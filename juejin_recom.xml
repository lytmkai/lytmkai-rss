<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[告别冗余！用Python + 星析API，一键自动化处理Shopify订单]]></title>    <link>https://juejin.cn/post/7576918517238497330</link>    <guid>https://juejin.cn/post/7576918517238497330</guid>    <pubDate>2025-11-27T05:48:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576918517238497330" data-draft-id="7576978338754412594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别冗余！用Python + 星析API，一键自动化处理Shopify订单"/> <meta itemprop="keywords" content="运营,掘金日报"/> <meta itemprop="datePublished" content="2025-11-27T05:48:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星析互联"/> <meta itemprop="url" content="https://juejin.cn/user/1370462103538153"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别冗余！用Python + 星析API，一键自动化处理Shopify订单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1370462103538153/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星析互联
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:48:22.000Z" title="Thu Nov 27 2025 05:48:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为一名跨境卖家，你是否也曾疲于在Shopify、广告平台和物流商之间反复横跳？手动处理订单、更新物流信息，不仅效率低下，还极易出错。今天，就让我们用Python和星析API，打造一个专属的订单自动化流水线，把时间和精力还给选品与营销。</p>
<hr/>
<p>对于日订单量上百的跨境卖家而言，订单处理环节的“人效”是制约发展的关键瓶颈。客服手动导出订单、打包后又要手动上传单号、标记发货……这套流程不仅消耗了大量人力，而且在订单高峰期，任何一步的疏忽都可能导致发错货、漏发货等严重客诉。</p>
<p><strong>如何破局？答案是API自动化。</strong></p>
<p>星析跨境服务商为此提供了稳定、高效且文档清晰的RESTful API接口，允许开发者将星析强大的物流与订单管理能力，无缝集成到自己的业务系统中。</p>
<p><strong>实战：用Python构建Shopify订单自动化流程</strong></p>
<p>假设我们有这样一个核心需求：<strong>定时获取Shopify的新订单，并通过星析API自动完成发货操作。</strong>  下面，我们分步实现。</p>
<p><strong>第一步：环境准备与认证</strong></p>
<p>首先，确保你已安装了Python的<code>requests</code>库。星析API通常使用API Key进行认证，你可以在星析开发者后台获取它。
python</p>
<pre><code class="hljs language-makefile" lang="makefile">import requests
import json

<span class="hljs-comment"># 星析API配置</span>
XINGXI_API_KEY = <span class="hljs-string">"你的星析API密钥"</span>
XINGXI_BASE_URL = <span class="hljs-string">"https://api.xingxi.com/v1"</span> <span class="hljs-comment"># 示例地址，请以官方文档为准</span>

<span class="hljs-comment"># 设置请求头</span>
headers = {
    <span class="hljs-string">"Authorization"</span>: f<span class="hljs-string">"Bearer {XINGXI_API_KEY}"</span>,
    <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
}
</code></pre>
<p><strong>第二步：获取待处理订单</strong></p>
<p>这里我们模拟从Shopify获取到的订单列表。在实际应用中，你需要调用Shopify的API来获取未履行的订单。</p>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 模拟从Shopify获取的订单数据</span>
<span class="hljs-attr">shopify_orders</span> = [
    {
        <span class="hljs-string">"order_id"</span>: <span class="hljs-string">"SH123456"</span>,
        <span class="hljs-string">"customer"</span>: <span class="hljs-string">"John Doe"</span>,
        <span class="hljs-string">"line_items"</span>: [{<span class="hljs-string">"title"</span>: <span class="hljs-string">"Product A"</span>, <span class="hljs-string">"quantity"</span>: <span class="hljs-number">1</span>}]
    }
]
</code></pre>
<p><strong>第三步：调用星析API创建运单</strong></p>
<p>这是核心步骤。我们遍历Shopify订单，为每一个订单调用星析的运单创建接口。</p>
<p>python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">for</span> order <span class="hljs-keyword">in</span> shopify_orders:
    <span class="hljs-comment"># 构建请求体，根据星析API文档要求传递参数</span>
    shipping_data = {
        <span class="hljs-string">"order_sn"</span>: order[<span class="hljs-string">"order_id"</span>], <span class="hljs-comment"># 使用Shopify订单号作为外部单号</span>
        <span class="hljs-string">"recipient"</span>: {...}, <span class="hljs-comment"># 收件人信息，可从Shopify订单中提取</span>
        <span class="hljs-string">"package_info"</span>: {...}, <span class="hljs-comment"># 包裹信息</span>
        <span class="hljs-string">"channel_code"</span>: <span class="hljs-string">"UPS"</span> <span class="hljs-comment"># 选择的物流渠道</span>
    }
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 发送POST请求创建运单</span>
        response = requests.post(
            <span class="hljs-string">f"<span class="hljs-subst">{XINGXI_BASE_URL}</span>/shipping/order/create"</span>,
            headers=headers,
            data=json.dumps(shipping_data)
        )
        response.raise_for_status() <span class="hljs-comment"># 如果状态码不是200，则抛出异常</span>
        
        result = response.json()
        
        <span class="hljs-comment"># 判断请求是否成功</span>
        <span class="hljs-keyword">if</span> result.get(<span class="hljs-string">"code"</span>) == <span class="hljs-number">200</span>:
            tracking_number = result[<span class="hljs-string">"data"</span>][<span class="hljs-string">"tracking_number"</span>]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"订单 <span class="hljs-subst">{order[<span class="hljs-string">'order_id'</span>]}</span> 发货成功！物流单号：<span class="hljs-subst">{tracking_number}</span>"</span>)
            
            <span class="hljs-comment"># 第四步（可选）：回写物流单号到Shopify</span>
            <span class="hljs-comment"># 这里可以调用Shopify API，更新该订单的物流信息并标记为已发货。</span>
            <span class="hljs-comment"># update_shopify_fulfillment(order['order_id'], tracking_number)</span>
            
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"订单 <span class="hljs-subst">{order[<span class="hljs-string">'order_id'</span>]}</span> 处理失败：<span class="hljs-subst">{result.get(<span class="hljs-string">'message'</span>)}</span>"</span>)
            
    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"请求星析API时发生错误: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<p><strong>价值升华与行动引导</strong></p>
<p>通过这个简单的脚本，我们实现了从订单获取到发货的全流程自动化。一旦部署，系统可以7x24小时无间断运行，将人力从重复劳动中彻底解放，实现降本增效。</p>
<p>这只是星析API能力的冰山一角。你还可以利用它：</p>
<ul>
<li><strong>同步库存</strong>：实时同步多个仓库的库存数据到各大销售平台，避免超卖。</li>
<li><strong>生成数据报表</strong>：自动拉取物流轨迹、运费成本等数据，生成可视化报表。</li>
</ul>
<p>技术是驱动跨境业务增长的核心引擎。立即<strong>访问星析官网的开发者中心</strong>，查阅完整的API文档，开启你的自动化之旅吧！我们还为新用户提供了充足的<strong>免费API调用额度</strong>，助你无忧测试与集成。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[印度尼西亚股票多时间框架K线数据可视化页面]]></title>    <link>https://juejin.cn/post/7577042851079782443</link>    <guid>https://juejin.cn/post/7577042851079782443</guid>    <pubDate>2025-11-27T06:25:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577042851079782443" data-draft-id="7576955345378951231" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="印度尼西亚股票多时间框架K线数据可视化页面"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-27T06:25:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="StockPP"/> <meta itemprop="url" content="https://juejin.cn/user/4176365494996116"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            印度尼西亚股票多时间框架K线数据可视化页面
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4176365494996116/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    StockPP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:25:34.000Z" title="Thu Nov 27 2025 06:25:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">印度尼西亚股票多时间框架K线数据可视化页面</h2>
<p>下面我将为您创建一个直观展示印尼股票多时间框架K线数据的HTML页面，支持1分钟到1个月的不同时间周期切换。</p>
<h3 data-id="heading-1">设计思路</h3>
<p>首先分析需求：需要展示印尼股票的K线数据，支持1分钟、5分钟、15分钟、30分钟、1小时、1日和1月等不同时间框架的切换。页面需要直观易用，包含K线图、技术指标和交互控制面板。 以下是完整的实现代码：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>印尼股票多时间框架K线数据<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        * {
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">box-sizing</span>: border-box;
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Segoe UI'</span>, Tahoma, Geneva, Verdana, sans-serif;
        }
        
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#1a2a3a</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#0d1b2a</span> <span class="hljs-number">100%</span>);
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#e0e0e0</span>;
            <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-class">.container</span> {
            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1400px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
        }
        
        <span class="hljs-selector-tag">header</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">16</span>, <span class="hljs-number">30</span>, <span class="hljs-number">44</span>, <span class="hljs-number">0.8</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
        }
        
        <span class="hljs-selector-tag">h1</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#4fc3f7</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2.2rem</span>;
        }
        
        <span class="hljs-selector-class">.subtitle</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#90a4ae</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.1rem</span>;
        }
        
        <span class="hljs-selector-class">.content</span> {
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-class">.chart-container</span> {
            <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">16</span>, <span class="hljs-number">30</span>, <span class="hljs-number">44</span>, <span class="hljs-number">0.8</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
        }
        
        <span class="hljs-selector-class">.panel</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">280px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">16</span>, <span class="hljs-number">30</span>, <span class="hljs-number">44</span>, <span class="hljs-number">0.8</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
        }
        
        <span class="hljs-selector-class">.interval-selector</span> {
            <span class="hljs-attribute">display</span>: grid;
            <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>fr);
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-class">.interval-btn</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1e3a5c</span>;
            <span class="hljs-attribute">border</span>: none;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#bbdefb</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
            <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
            <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
            <span class="hljs-attribute">text-align</span>: center;
        }
        
        <span class="hljs-selector-class">.interval-btn</span><span class="hljs-selector-pseudo">:hover</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#2a4d7a</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>);
        }
        
        <span class="hljs-selector-class">.interval-btn</span><span class="hljs-selector-class">.active</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1565c0</span>;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">21</span>, <span class="hljs-number">101</span>, <span class="hljs-number">192</span>, <span class="hljs-number">0.4</span>);
        }
        
        <span class="hljs-selector-class">.stock-selector</span> {
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-class">.stock-selector</span> select {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1e3a5c</span>;
            <span class="hljs-attribute">border</span>: none;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#e0e0e0</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
        }
        
        <span class="hljs-selector-class">.info-card</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1e3a5c</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
        }
        
        <span class="hljs-selector-class">.info-card</span> <span class="hljs-selector-tag">h3</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#4fc3f7</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.1rem</span>;
        }
        
        <span class="hljs-selector-class">.price</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.8rem</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#4caf50</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-selector-class">.change</span><span class="hljs-selector-class">.positive</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#4caf50</span>;
        }
        
        <span class="hljs-selector-class">.change</span><span class="hljs-selector-class">.negative</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#f44336</span>;
        }
        
        <span class="hljs-selector-class">.stats</span> {
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">justify-content</span>: space-between;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
        }
        
        <span class="hljs-selector-class">.stat-item</span> {
            <span class="hljs-attribute">text-align</span>: center;
        }
        
        <span class="hljs-selector-class">.stat-value</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
        }
        
        <span class="hljs-selector-class">.stat-label</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.8rem</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#90a4ae</span>;
        }
        
        <span class="hljs-selector-id">#chart</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">600px</span>;
        }
        
        <span class="hljs-selector-class">.time-info</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#90a4ae</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
        }
        
        <span class="hljs-selector-class">.indicator-selector</span> {
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-selector-class">.indicator-btns</span> {
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-wrap</span>: wrap;
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
        }
        
        <span class="hljs-selector-class">.indicator-btn</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">12px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1a2a3a</span>;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#2a4d7a</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#bbdefb</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
            <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
        }
        
        <span class="hljs-selector-class">.indicator-btn</span><span class="hljs-selector-class">.active</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1565c0</span>;
            <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#4fc3f7</span>;
        }
        
        <span class="hljs-selector-tag">footer</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#90a4ae</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
        }
        
        <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">1024px</span>) {
            <span class="hljs-selector-class">.content</span> {
                <span class="hljs-attribute">flex-direction</span>: column;
            }
            
            <span class="hljs-selector-class">.panel</span> {
                <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            }
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>印度尼西亚股票多时间框架K线数据<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"subtitle"</span>&gt;</span>实时展示印尼雅加达综合指数(JCI)及主要股票的多周期K线图<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-container"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-info"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"timeInfo"</span>&gt;</span>数据更新时间: --<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stock-selector"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"stockSelect"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"JCI"</span>&gt;</span>雅加达综合指数 (JCI)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"BBCA"</span>&gt;</span>中亚银行 (BBCA)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"BBRI"</span>&gt;</span>印尼人民银行 (BBRI)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"TLKM"</span>&gt;</span>印尼电信 (TLKM)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"UNVR"</span>&gt;</span>联合利华印尼 (UNVR)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-selector"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"1m"</span>&gt;</span>1分钟<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"5m"</span>&gt;</span>5分钟<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"15m"</span>&gt;</span>15分钟<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"30m"</span>&gt;</span>30分钟<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn active"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"1h"</span>&gt;</span>1小时<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"1d"</span>&gt;</span>日线<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"1w"</span>&gt;</span>周线<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"interval-btn"</span> <span class="hljs-attr">data-interval</span>=<span class="hljs-string">"1mo"</span>&gt;</span>月线<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info-card"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>当前价格<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"price"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"currentPrice"</span>&gt;</span>--<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"change"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"priceChange"</span>&gt;</span>-- (--%)<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-item"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-value"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"openPrice"</span>&gt;</span>--<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-label"</span>&gt;</span>开盘<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-item"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-value"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"highPrice"</span>&gt;</span>--<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-label"</span>&gt;</span>最高<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-item"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-value"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lowPrice"</span>&gt;</span>--<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stat-label"</span>&gt;</span>最低<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-selector"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>技术指标<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btns"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btn active"</span> <span class="hljs-attr">data-indicator</span>=<span class="hljs-string">"ma"</span>&gt;</span>MA<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btn"</span> <span class="hljs-attr">data-indicator</span>=<span class="hljs-string">"ema"</span>&gt;</span>EMA<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btn"</span> <span class="hljs-attr">data-indicator</span>=<span class="hljs-string">"macd"</span>&gt;</span>MACD<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btn"</span> <span class="hljs-attr">data-indicator</span>=<span class="hljs-string">"rsi"</span>&gt;</span>RSI<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-btn"</span> <span class="hljs-attr">data-indicator</span>=<span class="hljs-string">"boll"</span>&gt;</span>布林带<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info-card"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>市场信息<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>印尼交易所交易时间: 09:30-12:00, 13:30-16:00 (UTC+7)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>货币: 印尼盾 (IDR)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>主要板块: 金融、资源、电信<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>数据来源: StockTV API | 本页面仅用于演示目的，不构成投资建议<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 初始化ECharts实例</span>
        <span class="hljs-keyword">const</span> chartDom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'chart'</span>);
        <span class="hljs-keyword">const</span> myChart = echarts.<span class="hljs-title function_">init</span>(chartDom);
        
        <span class="hljs-comment">// 当前选中的时间框架和股票</span>
        <span class="hljs-keyword">let</span> currentInterval = <span class="hljs-string">'1h'</span>;
        <span class="hljs-keyword">let</span> currentStock = <span class="hljs-string">'JCI'</span>;
        <span class="hljs-keyword">let</span> currentIndicator = <span class="hljs-string">'ma'</span>;
        
        <span class="hljs-comment">// 模拟K线数据生成函数（实际应用中应从API获取）</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateKLineData</span>(<span class="hljs-params">interval, count = <span class="hljs-number">100</span></span>) {
            <span class="hljs-keyword">const</span> basePrice = <span class="hljs-number">7000</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1000</span>;
            <span class="hljs-keyword">const</span> data = [];
            <span class="hljs-keyword">let</span> timestamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();
            
            <span class="hljs-comment">// 根据时间间隔设置时间步长（毫秒）</span>
            <span class="hljs-keyword">const</span> intervalMs = {
                <span class="hljs-string">'1m'</span>: <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'5m'</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'15m'</span>: <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'30m'</span>: <span class="hljs-number">30</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'1h'</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'1d'</span>: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'1w'</span>: <span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
                <span class="hljs-string">'1mo'</span>: <span class="hljs-number">30</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>
            }[interval] || <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;
            
            <span class="hljs-comment">// 生成倒序数据（最新的数据在最后）</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = count - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
                <span class="hljs-keyword">const</span> time = timestamp - i * intervalMs;
                <span class="hljs-keyword">const</span> open = i === count - <span class="hljs-number">1</span> ? basePrice : data[data.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>][<span class="hljs-number">1</span>];
                <span class="hljs-keyword">const</span> volatility = <span class="hljs-number">10</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">20</span>;
                <span class="hljs-keyword">const</span> change = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * volatility;
                <span class="hljs-keyword">const</span> close = open + change;
                <span class="hljs-keyword">const</span> high = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(open, close) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * volatility / <span class="hljs-number">2</span>;
                <span class="hljs-keyword">const</span> low = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(open, close) - <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * volatility / <span class="hljs-number">2</span>;
                <span class="hljs-keyword">const</span> volume = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1000000</span>) + <span class="hljs-number">100000</span>;
                
                data.<span class="hljs-title function_">push</span>([
                    echarts.<span class="hljs-property">format</span>.<span class="hljs-title function_">formatTime</span>(<span class="hljs-string">'yyyy-MM-dd HH:mm'</span>, time),
                    open,
                    close,
                    low,
                    high,
                    volume
                ]);
            }
            
            <span class="hljs-keyword">return</span> data;
        }
        
        <span class="hljs-comment">// 计算移动平均线</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateMA</span>(<span class="hljs-params">dayCount, data</span>) {
            <span class="hljs-keyword">const</span> result = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i++) {
                <span class="hljs-keyword">if</span> (i &lt; dayCount) {
                    result.<span class="hljs-title function_">push</span>(<span class="hljs-string">'-'</span>);
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; dayCount; j++) {
                    sum += data[i - j][<span class="hljs-number">2</span>]; <span class="hljs-comment">// 收盘价</span>
                }
                result.<span class="hljs-title function_">push</span>(+(sum / dayCount).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>));
            }
            <span class="hljs-keyword">return</span> result;
        }
        
        <span class="hljs-comment">// 更新图表</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateChart</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> klineData = <span class="hljs-title function_">generateKLineData</span>(currentInterval);
            
            <span class="hljs-comment">// 更新信息面板</span>
            <span class="hljs-keyword">const</span> latestData = klineData[klineData.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'currentPrice'</span>).<span class="hljs-property">textContent</span> = latestData[<span class="hljs-number">2</span>].<span class="hljs-title function_">toLocaleString</span>();
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'openPrice'</span>).<span class="hljs-property">textContent</span> = latestData[<span class="hljs-number">1</span>].<span class="hljs-title function_">toLocaleString</span>();
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'highPrice'</span>).<span class="hljs-property">textContent</span> = latestData[<span class="hljs-number">4</span>].<span class="hljs-title function_">toLocaleString</span>();
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'lowPrice'</span>).<span class="hljs-property">textContent</span> = latestData[<span class="hljs-number">3</span>].<span class="hljs-title function_">toLocaleString</span>();
            
            <span class="hljs-keyword">const</span> change = latestData[<span class="hljs-number">2</span>] - latestData[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">const</span> changePercent = (change / latestData[<span class="hljs-number">1</span>] * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
            <span class="hljs-keyword">const</span> changeElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'priceChange'</span>);
            changeElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${change &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>}</span><span class="hljs-subst">${change.toFixed(<span class="hljs-number">2</span>)}</span> (<span class="hljs-subst">${changePercent}</span>%)`</span>;
            changeElement.<span class="hljs-property">className</span> = <span class="hljs-string">`change <span class="hljs-subst">${change &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'positive'</span> : <span class="hljs-string">'negative'</span>}</span>`</span>;
            
            <span class="hljs-comment">// 更新时间信息</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'timeInfo'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`数据更新时间: <span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleString()}</span>`</span>;
            
            <span class="hljs-comment">// 计算技术指标</span>
            <span class="hljs-keyword">const</span> ma5 = <span class="hljs-title function_">calculateMA</span>(<span class="hljs-number">5</span>, klineData);
            <span class="hljs-keyword">const</span> ma10 = <span class="hljs-title function_">calculateMA</span>(<span class="hljs-number">10</span>, klineData);
            <span class="hljs-keyword">const</span> ma20 = <span class="hljs-title function_">calculateMA</span>(<span class="hljs-number">20</span>, klineData);
            
            <span class="hljs-comment">// 配置图表选项</span>
            <span class="hljs-keyword">const</span> option = {
                <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'transparent'</span>,
                <span class="hljs-attr">animation</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">legend</span>: {
                    <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>,
                    <span class="hljs-attr">left</span>: <span class="hljs-string">'center'</span>,
                    <span class="hljs-attr">data</span>: [currentStock, <span class="hljs-string">'MA5'</span>, <span class="hljs-string">'MA10'</span>, <span class="hljs-string">'MA20'</span>],
                    <span class="hljs-attr">textStyle</span>: {
                        <span class="hljs-attr">color</span>: <span class="hljs-string">'#e0e0e0'</span>
                    }
                },
                <span class="hljs-attr">tooltip</span>: {
                    <span class="hljs-attr">trigger</span>: <span class="hljs-string">'axis'</span>,
                    <span class="hljs-attr">axisPointer</span>: {
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'cross'</span>
                    },
                    <span class="hljs-attr">borderWidth</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'#2a4d7a'</span>,
                    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'rgba(16, 30, 44, 0.9)'</span>,
                    <span class="hljs-attr">textStyle</span>: {
                        <span class="hljs-attr">color</span>: <span class="hljs-string">'#e0e0e0'</span>
                    },
                    <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">params</span>) {
                        <span class="hljs-keyword">const</span> data = params[<span class="hljs-number">0</span>].<span class="hljs-property">data</span>;
                        <span class="hljs-keyword">return</span> <span class="hljs-string">`
                            &lt;div&gt;时间: <span class="hljs-subst">${data[<span class="hljs-number">0</span>]}</span>&lt;/div&gt;
                            &lt;div&gt;开盘: <span class="hljs-subst">${data[<span class="hljs-number">1</span>]}</span>&lt;/div&gt;
                            &lt;div&gt;收盘: <span class="hljs-subst">${data[<span class="hljs-number">2</span>]}</span>&lt;/div&gt;
                            &lt;div&gt;最低: <span class="hljs-subst">${data[<span class="hljs-number">3</span>]}</span>&lt;/div&gt;
                            &lt;div&gt;最高: <span class="hljs-subst">${data[<span class="hljs-number">4</span>]}</span>&lt;/div&gt;
                            &lt;div&gt;成交量: <span class="hljs-subst">${data[<span class="hljs-number">5</span>].toLocaleString()}</span>&lt;/div&gt;
                        `</span>;
                    }
                },
                <span class="hljs-attr">grid</span>: {
                    <span class="hljs-attr">top</span>: <span class="hljs-number">80</span>,
                    <span class="hljs-attr">left</span>: <span class="hljs-number">50</span>,
                    <span class="hljs-attr">right</span>: <span class="hljs-number">50</span>,
                    <span class="hljs-attr">bottom</span>: <span class="hljs-number">80</span>
                },
                <span class="hljs-attr">xAxis</span>: {
                    <span class="hljs-attr">type</span>: <span class="hljs-string">'category'</span>,
                    <span class="hljs-attr">data</span>: klineData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item[<span class="hljs-number">0</span>]),
                    <span class="hljs-attr">scale</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">boundaryGap</span>: <span class="hljs-literal">false</span>,
                    <span class="hljs-attr">axisLine</span>: {<span class="hljs-attr">onZero</span>: <span class="hljs-literal">false</span>},
                    <span class="hljs-attr">splitLine</span>: {<span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>},
                    <span class="hljs-attr">splitNumber</span>: <span class="hljs-number">20</span>,
                    <span class="hljs-attr">axisLabel</span>: {
                        <span class="hljs-attr">color</span>: <span class="hljs-string">'#90a4ae'</span>,
                        <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {
                            <span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(value);
                            <span class="hljs-keyword">if</span> (currentInterval === <span class="hljs-string">'1d'</span> || currentInterval === <span class="hljs-string">'1w'</span> || currentInterval === <span class="hljs-string">'1mo'</span>) {
                                <span class="hljs-keyword">return</span> echarts.<span class="hljs-property">format</span>.<span class="hljs-title function_">formatTime</span>(<span class="hljs-string">'MM-dd'</span>, date);
                            } <span class="hljs-keyword">else</span> {
                                <span class="hljs-keyword">return</span> echarts.<span class="hljs-property">format</span>.<span class="hljs-title function_">formatTime</span>(<span class="hljs-string">'HH:mm'</span>, date);
                            }
                        }
                    }
                },
                <span class="hljs-attr">yAxis</span>: {
                    <span class="hljs-attr">scale</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">splitArea</span>: {
                        <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">areaStyle</span>: {
                            <span class="hljs-attr">color</span>: [<span class="hljs-string">'rgba(255,255,255,0.02)'</span>, <span class="hljs-string">'rgba(0,0,0,0.02)'</span>]
                        }
                    },
                    <span class="hljs-attr">axisLabel</span>: {
                        <span class="hljs-attr">color</span>: <span class="hljs-string">'#90a4ae'</span>,
                        <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {
                            <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">toLocaleString</span>();
                        }
                    }
                },
                <span class="hljs-attr">dataZoom</span>: [
                    {
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'inside'</span>,
                        <span class="hljs-attr">start</span>: <span class="hljs-number">50</span>,
                        <span class="hljs-attr">end</span>: <span class="hljs-number">100</span>
                    },
                    {
                        <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'slider'</span>,
                        <span class="hljs-attr">top</span>: <span class="hljs-string">'90%'</span>,
                        <span class="hljs-attr">height</span>: <span class="hljs-number">40</span>,
                        <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'#1a2a3a'</span>,
                        <span class="hljs-attr">textStyle</span>: {
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#90a4ae'</span>
                        },
                        <span class="hljs-attr">handleStyle</span>: {
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#2a4d7a'</span>
                        }
                    }
                ],
                <span class="hljs-attr">series</span>: [
                    {
                        <span class="hljs-attr">name</span>: currentStock,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'candlestick'</span>,
                        <span class="hljs-attr">data</span>: klineData,
                        <span class="hljs-attr">itemStyle</span>: {
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#ef5350'</span>,
                            <span class="hljs-attr">color0</span>: <span class="hljs-string">'#26a69a'</span>,
                            <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'#ef5350'</span>,
                            <span class="hljs-attr">borderColor0</span>: <span class="hljs-string">'#26a69a'</span>
                        },
                        <span class="hljs-attr">markPoint</span>: {
                            <span class="hljs-attr">label</span>: {
                                <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">param</span>) {
                                    <span class="hljs-keyword">return</span> param != <span class="hljs-literal">null</span> ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(param.<span class="hljs-property">value</span>) : <span class="hljs-string">''</span>;
                                }
                            },
                            <span class="hljs-attr">data</span>: [
                                {
                                    <span class="hljs-attr">name</span>: <span class="hljs-string">'最高值'</span>,
                                    <span class="hljs-attr">type</span>: <span class="hljs-string">'max'</span>,
                                    <span class="hljs-attr">valueDim</span>: <span class="hljs-string">'highest'</span>
                                },
                                {
                                    <span class="hljs-attr">name</span>: <span class="hljs-string">'最低值'</span>,
                                    <span class="hljs-attr">type</span>: <span class="hljs-string">'min'</span>,
                                    <span class="hljs-attr">valueDim</span>: <span class="hljs-string">'lowest'</span>
                                }
                            ]
                        }
                    },
                    {
                        <span class="hljs-attr">name</span>: <span class="hljs-string">'MA5'</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>,
                        <span class="hljs-attr">data</span>: ma5,
                        <span class="hljs-attr">smooth</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">showSymbol</span>: <span class="hljs-literal">false</span>,
                        <span class="hljs-attr">lineStyle</span>: {
                            <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>,
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#4fc3f7'</span>
                        }
                    },
                    {
                        <span class="hljs-attr">name</span>: <span class="hljs-string">'MA10'</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>,
                        <span class="hljs-attr">data</span>: ma10,
                        <span class="hljs-attr">smooth</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">showSymbol</span>: <span class="hljs-literal">false</span>,
                        <span class="hljs-attr">lineStyle</span>: {
                            <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>,
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#fdd835'</span>
                        }
                    },
                    {
                        <span class="hljs-attr">name</span>: <span class="hljs-string">'MA20'</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>,
                        <span class="hljs-attr">data</span>: ma20,
                        <span class="hljs-attr">smooth</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">showSymbol</span>: <span class="hljs-literal">false</span>,
                        <span class="hljs-attr">lineStyle</span>: {
                            <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>,
                            <span class="hljs-attr">color</span>: <span class="hljs-string">'#ab47bc'</span>
                        }
                    },
                    {
                        <span class="hljs-attr">name</span>: <span class="hljs-string">'成交量'</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'bar'</span>,
                        <span class="hljs-attr">xAxisIndex</span>: <span class="hljs-number">1</span>,
                        <span class="hljs-attr">yAxisIndex</span>: <span class="hljs-number">1</span>,
                        <span class="hljs-attr">data</span>: klineData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item[<span class="hljs-number">5</span>]),
                        <span class="hljs-attr">itemStyle</span>: {
                            <span class="hljs-attr">color</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">params</span>) {
                                <span class="hljs-keyword">const</span> data = klineData[params.<span class="hljs-property">dataIndex</span>];
                                <span class="hljs-keyword">return</span> data[<span class="hljs-number">2</span>] &gt;= data[<span class="hljs-number">1</span>] ? <span class="hljs-string">'#26a69a'</span> : <span class="hljs-string">'#ef5350'</span>;
                            }
                        }
                    }
                ]
            };
            
            <span class="hljs-comment">// 设置图表选项</span>
            myChart.<span class="hljs-title function_">setOption</span>(option);
        }
        
        <span class="hljs-comment">// 初始化事件监听</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">initEventListeners</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// 时间框架切换</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.interval-btn'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span> {
                btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.interval-btn'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>));
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
                    currentInterval = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-interval'</span>);
                    <span class="hljs-title function_">updateChart</span>();
                });
            });
            
            <span class="hljs-comment">// 股票选择</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'stockSelect'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                currentStock = <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;
                <span class="hljs-title function_">updateChart</span>();
            });
            
            <span class="hljs-comment">// 技术指标切换</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.indicator-btn'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span> {
                btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.indicator-btn'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>));
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
                    currentIndicator = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-indicator'</span>);
                    <span class="hljs-comment">// 这里可以添加切换技术指标的逻辑</span>
                });
            });
            
            <span class="hljs-comment">// 窗口大小变化时调整图表大小</span>
            <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                myChart.<span class="hljs-title function_">resize</span>();
            });
        }
        
        <span class="hljs-comment">// 页面加载完成后初始化</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">initEventListeners</span>();
            <span class="hljs-title function_">updateChart</span>();
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">功能说明</h3>
<p>这个HTML页面提供了以下功能：</p>
<ol>
<li><strong>多时间框架切换</strong>：支持1分钟、5分钟、15分钟、30分钟、1小时、日线、周线和月线视图</li>
<li><strong>股票选择</strong>：可以查看雅加达综合指数(JCI)和印尼主要股票（如BBCA、BBRI等）</li>
<li><strong>技术指标</strong>：包含MA（移动平均线）等常用技术指标</li>
<li><strong>实时数据展示</strong>：显示当前价格、涨跌幅、开盘价、最高价和最低价</li>
<li><strong>交互功能</strong>：支持图表缩放、平移等操作</li>
</ol>
<h3 data-id="heading-3">技术实现</h3>
<p>页面使用ECharts库绘制K线图，这是一个功能强大的数据可视化库。通过JavaScript生成模拟的K线数据（实际应用中应替换为真实的API调用）。 页面设计采用暗色主题，符合金融数据展示的常见风格，确保数据可视性并减少视觉疲劳。</p>
<h3 data-id="heading-4">如何使用</h3>
<ol>
<li>将上述代码保存为HTML文件</li>
<li>在浏览器中打开该文件</li>
<li>使用左侧面板切换不同的时间框架和股票</li>
<li>通过图表下方的滑块缩放和平移K线图</li>
</ol>
<p>在实际应用中，您需要将模拟数据生成部分替换为真实的API调用，例如使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fpao.stocktv.top%2F" target="_blank" title="https://pao.stocktv.top/" ref="nofollow noopener noreferrer">StockTV</a>等金融数据服务商提供的接口。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue响应式原理(13)-ref实现原理解析]]></title>    <link>https://juejin.cn/post/7577171133444227108</link>    <guid>https://juejin.cn/post/7577171133444227108</guid>    <pubDate>2025-11-27T06:17:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577171133444227108" data-draft-id="7576935292428861482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue响应式原理(13)-ref实现原理解析"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-27T06:17:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="明教教主张5G"/> <meta itemprop="url" content="https://juejin.cn/user/644766058425008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue响应式原理(13)-ref实现原理解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/644766058425008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    明教教主张5G
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:17:44.000Z" title="Thu Nov 27 2025 06:17:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 3 中 Ref 实现原理解析</h2>
<p>在 Vue 3 中，<code>ref</code> 是组合式 API（Composition API）的核心。很多开发者虽然会用，但对其内部运作机制、<code>ref</code> 与 <code>reactive</code> 的关系、以及为什么在scrit中我们访问 <code>ref</code> 数据需要用 <code>.value</code>, 但是在模板里不需要 <code>.value</code> 往往一知半解。</p>
<p>本文将剥离复杂的边界情况，用最精简的代码还原 Vue 3 源码的核心逻辑，带你彻底搞懂这三个问题：</p>
<ol>
<li><strong><code>ref</code> 是如何实现的？</strong></li>
<li><strong><code>toRefs</code> 是如何解决解构丢失响应性问题的？</strong></li>
<li><strong>为什么在模板中不需要 <code>.value</code>？</strong></li>
</ol>
<hr/>
<h3 data-id="heading-1">1. Ref 的原理解析</h3>
<h4 data-id="heading-2">为什么需要 Ref？</h4>
<p>在先前的部分中，我们对响应式数据的原理进行了介绍，我们通过 <code>reactive</code> 函数处理一个对象来使其转变为响应式数据，而对于 JavaScript 中的原始类型（String, Number, Boolean, ...）是<strong>值传递</strong>的。如果你把一个数字传给一个函数，函数无法追踪这个数字的变化。为了让原始值变成“响应式”，我们需要把它包裹在一个对象中（Wrapper Pattern），利用对象的 <code>getter</code> 和 <code>setter</code> 来拦截访问和修改。</p>
<h4 data-id="heading-3">核心实现：<code>RefImpl</code> 类</h4>
<p>Vue 3 内部通过 <code>RefImpl</code> 类来实现 <code>ref</code>。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 伪代码：简化版的 RefImpl</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RefImpl</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">_value</span>: <span class="hljs-built_in">any</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">_rawValue</span>: <span class="hljs-built_in">any</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-attr">dep</span>: <span class="hljs-title class_">Dep</span>; <span class="hljs-comment">// 依赖容器</span>
  <span class="hljs-keyword">public</span> __v_isRef = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 标记这是一个 ref 对象</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span> = value;
    <span class="hljs-comment">// 如果传入的是对象，则通过 reactive 转换，否则保持原值</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-title function_">isObject</span>(value) ? <span class="hljs-title function_">reactive</span>(value) : value;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(); <span class="hljs-comment">// 假设这是依赖收集容器</span>
  }

  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-comment">// 1. 依赖收集 (Track)</span>
    <span class="hljs-title function_">trackEffects</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span>); 
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>;
  }

  <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newVal</span>) {
    <span class="hljs-comment">// 只有值发生改变时才触发</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasChanged</span>(newVal, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span>)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span> = newVal;
      <span class="hljs-comment">// 如果新值是对象，同样需要转换</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-title function_">isObject</span>(newVal) ? <span class="hljs-title function_">reactive</span>(newVal) : newVal;
      <span class="hljs-comment">// 2. 派发更新 (Trigger)</span>
      <span class="hljs-title function_">triggerEffects</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span>); 
    }
  }
}

<span class="hljs-comment">// 暴露出来的 ref 函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ref</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RefImpl</span>(value);
}
</code></pre>
<h4 data-id="heading-4">关键点解析</h4>
<ol>
<li><code>ref</code> 本质上会返回一个类的实例对象，这个对象拥有 <code>.value</code> 的访问器属性。</li>
<li><strong>__v_isRef</strong>：RefImpl 类需要增加一个 <code>__v_isRef</code> 属性用于区别 “Ref对象”与“含有 value 属性的普通对象”。<code>ref</code> 的本质是一个拥有 <code>.value</code> 属性的对象，但并不是所有拥有 <code>.value</code> 的对象都是 <code>ref</code>。如果不增加这个标识位，很难区分下面二者的区别：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 真正的 ref</span>
<span class="hljs-keyword">const</span> realRef = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>); 
<span class="hljs-comment">// realRef 结构: { value: 1, dep: Set, __v_isRef: true, ... }</span>

<span class="hljs-comment">// 用户不小心定义的普通对象</span>
<span class="hljs-keyword">const</span> fakeRef = { <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> };
<span class="hljs-comment">// fakeRef 结构: { value: 1 }</span>
</code></pre>
<p>当 <code>Vue</code> 的模板系统或者 <code>reactive</code> 尝试“自动解包”（读取 <code>.value</code>）时，如果没有 <code>__v_isRef</code>，系统可能会错误地把用户定义的 <code>fakeRef</code> 也当作响应式对象处理，去尝试读取它的依赖（<code>dep</code>），这会导致报错或逻辑混乱。</p>
<ol start="3">
<li><strong>Getter/Setter</strong>：
<ul>
<li><code>get value()</code>：当访问 <code>.value</code> 时，调用 <code>track</code> 收集当前副作用函数（Effect）。</li>
<li><code>set value()</code>：当修改 <code>.value</code> 时，比较新旧值，若变化则调用 <code>trigger</code> 通知视图更新。</li>
</ul>
</li>
<li><strong>兼容对象参数</strong>：如果 <code>ref(obj)</code> 接收的是一个对象，源码中会调用 <code>reactive(obj)</code> 将其转化为深层响应式对象。这就是为什么 <code>ref</code> 可以包裹对象，且对象内部属性变化也能触发更新。</li>
</ol>
<hr/>
<h3 data-id="heading-5">2. toRefs 的原理解析</h3>
<h4 data-id="heading-6">为什么需要 toRefs？</h4>
<p>当我们对一个 <code>reactive</code> 对象进行<strong>解构</strong>时，会丢失响应性，因为解构出来的只是普通的变量。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
<span class="hljs-keyword">const</span> { count } = state; <span class="hljs-comment">// count 此时只是一个普通数字 1，与 state 断开联系了</span>
</code></pre>
<p><code>toRefs</code> 的作用就是把 <code>reactive</code> 对象的每一个属性都转换成一个 <code>ref</code>，但这个 <code>ref</code> 比较特殊，它<strong>链接</strong>到了源对象。</p>
<h4 data-id="heading-7">核心实现：<code>ObjectRefImpl</code> 类</h4>
<p><code>toRefs</code> 内部并不是创建标准的 <code>RefImpl</code>，而是创建了 <code>ObjectRefImpl</code>。它不存储值，只是作为源对象属性的“代理”。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectRefImpl</span> {
  <span class="hljs-keyword">public</span> __v_isRef = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 标记为 ref</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> _object, <span class="hljs-comment">// 源 reactive 对象</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> _key     <span class="hljs-comment">// 指定的 key</span>
  </span>) {}

  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-comment">// 访问时，直接读取源对象的属性</span>
    <span class="hljs-comment">// 因为 _object 是响应式的，所以这里会自动触发源对象的依赖收集</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">_key</span>];
  }

  <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newVal</span>) {
    <span class="hljs-comment">// 修改时，直接修改源对象的属性</span>
    <span class="hljs-comment">// 这里会自动触发源对象的更新派发</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">_key</span>] = newVal;
  }
}

<span class="hljs-comment">// toRef 函数：针对单个属性</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toRef</span>(<span class="hljs-params"><span class="hljs-built_in">object</span>, key</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectRefImpl</span>(<span class="hljs-built_in">object</span>, key);
}

<span class="hljs-comment">// toRefs 函数：遍历对象所有属性</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toRefs</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>) {
  <span class="hljs-keyword">const</span> ret = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(<span class="hljs-built_in">object</span>) ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-built_in">object</span>.<span class="hljs-property">length</span>) : {};
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> <span class="hljs-built_in">object</span>) {
    <span class="hljs-comment">// 为每个属性创建一个 ObjectRefImpl</span>
    ret[key] = <span class="hljs-title function_">toRef</span>(<span class="hljs-built_in">object</span>, key);
  }
  
  <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<h4 data-id="heading-8">关键点解析</h4>
<ol>
<li><code>ObjectRefImpl</code> 自身没有任何 <code>track</code> 或 <code>trigger</code> 的逻辑。它只是把操作转发给了源 <code>reactive</code> 对象。当我们获取到 <code>toRef</code> 函数返回的对象时，我们对其 .value 属性的读写实际上会转发到对 <code>this._object[this._key]</code> 的读写，自然就会触发其 <code>track</code> 或 <code>trigger</code> 的逻辑。</li>
<li><code>toRefs</code> 返回的是一个普通对象，里面的值全是 <code>ref</code>。这个普通对象可以被解构，解构出来的变量依然是 <code>ObjectRefImpl</code> 实例，依然保持着对源对象的引用。</li>
</ol>
<hr/>
<h3 data-id="heading-9">3. 模板自动解包 (Unwrapping) 原理解析</h3>
<h4 data-id="heading-10">现象</h4>
<p>在 <code>setup</code> 中我们需要用 <code>count.value</code>，但在 <code>&lt;template&gt;</code> 中我们直接写 <code>{{ count }}</code> 即可。这是 Vue 在编译和渲染阶段做了特殊处理。</p>
<h4 data-id="heading-11">核心实现：<code>proxyRefs</code></h4>
<p>首先需要介绍两个辅助函数：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 如果是 ref 返回 .value，否则返回原值</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">unref</span>(<span class="hljs-params">ref</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">isRef</span>(ref) ? ref.<span class="hljs-property">value</span> : ref;
}
<span class="hljs-comment">// 根据对象 __v_isRef 属性判断其是否是 ref 对象</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isRef</span>(<span class="hljs-params">r: any</span>): r is <span class="hljs-title class_">Ref</span> {
  <span class="hljs-keyword">return</span> !!(r &amp;&amp; r.<span class="hljs-property">__v_isRef</span> === <span class="hljs-literal">true</span>);
}
</code></pre>
<p><code>unref</code> 函数首先判断传入的是否是 <code>ref</code> 对象，如果是则返回 <code>ref.value</code>， 否则返回 <code>ref</code> 本身，这个函数正是模板自动解包原理的核心。</p>
<p>Vue 在完成对模板的解析之后，将 <code>setup</code> 的返回值传递给渲染函数之前，会通过 <code>proxyRefs</code> 函数对其进行一层代理，在代理中拦截了 get 和 set 操作，并通过 <code>unref</code> 函数</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> shallowUnwrapHandlers = {
  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">target, key, receiver</span>) =&gt;</span> {
    <span class="hljs-comment">// 1. 获取真实的值</span>
    <span class="hljs-keyword">const</span> value = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
    <span class="hljs-comment">// 2. 自动解包：如果是 ref 就返回 value.value，否则直接返回</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">unref</span>(value);
  },
  
  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">target, key, value, receiver</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> oldValue = target[key];
    <span class="hljs-comment">// 3. 特殊处理：如果旧值是 ref，但新值不是 ref</span>
    <span class="hljs-comment">// 意味着用户想给 ref 赋值：count.value = 1</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isRef</span>(oldValue) &amp;&amp; !<span class="hljs-title function_">isRef</span>(value)) {
      oldValue.<span class="hljs-property">value</span> = value;
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } 
    <span class="hljs-comment">// 其他情况直接替换</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);
  }
};

<span class="hljs-comment">// Vue 内部会在 setupState 上套这一层 Proxy</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyRefs</span>(<span class="hljs-params">objectWithRefs</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(objectWithRefs, shallowUnwrapHandlers);
}
</code></pre>
<h4 data-id="heading-12">运行流程</h4>
<ol>
<li><strong>建立代理</strong>：当 <code>setup()</code> 函数返回一个对象（包含 ref）时，Vue 内部调用 <code>handleSetupResult</code>，使用 <code>proxyRefs</code> 包装这个返回对象，生成 render context（渲染上下文）。</li>
<li><strong>模板读取</strong>：
<ul>
<li>当模板渲染遇到 <code>{{ count }}</code> 时，实际上是去在这个 Proxy 对象上取 <code>count</code>。</li>
<li>触发 <code>get</code> 拦截：发现 <code>count</code> 是一个 <code>ref</code>，Proxy 自动帮你调用 <code>.value</code> 并返回结果。</li>
</ul>
</li>
<li><strong>模板赋值</strong>（例如 <code>v-model</code>）：
<ul>
<li>如果在模板中写 <code>&lt;input v-model="count"&gt;</code>。</li>
<li>触发 <code>set</code> 拦截：Proxy 发现 <code>count</code> 原本是 <code>ref</code>，而输入的是普通值，它会将新值赋值给 <code>count.value</code>。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-13">总结</h3>

























<table><thead><tr><th align="left">特性</th><th align="left">核心实现类/函数</th><th align="left">关键原理</th></tr></thead><tbody><tr><td align="left"><strong>ref</strong></td><td align="left"><code>RefImpl</code></td><td align="left">利用 getter/setter 劫持 <code>.value</code> 属性，通过 <code>track/trigger</code> 管理依赖。若值为对象则借助 <code>reactive</code>。</td></tr><tr><td align="left"><strong>toRefs</strong></td><td align="left"><code>ObjectRefImpl</code></td><td align="left">不存值，仅仅是对源 <code>reactive</code> 对象属性的<strong>代理访问</strong>。解决了解构导致的响应性丢失问题。</td></tr><tr><td align="left"><strong>模板解包</strong></td><td align="left"><code>proxyRefs</code></td><td align="left">利用 <code>Proxy</code> 拦截 <code>setup</code> 返回对象的访问，遇到 <code>ref</code> 自动返回 <code>.value</code>，实现由模板到数据的无感读写。</td></tr></tbody></table>
<p>通过阅读这部分源码，我们可以看到 Vue 3 在易用性（自动解包）和灵活性（ref/reactive 分离）之间做了非常精妙的设计。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🔁 字符串反转 × 两数之和：前端面试高频题深度拆解（附5种反转写法 + 哈希优化）]]></title>    <link>https://juejin.cn/post/7576968345875300379</link>    <guid>https://juejin.cn/post/7576968345875300379</guid>    <pubDate>2025-11-27T06:21:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576968345875300379" data-draft-id="7576105442214117426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🔁 字符串反转 × 两数之和：前端面试高频题深度拆解（附5种反转写法 + 哈希优化）"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-27T06:21:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="玉宇夕落"/> <meta itemprop="url" content="https://juejin.cn/user/3323164053734988"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🔁 字符串反转 × 两数之和：前端面试高频题深度拆解（附5种反转写法 + 哈希优化）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3323164053734988/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    玉宇夕落
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:21:22.000Z" title="Thu Nov 27 2025 06:21:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端面试中， <strong>“反转字符串”</strong> 和 <strong>“两数之和”</strong> 虽看似简单，却是考察候选人 <strong>基础扎实度、代码思维、API 熟练度与算法意识</strong> 的经典组合拳。本文将带你：</p>
<ul>
<li>用 <strong>5 种方式实现字符串反转</strong>，对比优劣；</li>
<li>深入剖析 <strong>两数之和的暴力解 vs 哈希优化</strong>；</li>
<li>揭秘面试官真正想考察什么；</li>
<li>提供可直接复用的高质量代码模板。</li>
</ul>
<hr/>
<h2 data-id="heading-0">🔄 一、字符串反转：不止一种写法</h2>
<h3 data-id="heading-1">场景</h3>
<p>输入 <code>'hello'</code>，输出 <code>'olleh'</code>。</p>
<blockquote>
<p>💡 面试官关注点：</p>
<ul>
<li>是否熟悉数组/字符串 API（<code>split</code>, <code>reverse</code>, <code>join</code>）</li>
<li>能否写出清晰、健壮的循环逻辑</li>
<li>是否理解递归思想及其风险</li>
<li>是否会用现代语法（如扩展运算符、reduce）</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-2">✅ 方法1：经典三连（API 流）</h3>
<pre><code class="hljs language-perl" lang="perl">js
编辑
function reverseStr(str) {
  <span class="hljs-keyword">return</span> str.<span class="hljs-keyword">split</span>(<span class="hljs-string">''</span>).<span class="hljs-keyword">reverse</span>().join(<span class="hljs-string">''</span>);
}

const str = <span class="hljs-string">"hello"</span>; 
const arr = str.<span class="hljs-keyword">split</span>(<span class="hljs-string">''</span>); 
<span class="hljs-regexp">//</span> arr 的值会是：[<span class="hljs-string">'h'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'o'</span>]

const arr = [<span class="hljs-string">'h'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'o'</span>];
arr.<span class="hljs-keyword">reverse</span>(); 
<span class="hljs-regexp">//</span> 调用后，arr 本身被修改了，现在的值是：[<span class="hljs-string">'o'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'h'</span>]

const reversedArr = [<span class="hljs-string">'o'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'h'</span>]; 
const reversedStr = reversedArr.join(<span class="hljs-string">''</span>); 
<span class="hljs-regexp">//</span> reversedStr 的值会是：<span class="hljs-string">"olleh"</span>
</code></pre>
<ul>
<li><strong>优点</strong>：简洁、可读性强，体现对内置方法的掌握。</li>
<li><strong>缺点</strong>：创建中间数组，内存开销略高（但通常可忽略）。</li>
</ul>
<hr/>
<h3 data-id="heading-3">✅ 方法2：传统 for 循环（从后往前）</h3>
<pre><code class="hljs language-ini" lang="ini">js
编辑
function reverseStr(str) {
  let <span class="hljs-attr">reversed</span> = <span class="hljs-string">''</span><span class="hljs-comment">;</span>
  for (let <span class="hljs-attr">i</span> = str.length - <span class="hljs-number">1</span><span class="hljs-comment">; i &gt;= 0; i--) {</span>
    reversed += str<span class="hljs-section">[i]</span><span class="hljs-comment">;</span>
  }
  return reversed<span class="hljs-comment">;</span>
}
</code></pre>
<ul>
<li><strong>优点</strong>：逻辑直观，兼容性好（ES3 起支持）。</li>
<li><strong>注意</strong>：字符串拼接在旧引擎中可能低效（现代 V8 已优化）。</li>
</ul>
<hr/>
<h3 data-id="heading-4">✅ 方法3：for...of 反向拼接</h3>
<pre><code class="hljs language-csharp" lang="csharp">js
编辑
<span class="hljs-function">function <span class="hljs-title">reverseStr</span>(<span class="hljs-params">str</span>)</span> {
  <span class="hljs-keyword">let</span> reversed = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-built_in">char</span> of str) {
    reversed = <span class="hljs-built_in">char</span> + reversed; <span class="hljs-comment">// 每次把新字符放前面</span>
  }
  <span class="hljs-keyword">return</span> reversed;
}
</code></pre>
<ul>
<li><strong>优点</strong>：避免索引操作，更符合“遍历字符”语义。</li>
<li><strong>缺点</strong>：频繁字符串拼接（虽现代 JS 引擎已优化）。</li>
</ul>
<hr/>
<h3 data-id="heading-5">✅ 方法4：扩展运算符 + 数组方法（ES6+）</h3>
<pre><code class="hljs language-python" lang="python">js
编辑
function reverseStr(<span class="hljs-built_in">str</span>) {
  <span class="hljs-keyword">return</span> [...<span class="hljs-built_in">str</span>].reverse().join(<span class="hljs-string">''</span>);
}

const <span class="hljs-built_in">str</span> = <span class="hljs-string">"hello"</span>; const arr = [...<span class="hljs-built_in">str</span>]; 
// arr 的值会是：[<span class="hljs-string">'h'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'o'</span>]
</code></pre>
<ul>
<li><strong>优点</strong>：比 <code>split('')</code> 更优雅（尤其对 emoji/Unicode 支持更好）。</li>
<li><strong>原理</strong>：<code>[...str]</code> 能正确处理 UTF-16 代理对（如 <code>'👨‍💻'.length === 5</code>，但 <code>[...'👨‍💻'].length === 1</code>）。</li>
</ul>
<blockquote>
<p>🌰 对比：</p>
<pre><code class="hljs language-bash" lang="bash">js
编辑
<span class="hljs-string">'café'</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">''</span>)   // [<span class="hljs-string">'c'</span>,<span class="hljs-string">'a'</span>,<span class="hljs-string">'f'</span>,<span class="hljs-string">'é'</span>] ✅
<span class="hljs-string">'👨‍💻'</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">''</span>)    // [<span class="hljs-string">'👨'</span>, <span class="hljs-string">'‍'</span>, <span class="hljs-string">'💻'</span>] ❌
[...<span class="hljs-string">'👨‍💻'</span>]         // [<span class="hljs-string">'👨‍💻'</span>] ✅
</code></pre>
</blockquote>
<hr/>
<h3 data-id="heading-6">✅ 方法5：递归实现（展示思维）</h3>
<pre><code class="hljs language-rust" lang="rust">js
编辑
function <span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-type">str</span>) {
  <span class="hljs-title function_ invoke__">if</span> (<span class="hljs-type">str</span> === '') <span class="hljs-keyword">return</span> ''; <span class="hljs-comment">// 终止条件</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-type">str</span>.<span class="hljs-title function_ invoke__">substring</span>(<span class="hljs-number">1</span>)) + <span class="hljs-type">str</span>.<span class="hljs-title function_ invoke__">charAt</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-keyword">const</span> <span class="hljs-type">str</span> = <span class="hljs-string">"hello"</span>; 
<span class="hljs-keyword">const</span> subStr = <span class="hljs-type">str</span>.<span class="hljs-title function_ invoke__">substring</span>(<span class="hljs-number">1</span>); 
<span class="hljs-comment">// subStr 的值会是："ello" (从索引1的 'e' 开始到末尾)</span>

<span class="hljs-keyword">const</span> <span class="hljs-type">str</span> = <span class="hljs-string">"hello"</span>; 
<span class="hljs-keyword">const</span> firstChar = <span class="hljs-type">str</span>.<span class="hljs-title function_ invoke__">charAt</span>(<span class="hljs-number">0</span>); 
<span class="hljs-comment">// firstChar 的值会是："h" (索引0位置的字符)</span>

<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"hello"</span>)` 调用 `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"ello"</span>)`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"ello"</span>)` 调用 `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"llo"</span>)`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"llo"</span>)` 调用 `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"lo"</span>)`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"lo"</span>)` 调用 `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"o"</span>)`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"o"</span>)` 调用 `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">""</span>)`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">""</span>)` 触发终止条件，返回 `<span class="hljs-string">""</span>`
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"o"</span>)` 得到返回值 `<span class="hljs-string">""</span> + <span class="hljs-string">"o"</span>`，即 `<span class="hljs-string">"o"</span>`，并返回
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"lo"</span>)` 得到返回值 `<span class="hljs-string">"o"</span> + <span class="hljs-string">"l"</span>`，即 `<span class="hljs-string">"ol"</span>`，并返回
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"llo"</span>)` 得到返回值 `<span class="hljs-string">"ol"</span> + <span class="hljs-string">"l"</span>`，即 `<span class="hljs-string">"oll"</span>`，并返回
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"ello"</span>)` 得到返回值 `<span class="hljs-string">"oll"</span> + <span class="hljs-string">"e"</span>`，即 `<span class="hljs-string">"olle"</span>`，并返回
<span class="hljs-number">1</span>.  `<span class="hljs-title function_ invoke__">reverseStr</span>(<span class="hljs-string">"hello"</span>)` 得到返回值 `<span class="hljs-string">"olle"</span> + <span class="hljs-string">"h"</span>`，即 `<span class="hljs-string">"olleh"</span>`，并返回给最初的调用者
</code></pre>
<ul>
<li>
<p><strong>优点</strong>：体现分治思想，代码简洁。</p>
</li>
<li>
<p><strong>⚠️ 风险</strong>：</p>
<ul>
<li><strong>爆栈</strong>：长字符串（如 &gt;10,000 字符）会导致栈溢出；</li>
<li><strong>性能差</strong>：每次 <code>substring</code> 都创建新字符串，时间复杂度 O(n²)。</li>
</ul>
</li>
</ul>
<blockquote>
<p>🚫 <strong>不推荐生产使用</strong>，但面试可作为“展示递归理解”的备选。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">✅ 方法6：reduce 高阶函数（函数式风格）</h3>
<pre><code class="hljs language-javascript" lang="javascript">js
编辑
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverseStr</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-keyword">return</span> [...str].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">reversed, char</span>) =&gt;</span> char + reversed, <span class="hljs-string">''</span>);
}
</code></pre>
<ul>
<li><strong>优点</strong>：无状态、纯函数风格，适合函数式编程场景。</li>
<li><strong>缺点</strong>：可读性略低于三连 API。</li>
</ul>
<hr/>
<h2 data-id="heading-8">📊 反转方法对比总结</h2>






















































<table><thead><tr><th>方法</th><th>可读性</th><th>性能</th><th>Unicode 安全</th><th>推荐场景</th></tr></thead><tbody><tr><td><code>split+reverse+join</code></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>❌（部分）</td><td>快速实现</td></tr><tr><td><code>for</code> 循环</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>✅</td><td>兼容老环境</td></tr><tr><td><code>for...of</code></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>✅</td><td>现代项目</td></tr><tr><td><code>[...str]</code></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>✅✅</td><td><strong>首选推荐</strong></td></tr><tr><td>递归</td><td>⭐⭐</td><td>⭐</td><td>✅</td><td>面试展示</td></tr><tr><td><code>reduce</code></td><td>⭐⭐⭐</td><td>⭐⭐</td><td>✅</td><td>函数式偏好</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>最佳实践</strong>：日常开发优先用 <code>[...str].reverse().join('')</code>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">🔢 二、两数之和：从暴力到哈希优化</h2>
<blockquote>
<p><strong>题目</strong>：给定整数数组 <code>nums</code> 和目标值 <code>target</code>，找出两个数的索引，使其和等于 <code>target</code>。假设每组输入只有一组解。</p>
</blockquote>
<h3 data-id="heading-10">面试官真实意图：</h3>
<ul>
<li>考察 <strong>时间复杂度意识</strong></li>
<li>是否知道  <strong>“空间换时间”</strong>  思想</li>
<li>对 <strong>数据结构选择</strong> 的敏感度（Object vs Map）</li>
</ul>
<hr/>
<h3 data-id="heading-11">❌ 解法1：暴力双重循环（O(n²)）</h3>
<pre><code class="hljs language-ini" lang="ini">js
编辑
function twoSum(nums, target) {
  for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; nums.length; i++) {</span>
    for (let <span class="hljs-attr">j</span> = i + <span class="hljs-number">1</span><span class="hljs-comment">; j &lt; nums.length; j++) {</span>
      if (nums<span class="hljs-section">[i]</span> + nums<span class="hljs-section">[j]</span> === target) {
        return <span class="hljs-section">[i, j]</span><span class="hljs-comment">;</span>
      }
    }
  }
}
</code></pre>
<ul>
<li><strong>问题</strong>：n=10⁴ 时，操作次数达 5×10⁷，明显超时。</li>
<li><strong>结论</strong>：仅用于兜底或教学演示。</li>
</ul>
<hr/>
<h3 data-id="heading-12">✅ 解法2：哈希表优化（O(n)）——核心思路</h3>
<h4 data-id="heading-13">核心思想：</h4>
<blockquote>
<p><strong>“求和变求差”</strong><br/>
遍历时，记录每个数字及其索引；<br/>
对当前 <code>num</code>，检查 <code>target - num</code> 是否已存在。</p>
</blockquote>
<h4 data-id="heading-14">方案A：使用普通对象（Object）</h4>
<pre><code class="hljs language-ini" lang="ini">js
编辑
function twoSum(nums, target) {
  const <span class="hljs-attr">map</span> = {}<span class="hljs-comment">;</span>
  for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; nums.length; i++) {</span>
    const <span class="hljs-attr">complement</span> = target - nums[i]<span class="hljs-comment">;</span>
    if (map<span class="hljs-section">[complement]</span> !== undefined) {
      return <span class="hljs-section">[map[complement]</span>, i]<span class="hljs-comment">;</span>
    }
    map<span class="hljs-section">[nums[i]]</span> = i<span class="hljs-comment">;</span>
  }
}
</code></pre>
<ul>
<li><strong>风险</strong>：键为字符串，若 <code>nums</code> 含非数字（如 <code>'2'</code>），可能混淆；</li>
<li><strong>性能</strong>：V8 对对象属性访问高度优化，实际很快。</li>
</ul>
<h4 data-id="heading-15">方案B：使用 <code>Map</code>（推荐！）</h4>
<pre><code class="hljs language-ini" lang="ini">js
编辑
function twoSum(nums, target) {
  const <span class="hljs-attr">map</span> = new Map()<span class="hljs-comment">;</span>
  for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; nums.length; i++) {</span>
    const <span class="hljs-attr">complement</span> = target - nums[i]<span class="hljs-comment">;</span>
    if (map.has(complement)) {
      return <span class="hljs-section">[map.get(complement), i]</span><span class="hljs-comment">;</span>
    }
    map.set(nums<span class="hljs-section">[i]</span>, i)<span class="hljs-comment">;</span>
  }
}
</code></pre>
<ul>
<li>
<p><strong>优势</strong>：</p>
<ul>
<li>键类型保持原样（number 还是 number）；</li>
<li><code>has()</code> / <code>get()</code> 语义清晰；</li>
<li>避免原型链污染（如 <code>map.__proto__</code> 干扰）；</li>
<li>更符合“键值对容器”语义。</li>
</ul>
</li>
</ul>
<blockquote>
<p>📌 <strong>面试加分点</strong>：主动说出 “我选择 <code>Map</code> 而非对象，因为……”</p>
</blockquote>
<hr/>
<h2 data-id="heading-16">🧠 三、面试官到底想考什么？</h2>




















<table><thead><tr><th>题目</th><th>考察维度</th><th>高分回答要点</th></tr></thead><tbody><tr><td>字符串反转</td><td>- API 熟练度 - 代码风格 - 边界意识</td><td>“我会优先用 <code>[...str]</code> 因为它对 Unicode 更安全”</td></tr><tr><td>两数之和</td><td>- 算法思维 - 数据结构选择 - 复杂度分析</td><td>“暴力是 O(n²)，我用哈希表降到 O(n)，空间换时间”</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>避坑提示</strong>：</p>
<ul>
<li>不要一上来就写递归（除非被要求）；</li>
<li>不要说“Object 和 Map 一样”（暴露基础不牢）；</li>
<li>记得处理边界（如空字符串、无解情况）。</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-17">📌 四、总结 &amp; 复习清单</h2>
<h3 data-id="heading-18">✅ 字符串反转</h3>
<ul>
<li><strong>首选写法</strong>：<code>[...str].reverse().join('')</code></li>
<li><strong>慎用递归</strong>：有爆栈风险，性能差</li>
<li><strong>注意 Unicode</strong>：<code>split('')</code> 对 emoji 不友好</li>
</ul>
<h3 data-id="heading-19">✅ 两数之和</h3>
<ul>
<li><strong>最优解</strong>：<code>Map</code> + 一次遍历，O(n) 时间</li>
<li><strong>关键转换</strong>：<code>a + b = target</code> → <code>b = target - a</code></li>
<li><strong>不要用 Object 当哈希表</strong>（除非明确知道数据安全）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JSAPIThree UI 控件学习笔记：用内置控件提升交互]]></title>    <link>https://juejin.cn/post/7576928016901455882</link>    <guid>https://juejin.cn/post/7576928016901455882</guid>    <pubDate>2025-11-27T06:23:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576928016901455882" data-draft-id="7576978338754658354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JSAPIThree UI 控件学习笔记：用内置控件提升交互"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-27T06:23:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户296541275917"/> <meta itemprop="url" content="https://juejin.cn/user/4109293389357897"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JSAPIThree UI 控件学习笔记：用内置控件提升交互
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4109293389357897/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户296541275917
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:23:13.000Z" title="Thu Nov 27 2025 06:23:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作为刚接触 mapvthree 的新手，今天我专门学习了 UI 控件模块。这里整理出最常用的控件和实用技巧，帮助和我一样的初学者快速上手。</p>
</blockquote>
<h2 data-id="heading-0">控件管理入口：engine.widgets</h2>
<p>mapvthree 中的控件由 <code>EngineWidgets</code> 管理，实例化后可以通过 <code>engine.widgets</code> 访问。控件分两种启用方式：</p>
<ol>
<li><strong>初始化时配置</strong>：在 <code>new Engine()</code> 时，通过 <code>widgets</code> 字段设置 <code>enabled</code></li>
<li><strong>运行时控制</strong>：引擎创建完成后，直接修改 <code>engine.widgets.xxx.enabled</code></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> engine = <span class="hljs-keyword">new</span> mapvthree.<span class="hljs-title class_">Engine</span>(container, {
    <span class="hljs-attr">map</span>: { <span class="hljs-attr">center</span>: [<span class="hljs-number">106.515</span>, <span class="hljs-number">29.639</span>], <span class="hljs-attr">range</span>: <span class="hljs-number">500</span> },
    <span class="hljs-attr">rendering</span>: {
        <span class="hljs-comment">// 导出图片需要开启</span>
        <span class="hljs-attr">preserveDrawingBuffer</span>: <span class="hljs-literal">true</span>,
    },
    <span class="hljs-attr">widgets</span>: {
        <span class="hljs-attr">zoom</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },        <span class="hljs-comment">// 缩放控件</span>
        <span class="hljs-attr">fullscreen</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },  <span class="hljs-comment">// 全屏控件</span>
        <span class="hljs-attr">geoLocate</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },   <span class="hljs-comment">// 定位控件</span>
        <span class="hljs-attr">exportImage</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> }, <span class="hljs-comment">// 导出图片控件</span>
        <span class="hljs-attr">compass</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },     <span class="hljs-comment">// 指南针</span>
        <span class="hljs-attr">mapInfo</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },     <span class="hljs-comment">// 显示地理坐标</span>
    },
});

<span class="hljs-comment">// 运行时开启比例尺与 logo</span>
engine.<span class="hljs-property">widgets</span>.<span class="hljs-property">scale</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span>;
engine.<span class="hljs-property">widgets</span>.<span class="hljs-property">logo</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span>;
</code></pre>
<blockquote>
<p>小贴士：<code>exportImage</code> 必须搭配 <code>rendering.preserveDrawingBuffer = true</code>，否则截图会是空白。</p>
</blockquote>
<h2 data-id="heading-1">常用控件一览</h2>













































<table><thead><tr><th>控件</th><th>作用</th><th>使用建议</th></tr></thead><tbody><tr><td><code>zoom</code></td><td>显示缩放按钮</td><td>与鼠标滚轮配合，易用性更高</td></tr><tr><td><code>compass</code></td><td>显示方向和倾角</td><td>适合 3D 场景，便于用户恢复默认视角</td></tr><tr><td><code>fullscreen</code></td><td>全屏切换</td><td>适合大屏展示或需要沉浸体验的场景</td></tr><tr><td><code>geoLocate</code></td><td>定位按钮</td><td>搭配获取定位的业务逻辑使用</td></tr><tr><td><code>exportImage</code></td><td>导出当前场景为图片</td><td>需开启 <code>preserveDrawingBuffer</code></td></tr><tr><td><code>mapInfo</code></td><td>显示当前地理坐标</td><td>对需要精确定位的业务很有帮助</td></tr><tr><td><code>drawer</code></td><td>自定义控件容器（如工具面板）</td><td>可以挂自定义按钮或操作</td></tr></tbody></table>
<h2 data-id="heading-2">深入配置：mapInfo、drawer 与 accessors</h2>
<p>除了 <code>enabled</code>，部分控件还提供更细的参数：</p>
<ul>
<li><strong>mapInfo</strong>
<ul>
<li><code>template</code>：字符串由 <code>C</code>（中心点）、<code>R</code>（视野距离）、<code>H</code>（heading）、<code>P</code>（pitch）等占位符组成，默认 <code>CR</code></li>
<li><code>separator</code>：字段之间的分隔符，默认 <code>' | '</code></li>
<li>例如：<code>mapInfo: { enabled: true, template: 'CHP', separator: ', ' }</code></li>
</ul>
</li>
<li><strong>drawer</strong>
<ul>
<li><code>draws</code> 数组描述每个工具项：<code>name</code>、<code>defaultChecked</code>、<code>data</code>、<code>onChange</code></li>
<li><code>onChange(checked, data, engine)</code> 在开关时触发，可用于添加/移除对象</li>
</ul>
</li>
<li><strong>访问器（accessor）</strong>
<ul>
<li>每个控件都有对应的 getter，例如 <code>engine.widgets.zoom</code>、<code>engine.widgets.scale</code></li>
<li>获取到的是控件实例，可以直接读写属性：<code>engine.widgets.mapInfo.template = 'CRH'</code></li>
</ul>
</li>
</ul>
<h2 data-id="heading-3">自定义 Drawer 控件</h2>
<p><code>drawer</code> 类似一个工具抽屉，可以配置多个“工具项”。每个工具项的 <code>onChange</code> 回调会在开关时触发，可用于添加/移除物体等自定义逻辑。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> engine = <span class="hljs-keyword">new</span> mapvthree.<span class="hljs-title class_">Engine</span>(container, {
    ...,
    <span class="hljs-attr">widgets</span>: {
        <span class="hljs-attr">drawer</span>: {
            <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">draws</span>: [
                {
                    <span class="hljs-attr">name</span>: <span class="hljs-string">'添加绿盒子'</span>,
                    <span class="hljs-attr">data</span>: { <span class="hljs-attr">mesh</span>: <span class="hljs-literal">null</span> },
                    <span class="hljs-attr">onChange</span>: <span class="hljs-function">(<span class="hljs-params">checked, data, engine</span>) =&gt;</span> {
                        <span class="hljs-keyword">if</span> (!data.<span class="hljs-property">mesh</span>) {
                            <span class="hljs-keyword">const</span> position = engine.<span class="hljs-property">map</span>.<span class="hljs-title function_">projectArrayCoordinate</span>([<span class="hljs-number">106.515</span>, <span class="hljs-number">29.639</span>]);
                            <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
                            <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({<span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span>});
                            <span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
                            mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(position[<span class="hljs-number">0</span>], position[<span class="hljs-number">1</span>], position[<span class="hljs-number">2</span>]);
                            data.<span class="hljs-property">mesh</span> = mesh;
                        }
                        checked ? engine.<span class="hljs-title function_">add</span>(data.<span class="hljs-property">mesh</span>) : engine.<span class="hljs-title function_">remove</span>(data.<span class="hljs-property">mesh</span>);
                    },
                },
            ],
        },
    },
});
</code></pre>
<h2 data-id="heading-4">截图功能：别忘了 preserveDrawingBuffer</h2>
<p><code>exportImage</code> 控件其实是一个“导出当前画面”的按钮，但要正常截图必须开启 <code>rendering.preserveDrawingBuffer = true</code>。在纯引擎场景下只用设置这一项；如果叠加 BMapGL 或 mapbox，还需要在对应地图实例初始化时开启同名参数。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> engine = <span class="hljs-keyword">new</span> mapvthree.<span class="hljs-title class_">Engine</span>(container, {
    <span class="hljs-attr">rendering</span>: {
        <span class="hljs-attr">preserveDrawingBuffer</span>: <span class="hljs-literal">true</span>,
    },
    <span class="hljs-attr">widgets</span>: {
        <span class="hljs-attr">exportImage</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> },
    },
});
</code></pre>
<h2 data-id="heading-5">使用建议</h2>
<ul>
<li><strong>按需启用</strong>：控件越多越不一定好，按场景需求启用即可</li>
<li><strong>统一风格</strong>：若有自定义 UI，尽量与内置控件保持视觉一致</li>
<li><strong>与业务逻辑配合</strong>：控件只是入口，核心业务逻辑仍需自行实现（如定位、截图结果保存等）</li>
<li><strong>运行时控制</strong>：可以根据场景状态动态开启/关闭控件，例如进入播放模式时隐藏所有按钮</li>
</ul>
<hr/>
<blockquote>
<p>学习笔记就到这里啦！内置控件用起来并不复杂，关键是理解“初始化配置 + 运行时控制”这两种方式，然后按需组合即可。希望这份笔记能帮你快速把控件用好！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[autoDL安装Open-WebUi+Rag本地知识库问答+Function Calling]]></title>    <link>https://juejin.cn/post/7576929700842405897</link>    <guid>https://juejin.cn/post/7576929700842405897</guid>    <pubDate>2025-11-27T06:16:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576929700842405897" data-draft-id="7576978338754379826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="autoDL安装Open-WebUi+Rag本地知识库问答+Function Calling"/> <meta itemprop="keywords" content="后端,算法,人工智能"/> <meta itemprop="datePublished" content="2025-11-27T06:16:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="16_one"/> <meta itemprop="url" content="https://juejin.cn/user/2802034986197256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            autoDL安装Open-WebUi+Rag本地知识库问答+Function Calling
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2802034986197256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    16_one
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:16:06.000Z" title="Thu Nov 27 2025 06:16:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基础环境搭建</h2>
<ol>
<li>open-webui安装</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">pip install open-webui
</code></pre>
<p>2.  ollama在线安装</p>

<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//ollama.com/install.sh | sh</span>
</code></pre>
<p>2.1. 将模型下载地址改到数据盘</p>
<pre><code class="hljs language-bash" lang="bash">vim /etc/profile
<span class="hljs-built_in">export</span> OLLAMA_MODELS=/root/autodl-tmp/models
<span class="hljs-built_in">source</span> /etc/profile
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75603b64bf91446681b7e171960fb74d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=z6qo5N2GUCerQhCaWBhNKOyyVQk%3D" alt="image.png" loading="lazy"/>
2.2. 启动ollama</p>
<pre><code class="hljs language-sql" lang="sql">ollama <span class="hljs-keyword">start</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3db9188f6141416c9b980fb2dd4c8146~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=mQ7yDOL3gkaqMz8MtpnM3tbyvCQ%3D" alt="5b549c7e-dbee-4a05-b64b-43065e14c80e.png" loading="lazy"/>
3. 安装deepseek-r1:14b模型</p>
<pre><code class="hljs">ollama pull deepseek-r1:14b
</code></pre>
<p>4.  Embedding模型下载</p>

<pre><code class="hljs language-arduino" lang="arduino">ollama pull nomic-embed-text
</code></pre>
<p>5.  查看模型下载情况</p>

<pre><code class="hljs">ollama list
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2197e9452cb8410f886a903fb93a2a92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=lUeO4g2m%2BUm8rAVhZy5Rd9%2FCSXc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">Open-WebUi调用</h2>
<blockquote>
<p>首先需要设置离线环境，避免Open-WebUI启动时自动进行模型下载：</p>
<p>export HF_HUB_OFFLINE=1</p>
</blockquote>
<ol>
<li>Open-WebUi启动</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">open-webui serve
</code></pre>
<p>2.  本地8080端口访问</p>
<blockquote>
<p>需要建立链接隧道，autodl参考这里<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.autodl.com%2Fdocs%2Fvisdom%2F" target="_blank" title="https://www.autodl.com/docs/visdom/" ref="nofollow noopener noreferrer">www.autodl.com/docs/visdom…</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76b1a94e26e14597a37071d737108c93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=dOinCM%2FqSnmhAkPWqHVV%2Bcr4IDY%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>Rag本地知识库问答</li>
</ol>
<blockquote>
<p>按照如下步骤操作后，即可上传文档，进行基础本地知识库问答</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cb9dd05b40b475a823eaf1fb833e510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=XksybYfu5ag%2BoLZjDrKeUavcRh8%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>外部工具调用Function Calling</li>
</ol>
<blockquote>
<p>案例：连接本地MySQL数据库进行数据查询</p>
</blockquote>
<p>4.1. 安装mysql</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建mysql数据库</span>
apt install mysql<span class="hljs-operator">-</span>server


<span class="hljs-comment">-- 启动mysql</span>
mysqld <span class="hljs-operator">&amp;</span>
mysql

<span class="hljs-comment">-- 初始化密码</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'123'</span>;

<span class="hljs-comment">-- 退出</span>
exit；

<span class="hljs-comment">-- 再次进入</span>
mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p

<span class="hljs-comment">-- 创建数据库</span>
<span class="hljs-keyword">CREATE</span> DATABASE school;
USE school;

<span class="hljs-comment">-- 创建表结构</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> students_scores (
id <span class="hljs-type">INT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
course1 <span class="hljs-type">INT</span>,
course2 <span class="hljs-type">INT</span>,
course3 <span class="hljs-type">INT</span>
);

<span class="hljs-comment">-- 插入数据</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> students_scores (name, course1, course2, course3)
<span class="hljs-keyword">VALUES</span>
(<span class="hljs-string">'学生1'</span>, <span class="hljs-number">85</span>, <span class="hljs-number">92</span>, <span class="hljs-number">78</span>),
(<span class="hljs-string">'学生2'</span>, <span class="hljs-number">76</span>, <span class="hljs-number">88</span>, <span class="hljs-number">91</span>),
(<span class="hljs-string">'学生3'</span>, <span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">80</span>),
(<span class="hljs-string">'学生4'</span>, <span class="hljs-number">65</span>, <span class="hljs-number">70</span>, <span class="hljs-number">72</span>),
(<span class="hljs-string">'学生5'</span>, <span class="hljs-number">82</span>, <span class="hljs-number">89</span>, <span class="hljs-number">95</span>),
(<span class="hljs-string">'学生6'</span>, <span class="hljs-number">91</span>, <span class="hljs-number">93</span>, <span class="hljs-number">87</span>),
(<span class="hljs-string">'学生7'</span>, <span class="hljs-number">77</span>, <span class="hljs-number">78</span>, <span class="hljs-number">85</span>),
(<span class="hljs-string">'学生8'</span>, <span class="hljs-number">88</span>, <span class="hljs-number">92</span>, <span class="hljs-number">91</span>),
(<span class="hljs-string">'学生9'</span>, <span class="hljs-number">84</span>, <span class="hljs-number">76</span>, <span class="hljs-number">80</span>),
(<span class="hljs-string">'学生10'</span>, <span class="hljs-number">89</span>, <span class="hljs-number">90</span>, <span class="hljs-number">92</span>);

<span class="hljs-comment">-- 需要刷新身份验证，使得其他库（如pymysql）可以通过密码验证登录：</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123'</span>;

</code></pre>
<p>4.2. 编写外部工具</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a73a5ccbf0a4261adbfccd56e1bbdb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=DlqmG1q2Sg%2FEf1t3u%2F4va05Ntr8%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pymysql
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Request
<span class="hljs-keyword">from</span> open_webui.models.users <span class="hljs-keyword">import</span> Users


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Tools</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">sql_inter</span>(<span class="hljs-params">
        self,
        sql_query: <span class="hljs-built_in">str</span>,
        __request__: Request,
        __user__: <span class="hljs-built_in">dict</span>,
        __event_emitter__=<span class="hljs-literal">None</span>,
    </span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""
        用于获取school数据库中各张表的有关相关信息。

        :param sql_query: 字符串形式的SQL查询语句，用于执行对MySQL数据库中的查询
        :param __request__: HTTP 请求对象（来自 FastAPI）
        :param __user__: 用户信息（可以用于个性化或记录请求）
        :param __event_emitter__: 事件发射器，用于将实时状态更新发送到前端
        :return: SQL 查询结果的 JSON 字符串
        """</span>
        <span class="hljs-comment"># Step 1. 通知用户正在执行数据库查询</span>
        <span class="hljs-keyword">await</span> __event_emitter__(
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"status"</span>,
                <span class="hljs-string">"data"</span>: {<span class="hljs-string">"description"</span>: <span class="hljs-string">"正在查询数据库..."</span>, <span class="hljs-string">"done"</span>: <span class="hljs-literal">False</span>},
            }
        )

        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Step 2. 连接 MySQL 数据库</span>
            connection = pymysql.connect(
                host=<span class="hljs-string">"localhost"</span>,  <span class="hljs-comment"># 数据库地址</span>
                user=<span class="hljs-string">"root"</span>,  <span class="hljs-comment"># 数据库用户名</span>
                passwd=<span class="hljs-string">"123"</span>,  <span class="hljs-comment"># 数据库密码</span>
                db=<span class="hljs-string">"school"</span>,  <span class="hljs-comment"># 数据库名</span>
                charset=<span class="hljs-string">"utf8"</span>,  <span class="hljs-comment"># 字符集选择utf8</span>
            )

            <span class="hljs-comment"># Step 3. 执行 SQL 查询</span>
            <span class="hljs-keyword">with</span> connection.cursor() <span class="hljs-keyword">as</span> cursor:
                cursor.execute(sql_query)
                results = cursor.fetchall()

            <span class="hljs-comment"># Step 4. 格式化查询结果</span>
            results_json = json.dumps(results, ensure_ascii=<span class="hljs-literal">False</span>)

            <span class="hljs-comment"># Step 5. 通知用户查询完成</span>
            <span class="hljs-keyword">await</span> __event_emitter__(
                {
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"status"</span>,
                    <span class="hljs-string">"data"</span>: {<span class="hljs-string">"description"</span>: <span class="hljs-string">"数据库查询完成"</span>, <span class="hljs-string">"done"</span>: <span class="hljs-literal">True</span>},
                }
            )

            <span class="hljs-comment"># Step 6. 返回查询结果</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"查询结果: <span class="hljs-subst">{results_json}</span>"</span>

        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-comment"># Step 7. 如果发生错误，通知用户</span>
            <span class="hljs-keyword">await</span> __event_emitter__(
                {
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"status"</span>,
                    <span class="hljs-string">"data"</span>: {<span class="hljs-string">"description"</span>: <span class="hljs-string">f"发生错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>, <span class="hljs-string">"done"</span>: <span class="hljs-literal">True</span>},
                }
            )
            <span class="hljs-comment"># 返回错误信息</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"获取数据库查询数据时发生错误：<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>

        <span class="hljs-keyword">finally</span>:
            <span class="hljs-comment"># Step 8. 关闭数据库连接</span>
            <span class="hljs-keyword">if</span> connection:
                connection.close()

</code></pre>
<p>4.3. 对话中打开数据库查询工具</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f9592cfd91e4aa5bf7118018b1baa58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=KNyyCFN9f60OBErTMbbkmNZgAJo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e44b657d22fa4b00a0057e5632562dda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTZfb25l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764828972&amp;x-signature=GLIHvgw5vMyCwZx%2Bc8kLx4gSLLc%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🧱 深入理解栈（Stack）：原理、实现与实战应用]]></title>    <link>https://juejin.cn/post/7577201863750860840</link>    <guid>https://juejin.cn/post/7577201863750860840</guid>    <pubDate>2025-11-27T06:37:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577201863750860840" data-draft-id="7577049352837890063" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 🧱 深入理解栈（Stack）：原理、实现与实战应用"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-11-27T06:37:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神秘的猪头"/> <meta itemprop="url" content="https://juejin.cn/user/793223472877051"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             🧱 深入理解栈（Stack）：原理、实现与实战应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/793223472877051/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神秘的猪头
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:37:06.000Z" title="Thu Nov 27 2025 06:37:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、什么是栈？🤔</h2>
<p><strong>栈</strong>（Stack）是一种经典的<strong>线性数据结构</strong>，其核心特性是 <strong>“先进后出”</strong> （Last In First Out, LIFO）。<br/>
你可以把它想象成一摞盘子🍽️：每次只能从顶部放入或取出盘子，最晚放进去的盘子最先被拿出来。</p>
<p>在计算机科学中，栈广泛应用于以下场景：</p>
<ul>
<li>🔁 函数调用（调用栈）</li>
<li>🧮 表达式求值与转换（如中缀转后缀）</li>
<li>✅ 括号匹配验证</li>
<li>🖥️ 浏览器前进/后退历史</li>
<li>🔄 撤销（Undo）操作</li>
</ul>
<blockquote>
<p>💡 栈的核心思想：<strong>只操作一端（栈顶），另一端封闭</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、栈的抽象数据类型（ADT）🧩</h2>
<p>一个标准的栈应具备以下<strong>属性和方法</strong>：</p>

































<table><thead><tr><th>方法 / 属性</th><th>说明</th></tr></thead><tbody><tr><td><code>push(item)</code></td><td>➕ 入栈：将元素压入栈顶</td></tr><tr><td><code>pop()</code></td><td>➖ 出栈：移除并返回栈顶元素</td></tr><tr><td><code>peek()</code> / <code>top()</code></td><td>👀 查看栈顶元素但不移除</td></tr><tr><td><code>isEmpty()</code></td><td>❓ 判断栈是否为空</td></tr><tr><td><code>size</code></td><td>🔢 获取栈中元素数量</td></tr><tr><td><code>toArray()</code>（可选）</td><td>📤 将栈内容转为数组（用于调试或展示）</td></tr></tbody></table>
<blockquote>
<p>⚠️ <strong>注意</strong>：栈不允许随机访问中间元素，<strong>只能操作栈顶</strong>！</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">三、ES6 Class 与栈的封装 🛠️</h2>
<p>ES6 引入了 <code>class</code> 语法，使面向对象编程更清晰。结合私有字段（<code>#</code>）、<code>get/set</code> 访问器等新特性，我们可以优雅地实现栈。</p>
<p>下面深入解析这些关键特性👇：</p>
<hr/>
<h3 data-id="heading-3">1️⃣ <code>class</code>：定义类的模板 📐</h3>
<p>在 ES6 之前，JavaScript 通过<strong>构造函数 + 原型链</strong>模拟类：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 🕰️ ES5 风格</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hello, '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
};
</code></pre>
<p>ES6 的 <code>class</code> 是对上述模式的<strong>语法糖</strong>，但结构更清晰、更接近传统 OOP：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✨ ES6 class</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hello, '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
  }
}
</code></pre>
<p>✅ <strong>关键点</strong>：</p>
<ul>
<li>底层仍基于 <strong>原型</strong>（prototype）</li>
<li>提供<strong>声明式、结构化</strong>的代码组织方式</li>
<li>显著提升<strong>可读性与可维护性</strong>，尤其适合大型项目</li>
</ul>
<hr/>
<h3 data-id="heading-4">2️⃣ <code>#privateField</code>：私有属性 🔒</h3>
<p>传统 JS 中所有属性都是公开的，容易被外部篡改：</p>
<pre><code class="hljs language-ini" lang="ini">class Counter {
  constructor() {
    <span class="hljs-attr">this.count</span> = <span class="hljs-number">0</span><span class="hljs-comment">; // 😱 外部可随意修改！</span>
  }
}
const <span class="hljs-attr">c</span> = new Counter()<span class="hljs-comment">;</span>
<span class="hljs-attr">c.count</span> = <span class="hljs-number">999</span><span class="hljs-comment">; // 破坏封装！</span>
</code></pre>
<p>ES2022 引入 <strong>私有字段</strong>（以 <code>#</code> 开头），仅限类内部访问：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
  #count = <span class="hljs-number">0</span>; <span class="hljs-comment">// 🔒 私有属性</span>

  <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">this</span>.#count++; }
  <span class="hljs-title function_">getCount</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#count; } <span class="hljs-comment">// ✅ 安全暴露</span>
}

<span class="hljs-keyword">const</span> c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
c.<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c.<span class="hljs-title function_">getCount</span>()); <span class="hljs-comment">// 1</span>

<span class="hljs-comment">// c.#count; // ❌ SyntaxError!</span>
</code></pre>
<p>✅ <strong>优势</strong>：</p>
<ul>
<li><strong>封装性</strong>：隐藏实现细节</li>
<li><strong>安全性</strong>：防止外部误操作</li>
<li><strong>可维护性</strong>：内部逻辑变更不影响外部调用</li>
</ul>
<blockquote>
<p>⚠️ 私有字段必须<strong>显式声明</strong>，不能动态添加。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">3️⃣ <code>constructor()</code>：初始化实例 🧬</h3>
<p><code>constructor</code> 是类的构造函数，在 <code>new</code> 实例时自动调用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Stack</span> {
  #items;
  <span class="hljs-keyword">constructor</span>(initialItems = []) {
    <span class="hljs-keyword">this</span>.#items = [...initialItems]; <span class="hljs-comment">// 初始化私有数组</span>
  }
}
</code></pre>
<p>✅ <strong>作用</strong>：</p>
<ul>
<li>初始化实例属性（包括私有属性）</li>
<li>接收参数设置初始状态</li>
<li>若未定义，JS 会提供空默认构造函数</li>
</ul>
<p>🔁 <strong>注意</strong>：每个类<strong>最多只能有一个</strong> <code>constructor</code>。</p>
<hr/>
<h3 data-id="heading-6">4️⃣ <code>get size()</code>：只读属性访问器 📏</h3>
<p>有时我们希望暴露某个值，但<strong>禁止修改</strong>。这时可用 <code>get</code> 定义访问器：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayStack</span> {
  <span class="hljs-meta">#stack = [];</span>
  <span class="hljs-function">get <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.<span class="hljs-meta">#stack.length; <span class="hljs-comment">// 📊 像读属性一样使用</span></span>
  }
}

<span class="hljs-type">const</span> stack = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayStack</span>();
console.<span class="hljs-built_in">log</span>(stack.size); <span class="hljs-comment">// 0</span>
<span class="hljs-comment">// stack.size = 10; // ❌ 无效（严格模式报错）</span>
</code></pre>
<p>✅ <strong>好处</strong>：</p>
<ul>
<li>语义清晰：<code>size</code> 看似属性，实为计算值</li>
<li>可加入校验、日志、缓存等逻辑</li>
<li>实现<strong>只读接口</strong>，避免误写</li>
</ul>
<p>💡 同理，<code>set</code> 可拦截赋值：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">set</span> <span class="hljs-title function_">maxSize</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'maxSize 不能为负'</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">_maxSize</span> = value;
}
</code></pre>
<hr/>
<h3 data-id="heading-7">5️⃣ 方法共享于原型链，节省内存 🧠</h3>
<p>这是 <code>class</code> 最重要的性能优势！</p>
<p>所有实例方法（非静态、非箭头函数）都定义在<strong>类的原型</strong>上：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Stack</span> {
  <span class="hljs-title function_">push</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
  <span class="hljs-title function_">pop</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-keyword">const</span> s1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>();
<span class="hljs-keyword">const</span> s2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(s1.<span class="hljs-property">push</span> === s2.<span class="hljs-property">push</span>); <span class="hljs-comment">// ✅ true！</span>
</code></pre>
<p>✅ <strong>这意味着</strong>：</p>
<ul>
<li>方法<strong>只在内存中存在一份</strong></li>
<li>所有实例通过原型链<strong>共享</strong>方法</li>
<li>极大节省内存，尤其适合创建大量对象（如游戏实体、UI 组件）</li>
</ul>
<p>❌ 对比反模式（ES5 常见陷阱）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">BadStack</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">push</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* 每次 new 都新建函数！*/</span> };
}
</code></pre>
<blockquote>
<p>📌 <strong>建议</strong>：现代项目优先使用 ES6+ <code>class</code>，善用私有字段与访问器，构建高内聚、低耦合的组件。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">四、两种实现方式：数组 vs 链表 ⚖️</h2>
<p>栈可以用<strong>数组</strong>或<strong>链表</strong>实现，各有优劣：</p>
<hr/>
<h3 data-id="heading-9">1️⃣ 基于数组的栈（ArrayStack）📦</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayStack</span> {
  #stack = [];
  <span class="hljs-keyword">get</span> size() { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.#stack.length; }
  isEmpty() { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.size === <span class="hljs-number">0</span>; }
  push(num) { <span class="hljs-keyword">this</span>.#stack.push(num); }
  pop() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isEmpty()) <span class="hljs-keyword">throw</span> new Error(<span class="hljs-string">'栈为空'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.#stack.pop();
  }
  peek() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isEmpty()) <span class="hljs-keyword">throw</span> new Error(<span class="hljs-string">'栈为空'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.#stack[<span class="hljs-keyword">this</span>.size - <span class="hljs-number">1</span>];
  }
  toArray() { <span class="hljs-keyword">return</span> [...<span class="hljs-keyword">this</span>.#stack]; }
}
</code></pre>
<h4 data-id="heading-10">✅ 优点：</h4>
<ul>
<li><strong>时间效率高</strong>：<code>push</code>/<code>pop</code> 在尾部操作，平均 <strong>O(1)</strong></li>
<li>内存连续，<strong>缓存友好</strong>（CPU 更快访问）</li>
<li>代码简洁，JS 数组原生支持</li>
</ul>
<h4 data-id="heading-11">❌ 缺点：</h4>
<ul>
<li><strong>扩容成本高</strong>：容量不足时需复制所有元素 → <strong>O(n)</strong></li>
<li>可能存在<strong>空间浪费</strong>（预分配未用完）</li>
</ul>
<blockquote>
<p>💡 实际中，扩容是<strong>低频事件</strong>，<strong>均摊时间复杂度仍为 O(1)</strong> 。</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">2️⃣ 基于链表的栈（LinkedListStack）⛓️</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListNode</span> {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">val</span>) {
    <span class="hljs-keyword">this</span>.<span class="hljs-keyword">val</span> = <span class="hljs-keyword">val</span>;
    <span class="hljs-keyword">this</span>.next = <span class="hljs-literal">null</span>;
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedListStack</span> {
  #stackPeek = <span class="hljs-literal">null</span>;
  #size = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">get</span> size() { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.#size; }
  isEmpty() { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.size === <span class="hljs-number">0</span>; }

  push(num) {
    <span class="hljs-keyword">const</span> node = new ListNode(num);
    node.next = <span class="hljs-keyword">this</span>.#stackPeek;
    <span class="hljs-keyword">this</span>.#stackPeek = node;
    <span class="hljs-keyword">this</span>.#size++;
  }

  peek() {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.#stackPeek) <span class="hljs-keyword">throw</span> new Error(<span class="hljs-string">'栈为空'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.#stackPeek.<span class="hljs-keyword">val</span>;
  }

  pop() {
    <span class="hljs-keyword">const</span> num = <span class="hljs-keyword">this</span>.peek();
    <span class="hljs-keyword">this</span>.#stackPeek = <span class="hljs-keyword">this</span>.#stackPeek.next;
    <span class="hljs-keyword">this</span>.#size--;
    <span class="hljs-keyword">return</span> num;
  }

  toArray() {
    <span class="hljs-keyword">const</span> arr = new Array(<span class="hljs-keyword">this</span>.size);
    let node = <span class="hljs-keyword">this</span>.#stackPeek;
    let i = <span class="hljs-keyword">this</span>.size - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (node) {
      arr[i--] = node.<span class="hljs-keyword">val</span>;
      node = node.next;
    }
    <span class="hljs-keyword">return</span> arr;
  }
}
</code></pre>
<h4 data-id="heading-13">✅ 优点：</h4>
<ul>
<li><strong>动态扩容</strong>：每次插入只需 <strong>O(1)</strong> ，无复制开销</li>
<li>空间按需分配，<strong>无浪费</strong></li>
</ul>
<h4 data-id="heading-14">❌ 缺点：</h4>
<ul>
<li>每个节点需额外存储 <code>next</code> 指针 → <strong>内存开销更大</strong></li>
<li>节点在内存中<strong>离散分布</strong> → 缓存局部性差</li>
<li>实例化 <code>ListNode</code> 有一定性能损耗</li>
</ul>
<blockquote>
<p>✅ <strong>总结</strong>：</p>
<ul>
<li>🚀 日常开发、轻量场景 → <strong>数组实现</strong></li>
<li>🏗️ 大数据、稳定性要求高 → <strong>链表实现</strong></li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-15">五、实战应用：有效的括号匹配 ✅</h2>
<p>栈的经典应用场景之一！</p>
<h3 data-id="heading-16">📌 问题描述：</h3>
<p>给定字符串 <code>s</code>，仅含 <code>'('</code>, <code>')'</code>, <code>'['</code>, <code>']'</code>, <code>'{'</code>, <code>'}'</code>，判断是否有效：</p>
<ul>
<li>左右括号必须正确闭合</li>
<li>顺序必须匹配（如 <code>"([)]"</code> ❌ 无效）</li>
</ul>
<h3 data-id="heading-17">🧠 解题思路：</h3>
<ol>
<li>遇到<strong>左括号</strong> → 将其对应的<strong>右括号</strong>压入栈</li>
<li>遇到<strong>右括号</strong> → 检查是否与栈顶匹配</li>
<li>遍历结束 → 栈必须为空</li>
</ol>
<h3 data-id="heading-18">💻 代码实现：</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> leftToRight = {
  <span class="hljs-string">"("</span>: <span class="hljs-string">")"</span>,
  <span class="hljs-string">"["</span>: <span class="hljs-string">"]"</span>,
  <span class="hljs-string">"{"</span>: <span class="hljs-string">"}"</span>,
};

<span class="hljs-function">function <span class="hljs-title">isValid</span><span class="hljs-params">(s)</span> </span>{
  <span class="hljs-keyword">if</span> (!s) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-type">const</span> stack = [];
  <span class="hljs-keyword">for</span> (let ch of s) {
    <span class="hljs-keyword">if</span> (ch in leftToRight) {
      stack.<span class="hljs-built_in">push</span>(leftToRight[ch]); <span class="hljs-comment">// 压入期望的右括号</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (!stack.length || stack.<span class="hljs-built_in">pop</span>() !== ch) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 不匹配或栈空</span>
      }
    }
  }
  <span class="hljs-keyword">return</span> stack.length === <span class="hljs-number">0</span>; <span class="hljs-comment">// 栈空则有效</span>
}
</code></pre>
<p>🧪 <strong>测试</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">isValid</span>(<span class="hljs-string">"()"</span>));       <span class="hljs-comment">// ✅ true</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">isValid</span>(<span class="hljs-string">"()[]{}"</span>));   <span class="hljs-comment">// ✅ true</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">isValid</span>(<span class="hljs-string">"(]"</span>));       <span class="hljs-comment">// ❌ false</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">isValid</span>(<span class="hljs-string">"([)]"</span>));     <span class="hljs-comment">// ❌ false</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">isValid</span>(<span class="hljs-string">"{[]}"</span>));     <span class="hljs-comment">// ✅ true</span>
</code></pre>
<blockquote>
<p>🔍 <strong>为什么压入“右括号”？</strong><br/>
这样遇到右括号时可直接比较 <code>stack.pop() === ch</code>，<strong>无需二次查表</strong>，逻辑更简洁高效！</p>
</blockquote>
<hr/>
<h2 data-id="heading-19">六、总结对比 📊</h2>



































<table><thead><tr><th>维度</th><th>数组栈 📦</th><th>链表栈 ⛓️</th></tr></thead><tbody><tr><td>时间复杂度（平均）</td><td>O(1)</td><td>O(1)</td></tr><tr><td>扩容开销</td><td>O(n)（低频）</td><td>O(1)</td></tr><tr><td>空间效率</td><td>可能浪费</td><td>指针开销（约 +50%）</td></tr><tr><td>实现难度</td><td>⭐ 简单</td><td>⭐⭐ 中等</td></tr><tr><td>适用场景</td><td>通用、轻量级</td><td>大数据、稳定性要求高</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-20">🎯 结语</h2>
<p>栈虽简单，却是理解程序运行机制（如调用栈）和解决算法问题（DFS、表达式解析、回溯）的<strong>基石数据结构</strong>。</p>
<p>掌握其两种实现方式及典型应用，不仅能写出更高效的代码，还能在面试中展现扎实的基本功！</p>
<blockquote>
<p>📌 <strong>终极建议</strong>：</p>
<ul>
<li>日常开发 → 优先用 <strong>数组实现</strong>（简单高效）</li>
<li>面试/性能敏感场景 → 主动讨论 <strong>链表方案</strong>，展现深度思考 💡</li>
</ul>
</blockquote>
<hr/>
<p>📚 <strong>延伸思考</strong>：你能用栈实现“浏览器后退”功能吗？或者用两个栈实现一个队列？欢迎动手尝试！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全球前四！京东云云海AI存储跻身IO500高性能存储榜单]]></title>    <link>https://juejin.cn/post/7576955345379082303</link>    <guid>https://juejin.cn/post/7576955345379082303</guid>    <pubDate>2025-11-27T06:40:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576955345379082303" data-draft-id="7577042851079864363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全球前四！京东云云海AI存储跻身IO500高性能存储榜单"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-27T06:40:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全球前四！京东云云海AI存储跻身IO500高性能存储榜单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:40:05.000Z" title="Thu Nov 27 2025 06:40:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近日，在最新公布的 IO500 排行榜中，京东云云海 AI 存储基于通用 NVMe 盘存储服务器，结合全栈自研软件体系与深度调优，成功跻身 IO500 生产榜单全球前四、国产自研第一。相较传统超算存储技术，云海AI存储不采用 PMEM 硬件，具备更强通用性的同时也实现了更低存储成本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c0739b56f604679adad9e5ef8d86fe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830405&amp;x-signature=p27tbLiZtFF3O5%2Fq7WbPzPg4H%2Bs%3D" alt="图片.png" loading="lazy"/></p>
<p>IO500是全球高性能计算HPC领域最权威、最具影响力的存储系统性能评测标准之一，评测维度涵盖了高性能存储系统的多个关键能力，包括带宽性能、元数据性能、混合负载、并行性和可扩展性，被誉为全球高性能存储领域的金标准。京东云凭借全自研云海AI存储系统JPFS、无 PMEM 的通用存储硬件架构和20节点小规模存储集群下达成该成绩，印证云海 AI 存储在软件栈调优、数据路径优化、网络 RDMA 处理、并行 I/O 调度等核心技术上，已达国际领先水平。</p>
<p>此次云海 AI 存储JPFS斩获了三项 “全球第一”。首先是通用硬件性能第一，不使用 PMEM 硬件加速，完全基于通用 NVMe SSD 设备，跑出全球领先成绩；其次是性能成本比第一，以更低硬件成本实现接近持久内存架构的性能表现。第三是可规模化落地第一，架构具备高度可复制性，可在智算/超算等大规模存储场景中快速部署。</p>
<p>云海AI存储，作为京东云自主研发的面向AI大模型需求的新一代分布式存储系统，历经京东618、京东11.11大规模实践验证，基于存算分离架构，可以很好满足智算场景极致的存储性能需求，它具备4大特性：</p>
<p><strong>在极致性能</strong>方面，云海AI存储可支持千亿级参数AI大模型，融合超低延时RDMA网络及软件架构优化，4K随机写IOPS达到1000万级，平均延迟在100微秒级，单节点可提供 44GB/s的带宽性能，满足极致的存储性能需求。</p>
<p><strong>在极致性价比方面</strong>，创新的存算分离技术架构，将计算和存储解耦独立，存算资源独立调度，大幅提高资源利用率和系统可靠性。云海支持低至1.1x副本的业内超低冗余的EC存储，并在生产环境成熟使用，磁盘空间利用率高达90%以上。</p>
<p><strong>在高可用性方面</strong>，云海数据可靠性达到11个9，故障秒级恢复用户无感，两副本故障仍可保持数据写入100%可用。历经京东618、京东11.11大规模实践场景打磨，EB级存储规模实践验证。</p>
<p><strong>在自主可控方面</strong>，云海为京东云100%自研产品，代码自研率超98%，核心技术完全自主可控，已与主流国产化硬件和软件兼容互认，并能实现兼容后性能无明显衰减，已在京东核心场景实现国产化实践验证。</p>
<p>目前，来自银行、证券、汽车、零售等领域超100家大型企业，正在使用云海AI存储。面向未来，京东云将持续投入自研存储系统的深度优化，推动高性能存储在 AI 模型训练、科学计算、大规模数据分析等场景中的更广泛应用，助力更多企业重塑AI生产力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[京东云海存储成为全球最大规模基于国产CPU的AI存储技术应用]]></title>    <link>https://juejin.cn/post/7576994308273733651</link>    <guid>https://juejin.cn/post/7576994308273733651</guid>    <pubDate>2025-11-27T06:40:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576994308273733651" data-draft-id="7576994308273700883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="京东云海存储成为全球最大规模基于国产CPU的AI存储技术应用"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-27T06:40:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            京东云海存储成为全球最大规模基于国产CPU的AI存储技术应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:40:34.000Z" title="Thu Nov 27 2025 06:40:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近日，在全球最权威的存储系统性能评测IO500榜单上，京东云海跻身榜单全球前四、国产自研第一。由此，<strong>京东云海存储成为全球最大规模基于国产CPU的AI存储技术应用</strong>，也是目前全球性能最强的基于通用NVMe架构的AI存储。</p>
<h3 data-id="heading-0"><strong>一、极致存储性能，斩获多项全球第一</strong></h3>
<p>基于通用 NVMe 盘存储服务器，结合全栈自研软件体系与深度调优，此次云海 AI 存储斩获了多项 “全球第一”：</p>
<p>首先，<strong>通用硬件性能第一</strong>，不使用 PMEM 硬件加速，完全基于通用 NVMe SSD 设备，跑出全球领先成绩；</p>
<p>其次，<strong>性能成本比第一</strong>，以更低硬件成本实现接近持久内存架构的性能表现。</p>
<p>第三，<strong>可规模化落地第一</strong>，架构具备高度可复制性，可在智算/超算等大规模存储场景中快速部署。</p>
<p>在排行榜单上的优秀成绩，源于京东云十多年在存储领域的技术积累。作为京东云自主研发的面向AI大模型需求的新一代分布式存储系统，历经京东618、京东11.11大规模实践验证，基于存算分离架构，可以很好满足智算场景极致的存储性能需求。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d57c8e0fc6b44c0c8eb44a7453c060d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830434&amp;x-signature=XjnD%2FKts7EXUdX1ao4BjtMdxGxY%3D" alt="图片.png" loading="lazy"/></p>
<p>在极致性能方面，云海AI存储可支持千亿级参数AI大模型，自研引擎采用全追加写模型，融合超低延时RDMA网络及软件架构优化，4K随机写IOPS达到1000万级，平均延迟在100微秒级，I/O性能接近本地NVMe磁盘，单节点可提供 44GiB/s的带宽性能。</p>
<p>云海为京东云全自研存储，代码自研率超98%，拥有完全自主知识产权，与主流国产化硬件和软件兼容互认，括操作系统、数据库、中间件、服务器、CPU、主板、网卡、SSD等，并基于全局无锁架构，充分发挥国产硬件能力。</p>
<h3 data-id="heading-1"><strong>二、超100家大型企业选择云海AI存储，加速AI落地产业</strong></h3>
<p>目前，来自银行、证券、汽车、零售等领域超100家大型企业，正在使用云海AI存储。</p>
<p>在科技领域，<strong>科大讯飞</strong>AI营销采用“开源分布式存储软件+服务器硬件”搭建，对十亿级小文件数据量时，读写性能陡然下降。升级京东云AI存储云海后，科大讯飞AI营销实现了一个集群一个文件系统，即可轻松应对多模态大模型时千亿~十万亿参数规模；同时，基于高性能存储层，以及大容量存储层的自动数据分级，在大幅降低存储成本的同时，实现了大模型训练能力的大幅提升，助力AI营销业务降本增效。</p>
<p>在互联网领域，<strong>墨迹天气</strong>是全球领先的气象服务企业，截至2024年，拥有超过7亿用户，天气日查询次数过6亿次。随着业务规模的扩大，墨迹天气越来越多的数据需要在降本增效的目标下进行安全的存储。墨迹天气与京东云云海共同建设新的分布式存储，采用低冗余存储的技术，在不降低性能和可靠性的情况下，只需要1.14个副本，大幅提升资源利用率。</p>
<p>在金融领域，<strong>国内某头部证券公司</strong>传统存储系统在性能、稳定性和故障恢复等方面存在诸多痛点，面临着系统架构整体国产化升级的迫切需求。京东云云海采用多台鲲鹏和海光CPU架构存储一体机搭建分布式存储集群，全面适配国产化系统及虚拟化平台。这一方案不仅满足了该证券公司的国产化需求，还通过提供POSIX、NFS、CIFS、S3等存储协议，支持块、文件和对象存储，实现了一个存储平台满足多种场景需求，提升了信息安全自主可控能力。</p>
<p>面向未来，京东云将持续投入自研存储系统的深度优化，推动高性能存储在 AI 模型训练、科学计算、大规模数据分析等场景中的更广泛应用，助力更多企业重塑AI生产力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin遇上Java 静态方法]]></title>    <link>https://juejin.cn/post/7577049352837971983</link>    <guid>https://juejin.cn/post/7577049352837971983</guid>    <pubDate>2025-11-27T06:37:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577049352837971983" data-draft-id="7577201863750778920" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin遇上Java 静态方法"/> <meta itemprop="keywords" content="Kotlin,Android,Java"/> <meta itemprop="datePublished" content="2025-11-27T06:37:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="方白羽"/> <meta itemprop="url" content="https://juejin.cn/user/2333635831676704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin遇上Java 静态方法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2333635831676704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    方白羽
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:37:26.000Z" title="Thu Nov 27 2025 06:37:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Kotlin 遇上 Java 静态方法：一个关于“重写”的陷阱与最佳实践</h2>
<p>在 Android 日常开发中，Kotlin 与 Java 的混合编程已是常态。我们享受着 Kotlin 带来的简洁与安全，但两种语言的底层差异偶尔也会给我们带来一些意想不到的“惊喜”。今天，我们就来剖析一个在继承关系中，由 Kotlin 的 <code>companion object</code>与 Java 的 <code>static</code>方法引发的经典陷阱。</p>
<h3 data-id="heading-1">问题的起点：一个继承引发的困惑</h3>
<p>想象一个常见的场景：我们有一个用 Java 编写的、设计精良的基类 <code>BaseActivity</code>，它提供了一个静态的 <code>launch</code>方法，用于封装复杂的启动逻辑。</p>
<h4 data-id="heading-2">Java 父类 - BaseActivity.java</h4>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> </span>{
    <span class="hljs-comment">// 一个通用的、静态的启动方法</span>
    public static void launch(<span class="hljs-type">Context</span> context, <span class="hljs-type">Class</span>&lt;?&gt; target) {
        <span class="hljs-type">Intent</span> intent = <span class="hljs-keyword">new</span> <span class="hljs-type">Intent</span>(context, target);
        <span class="hljs-comment">// ... 其他通用的参数设置 ...</span>
        context.startActivity(intent);
    }
}
</code></pre>
<p>现在，我们需要用 Kotlin 创建一个子类 <code>MyFeatureActivity</code>，它继承自 <code>BaseActivity</code>。我们希望 <code>MyFeatureActivity</code>也能有一个自己的 <code>launch</code>方法，并且这个方法有一些特殊逻辑，比如传递特定的参数。</p>
<p>我们的第一反应可能是"重写"父类的 <code>launch</code>方法。</p>
<h4 data-id="heading-3">Kotlin 子类 - MyFeatureActivity.kt</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFeatureActivity</span> : <span class="hljs-type">BaseActivity</span>() {

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// 目标：创建一个专属的 launch 方法，并"覆盖"父类的同名方法</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">launch</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, specialData: <span class="hljs-type">String</span>)</span></span> {
            <span class="hljs-keyword">val</span> intent = Intent(context, MyFeatureActivity::<span class="hljs-keyword">class</span>.java)
            intent.putExtra(<span class="hljs-string">"SPECIAL_DATA"</span>, specialData)
            context.startActivity(intent)
        }
    }
}
</code></pre>
<p>代码写完，一场"混乱"的序幕就此拉开。</p>
<h3 data-id="heading-4">困境一：加上 <code>@JvmStatic</code>，为何编译失败？</h3>
<p>为了让 Kotlin 的 <code>companion object</code>方法能像 Java 的静态方法一样被调用（即 <code>ClassName.method()</code>），我们通常会加上 <code>@JvmStatic</code>注解。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
    <span class="hljs-meta">@JvmStatic</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">launch</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, specialData: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>我们的想法很直接：既然父类是 Java 的 <code>static</code>方法，那我也在子类创建一个对应的 Java <code>static</code>方法，这不就是"重写"了吗？</p>
<p><strong>结果：编译失败！</strong> ​ 编译器会抛出一个类似"Platform declaration clash"的错误。</p>
<h4 data-id="heading-5">原因剖析</h4>
<p>这是两种语言设计哲学的第一次碰撞。</p>
<ul>
<li><strong>Java 世界观</strong>：静态方法属于类，不属于对象实例。它不能被重写（Override），只能被隐藏（Hide）。当子类定义了与父类签名完全相同的静态方法时，父类的方法就被"隐藏"了。</li>
<li><strong>Kotlin 世界观</strong>：Kotlin 的设计更加严格和安全。它认为在子类中声明一个与父类静态方法签名完全相同的方法，是一种意图不明确且危险的操作。为了防止开发者陷入"我以为我重写了，但实际上没有"的认知误区，Kotlin 编译器选择在编译期直接禁止这种行为。</li>
</ul>
<h3 data-id="heading-6">困境二：不加 <code>@JvmStatic</code>，为何行为不一致？</h3>
<p>好吧，既然编译器不让，那我们去掉 <code>@JvmStatic</code>总行了吧？</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">launch</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, specialData: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>代码编译通过了！我们来尝试调用一下 <code>MyFeatureActivity.launch(...)</code>。</p>
<p>奇怪的现象发生了：</p>
<p><strong>1. 在另一个 Kotlin 文件中调用：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 在 Kotlin 代码中调用</span>
MyFeatureActivity.<span class="hljs-built_in">launch</span>(context, <span class="hljs-string">"some_data"</span>)
</code></pre>
<p>执行的是 <code>MyFeatureActivity</code>中我们新定义的 <code>launch</code>方法。一切正常！</p>
<p><strong>2. 在 Java 文件中调用：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 在 Java 代码中调用</span>
MyFeatureActivity.<span class="hljs-built_in">launch</span>(context, MyFeatureActivity.<span class="hljs-keyword">class</span>);
</code></pre>
<p>执行的竟然是父类 <strong>BaseActivity</strong>​ 的 <code>launch</code>方法！</p>
<h4 data-id="heading-7">原因剖析</h4>
<p>这是两种语言底层实现的第二次碰撞。</p>
<ul>
<li><strong>Kotlin 的视角</strong>：当在 Kotlin 中调用 <code>MyFeatureActivity.launch(...)</code>时，Kotlin 编译器非常"懂"自家的 <code>companion object</code>。它知道这个调用应该被解析为 <code>MyFeatureActivity.Companion.launch(...)</code>，准确地找到了子类中的方法。</li>
<li><strong>Java 的视角</strong>：当在 Java 中调用 <code>MyFeatureActivity.launch(...)</code>时，Java 编译器对 <code>companion object</code>一无所知。它只看到 <code>MyFeatureActivity</code>继承自 <code>BaseActivity</code>，并且 <code>BaseActivity</code>中存在一个合法的、公开的 <code>public static void launch(...)</code>方法。于是，遵循继承规则，它直接调用了父类中的静态方法。</li>
</ul>
<p>这就导致了一个极其隐蔽且危险的 Bug：<strong>同一个方法调用，在不同的语言环境中，产生了截然不同的行为！</strong></p>
<h3 data-id="heading-8">最佳实践：放弃执念，拥抱清晰</h3>
<p>面对这种"加上编译不过，不加行为不一"的两难局面，我们应该意识到，"重写"或"隐藏"父类的静态方法从一开始就是一条崎岖的路。</p>
<p><strong>最佳实践只有一个：重命名。</strong></p>
<p>为子类的方法起一个全新的、不会产生任何歧义的名字。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFeatureActivity</span> : <span class="hljs-type">BaseActivity</span>() {

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// 使用一个全新的、明确的名字</span>
        <span class="hljs-meta">@JvmStatic</span> <span class="hljs-comment">// 加上 JvmStatic，方便 Java 调用</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, specialData: <span class="hljs-type">String</span>)</span></span> {
            <span class="hljs-keyword">val</span> intent = Intent(context, MyFeatureActivity::<span class="hljs-keyword">class</span>.java)
            intent.putExtra(<span class="hljs-string">"SPECIAL_DATA"</span>, specialData)
            <span class="hljs-comment">// 甚至可以复用父类的通用逻辑</span>
            <span class="hljs-comment">// super.launch(context, MyFeatureActivity::class.java) // 错误！不能通过 super 调用 static</span>
            context.startActivity(intent)
        }
    }
}
</code></pre>
<p>这样做的好处显而易见：</p>
<ol>
<li><strong>意图明确</strong>：<code>start</code>这个名字清楚地表明了这是 <code>MyFeatureActivity</code>专属的启动方法。</li>
<li><strong>行为统一</strong>：无论是在 Java 还是 Kotlin 中，调用 <code>MyFeatureActivity.start(...)</code>都只会执行这一个方法，绝无二义。</li>
<li><strong>安全可靠</strong>：彻底根除了因语言差异导致的调用混乱问题。</li>
</ol>
<h3 data-id="heading-9">结语</h3>
<p>这个小小的案例深刻地提醒我们：在享受 Kotlin 与 Java 无缝互操作性的同时，我们必须对其底层的实现差异保持敬畏。试图用一种语言的特性去"强行解释"另一种语言，往往会走进死胡同。</p>
<p>当遇到类似"静态方法继承"这类模糊地带时，选择最清晰、最没有歧义的方案——比如重命名——永远是通往高质量、可维护代码的康庄大道。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[防火墙高级配置完整教程：端口映射+访问控制策略+iptables规则编写]]></title>    <link>https://juejin.cn/post/7576978338754625586</link>    <guid>https://juejin.cn/post/7576978338754625586</guid>    <pubDate>2025-11-27T06:16:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576978338754625586" data-draft-id="7576918517238726706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="防火墙高级配置完整教程：端口映射+访问控制策略+iptables规则编写"/> <meta itemprop="keywords" content="运维"/> <meta itemprop="datePublished" content="2025-11-27T06:16:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="上班日常摸鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1197792767524060"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            防火墙高级配置完整教程：端口映射+访问控制策略+iptables规则编写
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1197792767524060/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    上班日常摸鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:16:45.000Z" title="Thu Nov 27 2025 06:16:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、防火墙高级配置核心概念（新手必看）</h3>
<p>防火墙高级配置是通过精细化规则实现网络流量的精准管控，核心覆盖三大场景：<strong>端口映射</strong>（公网访问内网服务）、<strong>访问控制策略</strong>（IP / 端口 / 协议级权限管控）、<strong>iptables 规则编写</strong>（Linux 系统底层流量过滤）。适用于服务器运维、企业内网安全加固、云服务器端口管理等场景，配置遵循 “最小权限原则”，即仅开放必要服务，拒绝所有默认流量。</p>
<h3 data-id="heading-1">二、端口映射配置（公网访问内网服务实操）</h3>
<p>端口映射本质是将公网 IP 的指定端口流量，转发到内网服务器的私有 IP + 端口，常见于 Web 服务、游戏服务器、远程桌面等场景。</p>
<h4 data-id="heading-2">1. Linux 系统（iptables 实现）</h4>
<h5 data-id="heading-3">前提条件</h5>
<ul>
<li>
<p>已安装 iptables（Debian/Ubuntu：<code>sudo apt install iptables</code>；CentOS：<code>sudo dnf install iptables</code>）</p>
</li>
<li>
<p>拥有公网 IP（服务器网卡绑定公网地址）</p>
</li>
<li>
<p>内网服务器可正常访问</p>
</li>
</ul>
<h5 data-id="heading-4">配置步骤</h5>
<ol>
<li><strong>启用 IP 转发</strong>（内核级转发开关）</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/sysctl.conf
</code></pre>
<p>取消注释或添加：<code>net.ipv4.ip_forward=1</code>，执行生效：</p>
<pre><code class="hljs language-css" lang="css">sudo sysctl -<span class="hljs-selector-tag">p</span>
</code></pre>
<ol>
<li><strong>配置端口转发规则</strong>（示例：公网 8080 端口→内网 192.168.1.100:80）</li>
</ol>
<pre><code class="hljs language-css" lang="css">\# DNAT：目标地址转换（公网→内网）

sudo iptables -t nat -<span class="hljs-selector-tag">A</span> PREROUTING -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">8080</span> -j DNAT <span class="hljs-attr">--to-destination</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">1.100</span>:<span class="hljs-number">80</span>

\# SNAT：源地址转换（内网→公网，确保返回流量正常）

sudo iptables -t nat -A POSTROUTING -j MASQUERADE
</code></pre>
<ol>
<li><strong>验证与保存</strong></li>
</ol>
<ul>
<li>
<p>查看规则：<code>sudo iptables -t nat -L -n</code></p>
</li>
<li>
<p>永久保存（Ubuntu/Debian）：</p>
</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">sudo apt install iptables-persistent  <span class="hljs-comment"># 安装持久化工具</span>

sudo netfilter-persistent save        <span class="hljs-comment"># 保存规则到/etc/iptables/rules.v4</span>
</code></pre>
<ul>
<li>永久保存（CentOS/RHEL）：</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">sudo service iptables save  <span class="hljs-comment"># 规则保存到/etc/sysconfig/iptables</span>
</code></pre>
<h4 data-id="heading-5">2. Windows 系统（Windows Defender 防火墙高级配置）</h4>
<p>适用于 Windows Server 或个人电脑，通过图形化界面配置端口映射：</p>
<ol>
<li>
<p>打开「控制面板→系统和安全→Windows Defender 防火墙→高级设置」</p>
</li>
<li>
<p>右键「入站规则→新建规则」，选择「端口」类型，点击下一步</p>
</li>
<li>
<p>选择 TCP/UDP 协议，输入需映射的本地端口（如 8080），点击下一步</p>
</li>
<li>
<p>选择「允许连接」，配置适用场景（域 / 专用 / 公共网络）</p>
</li>
<li>
<p>命名规则（如 “Web 服务 8080 端口映射”），完成创建</p>
</li>
<li>
<p>补充配置：右键规则→属性→高级，勾选 “在公共网络上启用”（公网访问需开启）</p>
</li>
</ol>
<h3 data-id="heading-6">三、访问控制策略设计与实现</h3>
<p>访问控制策略是防火墙的核心安全机制，通过 “允许 / 拒绝” 规则组合，限制特定 IP、端口或协议的流量，分为入站规则（外部→本地）和出站规则（本地→外部）。</p>
<h4 data-id="heading-7">1. 策略设计三原则</h4>
<ul>
<li>
<p>优先级规则：越具体的规则优先级越高（如 “允许 192.168.1.0/24 访问 80 端口” 优先于 “允许所有 IP 访问 80 端口”）</p>
</li>
<li>
<p>方向区分：入站规则重点防外部攻击，出站规则限制内部违规访问（如禁止访问恶意 IP）</p>
</li>
<li>
<p>日志审计：开启日志记录，便于排查异常流量（记录丢弃包和成功连接）</p>
</li>
</ul>
<h4 data-id="heading-8">2. 实操案例（Linux+Windows）</h4>
<h5 data-id="heading-9">案例 1：Linux iptables 访问控制（最常用）</h5>
<pre><code class="hljs language-css" lang="css">\# <span class="hljs-number">1</span>. 设置默认策略（拒绝所有入站/转发，允许出站）

sudo iptables -<span class="hljs-selector-tag">P</span> <span class="hljs-selector-tag">INPUT</span> DROP

sudo iptables -<span class="hljs-selector-tag">P</span> FORWARD DROP

sudo iptables -<span class="hljs-selector-tag">P</span> OUTPUT ACCEPT

\# <span class="hljs-number">2</span>. 允许信任IP访问SSH（<span class="hljs-number">22</span>端口）

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -s <span class="hljs-number">192.168</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">22</span> -j ACCEPT

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -s <span class="hljs-number">123.45</span>.<span class="hljs-number">67.89</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">22</span> -j ACCEPT

\# <span class="hljs-number">3</span>. 禁止特定IP段访问（如恶意IP段<span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">8</span>）

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -s <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">8</span> -j DROP

\# <span class="hljs-number">4</span>. 允许HTTP（<span class="hljs-number">80</span>）和HTTPS（<span class="hljs-number">443</span>）端口公共访问

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">80</span> -j ACCEPT

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">443</span> -j ACCEPT

\# <span class="hljs-number">5</span>. 启用日志记录（记录被拒绝的连接）

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -j LOG <span class="hljs-attr">--log-prefix</span> "FIREWALL-DENY: <span class="hljs-string">"
</span></code></pre>
<h5 data-id="heading-10">案例 2：Windows Defender 访问控制策略</h5>
<ol>
<li>
<p>打开高级防火墙→「出站规则→新建规则」，选择「自定义」类型</p>
</li>
<li>
<p>匹配条件设置：</p>
</li>
</ol>
<ul>
<li>
<p>协议：TCP/UDP（可指定具体协议号）</p>
</li>
<li>
<p>远程 IP 地址：添加需禁止的 IP 段（如 192.168.2.0/24）</p>
</li>
<li>
<p>本地端口：限制特定端口（如禁止访问 3389 远程桌面端口）</p>
</li>
</ul>
<ol>
<li>
<p>操作选择「阻止连接」，适用网络场景选择「所有网络」</p>
</li>
<li>
<p>命名规则（如 “禁止访问违规 IP 段”），完成配置</p>
</li>
</ol>
<h3 data-id="heading-11">四、iptables 规则编写进阶（Linux 系统）</h3>
<p>iptables 是 Linux 内核自带的防火墙工具，通过 “链 + 规则” 机制过滤流量，核心链包括 INPUT（入站）、OUTPUT（出站）、FORWARD（转发），支持 IP、端口、协议、连接状态等多维度匹配。</p>
<h4 data-id="heading-12">1. 基础语法格式</h4>
<pre><code class="hljs language-css" lang="css">iptables \<span class="hljs-selector-attr">[-t 表名]</span> 动作 链名 匹配条件 -j 目标动作
</code></pre>
<ul>
<li>
<p>表名：默认 filter 表（过滤），nat 表（地址转换），mangle 表（流量修改）</p>
</li>
<li>
<p>动作：-A（追加规则）、-I（插入规则）、-D（删除规则）、-F（清空规则）</p>
</li>
<li>
<p>匹配条件：-s（源 IP）、-d（目标 IP）、-p（协议）、--dport（目标端口）、--sport（源端口）</p>
</li>
<li>
<p>目标动作：ACCEPT（允许）、DROP（丢弃）、REJECT（拒绝并返回信息）、LOG（日志）</p>
</li>
</ul>
<h4 data-id="heading-13">2. 高频规则实例（直接复制可用）</h4>
<h5 data-id="heading-14">（1）连接状态匹配（仅允许已建立的连接）</h5>
<pre><code class="hljs language-css" lang="css">\# 允许ESTABLISHED（已建立）和RELATED（关联连接）流量

sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -m state <span class="hljs-attr">--state</span> ESTABLISHED,RELATED -j ACCEPT
</code></pre>
<h5 data-id="heading-15">（2）端口范围限制（允许 1000-2000 端口访问）</h5>
<pre><code class="hljs language-css" lang="css">sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">1000</span>:<span class="hljs-number">2000</span> -j ACCEPT
</code></pre>
<h5 data-id="heading-16">（3）SYN Flood 攻击防护（限制每秒新建连接数）</h5>
<pre><code class="hljs language-css" lang="css">sudo iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--syn</span> -m limit <span class="hljs-attr">--limit</span> <span class="hljs-number">1</span>/s -j ACCEPT
</code></pre>
<h5 data-id="heading-17">（4）删除指定规则（删除 INPUT 链中允许 80 端口的规则）</h5>
<pre><code class="hljs language-arduino" lang="arduino">\# 先查看规则编号：sudo iptables -L <span class="hljs-literal">INPUT</span> --line-numbers

sudo iptables -D <span class="hljs-literal">INPUT</span> <span class="hljs-number">3</span>  # <span class="hljs-number">3</span>为规则编号
</code></pre>
<h4 data-id="heading-18">3. 规则管理核心技巧</h4>
<ul>
<li>
<p>备份规则：<code>sudo iptables-save &gt; /root/iptables_backup.rules</code></p>
</li>
<li>
<p>恢复规则：<code>sudo iptables-restore &lt; /root/iptables_backup.rules</code></p>
</li>
<li>
<p>开机自启（Systemd 系统）：</p>
</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">\<span class="hljs-comment"># 创建服务文件</span>

sudo nano /etc/systemd/system/iptables-restore.service
</code></pre>
<p>写入以下内容：</p>
<pre><code class="hljs language-ini" lang="ini">\<span class="hljs-section">[Unit]</span>

<span class="hljs-attr">Description</span>=Restore iptables rules

<span class="hljs-attr">After</span>=network.target

\<span class="hljs-section">[Service]</span>

<span class="hljs-attr">Type</span>=<span class="hljs-literal">on</span>eshot

<span class="hljs-attr">ExecStart</span>=/sbin/iptables-restore /etc/iptables/rules.v4

\<span class="hljs-section">[Install]</span>

<span class="hljs-attr">WantedBy</span>=multi-user.target
</code></pre>
<p>启用服务：</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl daemon-reload

sudo systemctl <span class="hljs-built_in">enable</span> iptables-restore
</code></pre>
<h3 data-id="heading-19">五、避坑指南与常见问题排查</h3>
<ol>
<li><strong>端口映射配置后无法访问？</strong></li>
</ol>
<ul>
<li>
<p>检查内核 IP 转发是否启用：<code>sysctl net.ipv4.ip_forward</code>（返回 1 为正常）</p>
</li>
<li>
<p>云服务器需开放安全组（如阿里云 ECS、腾讯云需在控制台放行对应端口）</p>
</li>
<li>
<p>本地防火墙是否拦截：<code>sudo iptables -L INPUT -n | grep 8080</code>（查看规则是否存在）</p>
</li>
</ul>
<ol>
<li><strong>iptables 规则重启后失效？</strong></li>
</ol>
<ul>
<li>
<p>未执行永久保存命令（需按 Linux 发行版选择对应方法）</p>
</li>
<li>
<p>CentOS 7 + 默认使用 firewalld，需先关闭：<code>sudo systemctl stop firewalld &amp;&amp; sudo systemctl disable firewalld</code></p>
</li>
</ul>
<ol>
<li><strong>访问控制策略不生效？</strong></li>
</ol>
<ul>
<li>
<p>规则优先级顺序错误：先添加具体规则，再添加通用规则</p>
</li>
<li>
<p>未设置默认拒绝策略：<code>iptables -P INPUT DROP</code>（否则默认允许所有流量）</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Shell脚本基础教程：变量、条件判断、循环、函数实战（附案例）]]></title>    <link>https://juejin.cn/post/7576978338754723890</link>    <guid>https://juejin.cn/post/7576978338754723890</guid>    <pubDate>2025-11-27T06:24:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576978338754723890" data-draft-id="7577016562251808819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Shell脚本基础教程：变量、条件判断、循环、函数实战（附案例）"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-11-27T06:24:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="上班日常摸鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1197792767524060"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Shell脚本基础教程：变量、条件判断、循环、函数实战（附案例）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1197792767524060/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    上班日常摸鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:24:44.000Z" title="Thu Nov 27 2025 06:24:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Shell脚本是Linux运维的“效率神器”——把重复的命令（如批量部署、日志清理、数据备份）写成脚本，一键执行就能替代手动操作，大幅提升工作效率。本文从零基础入手，详解Shell脚本核心语法：变量、条件判断（if-else）、循环（for/while）、函数，每个知识点搭配可直接运行的实战案例，覆盖搜索引擎高频检索需求（如Shell变量定义、if-else条件判断、for循环批量操作、Shell函数封装），适合运维新手快速上手。</p>
<h2 data-id="heading-0">一、Shell脚本入门：先搞懂“基础规则”</h2>
<h3 data-id="heading-1">1. 什么是Shell脚本？</h3>
<p>Shell脚本是“一系列Linux命令的集合”，以<code>.sh</code>为后缀，通过解释器（默认bash）执行。简单来说：把你在终端手动敲的命令，按顺序写到文件里，添加执行权限后就能批量运行。</p>
<h3 data-id="heading-2">2. 脚本基本结构（必写3要素）</h3>
<p>新建一个<code>test.sh</code>脚本，核心结构如下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash  # 声明解释器（必须写在第一行，指定用bash执行）</span>
<span class="hljs-comment"># 这是注释（#开头的行不会执行，用于说明脚本功能）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Hello Shell!"</span>  <span class="hljs-comment"># 执行的命令（输出字符串）</span>
</code></pre>
<h3 data-id="heading-3">3. 脚本执行方式（3种常用）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式1：赋予执行权限后直接运行（推荐）</span>
<span class="hljs-built_in">chmod</span> +x test.sh  <span class="hljs-comment"># 添加可执行权限</span>
./test.sh         <span class="hljs-comment"># 执行脚本（./表示当前目录）</span>

<span class="hljs-comment"># 方式2：通过bash解释器执行（无需执行权限）</span>
bash test.sh

<span class="hljs-comment"># 方式3：在当前Shell环境执行（会影响当前终端，慎用）</span>
<span class="hljs-built_in">source</span> test.sh
. test.sh  <span class="hljs-comment"># 与source等价</span>
</code></pre>
<h2 data-id="heading-4">二、变量：Shell脚本的“数据容器”</h2>
<p>变量是存储数据的载体，Shell脚本中变量无需声明类型，直接赋值即可，核心分为“自定义变量”“系统变量”“位置参数变量”三类。</p>
<h3 data-id="heading-5">1. 自定义变量（最常用）</h3>
<h4 data-id="heading-6">（1）定义与赋值</h4>
<p>语法：<code>变量名=值</code>（注意：等号两边<strong>无空格</strong>，空格会被识别为命令分隔）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 定义变量（字符串、数字均可）</span>
name=<span class="hljs-string">"张三"</span>
age=28
score=95.5

<span class="hljs-comment"># 输出变量（$变量名 或 ${变量名}，{}用于区分变量边界）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"姓名：<span class="hljs-variable">$name</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"年龄：<span class="hljs-variable">${age}</span>岁"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"分数：<span class="hljs-variable">${score}</span>"</span>
</code></pre>
<h4 data-id="heading-7">（2）变量赋值进阶</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 1. 命令结果赋值（反引号`` 或 $()，推荐$()）</span>
ip=$(ifconfig eth0 | grep inet | awk <span class="hljs-string">'{print $2}'</span>)  <span class="hljs-comment"># 获取eth0网卡IP</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"服务器IP：<span class="hljs-variable">$ip</span>"</span>

<span class="hljs-comment"># 2. 读取用户输入赋值（read命令）</span>
<span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入你的手机号："</span> phone  <span class="hljs-comment"># -p：提示信息</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"你输入的手机号是：<span class="hljs-variable">$phone</span>"</span>

<span class="hljs-comment"># 3. 变量拼接</span>
prefix=<span class="hljs-string">"file_"</span>
suffix=<span class="hljs-string">".log"</span>
filename=<span class="hljs-variable">${prefix}</span>2025<span class="hljs-variable">${suffix}</span>  <span class="hljs-comment"># 拼接为file_2025.log</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"文件名：<span class="hljs-variable">$filename</span>"</span>
</code></pre>
<h3 data-id="heading-8">2. 系统变量（内置变量，直接用）</h3>
<p>Shell内置了常用系统变量，无需定义，直接调用即可：</p>








































<table><thead><tr><th>变量名</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>$0</td><td>脚本文件名</td><td>echo "脚本名：$0" → 输出test.sh</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo></mrow><annotation encoding="application/x-tex">1-</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mord">−</span></span></span></span></span>9</td><td>脚本位置参数（执行脚本时传入的参数）</td><td>./test.sh 10 20 → <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>=</mo><mn>10</mn><mtext>，</mtext></mrow><annotation encoding="application/x-tex">1=10，</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">10</span><span class="mord cjk_fallback">，</span></span></span></span></span>2=20</td></tr><tr><td>$#</td><td>位置参数的个数</td><td>./test.sh 10 20 → $#=2</td></tr><tr><td>$?</td><td>上一条命令的执行状态（0=成功，非0=失败）</td><td>ls /tmp; echo $? → 输出0</td></tr><tr><td>$USER</td><td>当前登录用户</td><td>echo "当前用户：$USER"</td></tr><tr><td>$PWD</td><td>当前工作目录</td><td>echo "当前路径：$PWD"</td></tr></tbody></table>
<p>实战示例（位置参数）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 脚本名：param.sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"脚本名：<span class="hljs-variable">$0</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"第一个参数：<span class="hljs-variable">$1</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"第二个参数：<span class="hljs-variable">$2</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"参数总数：<span class="hljs-variable">$#</span>"</span>

<span class="hljs-comment"># 执行：./param.sh 北京 上海</span>
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># 脚本名：./param.sh</span>
<span class="hljs-comment"># 第一个参数：北京</span>
<span class="hljs-comment"># 第二个参数：上海</span>
<span class="hljs-comment"># 参数总数：2</span>
</code></pre>
<h3 data-id="heading-9">3. 变量使用注意事项</h3>
<ul>
<li>变量名只能包含字母、数字、下划线，且不能以数字开头（如<code>1name</code>非法，<code>name1</code>合法）；</li>
<li>全局变量vs局部变量：默认定义的变量是全局的，函数内用<code>local</code>声明局部变量；</li>
<li>特殊字符转义：变量值包含空格/特殊字符时，用双引号包裹（如<code>path="/usr/local/bin"</code>）。</li>
</ul>
<h2 data-id="heading-10">三、条件判断（if-else）：让脚本“做选择”</h2>
<p>条件判断是脚本的“逻辑核心”——根据条件（如文件是否存在、数值大小、字符串是否相等）执行不同命令，核心语法是<code>if-else</code>。</p>
<h3 data-id="heading-11">1. 基础语法结构</h3>
<h4 data-id="heading-12">（1）单分支（满足条件才执行）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span> [ 条件表达式 ]; <span class="hljs-keyword">then</span>
    执行的命令
<span class="hljs-keyword">fi</span>  <span class="hljs-comment"># 结束if（必须写）</span>
</code></pre>
<h4 data-id="heading-13">（2）双分支（满足/不满足分别执行）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span> [ 条件表达式 ]; <span class="hljs-keyword">then</span>
    满足条件执行的命令
<span class="hljs-keyword">else</span>
    不满足条件执行的命令
<span class="hljs-keyword">fi</span>
</code></pre>
<h4 data-id="heading-14">（3）多分支（多个条件判断）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span> [ 条件1 ]; <span class="hljs-keyword">then</span>
    条件1满足执行的命令
<span class="hljs-keyword">elif</span> [ 条件2 ]; <span class="hljs-keyword">then</span>
    条件2满足执行的命令
<span class="hljs-keyword">else</span>
    所有条件都不满足执行的命令
<span class="hljs-keyword">fi</span>
</code></pre>
<h3 data-id="heading-15">2. 条件表达式（核心：判断什么？）</h3>
<p>条件表达式是<code>if</code>的“判断依据”，常用3类判断：数值比较、字符串比较、文件判断。</p>
<h4 data-id="heading-16">（1）数值比较（整数）</h4>








































<table><thead><tr><th>运算符</th><th>作用</th><th>示例（判断10是否大于5）</th></tr></thead><tbody><tr><td>-eq</td><td>等于</td><td>[ 10 -eq 5 ] → 假</td></tr><tr><td>-ne</td><td>不等于</td><td>[ 10 -ne 5 ] → 真</td></tr><tr><td>-gt</td><td>大于</td><td>[ 10 -gt 5 ] → 真</td></tr><tr><td>-lt</td><td>小于</td><td>[ 10 -lt 5 ] → 假</td></tr><tr><td>-ge</td><td>大于等于</td><td>[ 10 -ge 10 ] → 真</td></tr><tr><td>-le</td><td>小于等于</td><td>[ 10 -le 15 ] → 真</td></tr></tbody></table>
<p>实战示例（判断分数是否及格）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入考试分数："</span> score
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$score</span> -ge 60 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"及格！"</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$score</span> -ge 80 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"优秀！"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"不及格！"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h4 data-id="heading-17">（2）字符串比较</h4>






























<table><thead><tr><th>运算符</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>=</td><td>等于</td><td>[ "abc" = "abc" ] → 真</td></tr><tr><td>!=</td><td>不等于</td><td>[ "abc" != "def" ] → 真</td></tr><tr><td>-z</td><td>字符串为空</td><td>[ -z "$str" ] → 字符串为空时真</td></tr><tr><td>-n</td><td>字符串非空</td><td>[ -n "$str" ] → 字符串非空时真</td></tr></tbody></table>
<p>实战示例（判断用户输入是否为空）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入你的姓名："</span> name
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"错误：姓名不能为空！"</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span> = <span class="hljs-string">"admin"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"欢迎管理员！"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"你好，<span class="hljs-variable">$name</span>！"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h4 data-id="heading-18">（3）文件判断（运维高频）</h4>








































<table><thead><tr><th>运算符</th><th>作用</th><th>示例（判断/tmp/test.log）</th></tr></thead><tbody><tr><td>-f</td><td>是否为普通文件</td><td>[ -f /tmp/test.log ] → 文件存在且是普通文件则真</td></tr><tr><td>-d</td><td>是否为目录</td><td>[ -d /tmp ] → 目录存在则真</td></tr><tr><td>-e</td><td>文件/目录是否存在</td><td>[ -e /tmp/test.log ] → 存在则真</td></tr><tr><td>-r</td><td>是否有读权限</td><td>[ -r /tmp/test.log ] → 有读权限则真</td></tr><tr><td>-w</td><td>是否有写权限</td><td>[ -w /tmp/test.log ] → 有写权限则真</td></tr><tr><td>-x</td><td>是否有执行权限</td><td>[ -x /tmp/script.sh ] → 有执行权限则真</td></tr></tbody></table>
<p>实战示例（判断文件是否存在，不存在则创建）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
file=<span class="hljs-string">"/tmp/test.log"</span>
<span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>已存在，文件大小：<span class="hljs-subst">$(du -h $file | awk '{print $1}')</span>"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>不存在，正在创建..."</span>
    <span class="hljs-built_in">touch</span> <span class="hljs-variable">$file</span>  <span class="hljs-comment"># 创建文件</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"创建成功！"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h3 data-id="heading-19">3. 条件判断避坑点</h3>
<ul>
<li>条件表达式的<code>[ ]</code>两边必须有空格（如<code>[ $score -ge 60 ]</code>，少空格会报错）；</li>
<li>变量值可能为空时，用双引号包裹（如<code>[ -z "$name" ]</code>，避免<code>[ -z ]</code>语法错误）；</li>
<li>多个条件组合：用<code>&amp;&amp;</code>（且）、<code>||</code>（或），示例：<code>if [ $age -gt 18 ] &amp;&amp; [ $age -lt 60 ]; then</code>。</li>
</ul>
<h2 data-id="heading-20">四、循环：让脚本“重复做事”</h2>
<p>循环是脚本的“效率核心”——批量处理文件、遍历服务器列表、重复执行命令都靠循环，Shell常用<code>for</code>和<code>while</code>循环。</p>
<h3 data-id="heading-21">1. for循环（遍历列表/范围）</h3>
<h4 data-id="heading-22">（1）基础语法（遍历列表）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> 变量 <span class="hljs-keyword">in</span> 列表; <span class="hljs-keyword">do</span>
    执行的命令
<span class="hljs-keyword">done</span>
</code></pre>
<p>实战示例1（遍历字符串列表）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 遍历城市列表</span>
cities=<span class="hljs-string">"北京 上海 广州 深圳"</span>
<span class="hljs-keyword">for</span> city <span class="hljs-keyword">in</span> <span class="hljs-variable">$cities</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"当前城市：<span class="hljs-variable">$city</span>"</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># 当前城市：北京</span>
<span class="hljs-comment"># 当前城市：上海</span>
<span class="hljs-comment"># 当前城市：广州</span>
<span class="hljs-comment"># 当前城市：深圳</span>
</code></pre>
<p>实战示例2（遍历数字范围）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 遍历1-5（批量创建文件）</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..5}; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">touch</span> /tmp/file_<span class="hljs-variable">$i</span>.txt  <span class="hljs-comment"># 创建file_1.txt到file_5.txt</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"已创建：/tmp/file_<span class="hljs-variable">$i</span>.txt"</span>
<span class="hljs-keyword">done</span>
</code></pre>
<p>实战示例3（遍历文件（运维高频））：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 遍历/tmp下所有.log文件，统计大小</span>
<span class="hljs-keyword">for</span> <span class="hljs-built_in">log</span> <span class="hljs-keyword">in</span> /tmp/*.<span class="hljs-built_in">log</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"<span class="hljs-variable">$log</span>"</span> ]; <span class="hljs-keyword">then</span>  <span class="hljs-comment"># 确保是文件（避免目录）</span>
        size=$(<span class="hljs-built_in">du</span> -h <span class="hljs-variable">$log</span> | awk <span class="hljs-string">'{print $1}'</span>)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$log</span> → 大小：<span class="hljs-variable">$size</span>"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h4 data-id="heading-23">（2）C风格for循环（数值循环）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> (( 初始值; 条件; 步长 )); <span class="hljs-keyword">do</span>
    执行的命令
<span class="hljs-keyword">done</span>
</code></pre>
<p>示例（计算1-100的和）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">sum</span>=0
<span class="hljs-keyword">for</span> (( i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">100</span>; i++ )); <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">sum</span>=$((sum + i))  <span class="hljs-comment"># 数值计算（双括号）</span>
<span class="hljs-keyword">done</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"1-100的和：<span class="hljs-variable">$sum</span>"</span>  <span class="hljs-comment"># 输出5050</span>
</code></pre>
<h3 data-id="heading-24">2. while循环（条件满足就循环）</h3>
<h4 data-id="heading-25">（1）基础语法</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">while</span> [ 条件表达式 ]; <span class="hljs-keyword">do</span>
    执行的命令
<span class="hljs-keyword">done</span>
</code></pre>
<p>实战示例1（循环读取文件内容）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 读取/etc/passwd的每一行（逐行处理）</span>
file=<span class="hljs-string">"/etc/passwd"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line; <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># 提取用户名（第一列，:分隔）</span>
    username=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$line</span> | <span class="hljs-built_in">cut</span> -d: -f1)
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"用户名：<span class="hljs-variable">$username</span>"</span>
<span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$file</span>  <span class="hljs-comment"># &lt; 表示从文件读取内容</span>
</code></pre>
<p>实战示例2（无限循环+手动终止）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 每隔5秒检查nginx服务是否运行</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>  <span class="hljs-comment"># true表示无限循环</span>
    <span class="hljs-keyword">if</span> [ $(ps -ef | grep nginx | grep -v grep | <span class="hljs-built_in">wc</span> -l) -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"nginx已停止，正在重启..."</span>
        systemctl start nginx
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"nginx运行正常（<span class="hljs-subst">$(date)</span>）"</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">sleep</span> 5  <span class="hljs-comment"># 休眠5秒</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># 终止方式：Ctrl+C</span>
</code></pre>
<h3 data-id="heading-26">3. 循环控制（break/continue）</h3>
<ul>
<li><code>break</code>：终止整个循环（跳出循环）；</li>
<li><code>continue</code>：跳过当前循环，执行下一次循环。</li>
</ul>
<p>示例（遍历1-10，遇到5终止循环）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..10}; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$i</span> -eq 5 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">break</span>  <span class="hljs-comment"># 终止循环</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"当前数字：<span class="hljs-variable">$i</span>"</span>
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># 输出1-4</span>
</code></pre>
<p>示例（遍历1-10，跳过5）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..10}; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$i</span> -eq 5 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">continue</span>  <span class="hljs-comment"># 跳过5，继续下一次</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"当前数字：<span class="hljs-variable">$i</span>"</span>
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># 输出1-4、6-10</span>
</code></pre>
<h2 data-id="heading-27">五、函数：让脚本“模块化”</h2>
<p>函数是把重复的代码块封装成“可调用的命令”，减少脚本冗余，方便维护——比如把“备份数据库”“检查服务状态”封装成函数，按需调用。</p>
<h3 data-id="heading-28">1. 函数定义与调用</h3>
<h4 data-id="heading-29">（1）基础语法</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 定义函数</span>
函数名() {
    代码块
    <span class="hljs-built_in">return</span> 数值  <span class="hljs-comment"># 返回值（可选，默认返回最后一条命令的执行状态）</span>
}

<span class="hljs-comment"># 调用函数</span>
函数名 参数1 参数2
</code></pre>
<h4 data-id="heading-30">（2）实战示例（封装备份函数）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 定义备份函数（参数1：备份目录，参数2：备份文件名）</span>
<span class="hljs-function"><span class="hljs-title">backup_dir</span></span>() {
    <span class="hljs-built_in">local</span> src_dir=<span class="hljs-variable">$1</span>  <span class="hljs-comment"># 局部变量（仅函数内有效）</span>
    <span class="hljs-built_in">local</span> backup_file=<span class="hljs-variable">$2</span>
    <span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$src_dir</span>"</span> ]; <span class="hljs-keyword">then</span>
        tar -zcf /tmp/<span class="hljs-variable">$backup_file</span>.tar.gz <span class="hljs-variable">$src_dir</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"备份成功：/tmp/<span class="hljs-variable">$backup_file</span>.tar.gz"</span>
        <span class="hljs-built_in">return</span> 0  <span class="hljs-comment"># 成功返回0</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"错误：目录<span class="hljs-variable">$src_dir</span>不存在！"</span>
        <span class="hljs-built_in">return</span> 1  <span class="hljs-comment"># 失败返回1</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># 调用函数（备份/var/log目录）</span>
backup_dir /var/log log_backup_2025

<span class="hljs-comment"># 调用函数（备份/home目录）</span>
backup_dir /home home_backup_2025
</code></pre>
<h3 data-id="heading-31">2. 函数参数与返回值</h3>
<ul>
<li>函数参数：调用时传入的参数，用<code>$1</code>、<code>$2</code>获取（与脚本位置参数用法一致）；</li>
<li>函数返回值：
<ul>
<li>用<code>return</code>返回（仅能返回0-255的整数，0=成功，非0=失败）；</li>
<li>若需返回字符串/数值，用<code>echo</code>输出，调用时用<code>变量=$(函数名)</code>接收。</li>
</ul>
</li>
</ul>
<p>示例（返回数值计算结果）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 定义加法函数</span>
<span class="hljs-function"><span class="hljs-title">add</span></span>() {
    <span class="hljs-built_in">local</span> a=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">local</span> b=<span class="hljs-variable">$2</span>
    <span class="hljs-built_in">echo</span> $((a + b))  <span class="hljs-comment"># 用echo返回结果</span>
}

<span class="hljs-comment"># 调用函数，接收返回值</span>
result=$(add 10 20)
<span class="hljs-built_in">echo</span> <span class="hljs-string">"10+20=<span class="hljs-variable">$result</span>"</span>  <span class="hljs-comment"># 输出30</span>
</code></pre>
<h3 data-id="heading-32">3. 函数实战（运维常用）</h3>
<p>封装“检查端口是否开放”函数：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 定义检查端口函数（参数1：IP，参数2：端口）</span>
<span class="hljs-function"><span class="hljs-title">check_port</span></span>() {
    <span class="hljs-built_in">local</span> ip=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">local</span> port=<span class="hljs-variable">$2</span>
    <span class="hljs-comment"># 使用nc命令检查端口（需安装nc：yum install -y nc）</span>
    nc -z -w 2 <span class="hljs-variable">$ip</span> <span class="hljs-variable">$port</span> &gt; /dev/null 2&gt;&amp;1
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$ip</span>:<span class="hljs-variable">$port</span> 开放"</span>
        <span class="hljs-built_in">return</span> 0
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$ip</span>:<span class="hljs-variable">$port</span> 关闭"</span>
        <span class="hljs-built_in">return</span> 1
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># 批量检查端口</span>
check_port 192.168.1.100 80
check_port 192.168.1.100 3306
check_port 192.168.1.100 6379
</code></pre>
<h2 data-id="heading-33">六、Shell脚本实战案例（综合运用）</h2>
<h3 data-id="heading-34">案例1：批量创建用户并设置密码</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 脚本名：create_users.sh</span>
<span class="hljs-comment"># 功能：批量创建用户，密码统一为123456（生产环境需改为随机密码）</span>

<span class="hljs-comment"># 定义用户列表</span>
<span class="hljs-built_in">users</span>=<span class="hljs-string">"user1 user2 user3 user4"</span>

<span class="hljs-comment"># 循环创建用户</span>
<span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> <span class="hljs-variable">$users</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># 检查用户是否已存在</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">id</span> <span class="hljs-variable">$user</span> &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$user</span>已存在，跳过..."</span>
        <span class="hljs-built_in">continue</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-comment"># 创建用户</span>
    useradd <span class="hljs-variable">$user</span>
    <span class="hljs-comment"># 设置密码（echo "密码" | passwd --stdin 用户名）</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"123456"</span> | passwd --stdin <span class="hljs-variable">$user</span> &gt; /dev/null 2&gt;&amp;1
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$user</span>创建成功，密码：123456"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$user</span>创建失败！"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h3 data-id="heading-35">案例2：日志清理脚本（保留7天内日志）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 脚本名：clean_logs.sh</span>
<span class="hljs-comment"># 功能：删除/tmp下7天前的.log文件</span>

log_dir=<span class="hljs-string">"/tmp"</span>
<span class="hljs-comment"># 遍历7天前的.log文件</span>
find <span class="hljs-variable">$log_dir</span> -name <span class="hljs-string">"*.log"</span> -mtime +7 -<span class="hljs-built_in">type</span> f | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> log_file; <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># 删除文件</span>
    <span class="hljs-built_in">rm</span> -f <span class="hljs-variable">$log_file</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"已删除：<span class="hljs-variable">$log_file</span>"</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"日志清理完成！"</span>
</code></pre>
<h2 data-id="heading-36">七、Shell脚本避坑指南（新手必看）</h2>
<ol>
<li><strong>语法错误</strong>：<code>if</code>的<code>[ ]</code>两边加空格、变量赋值等号无空格、循环/函数结尾的<code>done</code>/<code>fi</code>/<code>}</code>必须写；</li>
<li><strong>路径问题</strong>：脚本中尽量用绝对路径（如<code>/tmp/test.log</code>），避免相对路径导致执行失败；</li>
<li><strong>权限问题</strong>：脚本执行时需有对应权限（如创建文件需写权限，删除文件需删权限）；</li>
<li><strong>特殊字符</strong>：处理包含空格的文件名/路径时，用双引号包裹（如<code>[ -f "$file" ]</code>）；</li>
<li><strong>日志输出</strong>：重要操作添加日志（如<code>echo "[$(date)] 备份失败" &gt;&gt; /tmp/backup.log</code>），方便排查问题；</li>
<li><strong>测试先行</strong>：新脚本先在测试环境运行，用<code>bash -x 脚本名</code>调试（显示执行过程）。</li>
</ol>
<h2 data-id="heading-37">总结</h2>
<p>Shell脚本的核心是“把复杂操作简单化、重复操作自动化”——变量存储数据，条件判断实现逻辑分支，循环处理批量任务，函数封装复用代码。学习时无需死记语法，重点是“多写多练”：先从简单脚本（如批量创建文件、检查服务状态）入手，再逐步实现复杂功能（如自动化备份、批量部署）。</p>
<p>掌握这些基础语法后，可结合运维场景扩展（如结合crontab定时执行脚本、结合SSH批量管理服务器），真正实现“一键运维”，大幅提升工作效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【AI-7 全栈-2 /Lesson16(2025-11-01)】构建一个基于 AIGC 的 Logo 生成 Bot：从前端到后端的完整技术指南 🎨]]></title>    <link>https://juejin.cn/post/7576978338754756658</link>    <guid>https://juejin.cn/post/7576978338754756658</guid>    <pubDate>2025-11-27T06:28:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576978338754756658" data-draft-id="7576929700842455049" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【AI-7 全栈-2 /Lesson16(2025-11-01)】构建一个基于 AIGC 的 Logo 生成 Bot：从前端到后端的完整技术指南 🎨"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-11-27T06:28:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jing_Rainbow"/> <meta itemprop="url" content="https://juejin.cn/user/1285809519198256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【AI-7 全栈-2 /Lesson16(2025-11-01)】构建一个基于 AIGC 的 Logo 生成 Bot：从前端到后端的完整技术指南 🎨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1285809519198256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jing_Rainbow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:28:32.000Z" title="Thu Nov 27 2025 06:28:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🎨在当今这个人工智能与前端开发深度融合的时代，构建一个能根据用户输入自动生成 Logo 的智能 Bot 已不再是遥不可及的梦想。本文<strong>逐字逐句、毫无删减地展开详细讲解</strong>，并补充所有相关的技术细节，涵盖前端布局、表单设计、无障碍访问、API 调用、LLM 集成、安全实践等多个维度。准备好了吗？Let’s go! 🚀</p>
<hr/>
<h2 data-id="heading-0">🧩 1. 项目目标：Logo 生成 Bot</h2>
<p>根据 <code>index.html</code> 中的信息：</p>
<pre><code class="hljs language-html" lang="html">Document
Bot名称： Bot描述： 生成图标
</code></pre>
<p>我们可以明确这个项目的 <strong>核心功能</strong> 是：</p>
<blockquote>
<p>用户输入一段文本（如“科技公司 logo”），系统调用 AI 模型（如 DALL·E 3），自动生成对应的 Logo 图像。</p>
</blockquote>
<p>这本质上是一个 <strong>AIGC（AI Generated Content）应用</strong>，结合了前端交互与后端大模型 API。</p>
<hr/>
<h2 data-id="heading-1">🖼️ 2. 选择合适的 AI 模型：DALL·E 3</h2>
<p><code>readme.md</code> 中明确指出：</p>
<blockquote>
<p>coze logo 生成选择合适的模型 dalle-e-3</p>
</blockquote>
<h3 data-id="heading-2">✅ 为什么选 DALL·E 3？</h3>
<ul>
<li><strong>高分辨率图像生成</strong>：支持 1024×1024、1792×1024 等多种尺寸。</li>
<li><strong>文本理解能力强</strong>：能精准解析复杂 prompt，如“极简风格的蓝色科技感 logo，包含电路图案”。</li>
<li><strong>OpenAI 官方支持</strong>：通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fdocs%2Fguides%2Fimages" target="_blank" title="https://platform.openai.com/docs/guides/images" ref="nofollow noopener noreferrer">OpenAI Images API</a> 可直接调用。</li>
</ul>
<h3 data-id="heading-3">🔧 调用方式（补充）</h3>
<p>使用 OpenAI 的 Node.js SDK：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"openai"</span>;

<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({ <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span> });

<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">images</span>.<span class="hljs-title function_">generate</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"dall-e-3"</span>,
  <span class="hljs-attr">prompt</span>: input, <span class="hljs-comment">// ← 这就是 {{input}}</span>
  <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">size</span>: <span class="hljs-string">"1024x1024"</span>
});

<span class="hljs-keyword">const</span> imageUrl = response.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">url</span>;
</code></pre>
<blockquote>
<p>💡 注意：<code>{{input}}</code> 是模板语法，通常在前端或服务端模板引擎中被替换为用户实际输入。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">🌐 3. 前端页面结构：Bootstrap + HTML5 表单</h2>
<p><code>readme.md</code> 提到了大量前端技术要点，我们逐一展开。</p>
<h3 data-id="heading-5">📦 使用 Bootstrap 样式库</h3>
<blockquote>
<p>CSS: <a href="https://link.juejin.cn?target=https%3A%2F%2Fv2.bootcss.com%2Fbase-css.html" target="_blank" title="https://v2.bootcss.com/base-css.html" ref="nofollow noopener noreferrer">v2.bootcss.com/base-css.ht…</a></p>
</blockquote>
<p>这是 <strong>Bootstrap v2 的中文 CDN</strong>（现已被 v5 取代，但原理相通）。我们采用现代实践，使用 <strong>Bootstrap 5</strong> 构建响应式布局。</p>
<h4 data-id="heading-6">🏗️ 页面容器布局</h4>
<blockquote>
<p><code>.container PC端页面的layout 中间宽度，.row 左右margin:auto;</code></p>
</blockquote>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row justify-content-center"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 表单放这里 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ul>
<li><code>.container</code>：固定宽度（如 1140px 在大屏），居中。</li>
<li><code>.row</code> + <code>justify-content-center</code>：实现水平居中（比手动写 <code>margin: auto</code> 更语义化）。</li>
</ul>
<hr/>
<h3 data-id="heading-7">📝 HTML5 表单最佳实践</h3>
<p><code>readme.md</code> 强调了以下关键点：</p>
<h4 data-id="heading-8">✅ 必填字段：<code>required</code> 属性</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">required</span>&gt;</span>
</code></pre>
<ul>
<li>浏览器会自动阻止提交空值，并提示用户。</li>
</ul>
<h4 data-id="heading-9">💬 占位符提示：<code>placeholder</code></h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入 Logo 描述，例如：极简风咖啡店 logo"</span>&gt;</span>
</code></pre>
<ul>
<li>提升用户体验，尤其对“小白用户”友好 👶。</li>
</ul>
<h4 data-id="heading-10">♿ 无障碍访问（Accessibility）：<code>&lt;label for="id"&gt;</code></h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"prompt"</span>&gt;</span>Logo 描述<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">required</span>&gt;</span>
</code></pre>
<ul>
<li><strong>为什么重要？</strong>
<ul>
<li>屏幕阅读器（如 JAWS、VoiceOver）能正确朗读标签。</li>
<li>点击 label 可聚焦 input，提升移动端体验。</li>
</ul>
</li>
<li>大厂（如 Google、Apple、阿里）强制要求无障碍合规（WCAG 标准）✅。</li>
</ul>
<h4 data-id="heading-11">📂 表单分组：<code>.form-group</code></h4>
<blockquote>
<p><code>.form-group 表单组，margin-bottom: 15px;</code></p>
</blockquote>
<p>虽然 Bootstrap 5 已弃用 <code>.form-group</code>，但其思想仍适用：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mb-3"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-label"</span>&gt;</span>Logo 描述<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">required</span> 
         <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"例如：蓝色科技感 AI 公司 logo"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ul>
<li><code>mb-3</code> = margin-bottom: 1rem（≈16px），视觉上分隔表单项。</li>
</ul>
<hr/>
<h3 data-id="heading-12">🚫 阻止默认提交行为：<code>event.preventDefault()</code></h3>
<blockquote>
<p>点击按钮，表单的提交 form 默认提交到 action 为空就是当前页面<br/>
event.preventDefault() 阻止表单的默认提交</p>
</blockquote>
<h4 data-id="heading-13">❌ 默认行为的问题</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>生成 Logo<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre>
<ul>
<li>若 <code>action=""</code> 或未设置，表单会 <strong>刷新当前页面</strong>，丢失状态！</li>
</ul>
<h4 data-id="heading-14">✅ 正确做法：JavaScript 拦截</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'form'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-keyword">async</span> (e) =&gt; {
  e.<span class="hljs-title function_">preventDefault</span>(); <span class="hljs-comment">// ← 关键！阻止页面跳转/刷新</span>

  <span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'prompt'</span>).<span class="hljs-property">value</span>;
  <span class="hljs-comment">// 调用 API 获取 logo...</span>
});
</code></pre>
<hr/>
<h2 data-id="heading-15">⚙️ 4. 后端 API 集成：Node.js + OpenAI</h2>
<p><code>readme.md</code> 提到：</p>
<blockquote>
<p>node openai completion API<br/>
输入：prompt<br/>
输出：completion<br/>
llm 发起的api接口调用 前端界面 api LLM<br/>
POST 请求<br/>
apikey 加密</p>
</blockquote>
<h3 data-id="heading-16">🔁 完整数据流</h3>
<pre><code class="hljs language-css" lang="css">前端 (<span class="hljs-selector-tag">HTML</span>/JS) 
  → POST /generate-logo { prompt: <span class="hljs-string">"..."</span> } 
  → Node<span class="hljs-selector-class">.js</span> 服务端 
  → 调用 OpenAI Images API (DALL·E <span class="hljs-number">3</span>) 
  → 返回图片 URL 
  → 前端显示 &lt;<span class="hljs-selector-tag">img</span> <span class="hljs-attribute">src</span>="..."&gt;
</code></pre>
<h3 data-id="heading-17">🔐 API Key 安全实践</h3>
<blockquote>
<p><strong>绝对不要</strong> 在前端暴露 <code>OPENAI_API_KEY</code>！</p>
</blockquote>
<p>✅ 正确做法：</p>
<ul>
<li>将 key 存在 <strong>服务端环境变量</strong> 中（如 <code>.env</code> 文件）。</li>
<li>前端只与自己的后端通信，后端再调用 OpenAI。</li>
</ul>
<pre><code class="hljs language-env" lang="env"># .env
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// server.js (Express 示例)</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/generate-logo'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">const</span> { prompt } = req.<span class="hljs-property">body</span>;
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">images</span>.<span class="hljs-title function_">generate</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"dall-e-3"</span>,
      <span class="hljs-attr">prompt</span>: prompt,
      <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">size</span>: <span class="hljs-string">"1024x1024"</span>
    });
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">url</span>: response.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">url</span> });
  } <span class="hljs-keyword">catch</span> (error) {
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span> });
  }
});
</code></pre>
<hr/>
<h2 data-id="heading-18">🧪 5. 开发与测试工具：Apifox</h2>
<blockquote>
<p>apifox</p>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.apifox.cn%2F" target="_blank" title="https://www.apifox.cn/" ref="nofollow noopener noreferrer">Apifox</a> 是一款国产 API 协作平台，集 Postman（调试）、Swagger（文档）、Mock（模拟）于一体。</p>
<h3 data-id="heading-19">🛠️ 如何用于本项目？</h3>
<ol>
<li>定义 <code>/generate-logo</code> 接口文档。</li>
<li>模拟 OpenAI 返回（开发阶段无需真实调用）。</li>
<li>前端直接对接 Mock 数据，加速联调。</li>
</ol>
<hr/>
<h2 data-id="heading-20">🧠 6. AIGC 与 LLM 的本质理解</h2>
<blockquote>
<p>AIGC LLM 的本质</p>
</blockquote>
<ul>
<li><strong>LLM（Large Language Model）</strong>：如 GPT-4，擅长文本生成与理解。</li>
<li><strong>AIGC（AI Generated Content）</strong>：泛指 AI 生成的内容，包括文本（LLM）、图像（DALL·E、Midjourney）、音频、视频等。</li>
<li><strong>本项目属于 “Text-to-Image” AIGC 应用</strong>，由 LLM（理解 prompt）驱动图像模型（生成 logo）。</li>
</ul>
<blockquote>
<p>💡 虽然 DALL·E 3 不是传统 LLM，但它内部集成了强大的语言理解模块，可视为 LLM 与扩散模型的结合体。</p>
</blockquote>
<hr/>
<h2 data-id="heading-21">🧱 7. 完整前端代码示例（整合所有要点）</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Logo 生成 Bot<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container mt-5"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row justify-content-center"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-center mb-4"</span>&gt;</span>🎨 AI Logo 生成器<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"logoForm"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mb-3"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-label"</span>&gt;</span>请输入 Logo 描述<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
              <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> 
              <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> 
              <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> 
              <span class="hljs-attr">name</span>=<span class="hljs-string">"prompt"</span> 
              <span class="hljs-attr">required</span> 
              <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"例如：极简风格的绿色环保公司 logo，含树叶元素"</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary w-100"</span>&gt;</span>生成 Logo<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"result"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-4 text-center"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'logoForm'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-keyword">async</span> (e) =&gt; {
      e.<span class="hljs-title function_">preventDefault</span>();
      <span class="hljs-keyword">const</span> prompt = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'prompt'</span>).<span class="hljs-property">value</span>;
      <span class="hljs-keyword">const</span> resultDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'result'</span>);
      
      resultDiv.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'&lt;div class="spinner-border" role="status"&gt;&lt;span class="visually-hidden"&gt;加载中...&lt;/span&gt;&lt;/div&gt;'</span>;
      
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/generate-logo'</span>, {
          <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
          <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
          <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ prompt })
        });
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
        <span class="hljs-keyword">if</span> (data.<span class="hljs-property">url</span>) {
          resultDiv.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`&lt;img src="<span class="hljs-subst">${data.url}</span>" class="img-fluid rounded mt-3" alt="生成的 Logo"&gt;`</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(data.<span class="hljs-property">error</span> || <span class="hljs-string">'未知错误'</span>);
        }
      } <span class="hljs-keyword">catch</span> (err) {
        resultDiv.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`&lt;div class="alert alert-danger"&gt;<span class="hljs-subst">${err.message}</span>&lt;/div&gt;`</span>;
      }
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">✅ 总结：技术栈全景图</h2>








































<table><thead><tr><th>模块</th><th>技术</th><th>说明</th></tr></thead><tbody><tr><td><strong>前端</strong></td><td>HTML5 + Bootstrap 5</td><td>响应式布局、无障碍表单</td></tr><tr><td><strong>交互</strong></td><td>JavaScript (Fetch API)</td><td>拦截表单、调用后端</td></tr><tr><td><strong>后端</strong></td><td>Node.js + Express</td><td>接收请求、调用 OpenAI</td></tr><tr><td><strong>AI 模型</strong></td><td>DALL·E 3 (via OpenAI API)</td><td>文本生成 Logo 图像</td></tr><tr><td><strong>安全</strong></td><td>环境变量 (.env)</td><td>保护 API Key</td></tr><tr><td><strong>开发工具</strong></td><td>Apifox</td><td>API 设计与测试</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-23">🌈 结语</h2>
<p>通过本文，我们不仅 <strong>完整还原了 <code>readme.md</code> 和 <code>index.html</code> 中的所有知识点</strong>，还深入扩展了每个环节的技术细节与最佳实践。从一个简单的“生成图标”需求出发，我们构建了一个融合现代 Web 开发、AI 能力与无障碍设计的完整应用。</p>
<p>现在，你可以自信地说：<strong>“我能用 DALL·E 3 做一个 Logo 生成 Bot！”</strong> 💪</p>
<p>快去动手实现吧！别忘了给你的项目起个酷炫的名字～ 🚀✨</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解锁淘宝京东拼多多API，让电商数据为你所用]]></title>    <link>https://juejin.cn/post/7576994308273471507</link>    <guid>https://juejin.cn/post/7576994308273471507</guid>    <pubDate>2025-11-27T06:13:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576994308273471507" data-draft-id="7577171133444145188" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解锁淘宝京东拼多多API，让电商数据为你所用"/> <meta itemprop="keywords" content="API"/> <meta itemprop="datePublished" content="2025-11-27T06:13:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="电商api2467742810"/> <meta itemprop="url" content="https://juejin.cn/user/2147781265591291"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解锁淘宝京东拼多多API，让电商数据为你所用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2147781265591291/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    电商api2467742810
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:13:23.000Z" title="Thu Nov 27 2025 06:13:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在数字化时代，电商平台已成为商业活动的重要阵地。淘宝、京东、拼多多三大巨头汇聚了海量商品信息和消费者行为数据。若能有效获取并利用这些数据，企业将获得市场竞争的关键优势。本文将探讨如何通过官方API合法获取电商数据，并将其转化为商业价值。</p>
<h4 data-id="heading-0">一、电商数据的价值洼地</h4>
<p>电商平台每日产生：</p>
<ul>
<li>千万级商品更新数据</li>
<li>亿级用户行为轨迹</li>
<li>实时价格波动信息 这些数据蕴含消费者偏好、市场趋势、竞品策略等关键商业情报。传统爬虫方式面临法律风险和技术壁垒，而官方API提供了合规的数据获取通道。</li>
</ul>
<h4 data-id="heading-1">二、API接入实战</h4>
<p>以淘宝API为例，获取商品数据的基本流程如下：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">import requests

def <span class="hljs-title">fetch_taobao_item</span>(<span class="hljs-params">item_id</span>):
    # 认证信息配置
    app_key</span> = <span class="hljs-string">'YOUR_APP_KEY'</span>
    app_secret = <span class="hljs-string">'YOUR_APP_SECRET'</span>
    url = <span class="hljs-string">'https://api.taobao.com/router/rest'</span>
    
    <span class="hljs-meta"># 构造请求参数</span>
    <span class="hljs-keyword">params</span> = {
        <span class="hljs-string">'method'</span>: <span class="hljs-string">'taobao.item.get'</span>,
        <span class="hljs-string">'item_id'</span>: item_id,
        <span class="hljs-string">'format'</span>: <span class="hljs-string">'json'</span>,
        <span class="hljs-string">'v'</span>: <span class="hljs-string">'2.0'</span>,
        <span class="hljs-string">'sign_method'</span>: <span class="hljs-string">'md5'</span>,
        <span class="hljs-string">'app_key'</span>: app_key,
        <span class="hljs-string">'timestamp'</span>: str(<span class="hljs-built_in">int</span>(time.time()))
    }
    
    <span class="hljs-meta"># 生成签名</span>
    <span class="hljs-keyword">params</span>[<span class="hljs-string">'sign'</span>] = generate_sign(<span class="hljs-keyword">params</span>, app_secret)
    
    <span class="hljs-meta"># 发送请求</span>
    response = requests.<span class="hljs-keyword">get</span>(url, <span class="hljs-keyword">params</span>=<span class="hljs-keyword">params</span>)
    <span class="hljs-keyword">return</span> response.json()
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-2">三、数据应用场景</h4>
<ol>
<li>
<p><strong>价格监控系统</strong></p>
<pre><code class="hljs language-ini" lang="ini">def monitor_price(item_id):
    while True:
        <span class="hljs-attr">data</span> = fetch_taobao_item(item_id)
        <span class="hljs-attr">current_price</span> = data[<span class="hljs-string">'price'</span>]
        if current_price &lt; threshold_price:
            send_alert_notification()
        time.sleep(3600)  <span class="hljs-comment"># 每小时检测一次</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p><strong>竞品分析矩阵</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">def competitor_analysis(competitor_ids):
    result = {}
    <span class="hljs-keyword">for</span> cid <span class="hljs-keyword">in</span> competitor_ids:
        <span class="hljs-keyword">data</span> = fetch_taobao_item(cid)
        result[cid] = {
            <span class="hljs-string">'sales'</span>: <span class="hljs-keyword">data</span>[<span class="hljs-string">'sales'</span>],
            <span class="hljs-string">'rating'</span>: <span class="hljs-keyword">data</span>[<span class="hljs-string">'rating'</span>],
            <span class="hljs-string">'promotions'</span>: <span class="hljs-keyword">data</span>[<span class="hljs-string">'promotion_info'</span>]
        }
    <span class="hljs-keyword">return</span> result
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p><strong>用户画像构建</strong></p>
<pre><code class="hljs language-scss" lang="scss">def <span class="hljs-built_in">build_user_profile</span>(user_behavior_data):
    # 使用协同过滤算法
    user_matrix = <span class="hljs-built_in">create_user_item_matrix</span>(user_behavior_data)
    model = <span class="hljs-built_in">AlternatingLeastSquares</span>(factors=<span class="hljs-number">50</span>)
    model.<span class="hljs-built_in">fit</span>(user_matrix)
    return model.<span class="hljs-built_in">recommend</span>(user_id)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ol>
<h4 data-id="heading-3">四、安全合规要点</h4>
<ol>
<li>
<p>严格遵循平台API调用频率限制： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>最大请求数</mtext><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>5000</mn><mi mathvariant="normal">/</mi><mtext>天</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>普通应用 </mtext><mn>10000</mn><mi mathvariant="normal">/</mi><mtext>天</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>企业认证</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\text{最大请求数} = \begin{cases} 5000/\text{天} &amp; \text{普通应用} \ 10000/\text{天} &amp; \text{企业认证} \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord cjk_fallback">最大请求数</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.97em;"><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"/><span class="mord"><span class="mord">5000/</span><span class="mord text"><span class="mord cjk_fallback">天</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47em;"><span/></span></span></span></span><span class="arraycolsep" style="width:1em;"/><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.97em;"><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"/><span class="mord"><span class="mord text"><span class="mord cjk_fallback">普通应用</span></span><span class="mspace"> </span><span class="mord">10000/</span><span class="mord text"><span class="mord cjk_fallback">天</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.97em;"><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"/><span class="mord"><span class="mord text"><span class="mord cjk_fallback">企业认证</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47em;"><span/></span></span></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
</li>
<li>
<p>敏感数据处理原则：</p>
<ul>
<li>用户隐私数据必须脱敏处理</li>
<li>不得存储原始支付信息</li>
<li>遵守GDPR等数据保护法规</li>
</ul>
</li>
<li>
<p>缓存策略优化：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">from redis <span class="hljs-keyword">import</span> Redis
cache = Redis()

def get_cached_data(key, ttl=<span class="hljs-number">300</span>):
    <span class="hljs-keyword">if</span> cache.exists(key):
        <span class="hljs-keyword">return</span> cache.<span class="hljs-keyword">get</span>(key)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">data</span> = fetch_api_data()
        cache.setex(key, ttl, <span class="hljs-keyword">data</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ol>
<h4 data-id="heading-4">五、数据价值升华</h4>
<p>通过API获取的原始数据需经深度加工：</p>
<ol>
<li>
<p>建立时间序列模型预测价格波动： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>α</mi><msub><mi>P</mi><mi>t</mi></msub><mo>+</mo><mi>β</mi><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>γ</mi><mi>i</mi></msub><msub><mi>S</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{t+1} = \alpha P_t + \beta \sum_{i=1}^{n} \gamma_i S_{i,t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"/><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0556em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> 其中<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></span>为价格，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></span>为影响因素</p>
</li>
<li>
<p>构建商品知识图谱：</p>
<pre><code class="hljs language-css" lang="css">graph LR
<span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[手机]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[品牌]</span>
<span class="hljs-selector-tag">A</span> --&gt; C<span class="hljs-selector-attr">[价格区间]</span>
<span class="hljs-selector-tag">A</span> --&gt; D<span class="hljs-selector-attr">[功能特性]</span>
<span class="hljs-selector-tag">B</span> --&gt; E<span class="hljs-selector-attr">[苹果]</span>
<span class="hljs-selector-tag">B</span> --&gt; F<span class="hljs-selector-attr">[华为]</span>
D --&gt; G<span class="hljs-selector-attr">[5G]</span>
D --&gt; H<span class="hljs-selector-attr">[摄像头]</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p>开发智能决策系统：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EcommerceDecisionSystem</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, api_client</span>):
        <span class="hljs-variable language_">self</span>.data_source = api_client
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">make_pricing_decision</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, product_id</span>):
        market_data = <span class="hljs-variable language_">self</span>.data_source.get_market_trends()
        cost_data = <span class="hljs-variable language_">self</span>.data_source.get_supply_chain_info()
        <span class="hljs-keyword">return</span> optimize_price(product_id, market_data, cost_data)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ol>
<h4 data-id="heading-5">结语</h4>
<p>电商API如同数字世界的石油钻井平台，只有掌握正确的开采技术，才能让数据能源源源不断转化为商业动力。通过本文介绍的技术路径，企业可建立合规高效的数据获取体系，将淘宝、京东、拼多多的数据金矿转化为：</p>
<ul>
<li>实时市场感知能力</li>
<li>精准用户洞察能力</li>
<li>敏捷商业决策能力 在数据驱动的商业新时代，掌握API技术就是掌握市场竞争的制高点。</li>
</ul>
<p><strong>注</strong>：本文示例代码需配合各平台官方SDK使用，实际开发请参考最新API文档。数据获取应严格遵守《网络安全法》及相关平台协议。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何使用 C# 将 RTF 转换为 PDF]]></title>    <link>https://juejin.cn/post/7576968345875218459</link>    <guid>https://juejin.cn/post/7576968345875218459</guid>    <pubDate>2025-11-27T06:15:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576968345875218459" data-draft-id="7576918517238693938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何使用 C# 将 RTF 转换为 PDF"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T06:15:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LSTM97"/> <meta itemprop="url" content="https://juejin.cn/user/2253353867033484"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何使用 C# 将 RTF 转换为 PDF
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2253353867033484/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LSTM97
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:15:26.000Z" title="Thu Nov 27 2025 06:15:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>RTF（Rich Text Format）是一种通用的文档格式，允许用户在不同的文字处理软件中保存和交换格式化文本。PDF（Portable Document Format）则是一种广泛使用的文档格式，它能够保留文档的原始布局，无论在哪种设备上查看都能保持一致。因此，将 RTF 文件转换为 PDF 文件在许多应用场景中都十分重要。本文将介绍如何使用 Spire.Doc for .NET 来实现这一功能。</p>
<h2 data-id="heading-0">Spire.Doc for .NET 简介</h2>
<p>Spire.Doc 是一款 .NET 平台的组件，可以轻松地处理 Word 文档，包括创建、编辑、转换和打印文档。该组件支持多种文档格式，诸如 DOC, DOCX, RTF, HTML, TXT, PDF 等。使用 Spire.Doc，开发者可以快速实现复杂的文档操作，而无需深入了解底层文档格式。</p>
<h2 data-id="heading-1">安装 Spire.Doc</h2>
<p>要使用 Spire.Doc 进行 RTF 到 PDF 的转换，可以通过 NuGet 包管理器进行安装。以下是安装的步骤：</p>
<ol>
<li>打开 Visual Studio 并创建一个新项目（例如，控制台应用程序）。</li>
<li>右键单击项目，选择“管理 NuGet 包”。</li>
<li>在浏览选项卡中，搜索“Spire.Doc”，并点击“安装”以添加该库。</li>
</ol>
<h2 data-id="heading-2">代码示例</h2>
<p>以下是一个简单的代码示例，演示如何使用 Spire.Doc 将 RTF 文件转换为 PDF 文件：</p>
<pre><code class="hljs language-typescript" lang="typescript">using <span class="hljs-title class_">Spire</span>.<span class="hljs-property">Doc</span>;
using <span class="hljs-title class_">Spire</span>.<span class="hljs-property">Doc</span>.<span class="hljs-property">Documents</span>;

classProgram
{
<span class="hljs-title function_">staticvoidMain</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)
    {
    <span class="hljs-comment">// 创建一个 Document 对象</span>
        <span class="hljs-title class_">Document</span> <span class="hljs-variable language_">document</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();

    <span class="hljs-comment">// 加载 RTF 文件</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title class_">LoadFromFile</span>(<span class="hljs-string">"input.rtf"</span>);

    <span class="hljs-comment">// 保存为 PDF 文件</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title class_">SaveToFile</span>(<span class="hljs-string">"output.pdf"</span>, <span class="hljs-title class_">FileFormat</span>.<span class="hljs-property">PDF</span>);

    <span class="hljs-comment">// 输出成功信息</span>
        <span class="hljs-title class_">Console</span>.<span class="hljs-title class_">WriteLine</span>(<span class="hljs-string">"RTF 文件成功转换为 PDF 文件！"</span>);
    }
}
</code></pre>
<h3 data-id="heading-3">代码详解</h3>
<ol>
<li><strong>加载 RTF 文件</strong> ：使用 <code>document.LoadFromFile()</code> 方法加载指定路径的 RTF 文件。</li>
<li><strong>保存为 PDF 文件</strong> ：通过 <code>document.SaveToFile()</code> 方法，将加载的文档保存为 PDF 格式。此方法的第一个参数是输出文件的路径，第二个参数则是文件格式。</li>
<li><strong>输出成功信息</strong> ：控制台输出信息提示用户转换成功。</li>
</ol>
<h2 data-id="heading-4">处理异常</h2>
<p>在实际开发中，处理异常是非常重要的。下面的示例展示了如何添加异常处理：</p>
<p>csharp</p>
<pre><code class="hljs language-typescript" lang="typescript">using <span class="hljs-title class_">System</span>;
using <span class="hljs-title class_">Spire</span>.<span class="hljs-property">Doc</span>;

classProgram
{
<span class="hljs-title function_">staticvoidMain</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)
    {
<span class="hljs-keyword">try</span>
        {
        <span class="hljs-comment">// 创建 Document 对象</span>
            <span class="hljs-title class_">Document</span> <span class="hljs-variable language_">document</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();
            <span class="hljs-comment">// 加载 RTF 文件</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title class_">LoadFromFile</span>(<span class="hljs-string">"input.rtf"</span>);
            <span class="hljs-comment">// 保存为 PDF 文件</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title class_">SaveToFile</span>(<span class="hljs-string">"output.pdf"</span>, <span class="hljs-title class_">FileFormat</span>.<span class="hljs-property">PDF</span>);
            <span class="hljs-title class_">Console</span>.<span class="hljs-title class_">WriteLine</span>(<span class="hljs-string">"RTF 文件成功转换为 PDF 文件！"</span>);
        }
        <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> ex)
        {
            <span class="hljs-title class_">Console</span>.<span class="hljs-title class_">WriteLine</span>($<span class="hljs-string">"发生错误：{ex.Message}"</span>);
        }
    }
}
</code></pre>
<p>通过抛出异常，用户可以确认文件路径是否正确或是否存在其他问题。</p>
<h2 data-id="heading-5">总结</h2>
<p>使用 Spire.Doc for .NET 转换 RTF 文件为 PDF 文件非常简单，只需几行代码即可完成。通过加载 RTF 文件并将其保存为 PDF，开发者能够在自己的应用程序中轻松实现文档处理功能。此外，通过适当的异常处理，可以增强程序的健壮性，使得用户体验更佳。</p>
<p>这种文档转换在实际应用中具有广泛的应用场景，如报告生成、数据导出和文档共享等。无论是业务应用还是学术需求，掌握这种技能都是现代开发者不可或缺的能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Scala Map集合完全指南：从入门到实战应用]]></title>    <link>https://juejin.cn/post/7576978338754740274</link>    <guid>https://juejin.cn/post/7576978338754740274</guid>    <pubDate>2025-11-27T06:25:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576978338754740274" data-draft-id="7576867727718547491" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Scala Map集合完全指南：从入门到实战应用"/> <meta itemprop="keywords" content="Scala,后端,编程语言"/> <meta itemprop="datePublished" content="2025-11-27T06:25:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="今天没有盐"/> <meta itemprop="url" content="https://juejin.cn/user/1408937846645355"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Scala Map集合完全指南：从入门到实战应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1408937846645355/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    今天没有盐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:25:19.000Z" title="Thu Nov 27 2025 06:25:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">导入</h2>
<p>在 Scala 中，集合体系与 Python 不同：没有直接名为 Set 的需导入基础类——Set 是 Scala 标准库的核心集合（位于 scala.collection 包下），默认无需手动导入即可使用。但需注意 Scala 的 Set 分为不可变（默认）和可变两种。本文将具体从格式定义到常见操作来讲述集合 Set。</p>
<h2 data-id="heading-1">一、Map的定义和创建</h2>
<h3 data-id="heading-2">定义</h3>
<p>Map（映射）是Scala中一种存储键值对（key-value）的数据结构，每个键在Map中是唯一的，通过键可以快速查找到对应的值。</p>
<h3 data-id="heading-3">好处</h3>
<ul>
<li><strong>快速查找</strong>：通过键可以在常数时间内访问对应的值</li>
<li><strong>数据关联</strong>：能够建立有逻辑关联的数据结构</li>
<li><strong>类型安全</strong>：编译时检查键值类型</li>
<li><strong>灵活性</strong>：支持可变和不可变两种实现方式</li>
</ul>
<h3 data-id="heading-4">语法</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// 不可变Map</span>
<span class="hljs-keyword">val</span> mapName: <span class="hljs-type">Map</span>[<span class="hljs-type">KeyType</span>, <span class="hljs-type">ValueType</span>] = <span class="hljs-type">Map</span>(key1 -&gt; value1, key2 -&gt; value2,...)

<span class="hljs-comment">// 可变Map (需导入scala.collection.mutable.Map)</span>
<span class="hljs-keyword">val</span> mapName: mutable.<span class="hljs-type">Map</span>[<span class="hljs-type">KeyType</span>, <span class="hljs-type">ValueType</span>] = mutable.<span class="hljs-type">Map</span>(key1 -&gt; value2,...)
</code></pre>
<h2 data-id="heading-5">二、Map的基本操作</h2>
<h3 data-id="heading-6">案例一：可变Map与不可变Map的基本操作</h3>
<h4 data-id="heading-7">代码</h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> map

<span class="hljs-comment">/*
 * Map，映射，表示一种一一对应关系！
 */</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">map01</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 创建可变的Map 键 值 对</span>
    <span class="hljs-keyword">val</span> scores = scala.collection.mutable.<span class="hljs-type">Map</span>(<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>, <span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">85</span>)
    <span class="hljs-comment">// 添加</span>
    scores += (<span class="hljs-string">"max"</span> -&gt; <span class="hljs-number">100</span>)

    println(scores)

    <span class="hljs-comment">// 创建不可变的Map</span>
    <span class="hljs-keyword">val</span> provinceInfo = scala.collection.immutable.<span class="hljs-type">Map</span>(<span class="hljs-string">"42"</span> -&gt; <span class="hljs-string">"湖北"</span>)
    <span class="hljs-comment">// provinceInfo += ("14" -&gt; "山西")</span>
    <span class="hljs-keyword">val</span> newInfo = provinceInfo + (<span class="hljs-string">"14"</span> -&gt; <span class="hljs-string">"山西"</span>)
    println(newInfo)
  }
}
</code></pre>
<h4 data-id="heading-8">结果展示</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f86952315ed6480786f8e47076e74b4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764829518&amp;x-signature=m6QMYs2YgcY5k%2BN899H6fpOJ0Zk%3D" alt="01.png" loading="lazy"/></p>
<h4 data-id="heading-9">代码分析</h4>
<ol>
<li><strong>可变Map创建</strong>：使用<code>scala.collection.mutable.Map</code>创建可变Map，初始包含"alice"和"bob"的成绩</li>
<li><strong>添加操作</strong>：使用<code>+=</code>操作符直接向可变Map添加"max"的成绩，这会修改原Map</li>
<li><strong>不可变Map创建</strong>：使用<code>scala.collection.immutable.Map</code>创建不可变Map</li>
<li><strong>不可变Map添加</strong>：通过<code>+</code>操作符创建新的Map，原Map保持不变，体现了不可变集合的特性</li>
<li><strong>键值对语法</strong>：使用<code>-&gt;</code>操作符创建键值对，语法清晰直观</li>
</ol>
<h3 data-id="heading-10">案例二：Map的增删改查操作</h3>
<h4 data-id="heading-11">代码</h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> map
<span class="hljs-number">9</span>
<span class="hljs-comment">/*
*
* Map, 映射，表示一种一一对应关系
* 1. 添加
* 2. 删除
* 3. 查询，对应的值
* 4. 遍历，把所有的数据，依次访问
* */</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">map02</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 创建可变的Map  键  值  对</span>
    <span class="hljs-keyword">val</span> scores = scala.collection.mutable.<span class="hljs-type">Map</span>(<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>, <span class="hljs-string">"bob1"</span> -&gt; <span class="hljs-number">85</span>)
    <span class="hljs-comment">// 1. 添加</span>
    scores += (<span class="hljs-string">"map"</span> -&gt; <span class="hljs-number">100</span>)

    <span class="hljs-comment">// 2. 删除 alice。 删除操作是根据key来做的</span>
    scores -= <span class="hljs-string">"alice"</span>

    <span class="hljs-comment">// 3. 查询。查看bob的分数. rst 是一个Option类型</span>
    <span class="hljs-keyword">val</span> rst = scores.get(<span class="hljs-string">"bob1"</span>)
    <span class="hljs-keyword">if</span> (rst.isEmpty){
      println(<span class="hljs-string">"bob1没有成绩"</span>)
    } <span class="hljs-keyword">else</span> {
      println(rst.get)
    }
    <span class="hljs-comment">// 4. 打印scores</span>
    println(scores)
    <span class="hljs-comment">// 第二种方法 for</span>
    <span class="hljs-keyword">for</span> ((key,value) &lt;- scores){
      println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>, <span class="hljs-subst">${value}</span>分"</span>)
    }

    <span class="hljs-comment">// 第二种方法 foreach</span>
    scores.foreach({
      <span class="hljs-keyword">case</span> (key,value) =&gt; println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>, <span class="hljs-subst">${value}</span>分"</span>)
    })
  }
}
</code></pre>
<h4 data-id="heading-12">结果展示</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c02ec9a43914cc1b3f9bd4e3001fcef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764829518&amp;x-signature=mwXGkiXbHfGa%2BeEjBeBzNPnDC5s%3D" alt="02.png" loading="lazy"/></p>
<h4 data-id="heading-13">代码分析</h4>
<ol>
<li><strong>添加元素</strong>：使用<code>+=</code>操作符添加新的键值对"map" -&gt; 100</li>
<li><strong>删除元素</strong>：使用<code>-=</code>操作符根据键删除"alice"对应的条目</li>
<li><strong>查询元素</strong>：
<ul>
<li>使用<code>get</code>方法查询，返回<code>Option</code>类型，安全处理可能不存在的键</li>
<li>通过<code>isEmpty</code>判断是否存在，避免空指针异常</li>
<li>使用<code>get</code>方法从<code>Option</code>中提取实际值</li>
</ul>
</li>
<li><strong>遍历方式一</strong>：使用<code>for</code>循环配合模式匹配，直接解构键值对</li>
<li><strong>遍历方式二</strong>：使用<code>foreach</code>方法配合case语句，函数式风格遍历</li>
<li><strong>输出格式</strong>：使用字符串插值<code>s"${key}, ${value}分"</code>格式化输出</li>
</ol>
<h2 data-id="heading-14">三、Map的常用方法详解</h2>
<h3 data-id="heading-15">添加元素</h3>
<p><strong>可变Map</strong>：</p>
<ul>
<li><code>+=</code>操作符：<code>map += (key -&gt; value)</code></li>
<li><code>put</code>方法：<code>map.put(key, value)</code></li>
</ul>
<p><strong>不可变Map</strong>：</p>
<ul>
<li><code>+</code>操作符：<code>val newMapName: Map[KeyType, ValueType] = oldMapName + (newKey -&gt;newValue)</code>（创建新Map）</li>
</ul>
<h3 data-id="heading-16">查询元素</h3>
<ul>
<li><code>get</code>方法：<code>val valueOption: Option[ValueType] = mapName.get(key)</code> ，返回<code>Option[ValueType]</code>，安全查询</li>
<li>直接访问：<code>map(key)</code>，键不存在时抛出异常</li>
</ul>
<h3 data-id="heading-17">删除元素（仅可变Map）</h3>
<ul>
<li><code>-=</code>操作符：<code>mapName -= key</code></li>
<li><code>remove</code>方法：<code>mapName.remove(key)</code></li>
</ul>
<h3 data-id="heading-18">遍历Map</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// for循环遍历</span>
<span class="hljs-keyword">for</span> ((key, value) &lt;- map) {
    println(<span class="hljs-string">s"<span class="hljs-subst">$key</span>: <span class="hljs-subst">$value</span>"</span>)
}

<span class="hljs-comment">// foreach方法遍历</span>
map.foreach { <span class="hljs-keyword">case</span> (key, value) =&gt;
    println(<span class="hljs-string">s"<span class="hljs-subst">$key</span>: <span class="hljs-subst">$value</span>"</span>)
}
</code></pre>
<h2 data-id="heading-19">四、总结</h2>
<p>通过本篇文章的学习，我们全面掌握了Scala中Map集合的核心知识：</p>
<h3 data-id="heading-20">核心要点</h3>
<ol>
<li><strong>两种Map类型</strong>：可变Map允许原地修改，不可变Map操作后返回新集合</li>
<li><strong>安全查询</strong>：使用<code>get</code>方法配合<code>Option</code>类型避免运行时异常</li>
<li><strong>多种遍历</strong>：支持<code>for</code>循环和<code>foreach</code>两种遍历方式</li>
<li><strong>丰富操作</strong>：提供完整的增删改查API</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于redis的多资源分布式公平锁的设计与实践]]></title>    <link>https://juejin.cn/post/7576955345379115071</link>    <guid>https://juejin.cn/post/7576955345379115071</guid>    <pubDate>2025-11-27T06:50:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576955345379115071" data-draft-id="7576955345379098687" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于redis的多资源分布式公平锁的设计与实践"/> <meta itemprop="keywords" content="后端,Redis"/> <meta itemprop="datePublished" content="2025-11-27T06:50:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="海尔智慧家技术平台"/> <meta itemprop="url" content="https://juejin.cn/user/3848721122725016"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于redis的多资源分布式公平锁的设计与实践
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/7156434854350389283/posts" data-v-d326b38e=""><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4176c1a2e0b4e1b986f105126840cc9~tplv-k3u1fbpfcp-watermark.image?" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/7156434854350389283/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="三翼鸟数字化技术团队" class="title" data-v-d326b38e="">三翼鸟数字化技术团队</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-11-27T06:50:34.000Z" title="Thu Nov 27 2025 06:50:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-11-27
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                阅读8分钟
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        关注
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              @海尔优家智能科技（北京）有限公司
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"> 1.背景</h2>
<p>在分布式系统架构中，多节点并发访问共享资源是常见场景。当业务涉及多个关联资源的协同操作时（如订单系统中的商品与库存等），传统单资源锁无法满足业务需求，而多资源锁的实现又面临以下挑战：</p>
<ul>
<li>死锁风险：不同节点以不同顺序获取多个锁时易导致死锁</li>
<li>公平性问题：先到请求可能因资源获取顺序不公导致长时间等待</li>
<li>性能瓶颈：分布式锁的获取与释放涉及网络通信，需优化重试机制</li>
</ul>
<h2 data-id="heading-1">2.核心问题</h2>
<h3 data-id="heading-2">2.1 典型业务场景</h3>
<p>以电商库存扣减为例：</p>
<ul>
<li>操作1：扣减商品库存（需锁定商品库存资源）</li>
<li>操作2：扣减仓库库存（需锁定仓库库存资源）</li>
<li>复合操作：同时扣减商品库存和仓库库存（需同时锁定商品库存和仓库库存资源）</li>
</ul>
<h3 data-id="heading-3">2.2 技术痛点</h3>
<ul>
<li>顺序敏感：若操作1先锁商品库存再锁仓库库存，操作2反之，可能形成循环等待</li>
<li>饥饿现象：后到的请求可能抢占先到的请求资源</li>
<li>原子性保障：多资源锁定需保证要么全部成功，要么全部失败</li>
</ul>
<h2 data-id="heading-4">3.问题分析</h2>
<h3 data-id="heading-5">3.1.现有方案对比</h3>



































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td><strong>方案类型</strong></td><td><strong>优点</strong></td><td><strong>缺点</strong></td></tr><tr><td>单资源锁</td><td>实现简单</td><td>无法处理多资源关联场景</td></tr><tr><td>顺序锁</td><td>避免死锁</td><td>需严格约定加锁顺序，灵活性差</td></tr><tr><td>RedLock算法</td><td>高可用</td><td>不保证公平性，时钟漂移问题</td></tr><tr><td>队列等待机制</td><td>天然公平</td><td>实现复杂，需处理超时和重试</td></tr></tbody></table>
<h3 data-id="heading-6">3.2.关键需求</h3>
<ul>
<li>公平性：保证先到请求优先获取资源</li>
<li>原子性：多资源锁定/释放的原子操作</li>
<li>灵活性：支持单/双资源混合锁定</li>
<li>容错性：超时自动释放避免死锁</li>
</ul>
<h2 data-id="heading-7">4.解决方案：多资源分布式顺序锁</h2>
<h3 data-id="heading-8">4.1.核心设计思想</h3>
<p>通过Redis实现基于等待队列的公平锁机制，结合Lua脚本保证原子性操作，主要包含：</p>
<ul>
<li>多Key设计：队列Key（维护请求顺序） + 锁Key（实际资源锁定）</li>
<li>多阶段验证：先确认队列头部位置，再执行原子加锁</li>
<li>多资源支持：通过统一资源标识处理多资源场景</li>
</ul>
<h3 data-id="heading-9">4.2.技术实现详解</h3>
<h4 data-id="heading-10">4.2.1 关键组件</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicResourceLock</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span>  RedisTemplate&lt;String, String&gt; redisTemplate;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">lockPrefix</span> <span class="hljs-operator">=</span> <span class="hljs-string">"mall:Lock:"</span>; <span class="hljs-comment">//锁前缀</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">queuePrefix</span> <span class="hljs-operator">=</span> <span class="hljs-string">"mall:Queue:"</span>; <span class="hljs-comment">//队列前缀</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">defaultTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>; <span class="hljs-comment">// 默认超时时间（秒）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">lockTTL</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">// 锁持有时间（秒）</span>
    
}
</code></pre>
<h4 data-id="heading-11">4.2.2核心流程</h4>
<p><strong>1.资源注册</strong></p>
<ul>
<li>将有效资源ID（r1,r2）统一处理为字符串列表</li>
<li>示例：<code>getValidResources("C123", "W456")</code> → ["<code>C123</code>", "<code>W456</code>"]</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">getValidResources</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> cId, <span class="hljs-built_in">String</span> wId</span>) {
    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; resources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-comment">// 添加原有的uocId和jshId资源</span>
    <span class="hljs-title class_">Arrays</span>.<span class="hljs-title function_">stream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{cId, wId})
            .<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Objects</span>::nonNull)
            .<span class="hljs-title function_">filter</span>(s -&gt; !s.<span class="hljs-title function_">isEmpty</span>())
            .<span class="hljs-title function_">forEach</span>(<span class="hljs-attr">resources</span>::add);
    <span class="hljs-keyword">return</span> resources;
}
</code></pre>
<p><strong>2.入队操作</strong></p>
<ul>
<li>使用Redis List的rightPush保证FIFO顺序</li>
<li>设置队列TTL防止死队列</li>
<li>设置lockId ****锁标识符，确保只有合法的持有者才能释放锁</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 尝试获取锁（自动处理单/双资源）
 * <span class="hljs-doctag">@param</span> r1 资源1（可为null）
 * <span class="hljs-doctag">@param</span> r2 资源2（可为null）
 * <span class="hljs-doctag">@return</span> 锁ID（失败返回null）
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">tryLock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> r1, <span class="hljs-built_in">String</span> r2</span>) {
    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; resources = <span class="hljs-title function_">getValidResources</span>(r1, r2);
    <span class="hljs-keyword">if</span> (resources.<span class="hljs-title function_">isEmpty</span>()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"至少需要一个有效资源ID"</span>);
    }

    <span class="hljs-title class_">String</span> lockId = <span class="hljs-variable constant_">UUID</span>.<span class="hljs-title function_">randomUUID</span>().<span class="hljs-title function_">toString</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">tryLock</span>(resources, lockId, defaultTimeout) ? lockId : <span class="hljs-literal">null</span>;
}



<span class="hljs-comment">/**
 * 获取锁
 * <span class="hljs-doctag">@param</span> resources 资源
 * <span class="hljs-doctag">@param</span> lockId 锁唯一标识
 * <span class="hljs-doctag">@param</span> timeout 是获取锁的最大等待时间
 * <span class="hljs-doctag">@return</span> 是否成功获取到锁
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">tryLock</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">String</span>&gt; resources, <span class="hljs-built_in">String</span> lockId, long timeout</span>) {
    long start = <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>();
    <span class="hljs-comment">// 1. 加入所有资源的等待队列</span>
    resources.<span class="hljs-title function_">forEach</span>(res -&gt; <span class="hljs-title function_">enqueue</span>(res, lockId));
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"已加入资源队列，资源：{}，锁ID：{}"</span>, resources, lockId);
    
    ....
    
}


<span class="hljs-comment">/**
 * 资源加入队列
 * <span class="hljs-doctag">@param</span> resource 资源
 * <span class="hljs-doctag">@param</span> lockId 锁唯一标识
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">enqueue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> resource, <span class="hljs-built_in">String</span> lockId</span>) {
    redisTemplate.<span class="hljs-title function_">opsForList</span>().<span class="hljs-title function_">rightPush</span>(queuePrefix + resource, lockId);
    redisTemplate.<span class="hljs-title function_">expire</span>(queuePrefix + resource, lockTTL, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">SECONDS</span>);
}
</code></pre>
<p><strong>3.原子加锁</strong></p>
<p>lua脚本分析</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- 检查所有资源队列的队首是否都是当前请求</span>
<span class="hljs-keyword">local</span> all_ready = <span class="hljs-number">1</span>
<span class="hljs-keyword">local</span> queue_key_count = #KEYS / <span class="hljs-number">2</span>  <span class="hljs-comment">-- 计算队列key的数量</span>

<span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, queue_key_count <span class="hljs-keyword">do</span>
   <span class="hljs-keyword">local</span> queue_key = KEYS[i]
   <span class="hljs-comment">-- 检查数据结构类型是否为list</span>
   <span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">'type'</span>, queue_key)[<span class="hljs-string">'ok'</span>] ~= <span class="hljs-string">'list'</span> <span class="hljs-keyword">then</span>
       <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>  <span class="hljs-comment">-- 数据结构错误</span>
   <span class="hljs-keyword">end</span>
   <span class="hljs-comment">-- 检查队首元素是否是当前lockId</span>
   <span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">'lindex'</span>, queue_key, <span class="hljs-number">0</span>) ~= ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span>
       all_ready = <span class="hljs-number">0</span>  <span class="hljs-comment">-- 不是队首，设置标志位</span>
       <span class="hljs-keyword">break</span>  <span class="hljs-comment">-- 跳出循环</span>
   <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- 如果所有队列的队首都是当前请求</span>
<span class="hljs-keyword">if</span> all_ready == <span class="hljs-number">1</span> <span class="hljs-keyword">then</span>
   <span class="hljs-comment">-- 遍历所有锁key（KEYS的后半部分）</span>
   <span class="hljs-keyword">for</span> i = queue_key_count + <span class="hljs-number">1</span>, #KEYS <span class="hljs-keyword">do</span>
       <span class="hljs-keyword">local</span> lock_key = KEYS[i]
       <span class="hljs-comment">-- 尝试设置锁（带过期时间和NX条件）</span>
       redis.call(<span class="hljs-string">'set'</span>, lock_key, ARGV[<span class="hljs-number">1</span>], <span class="hljs-string">'EX'</span>, ARGV[<span class="hljs-number">2</span>], <span class="hljs-string">'NX'</span>)
       <span class="hljs-comment">-- 验证锁是否设置成功</span>
       <span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">'get'</span>, lock_key) ~= ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span>
           <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>  <span class="hljs-comment">-- 获取锁失败</span>
       <span class="hljs-keyword">end</span>
   <span class="hljs-keyword">end</span>
   <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>  <span class="hljs-comment">-- 所有锁获取成功</span>
<span class="hljs-keyword">else</span>
   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>  <span class="hljs-comment">-- 不是所有队列的队首</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p><strong>获取锁</strong></p>
<ul>
<li>100ms间隔检查是否到达队列头部、是否能获取到锁</li>
<li>超时后自动清理残留请求</li>
</ul>
<pre><code class="hljs language-swift" lang="swift">
<span class="hljs-comment">//--------------- 核心实现 ---------------//</span>
<span class="hljs-comment">/**
 * 获取锁
 * @param resources 资源
 * @param lockId 锁唯一标识
 * @param timeout 是获取锁的最大等待时间
 * @return 是否成功获取到锁
 */</span>
<span class="hljs-keyword">private</span> boolean tryLock(<span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; resources, <span class="hljs-type">String</span> lockId, long timeout) {
    long start <span class="hljs-operator">=</span> <span class="hljs-type">System</span>.currentTimeMillis();
    <span class="hljs-comment">// 1. 加入所有资源的等待队列</span>
    resources.forEach(res -&gt; enqueue(res, lockId));
    log.info(<span class="hljs-string">"已加入资源队列，资源：{}，锁ID：{}"</span>, resources, lockId);
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">while</span> (<span class="hljs-type">System</span>.currentTimeMillis() <span class="hljs-operator">-</span> start <span class="hljs-operator">&lt;</span> timeout <span class="hljs-operator">*</span> <span class="hljs-number">1000</span>) {
            <span class="hljs-comment">// 2. 检查是否在所有资源队列头部</span>
            <span class="hljs-keyword">if</span> (checkAndLock(resources, lockId)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-type">TimeUnit</span>.<span class="hljs-type">MILLISECONDS</span>.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// 轮询间隔</span>
        }
    } <span class="hljs-keyword">catch</span> (<span class="hljs-type">InterruptedException</span> e) {
        <span class="hljs-type">Thread</span>.currentThread().interrupt();
    } finally {
        <span class="hljs-comment">// 3. 超时后清理队列</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-operator">!</span>isLockAcquired(resources, lockId)) {
            resources.forEach(res -&gt; removeFromQueue(res, lockId));
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}


<span class="hljs-comment">/**
 * 检查是否达到队列头部并获取锁
 * @param resources 资源
 * @param lockId 锁唯一标识
 * @return 是否成功获取到锁
 */</span>
<span class="hljs-keyword">private</span> boolean checkAndLock(<span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; resources, <span class="hljs-type">String</span> lockId) {
    <span class="hljs-type">String</span> luaScript <span class="hljs-operator">=</span>
            <span class="hljs-string">"local all_ready = 1<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"local queue_key_count = #KEYS / 2<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"for i = 1, queue_key_count do<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   local queue_key = KEYS[i]<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   if redis.call('type', queue_key)['ok'] ~= 'list' then<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       return -1<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   end<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   if redis.call('lindex', queue_key, 0) ~= ARGV[1] then<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       all_ready = 0<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       break<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   end<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"end<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"if all_ready == 1 then<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   for i = queue_key_count + 1, #KEYS do<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       local lock_key = KEYS[i]<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       redis.call('set', lock_key, ARGV[1], 'EX', ARGV[2], 'NX')<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       if redis.call('get', lock_key) ~= ARGV[1] then<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"           return 0<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"       end<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   end<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   return 1<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"else<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"   return 0<span class="hljs-subst">\n</span>"</span> <span class="hljs-operator">+</span>
                    <span class="hljs-string">"end"</span>;

    <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; keys <span class="hljs-operator">=</span> new <span class="hljs-type">ArrayList</span>&lt;&gt;();

    <span class="hljs-comment">// 队列Key</span>
    resources.forEach(res -&gt; keys.add(queuePrefix <span class="hljs-operator">+</span> res));

    <span class="hljs-comment">// 锁Key</span>
    resources.forEach(res -&gt; keys.add(lockPrefix <span class="hljs-operator">+</span> res));

    <span class="hljs-type">DefaultRedisScript</span>&lt;<span class="hljs-type">Long</span>&gt; script <span class="hljs-operator">=</span> new <span class="hljs-type">DefaultRedisScript</span>&lt;&gt;(luaScript, <span class="hljs-type">Long</span>.class);
    log.info(<span class="hljs-string">"尝试获取锁，keys:{},lockId:{}"</span>,keys,lockId);
    <span class="hljs-type">Long</span> result <span class="hljs-operator">=</span> redisTemplate.execute(script, keys, lockId, lockTTL);
    log.info(<span class="hljs-string">"获取锁结果：{},keys:{},lockId:{}"</span>,result <span class="hljs-operator">==</span> 1L,keys,lockId);
    <span class="hljs-keyword">return</span>  result <span class="hljs-operator">==</span> 1L;
}



<span class="hljs-comment">/**
 * 该组资源是否被lockId持有
 * @param resources 资源
 * @param lockId 锁唯一标识
 * @return true:全部被lockId持有  false：不被lockId持有
 */</span>
<span class="hljs-keyword">private</span> boolean isLockAcquired(<span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; resources, <span class="hljs-type">String</span> lockId) {
    <span class="hljs-keyword">return</span> resources.stream()
            .allMatch(res -&gt; lockId.equals(
                    redisTemplate.opsForValue().get(lockPrefix <span class="hljs-operator">+</span> res)
            ));
}
</code></pre>
<ul>
<li>
<p>参数说明：</p>
<ul>
<li>KEYS[1..n]：队列Key列表</li>
<li>KEYS[n+1..2n]：对应锁Key列表</li>
<li>ARGV[1]：lockId</li>
<li>ARGV[2]：TTL</li>
</ul>
</li>
</ul>
<p><strong>4.解锁流程</strong></p>
<ul>
<li>验证锁归属后同时删除锁和出队</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 释放锁、资源出队列
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">unlock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> r1, <span class="hljs-built_in">String</span> r2, <span class="hljs-built_in">String</span> lockId</span>) {
    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; resources = <span class="hljs-title function_">getValidResources</span>(r1, r2);
    resources.<span class="hljs-title function_">forEach</span>(res -&gt; <span class="hljs-title function_">releaseLock</span>(res, lockId));
    resources.<span class="hljs-title function_">forEach</span>(res -&gt; <span class="hljs-title function_">removeFromQueue</span>(res, lockId));
}


<span class="hljs-comment">/**
 * 释放锁
 * <span class="hljs-doctag">@param</span> resource 资源
 * <span class="hljs-doctag">@param</span> lockId 锁唯一标识
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">releaseLock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> resource, <span class="hljs-built_in">String</span> lockId</span>) {
    <span class="hljs-title class_">String</span> luaScript =
            <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then\n"</span> +
                    <span class="hljs-string">"   redis.call('del', KEYS[1])\n"</span> +
                    <span class="hljs-string">"   redis.call('lpop', KEYS[2])\n"</span> +
                    <span class="hljs-string">"   return 1\n"</span> +
                    <span class="hljs-string">"else\n"</span> +
                    <span class="hljs-string">"   return 0\n"</span> +
                    <span class="hljs-string">"end"</span>;

    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; keys = <span class="hljs-title class_">Arrays</span>.<span class="hljs-title function_">asList</span>(
            lockPrefix + resource,
            queuePrefix + resource
    );

    redisTemplate.<span class="hljs-title function_">execute</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;(luaScript, <span class="hljs-title class_">Long</span>.<span class="hljs-property">class</span>),
            keys,
            lockId
    );
}


<span class="hljs-comment">/**
 * 移除队列资源
 * <span class="hljs-doctag">@param</span> resource 资源
 * <span class="hljs-doctag">@param</span> lockId 锁唯一标识
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">removeFromQueue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> resource, <span class="hljs-built_in">String</span> lockId</span>) {
    redisTemplate.<span class="hljs-title function_">opsForList</span>().<span class="hljs-title function_">remove</span>(queuePrefix + resource, <span class="hljs-number">0</span>, lockId);
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"清理资源队列：{},lockId:{}"</span>,resource,lockId);
}
</code></pre>
<h4 data-id="heading-12">4.2.3 示例</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MallServiceImpl</span>  {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">DynamicResourceLock</span> lockUtil;
    
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Boolean</span> <span class="hljs-title function_">deductInventory</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> productId, <span class="hljs-built_in">String</span> warehouseId, int quantity</span>) {
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"库存扣减开始"</span>);
        <span class="hljs-title class_">String</span> requestId = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            requestId = lockUtil.<span class="hljs-title function_">tryLock</span>(productId, warehouseId);
            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isNotEmpty</span>(requestId)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BizException</span>(<span class="hljs-title class_">DefaultErrorCode</span>.<span class="hljs-property">EXECUTE_FAIL</span>,<span class="hljs-string">"库存扣减获取锁失败，请重试"</span>);
            }
          
           log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"deductInventory-,库存扣减获取锁成功"</span>);
            <span class="hljs-comment">// 执行业务操作</span>
            ...
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>;
        }  <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isNotEmpty</span>(requestId)) {
                lockUtil.<span class="hljs-title function_">unlock</span>(productId, warehouseId,requestId);
                log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"deductInventory-库存扣减释放锁成功"</span>);
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>;
    }
}
</code></pre>
<h3 data-id="heading-13">4.3技术亮点</h3>
<h4 data-id="heading-14">4.3.1公平性保障</h4>
<ul>
<li>通过Redis List的FIFO特性实现天然排队</li>
<li>只有队列头部请求可获取锁</li>
</ul>
<h4 data-id="heading-15">4.3.2原子性操作</h4>
<ul>
<li>使用Lua脚本将多个Redis命令打包为原子操作</li>
<li>避免竞态条件</li>
</ul>
<h4 data-id="heading-16">4.3.3多资源支持</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">lock</span>.tryLock(<span class="hljs-string">"C123"</span>, <span class="hljs-string">"W456"</span>);
</code></pre>
<h4 data-id="heading-17">4.3.4容错设计</h4>
<ul>
<li>超时自动释放机制</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">tryLock</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">String</span>&gt; resources, <span class="hljs-built_in">String</span> lockId, long timeout</span>) {
    long start = <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>();
    <span class="hljs-comment">// 1. 加入所有资源的等待队列</span>
    resources.<span class="hljs-title function_">forEach</span>(res -&gt; <span class="hljs-title function_">enqueue</span>(res, lockId));
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"已加入资源队列，资源：{}，锁ID：{}"</span>, resources, lockId);
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">while</span> (<span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>() - start &lt; timeout * <span class="hljs-number">1000</span>) {
            <span class="hljs-comment">// 2. 检查是否在所有资源队列头部</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkAndLock</span>(resources, lockId)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">MILLISECONDS</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">100</span>); <span class="hljs-comment">// 轮询间隔</span>
        }
    } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
        <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">interrupt</span>();
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 3. 超时后清理队列</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isLockAcquired</span>(resources, lockId)) {
            resources.<span class="hljs-title function_">forEach</span>(res -&gt; <span class="hljs-title function_">removeFromQueue</span>(res, lockId));
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isLockAcquired</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">String</span>&gt; resources, <span class="hljs-built_in">String</span> lockId</span>) {
    <span class="hljs-keyword">return</span> resources.<span class="hljs-title function_">stream</span>()
            .<span class="hljs-title function_">allMatch</span>(res -&gt; lockId.<span class="hljs-title function_">equals</span>(
                    redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(lockPrefix + res)
            ));
}
</code></pre>
<ul>
<li>锁TTL略大于业务操作时间</li>
</ul>
<h2 data-id="heading-18">5. 团队介绍</h2>
<p>「<strong>三翼鸟数字化技术平台-应用软件框架开发</strong>」主要负责设计工具的研发，包括营销设计工具、家电VR设计和展示、水电暖通前置设计能力，研发并沉淀素材库，构建家居家装素材库，集成户型库、全品类产品库、设计方案库、生产工艺模型，打造基于户型和风格的AI设计能力，快速生成算量和报价；同时研发了门店设计师中心和项目中心，包括设计师管理能力和项目经理管理能力。实现了场景全生命周期管理，同时为水，空气，厨房等产业提供商机管理工具，从而实现了以场景贯穿的B端C端全流程系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解分布式共识算法 Raft]]></title>    <link>https://juejin.cn/post/7576994308273750035</link>    <guid>https://juejin.cn/post/7576994308273750035</guid>    <pubDate>2025-11-27T06:41:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576994308273750035" data-draft-id="7577171133444407332" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解分布式共识算法 Raft"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-27T06:41:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解分布式共识算法 Raft
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:41:07.000Z" title="Thu Nov 27 2025 06:41:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“不可靠的网络”、“不稳定的时钟”和“节点的故障”都是在分布式系统中常见的问题，在文章开始前，我们先来看一下：如果在分布式系统中网络不可靠会发生什么样的问题。</p>
<p>有以下 3 个服务构成的分布式集群，并在 server_1 中发生写请求变更 A = 1，“正常情况下” server_1 将 A 值同步给 server_2 和 server_3，保证集群的数据一致性：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72ef24adcba943aaaccd990a108b64ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=c1zBqbb5Qu8GoHfSX6CFbZDgjqI%3D" alt="raft.png" loading="lazy"/></p>
<p>但是如果在数据变更时发生网络问题（延迟、断连和丢包等）便会出现以下情况：比如有两个写操作同时发生在 server_1 或 server_3 上，即便两个写操作有先后顺序，但可能由于网络延时导致各个服务中数据的不一致：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4927d1eff0d64b46893aebc585a4a263~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=FAOUIJGWGdF11eqV87Z5W11jVRw%3D" alt="raft2.png" loading="lazy"/></p>
<p>同样地情况，如果在 server_1 上发生三次写操作，在数据同步的过程中因为网络延时或网络丢包也可能会导致数据的不一致：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc47590acd0c4e13bc23863c33ae3012~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=Vy3Y40uwIsCvr6PVDBwpHaAJwzY%3D" alt="raft3.png" loading="lazy"/></p>
<p>那么为了避免以上这些集群间数据不一致的问题，便需要分布式共识算法来协调。分布式共识算法简单来说就是如何在多个服务器间对某一个值达成一致，并且当达成一致之后，无论之后这些机器间发生怎样的故障，这个值能保持不变。本篇文章我们便对 Raft 算法进行介绍。</p>
<h3 data-id="heading-0">理解 Raft 算法</h3>
<p>了解和学习过 Zookeeper 的同学可能听说过 Zab 算法，它用来保证 Zookeeper 中数据的 <strong>顺序一致性</strong>。Raft 也是一种分布式共识算法，它易于理解和实现，用于保证数据的 <strong>线性一致性</strong>，是最强一致性模型。</p>
<p>在遵循 Raft 算法的集群中，节点会有 3 种不同的角色。当集群在初始化时，每个节点的角色都是 Follower 跟随者，它们会等待来自 Leader 节点的心跳。因为此时并没有 Leader 节点，所以会等待心跳超时。等待超时的 Follower 节点会将角色转变为 Candidate 候选者，触发一次选举，触发选举时会标记 Term 任期变量，并将自己的一票投给自己，通知其他 Follower 节点发起投票。经过投票后，收到超过半数节点票数的 Candidate 节点会成为 Leader 领导者节点，其他节点为 Follower 跟随者节点，Leader 节点会不断地发送心跳给 Follower 节点来维持领导地位：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/274fc222277b481b8638036b23b3247e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=qBpByv5ZaL6%2BioiUDvxXQ6k6WJk%3D" alt="raft4.png" loading="lazy"/></p>
<p>如果每个节点每次在触发选举时都是同时超时，这样是不是导致不能完成一次选举，产生 <strong>“活锁”</strong> 问题？的确可能，不过活锁问题也很好解决：即节点超时时间在合理的范围内取随机值，这样由于它的随机性就不太可能再同时发起竞选了，这个时候其他节点便有足够的时间向其他节点索要选票。</p>
<h4 data-id="heading-1">写变更请求</h4>
<p>当发生写变更请求时，由 Leader 节点负责处理，即使是请求到 Follower 节点，也需要转发给 Leader 节点处理。当 Leader 节点接收到写请求时，它并不立即对这个请求进行处理，而是先将请求信息 <strong>按顺序追加到日志文件中（WAL: write-ahead-log）</strong> ，如图中标记的 log_index 表示追加到的最新一条日志的序号：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e25aeb79af6a474c8cc608b589f54d44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=2z0yHUkAG5qMrK%2FElbUdX0ODuDA%3D" alt="raft5.png" loading="lazy"/></p>
<p>在这个过程中，<strong>日志必须持久化存储</strong>。随后，Leader 节点通过 RPC 请求将日志同步到各个 Follower 节点，当超过半数节点成功将日志记录时，便认为同步成功。在这里可知 Raft 算法采用的是单主复制的模型，所以它也就会存在以下缺点：</p>
<ol>
<li>面对大量写请求负载时系统比较难扩展，因为系统只有一个主节点，写请求的性能瓶颈由单个节点决定</li>
<li>当主节点宕机时，从节点提升为主节点不是即时的，可能会造成一些停机时间</li>
</ol>
<p>随后，Leader 节点会更新最新同步日志的索引 commit_index 为 1，并通过心跳下发给各个 Follower 节点：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d117c20fda3e4489b545e3e5e3d29564~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=wHdsbKuMwEvEPqFnFFiiL2IHmbU%3D" alt="raft6.png" loading="lazy"/></p>
<p>在这个过程中可以发现 Follower 节点只是听从并响应 Leader 节点，没有任何主动性。现在，已经完成了日志在集群间的同步，但是请求对变量 A 的修改还没有被应用（Apply）。Apply 是在 Raft 算法中经常出现的一个名词，在多数与 Raft 算法相关的文章中经常会看到 “将已提交的日志条目应用到状态机” 等类似的表述。其实 “状态机” 理解起来并不复杂，通俗的理解是 <strong>业务逻辑的载体</strong> 或 <strong>业务逻辑的执行者</strong>，它的职责包括：</p>
<ol>
<li>接收来自日志文件中有序的命令</li>
<li>执行具体的业务逻辑，在本次写请求中，业务逻辑指的便是变更 A 的值</li>
<li>变更应用程序的状态</li>
<li>返回执行结果</li>
</ol>
<p>更加通俗的讲就是 <strong>让请求生效</strong>。将已经提交的日志应用到状态机是比较简单且自主的过程，各个服务实例会记录 apply_index 来标记应用索引，当 apply_index 小于 commit_index 时，那么证明日志文件中记录的请求信息还有部分没生效，所以需要按顺序应用，直到 apply_index = commit_index：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6c57c3e3ca0412f972fd8398b39ca75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=EitVlb7xVG7zMe73Pf%2Fbt90cgls%3D" alt="raft7.png" loading="lazy"/></p>
<p>在这个过程中，我一直在强调 <strong>“按顺序”</strong> ，不论是日志的追加还是日志的被应用都是按顺序来的，因此才能保证数据的线性一致性。</p>
<h4 data-id="heading-2">读请求</h4>
<p>Raft 集群处理读请求会保证读请求的线性一致性，所谓线性一致性读就是在 t1 的时间写入了一个值，那么在 t1 之后，读一定能读到这个值，不可能读到 t1 之前的值，在 Raft 算法中实现线性一致性读有以下两种方式：</p>
<h5 data-id="heading-3">ReadIndex Read</h5>
<p>在这种方式下，当 Leader 节点处理读请求时：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d886b67e1664b74912b09ef50d9131b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=LXi6G8oL5kX8R0CrENTqgBIqPcE%3D" alt="raft10.png" loading="lazy"/></p>
<ol>
<li>首先将 commit_index 记录到本地的 read_index 变量里</li>
<li>向其他节点发送一次 Heartbeat，确认自己仍然是 Leader 角色</li>
<li>Leader 节点等待自己的状态机执行，直到 apply_index 超过了 read_index，这样就能够安全的提供线性一致性读了</li>
<li>Leader 执行 read 请求，将结果返回</li>
</ol>
<p>在第三步中，保证 <code>apply_index &gt;= read_index</code> 是为了保证所有小于等于 <code>read_index</code> 的请求都已经生效。</p>
<p>如果是 Follower 节点处理读请求也和以上过程类似，当 Follower 节点收到读请求后，直接给 Leader 发送一个获取此时 read_index 的请求，Leader 节点仍然处理以上流程然后将 read_index 返回，此时 Follower 节点等到当前的状态机 apply_index 超过 read_index 后，就可以返回结果了。</p>
<h5 data-id="heading-4">Lease Read</h5>
<p>因为 ReadIndex Read 需要发送一次 Heartbeat 来确认 Leader 身份，存在 RPC 请求的开销，为了进一步优化，便可以采用租约（Lease）读。租约其实指的是 Leader 节点身份的过期约定时间，所以这种读请求只针对 Leader 节点，Follower 节点没有租约的概念，它通过以下公式计算：</p>
<p><code>lease_end = current_time() + election_timeout / clock_drift_bound</code></p>
<p>其中 election_timeout 为选举的超时时间，clock_drift_bound 表示时钟漂移，指的是在分布式系统中，两个或多个节点上的时钟以不同的速率运行，导致它们之间的时间差随时间不断累积和变化（也就是分布式系统中不稳定的时钟问题）。</p>
<p>举个简单的例子，假如选举过期时间是 10s，时钟漂移为 1.1，那么租约过期时间为：lease_end = current_time() + 10s / 1.1 ≈ current_time() + 9s，如果在处理读请求时，在租约时间内，则无需发送 Heartbeat 来明确 Leader 身份，直接等待 apply_index &gt;= commit_index 后返回请求结果。</p>
<hr/>
<p>在以上读写流程中，Raft 分布式共识算法能让每个节点对日志的值和顺序达成共识，每个节点都存储相同的日志副本，使整个系统中的每个节点都能有一致的状态和输出，使得这些节点看起来就像一个单独的，高可用的状态机。在上文中我们提到过 Zookeeper 使用的 Zab 共识算法保证的是顺序一致性，Raft 算法保证的是线性一致性，所以借着这个引子也来谈谈我对一致性的理解。</p>
<h4 data-id="heading-5">一致性</h4>
<p><strong>一致性</strong> 通常指的就是数据一致性，在分布式系统中的读写请求，表现得像在单机系统上一样，符合直觉和预期。一致性模型有很多种，在这里我们只谈以下常见的几种：</p>
<p><strong>线性一致性</strong> 是最强的一致性模型，也被称为强一致性，在 CAP 定理中的 C 表达的一致性含义便是线性一致性。这种一致性模型要求系统要像单一节点一样工作，并且所有操作是原子的，它有两个约束条件：</p>
<ol>
<li>顺序记录中的任何一次读必须读到最近一次写入的数据</li>
<li>顺序记录要跟全局时钟下的顺序保持一致</li>
</ol>
<p><strong>顺序一致性</strong> 要比线性一致性弱，它只要求 <strong>同一客户端或进程的操作在排序后保持先后顺序不变</strong>，但 <strong>不同客户端之间的先后顺序是可以任意改变的</strong>，顺序一致性与线性一致性的主要区别在于 <strong>没有全局时间的限制</strong>。比如在社交网络场景下，一个人通常不关注他看到的所有朋友的帖子的顺序，但是对于某个具体朋友，仍然以正确的顺序显示帖子的顺序。</p>
<p><strong>因果一致性</strong> 则是比 <strong>顺序一致性</strong> 更弱的一致性模型，因果一致性要求必须以相同的顺序看到因果相关的操作，而没有因果关系的并发操作可以被不同的进程以不同的顺序观察到。典型的例子就是社交网络中发帖和评论的关系：必须先有发帖才能对该帖子进行评论，所以发帖操作必须在评论操作之前。</p>
<p><strong>最终一致性</strong> 是常见的最弱的一致性模型，所谓最终表达的含义是“对于系统到达稳定状态并没有硬性要求”，即便这听起来很不靠谱，但是在业务中被应用的很多也很好，而且这种一致性模型能使系统的性能很高。</p>
<blockquote>
<p>CAP 定理：C 代表一致性，当客户端访问所有节点时，返回的都是同一份最新的数据；A 代表可用性，指每次请求都能获取到非错误的响应，但不保证获取的数据是最新的；P 代表分区容错性，节点之间由于网络分区而导致消息丢失的情况下，系统仍能正常运行。</p>
</blockquote>
<p>接下来我们再来谈谈脑裂问题：</p>
<h4 data-id="heading-6">脑裂问题</h4>
<p>当集群中发生网络通讯问题时，读、写请求只能在超过半数节点的集群内生效，<strong>过半数机制</strong> 在数学上保证不可能同时存在两个Leader：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a27055a414e34de49f3535ab5edc3ec7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=%2B0Ad4lhy3HDsuULhvxDt3rNEVzc%3D" alt="raft8.png" loading="lazy"/></p>
<p>除此之外还有以下机制来避免脑裂问题：</p>
<ol>
<li><strong>Term机制</strong>：时间上保证旧Leader会自动让位给新Leader</li>
<li><strong>主动stepDown</strong>：Leader无法联系到过半数节点时主动放弃领导权</li>
<li><strong>严格的投票规则</strong>：每个term每个节点只能投票给一个候选人</li>
</ol>
<p>当网络问题恢复时，Follower 节点能通过 Leader 节点的日志同步重新追回期间错过的数据。此外，一般采用 Raft 算法的集群在部署的时都是 <strong>“奇数个节点”</strong> ，而不是偶数个节点，这其实是数学的体现，性价比更高：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5d270d692d348a583b159e1155f515e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764830467&amp;x-signature=qBmGaB5xSdBKiP6MRSjseeMz8Bs%3D" alt="raft9.png" loading="lazy"/></p>
<p>如上图所示，虽然部署 4 个节点多出一个节点，但是和 3 节点集群相比，容错能力是相同的：只能容忍 1 个节点故障。在容错能力没有被提高的情况下又花费了更多的服务器成本和运维管理成本。</p>
<hr/>
<p>以上我们基本了解了 Raft 算法的内容，如果想使用 Raft 算法，对系统模型有以下要求：</p>
<ol>
<li>服务可能宕机、停止运行，但过段时间能够恢复，但不能存在 <strong>拜占庭故障</strong></li>
<li>消息可能丢失、延迟乱序或重复；可能有网络分区，并在一段时间之后恢复</li>
</ol>
<hr/>
<h3 data-id="heading-7">巨人的肩膀</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sofastack.tech%2Fprojects%2Fsofa-jraft%2Foverview%2F" target="_blank" title="https://www.sofastack.tech/projects/sofa-jraft/overview/" ref="nofollow noopener noreferrer">SOFAJRaft</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fraft.github.io%2F" target="_blank" title="https://raft.github.io/" ref="nofollow noopener noreferrer">The Raft Consensus Algorithm</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.pingcap.com%2Fblog%2Flease-read%2F" target="_blank" title="https://cn.pingcap.com/blog/lease-read/" ref="nofollow noopener noreferrer">TiKV 功能介绍 – Lease Read</a></li>
<li>《深入理解分布式系统》</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 应用容器化与部署]]></title>    <link>https://juejin.cn/post/7577189654487990322</link>    <guid>https://juejin.cn/post/7577189654487990322</guid>    <pubDate>2025-11-27T06:49:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577189654487990322" data-draft-id="7576978338754854962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 应用容器化与部署"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-27T06:49:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="信码由缰"/> <meta itemprop="url" content="https://juejin.cn/user/2110664941509214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 应用容器化与部署
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2110664941509214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    信码由缰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:49:33.000Z" title="Thu Nov 27 2025 06:49:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><em>如何开始打包、分发并将 Java 交付至生产环境</em></p>
<p><img src="https://cf-blog.icodebuddy.com/image/89/89-0.jpg" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>应用程序的容器化</strong> 提供了一种方法，可以将所有必需的应用程序资源——包括程序和配置文件、环境变量、网络设置等——组合到一个标准化、易于管理的包中。</p>
</blockquote>
<p>从单个容器镜像可以启动、运行、管理和终止多个功能相同的容器，确保从镜像创建点开始的一致性。容器可以在截然不同的操作平台上运行，从本地机器到全球可扩展的云环境，以及介于两者之间的一切。可以构建流水线，轻松地在它们之间过渡。</p>
<p>虽然应用程序容器化有许多好处，但许多都可以归结为一个词：<strong>一致性</strong>。</p>
<h2 data-id="heading-0">为何要对 JAVA 应用进行容器化？</h2>
<p>Java 早期的一个承诺是"一次编写，到处运行"，即"WORA"。尽管 Java 通过其 Java 虚拟机（JVM）实现了某种形式的目标，但在实现真正无缝的体验方面仍然存在相当多的外部障碍。</p>
<p>容器化解决了几乎所有这些外部障碍。虽然 100% 在任何追求中都可能是一个难以实现的目标，但将 Java 应用程序的可执行文件及其所有必需的依赖项和支持属性（配置等）打包的能力，使我们达到了有效的 100% 可移植性和一致性水平。</p>
<h2 data-id="heading-1">为 JAVA 应用程序创建 DOCKERFILE</h2>
<p>许多开发人员通过仔细阅读官方的 Dockerfile 参考文档来开始他们的容器化工作。为了立即获得良好效果，让我们介绍关键点，创建一些镜像，并在此基础上进行构建。</p>
<h3 data-id="heading-2">为容器化选择操作系统和 JDK 构建</h3>
<p>对此有各种不同的观点，但如果您刚开始接触容器化，从一个较小但完整的操作系统（OS）开始是一个很好的第一步。我们稍后将讨论其他选项（例如，无发行版）。</p>
<p>一般来说，您在操作系统层包含的内容越多，容器镜像就越大，安全漏洞的攻击面也就越大。可信来源也是一个关键的考虑因素。如果使用完整的操作系统构建，强烈推荐使用 eclipse-temurin（基于 Ubuntu）或 Alpine 基础层。</p>
<p>任何 OpenJDK 的构建都能运行您基于 JVM 的 Java 应用程序，而 Eclipse Temurin 是众多良好选项之一。但是，如果您希望对可能发现的任何 Java 问题获得专门的生产支持，那么选择商业支持的构建可以提供这种支持。</p>
<p><img src="https://cf-blog.icodebuddy.com/image/89/89-1.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">JAVA 应用的基本 DOCKERFILE 结构</h3>
<p>一个基本 Java 应用程序的最低可行 Dockerfile 看起来像这样：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
FROM eclipse-temurin:latest

COPY java-in-the-can-0.0.1-SNAPSHOT.jar /app.jar

EXPOSE 8080

CMD ["java", "-jar", "/app.jar"]

</code></pre>
<p>将上述文本（在 <code>COPY</code> 指令中使用您应用程序的名称）保存在一个名为 <code>Dockerfile</code> 的文件中，该文件与您的 Java 应用程序（<code>.jar</code>）文件位于同一目录。</p>
<p>在上面的 Dockerfile 中，我们提供了构建容器镜像的基本信息：</p>
<ul>
<li>
<p>构建应用程序容器镜像所基于的更高层<strong>基础镜像</strong>（<code>FROM</code>）</p>
</li>
<li>
<p>将 .jar 文件<strong>复制</strong>（<code>COPY</code>）到镜像中（在此示例中，还进行了重命名）的命令</p>
</li>
<li>
<p>为应用程序监听连接请求而需要<strong>暴露</strong>（<code>EXPOSE</code>）的任何特定端口（如有必要）</p>
</li>
<li>
<p>在容器启动时运行应用程序的<strong>命令</strong>（<code>CMD</code>）</p>
</li>
</ul>
<p>在包含您的 Dockerfile 和 .jar 文件的目录中执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">
docker build -t &lt;app-image-name&gt; .

</code></pre>
<p>请注意，在运行镜像创建和其他容器命令之前，docker 守护进程（或 Mac/Windows 上的 Docker Desktop、Podman 等）必须正在运行。另外，不要忘记命令末尾的 <code>.</code>；它指的是可以找到 Dockerfile 的当前目录。</p>
<p>以这种方式运行生成的应用程序容器，用您上面创建的容器镜像名称替换 <code>&lt;app-image-name&gt;</code>：</p>
<pre><code class="hljs language-bash" lang="bash">
docker run -p 8080:8080 &lt;app-image-name&gt;

</code></pre>
<h3 data-id="heading-4">选择无发行版操作系统+JDK 基础镜像</h3>
<p>对于大多数用例，在大小和攻击面方面可实现的最佳优化可能由"无发行版"基础镜像提供。虽然无发行版基础镜像中确实包含一个 Linux 发行版，但它已被剥离了任何非当前目的 specifically 不需要的文件，留下一个完全精简的操作系统，对于无发行版 Java 镜像而言，还包括 JVM。以下是一个使用无发行版 Java 基础镜像的 Dockerfile 示例：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
FROM mcr.microsoft.com/openjdk/jdk:21-distroless

COPY java-in-the-can-0.0.1-SNAPSHOT.jar /app.jar

EXPOSE 8080

CMD ["-Xmx256m", "-jar", "/app.jar"]

</code></pre>
<p>请注意，这个针对 Java 优化的基础镜像预先配置了 <code>java</code> 命令的 <strong>ENTRYPOINT</strong>，因此 <strong>CMD</strong> 指令用于为 JVM 启动器进程提供命令行参数。</p>
<h3 data-id="heading-5">使用多阶段构建来减小镜像大小</h3>
<p>如果您有构建所需但最终输出不需要的文件，多阶段构建提供了减小容器镜像大小的方法。就本文参考而言，情况并非如此，因为 JVM 以及应用程序的 <code>.jar</code> 文件和依赖项已为镜像创建预先配置好了。</p>
<p>正如您可能想象的那样，在某些非常常见的情况下，这变得有利。通常，应用程序通过配置好的构建流水线部署到生产环境，这些流水线基于源仓库上的触发器来创建构件。这是多阶段构建的最佳用例之一：构建流水线创建一个带有适当工具的构建容器，使用它来创建构件（例如 <code>.jar</code> 文件、配置文件），然后将这些构件复制到一个新的容器镜像中，该镜像不包含生产环境不需要的额外工具。这一系列操作大致类似于我们之前手动完成的操作，但实现了自动化，以获得一致和最优的结果。</p>
<h3 data-id="heading-6">管理环境变量</h3>
<p>有多种方法可以向容器和应用程序提供输入值，用于启动或执行。一个应该采用的良好实践是，尽可能使用 <strong>ENV</strong>、<strong>ENTRYPOINT</strong> 或 <strong>CMD</strong> 指令在 Dockerfile 本身中指定所有可能的值。所有这些值都可以在容器初始化时根据需要覆盖。</p>
<p>请注意，覆盖现有环境变量时应谨慎，因为这可能会以意外和不良的方式改变应用程序行为。</p>
<p>使用 <code>ENV</code> 配置 Java 特定选项的示例：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
ENV JAVA_OPTS="-Xmx512m -Xms256m"

</code></pre>
<p>相同的概念也适用于应用程序特定变量：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
ENV APP_GREETING="Greetings, Friend!"

</code></pre>
<p>使用 ENTRYPOINT 配置应用程序特定值的示例：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
ENTRYPOINT ["java", "$JAVA_OPTS", "-jar", "your-app.jar"]

</code></pre>
<p>使用 CMD 的示例：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
CMD ["java", "-Xmx256m", "-jar", "/app.jar"]

</code></pre>
<p>您可能已经注意到，<strong>ENTRYPOINT</strong> 和 <strong>CMD</strong> 都可以用来执行 Java 应用程序。像所有其他技术（和非技术）选项一样，这两种指令各有优缺点。如果操作得当，两者都会使您的 Java 应用程序运行。</p>
<p>一般来说，Java 应用程序使用 <strong>CMD</strong> 指令，以便应用程序可以处理操作系统信号，用于支持的钩子机制（例如，<code>SIGTERM</code> 对应 <code>java.lang.Runtime.addShutdownHook</code>）。当然，这并非绝对必要，并且可以（也经常）使用 <strong>ENTRYPOINT</strong> 和 <strong>CMD</strong> 来促进运行时参数传递，以提供/覆盖特定行为。这两者并不互斥。</p>
<h2 data-id="heading-7">使用 SPRING BOOT 插件进行容器化</h2>
<p>如果您使用 Spring Boot 开发 Java 应用程序，容器化会简单得多。无论使用 Maven 还是 Gradle 作为项目构建工具，创建容器镜像都像执行一个预定义的目标一样简单。</p>
<ul>
<li>如果使用 <strong>Maven</strong> 作为构建工具，您可以通过调用 <code>build-image</code> 目标来创建包含应用程序的容器镜像：</li>
</ul>
<p><code>./mvnw spring-boot:build-image</code></p>
<ul>
<li>如果使用 <strong>Gradle</strong> 作为构建工具，您可以通过调用 <code>bootBuildImage</code> 目标来创建包含应用程序的容器镜像：</li>
</ul>
<p><code>./gradlew bootBuildImage</code></p>
<p>在大多数情况下，自定义镜像创建（例如，镜像层定义）既不必要也不可取，但如果需要这样做，请参阅 Spring Boot Maven 或 Gradle 插件文档中的"打包 OCI 镜像"部分。</p>
<h2 data-id="heading-8">为原生应用程序构建容器镜像</h2>
<p>开发人员可以选择使用 JVM 或作为原生的、操作系统特定的可执行文件来交付 Java 应用程序。以下部分提供了一些关于选择的考虑因素，以及如果您决定使用原生应用程序构建容器镜像，如何以最小的代价实现。</p>
<h3 data-id="heading-9">使用 GRAALVM 的 JAVA 原生可执行文件</h3>
<p>GraalVM 支持创建原生可执行文件/二进制 Java 应用程序，在构建时执行所有编译和优化，而不是利用 JVM 在运行应用程序字节码时进行一些优化。</p>
<p>与所有选择一样，需要权衡利弊。编译为字节码与原生可执行文件是秒与分钟的问题，并且 JVM 执行的运行时优化在原生可执行文件中消失了，因为代码无法在运行时动态重写（这是 JVM 启用的一个特性）。</p>
<p>原生可执行文件优于基于 JVM 的 Java 应用程序的地方在于文件大小、内存需求和启动时间。原生应用程序要小得多，需要的资源更少，不需要 JVM 存在，并且启动速度显著更快。这在许多生产环境中是非常重要的考虑因素，因为较小的应用程序（及其容器）会降低平台资源需求，并且以毫秒而不是几秒衡量的启动时间可以增加可用性、可扩展性以及系统设计和部署的选项，从而可以显著节省成本。</p>
<p>根据您的框架和工具选择，有几种构建完全可执行的、操作系统原生的 Java 应用程序的选项。然而，一旦您有了原生可执行文件/二进制应用程序，您可以创建一个类似以下的 Dockerfile 作为您的原生应用程序容器镜像的模板：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">
FROM alpine:latest

WORKDIR /app

COPY java-in-the-can /app/

EXPOSE 8080

CMD ["/app/java-in-the-can"]

</code></pre>
<p>如果您使用 Spring Boot，您可以使用 GraalVM Maven 或 Gradle 插件，通过一条命令将您的应用程序编译为操作系统原生应用程序并创建容器镜像。</p>
<p><strong>MAVEN</strong></p>
<p>首先，将此依赖项添加到您的 <code>pom.xml</code> 的 <code>&lt;build&gt;&lt;plugins&gt;</code> 部分并保存文件：</p>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>

</code></pre>
<p>要构建原生应用程序和容器镜像，从您的项目根目录运行此命令：</p>
<p><code>./mvnw -Pnative spring-boot:build-image</code></p>
<p><strong>GRADLE</strong></p>
<p>类似地，将此依赖项添加到您的 <code>build.gradle</code> 文件的 <code>plugins {}</code> 部分并保存：</p>
<p><code>id 'org.graalvm.buildtools.native'</code></p>
<p>要构建原生应用程序和容器镜像，从您的项目根目录运行此命令：</p>
<p><code>./gradlew bootBuildImage</code></p>
<h2 data-id="heading-10">关于减小镜像大小和加快启动时间的考虑因素</h2>
<p>您可能已经注意到，上述各节的顺序总体上趋向于生产更精简、启动更快的容器镜像。许多决策可能涉及组织标准或选择（例如，部署标准），这些标准或选择会使天平倾向于或反对某些选择，但一般来说，容器镜像优化的路径遵循以下顺序：</p>
<ol>
<li>
<p>选择更小的基础镜像（操作系统发行版和 JVM）</p>
</li>
<li>
<p>选择带有 JVM 的无发行版镜像</p>
</li>
<li>
<p>如果您的工具链（例如 Spring Boot）允许，利用专门构建的工具</p>
</li>
<li>
<p>利用带有原生可执行应用程序的精简发行版或无发行版镜像</p>
</li>
</ol>
<h2 data-id="heading-11">容器中 JAVA 应用程序的部署策略</h2>
<p>您的应用程序的重要考虑因素超出了将其打包成应用程序容器镜像的范围。接下来是部署和维护决策，这些决策对于您的应用程序进入并保持在生产环境至关重要。</p>
<h3 data-id="heading-12">单容器部署</h3>
<p>对于基本上是自包含的应用程序，部署到生产环境可以像单个命令一样简单，前提是部署目标已准备好接受容器化应用程序。即使在应用程序部署之前必须创建支持资源的情况下，这通常也意味着通过命令行或 Web 门户发出少量指令。当应用程序包含多个容器部署时，进程间依赖关系可能要求按特定顺序部署容器，以确保可用性或最小化波动或 chatter。为了实现这些目标，需要进行编排部署。</p>
<h3 data-id="heading-13">编排部署</h3>
<p>编排部署可能比单容器部署复杂得多，并相应地提供更多功能。由于这两个特点，与单容器部署相比，编排部署可能有更多平台层级值得考虑。这些层级范围从提供广泛灵活性并相应需要开发人员付出更高水平努力的较低层级 Kubernetes 平台，到完成大量繁重工作以安全配置和集成多个容器和/或服务的完整平台。</p>
<p>您选择的目标平台将决定您对部署工具（例如，脚本、门户、基础设施配置工具）的选择。非常笼统地说，您选择的平台目标应该是能够部署和维护您的应用程序及其相关服务的最简单的平台。其他重要的考虑因素包括应用程序所有必需容器/服务的部署目标之间的比较成本、您组织已建立的实践/流水线等。</p>
<h2 data-id="heading-14">构建支持持续打补丁的 JAVA 应用程序</h2>
<p>生产部署在应用程序上线后并未完成；开发人员必须确保应用程序保持安全、最新和可用。关键的补丁管理考虑因素包括：</p>
<ul>
<li>
<p><strong>定期补丁</strong> – 为常规补丁（例如，每月或每季度）建立一个无中断、可预测的频率，以更新库和依赖项</p>
</li>
<li>
<p><strong>紧急补丁</strong> – 提供关于何时需要紧急补丁的指导，通常是为了应对关键漏洞或紧急安全更新</p>
</li>
</ul>
<p>容器镜像中需要打补丁的组件包括：</p>
<ul>
<li>
<p>基础操作系统容器镜像</p>
</li>
<li>
<p>附加的操作系统包（如果适用）</p>
</li>
<li>
<p>应用程序运行时（例如，JVM 版本，如果未包含在基础镜像中）</p>
</li>
<li>
<p>应用程序依赖项/库</p>
</li>
<li>
<p>应用程序性能监控（APM）代理二进制文件</p>
</li>
</ul>
<p>由开发人员及其组织来决定并严格维护一个保护应用程序、系统基础设施和数据的补丁策略。请参考此指南来帮助制定您的具体策略。</p>
<h2 data-id="heading-15">结论</h2>
<p>容器化使开发人员能够将所有必需的应用程序资源和支持服务组合到一个或多个容器镜像中，并更轻松地部署、运行和管理它们。如果操作得当，容器化可以从镜像创建点开始实现安全性和一致性。容器可以在截然不同的操作平台上运行，从本地机器到全球可扩展的云环境。可以构建流水线，轻松地在它们之间过渡。因此，开发人员构建和运行支持生产工作负载的相同构件，减少了冲突并简化了调优和故障排除。</p>
<p>如果您是容器新手，请从小处着手，在本地构建以获得知识和稳定的基础，然后通过纳入更多容器最佳实践、构建流水线和合适的云平台来"扩展构建"，逐步走向强大的应用程序部署生产模型。</p>
<p><strong>其他考虑因素和资源：</strong></p>
<ul>
<li>
<p>工具 – <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.docker.com%2F" target="_blank" title="https://www.docker.com/" ref="nofollow noopener noreferrer">Docker</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpodman.io%2F" target="_blank" title="https://podman.io/" ref="nofollow noopener noreferrer">Podman</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fminikube.sigs.k8s.io%2F" target="_blank" title="https://minikube.sigs.k8s.io/" ref="nofollow noopener noreferrer">Minikube</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fskaffold.dev%2F" target="_blank" title="https://skaffold.dev/" ref="nofollow noopener noreferrer">Skaffold</a></p>
</li>
<li>
<p>基于 JVM OSS 的可观测性工具 – <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavacomponents%2Fjmc-5-4%2Fjfr-runtime-guide%2F" target="_blank" title="https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/" ref="nofollow noopener noreferrer">Java Flight Recorder</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fen%2Fjava%2Fjava-components%2Fjdk-mission-control%2F" target="_blank" title="https://docs.oracle.com/en/java/java-components/jdk-mission-control/" ref="nofollow noopener noreferrer">Java Mission Control</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fvisualvm.github.io%2F" target="_blank" title="https://visualvm.github.io/" ref="nofollow noopener noreferrer">Visual VM</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAdoptOpenJDK%2Fjitwatch" target="_blank" title="https://github.com/AdoptOpenJDK/jitwatch" ref="nofollow noopener noreferrer">Jitwatch</a></p>
</li>
</ul>
<blockquote>
<p><strong>作者：MARK A. HECKLER,</strong></p>
</blockquote>
<blockquote>
<p><strong>微软首席云技术推广专家（Java/JVM 语言）</strong></p>
</blockquote>
<blockquote>
<p>Mark Heckler 是一名软件开发人员，微软的 Java/JVM 语言首席云技术推广专家，会议演讲者，Java Champion 和 Kotlin 开发专家，专注于为云和边缘计算平台快速开发生产软件。Mark 是开源贡献者，也是《Spring Boot: Up and Running》的作者，可以在 X @mkheck 上找到他。</p>
</blockquote>
<hr/>
<p>【注】本文译自：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdzone.com%2Frefcardz%2Fjava-application-containerization-and-deployment" target="_blank" title="https://dzone.com/refcardz/java-application-containerization-and-deployment" ref="nofollow noopener noreferrer">Java Application Containerization and Deployment</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5 个 AI 操纵手机的 GitHub 项目，太强了]]></title>    <link>https://juejin.cn/post/7577031454585454619</link>    <guid>https://juejin.cn/post/7577031454585454619</guid>    <pubDate>2025-11-27T06:58:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577031454585454619" data-draft-id="7576936862632509440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5 个 AI 操纵手机的 GitHub 项目，太强了"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-27T06:58:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5 个 AI 操纵手机的 GitHub 项目，太强了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T06:58:32.000Z" title="Thu Nov 27 2025 06:58:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在过去，如果我们想自动化操作手机，通常需要使用 Appium 或 Airtest 这样的工具，但这要求开发者必须深入了解 APP 的底层元素 ID，比如 resource-id 或 xpath。</p>
<p>一旦 APP 更新，ID 变了，脚本就废了。</p>
<p>现在有了 AI 大模型，尤其是视觉模型，让 AI 操纵手机做成了可能。推荐几个比较热门的 AI 操纵手机的开源项目，感兴趣的收藏。</p>
<h2 data-id="heading-0">01、MobiAgent：移动智能体框架</h2>
<p>这个叫 MobiAgent 的开源项目是 IPADS 实验室专为手机交互设计的框架。能让 AI 控制手机自己干活。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79552d1aea864c44b3c4ab8ca1b77938~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=3Z6k9I1U7qgCnZo%2BZujuWtHVjuA%3D" alt="图片" loading="lazy"/></p>
<p>这个智能 Agent 系统，可以把复杂任务分解为三个专业化模块：</p>
<p>Planner 负责制定整体计划，Decider 判断每一步该点击哪里，Grounder 则精准定位屏幕上的具体操作位置。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bf0018ece224af3935f4da5dd751260~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=ySMiEp6LvVzwbeBW2LyRfC4hyTY%3D" alt="图片" loading="lazy"/></p>
<p>从原理上讲，MobiAgent 包括三个核心组件：MobiMind 模型家族、AgentRR 加速框架和 MobiFlow 基准测试平台。</p>
<p>MobiMind 是智能核心，包含多个不同参数规模的模型。AgentRR 加速框架则对重复任务进行优化，大幅降低二次执行的耗时。</p>
<p>而 MobiFlow 基准测试平台，覆盖小红书、高德地图、饿了么、淘宝等 10 + 主流 App，包含简单和困难两个难度等级，为移动智能代理的性能评估提供了标准化场景。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/IPADS-SAI/MobiAgent</span>
</code></pre>
<h2 data-id="heading-1">02、Mobile-Agent：阿里开源</h2>
<p>这个叫 <strong>Mobile-Agent 的</strong>开源项目是阿里开源的。<strong>Mobile-Agent</strong> 能看见屏幕、能点击按钮、能像人一样跨 APP 操作，而且不依赖原本复杂的系统后台接口，而是像人类一样，通过看屏幕来操作手机。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d186c804a9354ba5bdfb8f2dff116678~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=eroY6p2XV8m0lutGGNQbu1LvGcQ%3D" alt="图片" loading="lazy"/></p>
<p>原理都差不多， AI 识别屏幕上的所有图标、文字和按钮。即使按钮没有文字说明，只有一个图标，它也能通过视觉理解其含义。</p>
<p>根据你的指令生成一步步的计划。然后 AI 结合当前屏幕状态，决定下一步具体点哪里，还是滑动，或者是输入文字。</p>
<p>通过 ADB（Android Debug Bridge）向手机发送点击或滑动指令。而且每执行一步，它会再次截图确认，如果发现不对，它会自我修正。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/X-PLUG/MobileAgent</span>
</code></pre>
<h2 data-id="heading-2">03、Droidrun机自动化 Agent 框架</h2>
<p>Droidrun 是一个基于 AI 大模型的 Android/iOS 自动化 Agent 框架。</p>
<p>目前在 GitHub 上有 6.2K 的 Star。</p>
<p>它的核心理念是将思考交给 AI，将执行交给框架，从而打破了传统自动化脚本对特定 UI 控件的强依赖。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c21ac6223bf74939abbda4cc862eba33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=HG4VPmiFDMh2c4qEY4XCNcVpwAw%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/droidrun/droidrun</span>
</code></pre>
<h2 data-id="heading-3">04、AppAgent：腾讯开源</h2>
<p>这个开源项目的全称是 "Multimodal Agents as Smartphone Users"，像智能手机用户一样的多模态智能体。</p>
<p>它的设计初衷是赋予 AI  Agent 像人类用户一样的感知和操作能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df0e5718931b4ecc8a5215f63dd81320~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=%2FQWxhp3%2FpRSTPBNsNPKC3bogLRU%3D" alt="图片" loading="lazy"/></p>
<p>它通过 ADB（Android Debug Bridge）获取手机屏幕截图，发送给多模态大模型。</p>
<p>模型分析截图中的 UI 元素，决定下一步是点击哪个坐标还是滑动屏幕，从而实现真正的视觉交互。</p>
<p>和其它开源项目不同，AppAgent 模仿了人类学习新软件的过程：</p>
<p>当你给它一个新的 App 时，它可以通过自主探索或者观察人类演示来学习。</p>
<p>在这个过程中，它会记录下每个按钮是干什么的，并生成一份使用文档（Knowledge Base）。</p>
<p>当需要执行具体任务，它会调用之前生成的文档，精准地执行操作，而不需要每次都重新摸索。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/TencentQQGYLab/AppAgent</span>
</code></pre>
<h2 data-id="heading-4">05、mobile-use：说句话自动化你的手机</h2>
<p>这个开源项目现在有 1.8k 的 Star。支持安卓和 iOS 系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47268cab0c4f4c5987db78a37eedd928~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764831512&amp;x-signature=OEFgGp%2BYgsVPvs6Qg34QAlOJfcg%3D" alt="图片" loading="lazy"/></p>
<p><strong>Mobile-Use</strong> 是一个由 Minitap AI 团队开源的 Python 库。它的核心逻辑是让 AI 模型模拟人类的操作行为。</p>
<p>它会截取当前手机屏幕的图像，将截图和用户的指令发送给多模态大模型。模型会分析截图，判断如果要完成这个任务，我现在该点哪里。</p>
<p>模型返回具体的坐标或操作指令（点击、滑动、输入），Mobile-Use 将其转换为底层的 ADB 命令执行。</p>
<p>执行完动作后，再次截图，确认是否进入了下一页，直到任务完成。</p>
<pre><code class="hljs language-perl" lang="perl">开源地址：https:<span class="hljs-regexp">//gi</span>thub.com/minitap-ai/mobile-<span class="hljs-keyword">use</span>
</code></pre>
<p>而且在技术实现上，mobile-use 集成了 Maestro 移动测试框架作为底层交互引擎，确保了对真实设备操作的稳定性和可靠性。同时，项目支持多种大模型后端，用户可以根据需要选择 OpenAI API、本地部署模型或其他兼容服务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[小需求做到千万美元 ARR：remove.bg 全案拆解]]></title>    <link>https://juejin.cn/post/7576918517238349874</link>    <guid>https://juejin.cn/post/7576918517238349874</guid>    <pubDate>2025-11-27T05:17:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576918517238349874" data-draft-id="7576929700842160137" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="小需求做到千万美元 ARR：remove.bg 全案拆解"/> <meta itemprop="keywords" content="产品,AI编程"/> <meta itemprop="datePublished" content="2025-11-27T05:17:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            小需求做到千万美元 ARR：remove.bg 全案拆解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:17:48.000Z" title="Thu Nov 27 2025 05:17:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p>今天开始，我将带领大家一起分析商业、分析产品。</p>
<p>这是商业洞察系列的第一篇。</p>
<p>为什么要开启这个系列呢？</p>
<p>在出海复盘中我写道，我们团队的优势在效率，劣势在市场。</p>
<p>我认为初创企业，需要关注的重点就是市场+效率，这两个做好了，就成功了一半。</p>
<p>因此，从现在开始，我自己会投入 50%的精力在市场研究、商业洞察这里，希望带头弥补这块的短板。</p>
<p>今天跟大家分享的这款产品是 remove.bg，这也是 AI 榜单前 10 的产品。</p>
<p>这个产品我觉得很值得研究学习，因为它其实是一个很垂直的需求市场，但是以小博大，它赚的钱不少。</p>
<h2 data-id="heading-0">01 价值主张写进 TDH</h2>
<p>先分析一下这个站点整体的 SEO 和流量情况。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fce8dabb78bd4442a32d253e5290bcf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=QTMD3gYnmnYTIAB3ZWzSXpN7sXo%3D" alt="" loading="lazy"/></p>
<p>我觉得这个站点首先值得学习的是它的 TDH，让我们仔细观摩一下：</p>
<p>title: Remove Background from Image for Free – remove.bg</p>
<p>Description: Remove image backgrounds automatically in 5 seconds with just one click. Don't spend hours manually picking pixels. Upload your photo now &amp; see the magic.</p>
<p>H1: Remove Image Background</p>
<p>这个 TDH 好在哪呢？我觉得重要的是包含了价值主张。</p>
<p>价值主张是精益画布很重要的一环，做产品前，应该先想好价值主张是什么。</p>
<p>它的标题，首先描述的主功能 Remove Background，然后抛出了一个 Free 的钩子，增加 serp 吸引力。</p>
<p>这也是我们惯用的技巧了，我在优化 serp 展现的时候也经常会用这个手段。</p>
<p>Description 则详细地包含了它的价值主张：5 second with just one click。</p>
<p>很多人不重视这个，导致你的 serp 没有吸引力，用户看到都不会点击进去。</p>
<p>这个 TDH 就非常有吸引力，抓住了用户的痛点，这个团队一定是深入调研过用户需求的。</p>
<p>实际上我们仅仅通过这个 TDH 就已经可以分析出用户需求了：</p>
<p><strong>想要找一个免费的去除背景图的工具，快速处理图片。</strong></p>
<h2 data-id="heading-1">02 OpenGraph 让传播自带转化力</h2>
<p>除了 TDH 之外，我觉得这个站点在 SEO 还有一点值得我们学习的就是 OpenGraph：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0171539408f642ec9c68f72ed13ec4e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=0lrqMlED6MjCIisHTMgJ0sjSoWw%3D" alt="" loading="lazy"/></p>
<p>OpenGraph 我们会经常忽略，但在 Twitter 这样的媒体平台传播是一个非常关键的因素。</p>
<p>remove.bg 这张图是精心设计过的，有 before 和 after 对比，在社媒平台上你看到这张图，一眼就能明白这个产品的价值。</p>
<h2 data-id="heading-2">03 流量盘子：80M/月的搜索 + 直访</h2>
<p>聊完 SEO，我们看看站点的流量情况。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af831f8d7bb34b7bb735bc4316bb6640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=rYezQVFZKTHP%2BQ16x7NZFQqzKew%3D" alt="" loading="lazy"/></p>
<p>这个站点近 3 个月，每个月大概有将近八千万的访问，是一个流量极高的站点，流量来源基本上是搜索+直接访问。</p>
<p>为什么这个站点直接访问这么高呢？我觉得首先是这个域名注册得非常好。</p>
<p>这是一个用户需求关键词的域名，非常容易记忆，用户在使用过后，可能就直接记住域名，下次就直接过来了。</p>
<p>然后再看它的搜索关键词，remove bg 这个关键词，月搜索量总数在 400 万，而它把这个流量全吃了。</p>
<p>也就是说，它在这个关键词上处于绝对的领先地位，一点流量都没有去竞争对手那里。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdc94931e5544eea39b04696ee7b0a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=r%2Bs7pjDC3DLNxB2X72J%2FWLz7Cmo%3D" alt="" loading="lazy"/></p>
<p>从 SimilarWeb 上可以看到，它的品牌词占比 96%，而它的品牌词就是需求词，基本上在这个词上就是垄断了。</p>
<p>对于 background remover、remove background，也有基本上六七十的市场占有率。</p>
<p>它的流量大头国家可以看到是印度、巴西、美国等地区。</p>
<p>一般来说我们认为来自印巴地区的流量比较廉价，但是他这个量级非常大，即使 cpm 很低也能赚很多钱了。</p>
<p>不过我在这个站点上暂时没有发现广告的痕迹，在 SImilarWeb 上其实是有的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76ec47f3c220457c9fd99ee4c11ffc6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=d68oX3TuTgoGHnSydIBTvXbygPA%3D" alt="" loading="lazy"/></p>
<p>出站流量第一名是 google，大概率是 adsense 广告了，不知道为什么他们现在去掉了广告。</p>
<h2 data-id="heading-3">04 赚多少钱？保守估算也很香</h2>
<p>就算按照最低的 cpm 估计，这个站纯广告收入也可以月入十万刀了，年入百万美金。</p>
<p>由于这个站点把 checkout 页面设置为不索引，所以没法估计它的订单量，但就算按照千分之一的转化率，它的定价策略按$10 来算，也有每个月 80 万刀的收益。</p>
<p>那么加起来，remove.bg 的 ARR 应该至少是千万美元级别的。就这么个小需求，做到了千万 ARR，这就是海外的生态。</p>
<p>这个域名的 whois 挂了，查不到是什么时候注册的域名，不过可以通过 archive 推断：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93392d33e11248c68b8e546c4e26c9a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=W1qKNPC54H%2F9IW03mfK7QB44tMc%3D" alt="" loading="lazy"/></p>
<p>其实 18 年的时候，这个站点就在布局了，他们的第一个版本就是 remove bg，那个时候 AI 还没有火热：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c35a3402fba4baaac659eef9487a06e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=IGSDhfxGlGoHBLIO5F%2FmEKRI1OY%3D" alt="" loading="lazy"/></p>
<p>我们看一下它的 about 页，果不其然，是 2018 年创立的团队：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/659845676f364a0c9d8751a03042c4a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=Yey2Y8sHEyzjWj6SbxhU7Ahog1o%3D" alt="" loading="lazy"/></p>
<p>他们竟然是 Canva 的一个子团队，从照片上来看大概有 50 多人了，从初创的角度来说人也不算少了。</p>
<h2 data-id="heading-4">05 上手体验：首屏直接把工具塞给你</h2>
<p>分析完流量和收益，我们来分析分析产品，看看这个产品有哪些是值得我们学习的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/468905437afb44899b0498014cb0c1ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=sr8riACejFySq7PSNidlQ6eGoDQ%3D" alt="" loading="lazy"/></p>
<p>先看它的首屏，直接把工具放在首屏，也就是说，用户不用滚动，就可以直接体验工具，这也是我们提倡的。</p>
<p>对于工具类站点来说，首页不用什么 Banner 和 CTA，把工具放在首屏，让用户第一时间体验是最优的做法。</p>
<p>从审美的角度，我觉得这个首屏并不算非常美观，胜在简洁。</p>
<p>其实这也说明了，工具站不一定要有很惊艳的视觉效果，重在功能满足用户需求，这是首要的。</p>
<p>在未登录的时候就支持用户上传图片，并没有阻断用户体验，在上传图片之后，跳转到了一个编辑页：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be90bf977c17462e931c5b81b68e62f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=BQiVKHfa3iWtry%2BMo76aKlcck7o%3D" alt="" loading="lazy"/></p>
<p>这也是工具站点非常值得学习的方式，相当于首页是一个钩子，具体复杂的功能在内页实现。</p>
<p>这里的编辑器做的还是不错的，提供了基本的图片编辑功能，还能一键换背景。</p>
<p>如果你仔细体验，它还有各种涂刷之类的功能，可以说是非常专业的，并不是随随便便做的。</p>
<p>到这里为止，其实背景已经去除了，目前还不需要登录以及付费。</p>
<p>这也是跟它标榜的免费使用所符合。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af71e7620dd9450c8e0ce29ba45078be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=iiMaCmULkrQAcxITZVV7NcFePUU%3D" alt="" loading="lazy"/></p>
<p>在下载的时候，也给了一个免费选项，而且下载是完全没有水印的，相当于免费就可以完成整个闭环。</p>
<p>我试了一下，再上传一张图片，这条路径还可以继续走，没有限制。</p>
<p>不过这也只能是大厂玩法了，对于我们个人来说，如果这么干，成本肯定扛不住。</p>
<h2 data-id="heading-5">06 付费触发 &amp; 定价设计</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97f3834bac654d6aa06191cf6e3c6177~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=YM5KmMT9B%2Bw092JuY1cv38AkDH4%3D" alt="" loading="lazy"/></p>
<p>如果点击需要付费的功能，会引导进入 Pricing 页面，这个 Pricing 页面也是非常值得学习的设计。</p>
<p>首先，是月付和年付的设计，默认引导年付，但是年付显示的是按月的价格，也就是帮用户计算出如果年付会每个月省 50%的钱，从而拉高用户的 LTV，这也是一个常用的手段。</p>
<p>然后就是它的价格梯度设计，也是非常值得学习的。第一个梯度是，登录送一个积分。</p>
<p>也就是说，只要你注册了，就能拿到 1 个积分。我们做产品的时候，注册率也是重要的一个指标，可以采用这个方式提升用户的注册率。</p>
<p>然后就是按量付费的设计，阶梯定价：</p>
<ul>
<li>
<p>3 积分 $3</p>
</li>
<li>
<p>10 积分 $9</p>
</li>
<li>
<p>75 积分 $49</p>
</li>
<li>
<p>200 积分 $99</p>
</li>
<li>
<p>500 积分 $199</p>
</li>
<li>
<p>1200 积分 $399</p>
</li>
<li>
<p>4000 积分 $999</p>
</li>
<li>
<p>8000 积分 $1699</p>
</li>
</ul>
<p>这个阶梯设计我们可以参考学习，顺便说一下，工具站一定不要只有订阅，要支持按量计费的，能够有效提高付费转化率。</p>
<p>然后就是订阅阶梯：</p>
<p>Lite 版本，$54/年，支持基本的编辑和 API 操作。40 积分/月。</p>
<p>Pro 版本，$234/年，比 Lite 版本多了一个批量的功能，200 积分/月。</p>
<p>Volume+版本，$534/年，可以认为这是企业版本，支持定制各种图片规格等等，500 积分/月。</p>
<p>一般我们的产品，支持 2-3 个阶梯就可以了，如果没能力支持企业版，我认为做两个版本就够用。</p>
<p>一定要想好用户权益，什么权益是高净值用户需要的，定价如何，从用户需求的角度和成本综合考虑。</p>
<h2 data-id="heading-6">07 FAQ 把规则讲透</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/355b0870f44343e8b2530e0ad0f3a733~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=gmKYl4%2Fhm%2BlTJEF1rXHZGGOXiYc%3D" alt="" loading="lazy"/></p>
<p>然后我们来学习一下它的 Faq，工具站点的 Faq 非常重要，尤其是付费页面，你要说清楚很多用户关心的问题。</p>
<p>比如，一个积分是什么概念，在 remove.bg 的定义里，1 个积分可以处理一张图片，这就定义清楚了积分的价值。</p>
<p>另外，它还附加说明了，订阅送的积分，只在订阅期间有效，而一次购买的积分，永久有效。</p>
<p>这些都是我们需要说明的规则。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee9de9d991de4f18bca410a5c4be5659~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=uYt8iuYyfFRLqGjPBktr2woip%2FQ%3D" alt="" loading="lazy"/></p>
<p>它还解释了什么场景适合单买积分，什么场景适合订阅，降低用户心智，实际上这针对的是不同的用户群体。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2812cd360284399ac87cfb822db5669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=TSu0PuW1UGZpY91kMxrzof2TSYk%3D" alt="" loading="lazy"/></p>
<p>然后，一定要声明你的产品是支持取消订阅的，这也是最基础的合规要求。否则用户可以去仲裁，会导致你大量的损失。以及取消订阅之后，积分怎么处理，一定要说明白。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a387b894959749c290e549dc0f47ec0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=0x073nAPA0m2UFRxqOkXVuw3tVc%3D" alt="" loading="lazy"/></p>
<p>最后就是隐私问题，海外用户还是比较注重隐私的，很多审核合规渠道都要求你的产品符合 GDPR（通用数据保护条例），你要做面向欧盟的产品，是必须要注意这一点的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11c595b59f33483181deba2d94ea1b3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=28lOOdJLW3Yd%2BXLbH9V%2BwN3suJI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">08 信息架构：导航做减法</h2>
<p>然后我们看它的导航栏设计，也是值得学习的，它的内页其实很多，但并不是每一个内页都要硬塞到导航栏里，它的导航非常简单：</p>
<ul>
<li>
<p>upload 是主功能</p>
</li>
<li>
<p>bulk 是附加功能，也是刚刚我们看到 pro 用户的最大的价值</p>
</li>
<li>
<p>api 是开放文档</p>
</li>
<li>
<p>plugins 是支持的插件</p>
</li>
<li>
<p>Pricing 是定价页</p>
</li>
</ul>
<p>我觉得做产品，一定要学会做减法，导航太臃肿，给用户的心智负担就很重，你不是 tob 的产品，而是这种 toc 的垂类产品，那就必须要学会做减法。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/827fb51803a740ca953b35aea6b155eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=9eNpdcKRXOEDa%2FaqXFtZa5Y5qbE%3D" alt="" loading="lazy"/></p>
<p>这个 bulk 页面，我觉得非常值得学习的点就是，它通过首屏的动图，让你立即能理解这个功能带来的附加价值，我觉得这个页面的 CTR 会非常不错，非常清晰易懂。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/932d2aa2ec9144cdaf5322ca1c9191c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=BiiEz3%2FRu%2BSjInShixoRCUWlQXk%3D" alt="" loading="lazy"/></p>
<p>plugin 页面就是在展示大厂实力了，这也是护城河。尽管是一个去除背景的小需求，它能做各种插件、APP，与这么多效率工具打通，如果我们以个人力量去和他竞争，那无异于以卵击石。</p>
<h2 data-id="heading-8">09 场景、功能、案例三套内页矩阵</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66c5eff2b1af43acbaebd2927537a223~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=maPLEOtSPfZdJhaQXCJcjQSyQWA%3D" alt="" loading="lazy"/></p>
<p>这是它做的一个 features 集合页，也就是说，产品的所有特性，它都做成了内页，而且每个内页都基本有个动图，这无论是从 SEO 的角度还是用户体验的角度来说都特别好，我觉得很值得我们学习。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7afb2b9f85e84fa7926a50bf8d04d082~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=Yawag9GX7aEYQstxyALIkna1eHQ%3D" alt="" loading="lazy"/></p>
<p>然后就是它为每一种用户场景都做了内页，你是设计师、工程师、Photoshop 人员等等，都做了内页。这是真正从用户的角度去做需求，深刻调研自己的用户、客户，做好分类，做精致的产品，这点我是需要反思和学习的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab43fa97bba14eaa97c48326bd044edc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=YCCIRPnTWADP7h1XJq160gI3FE8%3D" alt="" loading="lazy"/></p>
<p>这是它的用户案例，每个用户的精彩故事都记录下来，对于一个产品来说，这是最有力的证言。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9350eb2233a4f1caddcf84bc00a2840~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=y8yq8uLF47hu0vun0e5BFE%2BR6NE%3D" alt="" loading="lazy"/></p>
<p>然后是它的 blog 页面，作为工具站点，必须要写 blog，通过 blog 我们就看出 canva 这个团队的 SEO 功底了，基本上承接了所有 how-to、best xxx 等长尾需求流量，这也是我们必须要掌握的 SEO 技巧。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46c82f85ba5547ae8a399f32e31569f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=goy%2FDJhfytx90YTbOKaKkm0SD1o%3D" alt="" loading="lazy"/></p>
<p>而且随便点击去一篇博客，发现它是真正在用心写，从用户的角度去写，并不是为了 SEO 而 SEO。</p>
<h2 data-id="heading-9">10 增长工具：Newsletter + ProductHunt 小组件</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/231d85222d634769bed197eaae1ace58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=7gCoksCQY%2F%2BE06Aqpr0o0Hnujoc%3D" alt="" loading="lazy"/></p>
<p>它的博客下方有 newsletter 的订阅，和 ProductHunt 的小组件，这个我觉得也是值得学习的点。我们真正做一个长期的产品，一定要做 EDM，一定要抓住任何可以提留存的机会。</p>
<h2 data-id="heading-10">11 Affiliate 体系：规则透明才好招募</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afeea065aba842909257472839cdad52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=Q3tVqxxIn0Gqajl9PkTfvZH9epQ%3D" alt="" loading="lazy"/></p>
<p>这是它的 Affliate 页面设计，这次我的产品也是被迫采用了 Affliate 的，最后发现 Affliate 真香。</p>
<p>你可以看到这里明确写了 Affliate 是 15%的收益，并且有很多 Affliate 相关的 faq，都非常专业，值得学习。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc40708b03a245e89cc345d67a6e51e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=wIsSypmtkWXmhM%2BXnTP447J%2FXm8%3D" alt="" loading="lazy"/></p>
<p>比如，remove.bg 是可以将用户订阅续费的收益，算作 Affliate 的，这点要清晰说明。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b8317e7858341c4b2bfa5c83c2b3081~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=l%2BHaTEsEbWqoKsdgFkuDa8gaf3o%3D" alt="" loading="lazy"/></p>
<p>还有，哪些推广行为是不被允许的，这点要提前说明，一般我们不希望对方投流来影响我们自己的 seo 等等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a5fa57909274e13be91b3dc7cc4a9e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=fd4TK%2FvSr5zGhK2GvMv3Mz1DA0M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1836814955fa495fb243c57bc8f80d8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=mQF%2BKA%2BGzWXksgaGCYOgrXI2tdU%3D" alt="" loading="lazy"/></p>
<p>收益结算周期、如果付费、cookie 追踪有效期什么的，都要清晰。</p>
<p>以上这些，都是我上个产品 Affliate 踩的坑，跟对方来回 20 多个邮件才把这个东西聊明白。</p>
<p>remove.bg 就非常值得学习，直接做个 Affliate 页面，所有的规则都清楚了，可以吸引更多客户来对你的产品进行分销。</p>
<h2 data-id="heading-11">12 多语言 &amp; 渠道矩阵</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c366de8f06f94aea82de3765d9b8cf65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=9uKEZFBwBMFZDPjTVBqFyCHDs3o%3D" alt="" loading="lazy"/></p>
<p>另外就是它支持了基本上主流国家的语言，做海外站点，如果我们要面向全球 70 亿人口市场，多语言必不可少，可能带来几十倍的流量。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16cbc622950b4b6db8c0446f7f5f53db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=6wyFb4ZB2aoPkxf%2F7ovEI8AB1Jo%3D" alt="" loading="lazy"/></p>
<p>最后我们学习一下它的营销渠道，包括 Facebook、Instagram、Twitter、TikTok、Youtube、LinkedIn。</p>
<p>我就不一个个截图了，这基本上可以当做范例，我们做海外产品重点需要去做的品牌渠道。</p>
<h2 data-id="heading-12">13 竞争格局：大盘够大，仍有切口</h2>
<p>最后我们可以通过 SImilarWeb 去看看它的竞争者：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/105e3c8bc261410e91c6d74efd514310~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=TvDSpZt28MPaIGIvP1VXsLqyDIs%3D" alt="" loading="lazy"/></p>
<p>比如 pixelcut，这个站点有两千万的访问量，我们看它的搜索词：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d125e3247c394f4aa9c6e6de3d109aeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=qUo7cSmvRy6XdTnqTnncg3wsNWA%3D" alt="" loading="lazy"/></p>
<p>是不是也是 background remover？还有 photoroom，也有两千万的访问量：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f77b70a6a387470ab95983670567eb7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825467&amp;x-signature=yNtfqg64kNZJ8cu6jSlwcHXDHik%3D" alt="" loading="lazy"/></p>
<p>这说明什么？就算 remove.bg 已经非常厉害了，但这个市场盘子足够大，依然有其他的竞争者可以分到流量。</p>
<p>不可能有一个产品把所有的流量都吃光，能够在大盘子内占小比例，也是很大的流量了，这就是我们的出海机会。</p>
<p>这两个站产品做的咋样，他们的流量和用户又是什么分布，这里面的市场空间还有没有我们的商机？这些就留给大家的作业去分析了。</p>
<h2 data-id="heading-13">14 给出海团队的 8 个可落地要点</h2>
<ol>
<li>
<p>域名选需求词，品牌=需求。</p>
</li>
<li>
<p>TDH 写清价值主张，标题加 Free 钩子。</p>
</li>
<li>
<p>OG 图用 before/after，社媒即转化页。</p>
</li>
<li>
<p>首屏即工具，降低首次互动摩擦。</p>
</li>
<li>
<p>免费闭环先跑通，再做付费触发。</p>
</li>
<li>
<p>订阅 + 按量并行，价格梯度少而清晰。</p>
</li>
<li>
<p>FAQ 讲透规则，减少客服/拒付风险。</p>
</li>
<li>
<p>场景、功能、案例、博客做成内页矩阵，既 SEO 又教育用户。</p>
</li>
</ol>
<p>出海没那么神秘，好的产品套路都写在这些细节里。多拆解、多复盘，抓住大盘里的小切口，就有机会找到属于自己的红利。</p>
<p>好了，今天的分享就到这里，我们下期再见！</p>
<hr/>
<p>🚀 想要与更多AI爱好者交流，共同成长吗？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ4k_5_waWJbRRo5lZBZmog" target="_blank" title="https://mp.weixin.qq.com/s/Z4k_5_waWJbRRo5lZBZmog" ref="nofollow noopener noreferrer">和一群志同道合的人，持续精进 AI 的每一天</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue2、vue3父子组件嵌套生命周期执行顺序]]></title>    <link>https://juejin.cn/post/7577201863725514752</link>    <guid>https://juejin.cn/post/7577201863725514752</guid>    <pubDate>2025-11-27T04:39:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577201863725514752" data-draft-id="7576914798057046068" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue2、vue3父子组件嵌套生命周期执行顺序"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-27T04:39:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="什么时候吃饭"/> <meta itemprop="url" content="https://juejin.cn/user/4235734789917406"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue2、vue3父子组件嵌套生命周期执行顺序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4235734789917406/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    什么时候吃饭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T04:39:36.000Z" title="Thu Nov 27 2025 04:39:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">vue2版本</h2>
<blockquote>
<p>生命周期：</p>
<p>beforeCreate created beforeMount mounted beforeUpdate updated beforeDestroy destroyed activated deactivated</p>
</blockquote>
<h3 data-id="heading-1">1. 组件挂载阶段（Mounting）</h3>
<h4 data-id="heading-2">执行顺序：</h4>
<pre><code class="hljs language-arduino" lang="arduino">​
<span class="hljs-comment">// 创建和挂载过程</span>
​
父组件 beforeCreate
​
父组件 created
​
父组件 beforeMount
​
  子组件 beforeCreate
​
  子组件 created
​
  子组件 beforeMount
​
  子组件 mounted
​
父组件 mounted
</code></pre>
<h4 data-id="heading-3">代码示例：</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Child.vue'</span>
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Parent'</span>,
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 beforeCreate'</span>)
  },
  <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 父组件 created'</span>)
  },
  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 父组件 beforeMount'</span>)
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'6. 父组件 mounted'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Child'</span>,
  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 子组件 beforeCreate'</span>)
  },
  <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4.1 子组件 created'</span>)
  },
  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4.2 子组件 beforeMount'</span>)
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'5. 子组件 mounted'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h3 data-id="heading-4">2. 组件更新阶段（Updating）</h3>
<h4 data-id="heading-5">总结：</h4>
<blockquote>
<p>vue2中，只要子组件使用了，父组件传入的值，当该值更新时，子组件的更新生命周期就会执行，其他情况，子组件的更新生命周期都不会执行</p>
</blockquote>
<h4 data-id="heading-6">更新父组件--子组件使用了，父组件传入的参数</h4>
<h5 data-id="heading-7">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
父组件 beforeUpdate
​
  子组件 beforeUpdate
​
  子组件 updated
​
父组件 updated
</code></pre>
<h5 data-id="heading-8">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件 - {{ parentData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:childData</span>=<span class="hljs-string">"parentData"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Child.vue'</span>
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">parentData</span>: <span class="hljs-string">'初始值'</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">changeData</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentData</span> = <span class="hljs-string">'新值'</span>
    }
  },
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 beforeUpdate'</span>)
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 updated'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件 - {{ childData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'childData'</span>],
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 子组件 beforeUpdate'</span>)
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 updated'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-9">更新父组件--子组件没有使用，父组件传入的参数（即使有传入值给子组件）</h4>
<h5 data-id="heading-10">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
父组件 beforeUpdate
​
父组件 updated
</code></pre>
<h5 data-id="heading-11">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件 - {{ parentData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:childData</span>=<span class="hljs-string">"parentData"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;ChildComponent :childData="parentData" /&gt; --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/two/Child.vue'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">parentData</span>: <span class="hljs-string">'初始值'</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">changeData</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentData</span> = <span class="hljs-string">'新值'</span>
    }
  },
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 beforeUpdate'</span>)
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 updated'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;h3&gt;子组件 - {{ childData }}&lt;/h3&gt; --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'childData'</span>],
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 子组件 beforeUpdate'</span>)
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 updated'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
</code></pre>
<h4 data-id="heading-12">更新子组件</h4>
<h5 data-id="heading-13">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
子组件 beforeUpdate
​
子组件 updated
</code></pre>
<h5 data-id="heading-14">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件 - {{ parentData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/two/Child.vue'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">parentData</span>: <span class="hljs-string">'初始值'</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">changeData</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentData</span> = <span class="hljs-string">'新值'</span>
    }
  },
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 beforeUpdate'</span>)
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 updated'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc; padding: 10px; margin: 10px;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Child Component - {{ childMessage }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeChildData"</span>&gt;</span>改变子组件数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>计数: {{ count }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">childMessage</span>: <span class="hljs-string">'子组件初始数据'</span>,
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">changeChildData</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">childMessage</span> = <span class="hljs-string">'子组件数据已更新'</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 子组件数据变化触发 ==='</span>)
    }
  },
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child beforeUpdate'</span>) },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child updated'</span>) },
​
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
​
</code></pre>
<h3 data-id="heading-15">3. 组件销毁阶段（Destroying）</h3>
<h4 data-id="heading-16">销毁父组件</h4>
<h5 data-id="heading-17">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 销毁过程</span>
​
父组件 beforeDestroy
​
  子组件 beforeDestroy
​
  子组件 destroyed
​
父组件 destroyed
</code></pre>
<h5 data-id="heading-18">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showChild"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showChild = false"</span>&gt;</span>销毁子组件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/two/Child.vue'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">showChild</span>: <span class="hljs-literal">true</span>
    }
  },
  <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'父组件 beforeDestroy'</span>)
  },
  <span class="hljs-title function_">destroyed</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'父组件 destroyed'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h4 data-id="heading-19">销毁子组件</h4>
<h5 data-id="heading-20">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 销毁过程</span>
​
 子组件 beforeDestroy
​
 子组件 destroyed
​
</code></pre>
<h5 data-id="heading-21">代码示例：见销毁父组件的代码</h5>
<h2 data-id="heading-22">vue3版本</h2>
<blockquote>
<p>生命周期：</p>
<p>setup（）替代 beforeCreate setup（）替代 created onBeforeMount onMounted onBeforeUpdate onUpdated onBeforeUnmount onUnmounted onActivated onDeactivated onRenderTracked（新增） onRenderTriggered（新增）</p>
</blockquote>
<h3 data-id="heading-23">1. 组件挂载阶段（Mounting）</h3>
<h4 data-id="heading-24">执行顺序：</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 父组件 setup (相当于 beforeCreate + created)
<span class="hljs-bullet">2.</span> 父组件 onBeforeMount
<span class="hljs-bullet">    3.</span> 子组件 setup
<span class="hljs-code">    3.1 子组件 onBeforeMount
    4. 子组件 onMounted
5. 父组件 onMounted
</span></code></pre>
<h4 data-id="heading-25">代码示例：</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeMount, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../Son/s1.vue'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 setup (相当于 beforeCreate + created)'</span>)
<span class="hljs-title function_">onBeforeMount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 父组件 onBeforeMount'</span>)
})
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'5. 父组件 onMounted'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeMount, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 setup'</span>)
<span class="hljs-title function_">onBeforeMount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3.1 子组件 onBeforeMount'</span>)
})
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 子组件 onMounted'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h3 data-id="heading-26">2. 组件更新阶段（Updating）</h3>
<h4 data-id="heading-27">总结：</h4>
<blockquote>
<p>vue3中，只要父组件往子组件传入了值，当该值更新时，子组件的更新生命周期就会执行，其他情况，子组件的更新生命周期都不会执行</p>
</blockquote>
<h4 data-id="heading-28">更新父组件--子组件使用了，父组件传入的参数</h4>
<h5 data-id="heading-29">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
父组件 beforeUpdate
​
  子组件 beforeUpdate
​
  子组件 updated
​
父组件 updated
</code></pre>
<h5 data-id="heading-30">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件 - {{ parentData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:childData</span>=<span class="hljs-string">"parentData"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onBeforeUpdate, onUpdated } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../Son/s1.vue'</span>
<span class="hljs-keyword">const</span> parentData = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'初始值'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeData</span> = (<span class="hljs-params"/>) =&gt; {
  parentData.<span class="hljs-property">value</span> = <span class="hljs-string">'新值'</span>
}
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 onBeforeUpdate'</span>)
})
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 onUpdated'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件 - {{ props.childData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeUpdate, onUpdated, defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
​
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>([<span class="hljs-string">'childData'</span>])
​
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 子组件 onBeforeUpdate'</span>)
})
​
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 onUpdated'</span>)
})
​
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h4 data-id="heading-31">更新父组件--父组件传值给子组件，即使子组件没有使用 和 定义对应的属性</h4>
<blockquote>
<p>如果父组件没有传值给子组件，即使子组件定义 和 使用了值，当父组件更新时，子组件也不会更新，即：生命周期是：</p>
<p><code>父组件 beforeUpdate</code> -&gt; <code>父组件 updated</code></p>
</blockquote>
<h5 data-id="heading-32">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
父组件 beforeUpdate
​
  子组件 beforeUpdate
​
  子组件 updated
​
父组件 updated
</code></pre>
<h5 data-id="heading-33">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件 - {{ parentData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:childData</span>=<span class="hljs-string">"parentData"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;ChildComponent  /&gt; --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onBeforeUpdate, onUpdated } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../Son/s1.vue'</span>
<span class="hljs-keyword">const</span> parentData = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'初始值'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeData</span> = (<span class="hljs-params"/>) =&gt; {
  parentData.<span class="hljs-property">value</span> = <span class="hljs-string">'新值'</span>
}
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 onBeforeUpdate'</span>)
})
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 onUpdated'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;h3&gt;子组件 - {{ props.childData }}&lt;/h3&gt; --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeUpdate, onUpdated, defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
​
<span class="hljs-comment">// const props = defineProps(['childData'])</span>
​
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 子组件 onBeforeUpdate'</span>)
})
​
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 onUpdated'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h4 data-id="heading-34">更新子组件</h4>
<h5 data-id="heading-35">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 更新过程（数据变化时）</span>
​
子组件 beforeUpdate
​
子组件 updated
</code></pre>
<h5 data-id="heading-36">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;h2&gt;父组件 - {{ parentData }}&lt;/h2&gt; --&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;button @click="changeData"&gt;改变数据&lt;/button&gt; --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:childData</span>=<span class="hljs-string">"parentData"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;ChildComponent  /&gt; --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onBeforeUpdate, onUpdated } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../Son/s1.vue'</span>
<span class="hljs-keyword">const</span> parentData = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'初始值'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeData</span> = (<span class="hljs-params"/>) =&gt; {
  parentData.<span class="hljs-property">value</span> = <span class="hljs-string">'新值'</span>
}
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 父组件 onBeforeUpdate'</span>)
})
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 父组件 onUpdated'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;h3&gt;子组件&lt;/h3&gt; --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>子组件 - {{ sonData }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeData"</span>&gt;</span>改变数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeUpdate, onUpdated,ref, defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
​
<span class="hljs-comment">// const props = defineProps(['childData'])</span>
​
<span class="hljs-keyword">const</span> sonData = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'初始值'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeData</span> = (<span class="hljs-params"/>) =&gt; {
  sonData.<span class="hljs-property">value</span> = <span class="hljs-string">'新值'</span>
}
​
<span class="hljs-title function_">onBeforeUpdate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 子组件 onBeforeUpdate'</span>)
})
​
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. 子组件 onUpdated'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h3 data-id="heading-37">3. 组件销毁阶段（Destroying）</h3>
<h4 data-id="heading-38">销毁父组件</h4>
<h5 data-id="heading-39">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 销毁过程</span>
​
父组件 beforeDestroy
​
  子组件 beforeDestroy
​
  子组件 destroyed
​
父组件 destroyed
</code></pre>
<h5 data-id="heading-40">代码示例：</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showChild"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showChild = false"</span>&gt;</span>卸载子组件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onBeforeUnmount, onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../Son/s1.vue'</span>
<span class="hljs-keyword">const</span> showChild = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">true</span>)
<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'父组件 onBeforeUnmount'</span>)
})
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'父组件 onUnmounted'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
​
​
<span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;h3&gt;子组件&lt;/h3&gt; --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onBeforeUnmount, onUnmounted,ref, defineProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
​
<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子组件 onBeforeUnmount'</span>)
})
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子父组件 onUnmounted'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
</code></pre>
<h4 data-id="heading-41">销毁子组件</h4>
<h5 data-id="heading-42">执行顺序：</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 销毁过程</span>
​
 子组件 beforeDestroy
​
 子组件 destroyed
​
</code></pre>
<h5 data-id="heading-43">代码示例：见销毁父组件的代码</h5></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS 位置服务全攻略：精准定位、地理编码与后台持续定位实现]]></title>    <link>https://juejin.cn/post/7576942980708712448</link>    <guid>https://juejin.cn/post/7576942980708712448</guid>    <pubDate>2025-11-27T05:21:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576942980708712448" data-draft-id="7576928310788702260" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS 位置服务全攻略：精准定位、地理编码与后台持续定位实现"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-27T05:21:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT充电站"/> <meta itemprop="url" content="https://juejin.cn/user/125809758576431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS 位置服务全攻略：精准定位、地理编码与后台持续定位实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/125809758576431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT充电站
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:21:39.000Z" title="Thu Nov 27 2025 05:21:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>✨家人们记得点个账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>在 HarmonyOS 应用开发中，位置服务是许多场景的核心能力 —— 无论是本地生活服务的附近推荐、导航应用的实时轨迹追踪，还是出行类 App 的后台定位，都离不开稳定、精准的位置获取能力。本文将从权限配置、位置获取、地理编码转换、持续定位到后台长时定位，一步步拆解 HarmonyOS 位置服务的完整实现流程，附带可直接复用的代码示例，助力开发者快速落地功能。</p>
<h2 data-id="heading-0">获取设备的位置信息</h2>
<blockquote>
<p>1-配置申请位置权限 同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION 获取到精准位置，精准度在米级别。</p>
<p>2-检查全局位置开关是否打开 geoLocationManager.isLocationEnabled();</p>
<ul>
<li>2.1 没开 atManager.requestGlobalSwitch(getContext(this), abilityAccessCtrl.SwitchType.LOCATION) 拉起全局设置位置开关页</li>
<li>2.2 开了 继续</li>
</ul>
<p>3-获取当前位置 geoLocationManager.getCurrentLocation(request) 可以获取用户经度纬度</p>
<p>4-可以继续通过geoLocationManager.getAddressesFromLocation()地理编码转化为可读性较强地址</p>
</blockquote>
<ul>
<li>获取设备的位置信息，需要有位置权限，位置权限申请</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 位置信息（权限组）</span>
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.APPROXIMATELY_LOCATION"</span>,
  <span class="hljs-string">"reason"</span>: <span class="hljs-string">'<span class="hljs-subst">$string</span>:permission_reason_location'</span>,
  <span class="hljs-string">"usedScene"</span>: {}
},
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.LOCATION"</span>,
  <span class="hljs-string">"reason"</span>: <span class="hljs-string">'<span class="hljs-subst">$string</span>:permission_reason_location'</span>,
  <span class="hljs-string">"usedScene"</span>: {}
},
</code></pre>
<p>按照步骤申请权限 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V13%2Flocation-guidelines-V13" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V13/location-guidelines-V13" target="_blank" ref="nofollow noopener noreferrer">developer.huawei.com/consumer/cn…</a></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
<span class="hljs-keyword">import</span> { abilityAccessCtrl, <span class="hljs-title class_">Context</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;
<span class="hljs-keyword">import</span> { permissionUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/PermissionUtil'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'获取位置信息'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-comment">// 1 配置文件 申请权限   同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION 获取到精准位置，精准度在米级别。</span>
      <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> permissionUtil.<span class="hljs-title function_">checkPermissions</span>([<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>, <span class="hljs-string">'ohos.permission.LOCATION'</span>], <span class="hljs-title function_">getContext</span>());
      <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>

      <span class="hljs-comment">// 2 检查全局开关  开了-继续走，没开-弹出让他授权</span>
      <span class="hljs-keyword">const</span> locationEnabled = geoLocationManager.<span class="hljs-title function_">isLocationEnabled</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'查看当前全局开关状态：'</span>, locationEnabled)

      <span class="hljs-keyword">if</span> (!locationEnabled) {  <span class="hljs-comment">// 没开</span>
        <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestGlobalSwitch</span>(<span class="hljs-title function_">getContext</span>(), abilityAccessCtrl.<span class="hljs-property">SwitchType</span>.<span class="hljs-property">LOCATION</span>)
        <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>  <span class="hljs-comment">// 拉起全局弹出 用户没授权就终止代码执行</span>
      }

      <span class="hljs-comment">// 3. 获取位置信息  经度纬度</span>
      geoLocationManager.<span class="hljs-title function_">getCurrentLocation</span>( {
        <span class="hljs-attr">locatingPriority</span>: geoLocationManager.<span class="hljs-property">LocatingPriority</span>.<span class="hljs-property">PRIORITY_LOCATING_SPEED</span>,
        <span class="hljs-attr">locatingTimeoutMs</span>: <span class="hljs-number">10000</span>
      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> { <span class="hljs-comment">// 调用getCurrentLocation获取当前设备位置，通过promise接收上报的位置</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'current location: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result));
      })
        .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> { <span class="hljs-comment">// 接收上报的错误码</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'promise, getCurrentLocation: error='</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));
        });
      <span class="hljs-comment">// .....</span>
    })
  }
}
</code></pre>
<h2 data-id="heading-1">地理编码转化与逆地理编码转化</h2>
<p>使用坐标描述一个位置，非常准确，但是并不直观，面向用户表达并不友好。系统向开发者提供了以下两种转化能力。</p>
<ul>
<li>地理编码转化：将地理描述转化为具体坐标。</li>
<li>逆地理编码转化能力：将坐标转化为地理描述。</li>
</ul>
<p>其中地理编码包含多个属性来描述位置，包括国家、行政区划、街道、门牌号、地址描述等等，这样的信息更便于用户理解。</p>
<p>开发步骤</p>
<ol>
<li>导入geoLocationManager模块，所有与地理编码转化&amp;逆地理编码转化能力相关的功能API，都是通过该模块提供的。</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
</code></pre>
<p>2.获取转化结果。</p>
<p>调用getAddressesFromLocation，把坐标转化为地理位置信息。应用可以获得与此坐标匹配的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V13%2Fjs-apis-geolocationmanager-V13%23geoaddress" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V13/js-apis-geolocationmanager-V13#geoaddress" target="_blank" ref="nofollow noopener noreferrer">GeoAddress</a>（地理编码地址信息）列表，应用可以根据实际使用需求，读取相应的参数数据。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> <span class="hljs-attr">reverseGeocodeRequest</span>:geoLocationManager.<span class="hljs-property">ReverseGeoCodeRequest</span> = {
  <span class="hljs-attr">locale</span>: <span class="hljs-string">'zh'</span>,
  <span class="hljs-string">"latitude"</span>: <span class="hljs-number">31.12</span>, <span class="hljs-string">"longitude"</span>: <span class="hljs-number">121.11</span>, <span class="hljs-string">"maxItems"</span>: <span class="hljs-number">1</span>
};
<span class="hljs-keyword">try</span> {
    geoLocationManager.<span class="hljs-title function_">getAddressesFromLocation</span>(reverseGeocodeRequest, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getAddressesFromLocation err: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getAddressesFromLocation data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
        }
    });
} <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"errCode:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
}
</code></pre>
<p>3.示例代码</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
<span class="hljs-keyword">import</span> { abilityAccessCtrl, <span class="hljs-title class_">Context</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;
<span class="hljs-keyword">import</span> { permissionUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/PermissionUtil'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'获取位置信息'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-comment">// 1 配置文件 申请权限   同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION 获取到精准位置，精准度在米级别。</span>
      <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> permissionUtil.<span class="hljs-title function_">checkPermissions</span>([<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>, <span class="hljs-string">'ohos.permission.LOCATION'</span>], <span class="hljs-title function_">getContext</span>());
      <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>

      <span class="hljs-comment">// 2 检查全局开关  开了-继续走，没开-弹出让他授权</span>
      <span class="hljs-keyword">const</span> locationEnabled = geoLocationManager.<span class="hljs-title function_">isLocationEnabled</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'查看当前全局开关状态：'</span>, locationEnabled)

      <span class="hljs-keyword">if</span> (!locationEnabled) {  <span class="hljs-comment">// 没开</span>
        <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestGlobalSwitch</span>(<span class="hljs-title function_">getContext</span>(), abilityAccessCtrl.<span class="hljs-property">SwitchType</span>.<span class="hljs-property">LOCATION</span>)
        <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>  <span class="hljs-comment">// 拉起全局弹出 用户没授权就终止代码执行</span>
      }

      <span class="hljs-comment">// 3. 获取位置信息  经度纬度</span>
      geoLocationManager.<span class="hljs-title function_">getCurrentLocation</span>( {
        <span class="hljs-attr">locatingPriority</span>: geoLocationManager.<span class="hljs-property">LocatingPriority</span>.<span class="hljs-property">PRIORITY_LOCATING_SPEED</span>,
        <span class="hljs-attr">locatingTimeoutMs</span>: <span class="hljs-number">10000</span>
      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> { <span class="hljs-comment">// 调用getCurrentLocation获取当前设备位置，通过promise接收上报的位置</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'current location: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result))

        <span class="hljs-comment">// 正地理编码与逆地理编码</span>
        geoLocationManager.<span class="hljs-title function_">getAddressesFromLocation</span>({<span class="hljs-string">"latitude"</span>: result.<span class="hljs-property">latitude</span>, <span class="hljs-string">"longitude"</span>: result.<span class="hljs-property">longitude</span>, <span class="hljs-string">"maxItems"</span>: <span class="hljs-number">1</span>}, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
          <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getAddressesFromLocation err: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getAddressesFromLocation data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
          }
        });
        <span class="hljs-comment">// 正地理编码与逆地理编码 end</span>
      })
        .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> { <span class="hljs-comment">// 接收上报的错误码</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'promise, getCurrentLocation: error='</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));
        });
      <span class="hljs-comment">// .....</span>
    })
  }
}
</code></pre>
<h2 data-id="heading-2">持续定位</h2>
<p>持续定位。多用于导航、运动轨迹、出行等场景。</p>
<p>首先要实例化<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V13%2Fjs-apis-geolocationmanager-V13%23continuouslocationrequest12" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V13/js-apis-geolocationmanager-V13#continuouslocationrequest12" target="_blank" ref="nofollow noopener noreferrer">ContinuousLocationRequest</a>对象，用于告知系统该向应用提供何种类型的位置服务，以及位置结果上报的频率。</p>
<ul>
<li>设置locationScenario：</li>
</ul>
<p>建议locationScenario参数优先根据应用的使用场景进行设置，该参数枚举值定义参见<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V13%2Fjs-apis-geolocationmanager-V13%23useractivityscenario12" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V13/js-apis-geolocationmanager-V13#useractivityscenario12" target="_blank" ref="nofollow noopener noreferrer">UserActivityScenario</a>，例如地图在导航时使用NAVIGATION参数，可以持续在室内和室外场景获取位置用于导航。</p>
<ul>
<li>设置interval：</li>
</ul>
<p>表示上报位置信息的时间间隔，单位是秒，默认值为1秒。如果对位置上报时间间隔无特殊要求，可以不填写该字段。</p>
<p>以地图导航场景为例，调用方式如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: geoLocationManager.<span class="hljs-property">ContinuousLocationRequest</span>= {
   <span class="hljs-string">'interval'</span>: <span class="hljs-number">1</span>,
   <span class="hljs-string">'locationScenario'</span>: geoLocationManager.<span class="hljs-property">UserActivityScenario</span>.<span class="hljs-property">NAVIGATION</span>
}
<span class="hljs-keyword">let</span> locationCallback = (<span class="hljs-attr">location</span>:geoLocationManager.<span class="hljs-property">Location</span>):<span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'locationCallback: data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(location));
};
<span class="hljs-keyword">try</span> {
   geoLocationManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'locationChange'</span>, request, locationCallback);
} <span class="hljs-keyword">catch</span> (err) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"errCode:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
}
</code></pre>
<p>如果不主动结束定位可能导致设备功耗高，耗电快；建议在不需要获取定位信息时及时结束定位。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">geoLocationManager.<span class="hljs-keyword">off</span>(<span class="hljs-comment">'locationChange', locationCallback);</span>
</code></pre>
<p>完整实例代码</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
<span class="hljs-keyword">import</span> { abilityAccessCtrl } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { permissionUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/PermissionUtil'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {

  <span class="hljs-title function_">locationCallback</span>(<span class="hljs-params">location:geoLocationManager.Location</span>)  {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'locationCallback: data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(location));
  }

  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"/>) {
    geoLocationManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'locationChange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">locationCallback</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'获取位置信息'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-comment">// 1 配置文件 申请权限   同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION 获取到精准位置，精准度在米级别。</span>
      <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> permissionUtil.<span class="hljs-title function_">checkPermissions</span>([<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>, <span class="hljs-string">'ohos.permission.LOCATION'</span>], <span class="hljs-title function_">getContext</span>());
      <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>

      <span class="hljs-comment">// 2 检查全局开关  开了-继续走，没开-弹出让他授权</span>
      <span class="hljs-keyword">const</span> locationEnabled = geoLocationManager.<span class="hljs-title function_">isLocationEnabled</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'查看当前全局开关状态：'</span>, locationEnabled)

      <span class="hljs-keyword">if</span> (!locationEnabled) {  <span class="hljs-comment">// 没开</span>
        <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestGlobalSwitch</span>(<span class="hljs-title function_">getContext</span>(), abilityAccessCtrl.<span class="hljs-property">SwitchType</span>.<span class="hljs-property">LOCATION</span>)
        <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>  <span class="hljs-comment">// 拉起全局弹出 用户没授权就终止代码执行</span>
      }

      <span class="hljs-comment">// 3. 获取位置信息  经度纬度 【持续定位。多用于导航、运动轨迹、出行等场景。】</span>
      geoLocationManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'locationChange'</span>, {
        <span class="hljs-attr">interval</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">locationScenario</span>: geoLocationManager.<span class="hljs-property">UserActivityScenario</span>.<span class="hljs-property">NAVIGATION</span>
      }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">locationCallback</span>);

      <span class="hljs-comment">// .....</span>
    })
  }
}
</code></pre>
<h2 data-id="heading-3">后台定位-长时任务</h2>
<p><strong>应用退至后台后</strong>，在后台需要长时间运行用户可感知的任务，如播放音乐、导航等。为防止<strong>应用进程被挂起</strong>，导致对应功能异常，可以<strong>申请长时任务</strong>，使应用在后台长时间运行。在长时任务中可以申请多种类型的任务，并对任务类型进行更新。应用退后台执行业务时，系统会做一致性校验，确保应用在执行相应的长时任务。同时，系统有与长时任务相关联的通知栏消息，用户删除通知栏消息时，系统会自动停止长时任务。</p>
<p>1.需要申请ohos.permission.KEEP_BACKGROUND_RUNNING权限，配置方式请参见<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V13%2Fdeclare-permissions-V13" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V13/declare-permissions-V13" target="_blank" ref="nofollow noopener noreferrer">声明权限</a>。</p>
<p>2.声明后台模式类型。</p>
<p>在module.json5配置文件中为需要使用长时任务的UIAbility声明相应的长时任务类型（配置文件中填写长时任务类型的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V13%2Fcontinuous-task-V13%23%25E4%25BD%25BF%25E7%2594%25A8%25E5%259C%25BA%25E6%2599%25AF" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V13/continuous-task-V13#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" target="_blank" ref="nofollow noopener noreferrer">配置项</a>）。</p>
<pre><code class="hljs language-json" lang="json"> <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
     <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
         <span class="hljs-punctuation">{</span>
        			<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">,</span>
          		 <span class="hljs-comment">// ...</span>
              <span class="hljs-comment">// ...</span>
              <span class="hljs-comment">// </span>
              <span class="hljs-attr">"backgroundModes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
              	<span class="hljs-comment">// 长时任务类型的配置项</span>
             		<span class="hljs-string">"audioRecording"</span>
               	或者
          			<span class="hljs-string">"location"</span>   ✅
             <span class="hljs-punctuation">]</span>
         <span class="hljs-punctuation">}</span>
     <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
     ...
 <span class="hljs-punctuation">}</span>
</code></pre>
<ol start="3">
<li>创建BackgroundTaskUtil.ets文件封装长短时任务</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { backgroundTaskManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BackgroundTasksKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;
<span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">WantAgent</span>, wantAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BackgroundTaskUtil</span> {

  <span class="hljs-comment">// 长任务-开启</span>
  <span class="hljs-title function_">startLongTask</span>(<span class="hljs-params">list:<span class="hljs-built_in">string</span>[], callback: () =&gt; <span class="hljs-built_in">void</span></span>) {  <span class="hljs-comment">// list任务类型， callback开启成功后走的回调</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">wantAgentInfo</span>: wantAgent.<span class="hljs-property">WantAgentInfo</span> = {
      <span class="hljs-comment">// 点击通知后，将要执行的动作列表</span>
      <span class="hljs-comment">// 添加需要被拉起应用的bundleName和abilityName</span>
      <span class="hljs-attr">wants</span>: [
        {
          <span class="hljs-attr">bundleName</span>: (<span class="hljs-title function_">getContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>).<span class="hljs-property">abilityInfo</span>.<span class="hljs-property">bundleName</span>,
          <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"EntryAbility"</span>
        }
      ],
      <span class="hljs-comment">// 指定点击通知栏消息后的动作是拉起ability</span>
      <span class="hljs-attr">actionType</span>: wantAgent.<span class="hljs-property">OperationType</span>.<span class="hljs-property">START_ABILITY</span>,
      <span class="hljs-comment">// 使用者自定义的一个私有值</span>
      <span class="hljs-attr">requestCode</span>: <span class="hljs-number">0</span>,
      <span class="hljs-comment">// 点击通知后，动作执行属性</span>
      <span class="hljs-attr">actionFlags</span>: [wantAgent.<span class="hljs-property">WantAgentFlags</span>.<span class="hljs-property">UPDATE_PRESENT_FLAG</span>],
      <span class="hljs-comment">// 车钥匙长时任务子类型。只有申请bluetoothInteraction类型的长时任务，车钥匙子类型才能生效。</span>
      <span class="hljs-comment">// 确保extraInfo参数中的Key值为backgroundTaskManager.BackgroundModeType.SUB_MODE，否则子类型不生效。</span>
      <span class="hljs-comment">// extraInfo: { [backgroundTaskManager.BackgroundModeType.SUB_MODE] : backgroundTaskManager.BackgroundSubMode.CAR_KEY }</span>
    };

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 通过wantAgent模块下getWantAgent方法获取WantAgent对象</span>
      wantAgent.<span class="hljs-title function_">getWantAgent</span>(wantAgentInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">wantAgentObj: WantAgent</span>) =&gt;</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// let list: Array&lt;string&gt; = ["audioRecording"];</span>
          <span class="hljs-comment">// let list: Array&lt;string&gt; = ["bluetoothInteraction"]; 长时任务类型包含bluetoothInteraction，CAR_KEY子类型合法</span>
          backgroundTaskManager.<span class="hljs-title function_">startBackgroundRunning</span>(<span class="hljs-title function_">getContext</span>(), list, wantAgentObj).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: backgroundTaskManager.ContinuousTaskNotification</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Operation startBackgroundRunning succeeded"</span>);
            <span class="hljs-comment">// 此处执行具体的长时任务逻辑，如录音，录制等。</span>
            <span class="hljs-comment">// 写尝试任务</span>
            <span class="hljs-title function_">callback</span>()
          }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation startBackgroundRunning. code is <span class="hljs-subst">${error.code}</span> message is <span class="hljs-subst">${error.message}</span>`</span>);
          });
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation startBackgroundRunning. code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span> message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);
        }
      });
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation getWantAgent. code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span> message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);
    }

  }
  <span class="hljs-comment">// 长任务-关闭</span>
  <span class="hljs-title function_">stopLongTask</span>(<span class="hljs-params"/>) {
    backgroundTaskManager.<span class="hljs-title function_">stopBackgroundRunning</span>(<span class="hljs-title function_">getContext</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in operationing stopBackgroundRunning.`</span>);
    }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to operation stopBackgroundRunning. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);
    });
  }

  <span class="hljs-comment">// 短任务-开启</span>
  <span class="hljs-comment">// 短任务-关闭</span>
}

<span class="hljs-keyword">export</span>  <span class="hljs-keyword">const</span> backgroundTaskUtil = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BackgroundTaskUtil</span>()
</code></pre>
<ul>
<li>示例代码</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;
<span class="hljs-keyword">import</span> { abilityAccessCtrl } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { permissionUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/PermissionUtil'</span>;
<span class="hljs-keyword">import</span> { backgroundTaskUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/BackgroundTaskUtil'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {

  <span class="hljs-title function_">locationCallback</span>(<span class="hljs-params">location:geoLocationManager.Location</span>)  {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'locationCallback: data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(location));
  }

  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"/>) {
    geoLocationManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'locationChange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">locationCallback</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'获取位置信息'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-comment">// 1 配置文件 申请权限   同时申请ohos.permission.APPROXIMATELY_LOCATION和ohos.permission.LOCATION 获取到精准位置，精准度在米级别。</span>
      <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> permissionUtil.<span class="hljs-title function_">checkPermissions</span>([<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>, <span class="hljs-string">'ohos.permission.LOCATION'</span>], <span class="hljs-title function_">getContext</span>());
      <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>

      <span class="hljs-comment">// 2 检查全局开关  开了-继续走，没开-弹出让他授权</span>
      <span class="hljs-keyword">const</span> locationEnabled = geoLocationManager.<span class="hljs-title function_">isLocationEnabled</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'查看当前全局开关状态：'</span>, locationEnabled)

      <span class="hljs-keyword">if</span> (!locationEnabled) {  <span class="hljs-comment">// 没开</span>
        <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestGlobalSwitch</span>(<span class="hljs-title function_">getContext</span>(), abilityAccessCtrl.<span class="hljs-property">SwitchType</span>.<span class="hljs-property">LOCATION</span>)
        <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">return</span>  <span class="hljs-comment">// 拉起全局弹出 用户没授权就终止代码执行</span>
      }

      <span class="hljs-comment">// 3. 获取位置信息  经度纬度 【持续定位。多用于导航、运动轨迹、出行等场景。】</span>
      backgroundTaskUtil.<span class="hljs-title function_">startLongTask</span>([<span class="hljs-string">'location'</span>], <span class="hljs-function">() =&gt;</span> {
        geoLocationManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'locationChange'</span>, {
          <span class="hljs-attr">interval</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">locationScenario</span>: geoLocationManager.<span class="hljs-property">UserActivityScenario</span>.<span class="hljs-property">NAVIGATION</span>
        }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">locationCallback</span>);
      })
      <span class="hljs-comment">// .....</span>
    })
  }
}
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2F0a0a956faec348ddaa9b2676a3f19545%3Ftype%3D1%3Fha_source%3Dhmosclass%26ha_sourceId%3D89000248" title="https://developer.huawei.com/consumer/cn/training/classDetail/0a0a956faec348ddaa9b2676a3f19545?type=1?ha_source=hmosclass&amp;ha_sourceId=89000248" target="_blank" ref="nofollow noopener noreferrer">鸿蒙开发者班级</a></p>
<p>✨家人们点个juejin账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>✨家人们点个juejin账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>✨家人们点个juejin账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>    ^_^ 点关注、不迷路、主播带你学技术 (๑′ᴗ‵๑)Ｉ Lᵒᵛᵉᵧₒᵤ❤</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS 帧动画 animator]]></title>    <link>https://juejin.cn/post/7576953459544342582</link>    <guid>https://juejin.cn/post/7576953459544342582</guid>    <pubDate>2025-11-27T05:25:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576953459544342582" data-draft-id="7576994308273225747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS 帧动画 animator"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-27T05:25:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT充电站"/> <meta itemprop="url" content="https://juejin.cn/user/125809758576431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS 帧动画 animator
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/125809758576431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT充电站
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:25:28.000Z" title="Thu Nov 27 2025 05:25:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>就是类似播放电影一样，一帧一帧的进行播放，相对于属性动画，其每一帧，我们都可以进行设置相关的属性值，并且具有暂停播放，继续播放的优点，而且还具备事件的实时响应，需要说明的是，在性能上是远远不如属性动画的，所以如果能用属性动画实现的场景，还是主推属性动画</p>
<ul>
<li>需要控制动画播放暂停：音乐播放、或者运动小车</li>
<li>翻页动画</li>
</ul>
<h2 data-id="heading-0">基础使用</h2>
<ul>
<li>
<p>创建帧动画   this.animator =   Animator.create()</p>
</li>
<li>
<p>每一帧回调    this.animator.onFrame=fn</p>
</li>
<li>
<p>控制           this.animator.play/pause()</p>
</li>
</ul>
<h5 data-id="heading-1">示例代码1</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">Animator</span>, <span class="hljs-selector-tag">AnimatorResult</span> } <span class="hljs-selector-tag">from</span> '@<span class="hljs-selector-tag">kit</span><span class="hljs-selector-class">.ArkUI</span>'

@<span class="hljs-selector-tag">Entry</span>
@<span class="hljs-selector-tag">Component</span>
<span class="hljs-selector-tag">struct</span> <span class="hljs-selector-tag">Index</span> {
  <span class="hljs-comment">// 1. 创建帧动画</span>
  <span class="hljs-variable">@State</span> <span class="hljs-attribute">animator</span>:AnimatorResult  = Animator.<span class="hljs-built_in">create</span>({
    <span class="hljs-attribute">duration</span>: <span class="hljs-number">3000</span>, <span class="hljs-comment">//动画播放的时长</span>
    <span class="hljs-attribute">delay</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">//动画延时播放时长</span>
    <span class="hljs-attribute">easing</span>: <span class="hljs-string">'linear'</span>, <span class="hljs-comment">//动画插值曲线</span>
    <span class="hljs-attribute">iterations</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">//动画播放次数</span>
    <span class="hljs-attribute">fill</span>: <span class="hljs-string">"forwards"</span>, <span class="hljs-comment">//动画执行后是否恢复到初始状态</span>
    <span class="hljs-attribute">direction</span>: <span class="hljs-string">'normal'</span>, <span class="hljs-comment">//动画播放模式</span>
    <span class="hljs-attribute">begin</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">//动画插值起点</span>
    <span class="hljs-attribute">end</span>: <span class="hljs-number">100</span><span class="hljs-comment">//动画插值终点</span>
  })

  <span class="hljs-variable">@State</span> <span class="hljs-attribute">translateX</span>: number = <span class="hljs-number">0</span>
  <span class="hljs-variable">@State</span> <span class="hljs-attribute">translateY</span>: number = <span class="hljs-number">0</span>

  <span class="hljs-built_in">aboutToAppear</span>(): void {
    <span class="hljs-comment">// 2.每一帧回调</span>
    <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.animator</span><span class="hljs-selector-class">.onFrame</span> = (<span class="hljs-attribute">progress</span>: number) =&gt; {
      <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.translateX</span> = <span class="hljs-selector-tag">progress</span>
    }
  }

  <span class="hljs-selector-tag">build</span>() {
    <span class="hljs-selector-tag">Column</span>({space:20}) {

      <span class="hljs-selector-tag">Text</span>(<span class="hljs-string">"1"</span>)<span class="hljs-selector-class">.width</span>(<span class="hljs-number">30</span>)<span class="hljs-selector-class">.height</span>(<span class="hljs-number">30</span>)<span class="hljs-selector-class">.backgroundColor</span>(Color.Red)<span class="hljs-selector-class">.textAlign</span>(TextAlign.Center)<span class="hljs-selector-class">.margin</span>({ <span class="hljs-attribute">top</span>: <span class="hljs-number">100</span> })
        <span class="hljs-selector-class">.translate</span>({ x: this.translateX, y: this.translateY })

      <span class="hljs-selector-tag">Button</span>(<span class="hljs-string">"播放"</span>)<span class="hljs-selector-class">.onClick</span>(() =&gt; this.animator.<span class="hljs-built_in">play</span>() )
      <span class="hljs-selector-tag">Button</span>(<span class="hljs-string">"暂停"</span>)<span class="hljs-selector-class">.onClick</span>(() =&gt;  this.animator.<span class="hljs-built_in">pause</span>() )
      <span class="hljs-selector-tag">Button</span>(<span class="hljs-string">"重置"</span>)<span class="hljs-selector-class">.onClick</span>(() =&gt; {
        <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.translateX</span> = <span class="hljs-number">0</span>
        <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.translateY</span> = <span class="hljs-number">0</span>
      })
    }
    <span class="hljs-selector-class">.height</span>(<span class="hljs-string">'100%'</span>)
    <span class="hljs-selector-class">.width</span>(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<h2 data-id="heading-2">示例代码2：实战音乐播放器</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Animator</span>, <span class="hljs-title class_">AnimatorResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">angle</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>

  <span class="hljs-comment">// 1 创建帧动画对象</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">animator</span>: <span class="hljs-title class_">AnimatorResult</span> = <span class="hljs-title class_">Animator</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">duration</span>: <span class="hljs-number">10000</span>,  <span class="hljs-comment">//   持续时间</span>
    <span class="hljs-attr">delay</span>: <span class="hljs-number">0</span>,         <span class="hljs-comment">//   延迟时间</span>
    <span class="hljs-attr">easing</span>: <span class="hljs-string">"linear"</span>, <span class="hljs-comment">//   动画曲线</span>
    <span class="hljs-attr">iterations</span>: -<span class="hljs-number">1</span>,   <span class="hljs-comment">//   播放次数</span>
    <span class="hljs-attr">fill</span>: <span class="hljs-string">"none"</span>,     <span class="hljs-comment">//   播放模式 播放之外的状态</span>
    <span class="hljs-attr">direction</span>: <span class="hljs-string">"normal"</span>, <span class="hljs-comment">//   播放方向</span>
    <span class="hljs-attr">begin</span>: <span class="hljs-number">0</span>,   <span class="hljs-comment">// 开始角度</span>
    <span class="hljs-attr">end</span>: <span class="hljs-number">360</span> <span class="hljs-comment">// 结束角度</span>
  })

  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">//   2 监听帧变化事件</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">animator</span>.<span class="hljs-property">onFrame</span> = <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">angle</span> = value
    }
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'开始'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">event: ClickEvent</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">animator</span>.<span class="hljs-title function_">play</span>()
      })
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'暂停'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">event: ClickEvent</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">animator</span>.<span class="hljs-title function_">pause</span>()
      })
      <span class="hljs-title class_">Stack</span>() {
        <span class="hljs-title class_">Image</span>(<span class="hljs-string">"https://p6.music.126.net/obj/wonDlsKUwrLClGjCm8Kx/28513831157/e8e9/beeb/912c/468bcb523668065ccf6f853c4a084e31.png"</span>)
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)

        <span class="hljs-title class_">Image</span>(<span class="hljs-string">"https://p1.music.126.net/MX4wNwR9eJNvx_Y5AKBEFw==/109951169909770184.jpg?imageView&amp;thumbnail=360y360&amp;quality=75&amp;tostatic=0"</span>)
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)
          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">200</span>)
          .<span class="hljs-title function_">rotate</span>({
            <span class="hljs-attr">angle</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">angle</span>
          })

      }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    }
  }
}

</code></pre>
<h2 data-id="heading-3">示例代码3：图片帧动画</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references%2Fts-basic-components-imageanimator%23%25E7%25A4%25BA%25E4%25BE%258B1%25E6%2592%25AD%25E6%2594%25BEresource%25E5%258A%25A8%25E7%2594%25BB" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-imageanimator#%E7%A4%BA%E4%BE%8B1%E6%92%AD%E6%94%BEresource%E5%8A%A8%E7%94%BB" ref="nofollow noopener noreferrer">developer.huawei.com/consumer/cn…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jq22.com%2Fyanshi24013" target="_blank" title="https://www.jq22.com/yanshi24013" ref="nofollow noopener noreferrer">www.jq22.com/yanshi24013</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jq22.com%2Fdemo%2FimgAni202108230153%2Fimg%2F611e2b5c8fcd2.png" target="_blank" title="https://www.jq22.com/demo/imgAni202108230153/img/611e2b5c8fcd2.png" ref="nofollow noopener noreferrer">www.jq22.com/demo/imgAni…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2F0a0a956faec348ddaa9b2676a3f19545%3Ftype%3D1%3Fha_source%3Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/0a0a956faec348ddaa9b2676a3f19545?type=1?ha_source=hmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">鸿蒙开发班级</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS 组件导航（Navigation）]]></title>    <link>https://juejin.cn/post/7576955345378426943</link>    <guid>https://juejin.cn/post/7576955345378426943</guid>    <pubDate>2025-11-27T05:22:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576955345378426943" data-draft-id="7576953459544293430" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS 组件导航（Navigation）"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-27T05:22:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT充电站"/> <meta itemprop="url" content="https://juejin.cn/user/125809758576431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS 组件导航（Navigation）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/125809758576431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT充电站
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:22:47.000Z" title="Thu Nov 27 2025 05:22:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>✨家人们记得点个账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<h2 data-id="heading-0">组件导航（Navigation）</h2>
<p><strong>Navigation是路由容器组件，一般作为首页的根容器</strong>，包括单栏(Stack)、分栏(Split)和自适应(Auto)三种显示模式。Navigation组件适用于模块内和跨模块的路由切换，<strong>一次开发，多端部署场景</strong>。通过组件级路由能力实现更加自然流畅的转场体验，并提供多种标题栏样式来呈现更好的标题和内容联动效果。在不同尺寸的设备上，Navigation组件能够自适应显示大小，自动切换分栏展示效果。</p>
<ul>
<li>模块内、和跨模块实现路由切换</li>
<li>一次开发，多端部署场景</li>
<li>通过组件级路由能力实现更加自然流畅的转场体验</li>
<li>更好的标题、tabBar等等联动效果</li>
<li>等等</li>
</ul>
<h3 data-id="heading-1">2.1 Navigation属性</h3>
<pre><code class="hljs language-plain" lang="plain">@Entry
@Component
struct Index {
  build() {
    Navigation() {

    }
      .title("主标题")
      .mode()
      .toolbarConfiguration()
      .menus()
  }
}
</code></pre>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a35e8cb486c548f58d6cd679d206bdbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTlhYXnlLXnq5k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825766&amp;x-signature=1BELIzfK9%2FsamvrTX%2F9ZWVSZ6uA%3D" height="600" loading="lazy"/> 
<h4 data-id="heading-2">title 设置标题</h4>
<p>显示在这个主标题的位置</p>
<h4 data-id="heading-3">titleMode 标题栏模式</h4>
<p>标题栏在界面顶部，用于呈现界面名称和操作入口，Navigation组件通过titleMode属性设置标题栏模式</p>
<ul>
<li>Mini模式：普通型标题栏，用于一级页面不需要突出标题的场景</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b32f7f788a92418db94235561541f02f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTlhYXnlLXnq5k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825766&amp;x-signature=tMsfFeHoRHHSv7gE4S4h5ynagj8%3D" alt="img" loading="lazy"/></p>
<ul>
<li>Full模式：强调型标题栏，用于一级页面需要突出标题的场景。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7395ff86fbff46428f6a904716b2aa2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTlhYXnlLXnq5k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825766&amp;x-signature=gS3UCLZQAqzkp9YAeWP0KvbcKd4%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-4">mode 设置模式</h4>
<p>Navigation是路由容器组件，一般作为首页的根容器，包括单栏(Stack)、分栏(Split)和自适应(Auto)三种显示模式.Navigation组件适用于模块内和跨模块的路由切换，一次开发，多端部署场景</p>
<p>Navigation组件通过mode属性设置页面的显示模式。自适应模式下，当页面宽度大于等于一定阈值( API version 9及以前：520vp，API version 10及以后：600vp )时，Navigation组件采用分栏模式，反之采用单栏模式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb19ad267832450e8d6e6b1ff2f759bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTlhYXnlLXnq5k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825766&amp;x-signature=YXgPw0YARFXlraefEdG1B0%2FHRwk%3D" alt="img" loading="lazy"/></p>
<p>将mode属性设置为NavigationMode.Stack，Navigation组件即可设置为单页面显示模式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38e8d26224fd4b30ae9efd76d6f10294~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTlhYXnlLXnq5k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825766&amp;x-signature=GN5aLdEa%2B%2B3C9Bj0VLqKDASXCTk%3D" alt="img" loading="lazy"/></p>
<p>将mode属性设置为NavigationMode.Split，Navigation组件即可设置为分页面显示模式。</p>
<h4 data-id="heading-5">toolbarConfiguration 底层标题栏</h4>
<p>.toolbarConfiguration() 里面设置的是一个数组，数组里面每个元素ToolbarItem类型，数据的结构如下</p>
<pre><code class="hljs language-plain" lang="plain">{
    value: "我的",
    icon: "https://s1.aigei.com/src/img/png/e7/e79cacc5161a4a6ca589e097f87a2526.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:TLXitIEF_QaGqfeKVbpaGb8_qyQ=",
    action: () =&gt; {

    },
    activeIcon: "",
    status: ToolbarItemStatus.DISABLED,

}
</code></pre>
<p>value 就是显示的文字</p>
<p>icon 显示的图标</p>
<p>action 当点击时触发做某些事情，例如跳转路由</p>
<p>activeIcon 激活时的图标</p>
<p>status 当前图标的状态，例如不可用等等</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a26629542d1641dfa26ca2ee3e91a355~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTlhYXnlLXnq5k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825766&amp;x-signature=0V6b2n%2BoTjN%2Bhk8h4cQ%2FB%2F8BVW4%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-6">menus 菜单栏</h4>
<p>菜单栏位于Navigation组件的右上角，开发者可以通过menus属性进行设置。menus支持Array和CustomBuilder两种参数类型。使用Array类型时，竖屏最多支持显示3个图标，横屏最多支持显示5个图标，多余的图标会被放入自动生成的更多图标。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa20fea36cb44b7cb3f1310741671bd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTlhYXnlLXnq5k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825766&amp;x-signature=gDkqLMN4TqMkazO2RdP0BWRuAzQ%3D" alt="img" loading="lazy"/></p>
<pre><code class="hljs language-plain" lang="plain">{
    value: "我的",
    icon: "https://s1.aigei.com/src/img/png/e7/e79cacc5161a4a6ca589e097f87a2526.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:TLXitIEF_QaGqfeKVbpaGb8_qyQ=",
    action: () =&gt; {

    },
   isEnabled:false

}
</code></pre>
<p>value 就是显示的文字</p>
<p>icon 显示的图标</p>
<p>action 当点击时触发做某些事情，例如跳转路由</p>
<p>isEnabled 是否可用</p>
<ul>
<li>示例代码（全部）</li>
</ul>
<pre><code class="hljs language-arkts" lang="arkts">@Entry
@Component
struct Index {
  build() {
    Navigation() {

    }
    .title("主标题")
      .mode(NavigationMode.Stack)
      .titleMode(NavigationTitleMode.Free)
      .toolbarConfiguration([
        {
          value: "我的",
          icon: "https://s1.aigei.com/src/img/png/e7/e79cacc5161a4a6ca589e097f87a2526.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:TLXitIEF_QaGqfeKVbpaGb8_qyQ=",
          action: () =&gt; {

          },

        },
        {
          value: "购物车",
          icon: "https://s1.aigei.com/src/img/png/5d/5dc2f07ba8224cd4883648c9ea939ac5.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:Q5dD_6ZS_ry4kaVXHgv6gnKw2IQ=",
          action: () =&gt; {

          }
        },
        {
          value: "更多",
          icon: "https://s1.aigei.com/src/img/png/03/03d71ede7b404e70838f3d575b31a930.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:ABookBJ6PVBeSxtM2hEuQHPlGLE=",
          action: () =&gt; {

          }
        }
      ])
      .menus([
        {
          value: "设置",
          icon: "https://s1.4sai.com/src/img/png/6c/6ca77e26c31548e680b784ab33f72900.png?e=1735488000&amp;token=1srnZGLKZ0Aqlz6dk7yF4SkiYf4eP-YrEOdM1sob:9x9bgI9kDs15UsWPzGN7ZuaICXM=",
          action: () =&gt; {

          },
        },
        {
          value: "小红书",
          icon: "https://s1.aigei.com/src/img/png/3e/3e3bda0ac48046b08e560e8764942bd8.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:JPuRl9bkD4UfIc8fGN4ApLuS_rE=",
          action: () =&gt; {

          }
        },
        {
          value: "微信",
          icon: "https://s1.aigei.com/src/img/png/ef/efd714270fdd44f485156053901ecb51.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:GfcdaqAj6Uie-yCw4Wt1pPqAGwg=",
          action: () =&gt; {

          }
        },
        {
          value: "抖音",
          icon: "https://s1.aigei.com/src/img/png/5b/5b26e982f0b34c47817d3b40c9bf2d1f.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:YCO6IvUtFIqf6x1hmy82VctIElo=",
          action: () =&gt; {

          }
        }
      ])
  }
}
</code></pre>
<h3 data-id="heading-7">2.2 NavRouter</h3>
<p>导航组件，默认提供点击响应处理，不需要开发者自定义点击事件逻辑。</p>
<p>必须包含两个子组件，其中第二个子组件必须为NavDestination。</p>
<p>其中第一个组件是需要点击的元素</p>
<p>第二个必须是NavDestination</p>
<pre><code class="hljs language-plain" lang="plain">@Entry
@Component
struct Index {
  build() {
    Navigation() {

      // NavRouter() {
      //   Text('菜单1')
      //   NavDestination() {
      //     Text('内容1')
      //   }
      // }
      //
      //
      // NavRouter() {
      //   Text('菜单2')
      //   NavDestination() {
      //     Text('内容2')
      //   }
      // }

      ForEach('123'.split(''), (item: number) =&gt; {
        NavRouter() {
          // 这里是点击的内容
          Column() {
            Text("文本" + item)
              .width("85%")
              .height(60)
              .backgroundColor("#ccc")
              .borderRadius(25)
              .margin({ top: 10 })
              .textAlign(TextAlign.Center)
          }
          // 这里是跳转显示的页面
          NavDestination() {
            Text("文本" + item).fontSize(30).fontColor("red")
          }.title("标题" + item).hideTitleBar(false)
        }.mode(NavRouteMode.PUSH)
      })


    }.mode(NavigationMode.Split)
  }
}
</code></pre>
<p>这里有一个属性</p>
<h4 data-id="heading-8">mode(mode: NavRouteMode)</h4>
<p>设置指定点击NavRouter跳转到NavDestination页面时，使用的路由模式</p>
<p>PUSH_WITH_RECREATE 跳转到新的NavDestination页面时，替换当前显示的NavDestination页面，页面销毁，但该页面信息仍保留在路由栈中。</p>
<p>PUSH 跳转到新的NavDestination页面时，覆盖当前显示的NavDestination页面，该页面不销毁，且页面信息保留在路由栈中。</p>
<p>REPLACE 跳转到新的NavDestination页面时，替换当前显示的NavDestination页面，页面销毁，且该页面信息从路由栈中清除。</p>
<p>还有一个事件</p>
<h4 data-id="heading-9">onStateChange(callback: (isActivated: boolean) =&gt; void)</h4>
<p>组件激活状态切换时触发该回调。开发者点击激活NavRouter，加载对应的NavDestination子组件时，回调onStateChange(true)。NavRouter对应的NavDestination子组件不再显示时，回调onStateChange(false)。</p>
<p>最后效果</p>
<pre><code class="hljs language-plain" lang="plain">@Entry
  @Component
  struct Index {
    pageStack: NavPathStack = new NavPathStack();
    @State list: Array&lt;number&gt; = [1, 2, 3]

    build() {
      Navigation(this.pageStack) {
        ForEach(this.list, (item: number) =&gt; {
          NavRouter() {
            Column() {
              Text("文本" + item)
                .width("85%")
                .height(60)
                .backgroundColor("#ccc")
                .borderRadius(25)
                .margin({ top: 10 })
                .textAlign(TextAlign.Center)
            }

            NavDestination() {
              Text("文本" + item)
                .fontSize(30)
                .fontColor("red")
            }.title("标题" + item)

          }.mode(NavRouteMode.PUSH)
                .onStateChange((isActivated: boolean) =&gt; {
                   console.log(item + "激活：" + isActivated)
          })
        })
      }
      .title("主标题")
        .mode(NavigationMode.Stack)
        .titleMode(NavigationTitleMode.Free)
        .toolbarConfiguration([
          {
            value: "我的",
            icon: "https://s1.aigei.com/src/img/png/e7/e79cacc5161a4a6ca589e097f87a2526.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:TLXitIEF_QaGqfeKVbpaGb8_qyQ=",
            action: () =&gt; {
              this.pageStack.pushPath({ name: "pageOne", param: "aaa" })
            },

          },
          {
            value: "购物车",
            icon: "https://s1.aigei.com/src/img/png/5d/5dc2f07ba8224cd4883648c9ea939ac5.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:Q5dD_6ZS_ry4kaVXHgv6gnKw2IQ=",
            action: () =&gt; {

            }
          },
          {
            value: "更多",
            icon: "https://s1.aigei.com/src/img/png/03/03d71ede7b404e70838f3d575b31a930.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:ABookBJ6PVBeSxtM2hEuQHPlGLE=",
            action: () =&gt; {

            }
          }
        ])
        .menus([
          {
            value: "设置",
            icon: "https://s1.4sai.com/src/img/png/6c/6ca77e26c31548e680b784ab33f72900.png?e=1735488000&amp;token=1srnZGLKZ0Aqlz6dk7yF4SkiYf4eP-YrEOdM1sob:9x9bgI9kDs15UsWPzGN7ZuaICXM=",
            action: () =&gt; {

            },
          },
          {
            value: "小红书",
            icon: "https://s1.aigei.com/src/img/png/3e/3e3bda0ac48046b08e560e8764942bd8.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:JPuRl9bkD4UfIc8fGN4ApLuS_rE=",
            action: () =&gt; {

            }
          },
          {
            value: "微信",
            icon: "https://s1.aigei.com/src/img/png/ef/efd714270fdd44f485156053901ecb51.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:GfcdaqAj6Uie-yCw4Wt1pPqAGwg=",
        action: () =&gt; {

        }
      },
      {
        value: "抖音",
        icon: "https://s1.aigei.com/src/img/png/5b/5b26e982f0b34c47817d3b40c9bf2d1f.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:YCO6IvUtFIqf6x1hmy82VctIElo=",
        action: () =&gt; {

        }
      }
    ])
  }
}
</code></pre>
<h3 data-id="heading-10">2.3  独立的NavDestination</h3>
<p>切记独立的NavDestination不能通过NavRouter跳转 它也被弃用了，只能通过 NavPathStack创建一个路由栈对象，</p>
<p>然后通过路由栈对象控制页面跳转</p>
<h4 data-id="heading-11">具体实现</h4>
<p>1、Profile.ets 把页面内容NavDestination独立出去</p>
<pre><code class="hljs language-plain" lang="plain">@Component
export struct Profile {
  build() {
    NavDestination() { // 根元素必须是NavDestination
      Column() {
        Text("实际的内容")
      }
    }
    .title("标题")
  }
}
</code></pre>
<p>2、Navigation通过属性关联Profile页面</p>
<pre><code class="hljs language-plain" lang="plain">import {Profile} from './Profile'

@Entry
@Component
export struct Index {

  @Builder PagesMap(name: string) {
    if (name === "Profile") {
      Profile()
    }
  }

  pageStack: NavPathStack = new NavPathStack()  // 页面栈对象 管理页面栈里面的网页

  build() {
    Navigation(this.pageStack) {
      Button('跳转到Cart页面').onClick(() =&gt; {
        this.pageStack.pushPathByName('Profile', null)
        // this.pageStack.pushPath({ name: "Profile", param: "实际需要显示的内容" })
      })
    }
    .title("主标题")
    .mode(NavigationMode.Stack)
    .navDestination(this.PagesMap) // 通过属性的方式动态设置
  }
}
</code></pre>
<p>3、控制跳转（之前没有独立NavRouter 独立之后必须通过Navigation提供的<strong>页面栈对象</strong>来操作</p>
<pre><code class="hljs language-plain" lang="plain">3.1 创建页面栈

pageStack: NavPathStack = new NavPathStack(); // 创建页面栈实例化对象  控制页面栈路由增删改等
 
3.2 注册关联
Navigation(this.pageStack) {

3.3  跳转
https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-navigation-navigation-V5#%E8%B7%AF%E7%94%B1%E6%93%8D%E4%BD%9C
</code></pre>
<h4 data-id="heading-12">NavDestination的模式</h4>
<p>NavDestination的mode属性有两种值</p>
<p>标准类型 NavDestinationMode.STANDARD</p>
<p>标准类型的NavDestination的生命周期跟随其在NavPathStack页面栈中的位置变化而改变。</p>
<p>弹窗类型 NavDestinationMode.DIALOG</p>
<p>整个NavDestination默认透明显示。弹窗类型的NavDestination显示和消失时不会影响下层标准类型的NavDestination的显示和生命周期，两者可以同时显示。</p>
<p>下面处理一个弹窗问题</p>
<pre><code class="hljs language-plain" lang="plain">@Component
export  struct DialogPage {
  @Consume pageStack: NavPathStack;
  param: string = ""

  build() {
    NavDestination() {
      Column() {
        Stack({ alignContent: Alignment.TopEnd }) {
          Text(this.param)
            .fontSize(30)
            .fontColor("red")
            .textAlign(TextAlign.Center)
            .width("100%")
            .margin({ top: 80 })
          Button("×").onClick(() =&gt; {
            this.pageStack.pop();
          })
        }.width("70%")
          .height("30%")
          .backgroundColor("white")
          .borderRadius(30)
      }.justifyContent(FlexAlign.Center)
        .alignItems(HorizontalAlign.Center)
        .width("100%")
        .height("100%")
    }
    .backgroundColor("rgba(0,0,0,0.5)")
      .mode(NavDestinationMode.DIALOG)
      .title("标题")
      .hideTitleBar(true)
  }
}
import { DialogPage } from '../components/DialogPage';


@Entry
  @Component
  struct Index {
    @Provide pageStack: NavPathStack = new NavPathStack();

    @Builder
    PagesMap(name: string, param: string) {
      if (name === "dialogPage") {
        DialogPage({ param: param })
      }
    }

    build() {
      Navigation(this.pageStack) {

      }
      .title("主标题")
        .mode(NavigationMode.Stack)
        .titleMode(NavigationTitleMode.Free)
        .navDestination(this.PagesMap)
        .toolbarConfiguration([
          {
            value: "我的",
            icon: "https://s1.aigei.com/src/img/png/e7/e79cacc5161a4a6ca589e097f87a2526.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:TLXitIEF_QaGqfeKVbpaGb8_qyQ=",
            action: () =&gt; {
              this.pageStack.pushPath({ name: "dialogPage", param: "aaa" })
            },

          },
          {
            value: "购物车",
            icon: "https://s1.aigei.com/src/img/png/5d/5dc2f07ba8224cd4883648c9ea939ac5.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:Q5dD_6ZS_ry4kaVXHgv6gnKw2IQ=",
            action: () =&gt; {

            }
          },
          {
            value: "更多",
            icon: "https://s1.aigei.com/src/img/png/03/03d71ede7b404e70838f3d575b31a930.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:ABookBJ6PVBeSxtM2hEuQHPlGLE=",
            action: () =&gt; {

            }
          }
        ])
    }
  }
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b9a79a603714bab968b1c4b20460ccf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTlhYXnlLXnq5k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764825766&amp;x-signature=IaczK3cVsvnc6Wbm3XOYfVLxB7c%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-13">2.4 NavPathStack</h3>
<p>NavPathStrack是<strong>页面栈</strong>为路由跳转提供的方法对象，每个Navigation都需要创建并传入一个NavPathStack对象，用于管理页面。主要涉及页面跳转、页面返回、页面替换、页面删除、参数获取、路由拦截等功能。</p>
<p>pageStack: NavPathStack = new NavPathStack()</p>
<h4 data-id="heading-14">普通跳转</h4>
<pre><code class="hljs language-plain" lang="plain">this.pageStack.pushPath({ name: "DialogPage", param: "aaa" })
this.pageStack.pushPathByName("DialogPage", "aaa")
</code></pre>
<p>这两种方法都可以使用</p>
<h4 data-id="heading-15">带返回回调的跳转，跳转时添加onPop回调,能在页面出栈时获取返回信息</h4>
<pre><code class="hljs language-plain" lang="plain">this.pageStack.pushPath({
  name: "DialogPage", param: "aaa", onPop: (popInfo) =&gt; {
    Logger.log(popInfo.result)
  }
})
</code></pre>
<p>关闭退回时通过pop传回的数据</p>
<pre><code class="hljs language-plain" lang="plain">Button("×").onClick(() =&gt; {
  this.pageStack.pop("返回的内容")
})
</code></pre>
<h4 data-id="heading-16">页面返回</h4>
<pre><code class="hljs language-plain" lang="plain">// 返回到上一页
this.pageStack.pop()
// 返回到上一个PageOne页面
this.pageStack.popToName("PageOne")
// 返回到索引为1的页面
this.pageStack.popToIndex(1)
// 返回到根首页（清除栈中所有页面）
this.pageStack.clear()
</code></pre>
<h4 data-id="heading-17">页面替换</h4>
<pre><code class="hljs language-plain" lang="plain">// 将栈顶页面替换为PageOne
this.pageStack.replacePath({ name: "PageOne", param: "PageOne Param" })
this.pageStack.replacePathByName("PageOne", "PageOne Param")
</code></pre>
<h4 data-id="heading-18">页面删除</h4>
<pre><code class="hljs language-plain" lang="plain">// 删除栈中name为PageOne的所有页面
this.pageStack.removeByName("PageOne")
// 删除指定索引的页面
this.pageStack.removeByIndexes([1,3,5])
</code></pre>
<h4 data-id="heading-19">参数获取</h4>
<pre><code class="hljs language-plain" lang="plain">// 获取栈中所有页面name集合
this.pageStack.getAllPathName()
// 获取索引为1的页面参数
this.pageStack.getParamByIndex(1)
// 获取PageOne页面的参数
this.pageStack.getParamByName("PageOne")
// 获取PageOne页面的索引集合
this.pageStack.getIndexByName("PageOne")
</code></pre>
<h4 data-id="heading-20">路由拦截</h4>
<p>在页面的初始生命周期中设置</p>
<pre><code class="hljs language-plain" lang="plain">aboutToAppear(): void {
  this.pageStack.setInterception({
  willShow: (from: NavDestinationContext | NavBar, to: NavDestinationContext | NavBar,
       operation: NavigationOperation, isAnimated: boolean) =&gt; {
         if (typeof to === "string") return; 
         if (to.pathInfo.name === "dialogPage") {
           to.pathStack.pop();
           to.pathStack.pushPath({ name: "page1", param: "bbbb" })
         }
       }
  })
}
</code></pre>
<h3 data-id="heading-21">2.5  跨包动态路由-系统路由表</h3>
<h4 data-id="heading-22">准备生成Navigation的route_map路由</h4>
<p>a）给模块创建系统路由表 （也就是针对于Navigation以后还是通过配置文件生成路由）</p>
<p>创建resources/base/profile/route_map.json（<code>切记route不加r</code>）路由配置文件，填写下述代码</p>
<pre><code class="hljs language-plain" lang="plain">{
  "routerMap": [
    {
      # 路由名  也就是跳转名
      "name": "Home或者Profile",    
      # 改名字对应的页面 
      "pageSourceFile": "src/main/ets/pages/Profile.ets",     
      
      # 切记MainPage.ets这个文件必须用MainPageBuilder当做入口（比较抽象跟着写  写完反过来看才能理解）
      "buildFunction": "MainPageBuilder",    
      "data": {
        "description" : "this is PageOne"
      }
    }
  ]
}
</code></pre>
<p>b）让创建route_map.json生效 也就是跟模块绑定</p>
<p>修改模块的<code>module.json5</code>文件 <code>"routerMap": "$profile:route_map",</code></p>
<pre><code class="hljs language-plain" lang="plain">{
  "module": {
  
    "routerMap": "$profile:route_map",
    
    "name": "cartHar",
    "type": "har",
    "deviceTypes": [
      "default",
      "tablet",
      "2in1"
    ]
  }
}
</code></pre>
<h4 data-id="heading-23">后续创建页面跳转</h4>
<p>a）必须按照下述格式创建页面</p>
<pre><code class="hljs language-scss" lang="scss">按照系统路由表需要的组件格式修改组件 `<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/ets/components/MainPage<span class="hljs-selector-class">.ets</span>`

```plain
<span class="hljs-comment">// 跳转页面入口函数</span>
<span class="hljs-keyword">@Builder</span>
export function MainPageBuilder() {  <span class="hljs-comment">// 细节2：按照这个格式配置</span>
  <span class="hljs-built_in">MainPage</span>()
}


<span class="hljs-keyword">@Component</span>
struct MainPage { <span class="hljs-comment">// 细节1.1：不用导出  但是必须按照上述配置</span>

  <span class="hljs-built_in">build</span>() {
    <span class="hljs-built_in">NavDestination</span>() { <span class="hljs-comment">// 细节1.2：必须通过NavDestination写</span>
      Text('内容')<span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">30</span>)
    }
    <span class="hljs-selector-class">.title</span>('CartHar/MainPage')
    <span class="hljs-selector-class">.hideTitleBar</span>(false)
  }
}
```


</code></pre>
<p>b）通过NavPathStack跳转</p>
<h3 data-id="heading-24">2.6  跨包动态路由-自定义路由表 HMRouter</h3>
<p>千锋生鲜项目</p>
<h3 data-id="heading-25">2.7  企业级面试题</h3>
<ul>
<li>Navigation 和 Router 区别</li>
</ul>

<pre><code class="hljs">1 路由有闪屏的问题、Navigation更流畅
2 Navigation更适合一次开发、多端适配
3 Navigation页面转场动画更方便
4 跨模块开发Navigation更方便
等等
</code></pre>
<ul>
<li>如何用的</li>
</ul>

<pre><code class="hljs language-diff" lang="diff">传统：1-创建页面、2-配置路由main_pages、3-router跳转
现在：
<span class="hljs-deletion">- 准备：Navigation动态路由-系统路由表配置：1-创建route_map.json写配置、2-注册把1的文件跟项目关联module.json5、3-入口文件Navigation配置</span>
<span class="hljs-deletion">- 后续1：创建页面  必须按照系统路由规则去创建 （必须写NavDestination 然后不写导出但是必须被@Builder调用）</span>
<span class="hljs-deletion">- 后续2：配置该页面路由就可以跳转</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2F0a0a956faec348ddaa9b2676a3f19545%3Ftype%3D1%3Fha_source%3Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/0a0a956faec348ddaa9b2676a3f19545?type=1?ha_source=hmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">鸿蒙开发班级</a></p>
<p>✨家人们点个juejin账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>✨家人们点个juejin账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>✨家人们点个juejin账号关注，会持续发布大前端领域技术文章💕 🍃</p>
<p>    ^_^ 点关注、不迷路、主播带你学技术 (๑′ᴗ‵๑)Ｉ Lᵒᵛᵉᵧₒᵤ❤</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python自动化脚本：告别重复劳动]]></title>    <link>https://juejin.cn/post/7576861477267177491</link>    <guid>https://juejin.cn/post/7576861477267177491</guid>    <pubDate>2025-11-26T16:11:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576861477267177491" data-draft-id="7576888607479840787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python自动化脚本：告别重复劳动"/> <meta itemprop="keywords" content="Python,PyCharm"/> <meta itemprop="datePublished" content="2025-11-26T16:11:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BBB努力学习程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python自动化脚本：告别重复劳动
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BBB努力学习程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T16:11:18.000Z" title="Wed Nov 26 2025 16:11:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否曾经花费数小时重复做着相同的文件整理、数据录入或系统维护工作？想象一下，如果这些繁琐任务都能自动完成，你的工作效率将提升多少倍！Python自动化脚本正是为此而生，它就像雇佣了一个不知疲倦的数字助手，帮你处理各种重复性工作。</p>
<h2 data-id="heading-0">实战代码：构建个人自动化工具箱</h2>
<h3 data-id="heading-1">文件批量处理脚本</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> shutil
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">def</span> <span class="hljs-title function_">organize_files_by_extension</span>(<span class="hljs-params">folder_path</span>):
    <span class="hljs-string">"""
    按文件扩展名自动整理文件夹
    """</span>
    <span class="hljs-comment"># 确保目标文件夹存在</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(folder_path):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：文件夹 <span class="hljs-subst">{folder_path}</span> 不存在"</span>)
        <span class="hljs-keyword">return</span>
    
    <span class="hljs-comment"># 定义文件类型分类</span>
    file_categories = {
        <span class="hljs-string">'图片'</span>: [<span class="hljs-string">'.jpg'</span>, <span class="hljs-string">'.jpeg'</span>, <span class="hljs-string">'.png'</span>, <span class="hljs-string">'.gif'</span>, <span class="hljs-string">'.bmp'</span>],
        <span class="hljs-string">'文档'</span>: [<span class="hljs-string">'.pdf'</span>, <span class="hljs-string">'.doc'</span>, <span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.txt'</span>, <span class="hljs-string">'.xlsx'</span>, <span class="hljs-string">'.pptx'</span>],
        <span class="hljs-string">'视频'</span>: [<span class="hljs-string">'.mp4'</span>, <span class="hljs-string">'.avi'</span>, <span class="hljs-string">'.mov'</span>, <span class="hljs-string">'.mkv'</span>],
        <span class="hljs-string">'音频'</span>: [<span class="hljs-string">'.mp3'</span>, <span class="hljs-string">'.wav'</span>, <span class="hljs-string">'.flac'</span>],
        <span class="hljs-string">'代码'</span>: [<span class="hljs-string">'.py'</span>, <span class="hljs-string">'.js'</span>, <span class="hljs-string">'.html'</span>, <span class="hljs-string">'.css'</span>, <span class="hljs-string">'.java'</span>],
        <span class="hljs-string">'压缩包'</span>: [<span class="hljs-string">'.zip'</span>, <span class="hljs-string">'.rar'</span>, <span class="hljs-string">'.7z'</span>]
    }
    
    <span class="hljs-comment"># 创建分类文件夹</span>
    <span class="hljs-keyword">for</span> category <span class="hljs-keyword">in</span> file_categories.keys():
        category_path = os.path.join(folder_path, category)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(category_path):
            os.makedirs(category_path)
    
    <span class="hljs-comment"># 遍历并整理文件</span>
    moved_files = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> os.listdir(folder_path):
        file_path = os.path.join(folder_path, filename)
        
        <span class="hljs-comment"># 跳过文件夹和隐藏文件</span>
        <span class="hljs-keyword">if</span> os.path.isdir(file_path) <span class="hljs-keyword">or</span> filename.startswith(<span class="hljs-string">'.'</span>):
            <span class="hljs-keyword">continue</span>
        
        <span class="hljs-comment"># 获取文件扩展名</span>
        _, file_extension = os.path.splitext(filename)
        file_extension = file_extension.lower()
        
        <span class="hljs-comment"># 查找对应的文件分类</span>
        moved = <span class="hljs-literal">False</span>
        <span class="hljs-keyword">for</span> category, extensions <span class="hljs-keyword">in</span> file_categories.items():
            <span class="hljs-keyword">if</span> file_extension <span class="hljs-keyword">in</span> extensions:
                target_path = os.path.join(folder_path, category, filename)
                shutil.move(file_path, target_path)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"移动: <span class="hljs-subst">{filename}</span> -&gt; <span class="hljs-subst">{category}</span>/"</span>)
                moved_files += <span class="hljs-number">1</span>
                moved = <span class="hljs-literal">True</span>
                <span class="hljs-keyword">break</span>
        
        <span class="hljs-comment"># 未分类的文件移到"其他"文件夹</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> moved:
            other_path = os.path.join(folder_path, <span class="hljs-string">"其他"</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(other_path):
                os.makedirs(other_path)
            shutil.move(file_path, os.path.join(other_path, filename))
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"移动: <span class="hljs-subst">{filename}</span> -&gt; 其他/"</span>)
            moved_files += <span class="hljs-number">1</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n整理完成！共移动了 <span class="hljs-subst">{moved_files}</span> 个文件"</span>)

<span class="hljs-comment"># 使用示例</span>
organize_files_by_extension(<span class="hljs-string">"/Users/你的用户名/Downloads"</span>)
</code></pre>
<h3 data-id="heading-2">自动备份脚本</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> shutil
<span class="hljs-keyword">import</span> schedule
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_backup</span>(<span class="hljs-params">source_dir, backup_dir</span>):
    <span class="hljs-string">"""
    创建文件备份
    """</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 创建带时间戳的备份文件夹</span>
        timestamp = datetime.now().strftime(<span class="hljs-string">"%Y%m%d_%H%M%S"</span>)
        backup_path = os.path.join(backup_dir, <span class="hljs-string">f"backup_<span class="hljs-subst">{timestamp}</span>"</span>)
        
        <span class="hljs-comment"># 复制文件</span>
        <span class="hljs-keyword">if</span> os.path.exists(source_dir):
            shutil.copytree(source_dir, backup_path)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"备份成功: <span class="hljs-subst">{backup_path}</span>"</span>)
            <span class="hljs-keyword">return</span> backup_path
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：源目录 <span class="hljs-subst">{source_dir}</span> 不存在"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
            
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"备份失败: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">cleanup_old_backups</span>(<span class="hljs-params">backup_dir, keep_days=<span class="hljs-number">7</span></span>):
    <span class="hljs-string">"""
    清理旧的备份文件
    """</span>
    current_time = time.time()
    deleted_count = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> os.listdir(backup_dir):
        item_path = os.path.join(backup_dir, item)
        
        <span class="hljs-comment"># 检查是否是备份文件夹且超过保留期限</span>
        <span class="hljs-keyword">if</span> os.path.isdir(item_path) <span class="hljs-keyword">and</span> item.startswith(<span class="hljs-string">"backup_"</span>):
            <span class="hljs-comment"># 获取文件夹创建时间</span>
            creation_time = os.path.getctime(item_path)
            age_days = (current_time - creation_time) / (<span class="hljs-number">24</span> * <span class="hljs-number">3600</span>)
            
            <span class="hljs-keyword">if</span> age_days &gt; keep_days:
                shutil.rmtree(item_path)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"删除旧备份: <span class="hljs-subst">{item}</span>"</span>)
                deleted_count += <span class="hljs-number">1</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"清理完成！删除了 <span class="hljs-subst">{deleted_count}</span> 个旧备份"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_auto_backup</span>(<span class="hljs-params">source_dir, backup_dir, interval_hours=<span class="hljs-number">24</span></span>):
    <span class="hljs-string">"""
    设置自动备份任务
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">backup_job</span>():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n执行自动备份 - <span class="hljs-subst">{datetime.now()}</span>"</span>)
        create_backup(source_dir, backup_dir)
        cleanup_old_backups(backup_dir)
    
    <span class="hljs-comment"># 设置定时任务</span>
    schedule.every(interval_hours).hours.do(backup_job)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"自动备份已设置：每<span class="hljs-subst">{interval_hours}</span>小时备份一次"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"源目录: <span class="hljs-subst">{source_dir}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"备份目录: <span class="hljs-subst">{backup_dir}</span>"</span>)
    
    <span class="hljs-comment"># 立即执行一次备份</span>
    backup_job()
    
    <span class="hljs-comment"># 保持程序运行（在实际使用中可能需要用系统服务代替）</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            schedule.run_pending()
            time.sleep(<span class="hljs-number">60</span>)  <span class="hljs-comment"># 每分钟检查一次</span>
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n自动备份已停止"</span>)

<span class="hljs-comment"># 使用示例（取消注释来运行）</span>
<span class="hljs-comment"># setup_auto_backup(</span>
<span class="hljs-comment">#     source_dir="/Users/你的用户名/重要文档",</span>
<span class="hljs-comment">#     backup_dir="/Users/你的用户名/文档备份",</span>
<span class="hljs-comment">#     interval_hours=24</span>
<span class="hljs-comment"># )</span>
</code></pre>
<h3 data-id="heading-3">网页内容监控脚本</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> smtplib
<span class="hljs-keyword">from</span> email.mime.text <span class="hljs-keyword">import</span> MIMEText
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">class</span> <span class="hljs-title class_">WebsiteMonitor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, websites, check_interval=<span class="hljs-number">300</span></span>):
        <span class="hljs-string">"""
        初始化网站监控器
        websites: 要监控的网站列表 [{'name': '网站名', 'url': '网址'}]
        check_interval: 检查间隔（秒）
        """</span>
        self.websites = websites
        self.check_interval = check_interval
        self.status_history = {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_website_status</span>(<span class="hljs-params">self, url</span>):
        <span class="hljs-string">"""
        检查网站状态
        """</span>
        <span class="hljs-keyword">try</span>:
            response = requests.get(url, timeout=<span class="hljs-number">10</span>)
            <span class="hljs-keyword">return</span> response.status_code == <span class="hljs-number">200</span>, response.status_code
        <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-built_in">str</span>(e)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_alert</span>(<span class="hljs-params">self, website_name, status, message</span>):
        <span class="hljs-string">"""
        发送警报（这里打印到控制台，实际使用时可以发送邮件）
        """</span>
        timestamp = datetime.now().strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>)
        alert_message = <span class="hljs-string">f"[<span class="hljs-subst">{timestamp}</span>] 警报: <span class="hljs-subst">{website_name}</span> - <span class="hljs-subst">{status}</span>\n详情: <span class="hljs-subst">{message}</span>"</span>
        <span class="hljs-built_in">print</span>(alert_message)
        
        <span class="hljs-comment"># 在实际使用中，这里可以添加邮件发送代码</span>
        <span class="hljs-comment"># self.send_email_alert(website_name, status, message)</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">monitor_websites</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        开始监控网站
        """</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"开始监控 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(self.websites)}</span> 个网站..."</span>)
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                <span class="hljs-keyword">for</span> website <span class="hljs-keyword">in</span> self.websites:
                    name = website[<span class="hljs-string">'name'</span>]
                    url = website[<span class="hljs-string">'url'</span>]
                    
                    <span class="hljs-comment"># 检查网站状态</span>
                    is_online, status = self.check_website_status(url)
                    current_status = <span class="hljs-string">"在线"</span> <span class="hljs-keyword">if</span> is_online <span class="hljs-keyword">else</span> <span class="hljs-string">"离线"</span>
                    
                    <span class="hljs-comment"># 检查状态变化</span>
                    previous_status = self.status_history.get(name)
                    <span class="hljs-keyword">if</span> previous_status != current_status:
                        <span class="hljs-keyword">if</span> previous_status <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:  <span class="hljs-comment"># 不是第一次检查</span>
                            self.send_alert(name, current_status, <span class="hljs-string">f"状态码: <span class="hljs-subst">{status}</span>"</span>)
                        
                        self.status_history[name] = current_status
                    
                    <span class="hljs-comment"># 输出状态信息</span>
                    status_icon = <span class="hljs-string">"✅"</span> <span class="hljs-keyword">if</span> is_online <span class="hljs-keyword">else</span> <span class="hljs-string">"❌"</span>
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{status_icon}</span> <span class="hljs-subst">{name}</span>: <span class="hljs-subst">{current_status}</span> (<span class="hljs-subst">{status}</span>)"</span>)
                
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"等待 <span class="hljs-subst">{self.check_interval}</span> 秒后再次检查...\n"</span>)
                time.sleep(self.check_interval)
                
        <span class="hljs-keyword">except</span> KeyboardInterrupt:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n网站监控已停止"</span>)

<span class="hljs-comment"># 使用示例</span>
websites_to_monitor = [
    {<span class="hljs-string">'name'</span>: <span class="hljs-string">'谷歌'</span>, <span class="hljs-string">'url'</span>: <span class="hljs-string">'https://www.google.com'</span>},
    {<span class="hljs-string">'name'</span>: <span class="hljs-string">'GitHub'</span>, <span class="hljs-string">'url'</span>: <span class="hljs-string">'https://www.github.com'</span>},
    {<span class="hljs-string">'name'</span>: <span class="hljs-string">'稀土掘金'</span>, <span class="hljs-string">'url'</span>: <span class="hljs-string">'https://juejin.cn'</span>}
]

monitor = WebsiteMonitor(websites_to_monitor, check_interval=<span class="hljs-number">60</span>)
<span class="hljs-comment"># monitor.monitor_websites()  # 取消注释来运行</span>
</code></pre>
<h3 data-id="heading-4">自动化数据收集脚本</h3>
<pre><code class="hljs language-pythonimport" lang="pythonimport">import json
import csv
import sqlite3
from datetime import datetime

class DataCollector:
    def __init__(self, db_path="collected_data.db"):
        self.db_path = db_path
        self.setup_database()
    
    def setup_database(self):
        """设置SQLite数据库"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        # 创建数据表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS weather_data (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                city TEXT NOT NULL,
                temperature REAL,
                humidity INTEGER,
                description TEXT,
                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        
        conn.commit()
        conn.close()
        print("数据库初始化完成")
    
    def get_weather_data(self, city):
        """获取天气数据（模拟API调用）"""
        # 这里使用模拟数据，实际使用时可以调用真实天气API
        weather_data = {
            '北京': {'temperature': 25.5, 'humidity': 60, 'description': '晴朗'},
            '上海': {'temperature': 28.0, 'humidity': 75, 'description': '多云'},
            '广州': {'temperature': 32.5, 'humidity': 80, 'description': '阵雨'},
            '深圳': {'temperature': 31.0, 'humidity': 78, 'description': '阴天'}
        }
        
        return weather_data.get(city, {'temperature': 0, 'humidity': 0, 'description': '未知'})
    
    def collect_weather_data(self, cities):
        """收集多个城市的天气数据"""
        collected_data = []
        
        for city in cities:
            print(f"正在收集 {city} 的天气数据...")
            weather = self.get_weather_data(city)
            
            data_point = {
                'city': city,
                'temperature': weather['temperature'],
                'humidity': weather['humidity'],
                'description': weather['description'],
                'timestamp': datetime.now()
            }
            
            collected_data.append(data_point)
            
            # 保存到数据库
            self.save_to_database(data_point)
        
        return collected_data
    
    def save_to_database(self, data):
        """保存数据到数据库"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('''
            INSERT INTO weather_data (city, temperature, humidity, description)
            VALUES (?, ?, ?, ?)
        ''', (data['city'], data['temperature'], data['humidity'], data['description']))
        
        conn.commit()
        conn.close()
    
    def export_to_csv(self, filename="weather_data.csv"):
        """导出数据到CSV文件"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('SELECT * FROM weather_data')
        data = cursor.fetchall()
        
        with open(filename, 'w', newline='', encoding='utf-8') as file:
            writer = csv.writer(file)
            
            # 写入表头
            writer.writerow(['ID', '城市', '温度', '湿度', '描述', '时间'])
            
            # 写入数据
            for row in data:
                writer.writerow(row)
        
        conn.close()
        print(f"数据已导出到 {filename}")
    
    def generate_report(self):
        """生成数据报告"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        # 统计各城市平均温度
        cursor.execute('''
            SELECT city, 
                   AVG(temperature) as avg_temp,
                   AVG(humidity) as avg_humidity,
                   COUNT(*) as data_count
            FROM weather_data 
            GROUP BY city
        ''')
        
        stats = cursor.fetchall()
        
        print("\n=== 天气数据统计报告 ===")
        for city, avg_temp, avg_humidity, count in stats:
            print(f"{city}:")
            print(f"  平均温度: {avg_temp:.1f}°C")
            print(f"  平均湿度: {avg_humidity:.1f}%")
            print(f"  数据点数: {count}")
            print()
        
        conn.close()

# 使用示例
collector = DataCollector()

# 收集数据
cities = ['北京', '上海', '广州', '深圳']
weather_data = collector.collect_weather_data(cities)

print("收集到的天气数据:")
for data in weather_data:
    print(f"{data['city']}: {data['temperature']}°C, {data['humidity']}%, {data['description']}")

# 生成报告和导出数据
collector.generate_report()
collector.export_to_csv()
import requests
import json
import csv
import sqlite3
from datetime import datetime

class DataCollector:
    def __init__(self, db_path="collected_data.db"):
        self.db_path = db_path
        self.setup_database()
    
    def setup_database(self):
        """设置SQLite数据库"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        # 创建数据表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS weather_data (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                city TEXT NOT NULL,
                temperature REAL,
                humidity INTEGER,
                description TEXT,
                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        
        conn.commit()
        conn.close()
        print("数据库初始化完成")
    
    def get_weather_data(self, city):
        """获取天气数据（模拟API调用）"""
        # 这里使用模拟数据，实际使用时可以调用真实天气API
        weather_data = {
            '北京': {'temperature': 25.5, 'humidity': 60, 'description': '晴朗'},
            '上海': {'temperature': 28.0, 'humidity': 75, 'description': '多云'},
            '广州': {'temperature': 32.5, 'humidity': 80, 'description': '阵雨'},
            '深圳': {'temperature': 31.0, 'humidity': 78, 'description': '阴天'}
        }
        
        return weather_data.get(city, {'temperature': 0, 'humidity': 0, 'description': '未知'})
    
    def collect_weather_data(self, cities):
        """收集多个城市的天气数据"""
        collected_data = []
        
        for city in cities:
            print(f"正在收集 {city} 的天气数据...")
            weather = self.get_weather_data(city)
            
            data_point = {
                'city': city,
                'temperature': weather['temperature'],
                'humidity': weather['humidity'],
                'description': weather['description'],
                'timestamp': datetime.now()
            }
            
            collected_data.append(data_point)
            
            # 保存到数据库
            self.save_to_database(data_point)
        
        return collected_data
    
    def save_to_database(self, data):
        """保存数据到数据库"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('''
            INSERT INTO weather_data (city, temperature, humidity, description)
            VALUES (?, ?, ?, ?)
        ''', (data['city'], data['temperature'], data['humidity'], data['description']))
        
        conn.commit()
        conn.close()
    
    def export_to_csv(self, filename="weather_data.csv"):
        """导出数据到CSV文件"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('SELECT * FROM weather_data')
        data = cursor.fetchall()
        
        with open(filename, 'w', newline='', encoding='utf-8') as file:
            writer = csv.writer(file)
            
            # 写入表头
            writer.writerow(['ID', '城市', '温度', '湿度', '描述', '时间'])
            
            # 写入数据
            for row in data:
                writer.writerow(row)
        
        conn.close()
        print(f"数据已导出到 {filename}")
    
    def generate_report(self):
        """生成数据报告"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        # 统计各城市平均温度
        cursor.execute('''
            SELECT city, 
                   AVG(temperature) as avg_temp,
                   AVG(humidity) as avg_humidity,
                   COUNT(*) as data_count
            FROM weather_data 
            GROUP BY city
        ''')
        
        stats = cursor.fetchall()
        
        print("\n=== 天气数据统计报告 ===")
        for city, avg_temp, avg_humidity, count in stats:
            print(f"{city}:")
            print(f"  平均温度: {avg_temp:.1f}°C")
            print(f"  平均湿度: {avg_humidity:.1f}%")
            print(f"  数据点数: {count}")
            print()
        
        conn.close()

# 使用示例
collector = DataCollector()

# 收集数据
cities = ['北京', '上海', '广州', '深圳']
weather_data = collector.collect_weather_data(cities)

print("收集到的天气数据:")
for data in weather_data:
    print(f"{data['city']}: {data['temperature']}°C, {data['humidity']}%, {data['description']}")

# 生成报告和导出数据
collector.generate_report()
collector.export_to_csv()
</code></pre>
<h2 data-id="heading-5">自动化脚本开发原则</h2>
<ol>
<li>可靠性设计</li>
<li>用户体验</li>
<li>维护性考虑</li>
<li>安全性保障</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python函数式编程：优雅的代码艺术]]></title>    <link>https://juejin.cn/post/7576893180080734250</link>    <guid>https://juejin.cn/post/7576893180080734250</guid>    <pubDate>2025-11-26T16:17:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576893180080734250" data-draft-id="7576859345935614006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python函数式编程：优雅的代码艺术"/> <meta itemprop="keywords" content="Python,PyCharm"/> <meta itemprop="datePublished" content="2025-11-26T16:17:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BBB努力学习程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python函数式编程：优雅的代码艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BBB努力学习程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T16:17:30.000Z" title="Wed Nov 26 2025 16:17:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><p>想象一下，如果编程就像搭积木一样，通过组合简单的模块来构建复杂的功能，而不是编写冗长的指令序列。这正是函数式编程的魅力所在！它不仅仅是一种技术，更是一种思维方式，让代码变得更简洁、更可预测、更易于理解。</p>
<h2 data-id="heading-0">函数式编程的核心理念</h2>
<ul>
<li>不变性：数据的安全保障</li>
<li>纯函数：相同的输入，永远得到相同的输出</li>
<li>函数是最重要的</li>
</ul>
<h2 data-id="heading-1">实战代码：函数式编程的实践</h2>
<h3 data-id="heading-2">基础函数式操作</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 传统方式 vs 函数式方式</span>

<span class="hljs-comment"># 传统命令式编程</span>
numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>]

<span class="hljs-comment"># 筛选偶数并计算平方</span>
result_imperative = []
<span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> numbers:
    <span class="hljs-keyword">if</span> num % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:
        result_imperative.append(num ** <span class="hljs-number">2</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"命令式结果: <span class="hljs-subst">{result_imperative}</span>"</span>)

<span class="hljs-comment"># 函数式编程方式</span>
result_functional = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x ** <span class="hljs-number">2</span>, 
                           <span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, numbers)))

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"函数式结果: <span class="hljs-subst">{result_functional}</span>"</span>)

<span class="hljs-comment"># 更清晰的写法（使用生成器表达式）</span>
result_clear = [x ** <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> numbers <span class="hljs-keyword">if</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"清晰写法: <span class="hljs-subst">{result_clear}</span>"</span>)
</code></pre>
<h3 data-id="heading-3">高阶函数应用</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> reduce
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Callable</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">compose</span>(<span class="hljs-params">*functions: <span class="hljs-type">Callable</span></span>) -&gt; <span class="hljs-type">Callable</span>:
    <span class="hljs-string">"""函数组合：将多个函数组合成一个新函数"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">composed</span>(<span class="hljs-params">arg</span>):
        result = arg
        <span class="hljs-keyword">for</span> func <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(functions):
            result = func(result)
        <span class="hljs-keyword">return</span> result
    <span class="hljs-keyword">return</span> composed

<span class="hljs-keyword">def</span> <span class="hljs-title function_">pipe</span>(<span class="hljs-params">*functions: <span class="hljs-type">Callable</span></span>) -&gt; <span class="hljs-type">Callable</span>:
    <span class="hljs-string">"""管道操作：从左到右执行函数序列"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">piped</span>(<span class="hljs-params">arg</span>):
        result = arg
        <span class="hljs-keyword">for</span> func <span class="hljs-keyword">in</span> functions:
            result = func(result)
        <span class="hljs-keyword">return</span> result
    <span class="hljs-keyword">return</span> piped

<span class="hljs-comment"># 创建一些小的纯函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">Callable</span>[[<span class="hljs-built_in">int</span>], <span class="hljs-built_in">int</span>]:
    <span class="hljs-string">"""柯里化的加法函数"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">lambda</span> y: x + y

<span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">x: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">Callable</span>[[<span class="hljs-built_in">int</span>], <span class="hljs-built_in">int</span>]:
    <span class="hljs-string">"""柯里化的乘法函数"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">lambda</span> y: x * y

<span class="hljs-keyword">def</span> <span class="hljs-title function_">filter_even</span>(<span class="hljs-params">numbers: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:
    <span class="hljs-string">"""筛选偶数"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, numbers))

<span class="hljs-keyword">def</span> <span class="hljs-title function_">square_all</span>(<span class="hljs-params">numbers: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:
    <span class="hljs-string">"""对所有数字求平方"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x ** <span class="hljs-number">2</span>, numbers))

<span class="hljs-keyword">def</span> <span class="hljs-title function_">sum_all</span>(<span class="hljs-params">numbers: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-string">"""求和"""</span>
    <span class="hljs-keyword">return</span> reduce(<span class="hljs-keyword">lambda</span> x, y: x + y, numbers, <span class="hljs-number">0</span>)

<span class="hljs-comment"># 使用函数组合构建复杂操作</span>
process_numbers = pipe(
    filter_even,    <span class="hljs-comment"># 第一步：筛选偶数</span>
    square_all,     <span class="hljs-comment"># 第二步：求平方</span>
    sum_all         <span class="hljs-comment"># 第三步：求和</span>
)

<span class="hljs-comment"># 测试函数组合</span>
numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]
result = process_numbers(numbers)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"处理结果: <span class="hljs-subst">{result}</span>"</span>)  <span class="hljs-comment"># 4 + 16 + 36 = 56</span>

<span class="hljs-comment"># 柯里化函数的使用</span>
add_five = add(<span class="hljs-number">5</span>)
multiply_by_three = multiply(<span class="hljs-number">3</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"5 + 10 = <span class="hljs-subst">{add_five(<span class="hljs-number">10</span>)}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"3 × 7 = <span class="hljs-subst">{multiply_by_three(<span class="hljs-number">7</span>)}</span>"</span>)

<span class="hljs-comment"># 组合柯里化函数</span>
add_then_multiply = compose(multiply_by_three, add_five)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"(5 + 10) × 3 = <span class="hljs-subst">{add_then_multiply(<span class="hljs-number">10</span>)}</span>"</span>)
</code></pre>
<h3 data-id="heading-4">不可变数据结构</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">List</span>, <span class="hljs-type">Any</span>
<span class="hljs-keyword">from</span> copy <span class="hljs-keyword">import</span> deepcopy

<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_in</span>(<span class="hljs-params">data: <span class="hljs-type">Dict</span>, keys: <span class="hljs-type">List</span>, value: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-type">Dict</span>:
    <span class="hljs-string">"""不可变地更新嵌套字典的特定路径"""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(keys) == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> value
    
    key = keys[<span class="hljs-number">0</span>]
    remaining_keys = keys[<span class="hljs-number">1</span>:]
    
    <span class="hljs-comment"># 创建数据的深拷贝</span>
    new_data = deepcopy(data)
    
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(new_data, <span class="hljs-built_in">dict</span>):
        <span class="hljs-keyword">if</span> key <span class="hljs-keyword">in</span> new_data:
            new_data[key] = update_in(new_data[key], remaining_keys, value)
        <span class="hljs-keyword">else</span>:
            new_data[key] = update_in({}, remaining_keys, value)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># 如果不是字典，创建新的字典结构</span>
        new_data = {key: update_in({}, remaining_keys, value)}
    
    <span class="hljs-keyword">return</span> new_data

<span class="hljs-keyword">def</span> <span class="hljs-title function_">assoc</span>(<span class="hljs-params">data: <span class="hljs-type">Dict</span>, key: <span class="hljs-built_in">str</span>, value: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-type">Dict</span>:
    <span class="hljs-string">"""不可变地设置字典键值"""</span>
    new_data = data.copy()
    new_data[key] = value
    <span class="hljs-keyword">return</span> new_data

<span class="hljs-keyword">def</span> <span class="hljs-title function_">dissoc</span>(<span class="hljs-params">data: <span class="hljs-type">Dict</span>, key: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>:
    <span class="hljs-string">"""不可变地删除字典键"""</span>
    new_data = data.copy()
    <span class="hljs-keyword">if</span> key <span class="hljs-keyword">in</span> new_data:
        <span class="hljs-keyword">del</span> new_data[key]
    <span class="hljs-keyword">return</span> new_data

<span class="hljs-comment"># 使用不可变数据操作</span>
user_data = {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"张三"</span>,
    <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>,
    <span class="hljs-string">"address"</span>: {
        <span class="hljs-string">"city"</span>: <span class="hljs-string">"北京"</span>,
        <span class="hljs-string">"street"</span>: <span class="hljs-string">"朝阳路"</span>
    },
    <span class="hljs-string">"hobbies"</span>: [<span class="hljs-string">"阅读"</span>, <span class="hljs-string">"编程"</span>]
}

<span class="hljs-built_in">print</span>(<span class="hljs-string">"原始数据:"</span>, user_data)

<span class="hljs-comment"># 不可变更新</span>
new_user = assoc(user_data, <span class="hljs-string">"age"</span>, <span class="hljs-number">26</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"更新年龄后:"</span>, new_user)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"原始数据未改变:"</span>, user_data[<span class="hljs-string">"age"</span>])

<span class="hljs-comment"># 删除属性</span>
user_without_age = dissoc(user_data, <span class="hljs-string">"age"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"删除年龄后:"</span>, user_without_age)

<span class="hljs-comment"># 深层更新</span>
updated_user = update_in(user_data, [<span class="hljs-string">"address"</span>, <span class="hljs-string">"city"</span>], <span class="hljs-string">"上海"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"更新城市后:"</span>, updated_user)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"原始地址未改变:"</span>, user_data[<span class="hljs-string">"address"</span>][<span class="hljs-string">"city"</span>])
</code></pre>
<h3 data-id="heading-5">函数式数据处理</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> partial
<span class="hljs-keyword">from</span> operator <span class="hljs-keyword">import</span> itemgetter, attrgetter

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, price: <span class="hljs-built_in">float</span>, category: <span class="hljs-built_in">str</span></span>):
        self.name = name
        self.price = price
        self.category = category
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__repr__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"Product(<span class="hljs-subst">{self.name}</span>, $<span class="hljs-subst">{self.price}</span>, <span class="hljs-subst">{self.category}</span>)"</span>

<span class="hljs-comment"># 创建产品列表</span>
products = [
    Product(<span class="hljs-string">"笔记本电脑"</span>, <span class="hljs-number">5999</span>, <span class="hljs-string">"电子产品"</span>),
    Product(<span class="hljs-string">"智能手机"</span>, <span class="hljs-number">3999</span>, <span class="hljs-string">"电子产品"</span>),
    Product(<span class="hljs-string">"书籍"</span>, <span class="hljs-number">49</span>, <span class="hljs-string">"文教用品"</span>),
    Product(<span class="hljs-string">"咖啡"</span>, <span class="hljs-number">35</span>, <span class="hljs-string">"食品饮料"</span>),
    Product(<span class="hljs-string">"鼠标"</span>, <span class="hljs-number">89</span>, <span class="hljs-string">"电子产品"</span>),
    Product(<span class="hljs-string">"笔记本"</span>, <span class="hljs-number">15</span>, <span class="hljs-string">"文教用品"</span>)
]

<span class="hljs-comment"># 函数式数据处理管道</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_data_pipeline</span>(<span class="hljs-params">*transformations</span>):
    <span class="hljs-string">"""创建数据处理管道"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pipeline</span>(<span class="hljs-params">data</span>):
        <span class="hljs-keyword">return</span> reduce(<span class="hljs-keyword">lambda</span> d, transform: transform(d), 
                     transformations, data)
    <span class="hljs-keyword">return</span> pipeline

<span class="hljs-comment"># 各种数据处理函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">filter_by_category</span>(<span class="hljs-params">category: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""按类别筛选的柯里化函数"""</span>
    <span class="hljs-keyword">return</span> partial(<span class="hljs-built_in">filter</span>, <span class="hljs-keyword">lambda</span> p: p.category == category)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">filter_by_price</span>(<span class="hljs-params">max_price: <span class="hljs-built_in">float</span></span>):
    <span class="hljs-string">"""按价格筛选的柯里化函数"""</span>
    <span class="hljs-keyword">return</span> partial(<span class="hljs-built_in">filter</span>, <span class="hljs-keyword">lambda</span> p: p.price &lt;= max_price)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">sort_by_price</span>(<span class="hljs-params">descending: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>):
    <span class="hljs-string">"""按价格排序的柯里化函数"""</span>
    <span class="hljs-keyword">return</span> partial(<span class="hljs-built_in">sorted</span>, key=attrgetter(<span class="hljs-string">'price'</span>), reverse=descending)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_names</span>():
    <span class="hljs-string">"""提取产品名称"""</span>
    <span class="hljs-keyword">return</span> partial(<span class="hljs-built_in">map</span>, attrgetter(<span class="hljs-string">'name'</span>))

<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_total_price</span>():
    <span class="hljs-string">"""计算总价格"""</span>
    <span class="hljs-keyword">return</span> partial(reduce, <span class="hljs-keyword">lambda</span> total, p: total + p.price)

<span class="hljs-comment"># 构建复杂的数据处理管道</span>
affordable_electronics = create_data_pipeline(
    filter_by_category(<span class="hljs-string">"电子产品"</span>),
    filter_by_price(<span class="hljs-number">5000</span>),
    sort_by_price(descending=<span class="hljs-literal">True</span>)
)

cheap_product_names = create_data_pipeline(
    filter_by_price(<span class="hljs-number">100</span>),
    get_names(),
    <span class="hljs-built_in">list</span>
)

total_electronics_price = create_data_pipeline(
    filter_by_category(<span class="hljs-string">"电子产品"</span>),
    calculate_total_price()
)

<span class="hljs-comment"># 使用数据处理管道</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"实惠的电子产品:"</span>)
<span class="hljs-keyword">for</span> product <span class="hljs-keyword">in</span> affordable_electronics(products):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{product}</span>"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n便宜商品名称: <span class="hljs-subst">{<span class="hljs-built_in">list</span>(cheap_product_names(products))}</span>"</span>)

<span class="hljs-comment"># 注意：calculate_total_price 返回的是reduce函数，需要传入初始值0</span>
electronics_price = total_electronics_price(products)(<span class="hljs-number">0</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"电子产品总价: $<span class="hljs-subst">{electronics_price}</span>"</span>)
</code></pre>
<h3 data-id="heading-6">递归和惰性求值</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> islice

<span class="hljs-keyword">def</span> <span class="hljs-title function_">fibonacci</span>():
    <span class="hljs-string">"""生成无限斐波那契数列（惰性求值）"""</span>
    a, b = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">yield</span> a
        a, b = b, a + b

<span class="hljs-keyword">def</span> <span class="hljs-title function_">recursive_sum</span>(<span class="hljs-params">numbers: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-string">"""递归方式求和"""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> numbers:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">return</span> numbers[<span class="hljs-number">0</span>] + recursive_sum(numbers[<span class="hljs-number">1</span>:])

<span class="hljs-keyword">def</span> <span class="hljs-title function_">recursive_max</span>(<span class="hljs-params">numbers: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-string">"""递归方式求最大值"""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(numbers) == <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> numbers[<span class="hljs-number">0</span>]
    
    rest_max = recursive_max(numbers[<span class="hljs-number">1</span>:])
    <span class="hljs-keyword">return</span> numbers[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> numbers[<span class="hljs-number">0</span>] &gt; rest_max <span class="hljs-keyword">else</span> rest_max

<span class="hljs-keyword">def</span> <span class="hljs-title function_">trampoline</span>(<span class="hljs-params">func</span>):
    <span class="hljs-string">"""蹦床函数：优化递归，防止栈溢出"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">trampolined</span>(<span class="hljs-params">*args, **kwargs</span>):
        result = func(*args, **kwargs)
        <span class="hljs-keyword">while</span> <span class="hljs-built_in">callable</span>(result):
            result = result()
        <span class="hljs-keyword">return</span> result
    <span class="hljs-keyword">return</span> trampolined

<span class="hljs-comment"># 使用惰性序列</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"斐波那契数列前10项:"</span>)
fib_sequence = islice(fibonacci(), <span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(fib_sequence))

<span class="hljs-comment"># 使用递归函数</span>
numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"递归求和: <span class="hljs-subst">{recursive_sum(numbers)}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"递归求最大值: <span class="hljs-subst">{recursive_max(numbers)}</span>"</span>)

<span class="hljs-comment"># 记忆化装饰器（缓存函数结果）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">memoize</span>(<span class="hljs-params">func</span>):
    <span class="hljs-string">"""记忆化装饰器：缓存函数计算结果"""</span>
    cache = {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">memoized</span>(<span class="hljs-params">*args</span>):
        <span class="hljs-keyword">if</span> args <span class="hljs-keyword">in</span> cache:
            <span class="hljs-keyword">return</span> cache[args]
        result = func(*args)
        cache[args] = result
        <span class="hljs-keyword">return</span> result
    
    <span class="hljs-keyword">return</span> memoized

<span class="hljs-meta">@memoize</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">factorial</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-string">"""记忆化的阶乘函数"""</span>
    <span class="hljs-keyword">if</span> n &lt;= <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> n * factorial(n - <span class="hljs-number">1</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n记忆化阶乘:"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"5! = <span class="hljs-subst">{factorial(<span class="hljs-number">5</span>)}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"10! = <span class="hljs-subst">{factorial(<span class="hljs-number">10</span>)}</span>"</span>)
<span class="hljs-comment"># 第二次调用会使用缓存</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"5! (缓存) = <span class="hljs-subst">{factorial(<span class="hljs-number">5</span>)}</span>"</span>)
</code></pre>
<h2 data-id="heading-7">函数式编程原则</h2>
<ol>
<li>纯函数优先</li>
<li>不可变性原则</li>
<li>声明式编程</li>
<li>组合优于继承</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么C++项目偏爱.cxx扩展名：从MongoDB驱动说起]]></title>    <link>https://juejin.cn/post/7576894999095689243</link>    <guid>https://juejin.cn/post/7576894999095689243</guid>    <pubDate>2025-11-27T01:02:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576894999095689243" data-draft-id="7576894999095656475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么C++项目偏爱.cxx扩展名：从MongoDB驱动说起"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-11-27T01:02:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="自由生长2024"/> <meta itemprop="url" content="https://juejin.cn/user/1591748569862670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么C++项目偏爱.cxx扩展名：从MongoDB驱动说起
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748569862670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    自由生长2024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T01:02:37.000Z" title="Thu Nov 27 2025 01:02:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>摘要：C++扩展名选用.cxx而非.cpp，源于Unix历史：cpp命令早被C预处理器占用，为避免冲突衍生出.cxx、.cc等变体。mongocxx遵循这一传统，体现了C++生态的历史传承。现代项目虽多用.cpp，但.cxx仍是老牌库的常见选择，构建工具均能妥善支持。</p>
<h2 data-id="heading-0">为什么C++项目偏爱.cxx扩展名：从MongoDB驱动说起</h2>
<h3 data-id="heading-1">一个令人困惑的发现</h3>
<p>当你第一次接触MongoDB的C++驱动时，可能会感到疑惑：为什么它叫<code>mongocxx</code>而不是更直观的<code>mongocpp</code>？这背后其实隐藏着C++发展史上的一段有趣故事。</p>
<h3 data-id="heading-2">罪魁祸首：被占用的<code>cpp</code>命令</h3>
<h4 data-id="heading-3">Unix系统的历史遗产</h4>
<p>在Unix/Linux系统中，<code>cpp</code>这个命令名早在上世纪70年代就被C预处理器（C Preprocessor）占据了：</p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">which</span> cpp
/usr/bin/cpp

$ cpp --version
cpp (GCC) 9.3.0
Copyright © 2020 Free Software Foundation, Inc.
</code></pre>
<h4 data-id="heading-4">命名冲突的现实困境</h4>
<p>如果C++编译器也命名为<code>cpp</code>，会导致严重混乱：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 假设两个命令都叫cpp，会发生什么？</span>
cpp my_program.cpp    <span class="hljs-comment"># 这是调用预处理器还是编译器？</span>
</code></pre>
<p>这种冲突在构建工具和Makefile中尤为明显，系统无法区分你到底要调用哪个工具。</p>
<h3 data-id="heading-5">C++扩展名的"战国时代"</h3>
<p>为了避免与预处理器冲突，C++社区出现了多种文件扩展名：</p>
<h4 data-id="heading-6">各派系之争</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 1. .cpp 派 (现在的主流)</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-comment">// 多数现代IDE和构建系统首选</span>

<span class="hljs-comment">// 2. .cxx 派 (mongocxx的选择)  </span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mongocxx/client.hpp&gt;</span></span>
<span class="hljs-comment">// 常见于老牌项目和Unix传统</span>

<span class="hljs-comment">// 3. .cc 派 (Google风格)</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"base/logging.h"</span></span>
<span class="hljs-comment">// Google内部代码规范要求</span>

<span class="hljs-comment">// 4. 其他变体</span>
file.C     <span class="hljs-comment">// 区分大小写的系统</span>
file.c++   <span class="hljs-comment">// 较少使用</span>
</code></pre>
<h4 data-id="heading-7">编译器的兼容性</h4>
<p>各大编译器都对各种扩展名提供了支持：</p>
<pre><code class="hljs language-bash" lang="bash">g++ -c file.cxx        <span class="hljs-comment"># 编译.cxx文件</span>
g++ -c file.cc         <span class="hljs-comment"># 编译.cc文件  </span>
clang++ -c file.cpp    <span class="hljs-comment"># 编译.cpp文件</span>
</code></pre>
<h3 data-id="heading-8">mongocxx的命名逻辑</h3>
<h4 data-id="heading-9">保持历史一致性</h4>
<p>MongoDB驱动遵循了传统的命名规范：</p>
<pre><code class="hljs language-scss" lang="scss">mongoc     → C语言驱动 (基础层)
└── mongocxx → C++驱动 (基于C驱动的封装)
</code></pre>
<h4 data-id="heading-10">项目结构体现</h4>
<pre><code class="hljs language-bash" lang="bash">mongocxx/
├── src/mongocxx/  <span class="hljs-comment"># C++头文件使用.hpp</span>
│   └── client.hpp
├── <span class="hljs-built_in">test</span>/          <span class="hljs-comment"># 测试代码可能使用.cxx</span>
│   └── test_client.cxx
└── CMakeLists.txt <span class="hljs-comment"># 构建配置处理各种扩展名</span>
</code></pre>
<h3 data-id="heading-11">现代开发中的现状</h3>
<h4 data-id="heading-12">现状分析</h4>
<p>虽然<code>.cpp</code>已成为事实上的主流标准，但很多历史悠久的项目仍然保持传统：</p>

























<table><thead><tr><th>项目类型</th><th>常用扩展名</th><th>说明</th></tr></thead><tbody><tr><td>新启动项目</td><td>.cpp</td><td>现代IDE和构建系统友好</td></tr><tr><td>老牌库项目</td><td>.cxx/.cc</td><td>保持历史一致性</td></tr><tr><td>Google相关</td><td>.cc</td><td>遵循内部代码规范</td></tr></tbody></table>
<h4 data-id="heading-13">构建系统的适应性</h4>
<p>现代构建系统都能正确处理各种扩展名：</p>
<pre><code class="hljs language-cmake" lang="cmake"># CMake自动识别所有C++扩展名
add_library(mongocxx 
    src/file1.cxx
    src/file2.cpp  
    src/file3.cc
)

# 或者明确指定
set(CMAKE_CXX_EXTENSIONS .cxx .cpp .cc)
</code></pre>
<h3 data-id="heading-14">实践建议</h3>
<h4 data-id="heading-15">对于新项目</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 推荐使用.cpp，因为：</span>
<span class="hljs-comment"># 1. 更广泛的工具支持</span>
<span class="hljs-comment"># 2. 更直观的命名</span>
<span class="hljs-comment"># 3. 社区主流选择</span>
my_program.cpp
</code></pre>
<h4 data-id="heading-16">理解老项目</h4>
<p>当你遇到<code>.cxx</code>扩展名时，现在应该明白：</p>
<ul>
<li>这不是标新立异，而是历史传承</li>
<li>不影响代码功能和性能</li>
<li>构建工具都能正常处理</li>
</ul>
<h3 data-id="heading-17">结语</h3>
<p><code>mongocxx</code>的命名选择反映了C++语言的演进历史。从今天的视角看，<code>.cxx</code>可能显得有些"老派"，但它承载了C++从Unix实验室走向全世界的完整历程。</p>
<p>这种命名上的多样性，恰恰体现了C++生态的丰富性和兼容性——无论是现代的<code>.cpp</code>还是传统的<code>.cxx</code>，都能在同一个项目中和谐共存，共同构建强大的软件系统。</p>
<p>所以下次看到<code>.cxx</code>扩展名时，你不必困惑，只需会心一笑：这是一个经历过C++"战国时代"的老兵。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Mac 自动定时打开指定URL（无日历版）操作文档]]></title>    <link>https://juejin.cn/post/7576894778572849187</link>    <guid>https://juejin.cn/post/7576894778572849187</guid>    <pubDate>2025-11-27T02:20:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576894778572849187" data-draft-id="7576929700841275401" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Mac 自动定时打开指定URL（无日历版）操作文档"/> <meta itemprop="keywords" content="macOS"/> <meta itemprop="datePublished" content="2025-11-27T02:20:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="学习非暴力沟通的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/4183005583377070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Mac 自动定时打开指定URL（无日历版）操作文档
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4183005583377070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    学习非暴力沟通的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T02:20:59.000Z" title="Thu Nov 27 2025 02:20:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你提供的内容本身已采用 Markdown 语法撰写，我已对格式进行了细微优化（如统一代码块样式、确保标题层级一致性），以下是可直接使用的完整 Markdown 文档：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># Mac 自动定时打开指定URL（无日历版）操作文档</span>
<span class="hljs-section">## 一、操作目标</span>
无需依赖日历，通过 Mac 自带「自动操作」+「LaunchAgent」，实现每天 <span class="hljs-strong">**9:00、10:00、11:00、14:00、15:00、16:00、17:00**</span> 自动用默认浏览器打开目标飞书链接：<span class="hljs-code">`https://hav4xarv6k.feishu.cn/share/base/form/shrcnRbIxP9bnHct1X1aCiKjYyc`</span>


<span class="hljs-section">## 二、前置准备</span>
<span class="hljs-bullet">1.</span> 确认 Mac 登录用户名：打开「系统设置」→「用户与群组」，记录当前用户名（示例中用户名为 <span class="hljs-code">`lixing`</span>，后续需替换为你的实际用户名）。
<span class="hljs-bullet">2.</span> 确保目标浏览器为系统默认：打开「系统设置」→「通用」→「默认网页浏览器」，选择常用浏览器（如 Safari、Chrome）。


<span class="hljs-section">## 三、关键前置：打开 Mac 隐藏的「资源库（Library）」</span>
Mac 中的「资源库（Library）」是核心文件夹，存放脚本、配置文件等关键内容，默认隐藏。后续步骤需多次用到，以下是 2 种常用打开方式：

<span class="hljs-section">### 方式1：通过「前往文件夹」直接跳转（最快）</span>
<span class="hljs-bullet">1.</span> 打开「Finder」（点击桌面底部 Dock 栏的蓝色笑脸图标）。
<span class="hljs-bullet">2.</span> 按快捷键 <span class="hljs-strong">**Command + Shift + G**</span>，弹出「前往文件夹」对话框。
<span class="hljs-bullet">3.</span> 输入目标路径（根据需求选择）：
<span class="hljs-bullet">   -</span> 打开「用户资源库」（后续主要用此路径）：输入 <span class="hljs-code">`~/Library`</span>，点击「前往」。
<span class="hljs-bullet">   -</span> 打开「系统资源库」（极少用到）：输入 <span class="hljs-code">`/Library`</span>，点击「前往」。
<span class="hljs-bullet">4.</span> 对话框会直接跳转到对应的「资源库」文件夹，无需手动查找。

<span class="hljs-section">### 方式2：通过终端命令打开（适合习惯用终端的用户）</span>
<span class="hljs-bullet">1.</span> 打开「终端」（通过 Spotlight 搜索“终端”启动，或在「应用程序→实用工具」中找到）。
<span class="hljs-bullet">2.</span> 输入以下命令（打开用户资源库），按回车：
   <span class="hljs-code">```bash
   open ~/Library
</span></code></pre>
<ol start="3">
<li>系统会自动弹出「资源库」文件夹窗口，直接操作即可。</li>
</ol>
<h2 data-id="heading-0">四、详细操作步骤</h2>
<h3 data-id="heading-1">步骤 1：用「自动操作」创建 “打开 URL” 工作流程</h3>
<ol>
<li>
<p>打开「自动操作」：通过 Spotlight 搜索（按 <code>Command+空格</code>，输入 “自动操作”）启动，或在「应用程序→实用工具」中找到并打开。</p>
</li>
<li>
<p>新建工作流程：点击「新建」，选择「工作流程」模板，点击「选取」。</p>
</li>
<li>
<p>添加 “运行 AppleScript” 操作：</p>
<ol>
<li>
<p>在左侧「操作库」搜索栏输入 “运行 AppleScript”，将该操作拖到右侧空白工作区。</p>
</li>
<li>
<p>删除操作中的默认代码，粘贴以下代码（直接内嵌打开 URL 逻辑）：</p>
<ul>
<li>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 目标飞书URL（无需修改）</span>
<span class="hljs-keyword">set</span> targetURL <span class="hljs-keyword">to</span> "https://hav4xarv6k.feishu.cn/share/base/form/shrcnRbIxP9bnHct1X1aCiKjYyc"
<span class="hljs-comment">-- 用默认浏览器打开链接</span>
<span class="hljs-keyword">open</span> location targetURL
<span class="hljs-comment">-- 弹出执行提示（可选，不想显示可删除这两行）</span>
display notification "已自动打开飞书需求表" <span class="hljs-keyword">with</span> title "定时任务完成" sound name "default"
</code></pre>
</li>
</ul>
</li>
<li>
<p>（可选）指定 Chrome 浏览器：若需用 Chrome 打开，将上述代码中 “用默认浏览器打开链接” 的行替换为：</p>
<ul>
<li>
<pre><code class="hljs language-lua" lang="lua">tell application <span class="hljs-string">"/Applications/Google Chrome.app"</span>
    <span class="hljs-built_in">open</span> location targetURL
    activate <span class="hljs-comment">-- 自动激活浏览器窗口</span>
<span class="hljs-keyword">end</span> tell
</code></pre>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>保存工作流程：</p>
<ol>
<li>按 <code>Command+S</code>，通过「三、关键前置」中的方法打开「用户资源库（~/Library）」。</li>
<li>进入 <code>Library→Scripts</code> 文件夹（若没有 <code>Scripts</code> 文件夹，右键空白处选择「新建文件夹」，命名为 <code>Scripts</code>）。</li>
<li>文件名输入 <code>OpenFeishuURL.workflow</code>（后缀必须为 <code>.workflow</code>，不可修改），点击「存储」。</li>
</ol>
</li>
</ol>
<h3 data-id="heading-2">步骤 2：创建「LaunchAgent」定时配置文件（plist）</h3>
<ol>
<li>
<p>打开「文本编辑」：通过 Spotlight 搜索启动，或在「应用程序」中找到并打开。</p>
</li>
<li>
<p>切换纯文本格式：点击顶部菜单栏「格式」→「制作纯文本」（必须切换，否则配置文件无效）。</p>
</li>
<li>
<p>粘贴配置代码：复制以下 XML 代码，粘贴到文本编辑中，<strong>关键修改 “用户名”</strong> （将 <code>lixing</code> 替换为你的实际用户名）：</p>
<ol>
<li>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">plist</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="hljs-string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">plist</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"1.0"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 任务唯一标识（无需修改） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Label<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>com.user.OpenFeishuURL<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 执行命令：调用自动操作的工作流程（替换用户名） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>ProgramArguments<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/usr/bin/automator<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/Users/lixing/Library/Scripts/OpenFeishuURL.workflow<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 定时规则：每天7个时间点（9/10/11/14/15/16/17点） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>StartCalendarInterval<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Hour<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>9<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Minute<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Hour<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Minute<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Hour<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Minute<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Hour<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>14<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Minute<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Hour<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>15<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Minute<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Hour<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>16<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Minute<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Hour<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Minute<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 日志路径（用于排查错误，无需修改） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>StandardOutPath<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/tmp/OpenFeishuURL.log<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>StandardErrorPath<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/tmp/OpenFeishuURL.error.log<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plist</span>&gt;</span>
</code></pre>
</li>
</ol>
</li>
<li>
<p>保存配置文件：</p>
<ol>
<li>按 <code>Command+S</code>，通过「三、关键前置」中的方法打开「用户资源库（~/Library）」，进入 <code>LaunchAgents</code> 文件夹（若没有该文件夹，手动新建并命名为 <code>LaunchAgents</code>）。</li>
<li>文件名输入 <code>com.user.OpenFeishuURL.plist</code>（需与代码中「Label」字段一致，不可修改），点击「存储」。</li>
</ol>
</li>
</ol>
<h3 data-id="heading-3">步骤 3：通过终端加载并激活定时任务</h3>
<ol>
<li>
<p>打开「终端」：通过 Spotlight 搜索（输入 “终端”）启动，或在「应用程序→实用工具」中找到。</p>
</li>
<li>
<p>卸载旧任务（若之前加载过）：输入以下命令，按回车（若提示 “找不到服务”，直接跳过）：</p>
<ol>
<li>
<pre><code class="hljs language-javascript" lang="javascript">launchctl unload ~<span class="hljs-regexp">/Library/</span><span class="hljs-title class_">LaunchAgents</span>/com.<span class="hljs-property">user</span>.<span class="hljs-property">OpenFeishuURL</span>.<span class="hljs-property">plist</span>
</code></pre>
</li>
</ol>
</li>
<li>
<p>加载新任务：输入以下命令，按回车（若提示输入密码，输入 Mac 登录密码，输入时密码不显示，输完直接回车）：</p>
<ol>
<li>
<pre><code class="hljs language-javascript" lang="javascript">launchctl bootstrap gui/$(id -u) ~<span class="hljs-regexp">/Library/</span><span class="hljs-title class_">LaunchAgents</span>/com.<span class="hljs-property">user</span>.<span class="hljs-property">OpenFeishuURL</span>.<span class="hljs-property">plist</span>
</code></pre>
</li>
<li>若执行后无任何提示，说明加载成功；若有报错，参考「问题排查」部分处理。</li>
</ol>
</li>
<li>
<p>验证加载结果：输入以下命令，按回车，若显示包含 <code>com.user.OpenFeishuURL</code> 的条目，说明加载成功：</p>
<ol>
<li>
<pre><code class="hljs language-perl" lang="perl">launchctl list | <span class="hljs-keyword">grep</span> com.user.OpenFeishuURL
</code></pre>
</li>
</ol>
</li>
<li>
<p>手动测试任务：输入以下命令，按回车，若浏览器自动打开目标 URL，且弹出提示（若未删除提示代码），说明任务正常：</p>
<ol>
<li>
<pre><code class="hljs language-sql" lang="sql">launchctl <span class="hljs-keyword">start</span> com.user.OpenFeishuURL
</code></pre>
</li>
</ol>
</li>
</ol>
<h2 data-id="heading-4">五、问题排查</h2>
<h3 data-id="heading-5">1. 加载任务时提示 “Input/output error”</h3>
<ul>
<li>
<p>原因：plist 文件格式错误或路径不正确。</p>
</li>
<li>
<p>解决：</p>
<ul>
<li>
<p>检查 plist 纯文本格式：打开 plist 文件，确认「格式」已勾选「制作纯文本」。</p>
</li>
<li>
<p>验证 XML 语法：在终端输入以下命令，按回车，根据提示修正错误（如 “第 X 行缺少引号”）：</p>
<ol>
<li>
<pre><code class="hljs language-javascript" lang="javascript">plutil ~<span class="hljs-regexp">/Library/</span><span class="hljs-title class_">LaunchAgents</span>/com.<span class="hljs-property">user</span>.<span class="hljs-property">OpenFeishuURL</span>.<span class="hljs-property">plist</span>
</code></pre>
</li>
</ol>
</li>
<li>
<p>确认路径正确：检查 plist 中 <code>ProgramArguments</code> 下的工作流程路径，确保用户名和文件名正确（可在 Finder 中找到文件，拖入终端获取正确路径）。</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">2. 手动测试时不打开浏览器</h3>
<ul>
<li>
<p>原因：权限不足或浏览器路径错误。</p>
</li>
<li>
<p>解决：</p>
<ul>
<li>检查自动化权限：打开「系统设置→隐私与安全性→自动化」，确保「终端」和「自动操作」已允许访问默认浏览器（如 Safari/Chrome）。</li>
<li>确认浏览器路径：若指定 Chrome，检查代码中 <code>"/Applications/Google Chrome.app"</code> 路径是否正确（若 Chrome 安装在其他位置，需修改路径）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">3. 定时任务到点不执行</h3>
<ul>
<li>
<p>原因：Mac 处于休眠状态或任务未加载。</p>
</li>
<li>
<p>解决：</p>
<ul>
<li>关闭休眠：打开「系统设置→电池→电源适配器」，勾选「防止电脑自动进入睡眠」（笔记本需接电源）。</li>
<li>重新加载任务：按步骤 3 重新执行 “卸载→加载” 命令。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-8">六、后续管理</h2>
<h3 data-id="heading-9">1. 修改定时时间</h3>
<ol>
<li>打开 <code>~/Library/LaunchAgents/com.user.OpenFeishuURL.plist</code> 文件。</li>
<li>修改 <code>StartCalendarInterval</code> 下的 <code>&lt;integer&gt;</code> 数值（如将 <code>9</code> 改为 <code>8</code>，即 8 点执行）。</li>
<li>在终端重新执行 “卸载→加载” 命令，使修改生效。</li>
</ol>
<h3 data-id="heading-10">2. 停止定时任务</h3>
<p>在终端输入以下命令，按回车：</p>
<pre><code class="hljs language-javascript" lang="javascript">launchctl unload ~<span class="hljs-regexp">/Library/</span><span class="hljs-title class_">LaunchAgents</span>/com.<span class="hljs-property">user</span>.<span class="hljs-property">OpenFeishuURL</span>.<span class="hljs-property">plist</span>
</code></pre>
<h3 data-id="heading-11">3. 永久删除任务</h3>
<ol>
<li>
<p>执行 “停止定时任务” 命令。</p>
</li>
<li>
<p>删除两个核心文件：</p>
<ol>
<li>工作流程：<code>~/Library/Scripts/OpenFeishuURL.workflow</code></li>
<li>配置文件：<code>~/Library/LaunchAgents/com.user.OpenFeishuURL.plist</code></li>
</ol>
</li>
</ol>
<pre><code class="hljs language-css" lang="css">你可以直接将上述代码复制到任意 Markdown 编辑器（如 Typora、VS <span class="hljs-selector-tag">Code</span>、飞书文档等）中，即可正常显示标题、列表、代码块等格式。如果需要进一步调整格式（如添加表格、补充注释），或导出为 PDF/Word，都可以基于这个基础版本修改~
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NSQ 磁盘持久队列 DiskQueue 设计思想全解析]]></title>    <link>https://juejin.cn/post/7576914798056898612</link>    <guid>https://juejin.cn/post/7576914798056898612</guid>    <pubDate>2025-11-27T03:38:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576914798056898612" data-draft-id="7576914798056882228" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NSQ 磁盘持久队列 DiskQueue 设计思想全解析"/> <meta itemprop="keywords" content="Go,NSQ"/> <meta itemprop="datePublished" content="2025-11-27T03:38:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="想搞艺术的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/860232800801568"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NSQ 磁盘持久队列 DiskQueue 设计思想全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/860232800801568/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    想搞艺术的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T03:38:39.000Z" title="Thu Nov 27 2025 03:38:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>—— 为什么 NSQ 的 DiskQueue 不用锁也能做到高性能、强一致？</strong></p>
<p>NSQ 的 <code>diskqueue</code> 是一个极其优雅的磁盘持久化 FIFO 队列实现。它的代码不多，却藏着许多工程上的巧思：</p>
<ul>
<li>单调度协程保证线程安全</li>
<li>记录格式简洁高效（长度+数据）</li>
<li>元数据持久化设计稳健</li>
<li>文件滚动策略减少 IO 并保持性能</li>
</ul>
<p>本文从<strong>设计思想</strong>切入，结合源码逐块解析 <code>diskqueue</code> 是如何实现一个可持久、线程安全、性能稳定的磁盘队列。</p>
<hr/>
<h2 data-id="heading-0">1. 单协程调度（ioLoop）保证线程安全：无需加锁</h2>
<p>DiskQueue 的最巧妙设计之一，就是所有写入、读取、同步、文件滚动等操作都在 <strong>一个 ioLoop 协程中完成</strong>。</p>
<p>即使 <code>diskQueue</code> 结构体上存在 <code>RWMutex</code>，但核心变量（read/write position、file num、depth）都只在 ioLoop 中修改，因此<strong>可以不用锁，天然线程安全</strong>。</p>
<p>创建队列时就启动这个协程：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// diskqueue.go: New()</span>
<span class="hljs-keyword">go</span> d.ioLoop()
</code></pre>
<p>来看 ioLoop 的结构：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// diskqueue.go: ioLoop()</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *diskQueue)</span></span> ioLoop() {
    <span class="hljs-keyword">for</span> {
        <span class="hljs-keyword">select</span> {
        <span class="hljs-keyword">case</span> data := &lt;-d.writeChan:
            err := d.writeOne(data)
            d.writeResponseChan &lt;- err
        
        <span class="hljs-keyword">case</span> &lt;-d.emptyChan:
            err := d.deleteAllFiles()
            d.emptyResponseChan &lt;- err

        <span class="hljs-keyword">case</span> d.depthChan &lt;- d.depth:
            <span class="hljs-comment">// return depth</span>

        <span class="hljs-comment">// 其他分支：退出、同步等...</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-1">✨ 设计亮点</h4>
<ul>
<li><strong>所有请求都通过 channel 串行进入 ioLoop</strong>
生产者调用 <code>Put()</code> → writeChan → ioLoop → writeOne()</li>
<li><strong>ioLoop 不需要任何互斥锁</strong>
因为写入操作永远在单协程执行，不存在并发修改。</li>
<li><strong>读通道 readChan 也在循环内安全发送</strong></li>
</ul>
<p>这与 Redis 的单线程模型有异曲同工之妙：<strong>串行化换线程安全，避免锁开销</strong>。</p>
<hr/>
<h2 data-id="heading-2">2. 内容数据按（长度+数据）格式写入磁盘</h2>
<p>NSQ 为每条记录写入：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-number">4</span>字节长度（<span class="hljs-type">int32</span> 大端序） + N 字节消息内容
</code></pre>
<h4 data-id="heading-3">写入逻辑在 <code>writeOne()</code>：</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// diskqueue.go: writeOne()</span>
dataLen := <span class="hljs-type">int32</span>(<span class="hljs-built_in">len</span>(data))
totalBytes := <span class="hljs-type">int64</span>(<span class="hljs-number">4</span> + dataLen)

<span class="hljs-comment">// 写长度</span>
binary.Write(&amp;d.writeBuf, binary.BigEndian, dataLen)

<span class="hljs-comment">// 写内容</span>
d.writeBuf.Write(data)

<span class="hljs-comment">// 一次性写入文件</span>
_, err = d.writeFile.Write(d.writeBuf.Bytes())
</code></pre>
<h4 data-id="heading-4">为什么采用“长度 + 内容”？</h4>
<ul>
<li>读取时无需扫描分隔符，直接按长度读取 → <strong>高性能顺序读</strong></li>
<li>能快速跳过损坏数据（长度检测） → <strong>增强鲁棒性</strong></li>
<li>二进制格式紧凑 → <strong>磁盘占用小</strong></li>
</ul>
<h4 data-id="heading-5">文件满了会自动滚动</h4>
<p>当 <code>writePos + totalBytes &gt; maxBytesPerFile</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> d.writePos &gt; <span class="hljs-number">0</span> &amp;&amp; d.writePos+totalBytes &gt; d.maxBytesPerFile {
    d.writeFileNum++
    d.writePos = <span class="hljs-number">0</span>
    d.sync()
    d.writeFile.Close()
}
</code></pre>
<p>即：<strong>当前文件满 → fsync → 开新文件继续写</strong>。</p>
<hr/>
<h2 data-id="heading-6">3. 元数据持久化：周期性记录读写进度</h2>
<p>为了保证<strong>崩溃后仍能从正确位置恢复</strong>，DiskQueue 会定期将读写指针和 depth 写入 metadata 文件。</p>
<p>元数据内容示例：</p>
<pre><code class="hljs">depth
readFileNum,readPos
writeFileNum,writePos
</code></pre>
<p>对应的写逻辑在：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// diskqueue.go: persistMetaData()</span>
fmt.Fprintf(f, <span class="hljs-string">"%d\n%d,%d\n%d,%d\n"</span>,
    d.depth,
    d.readFileNum, d.readPos,
    d.writeFileNum, d.writePos)
</code></pre>
<p>采用安全的 <strong>tmp file + rename 原子替换</strong>，保证文件内部的数据是完整：</p>
<pre><code class="hljs language-go" lang="go">tmpFileName := fmt.Sprintf(<span class="hljs-string">"%s.%d.tmp"</span>, fileName, rand.Int())
os.Rename(tmpFileName, fileName)  <span class="hljs-comment">// 原子提交</span>
</code></pre>
<p>这样即使在持久化过程中崩溃也不会破坏原有 metadata。</p>
<h4 data-id="heading-7">什么时候会同步？</h4>
<p>两种模式：</p>
<ol>
<li><strong>每写 X 条消息</strong>（通过 syncEvery 配置）</li>
<li><strong>定时 syncTimeout 触发 fsync</strong></li>
</ol>
<p>触发逻辑在 ioLoop 中处理：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> d.needSync &amp;&amp; (writes%syncEvery == <span class="hljs-number">0</span> || time.Since(lastSync) &gt; syncTimeout) {
    d.sync()
}
</code></pre>
<hr/>
<h2 data-id="heading-8">4. 读取记录（一次取一条，同样采用“长度+数据”格式）</h2>
<p>读取逻辑在 <code>readOne()</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> msgSize <span class="hljs-type">int32</span>
binary.Read(d.reader, binary.BigEndian, &amp;msgSize)

readBuf := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, msgSize)
io.ReadFull(d.reader, readBuf)
</code></pre>
<p>并计算下一次读取的位置：</p>
<pre><code class="hljs language-go" lang="go">totalBytes := <span class="hljs-type">int64</span>(<span class="hljs-number">4</span> + msgSize)
d.nextReadPos = d.readPos + totalBytes
</code></pre>
<h4 data-id="heading-9">文件滚动</h4>
<p>读取到文件末尾时：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> d.readFileNum &lt; d.writeFileNum &amp;&amp; d.nextReadPos &gt;= d.maxBytesPerFileRead {
    d.nextReadFileNum++
    d.nextReadPos = <span class="hljs-number">0</span>
}
</code></pre>
<p>DiskQueue 会自动切换到下一个文件。</p>
<hr/>
<h2 data-id="heading-10">总结：DiskQueue 以极小的代码实现极稳健的持久化队列</h2>

























<table><thead><tr><th>设计点</th><th>带来的价值</th></tr></thead><tbody><tr><td>ioLoop 单协程串行调度</td><td>无锁、线程安全、高性能</td></tr><tr><td>长度+数据 格式</td><td>顺序读写最高效、格式安全</td></tr><tr><td>文件滚动策略</td><td>提高磁盘局部性，避免巨型文件</td></tr><tr><td>metadata 原子持久化</td><td>崩溃可恢复，不产生部分写入</td></tr></tbody></table>
<p>NSQ 的 DiskQueue 是工程中<strong>小而美、高可靠、高性能</strong>磁盘队列实现的典范，非常值得学习。</p>
<p>如果你正在实现：</p>
<ul>
<li>本地消息队列</li>
<li>任务执行器的持久化存储</li>
<li>分布式系统的持久化 mailbox</li>
<li>WAL / 顺序写日志</li>
</ul>
<p>DiskQueue 都是一个极好的参考。</p>
<blockquote>
<p>nsq的diskqueue源码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnsqio%2Fgo-diskqueue%2Fblob%2Fmaster%2Fdiskqueue.go" target="_blank" title="https://github.com/nsqio/go-diskqueue/blob/master/diskqueue.go" ref="nofollow noopener noreferrer">github.com/nsqio/go-di…</a></p>
</blockquote>
<blockquote>
<p>我的小栈：<a href="https://link.juejin.cn?target=https%3A%2F%2Fitart.cn%2Fblogs%2F2025%2Fpractice%2Fnsq-diskqueue-persistent-queue-design-analysis.html" target="_blank" title="https://itart.cn/blogs/2025/practice/nsq-diskqueue-persistent-queue-design-analysis.html" ref="nofollow noopener noreferrer">itart.cn/blogs/2025/…</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot CLI 从入门到企业级实战（上下篇）]]></title>    <link>https://juejin.cn/post/7576844295434616841</link>    <guid>https://juejin.cn/post/7576844295434616841</guid>    <pubDate>2025-11-27T00:28:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576844295434616841" data-draft-id="7576863819982323721" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot CLI 从入门到企业级实战（上下篇）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T00:28:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大头an"/> <meta itemprop="url" content="https://juejin.cn/user/618374030438861"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot CLI 从入门到企业级实战（上下篇）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/618374030438861/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大头an
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:28:57.000Z" title="Thu Nov 27 2025 00:28:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Boot CLI 完全指南（上篇）：从入门到企业级实战</h2>
<h3 data-id="heading-1">前言</h3>
<p>在当今快节奏的软件开发世界中，效率就是竞争力。Spring Boot CLI 作为 Spring 生态中的隐藏瑰宝，能够将项目初始化时间从小时级缩短到秒级，将复杂配置从手动操作变为一键生成。无论你是刚刚接触 Spring Boot 的新手，还是正在构建大型微服务架构的资深架构师，掌握 Spring Boot CLI 都将为你的开发工作流带来革命性的提升。</p>
<p>本指南将带你从 CLI 的基础安装开始，逐步深入到企业级应用实战，最终探索架构师级别的高级用法。让我们开始这段高效开发之旅！</p>
<h3 data-id="heading-2">一、Spring Boot CLI 基础入门</h3>
<h4 data-id="heading-3">1.1 什么是 Spring Boot CLI？</h4>
<p>Spring Boot CLI（命令行接口）是一个强大的开发工具，它通过简化的命令行操作，让 Spring 应用的创建和管理变得前所未有的简单。</p>
<p><strong>核心价值矩阵：</strong></p>
<ul>
<li>⚡ <strong>极致效率</strong> - 项目初始化从想法到运行只需30秒</li>
<li>🎯 <strong>精准控制</strong> - 每个依赖、每个配置都可精确控制</li>
<li>🔄 <strong>一致性保证</strong> - 团队项目结构标准化</li>
<li>🔧 <strong>灵活扩展</strong> - 支持各种复杂场景需求</li>
</ul>
<h4 data-id="heading-4">1.2 安装与配置</h4>
<h5 data-id="heading-5">多平台安装方案</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式1：SDKMAN!（推荐）</span>
sdk install springboot
spring --version

<span class="hljs-comment"># 方式2：Homebrew（Mac用户）</span>
brew tap spring-io/tap
brew install spring-boot

<span class="hljs-comment"># 方式3：手动安装</span>
<span class="hljs-comment"># 下载地址：https://repo.spring.io/release/org/springframework/boot/spring-boot-cli/</span>
</code></pre>
<h5 data-id="heading-6">验证安装</h5>
<pre><code class="hljs language-bash" lang="bash">$ spring --version
Spring CLI v3.2.0-SNAPSHOT

$ spring
usage: spring [--<span class="hljs-built_in">help</span>] [--version]
       &lt;<span class="hljs-built_in">command</span>&gt; [&lt;args&gt;]

Available commands are:
  init [options] [location]
    Initialize a new project using Spring Initializr
  encodepassword [options] &lt;password to encode&gt;
    Encode a password <span class="hljs-keyword">for</span> use with Spring Security
  shell
    Start a nested shell
</code></pre>
<h4 data-id="heading-7">1.3 核心命令详解</h4>
<h5 data-id="heading-8">项目初始化（init）</h5>
<p><strong>基础用法：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 简单Web项目</span>
spring init --dependencies=web my-web-app

<span class="hljs-comment"># 包含数据访问的完整项目</span>
spring init --dependencies=web,data-jpa,security my-complete-app
</code></pre>
<p><strong>探索可用选项：</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ spring init --list
=======================================
Capabilities of https://start.spring.io
=======================================

Available dependencies:
-----------------------
web - Web: 全栈Web开发支持
data-jpa - Data JPA: Spring Data JPA 支持
security - Security: Spring Security 安全框架
...

Available project types:
------------------------
maven-project - Maven项目（默认）
gradle-project - Gradle项目
</code></pre>
<h5 data-id="heading-9">项目创建流程</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[开始项目创建] --&gt; B{选择构建工具}
    B --&gt; C[Maven]
    B --&gt; D[Gradle]
    
    C --&gt; E[配置Maven参数]
    D --&gt; F[配置Gradle参数]
    
    E --&gt; G{选择依赖}
    F --&gt; G
    
    G --&gt; H[Web相关]
    G --&gt; I[数据访问]
    G --&gt; J[安全框架]
    G --&gt; K[监控管理]
    
    H --&gt; L[thymeleaf, web, websocket]
    I --&gt; M[data-jpa, data-mongodb, redis]
    J --&gt; N[security, oauth2-client]
    K --&gt; O[actuator, devtools]
    
    L --&gt; P[生成项目结构]
    M --&gt; P
    N --&gt; P
    O --&gt; P
    
    P --&gt; Q[下载项目文件]
    Q --&gt; R[项目创建完成]
</code></pre>
<h3 data-id="heading-10">二、进阶功能与实战技巧</h3>
<h4 data-id="heading-11">2.1 高级项目配置</h4>
<p><strong>企业级项目配置：</strong></p>
<pre><code class="hljs language-bash" lang="bash">spring init \
  --build=gradle \
  --java-version=17 \
  --group-id=com.company \
  --artifact-id=enterprise-app \
  --name=<span class="hljs-string">"企业级应用"</span> \
  --description=<span class="hljs-string">"基于Spring Boot的企业级应用框架"</span> \
  --dependencies=web,data-jpa,security,redis,actuator \
  --packaging=jar \
  --package-name=com.company.enterprise \
  enterprise-project
</code></pre>
<p><strong>多环境配置模板：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开发环境</span>
spring init --dependencies=web,data-jpa,devtools,h2 dev-project

<span class="hljs-comment"># 生产环境  </span>
spring init --dependencies=web,data-jpa,mysql,actuator prod-project

<span class="hljs-comment"># 测试环境</span>
spring init --dependencies=web,data-jpa,testcontainers test-project
</code></pre>
<h4 data-id="heading-12">2.2 嵌入式 Shell 环境</h4>
<p>Spring Boot CLI 提供强大的交互式 Shell：</p>
<pre><code class="hljs language-bash" lang="bash">$ spring shell
Spring Boot (v3.2.0-SNAPSHOT)
Hit TAB to complete. Type <span class="hljs-string">'help'</span> and hit RETURN <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>, and <span class="hljs-string">'exit'</span> to quit.

<span class="hljs-comment"># 在Shell中直接操作</span>
$&gt; version
Spring CLI v3.2.0-SNAPSHOT

$&gt; init --dependencies=web demo-app
Using service at https://start.spring.io
Project extracted to <span class="hljs-string">'/path/to/demo-app'</span>

$&gt; !<span class="hljs-built_in">ls</span> -la  <span class="hljs-comment"># 执行本地命令</span>
</code></pre>
<h4 data-id="heading-13">2.3 批量项目生成</h4>
<p><strong>微服务批量创建脚本：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># create-microservices.sh</span>

services=(<span class="hljs-string">"user"</span> <span class="hljs-string">"order"</span> <span class="hljs-string">"product"</span> <span class="hljs-string">"inventory"</span> <span class="hljs-string">"notification"</span>)

<span class="hljs-keyword">for</span> service <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${services[@]}</span>"</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"创建服务: <span class="hljs-variable">$service</span>-service"</span>
    spring init \
        --dependencies=web,data-jpa,config-client \
        --group-id=com.company \
        --artifact-id=<span class="hljs-string">"<span class="hljs-variable">$service</span>-service"</span> \
        --name=<span class="hljs-string">"<span class="hljs-variable">$service</span>-service"</span> \
        <span class="hljs-string">"<span class="hljs-variable">$service</span>-service"</span> &amp;
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">wait</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"所有服务创建完成！"</span>
</code></pre>
<h3 data-id="heading-14">三、企业级实战应用</h3>
<h4 data-id="heading-15">3.1 微服务生态系统搭建</h4>
<p><strong>完整微服务套件：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># microservice-ecosystem.sh</span>

<span class="hljs-comment"># 基础设施服务</span>
INFRA_SERVICES=(
    <span class="hljs-string">"service-registry:eureka-server"</span>
    <span class="hljs-string">"config-server:config-server"</span> 
    <span class="hljs-string">"api-gateway:cloud-gateway,web"</span>
)

<span class="hljs-comment"># 业务微服务</span>
BUSINESS_SERVICES=(
    <span class="hljs-string">"user-service:web,data-jpa,config-client,validation"</span>
    <span class="hljs-string">"order-service:web,data-jpa,config-client,feign"</span> 
    <span class="hljs-string">"product-service:web,data-jpa,config-client"</span>
)

<span class="hljs-function"><span class="hljs-title">generate_service</span></span>() {
    <span class="hljs-built_in">local</span> service_name=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">local</span> dependencies=<span class="hljs-variable">$2</span>
    
    spring init \
        --build=gradle \
        --java-version=17 \
        --group-id=com.company.microservices \
        --artifact-id=<span class="hljs-string">"<span class="hljs-variable">$service_name</span>"</span> \
        --name=<span class="hljs-string">"<span class="hljs-variable">$service_name</span>"</span> \
        --dependencies=<span class="hljs-string">"<span class="hljs-variable">$dependencies</span>"</span> \
        <span class="hljs-string">"<span class="hljs-variable">$service_name</span>"</span>
}

<span class="hljs-comment"># 生成所有服务</span>
<span class="hljs-keyword">for</span> service <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${INFRA_SERVICES[@]}</span>"</span>; <span class="hljs-keyword">do</span>
    IFS=<span class="hljs-string">':'</span> <span class="hljs-built_in">read</span> -r name deps &lt;&lt;&lt; <span class="hljs-string">"<span class="hljs-variable">$service</span>"</span>
    generate_service <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$deps</span>"</span> &amp;
<span class="hljs-keyword">done</span>

<span class="hljs-keyword">for</span> service <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${BUSINESS_SERVICES[@]}</span>"</span>; <span class="hljs-keyword">do</span>
    IFS=<span class="hljs-string">':'</span> <span class="hljs-built_in">read</span> -r name deps &lt;&lt;&lt; <span class="hljs-string">"<span class="hljs-variable">$service</span>"</span>  
    generate_service <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$deps</span>"</span> &amp;
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">wait</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"微服务生态系统生成完成！"</span>
</code></pre>
<h4 data-id="heading-16">3.2 企业级开发工作流</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant D as 开发者
    participant C as Spring Boot CLI
    participant S as Spring Initializr
    participant G as Git
    participant CI as CI/CD流水线

    D-&gt;&gt;C: spring init 项目
    C-&gt;&gt;S: 请求项目模板
    S-&gt;&gt;C: 返回项目结构
    C-&gt;&gt;D: 生成项目文件
    D-&gt;&gt;G: git init &amp;&amp; 提交
    G-&gt;&gt;CI: 触发自动化流程
    CI-&gt;&gt;CI: 代码质量检查
    CI-&gt;&gt;CI: 安全合规扫描
    CI-&gt;&gt;CI: 自动化测试
    CI-&gt;&gt;CI: 构建和部署
    CI-&gt;&gt;D: 反馈构建结果
</code></pre>
<h4 data-id="heading-17">3.3 依赖管理策略</h4>
<p><strong>企业级依赖矩阵：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># enterprise-dependencies.yaml</span>
<span class="hljs-attr">profiles:</span>
  <span class="hljs-attr">foundation:</span>
    <span class="hljs-attr">base:</span> <span class="hljs-string">"web,devtools,configuration-processor"</span>
    <span class="hljs-attr">monitoring:</span> <span class="hljs-string">"actuator,metrics,prometheus"</span>
    
  <span class="hljs-attr">persistence:</span>
    <span class="hljs-attr">rdbms:</span> <span class="hljs-string">"data-jpa,h2,mysql"</span>
    <span class="hljs-attr">nosql:</span> <span class="hljs-string">"data-mongodb,data-redis"</span>
    
  <span class="hljs-attr">communication:</span>
    <span class="hljs-attr">rest:</span> <span class="hljs-string">"web,webflux,restdocs"</span>
    <span class="hljs-attr">messaging:</span> <span class="hljs-string">"amqp,kafka"</span>
    
  <span class="hljs-attr">security:</span>
    <span class="hljs-attr">basic:</span> <span class="hljs-string">"security"</span>
    <span class="hljs-attr">oauth2:</span> <span class="hljs-string">"oauth2-client,oauth2-resource-server"</span>
</code></pre>
<h3 data-id="heading-18">四、监控与可观测性</h3>
<h4 data-id="heading-19">4.1 完整的监控栈</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># monitoring-stack-setup.sh</span>

<span class="hljs-comment"># 监控基础设施</span>
spring init --dependencies=actuator,prometheus,micrometer-registry-prometheus \
            --name=<span class="hljs-string">"monitoring-server"</span> \
            monitoring-server

<span class="hljs-comment"># 分布式追踪</span>
spring init --dependencies=web,actuator,sleuth,zipkin \
            --name=<span class="hljs-string">"tracing-server"</span> \ 
            tracing-server

<span class="hljs-comment"># 为业务服务添加监控</span>
<span class="hljs-function"><span class="hljs-title">add_monitoring_to_service</span></span>() {
    <span class="hljs-built_in">local</span> service_dir=<span class="hljs-variable">$1</span>
    
    <span class="hljs-comment"># 添加监控配置</span>
    <span class="hljs-built_in">cat</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$service_dir</span>/src/main/resources/application-monitoring.yml"</span> &lt;&lt; <span class="hljs-string">'EOF'</span>
management:
  endpoints:
    web:
      exposure:
        include: <span class="hljs-string">"health,info,metrics,prometheus"</span>
  metrics:
    <span class="hljs-built_in">export</span>:
      prometheus:
        enabled: <span class="hljs-literal">true</span>
EOF
}
</code></pre>
<h4 data-id="heading-20">4.2 健康检查架构</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[应用启动] --&gt; B[就绪探针检查]
    B --&gt; C{是否就绪?}
    C --&gt;|是| D[接收流量]
    C --&gt;|否| E[继续初始化]
    
    F[运行期监控] --&gt; G[存活探针检查]
    G --&gt; H{是否健康?}
    H --&gt;|是| F
    H --&gt;|否| I[重启实例]
    
    J[外部监控] --&gt; K[Prometheus 抓取]
    K --&gt; L[指标存储]
    L --&gt; M[Grafana 展示]
    L --&gt; N[告警触发]
</code></pre>
<h3 data-id="heading-21">总结（上篇）</h3>
<p>通过上篇的学习，我们掌握了 Spring Boot CLI 的核心概念和在企业环境中的基础应用。关键收获包括：</p>
<ol>
<li><strong>🚀 安装配置</strong> - 掌握了多平台安装和验证方法</li>
<li><strong>🛠️ 核心命令</strong> - 熟练使用 init、shell 等关键命令</li>
<li><strong>🏗️ 项目生成</strong> - 学会了单项目和批量项目创建</li>
<li><strong>🔧 企业实践</strong> - 了解了微服务生态系统的搭建方法</li>
<li><strong>📊 监控观测</strong> - 掌握了基本的监控和健康检查配置</li>
</ol>
<p>这些基础技能为下篇的架构师级高级用法打下了坚实基础。在下篇中，我们将深入探讨安全架构、部署流水线、性能优化等高级主题，带你从使用者转变为 Spring Boot CLI 专家。</p>
<hr/>
<h2 data-id="heading-22">Spring Boot CLI 完全指南（下篇）：架构师级高级实战</h2>
<h3 data-id="heading-23">前言</h3>
<p>在掌握了 Spring Boot CLI 的基础用法和企业级实践后，我们将进入更高阶的领域。作为架构师，我们不仅要会使用工具，更要理解如何将工具融入完整的软件开发生命周期，如何设计符合企业标准的安全架构，如何构建可靠的部署流水线，以及如何持续优化系统性能。</p>
<p>下篇将聚焦于架构师视角的 Spring Boot CLI 高级用法，包括安全架构设计、云原生集成、性能优化、合规性检查等关键主题。让我们深入探索，将开发效率提升到新的高度。</p>
<h3 data-id="heading-24">五、安全架构设计</h3>
<h4 data-id="heading-25">5.1 多层次安全防护</h4>
<p><strong>安全服务生成：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># security-architecture.sh</span>

<span class="hljs-comment"># 1. 认证服务</span>
spring init --dependencies=web,data-jpa,security,oauth2-authorization-server,jwt \
            --name=<span class="hljs-string">"auth-server"</span> \
            --package-name=com.company.security.auth \
            auth-server

<span class="hljs-comment"># 2. 资源服务模板  </span>
spring init --dependencies=web,data-jpa,oauth2-resource-server,validation \
            --name=<span class="hljs-string">"resource-server-template"</span> \
            --package-name=com.company.security.resource \
            resource-server-template

<span class="hljs-comment"># 3. API 网关安全</span>
spring init --dependencies=cloud-gateway,oauth2-client,redis,actuator \
            --name=<span class="hljs-string">"secure-gateway"</span> \
            --package-name=com.company.security.gateway \
            secure-gateway
</code></pre>
<h4 data-id="heading-26">5.2 安全合规性检查</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># security-compliance.sh</span>

<span class="hljs-function"><span class="hljs-title">check_security_compliance</span></span>() {
    <span class="hljs-built_in">local</span> project_dir=<span class="hljs-variable">$1</span>
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"检查安全合规性: <span class="hljs-variable">$project_dir</span>"</span>
    
    <span class="hljs-built_in">local</span> score=0
    <span class="hljs-built_in">local</span> total=8
    
    <span class="hljs-comment"># 检查安全依赖</span>
    <span class="hljs-keyword">if</span> grep -q <span class="hljs-string">"spring-boot-starter-security"</span> <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>/build.gradle"</span>; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 包含安全依赖"</span>
        ((score++))
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># 检查SSL配置</span>
    <span class="hljs-keyword">if</span> find <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>"</span> -name <span class="hljs-string">"*.yml"</span> | xargs grep -q <span class="hljs-string">"server.ssl"</span>; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ SSL/TLS 配置存在"</span>
        ((score++))
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># 计算合规分数</span>
    <span class="hljs-built_in">local</span> compliance_rate=$((score * <span class="hljs-number">100</span> / total))
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"安全合规率: <span class="hljs-variable">$compliance_rate</span>% (<span class="hljs-variable">$score</span>/<span class="hljs-variable">$total</span>)"</span>
    
    <span class="hljs-built_in">return</span> $((compliance_rate &gt;= <span class="hljs-number">80</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>))
}
</code></pre>
<h4 data-id="heading-27">5.3 安全架构流程图</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[客户端请求] --&gt; B[API Gateway]
    B --&gt; C{认证检查}
    C --&gt;|未认证| D[重定向到 Auth Server]
    C --&gt;|已认证| E[路由到业务服务]
    
    D --&gt; F[用户登录]
    F --&gt; G[颁发Token]
    G --&gt; B
    
    E --&gt; H[业务服务]
    H --&gt; I[资源服务器验证Token]
    I --&gt; J[访问数据库]
    
    K[监控系统] --&gt; L[安全事件收集]
    L --&gt; M[异常检测]
    M --&gt; N[自动响应]
</code></pre>
<h3 data-id="heading-28">六、云原生与容器化</h3>
<h4 data-id="heading-29">6.1 Kubernetes 就绪配置</h4>
<p><strong>服务网格配置生成：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># service-mesh-setup.sh</span>

<span class="hljs-function"><span class="hljs-title">generate_service_mesh_config</span></span>() {
    <span class="hljs-built_in">local</span> service_name=<span class="hljs-variable">$1</span>
    
    <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">"<span class="hljs-variable">$service_name</span>/src/main/resources/META-INF"</span>
    
    <span class="hljs-comment"># 生成 Kubernetes 配置</span>
    <span class="hljs-built_in">cat</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$service_name</span>/src/main/resources/META-INF/kubernetes.yml"</span> &lt;&lt; <span class="hljs-string">EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: $service_name
spec:
  replicas: 2
  selector:
    matchLabels:
      app: $service_name
  template:
    metadata:
      labels:
        app: $service_name
    spec:
      containers:
      - name: $service_name
        image: company/$service_name:latest
        ports:
        - containerPort: 8080
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /actuator/health/liveness
            port: 8080
EOF</span>
}
</code></pre>
<h4 data-id="heading-30">6.2 多环境部署策略</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># deployment-pipeline.sh</span>

<span class="hljs-function"><span class="hljs-title">generate_deployment_config</span></span>() {
    <span class="hljs-built_in">local</span> service_name=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">local</span> environment=<span class="hljs-variable">$2</span>
    
    <span class="hljs-keyword">case</span> <span class="hljs-variable">$environment</span> <span class="hljs-keyword">in</span>
        <span class="hljs-string">"dev"</span>)
            <span class="hljs-comment"># 开发环境配置</span>
            ;;
        <span class="hljs-string">"prod"</span>)
            <span class="hljs-comment"># 生产环境配置</span>
            ;;
    <span class="hljs-keyword">esac</span>
}

<span class="hljs-comment"># 为所有服务生成多环境配置</span>
SERVICES=(<span class="hljs-string">"user-service"</span> <span class="hljs-string">"order-service"</span> <span class="hljs-string">"product-service"</span>)
ENVIRONMENTS=(<span class="hljs-string">"dev"</span> <span class="hljs-string">"staging"</span> <span class="hljs-string">"prod"</span>)

<span class="hljs-keyword">for</span> service <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${SERVICES[@]}</span>"</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">env</span> <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${ENVIRONMENTS[@]}</span>"</span>; <span class="hljs-keyword">do</span>
        generate_deployment_config <span class="hljs-string">"<span class="hljs-variable">$service</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$env</span>"</span>
    <span class="hljs-keyword">done</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h3 data-id="heading-31">七、性能优化与调优</h3>
<h4 data-id="heading-32">7.1 依赖优化策略</h4>
<p><strong>依赖分析脚本：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># dependency-optimizer.sh</span>

<span class="hljs-function"><span class="hljs-title">analyze_dependencies</span></span>() {
    <span class="hljs-built_in">local</span> project_dir=<span class="hljs-variable">$1</span>
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"分析项目依赖: <span class="hljs-variable">$project_dir</span>"</span>
    
    <span class="hljs-keyword">if</span> [[ -f <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>/build.gradle"</span> ]]; <span class="hljs-keyword">then</span>
        <span class="hljs-comment"># 提取依赖列表</span>
        <span class="hljs-built_in">local</span> dependencies=$(grep <span class="hljs-string">"implementation"</span> <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>/build.gradle"</span> | <span class="hljs-built_in">wc</span> -l)
        <span class="hljs-built_in">local</span> test_dependencies=$(grep <span class="hljs-string">"testImplementation"</span> <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>/build.gradle"</span> | <span class="hljs-built_in">wc</span> -l)
        
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"实现依赖: <span class="hljs-variable">$dependencies</span> 个"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"测试依赖: <span class="hljs-variable">$test_dependencies</span> 个"</span>
        
        <span class="hljs-comment"># 建议优化</span>
        <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$dependencies</span> -gt 15 ]]; <span class="hljs-keyword">then</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"⚠️  建议: 依赖数量较多，考虑模块化拆分"</span>
        <span class="hljs-keyword">fi</span>
        
        <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$test_dependencies</span> -eq 0 ]]; <span class="hljs-keyword">then</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"❌ 警告: 缺少测试依赖"</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>
}
</code></pre>
<h4 data-id="heading-33">7.2 构建性能优化</h4>
<p><strong>Gradle 构建优化配置：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># build-optimization.sh</span>

<span class="hljs-function"><span class="hljs-title">optimize_gradle_build</span></span>() {
    <span class="hljs-built_in">local</span> project_dir=<span class="hljs-variable">$1</span>
    
    <span class="hljs-built_in">cat</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>/gradle.properties"</span> &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment"># 构建性能优化</span>
org.gradle.parallel=<span class="hljs-literal">true</span>
org.gradle.caching=<span class="hljs-literal">true</span>
org.gradle.daemon=<span class="hljs-literal">true</span>
org.gradle.configureondemand=<span class="hljs-literal">true</span>

<span class="hljs-comment"># JVM 配置</span>
org.gradle.jvmargs=-Xmx4g -XX:MaxMetaspaceSize=1g -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8

<span class="hljs-comment"># 依赖下载优化</span>
systemProp.http.proxyHost=proxy.company.com
systemProp.http.proxyPort=8080
EOF

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ Gradle 构建配置已优化"</span>
}
</code></pre>
<h4 data-id="heading-34">7.3 应用性能监控</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[应用性能] --&gt; B[JVM 指标]
    A --&gt; C[数据库指标]
    A --&gt; D[HTTP 请求指标]
    
    B --&gt; E[GC 时间]
    B --&gt; F[堆内存使用]
    B --&gt; G[线程状态]
    
    C --&gt; H[查询性能]
    C --&gt; I[连接池状态]
    C --&gt; J[锁等待时间]
    
    D --&gt; K[响应时间]
    D --&gt; L[请求率]
    D --&gt; M[错误率]
    
    E --&gt; N[性能仪表板]
    F --&gt; N
    G --&gt; N
    H --&gt; N
    I --&gt; N
    J --&gt; N
    K --&gt; N
    L --&gt; N
    M --&gt; N
    
    N --&gt; O[自动告警]
    N --&gt; P[容量规划]
</code></pre>
<h3 data-id="heading-35">八、高级定制与扩展</h3>
<h4 data-id="heading-36">8.1 自定义 Initializr 服务</h4>
<p><strong>企业定制化配置：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># custom-initializr-setup.sh</span>

<span class="hljs-comment"># 使用企业内部 Initializr 服务</span>
spring init --target=http://internal-start.company.com \
            --dependencies=web,data-jpa,company-security \
            --<span class="hljs-built_in">type</span>=company-microservice \
            internal-project

<span class="hljs-comment"># 自定义项目类型</span>
spring init --<span class="hljs-built_in">type</span>=company-microservice \
            --dependencies=web,data-jpa,config-client \
            custom-service
</code></pre>
<h4 data-id="heading-37">8.2 CLI 插件开发</h4>
<p><strong>自定义命令示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 自定义 Spring Boot CLI 命令</span>
<span class="hljs-meta">@Order(0)</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompanyInitCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(ApplicationContext context)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 实现自定义项目初始化逻辑</span>
        System.out.println(<span class="hljs-string">"公司定制化项目初始化..."</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"company-init"</span>;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Initialize company standard project"</span>;
    }
}
</code></pre>
<h3 data-id="heading-38">九、架构质量与规范</h3>
<h4 data-id="heading-39">9.1 架构质量评估</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># architecture-quality-assessment.sh</span>

<span class="hljs-function"><span class="hljs-title">assess_architecture_quality</span></span>() {
    <span class="hljs-built_in">local</span> project_dir=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">local</span> project_name=<span class="hljs-variable">$2</span>
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"评估架构质量: <span class="hljs-variable">$project_name</span>"</span>
    
    <span class="hljs-built_in">local</span> metrics=()
    
    <span class="hljs-comment"># 依赖数量评估</span>
    <span class="hljs-built_in">local</span> dep_count=$(grep -c <span class="hljs-string">"implementation"</span> <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>/build.gradle"</span>)
    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$dep_count</span> -le 10 ]]; <span class="hljs-keyword">then</span>
        metrics+=(<span class="hljs-string">"✅ 依赖数量合理: <span class="hljs-variable">$dep_count</span>"</span>)
    <span class="hljs-keyword">else</span>
        metrics+=(<span class="hljs-string">"⚠️  依赖数量较多: <span class="hljs-variable">$dep_count</span>"</span>) 
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># 配置复杂度评估</span>
    <span class="hljs-built_in">local</span> config_files=$(find <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>/src/main/resources"</span> -name <span class="hljs-string">"*.yml"</span> | <span class="hljs-built_in">wc</span> -l)
    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$config_files</span> -le 3 ]]; <span class="hljs-keyword">then</span>
        metrics+=(<span class="hljs-string">"✅ 配置复杂度低"</span>)
    <span class="hljs-keyword">else</span>
        metrics+=(<span class="hljs-string">"⚠️  配置复杂度中: <span class="hljs-variable">$config_files</span> 个文件"</span>)
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># 输出评估结果</span>
    <span class="hljs-keyword">for</span> metric <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${metrics[@]}</span>"</span>; <span class="hljs-keyword">do</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$metric</span>"</span>
    <span class="hljs-keyword">done</span>
}
</code></pre>
<h4 data-id="heading-40">9.2 代码规范检查</h4>
<p><strong>自动化代码质量检查：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># code-quality-check.sh</span>

<span class="hljs-function"><span class="hljs-title">check_code_quality</span></span>() {
    <span class="hljs-built_in">local</span> project_dir=<span class="hljs-variable">$1</span>
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"检查代码质量: <span class="hljs-variable">$project_dir</span>"</span>
    
    <span class="hljs-comment"># 检查代码结构</span>
    <span class="hljs-keyword">if</span> [[ ! -d <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>/src/main/java"</span> ]]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"❌ 缺少标准代码目录结构"</span>
        <span class="hljs-built_in">return</span> 1
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># 检查配置文件</span>
    <span class="hljs-keyword">if</span> [[ ! -f <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>/src/main/resources/application.yml"</span> ]]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"⚠️  建议使用 YAML 格式配置文件"</span>
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># 检查测试覆盖率</span>
    <span class="hljs-keyword">if</span> [[ ! -d <span class="hljs-string">"<span class="hljs-variable">$project_dir</span>/src/test"</span> ]]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"❌ 缺少测试代码"</span>
        <span class="hljs-built_in">return</span> 1
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 代码质量检查通过"</span>
    <span class="hljs-built_in">return</span> 0
}
</code></pre>
<h3 data-id="heading-41">十、完整 DevOps 流水线集成</h3>
<h4 data-id="heading-42">10.1 端到端自动化流程</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[需求分析] --&gt; B[CLI 项目生成]
    B --&gt; C[代码开发]
    C --&gt; D[自动化测试]
    D --&gt; E[代码审查]
    E --&gt; F[安全扫描]
    F --&gt; G[构建打包]
    G --&gt; H[容器化]
    H --&gt; I[部署到环境]
    I --&gt; J[自动化测试]
    J --&gt; K[性能测试]
    K --&gt; L[生产部署]
    L --&gt; M[监控告警]
    
    subgraph 反馈循环
        M --&gt; N[指标分析]
        N --&gt; O[优化建议]
        O --&gt; B
    end
</code></pre>
<h4 data-id="heading-43">10.2 Jenkins 流水线集成</h4>
<pre><code class="hljs language-groovy" lang="groovy">pipeline {
    agent any
    parameters {
        choice(
            name: 'PROJECT_TYPE',
            choices: ['web-basic', 'microservice', 'full-stack'],
            description: '项目类型'
        )
    }
    stages {
        stage('Generate Project') {
            steps {
                script {
                    def depsMap = [
                        'web-basic': 'web,devtools',
                        'microservice': 'web,data-jpa,config-client',
                        'full-stack': 'web,data-jpa,security,actuator,thymeleaf'
                    ]
                    
                    sh """
                        spring init \
                            --build=gradle \
                            --java-version=17 \
                            --group-id=com.company.\${PROJECT_NAME} \
                            --dependencies=\${depsMap[params.PROJECT_TYPE]} \
                            \${PROJECT_NAME}
                    """
                }
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-44">总结（下篇）</h3>
<p>通过下篇的深入学习，我们掌握了 Spring Boot CLI 在架构师视角下的高级用法：</p>
<h4 data-id="heading-45">🎯 核心成就</h4>
<ol>
<li><strong>🔒 安全架构</strong> - 设计了多层次的安全防护体系</li>
<li><strong>☁️ 云原生集成</strong> - 实现了 Kubernetes 就绪的微服务架构</li>
<li><strong>⚡ 性能优化</strong> - 掌握了依赖优化和构建性能调优</li>
<li><strong>🔧 定制扩展</strong> - 学会了自定义 Initializr 和 CLI 插件开发</li>
<li><strong>📊 质量保障</strong> - 建立了完整的架构质量和代码规范检查体系</li>
<li><strong>🔄 DevOps 集成</strong> - 构建了端到端的自动化流水线</li>
</ol>
<h4 data-id="heading-46">🚀 从工具使用者到效率专家</h4>
<p>Spring Boot CLI 不仅仅是一个项目生成工具，它是现代软件开发理念的体现。通过将 CLI 深度集成到开发流程中，我们实现了：</p>
<ul>
<li><strong>标准化</strong> - 统一团队技术栈和项目结构</li>
<li><strong>自动化</strong> - 减少重复劳动，提升开发效率</li>
<li><strong>可视化</strong> - 清晰的架构流程图和质量评估</li>
<li><strong>可持续</strong> - 建立持续改进的反馈循环</li>
</ul>
<h4 data-id="heading-47">🌟 未来展望</h4>
<p>随着云原生和 AI 技术的不断发展，Spring Boot CLI 也将持续进化。我们可以期待：</p>
<ul>
<li>更智能的依赖推荐和冲突解决</li>
<li>与云平台更深度集成</li>
<li>AI 辅助的项目架构设计</li>
<li>更强大的可观测性集成</li>
</ul>
<p>掌握 Spring Boot CLI，不仅是掌握一个工具，更是拥抱高效、规范的现代软件开发范式。愿你在未来的开发之旅中，持续运用这些技能，构建更加卓越的软件系统。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【已开源】Cursor AI 开发实战：小文件在线互传工具]]></title>    <link>https://juejin.cn/post/7576968345875021851</link>    <guid>https://juejin.cn/post/7576968345875021851</guid>    <pubDate>2025-11-27T05:40:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576968345875021851" data-draft-id="7577189654472474650" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【已开源】Cursor AI 开发实战：小文件在线互传工具"/> <meta itemprop="keywords" content="Cursor,AI编程,开源"/> <meta itemprop="datePublished" content="2025-11-27T05:40:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="极客密码"/> <meta itemprop="url" content="https://juejin.cn/user/976022055165608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【已开源】Cursor AI 开发实战：小文件在线互传工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976022055165608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    极客密码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:40:29.000Z" title="Thu Nov 27 2025 05:40:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>灵机一动 + Cursor + 几个小时 = 一个完整的文件传输工具！这就是 AI 编程的魅力~</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9843123e06b941448177a7d804dc9ced~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764826829&amp;x-signature=9O2lbQ5i2sC2tws%2BGEqUZ7LvvwI%3D" alt="工具首页" loading="lazy"/></p>
<h2 data-id="heading-0">前言</h2>
<p>大家好！今天给大家分享一次<strong>纯纯的 AI 开发实战</strong>。</p>
<p>周末在家闲着没事，突然想到平时工作中经常需要在设备间传文件，或者临时给朋友分享个东西。现有的工具要么太重（百度网盘、微信那种），要么不够安全（公开链接谁都能访问），要么就是要付费。</p>
<p><strong>灵机一动</strong>：能不能做一个轻量级的临时文件传输工具？</p>
<p>然后打开 Cursor，开始和 AI 聊天，<strong>几个小时后</strong>，一个完整的项目就出来了 —— <strong>F2F.icu</strong>！</p>
<p>关键是，整个项目完全基于 <strong>Cloudflare 这个赛博大善人</strong>提供的免费服务，完美的<strong>穷鬼开发者套餐</strong>：不需要买服务器、不需要装数据库、不需要担心流量费用，还自带全球 CDN 加速！</p>
<p><strong>在线体验</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ff2f.icu" target="_blank" title="https://f2f.icu" ref="nofollow noopener noreferrer">f2f.icu</a></p>
<h2 data-id="heading-1">工具截图</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9843123e06b941448177a7d804dc9ced~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764826829&amp;x-signature=9O2lbQ5i2sC2tws%2BGEqUZ7LvvwI%3D" alt="工具首页" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b04550dc96bc4bdd89ddc5438baafd10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764826829&amp;x-signature=ELWA%2BnRFz5ed6k5T%2BP%2B80jZfc%2FU%3D" alt="发送文件" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3927cc8ebd104c4892b3a447eabf5882~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764826829&amp;x-signature=UKV1p9Vk2tg5u5jJPxWEkpZJnFo%3D" alt="创建分享" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5dceb14c4fe451c92d1b597b0e8b5a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764826829&amp;x-signature=dSAQOYn%2BBEVlLLZfzeNxcFDIuwg%3D" alt="i18n 国际化发送" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f85588d59d648bdb08f651c63df6941~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764826829&amp;x-signature=rIh4jmIzUkE9a38qaDyYcoIiypE%3D" alt="i18n 国际化接收" loading="lazy"/></p>
<h2 data-id="heading-2">核心特性</h2>
<p>先说说这个工具有啥亮点：</p>
<h3 data-id="heading-3">1. 极简的使用体验</h3>
<p>整个使用流程超级简单：</p>
<ul>
<li><strong>发送方</strong>：生成一个 6 位分享码 → 上传文件/文本 → 把码给对方</li>
<li><strong>接收方</strong>：输入 6 位取件码 → 一键下载</li>
</ul>
<p>就像快递取件一样，<strong>6 个字符搞定一切</strong>。不用注册登录，不用装 APP，打开网页就能用。</p>
<h3 data-id="heading-4">2. 自动销毁机制</h3>
<p>这个是我最喜欢的设计。数据的生命周期是这样的：</p>
<ul>
<li>上传后如果 <strong>1 小时没人下载</strong> → 自动删除</li>
<li>下载后 <strong>1 分钟</strong> → 自动删除</li>
</ul>
<p>为什么下载后不立即删除？因为考虑到网络不稳定的情况，给用户一个「重新下载」的缓冲时间。这样既保护了隐私，又提供了容错机制。</p>
<h3 data-id="heading-5">3. 完全免费 + 零维护</h3>
<p>这是重点！整个项目完全基于 Cloudflare 的免费服务：</p>
<ul>
<li><strong>Cloudflare Pages</strong>：托管前端（全球 CDN 加速）</li>
<li><strong>Cloudflare Workers</strong>：处理 API 请求（边缘计算）</li>
<li><strong>Cloudflare KV</strong>：存储文件数据（自动 TTL 过期删除）</li>
</ul>
<p>免费额度对个人使用来说完全够用：</p>
<ul>
<li>KV 读取：<strong>每天 10 万次</strong></li>
<li>KV 写入：<strong>每天 1000 次</strong></li>
<li>Workers 请求：<strong>每天 10 万次</strong></li>
</ul>
<p>而且因为用了 KV 的原生 TTL 特性，数据过期自动清理，<strong>完全零维护成本</strong>。</p>
<h2 data-id="heading-6">Cloudflare —— 赛博大善人的穷鬼开发套餐</h2>
<p>这里必须吹一波 Cloudflare。</p>
<p>作为一个穷鬼开发者（bushi），Cloudflare 简直是业界良心：</p>
<ul>
<li><strong>Cloudflare Pages</strong>：免费托管静态网站 + 全球 CDN</li>
<li><strong>Cloudflare Workers</strong>：免费 Serverless 函数（每天 10 万次请求）</li>
<li><strong>Cloudflare KV</strong>：免费键值存储（每天 10 万次读取）</li>
<li><strong>免费 SSL 证书</strong>：自动配置 HTTPS</li>
<li><strong>免费 DDoS 防护</strong>：自带安全防护</li>
</ul>
<p>这套组合拳下来，对于个人项目和小型应用来说，<strong>完全够用而且完全免费</strong>！</p>
<p>不需要绑信用卡（划重点），注册个账号就能用。这你受得了吗？</p>
<p>所以我这个项目从头到尾的成本只有个几块钱的域名费用。</p>
<h2 data-id="heading-7">技术架构</h2>
<p>下面聊聊技术实现，这也是我和 AI 一起讨论出来的方案。</p>
<h3 data-id="heading-8">为什么选 KV 而不是 R2？</h3>
<p>很多人可能会问，Cloudflare 不是有对象存储 R2 吗，为啥不用？</p>
<p>这里我做了个对比：</p>






























<table><thead><tr><th>特性</th><th>KV 存储</th><th>R2 对象存储</th></tr></thead><tbody><tr><td>单文件大小限制</td><td>25MB</td><td>5GB</td></tr><tr><td>TTL 支持</td><td>✅ 原生支持</td><td>❌ 需要手动实现定时清理</td></tr><tr><td>读写延迟</td><td>极低（边缘节点）</td><td>稍高（区域存储）</td></tr><tr><td>免费使用</td><td>✅ 直接用</td><td>❌ 需要绑定信用卡</td></tr></tbody></table>
<p>对于<strong>临时文件传输</strong>这个场景，KV 简直是完美选择：</p>
<ol>
<li><strong>原生 TTL</strong>：上传时直接设置过期时间，到期自动删除，不用写定时任务</li>
<li><strong>25MB 够用</strong>：日常传个文档、图片、小视频完全够</li>
<li><strong>零成本启动</strong>：不需要绑卡，注册就能用</li>
</ol>
<h3 data-id="heading-9">数据流转过程</h3>
<p>整个数据流是这样的：</p>
<pre><code class="hljs">发送方上传
  → 文件转 Base64 编码
  → 存入 KV（TTL: 1小时）
  → 返回分享码

接收方下载
  → 验证分享码
  → 从 KV 读取数据
  → 更新 TTL 为 1 分钟
  → 返回文件/文本
</code></pre>
<p>核心代码其实很简单，以上传为例（简化版）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// functions/api/upload.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onRequestPost</span>(<span class="hljs-params">{ request, env }</span>) {
  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">await</span> request.<span class="hljs-title function_">formData</span>();
  <span class="hljs-keyword">const</span> code = formData.<span class="hljs-title function_">get</span>(<span class="hljs-string">"code"</span>); <span class="hljs-comment">// 6位分享码</span>
  <span class="hljs-keyword">const</span> content = formData.<span class="hljs-title function_">get</span>(<span class="hljs-string">"content"</span>); <span class="hljs-comment">// Base64 内容</span>

  <span class="hljs-comment">// 存入 KV，设置 1 小时过期</span>
  <span class="hljs-keyword">await</span> env.<span class="hljs-property">TRANSFERS</span>.<span class="hljs-title function_">put</span>(
    code,
    <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">type</span>: <span class="hljs-string">"file"</span>,
      <span class="hljs-attr">content</span>: content,
      <span class="hljs-attr">fileName</span>: fileName,
      <span class="hljs-attr">downloaded</span>: <span class="hljs-literal">false</span>,
    }),
    {
      <span class="hljs-attr">expirationTtl</span>: <span class="hljs-number">3600</span>, <span class="hljs-comment">// 1小时 = 3600秒</span>
    }
  );

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> }));
}
</code></pre>
<p>下载时：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// functions/api/download.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onRequestGet</span>(<span class="hljs-params">{ request, env }</span>) {
  <span class="hljs-keyword">const</span> code = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(request.<span class="hljs-property">url</span>).<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"code"</span>);

  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> env.<span class="hljs-property">TRANSFERS</span>.<span class="hljs-title function_">get</span>(code);

  <span class="hljs-comment">// 标记为已下载，更新 TTL 为 1 分钟</span>
  <span class="hljs-keyword">await</span> env.<span class="hljs-property">TRANSFERS</span>.<span class="hljs-title function_">put</span>(
    code,
    <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      ...data,
      <span class="hljs-attr">downloaded</span>: <span class="hljs-literal">true</span>,
    }),
    {
      <span class="hljs-attr">expirationTtl</span>: <span class="hljs-number">60</span>, <span class="hljs-comment">// 1分钟后自动删除</span>
    }
  );

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
}
</code></pre>
<p>是不是很简洁？KV 的 API 非常易用，而且支持直接设置过期时间，省去了很多额外的清理逻辑。</p>
<h3 data-id="heading-10">前端设计</h3>
<p>前端我用了 Tailwind CSS + 原生 JavaScript，没有引入 Vue/React 这些框架，原因是：</p>
<ol>
<li><strong>体积小</strong>：整个前端打包后不到 100KB</li>
<li><strong>加载快</strong>：静态 HTML，秒开</li>
<li><strong>够用了</strong>：功能不复杂，用不着框架</li>
</ol>
<p>界面设计上追求<strong>极简</strong>：</p>
<ul>
<li>两个 Tab（发送/接收）</li>
<li>三种内容类型（文件/文本/图片）</li>
<li>一键操作（生成码 → 上传 → 分享）</li>
</ul>
<p>支持拖拽上传、粘贴截图（Ctrl/Cmd + V），这些交互细节让使用体验更好。</p>
<h2 data-id="heading-11">安全性考虑</h2>
<p>关于安全，有几点要说明：</p>
<h3 data-id="heading-12">分享码的强度</h3>
<p>6 位字符（A-Z, 0-9）= 36^6 = <strong>21.8 亿种组合</strong></p>
<p>理论上暴力破解的成功率是很低的，而且：</p>
<ul>
<li>数据会自动过期（最多 1 小时）</li>
<li>分享码只能使用一次（下载后 1 分钟删除）</li>
</ul>
<p>所以安全性对于<strong>临时文件传输</strong>场景是够用的。</p>
<h3 data-id="heading-13">使用建议</h3>
<p>虽然有一定安全性，但我还是建议：</p>
<p>⚠️ <strong>不要传输高度敏感信息</strong>（密码、私钥、身份证号等）</p>
<p>这个工具的定位是<strong>轻量级临时文件传输</strong>，适合：</p>
<ul>
<li>发送工作文档</li>
<li>分享照片/截图</li>
<li>传输代码文件</li>
<li>分享文本片段</li>
</ul>
<h2 data-id="heading-14">部署超简单</h2>
<p>说到部署，真的是简单到爆。完全不需要自己的服务器，只需要一个 Cloudflare 账号（免费）：</p>
<h3 data-id="heading-15">Fork + 一键部署</h3>
<ol>
<li>
<p><strong>Fork 我的 GitHub 仓库</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fisnl%2Ff2f" target="_blank" title="https://github.com/isnl/f2f" ref="nofollow noopener noreferrer">github.com/isnl/f2f</a></p>
</li>
<li>
<p><strong>连接到 Cloudflare Pages</strong></p>
<ul>
<li>登录 Cloudflare Dashboard</li>
<li>Workers &amp; Pages → 创建应用 → 连接 Git</li>
<li>选择你 Fork 的仓库</li>
<li>构建配置：输出目录填 <code>public</code></li>
</ul>
</li>
<li>
<p><strong>创建 KV 存储</strong></p>
<ul>
<li>在 KV 板块创建一个命名空间（比如 <code>f2f-transfers</code>）</li>
<li>在 Pages 项目设置中绑定这个 KV（变量名：<code>TRANSFERS</code>）</li>
</ul>
</li>
<li>
<p><strong>完成！</strong></p>
<p>Cloudflare 会给你一个域名，直接访问就能用。如果有自己的域名，还可以绑定自定义域名。</p>
</li>
</ol>
<p>整个过程 <strong>5 分钟搞定</strong>，而且之后不需要任何维护，Cloudflare 自动帮你处理全球分发、HTTPS 证书、数据清理等等。</p>
<h2 data-id="heading-16">一些有趣的优化</h2>
<h3 data-id="heading-17">1. 6 位分享码的设计</h3>
<p>为什么是 6 位？因为：</p>
<ul>
<li>4 位太短（只有 160 万组合，容易碰撞）</li>
<li>8 位太长（用户记忆和输入成本高）</li>
<li>6 位刚刚好（21 亿组合 + 便于记忆）</li>
</ul>
<p>而且只用大写字母和数字（不用小写），避免了 O 和 0、I 和 1 的混淆。</p>
<h3 data-id="heading-18">2. 图片的特殊处理</h3>
<p>对于图片类型，接收方可以直接在页面上预览，而不是强制下载。这样分享截图特别方便，对方打开链接就能看到。</p>
<h3 data-id="heading-19">3. 响应式设计</h3>
<p>全面适配手机、平板、电脑，在手机上的体验也很流畅。经常我在外面用手机传个文件给自己电脑，特别方便。</p>
<h3 data-id="heading-20">4. 国际化支持</h3>
<p>已经内置了中英双语支持（i18n），根据浏览器语言自动切换，代码里也准备了中英文文档。虽然功能简单，但该有的细节都有。</p>
<h2 data-id="heading-21">AI 编程的一些感悟</h2>
<h3 data-id="heading-22">1. AI 是放大器，不是替代品</h3>
<p>AI 让我的开发效率提升了至少 <strong>3-5 倍</strong>，但核心的：</p>
<ul>
<li>需求设计（要做什么）</li>
<li>技术选型（用什么方案）</li>
<li>问题发现（哪里不对劲）</li>
<li>体验优化（怎么做更好）</li>
</ul>
<p>这些还是需要我自己来决策。AI 是个超强的执行助手，但产品思维和技术判断还得靠人。</p>
<h3 data-id="heading-23">2. 会提问很重要</h3>
<p>和 AI 对话式编程，最重要的是<strong>会提问</strong>：</p>
<ul>
<li>❌ "帮我写个上传功能"（太笼统）</li>
<li>✅ "写一个文件上传 API，接收 FormData，验证文件大小不超过 25MB，转 Base64 存到 KV，设置 TTL 为 3600 秒"（清晰明确）</li>
</ul>
<p>问题越具体，AI 给的答案越准确。</p>
<h3 data-id="heading-24">3. 快速迭代才是王道</h3>
<p>有了 AI，我可以快速试错：</p>
<ul>
<li>想到一个功能 → 让 AI 实现 → 测试 → 不满意就换方案</li>
<li>整个过程可能只要几分钟</li>
</ul>
<p>这种快速迭代的能力，在以前是不敢想象的。</p>
<h3 data-id="heading-25">4. 专注于创意和产品</h3>
<p>因为 AI 帮我搞定了大量的"体力活"（写基础代码、调样式、配环境），我可以把更多精力放在：</p>
<ul>
<li>产品体验的打磨</li>
<li>功能细节的优化</li>
<li>用户场景的思考</li>
</ul>
<p>这才是真正有价值的部分。</p>
<h2 data-id="heading-26">总结</h2>
<h3 data-id="heading-27">关于 AI 编程开发</h3>
<p><strong>AI 真的改变了个人开发者的游戏规则</strong>。</p>
<p>以前做一个完整的项目，可能需要几天甚至几周。现在有了 Cursor 这样的 AI 编程工具，一个周末下午就能从想法到上线。</p>
<p>但关键是，你得知道自己要什么，然后引导 AI 去实现。AI 是工具，是助手，不是魔法棒。</p>
<h3 data-id="heading-28">关于 Cloudflare</h3>
<p><strong>赛博大善人，名不虚传</strong>。</p>
<p>作为穷鬼开发者，Cloudflare 的免费服务让我们不需要购买服务器、不需要关心运维、不需要担心流量费用，就能做出一个<strong>全球可用、性能优秀</strong>的 Web 应用。</p>
<p>而且因为是边缘计算，用户访问时会自动路由到离他最近的节点，无论在国内还是国外，速度都很快。</p>
<h3 data-id="heading-29">给想尝试的你</h3>
<p>如果你也想体验 AI 编程开发，或者对 Cloudflare 的边缘计算感兴趣：</p>
<ol>
<li><strong>装个 Cursor</strong>（或者其他 AI 编程工具）</li>
<li><strong>注册个 Cloudflare 账号</strong>（免费的）</li>
<li><strong>想个有意思的小项目</strong>（解决自己的实际需求）</li>
<li><strong>开始和 AI 聊天写代码</strong></li>
</ol>
<p>你会发现，做一个自己的产品，真的没那么难了。</p>
<p>这个项目的代码很简洁，总共也就几百行，非常适合学习和二次开发。如果你想自己部署一套，或者想看看是怎么实现的，欢迎去 GitHub 看看。</p>
<hr/>
<p><strong>项目地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fisnl%2Ff2f" target="_blank" title="https://github.com/isnl/f2f" ref="nofollow noopener noreferrer">github.com/isnl/f2f</a></p>
<p><strong>在线体验</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ff2f.icu" target="_blank" title="https://f2f.icu" ref="nofollow noopener noreferrer">f2f.icu</a></p>
<p>如果觉得有用，欢迎 Star ⭐️ 支持一下！</p>
<p>有任何问题或建议，也欢迎在 GitHub 上提 Issue，我会及时回复的~</p>
<hr/>
<p><strong>技术栈总结</strong>：</p>
<ul>
<li>🤖 开发工具：Cursor（AI 辅助编程）</li>
<li>🎨 前端：原生 JavaScript + Tailwind CSS</li>
<li>⚡️ 后端：Cloudflare Workers（Serverless）</li>
<li>💾 存储：Cloudflare KV（键值存储）</li>
<li>🌐 托管：Cloudflare Pages（全球 CDN）</li>
<li>🌍 国际化：内置中英双语支持</li>
<li>💰 成本：<strong>完全免费</strong> 🎉</li>
<li>⏱️ 开发时间：<strong>不到 4 小时</strong></li>
</ul>
<p>希望这篇文章对你有帮助！如果你也用 AI 做了有趣的项目，欢迎在评论区分享~</p>
<hr/>
<p>哦对了，最近从 Cursor 又平滑迁移到 Claude Code 了，给大家分享一个正在使用的 Claude Code 中转站，非公益站！</p>
<p>因为他家有付费用户，所以稳定性相当不错，体验非常丝滑！而且模型能力就我重度 AI 使用体验而言，无降智！无降智！无降智！(用过 Cursor/AugmentCode/Trae/Windsurf/Github Copilot/国产 glm、kimi、minimax 等等)</p>
<p>注册即可赠送 30 刀额度，正常使用 claude-4.5-sonnet，可以用很久</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.codemirror.codes%2Fregister%3Faff%3DseMc" target="_blank" title="https://api.codemirror.codes/register?aff=seMc" ref="nofollow noopener noreferrer">api.codemirror.codes/register?af…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文读懂计算机系统核心流量术语]]></title>    <link>https://juejin.cn/post/7576978338754445362</link>    <guid>https://juejin.cn/post/7576978338754445362</guid>    <pubDate>2025-11-27T05:46:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576978338754445362" data-draft-id="7576968345875038235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文读懂计算机系统核心流量术语"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T05:46:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="元Y亨H"/> <meta itemprop="url" content="https://juejin.cn/user/2839351584888617"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文读懂计算机系统核心流量术语
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2839351584888617/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    元Y亨H
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:46:02.000Z" title="Thu Nov 27 2025 05:46:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h2 data-id="heading-0">一文读懂计算机系统核心流量术语</h2>
<p>在后端开发、运维以及系统架构设计中，我们经常听到“QPS 抗不住了”、“RT 太高”、“带宽打满了”等描述。这些术语是衡量系统健康状况的“体检指标”。</p>
<p>要设计一个高可用、高性能的系统，首先需要统一语言。本文将计算机系统中的常见流量术语分为四大维度：<strong>处理能力、响应速度、通道容量、业务规模</strong>，并深入解析它们之间的换算关系。</p>
<hr/>
<h3 data-id="heading-1">一、处理能力指标：系统有多“强”？</h3>
<p>这一类指标衡量服务器在单位时间内能完成多少工作量，是评估系统负载能力的核心。</p>
<h4 data-id="heading-2">1. QPS (Queries Per Second) - 每秒查询率</h4>
<ul>
<li><strong>定义</strong>：服务器每秒钟能够处理的<strong>读操作</strong>或 API 请求数量。</li>
<li><strong>场景</strong>：通常用于衡量接口的吞吐能力。例如，一个查询用户信息的 API，其 QPS 为 1000，意味着它每秒能响应 1000 次请求。</li>
<li><strong>注意</strong>：QPS 是对单一接口或单一查询维度的度量。</li>
</ul>
<h4 data-id="heading-3">2. TPS (Transactions Per Second) - 每秒事务处理量</h4>
<ul>
<li><strong>定义</strong>：服务器每秒处理的<strong>事务</strong>数量。</li>
<li><strong>场景</strong>：多用于涉及数据写入、修改或复杂逻辑的场景（如银行转账、电商下单）。</li>
<li><strong>关键区别</strong>：<strong>一个事务 (Transaction) 可能包含多次查询 (Query)。</strong>
<ul>
<li><em>例子</em>：一个“下单”动作（1个 TPS）可能包含：查库存、减库存、创建订单、写入日志（4个 QPS）。因此，在复杂业务中，QPS 数值通常远大于 TPS。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">3. Concurrency (并发数)</h4>
<ul>
<li><strong>定义</strong>：系统同时处理的请求数量或保持的连接数量。</li>
<li><strong>误区</strong>：并发数 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo mathvariant="normal">≠</mo></mrow><annotation encoding="application/x-tex">\neq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"/></span></span></span></span><span class="mrel">=</span></span></span></span></span></span> QPS。并发数是指“正在车道上跑的车”，而 QPS 是“每秒通过收费站的车”。</li>
</ul>
<hr/>
<h3 data-id="heading-5">二、时间延迟指标：系统有多“快”？</h3>
<p>处理能力强不代表速度快。这一类指标关注用户等待的时间，数值越低越好。</p>
<h4 data-id="heading-6">1. RT (Response Time) - 响应时间</h4>
<ul>
<li><strong>定义</strong>：从客户端发出请求到接收到完整响应的总耗时。</li>
<li><strong>公式</strong>：<code>RT = 网络传输时间 + 服务器排队时间 + 应用处理时间</code>。</li>
</ul>
<h4 data-id="heading-7">2. TTFB (Time To First Byte) - 首字节时间</h4>
<ul>
<li><strong>定义</strong>：从发送请求到接收到服务器返回的<strong>第一个字节</strong>的时间。</li>
<li><strong>意义</strong>：它排除了下载大文件耗时的干扰，纯粹衡量服务器的反应速度和网络链路质量。</li>
</ul>
<h4 data-id="heading-8">3. P99 / P95 / P90 - 百分位延迟（长尾效应）</h4>
<ul>
<li><strong>定义</strong>：统计学术语。<strong>P99 = 100ms</strong> 意味着 <strong>99%</strong> 的请求都在 100ms 内完成，只有 1% 的请求超过这个时间。</li>
<li><strong>为什么不用平均值？</strong>：平均值极易被少数极端慢的请求（长尾）拉高或掩盖。P99 是衡量系统稳定性和用户体验更真实的指标，也是大厂 SLA（服务等级协议）的标准考核项。</li>
</ul>
<hr/>
<h3 data-id="heading-9">三、容量与带宽指标：管道有多“宽”？</h3>
<p>这一类指标衡量数据传输的物理极限。</p>
<h4 data-id="heading-10">1. Bandwidth (带宽) vs. Throughput (吞吐量)</h4>
<ul>
<li><strong>Bandwidth (带宽)</strong>：链路的理论最大传输能力。单位通常是 <strong>bps</strong> (bits per second)。</li>
<li><strong>Throughput (吞吐量)</strong>：单位时间内实际成功传输的数据量。</li>
<li><strong>关系</strong>：带宽是水管的粗细，吞吐量是实际流过的水量。吞吐量永远不可能超过带宽。</li>
</ul>
<h4 data-id="heading-11">2. IOPS (Input/Output Operations Per Second)</h4>
<ul>
<li><strong>定义</strong>：磁盘每秒的读写次数。</li>
<li><strong>瓶颈</strong>：数据库性能往往受限于磁盘 IOPS。传统机械硬盘 IOPS 只有几百，而企业级 SSD 可达数万。</li>
</ul>
<hr/>
<h3 data-id="heading-12">四、业务规模指标：压力来自哪里？</h3>
<p>这是产品经理和运营关注的指标，它们直接决定了技术团队需要准备多大的服务器资源。</p>
<ul>
<li><strong>PV (Page View)</strong>：页面浏览量。用户每刷新一次即计算一次。</li>
<li><strong>UV (Unique Visitor)</strong>：独立访客数。一定时间内访问的用户去重后的数量。</li>
<li><strong>DAU (Daily Active Users)</strong>：日活跃用户数。</li>
<li><strong>PCU (Peak Concurrent Users)</strong>：最高同时在线人数。这是容量规划（扩容）的最重要依据。</li>
</ul>
<hr/>
<h3 data-id="heading-13">五、核心公式与估算方法（重点）</h3>
<p>理解术语后，架构师需要通过公式进行容量预估。</p>
<h4 data-id="heading-14">1. QPS、并发与 RT 的三角关系</h4>
<p>这是性能测试中最核心的公式：
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mi>P</mi><mi>S</mi><mo>=</mo><mfrac><mtext>并发数</mtext><mtext>平均响应时间 (秒)</mtext></mfrac></mrow><annotation encoding="application/x-tex">QPS = \frac{\text{并发数}}{\text{平均响应时间 (秒)}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">QPS</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.3923em;vertical-align:-0.52em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">平均响应时间</span><span class="mord mtight"> (</span><span class="mord cjk_fallback mtight">秒</span><span class="mord mtight">)</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">并发数</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<ul>
<li><strong>推论</strong>：如果想提高 QPS，要么增加并发能力（加机器/线程），要么优化代码降低 RT。</li>
</ul>
<h4 data-id="heading-15">2. 流量估算（二八原则）</h4>
<p>已知每天的 PV 量，如何估算系统需要承受的 QPS？
通常假设 80% 的流量集中在 20% 的高峰时段：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>峰值 QPS</mtext><mo>=</mo><mfrac><mrow><mtext>总PV</mtext><mo>×</mo><mn>0.8</mn></mrow><mrow><mtext>一天秒数(86400)</mtext><mo>×</mo><mn>0.2</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{峰值 QPS} = \frac{\text{总PV} \times 0.8}{\text{一天秒数(86400)} \times 0.2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord cjk_fallback">峰值</span><span class="mord"> QPS</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.3923em;vertical-align:-0.52em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">一天秒数</span><span class="mord mtight">(86400)</span></span><span class="mbin mtight">×</span><span class="mord mtight">0.2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">总</span><span class="mord mtight">PV</span></span><span class="mbin mtight">×</span><span class="mord mtight">0.8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<ul>
<li><em>速算技巧</em>：<code>峰值 QPS ≈ 总PV / 20000</code>。</li>
</ul>
<h4 data-id="heading-16">3. 带宽换算</h4>
<p>如何根据 QPS 计算需要购买多少带宽？</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>带宽 (Mbps)</mtext><mo>=</mo><mfrac><mrow><mtext>QPS</mtext><mo>×</mo><mtext>平均包大小(KB)</mtext><mo>×</mo><mn>8</mn></mrow><mn>1024</mn></mfrac></mrow><annotation encoding="application/x-tex">\text{带宽 (Mbps)} = \frac{\text{QPS} \times \text{平均包大小(KB)} \times 8}{1024}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord cjk_fallback">带宽</span><span class="mord"> (Mbps)</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1024</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">QPS</span></span><span class="mbin mtight">×</span><span class="mord text mtight"><span class="mord cjk_fallback mtight">平均包大小</span><span class="mord mtight">(KB)</span></span><span class="mbin mtight">×</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<ul>
<li><strong>注意</strong>：务必乘以 8，因为带宽单位是 bit，而数据包单位通常是 Byte。</li>
</ul>
<hr/>
<h3 data-id="heading-17">六、特殊场景术语</h3>
<p>在应对高并发或故障时，还会用到以下术语：</p>
<ul>
<li><strong>Burst (突发)</strong>：短时间内激增的流量（如秒杀、热点新闻）。</li>
<li><strong>Backpressure (背压)</strong>：当下游服务处理不过来时，向上游反馈信号减缓发送，防止系统崩溃。</li>
<li><strong>Throttling (限流)</strong>：主动丢弃超出系统承载能力的流量（如 Nginx 限制每秒请求数），属于自我保护机制。</li>
<li><strong>C10K 问题</strong>：经典的系统设计挑战，指单机如何同时维持 10,000 个并发连接。</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[# 一、项目概览 Dragonboat 是纯 Go 实现的（multi-group）Raft 库。 为应用屏蔽 Raft 复杂性，提供易于使用的 NodeH]]></title>    <link>https://juejin.cn/post/7576928310788898868</link>    <guid>https://juejin.cn/post/7576928310788898868</guid>    <pubDate>2025-11-27T05:56:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576928310788898868" data-draft-id="7576936862632476672" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="# 一、项目概览  Dragonboat 是纯 Go 实现的（multi-group）Raft 库。  为应用屏蔽 Raft 复杂性，提供易于使用的 NodeH"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T05:56:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="得物技术"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            # 一、项目概览  Dragonboat 是纯 Go 实现的（multi-group）Raft 库。  为应用屏蔽 Raft 复杂性，提供易于使用的 NodeH
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    得物技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T05:56:59.000Z" title="Thu Nov 27 2025 05:56:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、项目概览</h2>
<p>Dragonboat 是纯 Go 实现的（multi-group）Raft 库。</p>
<p>为应用屏蔽 Raft 复杂性，提供易于使用的 NodeHost 和状态机接口。该库（自称）有如下特点：</p>
<ul>
<li>高吞吐、流水线化、批处理；</li>
<li>提供了内存/磁盘状态机多种实现；</li>
<li>提供了 ReadIndex、成员变更、Leader转移等管理端API；</li>
<li>默认使用 Pebble 作为 存储后端。</li>
</ul>
<p>本次代码串讲以V3的稳定版本为基础，不包括GitHub上v4版本内容。</p>
<h2 data-id="heading-1">二、整体架构</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f955e506c55247fb90a7eda4442fc289~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764827819&amp;x-signature=q7E00HDNNARA40sdcX38dVI4XWo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">三、LogDB 统一存储</h2>
<p>LogDB 模块是 Dragonboat 的核心持久化存储层，虽然模块名字有Log，但是它囊括了所有和存储相关的API，负责管理 Raft 协议的所有持久化数据，包括：</p>
<p><strong>Raft状态 (RaftState)</strong></p>
<p><strong>Raft内部状态变更的集合结构</strong></p>
<p>包括但不限于：</p>
<ul>
<li>ClusterID/NodeID： 节点ID</li>
<li>RaftState： Raft任期、投票情况、commit进度</li>
<li>EntriesToSave：Raft提案日志数据</li>
<li>Snapshot：快照元数据(包括快照文件路径，快照大小，快照对应的提案Index，快照对应的Raft任期等信息)</li>
<li>Messages：发给其他节点的Raft消息</li>
<li>ReadyToReads：ReadIndex就绪的请求</li>
</ul>
<p><strong>引导信息 (Bootstrap)</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Bootstrap <span class="hljs-keyword">struct</span> {
    Addresses <span class="hljs-keyword">map</span>[<span class="hljs-type">uint64</span>]<span class="hljs-type">string</span> <span class="hljs-comment">// 初始集群成员</span>
    Join      <span class="hljs-type">bool</span>
    Type      StateMachineType
}
</code></pre>
<p>ILogDB的API如下：</p>
<pre><code class="hljs language-scss" lang="scss">type ILogDB interface {


    <span class="hljs-built_in">BinaryFormat</span>() uint32 <span class="hljs-comment">// 返回支持的二进制格式版本号</span>


    <span class="hljs-built_in">ListNodeInfo</span>() ([]NodeInfo, error) <span class="hljs-comment">// 列出 LogDB 中所有可用的节点信息</span>


    <span class="hljs-comment">// 存储集群节点的初始化配置信息，包括是否加入集群、状态机类型等</span>
    <span class="hljs-built_in">SaveBootstrapInfo</span>(clusterID uint64, nodeID uint64, bootstrap pb.Bootstrap) error


    <span class="hljs-comment">// 获取保存的引导信息</span>
    <span class="hljs-built_in">GetBootstrapInfo</span>(clusterID uint64, nodeID uint64) (pb.Bootstrap, error)


    <span class="hljs-comment">// 原子性保存 Raft 状态、日志条目和快照元数据</span>
    <span class="hljs-built_in">SaveRaftState</span>(updates []pb.Update, shardID uint64) error


    <span class="hljs-comment">// 迭代读取指定范围内的连续日志条目</span>
    <span class="hljs-built_in">IterateEntries</span>(ents []pb.Entry, size uint64, clusterID uint64, nodeID uint64, 
                   low uint64, high uint64, maxSize uint64) ([]pb.Entry, uint64, error)


    <span class="hljs-comment">// 读取持久化的 Raft 状态</span>
    <span class="hljs-built_in">ReadRaftState</span>(clusterID uint64, nodeID uint64, lastIndex uint64) (RaftState, error)


    <span class="hljs-comment">// 删除指定索引之前的所有条目, 日志压缩、快照后清理旧日志</span>
    <span class="hljs-built_in">RemoveEntriesTo</span>(clusterID uint64, nodeID uint64, index uint64) error


    <span class="hljs-comment">// 回收指定索引之前条目占用的存储空间</span>
    <span class="hljs-built_in">CompactEntriesTo</span>(clusterID uint64, nodeID uint64, index uint64) (&lt;-chan struct{}, error)


    <span class="hljs-comment">// 保存所有快照元数据</span>
    <span class="hljs-built_in">SaveSnapshots</span>([]pb.Update) error


    <span class="hljs-comment">// 删除指定的快照元数据 清理过时或无效的快照</span>
    <span class="hljs-built_in">DeleteSnapshot</span>(clusterID uint64, nodeID uint64, index uint64) error


    <span class="hljs-comment">// 列出指定索引范围内的可用快照</span>
    <span class="hljs-built_in">ListSnapshots</span>(clusterID uint64, nodeID uint64, index uint64) ([]pb.Snapshot, error)


    <span class="hljs-comment">// 删除节点的所有相关数据</span>
    <span class="hljs-built_in">RemoveNodeData</span>(clusterID uint64, nodeID uint64) error


    <span class="hljs-comment">// 导入快照并创建所有必需的元数据</span>
    <span class="hljs-built_in">ImportSnapshot</span>(snapshot pb.Snapshot, nodeID uint64) error
}
</code></pre>
<h3 data-id="heading-3">3.1索引键</h3>
<p>存储的底层本质是一个KVDB (pebble or rocksdb)，由于业务的复杂性，要统一各类业务key的设计方法，而且要降低空间使用，所以有了如下的key设计方案。</p>
<p>龙舟中key分为3类：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c3776bbc6d847f7ab268c897b16e408~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764827819&amp;x-signature=HWHrlMAMKVOo%2BWhJgVg77ZwWmdM%3D" alt="" loading="lazy"/></p>
<p>其中，2字节的header用于区分各类不同业务的key空间。</p>
<pre><code class="hljs language-arduino" lang="arduino">entryKeyHeader       = [<span class="hljs-number">2</span>]<span class="hljs-type">byte</span>{<span class="hljs-number">0x1</span>, <span class="hljs-number">0x1</span>}  <span class="hljs-comment">// 普通日志条目</span>
persistentStateKey   = [<span class="hljs-number">2</span>]<span class="hljs-type">byte</span>{<span class="hljs-number">0x2</span>, <span class="hljs-number">0x2</span>}  <span class="hljs-comment">// Raft状态</span>
maxIndexKey          = [<span class="hljs-number">2</span>]<span class="hljs-type">byte</span>{<span class="hljs-number">0x3</span>, <span class="hljs-number">0x3</span>}  <span class="hljs-comment">// 最大索引记录</span>
nodeInfoKey          = [<span class="hljs-number">2</span>]<span class="hljs-type">byte</span>{<span class="hljs-number">0x4</span>, <span class="hljs-number">0x4</span>}  <span class="hljs-comment">// 节点元数据</span>
bootstrapKey         = [<span class="hljs-number">2</span>]<span class="hljs-type">byte</span>{<span class="hljs-number">0x5</span>, <span class="hljs-number">0x5</span>}  <span class="hljs-comment">// 启动配置</span>
snapshotKey          = [<span class="hljs-number">2</span>]<span class="hljs-type">byte</span>{<span class="hljs-number">0x6</span>, <span class="hljs-number">0x6</span>}  <span class="hljs-comment">// 快照索引</span>
entryBatchKey        = [<span class="hljs-number">2</span>]<span class="hljs-type">byte</span>{<span class="hljs-number">0x7</span>, <span class="hljs-number">0x7</span>}  <span class="hljs-comment">// 批量日志</span>
</code></pre>
<p>在key的生成中，采用了useAsXXXKey和SetXXXKey的方式，复用了data这个二进制变量，减少GC。</p>
<pre><code class="hljs language-scss" lang="scss">type Key struct {
    data <span class="hljs-selector-attr">[]</span>byte  <span class="hljs-comment">// 底层字节数组复用池</span>
    key  <span class="hljs-selector-attr">[]</span>byte  <span class="hljs-comment">// 有效数据切片</span>
    pool *sync<span class="hljs-selector-class">.Pool</span> <span class="hljs-comment">// 似乎并没有什么用</span>
}




func (k *Key) <span class="hljs-built_in">useAsEntryKey</span>() {
    k<span class="hljs-selector-class">.key</span> = k<span class="hljs-selector-class">.data</span>
}


type IReusableKey interface {
    <span class="hljs-built_in">SetEntryBatchKey</span>(clusterID uint64, nodeID uint64, index uint64)
    <span class="hljs-comment">// SetEntryKey sets the key to be an entry key for the specified Raft node</span>
    <span class="hljs-comment">// with the specified entry index.</span>
    <span class="hljs-built_in">SetEntryKey</span>(clusterID uint64, nodeID uint64, index uint64)
    <span class="hljs-comment">// SetStateKey sets the key to be an persistent state key suitable</span>
    <span class="hljs-comment">// for the specified Raft cluster node.</span>
    <span class="hljs-built_in">SetStateKey</span>(clusterID uint64, nodeID uint64)
    <span class="hljs-comment">// SetMaxIndexKey sets the key to be the max possible index key for the</span>
    <span class="hljs-comment">// specified Raft cluster node.</span>
    <span class="hljs-built_in">SetMaxIndexKey</span>(clusterID uint64, nodeID uint64)
    <span class="hljs-comment">// Key returns the underlying byte slice of the key.</span>
    <span class="hljs-built_in">Key</span>() <span class="hljs-selector-attr">[]</span>byte
    <span class="hljs-comment">// Release releases the key instance so it can be reused in the future.</span>
    <span class="hljs-built_in">Release</span>()
}


func (k *Key) <span class="hljs-built_in">useAsEntryKey</span>() {
    k<span class="hljs-selector-class">.key</span> = k<span class="hljs-selector-class">.data</span>
}


<span class="hljs-comment">// SetEntryKey sets the key value to the specified entry key.</span>
func (k *Key) <span class="hljs-built_in">SetEntryKey</span>(clusterID uint64, nodeID uint64, index uint64) {
    k<span class="hljs-selector-class">.useAsEntryKey</span>()
    k<span class="hljs-selector-class">.key</span><span class="hljs-selector-attr">[0]</span> = entryKeyHeader<span class="hljs-selector-attr">[0]</span>
    k<span class="hljs-selector-class">.key</span><span class="hljs-selector-attr">[1]</span> = entryKeyHeader<span class="hljs-selector-attr">[1]</span>
    k<span class="hljs-selector-class">.key</span><span class="hljs-selector-attr">[2]</span> = <span class="hljs-number">0</span>
    k<span class="hljs-selector-class">.key</span><span class="hljs-selector-attr">[3]</span> = <span class="hljs-number">0</span>
    binary<span class="hljs-selector-class">.BigEndian</span><span class="hljs-selector-class">.PutUint64</span>(k.key[<span class="hljs-number">4</span>:], clusterID)
    <span class="hljs-comment">// the 8 bytes node ID is actually not required in the key. it is stored as</span>
    <span class="hljs-comment">// an extra safenet - we don't know what we don't know, it is used as extra</span>
    <span class="hljs-comment">// protection between different node instances when things get ugly.</span>
    <span class="hljs-comment">// the wasted 8 bytes per entry is not a big deal - storing the index is</span>
    <span class="hljs-comment">// wasteful as well.</span>
    binary<span class="hljs-selector-class">.BigEndian</span><span class="hljs-selector-class">.PutUint64</span>(k.key[<span class="hljs-number">12</span>:], nodeID)
    binary<span class="hljs-selector-class">.BigEndian</span><span class="hljs-selector-class">.PutUint64</span>(k.key[<span class="hljs-number">20</span>:], index)
}
</code></pre>
<h3 data-id="heading-4">3.2变量复用IContext</h3>
<p>IContext的核心设计目的是实现<strong>并发安全的内存复用机制</strong>。在高并发场景下，频繁的内存分配和释放会造成较大的GC压力，通过IContext可以实现：</p>
<ul>
<li><strong>键对象复用</strong>：通过GetKey()获取可重用的IReusableKey</li>
<li><strong>缓冲区复用</strong>：通过GetValueBuffer()获取可重用的字节缓冲区</li>
<li><strong>批量操作对象复用</strong>：EntryBatch和WriteBatch的复用</li>
</ul>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// IContext is the per thread context used in the logdb module.</span>
<span class="hljs-comment">// IContext is expected to contain a list of reusable keys and byte</span>
<span class="hljs-comment">// slices that are owned per thread so they can be safely reused by the</span>
<span class="hljs-comment">// same thread when accessing ILogDB.</span>
type IContext interface {
    <span class="hljs-comment">// Destroy destroys the IContext instance.</span>
    <span class="hljs-built_in">Destroy</span>()
    <span class="hljs-comment">// Reset resets the IContext instance, all previous returned keys and</span>
    <span class="hljs-comment">// buffers will be put back to the IContext instance and be ready to</span>
    <span class="hljs-comment">// be used for the next iteration.</span>
    <span class="hljs-built_in">Reset</span>()
    <span class="hljs-comment">// GetKey returns a reusable key.</span>
    <span class="hljs-built_in">GetKey</span>() IReusableKey <span class="hljs-comment">// 这就是上文中的key接口</span>
    <span class="hljs-comment">// GetValueBuffer returns a byte buffer with at least sz bytes in length.</span>
    <span class="hljs-built_in">GetValueBuffer</span>(sz uint64) <span class="hljs-selector-attr">[]</span>byte
    <span class="hljs-comment">// GetWriteBatch returns a write batch or transaction instance.</span>
    <span class="hljs-built_in">GetWriteBatch</span>() interface{}
    <span class="hljs-comment">// SetWriteBatch adds the write batch to the IContext instance.</span>
    <span class="hljs-built_in">SetWriteBatch</span>(wb interface{})
    <span class="hljs-comment">// GetEntryBatch returns an entry batch instance.</span>
    <span class="hljs-built_in">GetEntryBatch</span>() pb<span class="hljs-selector-class">.EntryBatch</span>
    <span class="hljs-comment">// GetLastEntryBatch returns an entry batch instance.</span>
    <span class="hljs-built_in">GetLastEntryBatch</span>() pb<span class="hljs-selector-class">.EntryBatch</span>
}








type context struct {
    size    uint64
    maxSize uint64
    eb      pb<span class="hljs-selector-class">.EntryBatch</span>
    lb      pb<span class="hljs-selector-class">.EntryBatch</span>
    key     *Key
    val     <span class="hljs-selector-attr">[]</span>byte
    wb      kv<span class="hljs-selector-class">.IWriteBatch</span>
}


func (c *context) <span class="hljs-built_in">GetKey</span>() IReusableKey {
    return c<span class="hljs-selector-class">.key</span>
}


func (c *context) <span class="hljs-built_in">GetValueBuffer</span>(sz uint64) <span class="hljs-selector-attr">[]</span>byte {
    if sz &lt;= c<span class="hljs-selector-class">.size</span> {
        return c<span class="hljs-selector-class">.val</span>
    }
    val := <span class="hljs-built_in">make</span>([]byte, sz)
    if sz &lt; c.maxSize {
        c<span class="hljs-selector-class">.size</span> = sz
        c<span class="hljs-selector-class">.val</span> = val
    }
    return val
}


func (c *context) <span class="hljs-built_in">GetEntryBatch</span>() pb<span class="hljs-selector-class">.EntryBatch</span> {
    return c<span class="hljs-selector-class">.eb</span>
}


func (c *context) <span class="hljs-built_in">GetLastEntryBatch</span>() pb<span class="hljs-selector-class">.EntryBatch</span> {
    return c<span class="hljs-selector-class">.lb</span>
}


func (c *context) <span class="hljs-built_in">GetWriteBatch</span>() interface{} {
    return c<span class="hljs-selector-class">.wb</span>
}


func (c *context) <span class="hljs-built_in">SetWriteBatch</span>(wb interface{}) {
    c<span class="hljs-selector-class">.wb</span> = wb.(kv.IWriteBatch)
}
</code></pre>
<h3 data-id="heading-5">3.3存储引擎封装IKVStore</h3>
<p>IKVStore 是 Dragonboat 日志存储系统的抽象接口，它定义了底层键值存储引擎需要实现的所有基本操作。这个接口让 Dragonboat 能够支持不同的存储后端（如 Pebble、RocksDB 等），实现了存储引擎的可插拔性。</p>
<pre><code class="hljs language-scss" lang="scss">type IKVStore interface {
    <span class="hljs-comment">// Name is the IKVStore name.</span>
    <span class="hljs-built_in">Name</span>() string
    <span class="hljs-comment">// Close closes the underlying Key-Value store.</span>
    <span class="hljs-built_in">Close</span>() error


    <span class="hljs-comment">// 范围扫描 - 支持前缀遍历的迭代器</span>
    <span class="hljs-built_in">IterateValue</span>(fk []byte,
            lk []byte, inc bool, op func(key []byte, data []byte) (bool, error)) error
    
    <span class="hljs-comment">// 查询操作 - 基于回调的内存高效查询模式</span>
    <span class="hljs-built_in">GetValue</span>(key []byte, op func([]byte) error) error
    
    <span class="hljs-comment">// 写入操作 - 单条记录的原子写入</span>
    <span class="hljs-built_in">SaveValue</span>(key []byte, value []byte) error


    <span class="hljs-comment">// 删除操作 - 单条记录的精确删除</span>
    <span class="hljs-built_in">DeleteValue</span>(key []byte) error
    
    <span class="hljs-comment">// 获取批量写入器</span>
    <span class="hljs-built_in">GetWriteBatch</span>() IWriteBatch
    
    <span class="hljs-comment">// 原子提交批量操作</span>
    <span class="hljs-built_in">CommitWriteBatch</span>(wb IWriteBatch) error
    
    <span class="hljs-comment">// 批量删除一个范围的键值对</span>
    <span class="hljs-built_in">BulkRemoveEntries</span>(firstKey []byte, lastKey []byte) error
    
    <span class="hljs-comment">// 压缩指定范围的存储空间</span>
    <span class="hljs-built_in">CompactEntries</span>(firstKey []byte, lastKey []byte) error
    
    <span class="hljs-comment">// 全量压缩整个数据库</span>
    <span class="hljs-built_in">FullCompaction</span>() error
}


type IWriteBatch interface {
    <span class="hljs-built_in">Destroy</span>()                 <span class="hljs-comment">// 清理资源，防止内存泄漏</span>
    <span class="hljs-built_in">Put</span>(key, value []byte)    <span class="hljs-comment">// 添加写入操作</span>
    <span class="hljs-built_in">Delete</span>(key []byte)        <span class="hljs-comment">// 添加删除操作</span>
    <span class="hljs-attribute">Clear</span>()                   <span class="hljs-comment">// 清空批处理中的所有操作</span>
    <span class="hljs-built_in">Count</span>() int               <span class="hljs-comment">// 获取当前批处理中的操作数量</span>
}
</code></pre>
<p>openPebbleDB是Dragonboat 中 Pebble 存储引擎的初始化入口，负责根据配置创建一个完整可用的键值存储实例。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/981de8dd26004e8887ddc82dd81f9318~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764827819&amp;x-signature=2uCOkxPECTcrlUoekIyqnZ4wGUc%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// KV is a pebble based IKVStore type.</span>
<span class="hljs-keyword">type</span> KV <span class="hljs-keyword">struct</span> {
    db       *pebble.DB
    dbSet    <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{}
    opts     *pebble.Options
    ro       *pebble.IterOptions
    wo       *pebble.WriteOptions
    event    *eventListener
    callback kv.LogDBCallback
    config   config.LogDBConfig
}


<span class="hljs-keyword">var</span> _ kv.IKVStore = (*KV)(<span class="hljs-literal">nil</span>)




<span class="hljs-comment">// openPebbleDB</span>
<span class="hljs-comment">// =============</span>
<span class="hljs-comment">// 将 Dragonboat 的 LogDBConfig → Pebble 引擎实例</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">openPebbleDB</span><span class="hljs-params">(
        cfg  config.LogDBConfig,
        cb   kv.LogDBCallback,   // =&gt; busy通知：busy(<span class="hljs-literal">true</span>/<span class="hljs-literal">false</span>)</span></span>
        dir  <span class="hljs-type">string</span>,             <span class="hljs-comment">// 主数据目录</span>
        wal  <span class="hljs-type">string</span>,             <span class="hljs-comment">// WAL 独立目录（可空）</span>
        fs   vfs.IFS,            <span class="hljs-comment">// 文件系统抽象（磁盘/memfs）</span>
) (kv.IKVStore, <span class="hljs-type">error</span>) {
    
    <span class="hljs-comment">//--------------------------------------------------</span>
    <span class="hljs-comment">// 2️⃣ &lt;&lt; 核心调优参数读入</span>
    <span class="hljs-comment">//--------------------------------------------------</span>
    blockSz      := <span class="hljs-type">int</span>(cfg.KVBlockSize)                    <span class="hljs-comment">// 数据块(4K/8K…)</span>
    writeBufSz   := <span class="hljs-type">int</span>(cfg.KVWriteBufferSize)              <span class="hljs-comment">// 写缓冲</span>
    bufCnt       := <span class="hljs-type">int</span>(cfg.KVMaxWriteBufferNumber)         <span class="hljs-comment">// MemTable数量</span>
    l0Compact    := <span class="hljs-type">int</span>(cfg.KVLevel0FileNumCompactionTrigger) <span class="hljs-comment">// L0 层文件数量触发压缩的阈值</span>
    l0StopWrites := <span class="hljs-type">int</span>(cfg.KVLevel0StopWritesTrigger)
    baseBytes    := <span class="hljs-type">int64</span>(cfg.KVMaxBytesForLevelBase)
    fileBaseSz   := <span class="hljs-type">int64</span>(cfg.KVTargetFileSizeBase)
    cacheSz      := <span class="hljs-type">int64</span>(cfg.KVLRUCacheSize)
    levelMult    := <span class="hljs-type">int64</span>(cfg.KVTargetFileSizeMultiplier)  <span class="hljs-comment">// 每层文件大小倍数</span>
    numLevels    := <span class="hljs-type">int64</span>(cfg.KVNumOfLevels)
    
    
    <span class="hljs-comment">//--------------------------------------------------</span>
    <span class="hljs-comment">// 4️⃣ 构建 LSM-tree 层级选项 (每层无压缩)</span>
    <span class="hljs-comment">//--------------------------------------------------</span>
    levelOpts := []pebble.LevelOptions{}
    sz := fileBaseSz
    <span class="hljs-keyword">for</span> lvl := <span class="hljs-number">0</span>; lvl &lt; <span class="hljs-type">int</span>(numLevels); lvl++ {
        levelOpts = <span class="hljs-built_in">append</span>(levelOpts, pebble.LevelOptions{
            Compression:    pebble.NoCompression, <span class="hljs-comment">// 写性能优先</span>
            BlockSize:      blockSz,
            TargetFileSize: sz,                 <span class="hljs-comment">// L0 &lt; L1 &lt; … 呈指数增长</span>
        })
        sz *= levelMult
    }
    
    <span class="hljs-comment">//--------------------------------------------------</span>
    <span class="hljs-comment">// 5️⃣ 初始化依赖：LRU Cache + 读写选项</span>
    <span class="hljs-comment">//--------------------------------------------------</span>
    cache := pebble.NewCache(cacheSz)    <span class="hljs-comment">// block缓存</span>
    ro    := &amp;pebble.IterOptions{}       <span class="hljs-comment">// 迭代器默认配置</span>
    wo    := &amp;pebble.WriteOptions{Sync: <span class="hljs-literal">true</span>} <span class="hljs-comment">// ❗fsync强制刷盘</span>
    
    opts := &amp;pebble.Options{
        Levels:                      levelOpts,
        Cache:                       cache,
        MemTableSize:                writeBufSz,
        MemTableStopWritesThreshold: bufCnt,
        LBaseMaxBytes:               baseBytes,
        L0CompactionThreshold:       l0Compact,
        L0StopWritesThreshold:       l0StopWrites,
        Logger:                      PebbleLogger,
        FS:                          vfs.NewPebbleFS(fs),
        MaxManifestFileSize:         <span class="hljs-number">128</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,
        <span class="hljs-comment">// WAL 目录稍后条件注入</span>
    }
    
    kv := &amp;KV{
        dbSet:    <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{}),          <span class="hljs-comment">// 关闭-&gt;初始化完成信号</span>
        callback: cb,                           <span class="hljs-comment">// 上层 raft engine 回调</span>
        config:   cfg,
        opts:     opts,
        ro:       ro,
        wo:       wo,
    }
    
    event := &amp;eventListener{
        kv:      kv,
        stopper: syncutil.NewStopper(),
    }
    
    <span class="hljs-comment">// =&gt; 关键事件触发</span>
    opts.EventListener = pebble.EventListener{
        WALCreated:    event.onWALCreated,
        FlushEnd:      event.onFlushEnd,
        CompactionEnd: event.onCompactionEnd,
    }
    
    <span class="hljs-comment">//--------------------------------------------------</span>
    <span class="hljs-comment">// 7️⃣ 目录准备</span>
    <span class="hljs-comment">//--------------------------------------------------</span>
    <span class="hljs-keyword">if</span> wal != <span class="hljs-string">""</span> {
        fs.MkdirAll(wal)        <span class="hljs-comment">// 📁 为 WAL 单独磁盘预留</span>
        opts.WALDir = wal
    }
    fs.MkdirAll(dir)            <span class="hljs-comment">// 📁 主数据目录</span>
    
    <span class="hljs-comment">//--------------------------------------------------</span>
    <span class="hljs-comment">// 8️⃣ 真正的数据库实例化</span>
    <span class="hljs-comment">//--------------------------------------------------</span>
    pdb, err := pebble.Open(dir, opts)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err }
    
    <span class="hljs-comment">//--------------------------------------------------</span>
    <span class="hljs-comment">// 9️⃣ 🧹 资源整理 &amp; 启动事件</span>
    <span class="hljs-comment">//--------------------------------------------------</span>
    cache.Unref()               <span class="hljs-comment">// 去除多余引用，防止泄露</span>
    kv.db = pdb
    
    <span class="hljs-comment">// 🔔 手动触发一次 WALCreated 确保反压逻辑进入首次轮询</span>
    kv.setEventListener(event)  <span class="hljs-comment">// 内部 close(kv.dbSet)</span>
    
    <span class="hljs-keyword">return</span> kv, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>其中eventListener是对pebble 内存繁忙的回调，繁忙判断的条件有两个：</p>
<ul>
<li>内存表大小超过阈值（95%）</li>
<li>L0 层文件数量超过阈值（L0写入最大文件数量-1）</li>
</ul>
<pre><code class="hljs language-go" lang="go">

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *eventListener)</span></span> notify() {
    l.stopper.RunWorker(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">select</span> {
        <span class="hljs-keyword">case</span> &lt;-l.kv.dbSet:
            <span class="hljs-keyword">if</span> l.kv.callback != <span class="hljs-literal">nil</span> {
                memSizeThreshold := l.kv.config.KVWriteBufferSize *
                    l.kv.config.KVMaxWriteBufferNumber * <span class="hljs-number">19</span> / <span class="hljs-number">20</span>
                l0FileNumThreshold := l.kv.config.KVLevel0StopWritesTrigger - <span class="hljs-number">1</span>
                m := l.kv.db.Metrics()
                busy := m.MemTable.Size &gt;= memSizeThreshold ||
                    <span class="hljs-type">uint64</span>(m.Levels[<span class="hljs-number">0</span>].NumFiles) &gt;= l0FileNumThreshold
                l.kv.callback(busy)
            }
        <span class="hljs-keyword">default</span>:
        }
    })
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27067c4d7d214c248295ed4a11b77b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764827819&amp;x-signature=xzyNrtkP3NOjRXhDEtOooCqd3ho%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">3.4日志条目存储DB</h3>
<p>db结构体是Dragonboat日志数据库的核心管理器，提供Raft日志、快照、状态等数据的持久化存储接口。是桥接了业务和pebble存储的中间层。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// db is the struct used to manage log DB.</span>
<span class="hljs-keyword">type</span> db <span class="hljs-keyword">struct</span> {
    cs      *cache       <span class="hljs-comment">// 节点信息、Raft状态信息缓存</span>
    keys    *keyPool     <span class="hljs-comment">// Raft日志索引键变量池</span>
    kvs     kv.IKVStore  <span class="hljs-comment">// pebble的封装</span>
    entries entryManager <span class="hljs-comment">// 日志条目读写封装</span>
}


<span class="hljs-comment">// 这里面的信息不会过期，叫寄存更合适</span>
<span class="hljs-keyword">type</span> cache <span class="hljs-keyword">struct</span> {
    nodeInfo       <span class="hljs-keyword">map</span>[raftio.NodeInfo]<span class="hljs-keyword">struct</span>{}
    ps             <span class="hljs-keyword">map</span>[raftio.NodeInfo]pb.State
    lastEntryBatch <span class="hljs-keyword">map</span>[raftio.NodeInfo]pb.EntryBatch
    maxIndex       <span class="hljs-keyword">map</span>[raftio.NodeInfo]<span class="hljs-type">uint64</span>
    mu             sync.Mutex
}
</code></pre>
<ul>
<li><strong>获取一个批量写容器</strong></li>
</ul>
<p>实现：</p>
<pre><code class="hljs language-scss" lang="scss">func (r *db) <span class="hljs-built_in">getWriteBatch</span>(ctx IContext) kv<span class="hljs-selector-class">.IWriteBatch</span> {
    if ctx != nil {
        wb := ctx.<span class="hljs-built_in">GetWriteBatch</span>()
        if wb == nil {
            wb = r<span class="hljs-selector-class">.kvs</span><span class="hljs-selector-class">.GetWriteBatch</span>()
            ctx<span class="hljs-selector-class">.SetWriteBatch</span>(wb)
        }
        return wb.(kv.IWriteBatch)
    }
    return r<span class="hljs-selector-class">.kvs</span><span class="hljs-selector-class">.GetWriteBatch</span>()
}
</code></pre>
<p>降低GC压力</p>
<ul>
<li><strong>获取所有节点信息</strong></li>
</ul>
<p>实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *db)</span></span> listNodeInfo() ([]raftio.NodeInfo, <span class="hljs-type">error</span>) {
    fk := newKey(bootstrapKeySize, <span class="hljs-literal">nil</span>)
    lk := newKey(bootstrapKeySize, <span class="hljs-literal">nil</span>)
    fk.setBootstrapKey(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    lk.setBootstrapKey(math.MaxUint64, math.MaxUint64)
    ni := <span class="hljs-built_in">make</span>([]raftio.NodeInfo, <span class="hljs-number">0</span>)
    op := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(key []<span class="hljs-type">byte</span>, data []<span class="hljs-type">byte</span>)</span></span> (<span class="hljs-type">bool</span>, <span class="hljs-type">error</span>) {
        cid, nid := parseNodeInfoKey(key)
        ni = <span class="hljs-built_in">append</span>(ni, raftio.GetNodeInfo(cid, nid))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>, <span class="hljs-literal">nil</span>
    }
    <span class="hljs-keyword">if</span> err := r.kvs.IterateValue(fk.Key(), lk.Key(), <span class="hljs-literal">true</span>, op); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> []raftio.NodeInfo{}, err
    }
    <span class="hljs-keyword">return</span> ni, <span class="hljs-literal">nil</span>
}
</code></pre>
<ul>
<li><strong>保存集群状态</strong></li>
</ul>
<p>实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Update <span class="hljs-keyword">struct</span> {
    ClusterID <span class="hljs-type">uint64</span>  <span class="hljs-comment">// 集群ID，标识节点所属的Raft集群</span>
    NodeID    <span class="hljs-type">uint64</span>  <span class="hljs-comment">// 节点ID，标识集群中的具体节点</span>


    State  <span class="hljs-comment">// 包含当前任期（Term）、投票节点（Vote）、提交索引（Commit）三个关键持久化状态</span>


    EntriesToSave []Entry    <span class="hljs-comment">// 需要持久化到稳定存储的日志条目</span>
    CommittedEntries []Entry <span class="hljs-comment">// 已提交位apply的日志条目</span>
    MoreCommittedEntries <span class="hljs-type">bool</span>  <span class="hljs-comment">// 指示是否还有更多已提交条目等待处理</span>


    Snapshot Snapshot  <span class="hljs-comment">// 快照元数据，当需要应用快照时设置</span>


    ReadyToReads []ReadyToRead  <span class="hljs-comment">// ReadIndex机制实现的线性一致读</span>


    Messages []Message  <span class="hljs-comment">// 需要发送给其他节点的Raft消息</span>


    UpdateCommit <span class="hljs-keyword">struct</span> {
        Processed         <span class="hljs-type">uint64</span>  <span class="hljs-comment">// 已推送给RSM处理的最后索引</span>
        LastApplied       <span class="hljs-type">uint64</span>  <span class="hljs-comment">// RSM确认已执行的最后索引</span>
        StableLogTo       <span class="hljs-type">uint64</span>  <span class="hljs-comment">// 已稳定存储的日志到哪个索引</span>
        StableLogTerm     <span class="hljs-type">uint64</span>  <span class="hljs-comment">// 已稳定存储的日志任期</span>
        StableSnapshotTo  <span class="hljs-type">uint64</span>  <span class="hljs-comment">// 已稳定存储的快照到哪个索引</span>
        ReadyToRead       <span class="hljs-type">uint64</span>  <span class="hljs-comment">// 已准备好读的ReadIndex请求索引</span>
    }
}




<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *db)</span></span> saveRaftState(updates []pb.Update, ctx IContext) <span class="hljs-type">error</span> {
      <span class="hljs-comment">// 步骤1：获取写入批次对象，用于批量操作提高性能</span>
      <span class="hljs-comment">// 优先从上下文中获取已存在的批次，避免重复创建</span>
      wb := r.getWriteBatch(ctx)
      
      <span class="hljs-comment">// 步骤2：遍历所有更新，处理每个节点的状态和快照</span>
      <span class="hljs-keyword">for</span> _, ud := <span class="hljs-keyword">range</span> updates {
          <span class="hljs-comment">// 保存 Raft 的硬状态（Term、Vote、Commit）</span>
          <span class="hljs-comment">// 使用缓存机制避免重复保存相同状态</span>
          r.saveState(ud.ClusterID, ud.NodeID, ud.State, wb, ctx)
          
          <span class="hljs-comment">// 检查是否有快照需要保存</span>
          <span class="hljs-keyword">if</span> !pb.IsEmptySnapshot(ud.Snapshot) {
              <span class="hljs-comment">// 快照索引一致性检查：确保快照索引不超过最后一个日志条目的索引</span>
              <span class="hljs-comment">// 这是 Raft 协议的重要约束，防止状态不一致</span>
              <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(ud.EntriesToSave) &gt; <span class="hljs-number">0</span> {
                  lastIndex := ud.EntriesToSave[<span class="hljs-built_in">len</span>(ud.EntriesToSave)<span class="hljs-number">-1</span>].Index
                  <span class="hljs-keyword">if</span> ud.Snapshot.Index &gt; lastIndex {
                      plog.Panicf(<span class="hljs-string">"max index not handled, %d, %d"</span>,
                          ud.Snapshot.Index, lastIndex)
                  }
              }
              
              <span class="hljs-comment">// 保存快照元数据到数据库</span>
              r.saveSnapshot(wb, ud)
              
              <span class="hljs-comment">// 更新节点的最大日志索引为快照索引</span>
              r.setMaxIndex(wb, ud, ud.Snapshot.Index, ctx)
          }
      }
      
      <span class="hljs-comment">// 步骤3：批量保存所有日志条目</span>
      <span class="hljs-comment">// 这里会调用 entryManager 接口的 record 方法，根据配置选择批量或单独存储策略</span>
      r.saveEntries(updates, wb, ctx)
      
      <span class="hljs-comment">// 步骤4：提交写入批次到磁盘</span>
      <span class="hljs-comment">// 只有在批次中有实际操作时才提交，避免不必要的磁盘 I/O</span>
      <span class="hljs-keyword">if</span> wb.Count() &gt; <span class="hljs-number">0</span> {
          <span class="hljs-keyword">return</span> r.kvs.CommitWriteBatch(wb)
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
  }
  
  
</code></pre>
<ul>
<li><strong>保存引导信息</strong></li>
</ul>
<p>实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *db)</span></span> saveBootstrapInfo(clusterID <span class="hljs-type">uint64</span>,
    nodeID <span class="hljs-type">uint64</span>, bs pb.Bootstrap) <span class="hljs-type">error</span> {
    wb := r.getWriteBatch(<span class="hljs-literal">nil</span>)
    r.saveBootstrap(wb, clusterID, nodeID, bs)
    <span class="hljs-keyword">return</span> r.kvs.CommitWriteBatch(wb) <span class="hljs-comment">// 提交至Pebble</span>
}


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *db)</span></span> saveBootstrap(wb kv.IWriteBatch,
    clusterID <span class="hljs-type">uint64</span>, nodeID <span class="hljs-type">uint64</span>, bs pb.Bootstrap) {
    k := newKey(maxKeySize, <span class="hljs-literal">nil</span>)
    k.setBootstrapKey(clusterID, nodeID) <span class="hljs-comment">// 序列化集群节点信息</span>
    data, err := bs.Marshal()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    wb.Put(k.Key(), data)
}
</code></pre>
<ul>
<li><strong>获取Raft状态</strong></li>
</ul>
<p>实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *db)</span></span> getState(clusterID <span class="hljs-type">uint64</span>, nodeID <span class="hljs-type">uint64</span>) (pb.State, <span class="hljs-type">error</span>) {
    k := r.keys.get()
    <span class="hljs-keyword">defer</span> k.Release()
    k.SetStateKey(clusterID, nodeID)
    hs := pb.State{}
    <span class="hljs-keyword">if</span> err := r.kvs.GetValue(k.Key(), <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(data []<span class="hljs-type">byte</span>)</span></span> <span class="hljs-type">error</span> {
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) == <span class="hljs-number">0</span> {
            <span class="hljs-keyword">return</span> raftio.ErrNoSavedLog
        }
        <span class="hljs-keyword">if</span> err := hs.Unmarshal(data); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-built_in">panic</span>(err)
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> pb.State{}, err
    }
    <span class="hljs-keyword">return</span> hs, <span class="hljs-literal">nil</span>
}
</code></pre>
<h3 data-id="heading-7">3.5对外存储API实现</h3>
<p>龙舟对ILogDB提供了实现：ShardedDB，一个管理了多个pebble bucket的存储单元。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> _ raftio.ILogDB = (*ShardedDB)(<span class="hljs-literal">nil</span>)
<span class="hljs-comment">// ShardedDB is a LogDB implementation using sharded pebble instances.</span>
<span class="hljs-keyword">type</span> ShardedDB <span class="hljs-keyword">struct</span> {
    completedCompactions <span class="hljs-type">uint64</span>             <span class="hljs-comment">// 原子计数器：已完成压缩操作数</span>
    config               config.LogDBConfig <span class="hljs-comment">// 日志存储配置</span>
    ctxs                 []IContext         <span class="hljs-comment">// 分片上下文池，减少GC压力</span>
    shards               []*db              <span class="hljs-comment">// 核心：Pebble实例数组</span>
    partitioner          server.IPartitioner <span class="hljs-comment">// 智能分片策略器</span>
    compactionCh         <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{}      <span class="hljs-comment">// 压缩任务信号通道</span>
    compactions          *compactions       <span class="hljs-comment">// 压缩任务管理器</span>
    stopper              *syncutil.Stopper  <span class="hljs-comment">// 优雅关闭管理器</span>
}
</code></pre>
<ul>
<li><strong>初始化过程</strong></li>
</ul>
<p>实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 入口函数：创建并初始化分片日志数据库</span>
OpenShardedDB(config, cb, dirs, lldirs, batched, check, fs, kvf):


    <span class="hljs-comment">// ===阶段1：安全验证===</span>
    <span class="hljs-keyword">if</span> 配置为空 then <span class="hljs-built_in">panic</span>
    <span class="hljs-keyword">if</span> check和batched同时为<span class="hljs-literal">true</span> then <span class="hljs-built_in">panic</span>


    <span class="hljs-comment">// ===阶段2：预分配资源管理器===</span>
    shards := 空数组
    closeAll := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(all []*db)</span></span> { <span class="hljs-comment">//出错清理工具</span>
        <span class="hljs-keyword">for</span> s in all {
            s.<span class="hljs-built_in">close</span>()
        }
    }


    <span class="hljs-comment">// ===阶段3：逐个创建分片===</span>
    loop i := <span class="hljs-number">0</span> → 分片总数:
        datadir := pathJoin(dirs[i], <span class="hljs-string">"logdb-"</span>+i)  <span class="hljs-comment">//数据目录</span>
        snapdir := <span class="hljs-string">""</span>                           <span class="hljs-comment">//快照目录(可选)</span>
        <span class="hljs-keyword">if</span> lldirs非空 {
            snapdir = pathJoin(lldirs[i], <span class="hljs-string">"logdb-"</span>+i)
        }


        shardCb := {shard:i, callback:cb}      <span class="hljs-comment">//监控回调</span>
        db, err := openRDB(...)                <span class="hljs-comment">//创建实际数据库实例</span>
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {                        <span class="hljs-comment">//创建失败</span>
            closeAll(shards)                   <span class="hljs-comment">//清理已创建的</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        shards = <span class="hljs-built_in">append</span>(shards, db)


    <span class="hljs-comment">// ===阶段5：核心组件初始化===</span>
    partitioner := 新建分区器(execShards数量, logdbShards数量)
    instance := &amp;ShardedDB{
        shards:      shards,
        partitioner: partitioner,
        compactions: 新建压缩管理器(),
        compactionCh: 通道缓冲<span class="hljs-number">1</span>,
        ctxs:       <span class="hljs-built_in">make</span>([]IContext, 执行分片数),
        stopper:    新建停止器()
    }


    <span class="hljs-comment">// ===阶段6：预分配上下文&amp;启动后台===</span>
    <span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span> → 执行分片数:
        instance.ctxs[j] = 新建Context(saveBufferSize)


    instance.stopper.RunWorker(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {        <span class="hljs-comment">//后台压缩协程</span>
        instance.compactionWorkerMain()
    })


    <span class="hljs-keyword">return</span> instance, <span class="hljs-literal">nil</span>                      <span class="hljs-comment">//构造完成</span>
    
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf2eb6e670ef456ab963d69428fd6ee7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764827819&amp;x-signature=FVFpk1utqCy1yEUH0vS2wyREjnc%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>保存集群状态</strong></li>
</ul>
<p>实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ShardedDB)</span></span> SaveRaftState(updates []pb.Update, shardID <span class="hljs-type">uint64</span>) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> shardID<span class="hljs-number">-1</span> &gt;= <span class="hljs-type">uint64</span>(<span class="hljs-built_in">len</span>(s.ctxs)) {
        plog.Panicf(<span class="hljs-string">"invalid shardID %d, len(s.ctxs): %d"</span>, shardID, <span class="hljs-built_in">len</span>(s.ctxs))
    }
    ctx := s.ctxs[shardID<span class="hljs-number">-1</span>]
    ctx.Reset()
    <span class="hljs-keyword">return</span> s.SaveRaftStateCtx(updates, ctx)
}


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *ShardedDB)</span></span> SaveRaftStateCtx(updates []pb.Update, ctx IContext) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(updates) == <span class="hljs-number">0</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }
    pid := s.getParititionID(updates)
    <span class="hljs-keyword">return</span> s.shards[pid].saveRaftState(updates, ctx)
}
</code></pre>
<p><strong>以sylas为例子，我们每个分片都是单一cluster，所以logdb只使用了一个分片，龙舟设计初衷是为了解放多cluster的吞吐，我们暂时用不上，tindb可以考虑</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b3817e02c52463c96161e7aebcb1f4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764827819&amp;x-signature=G6gqXptWwv8ORHxaY%2FM2fhsBPkE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">四、总结</h2>
<p>LogDB是Dragonboat重要的存储层实现，作者将Pebble引擎包装为一组通用简洁的API，极大方便了上层应用与存储引擎的交互成本。</p>
<p>其中包含了很多Go语言的技巧，例如大量的内存变量复用设计，展示了这个库对高性能的极致追求，是一个十分值得学习的优秀工程案例。</p>
<h3 data-id="heading-9">往期回顾</h3>
<p>1. 从数字到版面：得物数据产品里数字格式化的那些事</p>
<p>2. 一文解析得物自建 Redis 最新技术演进</p>
<p>3. Golang HTTP请求超时与重试：构建高可靠网络请求｜得物技术</p>
<p>4. RN与hawk碰撞的火花之C++异常捕获｜得物技术</p>
<p>5. 得物TiDB升级实践</p>
<h3 data-id="heading-10">文 /酒米</h3>
<p>关注得物技术，每周更新技术干货</p>
<p>要是觉得文章对你有帮助的话，欢迎评论转发点赞～</p>
<p>未经得物技术许可严禁转载，否则依法追究法律责任。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【数据操作与可视化】Pandas数据处理-其他操作]]></title>    <link>https://juejin.cn/post/7576894999096066075</link>    <guid>https://juejin.cn/post/7576894999096066075</guid>    <pubDate>2025-11-27T01:52:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576894999096066075" data-draft-id="7575533124878630939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【数据操作与可视化】Pandas数据处理-其他操作"/> <meta itemprop="keywords" content="pandas,Python"/> <meta itemprop="datePublished" content="2025-11-27T01:52:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI小云"/> <meta itemprop="url" content="https://juejin.cn/user/4153318871926912"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【数据操作与可视化】Pandas数据处理-其他操作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4153318871926912/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI小云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T01:52:36.000Z" title="Thu Nov 27 2025 01:52:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【数据操作与可视化】Pandas数据处理-其他操作</h2>
<h4 data-id="heading-1">一、不同df进行拼接</h4>
<p>有时我们需要把不同的df合在一起，这时就要用到dataframe的拼接操作。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df1 = pd.read_excel(<span class="hljs-string">r'数据拼接.xlsx'</span>)    <span class="hljs-comment"># 3行4列</span>
df2 = pd.read_excel(<span class="hljs-string">r'数据拼接.xlsx'</span>, sheet_name=<span class="hljs-string">'data2'</span>)   <span class="hljs-comment"># 4行3列</span>
pd.concat([df1, df2])  <span class="hljs-comment"># 默认竖向拼接</span>
pd.concat([df1, df2], ignore_index=<span class="hljs-literal">True</span>)   <span class="hljs-comment"># 重新自动设置索引</span>
pd.concat([df1, df2], axis=<span class="hljs-number">1</span>)   <span class="hljs-comment"># 设置横向拼接</span>
<span class="hljs-comment"># 练习：利用concat方法在df中间插入一条记录</span>
<span class="hljs-comment"># 思路：先把原来的df拆分成两部分，然后再把它们和新的那行拼接在一起即可</span>
df = pd.read_excel(<span class="hljs-string">'数值操作.xlsx'</span>)
df_first = df[:<span class="hljs-number">5</span>]
df_second = df[<span class="hljs-number">5</span>:]
df_new = pd.DataFrame({<span class="hljs-string">'订单编号'</span>:<span class="hljs-string">'AAAA'</span>,
                       <span class="hljs-string">'客户姓名'</span>: <span class="hljs-string">'billy'</span>,
                       <span class="hljs-string">'唯一识别码'</span>: <span class="hljs-number">999</span>,
                       <span class="hljs-string">'购买日期'</span>: <span class="hljs-string">'2020-09-10'</span>,
                       <span class="hljs-string">'年龄'</span>: <span class="hljs-number">18</span>,
                       <span class="hljs-string">'消费金额'</span>: <span class="hljs-number">1000</span>}, index=[<span class="hljs-number">0</span>])
pd.concat([df_first, df_new, df_second], ignore_index=<span class="hljs-literal">True</span>)
</code></pre>
<h4 data-id="heading-2">二、数据分组</h4>
<p>分组操作相当于数据库中的group by操作，通常用于对数据进行统计操作</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. </span>
<span class="hljs-built_in">df</span> = pd.read_excel(<span class="hljs-string">'数据分组.xlsx'</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">df</span>)
<span class="hljs-comment"># 通过group by指定分组依据。注意，统计方法后面不能加参数，比如count后面不能有参数，否则报错</span>
<span class="hljs-built_in">print</span>(df.groupby(<span class="hljs-string">'学生ID'</span>).count())
<span class="hljs-comment"># print(df.groupby('学生ID').count('科目'))  # 报错</span>
<span class="hljs-comment"># sum操作只针对于float，int等数值类型的列才进行操作</span>
<span class="hljs-built_in">print</span>(df.groupby(<span class="hljs-string">'学生ID'</span>).<span class="hljs-built_in">sum</span>())
<span class="hljs-comment"># 按照多列来进行分组，如果分组后面没有指定列名，默认会对所有列进行count操作</span>
<span class="hljs-built_in">print</span>(df.groupby([<span class="hljs-string">'学生ID'</span>, <span class="hljs-string">'科目'</span>]).count())
<span class="hljs-comment"># 分组后面的列叫统计列。，可以在group by后面指定列名。如果要统计的列有多列的话，必须加[]括起来</span>
<span class="hljs-built_in">print</span>(df.groupby([<span class="hljs-string">'学生ID'</span>])[[<span class="hljs-string">'成绩'</span>]].count())   <span class="hljs-comment"># 学生ID分组后，只统计成绩这列</span>
<span class="hljs-built_in">print</span>(df.groupby([<span class="hljs-string">'学生ID'</span>])[[<span class="hljs-string">'成绩'</span>, <span class="hljs-string">'授课老师'</span>]].count())<span class="hljs-comment"># 统计成绩和授课老师两列</span>
<span class="hljs-comment"># aggregate方法的使用, 它可以同时在指定的统计列上做不同的统计计算,也就是想同时进行多种统计计算时，可以使用aggregate方法来实现</span>
<span class="hljs-built_in">print</span>(df.groupby(<span class="hljs-string">'所在年级'</span>)[[<span class="hljs-string">'成绩'</span>, <span class="hljs-string">'年龄'</span>]].aggregate([<span class="hljs-string">'mean'</span>, <span class="hljs-string">'max'</span>]))
<span class="hljs-comment"># 分组后再对不同的字段采用不同的统计方法</span>
<span class="hljs-built_in">print</span>(df.groupby(<span class="hljs-string">'所在年级'</span>).aggregate({
    <span class="hljs-string">'科目'</span>: <span class="hljs-string">'count'</span>,   <span class="hljs-comment"># 针对科目这列计数</span>
    <span class="hljs-string">'成绩'</span>: <span class="hljs-string">'mean'</span>,
    <span class="hljs-string">'年龄'</span>: <span class="hljs-string">'max'</span>
}))
<span class="hljs-built_in">print</span>(df.groupby(<span class="hljs-string">'所在年级'</span>).aggregate({
    <span class="hljs-string">'科目'</span>: <span class="hljs-string">'count'</span>,   
    <span class="hljs-string">'成绩'</span>: <span class="hljs-string">'mean'</span>,
    <span class="hljs-string">'年龄'</span>: [<span class="hljs-string">'max'</span>, <span class="hljs-string">'median'</span>]   <span class="hljs-comment"># 对某一列进行多种统计</span>
}))
</code></pre>
<h4 data-id="heading-3">三、数据导出</h4>
<p>在pandas中要将df导出为其他格式的文件，只需要统一调用pandas的to_xxx()方法即可。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 在工作路径导出为excel文件。注意，有些电脑上可能会出现缺乏openyxl模块导致的错误，如果报错的话可以自己用pip装一下。</span>
df1.to_excel(<span class="hljs-string">'test.xlsx'</span>)
<span class="hljs-comment"># 指定sheet名称</span>
df1.to_excel(<span class="hljs-string">'test.xlsx'</span>, sheet_name=<span class="hljs-string">'新sheet'</span>)
<span class="hljs-comment"># 去掉默认的索引</span>
df.to_excel(<span class="hljs-string">r'导出数据.xlsx'</span>, index = <span class="hljs-literal">False</span>)
<span class="hljs-comment"># 设置要导出的列</span>
df.to_excel(<span class="hljs-string">r'导出数据.xlsx'</span>, index=<span class="hljs-literal">False</span>, columns=[<span class="hljs-string">'列2'</span>, <span class="hljs-string">'列3'</span>])
<span class="hljs-comment"># 导出为csv文件时，含有中文必须加encoding参数</span>
df.to_csv(<span class="hljs-string">'测试保存csv.csv'</span>, encoding=<span class="hljs-string">'utf_8_sig'</span>)  <span class="hljs-comment"># encoding可以设置为utf_8_sig和gbk</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[3 张动图秒懂 A2A 协议：打造高效 Multi-Agent 协同机制]]></title>    <link>https://juejin.cn/post/7576994308272766995</link>    <guid>https://juejin.cn/post/7576994308272766995</guid>    <pubDate>2025-11-27T03:36:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576994308272766995" data-draft-id="7576935292428501034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="3 张动图秒懂 A2A 协议：打造高效 Multi-Agent 协同机制"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-11-27T03:36:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            3 张动图秒懂 A2A 协议：打造高效 Multi-Agent 协同机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T03:36:43.000Z" title="Thu Nov 27 2025 03:36:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>随着 AI Agent（智能体）技术的爆发，未来我们也必将从“人与 AI 对话”的时代迈向“AI 与 AI 协作”的时代。然而，目前的 Agent 大多像是“独行侠”——它们各自拥有相关的专业能力，却很难跨越框架、跨越服务器进行协作。</p>
<p>而Google 发布的 <strong>A2A (Agent2Agent) Protocol正是</strong>为了解决这类问题。其作用未来或许可以和Anthropic 推出的 <strong>MCP (Model Context Protocol)相媲美。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2de2734935794dd38ed8b78f1f7824d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819403&amp;x-signature=%2B840KRc8DDrcvowUvS77ojJei1s%3D" alt="" loading="lazy"/></p>
<p><strong>本文将借助一些可视化动图解析 A2A 协议的技术细节，并深度剖析它与 MCP 的本质区别。</strong></p>
<h2 data-id="heading-0">1 什么是 A2A (Agent2Agent) 协议？</h2>
<p>准化 AI Agent 之间通信的开放标准</p>
<p><strong>A2A 协议</strong> 是一套旨在标准化 AI Agent 之间通信的开放标准。如果说 HTTP 协议连接了互联网上的服务器，那么 A2A 协议就是连接不同 AI Agent 的通用语言。</p>
<p>它的核心目标是解决<strong>互操作性（Interoperability）</strong> 。无论 Agent 是由 Google Vertex AI、LangChain 还是 AutoGen 构建，只要遵循 A2A 标准，它们就能互相发现、握手并协作完成任务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d221da52e8a4fb18636a4a6279a0d83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819403&amp;x-signature=%2BW2mdaPKGi3%2FukcHk8xb3yBh2Zw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-1">A2A 的核心组件</h4>
<p>在 A2A 的架构中，Agent 之间的交互不再是简单的文本传输，而是结构化的“任务委托”：</p>
<ul>
<li><strong>Agent Card (身份卡片)</strong> ： 这是 Agent 的“名片”或 JSON 元数据文件。它声明了 Agent 的身份、能力（Capabilities）、支持的输入格式以及认证方式。Client Agent 通过读取 Server Agent 的 Card 来决定是否将任务委派给它。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72eaccd0760b410a8093de4e245419f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819403&amp;x-signature=tjBZ%2FvuwPOkuPPlIqIX0giOsHVg%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>Task (任务生命周期)： A2A 将交互视为“任务”。一个任务拥有明确的状态流转：<code>Submitted</code>（已提交） -&gt; <code>Working</code>（进行中） -&gt; <code>Input-Required</code>（需人工/外部介入） -&gt; <code>Completed</code>（完成）。这种状态管理对于长链路的异步协作至关重要。</p>
</li>
<li>
<p>Message &amp; Artifact (消息与工件)： Agent 之间不仅交换对话（Message），还交换结构化的产出物（Artifact）。例如，一个“旅行规划 Agent”完成任务后，返回的不仅仅是一句“做好了”，而是一个包含航班信息、酒店预订号的结构化 JSON Artifact。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d587bffa6cef443db699aecd75884a4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819403&amp;x-signature=F252IcySr%2F4SoWLoOk7nSf7WxwE%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-2">2 A2A vs. MCP</h2>
<p>不仅仅是名字的区别</p>
<p>很多开发者容易混淆 A2A 和 MCP，因为它们都旨在“连接”事物。但它们的<strong>连接对象</strong>和<strong>抽象层级</strong>完全不同。我们可以通过一个核心维度来区分它们：<strong>垂直整合 vs. 水平协作</strong>。</p>
<h4 data-id="heading-3">1. 垂直 vs. 水平 (Vertical vs. Horizontal)</h4>
<ul>
<li><strong>MCP (垂直整合 - 工具层)：</strong> MCP 解决的是 <strong>Agent 如何连接“世界”</strong>  的问题。它是 Agent 与外部数据（如本地文件、GitHub 仓库、数据库）或工具（如执行代码、搜索 API）之间的管道。</li>
</ul>

<ul>
<li><em>方向：</em>  向下扎根。</li>
<li><em>关系：</em>  主从关系（Client - Host - Server）。Agent 是大脑，MCP Server 是手和眼。</li>
</ul>

<ul>
<li><strong>A2A (水平协作 - 社交层)：</strong> A2A 解决的是 <strong>Agent 如何连接“同伴”</strong>  的问题。它是 Agent 寻找其他 Agent 帮忙的协议。</li>
</ul>

<ul>
<li><em>方向：</em>  向外扩展。</li>
<li><em>关系：</em>  对等或委托关系（Peer-to-Peer）。Agent A 委托 Agent B，Agent B 是另一个独立的大脑。</li>
</ul>
<h4 data-id="heading-4">技术特性的深度对比表</h4>








































<table><thead><tr><th>特性</th><th>MCP (Model Context Protocol)</th><th>A2A (Agent2Agent Protocol)</th></tr></thead><tbody><tr><td><strong>核心目标</strong></td><td>连接模型与上下文（数据/工具）</td><td>连接 Agent 与 Agent（协作/分工）</td></tr><tr><td><strong>通信模式</strong></td><td>主要是同步请求/响应 (RPC-like)</td><td>支持长运行任务、异步、状态流转</td></tr><tr><td><strong>数据流向</strong></td><td>Agent :资源/Prompt</td><td>Client Agent : Server Agent</td></tr><tr><td><strong>抽象层级</strong></td><td><strong>功能级</strong>：读文件、查库、调API</td><td><strong>任务级</strong>：如规划旅行、编写代码、审核合同等</td></tr><tr><td><strong>典型载体</strong></td><td>本地进程 (Stdio) 或 SSE</td><td>HTTP/WebSockets (跨网络)</td></tr><tr><td><strong>主要解决</strong></td><td>幻觉问题、上下文获取困难</td><td>孤岛问题、复杂任务拆解能力不足</td></tr></tbody></table>
<p>在实际的企业级应用中，A2A 和 MCP 并不是非此即彼的，而是<strong>互补</strong>的。未来的 AI 应用架构将呈现出“分层协作”的形态：</p>
<h2 data-id="heading-5"> 3 总结</h2>
<p>A2A 和 MCP 的互补性</p>
<ul>
<li>如果你正在构建一个需要访问本地文件、数据库或特定 API 的 Agent，你需要 <strong>MCP</strong>。</li>
<li>如果你正在构建一个由多个 Agent 组成的“专家团队”，需要让它们互相派活、同步进度，你需要 <strong>A2A</strong>。</li>
</ul>
<p><strong><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f45a54b452c34fe6b857d6d30b826d20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819403&amp;x-signature=rWA7Y4wA1KPCxZWNRa1jj3VU0NE%3D" alt="" loading="lazy"/></strong></p>
<p><strong>A2A 构建了 Agent 的社会关系，而 MCP 赋予了 Agent 改变世界的手脚。</strong>  两者的结合，正是从单一的大语言模型迈向真正的通用人工智能生态系统的关键一步。</p>
<h3 data-id="heading-6">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[剑指offer-43、左旋转字符串]]></title>    <link>https://juejin.cn/post/7577189654472261658</link>    <guid>https://juejin.cn/post/7577189654472261658</guid>    <pubDate>2025-11-27T04:07:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577189654472261658" data-draft-id="7575065042158174258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 剑指offer-43、左旋转字符串"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-27T04:07:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             剑指offer-43、左旋转字符串
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T04:07:41.000Z" title="Thu Nov 27 2025 04:07:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">题⽬描述</h2>
<p>汇编语⾔中有⼀种移位指令叫做循环左移（ ROL ），现在有个简单的任务，就是⽤字符串模拟这个指令的运算结果。对于⼀个给定的字符序列 S ，请你把其循环左移 K 位后的序列输出。例如，字符序列S=”abcXYZdef” ,要求输出循环左移3位后的结果，即“ XYZdefabc ”。是不是很简单？OK，搞定它！</p>
<h2 data-id="heading-1">思路及解答</h2>
<p>这道题⽬的意思就是将前⾯ n 位，移动到后⾯，那么我们可以直接从第 n+1 位开始，遍历到最后⼀个，再拼接上前⾯ n 个。</p>
<h3 data-id="heading-2">暴力移位</h3>
<p>通过k次单步左移实现循环左移。将第一个字符保存，其余字符前移，最后字符放到末尾</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">leftRotateString</span><span class="hljs-params">(String str, <span class="hljs-type">int</span> n)</span> {
        <span class="hljs-keyword">if</span> (str == <span class="hljs-literal">null</span> || str.length() == <span class="hljs-number">0</span> || n &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> str;
        }
        
        <span class="hljs-type">char</span>[] chars = str.toCharArray();
        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> chars.length;
        n %= len; <span class="hljs-comment">// 处理n大于字符串长度的情况</span>
        
        <span class="hljs-comment">// 执行n次单步左移</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; k &lt; n; k++) {
            <span class="hljs-comment">// 单步左移：保存首字符，其余前移，最后放回首字符</span>
            <span class="hljs-type">char</span> <span class="hljs-variable">firstChar</span> <span class="hljs-operator">=</span> chars[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; len - <span class="hljs-number">1</span>; i++) {
                chars[i] = chars[i + <span class="hljs-number">1</span>];
            }
            chars[len - <span class="hljs-number">1</span>] = firstChar;
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(chars);
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(k×n)，其中k为移动次数，n为字符串长度</li>
<li><strong>空间复杂度</strong>：O(1)，只使用固定额外空间</li>
</ul>
<h3 data-id="heading-3">字符串切片法（推荐）</h3>
<p>值得注意的是， n 可能⼤于 str 的⻓度，那么这种情况下我们应该先对 str 的⻓度取余，保持严谨。即是： n = n % str.length(); 。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {

	<span class="hljs-keyword">public</span> String <span class="hljs-title function_">LeftRotateString</span><span class="hljs-params">(String str, <span class="hljs-type">int</span> n)</span> {
		<span class="hljs-keyword">if</span> (str == <span class="hljs-literal">null</span> || str.length() == <span class="hljs-number">0</span> || n &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> str;
        }
		<span class="hljs-type">String</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
		n = n % str.length();
		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n; i &lt; str.length(); ++i) {
			ret += str.charAt(i);
		}
		
		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n; ++i) {
			ret += str.charAt(i);
		}
		<span class="hljs-keyword">return</span> ret;
	}

}
</code></pre>
<ul>
<li>时间复杂度 O(n)</li>
<li>空间复杂度 O(n) 。</li>
</ul>
<p>或者可以用substring 的API</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">leftRotateString</span><span class="hljs-params">(String str, <span class="hljs-type">int</span> n)</span> {
        <span class="hljs-keyword">if</span> (str == <span class="hljs-literal">null</span> || str.length() == <span class="hljs-number">0</span> || n &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> str;
        }
        
        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> str.length();
        n %= len; <span class="hljs-comment">// 处理n大于字符串长度的情况</span>
        
        <span class="hljs-comment">// 直接截取并拼接：后部分 + 前部分</span>
        <span class="hljs-keyword">return</span> str.substring(n) + str.substring(<span class="hljs-number">0</span>, n);
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(n)，substring操作需要线性时间</li>
<li><strong>空间复杂度</strong>：O(n)，创建新的字符串对象</li>
</ul>
<h3 data-id="heading-4">三次反转（数学优美）</h3>
<p>利用数学规律：BA = (A'B')'，通过三次反转实现循环左移。</p>
<p>分别反转前n位、剩余部分，最后整体反转</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">leftRotateString</span><span class="hljs-params">(String str, <span class="hljs-type">int</span> n)</span> {
        <span class="hljs-keyword">if</span> (str == <span class="hljs-literal">null</span> || str.length() == <span class="hljs-number">0</span> || n &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> str;
        }
        
        <span class="hljs-type">char</span>[] chars = str.toCharArray();
        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> chars.length;
        n %= len;
        
        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> str; <span class="hljs-comment">// 移动0位直接返回</span>
        
        <span class="hljs-comment">// 第一步：反转前n个字符</span>
        reverse(chars, <span class="hljs-number">0</span>, n - <span class="hljs-number">1</span>);
        <span class="hljs-comment">// 第二步：反转剩余字符</span>
        reverse(chars, n, len - <span class="hljs-number">1</span>);
        <span class="hljs-comment">// 第三步：整体反转</span>
        reverse(chars, <span class="hljs-number">0</span>, len - <span class="hljs-number">1</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(chars);
    }
    
    <span class="hljs-comment">/**
     * 反转字符数组中指定范围的字符
     * <span class="hljs-doctag">@param</span> chars 字符数组
     * <span class="hljs-doctag">@param</span> start 起始索引
     * <span class="hljs-doctag">@param</span> end 结束索引
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reverse</span><span class="hljs-params">(<span class="hljs-type">char</span>[] chars, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
        <span class="hljs-keyword">while</span> (start &lt; end) {
            <span class="hljs-comment">// 交换首尾字符</span>
            <span class="hljs-type">char</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> chars[start];
            chars[start] = chars[end];
            chars[end] = temp;
            start++;
            end--;
        }
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(n)，每个字符被访问两次</li>
<li><strong>空间复杂度</strong>：O(1)，原地操作，只使用常数空间</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NocoBase 本周更新汇总：优化及缺陷修复]]></title>    <link>https://juejin.cn/post/7576928310788554804</link>    <guid>https://juejin.cn/post/7576928310788554804</guid>    <pubDate>2025-11-27T04:11:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576928310788554804" data-draft-id="7576914798057095220" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NocoBase 本周更新汇总：优化及缺陷修复"/> <meta itemprop="keywords" content="开源,资讯,低代码"/> <meta itemprop="datePublished" content="2025-11-27T04:11:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NocoBase"/> <meta itemprop="url" content="https://juejin.cn/user/180779873743566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NocoBase 本周更新汇总：优化及缺陷修复
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180779873743566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NocoBase
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T04:11:11.000Z" title="Thu Nov 27 2025 04:11:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fweekly-updates-20251127" target="_blank" title="https://www.nocobase.com/cn/blog/weekly-updates-20251127" ref="nofollow noopener noreferrer">www.nocobase.com/cn/blog/wee…</a></p>
<p>汇总一周产品更新日志，最新发布可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Ftimeline" target="_blank" title="https://www.nocobase.com/cn/blog/timeline" ref="nofollow noopener noreferrer">前往我们的博客查看</a>。</p>
<p><strong>NocoBase 目前更新包括的版本更新包括三个分支：<code>main</code> ，<code>next</code>和 <code>develop</code>。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cbfcb316a2649969c446d5ce5528959~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764821471&amp;x-signature=tybfEctJUqsbM5cX2FFzeAnBFf8%3D" alt="version.png" loading="lazy"/></p>
<p><code>main</code> ：截止目前最稳定的版本，推荐安装此版本。</p>
<p><code>next</code>：包含即将发布的新功能，经过初步测试的版本，可能存在部分已知或未知问题。主要面向测试用户，用于收集反馈和进一步优化功能。适合愿意提前体验新功能并提供反馈的测试用户。</p>
<p><code>develop</code>：开发中的版本，包含最新的功能代码，可能尚未完成或存在较多不稳定因素，主要用于内部开发和快速迭代。适合对产品功能前沿发展感兴趣的技术用户，但可能存在较多问题或不完整功能，不建议在生产环境中使用。</p>
<h2 data-id="heading-0">main</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/928da26b174f495b9476e3e0d6a53718~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764821471&amp;x-signature=2iXr3Awq3OQtPpSDCDdeF571ghM%3D" alt="main.png" loading="lazy"/></p>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv1.9.14" target="_blank" title="https://www.nocobase.com/cn/blog/v1.9.14" ref="nofollow noopener noreferrer">v1.9.14</a></h3>
<p><em>发布时间：2025-11-27</em></p>
<h3 data-id="heading-2">🎉 新特性</h3>
<ul>
<li><strong>[认证：OIDC]</strong> 支持选项 当用户未登录时自动跳转到 SSO 登录页 by @heziqiang</li>
</ul>
<h3 data-id="heading-3">🚀 优化</h3>
<ul>
<li><strong>[client]</strong> 对消息内容的变量使用三重括号，以免变量被 Handlerbars 转义 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7972" target="_blank" title="https://github.com/nocobase/nocobase/pull/7972" ref="nofollow noopener noreferrer">#7972</a>) by @mytharcher</li>
<li><strong>[数据表字段：Markdown(Vditor)]</strong> 调整 Vditor 全屏时内容宽度 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7974" target="_blank" title="https://github.com/nocobase/nocobase/pull/7974" ref="nofollow noopener noreferrer">#7974</a>) by @katherinehhh</li>
</ul>
<h3 data-id="heading-4">🐛 修复</h3>
<ul>
<li>
<p><strong>[database]</strong> 修复：移除 time 字段转换中的 UTC 处理，避免因时区导致的纯时间值偏移 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7812" target="_blank" title="https://github.com/nocobase/nocobase/pull/7812" ref="nofollow noopener noreferrer">#7812</a>) by @ChimingLiu</p>
</li>
<li>
<p><strong>[client]</strong> 修复 下拉列表组件在非对象值回显时没有正确显示 label 问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7975" target="_blank" title="https://github.com/nocobase/nocobase/pull/7975" ref="nofollow noopener noreferrer">#7975</a>) by @katherinehhh</p>
</li>
<li>
<p><strong>[工作流]</strong></p>
<ul>
<li>修复停止服务前，已创建的执行计划未发送到队列的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7981" target="_blank" title="https://github.com/nocobase/nocobase/pull/7981" ref="nofollow noopener noreferrer">#7981</a>) by @mytharcher</li>
<li>修复点击默认进入的待办列表中的任务跳转到错误页面的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7983" target="_blank" title="https://github.com/nocobase/nocobase/pull/7983" ref="nofollow noopener noreferrer">#7983</a>) by @mytharcher</li>
<li>修复部分工作流待办菜单不显示的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7980" target="_blank" title="https://github.com/nocobase/nocobase/pull/7980" ref="nofollow noopener noreferrer">#7980</a>) by @mytharcher</li>
<li>修复由于 provider 误用导致待办总数不展示的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7968" target="_blank" title="https://github.com/nocobase/nocobase/pull/7968" ref="nofollow noopener noreferrer">#7968</a>) by @mytharcher</li>
</ul>
</li>
<li>
<p><strong>[工作流：人工处理节点]</strong> 修复人工待办任务统计数字不对的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7984" target="_blank" title="https://github.com/nocobase/nocobase/pull/7984" ref="nofollow noopener noreferrer">#7984</a>) by @mytharcher</p>
</li>
<li>
<p><strong>[数据可视化]</strong></p>
<ul>
<li>外部数据源表的筛选字段的配置项不能显示特有属性 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7982" target="_blank" title="https://github.com/nocobase/nocobase/pull/7982" ref="nofollow noopener noreferrer">#7982</a>) by @2013xile</li>
<li>解决图表数据查询不支持 ACL 数据范围的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7915" target="_blank" title="https://github.com/nocobase/nocobase/pull/7915" ref="nofollow noopener noreferrer">#7915</a>) by @2013xile</li>
</ul>
</li>
<li>
<p><strong>[数据源管理]</strong> 修复外部数据源修改密码后系统内无法更新密码的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7977" target="_blank" title="https://github.com/nocobase/nocobase/pull/7977" ref="nofollow noopener noreferrer">#7977</a>) by @cgyrock</p>
</li>
<li>
<p><strong>[操作：导入记录]</strong> 修复树表导入数据报错问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7976" target="_blank" title="https://github.com/nocobase/nocobase/pull/7976" ref="nofollow noopener noreferrer">#7976</a>) by @cgyrock</p>
</li>
</ul>
<h3 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv1.9.13" target="_blank" title="https://www.nocobase.com/cn/blog/v1.9.13" ref="nofollow noopener noreferrer">v1.9.13</a></h3>
<p><em>发布时间：2025-11-25</em></p>
<h3 data-id="heading-6">🐛 修复</h3>
<ul>
<li><strong>[client]</strong> 修复使用 Iframe 时，导致路由异常的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7957" target="_blank" title="https://github.com/nocobase/nocobase/pull/7957" ref="nofollow noopener noreferrer">#7957</a>) by @zhangzhonghe</li>
</ul>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv1.9.12" target="_blank" title="https://www.nocobase.com/cn/blog/v1.9.12" ref="nofollow noopener noreferrer">v1.9.12</a></h3>
<p><em>发布时间：2025-11-24</em></p>
<h3 data-id="heading-8">🚀 优化</h3>
<ul>
<li>
<p><strong>[client]</strong> 为更新记录和删除记录操作按钮添加加载状态，以避免重复请求 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7964" target="_blank" title="https://github.com/nocobase/nocobase/pull/7964" ref="nofollow noopener noreferrer">#7964</a>) by @mytharcher</p>
</li>
<li>
<p><strong>[异步任务管理器]</strong> 优化异步任务的错误信息，任务失败时将明确提示具体的错误原因 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7796" target="_blank" title="https://github.com/nocobase/nocobase/pull/7796" ref="nofollow noopener noreferrer">#7796</a>) by @mytharcher</p>
</li>
<li>
<p><strong>[操作：导入记录 Pro]</strong> 优化异步任务的错误信息，任务失败时将明确提示具体的错误原因 by @mytharcher</p>
</li>
<li>
<p><strong>[工作流：审批]</strong></p>
<ul>
<li>修复审批人选择组件，仅允许用户表的主外键可选 by @mytharcher</li>
<li>减少打开审批弹窗时加载的关联数据，以提供更好的性能表现 by @mytharcher</li>
<li>在手动执行（或子流程调用）时，同时支持传入整行数据或仅主键，避免触发器数据中的数据一致性问题 by @mytharcher</li>
</ul>
</li>
</ul>
<h3 data-id="heading-9">🐛 修复</h3>
<ul>
<li><strong>[异步任务管理器]</strong> 为 <code>asyncTasks</code> 数据表增加迁移规则，避免异步任务记录被迁移 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7950" target="_blank" title="https://github.com/nocobase/nocobase/pull/7950" ref="nofollow noopener noreferrer">#7950</a>) by @mytharcher</li>
<li><strong>[工作流：审批]</strong> 修复语言文件 by @mytharcher</li>
</ul>
<h3 data-id="heading-10"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv1.9.11" target="_blank" title="https://www.nocobase.com/cn/blog/v1.9.11" ref="nofollow noopener noreferrer">v1.9.11</a></h3>
<p><em>发布时间：2025-11-24</em></p>
<h3 data-id="heading-11">🐛 修复</h3>
<ul>
<li><strong>[client]</strong> 修复外部数据源配置 belongsTo 字段时，field interface 显示为 many to one 而非 one to one 的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7936" target="_blank" title="https://github.com/nocobase/nocobase/pull/7936" ref="nofollow noopener noreferrer">#7936</a>) by @cgyrock</li>
<li><strong>[工作流]</strong> 修复了更新待办数量时意外导致填写中的表单状态被重置的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7937" target="_blank" title="https://github.com/nocobase/nocobase/pull/7937" ref="nofollow noopener noreferrer">#7937</a>) by @mytharcher</li>
<li><strong>[数据表字段：多对多 (数组)]</strong> 修复多对多（数组）字段在新增/修改关联数据时的异常行为 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7926" target="_blank" title="https://github.com/nocobase/nocobase/pull/7926" ref="nofollow noopener noreferrer">#7926</a>) by @cgyrock</li>
</ul>
<h3 data-id="heading-12"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv1.9.10" target="_blank" title="https://www.nocobase.com/cn/blog/v1.9.10" ref="nofollow noopener noreferrer">v1.9.10</a></h3>
<p><em>发布时间：2025-11-20</em></p>
<h3 data-id="heading-13">🚀 优化</h3>
<ul>
<li><strong>[权限控制]</strong> 缩小 member 角色的默认权限 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7921" target="_blank" title="https://github.com/nocobase/nocobase/pull/7921" ref="nofollow noopener noreferrer">#7921</a>) by @2013xile</li>
<li><strong>[数据可视化]</strong> 为插件界面添加了俄语支持。 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7676" target="_blank" title="https://github.com/nocobase/nocobase/pull/7676" ref="nofollow noopener noreferrer">#7676</a>) by @sembaev-a-a</li>
<li><strong>[工作流：Webhook 触发器]</strong> 为响应节点增加图标 by @mytharcher</li>
</ul>
<h3 data-id="heading-14">🐛 修复</h3>
<ul>
<li><strong>[client]</strong> 修复错误： Can't resolve 'antd-mobile' 和 Can't resolve 'antd-mobile-icons' (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7914" target="_blank" title="https://github.com/nocobase/nocobase/pull/7914" ref="nofollow noopener noreferrer">#7914</a>) by @zhangzhonghe</li>
<li><strong>[权限控制]</strong> 关系字段关联操作支持数据范围限制 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7919" target="_blank" title="https://github.com/nocobase/nocobase/pull/7919" ref="nofollow noopener noreferrer">#7919</a>) by @2013xile</li>
<li><strong>[数据源：主数据库]</strong> 修复增加一对多字段后在重启应用前无法选择外键字段的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7907" target="_blank" title="https://github.com/nocobase/nocobase/pull/7907" ref="nofollow noopener noreferrer">#7907</a>) by @cgyrock</li>
</ul>
<h2 data-id="heading-15">next</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/174c3b0c093443d58675a87313f692b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764821471&amp;x-signature=OX2LRH9rL0Ld0yGWKmLZYujDvUw%3D" alt="next.png" loading="lazy"/></p>
<h3 data-id="heading-16"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv1.9.0-beta.17" target="_blank" title="https://www.nocobase.com/cn/blog/v1.9.0-beta.17" ref="nofollow noopener noreferrer">v1.9.0-beta.17</a></h3>
<p><em>发布时间：2025-11-21</em></p>
<h3 data-id="heading-17">🚀 优化</h3>
<ul>
<li>
<p><strong>[database]</strong> 对 MariaDB 连接实例增加 <code>multipleStatements</code> 选项，以支持一次查询中调用多条语句 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7781" target="_blank" title="https://github.com/nocobase/nocobase/pull/7781" ref="nofollow noopener noreferrer">#7781</a>) by @mytharcher</p>
</li>
<li>
<p><strong>[权限控制]</strong></p>
<ul>
<li>缩小 member 角色的默认权限 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7921" target="_blank" title="https://github.com/nocobase/nocobase/pull/7921" ref="nofollow noopener noreferrer">#7921</a>) by @2013xile</li>
<li>优化关系字段关联操作的权限控制逻辑 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7800" target="_blank" title="https://github.com/nocobase/nocobase/pull/7800" ref="nofollow noopener noreferrer">#7800</a>) by @2013xile</li>
</ul>
</li>
<li>
<p><strong>[数据可视化]</strong> 为插件界面添加了俄语支持。 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7676" target="_blank" title="https://github.com/nocobase/nocobase/pull/7676" ref="nofollow noopener noreferrer">#7676</a>) by @sembaev-a-a</p>
</li>
<li>
<p><strong>[工作流]</strong> 支持工作流中的数据区块使用一致的详情区块配置菜单 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7771" target="_blank" title="https://github.com/nocobase/nocobase/pull/7771" ref="nofollow noopener noreferrer">#7771</a>) by @mytharcher</p>
</li>
<li>
<p><strong>[工作流：Webhook 触发器]</strong> 为响应节点增加图标 by @mytharcher</p>
</li>
<li>
<p><strong>[工作流：JavaScript 节点]</strong> 修复传递到执行环境中的上层函数导致的安全漏洞，避免通过利用漏洞访问上层执行环境的问题 by @mytharcher</p>
</li>
<li>
<p><strong>[认证：OIDC]</strong> 增加请求超时时间 by @2013xile</p>
</li>
<li>
<p><strong>[工作流：审批]</strong> 在转签和加签时通知新的审批人 by @mytharcher</p>
</li>
</ul>
<h3 data-id="heading-18">🐛 修复</h3>
<ul>
<li>
<p><strong>[client]</strong></p>
<ul>
<li>修复外部数据源配置 belongsTo 字段时，field interface 显示为 many to one 而非 one to one 的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7936" target="_blank" title="https://github.com/nocobase/nocobase/pull/7936" ref="nofollow noopener noreferrer">#7936</a>) by @cgyrock</li>
<li>修复错误：Can't resolve 'antd-mobile' 和 Can't resolve 'antd-mobile-icons' (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7914" target="_blank" title="https://github.com/nocobase/nocobase/pull/7914" ref="nofollow noopener noreferrer">#7914</a>) by @zhangzhonghe</li>
<li>修复拖拽引用模板后再删除引用模板而导致的复制模板不显示的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7847" target="_blank" title="https://github.com/nocobase/nocobase/pull/7847" ref="nofollow noopener noreferrer">#7847</a>) by @zhangzhonghe</li>
<li>修复审批表单的联动规则不生效的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7858" target="_blank" title="https://github.com/nocobase/nocobase/pull/7858" ref="nofollow noopener noreferrer">#7858</a>) by @zhangzhonghe</li>
<li>修复详情区块简单分页出现空数据下一页的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7784" target="_blank" title="https://github.com/nocobase/nocobase/pull/7784" ref="nofollow noopener noreferrer">#7784</a>) by @katherinehhh</li>
<li>修复 “Maximum call stack size exceeded” (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7780" target="_blank" title="https://github.com/nocobase/nocobase/pull/7780" ref="nofollow noopener noreferrer">#7780</a>) by @zhangzhonghe</li>
</ul>
</li>
<li>
<p><strong>[server]</strong></p>
<ul>
<li>修复服务拆分模式下未订阅无法发布队列消息的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7875" target="_blank" title="https://github.com/nocobase/nocobase/pull/7875" ref="nofollow noopener noreferrer">#7875</a>) by @mytharcher</li>
<li>使用应用名称隔离发布订阅的频道 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7762" target="_blank" title="https://github.com/nocobase/nocobase/pull/7762" ref="nofollow noopener noreferrer">#7762</a>) by @mytharcher</li>
<li>修复消息队列在启用服务拆分模式后，工作进程发消息导致报错的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7797" target="_blank" title="https://github.com/nocobase/nocobase/pull/7797" ref="nofollow noopener noreferrer">#7797</a>) by @mytharcher</li>
</ul>
</li>
<li>
<p><strong>[utils]</strong> 为 intersect 策略增加对象类型支持 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7840" target="_blank" title="https://github.com/nocobase/nocobase/pull/7840" ref="nofollow noopener noreferrer">#7840</a>) by @chenos</p>
</li>
<li>
<p><strong>[database]</strong> 字段名为 snake_case 风格时，索引字段判断不正确的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7776" target="_blank" title="https://github.com/nocobase/nocobase/pull/7776" ref="nofollow noopener noreferrer">#7776</a>) by @2013xile</p>
</li>
<li>
<p><strong>[数据表字段：多对多 (数组)]</strong> 修复多对多（数组）字段在新增/修改关联数据时的异常行为 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7926" target="_blank" title="https://github.com/nocobase/nocobase/pull/7926" ref="nofollow noopener noreferrer">#7926</a>) by @cgyrock</p>
</li>
<li>
<p><strong>[数据源：主数据库]</strong> 修复增加一对多字段后在重启应用前无法选择外键字段的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7907" target="_blank" title="https://github.com/nocobase/nocobase/pull/7907" ref="nofollow noopener noreferrer">#7907</a>) by @cgyrock</p>
</li>
<li>
<p><strong>[工作流]</strong></p>
<ul>
<li>修复了更新待办数量时意外导致填写中的表单状态被重置的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7937" target="_blank" title="https://github.com/nocobase/nocobase/pull/7937" ref="nofollow noopener noreferrer">#7937</a>) by @mytharcher</li>
<li>使用底层事件队列代替共享后台任务队列，以避免共享队列在服务拆分模式下会被错误消费的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7871" target="_blank" title="https://github.com/nocobase/nocobase/pull/7871" ref="nofollow noopener noreferrer">#7871</a>) by @mytharcher</li>
<li>修复服务拆分模式下，工作流插件不处于服务模式时仍然消费队列的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7820" target="_blank" title="https://github.com/nocobase/nocobase/pull/7820" ref="nofollow noopener noreferrer">#7820</a>) by @mytharcher</li>
<li>修复监听不存在的外部数据源事件产生的报错 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7855" target="_blank" title="https://github.com/nocobase/nocobase/pull/7855" ref="nofollow noopener noreferrer">#7855</a>) by @mytharcher</li>
<li>修复在服务拆分模式下，手动执行带中断节点的工作流一直等待的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7767" target="_blank" title="https://github.com/nocobase/nocobase/pull/7767" ref="nofollow noopener noreferrer">#7767</a>) by @mytharcher</li>
<li>为工作流的日志增加 <code>workflowId</code> 的数据标识 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7789" target="_blank" title="https://github.com/nocobase/nocobase/pull/7789" ref="nofollow noopener noreferrer">#7789</a>) by @mytharcher</li>
<li>修复了集群模式下工作流调度器无法正确识别空闲状态的问题，该问题可能导致插件未就绪就开始消费队列事件 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7768" target="_blank" title="https://github.com/nocobase/nocobase/pull/7768" ref="nofollow noopener noreferrer">#7768</a>) by @mytharcher</li>
</ul>
</li>
<li>
<p><strong>[权限控制]</strong></p>
<ul>
<li>关系字段关联操作支持数据范围限制 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7919" target="_blank" title="https://github.com/nocobase/nocobase/pull/7919" ref="nofollow noopener noreferrer">#7919</a>) by @2013xile</li>
<li>关系字段关联操作 snippets 不生效的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7876" target="_blank" title="https://github.com/nocobase/nocobase/pull/7876" ref="nofollow noopener noreferrer">#7876</a>) by @2013xile</li>
</ul>
</li>
<li>
<p><strong>[工作流：人工处理节点]</strong> 修复翻译语言指向的命名空间，以正确的翻译内容 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7877" target="_blank" title="https://github.com/nocobase/nocobase/pull/7877" ref="nofollow noopener noreferrer">#7877</a>) by @mytharcher</p>
</li>
<li>
<p><strong>[用户]</strong> 字段名为 snake_case 风格时，索引字段重置不正确的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7785" target="_blank" title="https://github.com/nocobase/nocobase/pull/7785" ref="nofollow noopener noreferrer">#7785</a>) by @2013xile</p>
</li>
<li>
<p><strong>[移动端（已废弃）]</strong> 修复移动端的日期字段默认值弹窗无法选中日期的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7783" target="_blank" title="https://github.com/nocobase/nocobase/pull/7783" ref="nofollow noopener noreferrer">#7783</a>) by @zhangzhonghe</p>
</li>
<li>
<p><strong>[工作流：自定义变量节点]</strong> 修复变量节点缺失 config 时报错的问题 by @mytharcher</p>
</li>
<li>
<p><strong>[工作流：自定义操作事件]</strong> 修复监听不存在的外部数据源事件产生的报错 by @mytharcher</p>
</li>
<li>
<p><strong>[模板打印]</strong> 解析 filter 中变量 by @jiannx</p>
</li>
<li>
<p><strong>[数据可视化：EChrats]</strong> 修复 Echarts 选项配置 Label type 不生效的问题 by @heziqiang</p>
</li>
<li>
<p><strong>[工作流：审批]</strong></p>
<ul>
<li>修复待办中心审批列表卡片上的日期格式，展示完整的日期和时间 by @mytharcher</li>
<li>修复通知渠道分页数量太小加载不全的问题 by @mytharcher</li>
<li>修复提交审批处理时查询审批记录列表的性能问题 by @mytharcher</li>
<li>修复重查关系数据时未屏蔽主表字段的问题 by @mytharcher</li>
<li>修复由于多个审批人并发处理审批时的竞态导致的节点重复执行的问题 by @mytharcher</li>
<li>并行分支中不再支持创建审批节点，避免流程状态导致的问题 by @mytharcher</li>
<li>修复审批表单的联动规则不生效的问题 by @zhangzhonghe</li>
<li>修复复制审批工作流时报错的问题 by @mytharcher</li>
</ul>
</li>
<li>
<p><strong>[邮件管理]</strong></p>
<ul>
<li>添加同步日志 by @jiannx</li>
<li>没有时间戳的情况下同步微软邮件已读状态 by @jiannx</li>
<li>mailMessages 添加索引 by @jiannx</li>
<li>给索引添加迁移脚本 by @jiannx</li>
<li>修复 Outlook 内敛图片和同步问题 by @jiannx</li>
</ul>
</li>
</ul>
<h2 data-id="heading-19">develop</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7b96260b2774504844b7b4695b02df7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764821471&amp;x-signature=bBUYij57PqNqk%2Bjw6Lj%2B%2BuUZsMM%3D" alt="develop.png" loading="lazy"/></p>
<h3 data-id="heading-20"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv2.0.0-alpha.47" target="_blank" title="https://www.nocobase.com/cn/blog/v2.0.0-alpha.47" ref="nofollow noopener noreferrer">v2.0.0-alpha.47</a></h3>
<p><em>发布时间：2025-11-26</em></p>
<h3 data-id="heading-21">🚀 优化</h3>
<ul>
<li>
<p><strong>[client]</strong></p>
<ul>
<li>支持在图表查询初始时选择筛选字段 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7933" target="_blank" title="https://github.com/nocobase/nocobase/pull/7933" ref="nofollow noopener noreferrer">#7933</a>) by @heziqiang</li>
<li>对消息内容的变量使用三重括号，以免变量被 Handlerbars 转义 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7972" target="_blank" title="https://github.com/nocobase/nocobase/pull/7972" ref="nofollow noopener noreferrer">#7972</a>) by @mytharcher</li>
<li>为更新记录和删除记录操作按钮添加加载状态，以避免重复请求 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7964" target="_blank" title="https://github.com/nocobase/nocobase/pull/7964" ref="nofollow noopener noreferrer">#7964</a>) by @mytharcher</li>
</ul>
</li>
<li>
<p><strong>[数据表字段：Markdown(Vditor)]</strong> 调整 Vditor 全屏时内容宽度 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7974" target="_blank" title="https://github.com/nocobase/nocobase/pull/7974" ref="nofollow noopener noreferrer">#7974</a>) by @katherinehhh</p>
</li>
</ul>
<h3 data-id="heading-22">🐛 修复</h3>
<ul>
<li>
<p><strong>[client]</strong></p>
<ul>
<li>修复非 id 关系字段弹窗详情区块打开报错。 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7973" target="_blank" title="https://github.com/nocobase/nocobase/pull/7973" ref="nofollow noopener noreferrer">#7973</a>) by @gchust</li>
<li>修复非 id 关系字段弹窗中关系数据加载错误的问题。 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7970" target="_blank" title="https://github.com/nocobase/nocobase/pull/7970" ref="nofollow noopener noreferrer">#7970</a>) by @gchust</li>
<li>修复使用 Iframe 时，导致路由异常的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7957" target="_blank" title="https://github.com/nocobase/nocobase/pull/7957" ref="nofollow noopener noreferrer">#7957</a>) by @zhangzhonghe</li>
<li>修复数字字段格式化精度设置无效的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7967" target="_blank" title="https://github.com/nocobase/nocobase/pull/7967" ref="nofollow noopener noreferrer">#7967</a>) by @katherinehhh</li>
<li>修复新建 2.0 页面的类型不正确的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7945" target="_blank" title="https://github.com/nocobase/nocobase/pull/7945" ref="nofollow noopener noreferrer">#7945</a>) by @zhangzhonghe</li>
<li>修复点击筛选重置按钮时筛选值未清空的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7966" target="_blank" title="https://github.com/nocobase/nocobase/pull/7966" ref="nofollow noopener noreferrer">#7966</a>) by @zhangzhonghe</li>
</ul>
</li>
<li>
<p><strong>[工作流]</strong> 修复由于 provider 误用导致待办总数不展示的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7968" target="_blank" title="https://github.com/nocobase/nocobase/pull/7968" ref="nofollow noopener noreferrer">#7968</a>) by @mytharcher</p>
</li>
<li>
<p><strong>[数据可视化]</strong> 解决图表数据查询不支持 ACL 数据范围的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7915" target="_blank" title="https://github.com/nocobase/nocobase/pull/7915" ref="nofollow noopener noreferrer">#7915</a>) by @2013xile</p>
</li>
<li>
<p><strong>[区块：引用]</strong> 修复引用区块会将被引用区块从原始页面中移除的问题。 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7969" target="_blank" title="https://github.com/nocobase/nocobase/pull/7969" ref="nofollow noopener noreferrer">#7969</a>) by @gchust</p>
</li>
<li>
<p><strong>[AI 员工]</strong> 修复AI员工生成 SQL 异常输出的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7956" target="_blank" title="https://github.com/nocobase/nocobase/pull/7956" ref="nofollow noopener noreferrer">#7956</a>) by @heziqiang</p>
</li>
<li>
<p><strong>[模板打印]</strong> 修复表格行中模板打印操作添加模板失败问题 by @katherinehhh</p>
</li>
</ul>
<h3 data-id="heading-23"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv2.0.0-alpha.46" target="_blank" title="https://www.nocobase.com/cn/blog/v2.0.0-alpha.46" ref="nofollow noopener noreferrer">v2.0.0-alpha.46</a></h3>
<p><em>发布时间：2025-11-24</em></p>
<h3 data-id="heading-24">🚀 优化</h3>
<ul>
<li>
<p><strong>[flow-engine]</strong> 支持动态切换 flow model 类型 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7952" target="_blank" title="https://github.com/nocobase/nocobase/pull/7952" ref="nofollow noopener noreferrer">#7952</a>) by @gchust</p>
</li>
<li>
<p><strong>[AI 员工]</strong> AI 员工插件添加 upgrade 钩子函数 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7951" target="_blank" title="https://github.com/nocobase/nocobase/pull/7951" ref="nofollow noopener noreferrer">#7951</a>) by @heziqiang</p>
</li>
<li>
<p><strong>[异步任务管理器]</strong> 优化异步任务的错误信息，任务失败时将明确提示具体的错误原因 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7796" target="_blank" title="https://github.com/nocobase/nocobase/pull/7796" ref="nofollow noopener noreferrer">#7796</a>) by @mytharcher</p>
</li>
<li>
<p><strong>[工作流：审批]</strong></p>
<ul>
<li>在手动执行（或子流程调用）时，同时支持传入整行数据或仅主键，避免触发器数据中的数据一致性问题 by @mytharcher</li>
<li>减少打开审批弹窗时加载的关联数据，以提供更好的性能表现 by @mytharcher</li>
<li>修复审批人选择组件，仅允许用户表的主外键可选 by @mytharcher</li>
</ul>
</li>
</ul>
<h3 data-id="heading-25">🐛 修复</h3>
<ul>
<li><strong>[client]</strong> 文本字段在详情区块中超出内容宽度时应默认换行 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7955" target="_blank" title="https://github.com/nocobase/nocobase/pull/7955" ref="nofollow noopener noreferrer">#7955</a>) by @katherinehhh</li>
<li><strong>[异步任务管理器]</strong> 为 <code>asyncTasks</code> 数据表增加迁移规则，避免异步任务记录被迁移 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7950" target="_blank" title="https://github.com/nocobase/nocobase/pull/7950" ref="nofollow noopener noreferrer">#7950</a>) by @mytharcher</li>
<li><strong>[文件管理器]</strong> 修复表单附件字段上传未按设置使用指定文件存储器的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7947" target="_blank" title="https://github.com/nocobase/nocobase/pull/7947" ref="nofollow noopener noreferrer">#7947</a>) by @katherinehhh</li>
<li><strong>[工作流：审批]</strong> 修复语言文件 by @mytharcher</li>
</ul>
<h3 data-id="heading-26"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv2.0.0-alpha.45" target="_blank" title="https://www.nocobase.com/cn/blog/v2.0.0-alpha.45" ref="nofollow noopener noreferrer">v2.0.0-alpha.45</a></h3>
<p><em>发布时间：2025-11-21</em></p>
<h3 data-id="heading-27">🎉 新特性</h3>
<ul>
<li><strong>[client]</strong> 支持表格列字段开启排序 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7900" target="_blank" title="https://github.com/nocobase/nocobase/pull/7900" ref="nofollow noopener noreferrer">#7900</a>) by @katherinehhh</li>
<li><strong>[工作流]</strong> 新增“多条件分支”节点，提供类似 <code>switch</code> / <code>case</code> 的控制流程 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7878" target="_blank" title="https://github.com/nocobase/nocobase/pull/7878" ref="nofollow noopener noreferrer">#7878</a>) by @mytharcher</li>
</ul>
<h3 data-id="heading-28">🐛 修复</h3>
<ul>
<li><strong>[client]</strong> 修复多级联选择器清空数据时报错的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7943" target="_blank" title="https://github.com/nocobase/nocobase/pull/7943" ref="nofollow noopener noreferrer">#7943</a>) by @katherinehhh</li>
<li><strong>[数据可视化]</strong> 修复图表配置保存后区块没有更新的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7920" target="_blank" title="https://github.com/nocobase/nocobase/pull/7920" ref="nofollow noopener noreferrer">#7920</a>) by @heziqiang</li>
<li><strong>[模板打印]</strong> 修复详情区块模板打印按钮报错问题 by @katherinehhh</li>
</ul>
<h3 data-id="heading-29"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv2.0.0-alpha.44" target="_blank" title="https://www.nocobase.com/cn/blog/v2.0.0-alpha.44" ref="nofollow noopener noreferrer">v2.0.0-alpha.44</a></h3>
<p><em>发布时间：2025-11-21</em></p>
<h3 data-id="heading-30">🎉 新特性</h3>
<ul>
<li>
<p><strong>[client]</strong></p>
<ul>
<li>为关系字段下拉选择器增加快捷新增能力 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7887" target="_blank" title="https://github.com/nocobase/nocobase/pull/7887" ref="nofollow noopener noreferrer">#7887</a>) by @katherinehhh</li>
<li>支持树表关系字段使用级联选择器 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7846" target="_blank" title="https://github.com/nocobase/nocobase/pull/7846" ref="nofollow noopener noreferrer">#7846</a>) by @katherinehhh</li>
</ul>
</li>
<li>
<p><strong>[遥测]</strong> 新增插件：遥测，基于 OpenTelemetry 的应用遥测插件，内置 CPU、内存、HTTP 请求等指标，并支持通过 HTTP 导出 by @2013xile</p>
</li>
</ul>
<h3 data-id="heading-31">🚀 优化</h3>
<ul>
<li><strong>[telemetry]</strong> 支持控制需要上报的指标 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7938" target="_blank" title="https://github.com/nocobase/nocobase/pull/7938" ref="nofollow noopener noreferrer">#7938</a>) by @2013xile</li>
<li><strong>[异步任务管理器]</strong> 在子应用中执行异步任务时，异步进程只启动对应的子应用 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7927" target="_blank" title="https://github.com/nocobase/nocobase/pull/7927" ref="nofollow noopener noreferrer">#7927</a>) by @2013xile</li>
</ul>
<h3 data-id="heading-32">🐛 修复</h3>
<ul>
<li>
<p><strong>[client]</strong></p>
<ul>
<li>修复树表按钮显示在非树表区块中的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7931" target="_blank" title="https://github.com/nocobase/nocobase/pull/7931" ref="nofollow noopener noreferrer">#7931</a>) by @katherinehhh</li>
<li>修复外部数据源配置 belongsTo 字段时，field interface 显示为 many to one 而非 one to one 的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7936" target="_blank" title="https://github.com/nocobase/nocobase/pull/7936" ref="nofollow noopener noreferrer">#7936</a>) by @cgyrock</li>
</ul>
</li>
<li>
<p><strong>[flow-engine]</strong> 修复详情区块按钮的工具栏图标显示错位的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7929" target="_blank" title="https://github.com/nocobase/nocobase/pull/7929" ref="nofollow noopener noreferrer">#7929</a>) by @zhangzhonghe</p>
</li>
<li>
<p><strong>[工作流]</strong> 修复了更新待办数量时意外导致填写中的表单状态被重置的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7937" target="_blank" title="https://github.com/nocobase/nocobase/pull/7937" ref="nofollow noopener noreferrer">#7937</a>) by @mytharcher</p>
</li>
<li>
<p><strong>[数据表字段：多对多 (数组)]</strong> 修复多对多（数组）字段在新增/修改关联数据时的异常行为 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7926" target="_blank" title="https://github.com/nocobase/nocobase/pull/7926" ref="nofollow noopener noreferrer">#7926</a>) by @cgyrock</p>
</li>
<li>
<p><strong>[操作：导入记录 Pro]</strong> 修复导入 Pro 操作允许上传时修改导入选项不生效的问题 by @katherinehhh</p>
</li>
</ul>
<h3 data-id="heading-33"><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fv2.0.0-alpha.43" target="_blank" title="https://www.nocobase.com/cn/blog/v2.0.0-alpha.43" ref="nofollow noopener noreferrer">v2.0.0-alpha.43</a></h3>
<p><em>发布时间：2025-11-20</em></p>
<h3 data-id="heading-34">🚀 优化</h3>
<ul>
<li><strong>[数据可视化]</strong> 为插件界面添加了俄语支持。 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7676" target="_blank" title="https://github.com/nocobase/nocobase/pull/7676" ref="nofollow noopener noreferrer">#7676</a>) by @sembaev-a-a</li>
<li><strong>[权限控制]</strong> 缩小 member 角色的默认权限 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7921" target="_blank" title="https://github.com/nocobase/nocobase/pull/7921" ref="nofollow noopener noreferrer">#7921</a>) by @2013xile</li>
<li><strong>[工作流：Webhook 触发器]</strong> 为响应节点增加图标 by @mytharcher</li>
</ul>
<h3 data-id="heading-35">🐛 修复</h3>
<ul>
<li><strong>[client]</strong> 修复错误： Can't resolve 'antd-mobile' 和 Can't resolve 'antd-mobile-icons' (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7914" target="_blank" title="https://github.com/nocobase/nocobase/pull/7914" ref="nofollow noopener noreferrer">#7914</a>) by @zhangzhonghe</li>
<li><strong>[flow-engine]</strong> 修复打开表格区块的快捷编辑表单报错的问题。 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7923" target="_blank" title="https://github.com/nocobase/nocobase/pull/7923" ref="nofollow noopener noreferrer">#7923</a>) by @gchust</li>
<li><strong>[前端流引擎]</strong> 修复记录变量解析问题：当同时使用记录本身和其字段时，始终返回完整记录。 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7917" target="_blank" title="https://github.com/nocobase/nocobase/pull/7917" ref="nofollow noopener noreferrer">#7917</a>) by @gchust</li>
<li><strong>[数据源：主数据库]</strong> 修复增加一对多字段后在重启应用前无法选择外键字段的问题 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7907" target="_blank" title="https://github.com/nocobase/nocobase/pull/7907" ref="nofollow noopener noreferrer">#7907</a>) by @cgyrock</li>
<li><strong>[权限控制]</strong> 关系字段关联操作支持数据范围限制 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase%2Fpull%2F7919" target="_blank" title="https://github.com/nocobase/nocobase/pull/7919" ref="nofollow noopener noreferrer">#7919</a>) by @2013xile</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis实战：5个高频应用场景下的性能优化技巧，让你的QPS提升50%]]></title>    <link>https://juejin.cn/post/7576936862632607744</link>    <guid>https://juejin.cn/post/7576936862632607744</guid>    <pubDate>2025-11-27T04:16:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576936862632607744" data-draft-id="7576928310788571188" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis实战：5个高频应用场景下的性能优化技巧，让你的QPS提升50%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-27T04:16:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis实战：5个高频应用场景下的性能优化技巧，让你的QPS提升50%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T04:16:41.000Z" title="Thu Nov 27 2025 04:16:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Redis实战：5个高频应用场景下的性能优化技巧，让你的QPS提升50%</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>Redis作为高性能的内存数据库，在现代分布式系统中扮演着至关重要的角色。无论是缓存加速、会话管理还是实时排行榜，Redis都能显著提升系统性能。然而，随着业务规模的增长和流量峰值的出现，如何充分挖掘Redis的潜力成为开发者面临的关键挑战。</p>
<p>本文将深入分析Redis在五种典型应用场景中的性能瓶颈，并提供经过生产验证的优化技巧。这些方法不仅来自官方文档的最佳实践，更结合了笔者在大型互联网公司处理高并发场景的一线经验。通过合理配置和针对性优化，你的Redis实例QPS（Queries Per Second）有望提升50%甚至更高。</p>
<h2 data-id="heading-2">一、热点数据缓存优化</h2>
<h3 data-id="heading-3">1.1 问题诊断</h3>
<p>热点Key问题是缓存场景中最常见的性能杀手。当某个Key的访问量远超其他Key时（如电商秒杀商品），会导致：</p>
<ul>
<li>单个Redis实例CPU飙高</li>
<li>集群模式下数据倾斜</li>
<li>网络带宽成为瓶颈</li>
</ul>
<h3 data-id="heading-4">1.2 优化方案</h3>
<p><strong>多级缓存架构：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 伪代码示例：本地缓存+Redis两级缓存</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getData</span><span class="hljs-params">(String key)</span> {
    <span class="hljs-comment">// 1.检查本地缓存</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> localCache.get(key);
    <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> value;
    
    <span class="hljs-comment">// 2.检查Redis缓存</span>
    value = redis.get(key);
    <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
        localCache.put(key, value); <span class="hljs-comment">// 回填本地缓存</span>
        <span class="hljs-keyword">return</span> value;
    }
    
    <span class="hljs-comment">// 3.回源数据库...</span>
}
</code></pre>
<p><strong>Key拆分技术：</strong></p>
<ul>
<li>将大Value拆分为多个子Key（如<code>product:123 -&gt; product:123:base + product:123:detail</code>）</li>
<li>使用Hash分片存储（HSET product:123_detail field1 value1 field2 value2）</li>
</ul>
<p><strong>实战技巧：</strong></p>
<ol>
<li>Redis监控发现热点Key（使用<code>redis-cli --hotkeys</code>）</li>
<li>LRU策略调整为volatile-lru避免全量淘汰</li>
<li>Pipeline批量获取拆分后的子Key</li>
</ol>
<h2 data-id="heading-5">二、分布式锁的性能陷阱与突破</h2>
<h3 data-id="heading-6">2.1 Redlock的代价</h3>
<p>传统Redlock算法需要与半数以上节点通信，在高并发下：</p>
<ul>
<li>TPS从10万+骤降到不足1万</li>
<li>GC压力剧增导致STW问题</li>
</ul>
<h3 data-id="heading-7">2.2 CAS乐观锁方案</h3>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- Lua脚本保证原子性</span>
<span class="hljs-keyword">local</span> current = redis.call(<span class="hljs-string">'GET'</span>, KEYS[<span class="hljs-number">1</span>])
<span class="hljs-keyword">if</span> current == ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> redis.call(<span class="hljs-string">'SET'</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">2</span>])
<span class="hljs-keyword">end</span>
<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
</code></pre>
<h3 data-id="heading-8">2.3 Lease机制优化版锁</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">acquire_lock_with_lease</span>(<span class="hljs-params">conn, lockname, lease_time=<span class="hljs-number">10</span></span>):
    identifier = <span class="hljs-built_in">str</span>(uuid.uuid4())
    end = time.time() + lease_time
    
    <span class="hljs-keyword">while</span> time.time() &lt; end:
        <span class="hljs-keyword">if</span> conn.setnx(lockname, identifier): 
            conn.expire(lockname, lease_time)
            <span class="hljs-keyword">return</span> identifier
        
        <span class="hljs-comment"># Lease续期逻辑省略...</span>
        
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<p><strong>关键改进点：</strong></p>
<ul>
<li>Lease时间从固定值改为动态计算（根据历史执行时间P99值）</li>
<li>Watch Dog异步续约避免客户端阻塞</li>
</ul>
<h2 data-id="heading-9">三、排行榜场景的极致优化</h2>
<h3 data-id="heading-10">3.1 ZSET的内存消耗分析</h3>
<p>存储100万成员的排行榜：</p>
<ul>
<li>Redis原生ZSET约消耗64MB内存（每个entry平均64字节）</li>
<li>Score使用double类型存在精度浪费</li>
</ul>
<h3 data-id="heading-11">3.2 Compact Storage模式设计</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"># <span class="hljs-keyword">Key</span>设计改造前：
<span class="hljs-symbol">user:</span>score -&gt; ZSET {userid1:score1, userid2:score2,...}

# <span class="hljs-keyword">Key</span>设计改造后：
<span class="hljs-symbol">user:</span>vscore -&gt; <span class="hljs-type">STRING</span> (紧凑二进制存储)
<span class="hljs-symbol">user:</span>rank -&gt; ZSET {userid1:vscore_offset,...}
</code></pre>
<p><strong>效果对比：</strong></p>




















<table><thead><tr><th>Metric</th><th>Before</th><th>After</th></tr></thead><tbody><tr><td>Memory</td><td>~64MB</td><td>~24MB</td></tr><tr><td>ZADD QPS</td><td>~12k</td><td>~35k</td></tr></tbody></table>
<p>##四、消息队列的场景化调优</p>
<p>###4.1 List vs Stream的选择矩阵</p>















<table><thead><tr><th/><th>List</th><th>Stream</th></tr></thead><tbody><tr><td>消费确认</td><td>不支持</td><td>支持</td></tr></tbody></table>
<blockquote>
<p>注意表格对齐方式可能需要调整显示效果</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[双非同学校招笔记——离开字节入职小📕]]></title>    <link>https://juejin.cn/post/7576914798057127988</link>    <guid>https://juejin.cn/post/7576914798057127988</guid>    <pubDate>2025-11-27T04:19:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576914798057127988" data-draft-id="7575412016404496394" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="双非同学校招笔记——离开字节入职小📕"/> <meta itemprop="keywords" content="前端,程序员,面试"/> <meta itemprop="datePublished" content="2025-11-27T04:19:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="July_lly"/> <meta itemprop="url" content="https://juejin.cn/user/2975757420726467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            双非同学校招笔记——离开字节入职小📕
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2975757420726467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    July_lly
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T04:19:13.000Z" title="Thu Nov 27 2025 04:19:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body ::selection{color:#fff;background-color:#ed7373}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:.6em;margin-top:1.5em;padding-bottom:4px;color:#ed7373}.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px}.markdown-body h4{font-size:16px}.markdown-body h5,.markdown-body h6{font-size:14px}.markdown-body p{line-height:inherit;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border-top:1px solid #dfe1e6;margin:33px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:rgba(239,198,221,.2666666667);color:#7b164f;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==") 10px 10px no-repeat;background-size:40px;background-color:#fdf8f8}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#fdf8f8}.markdown-body a{position:relative;text-decoration:underline;text-decoration-color:#ffd4d4;color:#ed7373;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAD1lJREFUeF7tnV122zgShQHJG5gT9/OkV2J7JR3voI/U707eI5/eQeyVRFlJa56nc2YDFjkHEulWHP3g5xZYAK5eku6QYOFWfSwUAJLW8EcFqMBJBSy1oQJU4LQCBITRQQXOKEBAGB5UgIAwBqhAnALMIHG68axGFCAgjTia3YxTgIDE6cazGlGAgDTiaHYzTgECEqcbz2pEAQLSiKPZzTgFCEicbjyrEQUISCOOZjfjFCAgcbrxrEYUICCNOJrdjFOAgMTpxrMaUYCANOJodjNOAQISpxvPakQBAtKIo9nNOAUISJxuPKsRBQhII45GdfN/v//+/l9//rlBtae9HQKi3UOZ7ft7sfhgjfm3sfa9u3RvzHtrjPv77r8PfpvemB0o1v3Z95tuNvt29fKyqQkgApI5ADVebgeFtTfGmA8I+3pj1rbv17Ouey4dFgKCiIgC2/i+WDwYax0QbzMDtDcjLC67/PL58xraeIbGCEgGkTVd4vty+QWVKUL75WCZb7f3JWUVAhLq5UKPHzLGRyXmP822208lgEJAlESMlBlDfeGyhsafelAIiMawAdjkpmO38/kXa8wtoDnRJvq+v79+fHwSvUhk4wQkUjjNp/33jz9uZ33/VbONP9nW9x/fPT5+0mYzAdHmkUR7lNUaob1RN+QiIKEuVHz838vl1xKGVOck1DbTRUAUB7yvaSXVG5592sy22zsNs1wExNNjWg+rEI5XqWfb7a9TQ0JAtEa+h101wzF0f/JMQkA8AlHjIQ3AMco+KSQERGP0X7CpITj2Skw4BUxACgOkOThG/0wECQEpCJBm4Rh81Fl7l3tHMAEpBJCJ4Hjq+/7bvOt229THGSVny8vV1W6b/Kzrbnprb088VAVXN/fMFgGBuxDfYE443L4oB0TM9OqwxcVtjJR7xiTzUIuA4OMZ2mI2OICBN+wgfpACJWcWISDQcMY2lgMOt7XjerW6w1q+b03sqUUgzJf6TUAuKTTRv+eAI8f0qdSwK1cWISATAXDusjngyDkj5PrTzedu+z2uNsmURQiIMkBqg2OUVwKSHFmEgCgCpFY4xCDJkEUIiBJAaodjlBlZuEtOMIz2EhAFgLQCxxtIIG9YkR5mEZCJAWkNjldIlsu/EEW79AsfCMiEgLQKx8EaCSKLPL1bre6l3EhApJS90G7LcKCziOQwi4BMAAjh+GGlPTmLSK7pEJDMgBCOfwRHvb9Lsg4hIBkBIRw/i/0dUawLrocQkEyAEI7jQoPeNi9WqBOQDIAQjtMig16uTUAyxLHIJQjHeVkRdYjkijoziAgW+0YJx2VxEYAYYzbvVqtfL18t/AgCEq6Z1xmEw0um3U2km8/dqnrS791qJRLLIo0m9bSCkwmHvxNBgDCD+Es+7ZGEI0x/DrHC9Cr6aMIR7j7ELBaL9HDds59BOOIkB33wh9O8cfLnOYtwxOsM+egPV9LjHSB9JuFIU/j7ctmntSD7cmvOYiV6B3IHPGOD5E7VxK4nnw4q0A03Kya7QqYBwpGmK6j+MFJrIK53zCCRPgZtsjt59Zozh+s0aP3DNSW2BkJAIuFATE2eu3TtcLi+w24wggU6AYkABDVuPnXpFuAAZg8jrReHWAGQIB177LLSzg7oqtih4Dcsig6vmEECw0CyKG8BDic3VEPh4RUBCQAENePSaubY1R2LxYOxNvklDa8aEpCACBY+FLKgdcTGZjLHYvHBWuu+PoX6iQ+vmEE8XQW/8w3XJRyeDjhymOTi4OHlWKRf8JFUYU444uGQXvsgIAG+kcgesXAM6y83/fAhGtv36242+5b708i+8kmtF+XKHhxiTZA9YuDwCLSn2Xb7KebLtL7BHnqch82hTY7HZ6k9xotxiHXGTejsEQXHcvnVGnPrEU2b2XZ7pwESQTjEFwbf6kxAzgGCeOvf2H7ElGQMoDmHH8ekk4RD8snBU2FAQE4oAy7Og594S7p+BIweGeriIZJw5CzMWaRfdDV0UStqzByTPX7oVt9/nHXdc64hV41wsEjPMLyKqTucWZAtGZkyiTAc2esOZpBMs1cpY2bIW89dP4UhkYZj6pqKNcgRWFBb2lO+fAQDxBiTYse5e4k0HMaY4NrNY/QcdAgBOSJX8vjf3biNWV+vVndB3jg4GPZA0b5N+BSwNByp+sXqzmleD+UQgMTWHqN5AgEIg0TAtrdemTxzjAYxgxzLIMul23X6wYOlU4dEzVy9bQw5zNq1DahHpOGYuuZgBvGI+uQZJEAgOjOHWsjB+t7DbK9DUgIQkVnPGZmadb0ECDyIGeR4Bkl6mRnS0WhIYsf2LcLhQoOACACCfk8T+Dnu4BetJa3qe9yxkTcUj8sFHUJAjgPiPugSO6yB1B9vzUJCEppFBLPHprP2Xut2fWaQE/eSxOJYBJDR1ETbXnscUosk12THdVYPBwE5AUhiQIgCAswk3tO+As/ji2oUNIa6cDCHWOBp3tDhS4wzUZD4ZhEkIDn0idH01DkEBAyIaw5dpB9zHqgu8FqQgw3rEncXIAPft60qAXF32JRt3qnBJ7X36a1TUwPX926O2Pbiey3fwM11XBWADGsFv5n9o6m72SfnkJ2Iff98/fj4FCJo6mpxrmnLVJCdJj4wp+pRKhxVFOmeBXXwSw2S7s6glXQfqJPs3N0/+nufG0jCdbyGcT59neKYYjNIxKfPvGdtnCM8wTvpM587M8LhgOGPVwDHTAz4wofQQaqNIgGJgGOvX8CdPXVYEXKtFOcm2+k5zHI2hmx7yTXMTNHO59ziAEne9uAJCeChqaCM5eOsY8cA7PSqQw6vPWSt13rvjV1PnbXPmlfHQ7QuChBEMIQUjAnj7uCMFeI09GxW7N1+54+uuxkmRf4z77p1yuxhigZS5xYDCAKOUUTfdQrELFGOoVZqvRQLiFRQamq3CECQcPhObY5OSs4iATNFsYGRamMNxXSsdpfOUw8IGg4nSMgdE5JFhCEhIJfCPP7fVQOCmKE5Ik3wRrnUABxtkLpTJ9vnOXERH2blnqkWECE4ot42gsoiodnLN6wAmwm91kJ87anpOJWAABa/Tvso8m6ZfJf+xyLo9G/ytPduCqr/+O7x8VNNgY3qizpAROEwJnh4NQodskh20TnAgITUaEB7Lva9sANUAZI6XXlB++Q7N3KohdqKgrApZNKisPhONlcNIMJwBM1cnVMVEZDIWgShGwrW5GhU2IAKQBBOPqct+g4JqUcAwxpI/ZHpAS+Fse9l0qSARG869Ora/iA0HK7NmJ2tP5kMAASUzaLrsgA3FHvopICUljkOvZwKCQJcRCYL2ZtWbJQnGD4ZICXDMeo93MHdO3yD36Hlux/slG8hs1ec4r2IziSAgIYGJzuHuDtfVG44IGr6FzG8An1gNKdWvppqOi47ILA73wkVp3B4ICTJY37gDSbZFk3BLGFLVkBQsy6nhJgCjtEWn5oEMd6HagjIZBJBqanNbIBAHXtEwSnhODRn2EP2MPy/sTaBPWWHrN20aKYJiLe2ZANEcguJVkenvp/rrbOQcEz13XHNMByzLQsgktlDKxzoQADWHXvTOLzyclEWQMB3vteOtQKHxNZ/bi/x4kP+AzpS2YNw+Dn46FHMHt7iiWcQiexBOLz9e+xATu0GyCcKiMSaB+EI8O6xQ5k9ggQUBQSxV+iwN4QjyLfMHslyCX7EE157NHLnkyjIxziRemkEIA7VNiGWQcDTkk28VEAUjgI/XqOBGjFAgMV5E0WlJBxcFIxHTQQQ5PCqhbpDGo7ZdntX2ztz40M+7EwRQICzV9VnD2E4RJ6oDAuxso8WAQRVf9S+2isNB4vydDhlAFku+3TT4t9hBbi2eBPScBhjmpjYkHaUXkAqntaVhgPx3Il04JXSPhwQVIFe6/CKcJSCxt5OrYBUWZwTjrLgEAEEMYNV4xCBcJQHhwggoECoqsAEaXIywmq8oWjBCT7EgkzxVlSgEw4toR5nBwGJ083rLMLhJZPqg/CALJdfjDHubYPxvwoyCOGId7+mM+GAgAKj6BoEpAFrDgWkqASk5KKTcCiIaqAJcEBanuYlHMDIVNIUHJBWV9IJh5KIBpsBB8TZB/gssSlpJyrhAEelouakAPkr5psZb3QpolAnHIqiWcAUEUBQj9tq37BIOAQiUlmTMoAsFh+stW49JO2neD2EcKS5tpSzRQBBzGSNAmrMIoSjlPBOt1MEkKFQR9Qh6t5CTjjSg66kFiQBSd9yMiqpZKhFOEoKbYytYoAgh1muq1MPtQgHJuBKa0UMEOgwa6/qZqr3OxGO0sIaZ68sIIvFg7H2I87c/JBAnm85I0DJ+86AflXblCggAlkkayZBreec8j7hUMvFq2HygOCzyM54ya0obj/Zdj7/Yo25lXIh4ZBSFtuuOCBCWWQPiTHr+XZ7j3zvrHS9Mdp9vVrdYV3J1iQUyAOIUBY5EORptt1+SgFlAMN933z8trmE3juoCYeItCKNZgFEMoscquKCz/b9etZ1zz6wDFDcmP1QShQMZg6R+BVvNBsgw7qIWzwUD8RBtU1vzMb93Q5/DkH63u5tyGXH63CQmUM8nuEXyAbILovID7XgAiEa5LAKoeI0bWQFpEVICMc0gY26anZActUjKIFS2iEcKerpOHcSQIbn1r/mrgNySk44cqotd61JAHHdqRkSwiEXsLlbngwQ19EJZrbE9SUc4hJnvcCkgFQHiZLnVrJGUOUXmxyQUV/pjYHSfmzhc9XSGmpsXw0gBU8Bbzpr73/5/Hmt0cG0KU0BVYAcQOLeDp91pTtGRtYbMaqVdY46QMa6xPb9g+R282Q3sd5IlrCEBlQCMgqndJariDc+lhB8JdioGpDXAn7/IjrxregXHJa8pb6EgKCNPypQBCATg0IwGqamKEB+GHp13U1v7a3Q1vWnvu+/XT8+PjUcG+z6/lGJ8n+uVhmK+nHmK2QGzD0zsnZAzLtu7fOgVfmKsQe+ClQByLHOur1eL1dXO1Bs170C089mm6uXl92DVITBN0zaPa5aQNp1KXuOVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFTg//8JNVC78ovQAAAAAElFTkSuQmCC");background-size:100%}.markdown-body a:active,.markdown-body a:hover{opacity:.66}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #ed7373;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#ed7373}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#fdf2f2}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #ed7373;background-color:#fdf2f2}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ed7373}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{appearance:none;-webkit-appearance:none;-moz-appearance:none;outline:none;width:16px;height:16px;border-radius:2px;background-color:transparent;box-shadow:inset 0 0 0 1px rgba(28,31,35,.3490196078);vertical-align:middle;margin:0;transform:translateY(-2px)}.markdown-body input[type=checkbox]:checked{background-color:#ed7373;background-image:url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGFyaWEtaGlkZGVuPSJ0cnVlIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3LjQxMSA3LjMwOGExLjUgMS41IDAgMDEuMjggMi4xMDNsLTYuNSA4LjVhMS41IDEuNSAwIDAxLTIuMzc1LjAxbC0zLjUtNC41YTEuNSAxLjUgMCAxMTIuMzY4LTEuODQybDIuMzA2IDIuOTY1IDUuMzE4LTYuOTU1YTEuNSAxLjUgMCAwMTIuMTAzLS4yOHoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=");box-shadow:inset 0 0 0 1px #ed7373}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>本文纯属个人碎碎念，想到哪写到哪，不喜勿喷，也请不要上升到“公司员工文笔水平”这种维度。</p>
<h2 data-id="heading-0">一些概括</h2>
<p>接触前端也两年了。还记得 23 年初跟着 B 站黑马的课程学 HTML、CSS，从 <code>&lt;div /&gt;</code>、<code>&lt;span /&gt;</code> 这些最基础的标签开始，一点点摸索，再到后来接触 JavaScript、Vue、React。</p>
<p>学习的过程中，也在网上加入了不少学习群，认识了许多同路人、前辈和朋友。</p>
<p>当时写下这篇  👉 <a href="https://juejin.cn/post/7469428180028080140" target="_blank" title="https://juejin.cn/post/7469428180028080140">《快手 ks 前端实习小记》</a><br/>
还是我在快手的 last day。转眼 9 个多月过去，现在我又来到小红书，只能说——人生无常，大肠包小肠。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42cf71d283424fedbed655187898e30d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseV9sbHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764821953&amp;x-signature=3O2OeIbn0qxlY%2BNpis2%2FC6Kf%2BSY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">关于秋招</h2>
<p>其实秋招我没投很多公司，一方面是在字节实习，另一方面很多公司也确实不太想去。当然，说实话，也没有几家公司来约我面试😄。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8856622c1fd04e0999a5e052b09fff0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseV9sbHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764821953&amp;x-signature=DTpy8vB6CQnBbXnpIGTwECzkdXE%3D" alt="cdf952d901750c159e868b437ba05b73.jpg" loading="lazy"/></p>
<p>我在字节待过两个部门：直播和生服。<br/>
在直播待了半年，但因为 HC 的原因，连答辩流程都没推进。后来转去杭州的生服，两个月提前答辩通过了，但因为薪资和业务方向原因，最后还是没有过去，选择离职。</p>
<p>离职后，TT 直播连续给我发了 5 次面试邀请。虽然我说明了拒绝原因，但 HR 和老板还是希望我再面一下。于是 3 天推进了 3 轮。<br/>
记得 3 面老板问我最后的一个问题：</p>
<blockquote>
<p>“为什么你都过了，还离职拒了？”</p>
</blockquote>
<p>我如实说是薪资原因（但是没说业务原因）。老板说他下播后会跟另外两个面试官聊聊。<br/>
第二天我就收到了感谢信。</p>
<h2 data-id="heading-2">聊聊面试</h2>
<p>关于面试，我真的想说一句：<br/>
<strong>双非同学完全没必要太自卑。</strong></p>
<p>在字节、快手、小红书，我遇到的双非同事真的很多。能见到面试官这一关，学历的劣势基本就过去了；<br/>
真正会被卡掉的学历问题，大多都发生在简历筛选阶段。如果两个人技术能力差不多，HR 是会优先看学历的，这是现实；但只要你已经走到技术面了，那就只比实力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eeb0fa6efdf6430c8639ea14c0f8ea3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseV9sbHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764821953&amp;x-signature=X3OPxGUm74CJf%2BVLXalX0WQBJm8%3D" alt="4fa9faa2d8e2b8e2dcb48281c7832d98.jpg" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71eab806b4164361ad371d65ee62ecc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseV9sbHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764821953&amp;x-signature=f258OOZgxB56Pjoe4J17I36CVwQ%3D" alt="b5c9478e559be882920d45b168f25f44.jpg" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ede8c64cfa74aa19d269064023914a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseV9sbHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764821953&amp;x-signature=XnMalw8AdsSOd1yDldIvmdyMWIA%3D" alt="328f52e70e24a6e4da6297dacc6e328f.jpg" loading="lazy"/></p>
<h2 data-id="heading-3">结尾</h2>
<p>“红黄蓝”三家公司进进出出，一年多了。虽然我还是大四学生，但更多时候已经把自己当成一个刚踏入职场一年的年轻人。</p>
<p>以前在掘金看到那些感慨文，说不上不理解，但也没太有共鸣。那时候我以为掘金应该是讨论技术的地方。但现在逐渐理解了：工作占据了我们绝大多数时间，程序员要终身学习，而学习往往发生在为数不多的休息时间里，投入和产出常常不成正比，还伴随着所谓“中年危机”，于是，大家自然就会有更多感慨。</p>
<p>我也慢慢明白了（特别是在直播没转正、秋招又不算顺利的那段时间）：</p>
<p><strong>生活没有那么多必须烦恼的事。</strong><br/>
把工作做好，不要过度焦虑未来。<br/>
把握当下——<strong>在自己的能力范围内做自己真正想做的事</strong>。<br/>
不要因为浪费了时间、花了点钱而懊恼。</p>
<p>我们应该感受生活，而不是被生活推着走。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude回复太啰嗦？用Subagent打造你的专属AI团队]]></title>    <link>https://juejin.cn/post/7576994308272947219</link>    <guid>https://juejin.cn/post/7576994308272947219</guid>    <pubDate>2025-11-27T04:32:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576994308272947219" data-draft-id="7576861477267161107" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude回复太啰嗦？用Subagent打造你的专属AI团队"/> <meta itemprop="keywords" content="Claude,AI编程"/> <meta itemprop="datePublished" content="2025-11-27T04:32:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术探索家"/> <meta itemprop="url" content="https://juejin.cn/user/2735240657517816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude回复太啰嗦？用Subagent打造你的专属AI团队
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2735240657517816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术探索家
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T04:32:09.000Z" title="Thu Nov 27 2025 04:32:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca45628126054c75933e569fc4140e92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5o6i57Si5a62:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764823094&amp;x-signature=QN%2F3Nb8Wd3HdG7rHpiVeqkukSVA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>深夜两点，我盯着屏幕，看着Claude又一次给出了3000行的回复。我只是想让它帮我查一下代码里有没有安全隐患，结果它连重构建议、性能优化、测试用例全给我写了一遍。</p>
<p>说实话，当时我就想——能不能让它只关注代码审查，别扯那么多有的没的？</p>
<p>后来我发现，Subagent就是专门解决这个问题的。</p>
<h2 data-id="heading-0">Subagent到底是什么</h2>
<p>简单说，Subagent就是你给Claude定制的专属助手。每个助手有自己的任务范围、工具权限，甚至用的模型都可以不一样。</p>
<p>它们住在你项目的<code>.claude/agents/</code>目录里，每个文件就是一个助手。文件结构挺简单：上面是YAML配置，下面是Markdown写的详细提示词。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">code-reviewer</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">专门审查代码质量和安全隐患的助手</span>
<span class="hljs-attr">tools:</span> [<span class="hljs-string">Read</span>, <span class="hljs-string">Grep</span>, <span class="hljs-string">Glob</span>]
<span class="hljs-attr">model:</span> <span class="hljs-string">haiku</span>
<span class="hljs-meta">---
</span>
<span class="hljs-string">你是一个代码审查专家，专注于发现以下问题：</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">安全漏洞（SQL注入、XSS等）</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">性能瓶颈</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">代码规范问题</span>

<span class="hljs-string">你只需要指出问题，不要动手改代码。</span>
</code></pre>
<p>和普通的Claude对话比起来，Subagent有三个明显的不同：</p>
<p><strong>专注</strong>——它只干你规定的事，不会跑题。你让它审查代码，它就只审查，不会顺手帮你重构。</p>
<p><strong>受限</strong>——工具权限是你给的，它不能用你没授权的工具。一个只读的审查助手，根本没办法改你的文件。</p>
<p><strong>可复用</strong>——配置文件放在项目里，团队成员都能用。新人入职，直接<code>@code-reviewer</code>就能开始干活。</p>
<h2 data-id="heading-1">为什么需要Subagent</h2>
<p>老实说，我一开始觉得这东西是多此一举——直接跟Claude聊不就完了吗？</p>
<p>但用了一段时间之后，我发现确实香。</p>
<h3 data-id="heading-2">专注性</h3>
<p>Claude本身太全能了，你问它代码问题，它可能会顺便给你讲最佳实践、推荐框架、甚至帮你写文档。这些东西有时候有用，但大部分时候只是噪音。</p>
<p>Subagent能让它专注在单一任务上。一个专门做代码审查的助手，不会给你写重构方案；一个专门写测试的助手，不会质疑你的架构设计。</p>
<h3 data-id="heading-3">成本优化</h3>
<p>这个可能很多人没意识到——不是每个任务都需要用最贵的模型。</p>
<p>搜索、格式转换、简单的分析，用Haiku就够了，成本大概是Sonnet的三分之一。一个团队一个月下来，省的钱挺可观的。</p>
<h3 data-id="heading-4">并行处理</h3>
<p>这才是我觉得最爽的地方。</p>
<p>你可以同时启动多个任务，让它们并行跑。比如写完一个功能之后，同时让一个助手跑单元测试、一个做代码审查、一个写文档。实际体验下来，效率提升非常明显。</p>
<h3 data-id="heading-5">可复用性</h3>
<p>写好的配置文件，直接提交到Git仓库，团队成员都能用。项目积累下来的经验，变成了可执行的配置。</p>
<h2 data-id="heading-6">YAML配置详解</h2>
<p>说了这么多，具体怎么写配置文件呢？</p>
<p>一个完整的Subagent配置有几个字段，但只有两个是必须的：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">blog-writer</span>          <span class="hljs-comment"># 必需：助手的唯一标识</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">撰写博客初稿的专家</span>  <span class="hljs-comment"># 必需：简短描述，影响自动触发</span>
<span class="hljs-attr">tools:</span> [<span class="hljs-string">Read</span>, <span class="hljs-string">Write</span>, <span class="hljs-string">Grep</span>]  <span class="hljs-comment"># 可选：工具权限，默认是全部</span>
<span class="hljs-attr">model:</span> <span class="hljs-string">sonnet</span>              <span class="hljs-comment"># 可选：模型选择，默认继承主对话</span>
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># 提示词写在YAML下面</span>
<span class="hljs-string">你是一个专业的博客写作者...</span>
</code></pre>
<p><strong>name</strong>——助手的ID，用于调用时识别。最好起个能一眼看懂的名字，比如<code>code-reviewer</code>、<code>test-writer</code>。</p>
<p><strong>description</strong>——这个很关键。Claude会根据描述来判断什么时候自动触发这个助手。如果你写"处理各种任务的通用助手"，那它基本永远不会被自动触发。</p>
<p>不好的写法：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">一个帮手</span>
</code></pre>
<p>好的写法：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">深度调研博客主题，生成结构化内容规划文档</span>
</code></pre>
<p><strong>tools</strong>——工具权限列表。没配置的话默认能用所有工具，但这其实不太好（后面会讲）。</p>
<p><strong>model</strong>——选择用哪个模型。<code>haiku</code>便宜快速，<code>sonnet</code>是默认的平衡选择，<code>opus</code>质量最高但最贵。</p>
<h2 data-id="heading-7">工具权限控制</h2>
<p>这一块我踩过坑，值得单独说说。</p>
<p>刚开始我图省事，所有Subagent都用默认的全权限。结果有一次，一个本来只应该做代码分析的助手，顺手帮我改了几个文件——改错了。</p>
<p>从那以后，我就开始认真对待工具权限了。原则挺简单：<strong>只给必需的权限，不多给</strong>。</p>
<p>常见的工具权限组合：</p>





























<table><thead><tr><th>任务类型</th><th>推荐工具组合</th></tr></thead><tbody><tr><td>只读分析</td><td><code>Read, Grep, Glob</code></td></tr><tr><td>搜索研究</td><td><code>Read, WebSearch, WebFetch</code></td></tr><tr><td>内容编辑</td><td><code>Read, Edit</code></td></tr><tr><td>内容创建</td><td><code>Read, Write, Edit</code></td></tr><tr><td>全权限</td><td><code>All tools</code>（谨慎使用）</td></tr></tbody></table>
<p>一个实际的对比：</p>
<p>不好的配置：给代码审查助手太多权限</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">code-reviewer</span>
<span class="hljs-attr">tools:</span> []  <span class="hljs-comment"># 空数组 = 全权限，这样不太安全</span>
<span class="hljs-meta">---
</span></code></pre>
<p>好的配置：只给只读权限</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">code-reviewer</span>
<span class="hljs-attr">tools:</span> [<span class="hljs-string">Read</span>, <span class="hljs-string">Grep</span>, <span class="hljs-string">Glob</span>]
<span class="hljs-meta">---
</span></code></pre>
<p>只读的审查助手，根本没办法误改你的代码。这种约束，反而是一种保护。</p>
<h2 data-id="heading-8">三种调用方式</h2>
<p>配置写好了，怎么调用呢？有三种方式：</p>
<h3 data-id="heading-9">自动触发</h3>
<p>如果你在description里写得够清楚，Claude会自动判断什么时候该调用。比如描述写"处理所有与代码审查相关的请求"，那你说"帮我审查一下这个PR"，它就会自动触发。</p>
<h3 data-id="heading-10">@-mention</h3>
<p>最直接的方式，直接<code>@agent-name</code>就行：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@code-reviewer</span> 帮我看看这个函数有没有问题
</code></pre>
<h3 data-id="heading-11">Task工具</h3>
<p>编程式调用，适合更复杂的场景：</p>
<pre><code class="hljs language-ini" lang="ini">Task(<span class="hljs-attr">subagent_type</span>=<span class="hljs-string">"code-reviewer"</span>, prompt=<span class="hljs-string">"审查src/目录下的所有文件"</span>)
</code></pre>





























<table><thead><tr><th>方式</th><th>语法</th><th>适用场景</th><th>特点</th></tr></thead><tbody><tr><td>自动触发</td><td>无需显式调用</td><td>明确关键词</td><td>方便但可能误触发</td></tr><tr><td>Task工具</td><td><code>Task(subagent_type="name")</code></td><td>编程式调用</td><td>精确控制</td></tr><tr><td>@-mention</td><td><code>@agent-name</code></td><td>交互式使用</td><td>直观但需要记名字</td></tr></tbody></table>
<p>我个人最常用@-mention，简单直接。自动触发有时候会误判，Task工具在复杂工作流里才用得上。</p>
<h2 data-id="heading-12">Multi-Agent协作</h2>
<p>说到这里，还只是单个助手的用法。Subagent真正强大的地方，是多个助手协作。</p>
<h3 data-id="heading-13">顺序模式</h3>
<p>我用得最多的是<strong>顺序模式</strong>，特别适合内容创作类的工作流：</p>
<pre><code class="hljs language-less" lang="less">用户输入主题
    |
<span class="hljs-variable">@blog-planner</span> 做调研、写大纲
    | 输出规划文档
<span class="hljs-variable">@blog-writer</span> 读取大纲、写初稿
    | 输出初稿
<span class="hljs-variable">@blog-editor</span> 读取初稿、润色发布
    | 输出最终稿
</code></pre>
<p>每个助手只负责一个环节，前一个的输出是后一个的输入。清晰、可控、容易调试。</p>
<h3 data-id="heading-14">并行模式</h3>
<p>并行模式就更爽了。写完一个功能之后，同时启动：</p>
<ul>
<li><code>@test-writer</code> 写单元测试</li>
<li><code>@code-reviewer</code> 做代码审查</li>
<li><code>@doc-writer</code> 写文档</li>
</ul>
<p>三个任务并行跑，互不干扰。原来要串行做30分钟的事，现在10分钟搞定。</p>
<h3 data-id="heading-15">HITL模式（Human In The Loop）</h3>
<p>还有一种模式，适合需要人工确认的场景：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@planner</span> 生成方案
    |
用户确认或修改
    |
<span class="hljs-variable">@executor</span> 执行方案
</code></pre>
<p>这种模式的好处是，关键决策点由人来把控，不会完全失控。</p>
<h2 data-id="heading-16">七个编写技巧</h2>
<p>用了几个月Subagent，我总结了7个让配置更好用的技巧：</p>
<h3 data-id="heading-17">技巧1：描述要精准</h3>
<p>description直接影响自动触发的准确性。</p>
<p>太模糊——几乎不会被自动触发：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">一个通用的助手</span>
</code></pre>
<p>精准描述——明确职责范围：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">专门审查Python代码的安全漏洞和性能问题</span>
</code></pre>
<h3 data-id="heading-18">技巧2：提示词要具体</h3>
<p>别只说"你是一个代码审查专家"，要告诉它具体怎么审查。</p>
<p>太笼统：</p>
<pre><code class="hljs language-markdown" lang="markdown">你是代码审查专家，帮用户审查代码。
</code></pre>
<p>具体指导：</p>
<pre><code class="hljs language-markdown" lang="markdown">你是Python代码安全审查专家。

<span class="hljs-section">## 审查重点</span>
<span class="hljs-bullet">1.</span> SQL注入风险 - 检查所有数据库操作
<span class="hljs-bullet">2.</span> XSS漏洞 - 检查用户输入的处理
<span class="hljs-bullet">3.</span> 敏感信息泄露 - 检查日志和错误处理

<span class="hljs-section">## 输出格式</span>
每个问题按以下格式报告：
<span class="hljs-bullet">-</span> 文件：xxx
<span class="hljs-bullet">-</span> 行号：xxx
<span class="hljs-bullet">-</span> 风险等级：高/中/低
<span class="hljs-bullet">-</span> 问题描述：xxx
<span class="hljs-bullet">-</span> 修复建议：xxx
</code></pre>
<h3 data-id="heading-19">技巧3：工具最小化</h3>
<p>前面说过了，只给必需的权限。少给权限不会让助手变笨，只是限制了它能做的事。</p>
<h3 data-id="heading-20">技巧4：模型选对</h3>
<p>简单任务用Haiku，复杂任务用Sonnet。具体来说：</p>
<ul>
<li><strong>Haiku适合</strong>：搜索汇总、格式转换、简单分析、数据整理</li>
<li><strong>Sonnet适合</strong>：复杂逻辑、创意内容、代码生成、推理分析</li>
</ul>
<h3 data-id="heading-21">技巧5：测试要充分</h3>
<p>写完配置之后，多试几种调用方式。自动触发好不好用？@-mention正不正常？边界情况怎么处理？</p>
<h3 data-id="heading-22">技巧6：文档要清晰</h3>
<p>提示词本身就是文档。写得清楚的话，团队成员一看就知道这个助手是干什么的、怎么用。</p>
<h3 data-id="heading-23">技巧7：迭代要频繁</h3>
<p>别想着一次就写完美。先写一个能用的版本，实际用一段时间，根据反馈慢慢调整。</p>
<h2 data-id="heading-24">常见错误避坑</h2>
<p>讲完技巧，再说说我踩过的坑：</p>
<h3 data-id="heading-25">坑1：描述太模糊</h3>
<p>写"通用助手"这种描述，Claude根本不知道什么时候该调用它。要写清楚具体负责什么。</p>
<p>不好：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">帮助用户的助手</span>
</code></pre>
<p>改进：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">当用户提到"测试"、"单元测试"时，自动生成测试用例</span>
</code></pre>
<h3 data-id="heading-26">坑2：工具权限过多</h3>
<p>图省事给全权限，结果助手做了你不希望它做的事。特别是Write权限，给之前要想清楚。</p>
<p>不好：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">format-converter</span>
<span class="hljs-attr">tools:</span> []  <span class="hljs-comment"># 空数组 = 全权限</span>
</code></pre>
<p>改进：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">format-converter</span>
<span class="hljs-attr">tools:</span> [<span class="hljs-string">Read</span>, <span class="hljs-string">Write</span>]
</code></pre>
<h3 data-id="heading-27">坑3：提示词太长</h3>
<p>Subagent的提示词也是算token的。写几千字的提示词，每次调用都要消耗这些token。保持简洁，只写必要的信息。</p>
<h3 data-id="heading-28">坑4：忘记设置model</h3>
<p>不设置model的话，默认会继承主对话的模型（通常是Sonnet）。简单任务白白多花钱。</p>
<p>忘了设置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">text-extractor</span>
<span class="hljs-attr">tools:</span> [<span class="hljs-string">Read</span>]
</code></pre>
<p>记得设置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">text-extractor</span>
<span class="hljs-attr">tools:</span> [<span class="hljs-string">Read</span>]
<span class="hljs-attr">model:</span> <span class="hljs-string">haiku</span>
</code></pre>
<h3 data-id="heading-29">坑5：循环调用</h3>
<p>Agent A调用Agent B，Agent B又调用Agent A。这种死循环会一直跑下去，直到超时或者你强制停止。</p>
<p>正确：A -&gt; B -&gt; C
错误：A -&gt; B -&gt; A</p>
<h3 data-id="heading-30">坑6：没有错误处理</h3>
<p>Subagent也会失败。在工作流里加上错误处理逻辑，失败了能及时发现。</p>
<h3 data-id="heading-31">坑7：配置没有版本控制</h3>
<p>配置文件要提交到Git。改了配置出了问题，能回滚到之前的版本。</p>
<h2 data-id="heading-32">实战案例：博客写作系统</h2>
<p>说了这么多理论，来看个实际的例子。</p>
<p>我自己在用的博客写作系统，由三个Subagent组成：</p>
<h3 data-id="heading-33">系统架构</h3>
<pre><code class="hljs language-ini" lang="ini">用户提供主题
    |
blog-planner: 调研+规划（20分钟）
    | 输出：docs/<span class="hljs-section">[主题]</span>-内容规划文档.md
blog-writer: 撰写初稿（40分钟）
    | 输出：docs/<span class="hljs-section">[主题]</span>-初稿.md
blog-editor: 润色优化（20分钟）
    | 输出：docs/<span class="hljs-section">[主题]</span>-最终稿.md
</code></pre>
<h3 data-id="heading-34">blog-planner（规划师）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">blog-planner</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">深度研究主题并创建内容规划文档</span>
<span class="hljs-attr">tools:</span> [<span class="hljs-string">Read</span>, <span class="hljs-string">Write</span>, <span class="hljs-string">Grep</span>, <span class="hljs-string">WebSearch</span>, <span class="hljs-string">WebFetch</span>]
<span class="hljs-attr">model:</span> <span class="hljs-string">sonnet</span>
<span class="hljs-meta">---
</span>
<span class="hljs-string">你是内容规划师，负责：</span>
<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">使用WebSearch研究主题的最新趋势</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">分析目标受众和痛点</span>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">设计文章结构和SEO策略</span>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">输出规划文档到docs/文件夹</span>
</code></pre>
<h3 data-id="heading-35">blog-writer（作者）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">blog-writer</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">根据规划文档撰写博客初稿</span>
<span class="hljs-attr">tools:</span> [<span class="hljs-string">Read</span>, <span class="hljs-string">Write</span>, <span class="hljs-string">Grep</span>]
<span class="hljs-attr">model:</span> <span class="hljs-string">sonnet</span>
<span class="hljs-meta">---
</span>
<span class="hljs-string">你是内容作者，负责：</span>
<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">读取规划文档</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">按照大纲撰写完整初稿</span>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">确保内容人性化、去AI味</span>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">输出初稿到docs/文件夹</span>
</code></pre>
<h3 data-id="heading-36">blog-editor（编辑）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">blog-editor</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">编辑初稿并优化人性化表达</span>
<span class="hljs-attr">tools:</span> [<span class="hljs-string">Read</span>, <span class="hljs-string">Edit</span>]
<span class="hljs-attr">model:</span> <span class="hljs-string">haiku</span>
<span class="hljs-meta">---
</span>
<span class="hljs-string">你是内容编辑，负责：</span>
<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">读取初稿</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">检查并消除AI味表达</span>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">增强人性化和可读性</span>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">输出最终稿到docs/文件夹</span>
</code></pre>
<p>工作流程很简单：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 第1步：规划</span>
@blog-planner Claude Code Subagent使用技巧

<span class="hljs-comment"># 第2步：撰写</span>
@blog-writer

<span class="hljs-comment"># 第3步：编辑</span>
@blog-editor
</code></pre>
<p>每个环节都有明确的输入输出，出问题了容易定位。</p>
<h2 data-id="heading-37">成本优化建议</h2>
<p>最后说说成本的事。</p>
<p>Haiku和Sonnet的价格差大概是3倍左右（具体价格请参考Anthropic官网）。一个典型的博客写作任务，如果合理分配模型，能省下不少钱。</p>
<h3 data-id="heading-38">模型选择策略</h3>
<p>我的建议是：</p>
<p><strong>用Haiku的场景</strong></p>
<ul>
<li>搜索和信息汇总</li>
<li>简单的格式转换</li>
<li>数据整理和分类</li>
<li>代码审查（只读分析）</li>
</ul>
<p><strong>用Sonnet的场景</strong></p>
<ul>
<li>内容创作（博客、文档）</li>
<li>复杂的代码生成</li>
<li>需要推理的分析任务</li>
<li>对质量要求高的场景</li>
</ul>
<h3 data-id="heading-39">模型对比参考</h3>

























<table><thead><tr><th>模型</th><th>特点</th><th>适合场景</th></tr></thead><tbody><tr><td>Haiku</td><td>快速、便宜</td><td>简单任务</td></tr><tr><td>Sonnet</td><td>平衡、默认选择</td><td>复杂任务</td></tr><tr><td>Opus</td><td>质量最高、最贵</td><td>极致质量</td></tr></tbody></table>
<p><strong>Opus</strong>我几乎不用，除非是特别重要、对质量要求极高的任务。日常工作Sonnet足够了。</p>
<h3 data-id="heading-40">省钱口诀</h3>
<p>记住这几条：</p>
<ul>
<li>能用Haiku就别用Sonnet</li>
<li>能限制工具就别给All tools</li>
<li>能精简提示词就别写太长</li>
<li>能限制输出就别让它随便发挥</li>
</ul>
<h2 data-id="heading-41">写在最后</h2>
<p>说白了，Subagent不是什么黑科技，就是把Claude的能力按需拆分。一个通才变成一个专家团队，每个专家只干自己擅长的事。</p>
<p>如果你还在用"一个Claude打天下"的方式，我真的建议试试Subagent。花半小时写几个配置，能省下无数个"Claude又跑题了"的时刻。</p>
<p>核心就是几个原则：</p>
<ol>
<li>一个agent只干一件事</li>
<li>只给必需的工具权限</li>
<li>简单任务用Haiku</li>
<li>提示词要具体清晰</li>
<li>多agent协作用文档传递</li>
</ol>
<p>遇到问题别慌，多半是配置没写对。对照着这篇文章的7个技巧和7个错误，基本都能解决。</p>
<p>最后说一句：<strong>别追求完美配置，先用起来，慢慢迭代</strong>。</p>
<p>祝你早日组建自己的AI团队！</p>
<blockquote>
<p>本文首发自<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.betterlink.top%2Fzh%2Fposts%2Fai%2F20251122-claude-subagent-guide%2F" target="_blank" title="https://blog.betterlink.top/zh/posts/ai/20251122-claude-subagent-guide/" ref="nofollow noopener noreferrer">个人博客</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年11月27日年解决隐私清单导致审核总是提示二进制无效的问题]]></title>    <link>https://juejin.cn/post/7576918517238251570</link>    <guid>https://juejin.cn/post/7576918517238251570</guid>    <pubDate>2025-11-27T04:45:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576918517238251570" data-draft-id="7576918517238186034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年11月27日年解决隐私清单导致审核总是提示二进制无效的问题"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2025-11-27T04:45:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90后晨仔"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年11月27日年解决隐私清单导致审核总是提示二进制无效的问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90后晨仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T04:45:24.000Z" title="Thu Nov 27 2025 04:45:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>最新新上架一个产品，但是由于有些三方库没有隐私清单的问题导致提交到苹果后台之后总是会提示<code>二进制无效</code>，这里<code>特别说明</code>一下，如果你的app已经是线上的话，貌似没啥问题。（只是问了几个朋友），但是如果你要是新的产品，1.0上线的话那么就会因为这个导致二进制无效无法提交。</p>
</blockquote>
<ul>
<li>
<h4 data-id="heading-0">提交时后苹果那边给发的邮件内容，有好几个库的警告这里就拿"AFNetworking"举例说明下解决方案。下边是警告：</h4>
</li>
</ul>
<blockquote>
<p>Please correct the following issues and upload a new binary to App Store Connect.
ITMS-91061: Missing privacy manifest - Your app includes “Frameworks/AFNetworking.framework/AFNetworking”, which includes AFNetworking, an SDK that was identified in the documentation as a commonly used third-party SDK. If a new app includes a commonly used third-party SDK, or an app update adds a new commonly used third-party SDK, the SDK must include a privacy manifest file. Please contact the provider of the SDK that includes this file to get an updated SDK version with a privacy manifest. For more details about this policy, including a list of SDKs that are required to include signatures and manifests, visit:</p>
</blockquote>
<ul>
<li>
<h4 data-id="heading-1">解决方案的思路是自己在打包的时候让<code>Trae</code>帮我写了一个脚本然后给指定的库进行了添加。当然网上也有好多其他的解决方案，自己都尝试过了并没有起作用。脚本内容如下：</h4>
</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">set</span> -euo pipefail
FRAMEWORKS_DIR=<span class="hljs-string">"<span class="hljs-variable">${TARGET_BUILD_DIR}</span>/<span class="hljs-variable">${FRAMEWORKS_FOLDER_PATH}</span>"</span>
<span class="hljs-comment"># 生成标准的 XML plist 隐私清单（不跟踪、不收集、不使用“需要理由”的 API）</span>
<span class="hljs-function"><span class="hljs-title">write_manifest_basic</span></span>() {
  dst=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
  <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">"<span class="hljs-subst">$(dirname <span class="hljs-string">"<span class="hljs-variable">$dst</span>"</span>)</span>"</span>
  <span class="hljs-built_in">cat</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$dst</span>"</span> &lt;&lt;<span class="hljs-string">'PLIST'</span>
&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;
&lt;!DOCTYPE plist PUBLIC <span class="hljs-string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="hljs-string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;
&lt;plist version=<span class="hljs-string">"1.0"</span>&gt;
&lt;dict&gt;
  &lt;key&gt;NSPrivacyTracking&lt;/key&gt;
  &lt;<span class="hljs-literal">false</span>/&gt;
  &lt;key&gt;NSPrivacyCollectedDataTypes&lt;/key&gt;
  &lt;array/&gt;
  &lt;key&gt;NSPrivacyTrackingDomains&lt;/key&gt;
  &lt;array/&gt;
  &lt;key&gt;NSPrivacyAccessedAPITypes&lt;/key&gt;
  &lt;array/&gt;
&lt;/dict&gt;
&lt;/plist&gt;

PLIST

}


<span class="hljs-comment"># 给指定 framework 注入隐私清单（若已有则不覆盖）</span>

<span class="hljs-function"><span class="hljs-title">inject_manifest_basic</span></span>() {

  fwdir=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

  dst=<span class="hljs-string">"<span class="hljs-variable">${fwdir}</span>/PrivacyInfo.xcprivacy"</span>

  <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"<span class="hljs-variable">$dst</span>"</span> ]; <span class="hljs-keyword">then</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Already present: <span class="hljs-subst">$(basename <span class="hljs-string">"<span class="hljs-variable">$fwdir</span>"</span>)</span>/PrivacyInfo.xcprivacy"</span>

  <span class="hljs-keyword">else</span>

    write_manifest_basic <span class="hljs-string">"<span class="hljs-variable">$dst</span>"</span>

    /usr/bin/plutil -lint <span class="hljs-string">"<span class="hljs-variable">$dst</span>"</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Injected PrivacyInfo.xcprivacy into <span class="hljs-subst">$(basename <span class="hljs-string">"<span class="hljs-variable">$fwdir</span>"</span>)</span>"</span>

  <span class="hljs-keyword">fi</span>

}


<span class="hljs-comment"># 注入后重新签名，避免签名失效</span>

<span class="hljs-function"><span class="hljs-title">resign_framework</span></span>() {

  fwdir=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${CODE_SIGNING_ALLOWED:-YES}</span>"</span> = <span class="hljs-string">"YES"</span> ] &amp;&amp; [ -n <span class="hljs-string">"<span class="hljs-variable">${EXPANDED_CODE_SIGN_IDENTITY:-}</span>"</span> ]; <span class="hljs-keyword">then</span>

    /usr/bin/codesign --force --sign <span class="hljs-string">"<span class="hljs-variable">${EXPANDED_CODE_SIGN_IDENTITY}</span>"</span> --timestamp=none <span class="hljs-string">"<span class="hljs-variable">$fwdir</span>"</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Resigned <span class="hljs-subst">$(basename <span class="hljs-string">"<span class="hljs-variable">$fwdir</span>"</span>)</span>"</span>

  <span class="hljs-keyword">else</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Skip resign: CODE_SIGNING_ALLOWED=<span class="hljs-variable">${CODE_SIGNING_ALLOWED:-}</span> EXPANDED_CODE_SIGN_IDENTITY=<span class="hljs-variable">${EXPANDED_CODE_SIGN_IDENTITY:-}</span>"</span>

  <span class="hljs-keyword">fi</span>

}

  


<span class="hljs-function"><span class="hljs-title">process_framework</span></span>() {

  name=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

  fw=<span class="hljs-string">"<span class="hljs-variable">${FRAMEWORKS_DIR}</span>/<span class="hljs-variable">${name}</span>"</span>

  <span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$fw</span>"</span> ]; <span class="hljs-keyword">then</span>

    inject_manifest_basic <span class="hljs-string">"<span class="hljs-variable">$fw</span>"</span>

    resign_framework <span class="hljs-string">"<span class="hljs-variable">$fw</span>"</span>

  <span class="hljs-keyword">else</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Skip <span class="hljs-variable">${name}</span>: not found at <span class="hljs-variable">${fw}</span>"</span>

  <span class="hljs-keyword">fi</span>

}

process_framework <span class="hljs-string">"AFNetworking.framework"</span>

</code></pre>
<ul>
<li>
<h4 data-id="heading-2">具体的配置位置如下：</h4>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14b90ac67b4c4ef881cde32d77007767~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgOTDlkI7mmajku5Q=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764823544&amp;x-signature=z4kB%2FrsDPrIZfh1RyYsZ8PPGllA%3D" alt="Snip20251127_1.png" loading="lazy"/></p>
<ul>
<li>
<h4 data-id="heading-3">完成上边的配置之后重新打包上传就可以了，如果不放心的小伙伴可以在打包完成之后，导出.ipa的包，然后找到<code>Frameworks</code>这个文件夹，然后在它的下边可以找到<code>AFNetworking.framework</code>的文件夹然后你会看到如下图所示的文件，那么证明你添加成功了。</h4>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4b177f0609a48cbbb3b2cf2c0f342c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgOTDlkI7mmajku5Q=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764823544&amp;x-signature=IKlBvrt%2FxijvVe7nffBQh78ARRk%3D" alt="Snip20251127_2.png" loading="lazy"/></p>
<ul>
<li>
<h4 data-id="heading-4">有了上边的文件之后你再次提交审核就不会出现<code>AFNetworking</code>这个库没有隐私清单的警告了。</h4>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RuoYi-Cloud 完全解剖：TRAE AI 绘制的架构蓝图]]></title>    <link>https://juejin.cn/post/7577201863721418752</link>    <guid>https://juejin.cn/post/7577201863721418752</guid>    <pubDate>2025-11-27T01:31:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577201863721418752" data-draft-id="7576859594360635392" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RuoYi-Cloud 完全解剖：TRAE AI 绘制的架构蓝图"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-27T01:31:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天天摸鱼的java工程师"/> <meta itemprop="url" content="https://juejin.cn/user/3109843365802925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RuoYi-Cloud 完全解剖：TRAE AI 绘制的架构蓝图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3109843365802925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天天摸鱼的java工程师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T01:31:52.000Z" title="Thu Nov 27 2025 01:31:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.  RuoYi-Cloud 完全解剖：TRAE AI 绘制的架构蓝图</h2>
<hr/>
<blockquote>
<p>🧑‍💻 作者：天天摸鱼的java工程师<br/>
🏁 项目：RuoYi-Cloud 微服务框架分析文档自动生成<br/>
🛠 关键词：TRAE、AI助手、项目文档生成、架构可视化、微服务分析\</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">🧭 先看最终结果：个人觉得还是很不错的</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db72381b08d14a3aa1786055a6361687~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp5aSp5pG46bG855qEamF2YeW3peeoi-W4iA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764811912&amp;x-signature=R6WJBODDM7u0LquKJLX98YxrV2E%3D" alt="deepseek_mermaid_20251125_3d1b66.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-2">🧭 写在前面：项目越大，文档越重要，AI 能帮上忙吗？</h3>
<p>作为一个做了 8 年 Java 的“老兵”，我已经习惯了打开一个项目先 <code>cd</code> 到 <code>backend/</code>，然后从 <code>pom.xml</code> 一路摸到 <code>controller</code>，靠经验猜结构、靠直觉找入口。</p>
<p>但随着项目越来越大、团队越来越多人，靠“经验摸索”这套体系已经越来越吃力。<strong>项目文档的缺失、架构图的不全、模块关系不清楚</strong>，成为了我们 onboarding（接手项目）时最大的障碍。</p>
<p>这次借 TRAE SOLO 技术大奖赛的机会，我尝试用 TRAE AI 工具链，<strong>自动生成一个中大型微服务项目（RuoYi-Cloud）</strong> 的：</p>
<ul>
<li>🧾 项目介绍文档</li>
<li>🧱 架构组件关系图</li>
<li>🧩 模块结构说明</li>
<li>🔐 权限配置与路由设计分析</li>
</ul>
<p>最终，我用 AI 成功完成了对 RuoYi-Cloud 的完整文档和架构图生成，效果远超预期。</p>
<hr/>
<h3 data-id="heading-3">🔍 目标项目：RuoYi-Cloud 微服务权限系统</h3>
<p>如果你做过 Spring Cloud 项目，你大概率听过 RuoYi-Cloud，这是一个非常成熟的开源微服务权限平台，采用 Spring Cloud Alibaba 技术栈，具备完整的：</p>
<ul>
<li>用户权限管理</li>
<li>菜单路由系统</li>
<li>微服务注册与配置</li>
<li>Docker 一键部署能力</li>
</ul>
<p>但它文档不是很全，模块又多，<strong>一上来就有十几个服务 + 前端代码</strong>，新人接手很容易懵。</p>
<hr/>
<h3 data-id="heading-4">🧠 我的分析策略：交给 AI 来“啃”项目</h3>
<p>这次我没有再手动去翻每一层代码，而是尝试用 TRAE 的 AI 智能分析能力，来“自动完成”以下任务：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38ecdf5c3dff4aa59b0826ead222bf3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp5aSp5pG46bG855qEamF2YeW3peeoi-W4iA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764811912&amp;x-signature=pzhQm530DoHzNHLrzbuXgaghuYc%3D" alt="image.png" loading="lazy"/></p>
<p>如图所示，TRAE 为我生成了一套清晰的任务清单：</p>
<ol>
<li>查看 <code>README.md</code>，了解项目介绍</li>
<li>分析项目结构，理清模块关系</li>
<li>生成详细介绍文档</li>
<li>创建项目架构结构图</li>
<li>分析核心配置文件</li>
<li>查看业务代码实现</li>
<li>查看前端结构和权限逻辑</li>
</ol>
<hr/>
<h3 data-id="heading-5">✨ 最终成果：文档 + 架构图 + 模块说明，一应俱全</h3>
<p>经过一轮分析，TRAE 自动为我生成了以下内容：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce1ff3a458c945a1beeb62399d06b22a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp5aSp5pG46bG855qEamF2YeW3peeoi-W4iA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764811912&amp;x-signature=DBbmIHfxf9i8pCtpFB412pqnKPE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">✅ 一份完整的项目介绍文档：</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f635e5053d7146ecac7d72b873ab8689~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp5aSp5pG46bG855qEamF2YeW3peeoi-W4iA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764811912&amp;x-signature=LNqavDUMF8HbWdQNeVsgF%2Be3%2Bxo%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>项目概述与核心功能</li>
<li>后端技术栈 + 前端技术栈</li>
<li>系统架构与模块划分</li>
<li>用户管理、菜单权限、认证授权逻辑</li>
<li>Docker 环境部署说明</li>
</ul>
<p>文件名：<code>project_documentation.md</code></p>
<h4 data-id="heading-7">✅ 一张可视化的系统架构图</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9842e1b5a92e4c1f88c7c3b8611f46b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp5aSp5pG46bG855qEamF2YeW3peeoi-W4iA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764811912&amp;x-signature=RoB54BcByQy4c9v7shBbiHXfSxw%3D" alt="deepseek_mermaid_20251125_b587a6.png" loading="lazy"/></p>
<ul>
<li>微服务模块依赖关系</li>
<li>核心功能模块分布图</li>
<li>前后端调用流程图</li>
<li>权限认证流程图</li>
</ul>
<p>文件名：<code>system_architecture.md</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4350142b67143c38d30930b3f0ac8a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp5aSp5pG46bG855qEamF2YeW3peeoi-W4iA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764811912&amp;x-signature=O199sdtwthKkHymR3xtGgaotniM%3D" alt="deepseek_mermaid_20251125_1929da.png" loading="lazy"/>
你可以看到，在系统左侧我完整分析了 RuoYi-Cloud 的模块结构，在右侧的 TRAE 界面中，任务进度被自动追踪，并且每完成一个阶段，AI 都会自动生成内容并回填上下文。</p>
<hr/>
<h3 data-id="heading-8">🧩 项目结构分析亮点</h3>
<p>在文档中，AI 对模块做了非常细致的拆解：</p>
<h4 data-id="heading-9">🌐 微服务核心模块</h4>
<ul>
<li><code>ruoyi-auth</code>：认证中心</li>
<li><code>ruoyi-gateway</code>：网关路由服务</li>
<li><code>ruoyi-system</code>：核心业务模块（用户/角色/菜单）</li>
<li><code>ruoyi-job</code>：定时任务服务</li>
<li><code>ruoyi-gen</code>：代码生成模块</li>
</ul>
<h4 data-id="heading-10">🧱 公共依赖模块</h4>
<ul>
<li><code>ruoyi-common-core</code>：基础工具类</li>
<li><code>ruoyi-common-security</code>：权限相关封装</li>
<li><code>ruoyi-common-redis</code>：Redis 封装</li>
</ul>
<h4 data-id="heading-11">📊 前端结构分析</h4>
<ul>
<li>Vue 2.6 + Element UI</li>
<li>Vuex 状态管理</li>
<li>Axios 请求封装</li>
<li>权限逻辑基于路由守卫（<code>permission.js</code>）</li>
</ul>
<hr/>
<h3 data-id="heading-12">🧾 文档内容摘录</h3>
<p>生成的 <code>project_documentation.md</code> 中内容非常完整。以下是部分文档结构：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 1. 项目概述</span>
RuoYi-Cloud 是一套基于 Spring Cloud Alibaba 的微服务架构权限管理系统...

<span class="hljs-section">## 2. 技术栈</span>
<span class="hljs-bullet">-</span> 后端：Spring Boot、Nacos、Sentinel、MyBatis-Plus、Redis、MySQL
<span class="hljs-bullet">-</span> 前端：Vue 2.x、Element UI、Axios、Vuex

<span class="hljs-section">## 3. 系统架构</span>
<span class="hljs-bullet">-</span> ruoyi-auth：认证中心
<span class="hljs-bullet">-</span> ruoyi-system：核心业务
<span class="hljs-bullet">-</span> ruoyi-gateway：API 网关

<span class="hljs-section">## 4. 核心功能模块</span>
<span class="hljs-section">### 用户管理</span>
<span class="hljs-bullet">-</span> GET /user/list：分页查询用户
<span class="hljs-bullet">-</span> PUT /user/resetPwd：重置密码

<span class="hljs-section">### 菜单管理</span>
<span class="hljs-bullet">-</span> GET /menu/treeselect：获取菜单树
<span class="hljs-bullet">-</span> GET /menu/getRouters：生成前端路由
</code></pre>
<hr/>
<h3 data-id="heading-13">🧠 我的收获：AI 不只是“写代码”，更是“帮你理解系统”</h3>
<p>很多人对 AI 的认知还停留在“让它写个工具类”“让它生成个接口”，但我这次最大的感受是：</p>
<blockquote>
<p><strong>AI 可以成为我们理解系统结构、梳理架构、生成文档的得力助手。</strong></p>
</blockquote>
<p>它不是“替代你写文档”，而是让你“有能力写得更快、写得更全、写得更专业”。</p>
<hr/>
<h3 data-id="heading-14">🧩 适用场景：不仅是 RuoYi，也适用于你们的项目</h3>
<p>如果你团队也有以下情况：</p>
<ul>
<li>接手一个别人留下的老项目</li>
<li>想补文档但没人愿意写</li>
<li>想梳理架构但没人搞得清楚</li>
<li>跨部门协作时沟通成本高</li>
</ul>
<p>那么我强烈推荐你试试 TRAE 的文档生成能力。尤其是对 Java 微服务架构项目，它的理解能力已经非常成熟。</p>
<hr/>
<h3 data-id="heading-15">🚀 总结：未来的开发者，不只是写代码的人</h3>
<p>这次我用 TRAE AI 成功完成了对一个企业级微服务项目的结构分析、文档生成和架构图绘制，真正做到了“<strong>一键了解项目全貌</strong>”。</p>
<p>我也更加坚信：未来的开发者，不只是写代码的人，更是能驾驭工具、理解系统、讲清楚架构的人。</p>
<hr/>
<p>🧠 工具：TRAE AI助手 + Mermaid 架构图生成 + Markdown 文档生成器</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用简单 JSON + 自定义 t 函数实现轻量多语言国际化（无需 next-intl）]]></title>    <link>https://juejin.cn/post/7576918517237809202</link>    <guid>https://juejin.cn/post/7576918517237809202</guid>    <pubDate>2025-11-27T03:11:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576918517237809202" data-draft-id="7577189654471901210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用简单 JSON + 自定义 t 函数实现轻量多语言国际化（无需 next-intl）"/> <meta itemprop="keywords" content="前端,JavaScript,Trae"/> <meta itemprop="datePublished" content="2025-11-27T03:11:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用简单 JSON + 自定义 t 函数实现轻量多语言国际化（无需 next-intl）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T03:11:55.000Z" title="Thu Nov 27 2025 03:11:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Next.js 开发国际化（i18n）项目时，许多人会直接安装 next-intl、react-intl、i18next 这样的重量级库。
但对于一些结构简单、只需要基础文本翻译的网站来说，使用这些库反而会带来额外的复杂性。</p>
</blockquote>
<p>如果你只想让项目支持：</p>
<p>✔ 标题多语言
✔ 按钮多语言
✔ 文案多语言
✔ 扩展灵活、无需复杂配置</p>
<p>那么你完全可以自己写一个 <strong>超轻量 i18n 方案</strong>。</p>
<p>今天我们来介绍一个非常简单、方便扩展、可在任何环境使用的多语言实现方式：
<strong>基于 JSON 语言包 + t() 翻译函数。</strong></p>
<hr/>
<h2 data-id="heading-0">目录结构：简单、清晰、可扩展</h2>
<p>首先在项目中新建 <code>i18n</code> 文件夹：</p>
<pre><code class="hljs language-bash" lang="bash">/i18n
  ├─ en.json
  ├─ de.json
  ├─ fr.json
</code></pre>
<p>内容例如：</p>
<h3 data-id="heading-1">en.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hotTags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Hot Tags"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"hotArticles"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Hot Articles"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"latestNews"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Latest News"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-2">de.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hotTags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Beliebte Tags"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"hotArticles"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Beliebte Artikel"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"latestNews"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Neueste Nachrichten"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">fr.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hotTags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Tags Populaires"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"hotArticles"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Articles Populaires"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"latestNews"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Dernières Nouvelles"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">自定义 t() 翻译函数</h2>
<p>这一小段代码就是整个多语言系统的核心：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> en <span class="hljs-keyword">from</span> <span class="hljs-string">"@/i18n/en.json"</span>;
<span class="hljs-keyword">import</span> de <span class="hljs-keyword">from</span> <span class="hljs-string">"@/i18n/de.json"</span>;
<span class="hljs-keyword">import</span> fr <span class="hljs-keyword">from</span> <span class="hljs-string">"@/i18n/fr.json"</span>;

<span class="hljs-keyword">const</span> locales = { en, de, fr };

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">t</span>(<span class="hljs-params">locale: <span class="hljs-built_in">string</span>, key: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">const</span> dict =
    (locales <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;&gt;)[locale] || locales[<span class="hljs-string">"en"</span>];

  <span class="hljs-keyword">return</span> dict[key] ?? key;
}
</code></pre>
<h3 data-id="heading-5">工作原理</h3>
<ol>
<li>根据传入的 locale（<code>en</code> / <code>de</code> / <code>fr</code>）选择对应字典</li>
<li>如果找不到语言，自动使用英文作为 fallback</li>
<li>如果 key 不存在，原样返回 key（方便调试）</li>
</ol>
<h3 data-id="heading-6">类型安全（解决 TS 报错）</h3>
<p>上面代码使用了：</p>
<pre><code class="hljs language-ts" lang="ts">(locales <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;&gt;)
</code></pre>
<p>让 TypeScript 明确知道字典是：</p>
<ul>
<li>key: 语言代码</li>
<li>value: 文本映射表（键值对）</li>
</ul>
<p>这样就不会出现：</p>
<blockquote>
<p>「元素隐式具有 any 类型」</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">在页面中使用</h2>
<p>示例：
你在首页 HomePage 中传入 locale：</p>
<pre><code class="hljs language-tsx" lang="tsx">&lt;h2 className=<span class="hljs-string">"text-2xl font-bold"</span>&gt;
  {<span class="hljs-title function_">t</span>(locale, <span class="hljs-string">"hotTags"</span>)}
&lt;/h2&gt;
</code></pre>
<p>渲染效果将根据语言不同自动变化：</p>
<ul>
<li>English → Hot Tags</li>
<li>Deutsch → Beliebte Tags</li>
<li>Français → Tags Populaires</li>
</ul>
<p>无需额外库，无需复杂配置。</p>
<hr/>
<h2 data-id="heading-8">优点总结</h2>





























<table><thead><tr><th>特点</th><th>说明</th></tr></thead><tbody><tr><td>极轻量</td><td>无需安装任何 i18n 库</td></tr><tr><td>纯 JSON 文件</td><td>非技术人员也能直接编辑</td></tr><tr><td>完全可控</td><td>不会被第三方库的 API 或复杂行为束缚</td></tr><tr><td>易扩展</td><td>想加语言？加个 JSON 文件即可</td></tr><tr><td>易维护</td><td>键值结构简单不容易出错</td></tr></tbody></table>
<p>适合用在：</p>
<ul>
<li>企业官网</li>
<li>展示性网站</li>
<li>CMS 文章网站（如 Strapi + Next.js）</li>
<li>SEO 友好的多语言站点</li>
<li>需要快速上线 MVP 的项目</li>
</ul>
<hr/>
<h2 data-id="heading-9">还能进一步增强！</h2>
<p>要是你想扩展成更强的国际化系统，你还可以加入：</p>
<h3 data-id="heading-10">✔ 支持嵌套 key（如 <code>home.title</code>）</h3>
<h3 data-id="heading-11">✔ 支持变量插值（如 <code>Hello {{name}}</code>）</h3>
<h3 data-id="heading-12">✔ 自动检测浏览器语言</h3>
<h3 data-id="heading-13">✔ 服务端自动注入 locale（Next.js App Router）</h3>
<p>我可以进一步为你升级成 <strong>完整简易版 i18n 框架</strong>。</p>
<hr/>
<h2 data-id="heading-14">最后</h2>
<p>这种方式简单却非常实用，特别适合
已经有后端（例如 Strapi） + 前端 Next.js 结构的多语言站点。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[知识库（Knowledge Base）与知识图谱（Knowledge Graph）到底该怎么选？]]></title>    <link>https://juejin.cn/post/7576923573778399274</link>    <guid>https://juejin.cn/post/7576923573778399274</guid>    <pubDate>2025-11-27T03:21:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576923573778399274" data-draft-id="7576923573778202666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="知识库（Knowledge Base）与知识图谱（Knowledge Graph）到底该怎么选？"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-27T03:21:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="奇舞精选"/> <meta itemprop="url" content="https://juejin.cn/user/4388906147515367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            知识库（Knowledge Base）与知识图谱（Knowledge Graph）到底该怎么选？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906147515367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    奇舞精选
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T03:21:02.000Z" title="Thu Nov 27 2025 03:21:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>摘要</strong>：在大模型幻觉频发的今天，RAG 架构成为救命稻草。但面对“知识库”与“知识图谱”两大技术路线，开发者该如何抉择？本文深度解析两者的定义、区别与融合趋势，助你构建更聪明的 AI 系统。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fd4bda76d9149f8b29c9dfb8820d379~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818461&amp;x-signature=UYtBwzlAibO9jYPpfKIaw26u8bM%3D" alt="封面图示例" loading="lazy"/></p>
<hr/>
<p>在大语言模型（LLM）重塑技术版图的今天，“幻觉（Hallucination）”问题依然是悬在企业级应用头顶的达摩克利斯之剑。为了解决这一问题，检索增强生成（RAG）架构应运而生，而 RAG 的核心在于“外部知识”的有效存储与检索。</p>
<p>在这个背景下，两个概念频繁出现在技术架构图中：<strong>知识库（Knowledge Base, KB）</strong> 和 <strong>知识图谱（Knowledge Graph, KG）</strong>。</p>
<p>很多开发者在选型时会感到困惑：它们究竟有何区别？是互斥的替代关系，还是互补的搭档？本文将从技术原理、应用场景及落地实践三个维度，为您深度拆解这两大知识管理支柱。</p>
<h2 data-id="heading-0">一、 核心概念拆解</h2>
<h3 data-id="heading-1">1. 知识库（Knowledge Base）：广义的知识容器</h3>
<p>在传统定义中，知识库是用于知识管理的信息集合。但在当今的 AI 语境下（特别是 RAG 架构中），当我们谈论“知识库”时，通常指的是<strong>基于向量检索（Vector Search）的非结构化数据存储</strong>。</p>
<ul>
<li><strong>核心逻辑</strong>：将文档（PDF、Wiki、Markdown）切分成片段（Chunks），通过 Embedding 模型转化为高维向量，存储在向量数据库中。</li>
<li><strong>检索方式</strong>：计算“语义相似度”。例如，用户问“苹果怎么卖？”，系统能匹配到“红富士价格优惠”的片段，因为它们在向量空间距离相近。</li>
<li><strong>特点</strong>：模糊匹配、构建速度快、适合处理海量非结构化文本。</li>
</ul>
<h3 data-id="heading-2">2. 知识图谱（Knowledge Graph）：万物互联的语义网络</h3>
<p>知识图谱本质上是一种<strong>基于图数据结构（Graph Data Structure）的知识表示方法</strong>。它由节点（Entities）和边（Relationships）组成，以“主-谓-宾”的三元组形式（如 <code>&lt;埃隆·马斯克, 是CEO, 特斯拉&gt;</code>）描述世界。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb173897465e475aa8e334dda94947e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818461&amp;x-signature=8cOnFnZPvZXrTFZEZXTf7QlH7T0%3D" alt="知识图谱示意图" loading="lazy"/></p>
<ul>
<li><strong>核心逻辑</strong>：通过信息抽取（Information Extraction）技术，从数据中提炼实体与关系，构建一张网状的拓扑结构。</li>
<li><strong>检索方式</strong>：图遍历（Graph Traversal）与子图匹配。例如，查询“马斯克管理的公司有哪些？”，系统会沿着“CEO”这条边找到所有关联节点。</li>
<li><strong>特点</strong>：精确匹配、具备推理能力、结构化程度高、适合处理复杂关系。</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、 深度对比：多维度的技术博弈</h2>
<p>为了更直观地理解两者的差异，我们从以下五个维度进行对比：</p>








































<table><thead><tr><th align="left">维度</th><th align="left">知识库 (Vector-based KB)</th><th align="left">知识图谱 (Knowledge Graph)</th></tr></thead><tbody><tr><td align="left"><strong>数据结构</strong></td><td align="left">高维向量空间（扁平化）</td><td align="left">节点与边的拓扑网络（结构化）</td></tr><tr><td align="left"><strong>构建成本</strong></td><td align="left"><strong>低</strong>：切片 + Embedding 即可</td><td align="left"><strong>高</strong>：需要 Schema 设计、实体识别、关系抽取</td></tr><tr><td align="left"><strong>查询逻辑</strong></td><td align="left">语义相似度（模糊匹配）</td><td align="left">逻辑查询与多跳遍历（精确匹配）</td></tr><tr><td align="left"><strong>推理能力</strong></td><td align="left">弱（依赖 LLM 上下文理解）</td><td align="left"><strong>强</strong>（具备传递性、归纳性推理能力）</td></tr><tr><td align="left"><strong>可解释性</strong></td><td align="left">黑盒（向量距离难以直观解释）</td><td align="left"><strong>白盒</strong>（路径清晰，可追溯）</td></tr><tr><td align="left"><strong>更新维护</strong></td><td align="left">简单（增删文档片段）</td><td align="left">复杂（需维护图结构的完整性与一致性）</td></tr></tbody></table>
<p><strong>一句话总结</strong>：知识库胜在<strong>广度与效率</strong>，知识图谱胜在<strong>精度与深度</strong>。</p>
<hr/>
<h2 data-id="heading-4">三、 典型应用场景</h2>
<h3 data-id="heading-5">1. 适合使用知识库（KB）的场景</h3>
<ul>
<li><strong>企业内部文档问答</strong>：员工查询 HR 政策、IT 操作手册。这类数据通常是非结构化的文本，语义搜索能快速定位相关段落。</li>
<li><strong>长文本辅助写作</strong>：寻找相关的历史文章或素材。</li>
<li><strong>初级智能客服</strong>：基于 FAQ 列表的快速响应。</li>
</ul>
<h3 data-id="heading-6">2. 适合使用知识图谱（KG）的场景</h3>
<ul>
<li><strong>金融风控与反欺诈</strong>：通过分析借款人之间的关联关系（如共同联系人、担保链），发现隐蔽的欺诈团伙。这是向量搜索无法做到的。</li>
<li><strong>供应链管理</strong>：分析零部件短缺对下游产品的级联影响（图的传导性）。</li>
<li><strong>精准推荐系统</strong>：不仅推荐商品，还能解释“为什么推荐”（因为你购买了 A，A 与 B 属于同系列）。</li>
<li><strong>复杂多跳问答（Multi-hop QA）</strong>：例如“马斯克第一任妻子的职业是什么？”这需要先找到妻子，再查找其职业，图谱的遍历能力在此具有压倒性优势。</li>
</ul>
<hr/>
<h2 data-id="heading-7">四、 技术实现概览</h2>
<h3 data-id="heading-8">1. 数据建模与存储</h3>
<ul>
<li>
<p><strong>KB 方案</strong>：</p>
<ul>
<li><strong>工具链</strong>：LangChain / LlamaIndex (数据处理), OpenAI / HuggingFace (Embedding)。</li>
<li><strong>存储</strong>：Pinecone, Milvus, Weaviate, 或 PostgreSQL (pgvector)。</li>
<li><strong>关键点</strong>：Chunking Strategy（切片策略）直接影响检索质量。</li>
</ul>
</li>
<li>
<p><strong>KG 方案</strong>：</p>
<ul>
<li><strong>工具链</strong>：DeepDive (抽取), SpaCy (NER)。</li>
<li><strong>存储</strong>：Neo4j (属性图), NebulaGraph (大规模分布式), JanusGraph。</li>
<li><strong>关键点</strong>：Ontology Design（本体设计），即定义数据世界的“骨架”。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-9">2. 融合趋势：GraphRAG</h3>
<p>单纯的向量检索存在“切片丢失上下文”的问题，而单纯的图谱构建成本过高。目前的业界趋势是 <strong>GraphRAG</strong>——将两者结合。<strong>微软研究院（Microsoft Research）在 2024 年发布的 GraphRAG 项目</strong>正是这一方向的里程碑式工作。</p>
<ul>
<li><strong>原理</strong>：利用 LLM 提取文本中的关键实体构建局部子图，存储在图数据库中；同时保留文本向量。</li>
<li><strong>优势</strong>：在回答“总结全书主旨”或“分析人物关系”这类宏观问题时，图谱能提供全局结构信息，弥补向量检索过于微观的缺陷。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58b4732e07794d069aecceb2b61e7a7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818461&amp;x-signature=WHhYuH8NBsp6hQ%2FpYrTJ%2FboFbZc%3D" alt="GraphRAG" loading="lazy"/>
（GraphRAG）</p>
<hr/>
<h2 data-id="heading-10">五、 实践建议与落地案例</h2>
<p>对于大多数初创团队或从 0 到 1 的项目，我的建议遵循 <strong>“先僵化，后优化”</strong> 的路径：</p>
<h3 data-id="heading-11">阶段一：快速冷启动（Vector KB）</h3>
<p><strong>场景</strong>：某电商搭建售后机器人。
<strong>做法</strong>：直接将产品手册、退换货政策 PDF 导入向量数据库。
<strong>收益</strong>：1-2 周即可上线，解决 80% 的常见语义匹配问题。</p>
<h3 data-id="heading-12">阶段二：精度调优（Hybrid Search）</h3>
<p><strong>场景</strong>：用户反馈搜不到特定型号参数。
<strong>做法</strong>：引入关键词搜索（BM25）与向量搜索结合，确保专有名词的精确匹配。</p>
<h3 data-id="heading-13">阶段三：引入图谱（Knowledge Graph）</h3>
<p><strong>场景</strong>：需要处理“兼容性”咨询，如“镜头 A 能不能装在相机 B 上？”。
<strong>做法</strong>：构建小规模图谱，定义 <code>&lt;镜头, 适配卡口, 卡口型号&gt;</code> 和 <code>&lt;相机, 适配卡口, 卡口型号&gt;</code> 的关系。
<strong>收益</strong>：利用图的逻辑推理能力，给出 100% 准确的兼容性回答，避免 LLM 胡编乱造。</p>
<hr/>
<h2 data-id="heading-14">结语</h2>
<p>知识库赋予了 AI <strong>“博学”</strong> 的底色，而知识图谱则注入了 <strong>“逻辑”</strong> 的灵魂。</p>
<p>在实际工程中，不要为了用图谱而用图谱。从业务痛点出发，以低成本的向量知识库起步，在需要处理复杂关联与严谨推理的深水区，再引入知识图谱这一重型武器。两者的有机结合，才是通往下一代认知智能的必经之路。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[又被 Cursor 烧了 1 万块，我麻了。。。]]></title>    <link>https://juejin.cn/post/7577189654472065050</link>    <guid>https://juejin.cn/post/7577189654472065050</guid>    <pubDate>2025-11-27T03:21:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577189654472065050" data-draft-id="7576929700841701385" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="又被 Cursor 烧了 1 万块，我麻了。。。"/> <meta itemprop="keywords" content="API,AI编程,Cursor"/> <meta itemprop="datePublished" content="2025-11-27T03:21:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员鱼皮"/> <meta itemprop="url" content="https://juejin.cn/user/2444938365386621"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            又被 Cursor 烧了 1 万块，我麻了。。。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2444938365386621/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员鱼皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T03:21:39.000Z" title="Thu Nov 27 2025 03:21:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是程序员鱼皮。这段时间国外的大模型真是火到不行，像新出的 Gemini 3.0 和 Claude Opus 4.5，天天最强、天天炸裂，搞的我已经有些麻了。。。</p>
<p>的确目前国外的大模型在编程能力上是领先的，但 <strong>不一定是最适合咱们的</strong>。</p>
<p>大多数同学用 AI 文本模型无非就 2 个目的嘛：</p>
<ul>
<li>自己用来写代码</li>
<li>对外提供 AI 应用</li>
</ul>
<p>先说说第一个场景，像我们团队虽然也在用 Cursor 去处理复杂任务，但是前段时间刚刚分享过账单，价格真是太贵了，才一个多月就花了 <strong>1 万多</strong>！我整个人都麻了。。。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e4f24a1af48405ba62c03f2eba97649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=MoQ5e%2BPYB5Cv9eHIvRraFClp3l0%3D" alt="" loading="lazy"/></p>
<p>除了费用贵之外，国外的大模型在很多任务的处理速度上是不如国内大模型的，很容易把简单的任务搞复杂，费时又费钱。之前国内的 GLM-4.6 发布的时候，我也专门 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F8Gr__biKvaiaJqAu-8k6Ag" target="_blank" title="https://mp.weixin.qq.com/s/8Gr__biKvaiaJqAu-8k6Ag" ref="nofollow noopener noreferrer">写文章做过对比</a>，让它和 Claude 一决高下，一起做个包含完整前后端代码的工具网站。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea523681ac5a42e58dcf2b73324c0537~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=IdySvjVzo9sz%2Fa8Yp23dMIPfgeA%3D" alt="null" loading="lazy"/></p>
<p>结果 GLM-4.6 不仅速度最快，而且功能实现最完整，理解了我的需求。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7ee66026a804411ae6ab308a164970c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=4f%2B6Fk%2Fsw6R2aC0Q1BkYaqSK1Bk%3D" alt="" loading="lazy"/></p>
<p>再说说第二个场景 —— 对外提供 AI 应用，也就是让自己的程序通过 API 接入 AI 大模型。</p>
<p>我们团队也做过很多 AI 应用，但是用的一直是国内大模型的 API！</p>
<p>原因很简单，不仅能够满足需求，而且 <strong>更快、更稳定、更便宜</strong>。所以国外大模型吹得再天花乱坠，我依然建议大家使用国内大模型的 API。</p>
<p>比如最近很火的 GLM-4.6 模型，在真实编程、长上下文处理、推理能力、信息搜索、写作能力与智能体应用等多个方面实现全面提升。他们新推出的 Coding Plan 套餐，更是能够以 Claude Code 1/7 的价格，享受 Claude Pro 套餐的 3 倍用量，同时能够在代码能力上对齐 Claude Sonnet 4。</p>
<p>之前我已经给大家分享过很多个人使用 AI 的技巧，今天这篇文章就主要分享大模型 API 的使用教程，我将以国内智谱最新旗舰的 GLM-4.6 模型为例，手把手带你学会 3 大使用 API 的场景。</p>
<h2 data-id="heading-0">一、API 接入开发工具</h2>
<p>下面以流行的 Cursor 和 Claude Code 为例，来演示如何将国内大模型 GLM-4.6 的 API 接入开发工具。</p>
<h3 data-id="heading-1">Cursor 接入 GLM</h3>
<p>首先打开 Cursor 的设置界面，进入模型设置，然后添加自定义模型，注意名称一定要是大写的 <code>GLM-4.6</code>！</p>
<p>添加模型后，需要覆盖 OpenAI 的 API Key 为你自己的、同时覆盖 OpenAI 的请求地址为 <code>https://open.bigmodel.cn/api/coding/paas/v4</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ffda27525d94678b25307557b7282d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=mPqIPl9kfNagZTHX4kAFWAwFgNY%3D" alt="" loading="lazy"/></p>
<p>可以在智谱 AI 开放平台获取到 API Key，注意不要泄露！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f24a4a6ab9a42818d29ec38093ea38c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=C1yLsmvxdMhKM%2FizyBJ%2FfUGhbuk%3D" alt="" loading="lazy"/></p>
<p>然后，就可以在对话界面选择 GLM-4.6 大模型，愉快使用了~</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c468c6423bf47c1bca02e004755702e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=igEa5xGskWRjmS45dhZCWxgdp7w%3D" alt="" loading="lazy"/></p>
<p>国内模型的输出速度很快，实测下来结果也比较靠谱。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f43a45494f242a88bf916de5d426c38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=MjaAz0rMrvBF6UPN5W84oqQnTrs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">Claude Code 接入 GLM</h3>
<p>给 Claude Code 接入 GLM 也很简单，1 分钟搞定。</p>
<p>首先一行命令安装 Claude Code：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @anthropic-ai/claude-code
</code></pre>
<p>然后执行 <code>claude</code> 命令打开程序，默认是需要登录 Claude 账号的，否则无法使用：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c651cbb4f12e4536a5b4eea477666f91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=i9aSiYPLyO5NGLhEVHHLcFJkRwk%3D" alt="" loading="lazy"/></p>
<p>不过没关系，让我们把它背后的 AI 大模型换成国内的。首先进入 <code>{用户目录}/.claude</code> 目录，创建一个 <code>settings.json</code> 配置文件：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f02f972202f648e291d4f20acfa730af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=5DmTsAFyNxRXJYLLDqRYy3zcHWw%3D" alt="" loading="lazy"/></p>
<p>然后修改配置文件中的内容如下，记得替换成你自己的 API Key：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/388e426792d747ad9cb69cf30c3d9a6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=B0pn0oqBmnOlmEU5Rc3LHzm8mnA%3D" alt="" loading="lazy"/></p>
<p>接下来就可以愉快地使用了~</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d22b890080b4640a52dde2383d26ae9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=YJKgvyHQIwWVSUJnYoHSzlX1O%2Fs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">二、API 接入新项目</h2>
<p>接下来让我们学习如何利用大模型 API 开发一个全新的 AI 应用。以 Java 项目为例，我们可以使用主流的 Spring AI 框架来开发 AI 应用。</p>
<p>首先利用 IDEA 创建一个 Spring Boot 项目，注意 JDK 版本最好选择 21：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad4f564e0fe7454e95f396e1f41c546c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=RPjX11c1WI1We8%2F1N0N0nvcYyus%3D" alt="" loading="lazy"/></p>
<p>然后选择 Spring Boot 3.x 的版本（暂时不要使用 4）以及需要的依赖。</p>
<p>Spring AI 已经兼容了智谱系列的大模型（包括 GLM-4.6），只需要勾选 <code>ZhipuAI</code> 依赖就好：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adf177e26d82468fa1c0ed6e937e2a7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=FMxdHonAYgWwfC3vaSadvaMQqfo%3D" alt="" loading="lazy"/></p>
<p>创建新项目完成后，我们可以参考 Spring AI 官方文档来修改 <code>application.yml</code> 配置文件，填写对接智谱 AI 所需的配置。</p>
<p>官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-ai%2Freference%2Fapi%2Fchat%2Fzhipuai-chat.html" target="_blank" title="https://docs.spring.io/spring-ai/reference/api/chat/zhipuai-chat.html" ref="nofollow noopener noreferrer">docs.spring.io/spring-ai/r…</a></p>
<p>比如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
<span class="hljs-attr">application:</span>
  <span class="hljs-string">name:</span> <span class="hljs-string">yupi-ai-project</span>
<span class="hljs-attr">ai:</span>
  <span class="hljs-attr">zhipuai:</span>
    <span class="hljs-string">api-key:</span> <span class="hljs-string">&lt;Your</span> <span class="hljs-string">API</span> <span class="hljs-string">Key&gt;</span>
    <span class="hljs-attr">chat:</span>
      <span class="hljs-string">base-url:</span> <span class="hljs-string">https://open.bigmodel.cn/api/coding/paas</span>
      <span class="hljs-attr">options:</span>
        <span class="hljs-string">model:</span> <span class="hljs-string">glm-4.6</span>
</code></pre>
<p>注意，上述代码中的 <code>base-url</code> 如果不填写，默认为 <code>https://open.bigmodel.cn/api/paas</code>；如果你要使用 Coding Plan 的优惠套餐包，需要替换为 <code>https://open.bigmodel.cn/api/coding/paas</code>（中间多加了个 coding）。</p>
<p>填写好配置后，让我们写一个单元测试文件，直接使用自动注入的 ChatModel 类型的 Bean，然后调用 ChatModel 提供的 call 方法和 AI 对话：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">YupiAiProjectApplicationTests</span> {
​
   <span class="hljs-meta">@Resource</span>
   <span class="hljs-keyword">private</span> <span class="hljs-title class_">ChatModel</span> zhiPuAiChatModel;
​
   <span class="hljs-meta">@Test</span>
   <span class="hljs-built_in">void</span> <span class="hljs-title function_">contextLoads</span>(<span class="hljs-params"/>) {
       <span class="hljs-title class_">String</span> content = zhiPuAiChatModel.<span class="hljs-title function_">call</span>(<span class="hljs-string">"你好，我是程序员鱼皮"</span>);
       <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(content);
  }
​
}
</code></pre>
<p>直接运行单元测试，一次 AI 对话就完成了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb6b4755f6de41aab7e2efe06dcab589~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=HtXdACVT8ShkbcsVTmHDxEGFdRs%3D" alt="" loading="lazy"/></p>
<p>将 AI 接入项目就是这么简单~ 而且因为我们用的是 Spring AI 框架，你可以享受框架提供的各种高级能力，比如对话记忆、RAG、工具调用、可观测性等等。</p>
<h2 data-id="heading-4">三、API 接入已有项目</h2>
<p>如果你的项目已经使用了 AI 开发框架、或者 Open AI 大模型，只需 1 分钟就能替换为国内的大模型 API。</p>
<p>以我当时带大家从 0 开始做的、对标大厂的 <strong>AI 零代码生成项目</strong> 为例，这个项目使用 Java 主流的 AI 应用开发框架 LangChain4j。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55afbbe8efd54f6aa14d7790207dcd21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=j7eplPQZYL%2FUr9CVLSVqUuS8uyo%3D" alt="" loading="lazy"/></p>
<p>项目代码是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fyu-ai-code-mother" target="_blank" title="https://github.com/liyupi/yu-ai-code-mother" ref="nofollow noopener noreferrer">完全开源</a> 的，大家可以直接下载学习，也欢迎到编程导航学习整个项目的完整教程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/734ca96e3f0747f4a50e7b901126fef7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=PhpvywZyJW9f%2F3kfdyhCQdMGPJQ%3D" alt="" loading="lazy"/></p>
<p>之前这个项目接入的是 DeepSeek，现在如果要接入编程能力更快更强的 GLM-4.6，只需要更改一下配置文件：</p>
<pre><code class="hljs language-arduino" lang="arduino">langchain4j:
open-ai:
  reasoning-streaming-chat-model:
    base-url: https:<span class="hljs-comment">//open.bigmodel.cn/api/coding/paas/v4</span>
    api-key: &lt;Your API Key&gt;
    model-name: glm<span class="hljs-number">-4.6</span>
    max-tokens: <span class="hljs-number">32768</span>
    temperature: <span class="hljs-number">0.1</span>
</code></pre>
<p>其中，如果你要生成更复杂的项目，max-tokens 可以调大点，GLM-4.6 有 200K 超长上下文窗口，写几十个页面都不成问题。</p>
<p>然后依次启动后端和前端项目，输入提示词，比如让 AI 制作一个精美的作品展示网站：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57f78230fb20454fbb0fa02d83a17c73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=EvcT%2FTBI5LYR6QelUegxhwgF4kk%3D" alt="" loading="lazy"/></p>
<p>大概 3 ~ 4 分钟左右，GLM-4.6 完成了任务，生成的网站效果还是相当不错的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/469d1879133448f2b3620d9139c51737~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=epN25f%2FSyomB9%2B5Xc6QZvB%2BNkwM%3D" alt="" loading="lazy"/></p>
<p>之前这个项目我使用的是 DeepSeek-V3.2-Exp 模型，用同样的提示词，需要花费 6 ~ 8 分钟左右，做出来的效果如图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff7f09cffcd94e2ab64ec124c6ff5498~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=o5BD99eGYeg6PRk%2Bq8AoCwQVxCY%3D" alt="" loading="lazy"/></p>
<p>显然无论是速度上，还是效果上，GLM-4.6 都更胜一筹。</p>
<p>为消除偶然性，我这边挑选了几个案例，进行了更多对比。</p>
<p>1）先是经典的个人博客网站，二者做出的效果差不多，GLM-4.6 更现代、DeepSeek 更简约传统：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85e608840dca456a91ad83eccfb2364e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=hloJ%2Bf%2FJ7RAip3ZS36Vc5Cj2iTw%3D" alt="" loading="lazy"/></p>
<p>2）然后是一个宇宙大爆炸 3D 动画演示，这里显然 GLM-4.6 更专注于 “做动画效果”，而 DeepSeek 做的更像是一个知识科普网站。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f962195acd5d4111ba7a6431d85fb173~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=ZpUTG%2B6G24U6foG7XO3CYa0r1vo%3D" alt="" loading="lazy"/></p>
<p>咱就是说，DeepSeek 做的这个 “宇宙膨胀” 方格动画真的给我看笑了。</p>
<p>3）然后是做一个微信 UI 原型图，这次我要把 Gemini 3 拉进来一起对比。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaf38be521c140caa322fd019be60121~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=Y%2Foti2E1wzYR70qYdOpXNYW5i%2Fw%3D" alt="" loading="lazy"/></p>
<p>Gemini 3 的还原度是最高的，其次是 GLM-4.6，而 DeepSeek 根本就没有做聊天页面。不过这里我用的是 Gemini 3 的 Canvas 模式，有些图标会自己绘制，而国内的大模型直接用 Emoji 来代替图标了，所以逼真度差了一截。</p>
<p>4）最后是我最喜欢让 AI 做的案例 —— 仿做一个知名的海外视频网站，来验证 AI 的理解能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32384a40e4074d2a9bee5027a4f6347f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=yIvuMaN3Wzhw0q2Iv%2FFkll7lZgE%3D" alt="" loading="lazy"/></p>
<p>这把我觉得 GLM-4.6 的效果更好一些，增强了 “看视频” 的体验，有很多视频的分类；而 DeepSeek 考虑到了上传视频。到底哪个更符合现代视频网站的特点，我相信大家心里有答案。</p>
<h2 data-id="heading-5">尾声</h2>
<p>OK，以上就是几种国内大模型 API 的使用方法，学到的朋友们点个赞吧~</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1927afe221584eb8a9312b66e50e126f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764818499&amp;x-signature=6nXj70BlnlZj9dMStS6XbwlkLfQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">更多</h2>
<p>💻 编程学习交流：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fcode-nav" target="_blank" title="https://github.com/liyupi/code-nav" ref="nofollow noopener noreferrer">编程导航</a> 📃 简历快速制作：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Flaoyujianli" target="_blank" title="https://github.com/liyupi/laoyujianli" ref="nofollow noopener noreferrer">老鱼简历</a> ✏️ 面试刷题神器：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fmianshiya" target="_blank" title="https://github.com/liyupi/mianshiya" ref="nofollow noopener noreferrer">面试鸭</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[打造一个可定制工作流的桌面女友]]></title>    <link>https://juejin.cn/post/7577171133432709161</link>    <guid>https://juejin.cn/post/7577171133432709161</guid>    <pubDate>2025-11-27T03:13:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577171133432709161" data-draft-id="7576955345377968191" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="打造一个可定制工作流的桌面女友"/> <meta itemprop="keywords" content="Electron"/> <meta itemprop="datePublished" content="2025-11-27T03:13:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="奇舞精选"/> <meta itemprop="url" content="https://juejin.cn/user/4388906147515367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            打造一个可定制工作流的桌面女友
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906147515367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    奇舞精选
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T03:13:52.000Z" title="Thu Nov 27 2025 03:13:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>你是否想过拥有一个可以自定义行为的桌面虚拟角色？本文将带你从零开始，打造一个基于 Live2D 的桌面女友，并赋予她可定制的工作流能力。通过 Electron + LangGraph 的组合，我们可以创建一个既可爱又智能的桌面应用。</p>
</blockquote>
<p>通过本项目，你能得到什么：</p>
<ol>
<li><strong>一位常驻桌面的虚拟女友</strong>：使用 Live2D 技术打造的可爱角色，可以常驻桌面，陪伴你的工作时光</li>
<li><strong>可定制的工作流系统</strong>：通过 LangGraph 构建的工作流引擎，让虚拟角色能够执行各种自定义任务和逻辑</li>
<li><strong>模板管理系统</strong>：可以保存、复用和分享工作流模板，提高工作效率</li>
<li><strong>高度可扩展的架构</strong>：模块化设计，可以轻松添加新的步骤类型、集成 AI 对话、文件操作等功能</li>
</ol>
<h2 data-id="heading-0">项目概览</h2>
<p>在开始之前，让我们先了解一下整个项目的架构：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────┐
│                    用户交互层                             │
│  ┌──────────────┐         ┌──────────────┐              │
│  │  Live2D 模型 │         │  工作流管理  │                │
│  │   (桌面女友)  │         │   界面       │               │
│  └──────────────┘         └──────────────┘              │
└─────────────────────────────────────────────────────────┘
                        ↕
┌─────────────────────────────────────────────────────────┐
│                  Electron 应用层                          │
│  ┌──────────────┐         ┌──────────────┐              │
│  │  Express 服务 │         │  BrowserWindow│             │
│  │  (静态资源)   │         │  (工作流UI)  │               │
│  └──────────────┘         └──────────────┘              │
└─────────────────────────────────────────────────────────┘
                        ↕
┌─────────────────────────────────────────────────────────┐
│                 工作流服务层                               │
│  ┌──────────────┐         ┌──────────────┐              │
│  │  FastAPI     │         │  LangGraph   │              │
│  │  (REST API)  │         │  (工作流引擎) │               │
│  └──────────────┘         └──────────────┘              │
└─────────────────────────────────────────────────────────┘
</code></pre>
<p>整个系统分为三个层次：</p>
<ol>
<li><strong>用户交互层</strong>：Live2D 模型交互和工作流管理界面</li>
<li><strong>Electron 应用层</strong>：桌面应用框架和资源服务</li>
<li><strong>工作流服务层</strong>：后端 API 和工作流执行引擎</li>
</ol>
<hr/>
<h2 data-id="heading-1">第一步：获取 Live2D 免费模型</h2>
<p>Live2D 官方提供了丰富的免费示例模型，我们可以直接下载使用。</p>
<h3 data-id="heading-2">访问下载页面</h3>
<p>打开 Live2D 官方示例数据集页面：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.live2d.com%2Fzh-CHS%2Flearn%2Fsample%2F" target="_blank" title="https://www.live2d.com/zh-CHS/learn/sample/" ref="nofollow noopener noreferrer">www.live2d.com/zh-CHS/lear…</a></p>
<p>在这个页面上，你可以看到多个免费模型，包括：</p>
<ul>
<li><strong>Haru</strong>：一个可爱的女孩角色</li>
<li><strong>Nito</strong>：二头身卡通角色</li>
</ul>
<h3 data-id="heading-3">下载模型文件</h3>
<p>选择一个你喜欢的模型（推荐从 <strong>Haru</strong> 开始），下载 FREE 版本。下载后的文件结构通常如下：</p>
<pre><code class="hljs language-bash" lang="bash">haru/
├── haru_greeter_t05.moc3          <span class="hljs-comment"># 模型数据文件</span>
├── haru_greeter_t05.physics3.json <span class="hljs-comment"># 物理效果配置</span>
├── haru_greeter_t05.pose3.json    <span class="hljs-comment"># 姿势配置</span>
├── haru_greeter_t05.cdi3.json     <span class="hljs-comment"># 显示辅助文件</span>
├── index.json                      <span class="hljs-comment"># 模型索引文件</span>
├── texture_00.png                  <span class="hljs-comment"># 纹理贴图</span>
├── texture_01.png                  <span class="hljs-comment"># 纹理贴图</span>
└── motion/                         <span class="hljs-comment"># 动作文件夹</span>
    ├── haru_g_idle.motion3.json   <span class="hljs-comment"># 待机动作</span>
    └── ...                         <span class="hljs-comment"># 其他动作文件</span>
</code></pre>
<h3 data-id="heading-4">放置模型文件</h3>
<p>将下载的模型文件夹放到项目的 <code>electron/live2d/model/</code> 目录下，例如：</p>
<pre><code class="hljs language-bash" lang="bash">electron/
└── live2d/
    └── model/
        └── haru/          <span class="hljs-comment"># 你下载的模型文件夹</span>
            ├── index.json
            └── ...
</code></pre>
<hr/>
<h2 data-id="heading-5">第二步：初始化 Electron + Live2D 项目</h2>
<h3 data-id="heading-6">项目结构</h3>
<p>首先，我们需要创建一个 Electron 项目，并集成 Live2D 显示功能。这里使用 live2d-widget <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fstevenjoezhang%2Flive2d-widget" target="_blank" title="https://github.com/stevenjoezhang/live2d-widget" ref="nofollow noopener noreferrer">github.com/stevenjoezh…</a> 项目的构建工程集成 Live2D。</p>
<h3 data-id="heading-7">添加构建工程</h3>
<p>将下载 <code>live2d-widget</code> 工程放到以下目录：</p>
<pre><code class="hljs language-markdown" lang="markdown">electron/
└── live2d/
<span class="hljs-code">    └── live2d-widget/
</span></code></pre>
<h3 data-id="heading-8">安装依赖</h3>
<p>在 <code>electron</code> 目录下创建 <code>package.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"wenko"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"main.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"electron ."</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"electron"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^latest"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"express"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.18.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后运行：</p>
<pre><code class="hljs language-bash" lang="bash">npm install
</code></pre>
<h3 data-id="heading-9">创建主窗口</h3>
<p>创建 <code>index.html</code> 文件，用于显示 Live2D 模型：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Wenko<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"wenko_wifu"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://localhost:8080/live2d/live2d-widget/dist/autoload.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>这里我们通过 <code>localhost:8080</code> 来加载 Live2D 的资源文件，这个服务我们会在下一步创建。</p>
<h3 data-id="heading-10">live2d-widget 项目和 Live2D 模型有什么关系？</h3>
<p><code>live2d-widget</code> 项目不包括任何模型，仅负责在网页中加载和运行 <code>Live2D</code> 模型。具体逻辑可参考 <code>autoload.js</code> 。</p>
<hr/>
<h2 data-id="heading-11">第三步：配置 Express 静态资源服务</h2>
<p>为了让 Live2D 模型文件能够正常加载，我们需要在 Electron 主进程中启动一个 Express 服务器来提供静态文件服务。</p>
<h3 data-id="heading-12">修改 main.js</h3>
<p>打开 <code>electron/main.js</code>，添加 Express 服务器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { app, <span class="hljs-title class_">BrowserWindow</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'electron'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);

<span class="hljs-comment">// 创建 Express 服务器提供 live2d 静态文件访问</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createStaticServer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> expressApp = <span class="hljs-title function_">express</span>();
  <span class="hljs-keyword">const</span> port = <span class="hljs-number">8080</span>;
  
  <span class="hljs-comment">// 提供 live2d 目录的静态文件访问</span>
  expressApp.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/live2d'</span>, express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'live2d'</span>)));
  
  expressApp.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Static server running on http://localhost:<span class="hljs-subst">${port}</span>`</span>);
  });
}

<span class="hljs-comment">// 启动静态文件服务器</span>
<span class="hljs-title function_">createStaticServer</span>();

<span class="hljs-comment">// 创建 Electron 窗口</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createWindow</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> mainWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({
    <span class="hljs-attr">width</span>: <span class="hljs-number">350</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">400</span>,
    <span class="hljs-attr">frame</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">webPreferences</span>: {
      <span class="hljs-attr">nodeIntegration</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">contextIsolation</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">webSecurity</span>: <span class="hljs-literal">false</span>
    }
  });

  mainWindow.<span class="hljs-title function_">loadFile</span>(<span class="hljs-string">'index.html'</span>);
}

app.<span class="hljs-title function_">whenReady</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">createWindow</span>();
});
</code></pre>
<h3 data-id="heading-13">工作流程</h3>
<pre><code class="hljs language-bash" lang="bash">┌─────────────────┐
│  Electron 启动   │
└────────┬─────────┘
         │
         ├──&gt; 启动 Express 服务器 (端口 8080)
         │    └──&gt; 提供 /live2d/* 静态资源
         │
         └──&gt; 创建 BrowserWindow
              └──&gt; 加载 index.html
                   └──&gt; 通过 http://localhost:8080/live2d/... 加载模型
</code></pre>
<h3 data-id="heading-14">为什么需要 Express 服务器？</h3>
<p>Live2D 的模型文件（<code>.moc3</code>、<code>.json</code>、<code>.png</code> 等）需要通过 HTTP 协议加载。虽然 Electron 支持 <code>file://</code> 协议，但某些情况下会遇到跨域问题。使用 Express 提供 HTTP 服务可以：</p>
<ol>
<li><strong>避免跨域问题</strong>：统一使用 HTTP 协议</li>
<li><strong>便于调试</strong>：可以在浏览器中直接访问资源</li>
<li><strong>灵活配置</strong>：可以添加缓存、压缩等中间件</li>
</ol>
<hr/>
<h2 data-id="heading-15">第四步：构建工作流系统</h2>
<p>现在，让我们为桌面女友添加"大脑"——一个可定制的工作流系统。</p>
<h3 data-id="heading-16">初始化 LangGraph 项目</h3>
<p>在项目根目录下创建 <code>workflow</code> 目录，并初始化 Python 项目：</p>
<p><strong>首先安装 uv</strong>（如果还没有安装）：</p>
<pre><code class="hljs language-bash" lang="bash">curl -LsSf https://astral.sh/uv/install.sh | sh
</code></pre>
<p><strong>然后初始化项目</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> workflow
<span class="hljs-built_in">cd</span> workflow

<span class="hljs-comment"># 使用 uv 初始化项目</span>
uv init

<span class="hljs-comment"># 添加依赖</span>
uv add langgraph langgraph-cli fastapi uvicorn httpx pydantic python-dotenv
</code></pre>
<h3 data-id="heading-17">项目结构</h3>
<pre><code class="hljs language-bash" lang="bash">workflow/
├── main.py          <span class="hljs-comment"># FastAPI 应用入口</span>
├── executor.py      <span class="hljs-comment"># 工作流执行器</span>
├── steps.py         <span class="hljs-comment"># 步骤定义</span>
├── graph.py         <span class="hljs-comment"># LangGraph 图定义</span>
├── control_steps.py <span class="hljs-comment"># 控制流步骤（If/Then/Else）</span>
└── pyproject.toml   <span class="hljs-comment"># 项目配置</span>
</code></pre>
<h3 data-id="heading-18">核心组件解析</h3>
<h4 data-id="heading-19">1. steps.py - 步骤定义</h4>
<p><code>steps.py</code> 定义了所有可用的工作流步骤。每个步骤都是一个类，继承自 <code>Step</code> 基类：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Step</span>(<span class="hljs-title class_ inherited__">ABC</span>):
    <span class="hljs-string">"""步骤基类"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, step_type: <span class="hljs-built_in">str</span>, params: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>):
        self.step_type = step_type
        self.params = params
    
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">self, context: StepContext</span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-string">"""执行步骤"""</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<p><strong>步骤类型示例</strong>：</p>
<ul>
<li>
<p><strong>SetVar</strong>：设置变量</p>
<pre><code class="hljs language-python" lang="python">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"SetVar"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"key"</span>: <span class="hljs-string">"greeting"</span>,
    <span class="hljs-string">"value"</span>: <span class="hljs-string">"Hello, World!"</span>
  }
}
</code></pre>
</li>
<li>
<p><strong>GetVar</strong>：获取变量</p>
<pre><code class="hljs language-python" lang="python">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"GetVar"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"key"</span>: <span class="hljs-string">"greeting"</span>
  }
}
</code></pre>
</li>
<li>
<p><strong>EchoInput</strong>：回显输入</p>
<pre><code class="hljs language-python" lang="python">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"EchoInput"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"input_key"</span>: <span class="hljs-string">"user_input"</span>,
    <span class="hljs-string">"output_key"</span>: <span class="hljs-string">"response"</span>
  }
}
</code></pre>
</li>
</ul>
<p><strong>步骤注册表</strong>：</p>
<p>所有步骤都注册在 <code>STEP_REGISTRY</code> 中，方便动态创建：</p>
<pre><code class="hljs language-python" lang="python">STEP_REGISTRY = {
    <span class="hljs-string">'EchoInput'</span>: EchoInputStep,
    <span class="hljs-string">'SetVar'</span>: SetVarStep,
    <span class="hljs-string">'GetVar'</span>: GetVarStep,
    <span class="hljs-comment"># ... 更多步骤类型</span>
}
</code></pre>
<h4 data-id="heading-20">2. executor.py - 工作流执行器</h4>
<p><code>executor.py</code> 负责执行工作流步骤序列：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkflowExecutor</span>:
    <span class="hljs-string">"""工作流执行器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">self, steps: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>], initial_context: <span class="hljs-type">Dict</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-comment"># 创建上下文</span>
        context = StepContext(initial_context <span class="hljs-keyword">or</span> {})
        
        <span class="hljs-comment"># 依次执行每个步骤</span>
        <span class="hljs-keyword">for</span> step_config <span class="hljs-keyword">in</span> steps:
            step_type = step_config.get(<span class="hljs-string">'type'</span>)
            step_params = step_config.get(<span class="hljs-string">'params'</span>, {})
            
            <span class="hljs-comment"># 从注册表创建步骤实例</span>
            step = create_step(step_type, step_params)
            
            <span class="hljs-comment"># 执行步骤</span>
            result = step.execute(context)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'success'</span>: <span class="hljs-literal">True</span>,
            <span class="hljs-string">'result'</span>: context.variables
        }
</code></pre>
<p><strong>执行流程</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">┌─────────────────┐</span>
<span class="hljs-string">│</span>  <span class="hljs-string">工作流请求</span>      <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  {               <span class="hljs-string">│</span>
<span class="hljs-string">│</span>    <span class="hljs-attr">steps:</span> [<span class="hljs-string">...</span>], <span class="hljs-string">│</span>
<span class="hljs-string">│</span>    <span class="hljs-attr">context:</span> {}   <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  }               <span class="hljs-string">│</span>
<span class="hljs-string">└────────┬─────────┘</span>
         <span class="hljs-string">│</span>
         <span class="hljs-string">v</span>
<span class="hljs-string">┌─────────────────┐</span>
<span class="hljs-string">│</span>  <span class="hljs-string">WorkflowExecutor│</span>
<span class="hljs-string">└────────┬─────────┘</span>
         <span class="hljs-string">│</span>
         <span class="hljs-string">v</span>
<span class="hljs-string">┌─────────────────┐</span>      <span class="hljs-string">┌──────────────┐</span>
<span class="hljs-string">│</span>  <span class="hljs-string">StepContext</span>    <span class="hljs-string">│&lt;─────│</span>  <span class="hljs-string">变量存储</span>     <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">(上下文)</span>        <span class="hljs-string">│</span>      <span class="hljs-string">│</span>  <span class="hljs-string">variables</span>   <span class="hljs-string">│</span>
<span class="hljs-string">└────────┬────────┘</span>      <span class="hljs-string">└──────────────┘</span>
         <span class="hljs-string">│</span>
         <span class="hljs-string">v</span>
<span class="hljs-string">┌─────────────────────────────────────┐</span>
<span class="hljs-string">│</span>  <span class="hljs-string">遍历步骤列表</span>                        <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">┌──────────┐</span>  <span class="hljs-string">┌──────────┐</span>        <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">│</span> <span class="hljs-string">Step</span> <span class="hljs-number">1</span>   <span class="hljs-string">│→</span> <span class="hljs-string">│</span> <span class="hljs-string">Step</span> <span class="hljs-number">2</span>   <span class="hljs-string">│→</span> <span class="hljs-string">...</span>   <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">└──────────┘</span>  <span class="hljs-string">└──────────┘</span>        <span class="hljs-string">│</span>
<span class="hljs-string">└─────────────────────────────────────┘</span>
         <span class="hljs-string">│</span>
         <span class="hljs-string">v</span>
<span class="hljs-string">┌─────────────────┐</span>
<span class="hljs-string">│</span>  <span class="hljs-string">返回执行结果</span>    <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  {               <span class="hljs-string">│</span>
<span class="hljs-string">│</span>    <span class="hljs-attr">success:</span> <span class="hljs-literal">true</span>,<span class="hljs-string">│</span>
<span class="hljs-string">│</span>    <span class="hljs-attr">result:</span> {<span class="hljs-string">...</span>} <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  }               <span class="hljs-string">│</span>
<span class="hljs-string">└─────────────────┘</span>
</code></pre>
<h4 data-id="heading-21">3. main.py - REST API 接口</h4>
<p><code>main.py</code> 使用 FastAPI 提供 RESTful API：</p>
<p><strong>核心接口</strong>：</p>
<ol>
<li>
<p><strong>执行工作流</strong> - <code>POST /run</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/run"</span>, response_model=WorkflowResponse</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_workflow</span>(<span class="hljs-params">request: WorkflowRequest</span>):
    executor = WorkflowExecutor()
    result = executor.execute(
        steps=request.steps,
        initial_context=request.initial_context <span class="hljs-keyword">or</span> {}
    )
    <span class="hljs-keyword">return</span> result
</code></pre>
</li>
<li>
<p><strong>模板管理接口</strong>：</p>
<ul>
<li><code>POST /templates</code> - 创建模板</li>
<li><code>GET /templates</code> - 列出所有模板</li>
<li><code>GET /templates/{id}</code> - 获取模板详情</li>
<li><code>PUT /templates/{id}</code> - 更新模板</li>
<li><code>DELETE /templates/{id}</code> - 删除模板</li>
<li><code>GET /templates/search/{query}</code> - 搜索模板</li>
<li><code>POST /templates/{id}/execute</code> - 执行模板</li>
</ul>
</li>
<li>
<p><strong>系统接口</strong>：</p>
<ul>
<li><code>GET /health</code> - 健康检查</li>
<li><code>GET /steps</code> - 获取步骤注册表</li>
</ul>
</li>
</ol>
<p><strong>API 调用示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 执行工作流</span>
curl -X POST http://localhost:8002/run \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{
    "steps": [
      {
        "type": "SetVar",
        "params": {"key": "name", "value": "Wenko"}
      },
      {
        "type": "EchoInput",
        "params": {"input_key": "name", "output_key": "greeting"}
      }
    ],
    "initial_context": {}
  }'</span>
</code></pre>
<h3 data-id="heading-22">启动服务</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> workflow
uv run python main.py
</code></pre>
<p>服务启动后，访问 <code>http://localhost:8002/docs</code> 可以看到自动生成的 API 文档。</p>
<hr/>
<h2 data-id="heading-23">第五步：构建工作流管理界面</h2>
<p>最后，我们需要一个友善的界面来管理模板和执行工作流。</p>
<h3 data-id="heading-24">修改 main.js 添加工作流窗口</h3>
<p>在 <code>electron/main.js</code> 中添加快捷键监听，打开工作流管理窗口：</p>
<pre><code class="hljs language-javascript" lang="javascript">ipcMain.<span class="hljs-title function_">on</span>(<span class="hljs-string">'wenko_shortcut'</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
  <span class="hljs-comment">// 处理快捷键事件: action: open</span>
  <span class="hljs-keyword">const</span> { action } = data;
  <span class="hljs-keyword">if</span> (action === <span class="hljs-string">'open'</span>) {
    <span class="hljs-keyword">const</span> shortcutWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({
      <span class="hljs-attr">width</span>: <span class="hljs-number">1200</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-number">800</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'Workflow API 测试工具'</span>,
      <span class="hljs-attr">icon</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'assets'</span>, <span class="hljs-string">'favicon.ico'</span>),
      <span class="hljs-attr">frame</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">transparent</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">alwaysOnTop</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">hasShadow</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">fullscreenable</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">skipTaskbar</span>: <span class="hljs-literal">false</span>,    <span class="hljs-comment">// 在任务栏显示</span>
      <span class="hljs-attr">webPreferences</span>: {
        <span class="hljs-attr">preload</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'preload.js'</span>),
        <span class="hljs-attr">nodeIntegration</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">contextIsolation</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">webSecurity</span>: <span class="hljs-literal">false</span>  <span class="hljs-comment">// 关闭同源策略和 CSP 检查，方便开发加载任意脚本</span>
      }
    });
    shortcutWindow.<span class="hljs-title function_">loadFile</span>(<span class="hljs-string">'workflow.html'</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Unknown action:'</span>, action);
  }
});

</code></pre>
<h3 data-id="heading-25">workflow.html 功能模块</h3>
<p><code>workflow.html</code> 使用 React + Ant Design 构建，包含以下功能：</p>
<h4 data-id="heading-26">1. 工作流执行标签页</h4>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────┐
│  工作流执行                          │
├─────────────────────────────────────┤
│  工作流步骤 (JSON)                   │
│  ┌───────────────────────────────┐  │
│  │ <span class="hljs-selector-attr">[                            │  ││  │   {<span class="hljs-string">"type"</span>: <span class="hljs-string">"SetVar"</span>, ...}    │  ││  │ ]</span>                            │  │
│  └───────────────────────────────┘  │
│                                      │
│  初始上下文 (JSON, 可选)              │
│  ┌───────────────────────────────┐  │
│  │ {"key": <span class="hljs-string">"value"</span>}              │  │
│  └───────────────────────────────┘  │
│                                      │
│  ☑ 调试模式                          │
│                                      │
│  <span class="hljs-selector-attr">[执行工作流]</span> <span class="hljs-selector-attr">[加载示例]</span> <span class="hljs-selector-attr">[清空]</span>      │
└─────────────────────────────────────┘
</code></pre>
<h4 data-id="heading-27">2. 模板管理标签页</h4>
<pre><code class="hljs language-css" lang="css">┌─────────────────────────────────────┐
│  模板管理                            │
├─────────────────────────────────────┤
│  <span class="hljs-selector-attr">[+ 创建新模板]</span>                      │
│                                      │
│  ┌───────────────────────────────┐  │
│  │ 模板名称                        │  │
│  │ 描述：这是一个示例模板...        │  │
│  │ 标签：<span class="hljs-selector-attr">[基础]</span> <span class="hljs-selector-attr">[示例]</span>              │  │
│  │ <span class="hljs-selector-attr">[查看]</span> <span class="hljs-selector-attr">[执行]</span> <span class="hljs-selector-attr">[编辑]</span> <span class="hljs-selector-attr">[删除]</span>     │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
</code></pre>
<h4 data-id="heading-28">3. 步骤注册表标签页</h4>
<p>显示所有可用的步骤类型：</p>
<pre><code class="hljs language-css" lang="css">┌─────────────────────────────────────┐
│  步骤注册表                          │
├─────────────────────────────────────┤
│  <span class="hljs-selector-attr">[刷新步骤列表]</span>                      │
│                                      │
│  ┌──────┐ ┌──────┐ ┌──────┐        │
│  │EchoInput│ │SetVar│ │GetVar│        │
│  └──────┘ └──────┘ └──────┘        │
│  ┌──────┐ ┌──────┐ ┌──────┐        │
│  │FetchURL│ │ParseJSON│ │...│        │
│  └──────┘ └──────┘ └──────┘        │
└─────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-29">模板执行流程</h3>
<p>当用户点击"执行"按钮时：</p>
<pre><code class="hljs language-bash" lang="bash">┌─────────────────┐
│  用户点击执行    │
└────────┬────────┘
         │
         v
┌─────────────────┐
│  弹出对话框      │
│  让用户输入上下文│
└────────┬────────┘
         │
         v
┌─────────────────┐
│  调用 API        │
│  POST /templates/│
│  {<span class="hljs-built_in">id</span>}/execute    │
└────────┬────────┘
         │
         v
┌─────────────────┐
│  显示执行结果    │
└─────────────────┘
</code></pre>
<hr/>
<h2 data-id="heading-30">完整系统架构</h2>
<p>现在，让我们看看整个系统是如何协作的：</p>
<pre><code class="hljs language-javascript" lang="javascript">┌─────────────────────────────────────────────────────────────┐
│                      用户操作流程                              │
└─────────────────────────────────────────────────────────────┘
                            │
                            v
        ┌───────────────────────────────────┐
        │  <span class="hljs-number">1.</span> 启动 <span class="hljs-title class_">Electron</span> 应用              │
        │     - 显示 <span class="hljs-title class_">Live2D</span> 模型             │
        │     - 启动 <span class="hljs-title class_">Express</span> 静态服务         │
        └───────────────┬─────────────────────┘
                        │
                        v
        ┌───────────────────────────────────┐
        │  <span class="hljs-number">2.</span> 与 <span class="hljs-title class_">Live2D</span> 模型交互打开管理界面     │
        └───────────────┬─────────────────────┘
                        │
                        v
        ┌───────────────────────────────────┐
        │  <span class="hljs-number">3.</span> 在工作流界面中：                │
        │     - 创建/编辑模板                 │
        │     - 执行工作流                    │
        │     - 查看步骤注册表                │
        └───────────────┬─────────────────────┘
                        │
                        v
        ┌───────────────────────────────────┐
        │  <span class="hljs-number">4.</span> 前端调用 <span class="hljs-title class_">FastAPI</span>                │
        │     <span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:8002/...       │</span>
        └───────────────┬─────────────────────┘
                        │
                        v
        ┌───────────────────────────────────┐
        │  <span class="hljs-number">5.</span> <span class="hljs-title class_">FastAPI</span> 处理请求                │
        │     - 解析 <span class="hljs-title class_">JSON</span>                     │
        │     - 调用 <span class="hljs-title class_">WorkflowExecutor</span>         │
        └───────────────┬─────────────────────┘
                        │
                        v
        ┌───────────────────────────────────┐
        │  <span class="hljs-number">6.</span> <span class="hljs-title class_">WorkflowExecutor</span> 执行步骤      │
        │     - 创建 <span class="hljs-title class_">StepContext</span>             │
        │     - 遍历步骤列表                 │
        │     - 执行每个步骤                 │
        └───────────────┬─────────────────────┘
                        │
                        v
        ┌───────────────────────────────────┐
        │  <span class="hljs-number">7.</span> 返回执行结果                    │
        │     - 成功/失败状态                 │
        │     - 上下文变量                    │
        └───────────────┬─────────────────────┘
                        │
                        v
        ┌───────────────────────────────────┐
        │  <span class="hljs-number">8.</span> 前端显示结果                    │
        │     - 成功提示                     │
        │     - 结果 <span class="hljs-title class_">JSON</span> 展示               │
        └───────────────────────────────────┘
</code></pre>
<hr/>
<h2 data-id="heading-31">使用示例</h2>
<h3 data-id="heading-32">示例 1：简单的问候工作流</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"steps"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"SetVar"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"name"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Wenko"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TemplateReplace"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"template"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你好，{{name}}！今天过得怎么样？"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"template_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"output_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"greeting"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"initial_context"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>执行结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Wenko"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"greeting"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你好，Wenko！今天过得怎么样？"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-33">总结</h2>
<p>通过本文，我们完成了一个完整的可定制工作流桌面女友系统：</p>
<ol>
<li>✅ <strong>Live2D 模型集成</strong>：从官网下载免费模型并集成到 Electron</li>
<li>✅ <strong>静态资源服务</strong>：使用 Express 提供模型文件访问</li>
<li>✅ <strong>工作流引擎</strong>：基于 LangGraph 构建可扩展的工作流系统</li>
<li>✅ <strong>REST API</strong>：提供完整的模板管理和执行接口</li>
<li>✅ <strong>管理界面</strong>：友好的 Web 界面用于模板管理</li>
</ol>
<p>这个系统具有很强的扩展性：</p>
<ul>
<li>可以添加更多步骤类型（如 AI 对话、文件操作等）</li>
<li>可以集成更多 Live2D 模型和动作</li>
<li>可以添加数据库持久化模板</li>
<li>可以实现工作流与 Live2D 模型的联动（根据工作流结果触发模型动作）</li>
</ul>
<p>希望这篇文章能帮助你打造属于自己的智能桌面女友！🚀</p>
<hr/>
<h2 data-id="heading-34">参考资源</h2>
<ul>
<li>Live2D 官方示例数据集 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.live2d.com%2Fzh-CHS%2Flearn%2Fsample%2F" target="_blank" title="https://www.live2d.com/zh-CHS/learn/sample/" ref="nofollow noopener noreferrer">www.live2d.com/zh-CHS/lear…</a></li>
<li>live2d-widget 项目 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fstevenjoezhang%2Flive2d-widget" target="_blank" title="https://github.com/stevenjoezhang/live2d-widget" ref="nofollow noopener noreferrer">github.com/stevenjoezh…</a></li>
<li>LangGraph 官方文档 <a href="https://link.juejin.cn?target=https%3A%2F%2Flangchain-ai.github.io%2Flanggraph%2F" target="_blank" title="https://langchain-ai.github.io/langgraph/" ref="nofollow noopener noreferrer">langchain-ai.github.io/langgraph/</a></li>
<li>FastAPI 官方文档 <a href="https://link.juejin.cn?target=https%3A%2F%2Ffastapi.tiangolo.com%2F" target="_blank" title="https://fastapi.tiangolo.com/" ref="nofollow noopener noreferrer">fastapi.tiangolo.com/</a></li>
<li>Electron 官方文档 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.electronjs.org%2F" target="_blank" title="https://www.electronjs.org/" ref="nofollow noopener noreferrer">www.electronjs.org/</a></li>
<li>本项目仓库 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdaijinru%2Fwenko" target="_blank" title="https://github.com/daijinru/wenko" ref="nofollow noopener noreferrer">github.com/daijinru/we…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RAG 系统架构设计模式介绍]]></title>    <link>https://juejin.cn/post/7576955345378181183</link>    <guid>https://juejin.cn/post/7576955345378181183</guid>    <pubDate>2025-11-27T03:31:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576955345378181183" data-draft-id="7576953459543851062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RAG 系统架构设计模式介绍"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-11-27T03:31:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RAG 系统架构设计模式介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T03:31:18.000Z" title="Thu Nov 27 2025 03:31:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>在模块化RAG（Retrieval-Augmented Generation）设计中，各种操作模式通过模块化的方式协同工作，形成了一个名为 <strong>RAG流</strong> 的工作流程。这个 <strong>RAG流</strong> 可以被视为由多个子函数组成的图形结构。通过控制逻辑，这些子函数会按预定的顺序执行，同时也能根据需求进行条件判断、分支或循环。</p>
<p>这种模块化特性让RAG系统能够灵活应对不同的应用场景，并且提升了系统的设计效率和扩展性。在分析现有的RAG方法时，我们可以看到，模块化的结构使得RAG系统可以在处理复杂任务时更具适应性。</p>
<p><strong>本章将详细介绍几种常见的 <strong>RAG模式</strong>，包括：</strong></p>
<ul>
<li><strong>线性模式</strong>：在这个模式下，各个模块按顺序依次执行，每个步骤的输出作为下一个步骤的输入，适用于顺序性较强的任务。</li>
<li><strong>条件模式</strong>：根据特定的条件，选择性地执行不同的模块操作。这个模式能够处理具有分支或选择性的任务。</li>
<li><strong>分支模式</strong>：与条件模式类似，但它更多地用于任务中涉及多个并行处理路径的场景。</li>
<li><strong>循环模式</strong>：当某些操作需要重复执行时，循环模式便会派上用场。它适合那些需要反复处理相似任务的应用。</li>
</ul>
<p>通过这些模式的结合，RAG系统不仅能够高效地处理多样化的任务需求，还可以在面对复杂任务时保持灵活性与扩展性。</p>
<h2 data-id="heading-0">1 线性模式</h2>
<p>在 <strong>RAG系统</strong> 中，<strong>线性模式</strong> 是最简单且最常见的工作流模式。其核心流程包括几个主要模块：<strong>预检索（Pre-Retrieval）</strong> 、<strong>检索</strong>、<strong>后检索（Post-Retrieval）</strong>  和 <strong>生成模块</strong>。这些模块按顺序依次进行处理，如图示。值得注意的是，当预检索和检索后处理模块缺失时，线性模式会简化为一种称为 <strong>朴素检索增强生成（Naive RAG）</strong>  的基本范式，仅包含检索和生成过程。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/916860248a544c5883deea38e4fb77a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819077&amp;x-signature=TIsdJRXvvLFI8GuilrKrPDEJoyY%3D" alt="" loading="lazy"/></p>
<p>为了提升生成的质量，常见的线性RAG流通过以下几个步骤优化：</p>
<ul>
<li><strong>预检索阶段</strong>：这一阶段引入了查询变换模块，通常采用查询重写或者隐式文档扩展（HyDE）等操作符。通过这些变换，查询能够更好地适应检索需求，提高检索的相关性。</li>
<li><strong>检索阶段</strong>：在这一阶段，系统通过检索工具（如BM25）从外部知识库中获取与重写后的查询高度相关的文档或上下文信息。</li>
<li><strong>后检索阶段</strong>：检索结果进一步优化，通常通过排序模块对检索的结果进行调整，使得最终选出的文档最能满足生成需求。</li>
<li><strong>生成模块</strong>：最终，通过生成模型（例如GPT或T5等）处理优化后的文档上下文，产生高质量的回答或生成内容。</li>
</ul>
<p>一个典型的线性RAG流模式是：“<strong>重写-检索-阅读（Rewrite-Retrieve-Read，RRR）</strong> ”方法。该方法在预检索阶段引入了一个查询重写模块。这个模块基于 <strong>T5-large</strong> 模型的微调版本，并通过强化学习框架进行优化，将查询重写过程建模为 <strong>马尔可夫决策过程（MDP）</strong> 。</p>
<p>在这个过程中，查询重写模块的输出质量被视为奖励信号，强化学习算法通过策略梯度方法来调整和优化生成的查询，从而确保查询更符合检索任务的需求。这种方式提升了检索的效率，并进一步改善了生成结果的效果。</p>
<p>在检索阶段，<strong>RRR方法</strong>使用了稀疏编码模型（如<strong>BM25</strong>）进行检索，从外部知识库中获取与重写后的查询相关的文档，进一步增强了系统生成内容的准确性和可靠性。</p>
<p>通过这样的设计，线性模式的RAG流不仅提高了生成质量，还能在实际应用中实现高效的知识提取和生成。</p>
<h2 data-id="heading-1">2 条件模式</h2>
<p><strong>条件模式</strong> 是一种灵活的 <strong>RAG流模式</strong>，其核心特点是在不同的条件下选择不同的工作流，以便针对特定场景进行优化。这种模式的关键在于一个 <strong>路由模块（Routing Module）</strong> ，该模块根据输入问题的特性动态选择接下来的处理流程，如下图所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bb8991ca548429b9ac79f7a5fd56527~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819077&amp;x-signature=q5Tdoaw6g9BJq27Q7Q4lfoQiEwQ%3D" alt="" loading="lazy"/></p>
<p>具体来说，当系统接收到不同类型的问题时，它会根据预设的条件或规则决定如何处理。例如，对于涉及严肃议题、政治话题或娱乐内容等不同类型的问题，系统会自动切换到不同的处理流程。这种动态路由机制显著提升了系统处理多样化任务的能力，使得系统能够灵活应对各种复杂场景。</p>
<p><strong>条件模式的分支流</strong> 主要体现在以下几个方面：</p>
<ul>
<li><strong>检索来源</strong>：系统会根据问题的性质选择不同的检索来源。例如，对于严肃问题，系统可能会选择更可靠的、权威性的来源，而对于娱乐性问题，则可能选择更多元或创意性的资料。</li>
<li><strong>流程选择</strong>：针对不同任务的需求，条件模式可能会调整流程的细节，控制模块的顺序、执行的操作，甚至是否进行一些后处理。</li>
<li><strong>模型配置</strong>：不同类型的问题可能需要不同的模型配置。比如，严肃问题可能使用更精确、保守的模型，而娱乐类问题则可能使用更具创意性和生成自由度的模型。</li>
<li><strong>提示设计</strong>：根据任务的性质，系统的提示设计（Prompt Design）也会有所不同。对于严肃问题，提示可能会更为规范和严格，而对于娱乐类问题，提示可能会更具开放性和灵活性。</li>
</ul>
<p>举个例子，对于严肃性较高的问题（如法律、健康、政治等），系统可能会选择更加可靠的检索来源，并对生成的内容设置严格的约束，确保信息的准确性和权威性。而对于娱乐类的问题（如电影、游戏、搞笑等），系统则可以容忍更多的创意和不拘一格的生成，提供富有娱乐性和趣味性的回答。</p>
<p>通过这种方式，<strong>条件模式</strong> 能够根据任务的需求动态调整 <strong>RAG</strong> 各个组件，确保生成的回答既符合场景需求，又保持高相关性和准确性。这种灵活性使得 <strong>条件模式</strong> 在处理多样化、复杂性高的任务时具有显著的优势，能够有效提升系统的适应能力和输出质量。</p>
<h2 data-id="heading-2">3 分支模式</h2>
<p><strong>分支模式</strong> 是 <strong>RAG（Retrieval-Augmented Generation）</strong>  系统中一种增加结果多样性和鲁棒性的重要设计方式。它通过并行运行多个分支，来生成多样化的结果，从而提升系统的性能和准确性。</p>
<p>具体来说，<strong>分支模式</strong> 在某个模块中生成多个并行的分支，每个分支可以独立执行相同或不同的 <strong>RAG流程</strong>。这些分支通常由多个处理模块组成，每个模块生成各自的结果。然后，这些分支的结果会通过一个 <strong>聚合函数</strong> 合并成一个中间输出结果。值得注意的是，合并后的结果不一定意味着流程的结束，它们还可以传递到后续模块（如验证模块）进行进一步处理。整体流程从生成多个分支、独立处理、到结果聚合，形成了一个完整的流水线。</p>
<p>与<strong>条件模式</strong>不同，<strong>分支模式</strong> 的特点在于同时并行运行多个分支，而不是从多个选项中选择一个分支。这使得分支模式能够同时从多个角度进行处理，生成更加丰富和多样化的结果。</p>
<h4 data-id="heading-3">分支模式的结构类型</h4>
<p>根据任务需求，<strong>分支模式</strong> 可以设计为不同的结构，通常分为两种类型：</p>
<ul>
<li>
<p><strong>预检索分支模式（Pre-Retrieval Branching）</strong> 这种模式通过生成多个子查询并并行检索，旨在提高检索的全面性和生成结果的多样性。具体流程是，首先通过查询扩展模块将初始查询扩展为多个子查询。每个子查询然后通过检索模块获取相关文档，形成文档集合。这些文档和相应的子查询一同送入生成模块，产生多个答案集合。最终，所有生成的答案通过融合模块进行整合，形成最终的结果。</p>
<p>这种模式的优势在于，它能够从多个角度挖掘潜在信息，增强生成结果的覆盖度和准确性。它特别适用于需要广泛搜索和多角度生成的任务。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c70b9c7cd42e49d79ecd013ac9fb7777~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819077&amp;x-signature=wGS%2FkFuRSa2YbxdbMRosS0%2FPC08%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>后检索分支模式（Post-Retrieval Branching）</strong> 该模式从单一查询开始，首先通过检索模块获取多个文档块。然后，每个文档块被独立送入生成模块进行处理，生成对应的结果集合。这些结果最终会通过合并模块整合，形成最终输出。</p>
<p>与预检索分支模式不同，后检索分支模式的特点在于，它通过单一查询进行检索，而并行生成则集中在对不同文档块的独立处理上。这个模式非常适合那些需要从同一查询结果中挖掘多角度信息的场景，能更好地利用检索到的内容，提升生成结果的多样性和质量。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65acc7536587464f8ee0417e3206d768~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819077&amp;x-signature=qArkwsRjpn91ubzOaRak1FNoFtk%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<h4 data-id="heading-4">分支模式的优势</h4>
<p>通过并行执行多个分支，分支模式能够从多个角度生成和整合信息，极大地提升了系统的生成能力和结果质量。它特别适合于处理复杂场景和多任务需求，可以为不同的应用场景提供更加多样和精准的答案。因此，分支模式在 <strong>多任务处理</strong> 和 <strong>复杂场景</strong> 中具有显著的优势。</p>
<h2 data-id="heading-5">4 循环模式</h2>
<p><strong>循环模式</strong> 是 <strong>RAG（Retrieval-Augmented Generation）</strong>  系统中一种重要的设计方式，其核心特点是检索与生成步骤之间的相互依赖性。通过引入一个 <strong>调度模块</strong> 来控制流程，循环模式确保系统可以根据任务需求在不同模块之间重复执行某些操作。这使得循环模式可以不断优化流程中的步骤，提升任务的最终效果。</p>
<h4 data-id="heading-6">循环模式的基本原理</h4>
<p>循环模式可以抽象为一个 <strong>有向图</strong>，图中的节点代表系统中的各个模块，边则表示模块之间的控制流或数据流。当某个模块的输出能够返回到之前的模块时，系统就形成了一个 <strong>循环结构</strong>。这样的设计让系统可以根据需要在某些步骤之间来回循环，以不断优化结果，直到达到理想的效果。</p>
<h4 data-id="heading-7">判断模块</h4>
<p>在循环模式中，<strong>判断模块（Judge Module）</strong>  起到了关键作用。它用于决定系统是否需要返回到前一个模块，或者是否继续向下执行。例如，在每一次生成或检索之后，判断模块可以根据当前的输出结果、历史数据、查询和检索到的文档来决定是否继续迭代。如果决定返回，流程就会进行循环；如果决定不返回，流程则继续向前执行。这样，系统能够根据当前任务的情况动态调整整个流程。</p>
<h4 data-id="heading-8">循环模式的类型</h4>
<p>循环模式可以进一步细分为三种类型：<strong>迭代型循环模式</strong>、<strong>递归型循环模式</strong> 和 <strong>自适应型（主动型）循环模式</strong>。每种模式都适用于不同的场景，提供了灵活的处理方式。</p>
<ol>
<li>
<p><strong>迭代型循环模式</strong> 迭代型循环模式通过多次执行检索和生成操作，在每次迭代中逐步优化结果。如下图所示，在每一步迭代中，系统根据当前的查询和之前的输出结果来检索相关文档，然后使用这些文档生成新的输出。迭代过程通常会设置一个 <strong>最大迭代次数的限制</strong>，以避免出现无限循环。在每次迭代后，判断模块会根据当前的生成结果、历史输出、查询和检索到的文档来决定是否继续迭代。迭代型模式非常适合那些需要逐步收集信息并动态调整的任务，能够逐渐完善对复杂问题的回答。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15f29b8a03dc41b3a660080b41c88dfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819077&amp;x-signature=h9rCC0U58soi%2FNZb2dshiKhMfFE%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>递归型循环模式</strong> 递归型循环模式则是一种具有明显依赖性和层次性的检索方式，如图所示。每一步操作都依赖于前一步的输出，并通过不断深化检索过程，逐步获取更深入的信息。递归型模式通常遵循类似 <strong>树状结构</strong> 的模式，每次检索会基于改写后的查询进一步展开，以精确定位所需的知识。递归型检索具有明确的 <strong>退出机制</strong>，以确保在达到终止条件时流程停止，从而避免无限递归。此模式适用于需要分步推理或逐层分析的任务，能够深入挖掘相关信息并生成高质量的回答。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fbb2086ecc7407b89d4130e43ec960c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819077&amp;x-signature=xh4QZTOLAZx5cYdN6IOyRK1%2FvKw%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>自适应型（主动型）循环模式</strong> 自适应型循环模式是一种超越传统被动检索的方式，得益于大语言模型强大的能力。如图9.16所示，自适应型模式的核心思想是通过智能体的方式动态调整检索流程，主动决定何时进行检索，何时终止流程并生成最终结果。这种模式与传统的固定流程不同，具有更高的 <strong>灵活性</strong> 和 <strong>智能性</strong>。它能够实时根据任务的需求调整策略，判断最佳的执行路径。自适应型检索通常通过两种方法来进一步细分：一是 <strong>基于提示</strong> 的方法，通过设计动态提示来引导模型的检索；二是 <strong>基于指令微调</strong> 的方法，通过微调模型来实现更精准的检索控制。自适应型模式特别适用于复杂任务或动态信息需求的场景，能够提升检索效率和生成质量。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/289c41411a194189bf37cfe537788a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764819077&amp;x-signature=0M4UhUQCz5hbNMlL02uVZ27IJo4%3D" alt="" loading="lazy"/></p>
</li>
</ol>
<h4 data-id="heading-9">循环模式的优势</h4>
<p>通过引入循环结构，<strong>循环模式</strong> 能够让系统在检索与生成的过程中不断优化，逐步提升任务的完成效果。无论是 <strong>迭代型</strong> 的逐步改进，还是 <strong>递归型</strong> 的深度推理，或是 <strong>自适应型</strong> 的智能控制，循环模式都为 <strong>RAG</strong> 系统提供了强大的灵活性和处理能力，能够在面对复杂问题时进行更精确的调整和优化，从而提升生成结果的质量和准确性。</p>
<h3 data-id="heading-10">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangGraph4j LangChain4j JAVA 多Agent编排详解]]></title>    <link>https://juejin.cn/post/7577201863724924928</link>    <guid>https://juejin.cn/post/7577201863724924928</guid>    <pubDate>2025-11-27T03:00:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577201863724924928" data-draft-id="7576867727719858211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangGraph4j LangChain4j JAVA  多Agent编排详解 "/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-27T03:00:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="zhengzizhe"/> <meta itemprop="url" content="https://juejin.cn/user/159867906828928"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangGraph4j LangChain4j JAVA  多Agent编排详解 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/159867906828928/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    zhengzizhe
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T03:00:03.000Z" title="Thu Nov 27 2025 03:00:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    25
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">LangGraph4j 多Agent编排详解：为什么这么做，怎么做</h2>
<h3 data-id="heading-1">引言</h3>
<p>在多Agent系统中，如何协调多个AI Agent协同完成复杂任务是一个核心挑战。本文深入解析基于LangGraph4j的多Agent编排系统，重点阐述<strong>为什么选择这种架构</strong>以及<strong>如何具体实现</strong>。</p>
<hr/>
<h3 data-id="heading-2">一、为什么选择LangGraph4j？</h3>
<h4 data-id="heading-3">1.1 多Agent编排的核心挑战</h4>
<p>在构建多Agent系统时，我们面临以下核心问题：</p>
<ol>
<li><strong>任务依赖管理</strong>：任务A的输出是任务B的输入，如何确保执行顺序？</li>
<li><strong>并行执行优化</strong>：无依赖的任务如何并行执行以提高效率？</li>
<li><strong>状态共享</strong>：多个Agent如何共享中间结果和上下文？</li>
<li><strong>错误处理</strong>：某个Agent失败时，如何不影响其他Agent？</li>
<li><strong>流程可视化</strong>：如何清晰地表达复杂的执行流程？</li>
</ol>
<h4 data-id="heading-4">1.2 LangGraph4j的解决方案</h4>
<p><strong>LangGraph4j</strong>基于**状态图（StateGraph）**的概念，完美解决了上述问题：</p>
<ul>
<li><strong>图结构</strong>：用节点（Node）表示Agent，用边（Edge）表示依赖关系，直观清晰</li>
<li><strong>状态管理</strong>：通过<code>WorkspaceState</code>统一管理所有中间数据，实现Agent间的数据传递</li>
<li><strong>自动调度</strong>：框架自动根据依赖关系调度执行，支持并行和串行混合</li>
<li><strong>错误隔离</strong>：每个节点独立执行，失败不影响其他节点</li>
</ul>
<p><strong>这就是为什么我们选择LangGraph4j</strong>：它提供了声明式的编排方式，让我们专注于业务逻辑而非执行细节。</p>
<hr/>
<h3 data-id="heading-5">二、为什么采用Supervisor-Worker模式？</h3>
<h4 data-id="heading-6">2.1 设计动机</h4>
<p>传统的多Agent系统往往存在以下问题：</p>
<ul>
<li><strong>硬编码流程</strong>：任务流程写死在代码中，无法动态调整</li>
<li><strong>缺乏智能规划</strong>：无法根据任务特点智能分配Agent</li>
<li><strong>扩展性差</strong>：新增Agent需要修改代码</li>
</ul>
<h4 data-id="heading-7">2.2 Supervisor-Worker模式的优势</h4>
<p>我们采用<strong>Supervisor-Worker模式</strong>，核心思想是：</p>
<pre><code class="hljs">Supervisor（主管Agent）
  ↓ 分析用户请求，生成任务计划
TaskPlan（任务计划）
  ↓ 包含任务列表和依赖关系
Workers（工作者Agent）
  ↓ 执行具体任务
结果汇总
</code></pre>
<p><strong>为什么这样设计？</strong></p>
<ol>
<li><strong>动态规划</strong>：Supervisor根据用户请求和可用Agent动态生成计划，无需硬编码</li>
<li><strong>职责分离</strong>：Supervisor负责"思考"（规划），Worker负责"执行"（干活）</li>
<li><strong>易于扩展</strong>：新增Worker只需注册，Supervisor会自动识别并使用</li>
<li><strong>智能调度</strong>：Supervisor了解每个Worker的能力，可以做出最优分配</li>
</ol>
<h4 data-id="heading-8">2.3 具体实现：Orchestrator类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Orchestrator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ServiceNode supervisorNode;      <span class="hljs-comment">// 主管节点</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;ServiceNode&gt; workerNodes;   <span class="hljs-comment">// 工作者节点列表</span>
    
    <span class="hljs-comment">/**
     * 执行流程：规划 → 构建图 → 执行
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(String userRequest, UserContext userContext)</span> {
        <span class="hljs-comment">// Step 1: Supervisor生成任务计划</span>
        <span class="hljs-type">TaskPlan</span> <span class="hljs-variable">taskPlan</span> <span class="hljs-operator">=</span> plan(userRequest, userContext);
        
        <span class="hljs-comment">// Step 2: 根据计划构建执行图</span>
        CompiledGraph&lt;WorkspaceState&gt; graph = buildGraph(taskPlan, userContext);
        
        <span class="hljs-comment">// Step 3: 执行图</span>
        graph.invoke(init);
    }
}
</code></pre>
<p><strong>为什么分三步？</strong></p>
<ul>
<li><strong>plan()</strong>：让Supervisor理解需求并规划，这是"思考"阶段</li>
<li><strong>buildGraph()</strong>：将计划转换为可执行的图结构，这是"准备"阶段</li>
<li><strong>invoke()</strong>：实际执行，这是"行动"阶段</li>
</ul>
<p>这种分离使得每个阶段职责清晰，易于测试和维护。</p>
<hr/>
<h3 data-id="heading-9">三、如何实现任务规划？</h3>
<h4 data-id="heading-10">3.1 为什么需要任务规划？</h4>
<p>用户请求往往是模糊的，比如"帮我写一份市场分析报告"。Supervisor需要：</p>
<ol>
<li><strong>理解需求</strong>：分析用户真正想要什么</li>
<li><strong>任务分解</strong>：将复杂任务拆解为可执行的子任务</li>
<li><strong>分配Agent</strong>：根据任务特点选择合适的Worker</li>
<li><strong>建立依赖</strong>：确定任务间的执行顺序</li>
</ol>
<h4 data-id="heading-11">3.2 如何实现：plan()方法详解</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> TaskPlan <span class="hljs-title function_">plan</span><span class="hljs-params">(String userRequest, UserContext userContext)</span> {
    <span class="hljs-comment">// 1. 构建规划提示词</span>
    <span class="hljs-comment">// 为什么需要这些信息？</span>
    <span class="hljs-comment">// - userRequest: 用户的具体需求</span>
    <span class="hljs-comment">// - subAgents: 可用的Worker列表及其能力，让Supervisor知道"谁能做什么"</span>
    <span class="hljs-comment">// - chatHistory: 历史对话，提供上下文记忆</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">planningPrompt</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
        {
          "userRequest": "%s",
          "subAgents": %s,
          "chatHistory": %s
        }
        """</span>.formatted(userRequest, subWorkersDesc(), historyContext);
    
    <span class="hljs-comment">// 2. 调用Supervisor AI生成计划</span>
    <span class="hljs-comment">// 为什么用流式调用？</span>
    <span class="hljs-comment">// - 可以实时反馈规划进度</span>
    <span class="hljs-comment">// - 支持长文本生成</span>
    <span class="hljs-type">TokenStream</span> <span class="hljs-variable">chat</span> <span class="hljs-operator">=</span> supAi.chat(planningPrompt);
    
    <span class="hljs-comment">// 3. 等待完整响应</span>
    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>);
    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
    
    chat.onCompleteResponse(e -&gt; {
        builder.append(e.aiMessage().text());
        latch.countDown();
    });
    chat.start();
    latch.await();
    
    <span class="hljs-comment">// 4. 解析JSON为TaskPlan对象</span>
    <span class="hljs-comment">// 为什么返回JSON？</span>
    <span class="hljs-comment">// - 结构化数据，易于解析</span>
    <span class="hljs-comment">// - Supervisor可以明确指定任务ID、依赖关系等</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> builder.toString();
    <span class="hljs-type">TaskPlan</span> <span class="hljs-variable">taskPlan</span> <span class="hljs-operator">=</span> JSON.parseObject(response, TaskPlan.class);
    
    <span class="hljs-keyword">return</span> taskPlan;
}
</code></pre>
<h4 data-id="heading-12">3.3 TaskPlan的结构设计</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskPlan</span> {
    <span class="hljs-keyword">private</span> String summary;        <span class="hljs-comment">// 计划摘要：为什么需要？让用户知道Supervisor理解了什么</span>
    <span class="hljs-keyword">private</span> Integer totalTasks;     <span class="hljs-comment">// 总任务数：为什么需要？用于进度跟踪</span>
    <span class="hljs-keyword">private</span> List&lt;Task&gt; tasks;      <span class="hljs-comment">// 任务列表：核心数据</span>
}

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> {
    <span class="hljs-keyword">private</span> String id;                    <span class="hljs-comment">// 任务ID：为什么需要？用于依赖关系标识</span>
    <span class="hljs-keyword">private</span> String title;                 <span class="hljs-comment">// 任务标题：为什么需要？便于理解和调试</span>
    <span class="hljs-keyword">private</span> String description;           <span class="hljs-comment">// 任务描述：为什么需要？Worker需要知道具体做什么</span>
    <span class="hljs-keyword">private</span> String agentId;               <span class="hljs-comment">// 负责的Agent ID：为什么需要？指定执行者</span>
    <span class="hljs-keyword">private</span> TaskInputs inputs;            <span class="hljs-comment">// 输入配置：为什么需要？定义数据来源</span>
    <span class="hljs-keyword">private</span> ExecutionStrategy executionStrategy;  <span class="hljs-comment">// 执行策略：为什么需要？控制输出方式</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskInputs</span> {
    <span class="hljs-keyword">private</span> Boolean fromUser;          <span class="hljs-comment">// 是否来自用户：为什么需要？区分数据来源</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; fromTask;     <span class="hljs-comment">// 依赖的任务ID列表：为什么需要？定义执行顺序</span>
}
</code></pre>
<p><strong>设计要点</strong>：</p>
<ul>
<li><code>fromTask</code>列表定义了依赖关系，这是构建执行图的关键</li>
<li><code>agentId</code>指定执行者，确保任务分配给正确的Worker</li>
<li><code>executionStrategy</code>控制是否流式输出，平衡用户体验和性能</li>
</ul>
<hr/>
<h3 data-id="heading-13">四、如何构建执行图？</h3>
<h4 data-id="heading-14">4.1 为什么需要GraphBuilder？</h4>
<p>TaskPlan只是数据结构，需要转换为可执行的图。GraphBuilder的作用是：</p>
<ol>
<li><strong>创建节点</strong>：为每个任务创建执行节点</li>
<li><strong>建立边</strong>：根据依赖关系连接节点</li>
<li><strong>处理入口出口</strong>：连接START和END节点</li>
</ol>
<h4 data-id="heading-15">4.2 如何实现：GraphBuilder.build()详解</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CompiledGraph&lt;WorkspaceState&gt; <span class="hljs-title function_">build</span><span class="hljs-params">(
    TaskPlan taskPlan,
    Map&lt;String, ServiceNode&gt; workersByID,
    UserContext userContext
)</span> <span class="hljs-keyword">throws</span> GraphStateException {
    
    <span class="hljs-comment">// ========== 第一步：创建状态图 ==========</span>
    <span class="hljs-comment">// 为什么需要状态图？</span>
    <span class="hljs-comment">// - 状态图是LangGraph4j的核心抽象</span>
    <span class="hljs-comment">// - WorkspaceState::new 是状态工厂方法，用于创建初始状态</span>
    StateGraph&lt;WorkspaceState&gt; graph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StateGraph</span>&lt;&gt;(WorkspaceState::<span class="hljs-keyword">new</span>);
    
    <span class="hljs-comment">// ========== 第二步：为每个任务创建节点 ==========</span>
    <span class="hljs-comment">// 为什么需要节点？</span>
    <span class="hljs-comment">// - 节点是图的执行单元，每个节点对应一个Agent任务</span>
    <span class="hljs-keyword">for</span> (Task task : taskPlan.getTasks()) {
        <span class="hljs-comment">// 1. 创建执行器：为什么需要执行器？</span>
        <span class="hljs-comment">// - 执行器封装了具体的执行逻辑（调用AI、处理结果等）</span>
        <span class="hljs-comment">// - ExecutorFactory根据策略创建不同类型的执行器（静默/流式）</span>
        <span class="hljs-type">TaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> ExecutorFactory.create(
            task, 
            workersByID.get(task.getAgentId()),  <span class="hljs-comment">// 根据agentId找到对应的ServiceNode</span>
            userContext
        );
        
        <span class="hljs-comment">// 2. 添加节点到图：为什么用异步执行？</span>
        <span class="hljs-comment">// - CompletableFuture.supplyAsync()实现真正的异步执行</span>
        <span class="hljs-comment">// - 无依赖的任务可以并行执行，提高效率</span>
        <span class="hljs-comment">// - executorService是线程池，管理线程资源</span>
        graph.addNode(task.getId(), state -&gt; {
            <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    log.debug(<span class="hljs-string">"异步执行节点: taskId={}, thread={}"</span>, 
                        task.getId(), Thread.currentThread().getName());
                    <span class="hljs-comment">// executor.apply(state)执行任务，返回更新后的状态</span>
                    <span class="hljs-keyword">return</span> executor.apply(state);
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    log.error(<span class="hljs-string">"节点执行异常: taskId={}"</span>, task.getId(), e);
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"节点执行失败: taskId="</span> + task.getId(), e);
                }
            }, executorService);
        });
    }
    
    <span class="hljs-comment">// ========== 第三步：建立依赖关系（添加边）==========</span>
    <span class="hljs-comment">// 为什么需要边？</span>
    <span class="hljs-comment">// - 边定义了节点间的依赖关系和执行顺序</span>
    <span class="hljs-comment">// - LangGraph4j会根据边自动调度执行</span>
    Map&lt;String, Task.TaskInputs&gt; inputMap = taskPlan.getTasks().stream()
        .collect(Collectors.toMap(Task::getId, Task::getInputs));
    
    Set&lt;String&gt; allTargets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
    <span class="hljs-keyword">for</span> (Map.Entry&lt;String, Task.TaskInputs&gt; entry : inputMap.entrySet()) {
        <span class="hljs-type">String</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> entry.getKey();
        Task.<span class="hljs-type">TaskInputs</span> <span class="hljs-variable">inputs</span> <span class="hljs-operator">=</span> entry.getValue();
        
        <span class="hljs-comment">// 如果任务有前置依赖，添加边</span>
        <span class="hljs-keyword">if</span> (inputs != <span class="hljs-literal">null</span> &amp;&amp; inputs.getFromTask() != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">for</span> (String fromTask : inputs.getFromTask()) {
                <span class="hljs-comment">// 添加边：fromTask → taskId</span>
                <span class="hljs-comment">// 这意味着taskId必须等待fromTask完成后才能执行</span>
                graph.addEdge(fromTask, taskId);
                allTargets.add(taskId);  <span class="hljs-comment">// 记录有前置依赖的节点</span>
            }
        }
    }
    
    <span class="hljs-comment">// ========== 第四步：连接START和END ==========</span>
    <span class="hljs-comment">// 为什么需要START和END？</span>
    <span class="hljs-comment">// - START是图的入口，END是图的出口</span>
    <span class="hljs-comment">// - LangGraph4j需要知道从哪里开始，到哪里结束</span>
    
    <span class="hljs-comment">// 找到根节点（无前置依赖的节点）</span>
    Set&lt;String&gt; allNodes = inputMap.keySet();
    List&lt;String&gt; rootNodes = allNodes.stream()
        .filter(node -&gt; !allTargets.contains(node))  <span class="hljs-comment">// 不在allTargets中的节点就是根节点</span>
        .toList();
    
    <span class="hljs-comment">// 为什么可能有多个根节点？</span>
    <span class="hljs-comment">// - 多个独立的任务可以同时开始</span>
    <span class="hljs-comment">// - 例如：任务A和任务B都只依赖用户输入，可以并行执行</span>
    <span class="hljs-keyword">if</span> (rootNodes.isEmpty()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GraphStateException</span>(<span class="hljs-string">"任务图中没有找到入口任务"</span>);
    }
    
    <span class="hljs-comment">// 连接START到所有根节点</span>
    <span class="hljs-keyword">for</span> (String root : rootNodes) {
        graph.addEdge(StateGraph.START, root);
    }
    
    <span class="hljs-comment">// 找到叶子节点（无后续节点的节点）</span>
    Set&lt;String&gt; nodesWithTargets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
    <span class="hljs-keyword">for</span> (Task task : taskPlan.getTasks()) {
        <span class="hljs-keyword">if</span> (task.getInputs() != <span class="hljs-literal">null</span> &amp;&amp; task.getInputs().getFromTask() != <span class="hljs-literal">null</span>) {
            nodesWithTargets.addAll(task.getInputs().getFromTask());
        }
    }
    
    List&lt;String&gt; leafNodes = allNodes.stream()
        .filter(node -&gt; !nodesWithTargets.contains(node))
        .toList();
    
    <span class="hljs-comment">// 连接所有叶子节点到END</span>
    <span class="hljs-keyword">for</span> (String leaf : leafNodes) {
        graph.addEdge(leaf, StateGraph.END);
    }
    
    <span class="hljs-comment">// ========== 第五步：编译图 ==========</span>
    <span class="hljs-comment">// 为什么需要编译？</span>
    <span class="hljs-comment">// - 编译会优化图结构，检查错误</span>
    <span class="hljs-comment">// - 编译后的图才能执行</span>
    <span class="hljs-keyword">return</span> graph.compile();
}
</code></pre>
<h4 data-id="heading-16">4.3 执行图示例</h4>
<p>假设Supervisor生成了以下计划：</p>
<ul>
<li>Task1（Researcher）：检索资料，依赖用户输入</li>
<li>Task2（Analyst）：分析数据，依赖Task1</li>
<li>Task3（Writer）：写报告，依赖Task2</li>
</ul>
<p>构建的图结构：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">START</span> → Task1 → Task2 → Task3 → <span class="hljs-keyword">END</span>
</code></pre>
<p>如果Task1和Task4都只依赖用户输入：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">START</span> → Task1 ─┐
      → Task4 ─┼→ Task5 → <span class="hljs-keyword">END</span>
</code></pre>
<p>这样Task1和Task4可以并行执行。</p>
<hr/>
<h3 data-id="heading-17">五、如何执行任务？</h3>
<h4 data-id="heading-18">5.1 为什么需要TaskExecutor？</h4>
<p>不同的任务有不同的执行需求：</p>
<ul>
<li><strong>静默任务</strong>：后台处理，结果只保存到state，不向用户输出</li>
<li><strong>流式任务</strong>：实时向用户输出，提供更好的交互体验</li>
</ul>
<h4 data-id="heading-19">5.2 如何实现：执行器模式</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 执行器接口：为什么需要接口？</span>
<span class="hljs-comment">// - 统一执行规范</span>
<span class="hljs-comment">// - 支持多种实现（静默/流式）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TaskExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NodeAction</span>&lt;WorkspaceState&gt; {
    Task <span class="hljs-title function_">getTask</span><span class="hljs-params">()</span>;
    ServiceNode <span class="hljs-title function_">getServiceNode</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 工厂方法：为什么用工厂模式？</span>
<span class="hljs-comment">// - 根据策略动态创建执行器</span>
<span class="hljs-comment">// - 隐藏创建细节</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TaskExecutor <span class="hljs-title function_">create</span><span class="hljs-params">(Task task, ServiceNode serviceNode, UserContext userContext)</span> {
    <span class="hljs-type">ExecutionStrategy</span> <span class="hljs-variable">strategy</span> <span class="hljs-operator">=</span> task.getExecutionStrategy();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">switch</span> (strategy) {
        <span class="hljs-keyword">case</span> SILENT -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">SilentExecutor</span>(task, serviceNode, userContext);
        <span class="hljs-keyword">case</span> STREAMING -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamingExecutor</span>(task, serviceNode, userContext);
        <span class="hljs-keyword">default</span> -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">SilentExecutor</span>(task, serviceNode, userContext);
    };
}
</code></pre>
<h4 data-id="heading-20">5.3 SilentExecutor实现详解</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SilentExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTaskExecutor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">apply</span><span class="hljs-params">(WorkspaceState state)</span> {
        <span class="hljs-comment">// 1. 发送任务开始事件：为什么需要？</span>
        <span class="hljs-comment">// - 让用户知道任务进度</span>
        <span class="hljs-comment">// - 提供可观测性</span>
        userContext.emit(TaskStatusEvent.builder()
            .type(EventType.TASK_START)
            .taskId(task.getId())
            .build());
        
        <span class="hljs-comment">// 2. 获取任务输入：为什么需要？</span>
        <span class="hljs-comment">// - 从state中获取用户输入和依赖任务的结果</span>
        <span class="hljs-comment">// - 组装成完整的输入数据</span>
        Map&lt;String, Object&gt; taskInput = getTaskInput(state);
        
        <span class="hljs-comment">// 3. 调用AI服务：为什么用流式调用？</span>
        <span class="hljs-comment">// - 即使不向用户输出，流式调用也能提供更好的错误处理</span>
        <span class="hljs-comment">// - 可以实时监控AI响应</span>
        <span class="hljs-type">TokenStream</span> <span class="hljs-variable">tokenStream</span> <span class="hljs-operator">=</span> aiService.chat(Json.toJson(taskInput));
        
        <span class="hljs-comment">// 4. 等待完成并收集结果</span>
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">resultBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>);
        
        tokenStream.onCompleteResponse(e -&gt; {
            resultBuilder.append(e.aiMessage().text());
            latch.countDown();
        });
        tokenStream.start();
        latch.await();
        
        <span class="hljs-comment">// 5. 保存结果到state：为什么需要？</span>
        <span class="hljs-comment">// - 后续任务可以从state中获取这个结果</span>
        <span class="hljs-comment">// - 实现任务间的数据传递</span>
        Map&lt;String, Object&gt; stateUpdate = saveTaskResult(state, resultBuilder.toString());
        
        <span class="hljs-comment">// 6. 发送完成事件</span>
        userContext.emit(TaskStatusEvent.builder()
            .type(EventType.TASK_COMPLETE)
            .taskId(task.getId())
            .build());
        
        <span class="hljs-keyword">return</span> stateUpdate;  <span class="hljs-comment">// 返回更新后的状态</span>
    }
}
</code></pre>
<h4 data-id="heading-21">5.4 状态传递机制</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 在BaseTaskExecutor中</span>
<span class="hljs-keyword">protected</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getTaskInput</span><span class="hljs-params">(WorkspaceState state)</span> {
    Map&lt;String, Object&gt; taskInput = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-comment">// 1. 获取用户输入：为什么需要？</span>
    <span class="hljs-comment">// - 某些任务需要直接使用用户输入</span>
    Optional&lt;String&gt; userMessage = state.userMessage();
    <span class="hljs-keyword">if</span> (userMessage.isPresent()) {
        taskInput.put(<span class="hljs-string">"userMessage"</span>, userMessage.get());
    }
    
    <span class="hljs-comment">// 2. 获取依赖任务的输出：为什么需要？</span>
    <span class="hljs-comment">// - 任务可能依赖其他任务的结果</span>
    <span class="hljs-comment">// - 通过taskId从state中获取</span>
    <span class="hljs-type">TaskInputs</span> <span class="hljs-variable">inputs</span> <span class="hljs-operator">=</span> task.getInputs();
    <span class="hljs-keyword">if</span> (inputs != <span class="hljs-literal">null</span> &amp;&amp; inputs.getFromTask() != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">for</span> (String fromTaskId : inputs.getFromTask()) {
            Optional&lt;Map&lt;String, Object&gt;&gt; fromTaskResult = state.value(fromTaskId);
            <span class="hljs-keyword">if</span> (fromTaskResult.isPresent()) {
                <span class="hljs-comment">// 将依赖任务的结果添加到输入中</span>
                taskInput.put(fromTaskId, fromTaskResult.get());
            }
        }
    }
    
    <span class="hljs-keyword">return</span> taskInput;
}

<span class="hljs-comment">// 保存任务结果：为什么需要？</span>
<span class="hljs-comment">// - 后续任务可以通过taskId获取这个结果</span>
<span class="hljs-comment">// - 实现任务间的数据传递</span>
<span class="hljs-keyword">protected</span> Map&lt;String, Object&gt; <span class="hljs-title function_">saveTaskResult</span><span class="hljs-params">(WorkspaceState state, String result)</span> {
    Map&lt;String, Object&gt; stateUpdate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    <span class="hljs-comment">// 以taskId为key保存结果，这样依赖任务可以通过taskId获取</span>
    stateUpdate.put(task.getId(), result);
    <span class="hljs-keyword">return</span> stateUpdate;
}
</code></pre>
<hr/>
<h3 data-id="heading-22">六、完整执行流程</h3>
<h4 data-id="heading-23">6.1 用户请求到结果返回</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/execute")</span>
<span class="hljs-keyword">public</span> Flux&lt;TaskStatusEvent&gt; <span class="hljs-title function_">execute</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> TaskExecuteRequest request)</span> {
    <span class="hljs-comment">// 1. 构建Agent系统：为什么需要？</span>
    <span class="hljs-comment">// - 从数据库加载配置，初始化AI服务</span>
    <span class="hljs-comment">// - 构建Orchestrator实例</span>
    taskExecuteService.buildArmory(request.getOrchestratorId());
    
    <span class="hljs-comment">// 2. 获取Orchestrator：为什么需要？</span>
    <span class="hljs-comment">// - Orchestrator包含了Supervisor和Worker的配置</span>
    <span class="hljs-type">Orchestrator</span> <span class="hljs-variable">orchestrator</span> <span class="hljs-operator">=</span> taskExecuteService.getOrchestrator(request.getOrchestratorId());
    
    <span class="hljs-comment">// 3. 创建用户上下文：为什么需要？</span>
    <span class="hljs-comment">// - 管理SSE事件流</span>
    <span class="hljs-comment">// - 提供用户ID和会话ID用于记忆</span>
    <span class="hljs-type">UserContext</span> <span class="hljs-variable">userContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserContext</span>();
    userContext.setUserId(request.getUserId());
    userContext.setSessionId(request.getSessionId());
    
    <span class="hljs-comment">// 4. 启动事件分发器：为什么需要？</span>
    <span class="hljs-comment">// - 将任务执行过程中的事件推送给前端</span>
    <span class="hljs-comment">// - 实现实时反馈</span>
    userContext.startEventDispatcher(emitter);
    
    <span class="hljs-comment">// 5. 异步执行：为什么异步？</span>
    <span class="hljs-comment">// - 不阻塞HTTP请求线程</span>
    <span class="hljs-comment">// - 通过SSE流式返回结果</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        orchestrator.execute(request.getMessage(), userContext);
        userContext.complete();
    }).start();
    
    <span class="hljs-keyword">return</span> Flux.create(emitter -&gt; {
        <span class="hljs-comment">// SSE事件流</span>
    });
}
</code></pre>
<h4 data-id="heading-24">6.2 执行时序图</h4>
<pre><code class="hljs language-scss" lang="scss">用户请求
  ↓
Controller<span class="hljs-selector-class">.execute</span>()
  ↓
TaskExecuteService<span class="hljs-selector-class">.buildArmory</span>()  <span class="hljs-selector-attr">[构建Agent系统]</span>
  ↓
Orchestrator<span class="hljs-selector-class">.execute</span>()
  ├─→ <span class="hljs-built_in">plan</span>()                      <span class="hljs-selector-attr">[Supervisor生成计划]</span>
  │     ├─→ 构建提示词
  │     ├─→ 调用Supervisor AI
  │     └─→ 解析TaskPlan
  │
  ├─→ <span class="hljs-built_in">buildGraph</span>()                <span class="hljs-selector-attr">[构建执行图]</span>
  │     ├─→ 创建StateGraph
  │     ├─→ 添加节点（TaskExecutor）
  │     ├─→ 添加边（依赖关系）
  │     └─→ 编译图
  │
  └─→ graph<span class="hljs-selector-class">.invoke</span>()              <span class="hljs-selector-attr">[执行图]</span>
        ├─→ START → 根节点
        ├─→ 并行执行无依赖任务
        ├─→ 等待依赖完成
        ├─→ 执行后续任务
        └─→ 叶子节点 → END
</code></pre>
<hr/>
<h3 data-id="heading-25">七、设计要点总结</h3>
<h4 data-id="heading-26">7.1 为什么这样设计？</h4>
<ol>
<li><strong>状态图模式</strong>：用图结构表达复杂的执行流程，直观清晰</li>
<li><strong>Supervisor-Worker模式</strong>：职责分离，Supervisor规划，Worker执行</li>
<li><strong>异步执行</strong>：提高效率，支持并行执行无依赖任务</li>
<li><strong>状态管理</strong>：通过WorkspaceState统一管理数据，实现任务间传递</li>
<li><strong>事件驱动</strong>：通过事件系统提供可观测性</li>
</ol>
<h4 data-id="heading-27">7.2 关键实现技巧</h4>
<ol>
<li><strong>依赖解析</strong>：通过<code>fromTask</code>列表自动构建依赖关系</li>
<li><strong>根节点识别</strong>：找到无前置依赖的节点作为入口</li>
<li><strong>叶子节点识别</strong>：找到无后续节点的节点作为出口</li>
<li><strong>状态传递</strong>：以taskId为key保存结果，依赖任务通过taskId获取</li>
<li><strong>错误隔离</strong>：每个节点独立执行，失败不影响其他节点</li>
</ol>
<hr/>
<h3 data-id="heading-28">总结</h3>
<p>本文深入解析了基于LangGraph4j的多Agent编排系统，重点阐述了：</p>
<ol>
<li><strong>为什么选择LangGraph4j</strong>：解决任务依赖、并行执行、状态共享等核心问题</li>
<li><strong>为什么采用Supervisor-Worker模式</strong>：实现动态规划、职责分离、易于扩展</li>
<li><strong>如何实现任务规划</strong>：Supervisor分析需求，生成结构化的TaskPlan</li>
<li><strong>如何构建执行图</strong>：GraphBuilder将TaskPlan转换为可执行的StateGraph</li>
<li><strong>如何执行任务</strong>：TaskExecutor封装执行逻辑，支持静默和流式两种模式</li>
</ol>
<p>通过这种设计，我们实现了<strong>声明式的多Agent编排</strong>，让复杂的多Agent协作变得简单可控。</p>
<hr/>
<p><strong>关键代码位置</strong>：</p>
<ul>
<li><code>Orchestrator.java</code>: 编排器核心逻辑</li>
<li><code>GraphBuilder.java</code>: 图构建实现</li>
<li><code>TaskExecutor.java</code>: 任务执行器接口</li>
<li><code>WorkspaceState.java</code>: 状态管理</li>
<li><code>TaskExecuteController.java</code>: REST API入口</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>