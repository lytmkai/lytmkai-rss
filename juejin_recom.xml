<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[OpenSpec的核心创新-Artifact Graph剖析]]></title>    <link>https://juejin.cn/post/7600681071715106816</link>    <guid>https://juejin.cn/post/7600681071715106816</guid>    <pubDate>2026-01-30T05:49:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600681071715106816" data-draft-id="7600704706551398440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenSpec的核心创新-Artifact Graph剖析"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-30T05:49:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鱼疯而行"/> <meta itemprop="url" content="https://juejin.cn/user/4425979920129392"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenSpec的核心创新-Artifact Graph剖析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4425979920129392/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鱼疯而行
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:49:07.000Z" title="Fri Jan 30 2026 05:49:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2. Artifact Graph 系统</h2>
<h3 data-id="heading-1">概述</h3>
<p>Artifact Graph 是 OpenSpec 的核心创新，它将文档创建过程建模为<strong>有向无环图（DAG）</strong>，自动管理工件之间的依赖关系。</p>
<h3 data-id="heading-2">核心概念</h3>
<h4 data-id="heading-3">什么是 Artifact？</h4>
<p><strong>Artifact（工件）</strong> 是工作流中需要创建的一个文档或文件。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Artifact</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;              <span class="hljs-comment">// 唯一标识，如 "proposal"</span>
  <span class="hljs-attr">generates</span>: <span class="hljs-built_in">string</span>;       <span class="hljs-comment">// 生成的文件路径，如 "proposal.md"</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>;     <span class="hljs-comment">// 描述</span>
  <span class="hljs-attr">template</span>: <span class="hljs-built_in">string</span>;        <span class="hljs-comment">// 模板文件名</span>
  instruction?: <span class="hljs-built_in">string</span>;    <span class="hljs-comment">// AI 生成指令</span>
  <span class="hljs-attr">requires</span>: <span class="hljs-built_in">string</span>[];      <span class="hljs-comment">// 依赖的其他工件 ID</span>
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">proposal</span>
  <span class="hljs-attr">generates:</span> <span class="hljs-string">proposal.md</span>
  <span class="hljs-attr">description:</span> <span class="hljs-string">Initial</span> <span class="hljs-string">proposal</span> <span class="hljs-string">document</span>
  <span class="hljs-attr">template:</span> <span class="hljs-string">proposal.md</span>
  <span class="hljs-attr">requires:</span> []  <span class="hljs-comment"># 无依赖，可以直接开始</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">specs</span>
  <span class="hljs-attr">generates:</span> <span class="hljs-string">"specs/**/*.md"</span>  <span class="hljs-comment"># 支持 glob 模式</span>
  <span class="hljs-attr">description:</span> <span class="hljs-string">Detailed</span> <span class="hljs-string">specifications</span>
  <span class="hljs-attr">template:</span> <span class="hljs-string">spec.md</span>
  <span class="hljs-attr">requires:</span> [<span class="hljs-string">proposal</span>]  <span class="hljs-comment"># 依赖 proposal</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">tasks</span>
  <span class="hljs-attr">generates:</span> <span class="hljs-string">tasks.md</span>
  <span class="hljs-attr">description:</span> <span class="hljs-string">Implementation</span> <span class="hljs-string">checklist</span>
  <span class="hljs-attr">template:</span> <span class="hljs-string">tasks.md</span>
  <span class="hljs-attr">requires:</span> [<span class="hljs-string">specs</span>, <span class="hljs-string">design</span>]  <span class="hljs-comment"># 依赖多个工件</span>
</code></pre>
<h4 data-id="heading-4">依赖图可视化</h4>
<pre><code class="hljs language-scss" lang="scss">    proposal (无依赖)
    /      \
specs    design (并行，都依赖 proposal)
    \      /
     tasks (依赖 specs 和 design)
</code></pre>
<h3 data-id="heading-5">核心类：ArtifactGraph</h3>
<h4 data-id="heading-6">类结构</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArtifactGraph</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">artifacts</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Artifact</span>&gt;;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">schema</span>: <span class="hljs-title class_">SchemaYaml</span>;

  <span class="hljs-comment">// 构造函数（私有）</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">schema: SchemaYaml</span>);

  <span class="hljs-comment">// 工厂方法</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">fromYaml</span>(<span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">ArtifactGraph</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">fromYamlContent</span>(<span class="hljs-attr">yamlContent</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">ArtifactGraph</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">fromSchema</span>(<span class="hljs-attr">schema</span>: <span class="hljs-title class_">SchemaYaml</span>): <span class="hljs-title class_">ArtifactGraph</span>;

  <span class="hljs-comment">// 查询方法</span>
  <span class="hljs-title function_">getArtifact</span>(<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Artifact</span> | <span class="hljs-literal">undefined</span>;
  <span class="hljs-title function_">getAllArtifacts</span>(): <span class="hljs-title class_">Artifact</span>[];
  <span class="hljs-title function_">getName</span>(): <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">getVersion</span>(): <span class="hljs-built_in">number</span>;

  <span class="hljs-comment">// 核心算法</span>
  <span class="hljs-title function_">getBuildOrder</span>(): <span class="hljs-built_in">string</span>[];
  <span class="hljs-title function_">getNextArtifacts</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-built_in">string</span>[];
  <span class="hljs-title function_">isComplete</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-built_in">boolean</span>;
  <span class="hljs-title function_">getBlocked</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-title class_">BlockedArtifacts</span>;
}
</code></pre>
<h4 data-id="heading-7">核心算法详解</h4>
<h5 data-id="heading-8">1. 拓扑排序 (Kahn's Algorithm)</h5>
<p><strong>目的：</strong> 计算工件的构建顺序</p>
<p><strong>算法实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">getBuildOrder</span>(): <span class="hljs-built_in">string</span>[] {
  <span class="hljs-comment">// 步骤 1: 初始化入度表和依赖表</span>
  <span class="hljs-keyword">const</span> inDegree = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt;();
  <span class="hljs-keyword">const</span> dependents = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>[]&gt;();

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">values</span>()) {
    <span class="hljs-comment">// 入度 = 依赖的数量</span>
    inDegree.<span class="hljs-title function_">set</span>(artifact.<span class="hljs-property">id</span>, artifact.<span class="hljs-property">requires</span>.<span class="hljs-property">length</span>);
    dependents.<span class="hljs-title function_">set</span>(artifact.<span class="hljs-property">id</span>, []);
  }

  <span class="hljs-comment">// 步骤 2: 构建反向依赖图（谁依赖我）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">values</span>()) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> req <span class="hljs-keyword">of</span> artifact.<span class="hljs-property">requires</span>) {
      dependents.<span class="hljs-title function_">get</span>(req)!.<span class="hljs-title function_">push</span>(artifact.<span class="hljs-property">id</span>);
    }
  }

  <span class="hljs-comment">// 步骤 3: 找到所有入度为 0 的节点（无依赖）</span>
  <span class="hljs-keyword">const</span> queue = [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">keys</span>()]
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> inDegree.<span class="hljs-title function_">get</span>(id) === <span class="hljs-number">0</span>)
    .<span class="hljs-title function_">sort</span>();  <span class="hljs-comment">// 排序保证确定性</span>

  <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">string</span>[] = [];

  <span class="hljs-comment">// 步骤 4: BFS 遍历</span>
  <span class="hljs-keyword">while</span> (queue.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> current = queue.<span class="hljs-title function_">shift</span>()!;
    result.<span class="hljs-title function_">push</span>(current);

    <span class="hljs-comment">// 减少依赖者的入度</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">newlyReady</span>: <span class="hljs-built_in">string</span>[] = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> dep <span class="hljs-keyword">of</span> dependents.<span class="hljs-title function_">get</span>(current)!) {
      <span class="hljs-keyword">const</span> newDegree = inDegree.<span class="hljs-title function_">get</span>(dep)! - <span class="hljs-number">1</span>;
      inDegree.<span class="hljs-title function_">set</span>(dep, newDegree);
      
      <span class="hljs-comment">// 入度变为 0，加入队列</span>
      <span class="hljs-keyword">if</span> (newDegree === <span class="hljs-number">0</span>) {
        newlyReady.<span class="hljs-title function_">push</span>(dep);
      }
    }
    
    queue.<span class="hljs-title function_">push</span>(...newlyReady.<span class="hljs-title function_">sort</span>());
  }

  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p><strong>示例执行：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">初始状态:</span>
  <span class="hljs-attr">inDegree:</span> { <span class="hljs-attr">proposal:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">specs:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">design:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">tasks:</span> <span class="hljs-number">2</span> }
  <span class="hljs-attr">queue:</span> [<span class="hljs-string">proposal</span>]

<span class="hljs-string">迭代</span> <span class="hljs-attr">1:</span>
  <span class="hljs-string">处理:</span> <span class="hljs-string">proposal</span>
  <span class="hljs-string">更新:</span> <span class="hljs-string">specs</span> <span class="hljs-string">(1→0),</span> <span class="hljs-string">design</span> <span class="hljs-string">(1→0)</span>
  <span class="hljs-attr">queue:</span> [<span class="hljs-string">design</span>, <span class="hljs-string">specs</span>]  <span class="hljs-comment"># 排序后</span>
  <span class="hljs-attr">result:</span> [<span class="hljs-string">proposal</span>]

<span class="hljs-string">迭代</span> <span class="hljs-attr">2:</span>
  <span class="hljs-string">处理:</span> <span class="hljs-string">design</span>
  <span class="hljs-string">更新:</span> <span class="hljs-string">tasks</span> <span class="hljs-string">(2→1)</span>
  <span class="hljs-attr">queue:</span> [<span class="hljs-string">specs</span>]
  <span class="hljs-attr">result:</span> [<span class="hljs-string">proposal</span>, <span class="hljs-string">design</span>]

<span class="hljs-string">迭代</span> <span class="hljs-attr">3:</span>
  <span class="hljs-string">处理:</span> <span class="hljs-string">specs</span>
  <span class="hljs-string">更新:</span> <span class="hljs-string">tasks</span> <span class="hljs-string">(1→0)</span>
  <span class="hljs-attr">queue:</span> [<span class="hljs-string">tasks</span>]
  <span class="hljs-attr">result:</span> [<span class="hljs-string">proposal</span>, <span class="hljs-string">design</span>, <span class="hljs-string">specs</span>]

<span class="hljs-string">迭代</span> <span class="hljs-attr">4:</span>
  <span class="hljs-string">处理:</span> <span class="hljs-string">tasks</span>
  <span class="hljs-attr">queue:</span> []
  <span class="hljs-attr">result:</span> [<span class="hljs-string">proposal</span>, <span class="hljs-string">design</span>, <span class="hljs-string">specs</span>, <span class="hljs-string">tasks</span>]
</code></pre>
<p><strong>时间复杂度：</strong> O(V + E)，其中 V 是工件数，E 是依赖边数</p>
<h5 data-id="heading-9">2. 查找可执行工件</h5>
<p><strong>目的：</strong> 找出所有依赖已满足的工件</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">getNextArtifacts</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-built_in">string</span>[] {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">ready</span>: <span class="hljs-built_in">string</span>[] = [];

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">values</span>()) {
    <span class="hljs-comment">// 跳过已完成的</span>
    <span class="hljs-keyword">if</span> (completed.<span class="hljs-title function_">has</span>(artifact.<span class="hljs-property">id</span>)) {
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-comment">// 检查所有依赖是否都已完成</span>
    <span class="hljs-keyword">const</span> allDepsCompleted = artifact.<span class="hljs-property">requires</span>.<span class="hljs-title function_">every</span>(
      <span class="hljs-function"><span class="hljs-params">req</span> =&gt;</span> completed.<span class="hljs-title function_">has</span>(req)
    );

    <span class="hljs-keyword">if</span> (allDepsCompleted) {
      ready.<span class="hljs-title function_">push</span>(artifact.<span class="hljs-property">id</span>);
    }
  }

  <span class="hljs-keyword">return</span> ready.<span class="hljs-title function_">sort</span>();  <span class="hljs-comment">// 排序保证确定性</span>
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 假设 completed = { proposal }</span>
<span class="hljs-title function_">getNextArtifacts</span>(completed)
<span class="hljs-comment">// 返回: [design, specs]  // 两者都只依赖 proposal</span>

<span class="hljs-comment">// 假设 completed = { proposal, specs, design }</span>
<span class="hljs-title function_">getNextArtifacts</span>(completed)
<span class="hljs-comment">// 返回: [tasks]  // tasks 依赖 specs 和 design</span>
</code></pre>
<h5 data-id="heading-10">3. 检查完成状态</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">isComplete</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">values</span>()) {
    <span class="hljs-keyword">if</span> (!completed.<span class="hljs-title function_">has</span>(artifact.<span class="hljs-property">id</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h5 data-id="heading-11">4. 查找阻塞工件</h5>
<p><strong>目的：</strong> 找出被阻塞的工件及其未满足的依赖</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">getBlocked</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-title class_">BlockedArtifacts</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">blocked</span>: <span class="hljs-title class_">BlockedArtifacts</span> = {};

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">values</span>()) {
    <span class="hljs-comment">// 跳过已完成的</span>
    <span class="hljs-keyword">if</span> (completed.<span class="hljs-title function_">has</span>(artifact.<span class="hljs-property">id</span>)) {
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-comment">// 找出未满足的依赖</span>
    <span class="hljs-keyword">const</span> unmetDeps = artifact.<span class="hljs-property">requires</span>.<span class="hljs-title function_">filter</span>(
      <span class="hljs-function"><span class="hljs-params">req</span> =&gt;</span> !completed.<span class="hljs-title function_">has</span>(req)
    );

    <span class="hljs-keyword">if</span> (unmetDeps.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      blocked[artifact.<span class="hljs-property">id</span>] = unmetDeps.<span class="hljs-title function_">sort</span>();
    }
  }

  <span class="hljs-keyword">return</span> blocked;
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 假设 completed = { proposal }</span>
<span class="hljs-title function_">getBlocked</span>(completed)
<span class="hljs-comment">// 返回: { tasks: ['design', 'specs'] }</span>
<span class="hljs-comment">// tasks 被 design 和 specs 阻塞</span>
</code></pre>
<h3 data-id="heading-12">Schema 解析</h3>
<h4 data-id="heading-13">Schema 文件格式</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">spec-driven</span>
<span class="hljs-attr">version:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">Default</span> <span class="hljs-string">OpenSpec</span> <span class="hljs-string">workflow</span>
<span class="hljs-attr">artifacts:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">proposal</span>
    <span class="hljs-attr">generates:</span> <span class="hljs-string">proposal.md</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">Initial</span> <span class="hljs-string">proposal</span>
    <span class="hljs-attr">template:</span> <span class="hljs-string">proposal.md</span>
    <span class="hljs-attr">instruction:</span> <span class="hljs-string">|
      Create the proposal document...
</span>    <span class="hljs-attr">requires:</span> []

  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">specs</span>
    <span class="hljs-attr">generates:</span> <span class="hljs-string">"specs/**/*.md"</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">Detailed</span> <span class="hljs-string">specifications</span>
    <span class="hljs-attr">template:</span> <span class="hljs-string">spec.md</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">proposal</span>]

<span class="hljs-attr">apply:</span>
  <span class="hljs-attr">requires:</span> [<span class="hljs-string">tasks</span>]
  <span class="hljs-attr">tracks:</span> <span class="hljs-string">tasks.md</span>
  <span class="hljs-attr">instruction:</span> <span class="hljs-string">|
    Implement tasks...
</span></code></pre>
<h4 data-id="heading-14">解析流程</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">parseSchema</span>(<span class="hljs-params">yamlContent: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">SchemaYaml</span> {
  <span class="hljs-comment">// 1. 解析 YAML</span>
  <span class="hljs-keyword">const</span> parsed = <span class="hljs-title function_">parseYaml</span>(yamlContent);

  <span class="hljs-comment">// 2. Zod 验证</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">SchemaYamlSchema</span>.<span class="hljs-title function_">safeParse</span>(parsed);
  <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">success</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchemaValidationError</span>(<span class="hljs-title function_">formatErrors</span>(result.<span class="hljs-property">error</span>));
  }

  <span class="hljs-keyword">const</span> schema = result.<span class="hljs-property">data</span>;

  <span class="hljs-comment">// 3. 业务规则验证</span>
  <span class="hljs-title function_">validateNoDuplicateIds</span>(schema.<span class="hljs-property">artifacts</span>);
  <span class="hljs-title function_">validateRequiresReferences</span>(schema.<span class="hljs-property">artifacts</span>);
  <span class="hljs-title function_">validateNoCycles</span>(schema.<span class="hljs-property">artifacts</span>);

  <span class="hljs-keyword">return</span> schema;
}
</code></pre>
<h4 data-id="heading-15">循环依赖检测</h4>
<p><strong>使用 DFS 检测环：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">validateNoCycles</span>(<span class="hljs-params">artifacts: Artifact[]</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> artifactMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(artifacts.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> [a.<span class="hljs-property">id</span>, a]));
  <span class="hljs-keyword">const</span> visited = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;();
  <span class="hljs-keyword">const</span> inStack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;();  <span class="hljs-comment">// 当前 DFS 路径</span>
  <span class="hljs-keyword">const</span> parent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;();

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> {
    visited.<span class="hljs-title function_">add</span>(id);
    inStack.<span class="hljs-title function_">add</span>(id);

    <span class="hljs-keyword">const</span> artifact = artifactMap.<span class="hljs-title function_">get</span>(id);
    <span class="hljs-keyword">if</span> (!artifact) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> dep <span class="hljs-keyword">of</span> artifact.<span class="hljs-property">requires</span>) {
      <span class="hljs-keyword">if</span> (!visited.<span class="hljs-title function_">has</span>(dep)) {
        parent.<span class="hljs-title function_">set</span>(dep, id);
        <span class="hljs-keyword">const</span> cycle = <span class="hljs-title function_">dfs</span>(dep);
        <span class="hljs-keyword">if</span> (cycle) <span class="hljs-keyword">return</span> cycle;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (inStack.<span class="hljs-title function_">has</span>(dep)) {
        <span class="hljs-comment">// 发现环！重建路径</span>
        <span class="hljs-keyword">const</span> cyclePath = [dep];
        <span class="hljs-keyword">let</span> current = id;
        <span class="hljs-keyword">while</span> (current !== dep) {
          cyclePath.<span class="hljs-title function_">unshift</span>(current);
          current = parent.<span class="hljs-title function_">get</span>(current)!;
        }
        cyclePath.<span class="hljs-title function_">unshift</span>(dep);
        <span class="hljs-keyword">return</span> cyclePath.<span class="hljs-title function_">join</span>(<span class="hljs-string">' → '</span>);
      }
    }

    inStack.<span class="hljs-title function_">delete</span>(id);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-comment">// 检查所有连通分量</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> artifacts) {
    <span class="hljs-keyword">if</span> (!visited.<span class="hljs-title function_">has</span>(artifact.<span class="hljs-property">id</span>)) {
      <span class="hljs-keyword">const</span> cycle = <span class="hljs-title function_">dfs</span>(artifact.<span class="hljs-property">id</span>);
      <span class="hljs-keyword">if</span> (cycle) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchemaValidationError</span>(
          <span class="hljs-string">`Cyclic dependency detected: <span class="hljs-subst">${cycle}</span>`</span>
        );
      }
    }
  }
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 错误的 Schema（有环）</span>
<span class="hljs-attr">artifacts:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">a</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">b</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">b</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">c</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">c</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">a</span>]  <span class="hljs-comment"># 环！</span>

<span class="hljs-comment"># 错误信息：</span>
<span class="hljs-comment"># Cyclic dependency detected: a → b → c → a</span>
</code></pre>
<h3 data-id="heading-16">状态检测</h3>
<h4 data-id="heading-17">基于文件系统的状态</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">detectCompleted</span>(<span class="hljs-params">
  graph: ArtifactGraph,
  changeDir: <span class="hljs-built_in">string</span>
</span>): <span class="hljs-title class_">CompletedSet</span> {
  <span class="hljs-keyword">const</span> completed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;();

  <span class="hljs-comment">// 检查目录是否存在</span>
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(changeDir)) {
    <span class="hljs-keyword">return</span> completed;
  }

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> graph.<span class="hljs-title function_">getAllArtifacts</span>()) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isArtifactComplete</span>(artifact.<span class="hljs-property">generates</span>, changeDir)) {
      completed.<span class="hljs-title function_">add</span>(artifact.<span class="hljs-property">id</span>);
    }
  }

  <span class="hljs-keyword">return</span> completed;
}
</code></pre>
<h4 data-id="heading-18">Glob 模式支持</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isArtifactComplete</span>(<span class="hljs-params">
  generates: <span class="hljs-built_in">string</span>,
  changeDir: <span class="hljs-built_in">string</span>
</span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">const</span> fullPattern = path.<span class="hljs-title function_">join</span>(changeDir, generates);

  <span class="hljs-comment">// 检查是否是 glob 模式</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isGlobPattern</span>(generates)) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">hasGlobMatches</span>(fullPattern);
  }

  <span class="hljs-comment">// 简单文件路径</span>
  <span class="hljs-keyword">return</span> fs.<span class="hljs-title function_">existsSync</span>(fullPattern);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isGlobPattern</span>(<span class="hljs-params">pattern: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">return</span> pattern.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'*'</span>) || 
         pattern.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'?'</span>) || 
         pattern.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'['</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">hasGlobMatches</span>(<span class="hljs-params">pattern: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">const</span> normalizedPattern = <span class="hljs-title class_">FileSystemUtils</span>.<span class="hljs-title function_">toPosixPath</span>(pattern);
  <span class="hljs-keyword">const</span> matches = fg.<span class="hljs-title function_">sync</span>(normalizedPattern, { <span class="hljs-attr">onlyFiles</span>: <span class="hljs-literal">true</span> });
  <span class="hljs-keyword">return</span> matches.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 简单文件</span>
<span class="hljs-attr">generates</span>: <span class="hljs-string">"proposal.md"</span>
<span class="hljs-comment">// 检查: openspec/changes/add-auth/proposal.md 是否存在</span>

<span class="hljs-comment">// Glob 模式</span>
<span class="hljs-attr">generates</span>: <span class="hljs-string">"specs/**/*.md"</span>
<span class="hljs-comment">// 检查: openspec/changes/add-auth/specs/ 下是否有 .md 文件</span>
</code></pre>
<h3 data-id="heading-19">使用示例</h3>
<h4 data-id="heading-20">创建依赖图</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 从文件加载</span>
<span class="hljs-keyword">const</span> graph = <span class="hljs-title class_">ArtifactGraph</span>.<span class="hljs-title function_">fromYaml</span>(<span class="hljs-string">'schemas/spec-driven/schema.yaml'</span>);

<span class="hljs-comment">// 从内容加载</span>
<span class="hljs-keyword">const</span> yamlContent = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'schema.yaml'</span>, <span class="hljs-string">'utf-8'</span>);
<span class="hljs-keyword">const</span> graph = <span class="hljs-title class_">ArtifactGraph</span>.<span class="hljs-title function_">fromYamlContent</span>(yamlContent);

<span class="hljs-comment">// 从已解析的 Schema</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-title function_">parseSchema</span>(yamlContent);
<span class="hljs-keyword">const</span> graph = <span class="hljs-title class_">ArtifactGraph</span>.<span class="hljs-title function_">fromSchema</span>(schema);
</code></pre>
<h4 data-id="heading-21">查询工件信息</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 获取单个工件</span>
<span class="hljs-keyword">const</span> proposal = graph.<span class="hljs-title function_">getArtifact</span>(<span class="hljs-string">'proposal'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proposal.<span class="hljs-property">description</span>);

<span class="hljs-comment">// 获取所有工件</span>
<span class="hljs-keyword">const</span> allArtifacts = graph.<span class="hljs-title function_">getAllArtifacts</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Total artifacts: <span class="hljs-subst">${allArtifacts.length}</span>`</span>);

<span class="hljs-comment">// 获取构建顺序</span>
<span class="hljs-keyword">const</span> buildOrder = graph.<span class="hljs-title function_">getBuildOrder</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Build order:'</span>, buildOrder);
<span class="hljs-comment">// 输出: ['proposal', 'design', 'specs', 'tasks']</span>
</code></pre>
<h4 data-id="heading-22">工作流控制</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 检测已完成的工件</span>
<span class="hljs-keyword">const</span> completed = <span class="hljs-title function_">detectCompleted</span>(graph, changeDir);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Completed:'</span>, <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(completed));

<span class="hljs-comment">// 查找下一步可执行的工件</span>
<span class="hljs-keyword">const</span> next = graph.<span class="hljs-title function_">getNextArtifacts</span>(completed);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Ready to create:'</span>, next);

<span class="hljs-comment">// 检查是否全部完成</span>
<span class="hljs-keyword">if</span> (graph.<span class="hljs-title function_">isComplete</span>(completed)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'All artifacts complete!'</span>);
}

<span class="hljs-comment">// 查看阻塞状态</span>
<span class="hljs-keyword">const</span> blocked = graph.<span class="hljs-title function_">getBlocked</span>(completed);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [id, deps] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(blocked)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${id}</span> is blocked by: <span class="hljs-subst">${deps.join(<span class="hljs-string">', '</span>)}</span>`</span>);
}
</code></pre>
<h3 data-id="heading-23">设计优势</h3>
<h4 data-id="heading-24">1. 声明式依赖管理</h4>
<p><strong>传统方式（硬编码）：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 硬编码的顺序</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createArtifacts</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">createProposal</span>();
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">createSpecs</span>();
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">createDesign</span>();
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">createTasks</span>();
}
</code></pre>
<p><strong>Artifact Graph 方式：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 声明依赖关系</span>
<span class="hljs-attr">artifacts:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">specs</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">proposal</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">design</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">proposal</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">tasks</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">specs</span>, <span class="hljs-string">design</span>]
</code></pre>
<p><strong>优势：</strong></p>
<ul>
<li>依赖关系清晰可见</li>
<li>自动计算执行顺序</li>
<li>支持并行执行（specs 和 design）</li>
</ul>
<h4 data-id="heading-25">2. 灵活的工作流</h4>
<p><strong>支持多种工作流模式：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 线性工作流</span>
<span class="hljs-string">proposal</span> <span class="hljs-string">→</span> <span class="hljs-string">specs</span> <span class="hljs-string">→</span> <span class="hljs-string">design</span> <span class="hljs-string">→</span> <span class="hljs-string">tasks</span>

<span class="hljs-comment"># 并行工作流</span>
<span class="hljs-string">proposal</span> <span class="hljs-string">→</span> <span class="hljs-string">(specs</span> <span class="hljs-string">+</span> <span class="hljs-string">design)</span> <span class="hljs-string">→</span> <span class="hljs-string">tasks</span>

<span class="hljs-comment"># 复杂工作流</span>
<span class="hljs-string">proposal</span> <span class="hljs-string">→</span> <span class="hljs-string">specs</span> <span class="hljs-string">→</span> <span class="hljs-string">(design</span> <span class="hljs-string">+</span> <span class="hljs-string">tests)</span> <span class="hljs-string">→</span> <span class="hljs-string">implementation</span> <span class="hljs-string">→</span> <span class="hljs-string">docs</span>
</code></pre>
<h4 data-id="heading-26">3. 可扩展性</h4>
<p><strong>添加新工件无需修改代码：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 添加新的工件类型</span>
<span class="hljs-attr">artifacts:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">security-review</span>
    <span class="hljs-attr">generates:</span> <span class="hljs-string">security-review.md</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">design</span>]
  
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">tasks</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">specs</span>, <span class="hljs-string">design</span>, <span class="hljs-string">security-review</span>]  <span class="hljs-comment"># 更新依赖</span>
</code></pre>
<h3 data-id="heading-27">性能考虑</h3>
<h4 data-id="heading-28">时间复杂度</h4>






























<table><thead><tr><th>操作</th><th>复杂度</th><th>说明</th></tr></thead><tbody><tr><td>getBuildOrder</td><td>O(V + E)</td><td>V=工件数, E=依赖边数</td></tr><tr><td>getNextArtifacts</td><td>O(V × D)</td><td>D=平均依赖数</td></tr><tr><td>isComplete</td><td>O(V)</td><td>遍历所有工件</td></tr><tr><td>getBlocked</td><td>O(V × D)</td><td>遍历并检查依赖</td></tr></tbody></table>
<h4 data-id="heading-29">空间复杂度</h4>
<ul>
<li>依赖图存储：O(V + E)</li>
<li>完成状态：O(V)</li>
</ul>
<h4 data-id="heading-30">优化策略</h4>
<ol>
<li><strong>缓存构建顺序</strong> - 构建顺序不变，可以缓存</li>
<li><strong>增量更新</strong> - 只检查状态变化的工件</li>
<li><strong>并行检测</strong> - 文件存在性检查可以并行</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1秒处理1亿行，这8个Python库彻底让Excel消失]]></title>    <link>https://juejin.cn/post/7600705962248781833</link>    <guid>https://juejin.cn/post/7600705962248781833</guid>    <pubDate>2026-01-30T05:53:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600705962248781833" data-draft-id="7600764857769361458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1秒处理1亿行，这8个Python库彻底让Excel消失"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2026-01-30T05:53:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="该用户已不存在"/> <meta itemprop="url" content="https://juejin.cn/user/64217584778579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1秒处理1亿行，这8个Python库彻底让Excel消失
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/64217584778579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    该用户已不存在
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:53:59.000Z" title="Fri Jan 30 2026 05:53:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>处理数据的时候，我发现 Excel 有时候不好用，不是说它的功能不好用，而是它的隐形转换和不可复现输在起跑线上了。日期格式错乱、大文件卡死、逻辑难以追踪，这些问题在工程化项目中是致命的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2068b236b3014946bfda1c71a8d862af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357239&amp;x-signature=kW7UYN855hrntvZiz%2FvsvBhMc1U%3D" alt="" loading="lazy"/></p>
<p>所以，我整理了一套 Python 工具栈。它们不搞花哨的噱头，只解决具体的问题。</p>
<h3 data-id="heading-0">DuckDB：轻松搞定亿级数据</h3>
<p>如果在单机上处理几百兆到几 GB 的数据，Pandas 的内存占用简直让我抓狂。DuckDB 的出现填补了 SQLite 和分布式数据库之间的空白。它是一个进程内的 OLAP 数据库，最大的特点是零配置和向量化计算。</p>
<p>DuckDB 可以直接对 CSV、Parquet 或 JSON 文件执行 SQL 查询，无需将数据全部加载到内存。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> duckdb

<span class="hljs-comment"># 直接对 Parquet 文件执行 SQL，无需建库建表</span>
<span class="hljs-comment"># 这里的 query 类似于 Pandas 的 dataframe，但计算是在 DuckDB 引擎中完成的</span>
result = duckdb.sql(<span class="hljs-string">"""
    SELECT 
        department, 
        AVG(salary) as avg_salary 
    FROM 'employees.parquet' 
    WHERE join_date &gt; '2022-01-01'
    GROUP BY department
    ORDER BY avg_salary DESC
"""</span>).df()

<span class="hljs-built_in">print</span>(result)
</code></pre>
<h3 data-id="heading-1">Ibis：写一次代码，到处运行</h3>
<p>Ibis 和 DuckDB 是目前数据工程领域的黄金搭档。</p>
<p>Ibis 将业务逻辑与执行引擎分离，这也是它的核心。可以使用类似 Pandas 的 Python API 来编写查询逻辑，后端可以无缝切换为 DuckDB、ClickHouse、BigQuery 甚至是 PySpark。</p>
<p>使用 Ibis 驱动 DuckDB 时，既享受了 Python 代码的优雅和类型检查，又利用了 DuckDB 极速的执行引擎。一举两得，棒棒哒。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> ibis

<span class="hljs-comment"># 连接到 DuckDB 后端（也可以是 SQLite, Postgres 等）</span>
con = ibis.duckdb.connect()

<span class="hljs-comment"># 惰性读取数据，此时并未真正加载</span>
table = con.read_csv(<span class="hljs-string">"sales_data.csv"</span>)

<span class="hljs-comment"># 构建查询表达式</span>
expr = (
    table.<span class="hljs-built_in">filter</span>(table[<span class="hljs-string">"status"</span>] == <span class="hljs-string">"completed"</span>)
         .group_by(<span class="hljs-string">"region"</span>)
         .aggregate(total_revenue=table[<span class="hljs-string">"amount"</span>].<span class="hljs-built_in">sum</span>())
         .order_by(ibis.desc(<span class="hljs-string">"total_revenue"</span>))
)

<span class="hljs-comment"># 只有调用 execute() 时才会生成 SQL 并执行</span>
<span class="hljs-built_in">print</span>(expr.execute())
</code></pre>
<h3 data-id="heading-2">Polars：多线程时代的 DataFrame</h3>
<p>Pandas 是单线程的，而 Polars 是用 Rust 编写的，天生支持并行计算。在处理大规模数据集时，Polars 的速度通常比 Pandas 快数倍。</p>
<p>它的设计理念采用了“惰性求值”（Lazy Evaluation），先构建查询计划，经优化器优化后再执行，这能极大减少内存开销。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> polars <span class="hljs-keyword">as</span> pl

<span class="hljs-comment"># 扫描文件而非读取，启用 Lazy 模式</span>
q = (
    pl.scan_csv(<span class="hljs-string">"large_dataset.csv"</span>)
    .<span class="hljs-built_in">filter</span>(pl.col(<span class="hljs-string">"age"</span>) &gt; <span class="hljs-number">30</span>)
    .select([<span class="hljs-string">"name"</span>, <span class="hljs-string">"salary"</span>, <span class="hljs-string">"department"</span>])
    .group_by(<span class="hljs-string">"department"</span>)
    .agg(pl.col(<span class="hljs-string">"salary"</span>).mean().alias(<span class="hljs-string">"avg_salary"</span>))
)

<span class="hljs-comment"># collect() 触发实际计算</span>
df = q.collect()
<span class="hljs-built_in">print</span>(df)
</code></pre>
<h3 data-id="heading-3">PyArrow Compute：底层的计算基石</h3>
<p>PyArrow 不仅仅是数据格式标准，其 compute 模块提供了一套高性能的向量化计算函数。很多现代数据工具（包括 Pandas 2.0+）底层都在使用它。</p>
<p>如果需要对数组进行极速的数学运算或字符串处理，且不想引入 DataFrame 的额外开销，可以考虑一下 PyArrow Compute。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pyarrow <span class="hljs-keyword">as</span> pa
<span class="hljs-keyword">import</span> pyarrow.compute <span class="hljs-keyword">as</span> pc

<span class="hljs-comment"># 创建 Arrow 数组</span>
arr_a = pa.array([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-literal">None</span>])
arr_b = pa.array([<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>])

<span class="hljs-comment"># 使用计算内核进行向量化乘法，自动处理 None 值</span>
result = pc.multiply(arr_a, arr_b)

<span class="hljs-comment"># 过滤数据</span>
mask = pc.greater(result, <span class="hljs-number">50</span>)
filtered = pc.<span class="hljs-built_in">filter</span>(result, mask)

<span class="hljs-built_in">print</span>(filtered)
</code></pre>
<h3 data-id="heading-4">TinyDB：面向文档的轻量级存储</h3>
<p>并非所有项目都需要 PostgreSQL。对于配置文件管理、小型爬虫数据存储或单机小工具，TinyDB 非常合适。它是一个纯 Python 编写的文档型数据库，数据存储在 JSON 文件中，API 像操作 Python 列表一样自然。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> tinydb <span class="hljs-keyword">import</span> TinyDB, Query

db = TinyDB(<span class="hljs-string">'local_storage.json'</span>)
User = Query()

<span class="hljs-comment"># 插入数据</span>
db.insert({<span class="hljs-string">'name'</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-string">'role'</span>: <span class="hljs-string">'admin'</span>, <span class="hljs-string">'points'</span>: <span class="hljs-number">85</span>})
db.insert({<span class="hljs-string">'name'</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-string">'role'</span>: <span class="hljs-string">'user'</span>, <span class="hljs-string">'points'</span>: <span class="hljs-number">60</span>})

<span class="hljs-comment"># 查询数据</span>
results = db.search(User.role == <span class="hljs-string">'admin'</span>)
<span class="hljs-built_in">print</span>(results)
</code></pre>
<h3 data-id="heading-5">Rill：开发者的 BI 工具</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24de2b175bf6402b941ff383962e9a57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357239&amp;x-signature=MG6qZx6RBX8ZEu5abEpIzk2CaLo%3D" alt="" loading="lazy"/></p>
<p>虽然 Rill 更像是一个工具而非传统的 Python 库，但它在现代 Python 数据栈中地位独特。Rill 基于 DuckDB，能够快速读取本地数据（CSV, Parquet），并瞬间生成交互式的 BI 仪表盘。它解决了“为了看个图表还要搭一套 Superset”的痛点，非常适合快速探索数据分布。</p>
<h3 data-id="heading-6">Numba：让 Python 跑出 C 的速度</h3>
<p>当代码中包含大量原生 <code>for</code> 循环（如科学计算、复杂算法）时，Python 的解释器性能往往成为瓶颈。Numba 是一个 JIT（即时）编译器，通过加一行装饰器，就能将 Python 函数编译成机器码运行。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> jit
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 不使用 @jit 时，Python 循环较慢</span>
<span class="hljs-comment"># 使用 nopython=True 强制生成机器码</span>
<span class="hljs-meta">@jit(<span class="hljs-params">nopython=<span class="hljs-literal">True</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">heavy_computation</span>(<span class="hljs-params">n</span>):
    total = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):
        total += i * <span class="hljs-number">2</span>
    <span class="hljs-keyword">return</span> total

start = time.time()
<span class="hljs-built_in">print</span>(heavy_computation(<span class="hljs-number">100_000_000</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"耗时: <span class="hljs-subst">{time.time() - start:<span class="hljs-number">.4</span>f}</span> 秒"</span>)
</code></pre>
<h3 data-id="heading-7">Bonobo：轻量级 ETL 框架</h3>
<p>对于不需要 Airflow 这种重型调度系统的数据迁移任务，Bonobo 提供了一种基于图（Graph）的轻量级 ETL 方案。它使用纯 Python 代码定义数据流向，逻辑清晰，非常适合处理中小规模的数据清洗和转换任务。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> bonobo

<span class="hljs-keyword">def</span> <span class="hljs-title function_">extract</span>():
    <span class="hljs-keyword">yield</span> {<span class="hljs-string">'id'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'name'</span>: <span class="hljs-string">' Item A '</span>}
    <span class="hljs-keyword">yield</span> {<span class="hljs-string">'id'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'name'</span>: <span class="hljs-string">' Item B '</span>}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">transform</span>(<span class="hljs-params">row</span>):
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'id'</span>: row[<span class="hljs-string">'id'</span>], 
        <span class="hljs-string">'name_clean'</span>: row[<span class="hljs-string">'name'</span>].strip().upper()
    }

<span class="hljs-keyword">def</span> <span class="hljs-title function_">load</span>(<span class="hljs-params">row</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Loading: <span class="hljs-subst">{row}</span>"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_graph</span>(<span class="hljs-params">**options</span>):
    graph = bonobo.Graph()
    graph.add_chain(extract, transform, load)
    <span class="hljs-keyword">return</span> graph

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-comment"># 实际运行时使用 bonobo run</span>
    parser = bonobo.get_argument_parser()
    <span class="hljs-keyword">with</span> bonobo.parse_args(parser) <span class="hljs-keyword">as</span> options:
        bonobo.run(get_graph(**options))
</code></pre>
<hr/>
<p>上述库涵盖了从数据存储、计算引擎到 ETL 流程的各个环节，Python的库，需要的肯定是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fpython" target="_blank" title="https://www.servbay.com/features/python" ref="nofollow noopener noreferrer">Python 环境</a>。</p>
<p>而且码农怎么可能只有一个项目需要维护呢？肯定是有的依赖最新的 Python 3.14，有的则必须跑在 Python 3.8 甚至古老的 Python 2.7 上维护遗留系统。系统自带的 Python 环境一旦弄乱，修复起来就头大了。</p>
<p>那这时候我们就要请上 ServBay 了。</p>
<p>ServBay 为开发者提供了一个隔离且纯净的开发环境。它最大的优势是<strong>一键部署</strong>和<strong>多版本共存</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c01ee8593e424667bc1932f56e3aaaba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357239&amp;x-signature=efBZ8RjRAzIJnExsnB%2BtcDG9IK8%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>极速安装</strong>：还在用命令行就out了。ServBay 点击即可安装好包含常用组件的开发环境。</li>
<li><strong>全版本支持</strong>：它支持从最新的 Python 3.x 到早期的 Python 2.x 版本。</li>
<li><strong>环境隔离</strong>：ServBay 的环境独立于系统，不会污染系统自带的 Python，保证了系统的稳定性。</li>
</ul>
<p>对于追求效率的开发者而言，将环境管理交给 ServBay，把精力集中在代码和数据逻辑上，才是更明智的选择。</p>
<p>数据处理的边界正在被这些新兴的工具不断拓展。对于开发者而言，保持对新技术的敏感度，同时拥有一个随时能推倒重来且互不干扰的好工具，也是提高效率的关键。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端开发环境搭建全教程｜Node.js+npm+Vite（一步到位，附报错解决）]]></title>    <link>https://juejin.cn/post/7600791597169819691</link>    <guid>https://juejin.cn/post/7600791597169819691</guid>    <pubDate>2026-01-30T06:01:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600791597169819691" data-draft-id="7600710943250939946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端开发环境搭建全教程｜Node.js+npm+Vite（一步到位，附报错解决）"/> <meta itemprop="keywords" content="Node.js,Vue.js"/> <meta itemprop="datePublished" content="2026-01-30T06:01:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码煮茶"/> <meta itemprop="url" content="https://juejin.cn/user/4197279069639178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端开发环境搭建全教程｜Node.js+npm+Vite（一步到位，附报错解决）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4197279069639178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码煮茶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:01:16.000Z" title="Fri Jan 30 2026 06:01:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    23
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于前端初学者而言，第一步往往不是学习 HTML/CSS 语法，而是搭建一个稳定、可用的前端开发环境 —— 一个配置完善的环境能避免后续开发中出现各种 “莫名其妙” 的问题，大幅提升开发效率。本文将以<strong>Node.js+npm+Vite</strong>为核心，从搭建目的到具体步骤，再到常见报错解决，手把手带大家完成前端开发环境的一站式搭建，全程干货无冗余，新手也能轻松上手。</p>
<h2 data-id="heading-0">一、搭建目的：为什么需要这些工具？</h2>
<p>在开始搭建之前，我们先搞懂 “为什么要装这些东西”，避免盲目操作。</p>
<ol>
<li><strong>Node.js</strong>：前端开发的 “基础设施”简单来说，Node.js 是一个让 JavaScript 能够运行在<strong>服务器端 / 本地电脑</strong>（而非仅在浏览器中）的运行环境。它提供了大量内置模块和生态工具，是后续 npm、Vite 等工具运行的基础 —— 没有 Node.js，后面的工具都无法启动。</li>
<li><strong>npm</strong>：前端包管理工具（随 Node.js 自带）npm（Node Package Manager）是 Node.js 自带的包管理工具，相当于前端的 “应用商店”。我们在开发中需要用到的 Vue、React、Element UI 等第三方框架 / 插件，都可以通过 npm 一键安装、管理版本、卸载，无需手动下载文件包，极大简化了依赖管理流程。</li>
<li><strong>Vite</strong>：新一代前端构建工具传统前端开发中常用 Webpack，而 Vite 是近年来大火的新一代构建工具，主打 “快”—— 启动速度、热更新速度远超 Webpack，尤其在大型项目中优势明显。它支持 Vue、React、Vanilla JS 等多种项目模板，能快速初始化项目结构，还内置了开发服务器、打包构建等功能，是目前前端开发的首选构建工具。</li>
</ol>
<p>总结：<strong>Node.js（运行环境）→ npm（包管理）→ Vite（项目构建 / 开发）</strong> ，三者形成前端开发的基础链路，缺一不可。</p>
<h2 data-id="heading-1">二、各工具安装步骤（Windows/macOS 通用）</h2>
<h3 data-id="heading-2">第一步：安装 Node.js（附带 npm）</h3>
<p>Node.js 的安装包已经内置了 npm，安装 Node.js 后会自动获得 npm，无需单独安装。</p>
<h4 data-id="heading-3">1. 下载安装包</h4>
<p>访问 Node.js 官方下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2F" target="_blank" title="https://nodejs.org/zh-cn/" ref="nofollow noopener noreferrer">nodejs.org/zh-cn/</a>官网提供两个版本：</p>
<ul>
<li><strong>LTS 版本</strong>（长期支持版）：标注 “推荐用于大多数用户”，版本号通常为偶数（如 20.x、18.x），稳定性高，<strong>优先选择此版本</strong>（本文以 v20.x LTS 为例）。</li>
<li>Current 版本（最新版）：包含最新功能，但可能存在兼容性问题，适合开发者测试新特性，不推荐新手使用。</li>
</ul>
<p>根据你的操作系统（Windows/macOS）选择对应的安装包：</p>
<ul>
<li>Windows：选择 “Windows 安装程序 (.msi)”（64 位，目前主流电脑均为 64 位）。</li>
<li>macOS：选择 “macOS 安装程序 (.pkg)”。</li>
</ul>
<h4 data-id="heading-4">2. 执行安装（分步图解，以 Windows 为例）</h4>
<ol>
<li>双击下载完成的.msi 文件，弹出安装向导，点击 “Next”。</li>
<li>勾选 “我接受许可协议中的条款”，点击 “Next”。</li>
<li>选择安装路径（默认路径即可，无需修改；若要修改，建议放在非 C 盘根目录，如<code>D:\Program Files\nodejs</code>），点击 “Next”。</li>
<li>保持默认安装组件（无需勾选额外选项，npm 已包含在内），点击 “Next”。</li>
<li>无需勾选 “Tools for Native Modules”（新手用不到），直接点击 “Next”。</li>
<li>点击 “Install” 开始安装，等待进度条完成（约 1-2 分钟）。</li>
<li>安装完成后，点击 “Finish” 关闭向导。</li>
</ol>
<h4 data-id="heading-5">3. macOS 额外说明</h4>
<ol>
<li>
<p>双击下载的.pkg 文件，跟随安装向导一步步操作，默认选项即可。</p>
</li>
<li>
<p>若安装过程中提示 “无法验证开发者”，可右键安装包→“打开”，或在 “系统设置→隐私与安全性” 中允许此安装包运行。</p>
</li>
<li>
<p>也可通过 Homebrew 安装（适合有一定终端基础的用户）：</p>
<pre><code class="hljs language-less" lang="less"># 先安装<span class="hljs-selector-tag">Homebrew</span>（若未安装）
/<span class="hljs-selector-tag">bin</span>/<span class="hljs-selector-tag">bash</span> <span class="hljs-selector-tag">-c</span> "$(curl -fsSL <span class="hljs-attribute">https</span>:<span class="hljs-comment">//raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</span>
# 安装Node.js LTS版本
brew install node<span class="hljs-variable">@20</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-6">第二步：安装 Vite（全局安装，推荐）</h3>
<p>Vite 支持两种安装方式：全局安装（可在任意目录创建项目）、局部安装（仅在当前项目可用），新手推荐<strong>全局安装</strong>，操作更便捷。</p>
<ol>
<li>
<p>打开终端 / 命令提示符：</p>
<ul>
<li>Windows：按下<code>Win+R</code>，输入<code>cmd</code>回车，打开命令提示符（CMD）；或输入<code>powershell</code>回车，打开 PowerShell。</li>
<li>macOS：打开 “启动台→其他→终端”。</li>
</ul>
</li>
<li>
<p>输入以下命令全局安装 Vite：</p>
<pre><code class="hljs">npm install -g vite
</code></pre>
<p>解释：</p>
<ul>
<li><code>npm install</code>：npm 的安装命令，简写为<code>npm i</code>。</li>
<li><code>-g</code>：全局安装标识（global），表示将 Vite 安装到系统全局，后续在任意目录下都能使用<code>vite</code>命令。</li>
<li><code>vite</code>：要安装的包名。</li>
</ul>
</li>
<li>
<p>等待安装完成：终端会显示安装进度和依赖信息，最后出现 “added xxx packages in xxxs” 即表示安装成功（无需关注警告信息，只要没有红色报错即可）。</p>
</li>
</ol>
<h2 data-id="heading-7">三、版本验证：确认所有工具安装成功</h2>
<p>安装完成后，务必验证各工具的版本，确保环境搭建成功，避免后续开发出现问题。</p>
<h3 data-id="heading-8">1. 验证 Node.js 版本</h3>
<p>在终端 / CMD 中输入以下命令，回车执行：</p>
<pre><code class="hljs">node -v
</code></pre>
<p>若输出类似<code>v20.10.0</code>（版本号与你安装的 LTS 版本一致），说明 Node.js 安装成功。</p>
<h3 data-id="heading-9">2. 验证 npm 版本</h3>
<p>同样在终端 / CMD 中输入以下命令：</p>
<pre><code class="hljs">npm -v
</code></pre>
<p>若输出类似<code>10.2.3</code>（npm 版本与 Node.js 配套，无需刻意追求最新），说明 npm 安装成功。</p>
<h3 data-id="heading-10">3. 验证 Vite 版本</h3>
<p>在终端 / CMD 中输入以下命令：</p>
<pre><code class="hljs">vite -v
</code></pre>
<p>若输出类似<code>v5.0.10</code>（Vite 版本会持续更新，只要能输出版本号即表示安装成功），说明 Vite 全局安装成功。</p>
<blockquote>
<p>注意：若输入命令后提示 “不是内部或外部命令，也不是可运行的程序或批处理文件”（Windows）或 “command not found”（macOS），说明环境变量未配置成功，可参考本文 “四、常见报错及解决” 中的对应方案。</p>
</blockquote>
<h2 data-id="heading-11">四、全局配置：更换 npm 镜像源（解决下载缓慢问题）</h2>
<p>npm 的默认镜像源位于国外服务器（<a href="https://link.juejin.cn?target=https%3A%2F%2Fregistry.npmjs.org%2F" target="_blank" title="https://registry.npmjs.org/" ref="nofollow noopener noreferrer">registry.npmjs.org/</a>），国内用户直接使用会出现<strong>下载速度慢、安装超时</strong>等问题，因此需要将镜像源更换为国内镜像（如淘宝镜像）。</p>
<h3 data-id="heading-12">1. 临时更换（仅当前终端有效）</h3>
<p>在安装包时，通过<code>--registry</code>参数指定镜像源，仅对当前命令有效：</p>
<pre><code class="hljs language-ini" lang="ini">npm install -g vite <span class="hljs-attr">--registry</span>=https://registry.npmmirror.com/
</code></pre>
<h3 data-id="heading-13">2. 永久更换（推荐，一劳永逸）</h3>
<h4 data-id="heading-14">方法 1：使用 npm 命令配置</h4>
<p>在终端 / CMD 中输入以下命令，将默认镜像源设置为淘宝镜像（目前淘宝镜像已升级为 npmmirror）：</p>
<pre><code class="hljs language-arduino" lang="arduino"># 配置淘宝镜像源（永久生效）
npm config set registry https:<span class="hljs-comment">//registry.npmmirror.com/</span>
</code></pre>
<h4 data-id="heading-15">方法 2：验证镜像源是否配置成功</h4>
<p>输入以下命令，查看当前 npm 的镜像源配置：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm config get registry
</code></pre>
<p>若输出<code>https://registry.npmmirror.com/</code>，说明配置成功。</p>
<h4 data-id="heading-16">方法 3：恢复默认镜像源</h4>
<p>若后续需要切换回 npm 官方镜像源，输入以下命令即可：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm config set registry https:<span class="hljs-comment">//registry.npmjs.org/</span>
</code></pre>
<h3 data-id="heading-17">3. 额外推荐：使用 nrm 管理镜像源（可选）</h3>
<p>nrm 是一个 npm 镜像源管理工具，可快速切换多个镜像源，适合需要频繁切换镜像的用户。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 全局安装nrm</span>
npm install -g nrm

<span class="hljs-comment"># 查看所有可用镜像源</span>
nrm <span class="hljs-built_in">ls</span>

<span class="hljs-comment"># 切换到淘宝镜像源</span>
nrm use taobao

<span class="hljs-comment"># 验证当前镜像源</span>
nrm current
</code></pre>
<h2 data-id="heading-18">五、常见报错及解决（新手必看，避坑指南）</h2>
<p>搭建环境或后续使用过程中，难免会遇到各种报错，以下整理了最常见的几种报错及对应的解决方案，一步到位解决问题。</p>
<h3 data-id="heading-19">报错 1：命令未找到（node/npm/vite: command not found / 不是内部或外部命令）</h3>
<h4 data-id="heading-20">现象</h4>
<p>输入<code>node -v</code>、<code>npm -v</code>或<code>vite -v</code>时，终端提示命令不存在，无法识别工具。</p>
<h4 data-id="heading-21">原因</h4>
<p>Node.js 安装后，<strong>环境变量未自动配置成功</strong>，系统无法找到对应的可执行文件路径。</p>
<h4 data-id="heading-22">解决方案（Windows 为例）</h4>
<ol>
<li>找到你的 Node.js 安装路径（如<code>D:\Program Files\nodejs</code>），复制该路径。</li>
<li>右键 “此电脑”→“属性”→“高级系统设置”→“环境变量”。</li>
<li>在 “系统变量” 中，找到名为<code>Path</code>的变量，双击打开。</li>
<li>点击 “新建”，粘贴刚才复制的 Node.js 安装路径，点击 “上移” 将其移到顶部。</li>
<li>再点击 “新建”，粘贴<code>%USERPROFILE%\AppData\Roaming\npm</code>（npm 全局包的安装路径），点击 “确定” 保存所有配置。</li>
<li><strong>关键步骤</strong>：关闭当前所有终端 / CMD，重新打开一个新的终端，再次输入版本验证命令，即可正常识别。</li>
</ol>
<h4 data-id="heading-23">解决方案（macOS 为例）</h4>
<ol>
<li>
<p>打开终端，输入以下命令，编辑环境变量配置文件（以 zsh 为例，macOS 默认终端为 zsh）：</p>
<pre><code class="hljs language-arduino" lang="arduino">open ~/.zshrc
</code></pre>
<p>若使用 bash 终端，输入：<code>open ~/.bash_profile</code>。</p>
</li>
<li>
<p>在配置文件末尾，添加一行代码（替换为你的 Node.js 安装路径，默认路径为<code>/usr/local/bin/node</code>）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"/usr/local/bin:<span class="hljs-variable">$PATH</span>"</span>
</code></pre>
</li>
<li>
<p>保存文件并关闭，回到终端，输入以下命令使配置生效：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc
</code></pre>
</li>
<li>
<p>重新输入版本验证命令，即可正常识别。</p>
</li>
</ol>
<h3 data-id="heading-24">报错 2：npm 安装失败（超时、报错 code ECONNRESET / ETIMEDOUT）</h3>
<h4 data-id="heading-25">现象</h4>
<p>执行<code>npm install -g vite</code>时，终端出现红色报错，提示 “timeout”、“ECONNRESET”，安装进度卡住或中断。</p>
<h4 data-id="heading-26">原因</h4>
<ol>
<li>默认镜像源在国外，网络连接不稳定或速度过慢。</li>
<li>本地网络防火墙、代理软件拦截了 npm 的下载请求。</li>
</ol>
<h4 data-id="heading-27">解决方案</h4>
<ol>
<li>
<p><strong>优先更换国内镜像源</strong>：按照本文 “四、全局配置” 中的方法，永久更换为淘宝镜像源，重新执行安装命令。</p>
</li>
<li>
<p><strong>关闭代理 / 防火墙</strong>：若开启了 VPN、梯子、电脑防火墙，暂时关闭后再尝试安装。</p>
</li>
<li>
<p><strong>清理 npm 缓存</strong>：缓存损坏也可能导致安装失败，输入以下命令清理缓存后重新安装：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理npm缓存</span>
npm cache clean --force
<span class="hljs-comment"># 重新全局安装Vite</span>
npm install -g vite
</code></pre>
</li>
</ol>
<h3 data-id="heading-28">报错 3：Vite 启动项目提示 “端口占用”（Port xxx is already in use）</h3>
<h4 data-id="heading-29">现象</h4>
<p>使用<code>vite</code>启动项目时，终端报错 “Port 5173 is already in use”（Vite 默认端口为 5173），无法启动开发服务器。</p>
<h4 data-id="heading-30">原因</h4>
<p>5173 端口已被其他程序（如另一一个 Vite 项目、其他开发工具、杀毒软件等）占用。</p>
<h4 data-id="heading-31">解决方案</h4>
<h4 data-id="heading-32">方法 1：让 Vite 自动切换端口</h4>
<p>在启动项目时，添加<code>--port</code>参数的同时，使用<code>--open</code>，或直接输入以下命令，Vite 会自动寻找可用端口并启动：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动项目，自动切换未被占用的端口</span>
vite --port 0
</code></pre>
<h4 data-id="heading-33">方法 2：手动指定其他端口</h4>
<p>选择一个未被占用的端口（如 5174、3000 等），启动项目时手动指定：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 手动指定端口5174启动项目</span>
<span class="hljs-string">vite</span> <span class="hljs-string">--port</span> <span class="hljs-number">5174</span>
</code></pre>
<h4 data-id="heading-34">方法 3：查找并关闭占用端口的程序（Windows）</h4>
<ol>
<li>
<p>打开 CMD，输入以下命令，查找占用 5173 端口的进程 PID：</p>
<pre><code class="hljs language-arduino" lang="arduino">netstat -ano | findstr <span class="hljs-string">"5173"</span>
</code></pre>
</li>
<li>
<p>终端会输出类似<code>TCP 0.0.0.0:5173 0.0.0.0:0 LISTENING 12345</code>的信息，其中<code>12345</code>即为进程 PID。</p>
</li>
<li>
<p>输入以下命令，结束该进程（替换为实际查到的 PID）：</p>
<pre><code class="hljs language-r" lang="r">taskkill <span class="hljs-operator">/</span><span class="hljs-built_in">F</span> <span class="hljs-operator">/</span>PID <span class="hljs-number">12345</span>
</code></pre>
</li>
<li>
<p>重新启动 Vite 项目，即可正常使用 5173 端口。</p>
</li>
</ol>
<h4 data-id="heading-35">方法 3：查找并关闭占用端口的程序（macOS）</h4>
<ol>
<li>
<p>打开终端，输入以下命令，查找占用 5173 端口的进程 PID：</p>
<pre><code class="hljs language-css" lang="css">lsof -<span class="hljs-selector-tag">i</span>:<span class="hljs-number">5173</span>
</code></pre>
</li>
<li>
<p>终端会输出进程信息，其中<code>PID</code>列即为进程 PID。</p>
</li>
<li>
<p>输入以下命令，结束该进程（替换为实际查到的 PID）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">kill</span> -9 12345
</code></pre>
</li>
<li>
<p>重新启动 Vite 项目，即可正常使用 5173 端口。</p>
</li>
</ol>
<h3 data-id="heading-36">报错 4：Vite 创建项目时，模板选择后提示 “npm install failed”</h3>
<h4 data-id="heading-37">现象</h4>
<p>执行<code>npm create vite@latest</code>创建项目，选择框架（如 Vue）和语言（如 JavaScript）后，终端提示 “npm install failed”，项目创建不完整。</p>
<h4 data-id="heading-38">原因</h4>
<ol>
<li>项目目录中包含中文、空格或特殊字符（如<code>我的项目</code>、<code>project name</code>），npm 不支持此类目录名。</li>
<li>本地 npm 版本过低，与 Vite 不兼容。</li>
</ol>
<h4 data-id="heading-39">解决方案</h4>
<ol>
<li>
<p><strong>创建无特殊字符的项目目录</strong>：项目路径和项目名仅使用英文、数字、下划线（如<code>vite-vue-demo</code>），避免中文和空格。</p>
</li>
<li>
<p><strong>升级 npm 版本</strong>：输入以下命令，将 npm 升级到最新版本，重新创建项目：</p>
<pre><code class="hljs">npm install -g npm
</code></pre>
</li>
<li>
<p><strong>手动安装项目依赖</strong>：若项目已创建，仅依赖安装失败，进入项目目录后手动执行安装命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录（替换为你的项目名）</span>
<span class="hljs-built_in">cd</span> vite-vue-demo
<span class="hljs-comment"># 手动安装依赖</span>
npm install
</code></pre>
</li>
</ol>
<h2 data-id="heading-40">六、收尾：快速创建第一个 Vite 项目（验证环境可用性）</h2>
<p>所有配置完成后，我们来创建一个简单的 Vite 项目，验证整个环境是否可用。</p>
<ol>
<li>
<p>打开终端 / CMD，输入以下命令，创建 Vite 项目：</p>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">create</span> vite<span class="hljs-variable">@latest</span>
</code></pre>
</li>
<li>
<p>按照终端提示操作：</p>
<ul>
<li>输入项目名（如<code>vite-first-demo</code>，无特殊字符），回车。</li>
<li>选择项目框架（如<code>Vue</code>，用上下箭头切换，回车确认）。</li>
<li>选择语言（如<code>JavaScript</code>，回车确认）。</li>
</ul>
</li>
<li>
<p>项目创建完成后，按照终端提示，执行以下命令进入项目并安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> vite-first-demo
<span class="hljs-comment"># 安装项目依赖</span>
npm install
</code></pre>
</li>
<li>
<p>启动开发服务器：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run dev
</code></pre>
</li>
<li>
<p>启动成功后，终端会显示项目访问地址（如<code>http://localhost:5173/</code>），复制该地址在浏览器中打开，若能看到 Vite+Vue 的默认页面，说明整个前端开发环境搭建成功！</p>
</li>
</ol>
<h3 data-id="heading-41">总结</h3>
<ol>
<li>前端开发基础环境的核心是<strong>Node.js（运行环境）+ npm（包管理）+ Vite（项目构建）</strong> ，其中 npm 随 Node.js 自带，无需单独安装。</li>
<li>安装时优先选择 Node.js 的 LTS 版本，Vite 推荐全局安装，npm 镜像源建议更换为国内淘宝镜像以提升下载速度。</li>
<li>常见问题集中在<strong>环境变量未配置、端口占用、镜像源下载超时</strong>，按照文中对应方案可快速解决，搭建完成后可通过创建测试项目验证环境可用性。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[记录qiankun的demo]]></title>    <link>https://juejin.cn/post/7600706866785878059</link>    <guid>https://juejin.cn/post/7600706866785878059</guid>    <pubDate>2026-01-30T06:08:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600706866785878059" data-draft-id="7600674821308104740" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="记录qiankun的demo"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T06:08:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MQliferecord"/> <meta itemprop="url" content="https://juejin.cn/user/1139543665814600"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            记录qiankun的demo
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1139543665814600/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MQliferecord
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:08:57.000Z" title="Fri Jan 30 2026 06:08:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">主应用</h3>
<ul>
<li>修改主应用路由</li>
</ul>
<p>主应用使用 <code>history</code> 路由（微应用推荐），添加子应用容器页面：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createRouter, createWebHistory, <span class="hljs-title class_">RouteRecordRaw</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../views/Home.vue'</span>; 

<span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>&gt; = [ 
    { 
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, 
        <span class="hljs-attr">name</span>: <span class="hljs-string">'Home'</span>, 
        <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span> 
    }, <span class="hljs-comment">// 子应用挂载的路由（激活规则） </span>
    { 
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/sub-app'</span>, 
        <span class="hljs-attr">name</span>: <span class="hljs-string">'SubApp'</span>, <span class="hljs-comment">// 空组件，仅作为子应用的挂载容器 </span>
        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/SubAppContainer.vue'</span>) 
    } 
]; 
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({ 
    <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(), <span class="hljs-comment">// 注意：用 history 路由 </span>
    routes 
}); 

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;
</code></pre>
<ul>
<li>创建子应用容器组件（src/views/SubAppContainer.vue）</li>
</ul>
<pre><code class="hljs language-js" lang="js">&lt;template&gt; 
    &lt;!-- 子应用挂载的 <span class="hljs-variable constant_">DOM</span> 容器 --&gt; 
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sub-app-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> 
&lt;/template&gt; 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript"> 
<span class="hljs-comment">// 空组件，仅提供挂载容器 </span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span> 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css"> 
<span class="hljs-selector-id">#sub-app-container</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<ul>
<li>修改主应用入口（src/main.ts）</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>; 
<span class="hljs-keyword">import</span> { registerMicroApps, start } <span class="hljs-keyword">from</span> <span class="hljs-string">'qiankun'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>; 
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>; 
<span class="hljs-keyword">import</span> eventBus <span class="hljs-keyword">from</span> <span class="hljs-string">'./bus'</span>; <span class="hljs-comment">// 新增</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>; 

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>); 
app.<span class="hljs-title function_">use</span>(router); 
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>); <span class="hljs-comment">// 1. 注册子应用</span>

<span class="hljs-comment">// 通信方法1：props注入相关信息 </span>
<span class="hljs-keyword">const</span> globalData = { 
    <span class="hljs-attr">userInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }, 
    <span class="hljs-comment">// 新增：传递回调函数（实现子→主通信） </span>
    <span class="hljs-attr">onSubAppMsg</span>: <span class="hljs-function">(<span class="hljs-params">msg: string</span>) =&gt;</span> { 
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'主应用收到子应用消息：'</span>, msg); 
        <span class="hljs-title function_">alert</span>(<span class="hljs-string">`主应用收到：<span class="hljs-subst">${msg}</span>`</span>); 
    } 
};

<span class="hljs-comment">// 通信方法2：主应用仓库挂载在全局window上</span>
<span class="hljs-keyword">const</span> globalStore = <span class="hljs-title function_">useGlobalStore</span>();
<span class="hljs-variable language_">window</span>.<span class="hljs-property">globalStore</span> = globalStore; <span class="hljs-comment">// 子应用可直接访问</span>

<span class="hljs-comment">// 通信方法3：事件总线</span>
eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-string">'sub-app-msg'</span>, <span class="hljs-function">(<span class="hljs-params">msg: string</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'主应用通过事件总线收到：'</span>, msg);
  <span class="hljs-title function_">alert</span>(<span class="hljs-string">`事件总线：<span class="hljs-subst">${msg}</span>`</span>);
});
<span class="hljs-comment">// 主应用主动发送事件给子应用（示例）</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  eventBus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'main-app-msg'</span>, <span class="hljs-string">'主应用主动发送的实时消息'</span>);
}, <span class="hljs-number">3000</span>);

<span class="hljs-comment">// 通信方法4：QIANKUN自身的initGlobalState方法</span>
<span class="hljs-keyword">const</span> globalState = <span class="hljs-title function_">initGlobalState</span>({
  <span class="hljs-attr">userInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  <span class="hljs-attr">appMsg</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// 存储主/子应用交互的消息</span>
});
<span class="hljs-comment">// 2. 主应用监听全局状态变更（实时响应）</span>
globalState.<span class="hljs-title function_">onGlobalStateChange</span>(<span class="hljs-function">(<span class="hljs-params">newState, prevState</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'主应用状态变更：'</span>, <span class="hljs-string">'旧值'</span>, prevState, <span class="hljs-string">'新值'</span>, newState);
}, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 第二个参数为 true，初始化时立即执行一次</span>

<span class="hljs-comment">// 3. 主应用主动修改全局状态</span>
globalState.<span class="hljs-title function_">setGlobalState</span>({ <span class="hljs-attr">appMsg</span>: <span class="hljs-string">'主应用修改的全局消息'</span> });

<span class="hljs-title function_">registerMicroApps</span>([ 
    { 
        <span class="hljs-attr">name</span>: <span class="hljs-string">'sub-app'</span>, <span class="hljs-comment">// 子应用唯一标识（需和子应用 package.json 中的 name 一致） </span>
        <span class="hljs-attr">entry</span>: <span class="hljs-string">'//localhost:3001'</span>, <span class="hljs-comment">// 子应用的访问地址（端口和子应用一致） </span>
        <span class="hljs-attr">container</span>: <span class="hljs-string">'#sub-app-container'</span>, <span class="hljs-comment">// 子应用挂载的 DOM 容器 </span>
        <span class="hljs-attr">activeRule</span>: <span class="hljs-string">'/sub-app'</span>, <span class="hljs-comment">// 子应用的激活路由（匹配主应用的 /sub-app 路由） </span>
        <span class="hljs-comment">// 可选：传递给子应用的参数 </span>
        <span class="hljs-attr">props</span>: { 
            ...globalData,
            <span class="hljs-attr">msg</span>: <span class="hljs-string">'来自主应用的消息'</span> 
        }，
        <span class="hljs-comment">//通信方案6：postmessage</span>
        <span class="hljs-attr">afterMount</span>: <span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> subWindow = app?.<span class="hljs-property">window</span>;
          <span class="hljs-comment">// 发送消息（指定接收域名，提升安全性）</span>
          subWindow.<span class="hljs-title function_">postMessage</span>(
            { <span class="hljs-attr">type</span>: <span class="hljs-string">'MAIN_MSG'</span>, <span class="hljs-attr">data</span>: <span class="hljs-string">'来自主应用的跨域消息'</span> },
            <span class="hljs-string">'//sub.example.com'</span>
          );
        }
    } 
]); 

<span class="hljs-comment">// 主应用监听子应用的跨域消息</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// 严格验证消息来源，防止恶意攻击</span>
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">origin</span> !== <span class="hljs-string">'//sub.example.com'</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'SUB_MSG'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'主应用收到跨域消息：'</span>, e.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>);
  }
});


    
<span class="hljs-comment">// 2. 启动 qiankun（默认立即启动，也可配置延迟启动） </span>
<span class="hljs-title function_">start</span>({ 
    <span class="hljs-attr">sandbox</span>: { 
        <span class="hljs-comment">// CSS 隔离：优先用严格隔离（现代浏览器），兼容场景用前缀隔离</span>
        <span class="hljs-attr">strictStyleIsolation</span>: <span class="hljs-literal">true</span>, 
        <span class="hljs-comment">// experimentalStyleIsolation: true, // 兼容模式选这个 </span>
    },
    <span class="hljs-comment">// 路由隔离：单实例模式（默认），避免多个子应用路由冲突</span>
    <span class="hljs-attr">singular</span>: <span class="hljs-literal">true</span>
});
</code></pre>
<ul>
<li>修改主应用首页（src/views/Home.vue）</li>
</ul>
<p>添加跳转到子应用的按钮：</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"home"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>主应用（main-app）<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>全局用户信息：{{ globalStore.userInfo.name }}，{{ globalStore.userInfo.age }}岁<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>子应用发送的消息：{{ globalStore.appMsg }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 主应用修改全局状态 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"updateUser"</span>&gt;</span>修改用户信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"$router.push('/sub-app')"</span>&gt;</span>打开子应用<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useGlobalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'../store'</span>;

<span class="hljs-keyword">const</span> globalStore = <span class="hljs-title function_">useGlobalStore</span>();

<span class="hljs-comment">// 主应用修改全局状态（子应用会同步看到）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateUser</span> = (<span class="hljs-params"/>) =&gt; {
  globalStore.<span class="hljs-title function_">updateUserInfo</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> });
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<ul>
<li>主应用创建 Pinia 状态库（src/store/index.ts）</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>;

<span class="hljs-comment">// 定义全局共享状态</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useGlobalStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'global'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">userInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
    <span class="hljs-attr">appMsg</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// 存储子应用发送的消息</span>
  }),
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-comment">// 修改用户信息（主/子应用均可调用）</span>
    <span class="hljs-title function_">updateUserInfo</span>(<span class="hljs-params">newInfo: { name: string; age: number }</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">userInfo</span> = newInfo;
    },
    <span class="hljs-comment">// 接收子应用消息</span>
    <span class="hljs-title function_">setSubAppMsg</span>(<span class="hljs-params">msg: string</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">appMsg</span> = msg;
    }
  }
});
</code></pre>
<ul>
<li>主应用创建事件总线（src/bus/index.ts）</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> mitt <span class="hljs-keyword">from</span> <span class="hljs-string">'mitt'</span>;

<span class="hljs-comment">// 创建事件总线实例</span>
<span class="hljs-keyword">const</span> eventBus = <span class="hljs-title function_">mitt</span>();
<span class="hljs-comment">// 挂载到 window，供子应用访问</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">eventBus</span> = eventBus;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> eventBus;
</code></pre>
<ul>
<li>修改主应用 Vite 配置（vite.config.ts）</li>
</ul>
<p>配置端口（避免和子应用冲突），允许跨域</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>; 
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({ 
    <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()], 
    <span class="hljs-attr">server</span>: { 
        <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>, <span class="hljs-comment">// 主应用端口 </span>
        <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 允许跨域（子应用加载主应用资源需要） </span>
        <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 启动时自动打开浏览器 </span>
    } 
});
</code></pre>
<h3 data-id="heading-1">创建子应用</h3>
<ul>
<li>修改子应用 Vite 配置（vite.config.ts）</li>
</ul>
<p>配置基础路径、跨域、端口，适配 qiankun：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>; 
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>; <span class="hljs-comment">// 判断是否在 qiankun 环境中 </span>

<span class="hljs-keyword">const</span> isQiankun = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>; 

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({ 
    <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()], 
    <span class="hljs-comment">// 基础路径：qiankun 环境下为 /sub-app（和主应用激活规则一致），否则为 / </span>
    <span class="hljs-attr">base</span>: isQiankun ? <span class="hljs-string">'/sub-app'</span> : <span class="hljs-string">'/'</span>, 
    <span class="hljs-attr">server</span>: { 
        <span class="hljs-attr">port</span>: <span class="hljs-number">3001</span>, <span class="hljs-comment">// 子应用端口 </span>
        <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 允许跨域（主应用加载子应用资源需要） </span>
        <span class="hljs-attr">headers</span>: { 
            <span class="hljs-comment">// 允许主应用访问子应用的资源（CORS 配置） </span>
            <span class="hljs-string">'Access-Control-Allow-Origin'</span>: <span class="hljs-string">'*'</span> 
        } 
    } 
});
</code></pre>
<ul>
<li>修改子应用入口文件（src/main.ts）</li>
</ul>
<p>导出 qiankun 要求的生命周期函数（<code>bootstrap/mount/unmount</code>）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>; 
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>; 

<span class="hljs-keyword">let</span> <span class="hljs-attr">app</span>: <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> createApp&gt;; <span class="hljs-comment">// 1. 生命周期：启动（只会执行一次） </span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params">props: any</span>) { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子应用启动'</span>, props); <span class="hljs-comment">// 接收主应用传递的参数 </span>
} 

<span class="hljs-comment">// 主应用监听子应用的跨域消息</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// 严格验证消息来源，防止恶意攻击</span>
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">origin</span> !== <span class="hljs-string">'//sub.example.com'</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'SUB_MSG'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'主应用收到跨域消息：'</span>, e.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>);
  }
});

<span class="hljs-comment">// 2. 生命周期：挂载（每次激活子应用时执行） </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props: any</span>) { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子应用挂载'</span>, props); 
    
    qiankunProps = props; 
    <span class="hljs-comment">// 保存 props 到全局 </span>
    <span class="hljs-comment">// 新增：将 props 挂载到 window，方便子应用任意组件访问 </span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span> = props;
    
    <span class="hljs-keyword">const</span> { onGlobalStateChange, setGlobalState } = props;

  <span class="hljs-comment">// 1. 子应用监听全局状态变更</span>
  <span class="hljs-title function_">onGlobalStateChange</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子应用收到全局状态：'</span>, state);
    <span class="hljs-comment">// 可将状态挂载到子应用全局，供组件使用</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">globalState</span> = state;
  }, <span class="hljs-literal">true</span>);

  <span class="hljs-comment">// 2. 子应用修改全局状态（主应用会同步收到）</span>
  <span class="hljs-title function_">setGlobalState</span>({ <span class="hljs-attr">appMsg</span>: <span class="hljs-string">'子应用修改的全局消息'</span> });
    
    <span class="hljs-comment">// 挂载到主应用指定的容器，或子应用自己的容器（独立运行时） </span>
    <span class="hljs-keyword">const</span> container = props?.<span class="hljs-property">container</span>?.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#app'</span>) || <span class="hljs-string">'#app'</span>; 
    app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>); app.<span class="hljs-title function_">use</span>(router); 
    app.<span class="hljs-title function_">mount</span>(container); 
} 
    
<span class="hljs-comment">// 3. 生命周期：卸载（每次离开子应用时执行） </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">unmount</span>(<span class="hljs-params"/>) { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子应用卸载'</span>); 
    app.<span class="hljs-title function_">unmount</span>(); <span class="hljs-comment">// 销毁应用实例 </span>
} 

<span class="hljs-comment">// 4. 独立运行时（不嵌入主应用） </span>
<span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) { 
    <span class="hljs-title function_">mount</span>({}); 
} 

<span class="hljs-comment">// 导出生命周期函数（供 qiankun 调用） </span>
<span class="hljs-keyword">export</span> { bootstrap, mount, unmount };
</code></pre>
<ul>
<li>子应用组件使用（Home.vue）：</li>
</ul>
<p>调用主应用回调</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"home"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>子应用（sub-app）<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>主应用传递的用户信息：{{ userInfo.name }}，{{ userInfo.age }}岁<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>主应用初始消息：{{ msg }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 新增：子应用向主应用发消息 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"subMsg"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入要发送给主应用的消息"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"sendToMain"</span>&gt;</span>发送给主应用<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"goBack"</span>&gt;</span>返回主应用<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();
<span class="hljs-keyword">const</span> msg = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> userInfo = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });
<span class="hljs-keyword">const</span> subMsg = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>); <span class="hljs-comment">// 子应用要发送的消息</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">eventBus</span>: any = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// 新增：获取主应用挂载的全局状态</span>
<span class="hljs-keyword">const</span> globalStore = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span> ? <span class="hljs-variable language_">window</span>.<span class="hljs-property">globalStore</span> : <span class="hljs-literal">null</span>;

<span class="hljs-comment">// 子应用发送消息到主应用（修改全局状态）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendToMain</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (globalStore) {
    globalStore.<span class="hljs-title function_">setSubAppMsg</span>(subMsg.<span class="hljs-property">value</span>);
    subMsg.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
  }
};

<span class="hljs-comment">// 子应用修改全局用户信息（主应用会同步看到）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateUserFromSub</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (globalStore) {
    globalStore.<span class="hljs-title function_">updateUserInfo</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'王五'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span> });
  }
};

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) {
    <span class="hljs-comment">// 获取主应用的事件总线</span>
    eventBus = <span class="hljs-variable language_">window</span>.<span class="hljs-property">eventBus</span>;
    <span class="hljs-comment">// 监听主应用发送的事件</span>
    eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-string">'main-app-msg'</span>, <span class="hljs-function">(<span class="hljs-params">msg: string</span>) =&gt;</span> {
      mainMsg.<span class="hljs-property">value</span> = msg;
    });
    <span class="hljs-comment">// 读取主应用传递的 props</span>
    msg.<span class="hljs-property">value</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span>.<span class="hljs-property">msg</span>;
    userInfo.<span class="hljs-property">value</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span>.<span class="hljs-property">userInfo</span>;
  } <span class="hljs-keyword">else</span> {
    msg.<span class="hljs-property">value</span> = <span class="hljs-string">'独立运行'</span>;
    userInfo.<span class="hljs-property">value</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'测试用户'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> };
  }
});

<span class="hljs-comment">// 子应用发送事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendByBus</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (eventBus) {
    eventBus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'sub-app-msg'</span>, subMsg.<span class="hljs-property">value</span>);
    subMsg.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
  }
};

<span class="hljs-comment">// 卸载时移除事件监听（避免内存泄漏）</span>
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (eventBus) {
    eventBus.<span class="hljs-title function_">off</span>(<span class="hljs-string">'main-app-msg'</span>);
  }
});


<span class="hljs-comment">// 新增：子应用向主应用发消息（调用主应用传递的回调）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendToMain</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span>.<span class="hljs-property">onSubAppMsg</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span>.<span class="hljs-title function_">onSubAppMsg</span>(subMsg.<span class="hljs-property">value</span>);
    subMsg.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>; <span class="hljs-comment">// 清空输入框</span>
  }
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">goBack</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">back</span>();
  } <span class="hljs-keyword">else</span> {
    router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/'</span>);
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<ul>
<li>修改子应用路由（src/router/index.ts）</li>
</ul>
<p>适配主应用的路由前缀（<code>/sub-app</code>）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createRouter, createWebHistory, <span class="hljs-title class_">RouteRecordRaw</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../views/Home.vue'</span>; 

<span class="hljs-comment">// 路由基础路径：qiankun 环境下为 /sub-app </span>
<span class="hljs-keyword">const</span> base = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span> ? <span class="hljs-string">'/sub-app'</span> : <span class="hljs-string">'/'</span>; 
<span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>&gt; = [ { 
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, 
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Home'</span>, 
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span> 
} ]; 

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({ 
    <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(base), 
    routes 
}); 

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;
</code></pre>
<ul>
<li>修改子应用首页（src/views/Home.vue）</li>
</ul>
<p>展示主应用传递的参数，添加返回主应用的按钮：</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt; 
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"home"</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>子应用（sub-app）<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>主应用传递的消息：{{ msg }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"goBack"</span>&gt;</span>返回主应用<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> 
&lt;/template&gt; 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript"> 
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>; 
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>; 
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>(); 
<span class="hljs-keyword">const</span> msg = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>); <span class="hljs-comment">// 获取主应用传递的参数 </span>

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> { 
    <span class="hljs-comment">// @ts-ignore 忽略类型提示（新手友好） </span>
    msg.<span class="hljs-property">value</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span> ? <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span>?.<span class="hljs-property">msg</span> : <span class="hljs-string">'独立运行'</span>; 
}); 
<span class="hljs-comment">// 返回主应用 </span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">goBack</span> = (<span class="hljs-params"/>) =&gt; { 
<span class="hljs-comment">// 嵌入主应用时，使用主应用路由；独立运行时，直接跳转 </span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) { 
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">back</span>(); 
    } <span class="hljs-keyword">else</span> { 
        router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/'</span>); 
    } 
}; 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span> 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css"> 
<span class="hljs-selector-class">.home</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; } 
<span class="hljs-selector-tag">button</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>; <span class="hljs-attribute">cursor</span>: pointer; } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-2">总结</h3>
<ul>
<li>整体架构</li>
</ul>
<ol>
<li>端口冲突：主应用 3000，子应用 3001，确保启动时端口不重复；</li>
<li>跨域配置：主 / 子应用都开启 <code>cors: true</code>，子应用添加 <code>Access-Control-Allow-Origin</code> 头，避免加载资源跨域；</li>
<li>生命周期：子应用必须导出 <code>bootstrap/mount/unmount</code> 三个函数，qiankun 会根据路由匹配自动调用；</li>
<li>样式隔离：主应用启动时配置 <code>strictStyleIsolation: true</code>，避免子应用样式污染主应用；</li>
<li>路由适配：子应用路由的 <code>base</code> 需和主应用的 <code>activeRule</code> 一致（<code>/sub-app</code>），否则路由会失效。</li>
</ol>
<ul>
<li>通信机制</li>
</ul>
<ol>
<li>Props 传参：适合主→子单向简单数据传递，可通过回调实现子→主通信，上手成本最低；</li>
<li>全局状态共享（Pinia/Vuex/Redux） ：推荐用于复杂场景，支持主↔子双向数据同步，符合前端状态管理最佳实践；</li>
<li>事件总线（mitt） ：适合实时触发式交互（如通知、弹窗），轻量灵活，适配所有技术栈。</li>
<li>Url通信：单向传递，参数暴露在 URL 中（不适合敏感数据），参数长度有限制</li>
<li>postmessage通信：跨域名通信，不受 qiankun 沙箱限制，通用所有前端应用；缺点：需要手动验证消息来源（防 XSS），代码冗余，仅适合跨域场景</li>
<li>QIANKUN自带的initGlobalState，qiankun 原生支持，无需第三方库，状态变更自动同步，沙箱兼容好； 缺点是仅支持<strong>浅层次状态更新</strong>（复杂嵌套对象需整体替换），功能比 Pinia/Vuex 简单（无模块化、异步 action 等）</li>
<li>Localstorage等外部存储空间，qiankun 的沙箱默认<strong>不隔离</strong> LocalStorage/SessionStorage（所有子应用共享）：无实时通知，暴露在客户端有安全风险，不适合高频更新的状态</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[github stra 加星和 极易忽略的 4 个 Nginx 关键知识点，避坑指南 + 实战配置]]></title>    <link>https://juejin.cn/post/7600670417859149858</link>    <guid>https://juejin.cn/post/7600670417859149858</guid>    <pubDate>2026-01-30T05:54:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670417859149858" data-draft-id="7600681071715123200" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="github stra 加星和 极易忽略的 4 个 Nginx 关键知识点，避坑指南 + 实战配置"/> <meta itemprop="keywords" content="面试,GitHub"/> <meta itemprop="datePublished" content="2026-01-30T05:54:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开源之眼"/> <meta itemprop="url" content="https://juejin.cn/user/55438993800919"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            github stra 加星和 极易忽略的 4 个 Nginx 关键知识点，避坑指南 + 实战配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/55438993800919/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开源之眼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:54:59.000Z" title="Fri Jan 30 2026 05:54:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常 Nginx 使用中，很多看似细微的配置差异却可能导致服务异常，本文整理了 4 个高频踩坑点，结合实战案例详细解析，帮你快速掌握核心用法～</p>
<h4 data-id="heading-0">Taimili 艾米莉 ( 一款专业的 GitHub star 管理和github 加星涨星工具<a href="https://link.juejin.cn?target=taimili.com" title="https://link.juejin.cn?target=taimili.com" target="_blank">taimili.com</a> )</h4>
<p>艾米莉 是一款优雅便捷的 GitHub star 管理和github 加星涨星工具，基于 PHP &amp; javascript 构建， 能对github star fork follow watch 刷星管理和提升，最适合github 的深度用户</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b95d4a3fca14402782a7bb0fbc0b403b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5rqQ5LmL55y8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357303&amp;x-signature=UtJU%2F1rVy1hCTY7c4O%2BjiLVKJoo%3D" alt="WX20251021-210346@2x.png" loading="lazy"/></p>
<h2 data-id="heading-1">一、proxy_pass 与 location 末尾斜杠的 "生死劫"</h2>
<p>Nginx 反向代理中，<code>proxy_pass</code>和<code>location</code>指令后的斜杠 <code>/</code> 堪称 "细节杀手"，一个字符的差异会导致完全不同的转发结果。</p>
<h3 data-id="heading-2">1. proxy_pass 末尾的斜杠：控制路径前缀是否保留</h3>
<p>先看两组经典配置对比：</p>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置一：proxy_pass无末尾斜杠</span>
location /test {
  proxy_pass <span class="hljs-string">'http://192.186.0.1:8080'</span>;
}

<span class="hljs-comment"># 配置二：proxy_pass有末尾斜杠</span>
location /test {
  proxy_pass <span class="hljs-string">'http://192.186.0.1:8080/'</span>;
}
</code></pre>
<p>当请求接口 <code>http://domain/test/file/getList</code> 时：</p>
<ul>
<li>配置一转发结果：<code>http://192.186.0.1:8080/test/file/getList</code>（保留 <code>/test</code> 前缀）</li>
<li>配置二转发结果：<code>http://192.186.0.1:8080/file/getList</code>（去除 <code>/test</code> 前缀）</li>
</ul>
<p><strong>核心逻辑</strong>：<code>proxy_pass</code> 后的斜杠表示 "去除 location 匹配的路径前缀"。</p>
<ul>
<li>若后端接口本身包含 <code>/test</code> 路径，无需加斜杠；</li>
<li>若 <code>/test</code> 仅为前端反向代理拦截标识（后端无此路径），必须加斜杠。</li>
</ul>
<p><strong>推荐写法</strong>（可读性更强，避免歧义）：</p>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash">location /test {
  rewrite ^/test/(.*)$ /<span class="hljs-variable">$1</span> <span class="hljs-built_in">break</span>;  <span class="hljs-comment"># 显式去除/test前缀</span>
  proxy_pass <span class="hljs-string">'http://192.186.0.1:8080'</span>;
}
</code></pre>
<h3 data-id="heading-3">2. location 末尾的斜杠：控制匹配精度</h3>
<p>再看另一组配置差异：</p>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置一：location无末尾斜杠</span>
location /test {
  proxy_pass <span class="hljs-string">'http://192.186.0.1:8080'</span>;
}

<span class="hljs-comment"># 配置二：location有末尾斜杠</span>
location /test/ {
  proxy_pass <span class="hljs-string">'http://192.186.0.1:8080'</span>;
}
</code></pre>
<p>两者的匹配规则天差地别，具体对比如下：</p>









































<table><thead><tr><th>请求路径</th><th>location /test</th><th>location /test/</th><th>最终匹配结果</th></tr></thead><tbody><tr><td>/test</td><td>✅</td><td>❌</td><td>location /test</td></tr><tr><td>/test/</td><td>✅</td><td>✅</td><td>location /test/</td></tr><tr><td>/test/abc</td><td>✅</td><td>✅</td><td>location /test/</td></tr><tr><td>/test123</td><td>✅</td><td>❌</td><td>location /test</td></tr><tr><td>/test-123</td><td>✅</td><td>❌</td><td>location /test</td></tr></tbody></table>
<p><strong>关键结论</strong>：</p>
<ul>
<li><code>location /test</code>（无斜杠）：模糊匹配，包含 <code>/test</code> 开头的所有路径（包括 <code>/test123</code> 这类 "伪前缀" 路径）；</li>
<li><code>location /test/</code>（有斜杠）：精确匹配，仅匹配以 <code>/test/</code> 为前缀的路径（避免误匹配相似路径）；</li>
<li>当两个配置同时存在时，Nginx 会优先选择更精确的 <code>location /test/</code>（涉及匹配优先级规则）。</li>
</ul>
<h3 data-id="heading-4">延伸：Nginx location 匹配优先级完整版</h3>
<p>记住核心口诀（从高到低）：</p>
<p>plaintext</p>
<pre><code class="hljs">等号精确第一名
波浪前缀挡正则
正则排队按顺序
普通前缀取最长
</code></pre>
<p>详细解释：</p>
<ol>
<li><strong>等号精确匹配（=）</strong> ：优先级最高，完全匹配目标路径（如 <code>location = /</code> 仅匹配根路径）；</li>
<li><strong>前缀优先匹配（^~）</strong> ：匹配路径前缀，且会阻止后续正则匹配（适用于静态资源目录，提升性能）；</li>
<li>*<em>正则匹配（~ 区分大小写 / ~</em> 不区分大小写）**：按配置文件顺序匹配，一旦命中立即返回；</li>
<li><strong>普通前缀匹配（无符号）</strong> ：按最长路径匹配原则（如 <code>/api/v2/</code> 比 <code>/api/</code> 优先级高）；</li>
<li><strong>通用匹配（/）</strong> ：兜底规则，匹配所有未被前面规则命中的请求。</li>
</ol>
<p><strong>电商实战配置示例</strong>（覆盖所有优先级场景）：</p>
<p>nginx</p>
<pre><code class="hljs language-ini" lang="ini">server {
    listen 80<span class="hljs-comment">;</span>
    server_name shop.example.com<span class="hljs-comment">;</span>
    root /var/www/shop<span class="hljs-comment">;</span>

    <span class="hljs-comment"># 1. 精确匹配（=）- 最高优先级</span>
    <span class="hljs-attr">location</span> = / {
        return 200 "首页 <span class="hljs-section">[精确匹配 =]</span>"<span class="hljs-comment">;</span>
        add_header Content-Type text/plain<span class="hljs-comment">;</span>
    }
    <span class="hljs-attr">location</span> = /robots.txt {
        return 200 "User-agent: *\nDisallow: /admin/"<span class="hljs-comment">;</span>
        add_header Content-Type text/plain<span class="hljs-comment">;</span>
    }

    <span class="hljs-comment"># 2. 前缀优先匹配（^~）- 阻止正则</span>
    location ^~ /static/ {
        alias /var/www/shop/static/<span class="hljs-comment">;</span>
        expires 30d<span class="hljs-comment">;</span>
        return 200 "静态资源 <span class="hljs-section">[前缀优先 ^~]</span>"<span class="hljs-comment">;</span>
    }

    <span class="hljs-comment"># 3. 正则匹配（~ / ~*）- 按顺序</span>
    location ~ .(jpg|png|gif)$ {  <span class="hljs-comment"># 区分大小写</span>
        expires 30d<span class="hljs-comment">;</span>
        return 200 "图片文件 <span class="hljs-section">[正则 ~]</span>"<span class="hljs-comment">;</span>
    }
    location ~* .(css|js)$ {  <span class="hljs-comment"># 不区分大小写</span>
        expires 7d<span class="hljs-comment">;</span>
        return 200 "CSS/JS <span class="hljs-section">[正则 ~*]</span>"<span class="hljs-comment">;</span>
    }

    <span class="hljs-comment"># 4. 普通前缀匹配 - 最长优先</span>
    location /api/v2/ {  <span class="hljs-comment"># 最长前缀</span>
        proxy_pass http://backend_v2<span class="hljs-comment">;</span>
        return 200 "API v2 <span class="hljs-section">[普通前缀-最长]</span>"<span class="hljs-comment">;</span>
    }
    location /api/ {  <span class="hljs-comment"># 较短前缀</span>
        proxy_pass http://backend<span class="hljs-comment">;</span>
        return 200 "API 通用 <span class="hljs-section">[普通前缀-较短]</span>"<span class="hljs-comment">;</span>
    }

    <span class="hljs-comment"># 5. 兜底匹配</span>
    location / {
        try_files $uri $uri/ /index.html<span class="hljs-comment">;</span>
        return 200 "通用兜底 <span class="hljs-section">[/]</span>"<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h2 data-id="heading-5">二、Nginx 重启命令：reload vs systemctl reload，该用哪个？</h2>
<p>日常运维中，重启 Nginx 有两种常用命令，但适用场景和执行逻辑差异明显：</p>























<table><thead><tr><th>命令形式</th><th>执行原理</th><th>适用场景</th><th>核心特点</th></tr></thead><tbody><tr><td><code>nginx -s reload</code></td><td>直接向 Nginx 主进程发送 reload 信号</td><td>本地开发环境、无 systemd 的系统</td><td>原生方式，需确保 nginx 在 PATH 中</td></tr><tr><td><code>systemctl reload nginx</code></td><td>通过 systemd 管理服务发送重载信号</td><td>CentOS7+/Ubuntu16.04 + 等现代 Linux</td><td>系统标准方式，推荐生产环境使用</td></tr></tbody></table>
<h3 data-id="heading-6">关键补充：</h3>
<ol>
<li>
<p>两者均为<strong>优雅重启</strong>：不中断现有连接，平滑加载新配置；</p>
</li>
<li>
<p>相关命令对应关系：</p>
<ul>
<li><code>nginx -s stop</code> ≈ <code>systemctl stop nginx</code>（强制停止）</li>
<li><code>nginx -s quit</code> ≈ <code>systemctl stop nginx</code>（优雅停止）</li>
<li><code>nginx -t</code>：单独测试配置文件语法（无 systemctl 对应命令）；</li>
</ul>
</li>
<li>
<p>生产环境推荐操作流程（安全无风险）：</p>
</li>
</ol>
<p>bash</p>
<p>运行</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 先测试配置文件语法是否正确</span>
nginx -t

<span class="hljs-comment"># 2. 语法正确则平滑重载（不中断服务）</span>
systemctl reload nginx

<span class="hljs-comment"># 3. 检查服务状态</span>
systemctl status nginx

<span class="hljs-comment"># 4. 备用方案（若systemctl不可用）</span>
sudo /usr/sbin/nginx -s reload
</code></pre>
<p><strong>总结</strong>：生产环境优先使用 <code>systemctl</code> 系列命令（现代 Linux 标准），本地开发或无 systemd 环境可使用 <code>nginx -s</code> 原生命令。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Studio中Gradle版本修改与兼容性管理指南]]></title>    <link>https://juejin.cn/post/7600681071715287040</link>    <guid>https://juejin.cn/post/7600681071715287040</guid>    <pubDate>2026-01-30T06:12:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600681071715287040" data-draft-id="7600681071715254272" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Studio中Gradle版本修改与兼容性管理指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T06:12:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="城西往事"/> <meta itemprop="url" content="https://juejin.cn/user/1392401215657757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Studio中Gradle版本修改与兼容性管理指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1392401215657757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    城西往事
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:12:36.000Z" title="Fri Jan 30 2026 06:12:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d0890e56fc241168bf053f51623dd39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O6KW_5b6A5LqL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358355&amp;x-signature=dBbeoW3kUqB5PxfFiVeCGxmepc0%3D" alt="avatar" loading="lazy"/>2025-12-10 13:17:42</p>
<p>在Android开发中，Gradle版本与Android Gradle Plugin（AGP）的兼容性直接影响项目构建效率。本文详细介绍如何安全修改Gradle版本，并处理常见兼容性问题。</p>
<h2 data-id="heading-0">核心操作步骤<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%230" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#0" ref="nofollow noopener noreferrer"/></h2>
<h3 data-id="heading-1">修改Gradle插件版本（AGP）<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%231" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#1" ref="nofollow noopener noreferrer"/></h3>
<p>在项目根目录的<code>build.gradle</code>文件中，调整<code>classpath</code>依赖的AGP版本。例如将版本升级至8.13.2：</p>
<pre><code class="hljs language-groovy" lang="groovy">buildscript {
    dependencies {
        classpath "com.android.tools.build:gradle:8.13.2"
    }
}
</code></pre>
<p>或使用Kotlin DSL格式：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin">
plugins {
    id(<span class="hljs-string">"com.android.application"</span>) version <span class="hljs-string">"8.13.2"</span> apply <span class="hljs-literal">false</span>
}
</code></pre>
<h3 data-id="heading-2">修改Gradle发行版版本<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%232" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#2" ref="nofollow noopener noreferrer"/></h3>
<p>通过<code>gradle-wrapper.properties</code>文件指定Gradle版本。例如使用Gradle 8.13：</p>
<pre><code class="hljs language-properties" lang="properties">
distributionUrl=https://services.gradle.org/distributions/gradle-8.13-bin.zip
</code></pre>
<p><strong>图形界面操作</strong>：通过 <strong>File &gt; Project Structure &gt; Project</strong> 菜单，直接选择Gradle和AGP版本。</p>
<h3 data-id="heading-3">同步与清理<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%233" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#3" ref="nofollow noopener noreferrer"/></h3>
<p>修改后执行以下命令确保环境干净：</p>
<pre><code class="hljs language-bash" lang="bash">
./gradlew --stop  <span class="hljs-comment"># 停止旧版Gradle守护进程</span>
./gradlew clean   <span class="hljs-comment"># 清理构建缓存</span>
</code></pre>
<h2 data-id="heading-4">版本兼容性规则<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%234" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#4" ref="nofollow noopener noreferrer"/></h2>
<h3 data-id="heading-5">AGP与Gradle兼容关系<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%235" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#5" ref="nofollow noopener noreferrer"/></h3>

























<table><thead><tr><th>AGP版本</th><th>最低Gradle版本</th><th>推荐Gradle版本</th></tr></thead><tbody><tr><td>8.x</td><td>8.0</td><td>8.13</td></tr><tr><td>7.x</td><td>7.0</td><td>7.6</td></tr><tr><td>完整兼容表参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.google.cn%2Fstudio%2Freleases%2Fgradle-plugin.html%23updating-gradle" target="_blank" title="https://developer.android.google.cn/studio/releases/gradle-plugin.html#updating-gradle" ref="nofollow noopener noreferrer">官方文档</a>。</td><td/><td/></tr></tbody></table>
<h3 data-id="heading-6">常见错误处理<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%236" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#6" ref="nofollow noopener noreferrer"/></h3>
<ul>
<li><strong>错误1</strong>：<code>Minimum supported Gradle version is X.X.X</code><br/>
<strong>原因</strong>：AGP版本高于Gradle版本。<br/>
<strong>解决</strong>：升级Gradle或降级AGP。</li>
<li><strong>错误2</strong>：<code>Could not find com.android.tools.build:gradle:X.X.X</code><br/>
<strong>原因</strong>：插件版本不存在或网络问题。<br/>
<strong>解决</strong>：检查版本号或更换镜像源。</li>
</ul>
<h2 data-id="heading-7">最佳实践建议<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%237" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#7" ref="nofollow noopener noreferrer"/></h2>
<h3 data-id="heading-8">稳定版组合推荐<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%238" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#8" ref="nofollow noopener noreferrer"/></h3>
<ul>
<li>AGP 8.13 + Gradle 8.13（2025年最新稳定版）</li>
<li>避免使用动态版本（如<code>8.13.+</code>），防止意外更新。</li>
</ul>
<h3 data-id="heading-9">多模块项目配置<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%239" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#9" ref="nofollow noopener noreferrer"/></h3>
<p>确保所有模块的<code>build.gradle</code>中AGP版本一致。例如：</p>
<pre><code class="hljs language-groovy" lang="groovy">plugins {
    id("com.android.library") version "8.13.2"
}
</code></pre>
<h3 data-id="heading-10">离线模式优化<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%2310" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#10" ref="nofollow noopener noreferrer"/></h3>
<p>在<code>File &gt; Settings &gt; Build, Execution, Deployment &gt; Gradle</code>中启用 <strong>Offline work</strong>，可加速同步（需提前下载依赖）。</p>
<h2 data-id="heading-11">完整配置示例<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%2311" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#11" ref="nofollow noopener noreferrer"/></h2>
<h3 data-id="heading-12">项目级<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%2312" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#12" ref="nofollow noopener noreferrer"> </a><code>build.gradle</code></h3>
<pre><code class="hljs language-groovy" lang="groovy">
buildscript {
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath "com.android.tools.build:gradle:8.13.2"
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:1.9.22"
    }
}

allprojects {
    repositories {
        google()
        mavenCentral()
    }
}
</code></pre>
<h3 data-id="heading-13"><a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%2313" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#13" ref="nofollow noopener noreferrer"/><code>gradle-wrapper.properties</code></h3>
<pre><code class="hljs language-properties" lang="properties">
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https://services.gradle.org/distributions/gradle-8.13-bin.zip
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PPIO 上线 PaddleOCR-VL-1.5 ：小参数高性能 | 一键部署]]></title>    <link>https://juejin.cn/post/7600764857769279538</link>    <guid>https://juejin.cn/post/7600764857769279538</guid>    <pubDate>2026-01-30T05:41:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600764857769279538" data-draft-id="7600764857769263154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PPIO 上线 PaddleOCR-VL-1.5 ：小参数高性能 | 一键部署"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-30T05:41:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PPIO派欧云"/> <meta itemprop="url" content="https://juejin.cn/user/2922958914073696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PPIO 上线 PaddleOCR-VL-1.5 ：小参数高性能 | 一键部署
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2922958914073696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PPIO派欧云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:41:20.000Z" title="Fri Jan 30 2026 05:41:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2c9314356754ab295b55e25fd7182e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=S11AfwzIQRxgv5bihHeDMl4EZYw%3D" alt="" loading="lazy"/></p>
<p>PPIO 算力市场首发上线了 PaddleOCR-VL-1.5 模型模板。</p>
<p>作为 PaddleOCR-VL 系列的全新迭代版本，PaddleOCR-VL-1.5 在保持 0.9B 轻量级参数的同时，性能实现了显著提升 。在权威评测集 OmniDocBench v1.5 上，该模型取得了 94.5% 的精度，优于当前主流的通用大模型及文档解析专用模型。</p>
<p>该模型创新性地支持了文档元素的异形框定位，在扫描、倾斜、弯折、屏幕拍摄及复杂光照等真实落地场景中表现出色，能够精准返回多边形检测框。此外，模型还新增了印章识别与文本行定位功能，并优化了生僻字、古籍及多语种表格的解析效果。</p>
<p>现在，您可以通过 PPIO 算力市场的 PaddleOCR-VL-1.5 模板，将该模型一键部署在 GPU 云服务器上。只需简单几步，即可快速体验模型高效的文档解析能力。</p>
<p>一键部署地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fppio.com%2Fgpu-instance%2Fconsole%2Fexplore" target="_blank" title="https://ppio.com/gpu-instance/console/explore" ref="nofollow noopener noreferrer">ppio.com/gpu-instanc…</a></p>
<h2 data-id="heading-0"><strong>01</strong> <strong>GPU</strong> <strong>实例+模板，一键部署 PaddleOCR-VL-1.5</strong></h2>
<p>step 1: 子模版市场选择对应模板，并使用此模板。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd03f508d2b74e8693cab4e39f2429cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=9mtbC2dRv0WK4IPNXZtpN%2BqKNUs%3D" alt="" loading="lazy"/></p>
<p>step 2: 按照所需配置点击部署。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0e87bd7cd2a488985c4b039964c0587~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=raP%2FxbmDjzNb7%2FgAZaV%2F9dABTU8%3D" alt="" loading="lazy"/></p>
<p>step 3: 检查磁盘大小等信息，确认无误后点击下一步。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb32914fe2f34809a0fe5f61c597f01c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=Iu8%2FhQOdS%2FUQEGxWMM9NtlbLYrs%3D" alt="" loading="lazy"/></p>
<p>step 4: 稍等一会，实例创建需要一些时间。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eabf9ae3cb2841c591a53014221558fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=0avppuVWfZXbFNSYIx6iJZyqy7I%3D" alt="" loading="lazy"/></p>
<p>step 5: 在实例管理里可以查看到所创建的实例。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a82015b09a6453b85784c17ce4e05ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=I2wyCv%2FtCZEslTJRRM%2FTw5%2B2FXQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>02 使用示例</strong></h2>
<h4 data-id="heading-2">第一步</h4>
<p>测试用例如下，后续将被命名为 test.py。</p>
<pre><code class="hljs language-ini" lang="ini">import base64
import requests
import pathlib

<span class="hljs-attr">API_URL</span> = <span class="hljs-string">"http://localhost:8080/layout-parsing"</span>  <span class="hljs-comment"># Service URL</span>

<span class="hljs-attr">image_path</span> = <span class="hljs-string">"./demo.jpg"</span>

<span class="hljs-comment"># Encode local image to Base64</span>
with open(image_path, "rb") as file:
    <span class="hljs-attr">image_bytes</span> = file.read()
    <span class="hljs-attr">image_data</span> = base64.b64encode(image_bytes).decode(<span class="hljs-string">"ascii"</span>)

<span class="hljs-attr">payload</span> = {
    "file": image_data,  <span class="hljs-comment"># Base64 encoded file content or file URL</span>
    "fileType": 1,  <span class="hljs-comment"># File type, 1 means image file</span>
}

<span class="hljs-comment"># Call the API</span>
<span class="hljs-attr">response</span> = requests.post(API_URL, json=payload)

<span class="hljs-comment"># Process the API response data</span>
assert <span class="hljs-attr">response.status_code</span> == <span class="hljs-number">200</span>
<span class="hljs-attr">result</span> = response.json()[<span class="hljs-string">"result"</span>]
for i, res in enumerate(result<span class="hljs-section">["layoutParsingResults"]</span>):
    print(res<span class="hljs-section">["prunedResult"]</span>)
    <span class="hljs-attr">md_dir</span> = pathlib.Path(f<span class="hljs-string">"markdown_{i}"</span>)
    md_dir.mkdir(<span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
    (md_dir / "doc.md").write_text(res<span class="hljs-section">["markdown"]</span><span class="hljs-section">["text"]</span>)
    for img_path, img in res<span class="hljs-section">["markdown"]</span><span class="hljs-section">["images"]</span>.items():
        <span class="hljs-attr">img_path</span> = md_dir / img_path
        img_path.parent.mkdir(<span class="hljs-attr">parents</span>=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)
        img_path.write_bytes(base64.b64decode(img))
    print(f"Markdown document saved at {md_dir / 'doc.md'}")
    for img_name, img in res<span class="hljs-section">["outputImages"]</span>.items():
        <span class="hljs-attr">img_path</span> = f<span class="hljs-string">"{img_name}_{i}.jpg"</span>
        pathlib.Path(img_path).parent.mkdir(<span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
        with open(img_path, "wb") as f:
            f.write(base64.b64decode(img))
        print(f"Output image saved at {img_path}")
</code></pre>
<h4 data-id="heading-3">第二步</h4>
<p>准备OCR所需的图片 这里使用的是官方案例</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPaddlePaddle%2FPaddleOCR%2Fblob%2Fmain%2Ftests%2Ftest_files%2Fbook.jpg" target="_blank" title="https://github.com/PaddlePaddle/PaddleOCR/blob/main/tests/test_files/book.jpg" ref="nofollow noopener noreferrer">github.com/PaddlePaddl…</a></p>
<pre><code class="hljs language-bash" lang="bash">curl https://raw.githubusercontent.com/PaddlePaddle/PaddleOCR/main/tests/test_files/book.jpg -o demo.jpg 
复制端口映射地址并在 test.py 文件中替换 API URL
</code></pre>
<h4 data-id="heading-4">第三步</h4>
<p>运行 python test.py 检查输出结果</p>
<pre><code class="hljs language-lua" lang="lua">$ python test.py 
{<span class="hljs-string">'page_count'</span>: None, <span class="hljs-string">'width'</span>: <span class="hljs-number">1100</span>, <span class="hljs-string">'height'</span>: <span class="hljs-number">708</span>, <span class="hljs-string">'model_settings'</span>: {<span class="hljs-string">'use_doc_preprocessor'</span>: False, <span class="hljs-string">'use_layout_detection'</span>: True, <span class="hljs-string">'use_chart_recognition'</span>: False, <span class="hljs-string">'use_seal_recognition'</span>: False, <span class="hljs-string">'use_ocr_for_image_block'</span>: False, <span class="hljs-string">'format_block_content'</span>: False, <span class="hljs-string">'merge_layout_blocks'</span>: True, <span class="hljs-string">'markdown_ignore_labels'</span>: [<span class="hljs-string">'number'</span>, <span class="hljs-string">'footnote'</span>, <span class="hljs-string">'header'</span>, <span class="hljs-string">'header_image'</span>, <span class="hljs-string">'footer'</span>, <span class="hljs-string">'footer_image'</span>, <span class="hljs-string">'aside_text'</span>], <span class="hljs-string">'return_layout_polygon_points'</span>: True}, <span class="hljs-string">'parsing_res_list'</span>: [{<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"chances of the lottery jachts are also use combination formulas to work out the chances of the other prizes, but it all starts to get a bit fiddly so we'll move on to something else. (How to work out the other lottery chances is just one of the amazing features you'll find at: www.murderousmaths.co.uk)"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">180</span>, <span class="hljs-number">0</span>, <span class="hljs-number">512</span>, <span class="hljs-number">109</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[180.0, 0.0], [512.0, 0.0], [512.0, 109.0], [180.0, 109.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'paragraph_title'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">'The disappearing sum'</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">180</span>, <span class="hljs-number">113</span>, <span class="hljs-number">310</span>, <span class="hljs-number">137</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[179.04934692382812, 119.45269012451172], [308.8138122558594, 110.3464126586914], [310.1516418457031, 129.41043090820312], [180.38717651367188, 138.51669311523438]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"It's Friday evening. The lovely Veronica Gumfloss has been out with the football team who have all escorted her safely back to her doorstep. It's that tender moment when each hopeful player closes his eyes and leans forward with quivering lips. Unfortunately Veronica's parents heard them clumping down the road and Veronica knows she only has time to kiss four out of the eleven of them if she's going to do it properly."</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">175</span>, <span class="hljs-number">126</span>, <span class="hljs-number">505</span>, <span class="hljs-number">289</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[175, 137], [175, 281], [499, 285], [504, 134], [455, 126], [302, 126]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'image'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">''</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">179</span>, <span class="hljs-number">282</span>, <span class="hljs-number">491</span>, <span class="hljs-number">471</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'block_order'</span>: None, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[179.0, 282.0], [491.0, 282.0], [491.0, 471.0], [179.0, 471.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'vision_footnote'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"How many choices has she got? It's  $ ^{11}C_{4} $ which is  $ ^{111}4l \times 7 $ but for goodness sake DON'T reach for the calculator! The most brilliant thing about perms and"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">164</span>, <span class="hljs-number">455</span>, <span class="hljs-number">493</span>, <span class="hljs-number">531</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'block_order'</span>: None, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[164, 459], [164, 505], [345, 527], [492, 527], [492, 474], [377, 470], [323, 466], [246, 459], [207, 455], [170, 455]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'number'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">'94'</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">301</span>, <span class="hljs-number">546</span>, <span class="hljs-number">326</span>, <span class="hljs-number">563</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'block_order'</span>: None, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[301.0, 546.0], [325.0, 546.0], [325.0, 562.0], [301.0, 562.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"means that EVERYTHING ON THE BOTTOM ALWAYS CANCELS OUT! It's probably the best fun you'll ever have with a pencil so here we go..."</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">552</span>, <span class="hljs-number">0</span>, <span class="hljs-number">892</span>, <span class="hljs-number">85</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">6</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">6</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[552.6058349609375, -9.254895210266113], [895.4388427734375, 13.18508529663086], [890.72705078125, 85.17122650146484], [547.89404296875, 62.73124313354492]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">' $$ \frac{11!}{4!\times7!}=\quad\frac{11\times10\times9\times8\times7\times6\times5\times4\times3\times2\times1}{4\times3\times2\times1\times7\times6\times5\times4\times3\times2\times1} $$ '</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">573</span>, <span class="hljs-number">74</span>, <span class="hljs-number">880</span>, <span class="hljs-number">128</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">7</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">7</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[573, 89], [573, 109], [650, 113], [700, 117], [879, 127], [879, 96], [869, 92], [770, 85], [688, 78], [644, 74], [579, 74]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"(Before we continue, grab this book and show somebody this sum. Rub their face on it if you need to and tell them that this is the sort of thing you do for fun without a calculator these days because you're so brilliant.)"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">550</span>, <span class="hljs-number">123</span>, <span class="hljs-number">889</span>, <span class="hljs-number">219</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">8</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">6</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">8</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[550, 123], [550, 204], [660, 208], [883, 218], [888, 141], [697, 127], [648, 123]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"Off we go then. For starters we'll get rid of the 7! bit from top and bottom and get:"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">549</span>, <span class="hljs-number">203</span>, <span class="hljs-number">887</span>, <span class="hljs-number">253</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">9</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">7</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">9</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[549, 203], [549, 238], [886, 252], [886, 218], [792, 214], [676, 207]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">' $$ \frac{11\times10\times9\times8}{4\times3\times2\times1} $$ '</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">677</span>, <span class="hljs-number">255</span>, <span class="hljs-number">769</span>, <span class="hljs-number">292</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">10</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">8</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">10</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[677.0, 255.0], [769.0, 255.0], [769.0, 292.0], [677.0, 292.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"Pow! That's already got rid of more than half the numbers. Next we'll see that the  $ 4 \times 2 $ on the bottom cancels out the 8 on top (and we don't need that “×1” on the bottom either). We're left with..."</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">547</span>, <span class="hljs-number">300</span>, <span class="hljs-number">886</span>, <span class="hljs-number">376</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">11</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">9</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">11</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[547.0, 299.99993896484375], [886.40771484375, 307.02911376953125], [885.0, 375.0], [545.59228515625, 367.9708251953125]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">' $$ \frac{11\times10\times9}{3} $$ '</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">685</span>, <span class="hljs-number">384</span>, <span class="hljs-number">756</span>, <span class="hljs-number">417</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">12</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">10</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">12</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[685.0, 384.0], [756.0, 384.0], [756.0, 417.0], [685.0, 417.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"Then the 3 on the bottom divides into the 9 on top leaving it as a 3 so all we've got now is:"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">545</span>, <span class="hljs-number">429</span>, <span class="hljs-number">884</span>, <span class="hljs-number">468</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">13</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">11</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">13</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[545.0, 429.0], [884.0, 429.0], [884.0, 468.0], [545.0, 468.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"Veronica's choices = 11 × 10 × 3"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">618</span>, <span class="hljs-number">477</span>, <span class="hljs-number">817</span>, <span class="hljs-number">496</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">14</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">12</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">14</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[618.0, 477.0], [816.0, 477.0], [816.0, 495.0], [618.0, 495.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">'Look! No bottom.'</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">543</span>, <span class="hljs-number">508</span>, <span class="hljs-number">666</span>, <span class="hljs-number">529</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">15</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">13</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">15</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[542.9999389648438, 508.0], [664.9999389648438, 508.0], [664.9999389648438, 528.0], [542.9999389648438, 528.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'number'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">'95'</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">705</span>, <span class="hljs-number">555</span>, <span class="hljs-number">729</span>, <span class="hljs-number">571</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">16</span>, <span class="hljs-string">'block_order'</span>: None, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">16</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[705.0, 555.0], [728.0, 555.0], [728.0, 570.0], [705.0, 570.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'image'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">''</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">938</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1099</span>, <span class="hljs-number">647</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">17</span>, <span class="hljs-string">'block_order'</span>: None, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">17</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[938.0, -2.0], [1099.0, -2.0], [1099.0, 647.0], [938.0, 647.0]]</span>}], <span class="hljs-string">'layout_det_res'</span>: {<span class="hljs-string">'boxes'</span>: [{<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.9220595955848694</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">180</span>, <span class="hljs-number">0</span>, <span class="hljs-number">512</span>, <span class="hljs-number">109</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[180.0, 0.0], [512.0, 0.0], [512.0, 109.0], [180.0, 109.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">17</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'paragraph_title'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8456085920333862</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">180</span>, <span class="hljs-number">113</span>, <span class="hljs-number">310</span>, <span class="hljs-number">137</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[179.04934692382812, 119.45269012451172], [308.8138122558594, 110.3464126586914], [310.1516418457031, 129.41043090820312], [180.38717651367188, 138.51669311523438]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.9213816523551941</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">175</span>, <span class="hljs-number">126</span>, <span class="hljs-number">505</span>, <span class="hljs-number">289</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[175, 137], [175, 281], [499, 285], [504, 134], [455, 126], [302, 126]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">14</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'image'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.9448813199996948</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">179</span>, <span class="hljs-number">282</span>, <span class="hljs-number">491</span>, <span class="hljs-number">471</span>], <span class="hljs-string">'order'</span>: None, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[179.0, 282.0], [491.0, 282.0], [491.0, 471.0], [179.0, 471.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">24</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'vision_footnote'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8173566460609436</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">164</span>, <span class="hljs-number">455</span>, <span class="hljs-number">493</span>, <span class="hljs-number">531</span>], <span class="hljs-string">'order'</span>: None, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[164, 459], [164, 505], [345, 527], [492, 527], [492, 474], [377, 470], [323, 466], [246, 459], [207, 455], [170, 455]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">16</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'number'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.7621420621871948</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">301</span>, <span class="hljs-number">546</span>, <span class="hljs-number">326</span>, <span class="hljs-number">563</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[301.0, 546.0], [325.0, 546.0], [325.0, 562.0], [301.0, 562.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.913713276386261</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">552</span>, <span class="hljs-number">0</span>, <span class="hljs-number">892</span>, <span class="hljs-number">85</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[552.6058349609375, -9.254895210266113], [895.4388427734375, 13.18508529663086], [890.72705078125, 85.17122650146484], [547.89404296875, 62.73124313354492]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8774852156639099</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">573</span>, <span class="hljs-number">74</span>, <span class="hljs-number">880</span>, <span class="hljs-number">128</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">6</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[573, 89], [573, 109], [650, 113], [700, 117], [879, 127], [879, 96], [869, 92], [770, 85], [688, 78], [644, 74], [579, 74]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.9250841736793518</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">550</span>, <span class="hljs-number">123</span>, <span class="hljs-number">889</span>, <span class="hljs-number">219</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">7</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[550, 123], [550, 204], [660, 208], [883, 218], [888, 141], [697, 127], [648, 123]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8921533823013306</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">549</span>, <span class="hljs-number">203</span>, <span class="hljs-number">887</span>, <span class="hljs-number">253</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">8</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[549, 203], [549, 238], [886, 252], [886, 218], [792, 214], [676, 207]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.7999240159988403</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">677</span>, <span class="hljs-number">255</span>, <span class="hljs-number">769</span>, <span class="hljs-number">292</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">9</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[677.0, 255.0], [769.0, 255.0], [769.0, 292.0], [677.0, 292.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.9141753315925598</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">547</span>, <span class="hljs-number">300</span>, <span class="hljs-number">886</span>, <span class="hljs-number">376</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">10</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[547.0, 299.99993896484375], [886.40771484375, 307.02911376953125], [885.0, 375.0], [545.59228515625, 367.9708251953125]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.849932074546814</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">685</span>, <span class="hljs-number">384</span>, <span class="hljs-number">756</span>, <span class="hljs-number">417</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">11</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[685.0, 384.0], [756.0, 384.0], [756.0, 417.0], [685.0, 417.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8802617192268372</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">545</span>, <span class="hljs-number">429</span>, <span class="hljs-number">884</span>, <span class="hljs-number">468</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">12</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[545.0, 429.0], [884.0, 429.0], [884.0, 468.0], [545.0, 468.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.7239603400230408</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">618</span>, <span class="hljs-number">477</span>, <span class="hljs-number">817</span>, <span class="hljs-number">496</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">13</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[618.0, 477.0], [816.0, 477.0], [816.0, 495.0], [618.0, 495.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8236865997314453</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">543</span>, <span class="hljs-number">508</span>, <span class="hljs-number">666</span>, <span class="hljs-number">529</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">14</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[542.9999389648438, 508.0], [664.9999389648438, 508.0], [664.9999389648438, 528.0], [542.9999389648438, 528.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">16</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'number'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.552054762840271</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">705</span>, <span class="hljs-number">555</span>, <span class="hljs-number">729</span>, <span class="hljs-number">571</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">15</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[705.0, 555.0], [728.0, 555.0], [728.0, 570.0], [705.0, 570.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">14</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'image'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8069510459899902</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">938</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1099</span>, <span class="hljs-number">647</span>], <span class="hljs-string">'order'</span>: None, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[938.0, -2.0], [1099.0, -2.0], [1099.0, 647.0], [938.0, 647.0]]</span>}]}}
Markdown document saved at markdown_0/doc.md
Output image saved at layout_det_res_0.jpg
</code></pre>
<p>PPIO 的算力市场模板致力于帮助企业及个人开发者降低大模型私有化部署的门槛，无需繁琐的环境配置，即可实现高效、安全的模型落地。</p>
<p>目前，PPIO算力市场已上线几十个私有化部署模板，除了 PaddleOCR-VL-1.5，你也可以将DeepSeek-OCR-2、AutoGLM-Phone-9B、 GLM-Image、PaddleOCR-VL 等模型快速进行私有化部署。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何基于瑞芯微芯片的Linux Sdk开发应用]]></title>    <link>https://juejin.cn/post/7600709805469351979</link>    <guid>https://juejin.cn/post/7600709805469351979</guid>    <pubDate>2026-01-30T05:50:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600709805469351979" data-draft-id="7600760073007382582" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何基于瑞芯微芯片的Linux Sdk开发应用"/> <meta itemprop="keywords" content="嵌入式"/> <meta itemprop="datePublished" content="2026-01-30T05:50:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YF0211"/> <meta itemprop="url" content="https://juejin.cn/user/2576910988619064"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何基于瑞芯微芯片的Linux Sdk开发应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2576910988619064/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YF0211
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:50:35.000Z" title="Fri Jan 30 2026 05:50:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h5 data-id="heading-0">RV1126B 系列</h5>
<h2 data-id="heading-1">1、创建工程</h2>
<pre><code class="hljs language-bash" lang="bash">   <span class="hljs-built_in">cd</span> project/app
   <span class="hljs-built_in">mkdir</span> demo/
   <span class="hljs-built_in">cd</span> demo/
   <span class="hljs-built_in">mkdir</span> src
   <span class="hljs-built_in">cd</span>  /src
   <span class="hljs-built_in">touch</span> xxx.h
   <span class="hljs-built_in">touch</span> xxx.c
</code></pre>
<h2 data-id="heading-2">2、创建配置文件</h2>
<pre><code class="hljs language-bash" lang="bash">   <span class="hljs-built_in">cd</span> project/buildroot/package
   <span class="hljs-built_in">mkdir</span> demo
   <span class="hljs-built_in">touch</span> Config.<span class="hljs-keyword">in</span>
   <span class="hljs-built_in">touch</span> demo.mk
</code></pre>
<p>Config.in参照规则写，如</p>
<pre><code class="hljs language-arduino" lang="arduino">   config BR2_PACKAGE_DEMO
    <span class="hljs-type">bool</span> <span class="hljs-string">"demo"</span>
    <span class="hljs-keyword">default</span> y
    help
      JT/T <span class="hljs-number">808</span> position report demo <span class="hljs-keyword">for</span> RV1126B
</code></pre>
<p>demo.mk参照规则写，如</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">DEMO_VERSION</span> = <span class="hljs-number">1.0</span>
<span class="hljs-selector-tag">DEMO_SITE</span> = $(TOPDIR)/../<span class="hljs-selector-tag">app</span>/<span class="hljs-selector-tag">demo</span>
<span class="hljs-selector-tag">DEMO_SITE_METHOD</span> = <span class="hljs-selector-tag">local</span>

<span class="hljs-selector-tag">define</span> <span class="hljs-selector-tag">DEMO_BUILD_CMDS</span>
    $(TARGET_CC) $(TARGET_CFLAGS) $(TARGET_LDFLAGS) <span class="hljs-selector-tag">-o</span> $(<span class="hljs-variable">@D</span>)/<span class="hljs-selector-tag">demo</span> \
        $(<span class="hljs-variable">@D</span>)/<span class="hljs-selector-tag">src</span>/<span class="hljs-selector-tag">xxx</span><span class="hljs-selector-class">.c</span>  \
        <span class="hljs-selector-tag">-lpthread</span> <span class="hljs-selector-tag">-lm</span>
<span class="hljs-selector-tag">endef</span>

<span class="hljs-selector-tag">define</span> <span class="hljs-selector-tag">DEMO_INSTALL_TARGET_CMDS</span>
    $(INSTALL) <span class="hljs-selector-tag">-D</span> <span class="hljs-selector-tag">-m</span> <span class="hljs-number">0755</span> $(<span class="hljs-variable">@D</span>)/<span class="hljs-selector-tag">demo</span> $(TARGET_DIR)/<span class="hljs-selector-tag">usr</span>/<span class="hljs-selector-tag">bin</span>/<span class="hljs-selector-tag">demo</span>
    $(INSTALL) <span class="hljs-selector-tag">-d</span> <span class="hljs-selector-tag">-m</span> <span class="hljs-number">0755</span> $(TARGET_DIR)/<span class="hljs-selector-tag">data</span>/<span class="hljs-selector-tag">demo_cache</span>
<span class="hljs-selector-tag">endef</span>

$(eval $(generic-package))
</code></pre>
<h2 data-id="heading-3">3、编译</h2>
<pre><code class="hljs language-go" lang="go">cd buildroot
<span class="hljs-built_in">make</span> demo
<span class="hljs-built_in">make</span> demo-dirclean
</code></pre>
<p>也可以手动编译:</p>
<pre><code class="hljs language-css" lang="css">aarch64-<span class="hljs-attribute">none</span>-linux-gnu-gcc -O2 -Wall xxx<span class="hljs-selector-class">.c</span>  -o demo -lpthread -lm
</code></pre>
<p>验证产物：</p>
<pre><code class="hljs">file demo
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin Flow 的协程边界突破：channelFlow 与 callbackFlow 的实战解析]]></title>    <link>https://juejin.cn/post/7600704706551726120</link>    <guid>https://juejin.cn/post/7600704706551726120</guid>    <pubDate>2026-01-30T06:37:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600704706551726120" data-draft-id="7600681071715368960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin Flow 的协程边界突破：channelFlow 与 callbackFlow 的实战解析"/> <meta itemprop="keywords" content="Kotlin,Android Jetpack,Android"/> <meta itemprop="datePublished" content="2026-01-30T06:37:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="QING618"/> <meta itemprop="url" content="https://juejin.cn/user/339115460529117"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin Flow 的协程边界突破：channelFlow 与 callbackFlow 的实战解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/339115460529117/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    QING618
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:37:25.000Z" title="Fri Jan 30 2026 06:37:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、为什么在普通 Flow 中从另一个协程发射会失败？</h2>
<h4 data-id="heading-1">1. 普通 Flow 是顺序的、同步的</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simpleFlow</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-comment">// 正确：在同一个协程中发射</span>
    emit(<span class="hljs-number">1</span>)
    
    <span class="hljs-comment">// 错误：不能在另一个协程中发射</span>
    launch(Dispatchers.IO) {
        <span class="hljs-comment">// emit(2) // 编译错误：emit 只能在 flow builder 的协程中调用</span>
    }
}
</code></pre>
<p>原因：普通 Flow 的 <code>emit()</code> 函数不是线程安全的，且必须在同一个协程上下文中调用。</p>
<h4 data-id="heading-2">2. 结构化并发约束</h4>
<p>普通 Flow 遵守结构化并发原则：当收集器取消时，整个 flow 构建器块都会被取消。如果允许在外部协程发射，难以追踪和管理所有发射源的取消。</p>
<h2 data-id="heading-3">二、ChannelFlow 解决了什么问题？</h2>
<h4 data-id="heading-4">ChannelFlow 的核心价值：跨协程发射</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">channelFlowExample</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = channelFlow {
    <span class="hljs-comment">// 可以在多个协程中并发发射</span>
    launch {
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.5</span>) {
            send(i) <span class="hljs-comment">// 使用 send 而不是 emit</span>
            delay(<span class="hljs-number">100</span>)
        }
    }
    
    launch {
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">6.</span><span class="hljs-number">.10</span>) {
            send(i)
            delay(<span class="hljs-number">150</span>)
        }
    }
    
    <span class="hljs-comment">// 等待所有发射完成</span>
    awaitClose()
}
</code></pre>
<h4 data-id="heading-5">解决的问题：</h4>
<h4 data-id="heading-6">1.  并发数据源整合</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mergeMultipleSources</span><span class="hljs-params">()</span></span>: Flow&lt;String&gt; = channelFlow {
    <span class="hljs-comment">// 多个异步数据源</span>
    <span class="hljs-keyword">val</span> sources = listOf(
        async { fetchFromNetwork() },
        async { readFromDatabase() },
        async { getFromCache() }
    )
    
    sources.forEach { deferred -&gt;
        launch {
            <span class="hljs-keyword">val</span> result = deferred.await()
            result.forEach { item -&gt;
                send(item)
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-7">2.  生产者-消费者模式</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">producerConsumer</span><span class="hljs-params">()</span></span>: Flow&lt;Data&gt; = channelFlow {
    <span class="hljs-keyword">val</span> channel = <span class="hljs-keyword">this</span>.channel <span class="hljs-comment">// 获取底层的 Channel</span>
    
    <span class="hljs-comment">// 生产者协程</span>
    launch(Dispatchers.IO) {
        <span class="hljs-keyword">while</span> (isActive) {
            <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = produceData()
            send(<span class="hljs-keyword">data</span>)
        }
    }
    
    <span class="hljs-comment">// 另一个生产者</span>
    launch(Dispatchers.Default) {
        processAndSendResults()
    }
}
</code></pre>
<h2 data-id="heading-8">三、CallbackFlow 解决了什么问题？</h2>
<h4 data-id="heading-9">CallbackFlow 的特殊用途：桥接回调API</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">listenToLocationUpdates</span><span class="hljs-params">()</span></span>: Flow&lt;Location&gt; = callbackFlow {
    <span class="hljs-keyword">val</span> callback = <span class="hljs-keyword">object</span> : LocationCallback() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLocationResult</span><span class="hljs-params">(result: <span class="hljs-type">LocationResult</span>)</span></span> {
            result.locations.forEach { location -&gt;
                trySend(location) <span class="hljs-comment">// 非阻塞式发送</span>
            }
        }
    }
    
    <span class="hljs-comment">// 注册回调</span>
    locationClient.requestLocationUpdates(
        request,
        callback,
        Looper.getMainLooper()
    )
    
    <span class="hljs-comment">// 关键：当流被取消时，自动清理资源</span>
    awaitClose {
        locationClient.removeLocationUpdates(callback)
    }
}
</code></pre>
<h4 data-id="heading-10">解决的问题：</h4>
<h4 data-id="heading-11">1. 回调API的Flow化</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 传统回调 → Flow 转换</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">EventListener</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onEvent</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(error: <span class="hljs-type">Throwable</span>)</span></span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">listenToEvents</span><span class="hljs-params">()</span></span>: Flow&lt;Event&gt; = callbackFlow {
    <span class="hljs-keyword">val</span> listener = <span class="hljs-keyword">object</span> : EventListener {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onEvent</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>)</span></span> {
            trySend(event)
        }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(error: <span class="hljs-type">Throwable</span>)</span></span> {
            close(error)
        }
    }
    
    registerListener(listener)
    
    awaitClose {
        unregisterListener(listener)
    }
}
</code></pre>
<h4 data-id="heading-12">2. 生命周期管理</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">observeAndroidLifecycle</span><span class="hljs-params">()</span></span>: Flow&lt;Lifecycle.State&gt; = callbackFlow {
    <span class="hljs-keyword">val</span> observer = LifecycleEventObserver { _, event -&gt;
        <span class="hljs-keyword">when</span> (event) {
            Lifecycle.Event.ON_RESUME -&gt; trySend(Lifecycle.State.RESUMED)
            Lifecycle.Event.ON_PAUSE -&gt; trySend(Lifecycle.State.STARTED)
            <span class="hljs-comment">// ... 其他状态</span>
        }
    }
    
    lifecycle.addObserver(observer)
    
    awaitClose {
        lifecycle.removeObserver(observer)
    }
}
</code></pre>
<h2 data-id="heading-13">四、底层原理对比</h2>









































<table><thead><tr><th>特性</th><th>普通 Flow</th><th>ChannelFlow</th><th>CallbackFlow</th></tr></thead><tbody><tr><td>发射上下文</td><td>必须相同协程</td><td>可跨协程</td><td>可跨协程</td></tr><tr><td>线程安全</td><td>否</td><td>是</td><td>是</td></tr><tr><td>缓冲区</td><td>无</td><td>可配置缓冲区</td><td>可配置缓冲区</td></tr><tr><td>适用场景</td><td>同步/简单异步</td><td>并发数据源</td><td>回调API集成</td></tr><tr><td>取消传播</td><td>自动</td><td>手动管理</td><td>自动清理</td></tr></tbody></table>
<h2 data-id="heading-14">五、实际应用示例</h2>
<h4 data-id="heading-15">示例1：WebSocket 连接</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">connectWebSocket</span><span class="hljs-params">(url: <span class="hljs-type">String</span>)</span></span>: Flow&lt;Message&gt; = callbackFlow {
    <span class="hljs-keyword">val</span> webSocket = WebSocketClient(url, <span class="hljs-keyword">object</span> : WebSocketListener() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onMessage</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span> {
            trySend(Message.Text(message))
        }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onClose</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, reason: <span class="hljs-type">String</span>?)</span></span> {
            close(ClosedException(code, reason))
        }
    })
    
    webSocket.connect()
    
    awaitClose {
        webSocket.disconnect()
    }
}
</code></pre>
<h4 data-id="heading-16">示例2：传感器数据流</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sensorDataFlow</span><span class="hljs-params">(sensor: <span class="hljs-type">Sensor</span>)</span></span>: Flow&lt;SensorData&gt; = channelFlow {
    <span class="hljs-keyword">val</span> sensorManager = getSensorManager()
    
    <span class="hljs-comment">// 在主线程注册监听器</span>
    launch(Dispatchers.Main) {
        sensorManager.registerListener(
            { event -&gt;
                launch(Dispatchers.Default) {
                    <span class="hljs-comment">// 在后台线程处理并发送</span>
                    <span class="hljs-keyword">val</span> processed = processSensorEvent(event)
                    send(processed)
                }
            },
            sensor,
            SensorManager.SENSOR_DELAY_NORMAL
        )
    }
    
    awaitClose {
        sensorManager.unregisterListener()
    }
}
</code></pre>
<h2 data-id="heading-17">六、关键要点</h2>
<h4 data-id="heading-18">1.  ChannelFlow：</h4>
<ul>
<li>用于需要从多个协程并发发射数据的场景</li>
<li>提供了底层的 Channel 作为缓冲区</li>
<li>需要手动处理并发和完成信号</li>
</ul>
<h4 data-id="heading-19">2.  CallbackFlow：</h4>
<ul>
<li>专门用于包装回调式 API</li>
<li>自动处理资源清理（通过 <code>awaitClose</code>）</li>
<li>使用 <code>trySend</code> 避免阻塞</li>
</ul>
<h4 data-id="heading-20">3.  为什么需要它们：</h4>
<ul>
<li>打破普通 Flow 的"单协程发射"限制</li>
<li>支持与现有的异步 API（回调、监听器）集成</li>
<li>提供更灵活的生产者-消费者模式</li>
<li>更好的资源管理和生命周期控制</li>
</ul>
<p>选择哪个取决于具体需求：如果是处理并发数据源，用 <code>channelFlow</code>；如果是包装回调 API，用 <code>callbackFlow</code>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Moltbot(Clawdbot)对接本地大模型完整配置指南]]></title>    <link>https://juejin.cn/post/7600562816458784810</link>    <guid>https://juejin.cn/post/7600562816458784810</guid>    <pubDate>2026-01-29T10:31:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600562816458784810" data-draft-id="7600469605477007402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Moltbot(Clawdbot)对接本地大模型完整配置指南"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-29T10:31:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="赵刚在掘金"/> <meta itemprop="url" content="https://juejin.cn/user/3034307823410862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Moltbot(Clawdbot)对接本地大模型完整配置指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307823410862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    赵刚在掘金
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:31:13.000Z" title="Thu Jan 29 2026 10:31:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a09bf65f21504390bbb7acac6131a255~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=Ra6kce0jQNrJbx%2BSGWCUhuTAHFA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">Moltbot(Clawdbot)对接本地大模型完整配置指南</h2>
<p>近期，开源AI智能体Moltbot（原名Clawdbot）凭借“可执行、可扩展、本地化”的特性爆火开源圈，GitHub星标快速飙升至95k+，被不少开发者称为“个人开源贾维斯”。不同于传统只能聊天的AI助手，Moltbot具备完整的“手、脚、脑”能力，既能对接云端API，更能适配本地大模型部署，完美解决数据隐私保护与离线使用需求。本文将从Moltbot核心能力、演示效果入手，一步步带你完成从环境搭建到本地大模型对接的全流程配置，新手也能轻松上手。</p>
<h3 data-id="heading-1">一、Moltbot(Clawdbot)核心能力与演示效果</h3>
<h4 data-id="heading-2">1.1 核心能力解析</h4>
<p>Moltbot（原Clawdbot）是一款开源个人AI助手框架，核心定位是“连接AI大模型与本地系统的桥梁”，通过Gateway网关架构，实现从自然语言指令到实际任务执行的完整闭环。其核心能力可概括为“手、脚、脑”三大模块，兼顾实用性与扩展性：</p>
<p>“手”——本地执行能力：可直接读写电脑本地文件、执行终端代码、操控命令行，支持批量处理文件、自动化脚本运行等场景，无需手动操作即可完成复杂本地任务。</p>
<p>“脚”——联网交互能力：可自主联网搜索、访问网页并分析内容，支持提取网页关键信息、同步网络数据，打破本地资源限制，实现“在线获取+本地执行”的联动。</p>
<p>“脑”——灵活适配能力：支持对接OpenAI、Qwen、MiniMax、GLM等主流云端API，更能适配本地大模型（如Llama 3、Qwen本地版、GLM4.7等），数据全程在本地流转，兼顾隐私安全与离线使用需求。</p>
<p>除此之外，Moltbot还具备可扩展的技能系统、多渠道交互（Telegram、Slack等）、本地记忆存储等特性，支持自定义Agent和插件开发，面向技术极客、隐私敏感用户和开发者群体，可根据需求灵活定制。</p>
<h4 data-id="heading-3">1.2 演示效果展示</h4>
<p>本文作为Molbot的入门教程，重点在基于“Moltbot + 本地qwen3-30b-a3b大模型”部署完整运行程序。以下是简单的让Molbot写一篇日记。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e768ea29f1478fad0ab2b689dc8f80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=jaSbVY52uxax6uhhitRLW8QjMtE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">二、前置说明与环境准备</h3>
<h4 data-id="heading-5">2.1 前置说明</h4>
<ol>
<li>
<p>系统兼容：本文以ubuntu系统为例（macOS、windows流程类似参考官方文档）；</p>
</li>
<li>
<p>硬件要求：对接本地大模型需满足基础硬件条件——CPU≥8核、内存≥16GB（推荐32GB），大模型是Nvidia 4090 8卡机器单独部署的；</p>
</li>
<li>
<p>核心依赖：Moltbot运行依赖Node.js环境（版本≥v22.0.0，推荐v22.x或v24.x稳定版），本地大模型需提前部署完成（本文以qwen3-30b-a3b本地版为例）；</p>
</li>
</ol>
<h4 data-id="heading-6">2.2 环境准备（必做）</h4>
<h5 data-id="heading-7">2.2.1 部署本地大模型（以qwen3-30b-a3b为例）</h5>
<ol>
<li>
<p>下载模型：从阿里云ModelScope、Hugging Face等平台下载qwen3-30b-a3b本地模型；</p>
</li>
<li>
<p>部署模型：本文使用gpustack完成本地大模型部署，确保模型可正常运行，并记录模型部署后的本地接口地址（如<a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8080%2Fv1%25EF%25BC%258C%25E5%2590%258E%25E7%25BB%25AD%25E5%25AF%25B9%25E6%258E%25A5%25E9%259C%2580%25E7%2594%25A8%25E5%2588%25B0%25EF%25BC%2589%25E5%2592%258Capikey%25EF%25BC%2588gpustack__xxxxx%25EF%25BC%2589%25EF%25BC%259B" target="_blank" title="http://127.0.0.1:8080/v1%EF%BC%8C%E5%90%8E%E7%BB%AD%E5%AF%B9%E6%8E%A5%E9%9C%80%E7%94%A8%E5%88%B0%EF%BC%89%E5%92%8Capikey%EF%BC%88gpustack__xxxxx%EF%BC%89%EF%BC%9B" ref="nofollow noopener noreferrer">http://127.0.0.1:8080/v1，后续对接需用到）和apikey（gpustack__xxxxx）；</a></p>
</li>
<li>
<p>测试模型：打开浏览器或终端，访问本地模型接口，发送简单对话指令（如“你好”），若能正常接收响应，说明本地大模型部署成功。</p>
</li>
</ol>
<h5 data-id="heading-8">2.2.2 安装Moltbot</h5>
<p>从github下载最新源码<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fmoltbot%25E3%2580%2582%25E4%25B8%258B%25E8%25BD%25BD%25E5%2588%25B0ubuntu%25E6%259C%258D%25E5%258A%25A1%25E5%2599%25A8%25E5%2590%258E%25E8%25A7%25A3%25E5%258E%258B%25E7%25BC%25A9%25E3%2580%2582%25E7%2584%25B6%25E5%2590%258E%25E6%2589%25A7%25E8%25A1%258C%25E4%25B8%258B%25E9%259D%25A2%25E7%259A%2584%25E5%25AE%2589%25E8%25A3%2585%25E5%2591%25BD%25E4%25BB%25A4%25E3%2580%2582" target="_blank" title="https://github.com/moltbot/moltbot%E3%80%82%E4%B8%8B%E8%BD%BD%E5%88%B0ubuntu%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%E8%A7%A3%E5%8E%8B%E7%BC%A9%E3%80%82%E7%84%B6%E5%90%8E%E6%89%A7%E8%A1%8C%E4%B8%8B%E9%9D%A2%E7%9A%84%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4%E3%80%82" ref="nofollow noopener noreferrer">github.com/moltbot/mol…</a>
<span href="https://code.juejin.cn/pen/7600715127625383986" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7600715127625383986" data-src="https://code.juejin.cn/pen/7600715127625383986" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<p>执行安装命令时候会弹出下面截图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/571add5b9a894deea2cda6ba7bfbb3dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=vvQpBDXyycm3o3i0oAS8PJiYHgo%3D" alt="image.png" loading="lazy"/>
按n或其他键则安装结束，按y表示同意继续安装；选择安装模式，</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c679b479889643849908d39d23105e95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=KEKDD9Jom63YSXqsfVDyJGUppoU%3D" alt="image.png" loading="lazy"/>
第一个是快速开始，第二个是手动配置，选择第一个回车；然后让你配置一个模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62ea173b31c94eaa86fccc1302481352~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=OdWPr7cAguksycu4%2BmeSPVHZtAw%3D" alt="image.png" loading="lazy"/></p>
<p>列的国内外模型都需要收费的key和认证，本文对接本地大模型，选择最后一个Skip for now。接下来选择channel，</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b2400cc258f4f0d98449855c9660bc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=Fek1v4f3Q7K%2BQxYx31xstkVTfcw%3D" alt="image.png" loading="lazy"/></p>
<p>都是国外的app用不了，选择Skip for now；</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44866c2a239549f9a60208128918078c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=L0Xa07kMsoApvQRfT2NfCdyBDPU%3D" alt="image.png" loading="lazy"/></p>
<p>然后选择技能安装配置都是yes，最后选择安装技能用npm。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46fbaf5059854b19896f3bf33d20b851~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=AEvONj3vzXHLhoj5y%2FBnG3V6AwU%3D" alt="image.png" loading="lazy"/></p>
<p>然后让你安装 skill，这些技能也可以选择先不安装，后面用到的时候，会自行安装，所以也可以选择 Skip for now 跳过。空格选中复选框，回车下一步。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22268ebcabd2420ba5a197e0abe89903~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=LZtr1mjfa3octud%2F2ZF1II1nRAw%3D" alt="image.png" loading="lazy"/></p>
<p>google和sag的配置都需要外网，选择no，不设置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bec79f34300444849e0dc4003a6c343b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=TLL0Hz3FL2nwC26Az2gl9VIBFr0%3D" alt="image.png" loading="lazy"/></p>
<p>然后会看到是否启动 hooks，这里可以把这 3 个都选上，启动下。
至此，初步安装就完成了，会看到屏幕出现访问地址。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd4799b425214ab58b07540d58ddc397~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=9JudD7erjM3d2L1uQViKb5jIBiA%3D" alt="image.png" loading="lazy"/></p>
<p>在本机curl命令curl <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A18789%2Fchat" target="_blank" title="http://127.0.0.1:18789/chat" ref="nofollow noopener noreferrer">http://127.0.0.1:18789/chat</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b50e1dcc0ad4e6da7e6052575994511~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=jjlZyEKG5hyQ89ODDbvijYs%2FGZk%3D" alt="image.png" loading="lazy"/>
可以看到有结果返回。表示启动正常。但是通过外网ip端口发下无法访问。经过查询官方文档需要打开配置gateway.bind为lan局域网。配置文件的默认位置在~/.clawdbot/clawdbot.json。在配置文件中添加配置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b09ce60fb79b4d6aa3b0edd91a8a0418~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=izcYSf8EcrnyxDI75%2BqRjA9DaTg%3D" alt="image.png" loading="lazy"/></p>
<p>再次通过服务器ip和端口发下可以访问页面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6995f1d2dbb344e79f905e0ed92087e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=0n7ExPbepIcVy8ZSxgRDRYbLLKA%3D" alt="image.png" loading="lazy"/>
接下来在chat页面对话时候发现连接失败报错。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/603a3f080b504a599af93d3a01aa2a78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=94RFkk%2BuIGMkxiFXeyi0tEK9pXM%3D" alt="image.png" loading="lazy"/>
打开Overview测试连接发现右侧提示连接失败，Gateway Token需要填写和配置文件中的gateway.auth.token保持一致，并且设置gateway.controlUi.allowInsecureAuth设置为ture允许http连接。注意此处只是测试环境，生产环境建议开启https安全认证。</p>
<p>到这一步发现能够连接成功，但是对话无返回结果。</p>
<h5 data-id="heading-9">2.2.3 修改源码和配置支持本地大模型</h5>
<p>找到安装路径下的model.js文件，我服务器的路径为/xxx/moltbot-2026.1.24/dist/agents/pi-embedded-runner。
注释掉原有的if判断添加改造后的代码。
<span href="https://code.juejin.cn/pen/7600726274134589481" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7600726274134589481" data-src="https://code.juejin.cn/pen/7600726274134589481" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<p>修改~/.clawdbot/clawdbot.json，指定本地大模型。
<span href="https://code.juejin.cn/pen/7600726708367179786" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7600726708367179786" data-src="https://code.juejin.cn/pen/7600726708367179786" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<p>到此，在对话页面可以进行正常问答。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b730fe4b1834435fbd42f72613998b97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=Re9CZWuoBAhHgWGCevD5CNh9j3Q%3D" alt="image.png" loading="lazy"/></p>
<p>附属参考的帖子</p>
<ul>
<li>官网（<a href="https://link.juejin.cn?target=https%3A%2F%2Fclawd.bot%2F%25EF%25BC%2589" target="_blank" title="https://clawd.bot/%EF%BC%89" ref="nofollow noopener noreferrer">clawd.bot/）</a></li>
<li>github（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fmoltbot%25EF%25BC%2589" target="_blank" title="https://github.com/moltbot/moltbot%EF%BC%89" ref="nofollow noopener noreferrer">github.com/moltbot/mol…</a></li>
<li>官方文档（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.molt.bot%2F%25EF%25BC%2589" target="_blank" title="https://docs.molt.bot/%EF%BC%89" ref="nofollow noopener noreferrer">docs.molt.bot/）</a></li>
<li>对接deepseek（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nodeseek.com%2Fpost-599173-1%25EF%25BC%2589" target="_blank" title="https://www.nodeseek.com/post-599173-1%EF%BC%89" ref="nofollow noopener noreferrer">www.nodeseek.com/post-599173…</a></li>
</ul>
<p>看别的帖子还有对接飞书的能力，后面研究跑通了再发帖。
如果有问题可以留言咨询，共同进步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JuiceFS 企业版 5.3 特性详解：单文件系统支持超 5,000 亿文件，首次引入 RDMA]]></title>    <link>https://juejin.cn/post/7600760073007923254</link>    <guid>https://juejin.cn/post/7600760073007923254</guid>    <pubDate>2026-01-30T06:53:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600760073007923254" data-draft-id="7600953198745337862" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JuiceFS 企业版 5.3 特性详解：单文件系统支持超 5,000 亿文件，首次引入 RDMA"/> <meta itemprop="keywords" content="后端,运维"/> <meta itemprop="datePublished" content="2026-01-30T06:53:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JuiceFS"/> <meta itemprop="url" content="https://juejin.cn/user/2665636828032446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JuiceFS 企业版 5.3 特性详解：单文件系统支持超 5,000 亿文件，首次引入 RDMA
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2665636828032446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JuiceFS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:53:53.000Z" title="Fri Jan 30 2026 06:53:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>JuiceFS 企业版 5.3 近日发布，单文件系统支持超 5,000 亿文件，实现里程碑式突破。此次升级针对元数据多分区架构进行了多项关键优化，并首次引入 RDMA 技术，以提升分布式缓存效率；此外，5.3 版本还增强了可写镜像，为跨桶导入的对象提供数据缓存等多项功能，旨在支持高性能要求及多云应用场景。</p>
<p>JuiceFS 企业版专为高性能场景设计。自 2019 年起开始应用于机器学习领域，现已成为 AI 行业核心基础设施之一。商业客户涵盖大模型公司：MiniMax、智谱 AI、阶跃星辰；AI 基础设施及应用如 Fal.ai、HeyGen 等；自动驾驶领域的 Momenta、地平线等，以及众多应用 AI 技术的各行业领先科技企业。</p>
<h2 data-id="heading-0">01 单文件系统支持超 5,000 亿文件</h2>
<p>多分区架构是 JuiceFS 应对千亿文件规模的关键技术之一，保证了系统的高扩展性和高并发处理能力。<strong>为了继续满足如自动驾驶场景业务增长的需求，5.3 版本对多分区架构进行了深入优化，将分区数量限制提高到 1,024 个，单文件系统能够存储和访问至少 5,000 亿个文件</strong>。（每个分区可存储 5 亿个文件，最大支持 20 亿）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d5d7e11e022441583248fab927c86d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770360832&amp;x-signature=9pG2ngLDexCUnZPguGL6YzgiULI%3D" alt="" loading="lazy"/></p>
<p>这一突破对系统性能、数据一致性、稳定性要求提出了几何级的难度，背后是一系列繁杂的底层优化与研发工作。</p>
<h3 data-id="heading-1">关键优化 1 - 分区间热点均衡：自动监测和热点迁移；提供手动运维工具</h3>
<p>在分布式系统中，热点问题是常见的挑战，特别是当数据被分布到多个分区时，某些分区的负载可能比其他分区更高，这种不均衡会引发热点问题，影响系统的性能。</p>
<p>当分区数量达到数百时，热点问题变得更加普遍。尤其是在数据集较小、涉及的文件数量较多的情况下，读写热点问题会加剧，进一步增加延迟波动。</p>
<p>我们引入了自动化的热点迁移机制，将访问频繁的文件迁移到其他分区，从而分担负载并降低特定分区的压力。然而在实际环境中，我们发现仅依赖自动迁移并不能完全解决所有问题。特别是在某些特殊场景或极端情况下，自动迁移工具可能无法及时应对。<strong>因此，我们在自动监测和迁移的基础上，增加了手动运维工具，允许运维人员在遇到复杂场景时介入，进行人工分析并实施优化方案</strong>。</p>
<h3 data-id="heading-2">关键优化 2 - 大规模迁移：提升迁移速度，少量多次并发迁移</h3>
<p>面对热点过高的分区，早期的迁移操作比较简单，但随着系统规模扩大，迁移效率逐渐降低。为此，<strong>我们引入了“少量多次并发迁移”的策略，将高访问量的目录分解成多个小块，并行迁移到多个负载较低的分区</strong>，从而迅速分散热点，恢复业务的正常访问体验。</p>
<h3 data-id="heading-3">关键优化 3 - 强化可靠性自检：自动修复与清理迁移中间态文件</h3>
<p>在大规模集群中，分布式事务的失败概率显著上升，特别是在大量迁移过程中。为应对这一问题，<strong>我们增强了可靠性检测机制，增加了后台周期性的检查功能，定期扫描跨分区文件的状态，特别关注中间状态问题，并自动进行修复和清理</strong>。</p>
<p>此前，系统曾遇到过中间状态数据残留的问题，虽然短期内未影响系统运行，但随着时间推移，这些残留数据可能导致错误。通过增强的自检机制，我们确保了后台能够定期扫描并及时处理中间状态问题，从而提升了系统的稳定性和可靠性。</p>
<p>除了上述三项关键优化外，我们还在控制台进行了多项改进，以更好地适应更多分区的管理需求。我们优化了并发处理、运维操作和查询展示，提升了整体性能和用户体验。特别是，在 UI 设计方面，我们做了优化，以便更好地展示大规模分区环境下的系统状态。</p>
<h3 data-id="heading-4">千亿文件性能压测：稳定性与资源利用良好</h3>
<p>我们在谷歌云上使用自定义的 mdtest 测试工具进行了大规模测试，部署了 60 个节点，每个节点的内存超过 1 TB。在软件配置方面，我们将分区数增加至 1,024 个。部署方式与之前类似，为了降低内存消耗，我们选择仅部署一个服务进程，另两个作为冷备。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c661d1cdc3a41feac3fdfe29a7d8f42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770360832&amp;x-signature=ARwxuC2TRFuVuLIaClvxtldZnd4%3D" alt="" loading="lazy"/></p>
<ul>
<li>测试持续时间：大约 20 小时</li>
<li>写入的文件总数：约 4,000 亿个文件</li>
<li>每秒写入速度：500 万个文件</li>
<li>内存占用：约 35% 到 40%</li>
<li>硬盘使用： 40% 到 50%，主要用于元数据的持久化，使用情况良好</li>
</ul>
<p>根据我们的经验，如果采用一个服务进程、一个热备进程和一个冷备进程的配置，内存占用会增加 20% 到 30%。</p>
<p>由于云端资源有限，本次测试只写到 4,000 亿文件。在压测过程中，系统表现稳定，且硬件资源尚有富余。后续，我们会继续尝试更大规模的测试。</p>
<h2 data-id="heading-5"><strong>02 首次支持 RDMA：带宽上限提升，CPU 占用降低</strong></h2>
<p>在此次新版本中首次支持了 RDMA（Remote Direct Memory Access）技术，它的基本原理架构如下图所示。RDMA 通过允许直接访问远程节点的内存，绕过操作系统的网络协议栈，显著提高了数据传输效率。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d040b160665d4f5e93d87e16f742c16f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770360832&amp;x-signature=F97FSVGa2QFPQOgOkCzC%2FJmWZ8U%3D" alt="" loading="lazy"/></p>
<p>RDMA 的主要优点包括：</p>
<ol>
<li>低延迟：通过直接从内存到内存的传输，绕过操作系统的网络协议层，减少 CPU 的中断和上下文切换，从而降低延迟。</li>
<li>高吞吐量：RDMA 通过硬件直接传输数据，能够更好地发挥网卡（NIC）的带宽。</li>
<li>减少 CPU 占用：在 RDMA 中，数据的拷贝几乎全部由网卡完成，CPU 仅用于处理控制消息。这样，网卡负责硬件传输，释放了 CPU 的资源。</li>
</ol>
<p>在 JuiceFS 中，客户端与元数据服务之间的网络请求消息都较小，现有的 TCP 配置已能满足需求。而在分布式缓存中，客户端与缓存节点之间传输的是文件数据，使用 RDMA 可以有效提升传输效率，降低 CPU 消耗。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a610a13de6348fd96258bab8a08ebfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770360832&amp;x-signature=pqVmqI%2Fkb7xpJ%2BIYf6v8ATYPhwY%3D" alt="" loading="lazy"/></p>
<p>我们使用了 160 Gbps 网卡进行 1MB 随机读测试，比较了 5.1、 5.2（使用 TCP 网络） 和 5.3 版本（RDMA），并观察了 CPU 占用情况。测试表明，RDMA 有效降低了 CPU 占用。在 5.2 版本中，CPU 占用了近 50%；<strong>而在 5.3 版本中，通过 RDMA 优化，CPU 占用降至约 1/3。客户端和缓存节点的 CPU 占用分别降至 8 核和 5 核，带宽达到了 20 GiB/s</strong>。</p>
<p>在以往的测试中，我们发现 TCP 在 200G 网卡下虽然稳定运行，但要完全拉满带宽仍有困难，通常只能达到 85-90% 的带宽利用率。<strong>对于需要更高带宽（如 400G 网卡）的客户，TCP 无法满足需求，而 RDMA 能够更容易地发挥硬件带宽上限，提供更优的传输效率</strong>。</p>
<p>如果用户的硬件支持 RDMA 且存在高带宽需求（如网卡大于 100G），同时希望降低 CPU 占用，那么 RDMA 是值得尝试的技术。目前，我们的 RDMA 功能处于公测阶段，尚未在生产环境中广泛部署。</p>
<h2 data-id="heading-6">03 可写镜像增强</h2>
<p>最初，镜像集群主要用于企业产品中的只读镜像。随着用户提出在镜像中写入临时文件（如训练数据）等需求，我们为此提供了可写镜像功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/177faea59ce147b8b017eecc456329dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770360832&amp;x-signature=2z1YzXzcTif75nks6e8M%2FWEy0nE%3D" alt="" loading="lazy"/></p>
<p>镜像客户端在实现时采用了读写分离机制。客户端在读取数据时优先从镜像集群获取，以降低延迟；而写入数据时，仍然需要写入源集群，以确保数据一致性。通过元数据版本号的记录与对比，我们确保了镜像客户端和源集群客户端看到的数据保持强一致性。</p>
<p><strong>为了提升可用性，我们在 5.3 版本引入了回退机制，即当镜像不可用时，客户端的读请求能自动回退到源集群</strong>，从而保证业务连续性，避免镜像集群故障导致的业务中断。我们还优化了多镜像环境的部署。原先，镜像端需要部署两个热备节点以确保高可用性。现在，通过改进的回退功能，部署一个镜像节点也能实现类似的效果，确保业务连续性并降低成本，尤其适用于需要多个镜像的用户。</p>
<p>通过这一改进，我们不仅降低了硬件成本，还在高可用性和低成本之间找到了平衡。对于那些在多个地点部署镜像的用户，减少元数据副本的同时进一步降低了总体成本。</p>
<h2 data-id="heading-7">04 简化运维管理，提升灵活性：为导入对象提供跨桶数据缓存</h2>
<p>在 JuiceFS 中，用户可以使用 import 命令将对象存储中的现有文件导入并统一管理。这对于已经存储大量数据（如几十 PB）的用户来说十分便捷。但在之前版本中，这一功能仅支持为同一数据桶中的对象提供缓存，意味着导入的对象必须与现有文件系统数据处于同一个桶内。这一限制在实际使用中带来了一定局限性。</p>
<p>在 5.3 版本中，我们对该功能进行了改进。现在，<strong>用户可以为任何导入的对象提供缓存能力，无论这些对象是否来自同一数据桶</strong>。这样，用户可以更加灵活地管理不同数据桶中的对象，避免了对数据桶的严格限制，从而提升了数据管理的自由度。</p>
<p>此外，以前如果用户将数据分布在多个桶中，想要为这些桶中的数据提供缓存能力，需要为每个桶新建一个文件系统。而在 5.3 版本中，用户只需创建一个文件系统（volume），便可统一管理多个桶的数据，并为所有桶提供缓存能力。</p>
<h2 data-id="heading-8">05 其他重要优化</h2>
<p><strong>Trace 功能</strong></p>
<p>我们新增了 trace 功能，这是 Go 语言本身提供的一个特性。通过这个功能，资深用户可以进行追踪和性能分析，获得更多信息，帮助我们快速定位问题。</p>
<p><strong>回收站恢复</strong></p>
<p>在之前的版本中，特别是在多分区的情况下，有时回收站记录的路径不完整，导致恢复时出现异常，未能恢复到预期位置。为了解决这个问题，在 5.3 版本中，在删除文件时，我们会记录文件的原始路径，确保恢复时能够提供更可靠的恢复能力。</p>
<p><strong>Python SDK 改进</strong></p>
<p>在前几个版本中，我们发布了 Python SDK，它提供了基础的读写功能，方便 Python 用户与我们的系统对接。在 5.3 版本中，我们不仅加强了基础读写功能，还增加了对运维子命令的支持。例如，用户可以直接通过 SDK 调用 juicefs info 或 warmup 等命令，而不需要依赖外部系统命令。这不仅简化了编码工作，并且避免了频繁调用外部命令时可能产生的性能瓶颈。</p>
<p><strong>Windows 客户端</strong></p>
<p>我们在之前版本中推出了 Windows 客户端 Beta 版本，并已获得不少用户反馈。经过改进，当前版本在挂载的可靠性、性能以及与 Linux 系统的兼容性上都有了显著提升。未来，我们计划进一步完善 Windows 客户端，为依赖 Windows 的用户提供更接近 Linux 的体验。</p>
<h2 data-id="heading-9">06 小结</h2>
<p>相较于昂贵的专用硬件，JuiceFS 通过灵活地利用云上或客户现有的存储资源，帮助用户在应对数据增长时平衡性能与成本。在 5.3 版本中，通过优化元数据分区架构，单文件系统可支持超过 5,000 亿个文件。首次引入的 RDMA 技术显著提升了分布式缓存带宽和数据访问效率，减少了 CPU 占用，进一步优化了系统性能。此外，我们还优化了可写镜像、缓存等多项功能，提升了大规模集群的性能和运维效率，优化用户体验。</p>
<p>云服务用户现已可以直接在线体验 JuiceFS 企业版 5.3，私有部署用户可通过官方渠道获得升级支持。我们将继续专注于高性能存储解决方案，和企业一起应对数据量的持续增长所带来的挑战。</p>
<p>如果你在存储架构设计、成本控制或性能优化中遇到过问题，或有相关实践心得，欢迎在评论区留言。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code安装和GLM4.7替代]]></title>    <link>https://juejin.cn/post/7600260767687065626</link>    <guid>https://juejin.cn/post/7600260767687065626</guid>    <pubDate>2026-01-28T17:02:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600260767687065626" data-draft-id="7600260767687032858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code安装和GLM4.7替代"/> <meta itemprop="keywords" content="Claude,ChatGLM (智谱)"/> <meta itemprop="datePublished" content="2026-01-28T17:02:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Persistent_cwb"/> <meta itemprop="url" content="https://juejin.cn/user/3122268756249485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code安装和GLM4.7替代
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3122268756249485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Persistent_cwb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T17:02:36.000Z" title="Wed Jan 28 2026 17:02:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、安装 Claude Code</h2>
<p>考虑到有人可能没有使用过 Claude Code（CC），我们先从安装说起。</p>
<h3 data-id="heading-1">前置条件</h3>
<ul>
<li>Node.js 18+</li>
<li>Git for Windows</li>
</ul>
<h3 data-id="heading-2">安装步骤</h3>
<p>打开 CMD 终端，输入以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @anthropic-ai/claude-code
</code></pre>
<p>命令执行完成之后，检查版本：</p>
<pre><code class="hljs language-bash" lang="bash">claude --version
</code></pre>
<p>能正常输出版本号，就表示安装成功了。</p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102181204201.png@!full" alt="Claude Code 安装和验证过程" loading="lazy"/>
<em>Claude Code 安装和验证过程</em></p>
<blockquote>
<p>💡 <strong>提示：</strong> 这一步不需要科学上网，可以正常安装。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">二、配置 GLM Coding</h2>
<p>官方提供了三种配置方式：</p>
<ol>
<li><strong>自动化助手</strong>（推荐）</li>
<li>自动化脚本</li>
<li>手动配置</li>
</ol>
<p>下面详细介绍<strong>自动化助手</strong>配置方式：</p>
<h3 data-id="heading-4">1. 安装自动化助手</h3>
<pre><code class="hljs language-bash" lang="bash">npx @z_ai/coding-helper
</code></pre>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164100348.png@!full" alt="语言选择界面（默认英文，可切换中文）" loading="lazy"/>
<em>语言选择界面（默认英文，可切换中文）</em></p>
<h3 data-id="heading-5">2. 套餐选择</h3>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164244801.png@!full" alt="选择中国版本或国际版" loading="lazy"/>
<em>选择中国版本或国际版</em></p>
<p>我购买的是中国版，所以选择中国版本。</p>
<h3 data-id="heading-6">3. 输入 API Key</h3>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164351333.png@!full" alt="输入 API Key" loading="lazy"/>
<em>输入 API Key</em></p>
<p>根据界面提供的链接，打开智谱官网获取 API Key。</p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164450469.jpg@!full" alt="智谱官网 API Key 获取（有两个默认 key）" loading="lazy"/>
<em>智谱官网 API Key 获取（有两个默认 key）</em></p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164609950.png@!full" alt="粘贴 API Key 到配置界面" loading="lazy"/>
<em>粘贴 API Key 到配置界面</em></p>
<h3 data-id="heading-7">4. 选择编码工具</h3>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164625421.png@!full" alt="选择 Claude Code（智谱有专门针对 CC 优化）" loading="lazy"/>
<em>选择 Claude Code（智谱有专门针对 CC 优化）</em></p>
<h3 data-id="heading-8">5. 刷新配置</h3>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164734735.png@!full" alt="检测 CC 配置情况" loading="lazy"/>
<em>检测 CC 配置情况</em></p>
<p>这一步会检测 Claude Code 的配置情况，选择<strong>配置刷新</strong>。</p>
<h3 data-id="heading-9">6. 启动 Claude Code</h3>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164827604.png@!full" alt="用 GLM 编码套餐替换 CC 配置" loading="lazy"/>
<em>用 GLM 编码套餐替换 CC 配置</em></p>
<hr/>
<h2 data-id="heading-10">三、手动调整配置（如果需要）</h2>
<p>替换完成后，如果启动时显示的模型不是预期的，可能需要手动调整配置文件。</p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102165105948.png@!full" alt="Claude Code 启动界面" loading="lazy"/>
<em>Claude Code 启动界面</em></p>
<h3 data-id="heading-11">配置文件路径</h3>
<pre><code class="hljs language-text" lang="text">C:\Users\你的用户名\.claude\settings.json
</code></pre>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102165157211.jpg@!full" alt="配置文件内容（红色框中是其他模型配置，需要删除）" loading="lazy"/>
<em>配置文件内容（红色框中是其他模型配置，需要删除）</em></p>
<h3 data-id="heading-12">最终配置内容</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ANTHROPIC_AUTH_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your_zhipu_api_key"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ANTHROPIC_BASE_URL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://open.bigmodel.cn/api/anthropic"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"API_TIMEOUT_MS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3000000"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>GLM 会自动按如下规则做模型适配：</p>
<ul>
<li><code>ANTHROPIC_DEFAULT_OPUS_MODEL</code>：<code>GLM-4.7</code></li>
<li><code>ANTHROPIC_DEFAULT_SONNET_MODEL</code>：<code>GLM-4.7</code></li>
<li><code>ANTHROPIC_DEFAULT_HAIKU_MODEL</code>：<code>GLM-4.5-Air</code></li>
</ul>
<p>修改完成后，退出程序重新输入 <code>claude</code> 启动 Claude Code。</p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102165627674.jpg@!full" alt="配置完成，显示 Sonnet 4.5（对应 GLM 4.7）" loading="lazy"/>
<em>配置完成，显示 Sonnet 4.5（对应 GLM 4.7）</em></p>
<hr/>
<h2 data-id="heading-13">四、实际测试</h2>
<p>换心完成后，我尝试让 GLM 帮我创建一个 React 项目：</p>
<ol>
<li>输入 <code>/init</code> 命令</li>
<li>系统提示项目为空，询问是否创建项目</li>
<li>通过引导一步步创建 React 项目</li>
<li>生成 CLAUDE.md 配置文件</li>
</ol>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102173956590.png@!full" alt="GLM 帮助创建 React 项目" loading="lazy"/>
<em>GLM 帮助创建 React 项目</em></p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102174759311.png@!full" alt="生成的 CLAUDE.md 配置文件" loading="lazy"/>
<em>生成的 CLAUDE.md 配置文件</em></p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102174921439.png@!full" alt="CLAUDE.md 文件详细内容" loading="lazy"/>
<em>CLAUDE.md 文件详细内容</em></p>
<p>整个过程中，GLM 4.7 的表现相比之前使用的小米模型（mimo）有显著提升：</p>
<ul>
<li>✅ 命令执行更加准确</li>
<li>✅ 无需多次重试</li>
<li>✅ 代码生成质量更高</li>
</ul>
<hr/>
<h2 data-id="heading-14">五 总结</h2>
<p>目前配置已完成，GLM 4.7 已成功替换为 Claude Code 的"国产心"。</p>
<p>🎯 <strong>优势：</strong></p>
<ul>
<li>价格约为 Claude Pro 的 1/8</li>
<li>用量是 Claude Pro 的 3 倍</li>
<li>无需科学上网，国内使用更方便</li>
<li>实际测试表现良好</li>
</ul>
<p>📌 <strong>待验证：</strong></p>
<ul>
<li>在复杂任务中是否能真正替代 Claude 本尊</li>
<li>代码质量和准确性对比</li>
<li>长上下文处理能力</li>
</ul>
<p>至于 GLM 4.7 是否真的能完全替代 Claude 本尊，还需要更多实际测试来验证。接下来我将通过更多实际案例进行对比，一切以实测为准。</p>
<hr/>
<h2 data-id="heading-15">七、相关链接</h2>
<ul>
<li>🔗 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2Fglm-coding" target="_blank" title="https://www.bigmodel.cn/glm-coding" ref="nofollow noopener noreferrer">GLM 4.7 注册地址</a></li>
<li>📖 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fcoding-plan%2Ftool%2Fclaude" target="_blank" title="https://docs.bigmodel.cn/cn/coding-plan/tool/claude" ref="nofollow noopener noreferrer">GLM 4.7 配置文档</a></li>
</ul>
<p>本文基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tonyisstark.com%2F4810.html" target="_blank" title="https://www.tonyisstark.com/4810.html" ref="nofollow noopener noreferrer">www.tonyisstark.com/4810.html</a> 整理
发布日期：2026年1月</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MoltBot(原ClawdBot)安装指南，接入企微、飞书、钉钉、QQ四大主流社交软件]]></title>    <link>https://juejin.cn/post/7600292312217370676</link>    <guid>https://juejin.cn/post/7600292312217370676</guid>    <pubDate>2026-01-29T02:33:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600292312217370676" data-draft-id="7600296037543428096" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MoltBot(原ClawdBot)安装指南，接入企微、飞书、钉钉、QQ四大主流社交软件"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-29T02:33:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="润雨的AI开源日记"/> <meta itemprop="url" content="https://juejin.cn/user/295098467493901"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MoltBot(原ClawdBot)安装指南，接入企微、飞书、钉钉、QQ四大主流社交软件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/295098467493901/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    润雨的AI开源日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T02:33:21.000Z" title="Thu Jan 29 2026 02:33:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、安装MoltBot</h2>
<p>执行安装命令</p>
<pre><code class="hljs language-plain" lang="plain">npm install -g moltbot@latest
</code></pre>
<p>执行初始化命令</p>
<pre><code class="hljs language-plain" lang="plain">moltbot onboard --install-daemon
</code></pre>
<h2 data-id="heading-1">二、初始化过程</h2>













































<table><thead><tr><th>示意图</th><th>说明</th></tr></thead><tbody><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=N2NkYTMwNTcwNGU4ZjY3ZjNlNzIwZTQ3M2M2MzVhYjNfZFQ5R0ZBNEc3QndWSk9FWGI4b1BCd1VnQ25vcEJtWkhfVG9rZW46RHhDeWJpWUNrb3Iyd2t4YVpubWNrU0E5bmJnXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：Yes<br/></td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=M2FkZjIyN2RhOTQ4N2U0NDBmOGIyN2M1NzEyMzM3OTNfNVFDYlJacTJXaXh1WTk3U2ppSlM3dEtJMGVGNlNQdDdfVG9rZW46Um5VRmJZY25vb0xsZlZ4U0Fuc2NJZWk3bmhkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：QuickStart</td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGEzMmJlNDYzNTZlZmUzMzk0ZDM2MzVkYzkxYTM1NWJfaEJJSWRPUTREUG9yYWFHeHlreVFoRUFtS3hFZElCUEhfVG9rZW46SUVJMWJVRFRtb0I0NHZ4UzhUdGNFb3phbmloXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：OpenAI<br/>根据自己的需要选择，如果后期要使用其他AI的话，这里请选择 OpenAI<br/></td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MjMwZjIyYTljOTkxNDQ2MWEzODllZDc3NjAyNGM4NjJfcEkxa1VRMHV2QU95VEhpdnp1Zm9icXBTUEJieDhpSEZfVG9rZW46SGVTV2I1bzZGb1JTTzh4djlvVWNLelZNblliXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：OpenAI API key</td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NjkxZjE5ZThkNWFiZTZiNGYxYWYyNzZjZjc0NmY3MmJfSmVyYldkczhKNUIxU0xzb1hSc2Z6N1VLSUk1Tm5Jd2tfVG9rZW46Sk1kbWJhUFBYb0NMOEp4M0NpcWNCNnFUbnVjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>输入大模型 API Key</td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MGEzYzkzYjgzM2NlZTliMTU5OWJjNTY5ZDAwMzM1MzZfTEpzOW1NUkV4S3dzZGp2aURrYm9iMWtJZGN3UWdNTWdfVG9rZW46Q0VsbmJPcEQ5b0w3eWJ4WEdZVmNhd01WbkZwXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：Skip for now<br/>* 新版中，支持直接配置国内主流社交平台，请查看第四部分</td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OTNlYjAyZjkyN2M5NTQxMmVlOTQ3OTQ0MGViMGUzNWRfTmtiWGc2a0lHd2xrdEloZmtVZWFmRFYwNWQwZXluOWZfVG9rZW46QU9oZmJLWGtDb3pPMTR4R3BCOWN3UGh1bmxmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选yes，现在配置skill<br/>选no，之后再配置</td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTZlZDgwZGU2NjI0M2JhNDM2MTJiYjViM2E0YzFhMTRfbzNDMHZXbXRDVlR1N09ZTlA2RXh4Vkt6Z3hWdFluV1BfVG9rZW46VG9NRWJPemlOb2tKdXl4VjhWZGN3RmsybmRjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>按“空格键”选中左图选项，“回车键”下一步<br/></td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MmZlMGQ4YWZjODUyOTM3NDZiODVhZTVkNTBhMzg0NjZfZ3gwWTBaNkd6ZmFZMEhpaG84TWRHcGxyYUVaZ1lSTWlfVG9rZW46R2FuaGJSSkxhb3dqMHp4cWN1OWNjZGE0bkNmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：Hatch in TUI (recommended)<br/></td></tr></tbody></table>
<h2 data-id="heading-2">三、接入大模型（可选）</h2>
<p>如果初始化中，没有你想用的模型，可以按照此步骤单独接入</p>
<p>这里以豆包的coding计划为案例。</p>
<h3 data-id="heading-3">1.修改使用模型</h3>
<p>打开 MoltBot 页面</p>
<p>在 Web UI 中，选择 <strong>Settings-Config-Authentication</strong>，在底部选择 <strong>Raw</strong> 方式查看配置信息。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ODkzMmE0MjYwZTNiOTVkZjI3N2E5ZGRhODI2NDEzNjZfMDU0aTV0OW1yVWlGdHhmU0tLOUtMS0RpbnRDczhCcFZfVG9rZW46WjFYbWJaSGgxb1dLNnV4UUhWbmNSTnRtbjNmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>在 agents 参数下，找到 model 和 models，改为您要接入的模型名称</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
<span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao/doubao-seed-1-8-251228"</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
<span class="hljs-attr">"doubao/doubao-seed-1-8-251228"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao"</span> <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其中，<code>doubao</code>为平台名称，<code>doubao-seed-1-8-251228</code>为模型名称</p>
<h3 data-id="heading-4">2.配置模型平台</h3>
<p>在 models 参数下，修改您要接入的 base_url 以及 API KEY。（可在平台后台获取）</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=YWIzM2U4NTA2YjVhNTU5Y2M3ODY4ZTQxZjFiZjJmNTZfNFlmSHpiaUR2RFN2emRGUFNWeGE5bVE3MUxlcEd6QTBfVG9rZW46VE4yRGIyVmdib0NueFN4SE4xcWN4bHFqbmlmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"doubao"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://ark.cn-beijing.volces.com/api/v3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"YOUR_API_KEY"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai-completions"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><code>baseUrl</code> 为模型的请求地址</p>
<p><code>apiKey</code> 为你自己的密钥</p>
<p><code>api</code> 固定为 <code>openai-completions</code></p>
<h3 data-id="heading-5">3.修改认证配置</h3>
<p>在 auth 参数下，修改认证配置</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjdhYWI1Y2FiMzAxMzk2NzIyY2ZhMjc2N2Q1NzgxMmFfd1VWRVRxcWl5ZWprYW93ZnJlTEFwenRBdU1kcG1pc1NfVG9rZW46U2h5c2IydFVFb3dSbTR4RkZza2NKY0hHbkRmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"auth"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"profiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"doubao:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-6">4.保存配置并重启服务</h3>
<p>在 MoltBot 配置界面完成修改后，先单击 <strong>Save</strong>，保存完成后单击 <strong>Update</strong>。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OTQyNjczZTIyYWZhODRiMTRlZTYzMGQ2Yzk1YWQ0YjNfbEowc0NCQ0hzY3dINWRGZ0ZPaE9EeldZaVFZM1VmYllfVG9rZW46V1U3YWJFSmlFb05EMEF4dWF5T2NGV05pbm5pXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">四、接入主流社交平台</h2>
<h3 data-id="heading-8">企业微信</h3>
<h4 data-id="heading-9">1.创建机器人</h4>
<p>前往<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%253A%252F%252Fwork.weixin.qq.com%252F%26objectId%3D2625147%26objectType%3D1%26contentType%3Drich" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fwork.weixin.qq.com%2F&amp;objectId=2625147&amp;objectType=1&amp;contentType=rich" ref="nofollow noopener noreferrer"><span>企业微信官网</span></a>，使用有企业管理员权限的账号登录。如尚未拥有满足条件的企业，可以参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%253A%252F%252Fopen.work.weixin.qq.com%252Fwwopen%252Fmanual%252Fdetail%253Ft%253Dregister%26objectId%3D2625147%26objectType%3D1%26contentType%3Drich" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fopen.work.weixin.qq.com%2Fwwopen%2Fmanual%2Fdetail%3Ft%3Dregister&amp;objectId=2625147&amp;objectType=1&amp;contentType=rich" ref="nofollow noopener noreferrer"><span>创建&amp;注册企业</span></a>来创建一个新企业，以此来体验Moltbot（Clawdbot）的能力。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OWQ1MDk0N2FhM2FmOTc1NGM5NGZmMTgzNmQ2MzQ5NzNfYko3b3ZZSUlHSHNNM0JqSkE4bXhzUEtYYXh6RW1BOWtfVG9rZW46TkVDemJlVDRqb3dzbFB4VFREMmNzZUlVbjljXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>在企业微信管理后台左侧导航依次找到并进入<strong>安全与管理 &gt; 管理工具</strong>，并且在页面内点击<strong>创建机器人</strong>。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=YTQ4NGM2NWY2MTBhOGUxMTg3Y2MzYTAyZGEwNWE0ODJfNHNhcVI5V01mUnBYeXM1NHBrdGFkZm0yV0VaNFNzSmNfVG9rZW46Q3VJT2JPSEdob0dtQTJ4SGJGT2Nqc2hpbnloXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>滑到页面最底端点击API模式创建按钮：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NDk3MzhiYWU3ZmUwNWRlNmQ2ODMxNTMzMDMwY2FhYjlfQUF4VnRjNU0wM1ZvcjNzMDN4d2haRU5zS3FaTk5QZnZfVG9rZW46T0Nwa2J1N1I3b3ByQTF4ekhpaWNES0tHbklPXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>在切换后的页面，依次填写名称、简介、可见范围、<strong>URL</strong>，并且点击<strong>随机获取</strong>按钮生成<strong>Token</strong>和<strong>Encoding-AESKey</strong>（这是企业微信与Moltbot进行加密通信的密钥）。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjI2YTk3MzJmZDNlYmRmZjA2OWM4NDE4MjA1ZmQ2N2Ffc0d1YUN1SnVmT2JXa2daMVhzT0xiS0MzQjBmTVZybzlfVG9rZW46QVk4N2JoR084b3BYTFd4dmdWbWNVTDZqbnZoXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>此处需要关注，URL处提及的“实例IP地址”为你的公网IP地址。一般家用电脑是没有公网IP的，建议购买服务器部署。</p>
<pre><code class="hljs language-plain" lang="plain">http://公网IP地址:18789/wecom
</code></pre>
<p>示例：
比如我的公网IP地址是12.12.12.12，那么你就应该在企业微信机器人的URL处填入：<code>http://12.12.12.12:18789/wecom</code></p>
<p>填写完成后，先不要点创建，而是需要回到登录服务器的页面准备进行接下来的配置。</p>
<h4 data-id="heading-10">2.连接机器人</h4>
<p>此处我们首先假设你现在处于如图所示的步骤：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NmVhNmY4YzFmY2Y5ZmY3YTIyNjdmZGJhZWJjNTVlZjhfZmczNU5BUVR3cW9EbTBRNEx1UDhPTmpwQVhhNDMzMEtfVG9rZW46SGY3dmJJUnlZb2w4SlJ4SExJeWNVbGRpbndkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>如果你没有，最简单的方法是：</p>
<p>重新执行<code>clawdbot onboard</code>，重新走一遍，直到你回到如上步骤。</p>
<p>接下来，我们直接选择WeCom（Plugin），回车确认：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NmUxYjhiNzdlMWUxNzg0OGJlMjRkYmRjZjZjOWVhNmVfeU9keGVuWE9vdnh6aVhHbHp2MVVFd2JjTHFEZlZleDFfVG9rZW46QXNRRmI5aW9Pb291blZ4Tm0wY2M1WEl6bmtjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>接下来我们需要修改Moltbot的配置文件。</p>
<p>在 Web UI 中，选择 <strong>Settings-Config-Authentication</strong>，在底部选择 <strong>Raw</strong> 方式查看配置信息。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NTBmNmQ5OWE5YTQxMjE5ZTU4MmVkY2I5YTA1OTM4NDJfRmp0VDA2dFdxODFPYzBYQzU1MDRrWFIzZE1ubHhOeDVfVG9rZW46UTdnd2JjbGhkb0g3eTR4R2d0ZWNwcEx6bndmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json">  <span class="hljs-attr">"wecom"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"webhookPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/wecom"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"填入创建企业微信机器人的页面，生成的Token"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"encodingAESKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"填入创建企业微信机器人的页面，生成的encodingAESKey"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"receiveId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"dm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"policy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pairing"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
</code></pre>
<p>输入完成后，保存并更新，重新启动网关。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NDQ2MzUzMmYxNWQwMGZmYTI5ZjEwOGE4NDk3YWViZWVfSGlya0syQ2NJREVMZVFlRkhWSTBwc1d2N09PWW1pb1lfVG9rZW46SzNGOGJ0eUZqb3BackJ4QWo2MGN2anR1bnljXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>如果没有外层的<code>"channels":{}</code>，那么参考上图手动拼一下就好了。</p>
<h4 data-id="heading-11">3.继续创建机器人</h4>
<p>此时我们再回到企业微信机器人创建页，点击创建按钮</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NzRkNjg3MTE4MWRlZGI5OGI3YTdlNWFiNWVmZDJiNmZfWXVaY1RyczhWbzh3dWhicVpKbE1qOEZBWnl5bzRCTG1fVG9rZW46T2tMYmJWWVRnb1NnU2h4TWxJaGNCamFGbktiXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>创建成功后，在接下来的页面中找到企业微信机器人的二维码，用手机扫码后添加。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2E1NzU1N2JmZmM2OWI5Nzc0MmIzZjYzOWFlMzE5ZmZfSVlwaGh3VVFBaUx5ck5oVE0yWWdTQWtZdld3OXBBNFJfVG9rZW46RU1QN2JrVnRob1JDZWF4RE5ZbWMySjVOblRjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>添加完成后，即可在聊天窗中与它进行对话：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGMzZTc5NzdjYjY0NjhlZDFlOWRiMjczOWM3ODNkNWZfdmhONUhUUjZ3eXJZU3kyR1BvTG5jc21DczJBdVF0NlBfVG9rZW46UGl5OGJpb1ptb2ZRd1F4cXZKSWN4RlNabnpkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">飞书</h3>
<p>此处我们首先假设你现在处于如图所示的步骤：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NTkxOGZmYTNjMjY5M2YzOWM3MzhmOWRiZWFkNjIwZWNfODZOTjRWa2pGb2trWENtY29HMmZGUTJ3VGw3MVdKUWxfVG9rZW46SGtVNWJLVEdEb1pUSU54ZEZIemNuQkFsbkFjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-13">1.创建机器人</h4>
<ol>
<li>
<p>访问飞书开发者平台（<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.feishu.cn%2Fapp%3Flang%3Dzh-CN%25EF%25BC%2589%25EF%25BC%259B" target="_blank" title="https://open.feishu.cn/app?lang=zh-CN%EF%BC%89%EF%BC%9B" ref="nofollow noopener noreferrer">open.feishu.cn/app?lang=zh…</a></p>
</li>
<li>
<p>登录后，点击 “创建企业自建应用”；</p>
</li>
<li>
<p>填写应用基础信息：应用名称（如 “Moltbot 助手”），选择应用图标，点击 “创建” 按钮，进入<span>应用管理</span>页面。</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NzY2NjNiOTMzNDYxZTI0ZmJmNzA4ODdlYmMwNWFiZmNfQjlseDZRbW80OWRtNDJVMEU2TkhSV3dIRkFUTlJQa21fVG9rZW46TmVFMWJ1Skhjb2FzcEF4bWlQWGNXaUxDbnFnXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>4.添加机器人能力：在应用管理页左侧导航栏，找到并点击 “添加应用能力”，在弹出的列表中选择 “机器人”，点击 “添加”。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OGU3ZTU2ZjFiNzEwMzIxODM0MGM5MmExZTI5YTNkM2VfSzg4YWVkS2RBVjVjR0VlbEJaUGJGTGZnYkNRUWlNc3RfVG9rZW46WG1PSWJKSHZDbzd6Uk54cURhU2NuN1Q5bjdmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>5.点击上方的创建版本并发布。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGYxNmEzY2Q0MzNlYzQ0ZWJjMDUxMjBjMmY2YTgwNzFfckxxSlFoTVJnMzhwYmdxMkFCemdIVEN2Q21vaXNKRExfVG9rZW46VFVteWJDSzIzb0VrZ3d4bDM2ZWM0NXIwbm5oXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><strong>获取飞书应用凭证</strong></p>
<ol>
<li>
<p>在飞书应用管理页，左侧导航栏找到 “凭据与基础信息” 栏目，点击进入；</p>
</li>
<li>
<p>在页面中找到 “App ID” 和 “App Secret” 两个参数，分别点击右侧 “复制” 按钮，将其保存到记事本或备忘录中；</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NmU1YzFhNWE4NzFhMTk2ZTgyZjQ4YTZkM2M5ZDY4MjVfQ1l4QXoyZHpRTVFxeXlZWDc4R2VHcVJNRHhISWRVRzdfVG9rZW46UVBsVGJEM2ZMb2U5NVB4bEJFVWNpZldQbmNlXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>3.保存完成后，不要关闭飞书开发者平台页面，后续配置权限还需使用。</p>
<h4 data-id="heading-14">2.连接机器人</h4>
<p><strong>输入APP id 与 APP Secret</strong></p>
<p>输入上一步获取到的id与secret，回车确认；</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MGUwMzM4YWViNDA5NDVlMmJhMDM3YjExOWJiMDgyMTlfSm5vdjU3VUc5a284bnlVcE9MbmNKN2R1Rjd4U21vT2RfVG9rZW46SWdrNWJmY01Zb0xwaGh4RnM0NWNLazhQbkllXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>后续按正常流程运行即可~</p>
<h4 data-id="heading-15">3.配置机器人</h4>
<h5 data-id="heading-16"><strong>飞书应用权限与事件配置</strong></h5>
<p>此步骤分为「事件配置」「权限配置」「应用发布」三部分，全程在飞书开发者平台操作，按顺序执行：</p>
<h6 data-id="heading-17"><strong>（1）事件配置</strong></h6>
<ol>
<li>
<p>在飞书应用管理页，左侧导航栏找到 “事件与回调” 栏目，点击进入；</p>
</li>
<li>
<p>事件配置：在页面中选择 “长连接”，点击 “保存”；</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MGYxNTkyMjEwYzY5NzI3NjA2MDZhMDhkYjM3Nzg5NmVfeThrU0JNNTR5Y3g5cDlRMUh4WEtwZktjYThaMkRBR1VfVG9rZW46WVRwdmJlZldtb1VkN1R4TmxyQWNhSXk4bkVkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<p>3.添加事件：点击页面中的 “添加事件”，在弹出的事件列表中，选择 “消息与群组” 分类，勾选 “接收消息”，点击 “确定”，完成事件订阅。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MjkwMTRjZWI2OWExYjA2ZDIyNDRjZWYxOWNkNGRhNWFfaHFKbURjUGxXZ1lPVkpzaWFUMkRmaXd6QkNrTDJsVnFfVG9rZW46T3JhVWJBRkM4b1J1UjF4Vnd3M2NJeTNNbmFkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<p>4.回调配置：订阅方式选择 “使用长连接”，无需填写其他地址，配置自动生效。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=YTgxNzM1NjRkYzM4MzFlNTVhMWU5NWY1MGI2ODY4NzJfMXBpWDl3ZWJuNUV2dVdsMFhFWnMwVWRBSGNaVE9pdkJfVG9rZW46WG15UmJtMElJb0RUd3d4Sld0TGM1TVVFbk9mXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<h6 data-id="heading-18"><strong>（2）权限配置</strong></h6>
<ol>
<li>
<p>在飞书应用管理页，左侧导航栏找到 “权限管理” 栏目，点击进入；</p>
</li>
<li>
<p>点击页面中的 “批量导入权限” 按钮，弹出权限导入窗口；</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2UxM2I5NWFmOGQ3NDI3NTBlYzZiOTFkNWM2ZjVlZjdfbHFZdUVrS241RFg1NnpicWI2TFJ5OEw2c0UyUHUyaGxfVG9rZW46VXYwMGJZWjZhb2RGSWx4c0NHZGN2cW4ybmdmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MmU1NDMwYjQ1MmQ5ZDBmYzA1MzZlMmJjNmQxYTE3YTFfakxocEx3dUQ5dHR3OG5mSzZUZ3hBMUNsUThzWno2MjNfVG9rZW46UUplMWJzY1ZUb2RrZ2R4ZEpqVWNYNGtsbjllXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<p>3.复制以下 <span>JSON</span> 代码，粘贴到导入窗口的输入框中，点击 “导入” 按钮，等待权限导入完成：</p>
<p>代码语言：txt</p>
<p>AI代码解释</p>
<pre><code class="hljs language-plain" lang="plain">{
  "scopes": {
    "tenant": [
      "contact:user.base:readonly",
      "im:chat",
      "im:chat:read",
      "im:chat:update",
      "im:message",
      "im:message.group_at_msg:readonly",
      "im:message.p2p_msg:readonly",
      "im:message:send_as_bot",
      "im:resource"
    ],
    "user": []
  }
}
</code></pre>
<p>4.导入验证：页面显示 “导入成功”，且权限列表中出现上述导入的权限，即为配置完成。</p>
<h6 data-id="heading-19"><strong>（3）发布应用</strong></h6>
<ol>
<li>
<p>在飞书应用管理页，左侧导航栏找到 “版本管理与发布” 栏目，点击进入；</p>
</li>
<li>
<p>点击右上角的新建版本；</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MzYwNTJiZTAzMTc5YjYwZGNlN2ExODgxYjMxMjkyMDJfMkxVN2lBamdXSjllZE5NTjZMa0FsMmlFYXZ0TW01UFBfVG9rZW46QktRc2JYQ1IzbzNyakp4TUZOVWN2QUNybm9oXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<p>填写版本号与描述后，保存并发布；</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=M2Y5NzEyNTYwNWRkOTkzZDVkMDQ1NzRhMTc5ZmUzYmFfNU5QQXlUV1RkZ1cxVjZWQjgyUFVERFFYb0gyNElmYzdfVG9rZW46Rzg4MmJsU1l2bzJ4ZWl4bWNMbGNweENUbkxnXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-20">4.启动服务</h4>
<p>回到命令行界面，输入以下命令，启动后不要关闭命令行窗口：</p>
<pre><code class="hljs language-plain" lang="plain">clawdbot gateway
</code></pre>
<h4 data-id="heading-21">5.验证服务</h4>
<ol>
<li>
<p>打开手机或电脑端飞书 APP，登录与飞书开发者平台相同的账号；</p>
</li>
<li>
<p>在飞书首页，找到 “工作台” 入口，点击进入，在工作台列表中找到已发布的 Moltbot 应用（如 “Moltbot 助手”），点击进入；</p>
</li>
<li>
<p>系统将自动启动私聊窗口，发送任意消息（如 “你好”“查询今日日程”）；</p>
</li>
<li>
<p>验证结果：如果收到 Moltbot 的回复，即为飞书接入成功</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MjgyMmIyZGU1ODQwNGI0YzkyYjA2MzIxNjViN2Y5OGRfbFJVTHBnb3c1S0Z3d2p3OHh2a0xoenVxRlE5VjhqNnZfVG9rZW46UGZ2YmJZY3Zxb2JBTmh4SEs5TmNHUUJrbmhmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h3 data-id="heading-22">钉钉</h3>
<p>首先完成初始化，启动MoltBot</p>
<h4 data-id="heading-23">1.安装钉钉插件</h4>
<p>执行命令 <code>clawdbot plugins install clawdbot-dingtalk </code>安装插件</p>
<p>执行命令 <code>clawdbot onboard</code> 开始初始化</p>
<h4 data-id="heading-24">2.初始化</h4>
<p>选择钉钉作为频道</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjNmMTQ1OTM5ODhmN2RmYWJjNzJmNjMyM2VkYmU3MzhfTGRVeHZrOVVxQUxaZEphYkpOanFiUE1JUnM3RU1QaTdfVG9rZW46UzdkMGJobFd2bzRNSjh4dEp1UGNhWGJhbjdlXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-25">3.创建机器人</h4>
<p>前往钉钉开发者平台（需有管理员权限）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%253A%252F%252Fopen-dev.dingtalk.com%252Ffe%252Fapp%253Fhash%253D%2525252523%252525252Fcorp%252525252Fapp%2523%252Fcorp%252Fapp%26objectId%3D2625121%26objectType%3D1%26contentType%3Dundefined" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fopen-dev.dingtalk.com%2Ffe%2Fapp%3Fhash%3D%25252523%2525252Fcorp%2525252Fapp%23%2Fcorp%2Fapp&amp;objectId=2625121&amp;objectType=1&amp;contentType=undefined" ref="nofollow noopener noreferrer"><span>https://open-dev.dingtalk.com/fe/app?hash=%23%2Fcorp%2Fapp#/corp/app</span></a></p>
<p>点击<strong>创建应用</strong></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmRiNjI3ZGIwODI1YjE5ZDg2OTE3ZGVhNzA0NTZlMGZfRzg4MmNnYVNtbDdxczY5RU4yN3BnMUZiZGtNMFRPS1pfVG9rZW46SmJuR2JLTjZ1b1dCSkV4YkRwR2NMUk1mbnhkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>选<strong>机器人</strong></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=M2Q1NTc4ZTZlZjE3YTllMTI1MmUwYzFkMWEyMjI5Y2FfUDlVNXk3QUJpQlFaTlNYaGgzRG54NFJ3UzJ2UUNlSWtfVG9rZW46SE56a2Jqbk1GbzFZS2Z4ZGVTR2NjZ245bmljXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>完成所有必填项（其他默认）</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NjBjZWZkNzdlZDQxNjcxYjYwNzZkYjk3OWI4ODViMmZfUFM5a1VoUTByVTNyMXRFREFSeUNSM1FOVHozdWlOQmFfVG9rZW46SEh3d2I0bFZibzVMRjl4Nk9JaGNuMlI1bjVjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>点击 凭证与基础信息 保存好<strong>Client ID与Client Secret</strong>，后面会用到</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NzkzYmY0YzMxNDEzMmM1NzllNWE2ZmRhMjRmYTk1YTRfTmd6OXFNZXM2T0gwVXFnT3ZlWUp6UmFVeUZicXBBNUNfVG9rZW46RTZMNGJyNmFsbzhtaDl4OWgwYmM4QnVHbktlXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>点击 <strong>查看版本详情</strong> &gt;&gt; <strong>编辑</strong></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=M2U4NDg2ZTUxNThiMTk3YTQ5OTc0MzFkYzUyMDQwODFfTXREZldNeG1uMjlpM0xwbktOV2c4YzNta0dBSEhDV1RfVG9rZW46WjRiV2JqMVFxb1U4Y0N4YTNzMWN2eGg4bldlXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>完成所有必填项后点击<strong>保存</strong>，在弹出的窗口点击 <strong>确认发布</strong></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OTYxZDdlNWIyNjJkMDM2OGFiNDU3YmU0N2I4ZDFiZjFfRE44cUQ4Tzg1eldOMlUyejRGOFpuYk10YVhyWmhVdzdfVG9rZW46VnppU2JiRHZUb0NVOXd4QmFFQWNURWRpblFtXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGZkNDA2ZDIyMDBkMTIwMzNmMjhhZDM0ZThhMjY1YTVfUDZ1bG9LbDVIZjlMbVYzM3NQNHBSS1BHMjZJbWk3dDhfVG9rZW46QklqTmJtNWNab2NEU1N4Vlh3QmNuWk5Ybm9qXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-26">4.连接机器人</h4>
<p>接下来我们需要修改Moltbot的配置文件。</p>
<p>在 Web UI 中，选择 <strong>Settings-Config-Authentication</strong>，在底部选择 <strong>Raw</strong> 方式查看配置信息。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MDYzYzY4YjUzZDA5OTkwZDRhZjNhNWQxNDQ2YTE0OTVfVkFraTNZRXA3Q01PMUs2V1JEc1RzM0l3eHVuaHJPSzBfVG9rZW46QWxnMWJlcDlxb2E3ZjJ4OHhSUmNaekFmbldlXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>在meta后面增加下列内容，记得把clientId和clientSecret替换为自己的实际值</p>
<pre><code class="hljs language-json" lang="json">   <span class="hljs-attr">"channels"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
     <span class="hljs-attr">"dingtalk"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
       <span class="hljs-attr">"enabled"</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"clientId"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"your-dingtalk-client-id"</span> <span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"clientSecret"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"your-dingtalk-client-secret"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NTE0ZDhjNjhiMTcyODY4YTEwZGU4ZjEwNDlmZGJlZDRfQzl5YmpNbksyZE9QY05mUzBVeFRPQ21hSzZJam9PRXZfVG9rZW46TkU3eGJlMVZhbzBqWlR4dENvRWM5N3lvbmloXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>保存后重新启动</p>
<h4 data-id="heading-27">5.验证机器人</h4>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MWQ1MmU3MDQ2NGQxOGU1OGU0YWI5ZWJiN2E4ZTZkNDhfR0FKdmhRZDZJOFZ1b1kzYnVyUlRyYTBPYXdnWUlJOENfVG9rZW46TkNjcmJzWm1Mb0N1V3Z4bXVsSmNiRzQxbmllXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MjQ4ZGNiZWNlNmJmYzBlODM4MjRmNzhiMjdhOGY2YTFfYmswUTBoR2swVm1ubWhKOHU0STZVNVNyQU9OTnZFZGxfVG9rZW46T2lYM2JXMUdHb3AxQ1R4cG40RWNBeGZabmtjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h3 data-id="heading-28">QQ Bot</h3>
<h4 data-id="heading-29">1.安装插件</h4>
<p>执行命令 <code>git clone https://github.com/sliverp/qqbot.git &amp;&amp; clawdbot plugins install ./qqbot</code> 安装QQ机器人插件</p>
<h4 data-id="heading-30">2.创建机器人</h4>
<p>在QQ开放平台创建机器人，自己使用无需企业资质，指定用户，指定群聊可访问即可 </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fq.qq.com%2F%23%2Fapps" target="_blank" title="https://q.qq.com/#/apps" ref="nofollow noopener noreferrer">q.qq.com/#/apps</a></p>
<p>如果是新用户的话，注册流程会有点繁琐，但是没有什么难点，按照要求填写自己的个人信息就行</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=YTc1N2JkZDdlMjEyNGU2OWViOGJlYTQ2NGM1ZTVkNzJfNkh6QnNNOVJZU3JndVQ1OWFCOHpzbnprT05yODREaFZfVG9rZW46THZGMWJ5NTVib0FDOXh4eElMRmNlVThibjFkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>注册完整之后就可以创建属于自己的机器人了：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OGRjMTQ4M2U1ZjQ5MjRiMzA4ZDlmNTNiNjA1ZjBhMDdfNHJkQ2xOMm5FRFdzUEJJYWVLaExOTEJIaHVJVWN0dkxfVG9rZW46REx2emJQSGUxb0RHaEx4cVdlSGNmWmRmblFmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>点击你的机器人头像进入到机器人管理员界面</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MWMxODU4NGVkM2ZhZjM1YjllYWQ5MDkzZjk2ZWI3NTBfdW1UOERqSGVZUU1ydnBFd1d2NUIzdEVqYVlmMnNGcTZfVG9rZW46QWZOamJ0bVJsb2xqbEJ4YkMxYWN1eE9DbkpnXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>在管理页面获取到当前机器人的AppID, 和AppSecret，这两个很重要</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MWFmMWEwNTc2NmVjZWNkZTAxYTlmYmI2YWI3YjhiNGJfQWoxdnhaSkVFMFFLRkpBV2RNSWVqS0M3VVRJaXNlS2lfVG9rZW46TjFqOWJNUk8yb2RWZm94MDBvU2MwbHh1bmtiXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>启用QQ连接插件,填写你的AppID和AppSecret</p>
<pre><code class="hljs language-plain" lang="plain">clawdbot channels add --channel qqbot --token "&lt;AppID&gt;:&lt;AppSecret&gt;"
</code></pre>
<p>别忘了在IP白名单哪里，填上自己的服务器的公网IP哦~</p>
<p>重启gateway</p>
<pre><code class="hljs language-plain" lang="plain">clawdbot gateway restart
</code></pre>
<p>到这里就全部结束拉，在手机QQ和电脑版上均可以使用。</p>
<p><em>记得把他拉进群聊，大家一起调戏才更有意思哦~</em></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=YTAzNzRhYjk4NjBlMGY3MzYyYTQ3YjJjYTM5MmM3NDVfRm1yc1d5amdIQ0ZlOGd6aEFEeUoxUGZCN2lNbUVVQ3ZfVG9rZW46VHNJZmJDMk5MbzVIcmF4MlAxTGN3eDJHbkViXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MmVlYWVhNDMxZjI5ZDNkYTNmYjU0NWE1NjAxMGRjODdfMWFjQndNU1hDN3Nmem5sWE5MVnZHanR3bjh2TkpGSllfVG9rZW46TzVkVWJzS1Bkb2Z3MWJ4c1VRRmNWamNMbnlnXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>由于QQ开放平台的限制，在正式上线之前只能在特定范围内使用，但是已经可以愉快的跟自己的“贾维斯”聊天了，群里的小伙伴都可以使用哦，快来试试吧~<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%253A%252F%252Fq.qq.com%252Fqqbot%252F%2523%252Fdeveloper%252Fsandbox%26objectId%3D2625097%26objectType%3D1%26contentType%3Drich" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fq.qq.com%2Fqqbot%2F%23%2Fdeveloper%2Fsandbox&amp;objectId=2625097&amp;objectType=1&amp;contentType=rich" ref="nofollow noopener noreferrer"><span>https://q.qq.com/qqbot/#/developer/sandbox</span></a></p>
<p>找不到自己的机器人的话，可以扫描“添加成员”旁边的二维码，扫码添加机器人到自己的聊天界面</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWFlMjQyMWQ1YTBmYTJiMjBmNDBmNmVlNTRiMmRjYWZfd2NnR1NSZkRyNjZ6TzFqNmtKODVZREdNbThxVGpIOW1fVG9rZW46WTFTN2JzTHB4b3UzRmJ4QzZDeWNyS3VFbmRoXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h2 data-id="heading-31"> 五、交流群</h2>
<p>添加润雨：<span> runyut </span> 拉你进MoltBot交流群哦~，记得备注哪里来的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[花5分钟、50块体验 ClawdBot （MoltBot），值不值？]]></title>    <link>https://juejin.cn/post/7600953198745452550</link>    <guid>https://juejin.cn/post/7600953198745452550</guid>    <pubDate>2026-01-30T06:57:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600953198745452550" data-draft-id="7600953198744600582" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="花5分钟、50块体验 ClawdBot （MoltBot），值不值？"/> <meta itemprop="keywords" content="前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-30T06:57:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金安东尼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            花5分钟、50块体验 ClawdBot （MoltBot），值不值？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金安东尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:57:34.000Z" title="Fri Jan 30 2026 06:57:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>普通人，能不能用极低成本，把一个能用的 ClawdBot（moltbot） 跑起来。</strong></p>
<p>花费 50 元、官方平台、尽量少折腾，最好 5 分钟内能看到效果。</p>
<p>阿里云的轻量应用服务器 + clawdbot，实测，它来了～～</p>
<h3 data-id="heading-0">阿里云 + clawdbot</h3>
<p>整个过程比预期要直给很多。</p>
<p>先是在活动页直接购买 clawdbot 套餐，配套的是一台<strong>轻量应用服务器</strong>，不需要额外选型，也不用自己拉镜像。</p>
<p>实例创建完成后，控制台里已经能看到完整的运行环境，省掉了最容易劝退新人的那一段“环境准备期”。</p>
<p>传送门：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Factivity%2Fecs%2Fclawdbot%23J_003" target="_blank" title="https://www.aliyun.com/activity/ecs/clawdbot#J_003" ref="nofollow noopener noreferrer">购买</a>
｜<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fsimple-application-server%2Fuse-cases%2Fquickly-deploy-and-use-moltbot%3Fspm%3D5176.45303171.J_prbLYvsEQKDdDmwSsbh3D.2.2a4258acqO5uJV" target="_blank" title="https://help.aliyun.com/zh/simple-application-server/use-cases/quickly-deploy-and-use-moltbot?spm=5176.45303171.J_prbLYvsEQKDdDmwSsbh3D.2.2a4258acqO5uJV" ref="nofollow noopener noreferrer">指南</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dda86fe4d70f4b4dbd8117d0221f84b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=3t9STVDX9H%2Bi5wwYBz3oGe2cLII%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">轻量应用服务器详情</h3>
<p>详情概览：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76e84b32be8a4f5785c80fe05539b2df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=TeZjAFdm0Bu11XxdoALGIBvB2%2Bg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">阿里云百炼平台</h3>
<p>接着按照官方指南走 2 步流程：</p>
<p>放行端口、在百炼平台生成 API Key、复制到服务器里执行初始化命令。</p>
<p>没有出现隐晦参数，基本属于复制—执行—确认状态。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf3080c901a844f098bf41651534991c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=ettLuxll%2F8cu%2F1UwVllJK%2F5eDy4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">放行端口</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d8dc81e58c1483897315532917f3234~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=GfSiKHeLsAS3BnzfO5GkumLdXwo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">复制 API Key</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf552c17b6f64856992f2eac82ccf121~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=1%2B2xr%2FvMP5toAI1cZMhyDS8kQWs%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">执行命令</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9627d7c0fde4eb99bcaeea480359f36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=eMSJ5FEBKM%2Bv9HFDrr0Cv%2BHvWiM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">开启 respond</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be8eb8e772e44f308930d6f2acd8331f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=KgyGBbrG5ZfFQZKjeAEClaI9C5c%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">访问</h3>
<p>服务端口可访问的那一刻，本质上这个 Bot 已经活了。</p>
<p>不需要额外写代码，也不需要接数据库，直接通过浏览器就能看到交互界面。</p>
<p>确实，很轻便的体验～</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce3bef2918c4460f8664ad2d7b24f7f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=8Lz9y3EOBRdT7%2BHOMhyO%2BX30ovU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">命令</h3>
<p>本瓜随意发了一条命令：先跑着，用一段时间，再回头看值不值。</p>
<p>看看——稳定性、上下文能力、实际使用频率，以及它是否真的能嵌进日常工作流。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1267e80621f4c96898d830fdab49913~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=CgXICktmqMC8pCu8KgDN%2B%2Byceeo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">集成到钉钉</h3>
<p>如果继续往下走，还可以很自然地把它接进钉钉，对话入口直接落到熟悉的办公工具里，<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fsimple-application-server%2Fuse-cases%2Fquickly-deploy-and-use-moltbot" target="_blank" title="https://help.aliyun.com/zh/simple-application-server/use-cases/quickly-deploy-and-use-moltbot" ref="nofollow noopener noreferrer">“配置”</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[月之暗面 Kimi Code 发布，如何上手体验？]]></title>    <link>https://juejin.cn/post/7600414546189434890</link>    <guid>https://juejin.cn/post/7600414546189434890</guid>    <pubDate>2026-01-29T08:40:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600414546189434890" data-draft-id="7600344784946446382" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="月之暗面 Kimi Code 发布，如何上手体验？"/> <meta itemprop="keywords" content="后端,AI编程"/> <meta itemprop="datePublished" content="2026-01-29T08:40:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ServBay"/> <meta itemprop="url" content="https://juejin.cn/user/3828929445244761"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            月之暗面 Kimi Code 发布，如何上手体验？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3828929445244761/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ServBay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T08:40:27.000Z" title="Thu Jan 29 2026 08:40:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>月之暗面正式发布了 Kimi 的官方编程工具 Kimi Code。这不仅仅是一个代码生成器，而是一个可以直接在终端运行、具备自主规划能力的 AI Agent。它基于 K2.5 模型，支持多模态输入（图片和视频），并能通过 ACP（Agent Client Protocol）协议无缝集成到 VSCode、Cursor、JetBrains 和 Zed 等主流编辑器中。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa447d0a05da4cf0aaff56d6e2b94d02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284596&amp;x-signature=1%2BpZPl%2B205Flfebz1XggvZ5mG%2BA%3D" alt="" loading="lazy"/></p>
<p>对于开发者而言，Kimi Code 实现了“阅读代码”到“执行命令”的闭环，覆盖了从构建、调试、重构到测试的端到端任务。</p>
<p>以下是关于 Kimi Code CLI 的核心功能、安装配置及高阶使用技巧。</p>
<h3 data-id="heading-0">Kimi Code CLI 是什么</h3>
<p>Kimi Code CLI 是一个运行在终端中的智能代理。与传统的对话机器人不同，它具备操作系统的执行权限。它可以：</p>
<ul>
<li>
<p><strong>阅读和编辑代码</strong>：直接修改源文件，而非仅仅给出建议。</p>
</li>
<li>
<p><strong>执行 Shell 命令</strong>：运行构建、测试脚本。</p>
</li>
<li>
<p><strong>自主规划</strong>：在遇到错误时，自动分析日志并尝试修复，形成“执行-反馈-修正”的循环。</p>
</li>
</ul>
<p>它既是一个独立的终端工具，也可以作为后端服务接入 IDE。</p>
<h3 data-id="heading-1">安装与环境配置</h3>
<p>Kimi Code CLI 依赖 Python 环境（建议版本 3.12-3.14）。</p>
<p><strong>第一步：使用 ServBay 准备 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fpython" target="_blank" title="https://www.servbay.com/features/python" ref="nofollow noopener noreferrer">Python 环境</a></strong></p>
<p>打开 ServBay，在「软件包」中，找到并安装 <strong>Python 3.13</strong>（这是 Kimi Code 推荐的最佳兼容版本）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37620a99caa74a6a88443c6901f76fe0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284596&amp;x-signature=T1sSm5n5fxWueZoR%2FgktdRSvoMo%3D" alt="" loading="lazy"/></p>
<p>ServBay 会自动配置好环境，确保终端调用的是这个独立的 Python 版本，拥有完整的 <code>pip</code> 包管理能力。</p>
<p><strong>第二步：安装 uv 包管理器</strong></p>
<p>有了 ServBay 提供的 Python 环境后，需要先安装 <code>uv</code>。<code>uv</code> 是一个极速的 Python 包管理器，也是 Kimi Code 官方推荐的底层工具。在终端执行：</p>
<pre><code class="hljs language-bash" lang="bash">pip install uv
</code></pre>
<p><strong>第三步：安装 Kimi Code CLI</strong></p>
<p>现在 <code>uv</code> 命令已经可用了，直接使用它来安装 Kimi Code：</p>
<pre><code class="hljs language-bash" lang="bash">uv tool install --python 3.13 kimi-cli
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92c8c0b3054c451e84280fce67a117d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284596&amp;x-signature=ECmMBQU2Eg2jzTobtNCoRbSyesQ%3D" alt="" loading="lazy"/></p>
<p>安装完成后，验证是否成功：</p>
<pre><code class="hljs language-bash" lang="bash">kimi --version
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e101980cde849f39bc110979b3c4fb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284596&amp;x-signature=r1FMLxUAzlMmev%2FWJzeRNBv3BEg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">初始化与配置</h3>
<p>在项目目录下输入 <code>kimi</code> 即可启动交互界面。</p>
<p>首次使用推荐通过 <code>/login</code> 命令登录 Kimi 账号，系统会自动同步可用的模型配置。如果需要使用特定的 API Key，也可以通过 <code>/setup</code> 手动配置端点和密钥。</p>
<p><strong>项目索引</strong></p>
<p>进入一个新项目时，建议先运行 <code>/init</code>。这会让 Kimi 分析项目结构并生成 <code>AGENTS.md</code> 文件。这个文件相当于给 AI 看的“项目说明书”，能显著提升后续任务的准确率。</p>
<h3 data-id="heading-3">核心工作流</h3>
<p>Kimi Code CLI 的交互采用了类似 Shell 的混合模式，按 <code>Ctrl-X</code> 可在 <strong>Agent 模式</strong>（对话）和 <strong>Shell 模式</strong>（执行原生命令）之间切换。</p>
<h4 data-id="heading-4">1. 功能开发与重构</h4>
<p>在 Agent 模式下，直接用自然语言描述需求。Kimi 会遵循“阅读 → 修改 → 验证”的流程。</p>
<p>例如：</p>
<blockquote>
<p>“给用户列表页面添加分页功能，每页显示 20 条记录，样式参考现有的 Button 组件。”</p>
</blockquote>
<p>它会自动搜索相关文件，理解上下文，进行代码修改，并保持代码风格的一致性。</p>
<h4 data-id="heading-5">2. 排查与修复</h4>
<p>遇到报错时，可以直接粘贴错误日志，或者让 Kimi 运行测试命令。</p>
<blockquote>
<p>“运行 npm test，如果有失败的用例，请帮我分析原因并修复。”</p>
</blockquote>
<p>在处理复杂逻辑时，可以通过 <code>/model</code> 切换到支持 <strong>Thinking 模式</strong>的模型（如 k2-thinking），让 AI 在输出方案前进行更深度的逻辑推演。</p>
<h4 data-id="heading-6">3. 自动化任务</h4>
<p>对于繁琐的批量操作，CLI 优势其实挺多的，比如：</p>
<ul>
<li>
<p>把 src 目录下所有 .js 文件的 var 声明改成 const 或 let。</p>
</li>
<li>
<p>分析 logs 目录下的日志，统计接口平均响应时间。</p>
</li>
<li>
<p>把 images 目录下的 PNG 转换为 JPEG。</p>
</li>
</ul>
<h3 data-id="heading-7">高阶技巧</h3>
<ul>
<li>
<p><strong>@路径补全</strong>：在对话中输入 <code>@</code> 可以快速引用项目中的文件，例如 <code>帮我解释 @src/core/scheduler.py 的逻辑</code>。</p>
</li>
<li>
<p><strong>多模态输入</strong>：支持直接粘贴剪贴板中的图片。如果是 UI 调整任务，截图给 AI 往往比文字描述更高效。</p>
</li>
<li>
<p><strong>YOLO 模式</strong>：默认情况下，AI 的每一个文件修改和命令执行都需要用户确认。如果你在 Docker 容器或测试环境中运行，可以使用 <code>/yolo</code> 命令开启“大胆模式”，跳过所有确认步骤，实现全自动执行（生产环境慎用）。</p>
</li>
</ul>
<h3 data-id="heading-8">集成到编辑器</h3>
<p>Kimi Code 支持 ACP 协议，这意味着它不仅活在终端里，也能集成到 JetBrains 系列 IDE（IntelliJ IDEA、PyCharm、WebStorm 等）中。</p>
<p>首先需要在终端获取 Kimi 的安装路径：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">which</span> kimi
</code></pre>
<p>复制输出的路径（例如 <code>/Users/username/.local/bin/kimi</code>）。</p>
<p><strong>配置 AI 助手</strong></p>
<p>打开 IDE 的 AI 聊天面板（通常需要安装 AI Assistant 插件），在菜单中点击 <strong>"Configure ACP agents"</strong> ，添加如下配置：</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"agent_servers"</span>: {
    <span class="hljs-string">"Kimi Code CLI"</span>: {
      <span class="hljs-string">"command"</span>: <span class="hljs-string">"/Users/你的用户名/.local/bin/kimi"</span>, 
      <span class="hljs-string">"args"</span>: [<span class="hljs-string">"acp"</span>],
      <span class="hljs-string">"env"</span>: {}
    }
  }
}
</code></pre>
<p><em>注意：</em> <em><code>command</code></em> <em>必须填入第一步获取的完整绝对路径。</em></p>
<p><strong>开始使用</strong></p>
<p>保存后，在 AI 聊天的 Agent 选择器中即可看到 Kimi Code CLI。</p>
<h3 data-id="heading-9">总结</h3>
<p>Kimi Code 并没有花里胡哨的功能，但是它解决了开发者的问题，开发者不需要离开终端，就能让 AI 动手写代码。配合 ServBay 提供的稳定 Python 环境，不仅安装过程更顺畅，也能让 AI 工具在隔离的沙盒中高效运行，避免对系统造成干扰。</p>
<p>目前该工具处于技术预览阶段，建议在非生产关键路径上先行试用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kafka简介：了解现代分布式消息队列的基石]]></title>    <link>https://juejin.cn/post/7600260767688114202</link>    <guid>https://juejin.cn/post/7600260767688114202</guid>    <pubDate>2026-01-29T03:27:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600260767688114202" data-draft-id="7492648484967202831" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kafka简介：了解现代分布式消息队列的基石"/> <meta itemprop="keywords" content="Kafka,消息队列,性能优化"/> <meta itemprop="datePublished" content="2026-01-29T03:27:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Go高并发架构_王工"/> <meta itemprop="url" content="https://juejin.cn/user/446863555701561"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kafka简介：了解现代分布式消息队列的基石
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446863555701561/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Go高并发架构_王工
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T03:27:26.000Z" title="Thu Jan 29 2026 03:27:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    28
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 引言</h2>
<p>在微服务、实时分析和云原生架构盛行的今天，<strong>分布式消息队列</strong>就像现代系统的神经网络，负责在复杂环境中高效、可靠地传递数据。而在众多消息队列技术中，Apache Kafka无疑是一颗耀眼的明星。它不仅是一个高性能的消息队列，更是一个功能强大的分布式流处理平台。想象Kafka是一条数据高速公路：它能以极高的速度和可靠性运输海量消息，支撑从实时监控到事件驱动架构的各种场景。</p>
<p>为什么选择Kafka？Kafka诞生于LinkedIn，最初用于处理每天数百万的用户事件，如今已成为Apache顶级项目，被Netflix、Uber、Airbnb等公司广泛采用。它每天能处理<strong>数万亿条消息</strong>，以低延迟和高可用性著称。相比传统消息队列（如RabbitMQ），Kafka集消息传递、数据存储和流处理于一体，提供了无与伦比的灵活性。</p>
<p>本文的目标是帮助开发者深入理解Kafka的核心优势，并通过实战经验提升应用能力。我们将从基础概念入手，剖析Kafka的特色功能，分享生产环境中的优化技巧，并揭示常见问题及解决方案。读完后，你将能更自信地在项目中驾驭Kafka。</p>
<p><strong>目标读者</strong>：如果你有1-2年的Kafka开发经验，想从基础迈向精通，这篇文章为你量身定制。让我们一起开启Kafka的探索之旅！</p>
<hr/>
<h3 data-id="heading-1">过渡</h3>
<p>在动手写代码之前，我们先打好基础，了解Kafka的核心概念和架构。这些知识就像地图，指引我们在Kafka的世界中游刃有余。</p>
<hr/>
<h2 data-id="heading-2">2. Kafka核心概念与架构</h2>
<h3 data-id="heading-3">Kafka简介</h3>
<p>Kafka于2010年诞生于LinkedIn，旨在解决海量事件流（如用户点击、页面访问）的实时处理难题。你可以把Kafka想象成一个<strong>分布式日志</strong>：消息按时间顺序追加存储，多个系统可以并行读写。它从一个简单的消息队列，逐步演变为Apache顶级项目，如今被定位为<strong>高吞吐、可扩展的流处理平台</strong>。</p>
<p><strong>核心定位</strong>：Kafka不仅仅是消息队列（像ActiveMQ），它还是一个集发布、存储和处理数据流于一体的分布式系统，适合日志聚合、实时分析等场景。</p>
<h3 data-id="heading-4">核心组件</h3>
<p>Kafka的架构由几个关键组件构成，每个组件各司其职，共同构建高效的系统：</p>
<ul>
<li><strong>Topic（主题）</strong>：消息的分类或通道，类似收件箱的标签（例如<code>user-clicks</code>）。</li>
<li><strong>Partition（分区）</strong>：主题被拆分为多个分区，用于并行处理和负载均衡，每个分区是一个有序日志。</li>
<li><strong>Producer（生产者）</strong>：向主题发送消息的客户端。</li>
<li><strong>Consumer（消费者）</strong>：从主题读取消息的客户端，通常以组的形式并行消费。</li>
<li><strong>Broker（代理）</strong>：Kafka集群中的服务器，负责存储和管理消息。</li>
<li><strong>Offset（偏移量）</strong>：分区中每条消息的唯一标识，用于追踪消费进度。</li>
<li><strong>Consumer Group（消费者组）</strong>：一组消费者，共同分担主题分区的消费任务。</li>
</ul>
<p><strong>示意图</strong>：Kafka架构概览</p>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">-----------------+        +-----------------+        +-----------------+</span>
|  生产者 <span class="hljs-number">1</span>       | <span class="hljs-comment">-----&gt; |   主题 A        | &lt;----- |  消费者 1       |</span>
|  生产者 <span class="hljs-number">2</span>       | <span class="hljs-comment">-----&gt; | (分区 0,1)      | &lt;----- |  消费者 2       |</span>
+<span class="hljs-comment">-----------------+        |   Broker 1      |        | (消费者组)      |</span>
                           +<span class="hljs-comment">-----------------+        +-----------------+</span>
                           |   Broker <span class="hljs-number">2</span>      |
                           +<span class="hljs-comment">-----------------+</span>
                           |   Broker <span class="hljs-number">3</span>      |
                           +<span class="hljs-comment">-----------------+</span>
</code></pre>
<h3 data-id="heading-5">架构优势</h3>
<p>Kafka的设计在<strong>性能</strong>、<strong>扩展性</strong>和<strong>可靠性</strong>之间取得了巧妙平衡：</p>
<ul>
<li><strong>高吞吐量</strong>：通过顺序写磁盘和<strong>零拷贝</strong>技术，Kafka每秒可处理数百万条消息，极大降低CPU开销。</li>
<li><strong>分布式设计</strong>：Broker组成集群，支持水平扩展，分区分散负载，副本保证容错。</li>
<li><strong>数据持久化</strong>：消息可存储数天甚至更久（可配置保留周期，如7天），为消费者提供可靠的缓冲。</li>
</ul>
<p><strong>表格</strong>：Kafka与传统消息队列对比</p>


































<table><thead><tr><th>特性</th><th>Kafka</th><th>传统消息队列（如RabbitMQ）</th></tr></thead><tbody><tr><td><strong>吞吐量</strong></td><td>每秒百万级</td><td>每秒千级</td></tr><tr><td>**持久"`</td><td/></tr><tr><td><strong>持久化</strong></td><td>长期存储</td><td>短期排队</td></tr><tr><td><strong>扩展性</strong></td><td>水平扩展（分区）</td><td>垂直扩展（单节点）</td></tr><tr><td><strong>适用场景</strong></td><td>流处理、日志</td><td>任务队列、RPC</td></tr></tbody></table>
<h3 data-id="heading-6">示例代码：基础生产者和消费者</h3>
<p>让我们通过一个简单的Java/Spring Boot示例，看看Kafka如何工作。以下代码实现了一个生产者发送消息到主题，以及一个消费者读取消息。</p>
<p><strong>生产者代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;
<span class="hljs-keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleProducer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 配置生产者属性</span>
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"bootstrap.servers"</span>, <span class="hljs-string">"localhost:9092"</span>);
        props.put(<span class="hljs-string">"key.serializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringSerializer"</span>);
        props.put(<span class="hljs-string">"value.serializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringSerializer"</span>);

        <span class="hljs-comment">// 创建生产者实例</span>
        <span class="hljs-keyword">try</span> (KafkaProducer&lt;String, String&gt; producer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaProducer</span>&lt;&gt;(props)) {
            <span class="hljs-comment">// 向test-topic发送10条消息</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                ProducerRecord&lt;String, String&gt; record = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProducerRecord</span>&lt;&gt;(<span class="hljs-string">"test-topic"</span>, <span class="hljs-string">"key-"</span> + i, <span class="hljs-string">"Message-"</span> + i);
                producer.send(record, (metadata, exception) -&gt; {
                    <span class="hljs-keyword">if</span> (exception == <span class="hljs-literal">null</span>) {
                        System.out.println(<span class="hljs-string">"发送至分区: "</span> + metadata.partition());
                    } <span class="hljs-keyword">else</span> {
                        exception.printStackTrace();
                    }
                });
            }
        }
    }
}
</code></pre>
<p><strong>消费者代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;
<span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;
<span class="hljs-keyword">import</span> java.time.Duration;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleConsumer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 配置消费者属性</span>
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"bootstrap.servers"</span>, <span class="hljs-string">"localhost:9092"</span>);
        props.put(<span class="hljs-string">"group.id"</span>, <span class="hljs-string">"test-group"</span>);
        props.put(<span class="hljs-string">"key.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);
        props.put(<span class="hljs-string">"value.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);
        props.put(<span class="hljs-string">"auto.offset.reset"</span>, <span class="hljs-string">"earliest"</span>);

        <span class="hljs-comment">// 创建消费者实例</span>
        <span class="hljs-keyword">try</span> (KafkaConsumer&lt;String, String&gt; consumer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaConsumer</span>&lt;&gt;(props)) {
            <span class="hljs-comment">// 订阅主题</span>
            consumer.subscribe(Collections.singletonList(<span class="hljs-string">"test-topic"</span>));

            <span class="hljs-comment">// 循环拉取消息</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="hljs-number">100</span>));
                records.forEach(record -&gt; {
                    System.out.printf(<span class="hljs-string">"消费消息: key=%s, value=%s, 分区=%d, 偏移量=%d%n"</span>,
                            record.key(), record.value(), record.partition(), record.offset());
                });
            }
        }
    }
}
</code></pre>
<p><strong>代码说明</strong>：</p>
<ul>
<li>生产者异步发送消息，并通过回调处理成功或失败。</li>
<li>消费者通过轮询（poll）获取消息，使用组ID实现负载均衡。</li>
<li>配置项如<code>auto.offset.reset</code>决定消费者从哪里开始读取（<code>earliest</code>表示从头开始）。</li>
</ul>
<hr/>
<h3 data-id="heading-7">过渡</h3>
<p>掌握了Kafka的基础后，我们来探索它的独特功能——从极致的性能到强大的流处理能力，这些特性让Kafka在生产环境中大放异彩。</p>
<hr/>
<h2 data-id="heading-8">3. Kafka的特色功能</h2>
<h3 data-id="heading-9">高性能与低延迟</h3>
<p>Kafka的性能令人叹服，每秒可处理<strong>数百万条消息</strong>，延迟通常在毫秒级。以下是关键技术：</p>
<ul>
<li><strong>批量处理与压缩</strong>：生产者将消息打包发送，减少网络开销；压缩算法（如GZIP、Snappy）显著降低消息体积，提升吞吐量。</li>
<li><strong>零拷贝技术</strong>：Kafka直接从磁盘映射到网络缓冲区，跳过传统的数据拷贝流程，就像直接把书交给读者，而非逐页复印。</li>
</ul>
<p><strong>示意图</strong>：零拷贝与传统I/O对比</p>
<pre><code class="hljs language-rust" lang="rust">传统I/O: 磁盘 <span class="hljs-punctuation">-&gt;</span> 内核缓冲区 <span class="hljs-punctuation">-&gt;</span> 用户缓冲区 <span class="hljs-punctuation">-&gt;</span> 套接字缓冲区 <span class="hljs-punctuation">-&gt;</span> 网络
零拷贝:   磁盘 --------------------------<span class="hljs-punctuation">-&gt;</span> 套接字缓冲区 <span class="hljs-punctuation">-&gt;</span> 网络
</code></pre>
<h3 data-id="heading-10">强大的扩展性</h3>
<p>Kafka的扩展能力让它轻松应对业务增长：</p>
<ul>
<li><strong>分区扩展与重平衡</strong>：增加分区可提升吞吐量；消费者组动态加入或退出时，Kafka自动重新分配分区。</li>
<li><strong>动态Broker管理</strong>：新Broker可无缝加入集群，分区会自动重新分布。</li>
</ul>
<h3 data-id="heading-11">数据可靠性与一致性</h3>
<p>Kafka确保消息不丢失且一致性强：</p>
<ul>
<li><strong>副本与ISR</strong>：每个分区有多个副本，**同步副本（ISR）**与Leader保持一致。Broker故障时，副本可接管。</li>
<li><strong>ACK机制</strong>：生产者可选择确认级别（<code>acks=0</code>、<code>1</code>或<code>all</code>），在速度与可靠性间取舍。</li>
</ul>
<p><strong>表格</strong>：ACK模式对比</p>





























<table><thead><tr><th>模式</th><th>描述</th><th>可靠性</th><th>延迟</th></tr></thead><tbody><tr><td><code>acks=0</code></td><td>无确认</td><td>低</td><td>最快</td></tr><tr><td><code>acks=1</code></td><td>Leader确认</td><td>中</td><td>较快</td></tr><tr><td><code>acks=all</code></td><td>所有ISR确认</td><td>高</td><td>稍慢</td></tr></tbody></table>
<h3 data-id="heading-12">流处理能力</h3>
<p>Kafka不仅是消息系统，还是流处理平台。<strong>Kafka Streams</strong>是一个轻量级库，适合实时处理，如事件聚合或异常检测。</p>
<p><strong>对比</strong>：Kafka Streams与Flink/Spark</p>






























<table><thead><tr><th>特性</th><th>Kafka Streams</th><th>Flink/Spark</th></tr></thead><tbody><tr><td><strong>部署方式</strong></td><td>库（嵌入应用）</td><td>集群部署</td></tr><tr><td><strong>延迟</strong></td><td>亚秒级</td><td>秒级</td></tr><tr><td><strong>复杂度</strong></td><td>API简单</td><td>学习曲线陡</td></tr><tr><td><strong>适用场景</strong></td><td>流连接、聚合</td><td>复杂ETL、机器学习</td></tr></tbody></table>
<h3 data-id="heading-13">示例场景</h3>
<ul>
<li><strong>日志收集</strong>：Kafka的高吞吐量轻松处理每日TB级的日志数据，输送至Elasticsearch进行分析。例如，某媒体公司用Kafka实时收集用户点击日志，优化内容推荐。</li>
<li><strong>实时数据管道</strong>：在ETL流程中，Kafka作为数据源（如数据库）与目标（如数据仓库）间的缓冲，确保数据流畅可靠。</li>
</ul>
<hr/>
<h3 data-id="heading-14">过渡</h3>
<p>理论固然重要，但在生产环境中，Kafka的真正价值通过实战展现。接下来，我将分享在电商和分析项目中积累的经验，带你优化生产者、消费者和集群。</p>
<hr/>
<h2 data-id="heading-15">4. 项目实战经验与最佳实践</h2>
<p>基于我在电商订单系统和实时分析平台中使用Kafka的经验，以下是如何在实际项目中优化Kafka的技巧。</p>
<h3 data-id="heading-16">生产者优化</h3>
<p>生产者是数据的入口，优化它们对性能至关重要：</p>
<ul>
<li><strong>批量与异步发送</strong>：批量发送减少网络请求，异步模式提升应用响应速度。</li>
<li><strong>ACK与重试调优</strong>：设置<code>acks=1</code>平衡可靠性和性能，合理配置重试次数应对短暂故障。</li>
</ul>
<p><strong>示例代码</strong>：优化生产者</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;
<span class="hljs-keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedProducer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"bootstrap.servers"</span>, <span class="hljs-string">"localhost:9092"</span>);
        props.put(<span class="hljs-string">"key.serializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringSerializer"</span>);
        props.put(<span class="hljs-string">"value.serializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringSerializer"</span>);
        <span class="hljs-comment">// 优化配置</span>
        props.put(<span class="hljs-string">"acks"</span>, <span class="hljs-string">"1"</span>); <span class="hljs-comment">// 仅Leader确认</span>
        props.put(<span class="hljs-string">"retries"</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// 重试3次</span>
        props.put(<span class="hljs-string">"batch.size"</span>, <span class="hljs-number">16384</span>); <span class="hljs-comment">// 16KB批次</span>
        props.put(<span class="hljs-string">"linger.ms"</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// 等待5ms凑批次</span>
        props.put(<span class="hljs-string">"buffer.memory"</span>, <span class="hljs-number">33554432</span>); <span class="hljs-comment">// 32MB缓冲区</span>

        <span class="hljs-keyword">try</span> (KafkaProducer&lt;String, String&gt; producer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaProducer</span>&lt;&gt;(props)) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                producer.send(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProducerRecord</span>&lt;&gt;(<span class="hljs-string">"orders"</span>, <span class="hljs-string">"order-"</span> + i, <span class="hljs-string">"Details-"</span> + i));
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-17">消费者优化</h3>
<p>消费者需要精心调优以避免瓶颈：</p>
<ul>
<li><strong>消费者组管理</strong>：利用消费者组实现水平扩展，监控重平衡以减少延迟。</li>
<li><strong>手动提交偏移量</strong>：在消息处理后再提交偏移量，避免故障导致重复消费。</li>
</ul>
<p><strong>示例代码</strong>：可靠消费者</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;
<span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;
<span class="hljs-keyword">import</span> java.time.Duration;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReliableConsumer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"bootstrap.servers"</span>, <span class="hljs-string">"localhost:9092"</span>);
        props.put(<span class="hljs-string">"group.id"</span>, <span class="hljs-string">"order-group"</span>);
        props.put(<span class="hljs-string">"enable.auto.commit"</span>, <span class="hljs-string">"false"</span>); <span class="hljs-comment">// 手动提交</span>
        props.put(<span class="hljs-string">"key.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);
        props.put(<span class="hljs-string">"value.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);

        <span class="hljs-keyword">try</span> (KafkaConsumer&lt;String, String&gt; consumer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaConsumer</span>&lt;&gt;(props)) {
            consumer.subscribe(Collections.singletonList(<span class="hljs-string">"orders"</span>));
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="hljs-number">100</span>));
                records.forEach(record -&gt; {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">// 模拟业务处理</span>
                        System.out.println(<span class="hljs-string">"处理: "</span> + record.value());
                        <span class="hljs-comment">// 手动提交偏移量</span>
                        consumer.commitSync();
                    } <span class="hljs-keyword">catch</span> (Exception e) {
                        System.err.println(<span class="hljs-string">"处理错误: "</span> + e.getMessage());
                    }
                });
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-18">集群管理</h3>
<p>生产环境的Kafka需要持续监控和规划：</p>
<ul>
<li><strong>监控运维</strong>：跟踪<strong>消费者滞后（Lag）</strong>、吞吐量和Broker健康状况，使用工具如<strong>Kafka Manager</strong>或<strong>Burrow</strong>。</li>
<li><strong>容量规划</strong>：根据吞吐量（例如每分区1MB/s）和保留策略估算Broker和分区需求。</li>
</ul>
<h3 data-id="heading-19">最佳实践</h3>
<ul>
<li><strong>主题设计</strong>：根据吞吐量需求选择分区数（例如10MB/s用10个分区），副本数至少设为3以确保高可用。</li>
<li><strong>消息格式</strong>：推荐使用<strong>Avro</strong>结合Schema Registry（如Confluent提供），确保类型安全和 schema 演化。</li>
<li><strong>性能调优</strong>：调整<code>num.io.threads</code>和<code>compression.type</code>（如<code>snappy</code>）优化CPU和带宽使用。</li>
</ul>
<h3 data-id="heading-20">实际应用场景</h3>
<ul>
<li><strong>案例1：电商订单系统</strong>：Kafka传输订单事件（如<code>place-order</code>、<code>update-inventory</code>），通过<code>acks=all</code>确保低延迟和高可靠。</li>
<li><strong>案例2：实时推荐系统</strong>：用户行为数据（如点击）通过Kafka收集，Kafka Streams处理后送至机器学习模型，生成个性化推荐。</li>
</ul>
<hr/>
<h3 data-id="heading-21">过渡</h3>
<p>即使有最佳实践，Kafka部署仍可能遇到问题。接下来，我将分享常见坑点和解决方案，帮助你打造稳健的系统。</p>
<hr/>
<h2 data-id="heading-22">5. 踩坑经验与问题解决</h2>
<h3 data-id="heading-23">常见问题</h3>
<p>Kafka功能强大，但复杂性也带来挑战。以下是常见问题及应对：</p>
<ul>
<li><strong>消费者滞后堆积</strong>：原因可能是消费者处理慢或分区不足。<strong>解决</strong>：增加分区、扩展消费者或优化处理逻辑。</li>
<li><strong>消息丢失/重复消费</strong>：<code>acks=0</code>或过早提交偏移量可能导致丢失；重试或错误提交引发重复。<strong>解决</strong>：用<code>acks=all</code>和手动提交。</li>
<li><strong>集群故障</strong>：Broker宕机或网络问题触发重平衡风暴。<strong>解决</strong>：确保副本同步，监控ISR健康。</li>
</ul>
<h3 data-id="heading-24">踩坑案例</h3>
<ul>
<li><strong>案例1：热点分区</strong>：键设计不当（例如用时间戳）导致消息集中到一个分区，造成负载不均。<strong>修复</strong>：使用均衡键（如用户ID），监控分区分布。</li>
<li><strong>案例2：重复消费</strong>：自动提交偏移量在处理前完成，故障时导致重复。<strong>修复</strong>：改为处理后手动提交。</li>
<li><strong>案例3：网络抖动</strong>：间歇性延迟导致消息延迟。<strong>修复</strong>：增加<code>request.timeout.ms</code>，调优<code>replication.factor</code>。</li>
</ul>
<h3 data-id="heading-25">解决方案</h3>
<ul>
<li><strong>日志与监控</strong>：使用<strong>Prometheus</strong>和<strong>Grafana</strong>可视化滞后和吞吐量，启用调试日志快速定位问题。</li>
<li><strong>配置优化</strong>：设置<code>min.insync.replicas=2</code>提升可靠性，调整<code>max.poll.records</code>控制消费者负载。</li>
</ul>
<p><strong>示例代码</strong>：健壮消费者带重试</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;
<span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;
<span class="hljs-keyword">import</span> java.time.Duration;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RobustConsumer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"bootstrap.servers"</span>, <span class="hljs-string">"localhost:9092"</span>);
        props.put(<span class="hljs-string">"group.id"</span>, <span class="hljs-string">"robust-group"</span>);
        props.put(<span class="hljs-string">"enable.auto.commit"</span>, <span class="hljs-string">"false"</span>);
        props.put(<span class="hljs-string">"key.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);
        props.put(<span class="hljs-string">"value.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);

        <span class="hljs-keyword">try</span> (KafkaConsumer&lt;String, String&gt; consumer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaConsumer</span>&lt;&gt;(props)) {
            consumer.subscribe(Collections.singletonList(<span class="hljs-string">"events"</span>));
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="hljs-number">100</span>));
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> record : records) {
                    <span class="hljs-type">int</span> <span class="hljs-variable">retries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
                    <span class="hljs-keyword">while</span> (retries &gt; <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-comment">// 模拟业务处理</span>
                            processRecord(record.value());
                            consumer.commitSync();
                            <span class="hljs-keyword">break</span>;
                        } <span class="hljs-keyword">catch</span> (Exception e) {
                            retries--;
                            <span class="hljs-keyword">if</span> (retries == <span class="hljs-number">0</span>) {
                                System.err.println(<span class="hljs-string">"重试失败: "</span> + e.getMessage());
                            }
                            Thread.sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 退避重试</span>
                        }
                    }
                }
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRecord</span><span class="hljs-params">(String value)</span> {
        <span class="hljs-comment">// 模拟业务逻辑</span>
        System.out.println(<span class="hljs-string">"已处理: "</span> + value);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-26">过渡</h3>
<p>了解了Kafka的优势和坑点后，让我们总结它的核心价值，展望未来趋势，并给出学习建议。</p>
<hr/>
<h2 data-id="heading-27">6. 总结与展望</h2>
<p>Kafka是现代数据管道的支柱，助力系统轻松应对海量实时数据流。它在<strong>高吞吐量</strong>、<strong>持久化</strong>和<strong>流处理</strong>上的出色表现，使其成为电商、物联网等领域的核心组件。</p>
<p><strong>未来趋势</strong>：</p>
<ul>
<li><strong>云原生融合</strong>：Kafka与Kubernetes、Serverless结合更紧密，Strimzi等工具简化部署。</li>
<li><strong>生态扩展</strong>：<strong>Kafka Connect</strong>（数据集成）和<strong>KSQL</strong>（流查询）日益流行，减少自定义开发。</li>
<li><strong>AI与分析</strong>：Kafka在向机器学习管道提供实时数据方面作用凸显，连接事件流与预测模型。</li>
</ul>
<p><strong>个人心得</strong>：用了几年的Kafka，我依然为它在压力下的稳定性惊叹。建议从简单场景入手，熟悉基础后尝试Kafka Streams，逐步解锁更多可能。</p>
<p><strong>实践建议</strong>：</p>
<ol>
<li><strong>优先监控</strong>：用Grafana等工具尽早发现问题。</li>
<li><strong>测试故障</strong>：模拟Broker宕机，验证系统健壮性。</li>
<li><strong>探索生态</strong>：尝试Kafka Connect实现开箱即用的集成。</li>
</ol>
<p>Kafka是一场旅程——大胆尝试，持续学习，构建可扩展的分布式系统！</p>
<hr/>
<h2 data-id="heading-28">附录</h2>
<h3 data-id="heading-29">推荐资源</h3>
<ul>
<li><strong>官方文档</strong>：kafka.apache.org</li>
<li><strong>Confluent社区</strong>：confluent.io（教程、Schema Registry）</li>
<li><strong>书籍</strong>：《Kafka权威指南》（Neha Narkhede等）</li>
</ul>
<h3 data-id="heading-30">常见问题FAQ</h3>
<ul>
<li><strong>问：分区数该设多少？</strong><br/>
答：低吞吐量用1-2个分区/Broker，高负载用10-20个，避免过多分区增加开销。</li>
<li><strong>问：消费者为什么滞后？</strong><br/>
答：检查处理速度，增加消费者或分区。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[执行计划跑偏，你了解背后的根因吗？]]></title>    <link>https://juejin.cn/post/7600340964084596742</link>    <guid>https://juejin.cn/post/7600340964084596742</guid>    <pubDate>2026-01-29T07:19:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600340964084596742" data-draft-id="7600430748781641771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="执行计划跑偏，你了解背后的根因吗？"/> <meta itemprop="keywords" content="PostgreSQL,开源,数据库"/> <meta itemprop="datePublished" content="2026-01-29T07:19:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IvorySQL"/> <meta itemprop="url" content="https://juejin.cn/user/761327331579511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            执行计划跑偏，你了解背后的根因吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/761327331579511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IvorySQL
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T07:19:00.000Z" title="Thu Jan 29 2026 07:19:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>关于作者：</p>
<p>Nickyoung，数据库领域从业者。PostgreSQL ACE，IvorySQL 专家顾问委员会成员。</p>
<p>公众号“👉PostgreSQL 运维之道”。</p>
</blockquote>
<p>还在以最终 cost 来判断计划是否最优？那就大错特错了！！！本篇老杨和大家一起抽丝剥茧，从源码入手分析计划跑偏的原因。</p>
<h2 data-id="heading-0">问题现象</h2>
<p>一个简单查询运行 240s，从执行计划看耗时主要在 nestloop join，Outter 扫描了 2293 行，inner loop 扫描了 2293 次，耗时 103.1 * 2293 = 236408ms</p>
<pre><code class="hljs language-sql" lang="sql">test<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> explain analyze <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),zone_id <span class="hljs-keyword">from</span> instance_info <span class="hljs-keyword">where</span> instanceid <span class="hljs-keyword">in</span> (<span class="hljs-keyword">SELECT</span> instanceid
<span class="hljs-keyword">FROM</span>
    instance_info
wherevisible <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
GROUPBY
    instanceid
<span class="hljs-keyword">HAVING</span>
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> zone_id) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) andvisible <span class="hljs-operator">=</span> <span class="hljs-number">1</span>groupby zone_id;
                                                                   QUERY PLAN                                                                    
<span class="hljs-comment">-------------------------------------------------------------------------------------------------------------------------------------------------</span>
 GroupAggregate  (cost<span class="hljs-operator">=</span><span class="hljs-number">232.45</span>.<span class="hljs-number">.232</span><span class="hljs-number">.47</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> width<span class="hljs-operator">=</span><span class="hljs-number">12</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">244941.317</span>.<span class="hljs-number">.244942</span><span class="hljs-number">.725</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">4.00</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
   <span class="hljs-keyword">Group</span> Key: instance_info.zone_id
   Buffers: shared hit<span class="hljs-operator">=</span><span class="hljs-number">3</span>
   <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>  Sort  (cost<span class="hljs-operator">=</span><span class="hljs-number">232.45</span>.<span class="hljs-number">.232</span><span class="hljs-number">.45</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> width<span class="hljs-operator">=</span><span class="hljs-number">4</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">244940.890</span>.<span class="hljs-number">.244941</span><span class="hljs-number">.590</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">4588.00</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
         Sort Key: instance_info.zone_id
         Sort <span class="hljs-keyword">Method</span>: quicksort  Memory: <span class="hljs-number">193</span>kB
         Buffers: shared hit<span class="hljs-operator">=</span><span class="hljs-number">3</span>
         <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>  Nested Loop  (cost<span class="hljs-operator">=</span><span class="hljs-number">200.01</span>.<span class="hljs-number">.232</span><span class="hljs-number">.44</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> width<span class="hljs-operator">=</span><span class="hljs-number">4</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">124.292</span>.<span class="hljs-number">.244935</span><span class="hljs-number">.769</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">4588.00</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
               <span class="hljs-keyword">Join</span> <span class="hljs-keyword">Filter</span>: ((instance_info.instanceid)::text <span class="hljs-operator">=</span> (instance_info_1.instanceid)::text)
               <span class="hljs-keyword">Rows</span> Removed <span class="hljs-keyword">by</span> <span class="hljs-keyword">Join</span> <span class="hljs-keyword">Filter</span>: <span class="hljs-number">20185277</span>
               <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">Foreign</span> Scan  (cost<span class="hljs-operator">=</span><span class="hljs-number">100.01</span>.<span class="hljs-number">.116</span><span class="hljs-number">.12</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> width<span class="hljs-operator">=</span><span class="hljs-number">146</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">25.421</span>.<span class="hljs-number">.137</span><span class="hljs-number">.939</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">2293.00</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
                     Relations: Aggregate <span class="hljs-keyword">on</span> (instance_info instance_info_1)
               <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">Foreign</span> Scan <span class="hljs-keyword">on</span> instance_info  (cost<span class="hljs-operator">=</span><span class="hljs-number">100.00</span>.<span class="hljs-number">.116</span><span class="hljs-number">.30</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> width<span class="hljs-operator">=</span><span class="hljs-number">150</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">1.290</span>.<span class="hljs-number">.103</span><span class="hljs-number">.183</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">8805.00</span> loops<span class="hljs-operator">=</span><span class="hljs-number">2293</span>)
 Planning:
   Buffers: shared hit<span class="hljs-operator">=</span><span class="hljs-number">173</span>
 Planning <span class="hljs-type">Time</span>: <span class="hljs-number">1.516</span> ms
 Execution <span class="hljs-type">Time</span>: <span class="hljs-number">244953.762</span> ms
(<span class="hljs-number">17</span> <span class="hljs-keyword">rows</span>)

test<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>
</code></pre>
<p>一般遇到这种情况，肯定是尝试“关闭”nestloop 试试看，走了 Hashjoin 后执行耗时仅 287ms，性能提升快 1000 倍。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">test</span>=&gt; set enable_nestloop to<span class="hljs-literal">off</span><span class="hljs-comment">;</span>
SET
<span class="hljs-attr">test</span>=&gt; explain analyze select count(*),zone_id from instance_info where instanceid in (SELECT instanceid
FROM
    instance_info
<span class="hljs-attr">wherevisible</span> = <span class="hljs-number">1</span>
GROUPBY
    instanceid
HAVING
    COUNT(DISTINCT zone_id) &gt; 1) <span class="hljs-attr">andvisible</span> = <span class="hljs-number">1</span>groupby zone_id<span class="hljs-comment">;</span>
                                                                  QUERY PLAN                                                                  
----------------------------------------------------------------------------------------------------------------------------------------------
 GroupAggregate  (<span class="hljs-attr">cost</span>=<span class="hljs-number">232.44</span>..<span class="hljs-number">232.46</span> rows=<span class="hljs-number">1</span> width=<span class="hljs-number">12</span>) (actual time=<span class="hljs-number">273.475</span>..<span class="hljs-number">274.907</span> rows=<span class="hljs-number">4.00</span> loops=<span class="hljs-number">1</span>)
   Group Key: instance_info.zone_id
   Buffers: shared <span class="hljs-attr">hit</span>=<span class="hljs-number">3</span>
   -&gt;  Sort  (<span class="hljs-attr">cost</span>=<span class="hljs-number">232.44</span>..<span class="hljs-number">232.45</span> rows=<span class="hljs-number">1</span> width=<span class="hljs-number">4</span>) (actual time=<span class="hljs-number">273.006</span>..<span class="hljs-number">273.722</span> rows=<span class="hljs-number">4588.00</span> loops=<span class="hljs-number">1</span>)
         Sort Key: instance_info.zone_id
         Sort Method: quicksort  Memory: 193kB
         Buffers: shared <span class="hljs-attr">hit</span>=<span class="hljs-number">3</span>
         -&gt;  Hash Join  (<span class="hljs-attr">cost</span>=<span class="hljs-number">216.13</span>..<span class="hljs-number">232.43</span> rows=<span class="hljs-number">1</span> width=<span class="hljs-number">4</span>) (actual time=<span class="hljs-number">160.901</span>..<span class="hljs-number">271.843</span> rows=<span class="hljs-number">4588.00</span> loops=<span class="hljs-number">1</span>)
               Hash Cond: ((instance_info.instanceid)::<span class="hljs-attr">text</span> = (instance_info_1.instanceid)::text)
               -&gt;  Foreign Scan on instance_info  (<span class="hljs-attr">cost</span>=<span class="hljs-number">100.00</span>..<span class="hljs-number">116.30</span> rows=<span class="hljs-number">2</span> width=<span class="hljs-number">150</span>) (actual time=<span class="hljs-number">4.691</span>..<span class="hljs-number">109.722</span> rows=<span class="hljs-number">8805.00</span> loops=<span class="hljs-number">1</span>)
               -&gt;  Hash  (<span class="hljs-attr">cost</span>=<span class="hljs-number">116.12</span>..<span class="hljs-number">116.12</span> rows=<span class="hljs-number">1</span> width=<span class="hljs-number">146</span>) (actual time=<span class="hljs-number">156.185</span>..<span class="hljs-number">156.186</span> rows=<span class="hljs-number">2293.00</span> loops=<span class="hljs-number">1</span>)
                     Buckets: 4096 (originally 1024)  Batches: 1 (originally 1)  Memory Usage: 144kB
                     -&gt;  Foreign Scan  (<span class="hljs-attr">cost</span>=<span class="hljs-number">100.01</span>..<span class="hljs-number">116.12</span> rows=<span class="hljs-number">1</span> width=<span class="hljs-number">146</span>) (actual time=<span class="hljs-number">21.939</span>..<span class="hljs-number">155.037</span> rows=<span class="hljs-number">2293.00</span> loops=<span class="hljs-number">1</span>)
                           Relations: Aggregate on (instance_info instance_info_1)
 Planning Time: 0.242 ms
 Execution Time: 287.414 ms
(16 rows)

<span class="hljs-attr">test</span>=&gt; 
</code></pre>
<p>为什么优化器走了效率更差的 nested loop？</p>
<p>统计信息不准？优化器代价计算偏差？</p>
<h2 data-id="heading-1">问题分析</h2>
<p>从 nestloop 和 Hashjoin 对应 path 的最终 cost 来看</p>
<p>GroupAggregate  (cost=232.45..232.47）</p>
<p>GroupAggregate  (cost=232.44..232.46)</p>
<p>后者对应 path 最终的 startup_cost 和 total_cost 都要小，为什么优化器没有选择 Hashjoin 这条路径？</p>
<p>所以这里会有一个误区：老杨也曾以为优化器选择最优执行计划，肯定是生成每种路径后，比较最终的 cost，最终 cost 最小的为最优计划。</p>
<p>事实上在 add_path 生成路径的过程中，每个节点都会进行 cost 比较，可能采用 new_path，或者保留 old_path，或者都保留。比如说在生成 Joinpath 时，可能只保留了一种 JoinMethod 进入下一计划节点，生成最终执行计划。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4728c512ba0a4b749093f7e654bbd4ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=j32UdIfzHmtVp1jlu9dQWctHw2I%3D" alt="01.png" loading="lazy"/></p>
<p>那么这个案例中有没有可能是 Hashjoin 在 Joinpath 环节被“淘汰了”？</p>
<p>Nested Loop  (cost=200.01..232.44 rows=1 width=4)</p>
<p>Hash Join  (cost=216.13..232.43 rows=1 width=4)</p>
<p>从 cost 来看，两种路径的 cost 比较接近，由于之前研究过这里，我已经大概猜到问题的原因了。</p>
<p>在 add_path 生成路径时，首先使用模糊 cost 比较来决定路径的去留。</p>
<p>cost 模糊比较函数为<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpostgres%2Fpostgres%2Fblob%2FREL_18_0%2Fsrc%2Fbackend%2Foptimizer%2Futil%2Fpathnode.c%23L185" title="https://github.com/postgres/postgres/blob/REL_18_0/src/backend/optimizer/util/pathnode.c#L185" target="_blank" ref="nofollow noopener noreferrer">compare_path_costs_fuzzily</a>
[1]
：</p>
<p>path1 即 new_path 为 HashPath，path2 即 old_path 为 NestPath。</p>
<ul>
<li><strong>首先比较两条路径的 disabled_nodes</strong>。</li>
</ul>
<p>enable_nestloop 和 enable_hashjoin 均为 on，所以 disabled_nodes 均为 0。</p>
<ul>
<li>
<p><strong>若未果，再比较 total_cost，并通过模糊系数将路径 cost 提升 1%，和另外一条路径比较</strong>。</p>
<p>232.43 &gt; 232.44 _ 1.01 和 232.44 &gt; 232.43 _ 1.01 均不成立，total_cost 模糊近似。</p>
</li>
<li>
<p><strong>若未果，再比较 startup_cost，并通过模糊系数将路径 cost 提升 1%，和另外一条路径比较</strong>。</p>
<p>216.13 &gt; 200.01 * 1.01 所以返回 COSTS_BETTER2。</p>
</li>
</ul>
<p>经过比较确定两条路径中更优路径为 NestPath。 那么 HashPath 就被淘汰了，然后进行后续 SORT 和 AGG 节点的 path 生成。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">static</span> PathCostComparison
<span class="hljs-title function_ invoke__">compare_path_costs_fuzzily</span>(Path *path1, Path *path2, double fuzz_factor)
{
#define <span class="hljs-title function_ invoke__">CONSIDER_PATH_STARTUP_COST</span>(p)  \
 ((p)<span class="hljs-punctuation">-&gt;</span>param_info == NULL ? (p)<span class="hljs-punctuation">-&gt;</span>parent<span class="hljs-punctuation">-&gt;</span>consider_startup : (p)<span class="hljs-punctuation">-&gt;</span>parent<span class="hljs-punctuation">-&gt;</span>consider_param_startup)

<span class="hljs-comment">/* Number of disabled nodes, if different, trumps all else. */</span>
<span class="hljs-title function_ invoke__">if</span> (<span class="hljs-title function_ invoke__">unlikely</span>(path1<span class="hljs-punctuation">-&gt;</span>disabled_nodes != path2<span class="hljs-punctuation">-&gt;</span>disabled_nodes))
 {
<span class="hljs-title function_ invoke__">if</span> (path1<span class="hljs-punctuation">-&gt;</span>disabled_nodes &lt; path2<span class="hljs-punctuation">-&gt;</span>disabled_nodes)
   <span class="hljs-keyword">return</span> COSTS_BETTER1;
<span class="hljs-keyword">else</span>
   <span class="hljs-keyword">return</span> COSTS_BETTER2;
 }

<span class="hljs-comment">/*
  * Check total cost first since it's more likely to be different; many
  * paths have zero startup cost.
  */</span>
<span class="hljs-title function_ invoke__">if</span> (path1<span class="hljs-punctuation">-&gt;</span>total_cost &gt; path2<span class="hljs-punctuation">-&gt;</span>total_cost * fuzz_factor)
 {
<span class="hljs-comment">/* path1 fuzzily worse on total cost */</span>
<span class="hljs-title function_ invoke__">if</span> (<span class="hljs-title function_ invoke__">CONSIDER_PATH_STARTUP_COST</span>(path1) &amp;&amp;
   path2<span class="hljs-punctuation">-&gt;</span>startup_cost &gt; path1<span class="hljs-punctuation">-&gt;</span>startup_cost * fuzz_factor)
  {
   <span class="hljs-comment">/* ... but path2 fuzzily worse on startup, so DIFFERENT */</span>
   <span class="hljs-keyword">return</span> COSTS_DIFFERENT;
  }
<span class="hljs-comment">/* else path2 dominates */</span>
<span class="hljs-keyword">return</span> COSTS_BETTER2;
 }
<span class="hljs-title function_ invoke__">if</span> (path2<span class="hljs-punctuation">-&gt;</span>total_cost &gt; path1<span class="hljs-punctuation">-&gt;</span>total_cost * fuzz_factor)
 {
<span class="hljs-comment">/* path2 fuzzily worse on total cost */</span>
<span class="hljs-title function_ invoke__">if</span> (<span class="hljs-title function_ invoke__">CONSIDER_PATH_STARTUP_COST</span>(path2) &amp;&amp;
   path1<span class="hljs-punctuation">-&gt;</span>startup_cost &gt; path2<span class="hljs-punctuation">-&gt;</span>startup_cost * fuzz_factor)
  {
   <span class="hljs-comment">/* ... but path1 fuzzily worse on startup, so DIFFERENT */</span>
   <span class="hljs-keyword">return</span> COSTS_DIFFERENT;
  }
<span class="hljs-comment">/* else path1 dominates */</span>
<span class="hljs-keyword">return</span> COSTS_BETTER1;
 }
<span class="hljs-comment">/* fuzzily the same on total cost ... */</span>
<span class="hljs-title function_ invoke__">if</span> (path1<span class="hljs-punctuation">-&gt;</span>startup_cost &gt; path2<span class="hljs-punctuation">-&gt;</span>startup_cost * fuzz_factor)
 {
<span class="hljs-comment">/* ... but path1 fuzzily worse on startup, so path2 wins */</span>
<span class="hljs-keyword">return</span> COSTS_BETTER2;
 }
<span class="hljs-title function_ invoke__">if</span> (path2<span class="hljs-punctuation">-&gt;</span>startup_cost &gt; path1<span class="hljs-punctuation">-&gt;</span>startup_cost * fuzz_factor)
 {
<span class="hljs-comment">/* ... but path2 fuzzily worse on startup, so path1 wins */</span>
<span class="hljs-keyword">return</span> COSTS_BETTER1;
 }
<span class="hljs-comment">/* fuzzily the same on both costs */</span>
<span class="hljs-keyword">return</span> COSTS_EQUAL;

#undef CONSIDER_PATH_STARTUP_COST
}
</code></pre>
<p><strong>debug 做下验证：</strong></p>
<p>在生成 Joinpath 时，依次生成 MergePath、NestPath、HashPath 并进行 cost 模糊比较。</p>
<p>这里省去 MergePath 和 NestPath 的比较过程，NestPath 胜出。</p>
<p>当生成 HashPath 后，和 NestPath 比较 Total_cost 差异并未达到 1%。而进一步比较 startup_cost，明显差异大于 1%所以返回 COSTS_BETTER2，即 NestPath 胜出。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7443200633b4a21be0d517f218be3c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=hJVzPv3TJfGQOVq%2Bm7PIs2kKmSE%3D" alt="02.png" loading="lazy"/></p>
<p>case COSTS_BETTER2：当前满足 outercmp == BMS_EQUAL 等条件，将 accept_new 置为 false.</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a256a3c5c414b4880d03201ca35b280~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=GaT4cc9FswIrHqh4hVpdS%2BFHDRA%3D" alt="03.png" loading="lazy"/></p>
<p>accept_new 为 false，所以拒绝并且回收了 new_path，也就是 HashPath 被淘汰了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3751ee09745f4e909d442f330bafe277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=OM3pS9wlkwU3Fun9jZjyiJt2E9I%3D" alt="04.png" loading="lazy"/></p>
<p>经过 cost 精确比较，角逐出 cheapest_total_cost 和 cheapest_startup_cost 都为 NestPath。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d57cfd17a19e4e9386a014cf4930d7e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=zLSLKyW0ll%2F1pSdGNtD0Fd0PpUU%3D" alt="05.png" loading="lazy"/></p>
<p>最终，使用 best_path 去生成执行计划。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d201c3a08d38450e852cfac3cd57ff1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=2bgIDJ4U%2BzAPDg57mFX9aKtLERg%3D" alt="06.png" loading="lazy"/></p>
<p>到这里，<strong>大家已经感觉到这个 cost 模糊比较有坑了吧，特别当两条路径的 cost 差别比较小，total_cost 或者 startup_cost 差别小于 1%时，可能会导致选错路径，最终生成了一个次优计划。</strong></p>
<p>STD_FUZZ_FACTOR 默认就是 1.01，是不是可以把它调整得更小，这样就能更精准？但得慎重，这里也是优化器最核心的部分，弄不好真是牵一发则动全身。我觉得这个模糊比较目前看起来不太优雅，甚至后续版本有可能去除这里的逻辑，当然各位有想法的话可以发到社区和 Tom Lane 一众大佬 solo 下。</p>
<p>当然不能指望优化器一直都是最正确的，这是违背现实的，我之前也写了很多篇文章，多次分享相关的内容。</p>
<p>ok，那么为什么这个 case 走了不优计划，大家应该都清楚了。可能已经有朋友看出来还有点小问题，Foreign table 预估扫描 1 行，实际扫描了 2000+行，肯定是统计信息不准啊？</p>
<p>大家思考下 Foreign table 有统计信息吗？</p>
<p>sure，篇幅问题，我简述下原理：Foreign table 只是表映射，没有物理元组，它的统计信息，是通过 fdw 访问目的端表进行采集的。 但是只能手动挡，因为 Foreign table 没法进行 vacuum/autovacuum，需要手动 analyze 触发。</p>
<p>示例的表我做了下 analyze，更新了下统计信息，各种 path 的 cost 差异比较大，默认走了 Hashjoin。</p>
<p>因此，一定要定时收集外表统计信息，不然可能会拖垮整个实例。</p>
<h2 data-id="heading-2">小结</h2>
<p>本篇我们分析了一例执行计划跑偏的根本原因，从中看得到当路径间的 cost 接近时（1%以下），可能在 add_path 时 cost 模糊比较中会选择次优路径，生成不优计划。</p>
<p>当然遇到这样的场景可以尝试各种 hint 手段去干预，不过可以考虑利用强化学习来实现自动化的 hint 干预，让数据库自动管理执行计划。我在之前的文章《AI4DB 试玩-Bao/Balsa 适配 PG18》中研究过类似的模型，并在 PCC2025 大会中做了分享。</p>
<p>当然专业的事要专业的人来做，我们的好友崔鹏博士已有相关的 AI4DB 课题研究和落地，将会在 HOW2026 大会中与大家见面，敬请期待。</p>
<hr/>
<h2 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Fjsj.top%2Ff%2FuebqBc" target="_blank" title="https://jsj.top/f/uebqBc" ref="nofollow noopener noreferrer">HOW 2026 议题招募中</a></h2>
<p>2026 年 4 月 27-28 日，由 IvorySQL 社区联合 PGEU（欧洲 PG 社区）、PGAsia（亚洲 PG 社区）共同打造的 HOW 2026（IvorySQL &amp; PostgreSQL 技术峰会） 将再度落地济南。届时，PostgreSQL 联合创始人 Bruce Momjian 等顶级大师将亲临现场。</p>
<p>自开启征集以来，HOW 2026 筹备组已感受到来自全球 PostgreSQL 爱好者的澎湃热情。为了确保大会议题的深度与广度，我们诚邀您在 2026 年 2 月 27 日截止日期前，提交您的技术见解。</p>
<p>投递链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjsj.top%2Ff%2FuebqBc" target="_blank" title="https://jsj.top/f/uebqBc" ref="nofollow noopener noreferrer">jsj.top/f/uebqBc</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[什么是 Java 反射机制？为什么反射慢？]]></title>    <link>https://juejin.cn/post/7600681071714811904</link>    <guid>https://juejin.cn/post/7600681071714811904</guid>    <pubDate>2026-01-30T03:59:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600681071714811904" data-draft-id="7600681071714795520" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="什么是 Java 反射机制？为什么反射慢？"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2026-01-30T03:59:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Vin_evail"/> <meta itemprop="url" content="https://juejin.cn/user/3974048659038618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            什么是 Java 反射机制？为什么反射慢？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3974048659038618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Vin_evail
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:59:13.000Z" title="Fri Jan 30 2026 03:59:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是 Java 反射机制？为什么反射慢？</h2>
<p>2026年01月30日</p>
<h3 data-id="heading-1">面试考察点</h3>
<p>当面试官询问 “什么是 Java 反射机制？为什么反射慢？” 时，他不仅仅是在考察一个简单的概念，其核心意图通常包括以下几点：</p>
<ol>
<li><strong>对 Java 语言核心机制的理解深度</strong>：面试官想确认你是否理解 Java 运行时类型信息（RTTI）的实现方式之一，能否清晰阐述反射的基本概念和作用。</li>
<li><strong>探究技术原理的洞察力</strong>：面试官不仅仅是想知道反射“慢”，更是想知道<strong>你为什么知道它慢</strong>，即你是否了解其性能开销的具体来源和 JVM 层面的底层原因。</li>
<li><strong>工程实践中的权衡能力</strong>：通过询问“为什么慢”，间接考察你是否在实际开发中具备性能意识，能否在 “灵活性” 和 “性能” 之间做出合理取舍。</li>
<li><strong>对框架原理的理解基础</strong>：反射是众多主流框架（如 Spring、MyBatis）的基石。理解反射有助于理解这些框架是如何工作的。</li>
</ol>
<h3 data-id="heading-2">核心答案</h3>
<p>Java 反射机制是指在程序<strong>运行状态</strong>中，对于任意一个类，都能够动态地获取其属性和方法等信息（即 <code>Class</code> 对象），并能够动态地调用其方法、操作其属性。这种 “动态性” 使得我们可以在编译期未知具体类的情况下，运行期进行探索和操作。</p>
<p>反射之所以 “慢”，主要原因在于：</p>
<ol>
<li><strong>JVM 无法优化</strong>：反射调用阻碍了 JVM 的许多编译时和运行时优化，如方法内联。</li>
<li><strong>安全检查开销</strong>：每次反射操作都需要进行严格的权限和安全检查（如 <code>AccessibleObject.setAccessible(true)</code> 可以绕过，但需谨慎）。</li>
<li><strong>动态解析</strong>：方法名、参数类型等信息需要在运行时解析，而非编译时确定。</li>
<li><strong>参数装箱与拆箱</strong>：反射调用方法时，参数需要以 <code>Object</code> 数组传递，涉及频繁的装箱/拆箱和数组创建。</li>
</ol>
<h3 data-id="heading-3">深度解析</h3>
<h4 data-id="heading-4">原理/机制</h4>
<p>每个被 JVM 加载的类，在堆中都会有一个唯一的 <code>java.lang.Class</code> 对象。这个 <code>Class</code> 对象就像这个类的“蓝图”，包含了该类的所有结构信息：字段（<code>Field</code>）、方法（<code>Method</code>）、构造器（<code>Constructor</code>）、父类、接口等。反射 API（位于 <code>java.lang.reflect</code> 包）就是通过操作这个 <code>Class</code> 对象来“反推出”类的原始结构并与之交互。这是 Java 实现动态性的核心支持。</p>
<h4 data-id="heading-5"><strong>代码示例：反射 vs 正常调用</strong></h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> java.lang.reflect.Method;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectionDemo</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">normalCall</span><span class="hljs-params">(<span class="hljs-type">String</span> msg)</span> </span>{
        <span class="hljs-comment">// 编译时即可确定方法调用，JVM 可充分优化</span>
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"Normal: "</span> + msg);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">reflectionCall</span><span class="hljs-params">(<span class="hljs-type">String</span> msg)</span> throws Exception </span>{
        <span class="hljs-comment">// 运行时动态查找并调用方法</span>
        Class&lt;?&gt; clazz = ReflectionDemo.<span class="hljs-keyword">class</span>;
        Method method = clazz.<span class="hljs-built_in">getDeclaredMethod</span>(<span class="hljs-string">"normalCall"</span>, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>);
        method.<span class="hljs-built_in">invoke</span>(null, msg); <span class="hljs-comment">//  invoke 是可变参数，内部会封装成 Object[]</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> throws Exception </span>{
        <span class="hljs-type">long</span> start, end;
        <span class="hljs-type">int</span> times = <span class="hljs-number">1000000</span>;

        <span class="hljs-comment">// 1. 正常调用</span>
        start = System.<span class="hljs-built_in">currentTimeMillis</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; times; i++) {
            <span class="hljs-built_in">normalCall</span>(<span class="hljs-string">"Hello"</span>);
        }
        end = System.<span class="hljs-built_in">currentTimeMillis</span>();
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"正常调用耗时："</span> + (end - start) + <span class="hljs-string">" ms"</span>);

        <span class="hljs-comment">// 2. 反射调用（无缓存）</span>
        start = System.<span class="hljs-built_in">currentTimeMillis</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; times; i++) {
            <span class="hljs-built_in">reflectionCall</span>(<span class="hljs-string">"Hello"</span>);
        }
        end = System.<span class="hljs-built_in">currentTimeMillis</span>();
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"反射调用耗时："</span> + (end - start) + <span class="hljs-string">" ms"</span>);
    }
}
</code></pre>
<p>运行上述代码，你可以直观地看到性能差距（通常反射会慢一个数量级以上）。</p>
<h4 data-id="heading-6"><strong>为什么反射慢？深度拆解</strong></h4>
<ol>
<li>
<p><strong>方法内联失效</strong>：JIT 编译器的一个重要优化是<strong>方法内联</strong>。对于直接调用，JIT 可以判断热点方法并将其代码“内联”到调用处，消除调用开销。但 <code>Method.invoke</code> 是一个由本地方法实现的、通用且复杂的分发器，JIT 无法看到其背后的具体目标方法，因此无法进行内联。</p>
</li>
<li>
<p><strong>运行时解析与查找</strong>：每次 <code>getMethod</code> 和 <code>invoke</code> 都需要 JVM 在类的元数据中进行字符串匹配和查找，这是一个相对耗时的过程。尽管可以缓存 <code>Method</code> 对象来避免重复查找，但 <code>invoke</code> 本身的调用开销依然存在。</p>
</li>
<li>
<p><strong>本地方法调用与安全检查</strong>：<code>Method.invoke()</code> 的最终实现在本地代码（Native Code）中。每次调用都需要从 Java 层切换到本地层，这本身就有上下文切换开销。此外，默认情况下，它需要调用 <code>AccessibleObject.checkAccess</code> 方法进行可见性检查。</p>
</li>
<li>
<p><strong>参数处理的抽象成本</strong>：</p>
<ul>
<li><code>invoke</code> 接受一个 <code>Object...</code> 参数数组。这意味着所有基本类型参数都需要被<strong>装箱</strong>成 <code>Integer</code>、<code>Double</code> 等对象。</li>
<li>JVM 需要将传入的数组解包，并检查参数类型是否与方法签名匹配，然后将它们传递给真正的本地方法。</li>
<li>调用完成后，如果返回基本类型，还需要<strong>拆箱</strong>。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-7"><strong>最佳实践与常见误区</strong></h4>
<ul>
<li>
<p><strong>最佳实践</strong>：</p>
<ol>
<li><strong>缓存</strong>：这是最重要的优化手段。一旦通过反射获取到 <code>Class</code>、<code>Method</code>、<code>Field</code> 等对象，就应该将它们缓存起来，避免在循环或高频调用中重复查找。</li>
<li><strong>谨慎使用 <code>setAccessible(true)</code></strong> ：这可以关闭安全检查，带来显著的性能提升（在 JDK 8 及之前尤其明显）。但会破坏封装性，并可能带来安全隐患，仅在对性能有极致要求且明确知道后果的场景下使用。</li>
<li><strong>权衡使用</strong>：明确反射的使用场景，如框架开发、动态代理、注解处理器等。在普通的业务代码中，应优先使用直接的 API 调用。</li>
<li><strong>考虑替代方案</strong>：在 JDK 9+ 中，可以考虑 <code>java.lang.invoke</code> 包下的 <code>MethodHandle</code>，它在某些场景下性能优于反射，并得到了 JVM 更多的优化支持。</li>
</ol>
</li>
<li>
<p><strong>常见误区</strong>：</p>
<ul>
<li><strong>“反射一定不能用”</strong> ：不对。反射是强大的工具，许多基础框架离不开它。关键在于“正确使用”。</li>
<li><strong>“只要缓存了 <code>Method</code> 就不慢了”</strong> ：不准确。缓存只能消除查找开销，但 <code>invoke</code> 的调用开销、参数处理开销和优化阻碍依然存在，相比直接调用仍有显著差距。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>【总结】</strong></h3>
<p>Java 反射机制提供了强大的运行时动态能力，是许多框架的基石，但其性能代价主要源于 <strong>JVM 优化受阻、运行时的安全检查与解析、以及繁琐的参数处理过程</strong>；在实际开发中，应通过缓存 <code>Method</code> 等对象来优化，并严格限定其使用边界，在灵活性与性能之间做出明智权衡。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[智能巡检部署]]></title>    <link>https://juejin.cn/post/7600603245396082728</link>    <guid>https://juejin.cn/post/7600603245396082728</guid>    <pubDate>2026-01-29T10:11:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600603245396082728" data-draft-id="7600342201794560015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="智能巡检部署"/> <meta itemprop="keywords" content="Linux,Python"/> <meta itemprop="datePublished" content="2026-01-29T10:11:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恰饭小男孩"/> <meta itemprop="url" content="https://juejin.cn/user/1007625803672606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            智能巡检部署
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1007625803672606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恰饭小男孩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:11:54.000Z" title="Thu Jan 29 2026 10:11:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、背景介绍</h2>
<p>    哈喽啊，小饼好久没发文章了，个人原因最近工作比较繁忙，这段时间也换了新岗位。慢慢腾出一点时间去做巡检工作。</p>
<p>我突然发现一个个去巡检设备好麻烦，突然想到自己弄一个脚本去代替我人工，如果也有想和我一样偷懒的小伙伴，就去和我一样实践起来吧</p>
<h3 data-id="heading-1">1、环境准备</h3>
<blockquote>
<p>三台虚拟机，ansible服务器端+客户端+客户端。我们大部分操作都在服务端去执行</p>
</blockquote>
<h4 data-id="heading-2">1.1、安装ansible</h4>
<p>1、<code>yum install -y http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code>  ##添加ansible的yum源</p>
<p>2<code> yum install -y ansible</code> ##安装ansible</p>
<blockquote>
<p>这里给大家温习一下ansible的配置文件</p>
</blockquote>
<blockquote>
<p>1、默认配置文件:/etc/ansible/ansible.cfg，一般不用它</p>
<p>2，./ansible.cfg，当前工作路径下的配置文件，推荐。</p>
<p>3，~/.ansible.cfg，当前用户家目录下的配置文件(隐藏的）</p>
<p>4，/etc/ansible/ansible.cfg，默认配置文件</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e56f4d7070c48a9b1af9614a5c9fe93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=Auxcstsd40EdKm3LC76xVwJewXY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db6f4e14a498479b8414eaccd3eabed6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=do6%2Bn4yvJydL2RnqAON7r51jS4o%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">1.2、配置无密钥认证</h4>
<p><code>mkdir ./ansible</code>   ##此时我是在/root/ansible/
<code>ssh-keygen</code>    ##获取加密密钥</p>
<p><code>ssh-copy-id root@serverb</code>   ##分发给服务器</p>
<p><code>ssh-copy-id root@serverc</code>    ##分发给服务器</p>
<p><code>ssh-copy-id root@serverd</code>   ##分发给服务器</p>
<h4 data-id="heading-4">1.3、自定义配置文件</h4>
<blockquote>
<p>这里我建议大家配置ansible使用一个专用的ansible用户去配置。我是懒得不行，就用超级管理员去做了。大家用普通用户提权去做</p>
</blockquote>
<blockquote>
<p>#在工作路径，自定义配置文件
vi ./ansible.cfg</p>
</blockquote>
<p>[defaults]</p>
<p>inventory = ./inventory</p>
<p>[privilege_escalation]
become = true</p>
<p>become method =sudo</p>
<p>become user = root</p>
<p>become ask pass = true</p>
<h4 data-id="heading-5">1.4、自定义主机清单</h4>
<p><code>vim ./inventory</code></p>
<p><code>[work]</code></p>
<p><code>serverb</code></p>
<p><code>serverc</code></p>
<p><code>serverd</code></p>
<h5 data-id="heading-6">验证一下 ansible work --list-hosts</h5>
<blockquote>
<p>ansible work  -m ping</p>
</blockquote>
<h3 data-id="heading-7">2、在服务端配置巡检脚本 *****很重要！！！</h3>
<blockquote>
<p>将文件存放在/root/ansible中</p>
</blockquote>
<pre><code class="hljs language-#!/bin/bash" lang="#!/bin/bash"># ================ SysCheck 2.0 服务器运维巡检脚本 ================
#  作者：yy
# ===============================================================

# --- 基础配置 ---
# 自动检测终端颜色
if [ -t 1 ]; then
    RED="\033[91m"
    GREEN="\033[92m"
    YELLOW="\033[93m"
    BLUE="\033[94m"
    BOLD="\033[1m"
    NC="\033[0m"
else
    RED=""; GREEN=""; YELLOW=""; BLUE=""; BOLD=""; NC=""
fi

print_title() {
    echo -e "\n${BLUE}${BOLD}════════════════════════════════════════════════════════════${NC}"
    echo -e "${BOLD}                    $1${NC}"
    echo -e "${BLUE}${BOLD}════════════════════════════════════════════════════════════${NC}"
}

print_status() {
    case "$1" in
        ok) echo -e "${GREEN}  [OK] $2${NC}" ;;
        warn) echo -e "${YELLOW}  [WARN] $2${NC}" ;;
        error) echo -e "${RED}  [ERROR] $2${NC}" ;;
        info) echo -e "${BLUE}  [INFO] $2${NC}" ;;
        *) echo -e "  [$1] $2" ;;
    esac
}

# --- 生成报告文件 ---
generate_report() {
    local report_file="/tmp/syscheck_report_$(date +%Y%m%d_%H%M%S).txt"
    echo "=== SysCheck 巡检报告 ===" &gt; "$report_file"
    echo "生成时间: $(date '+%Y-%m-%d %H:%M:%S')" &gt;&gt; "$report_file"
    echo "主机名: $(hostname)" &gt;&gt; "$report_file"
    echo "IP地址: $(hostname -I 2&gt;/dev/null | awk '{print $1}')" &gt;&gt; "$report_file"
    echo "==================================" &gt;&gt; "$report_file"
}

# --- 1. 系统基础信息 ---
clear
print_title "Linux 服务器深度巡检 (SysCheck 2.0)"
echo -e "巡检时间：$(date '+%Y-%m-%d %H:%M:%S')"

[ -f /etc/os-release ] &amp;&amp; . /etc/os-release
OS_NAME="${PRETTY_NAME:-未知}"
HOSTNAME=$(hostname)
KERNEL=$(uname -r)
UPTIME=$(uptime)
LOAD_AVG=$(uptime | awk -F'load average:' '{print $2}' | sed 's/^[      ]*//')

print_status info "系统版本 : $OS_NAME"
print_status info "主机名称 : $HOSTNAME"
print_status info "内核版本 : $KERNEL"
print_status info "运行时间 : $(uptime -p)"
print_status info "平均负载 : $LOAD_AVG"

# --- 2. 资源使用情况 ---
print_title "资源使用情况"

# CPU使用率
CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
if [ $(echo "$CPU_USAGE &gt; 80" | bc 2&gt;/dev/null || echo "0") = "1" ]; then
    print_status error "CPU使用率: ${CPU_USAGE}% - 过高！"
elif [ $(echo "$CPU_USAGE &gt; 60" | bc 2&gt;/dev/null || echo "0") = "1" ]; then
    print_status warn "CPU使用率: ${CPU_USAGE}% - 偏高"
else
    print_status ok "CPU使用率: ${CPU_USAGE}%"
fi

# 内存
mem_info=$(free -m)
mem_total=$(echo "$mem_info" | awk '/Mem:/ {print $2}')
mem_used=$(echo "$mem_info" | awk '/Mem:/ {print $3}')
mem_free=$(echo "$mem_info" | awk '/Mem:/ {print $4}')
mem_usage=$(echo "scale=2; $mem_used*100/$mem_total" | bc 2&gt;/dev/null || echo "0")

if [ $(echo "$mem_usage &gt; 90" | bc 2&gt;/dev/null || echo "0") = "1" ]; then
    print_status error "内存使用: ${mem_usage}% (${mem_used}M/${mem_total}M) - 严重不足！"
elif [ $(echo "$mem_usage &gt; 80" | bc 2&gt;/dev/null || echo "0") = "1" ]; then
    print_status warn "内存使用: ${mem_usage}% (${mem_used}M/${mem_total}M) - 偏高"
else
    print_status ok "内存使用: ${mem_usage}% (${mem_used}M/${mem_total}M)"
fi

# 交换空间
swap_info=$(free -m | awk '/Swap:/')
if [ -n "$swap_info" ]; then
    swap_total=$(echo "$swap_info" | awk '{print $2}')
    swap_used=$(echo "$swap_info" | awk '{print $3}')
    if [ "$swap_total" -gt 0 ]; then
        swap_usage=$(echo "scale=2; $swap_used*100/$swap_total" | bc 2&gt;/dev/null || echo "0")
        if [ "$swap_used" -gt 0 ]; then
            print_status warn "交换空间使用: ${swap_usage}% (${swap_used}M/${swap_total}M)"
        fi
    fi
fi

# 磁盘检查
print_status info "磁盘使用情况:"
df -hT | grep -vE 'tmpfs|cdrom|loop|overlay|squashfs|udev|devtmpfs' | while read fs type size used avail use mount; do
    if [ -n "$use" ]; then
        usage_num=$(echo "$use" | tr -d '%')
        if [ "$usage_num" -ge 95 ]; then
            print_status error "  $mount ($use) - ${size}已用${used} - 空间严重不足！"
        elif [ "$usage_num" -ge 85 ]; then
            print_status warn "  $mount ($use) - ${size}已用${used} - 空间不足"
        elif [ "$usage_num" -ge 70 ]; then
            print_status info "  $mount ($use) - ${size}已用${used}"
        else
            print_status ok "  $mount ($use) - ${size}已用${used}"
        fi
    fi
done

# Inode检查
print_status info "Inode使用情况:"
df -i | grep -vE 'tmpfs|cdrom|loop|overlay|squashfs|udev|devtmpfs' | while read fs inodes iused ifree iuse mount; do
    if [ -n "$iuse" ] &amp;&amp; [ "$iuse" != "IUse%" ]; then
        iuse_num=$(echo "$iuse" | tr -d '%')
        if [ "$iuse_num" -ge 90 ]; then
            print_status error "  $mount ($iuse) - Inode接近耗尽！"
        elif [ "$iuse_num" -ge 80 ]; then
            print_status warn "  $mount ($iuse) - Inode使用较高"
        fi
    fi
done

# --- 3. 安全补丁检查 (修复增强版) ---
print_title "安全补丁与漏洞检查"

check_updates() {
    if command -v apt &gt;/dev/null 2&gt;&amp;1; then
        # Debian/Ubuntu 逻辑
        if updates=$(apt list --upgradable 2&gt;/dev/null | grep -v "Listing..."); then
            cnt=$(echo "$updates" | wc -l)
            if [ "$cnt" -gt 0 ]; then
                print_status warn "发现 $cnt 个可升级包"
                echo "$updates" | head -n 5 | while read line; do
                    echo "    $line"
                done
                [ "$cnt" -gt 5 ] &amp;&amp; echo "    ... (还有 $((cnt-5)) 个未显示)"
            else
                print_status ok "系统软件包已是最新"
            fi
        fi
    elif command -v dnf &gt;/dev/null 2&gt;&amp;1 || command -v yum &gt;/dev/null 2&gt;&amp;1; then
        # RHEL/CentOS/Rocky 逻辑
        PKG_MGR=$(command -v dnf || command -v yum)

        # 检查安全更新
        if $PKG_MGR check-update --security &gt;/dev/null 2&gt;&amp;1; then
            sec_count=$($PKG_MGR check-update --security 2&gt;/dev/null | grep -c "\.\.")
            if [ "$sec_count" -gt 0 ]; then
                print_status warn "发现 $sec_count 个安全补丁待安装！"
                $PKG_MGR check-update --security 2&gt;/dev/null | head -n 5
                [ "$sec_count" -gt 5 ] &amp;&amp; echo "    ... (还有 $((sec_count-5)) 个未显示)"
            else
                print_status ok "未发现严重安全补丁"
            fi
        else
            # 尝试其他方法
            if sec_info=$($PKG_MGR updateinfo list security 2&gt;/dev/null); then
                sec_count=$(echo "$sec_info" | grep -c "security" || echo 0)
                if [ "$sec_count" -gt 0 ]; then
                    print_status warn "发现 $sec_count 个安全补丁待安装！"
                    echo "$sec_info" | head -n 5
                else
                    print_status ok "未发现严重安全补丁"
                fi
            else
                print_status info "跳过安全检查：当前源不支持元数据查询或缺少插件"
            fi
        fi
    else
        print_status info "未知包管理器，跳过补丁检查"
    fi
}

check_updates

# --- 4. 服务状态检查 ---
print_title "关键服务状态检查"

check_service() {
    local service=$1
    local name=$2

    if systemctl list-unit-files | grep -q "^${service}.service"; then
        if systemctl is-active --quiet "$service"; then
            print_status ok "$name: 运行中"
        else
            print_status error "$name: 未运行"
        fi
    fi
}

# 检查常见服务
check_service "sshd" "SSH服务"
check_service "crond" "计划任务"
check_service "nginx" "Nginx"
check_service "httpd" "Apache"
check_service "mysqld" "MySQL"
check_service "postgresql" "PostgreSQL"
check_service "docker" "Docker"
check_service "firewalld" "防火墙"
check_service "iptables" "iptables"
check_service "fail2ban" "Fail2ban"

# --- 5. 异常检测 ---
print_title "异常进程检测"

# 高负载进程
echo -e "${BOLD}CPU 占用前五:${NC}"
ps -eo pid,user,%cpu,cmd --sort=-%cpu | head -n 6 | tail -n 5 | awk '{printf "  %-6s %-10s %-6s %s\n", $1, $2, $3, $4}'

echo -e "\n${BOLD}内存 占用前五:${NC}"
ps -eo pid,user,%mem,cmd --sort=-%mem | head -n 6 | tail -n 5 | awk '{printf "  %-6s %-10s %-6s %s\n", $1, $2, $3, $4}'

# 僵尸进程
zombies=$(ps aux | grep -E "[Zz]" | grep -v grep | wc -l)
if [ "$zombies" -gt 0 ]; then
    print_status error "发现 $zombies 个僵尸进程！"
    ps aux | grep -E "[Zz]" | grep -v grep
else
    print_status ok "无僵尸进程"
fi

# 检查异常连接
echo -e "\n${BOLD}异常网络连接检查:${NC}"
if command -v netstat &gt;/dev/null 2&gt;&amp;1; then
    suspicious=$(netstat -antp 2&gt;/dev/null | grep -E "LISTEN|ESTABLISHED" | grep -vE "127.0.0.1|::1|0.0.0.0" | head -n 10)
    if [ -n "$suspicious" ]; then
        print_status warn "发现异常网络连接:"
        echo "$suspicious" | head -n 5
    fi
fi

# --- 6. 登录和用户检查 ---
print_title "登录与用户检查"

# 当前登录用户
echo -e "${BOLD}当前登录用户:${NC}"
who | head -n 5

# 检查空密码用户
if [ -f /etc/shadow ]; then
    empty_pass=$(sudo awk -F: '($2 == "" || $2 == "!") {print $1}' /etc/shadow 2&gt;/dev/null || echo "")
    if [ -n "$empty_pass" ]; then
        print_status error "发现空密码用户: $empty_pass"
    fi
fi

# 检查root用户远程登录
if grep -q "^PermitRootLogin yes" /etc/ssh/sshd_config 2&gt;/dev/null; then
    print_status warn "SSH配置允许root远程登录"
fi

# --- 7. 系统日志检查 ---
print_title "系统日志检查"

# 检查最近错误日志
if [ -f /var/log/messages ]; then
    recent_errors=$(tail -n 20 /var/log/messages | grep -i "error\|fail\|critical" | head -n 5)
elif [ -f /var/log/syslog ]; then
    recent_errors=$(tail -n 20 /var/log/syslog | grep -i "error\|fail\|critical" | head -n 5)
fi

if [ -n "$recent_errors" ]; then
    print_status warn "最近系统日志错误:"
    echo "$recent_errors" | while read line; do
        echo "  $line"
    done
fi

# --- 8. 结束与建议 ---
print_title "巡检完成"
echo -e "${BOLD}巡检摘要:${NC}"
echo -e "  1. 系统资源使用情况已检查"
echo -e "  2. 安全补丁状态已评估"
echo -e "  3. 关键服务状态已验证"
echo -e "  4. 异常进程和连接已扫描"
echo -e "  5. 系统日志已检查"

echo -e "\n${BOLD}建议:${NC}"
echo -e "  • 定期清理 /var/log 目录日志"
echo -e "  • 监控磁盘使用率，及时清理无用文件"
echo -e "  • 及时安装安全补丁"
echo -e "  • 定期备份重要数据"
echo -e "  • 检查防火墙规则和SSH配置"

echo -e "\n${GREEN}巡检完成于: $(date '+%Y-%m-%d %H:%M:%S')${NC}"
echo -e "${BLUE}脚本版本: SysCheck 2.0${NC}"

</code></pre>
<h4 data-id="heading-8">效果图</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44f08002dff341dfab7c517bd5f37f70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=fTB1P%2BbRPRQoMHhx0UoYszhMVqk%3D" alt="微信图片_20260129184245.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/326177077f9747e79a02d8cb4cdcb401~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=ql9FAqWWnpjKynQakGZr1WM4sMY%3D" alt="微信图片_20260129184236.jpg" loading="lazy"/></p>
<h3 data-id="heading-9">3、使用python脚本去把生成巡检记录为excel文件</h3>
<blockquote>
<p>一般到了月巡检的时候，领导都会让我们形成一个文件去统计查看。我们运维人员肯定是可以去系统上看，但是把数据统计出来再放进表格还是有点麻烦。</p>
</blockquote>
<blockquote>
<p>现在不用担心了，小饼帮大家把这一步也节省了。现在来看看我下面的处理步骤吧</p>
</blockquote>
<h4 data-id="heading-10">3.1 安装python3环境</h4>
<p>1、<code>yum install epel</code>
2、<code>yum install  -y phthon3</code></p>
<h4 data-id="heading-11">3.2、编写python脚本</h4>
<p><code>vim syscheck-excel.py</code></p>
<pre><code class="hljs language-#!/usr/bin/env" lang="#!/usr/bin/env"># -*- coding: utf-8 -*-
# ==============================================================================
# 脚本名称: syscheck-excel.py (Pro版)
# 功能描述: 采集Linux系统信息、磁盘、Top进程，生成带样式的美观Excel报表
# 运行方式: chmod +x syscheck-excel.py &amp;&amp; ./syscheck-excel.py
# 依赖库  : pip3 install psutil pandas openpyxl
# 作者    :yy
# ==============================================================================

import os
import sys
import socket
import datetime
import platform
import subprocess

# 依赖库检查
try:
    import psutil
    import pandas as pd
    from openpyxl import Workbook
    from openpyxl.styles import Font, PatternFill, Border, Side, Alignment
    from openpyxl.utils import get_column_letter
except ImportError as e:
    print("[Error] 缺少必要模块:", e)
    print("请先执行安装: pip3 install psutil pandas openpyxl")
    sys.exit(1)

def get_size(bytes_num, suffix="B"):
    """人性化显示文件大小"""
    factor = 1024
    for unit in ["", "K", "M", "G", "T", "P"]:
        if bytes_num &lt; factor:
            return f"{bytes_num:.2f}{unit}{suffix}"
        bytes_num /= factor
    return f"{bytes_num:.2f}EB"

def get_process_info():
    """获取CPU和内存占用最高的Top 10进程"""
    procs = []
    for p in psutil.process_iter(['pid', 'name', 'username', 'cpu_percent', 'memory_percent']):
        try:
            procs.append(p.info)
        except (psutil.NoSuchProcess, psutil.AccessDenied, psutil.ZombieProcess):
            pass
    
    # 转为DataFrame
    if procs:
        df_proc = pd.DataFrame(procs)
        if not df_proc.empty:
            # 按内存使用率排序取Top 10
            df_proc = df_proc.sort_values(by='memory_percent', ascending=False).head(10)
            df_proc['cpu_percent'] = df_proc['cpu_percent'].apply(lambda x: f"{x:.1f}%" if x else "0.0%")
            df_proc['memory_percent'] = df_proc['memory_percent'].apply(lambda x: f"{x:.1f}%" if x else "0.0%")
            df_proc.columns = ['PID', 'Process', 'User', 'CPU%', 'Memory%']
            return df_proc
    return pd.DataFrame()

def get_system_info():
    """获取详细的系统信息"""
    info = {}
    
    # 基本系统信息
    uname = platform.uname()
    info['System'] = uname.system
    info['Hostname'] = uname.node
    info['Release'] = uname.release
    info['Version'] = uname.version
    info['Machine'] = uname.machine
    info['Processor'] = uname.processor
    
    # 获取发行版详细信息
    if os.path.exists('/etc/os-release'):
        with open('/etc/os-release', 'r') as f:
            for line in f:
                if 'PRETTY_NAME' in line:
                    info['OS Name'] = line.split('=', 1)[1].strip().strip('"')
                    break
    
    # CPU信息
    info['CPU Cores (Logical)'] = psutil.cpu_count(logical=True)
    info['CPU Cores (Physical)'] = psutil.cpu_count(logical=False)
    
    # 内存信息
    mem = psutil.virtual_memory()
    info['Total Memory'] = get_size(mem.total)
    info['Available Memory'] = get_size(mem.available)
    info['Memory Usage %'] = f"{mem.percent}%"
    
    # 启动时间
    boot_time = datetime.datetime.fromtimestamp(psutil.boot_time())
    info['Boot Time'] = boot_time.strftime("%Y-%m-%d %H:%M:%S")
    
    # 运行时间
    uptime = datetime.datetime.now() - boot_time
    days = uptime.days
    hours, remainder = divmod(uptime.seconds, 3600)
    minutes, seconds = divmod(remainder, 60)
    info['Uptime'] = f"{days}d {hours}h {minutes}m {seconds}s"
    
    # 负载
    if hasattr(os, 'getloadavg'):
        load = os.getloadavg()
        info['Load 1min'] = f"{load[0]:.2f}"
        info['Load 5min'] = f"{load[1]:.2f}"
        info['Load 15min'] = f"{load[2]:.2f}"
    
    # CPU使用率
    cpu_percent = psutil.cpu_percent(interval=1)
    info['CPU Usage %'] = f"{cpu_percent}%"
    
    return info

def get_network_info():
    """获取网络信息"""
    network_info = {}
    
    try:
        # 获取IP地址
        hostname = socket.gethostname()
        try:
            ip_address = socket.gethostbyname(hostname)
        except:
            ip_address = "Unknown"
        
        network_info['Hostname'] = hostname
        network_info['IP Address'] = ip_address
        
        # 网络接口信息
        interfaces = []
        for interface, addrs in psutil.net_if_addrs().items():
            for addr in addrs:
                if addr.family == socket.AF_INET:  # IPv4
                    interfaces.append({
                        'Interface': interface,
                        'Address': addr.address,
                        'Netmask': addr.netmask
                    })
        
        network_info['Interfaces'] = interfaces
        
        # IO统计
        net_io = psutil.net_io_counters()
        network_info['Bytes Sent'] = get_size(net_io.bytes_sent)
        network_info['Bytes Received'] = get_size(net_io.bytes_recv)
        
    except Exception as e:
        network_info['Error'] = f"获取网络信息失败: {str(e)}"
    
    return network_info

def get_disk_info():
    """获取磁盘信息"""
    disk_list = []
    
    try:
        for partition in psutil.disk_partitions():
            # 跳过特殊文件系统
            skip = False
            for skip_str in ['loop', 'snap', 'docker', 'overlay', 'tmpfs']:
                if skip_str in partition.device.lower() or skip_str in partition.mountpoint.lower():
                    skip = True
                    break
            
            if skip:
                continue
            
            try:
                usage = psutil.disk_usage(partition.mountpoint)
                disk_list.append({
                    'Device': partition.device,
                    'Mount Point': partition.mountpoint,
                    'File System': partition.fstype,
                    'Total Size': get_size(usage.total),
                    'Used': get_size(usage.used),
                    'Free': get_size(usage.free),
                    'Usage %': f"{usage.percent}%",
                    'Percent': usage.percent
                })
            except (PermissionError, OSError):
                continue
        
        # 按使用率排序
        if disk_list:
            disk_list.sort(key=lambda x: x['Percent'], reverse=True)
            
    except Exception as e:
        print(f"获取磁盘信息失败: {e}")
    
    return disk_list

def get_service_status():
    """获取服务状态"""
    services = []
    
    # 常见服务列表
    common_services = [
        'sshd', 'crond', 'rsyslog', 'network', 'firewalld',
        'nginx', 'httpd', 'mysql', 'postgresql', 'docker'
    ]
    
    for service in common_services:
        status = 'Unknown'
        try:
            # 尝试systemctl
            result = subprocess.run(['systemctl', 'is-active', service], 
                                  capture_output=True, text=True, timeout=2)
            if result.returncode == 0:
                status = result.stdout.strip()
            else:
                # 尝试service命令
                result = subprocess.run(['service', service, 'status'], 
                                      capture_output=True, text=True, timeout=2)
                status = 'active' if result.returncode == 0 else 'inactive'
        except subprocess.TimeoutExpired:
            status = 'timeout'
        except FileNotFoundError:
            status = 'not installed'
        except:
            status = 'error'
        
        services.append({'Service': service, 'Status': status})
    
    return services

def create_summary_sheet(workbook, system_info, network_info):
    """创建汇总sheet"""
    ws = workbook.create_sheet("System Summary")
    
    # 标题
    ws.merge_cells('A1:B1')
    ws['A1'] = "System Inspection Report"
    ws['A1'].font = Font(size=14, bold=True, color="366092")
    ws['A1'].alignment = Alignment(horizontal='center')
    
    ws['A2'] = f"Report Time: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}"
    ws['A3'] = f"Hostname: {network_info.get('Hostname', 'Unknown')}"
    ws['A4'] = f"IP Address: {network_info.get('IP Address', 'Unknown')}"
    
    # 系统信息表格
    row = 6
    ws[f'A{row}'] = "System Information"
    ws[f'A{row}'].font = Font(bold=True)
    row += 1
    
    sys_keys = ['OS Name', 'System', 'Release', 'Version', 'Machine', 
                'Processor', 'CPU Cores (Logical)', 'CPU Cores (Physical)', 
                'Total Memory', 'Memory Usage %', 'CPU Usage %', 
                'Boot Time', 'Uptime']
    
    for key in sys_keys:
        if key in system_info:
            ws[f'A{row}'] = key
            ws[f'B{row}'] = system_info[key]
            row += 1
    
    # 负载信息
    if 'Load 1min' in system_info:
        row += 1
        ws[f'A{row}'] = "System Load"
        ws[f'A{row}'].font = Font(bold=True)
        row += 1
        ws[f'A{row}'] = "1 Minute"
        ws[f'B{row}'] = system_info['Load 1min']
        row += 1
        ws[f'A{row}'] = "5 Minutes"
        ws[f'B{row}'] = system_info['Load 5min']
        row += 1
        ws[f'A{row}'] = "15 Minutes"
        ws[f'B{row}'] = system_info['Load 15min']
    
    # 调整列宽
    ws.column_dimensions['A'].width = 25
    ws.column_dimensions['B'].width = 40

def create_disk_sheet(workbook, disk_info):
    """创建磁盘信息sheet"""
    if not disk_info:
        return
    
    # 转换为DataFrame
    df_disk = pd.DataFrame(disk_info)
    
    # 移除Percent列（仅用于排序）
    if 'Percent' in df_disk.columns:
        df_disk = df_disk.drop('Percent', axis=1)
    
    # 创建sheet
    ws = workbook.create_sheet("Disk Usage")
    ws.title = "Disk Usage"
    
    # 写入数据
    for r_idx, row in enumerate(df_disk.iterrows(), start=1):
        for c_idx, value in enumerate(row[1], start=1):
            cell = ws.cell(row=r_idx+1, column=c_idx, value=value)
    
    # 写入表头
    for c_idx, col_name in enumerate(df_disk.columns, start=1):
        cell = ws.cell(row=1, column=c_idx, value=col_name)
    
    # 应用样式
    header_fill = PatternFill(start_color="4F81BD", end_color="4F81BD", fill_type="solid")
    header_font = Font(color="FFFFFF", bold=True)
    thin_border = Border(left=Side(style='thin'), right=Side(style='thin'), 
                       top=Side(style='thin'), bottom=Side(style='thin'))
    align_center = Alignment(horizontal='center', vertical='center')
    
    # 设置表头样式
    for cell in ws[1]:
        cell.fill = header_fill
        cell.font = header_font
        cell.alignment = align_center
        cell.border = thin_border
    
    # 设置数据样式和高亮
    for row in ws.iter_rows(min_row=2, max_row=ws.max_row):
        for cell in row:
            cell.border = thin_border
            cell.alignment = align_center
            
            # 高亮使用率
            if cell.column == 7 and cell.value:  # 第7列是Usage %
                try:
                    val_str = str(cell.value).strip('%')
                    val = float(val_str)
                    if val &gt;= 90:
                        cell.font = Font(color="FF0000", bold=True)
                    elif val &gt;= 80:
                        cell.font = Font(color="FFA500", bold=True)
                except ValueError:
                    pass
    
    # 调整列宽
    for col in ws.columns:
        max_length = 0
        col_letter = get_column_letter(col[0].column)
        for cell in col:
            if cell.value and len(str(cell.value)) &gt; max_length:
                max_length = len(str(cell.value))
        adjusted_width = min(max_length + 2, 30)
        ws.column_dimensions[col_letter].width = adjusted_width

def create_service_sheet(workbook, services):
    """创建服务状态sheet"""
    if not services:
        return
    
    df_services = pd.DataFrame(services)
    
    # 创建sheet
    ws = workbook.create_sheet("Service Status")
    
    # 写入数据
    for r_idx, row in enumerate(df_services.iterrows(), start=1):
        for c_idx, value in enumerate(row[1], start=1):
            cell = ws.cell(row=r_idx+1, column=c_idx, value=value)
    
    # 写入表头
    for c_idx, col_name in enumerate(df_services.columns, start=1):
        cell = ws.cell(row=1, column=c_idx, value=col_name)
    
    # 应用样式
    header_fill = PatternFill(start_color="4F81BD", end_color="4F81BD", fill_type="solid")
    header_font = Font(color="FFFFFF", bold=True)
    thin_border = Border(left=Side(style='thin'), right=Side(style='thin'), 
                       top=Side(style='thin'), bottom=Side(style='thin'))
    align_center = Alignment(horizontal='center', vertical='center')
    
    # 设置表头样式
    for cell in ws[1]:
        cell.fill = header_fill
        cell.font = header_font
        cell.alignment = align_center
        cell.border = thin_border
    
    # 设置数据样式和高亮
    for row in ws.iter_rows(min_row=2, max_row=ws.max_row):
        for cell in row:
            cell.border = thin_border
            cell.alignment = align_center
            
            # 高亮状态
            if cell.column == 2 and cell.value:  # 第2列是状态
                status = str(cell.value).lower()
                if status == 'active':
                    cell.fill = PatternFill(start_color="C6EFCE", end_color="C6EFCE", fill_type="solid")
                elif status in ['inactive', 'failed', 'error']:
                    cell.fill = PatternFill(start_color="FFC7CE", end_color="FFC7CE", fill_type="solid")
                    cell.font = Font(color="FF0000", bold=True)
    
    # 调整列宽
    ws.column_dimensions['A'].width = 20
    ws.column_dimensions['B'].width = 15

def create_process_sheet(workbook, process_info):
    """创建进程信息sheet"""
    if process_info.empty:
        return
    
    # 创建sheet
    ws = workbook.create_sheet("Top Processes")
    
    # 写入数据
    for r_idx, row in enumerate(process_info.iterrows(), start=1):
        for c_idx, value in enumerate(row[1], start=1):
            cell = ws.cell(row=r_idx+1, column=c_idx, value=value)
    
    # 写入表头
    for c_idx, col_name in enumerate(process_info.columns, start=1):
        cell = ws.cell(row=1, column=c_idx, value=col_name)
    
    # 应用样式
    header_fill = PatternFill(start_color="4F81BD", end_color="4F81BD", fill_type="solid")
    header_font = Font(color="FFFFFF", bold=True)
    thin_border = Border(left=Side(style='thin'), right=Side(style='thin'), 
                       top=Side(style='thin'), bottom=Side(style='thin'))
    align_center = Alignment(horizontal='center', vertical='center')
    
    # 设置表头样式
    for cell in ws[1]:
        cell.fill = header_fill
        cell.font = header_font
        cell.alignment = align_center
        cell.border = thin_border
    
    # 设置数据样式
    for row in ws.iter_rows(min_row=2, max_row=ws.max_row):
        for cell in row:
            cell.border = thin_border
            cell.alignment = align_center
    
    # 调整列宽
    for col in ws.columns:
        max_length = 0
        col_letter = get_column_letter(col[0].column)
        for cell in col:
            if cell.value and len(str(cell.value)) &gt; max_length:
                max_length = len(str(cell.value))
        adjusted_width = min(max_length + 2, 30)
        ws.column_dimensions[col_letter].width = adjusted_width

def create_network_sheet(workbook, network_info):
    """创建网络信息sheet"""
    ws = workbook.create_sheet("Network Info")
    
    # 标题
    ws['A1'] = "Network Information"
    ws['A1'].font = Font(size=12, bold=True)
    
    row = 3
    ws[f'A{row}'] = "Hostname"
    ws[f'B{row}'] = network_info.get('Hostname', 'Unknown')
    row += 1
    
    ws[f'A{row}'] = "IP Address"
    ws[f'B{row}'] = network_info.get('IP Address', 'Unknown')
    row += 1
    
    # 网络统计
    ws[f'A{row}'] = "Bytes Sent"
    ws[f'B{row}'] = network_info.get('Bytes Sent', 'Unknown')
    row += 1
    
    ws[f'A{row}'] = "Bytes Received"
    ws[f'B{row}'] = network_info.get('Bytes Received', 'Unknown')
    
    # 网络接口
    if 'Interfaces' in network_info and network_info['Interfaces']:
        row += 2
        ws[f'A{row}'] = "Network Interfaces"
        ws[f'A{row}'].font = Font(bold=True)
        row += 1
        
        # 表头
        headers = ['Interface', 'IP Address', 'Netmask']
        for col, header in enumerate(headers, 1):
            cell = ws.cell(row=row, column=col, value=header)
            cell.fill = PatternFill(start_color="4F81BD", end_color="4F81BD", fill_type="solid")
            cell.font = Font(color="FFFFFF", bold=True)
        
        row += 1
        
        # 数据
        for interface in network_info['Interfaces'][:10]:  # 限制显示数量
            ws.cell(row=row, column=1, value=interface.get('Interface', ''))
            ws.cell(row=row, column=2, value=interface.get('Address', ''))
            ws.cell(row=row, column=3, value=interface.get('Netmask', ''))
            row += 1
    
    # 设置边框和样式
    thin_border = Border(left=Side(style='thin'), right=Side(style='thin'), 
                       top=Side(style='thin'), bottom=Side(style='thin'))
    
    for row_cells in ws.iter_rows(min_row=1, max_row=ws.max_row, max_col=4):
        for cell in row_cells:
            cell.border = thin_border
            if cell.row &gt; 1:
                cell.alignment = Alignment(horizontal='left', vertical='center')
    
    # 调整列宽
    ws.column_dimensions['A'].width = 20
    ws.column_dimensions['B'].width = 25
    ws.column_dimensions['C'].width = 20

def sys_check_excel():
    """主函数"""
    print(f"[{datetime.datetime.now().strftime('%H:%M:%S')}] Starting system inspection...")
    
    # 收集信息
    print("Collecting system information...")
    system_info = get_system_info()
    
    print("Collecting network information...")
    network_info = get_network_info()
    
    print("Checking disk usage...")
    disk_info = get_disk_info()
    
    print("Checking service status...")
    services = get_service_status()
    
    print("Analyzing processes...")
    process_info = get_process_info()
    
    # 生成Excel文件名
    hostname = system_info.get('Hostname', 'unknown')
    timestamp = datetime.datetime.now().strftime('%Y%m%d_%H%M%S')
    filename = f"system_inspection_{hostname}_{timestamp}.xlsx"
    
    print(f"Generating Excel report: {filename}")
    
    try:
        # 创建Excel工作簿
        wb = Workbook()
        
        # 移除默认的sheet
        if 'Sheet' in wb.sheetnames:
            default_ws = wb['Sheet']
            wb.remove(default_ws)
        
        # 创建各个sheet
        create_summary_sheet(wb, system_info, network_info)
        create_disk_sheet(wb, disk_info)
        create_service_sheet(wb, services)
        create_network_sheet(wb, network_info)
        create_process_sheet(wb, process_info)
        
        # 保存文件
        wb.save(filename)
        
        print(f"\n[SUCCESS] Inspection completed!")
        print(f"Report generated: {os.path.abspath(filename)}")
        
        if os.path.exists(filename):
            print(f"File size: {get_size(os.path.getsize(filename))}")
        
        # 显示摘要信息
        print("\n=== Report Summary ===")
        print(f"System: {system_info.get('OS Name', system_info.get('System', 'Unknown'))}")
        print(f"Hostname: {hostname}")
        print(f"CPU Cores: {system_info.get('CPU Cores (Logical)', 'Unknown')}")
        print(f"Memory: {system_info.get('Total Memory', 'Unknown')} (Usage: {system_info.get('Memory Usage %', 'Unknown')})")
        print(f"CPU Usage: {system_info.get('CPU Usage %', 'Unknown')}")
        
        # 磁盘警告
        if disk_info:
            critical_disks = [d for d in disk_info if d['Percent'] &gt;= 90]
            warning_disks = [d for d in disk_info if 80 &lt;= d['Percent'] &lt; 90]
            
            if critical_disks:
                print(f"[CRITICAL] {len(critical_disks)} disk(s) usage &gt; 90%")
                for disk in critical_disks[:3]:
                    print(f"  - {disk['Mount Point']}: {disk['Usage %']}")
            
            if warning_disks:
                print(f"[WARNING] {len(warning_disks)} disk(s) usage &gt; 80%")
        
        # 服务警告
        if services:
            failed_services = [s for s in services if s['Status'] in ['inactive', 'failed', 'error']]
            if failed_services:
                print(f"[WARNING] {len(failed_services)} service(s) not running")
        
        print("\n=== Excel Sheet Contents ===")
        print("1. System Summary - Basic system information")
        print("2. Disk Usage - Disk partitions with usage highlighting")
        print("3. Service Status - Service status with color coding")
        print("4. Network Info - Network interfaces and statistics")
        print("5. Top Processes - Top 10 processes by memory usage")
        
        print("\n=== Color Legend ===")
        print("Disk Usage: &gt;90% = RED, &gt;80% = ORANGE")
        print("Services: Running = GREEN, Stopped = RED")
        
    except Exception as e:
        print(f"\n[ERROR] Failed to generate report: {e}")
        import traceback
        traceback.print_exc()

def main():
    """主入口函数"""
    print("=" * 70)
    print("           Linux System Inspection Tool (Excel Version)")
    print("              Author: Linux Operations Team")
    print("=" * 70)
    print()
    
    try:
        # 检查是否以root运行（某些信息需要root权限）
        if os.geteuid() != 0:
            print("[WARNING] Running without root privileges")
            print("Some information (services, detailed disk info) may not be available")
            print("Consider running with: sudo python3 syscheck-excel.py")
            response = input("Continue anyway? (y/N): ")
            if response.lower() != 'y':
                print("Exiting...")
                return
        
        # 执行巡检
        sys_check_excel()
        
    except KeyboardInterrupt:
        print("\n\n[INFO] Inspection interrupted by user.")
    except Exception as e:
        print(f"\n[ERROR] Unexpected error: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    main()
</code></pre>
<h4 data-id="heading-12">3.3、使用python脚本</h4>
<p><code>python3 syscheck-excel.py </code></p>
<h4 data-id="heading-13">3.4、效果</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0cfc2fdedf0487085474161f559e5ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=C%2Bz0WvauSrVj1WwRJ52a3HTCk4s%3D" alt="微信图片_20260129184304.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e6a935859f14e8b9f6f714cab7175ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=Xw%2BppRDN%2BvMUb2dZw7LdIiuE0J8%3D" alt="微信图片_20260129184316.jpg" loading="lazy"/></p>
<h3 data-id="heading-14">4、使用ansible批量巡检</h3>
<blockquote>
<p>同志们，现在迎来了一个问题，如果我们要巡检的服务器特别多几百台怎么办。这时候就用到我们上面配置好的ansibLe了，我只用三台做了一个例子。</p>
</blockquote>
<h4 data-id="heading-15">4.1、剧本编写</h4>
<p>1、<code>vim  check_all.yml</code></p>
<pre><code class="hljs language----" lang="---">- name: 全网服务器批量巡检
  hosts: all
  become: yes
  gather_facts: yes

  vars:
    # 配置变量
    check_script: "syscheck.sh"
    report_dir: "./reports"
    remote_report_dir: "/tmp"

  tasks:
    # 任务1: 创建本地报告目录
    - name: 创建本地报告目录
      delegate_to: localhost
      run_once: yes
      file:
        path: "{{ report_dir }}"
        state: directory
        mode: '0755'

    # 任务2: 分发巡检脚本
    - name: 分发巡检脚本到目标服务器
      copy:
        src: /root/ansible/syscheck.sh
        dest: /usr/local/bin/syscheck.sh
        owner: root
        group: root
        mode: '0755'

    # 任务3: 执行巡检并保存结果
    - name: 执行系统巡检
      shell: |
        # 设置环境变量，禁用终端颜色
        export TERM=dumb
        /usr/local/bin/syscheck.sh
      register: check_result
      args:
        executable: /bin/bash
      environment:
        TERM: dumb  # 禁用颜色输出，避免ANSI转义字符

    # 任务4: 保存巡检结果到临时文件
    - name: 保存巡检结果
      copy:
        content: |
          ==========================================
          服务器巡检报告
          主机名: {{ ansible_hostname }}
          IP地址: {{ ansible_default_ipv4.address | default('未知') }}
          检查时间: {{ ansible_date_time.iso8601 }}
          ==========================================

          {{ check_result.stdout }}
        dest: "{{ remote_report_dir }}/check_{{ ansible_hostname }}.txt"
        owner: root
        group: root
        mode: '0644'

    # 任务5: 拉取巡检报告到本地
    - name: 拉取巡检报告到本地
      fetch:
        src: "{{ remote_report_dir }}/check_{{ ansible_hostname }}.txt"
        dest: "{{ report_dir }}/"
        flat: no  # 按主机名创建目录结构

    # 任务6: 清理远程临时文件
    - name: 清理远程临时文件
      file:
        path: "{{ remote_report_dir }}/check_{{ ansible_hostname }}.txt"
        state: absent

    # 任务7: 显示执行摘要
    - name: 显示巡检摘要
      debug:
        msg: |
          巡检完成: {{ ansible_hostname }}
          报告已保存到: {{ report_dir }}/{{ ansible_hostname }}/check_{{ ansible_hostname }}.txt
</code></pre>
<h4 data-id="heading-16">4.2、使用剧本</h4>
<p>1、<code>ansible-playbook     check_all.yml</code></p>
<h4 data-id="heading-17">4.3 结果</h4>
<blockquote>
<p>目录都存在在/root/ansible/reports/服务器名称</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69ee24bf96684ed1a944d676eae772da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=losaPrH0%2BJJ%2BfvTxXWz85LsMK1I%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-18">四、总结&amp;优化</h2>
<h2 data-id="heading-19">最后，马上要过年了，小饼预祝大家马年发大财，万事如意。下课！</h2></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再被VO、BO、PO、DTO、DO绕晕！今天用一篇文章把它们讲透]]></title>    <link>https://juejin.cn/post/7600709805469171755</link>    <guid>https://juejin.cn/post/7600709805469171755</guid>    <pubDate>2026-01-30T05:23:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600709805469171755" data-draft-id="7600706866785681451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再被VO、BO、PO、DTO、DO绕晕！今天用一篇文章把它们讲透"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T05:23:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我爱娃哈哈"/> <meta itemprop="url" content="https://juejin.cn/user/1398234522335383"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再被VO、BO、PO、DTO、DO绕晕！今天用一篇文章把它们讲透
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234522335383/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我爱娃哈哈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:23:39.000Z" title="Fri Jan 30 2026 05:23:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>团队里新来的小伙伴在代码里各种对象传来传去，VO、BO、PO、DTO、DO满天飞，你问他为什么要这样设计，他支支吾吾说不清楚，最后你也被绕得云里雾里...</p>
<p>今天就来聊聊这些让人头疼的对象概念，用一篇文章把它们彻底讲透，让你再也不会被这些缩写绕晕！</p>
<h2 data-id="heading-0">一、为什么要区分这些对象？</h2>
<p>在开始详细介绍之前，我们先来理解为什么要区分这些对象。很多新手开发者可能会问："不就是个对象吗？为什么还要分这么细？直接用一个对象不就完事了？"</p>
<h3 data-id="heading-1">1.1 分层架构的需要</h3>
<p>现代Web应用通常采用分层架构设计：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 典型的分层架构</span>
<span class="hljs-comment">// Controller层 -&gt; Service层 -&gt; Repository层 -&gt; Database</span>
</code></pre>
<p>每一层都有不同的职责，需要处理不同的数据：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Controller层需要的数据</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> {
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String avatar;  <span class="hljs-comment">// 头像URL</span>
    <span class="hljs-keyword">private</span> String lastLoginTime;  <span class="hljs-comment">// 格式化的时间显示</span>
}

<span class="hljs-comment">// Service层需要的数据</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String password;  <span class="hljs-comment">// 密码需要在Service层处理</span>
    <span class="hljs-keyword">private</span> Integer status;   <span class="hljs-comment">// 用户状态</span>
    <span class="hljs-keyword">private</span> Date lastLoginTime;
}

<span class="hljs-comment">// Repository层需要的数据</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String passwordHash;  <span class="hljs-comment">// 加密后的密码</span>
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-keyword">private</span> Date lastLoginTime;
    <span class="hljs-keyword">private</span> Date createdAt;
    <span class="hljs-keyword">private</span> Date updatedAt;
}
</code></pre>
<h3 data-id="heading-2">1.2 数据安全和隐私保护</h3>
<p>不同层面对数据的访问权限不同：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误的做法 - 直接暴露数据库对象</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@GetMapping("/users/{id}")</span>
    <span class="hljs-keyword">public</span> UserDO <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-comment">// 直接返回数据库对象，可能包含敏感信息</span>
        <span class="hljs-keyword">return</span> userService.getUserById(id);
    }
}

<span class="hljs-comment">// 正确的做法 - 使用专门的VO对象</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@GetMapping("/users/{id}")</span>
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> userService.getUserById(id);
        <span class="hljs-comment">// 转换为VO对象，过滤敏感信息</span>
        <span class="hljs-keyword">return</span> convertToVO(userBO);
    }
    
    <span class="hljs-keyword">private</span> UserVO <span class="hljs-title function_">convertToVO</span><span class="hljs-params">(UserBO userBO)</span> {
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserVO</span>();
        vo.setUsername(userBO.getUsername());
        vo.setEmail(userBO.getEmail());
        vo.setAvatar(buildAvatarUrl(userBO.getId()));
        vo.setLastLoginTime(formatTime(userBO.getLastLoginTime()));
        <span class="hljs-comment">// 注意：不包含密码等敏感信息</span>
        <span class="hljs-keyword">return</span> vo;
    }
}
</code></pre>
<h3 data-id="heading-3">1.3 代码可维护性</h3>
<p>合理的对象分层能提高代码的可维护性：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 清晰的职责分离</span>
<span class="hljs-comment">// Controller层：处理HTTP请求，参数校验，返回响应</span>
<span class="hljs-comment">// Service层：业务逻辑处理</span>
<span class="hljs-comment">// Repository层：数据访问</span>
<span class="hljs-comment">// 各层使用不同的对象，职责明确</span>
</code></pre>
<h2 data-id="heading-4">二、各种对象详解</h2>
<h3 data-id="heading-5">2.1 PO (Persistent Object) - 持久化对象</h3>
<p>PO是与数据库表结构一一对应的对象，通常与ORM框架（如MyBatis、Hibernate）配合使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// PO对象 - 与数据库表结构对应</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserPO</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-meta">@Column(name = "username")</span>
    <span class="hljs-keyword">private</span> String username;
    
    <span class="hljs-meta">@Column(name = "email")</span>
    <span class="hljs-keyword">private</span> String email;
    
    <span class="hljs-meta">@Column(name = "password_hash")</span>
    <span class="hljs-keyword">private</span> String passwordHash;
    
    <span class="hljs-meta">@Column(name = "status")</span>
    <span class="hljs-keyword">private</span> Integer status;
    
    <span class="hljs-meta">@Column(name = "created_at")</span>
    <span class="hljs-keyword">private</span> Date createdAt;
    
    <span class="hljs-meta">@Column(name = "updated_at")</span>
    <span class="hljs-keyword">private</span> Date updatedAt;
    
    <span class="hljs-meta">@Column(name = "last_login_time")</span>
    <span class="hljs-keyword">private</span> Date lastLoginTime;
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>与数据库表结构一一对应</li>
<li>包含数据库字段的所有信息</li>
<li>通常由ORM框架管理生命周期</li>
<li>不包含业务逻辑</li>
</ul>
<h3 data-id="heading-6">2.2 DO (Data Object) - 数据对象</h3>
<p>DO与PO非常相似，也是与数据库表结构对应的对象，但在某些团队中会有一些细微差别。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// DO对象 - 数据访问层使用的对象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String passwordHash;
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-keyword">private</span> Date createdAt;
    <span class="hljs-keyword">private</span> Date updatedAt;
    <span class="hljs-keyword">private</span> Date lastLoginTime;
    
    <span class="hljs-comment">// 可能包含一些数据访问层的辅助方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isActive</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.status == <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLocked</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.status == <span class="hljs-number">2</span>;
    }
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>与数据库表结构对应</li>
<li>在Repository层使用</li>
<li>可能包含一些简单的数据处理方法</li>
<li>不包含复杂业务逻辑</li>
</ul>
<h3 data-id="heading-7">2.3 DTO (Data Transfer Object) - 数据传输对象</h3>
<p>DTO用于在不同层之间传输数据，特别是在远程调用时使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// DTO对象 - 用于服务间数据传输</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDTO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String statusDesc;  <span class="hljs-comment">// 状态描述，便于前端显示</span>
    <span class="hljs-keyword">private</span> String createTime;  <span class="hljs-comment">// 格式化的时间字符串</span>
    
    <span class="hljs-comment">// 用于创建用户的DTO</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateUserRequest</span> {
        <span class="hljs-keyword">private</span> String username;
        <span class="hljs-keyword">private</span> String email;
        <span class="hljs-keyword">private</span> String password;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-comment">// 用于更新用户的DTO</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpdateUserRequest</span> {
        <span class="hljs-keyword">private</span> String username;
        <span class="hljs-keyword">private</span> String email;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-comment">// 用于用户列表的DTO</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserListItem</span> {
        <span class="hljs-keyword">private</span> Long id;
        <span class="hljs-keyword">private</span> String username;
        <span class="hljs-keyword">private</span> String email;
        <span class="hljs-keyword">private</span> String statusDesc;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>用于层间数据传输</li>
<li>可以包含多个业务对象的数据</li>
<li>通常用于远程调用</li>
<li>可以进行数据格式转换</li>
</ul>
<h3 data-id="heading-8">2.4 BO (Business Object) - 业务对象</h3>
<p>BO包含业务逻辑的对象，通常在Service层使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// BO对象 - 包含业务逻辑的对象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-keyword">private</span> Date lastLoginTime;
    <span class="hljs-keyword">private</span> List&lt;RoleBO&gt; roles;  <span class="hljs-comment">// 用户角色</span>
    
    <span class="hljs-comment">// 业务方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canLogin</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.status == <span class="hljs-number">1</span>;  <span class="hljs-comment">// 只有激活状态的用户才能登录</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAdmin</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.roles.stream()
                .anyMatch(role -&gt; <span class="hljs-string">"ADMIN"</span>.equals(role.getRoleName()));
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateLastLoginTime</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.lastLoginTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkPassword</span><span class="hljs-params">(String inputPassword)</span> {
        <span class="hljs-keyword">return</span> BCrypt.checkpw(inputPassword, <span class="hljs-built_in">this</span>.password);
    }
    
    <span class="hljs-comment">// getters and setters</span>
}

<span class="hljs-comment">// 角色业务对象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleBO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String roleName;
    <span class="hljs-keyword">private</span> String roleDesc;
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>包含业务逻辑</li>
<li>在Service层使用</li>
<li>可能聚合多个DO/PO对象</li>
<li>是业务的核心抽象</li>
</ul>
<h3 data-id="heading-9">2.5 VO (Value Object) - 视图对象</h3>
<p>VO是展示层使用的对象，通常用于向前端返回数据。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// VO对象 - 用于前端展示</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String avatar;      <span class="hljs-comment">// 头像URL</span>
    <span class="hljs-keyword">private</span> String statusDesc;  <span class="hljs-comment">// 状态描述</span>
    <span class="hljs-keyword">private</span> String lastLoginTime;  <span class="hljs-comment">// 格式化的时间显示</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; roleNames;  <span class="hljs-comment">// 角色名称列表</span>
    
    <span class="hljs-comment">// 嵌套的VO对象</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDetailVO</span> {
        <span class="hljs-keyword">private</span> Long id;
        <span class="hljs-keyword">private</span> String username;
        <span class="hljs-keyword">private</span> String email;
        <span class="hljs-keyword">private</span> String avatar;
        <span class="hljs-keyword">private</span> String statusDesc;
        <span class="hljs-keyword">private</span> String lastLoginTime;
        <span class="hljs-keyword">private</span> List&lt;RoleVO&gt; roles;
        <span class="hljs-keyword">private</span> String registerTime;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleVO</span> {
        <span class="hljs-keyword">private</span> String roleName;
        <span class="hljs-keyword">private</span> String roleDesc;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>用于前端展示</li>
<li>数据格式友好</li>
<li>可能包含格式化后的数据</li>
<li>不包含敏感信息</li>
</ul>
<h2 data-id="heading-10">三、对象转换实践</h2>
<p>在实际开发中，我们需要在不同对象之间进行转换。</p>
<h3 data-id="heading-11">3.1 手动转换</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 手动转换示例</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;
    
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// 1. 从数据库获取DO对象</span>
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userRepository.findById(id);
        
        <span class="hljs-comment">// 2. 转换为BO对象</span>
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> convertToBO(userDO);
        
        <span class="hljs-comment">// 3. 转换为VO对象</span>
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> convertToVO(userBO);
        
        <span class="hljs-keyword">return</span> userVO;
    }
    
    <span class="hljs-keyword">private</span> UserBO <span class="hljs-title function_">convertToBO</span><span class="hljs-params">(UserDO userDO)</span> {
        <span class="hljs-keyword">if</span> (userDO == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserBO</span>();
        userBO.setId(userDO.getId());
        userBO.setUsername(userDO.getUsername());
        userBO.setEmail(userDO.getEmail());
        userBO.setPassword(userDO.getPasswordHash());
        userBO.setStatus(userDO.getStatus());
        userBO.setLastLoginTime(userDO.getLastLoginTime());
        
        <span class="hljs-keyword">return</span> userBO;
    }
    
    <span class="hljs-keyword">private</span> UserVO <span class="hljs-title function_">convertToVO</span><span class="hljs-params">(UserBO userBO)</span> {
        <span class="hljs-keyword">if</span> (userBO == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserVO</span>();
        userVO.setId(userBO.getId());
        userVO.setUsername(userBO.getUsername());
        userVO.setEmail(userBO.getEmail());
        userVO.setAvatar(buildAvatarUrl(userBO.getId()));
        userVO.setStatusDesc(getStatusDesc(userBO.getStatus()));
        userVO.setLastLoginTime(formatTime(userBO.getLastLoginTime()));
        
        <span class="hljs-keyword">return</span> userVO;
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">buildAvatarUrl</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"https://cdn.example.com/avatar/"</span> + userId + <span class="hljs-string">".jpg"</span>;
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getStatusDesc</span><span class="hljs-params">(Integer status)</span> {
        <span class="hljs-keyword">switch</span> (status) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"激活"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"锁定"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"注销"</span>;
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"未知"</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatTime</span><span class="hljs-params">(Date date)</span> {
        <span class="hljs-keyword">if</span> (date == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        <span class="hljs-keyword">return</span> sdf.format(date);
    }
}
</code></pre>
<h3 data-id="heading-12">3.2 使用MapStruct自动转换</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 使用MapStruct简化对象转换</span>
<span class="hljs-comment">// 1. 添加依赖</span>
<span class="hljs-comment">/*
&lt;dependency&gt;
    &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;
    &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;
    &lt;version&gt;1.5.2.Final&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;
    &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;
    &lt;version&gt;1.5.2.Final&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
*/</span>

<span class="hljs-comment">// 2. 定义转换接口</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserConverter</span> {
    
    <span class="hljs-type">UserConverter</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> Mappers.getMapper(UserConverter.class);
    
    <span class="hljs-comment">// DO转BO</span>
    UserBO <span class="hljs-title function_">toBO</span><span class="hljs-params">(UserDO userDO)</span>;
    
    <span class="hljs-comment">// BO转VO</span>
    UserVO <span class="hljs-title function_">toVO</span><span class="hljs-params">(UserBO userBO)</span>;
    
    <span class="hljs-comment">// 自定义转换规则</span>
    <span class="hljs-meta">@Mapping(target = "statusDesc", expression = "java(getStatusDesc(userBO.getStatus()))")</span>
    <span class="hljs-meta">@Mapping(target = "lastLoginTime", expression = "java(formatTime(userBO.getLastLoginTime()))")</span>
    UserVO <span class="hljs-title function_">toVOWithCustom</span><span class="hljs-params">(UserBO userBO)</span>;
    
    <span class="hljs-keyword">default</span> String <span class="hljs-title function_">getStatusDesc</span><span class="hljs-params">(Integer status)</span> {
        <span class="hljs-keyword">switch</span> (status) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"激活"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"锁定"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"注销"</span>;
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"未知"</span>;
        }
    }
    
    <span class="hljs-keyword">default</span> String <span class="hljs-title function_">formatTime</span><span class="hljs-params">(Date date)</span> {
        <span class="hljs-keyword">if</span> (date == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        <span class="hljs-keyword">return</span> sdf.format(date);
    }
}

<span class="hljs-comment">// 3. 使用转换器</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;
    
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// 1. 从数据库获取DO对象</span>
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userRepository.findById(id);
        
        <span class="hljs-comment">// 2. 转换为BO对象</span>
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> UserConverter.INSTANCE.toBO(userDO);
        
        <span class="hljs-comment">// 3. 转换为VO对象</span>
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> UserConverter.INSTANCE.toVOWithCustom(userBO);
        
        <span class="hljs-keyword">return</span> userVO;
    }
}
</code></pre>
<h2 data-id="heading-13">四、实际应用场景</h2>
<h3 data-id="heading-14">4.1 用户管理系统的完整示例</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 完整的用户管理系统示例</span>

<span class="hljs-comment">// 1. 数据库实体 (PO/DO)</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserPO</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-meta">@Column(name = "username")</span>
    <span class="hljs-keyword">private</span> String username;
    
    <span class="hljs-meta">@Column(name = "email")</span>
    <span class="hljs-keyword">private</span> String email;
    
    <span class="hljs-meta">@Column(name = "password_hash")</span>
    <span class="hljs-keyword">private</span> String passwordHash;
    
    <span class="hljs-meta">@Column(name = "status")</span>
    <span class="hljs-keyword">private</span> Integer status;
    
    <span class="hljs-meta">@Column(name = "created_at")</span>
    <span class="hljs-keyword">private</span> Date createdAt;
    
    <span class="hljs-meta">@Column(name = "updated_at")</span>
    <span class="hljs-keyword">private</span> Date updatedAt;
    
    <span class="hljs-comment">// getters and setters</span>
}

<span class="hljs-comment">// 2. 数据访问层</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;
    
    <span class="hljs-keyword">public</span> UserDO <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM users WHERE id = ?"</span>;
        <span class="hljs-keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{id}, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRowMapper</span>());
    }
    
    <span class="hljs-keyword">public</span> List&lt;UserDO&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM users"</span>;
        <span class="hljs-keyword">return</span> jdbcTemplate.query(sql, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRowMapper</span>());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(UserDO userDO)</span> {
        <span class="hljs-keyword">if</span> (userDO.getId() == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 插入新用户</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"INSERT INTO users (username, email, password_hash, status, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?)"</span>;
            jdbcTemplate.update(sql, userDO.getUsername(), userDO.getEmail(), userDO.getPasswordHash(), 
                              userDO.getStatus(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 更新用户</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"UPDATE users SET username = ?, email = ?, password_hash = ?, status = ?, updated_at = ? WHERE id = ?"</span>;
            jdbcTemplate.update(sql, userDO.getUsername(), userDO.getEmail(), userDO.getPasswordHash(), 
                              userDO.getStatus(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), userDO.getId());
        }
    }
}

<span class="hljs-comment">// 3. 业务逻辑层</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PasswordEncoder passwordEncoder;
    
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">createUser</span><span class="hljs-params">(CreateUserDTO createUserDTO)</span> {
        <span class="hljs-comment">// 1. DTO转BO</span>
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserBO</span>();
        userBO.setUsername(createUserDTO.getUsername());
        userBO.setEmail(createUserDTO.getEmail());
        userBO.setPassword(passwordEncoder.encode(createUserDTO.getPassword()));
        userBO.setStatus(<span class="hljs-number">1</span>); <span class="hljs-comment">// 默认激活状态</span>
        
        <span class="hljs-comment">// 2. 业务逻辑处理</span>
        <span class="hljs-keyword">if</span> (userRepository.existsByUsername(userBO.getUsername())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"用户名已存在"</span>);
        }
        
        <span class="hljs-keyword">if</span> (userRepository.existsByEmail(userBO.getEmail())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"邮箱已存在"</span>);
        }
        
        <span class="hljs-comment">// 3. BO转DO并保存</span>
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> convertToDO(userBO);
        userRepository.save(userDO);
        
        <span class="hljs-comment">// 4. DO转BO再转VO</span>
        userBO.setId(userDO.getId());
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> convertToVO(userBO);
        
        <span class="hljs-keyword">return</span> userVO;
    }
    
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userRepository.findById(id);
        <span class="hljs-keyword">if</span> (userDO == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"用户不存在"</span>);
        }
        
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> convertToBO(userDO);
        <span class="hljs-keyword">return</span> convertToVO(userBO);
    }
    
    <span class="hljs-keyword">public</span> List&lt;UserListItemVO&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> {
        List&lt;UserDO&gt; userDOs = userRepository.findAll();
        <span class="hljs-keyword">return</span> userDOs.stream()
                .map(<span class="hljs-built_in">this</span>::convertToBO)
                .map(<span class="hljs-built_in">this</span>::convertToListItemVO)
                .collect(Collectors.toList());
    }
    
    <span class="hljs-keyword">private</span> UserDO <span class="hljs-title function_">convertToDO</span><span class="hljs-params">(UserBO userBO)</span> {
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDO</span>();
        userDO.setId(userBO.getId());
        userDO.setUsername(userBO.getUsername());
        userDO.setEmail(userBO.getEmail());
        userDO.setPasswordHash(userBO.getPassword());
        userDO.setStatus(userBO.getStatus());
        userDO.setCreatedAt(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        userDO.setUpdatedAt(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        <span class="hljs-keyword">return</span> userDO;
    }
    
    <span class="hljs-keyword">private</span> UserBO <span class="hljs-title function_">convertToBO</span><span class="hljs-params">(UserDO userDO)</span> {
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserBO</span>();
        userBO.setId(userDO.getId());
        userBO.setUsername(userDO.getUsername());
        userBO.setEmail(userDO.getEmail());
        userBO.setPassword(userDO.getPasswordHash());
        userBO.setStatus(userDO.getStatus());
        userBO.setLastLoginTime(userDO.getUpdatedAt());
        <span class="hljs-keyword">return</span> userBO;
    }
    
    <span class="hljs-keyword">private</span> UserVO <span class="hljs-title function_">convertToVO</span><span class="hljs-params">(UserBO userBO)</span> {
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserVO</span>();
        userVO.setId(userBO.getId());
        userVO.setUsername(userBO.getUsername());
        userVO.setEmail(userBO.getEmail());
        userVO.setAvatar(<span class="hljs-string">"https://cdn.example.com/avatar/"</span> + userBO.getId() + <span class="hljs-string">".jpg"</span>);
        userVO.setStatusDesc(getStatusDesc(userBO.getStatus()));
        userVO.setLastLoginTime(formatTime(userBO.getLastLoginTime()));
        <span class="hljs-keyword">return</span> userVO;
    }
    
    <span class="hljs-keyword">private</span> UserListItemVO <span class="hljs-title function_">convertToListItemVO</span><span class="hljs-params">(UserBO userBO)</span> {
        <span class="hljs-type">UserListItemVO</span> <span class="hljs-variable">listItemVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserListItemVO</span>();
        listItemVO.setId(userBO.getId());
        listItemVO.setUsername(userBO.getUsername());
        listItemVO.setEmail(userBO.getEmail());
        listItemVO.setStatusDesc(getStatusDesc(userBO.getStatus()));
        <span class="hljs-keyword">return</span> listItemVO;
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getStatusDesc</span><span class="hljs-params">(Integer status)</span> {
        <span class="hljs-keyword">switch</span> (status) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"激活"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"锁定"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"注销"</span>;
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"未知"</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatTime</span><span class="hljs-params">(Date date)</span> {
        <span class="hljs-keyword">if</span> (date == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        <span class="hljs-keyword">return</span> sdf.format(date);
    }
}

<span class="hljs-comment">// 4. 控制器层</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;UserVO&gt; <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Valid</span> CreateUserDTO createUserDTO)</span> {
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> userService.createUser(createUserDTO);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(userVO);
    }
    
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;UserVO&gt; <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> userService.getUserById(id);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(userVO);
    }
    
    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;UserListItemVO&gt;&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> {
        List&lt;UserListItemVO&gt; users = userService.getAllUsers();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(users);
    }
}
</code></pre>
<h3 data-id="heading-15">4.2 DTO对象定义</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// DTO对象定义</span>

<span class="hljs-comment">// 创建用户请求DTO</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateUserDTO</span> {
    <span class="hljs-meta">@NotBlank(message = "用户名不能为空")</span>
    <span class="hljs-meta">@Size(min = 3, max = 20, message = "用户名长度必须在3-20之间")</span>
    <span class="hljs-keyword">private</span> String username;
    
    <span class="hljs-meta">@NotBlank(message = "邮箱不能为空")</span>
    <span class="hljs-meta">@Email(message = "邮箱格式不正确")</span>
    <span class="hljs-keyword">private</span> String email;
    
    <span class="hljs-meta">@NotBlank(message = "密码不能为空")</span>
    <span class="hljs-meta">@Size(min = 6, max = 20, message = "密码长度必须在6-20之间")</span>
    <span class="hljs-keyword">private</span> String password;
    
    <span class="hljs-comment">// getters and setters</span>
}

<span class="hljs-comment">// 用户列表项VO</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserListItemVO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String statusDesc;
    
    <span class="hljs-comment">// getters and setters</span>
}

<span class="hljs-comment">// 用户详情VO</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String avatar;
    <span class="hljs-keyword">private</span> String statusDesc;
    <span class="hljs-keyword">private</span> String lastLoginTime;
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<h2 data-id="heading-16">五、最佳实践建议</h2>
<h3 data-id="heading-17">5.1 命名规范</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 推荐的命名规范</span>
<span class="hljs-comment">// PO: UserPO, OrderPO</span>
<span class="hljs-comment">// DO: UserDO, OrderDO  </span>
<span class="hljs-comment">// DTO: UserDTO, CreateUserRequest, UpdateUserRequest</span>
<span class="hljs-comment">// BO: UserBO, OrderBO</span>
<span class="hljs-comment">// VO: UserVO, UserDetailVO, UserListItemVO</span>
</code></pre>
<h3 data-id="heading-18">5.2 转换工具选择</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 简单场景：手动转换</span>
<span class="hljs-comment">// 2. 复杂场景：MapStruct</span>
<span class="hljs-comment">// 3. 特殊场景：自定义转换器</span>

<span class="hljs-comment">// MapStruct配置示例</span>
<span class="hljs-meta">@Mapper(componentModel = "spring")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> {
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> Mappers.getMapper(UserMapper.class);
    
    UserBO <span class="hljs-title function_">toBO</span><span class="hljs-params">(UserDO userDO)</span>;
    UserVO <span class="hljs-title function_">toVO</span><span class="hljs-params">(UserBO userBO)</span>;
    
    <span class="hljs-meta">@Mapping(target = "password", ignore = true)</span>  <span class="hljs-comment">// 忽略密码字段</span>
    UserVO <span class="hljs-title function_">toSafeVO</span><span class="hljs-params">(UserBO userBO)</span>;
}
</code></pre>
<h3 data-id="heading-19">5.3 分层使用建议</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 各层对象使用建议</span>
<span class="hljs-comment">// Controller层：主要使用VO和DTO</span>
<span class="hljs-comment">// Service层：主要使用BO</span>
<span class="hljs-comment">// Repository层：主要使用DO/PO</span>
<span class="hljs-comment">// 外部接口：主要使用DTO</span>
</code></pre>
<h3 data-id="heading-20">5.4 性能考虑</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 避免不必要的转换</span>
<span class="hljs-comment">// 1. 只转换需要的字段</span>
<span class="hljs-comment">// 2. 批量操作时考虑批量转换</span>
<span class="hljs-comment">// 3. 缓存转换结果（如果适用）</span>

<span class="hljs-comment">// 批量转换示例</span>
<span class="hljs-keyword">public</span> List&lt;UserVO&gt; <span class="hljs-title function_">batchConvertToVO</span><span class="hljs-params">(List&lt;UserBO&gt; userBOs)</span> {
    <span class="hljs-keyword">return</span> userBOs.stream()
            .map(<span class="hljs-built_in">this</span>::convertToVO)
            .collect(Collectors.toList());
}
</code></pre>
<h2 data-id="heading-21">六、常见误区</h2>
<h3 data-id="heading-22">6.1 误区一：所有层都用同一个对象</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误的做法</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@GetMapping("/users/{id}")</span>
    <span class="hljs-keyword">public</span> UserDO <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-comment">// 直接返回数据库对象，可能暴露敏感信息</span>
        <span class="hljs-keyword">return</span> userService.getUserById(id);
    }
}

<span class="hljs-comment">// 正确的做法</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@GetMapping("/users/{id}")</span>
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-comment">// 返回专门的VO对象，过滤敏感信息</span>
        <span class="hljs-keyword">return</span> userService.getUserVOById(id);
    }
}
</code></pre>
<h3 data-id="heading-23">6.2 误区二：对象之间随意转换</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误的做法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">processUser</span><span class="hljs-params">(UserVO userVO)</span> {
        <span class="hljs-comment">// 在Service层直接操作VO对象</span>
        <span class="hljs-comment">// 违反了分层原则</span>
        <span class="hljs-keyword">return</span> userVO;
    }
}

<span class="hljs-comment">// 正确的做法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">processUser</span><span class="hljs-params">(UserDTO userDTO)</span> {
        <span class="hljs-comment">// 1. DTO转BO</span>
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> convertToBO(userDTO);
        
        <span class="hljs-comment">// 2. 在BO上执行业务逻辑</span>
        processBusinessLogic(userBO);
        
        <span class="hljs-comment">// 3. BO转VO</span>
        <span class="hljs-keyword">return</span> convertToVO(userBO);
    }
}
</code></pre>
<h3 data-id="heading-24">6.3 误区三：过度设计</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误的做法 - 过度分层</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> SimpleUserVO <span class="hljs-title function_">getSimpleUser</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userRepository.findById(id);
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> userConverter.toBO(userDO);
        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">userDTO</span> <span class="hljs-operator">=</span> userConverter.toDTO(userBO);
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> userConverter.toVO(userDTO);
        <span class="hljs-type">SimpleUserVO</span> <span class="hljs-variable">simpleUserVO</span> <span class="hljs-operator">=</span> userConverter.toSimpleVO(userVO);
        <span class="hljs-keyword">return</span> simpleUserVO;
    }
}

<span class="hljs-comment">// 正确的做法 - 合理分层</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUser</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userRepository.findById(id);
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> userConverter.toBO(userDO);
        <span class="hljs-keyword">return</span> userConverter.toVO(userBO);
    }
}
</code></pre>
<h2 data-id="heading-25">七、总结</h2>
<p>通过今天的详细讲解，我们了解了各种对象的概念和使用场景：</p>
<ol>
<li><strong>PO (Persistent Object)</strong>：与数据库表结构对应的持久化对象</li>
<li><strong>DO (Data Object)</strong>：数据访问层使用的数据对象</li>
<li><strong>DTO (Data Transfer Object)</strong>：用于层间数据传输的对象</li>
<li><strong>BO (Business Object)</strong>：包含业务逻辑的业务对象</li>
<li><strong>VO (Value Object)</strong>：用于前端展示的视图对象</li>
</ol>
<p><strong>核心要点</strong>：</p>
<ul>
<li>不同对象有不同的职责和使用场景</li>
<li>合理分层能提高代码的可维护性和安全性</li>
<li>对象转换是必要的，但要避免过度设计</li>
<li>选择合适的转换工具能提高开发效率</li>
</ul>
<p>掌握了这些概念，相信你在项目开发中再也不会被这些缩写绕晕了！</p>
<p><strong>今日思考</strong>：你们团队在项目中是如何使用这些对象的？有没有什么好的实践经验？欢迎在评论区分享你的看法！</p>
<hr/>
<p><em>如果你觉得这篇文章对你有帮助，欢迎分享给更多的朋友。关注"服务端技术精选"，获取更多技术干货！</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring事务嵌套异常处理深度解析]]></title>    <link>https://juejin.cn/post/7600692485946556425</link>    <guid>https://juejin.cn/post/7600692485946556425</guid>    <pubDate>2026-01-30T05:23:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600692485946556425" data-draft-id="7600675515151368219" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring事务嵌套异常处理深度解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T05:23:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="马卡巴卡"/> <meta itemprop="url" content="https://juejin.cn/user/1892677617451163"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring事务嵌套异常处理深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1892677617451163/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    马卡巴卡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:23:43.000Z" title="Fri Jan 30 2026 05:23:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring事务嵌套异常处理深度解析</h2>
<h2 data-id="heading-1">问题分析</h2>
<p>您遇到的问题是<strong>Spring 事务嵌套使用时的经典陷阱</strong>：当外层方法和内层方法都标注了<code>@Transactional</code>注解，内层方法抛出异常并被外层<code>try-catch</code>捕获，但外层事务提交时仍然报错。</p>
<h3 data-id="heading-2">错误原因</h3>
<p><strong>根本原因在于 Spring 事务的传播机制和事务状态传播</strong>：</p>
<pre><code class="hljs language-sql" lang="sql">org.springframework.transaction.UnexpectedRollbackException: 
Transaction rolled back because it has been marked <span class="hljs-keyword">as</span> <span class="hljs-keyword">rollback</span><span class="hljs-operator">-</span><span class="hljs-keyword">only</span>
</code></pre>
<p>这个错误表明<strong>事务已经被标记为 rollback-only 状态</strong>，即使异常被捕获，这个状态仍然会传播到外层事务。</p>
<h2 data-id="heading-3">事务传播机制详解</h2>
<h3 data-id="heading-4">1. 默认传播行为：REQUIRED</h3>
<p>Spring 默认的事务传播行为是<code>Propagation.REQUIRED</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRED)</span> <span class="hljs-comment">// 默认</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethod</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        innerService.innerMethod();
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// 异常处理</span>
    }
}
</code></pre>
<p><strong>关键特性</strong>：</p>
<ul>
<li>
<p>如果当前已经在一个事务中，则加入当前事务</p>
</li>
<li>
<p>内外层方法<strong>共用同一个事务</strong></p>
</li>
<li>
<p>只要内层方法抛出<code>RuntimeException</code>，<strong>整个事务就会被设置成 rollback-only</strong></p>
</li>
<li>
<p>即使外层<code>try-catch</code>内层异常，<strong>该事务仍然会回滚</strong></p>
</li>
</ul>
<h3 data-id="heading-5">2. 问题演示代码</h3>
<h3 data-id="heading-6">外层方法</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OuterService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">InnerService</span> innerService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserMapper</span> userMapper;
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">outerMethod</span>(<span class="hljs-params">User user</span>) {
        <span class="hljs-comment">// 业务操作</span>
        userMapper.<span class="hljs-title function_">insert</span>(user);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 调用内层事务方法</span>
            innerService.<span class="hljs-title function_">innerMethod</span>();
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-comment">// 捕获异常，但事务已经被标记为rollback-only</span>
            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"内层方法执行异常"</span>, e);
        }
        
        <span class="hljs-comment">// 这里会报错：Transaction rolled back because it has been marked as rollback-only</span>
    }
}
</code></pre>
<h3 data-id="heading-7">内层方法</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">OrderMapper</span> orderMapper;
    
    <span class="hljs-meta">@Transactional</span> <span class="hljs-comment">// 默认Propagation.REQUIRED</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">innerMethod</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务操作</span>
        orderMapper.<span class="hljs-title function_">insert</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>());
        
        <span class="hljs-comment">// 抛出运行时异常</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"内层方法异常"</span>);
    }
}
</code></pre>
<h2 data-id="heading-8">解决方案</h2>
<h3 data-id="heading-9">方案一：使用 NESTED 传播行为</h3>
<p><strong>NESTED 传播行为</strong>允许内层事务作为子事务嵌套在外层事务中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.NESTED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">innerMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"内层方法异常"</span>);
    }
}
</code></pre>
<p><strong>关键特性</strong>：</p>
<ul>
<li>
<p>内层事务嵌套在外层事务中作为子事务</p>
</li>
<li>
<p>内层事务失败可以单独回滚，<strong>不影响外层事务</strong></p>
</li>
<li>
<p><strong>需要外层 try-catch 内层异常</strong></p>
</li>
<li>
<p>基于数据库的 Savepoint 实现</p>
</li>
</ul>
<p><strong>使用前提</strong>：</p>
<ol>
<li>
<p>JDK 版本 1.4+（支持 java.sql.Savepoint）</p>
</li>
<li>
<p>事务管理器的<code>nestedTransactionAllowed</code>属性为 true</p>
</li>
<li>
<p><strong>外层必须 try-catch 内层异常</strong></p>
</li>
</ol>
<h3 data-id="heading-10">方案二：使用 REQUIRES_NEW 传播行为</h3>
<p><strong>REQUIRES_NEW 传播行为</strong>会创建一个全新的独立事务：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">innerMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"内层方法异常"</span>);
    }
}
</code></pre>
<p><strong>关键特性</strong>：</p>
<ul>
<li>
<p>每次调用都会创建新事务</p>
</li>
<li>
<p>如果当前已有事务，会挂起当前事务</p>
</li>
<li>
<p>内层事务独立提交或回滚，<strong>不影响外层事务</strong></p>
</li>
<li>
<p>内层事务结束后立即提交，不等外层事务</p>
</li>
</ul>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p>内层事务回滚后仍然会抛出异常</p>
</li>
<li>
<p>外层需要捕获这个异常，否则外层事务仍然会回滚</p>
</li>
</ul>
<h3 data-id="heading-11">方案三：手动控制事务状态</h3>
<p>如果必须使用默认的 REQUIRED 传播行为，可以通过<strong>编程式事务管理</strong>手动控制事务状态：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OuterService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">TransactionTemplate</span> transactionTemplate;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">InnerService</span> innerService;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">outerMethod</span>(<span class="hljs-params">User user</span>) {
        transactionTemplate.<span class="hljs-title function_">execute</span>(status -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 外层事务操作</span>
                userMapper.<span class="hljs-title function_">insert</span>(user);
                
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 调用内层方法</span>
                    innerService.<span class="hljs-title function_">innerMethod</span>();
                } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                    <span class="hljs-comment">// 内层异常处理</span>
                    log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"内层方法执行异常"</span>, e);
                    <span class="hljs-comment">// 不设置rollback-only</span>
                }
                
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                status.<span class="hljs-title function_">setRollbackOnly</span>();
                <span class="hljs-keyword">throw</span> e;
            }
        });
    }
}
</code></pre>
<h3 data-id="heading-12">方案四：异常重新抛出</h3>
<p>如果确实需要捕获异常并希望事务回滚，可以在捕获后<strong>重新抛出异常</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">outerMethod</span>(<span class="hljs-params">User user</span>) {
    userMapper.<span class="hljs-title function_">insert</span>(user);
    
    <span class="hljs-keyword">try</span> {
        innerService.<span class="hljs-title function_">innerMethod</span>();
    } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
        <span class="hljs-comment">// 异常处理逻辑</span>
        log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"内层方法执行异常"</span>, e);
        <span class="hljs-comment">// 重新抛出异常，触发事务回滚</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"业务异常"</span>, e);
    }
}
</code></pre>
<h2 data-id="heading-13">最佳实践建议</h2>
<h3 data-id="heading-14">1. 事务传播策略选择</h3>





























<table><thead><tr><th>传播行为</th><th>使用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>REQUIRED</td><td>内外层事务需要完全一致的结果</td><td>简单易用，事务一致性好</td><td>异常传播难以控制</td></tr><tr><td>NESTED</td><td>内层事务失败不影响外层事务</td><td>事务粒度更细，灵活性好</td><td>依赖数据库 Savepoint 支持</td></tr><tr><td>REQUIRES_NEW</td><td>内层事务需要独立提交</td><td>完全独立，互不影响</td><td>事务资源消耗较大</td></tr></tbody></table>
<h3 data-id="heading-15">2. 异常处理最佳实践</h3>
<ol>
<li>
<p><strong>避免在事务方法中捕获 RuntimeException</strong>：<br/>
// 错误示例 @Transactional public void method() { try { // 可能抛出RuntimeException的操作 } catch (RuntimeException e) { // 事务不会回滚 } }</p>
</li>
<li>
<p><strong>使用 checked 异常进行业务异常处理</strong>：<br/>
// 正确示例 @Transactional public void method() throws BusinessException { try { // 业务操作 } catch (RuntimeException e) { throw new BusinessException("业务异常", e); } }</p>
</li>
<li>
<p><strong>明确指定 rollbackFor 属性</strong>：<br/>
@Transactional(rollbackFor = {BusinessException.class, RuntimeException.class}) public void method() throws BusinessException { // 业务逻辑 }</p>
</li>
</ol>
<h3 data-id="heading-16">3. 事务设计原则</h3>
<ol>
<li>
<p><strong>保持事务方法的单一职责</strong>：<br/>
// 好的设计 @Transactional public void createUser(User user) { // 只包含用户创建相关操作 } @Transactional public void createOrder(Order order) { // 只包含订单创建相关操作 }</p>
</li>
<li>
<p><strong>避免过长的事务</strong>：<br/>
// 避免在事务中执行耗时操作 @Transactional public void method() { // 数据库操作 // 避免：远程调用、文件IO、复杂计算等耗时操作 }</p>
</li>
<li>
<p><strong>事务边界明确</strong>：<br/>
// 事务方法应该是业务逻辑的完整单元 @Service public class BusinessService { @Transactional public void completeBusinessProcess(BusinessData data) { // 完整的业务流程 validateData(data); createEntity(data); updateRelatedData(data); sendNotification(data); } }</p>
</li>
</ol>
<h2 data-id="heading-17">总结</h2>
<p>Spring 事务嵌套异常处理的核心在于<strong>理解事务传播机制和异常传播行为</strong>：</p>
<ol>
<li>
<p><strong>默认的 REQUIRED 传播行为</strong>会导致内外层事务共用同一个事务上下文</p>
</li>
<li>
<p><strong>RuntimeException 会自动标记事务为 rollback-only</strong>，即使被捕获</p>
</li>
<li>
<p><strong>合理选择事务传播行为</strong>（NESTED 或 REQUIRES_NEW）可以解决大部分问题</p>
</li>
<li>
<p><strong>编程式事务管理</strong>提供了最灵活的事务控制方式</p>
</li>
</ol>
<p>在实际开发中，应该根据<strong>业务需求的事务一致性要求</strong>选择合适的事务传播策略，并遵循异常处理的最佳实践，以避免类似的事务陷阱。</p>
<p><strong>记住：事务管理的目标是保证数据一致性，而不是简单地捕获异常。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3侦听器实战：组件与Pinia状态监听如何高效应用？]]></title>    <link>https://juejin.cn/post/7600670487410180148</link>    <guid>https://juejin.cn/post/7600670487410180148</guid>    <pubDate>2026-01-30T03:59:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670487410180148" data-draft-id="7600692485946343433" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3侦听器实战：组件与Pinia状态监听如何高效应用？   "/> <meta itemprop="keywords" content="前端,Vue.js,Trae"/> <meta itemprop="datePublished" content="2026-01-30T03:59:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kknone"/> <meta itemprop="url" content="https://juejin.cn/user/1366025597879930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3侦听器实战：组件与Pinia状态监听如何高效应用？   
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1366025597879930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kknone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:59:54.000Z" title="Fri Jan 30 2026 03:59:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 侦听器实战案例——在组件与Pinia中的应用</h2>
<h3 data-id="heading-1">一、组件内的侦听器基础</h3>
<h4 data-id="heading-2">1.1 基本概念与使用场景</h4>
<p>侦听器是Vue3中用于响应数据变化的核心工具，当你需要在数据变化时执行异步或复杂的操作时，侦听器就派上用场了。比如：</p>
<ul>
<li>数据变化时发送API请求</li>
<li>表单验证</li>
<li>复杂的状态联动</li>
</ul>
<h5 data-id="heading-3">Options API 写法</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">question</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">answer</span>: <span class="hljs-string">'Questions usually contain a question mark. ;-)'</span>,
      <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>
    }
  },
  <span class="hljs-attr">watch</span>: {
    <span class="hljs-comment">// 当question变化时触发</span>
    <span class="hljs-title function_">question</span>(<span class="hljs-params">newQuestion, oldQuestion</span>) {
      <span class="hljs-keyword">if</span> (newQuestion.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'?'</span>)) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAnswer</span>()
      }
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAnswer</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">answer</span> = <span class="hljs-string">'Thinking...'</span>
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://yesno.wtf/api'</span>)
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">answer</span> = (<span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>()).<span class="hljs-property">answer</span>
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">answer</span> = <span class="hljs-string">'Error! Could not reach the API. '</span> + error
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>
      }
    }
  }
}
</code></pre>
<h5 data-id="heading-4">Composition API 写法</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref, watch } from 'vue'

const question = ref('')
const answer = ref('Questions usually contain a question mark. ;-)')
const loading = ref(false)

// 直接监听ref
watch(question, async (newQuestion, oldQuestion) =&gt; {
  if (newQuestion.includes('?')) {
    loading.value = true
    answer.value = 'Thinking...'
    try {
      const res = await fetch('https://yesno.wtf/api')
      answer.value = (await res.json()).answer
    } catch (error) {
      answer.value = 'Error! Could not reach the API. ' + error
    } finally {
      loading.value = false
    }
  }
})
&lt;/script&gt;

&lt;template&gt;
  &lt;p&gt;
    Ask a yes/no question:
    &lt;input v-model="question" :disabled="loading" /&gt;
  &lt;/p&gt;
  &lt;p&gt;{{ answer }}&lt;/p&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-5">1.2 深度侦听器</h4>
<p>默认情况下，侦听器是浅层的，只会监听引用类型的引用变化，不会监听内部属性变化。如果需要监听嵌套对象的变化，需要使用深度侦听器。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
  <span class="hljs-attr">address</span>: {
    <span class="hljs-attr">city</span>: <span class="hljs-string">'New York'</span>
  }
})

<span class="hljs-comment">// 深度侦听整个对象</span>
<span class="hljs-title function_">watch</span>(user, <span class="hljs-function">(<span class="hljs-params">newUser, oldUser</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User changed:'</span>, newUser)
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// 或者只侦听嵌套属性</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> user.<span class="hljs-property">address</span>.<span class="hljs-property">city</span>, <span class="hljs-function">(<span class="hljs-params">newCity</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'City changed to:'</span>, newCity)
})
</code></pre>
<h4 data-id="heading-6">1.3 立即执行侦听器</h4>
<p>默认情况下，侦听器是懒加载的，只有当数据变化时才会触发。如果需要在组件创建时立即执行一次，可以使用<code>immediate: true</code>选项。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">watch</span>(question, <span class="hljs-function">(<span class="hljs-params">newQuestion</span>) =&gt;</span> {
  <span class="hljs-comment">// 这个回调会在组件创建时立即执行一次</span>
}, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> })
</code></pre>
<h4 data-id="heading-7">1.4 watchEffect 的使用</h4>
<p><code>watchEffect</code>是Vue3提供的另一种侦听器，它会自动追踪回调函数中的响应式依赖，当依赖变化时自动触发。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> todoId = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)
<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">// 自动追踪todoId的变化</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(
    <span class="hljs-string">`https://jsonplaceholder.typicode.com/todos/<span class="hljs-subst">${todoId.value}</span>`</span>
  )
  data.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
})
</code></pre>
<p><code>watch</code> vs <code>watchEffect</code> 对比流程图：</p>
<pre><code class="hljs">┌─────────────────┐     ┌─────────────────┐
│   watch         │     │   watchEffect   │
├─────────────────┤     ├─────────────────┤
│ 显式指定依赖    │     │ 自动追踪依赖    │
│ 懒加载（默认）  │     │ 立即执行        │
│ 可获取新旧值    │     │ 无法获取旧值    │
│ 更精确控制      │     │ 更简洁语法      │
└─────────────────┘     └─────────────────┘
</code></pre>
<h3 data-id="heading-8">二、Pinia中的侦听器应用</h3>
<h4 data-id="heading-9">2.1 监听Pinia Store中的状态</h4>
<p>在Pinia中，</p>
<details>
<summary>往期文章归档</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcdbbb1837f8c093252e61f46dbf0a2e7%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cdbbb1837f8c093252e61f46dbf0a2e7/" ref="nofollow noopener noreferrer">Vue 3中何时用watch，何时用watchEffect？核心区别及性能优化策略是什么？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F09551ab614c463a6d6ca69818e8c2d52%2F" target="_blank" title="https://blog.cmdragon.cn/posts/09551ab614c463a6d6ca69818e8c2d52/" ref="nofollow noopener noreferrer">Vue 3中如何有效管理侦听器的暂停、恢复与副作用清理？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb7bca5d20f628ac09f7192ad935ef664%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b7bca5d20f628ac09f7192ad935ef664/" ref="nofollow noopener noreferrer">Vue 3 watchEffect：如何实现响应式依赖的自动追踪与副作用管理？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2c6cdb100a20f10c7e7d4413617c7ea9%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2c6cdb100a20f10c7e7d4413617c7ea9/" ref="nofollow noopener noreferrer">Vue 3 watch如何利用immediate、once、deep选项实现初始化、一次性与深度监听？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F757a1728bc1b9c0c8b317b0354d85568%2F" target="_blank" title="https://blog.cmdragon.cn/posts/757a1728bc1b9c0c8b317b0354d85568/" ref="nofollow noopener noreferrer">Vue 3中watch如何高效监听多数据源、计算结果与数组变化？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F8e70552f0f61e0dc8c7f567a2d272345%2F" target="_blank" title="https://blog.cmdragon.cn/posts/8e70552f0f61e0dc8c7f567a2d272345/" ref="nofollow noopener noreferrer">Vue 3中watch监听ref和reactive的核心差异与注意事项是什么？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fdde70ab90dc5062c435e0501f5a6e7cb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/dde70ab90dc5062c435e0501f5a6e7cb/" ref="nofollow noopener noreferrer">Vue3中Watch与watchEffect的核心差异及适用场景是什么？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1f5ed5047850ed52c0fd0386f76bd4ae%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1f5ed5047850ed52c0fd0386f76bd4ae/" ref="nofollow noopener noreferrer">Vue 3自定义指令如何赋能表单自动聚焦与防抖输入的高效实现？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe3d4e128815ad731611b8ef29e37616b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e3d4e128815ad731611b8ef29e37616b/" ref="nofollow noopener noreferrer">Vue3中如何优雅实现支持多绑定变量和修饰符的双向绑定组件？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7d1caedd822f70542aa0eed67e30963b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7d1caedd822f70542aa0eed67e30963b/" ref="nofollow noopener noreferrer">Vue 3表单验证如何从基础规则到异步交互构建完整验证体系？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F3687a5437ab56cb082b5b813d5577a40%2F" target="_blank" title="https://blog.cmdragon.cn/posts/3687a5437ab56cb082b5b813d5577a40/" ref="nofollow noopener noreferrer">Vue3响应式系统如何支撑表单数据的集中管理、动态扩展与实时计算？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fad67c4eb6d76cf7707bdfe6a8146c34f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ad67c4eb6d76cf7707bdfe6a8146c34f/" ref="nofollow noopener noreferrer">Vue3跨组件通信中，全局事件总线与provide/inject该如何正确选择？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1c1e80d697cca0923f29ec70ebb8ccd1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1c1e80d697cca0923f29ec70ebb8ccd1/" ref="nofollow noopener noreferrer">Vue3表单事件处理：v-model如何实现数据绑定、验证与提交？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb990828143d70aa87f9aa52e16692e48%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b990828143d70aa87f9aa52e16692e48/" ref="nofollow noopener noreferrer">Vue应用如何基于DOM事件传播机制与事件修饰符实现高效事件处理？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb44316e0866e9f2e6aef927dbcf5152b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b44316e0866e9f2e6aef927dbcf5152b/" ref="nofollow noopener noreferrer">Vue3中如何在调用事件处理函数时同时传递自定义参数和原生DOM事件？参数顺序有哪些注意事项？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F021636c2a06f5e2d3d01977a12ddf559%2F" target="_blank" title="https://blog.cmdragon.cn/posts/021636c2a06f5e2d3d01977a12ddf559/" ref="nofollow noopener noreferrer">从捕获到冒泡：Vue事件修饰符如何重塑事件执行顺序？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb3cddf7023ab537e623a61bc01dab6bb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b3cddf7023ab537e623a61bc01dab6bb/" ref="nofollow noopener noreferrer">Vue事件处理：内联还是方法事件处理器，该如何抉择？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd4d9607ce1bc34cc3bda0a1a46c40f6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd4d9607ce1bc34cc3bda0a1a46c40f6/" ref="nofollow noopener noreferrer">Vue事件绑定中v-on与@语法如何取舍？参数传递与原生事件处理有哪些实战技巧？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa5f2bacb74476fd7f5e02bb3f1ba6b2b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a5f2bacb74476fd7f5e02bb3f1ba6b2b/" ref="nofollow noopener noreferrer">Vue 3中列表排序时为何必须复制数组而非直接修改原始数据？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd3b06b57fb7f126787e6ed22dce1e341%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d3b06b57fb7f126787e6ed22dce1e341/" ref="nofollow noopener noreferrer">Vue虚拟滚动如何将列表DOM数量从万级降至十位数？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F3100cc5a2e16f8dac36f722594e6af32%2F" target="_blank" title="https://blog.cmdragon.cn/posts/3100cc5a2e16f8dac36f722594e6af32/" ref="nofollow noopener noreferrer">Vue3中v-if与v-for直接混用为何会报错？计算属性如何解决优先级冲突？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F455dc2d47c38d12c1cf350e490041e8b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/455dc2d47c38d12c1cf350e490041e8b/" ref="nofollow noopener noreferrer">为何在Vue3递归组件中必须用v-if判断子项存在？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F3f842bbd7ba0f9c91151b983bf784c8b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/3f842bbd7ba0f9c91151b983bf784c8b/" ref="nofollow noopener noreferrer">Vue3列表渲染中，如何用数组方法与计算属性优化v-for的数据处理？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1eb3ffac668a743843b5ea1738301d40%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1eb3ffac668a743843b5ea1738301d40/" ref="nofollow noopener noreferrer">Vue v-for的key：为什么它能解决列表渲染中的“玄学错误”？选错会有哪些后果？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F138b13c5341f6a1fa9015400433a3611%2F" target="_blank" title="https://blog.cmdragon.cn/posts/138b13c5341f6a1fa9015400433a3611/" ref="nofollow noopener noreferrer">Vue3中v-for与v-if为何不能直接共存于同一元素？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0242a94dc552b93a1bc335ac4fc33db5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0242a94dc552b93a1bc335ac4fc33db5/" ref="nofollow noopener noreferrer">Vue3中v-if与v-show的本质区别及动态组件状态保持的关键策略是什么？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F97c66a18ae0e9b57c6a69b8b3a41ddf6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/97c66a18ae0e9b57c6a69b8b3a41ddf6/" ref="nofollow noopener noreferrer">Vue3中v-show如何通过CSS修改display属性控制条件显示？与v-if的应用场景该如何区分？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F8a1ddfac64b25062ac56403e4c1201d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/8a1ddfac64b25062ac56403e4c1201d2/" ref="nofollow noopener noreferrer">Vue3条件渲染中v-if系列指令如何合理使用与规避错误？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F218c3a59282c3b757447ee08a01937bb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/218c3a59282c3b757447ee08a01937bb/" ref="nofollow noopener noreferrer">Vue3动态样式控制：ref、reactive、watch与computed的应用场景与区别是什么？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1bab953e41f66ac53de099fa9fe76483%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1bab953e41f66ac53de099fa9fe76483/" ref="nofollow noopener noreferrer">Vue3中动态样式数组的后项覆盖规则如何与计算属性结合实现复杂状态样式管理？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc85e1fe16a7ae45e965b4e2df4d9d2f4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c85e1fe16a7ae45e965b4e2df4d9d2f4/" ref="nofollow noopener noreferrer">Vue浅响应式如何解决深层响应式的性能问题？适用场景有哪些？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa0af08dd60a37b9a890a9957f2cbfc9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a0af08dd60a37b9a890a9957f2cbfc9f/" ref="nofollow noopener noreferrer">Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbc287e1e36287afd90750fd907eca85e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bc287e1e36287afd90750fd907eca85e/" ref="nofollow noopener noreferrer">Vue 3中watch侦听器的正确使用姿势你掌握了吗？深度监听、与watchEffect的差异及常见报错解析 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc405a8d9950af5b7c63b56c348ac36b6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c405a8d9950af5b7c63b56c348ac36b6/" ref="nofollow noopener noreferrer">为什么Vue 3需要ref函数？它的响应式原理与正确用法是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa7e9abb9691a81e4404d9facabe0f7c3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a7e9abb9691a81e4404d9facabe0f7c3/" ref="nofollow noopener noreferrer">Vue 3中reactive函数如何通过Proxy实现响应式？使用时要避开哪些误区？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd995ea45161727597fb85b62566c43d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd995ea45161727597fb85b62566c43d/" ref="nofollow noopener noreferrer">Vue3响应式系统的底层原理与实践要点你真的懂吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F53e3f270a80675df662c6857a3332c0f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/53e3f270a80675df662c6857a3332c0f/" ref="nofollow noopener noreferrer">Vue 3模板如何通过编译三阶段实现从声明式语法到高效渲染的跨越 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbce4f2a23aa72c96b1c0473900321e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbce4f2a23aa72c96b1c0473900321e/" ref="nofollow noopener noreferrer">快速入门Vue模板引用：从收DOM“快递”到调子组件方法，你玩明白了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F23a2d5a334e15575277814c16e45df50%2F" target="_blank" title="https://blog.cmdragon.cn/posts/23a2d5a334e15575277814c16e45df50/" ref="nofollow noopener noreferrer">快速入门Vue模板里的JS表达式有啥不能碰？计算属性为啥比方法更能打？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6be38de6382e31d282659b689c5b17f0%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6be38de6382e31d282659b689c5b17f0/" ref="nofollow noopener noreferrer">快速入门Vue的v-model表单绑定：语法糖、动态值、修饰符的小技巧你都掌握了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F60ce517684f4a418f453d66aa805606c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/60ce517684f4a418f453d66aa805606c/" ref="nofollow noopener noreferrer">快速入门Vue3事件处理的挑战题：v-on、修饰符、自定义事件你能通关吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe4ae7d5e4a9205bb11b2baccb230c637%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e4ae7d5e4a9205bb11b2baccb230c637/" ref="nofollow noopener noreferrer">快速入门Vue3的v-指令：数据和DOM的“翻译官”到底有多少本事？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F999ce4fb32259ff4fbf4bf7bcb851654%2F" target="_blank" title="https://blog.cmdragon.cn/posts/999ce4fb32259ff4fbf4bf7bcb851654/" ref="nofollow noopener noreferrer">快速入门Vue3，插值、动态绑定和避坑技巧你都搞懂了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa6997d81b49cd232b87e1cf603888ad1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a6997d81b49cd232b87e1cf603888ad1/" ref="nofollow noopener noreferrer">想让PostgreSQL快到飞起？先找健康密码还是先换引擎？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1fee7afbb9abd4540b8aa9c141d6845d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1fee7afbb9abd4540b8aa9c141d6845d/" ref="nofollow noopener noreferrer">想让PostgreSQL查询快到飞起？分区表、物化视图、并行查询这三招灵不灵？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F79c590fbd87ece535b11a71c9667884f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/79c590fbd87ece535b11a71c9667884f/" ref="nofollow noopener noreferrer">子查询总拖慢查询？把它变成连接就能解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F748cdac2536008199abf8a8a2cd0ec85%2F" target="_blank" title="https://blog.cmdragon.cn/posts/748cdac2536008199abf8a8a2cd0ec85/" ref="nofollow noopener noreferrer">PostgreSQL全表扫描慢到崩溃？建索引+改查询+更统计信息三招能破？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F32ca943703226d317d4276a8fb53b0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/32ca943703226d317d4276a8fb53b0dd/" ref="nofollow noopener noreferrer">复杂查询总拖后腿？PostgreSQL多列索引+覆盖索引的神仙技巧你get没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fca93f1d53aa910e7ba5ffd8df611c12b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ca93f1d53aa910e7ba5ffd8df611c12b/" ref="nofollow noopener noreferrer">只给表子集建索引？用函数结果建索引？PostgreSQL这俩操作凭啥能省空间又加速？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ff507856ebfddd592448813c510a53669%2F" target="_blank" title="https://blog.cmdragon.cn/posts/f507856ebfddd592448813c510a53669/" ref="nofollow noopener noreferrer">B-tree索引像字典查词一样工作？那哪些数据库查询它能加速，哪些不能？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb2213bfcb5b88a862f2138404c03d596%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b2213bfcb5b88a862f2138404c03d596/" ref="nofollow noopener noreferrer">想抓PostgreSQL里的慢SQL？pg_stat_statements基础黑匣子和pg_stat_monitor时间窗，谁能帮你更准揪出性能小偷？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F26614eb7da6c476dde41d367ad888d2f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/26614eb7da6c476dde41d367ad888d2f/" ref="nofollow noopener noreferrer">PostgreSQL的“时光机”MVCC和锁机制是怎么搞定高并发的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F69f99bc6972a860d559c74aad7280da4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/69f99bc6972a860d559c74aad7280da4/" ref="nofollow noopener noreferrer">PostgreSQL性能暴涨的关键？内存IO并发参数居然要这么设置？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7b7053f392147a8b3b1a16bebeb08d0a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7b7053f392147a8b3b1a16bebeb08d0a/" ref="nofollow noopener noreferrer">大表查询慢到翻遍整个书架？PostgreSQL分区表教你怎么“分类”才高效</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc856e3cb073822349f3bf2d29995dcfc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c856e3cb073822349f3bf2d29995dcfc/" ref="nofollow noopener noreferrer">PostgreSQL 查询慢？是不是忘了优化 GROUP BY、ORDER BY 和窗口函数？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc096347d18e67b7431faacd2c4757093%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c096347d18e67b7431faacd2c4757093/" ref="nofollow noopener noreferrer">PostgreSQL里的子查询和CTE居然在性能上“掐架”？到底该站哪边？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2eca89463454fd4250d7b66243b9fe5a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2eca89463454fd4250d7b66243b9fe5a/" ref="nofollow noopener noreferrer">PostgreSQL选Join策略有啥小九九？Nested Loop/Merge/Hash谁是它的菜？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F068ecb772a87d7df20a8c9fb4b233f8e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/068ecb772a87d7df20a8c9fb4b233f8e/" ref="nofollow noopener noreferrer">PostgreSQL新手SQL总翻车？这7个性能陷阱你踩过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd498f63cd0a2d5a77e445c688a8b88db%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d498f63cd0a2d5a77e445c688a8b88db/" ref="nofollow noopener noreferrer">PostgreSQL索引选B-Tree还是GiST？“瑞士军刀”和“多面手”的差别你居然还不知道？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F9101b75bdec6faea9b35d54f14e37f36%2F" target="_blank" title="https://blog.cmdragon.cn/posts/9101b75bdec6faea9b35d54f14e37f36/" ref="nofollow noopener noreferrer">想知道数据库怎么给查询“算成本选路线”？EXPLAIN能帮你看明白？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd527f8ebb6e3dae2c7dfe4c8d8979444%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d527f8ebb6e3dae2c7dfe4c8d8979444/" ref="nofollow noopener noreferrer">PostgreSQL处理SQL居然像做蛋糕？解析到执行的4步里藏着多少查询优化的小心机？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6bfdae84f313cf7ad0bb7045c4392347%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6bfdae84f313cf7ad0bb7045c4392347/" ref="nofollow noopener noreferrer">PostgreSQL备份不是复制文件？物理vs逻辑咋选？误删还能精准恢复到1分钟前？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fde3672803de34dbad244d0a8d48b0eb5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/de3672803de34dbad244d0a8d48b0eb5/" ref="nofollow noopener noreferrer">转账不翻车、并发不干扰，PostgreSQL的ACID特性到底有啥魔法？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe463e8a2668abdf00a228c9b79324ded%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e463e8a2668abdf00a228c9b79324ded/" ref="nofollow noopener noreferrer">银行转账不白扣钱、电商下单不超卖，PostgreSQL事务的诀窍是啥？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F5c967e595058c4a1fc4474a68e64031d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/5c967e595058c4a1fc4474a68e64031d/" ref="nofollow noopener noreferrer">PostgreSQL里的PL/pgSQL到底是啥？能让SQL从“说目标”变“讲步骤”？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F325047855e3e23b5ef82f7d2db134fbd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/325047855e3e23b5ef82f7d2db134fbd/" ref="nofollow noopener noreferrer">PostgreSQL视图不存数据？那它怎么简化查询还能递归生成序列和控制权限？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd2dba50bb6e4df7b27e735245a06a2a2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d2dba50bb6e4df7b27e735245a06a2a2/" ref="nofollow noopener noreferrer">PostgreSQL索引这么玩，才能让你的查询真的“飞”起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F849ae5bab0f8c66e94c2f6ad1bb798e3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/849ae5bab0f8c66e94c2f6ad1bb798e3/" ref="nofollow noopener noreferrer">PostgreSQL的表关系和约束，咋帮你搞定用户订单不混乱、学生选课不重复？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fef4800975ffa84f1ca51976a70a1585b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ef4800975ffa84f1ca51976a70a1585b/" ref="nofollow noopener noreferrer">PostgreSQL查询的筛子、排序、聚合、分组？你会用它们搞定数据吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf54711525c507c5eacfa7b0151c39d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf54711525c507c5eacfa7b0151c39d2/" ref="nofollow noopener noreferrer">PostgreSQL数据类型怎么选才高效不踩坑？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F887809b3e0375f5956873cd442f516d8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/887809b3e0375f5956873cd442f516d8/" ref="nofollow noopener noreferrer">想解锁PostgreSQL查询从基础到进阶的核心知识点？你都get了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F934be1203725e8be9d6f6e9104e5abcc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/934be1203725e8be9d6f6e9104e5abcc/" ref="nofollow noopener noreferrer">PostgreSQL DELETE居然有这些操作？返回数据、连表删你试过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0f0622e9b7402b599e618150d0596ffe%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0f0622e9b7402b599e618150d0596ffe/" ref="nofollow noopener noreferrer">PostgreSQL UPDATE语句怎么玩？从改邮箱到批量更新的避坑技巧你都会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0e3bf7efc030b024ea67ee855a00f2de%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0e3bf7efc030b024ea67ee855a00f2de/" ref="nofollow noopener noreferrer">PostgreSQL插入数据还在逐条敲？批量、冲突处理、返回自增ID的技巧你会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb6cd3c86da6aac26ed829e472d34078e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b6cd3c86da6aac26ed829e472d34078e/" ref="nofollow noopener noreferrer">PostgreSQL的“仓库-房间-货架”游戏，你能建出电商数据库和表吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fba1f545a3410144552fbdbfcf31b5265%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ba1f545a3410144552fbdbfcf31b5265/" ref="nofollow noopener noreferrer">PostgreSQL 17安装总翻车？Windows/macOS/Linux避坑指南帮你搞定？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb5474d1480509c5072085abc80b3dd9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b5474d1480509c5072085abc80b3dd9f/" ref="nofollow noopener noreferrer">能当关系型数据库还能玩对象特性，能拆复杂查询还能自动管库存，PostgreSQL凭什么这么香？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcc098d8836e787baa8a4d92e4d56d5c5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cc098d8836e787baa8a4d92e4d56d5c5/" ref="nofollow noopener noreferrer">给接口加新字段又不搞崩老客户端？FastAPI的多版本API靠哪三招实现？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F46d05151c5bd31cf37a7bcf0b8f5b0b8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/46d05151c5bd31cf37a7bcf0b8f5b0b8/" ref="nofollow noopener noreferrer">流量突增要搞崩FastAPI？熔断测试是怎么防系统雪崩的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F65ce343cc5df9faf3a8e2eeaab42ae45%2F" target="_blank" title="https://blog.cmdragon.cn/posts/65ce343cc5df9faf3a8e2eeaab42ae45/" ref="nofollow noopener noreferrer">FastAPI秒杀库存总变负数？Redis分布式锁能帮你守住底线吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Feed6cd8985d9be0a4b092a7da38b3e0c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/eed6cd8985d9be0a4b092a7da38b3e0c/" ref="nofollow noopener noreferrer">FastAPI的CI流水线怎么自动测端点，还能让Allure报告美到犯规？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6157d87338ce894d18c013c3c4777abb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6157d87338ce894d18c013c3c4777abb/" ref="nofollow noopener noreferrer">如何用GitHub Actions为FastAPI项目打造自动化测试流水线？ - cmdragon's Blog</a></li>
</ul>
</details>
<details>
<summary>免费好用的热门在线工具</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffile-converter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/file-converter" ref="nofollow noopener noreferrer">文件格式转换器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fm3u8-player" target="_blank" title="https://tools.cmdragon.cn/zh/apps/m3u8-player" ref="nofollow noopener noreferrer">M3U8在线播放器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fquick-image-design" target="_blank" title="https://tools.cmdragon.cn/zh/apps/quick-image-design" ref="nofollow noopener noreferrer">快图设计 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-advanced" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-advanced" ref="nofollow noopener noreferrer">高级文字转图片转换器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fraid-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/raid-calculator" ref="nofollow noopener noreferrer">RAID 计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fphotoshop-online" target="_blank" title="https://tools.cmdragon.cn/zh/apps/photoshop-online" ref="nofollow noopener noreferrer">在线PS - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmermaid-live-editor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/mermaid-live-editor" ref="nofollow noopener noreferrer">Mermaid 在线编辑器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmath-solver-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/math-solver-calculator" ref="nofollow noopener noreferrer">数学求解计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsmart-teleprompter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/smart-teleprompter" ref="nofollow noopener noreferrer">智能提词器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmagic-resume" target="_blank" title="https://tools.cmdragon.cn/zh/apps/magic-resume" ref="nofollow noopener noreferrer">魔法简历 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-puzzle-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-puzzle-tool" ref="nofollow noopener noreferrer">Image Puzzle Tool - 图片拼图工具 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsubtitle-downloader" target="_blank" title="https://tools.cmdragon.cn/zh/apps/subtitle-downloader" ref="nofollow noopener noreferrer">字幕下载工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flyrics-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lyrics-generator" ref="nofollow noopener noreferrer">歌词生成工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcloud-drive-search" target="_blank" title="https://tools.cmdragon.cn/zh/apps/cloud-drive-search" ref="nofollow noopener noreferrer">网盘资源聚合搜索 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fascii-art-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ascii-art-generator" ref="nofollow noopener noreferrer">ASCII字符画生成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fjwt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/jwt-tool" ref="nofollow noopener noreferrer">JSON Web Tokens 工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbcrypt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/bcrypt-tool" ref="nofollow noopener noreferrer">Bcrypt 密码工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-composer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-composer" ref="nofollow noopener noreferrer">GIF 合成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-decomposer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-decomposer" ref="nofollow noopener noreferrer">GIF 分解器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-steganography" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-steganography" ref="nofollow noopener noreferrer">文本隐写术 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh" target="_blank" title="https://tools.cmdragon.cn/zh" ref="nofollow noopener noreferrer">CMDragon 在线工具 - 高级AI工具箱与开发者套件 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%3Fcategory%3Dtrending" target="_blank" title="https://tools.cmdragon.cn/zh/apps?category=trending" ref="nofollow noopener noreferrer">应用商店 - 发现1000+提升效率与开发的AI工具和实用程序 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fchangelog" target="_blank" title="https://tools.cmdragon.cn/zh/changelog" ref="nofollow noopener noreferrer">CMDragon 更新日志 - 最新更新、功能与改进 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fsponsor" target="_blank" title="https://tools.cmdragon.cn/zh/sponsor" ref="nofollow noopener noreferrer">支持我们 - 成为赞助者 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-ai" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-ai" ref="nofollow noopener noreferrer">AI文本生成图像 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftemp-email" target="_blank" title="https://tools.cmdragon.cn/zh/apps/temp-email" ref="nofollow noopener noreferrer">临时邮箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fqrcode-parser" target="_blank" title="https://tools.cmdragon.cn/zh/apps/qrcode-parser" ref="nofollow noopener noreferrer">二维码解析器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-mindmap" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-mindmap" ref="nofollow noopener noreferrer">文本转思维导图 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fregex-visualizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/regex-visualizer" ref="nofollow noopener noreferrer">正则表达式可视化工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsteganography-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/steganography-tool" ref="nofollow noopener noreferrer">文件隐写工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fiptv-explorer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/iptv-explorer" ref="nofollow noopener noreferrer">IPTV 频道探索器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsnapdrop" target="_blank" title="https://tools.cmdragon.cn/zh/apps/snapdrop" ref="nofollow noopener noreferrer">快传 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flucky-draw" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lucky-draw" ref="nofollow noopener noreferrer">随机抽奖工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fanime-scene-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/anime-scene-finder" ref="nofollow noopener noreferrer">动漫场景查找器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftime-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/time-toolkit" ref="nofollow noopener noreferrer">时间工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fspeed-test" target="_blank" title="https://tools.cmdragon.cn/zh/apps/speed-test" ref="nofollow noopener noreferrer">网速测试 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-remover" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-remover" ref="nofollow noopener noreferrer">AI 智能抠图工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-replacer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-replacer" ref="nofollow noopener noreferrer">背景替换工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fartistic-qrcode" target="_blank" title="https://tools.cmdragon.cn/zh/apps/artistic-qrcode" ref="nofollow noopener noreferrer">艺术二维码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fopen-graph-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/open-graph-generator" ref="nofollow noopener noreferrer">Open Graph 元标签生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-comparison" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-comparison" ref="nofollow noopener noreferrer">图像对比工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-compressor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-compressor" ref="nofollow noopener noreferrer">图片压缩专业版 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fpassword-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/password-generator" ref="nofollow noopener noreferrer">密码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsvg-optimizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/svg-optimizer" ref="nofollow noopener noreferrer">SVG优化器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcolor-palette" target="_blank" title="https://tools.cmdragon.cn/zh/apps/color-palette" ref="nofollow noopener noreferrer">调色板生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fonline-metronome" target="_blank" title="https://tools.cmdragon.cn/zh/apps/online-metronome" ref="nofollow noopener noreferrer">在线节拍器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcss-grid-layout" target="_blank" title="https://tools.cmdragon.cn/zh/apps/css-grid-layout" ref="nofollow noopener noreferrer">CSS网格布局生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Femail-validator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/email-validator" ref="nofollow noopener noreferrer">邮箱验证工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcalligraphy-practice" target="_blank" title="https://tools.cmdragon.cn/zh/apps/calligraphy-practice" ref="nofollow noopener noreferrer">书法练习字帖 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffinance-calculator-suite" target="_blank" title="https://tools.cmdragon.cn/zh/apps/finance-calculator-suite" ref="nofollow noopener noreferrer">金融计算器套件 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fchinese-kinship-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/chinese-kinship-calculator" ref="nofollow noopener noreferrer">中国亲戚关系计算器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fprotobuf-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/protobuf-toolkit" ref="nofollow noopener noreferrer">Protocol Buffer 工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-upscaler" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-upscaler" ref="nofollow noopener noreferrer">图片无损放大 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-compare" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-compare" ref="nofollow noopener noreferrer">文本比较工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-batch-lookup" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-batch-lookup" ref="nofollow noopener noreferrer">IP批量查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdomain-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/domain-finder" ref="nofollow noopener noreferrer">域名查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdns-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/dns-toolkit" ref="nofollow noopener noreferrer">DNS工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffavicon-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/favicon-generator" ref="nofollow noopener noreferrer">网站图标生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fsitemap_index.xml" target="_blank" title="https://tools.cmdragon.cn/sitemap_index.xml" ref="nofollow noopener noreferrer">XML Sitemap</a></li>
</ul>
</details>
我们可以使用Vue的`watch`函数来监听store中的状态变化。
<p>首先创建一个Pinia store：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// stores/counter.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello Pinia'</span>
  }),
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++
    }
  }
})
</code></pre>
<p>然后在组件中监听store状态：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { watch } from 'vue'
import { useCounterStore } from '@/stores/counter'

const counterStore = useCounterStore()

// 监听单个状态
watch(() =&gt; counterStore.count, (newCount, oldCount) =&gt; {
  console.log(`Count changed from ${oldCount} to ${newCount}`)
})

// 监听多个状态
watch([() =&gt; counterStore.count, () =&gt; counterStore.message], 
  ([newCount, newMessage], [oldCount, oldMessage]) =&gt; {
    console.log(`Count: ${oldCount} -&gt; ${newCount}`)
    console.log(`Message: ${oldMessage} -&gt; ${newMessage}`)
  }
)

// 深度监听整个store
watch(counterStore, (newStore, oldStore) =&gt; {
  console.log('Store changed:', newStore)
}, { deep: true })
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-10">2.2 实战案例：表单状态同步</h4>
<p>假设我们有一个表单组件，需要将表单数据同步到Pinia store中，同时当store中的数据变化时，表单也需要更新。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref, watch } from 'vue'
import { useFormStore } from '@/stores/form'

const formStore = useFormStore()

// 本地表单数据
const localForm = ref({
  name: '',
  email: ''
})

// 组件创建时同步store数据到本地
localForm.value = { ...formStore.formData }

// 监听本地表单变化，同步到store
watch(localForm, (newForm) =&gt; {
  formStore.updateFormData(newForm)
}, { deep: true })

// 监听store数据变化，同步到本地
watch(() =&gt; formStore.formData, (newForm) =&gt; {
  localForm.value = { ...newForm }
}, { deep: true })
&lt;/script&gt;

&lt;template&gt;
  &lt;form&gt;
    &lt;input v-model="localForm.name" placeholder="Name" /&gt;
    &lt;input v-model="localForm.email" placeholder="Email" type="email" /&gt;
  &lt;/form&gt;
&lt;/template&gt;
</code></pre>
<p>Pinia store代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// stores/form.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useFormStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'form'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">formData</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>
    }
  }),
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">updateFormData</span>(<span class="hljs-params">newData</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">formData</span> = { ...newData }
    }
  }
})
</code></pre>
<h3 data-id="heading-11">三、课后Quiz</h3>
<h4 data-id="heading-12">问题1：watch和watchEffect的主要区别是什么？</h4>
<p><strong>答案解析：</strong></p>
<ol>
<li><strong>依赖追踪方式</strong>：watch需要显式指定依赖，而watchEffect会自动追踪回调中的响应式依赖。</li>
<li><strong>执行时机</strong>：watch默认是懒加载的，只有当依赖变化时才会触发；watchEffect会在组件创建时立即执行一次。</li>
<li><strong>参数获取</strong>：watch可以获取新旧值，而watchEffect无法获取旧值。</li>
<li><strong>使用场景</strong>：watch适合需要精确控制依赖和获取新旧值的场景；watchEffect适合简单的副作用处理，语法更简洁。</li>
</ol>
<h4 data-id="heading-13">问题2：如何在Pinia中监听整个store的变化？</h4>
<p><strong>答案解析：</strong>
可以直接将store实例作为watch的第一个参数，并设置<code>deep: true</code>选项：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">watch</span>(counterStore, <span class="hljs-function">(<span class="hljs-params">newStore, oldStore</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Store changed:'</span>, newStore)
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> })
</code></pre>
<p>或者使用getter函数：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> ({ ...counterStore }), <span class="hljs-function">(<span class="hljs-params">newStore</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Store changed:'</span>, newStore)
})
</code></pre>
<h3 data-id="heading-14">四、常见报错解决方案</h3>
<h4 data-id="heading-15">1. 报错："watch() expects a source value as the first argument"</h4>
<p><strong>原因</strong>：传递给watch的第一个参数不是有效的响应式源。比如直接传递了一个非响应式的对象或值。
<strong>解决方法</strong>：</p>
<ul>
<li>确保监听的是ref、reactive对象，或者返回响应式值的getter函数。</li>
<li>如果要监听对象的某个属性，使用getter函数：<code>watch(() =&gt; obj.property, callback)</code></li>
</ul>
<h4 data-id="heading-16">2. 报错："deep option is ignored when watching a getter"</h4>
<p><strong>原因</strong>：当使用getter函数作为watch源时，deep选项会被忽略，因为getter函数返回的是一个值，而不是引用类型。
<strong>解决方法</strong>：</p>
<ul>
<li>如果需要深度监听，直接监听整个reactive对象，或者在getter函数中返回对象的副本：<code>watch(() =&gt; ({ ...obj }), callback, { deep: true })</code></li>
</ul>
<h4 data-id="heading-17">3. 报错："Maximum call stack size exceeded"</h4>
<p><strong>原因</strong>：在watch回调中修改了被监听的数据，导致无限循环。
<strong>解决方法</strong>：</p>
<ul>
<li>确保在watch回调中不会修改被监听的同一个数据。</li>
<li>如果需要修改，可以使用条件判断或者使用<code>watchEffect</code>代替。</li>
</ul>
<h4 data-id="heading-18">4. Pinia中watch不触发</h4>
<p><strong>原因</strong>：可能是因为没有正确使用getter函数来监听store中的状态。
<strong>解决方法</strong>：</p>
<ul>
<li>使用getter函数来监听store中的状态：<code>watch(() =&gt; store.count, callback)</code></li>
<li>确保store中的状态是响应式的，使用Pinia的state定义方式。</li>
</ul>
<h3 data-id="heading-19">五、参考链接</h3>
<ul>
<li>Vue3 侦听器官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Fwatchers.html" target="_blank" title="https://vuejs.org/guide/essentials/watchers.html" ref="nofollow noopener noreferrer">vuejs.org/guide/essen…</a></li>
<li>Pinia 官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpinia.vuejs.org%2F" target="_blank" title="https://pinia.vuejs.org/" ref="nofollow noopener noreferrer">pinia.vuejs.org/</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3逻辑写法]]></title>    <link>https://juejin.cn/post/7600704706551152680</link>    <guid>https://juejin.cn/post/7600704706551152680</guid>    <pubDate>2026-01-30T04:12:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600704706551152680" data-draft-id="7599483314160762899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3逻辑写法"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-30T04:12:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aniugel"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824198407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3逻辑写法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824198407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aniugel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:12:40.000Z" title="Fri Jan 30 2026 04:12:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h3 data-id="heading-0">test.vue</h3>
<pre><code class="hljs language-js" lang="js">&lt;!-- 图片展示 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-main</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cateList1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-row</span> <span class="hljs-attr">:gutter</span>=<span class="hljs-string">"20"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">"6"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, i) in dataList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-card</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 15px; position: relative"</span> <span class="hljs-attr">shadow</span>=<span class="hljs-string">"hover"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-image</span>
              <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 150px"</span>
              <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.url"</span>
              <span class="hljs-attr">fit</span>=<span class="hljs-string">"cover"</span>
            /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pic_title"</span>&gt;</span>{{ item.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pic_edit"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-checkbox</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"item.checked"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"selectImg(item)"</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"openDialog(item)"</span>&gt;</span>重命名<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"delPic(item.id)"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-card</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-col</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-row</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-pagination</span>
        <span class="hljs-attr">v-model:current-page</span>=<span class="hljs-string">"querData.page"</span>
        <span class="hljs-attr">v-model:page-size</span>=<span class="hljs-string">"querData.limit"</span>
        <span class="hljs-attr">:page-sizes</span>=<span class="hljs-string">"[2, 8, 15, 20]"</span>
        <span class="hljs-attr">small</span>=<span class="hljs-string">"small"</span>
        <span class="hljs-attr">background</span>=<span class="hljs-string">"background"</span>
        <span class="hljs-attr">layout</span>=<span class="hljs-string">"total, sizes, prev, pager, next, jumper"</span>
        <span class="hljs-attr">:total</span>=<span class="hljs-string">"total"</span>
        @<span class="hljs-attr">size-change</span>=<span class="hljs-string">"handleSizeChange"</span>
        @<span class="hljs-attr">current-change</span>=<span class="hljs-string">"handleCurrentChange"</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 重命名 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-dialog</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"dialogVisible"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"重命名"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"40%"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"formDate"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"图片名称"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"formDate.name"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">footer</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-footer"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"dialogVisible = false"</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"submitOk"</span>&gt;</span> 确定 <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dialog</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 上传图片 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-dialog</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"dialogVisibleUpload"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"上传图片"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"40%"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">UploadImg</span>
        <span class="hljs-attr">:data</span>=<span class="hljs-string">"{ image_class_id: querData.id }"</span>
        @<span class="hljs-attr">success</span>=<span class="hljs-string">"uploadSuccess"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">UploadImg</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">footer</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-footer"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"dialogVisible = false"</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"dialogVisible = false"</span>&gt;</span>
            确定
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dialog</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-main</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive, ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { getPicListByIdFn, editPicNameFn, delPicFn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/pic.js'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span>, <span class="hljs-title class_">ElMessageBox</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UploadImg</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/UploadImg.vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">num</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">1</span>,
  },
})

<span class="hljs-keyword">const</span> checkedImg = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> dataList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">checked</span>)
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>(<span class="hljs-string">'selectImgData'</span>)

<span class="hljs-comment">//选择图片事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectImg</span> = (<span class="hljs-params">item</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item)
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">checked</span> &amp;&amp; checkedImg.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> &gt; props.<span class="hljs-property">num</span>) {
    item.<span class="hljs-property">checked</span> = <span class="hljs-literal">false</span>
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`只能选择<span class="hljs-subst">${props.num}</span>张图片`</span>)
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'selectImgData'</span>, checkedImg.<span class="hljs-property">value</span>)
}

<span class="hljs-comment">//上传图片对话框显示和隐藏</span>
<span class="hljs-keyword">const</span> dialogVisibleUpload = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">openDialogUpload</span> = (<span class="hljs-params"/>) =&gt; {
  dialogVisibleUpload.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">uploadSuccess</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">getPicList</span>()
}

<span class="hljs-comment">//删除</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">delPic</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-keyword">const</span> isdel = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">'是否删除?'</span>, <span class="hljs-string">'删除'</span>, {
    <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">'确定'</span>,
    <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">'取消'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
  }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> err)

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isdel)

  <span class="hljs-keyword">if</span> (isdel !== <span class="hljs-string">'confirm'</span>) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">delPicFn</span>([id])
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
  <span class="hljs-title function_">getPicList</span>()
}

<span class="hljs-keyword">const</span> dialogVisible = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-comment">//打开对话框</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">openDialog</span> = (<span class="hljs-params">item</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item)
  formDate.<span class="hljs-property">id</span> = item.<span class="hljs-property">id</span>
  formDate.<span class="hljs-property">name</span> = item.<span class="hljs-property">name</span>
  dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
}

<span class="hljs-keyword">const</span> formDate = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
})

<span class="hljs-comment">//确定修改图片名称</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">submitOk</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">editPicNameFn</span>(formDate.<span class="hljs-property">id</span>, formDate.<span class="hljs-property">name</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">msg</span> &amp;&amp; res.<span class="hljs-property">msg</span> !== <span class="hljs-string">'ok'</span>) {
    <span class="hljs-keyword">return</span>
  }
  dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
  <span class="hljs-title function_">getPicList</span>()
}

<span class="hljs-keyword">const</span> querData = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-comment">//图库分类ID</span>
  <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">limit</span>: <span class="hljs-number">8</span>,
})

<span class="hljs-comment">//分页</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSizeChange</span> = (<span class="hljs-params">val</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val)
  querData.<span class="hljs-property">limit</span> = val
  <span class="hljs-title function_">getPicList</span>()
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCurrentChange</span> = (<span class="hljs-params">val</span>) =&gt; {
  querData.<span class="hljs-property">page</span> = val
  <span class="hljs-title function_">getPicList</span>()
}

<span class="hljs-keyword">const</span> dataList = <span class="hljs-title function_">ref</span>([])
<span class="hljs-keyword">const</span> total = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getPicList</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPicListByIdFn</span>(querData.<span class="hljs-property">id</span>, querData.<span class="hljs-property">page</span>, querData.<span class="hljs-property">limit</span>)

  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">msg</span> &amp;&amp; res.<span class="hljs-property">msg</span> !== <span class="hljs-string">'ok'</span>) {
    <span class="hljs-keyword">return</span>
  }
  dataList.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    item.<span class="hljs-property">checked</span> = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">return</span> item
  })
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dataList.<span class="hljs-property">value</span>)
  total.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">totalCount</span>
}
<span class="hljs-comment">//getPicList()</span>

<span class="hljs-comment">//获取父组件分类id</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getDataById</span> = (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-comment">//id 分类id</span>
  querData.<span class="hljs-property">id</span> = id
  <span class="hljs-title function_">getPicList</span>()
}
<span class="hljs-comment">// 还需要通过defineExpose暴露据和方法让子组件许可和确认,接下来在父组件中就可以查看子组件中暴露的数据与方法</span>
<span class="hljs-title function_">defineExpose</span>({
  getDataById,
  openDialogUpload,
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
:<span class="hljs-built_in">deep</span>(.el-card__body) {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0px</span> <span class="hljs-meta">!important</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>

</code></pre>
<h3 data-id="heading-1">api.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/request.js'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getPicCateFn</span>=(<span class="hljs-params">page,limit=<span class="hljs-number">10</span></span>)=&gt;{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
        <span class="hljs-attr">url</span>:<span class="hljs-string">`admin/getPicsCateList/<span class="hljs-subst">${page}</span>`</span>,
        <span class="hljs-attr">method</span>:<span class="hljs-string">'GET'</span>,
        <span class="hljs-attr">params</span>:{
            limit
        }
    })
}

<span class="hljs-comment">//修改图库分类</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">editPicCateFn</span>=(<span class="hljs-params">id,data</span>)=&gt;{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
        <span class="hljs-attr">url</span>:<span class="hljs-string">`admin/editPicsList/<span class="hljs-subst">${id}</span>`</span>,
        <span class="hljs-attr">method</span>:<span class="hljs-string">'POST'</span>,
        data
    })
}

<span class="hljs-comment">//删除图库分类</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">delCateFn</span>=(<span class="hljs-params">id</span>)=&gt;{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
        <span class="hljs-attr">url</span>:<span class="hljs-string">`admin/delPicsCateList/<span class="hljs-subst">${id}</span>/delete`</span>,
        <span class="hljs-attr">method</span>:<span class="hljs-string">'POST'</span>
    })
}

<span class="hljs-comment">//获取图库分类</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getPicListByIdFn</span>=(<span class="hljs-params">id,page,limit</span>)=&gt;{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
        <span class="hljs-attr">url</span>:<span class="hljs-string">`admin/getPicList/<span class="hljs-subst">${id}</span>/image/<span class="hljs-subst">${page}</span>`</span>,
        <span class="hljs-attr">method</span>:<span class="hljs-string">'GET'</span>,
        <span class="hljs-attr">params</span>:{
            limit
        }
    })
}

<span class="hljs-comment">//删除图片</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">delPicFn</span>=(<span class="hljs-params">ids</span>)=&gt;{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
        <span class="hljs-attr">url</span>:<span class="hljs-string">"admin/delPic/delete_all"</span>,
        <span class="hljs-attr">method</span>:<span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">data</span>:{
            ids
        }
    })
}
</code></pre>
<h3 data-id="heading-2">until/js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 修改密码</span>
<span class="hljs-keyword">import</span> { editPasswordFn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/login.js'</span>
<span class="hljs-keyword">import</span> { ref, reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useEditPassword</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">//修改对话是否显示</span>
    <span class="hljs-keyword">const</span> dialogVisible = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-comment">//form表单dom元素</span>
    <span class="hljs-keyword">const</span> ruleFormRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
    <span class="hljs-comment">//修改数据源</span>
    <span class="hljs-keyword">const</span> ruleForm = <span class="hljs-title function_">reactive</span>({
        <span class="hljs-attr">oldpassword</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">repassword</span>: <span class="hljs-string">''</span>
    })
    <span class="hljs-comment">//验证规则</span>
    <span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">reactive</span>({
        <span class="hljs-attr">oldpassword</span>: [
            { <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入旧密码'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
            { <span class="hljs-attr">min</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">max</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入5到15个字符'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
        ],
        <span class="hljs-attr">password</span>: [
            { <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入新密码'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
            { <span class="hljs-attr">min</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">max</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入5到15个字符'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
        ],
    })
    <span class="hljs-comment">//关闭对话框的回调</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">closeHandle</span> = (<span class="hljs-params"/>) =&gt; {
        ruleFormRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">resetFields</span>()
    }

    <span class="hljs-comment">//确定修改密码</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">submitOk</span> = (<span class="hljs-params"/>) =&gt; {
        ruleFormRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-keyword">async</span> isValid =&gt; {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isValid)
            <span class="hljs-keyword">if</span> (!isValid) {
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">editPasswordFn</span>(ruleForm)
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
            <span class="hljs-keyword">if</span> (res.<span class="hljs-property">msg</span> &amp;&amp; res.<span class="hljs-property">msg</span> !== <span class="hljs-string">'ok'</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span>)
            }
            <span class="hljs-title class_">ElMessage</span>({
                <span class="hljs-attr">message</span>: <span class="hljs-string">'密码修改成功'</span>,
                <span class="hljs-attr">type</span>: <span class="hljs-string">'success'</span>,
            })

            dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>

        })
    }

    <span class="hljs-keyword">return</span> {
        dialogVisible,
        ruleFormRef,
        ruleForm,
        rules,
        closeHandle,
        submitOk
    }
}
</code></pre>
<h3 data-id="heading-3">router.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> {createRouter,createWebHashHistory} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/index.js'</span>
<span class="hljs-keyword">import</span> np <span class="hljs-keyword">from</span> <span class="hljs-string">'nprogress'</span>

<span class="hljs-comment">//路由匹配规则</span>
<span class="hljs-keyword">const</span> routes=[
    {
        <span class="hljs-attr">path</span>:<span class="hljs-string">'/'</span>,
        <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/home'</span>
    },
    {
        <span class="hljs-attr">path</span>:<span class="hljs-string">'/home'</span>,
        <span class="hljs-attr">component</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Home.vue'</span>),
        <span class="hljs-attr">children</span>:[
            {
                <span class="hljs-attr">path</span>:<span class="hljs-string">'/home'</span>,
                <span class="hljs-attr">name</span>:<span class="hljs-string">'/home'</span>,
                <span class="hljs-attr">component</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/HomeIndex.vue'</span>),
                <span class="hljs-attr">meta</span>:{
                    <span class="hljs-attr">title</span>:<span class="hljs-string">'后台首页'</span>
                }
            },
            {
                <span class="hljs-attr">path</span>:<span class="hljs-string">'/notice/list'</span>,
                <span class="hljs-attr">name</span>:<span class="hljs-string">'/notice/list'</span>,
                <span class="hljs-attr">component</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/test.vue'</span>),
                <span class="hljs-attr">meta</span>:{
                    <span class="hljs-attr">title</span>:<span class="hljs-string">'公告管理'</span>
                }
            }
        ]
    },
    {
        <span class="hljs-attr">path</span>:<span class="hljs-string">'/login'</span>,
        <span class="hljs-attr">component</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Login.vue'</span>)

    },
    <span class="hljs-comment">//捕获404</span>
    {
        <span class="hljs-attr">path</span>:<span class="hljs-string">'/:pathMatch(.*)*'</span>,
        <span class="hljs-attr">name</span>:<span class="hljs-string">'NotFound'</span>,
        <span class="hljs-attr">component</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/404.vue'</span>)

    }
]

<span class="hljs-keyword">const</span> router=<span class="hljs-title function_">createRouter</span>({
    <span class="hljs-attr">history</span>:<span class="hljs-title function_">createWebHashHistory</span>(),
    routes
})

<span class="hljs-comment">//全局路由守卫</span>
router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to,<span class="hljs-keyword">from</span>,next)=&gt;{
    np.<span class="hljs-title function_">start</span>()
    <span class="hljs-comment">//获取token</span>
    <span class="hljs-keyword">const</span> tokenStr=<span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>)
    <span class="hljs-keyword">if</span>(tokenStr){
        <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">'getUserInfo'</span>)
    }
    <span class="hljs-comment">//如果没有登录</span>
    <span class="hljs-keyword">if</span>(!tokenStr&amp;&amp;to.<span class="hljs-property">path</span>!==<span class="hljs-string">'/login'</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(<span class="hljs-string">'/login'</span>)
    <span class="hljs-comment">//如果已经登录路</span>
    <span class="hljs-keyword">if</span>(tokenStr&amp;&amp;to.<span class="hljs-property">path</span>==<span class="hljs-string">'/login'</span>){
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>({<span class="hljs-attr">path</span>:<span class="hljs-keyword">from</span>.<span class="hljs-property">path</span>?<span class="hljs-keyword">from</span>.<span class="hljs-property">path</span>:<span class="hljs-string">'/'</span>})
    }   
    <span class="hljs-title function_">next</span>()
})

<span class="hljs-comment">//后置全局路由守卫</span>
router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to,<span class="hljs-keyword">from</span>,next</span>)=&gt;</span>{
    np.<span class="hljs-title function_">done</span>()

})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router

</code></pre>
<h3 data-id="heading-4">store.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>
<span class="hljs-keyword">import</span> { getUserInfoFn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/login'</span>

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>({
    <span class="hljs-title function_">state</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-comment">//管理员信息</span>
            <span class="hljs-attr">userInfo</span>: {
            },
            <span class="hljs-comment">//导航菜单</span>
            <span class="hljs-attr">menu</span>:[],
            <span class="hljs-comment">//控制导航是否隐藏</span>
            <span class="hljs-attr">isShow</span>:<span class="hljs-literal">false</span>
        }
    },
    <span class="hljs-attr">mutations</span>: {
        <span class="hljs-title function_">setUserInfo</span>(<span class="hljs-params">state, userInfo</span>) {
            state.<span class="hljs-property">userInfo</span> = userInfo
            state.<span class="hljs-property">menu</span>=userInfo.<span class="hljs-property">menus</span>
        },
        <span class="hljs-comment">//修改isShow</span>
        <span class="hljs-title function_">setShow</span>(<span class="hljs-params">state</span>){
            state.<span class="hljs-property">isShow</span>=!state.<span class="hljs-property">isShow</span>
        }
    },
    <span class="hljs-attr">actions</span>: {
        <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params">context</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
                <span class="hljs-title function_">getUserInfoFn</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {  
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)                  
                    context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setUserInfo'</span>, res.<span class="hljs-property">data</span>)
                    <span class="hljs-title function_">resolve</span>(res)
                }).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-title function_">reject</span>(err))
            })
        }
    }
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store

</code></pre>
<h3 data-id="heading-5">App.vue</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router/index.js'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/index.js'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'nprogress/nprogress.css'</span>

<span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementPlus</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'element-plus/dist/index.css'</span>

<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">ElementPlusIconsVue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@element-plus/icons-vue'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, component] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-title class_">ElementPlusIconsVue</span>)) {
    app.<span class="hljs-title function_">component</span>(key, component)
}

app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>)

app.<span class="hljs-title function_">use</span>(router)

app.<span class="hljs-title function_">use</span>(store)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h3 data-id="heading-6">Header.vue</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 左列 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo"</span>&gt;</span> 商城后台管理系统 <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"setIsShow"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Fold</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 右列 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"f_right"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-tooltip</span>
        <span class="hljs-attr">effect</span>=<span class="hljs-string">"dark"</span>
        <span class="hljs-attr">content</span>=<span class="hljs-string">"刷新"</span>
        <span class="hljs-attr">:enterable</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottom"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"refHandle"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Refresh</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-tooltip</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">el-tooltip</span>
        <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!isFullscreen"</span>
        <span class="hljs-attr">effect</span>=<span class="hljs-string">"dark"</span>
        <span class="hljs-attr">content</span>=<span class="hljs-string">"全屏"</span>
        <span class="hljs-attr">:enterable</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottom"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"toggle"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">FullScreen</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-tooltip</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">el-tooltip</span>
        <span class="hljs-attr">v-else</span>
        <span class="hljs-attr">effect</span>=<span class="hljs-string">"dark"</span>
        <span class="hljs-attr">content</span>=<span class="hljs-string">"退出全屏"</span>
        <span class="hljs-attr">:enterable</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottom"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"toggle"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">FullScreen</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-tooltip</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown</span> @<span class="hljs-attr">command</span>=<span class="hljs-string">"commandHandle"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-avatar</span> <span class="hljs-attr">:size</span>=<span class="hljs-string">"30"</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"$store.state.userInfo.avatar"</span> /&gt;</span>
          {{ $store.state.userInfo.username }}
          <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon--right"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-left: 10px"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">arrow-down</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">dropdown</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-menu</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"editPassword"</span>&gt;</span>修改密码<span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"logout"</span>&gt;</span>退出登录<span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-menu</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 修改密码对话框 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-dialog</span>
      <span class="hljs-attr">v-model</span>=<span class="hljs-string">"dialogVisible"</span>
      <span class="hljs-attr">title</span>=<span class="hljs-string">"修改密码"</span>
      <span class="hljs-attr">width</span>=<span class="hljs-string">"40%"</span>
      @<span class="hljs-attr">close</span>=<span class="hljs-string">"closeHandle"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">"ruleFormRef"</span>
        <span class="hljs-attr">:model</span>=<span class="hljs-string">"ruleForm"</span>
        <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules"</span>
        <span class="hljs-attr">label-width</span>=<span class="hljs-string">"100px"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"原密码"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"oldpassword"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"ruleForm.oldpassword"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"新密码"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"password"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"ruleForm.password"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"确认密码"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"repassword"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"ruleForm.repassword"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">footer</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-footer"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"dialogVisible = false"</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"submitOk"</span>&gt;</span> 确定 <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dialog</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useEditPassword } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/useEditPWP.js'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Fold</span>, <span class="hljs-title class_">Refresh</span>, <span class="hljs-title class_">FullScreen</span>, <span class="hljs-title class_">ArrowDown</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@element-plus/icons-vue'</span>
<span class="hljs-keyword">import</span> { useFullscreen } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vueuse/core'</span>

<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessageBox</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>()
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()

<span class="hljs-keyword">const</span> { toggle, isFullscreen } = <span class="hljs-title function_">useFullscreen</span>()
<span class="hljs-keyword">const</span> { dialogVisible, ruleFormRef, ruleForm, rules, closeHandle, submitOk } =
  <span class="hljs-title function_">useEditPassword</span>()

<span class="hljs-comment">//刷新</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">refHandle</span> = (<span class="hljs-params"/>) =&gt; {
  location.<span class="hljs-title function_">reload</span>()
}

<span class="hljs-comment">//退出</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">logout</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> isLogout = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">'是否退出?'</span>, <span class="hljs-string">'提示'</span>, {
    <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">'确定'</span>,
    <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">'取消'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
  }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> err)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isLogout)
  <span class="hljs-keyword">if</span> (isLogout !== <span class="hljs-string">'confirm'</span>) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-comment">//清空本地存储</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'token'</span>)
  <span class="hljs-comment">//清空vuex数据</span>
  store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setUserInfo'</span>, {})
  router.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'/login'</span> })
}

<span class="hljs-comment">//监听下拉菜单事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">commandHandle</span> = (<span class="hljs-params">res</span>) =&gt; {
  <span class="hljs-keyword">if</span> (res == <span class="hljs-string">'editPassword'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'修改密码'</span>)
    dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (res == <span class="hljs-string">'logout'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'退出'</span>)
    <span class="hljs-title function_">logout</span>()
  }
}

<span class="hljs-comment">//控制导航菜单的显示和隐藏</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">setIsShow</span> = (<span class="hljs-params"/>) =&gt; {
  store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setShow'</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">echarts.vue</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-card</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"e_title"</span>&gt;</span>
                订单统计
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">el-check-tag</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"selectOp(item.value)"</span> <span class="hljs-attr">:checked</span>=<span class="hljs-string">"ops == item.value"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, i) in option"</span>
                        <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span>&gt;</span>
                        {{ item.text }}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">el-check-tag</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"e_main"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-card</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">'echarts'</span>;
<span class="hljs-keyword">import</span> { getEchartsFn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/home.js'</span>
<span class="hljs-keyword">import</span> { ref, onMounted,onBeforeUnmount } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>


<span class="hljs-keyword">var</span> myChart
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">var</span> chartDom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'e_main'</span>);
    myChart = echarts.<span class="hljs-title function_">init</span>(chartDom);
    <span class="hljs-title function_">getEchartsData</span>()    
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getEchartsData</span>=<span class="hljs-keyword">async</span> (<span class="hljs-params"/>)=&gt;{

    <span class="hljs-keyword">var</span> option;
    option = {
        <span class="hljs-attr">xAxis</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'category'</span>,
            <span class="hljs-attr">data</span>: []
        },
        <span class="hljs-attr">yAxis</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'value'</span>
        },
        <span class="hljs-attr">series</span>: [
            {
                <span class="hljs-attr">data</span>: [],
                <span class="hljs-attr">type</span>: <span class="hljs-string">'bar'</span>,
                <span class="hljs-attr">showBackground</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">backgroundStyle</span>: {
                    <span class="hljs-attr">color</span>: <span class="hljs-string">'rgba(180, 180, 180, 0.2)'</span>
                }
            }
        ]
    };
    
    myChart.<span class="hljs-title function_">showLoading</span>()
    <span class="hljs-keyword">const</span> res=<span class="hljs-keyword">await</span> <span class="hljs-title function_">getEchartsFn</span>(ops.<span class="hljs-property">value</span>)
    myChart.<span class="hljs-title function_">hideLoading</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
    <span class="hljs-keyword">if</span>(res.<span class="hljs-property">msg</span>&amp;&amp;res.<span class="hljs-property">msg</span>!==<span class="hljs-string">'ok'</span>){
        <span class="hljs-keyword">return</span>
    }
    option.<span class="hljs-property">xAxis</span>.<span class="hljs-property">data</span>=res.<span class="hljs-property">data</span>.<span class="hljs-property">x</span>
    option.<span class="hljs-property">series</span>[<span class="hljs-number">0</span>].<span class="hljs-property">data</span>=res.<span class="hljs-property">data</span>.<span class="hljs-property">y</span>

    option &amp;&amp; myChart.<span class="hljs-title function_">setOption</span>(option);

}

<span class="hljs-keyword">const</span> ops = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'week'</span>)
<span class="hljs-keyword">const</span> option = [
    {
        <span class="hljs-attr">text</span>: <span class="hljs-string">'月'</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-string">'month'</span>
    },
    {
        <span class="hljs-attr">text</span>: <span class="hljs-string">'周'</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-string">'week'</span>
    },
    {
        <span class="hljs-attr">text</span>: <span class="hljs-string">'天'</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-string">'hour'</span>
    }
]

<span class="hljs-comment">//选择时间事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectOp</span> = (<span class="hljs-params">op</span>) =&gt; {
    ops.<span class="hljs-property">value</span> = op
    <span class="hljs-title function_">getEchartsData</span>()
}

<span class="hljs-comment">//销毁期间生命周期</span>
<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-keyword">if</span>(myChart){
        echarts.<span class="hljs-title function_">dispose</span>(myChart)
    }
})

<span class="hljs-keyword">const</span> props=<span class="hljs-title function_">defineProps</span>({
    <span class="hljs-attr">value</span>:{
        <span class="hljs-attr">type</span>:<span class="hljs-title class_">Number</span>,
        <span class="hljs-attr">default</span>:<span class="hljs-number">0</span>
    }
})
<span class="hljs-keyword">const</span> data=<span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">num</span>:<span class="hljs-number">0</span>
})

<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>){
    gsap.<span class="hljs-title function_">to</span>(data,{
        <span class="hljs-comment">//0.5毫秒之后 将初始数据 动画替换成父组件传递过来的数据</span>
        <span class="hljs-attr">duration</span>:<span class="hljs-number">0.5</span>,
        <span class="hljs-attr">num</span>:props.<span class="hljs-property">value</span>
    })
}

<span class="hljs-title function_">fn</span>()

<span class="hljs-title function_">watch</span>(<span class="hljs-function">()=&gt;</span>props.<span class="hljs-property">value</span>,<span class="hljs-function">()=&gt;</span><span class="hljs-title function_">fn</span>())

&lt;el-form-item label=<span class="hljs-string">"菜单图标"</span> v-<span class="hljs-keyword">if</span>=<span class="hljs-string">"formData.menu == 1"</span>&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">IconSelect</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"formData.icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">IconSelect</span>&gt;</span></span>
&lt;/el-form-item&gt;

<span class="hljs-comment">//接收v-model的值</span>
<span class="hljs-title function_">defineProps</span>({
    <span class="hljs-attr">modelValue</span>: <span class="hljs-title class_">String</span>
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])

<span class="hljs-comment">//选择图标事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeHandle</span> = (<span class="hljs-params">e</span>) =&gt; {

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e)
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">"update:modelValue"</span>, e)
}

<span class="hljs-keyword">const</span> dialogVisible = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> titleVal = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'新增'</span>)
<span class="hljs-keyword">const</span> skusId = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-comment">//新增参数</span>
<span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">order</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">status</span>: <span class="hljs-number">1</span>

})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">openDialog</span> = (<span class="hljs-params"/>) =&gt; {
    titleVal.<span class="hljs-property">value</span> = <span class="hljs-string">'新增'</span>
    formData.<span class="hljs-property">name</span> = <span class="hljs-string">''</span>
    formData.<span class="hljs-property">default</span> = <span class="hljs-string">''</span>
    formData.<span class="hljs-property">order</span> = <span class="hljs-number">50</span>
    formData.<span class="hljs-property">status</span> = <span class="hljs-number">1</span>
    dialogVisibl
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>


</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[# 🌟 JavaScript 字符串反转全攻略｜7 种方法手把手教学（小白也能懂！）]]></title>    <link>https://juejin.cn/post/7600764857768853554</link>    <guid>https://juejin.cn/post/7600764857768853554</guid>    <pubDate>2026-01-30T03:27:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600764857768853554" data-draft-id="7600990891205427227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="# 🌟 JavaScript 字符串反转全攻略｜7 种方法手把手教学（小白也能懂！）"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-30T03:27:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不会敲代码1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            # 🌟 JavaScript 字符串反转全攻略｜7 种方法手把手教学（小白也能懂！）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不会敲代码1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:27:53.000Z" title="Fri Jan 30 2026 03:27:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🌟 JavaScript 字符串反转全攻略｜7 种方法手把手教学（小白也能懂！）</h2>
<blockquote>
<p>适合刚学 JS 的你｜代码逐行注释｜原理图解｜避坑指南｜掘金首发</p>
</blockquote>
<p>大家好，我是正在努力学前端的「小码农」。最近在练习字符串操作时，被一道看似简单的题卡住了： <strong>“怎么把 'hello' 变成 'olleh'？”</strong><br/>
网上一搜，发现居然有 <strong>7 种写法</strong>！有的短短一行，有的要写十几行；有的快如闪电，有的可能让浏览器卡住…<br/>
别慌！今天我就用 <strong>最直白的大白话 + 最详细的注释 + 最真实的踩坑记录</strong>，带你从零搞懂所有方法——<strong>不讲概念，只讲人话；不堆代码，只讲为什么。</strong><br/>
（文末附可直接复制粘贴的完整代码 ✅）</p>
<hr/>
<h3 data-id="heading-1">🔍 一、先搞明白：什么是“反转字符串”？</h3>
<p>✅ 简单说：就是把字符串里的字符顺序<strong>完全倒过来</strong>。<br/>
比如：</p>
<ul>
<li><code>'abc'</code> → <code>'cba'</code></li>
<li><code>'JavaScript'</code> → <code>'tpircSavaJ'</code></li>
<li><code>'12345'</code> → <code>'54321'</code></li>
</ul>
<p>⚠️ 注意：字符串在 JS 中是<strong>不可变的</strong>（不能直接改），所以每次反转都必须<strong>创建一个新字符串</strong>。</p>
<hr/>
<h3 data-id="heading-2">🧩 二、7 种方法详解（附完整可运行代码）</h3>
<blockquote>
<p>💡 每种方法都包含：<br/>
✅ <strong>一句话原理</strong>｜✅ <strong>带中文注释的代码</strong>｜✅ <strong>小白友好图解</strong>｜✅ <strong>什么时候用 / 什么时候避开</strong></p>
</blockquote>
<hr/>
<h4 data-id="heading-3">方法 1️⃣：三步走大法（最常用！推荐新手首选）</h4>
<p><code>split()</code> → <code>reverse()</code> → <code>join()</code></p>
<pre><code class="hljs language-perl" lang="perl">function reverseStr(str) {
  <span class="hljs-regexp">//</span> 第一步：把字符串 <span class="hljs-string">'abc'</span> 拆成数组 [<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>]
  // <span class="hljs-keyword">split</span>(<span class="hljs-string">''</span>) 中的 <span class="hljs-string">''</span> 表示“按每个字符拆开”
  const arr = str.<span class="hljs-keyword">split</span>(<span class="hljs-string">''</span>);

  <span class="hljs-regexp">//</span> 第二步：把数组 [<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>] 反转成 [<span class="hljs-string">'c'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'a'</span>]
  // <span class="hljs-keyword">reverse</span>() 是数组的内置方法，会直接修改原数组！
  const reversedArr = arr.<span class="hljs-keyword">reverse</span>();

  <span class="hljs-regexp">//</span> 第三步：把数组 [<span class="hljs-string">'c'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'a'</span>] 合并成字符串 <span class="hljs-string">'cba'</span>
  // <span class="hljs-keyword">join</span>(<span class="hljs-string">''</span>) 中的 <span class="hljs-string">''</span> 表示“中间不加任何符号”
  const result = reversedArr.join(<span class="hljs-string">''</span>);

  <span class="hljs-keyword">return</span> result;
}

console.log(reverseStr(<span class="hljs-string">'abc'</span>)); <span class="hljs-regexp">//</span> 输出：<span class="hljs-string">'cba'</span>
</code></pre>
<p>🧠 <strong>小白理解图</strong>：<br/>
<code>'abc'</code><br/>
→ 拆开：<code>['a', 'b', 'c']</code><br/>
→ 翻个身：<code>['c', 'b', 'a']</code><br/>
→ 粘起来：<code>'cba'</code></p>
<p>✅ <strong>优点</strong>：代码短、好记、适合绝大多数场景<br/>
⚠️ <strong>注意</strong>：对 emoji（如 <code>'👨‍💻'</code>）或带音标的字（如 <code>'café'</code>）在老版本浏览器中可能出错（后面会教怎么安全处理）</p>
<hr/>
<h4 data-id="heading-4">方法 2️⃣：传统 for 循环（最稳！兼容性无敌）</h4>
<pre><code class="hljs language-ini" lang="ini">function reverseStr(str) {
  let <span class="hljs-attr">result</span> = <span class="hljs-string">''</span><span class="hljs-comment">; // 准备一个空盒子，用来装反转后的字符</span>

  // 从最后一个字符开始，往前数：<span class="hljs-attr">i</span> = <span class="hljs-number">2</span> → <span class="hljs-number">1</span> → <span class="hljs-number">0</span>（因为 <span class="hljs-string">'abc'</span> 长度是<span class="hljs-number">3</span>，索引是<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>）
  for (let <span class="hljs-attr">i</span> = str.length - <span class="hljs-number">1</span><span class="hljs-comment">; i &gt;= 0; i--) {</span>
    <span class="hljs-attr">result</span> = result + str[i]<span class="hljs-comment">; // 把当前字符 str[i] 加到 result 后面</span>
  }

  return result<span class="hljs-comment">;</span>
}

console.log(reverseStr('abc'))<span class="hljs-comment">; // 输出：'cba'</span>
</code></pre>
<p>🧠 <strong>小白理解图</strong>（以 <code>'abc'</code> 为例）：</p>





























<table><thead><tr><th>循环次数</th><th>i 的值</th><th>str[i]</th><th>result 变化</th></tr></thead><tbody><tr><td>第1次</td><td>2</td><td><code>'c'</code></td><td><code>'' + 'c'</code> → <code>'c'</code></td></tr><tr><td>第2次</td><td>1</td><td><code>'b'</code></td><td><code>'c' + 'b'</code> → <code>'cb'</code></td></tr><tr><td>第3次</td><td>0</td><td><code>'a'</code></td><td><code>'cb' + 'a'</code> → <code>'cba'</code></td></tr></tbody></table>
<p>✅ <strong>优点</strong>：兼容所有浏览器（IE6 都能跑！）、逻辑清晰、性能好<br/>
💡 <strong>小技巧</strong>：<code>str.length - 1</code> 是最后一个字符的下标（JS 数组/字符串下标从 0 开始）</p>
<hr/>
<h4 data-id="heading-5">方法 3️⃣：for...of 循环（更现代、更优雅）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">function <span class="hljs-title">reverseStr</span>(<span class="hljs-params">str</span>)</span> {
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">''</span>; <span class="hljs-comment">// 还是那个空盒子</span>

  <span class="hljs-comment">// for...of 会自动一个一个拿出字符串里的字符</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-built_in">char</span> of str) {
    result = <span class="hljs-built_in">char</span> + result; <span class="hljs-comment">// 关键！不是加在后面，而是加在前面！</span>
  }

  <span class="hljs-keyword">return</span> result;
}

console.log(reverseStr(<span class="hljs-string">'abc'</span>)); <span class="hljs-comment">// 输出：'cba'</span>
</code></pre>
<p>🧠 <strong>小白理解图</strong>（以 <code>'abc'</code> 为例）：</p>

























<table><thead><tr><th>循环次数</th><th>char</th><th>result 变化</th></tr></thead><tbody><tr><td>第1次</td><td><code>'a'</code></td><td><code>'' + 'a'</code> → <code>'a'</code></td></tr><tr><td>第2次</td><td><code>'b'</code></td><td><code>'b' + 'a'</code> → <code>'ba'</code></td></tr><tr><td>第3次</td><td><code>'c'</code></td><td><code>'c' + 'ba'</code> → <code>'cba'</code></td></tr></tbody></table>
<p>✅ <strong>优点</strong>：代码更简洁、天然支持 emoji 和中文等复杂字符（Unicode 安全）<br/>
💡 <strong>记住口诀</strong>：“for...of 遍历字符，<code>char + result</code> 就是反转”</p>
<hr/>
<h4 data-id="heading-6">方法 4️⃣：展开运算符法（ES6 新写法，强烈推荐！）</h4>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reverseStr</span><span class="hljs-params">(str)</span></span> {
  // [...str] 就像魔法：把 <span class="hljs-string">'abc'</span> 变成 [<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>]
  // 然后照旧反转 + 合并
  <span class="hljs-keyword">return</span> [...str].<span class="hljs-built_in">reverse</span>().join(<span class="hljs-string">''</span>);
}

console.<span class="hljs-built_in">log</span>(reverseStr(<span class="hljs-string">'abc'</span>)); // 输出：<span class="hljs-string">'cba'</span>
</code></pre>
<p>✅ <strong>为什么比方法1更好？</strong></p>
<ul>
<li><code>split('')</code> 在老浏览器中对 <code>'👨‍💻'</code> 可能拆成乱码；</li>
<li><code>[...str]</code> 是 ES6 标准，<strong>完美支持所有 emoji、中文、带音标文字</strong>！<br/>
✅ <strong>一句话总结</strong>：这是方法1的升级版，<strong>兼顾简洁 + 安全</strong>，现在写代码就用它！</li>
</ul>
<hr/>
<h4 data-id="heading-7">方法 5️⃣：递归法（理解“自己调自己”，锻炼思维）</h4>
<pre><code class="hljs language-python" lang="python">function reverseStr(<span class="hljs-built_in">str</span>) {
  // 🚨 退出条件（非常重要！没有它会无限循环直到崩溃）
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">str</span> === <span class="hljs-string">''</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>; // 空字符串反转还是空字符串
  }

  // 🧩 递归核心：把第一个字符放到“剩下部分的反转结果”后面
  // <span class="hljs-built_in">str</span>.substring(<span class="hljs-number">1</span>) → 去掉第一个字符（如 <span class="hljs-string">'abc'</span> → <span class="hljs-string">'bc'</span>）
  // <span class="hljs-built_in">str</span>.charAt(<span class="hljs-number">0</span>) → 拿到第一个字符（如 <span class="hljs-string">'abc'</span> → <span class="hljs-string">'a'</span>）
  <span class="hljs-keyword">return</span> reverseStr(<span class="hljs-built_in">str</span>.substring(<span class="hljs-number">1</span>)) + <span class="hljs-built_in">str</span>.charAt(<span class="hljs-number">0</span>);
}

console.log(reverseStr(<span class="hljs-string">'abc'</span>)); // 输出：<span class="hljs-string">'cba'</span>
</code></pre>
<p>🧠 <strong>小白理解图</strong>（递归调用过程）：</p>
<pre><code class="hljs language-bash" lang="bash">reverseStr(<span class="hljs-string">'abc'</span>)
├─ reverseStr(<span class="hljs-string">'bc'</span>) + <span class="hljs-string">'a'</span>
   ├─ reverseStr(<span class="hljs-string">'c'</span>) + <span class="hljs-string">'b'</span>
      └─ reverseStr(<span class="hljs-string">''</span>) + <span class="hljs-string">'c'</span> → <span class="hljs-string">''</span> + <span class="hljs-string">'c'</span> = <span class="hljs-string">'c'</span>
   → <span class="hljs-string">'c'</span> + <span class="hljs-string">'b'</span> = <span class="hljs-string">'cb'</span>
→ <span class="hljs-string">'cb'</span> + <span class="hljs-string">'a'</span> = <span class="hljs-string">'cba'</span>
</code></pre>
<p>⚠️ <strong>重要警告</strong>：</p>
<ul>
<li>✅ 适合学习算法思想、理解分治（Divide &amp; Conquer）</li>
<li>❌ <strong>不要在项目里用！</strong> 字符串太长（比如 10000 字符）会爆栈（Stack Overflow），浏览器直接卡死！<br/>
💡 <strong>类比</strong>：就像俄罗斯套娃，一层层打开，最后一层是最小的（空字符串），然后一层层合上。</li>
</ul>
<hr/>
<h4 data-id="heading-8">方法 6️⃣：reduce 法（函数式编程风，酷炫但需理解）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">reverseStr</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-keyword">return</span> [...str].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">reversed, char</span>) =&gt;</span> {
    <span class="hljs-comment">// reversed：之前累积的结果（初始为空字符串 ''）</span>
    <span class="hljs-comment">// char：当前正在处理的字符</span>
    <span class="hljs-keyword">return</span> char + reversed; <span class="hljs-comment">// 把新字符加到前面，实现反转</span>
  }, <span class="hljs-string">''</span>); <span class="hljs-comment">// '' 是初始值（reversed 的起点）</span>
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">reverseStr</span>(<span class="hljs-string">'abc'</span>)); <span class="hljs-comment">// 输出：'cba'</span>
</code></pre>
<p>🧠 <strong>小白理解图</strong>（以 <code>'abc'</code> 为例）：</p>



































<table><thead><tr><th>步骤</th><th>reversed（之前结果）</th><th>char</th><th>返回值（新 reversed）</th></tr></thead><tbody><tr><td>初始</td><td><code>''</code></td><td>—</td><td>—</td></tr><tr><td>第1次</td><td><code>''</code></td><td><code>'a'</code></td><td><code>'a' + ''</code> → <code>'a'</code></td></tr><tr><td>第2次</td><td><code>'a'</code></td><td><code>'b'</code></td><td><code>'b' + 'a'</code> → <code>'ba'</code></td></tr><tr><td>第3次</td><td><code>'ba'</code></td><td><code>'c'</code></td><td><code>'c' + 'ba'</code> → <code>'cba'</code></td></tr></tbody></table>
<p>✅ <strong>优点</strong>：代码非常“函数式”，没有变量赋值，适合喜欢数学思维的同学<br/>
⚠️ <strong>注意</strong>：<code>reduce</code> 本质也是循环，性能和 for...of 差不多，但初学者可能觉得绕。</p>
<hr/>
<h4 data-id="heading-9">方法 7️⃣：Array.from() 法（方法4的“双胞胎”，同样安全）</h4>
<pre><code class="hljs language-python" lang="python">function reverseStr(<span class="hljs-built_in">str</span>) {
  // Array.<span class="hljs-keyword">from</span>(<span class="hljs-built_in">str</span>) 和 [...<span class="hljs-built_in">str</span>] 功能完全一样，都是把字符串变成数组
  <span class="hljs-keyword">return</span> Array.<span class="hljs-keyword">from</span>(<span class="hljs-built_in">str</span>).reverse().join(<span class="hljs-string">''</span>);
}

console.log(reverseStr(<span class="hljs-string">'abc'</span>)); // 输出：<span class="hljs-string">'cba'</span>
</code></pre>
<p>✅ <strong>小知识</strong>：<code>Array.from(str)</code> 和 <code>[...str]</code> 是等价的，你可以任选其一。<br/>
📚 <strong>为什么多一种写法？</strong></p>
<ul>
<li><code>Array.from()</code> 还可以做更多事（比如转换类数组对象），是更通用的 API；</li>
<li><code>[...str]</code> 更简短，是日常开发中的“快捷写法”。</li>
</ul>
<hr/>
<h3 data-id="heading-10">🚨 三、新手必看！3 个真实踩坑记录（血泪教训）</h3>
<h4 data-id="heading-11">❌ 坑1：<code>split('')</code> 对 emoji 处理错误（老浏览器）</h4>
<pre><code class="hljs language-perl" lang="perl">// 在 Chrome <span class="hljs-number">80</span> 以下或某些手机浏览器中：
<span class="hljs-string">'👨‍💻'</span>.<span class="hljs-keyword">split</span>(<span class="hljs-string">''</span>); <span class="hljs-regexp">//</span> 可能返回 [<span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>]（乱码！）
[...<span class="hljs-string">'👨‍💻'</span>];        <span class="hljs-regexp">//</span> 正确返回 [<span class="hljs-string">'👨‍💻'</span>]（一个完整的 emoji）
</code></pre>
<p>✅ <strong>解决方案</strong>：统一用 <code>[...str]</code> 或 <code>Array.from(str)</code></p>
<h4 data-id="heading-12">❌ 坑2：递归调用忘记写“退出条件”</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 错误示范！没有 if 判断，会一直调用自己直到崩溃</span>
function <span class="hljs-built_in">badReverse</span>(str) {
  return <span class="hljs-built_in">badReverse</span>(str.substring(<span class="hljs-number">1</span>)) + str<span class="hljs-selector-class">.charAt</span>(<span class="hljs-number">0</span>);
}
<span class="hljs-built_in">badReverse</span>('abc'); <span class="hljs-comment">// ❌ 页面卡死！</span>
</code></pre>
<p>✅ <strong>解决方案</strong>：递归函数第一行必须写清楚“什么时候停止”</p>
<h4 data-id="heading-13">❌ 坑3：<code>reverse()</code> 修改了原数组（副作用！）</h4>
<pre><code class="hljs language-css" lang="css">const arr = <span class="hljs-selector-attr">[<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]</span>;
arr<span class="hljs-selector-class">.reverse</span>(); // 直接把 arr 改成了 <span class="hljs-selector-attr">[<span class="hljs-string">'c'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'a'</span>]</span>！
console<span class="hljs-selector-class">.log</span>(arr); // 输出：<span class="hljs-selector-attr">[<span class="hljs-string">'c'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'a'</span>]</span>（原数组被改了！）
</code></pre>
<p>✅ <strong>解决方案</strong>：如果不想改原数组，先用 <code>slice()</code> 复制一份：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">newArr</span> = arr.slice().reverse()<span class="hljs-comment">; // slice() 创建副本</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">📊 四、终极对比表（选哪个？看这里！）</h3>













































































<table><thead><tr><th>方法</th><th>代码长度</th><th>学习难度</th><th>运行速度</th><th>Unicode 安全</th><th>推荐指数</th><th>适合谁</th></tr></thead><tbody><tr><td><code>split+reverse+join</code></td><td>⭐⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐</td><td>❌（老环境）</td><td>⭐⭐⭐</td><td>快速验证想法</td></tr><tr><td><strong>传统 for 循环</strong></td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>✅</td><td>⭐⭐⭐⭐⭐</td><td><strong>新手入门首选！</strong> 兼容性最强</td></tr><tr><td><strong>for...of 循环</strong></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>✅</td><td>⭐⭐⭐⭐⭐</td><td><strong>现代项目首选！</strong> 简洁安全</td></tr><tr><td><strong>展开运算符 <code>[...str]</code></strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>✅</td><td>⭐⭐⭐⭐⭐</td><td><strong>2024 年推荐写法！</strong> 简洁+安全</td></tr><tr><td>递归</td><td>⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td><td>✅</td><td>⭐⭐</td><td>学算法/面试准备</td></tr><tr><td>reduce</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>✅</td><td>⭐⭐⭐</td><td>喜欢函数式编程者</td></tr><tr><td>Array.from</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>✅</td><td>⭐⭐⭐⭐</td><td>作为 <code>[...str]</code> 的替代</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>给你的明确建议</strong>：</p>
<ul>
<li><strong>刚学 JS？</strong> 从 <strong>方法2（for 循环）</strong> 开始，彻底搞懂每一步！</li>
<li><strong>想写现代代码？</strong> 主力用 <strong>方法4（展开运算符）</strong> ，又短又安全！</li>
<li><strong>面试被问“还有别的方法吗？”</strong> 把方法1、2、4、5 能说清楚就够了！</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-15">💡 五、课后小练习（动手才记得牢！）</h3>
<p>请尝试用 <strong>至少2种方法</strong> 实现以下功能，并在控制台验证：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 反转一个句子（注意空格位置）</span>
<span class="hljs-built_in">reverseStr</span>('hello world'); <span class="hljs-comment">// 应该输出 'dlrow olleh'</span>

<span class="hljs-comment">// 2. 反转带 emoji 的字符串</span>
<span class="hljs-built_in">reverseStr</span>('I ❤️ JS 🌟'); <span class="hljs-comment">// 应该保持 ❤️ 和 🌟 完整</span>

<span class="hljs-comment">// 3. 写一个“安全版”函数：对非字符串输入也友好</span>
<span class="hljs-built_in">reverseStr</span>(null);    <span class="hljs-comment">// 应该输出 ''</span>
<span class="hljs-built_in">reverseStr</span>(<span class="hljs-number">123</span>);     <span class="hljs-comment">// 应该输出 '321'</span>
</code></pre>
<blockquote>
<p>✅ <strong>答案提示</strong>：用 <code>String(input)</code> 可以把任意值转成字符串！</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">🌈 六、写在最后：编程不是背代码，而是理解“为什么”</h3>
<p>这7种方法，没有绝对的“最好”，只有“最适合当前场景”。</p>
<ul>
<li>你可能会发现：<strong>方法2（for循环）虽然代码长，但每一步都清晰可见；</strong></li>
<li><strong>方法4（展开运算符）虽然只有一行，但背后是整个 ES6 的设计哲学。</strong></li>
</ul>
<blockquote>
<p>🌟 <strong>送你一句我学到的话</strong>：<br/>
<strong>“优秀的程序员，不是知道最多方法的人，而是知道在什么情况下选择最合适方法的人。”</strong></p>
</blockquote>
<p>如果你觉得这篇笔记帮到了你，欢迎 👍 点赞、💬 评论、🔄 转发！<br/>
关注我，一起把前端学得明明白白、踏踏实实 💪<br/>
（代码已全部测试通过，复制即用！）</p>
<hr/>
<p>📌 <strong>附：7种方法完整可运行代码（一键复制）</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方法1：split+reverse+join（基础版）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse1</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">split</span>(<span class="hljs-string">''</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>); }

<span class="hljs-comment">// 方法2：传统for循环（最稳）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse2</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">let</span> r=<span class="hljs-string">''</span>; <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=str.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>;i&gt;=<span class="hljs-number">0</span>;i--) r+=str[i]; <span class="hljs-keyword">return</span> r; }

<span class="hljs-comment">// 方法3：for...of循环（现代简洁）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse3</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">let</span> r=<span class="hljs-string">''</span>; <span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> c <span class="hljs-keyword">of</span> str) r=c+r; <span class="hljs-keyword">return</span> r; }

<span class="hljs-comment">// 方法4：展开运算符（2024推荐！）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse4</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">return</span> [...str].<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>); }

<span class="hljs-comment">// 方法5：递归（理解思想）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse5</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">return</span> str===<span class="hljs-string">''</span>? <span class="hljs-string">''</span>: <span class="hljs-title function_">reverse5</span>(str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>)) + str.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>); }

<span class="hljs-comment">// 方法6：reduce（函数式）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse6</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">return</span> [...str].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">r,c</span>)=&gt;</span>c+r, <span class="hljs-string">''</span>); }

<span class="hljs-comment">// 方法7：Array.from（方法4的兄弟）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse7</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(str).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>); }

<span class="hljs-comment">// 测试</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法1:'</span>, <span class="hljs-title function_">reverse1</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法2:'</span>, <span class="hljs-title function_">reverse2</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法3:'</span>, <span class="hljs-title function_">reverse3</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法4:'</span>, <span class="hljs-title function_">reverse4</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法5:'</span>, <span class="hljs-title function_">reverse5</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法6:'</span>, <span class="hljs-title function_">reverse6</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法7:'</span>, <span class="hljs-title function_">reverse7</span>(<span class="hljs-string">'abc'</span>));
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[😭 还没爽完就欠费？我写了个自动“偷”额度的脚本，Gemini 都被我榨干了]]></title>    <link>https://juejin.cn/post/7600705962248568841</link>    <guid>https://juejin.cn/post/7600705962248568841</guid>    <pubDate>2026-01-30T04:31:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600705962248568841" data-draft-id="7600764857769099314" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="😭 还没爽完就欠费？我写了个自动“偷”额度的脚本，Gemini 都被我榨干了"/> <meta itemprop="keywords" content="Gemini,AI编程,AIGC"/> <meta itemprop="datePublished" content="2026-01-30T04:31:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="webkubor"/> <meta itemprop="url" content="https://juejin.cn/user/2119514149631870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            😭 还没爽完就欠费？我写了个自动“偷”额度的脚本，Gemini 都被我榨干了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2119514149631870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    webkubor
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:31:05.000Z" title="Fri Jan 30 2026 04:31:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf53175f7c9e4f408b9ca06ae89f4f95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357140&amp;x-signature=zNAN9Rw%2BKGjvbGffSK7PWH6Qw9M%3D" alt="截屏2026-01-30 13.49.45.png" loading="lazy"/></p>
<blockquote>
<p><strong>⚠️ 警告</strong>：本文含“高危”操作，阅读前请确保你的 Gemini CLI 已经装好，并且你拥有至少两个 Google 账号（大号和小号）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">😫 崩溃瞬间：当灵感撞上 429</h2>
<p>作为一个被 AI 惯坏的工程师，我现在写代码基本是这样的：
<strong>“Gemini，帮我重构这个函数”</strong> -&gt; <strong>“Gemini，写个单元测试”</strong> -&gt; <strong>“Gemini，这行报错是什么鬼？”</strong></p>
<p>正当我代码写得起飞，多巴胺疯狂分泌的时候，终端突然冷冰冰地甩给我一行字：</p>
<pre><code class="hljs language-bash" lang="bash">Error: 429 Quota exceeded <span class="hljs-keyword">for</span> the current user.
</code></pre>
<p>那一刻，我感觉像是刚要冲刺百米终点，裤衩突然松了。<strong>绝望，太绝望了。</strong></p>
<p>为了继续写代码，我不得不：</p>
<ol>
<li><code>gemini auth logout</code> （含泪登出）</li>
<li><code>gemini auth login</code> （打开浏览器，扫码，切小号，授权...）</li>
<li>回来重新输入刚才断掉的命令。</li>
</ol>
<p>这哪里是写代码？这简直是在做**“账号切换耐力测试”<strong>！这种</strong>“断流”**感，对于心流状态简直是毁灭性打击。</p>
<p>于是我怒了。<strong>DeepSeek 都在教我们怎么榨干算力，我居然还在手动切号？</strong> 必须搞个自动化的！</p>
<hr/>
<h2 data-id="heading-1">🧠 思路：给 CLI 装个“备胎”系统</h2>
<p>只要稍微扒一下 Gemini CLI 的底裤（<code>~/.gemini/</code> 目录），你就会发现它的鉴权机制单纯得可爱：</p>
<ul>
<li><strong>凭证文件</strong>：<code>~/.gemini/oauth_creds.json</code></li>
<li><strong>账号信息</strong>：<code>~/.gemini/google_accounts.json</code></li>
</ul>
<p>这不就简单了吗？
我只要提前把“大号”和“小号”的这两个文件<strong>偷</strong>出来存好，等到大号欠费时，用脚本<strong>毫秒级</strong>把小号的文件覆盖回去，CLI 不就以为我是尊贵的满血会员了吗？</p>
<p>说干就干。我设计了一套 <strong>“主备容灾系统 (Active-Passive Failover)”</strong>。</p>
<hr/>
<h2 data-id="heading-2">🛠️ 第一步：造一个“身份管理器”</h2>
<p>我们需要一个脚本来负责“物理换卡”。这相当于给你的 CLI 装了一个双卡双待的卡槽。</p>
<p>在 <code>~/Documents/AI_Common/docs/scripts/</code> 下创建一个 <code>gemini_manager.sh</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># gemini_manager.sh - 你的身份管家</span>

<span class="hljs-comment"># 你的配置文件仓库（建议放在 dotfiles 或文档里）</span>
PROFILE_STORE=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/Documents/AI_Common/docs/secrets/gemini_profiles"</span>
GEMINI_DIR=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.gemini"</span>

<span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">"<span class="hljs-variable">$PROFILE_STORE</span>"</span>

<span class="hljs-comment"># 💾 存档技能：把当前账号存起来</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">save_profile</span></span>() {
    NAME=<span class="hljs-variable">$1</span>
    TARGET=<span class="hljs-string">"<span class="hljs-variable">$PROFILE_STORE</span>/<span class="hljs-variable">$NAME</span>"</span>
    <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>"</span>
    
    <span class="hljs-comment"># 核心动作：把凭证“偷”走备份</span>
    <span class="hljs-built_in">cp</span> <span class="hljs-string">"<span class="hljs-variable">$GEMINI_DIR</span>/oauth_creds.json"</span> <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>/"</span> 2&gt;/dev/null
    <span class="hljs-built_in">cp</span> <span class="hljs-string">"<span class="hljs-variable">$GEMINI_DIR</span>/google_accounts.json"</span> <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>/"</span> 2&gt;/dev/null
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 账号已存档为: '<span class="hljs-variable">$NAME</span>'"</span>
}

<span class="hljs-comment"># 🔄 读档技能：切换到指定账号</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">switch_profile</span></span>() {
    NAME=<span class="hljs-variable">$1</span>
    TARGET=<span class="hljs-string">"<span class="hljs-variable">$PROFILE_STORE</span>/<span class="hljs-variable">$NAME</span>"</span>
    
    <span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>"</span> ]; <span class="hljs-keyword">then</span> 
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"❌ 找不到账号存档 '<span class="hljs-variable">$NAME</span>'，你是不是没存过？"</span>
        <span class="hljs-built_in">return</span> 1
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"🔄 正在切换身份到: '<span class="hljs-variable">$NAME</span>'..."</span>
    <span class="hljs-comment"># 核心动作：覆盖回去</span>
    <span class="hljs-built_in">cp</span> <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>/oauth_creds.json"</span> <span class="hljs-string">"<span class="hljs-variable">$GEMINI_DIR</span>/"</span> 2&gt;/dev/null
    <span class="hljs-built_in">cp</span> <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>/google_accounts.json"</span> <span class="hljs-string">"<span class="hljs-variable">$GEMINI_DIR</span>/"</span> 2&gt;/dev/null
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"🎉 切换成功！现在你是 '<span class="hljs-variable">$NAME</span>' 了。"</span>
}

<span class="hljs-comment"># 🧐 鉴定技能：我现在到底是谁？</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">check_status</span></span>() {
    <span class="hljs-comment"># 通过对比文件哈希值来确认身份</span>
    CURRENT_SUM=$(shasum <span class="hljs-string">"<span class="hljs-variable">$GEMINI_DIR</span>/oauth_creds.json"</span> 2&gt;/dev/null | awk <span class="hljs-string">'{print $1}'</span>)
    FOUND=0
    <span class="hljs-keyword">for</span> profile <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$PROFILE_STORE</span>"</span>/*; <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$profile</span>"</span> ]; <span class="hljs-keyword">then</span>
            P_NAME=$(<span class="hljs-built_in">basename</span> <span class="hljs-string">"<span class="hljs-variable">$profile</span>"</span>)
            P_SUM=$(shasum <span class="hljs-string">"<span class="hljs-variable">$profile</span>/oauth_creds.json"</span> 2&gt;/dev/null | awk <span class="hljs-string">'{print $1}'</span>)
            <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$CURRENT_SUM</span>"</span> == <span class="hljs-string">"<span class="hljs-variable">$P_SUM</span>"</span> ]; <span class="hljs-keyword">then</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 当前身份: <span class="hljs-variable">$P_NAME</span>"</span>
                FOUND=1
                <span class="hljs-built_in">break</span>
            <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$FOUND</span>"</span> -eq 0 ]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"⚠️  未知身份 (未存档)"</span>; <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># 简单的路由</span>
<span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span>
    save) save_profile <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ;; 
    switch) switch_profile <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ;; 
    status) check_status ;; 
    *) <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> {save|switch|status} [name]"</span> ;; 
<span class="hljs-keyword">esac</span>
</code></pre>
<hr/>
<h2 data-id="heading-3">🚀 第二步：终极黑科技 "Auto-Failover Wrapper"</h2>
<p>我要封装一个 <code>g</code> 命令。它平时就是普通的 Gemini，但在检测到报错时，它会<strong>光速切号</strong>并<strong>自动重试</strong>。</p>
<p>创建 <code>g.sh</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># g.sh - 永不欠费的 Gemini 包装器</span>

MANAGER=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/Documents/AI_Common/docs/scripts/gemini_manager.sh"</span>

<span class="hljs-comment"># 1. 显性化：告诉自己现在在用哪个号</span>
CURRENT_PROFILE=$(<span class="hljs-variable">$MANAGER</span> status | grep <span class="hljs-string">"当前身份"</span> | awk <span class="hljs-string">'{print $NF}'</span>)
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\033[1;34m[Gemini CLI]\033[0m Account: \033[1;32m<span class="hljs-variable">${CURRENT_PROFILE:-UNKNOWN}</span>\033[0m"</span>

<span class="hljs-comment"># 2. 核心逻辑：拦截报错</span>
<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"$*"</span> == *<span class="hljs-string">"-p"</span>* ]] || [[ <span class="hljs-string">"$*"</span> == *<span class="hljs-string">"--prompt"</span>* ]]; <span class="hljs-keyword">then</span>
    TMP_LOG=$(<span class="hljs-built_in">mktemp</span>)
    gemini <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> <span class="hljs-string">"<span class="hljs-variable">$TMP_LOG</span>"</span>
    
    <span class="hljs-keyword">if</span> grep -iqE <span class="hljs-string">"Quota exceeded|429|Too Many Requests"</span> <span class="hljs-string">"<span class="hljs-variable">$TMP_LOG</span>"</span>; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n\033[1;33m⚠️  检测到额度耗尽！启动自动故障转移...\033[0m"</span>
        
        <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$CURRENT_PROFILE</span>"</span> == <span class="hljs-string">"primary"</span> ]; <span class="hljs-keyword">then</span>
            <span class="hljs-variable">$MANAGER</span> switch secondary
        <span class="hljs-keyword">else</span>
            <span class="hljs-variable">$MANAGER</span> switch primary
        <span class="hljs-keyword">fi</span>
        
        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\033[1;32m🔄 已重试...\033[0m\n"</span>
        gemini <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">rm</span> <span class="hljs-string">"<span class="hljs-variable">$TMP_LOG</span>"</span>
<span class="hljs-keyword">else</span>
    gemini <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">🎉 最终效果：爽到飞起</h2>
<p>把这个脚本 <code>alias g='.../g.sh'</code> 后，我的开发体验发生了质变。</p>
<p><strong>全程无人工干预！</strong> 我甚至不用把手从键盘上拿开。</p>
<p>这才是 AI 时代该有的工作流啊兄弟们！<strong>把重复的劳动交给脚本，把脑子留给架构。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9e560aeee9e44e09e316c5d8da26e11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357140&amp;x-signature=Gq4wwrkCgnIiNcpqzbIqCnBT0z8%3D" alt="截屏2026-01-30 12.00.58.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe21352fac884919b553ab38c3026386~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357140&amp;x-signature=1Z8C7nouwpRhsP6l455FKZ8dnX8%3D" alt="截屏2026-01-30 13.51.18.png" loading="lazy"/></p>
<hr/>
<blockquote>
<p><strong>写在最后</strong>：
觉得有用的话，<strong>点赞、收藏、转发</strong>三连，别让你的 Gemini 饿着！🚀</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【翻译】将CSS裁剪功能引入React Native]]></title>    <link>https://juejin.cn/post/7600678255042002953</link>    <guid>https://juejin.cn/post/7600678255042002953</guid>    <pubDate>2026-01-30T04:15:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600678255042002953" data-draft-id="7600370554069123098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【翻译】将CSS裁剪功能引入React Native"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T04:15:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户60007181910"/> <meta itemprop="url" content="https://juejin.cn/user/3555196688934128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【翻译】将CSS裁剪功能引入React Native
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3555196688934128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户60007181910
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:15:04.000Z" title="Fri Jan 30 2026 04:15:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.callstack.com%2Fblog%2Fbringing-css-clipping-to-react-native" target="_blank" title="https://www.callstack.com/blog/bringing-css-clipping-to-react-native" ref="nofollow noopener noreferrer">www.callstack.com/blog/bringi…</a></p>
<p>作者：Kamil Paradowski</p>
<p>如果你曾在 React Native 中尝试创建倾斜标题或其他非矩形分隔区，你可能深有体会——总觉得缺少了什么。而在网页端，CSS 的 clip-path 特性让这些形状变得轻而易举。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.star-badge</span> { 
  <span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">polygon</span>(<span class="hljs-number">50%</span> <span class="hljs-number">0%</span>, <span class="hljs-number">61%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">98%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">68%</span> <span class="hljs-number">57%</span>, <span class="hljs-number">79%</span> <span class="hljs-number">91%</span>, <span class="hljs-number">50%</span> <span class="hljs-number">70%</span>, <span class="hljs-number">21%</span> <span class="hljs-number">91%</span>, <span class="hljs-number">32%</span> <span class="hljs-number">57%</span>, <span class="hljs-number">2%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">39%</span> <span class="hljs-number">35%</span>); 
}
</code></pre>
<p>但遗憾的是，该功能不适用于 React Native 应用，因此我们需要导入第三方库：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">MaskedView</span>} <span class="hljs-keyword">from</span> ...

&lt;<span class="hljs-title class_">MaskedView</span> path=<span class="hljs-string">"..."</span> /&gt;
</code></pre>
<p>这段代码的效果就是这个漂亮的形状：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4db672f8b311470d90ad519c82f1b29a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NjAwMDcxODE5MTA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770351304&amp;x-signature=MyT%2Fkkm2N9exTxIv15EHRDKa0VE%3D" alt="" loading="lazy"/>
最终我们实现了跨平台的星形遮罩效果。然而，网页和移动平台的代码差异显著。本文将探讨React Native如何通过类似CSS的StyleSheet API原生支持clip-path遮罩功能，并提出解决方案。</p>
<h2 data-id="heading-0">什么是CSS <code>clip-path</code>？</h2>
<p>CSS的clip-path属性定义了一个类似遮罩的裁剪区域：仅元素位于该区域内的部分可见，区域外内容均被隐藏。该区域由两部分构成：形状本身及其几何边框——后者决定了形状的定位与尺寸。</p>
<h3 data-id="heading-1">形状函数</h3>
<p>此参数定义裁剪的几何形状。可使用辅助形状函数(<code>circle()</code>、<code>polygon()</code>、<code>inset()</code>等)，或指向本地/远程资源(<code>url(image.png)</code>)。</p>
<blockquote>
<p>React Native的首个版本中不支持SVG图像的<code>clip-path</code>实现；<code>path()</code>形状无法正常工作。</p>
</blockquote>
<h3 data-id="heading-2">几何框</h3>
<p>此为参考帧。它告知渲染器应以元素"框"的哪个部分作为形状坐标系的原点<code>(0,0)</code>。默认值为<code>border-box</code>，也可使用<code>padding-box</code>、<code>content-box</code>或<code>margin-box</code>。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f7cbe89e02e410593c6a12f282ca5f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NjAwMDcxODE5MTA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770351304&amp;x-signature=Uj0I6IjVmy0%2BRGny%2FlHbsHU8hOM%3D" alt="几何框 - 边距框参考框" loading="lazy"/></p>
<h2 data-id="heading-3"><code>clip-path</code> 实战应用</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.avatar</span> { 
  <span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">circle</span>(<span class="hljs-number">50%</span>); 
}
<span class="hljs-selector-class">.star-badge</span> { 
  <span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">polygon</span>(<span class="hljs-number">50%</span> <span class="hljs-number">0%</span>, <span class="hljs-number">61%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">98%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">68%</span> <span class="hljs-number">57%</span>, <span class="hljs-number">79%</span> <span class="hljs-number">91%</span>, <span class="hljs-number">50%</span> <span class="hljs-number">70%</span>, <span class="hljs-number">21%</span> <span class="hljs-number">91%</span>, <span class="hljs-number">32%</span> <span class="hljs-number">57%</span>, <span class="hljs-number">2%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">39%</span> <span class="hljs-number">35%</span>); 
}
</code></pre>
<h2 data-id="heading-4">React Native 的独特之处</h2>
<p>在网页端，渲染栈由单一引擎（如 Blink）统一管理。它解析 CSS 并计算布局，随后借助 Skia 等图形引擎绘制屏幕上的每个像素。</p>
<p>相比之下，React Native 默认不自行绘制 UI。它更像一个协调者： 它将样式转换为布局指令，由宿主操作系统（iOS或Android）通过原生UI组件进行绘制。</p>
<p>本质上，网页在浏览器窗口内模拟UI，而React Native则利用手机原生构建块组装UI。</p>
<p>同时，React Native提供部分CSS功能供使用，但并非全部。让我们通过<code>clip-path</code>示例来观察实际运作机制。</p>
<p>如上所示的样式应呈现如下视图。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2704748e6a3a402f8205a061160815d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NjAwMDcxODE5MTA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770351304&amp;x-signature=yvX%2F1huF6m2cXnxVWGryYOU2wHo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">从样式到屏幕</h2>
<p>React Native 架构可视为分布式系统，它协调各组件间的协作。这意味着要为新属性添加支持，我们需要触及并修改其众多不同部分。</p>
<p>让我们逐一攻克这些环节。</p>
<p>当你在样式中写下示例定义 <code>clipPath: 'circle(50% at 25% 25%)'</code> 时，这场旅程便拉开了序幕。</p>
<h3 data-id="heading-6">从JS层开始</h3>
<p>React文件必须识别新属性的存在，因此我们需要确保TypeScript或Flow能检测到它。该属性的参数仅是文本，所以只需进行如下修改即可，对吧？</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">export</span> type ____ViewStyle_InternalBase = $ReadOnly&lt;{ <span class="hljs-comment">// ... isolation?: 'auto' | 'isolate', + clipPath?: string, }&gt;;</span>
</code></pre>
<p>‍‍其实不然。JS层还负责解析参数值并将其转换为对象结构，该结构随后由原生代码处理。这意味着我们还需添加解析功能及描述新<code>clipPath</code>输入模式的类型定义。</p>
<p>这必然需要配套测试及其他细微调整。为保持本文简洁明了，我将略过这些环节。让我们观察当新的CSS属性值（无论是解析后的对象还是原始字符串）传递至React Native C++核心层时会发生什么。</p>
<blockquote>
<p>近期 React Native 核心团队新增了<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact-native%2Ftree%2Fmain%2Fpackages%2Freact-native%2FReactCommon%2Freact%2Frenderer%2Fcss" target="_blank" title="https://github.com/facebook/react-native/tree/main/packages/react-native/ReactCommon/react/renderer/css" ref="nofollow noopener noreferrer">原生 CSS 解析器</a>。这意味着属性文本值可直接由 C++ 代码完成解析、分词及原生类型转换！此方案不仅略微提升性能，更是技术上更严谨的实现方式。不过该功能目前仍处于开发阶段，需通过内部功能开关启用。期待它能尽快成为默认配置。</p>
</blockquote>
<h3 data-id="heading-7">C++作为核心基础</h3>
<p>React Native的新架构渲染器（又称Fabric）采用C++作为跨平台共享核心。正是这一层实现了真正的跨平台兼容性。接收到的剪切路径数据需要以C++形式呈现，才能被iOS和Android（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevblogs.microsoft.com%2Freact-native%2F%25F0%259F%259A%2580react-native-windows-v0-81-is-here%2F" target="_blank" title="https://devblogs.microsoft.com/react-native/%F0%9F%9A%80react-native-windows-v0-81-is-here/" ref="nofollow noopener noreferrer">以及其他平台，如v0.81版本中默认采用新架构的Windows</a>）所使用。</p>
<p>让我们从头开始。要理解CSS属性变更如何触发应用重渲染，需完整解析React Native的渲染管道。</p>
<p>让我们逐步剖析：在添加新CSS属性功能时，各环节需要进行哪些具体变更。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a0cdd7ce07745c996782863fbd248f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NjAwMDcxODE5MTA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770351304&amp;x-signature=u7%2BxrfqdoFtWmuGScAYhA3Jmtjs%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>若想深入了解 React Native 的全新渲染管道，<a href="https://link.juejin.cn?target=https%3A%2F%2Freactnative.dev%2Farchitecture%2Foverview" target="_blank" title="https://reactnative.dev/architecture/overview" ref="nofollow noopener noreferrer">新架构的官方文档</a>对此有详尽阐述，尤其建议查阅<a href="https://link.juejin.cn?target=https%3A%2F%2Freactnative.dev%2Farchitecture%2Frender-pipeline" target="_blank" title="https://reactnative.dev/architecture/render-pipeline" ref="nofollow noopener noreferrer">渲染、提交与挂载</a>章节。</p>
</blockquote>
<p>一切始于名为<strong>协调</strong>的流程。在此阶段（即<strong>渲染阶段</strong>），React 的协调器会计算新旧 props 之间的差异，检测 props 变更，并安排重新渲染。上段已阐述此步骤的变更机制。</p>
<p>当 props 变更时，React 会克隆带有新 props 的 <em>Shadow Node</em>。不同于旧架构中通过异步消息传递至独立线程的低效方式，现在改用直接的 JSI 调用实现。</p>
<p>为何克隆在此处有效？</p>
<p>出于线程安全考虑，<em>Shadow Tree Nodes</em> 具有不可变性。要修改 CSS 属性时，渲染器无法直接修改现有节点。必须克隆受影响的Shadow Node并赋予新属性。通过结构共享机制回指未变更的旧节点，最大限度降低内存开销。</p>
<p>这正是我们需要介入的环节。</p>
<p><em>Shadow Node</em>是React阴影树元素的表示形式，包含源自JavaScript的属性及布局信息。我们需要扩展属性列表并新增一项。</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-keyword">namespace</span> facebook::react {

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseViewProps</span> : <span class="hljs-keyword">public</span> YogaStylableProps, <span class="hljs-keyword">public</span> AccessibilityProps {
	 <span class="hljs-comment">// ...</span>
	 
   <span class="hljs-comment">// Color</span>
   Float opacity{<span class="hljs-number">1.0</span>};
   SharedColor backgroundColor{};

   <span class="hljs-comment">// Borders</span>
   CascadedBorderRadii borderRadii{};
   CascadedBorderColors borderColors{};
   
 	 <span class="hljs-comment">// ...</span>
+  std::optional&lt;ClipPath&gt; clipPath{};
}

} <span class="hljs-comment">// namespace facebook::react</span>
</code></pre>
<p>将<code>clipPath</code>集成到<code>BaseViewProps</code>类定义中</p>
<p>在C++世界中，<code>std::optional&lt;T&gt;</code>表示该属性可为空，而<code>ClipPath</code>是我们用来表示此属性的新类型。其通常呈现如下形式：</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-keyword">namespace</span> facebook::react {

<span class="hljs-comment">// Define individual geometric primitives used for clipping</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">CircleShape</span> {
  std::optional&lt;ValueUnit&gt; r{};
  std::optional&lt;ValueUnit&gt; cx{};
  std::optional&lt;ValueUnit&gt; cy{};
    <span class="hljs-comment">// ...</span>
};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">EllipseShape</span> {
  std::optional&lt;ValueUnit&gt; rx{};
  std::optional&lt;ValueUnit&gt; ry{};
  std::optional&lt;ValueUnit&gt; cx{};
  std::optional&lt;ValueUnit&gt; cy{};
  <span class="hljs-comment">// ...</span>
}
...
<span class="hljs-comment">// A type-safe union representing any possible basic shape</span>
<span class="hljs-keyword">using</span> BasicShape = std::variant&lt;
    CircleShape,
    EllipseShape,
    InsetShape,
    PolygonShape,
    RectShape,
    XywhShape&gt;;

<span class="hljs-comment">// Standard box model enumerations for the clip reference box</span>
<span class="hljs-keyword">enum class</span> <span class="hljs-title class_">GeometryBox</span> : <span class="hljs-type">uint8_t</span> {
  MarginBox,
  BorderBox,
  ContentBox,
  PaddingBox
};

<span class="hljs-comment">// Main structure representing a full clip-path value</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ClipPath</span> {
  std::optional&lt;BasicShape&gt; shape;
  std::optional&lt;GeometryBox&gt; geometryBox;

  <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> ClipPath &amp;other) <span class="hljs-type">const</span>;

<span class="hljs-comment">// Debugging and serialization helpers</span>
<span class="hljs-meta">#<span class="hljs-keyword">if</span> RN_DEBUG_STRING_CONVERTIBLE</span>
  <span class="hljs-function">std::string <span class="hljs-title">toString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> RN_SERIALIZABLE_STATE</span>
  <span class="hljs-function">folly::dynamic <span class="hljs-title">toDynamic</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
};

} <span class="hljs-comment">// namespace facebook::react</span>
</code></pre>
<p><code>clipPath</code>属性实现的数据结构</p>
<p>我们需要确保，正如CSS规范所述，<code>clipPath</code>属性应导致<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2FGuides%2FPositioned_layout%2FStacking_context" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/Guides/Positioned_layout/Stacking_context" ref="nofollow noopener noreferrer">堆叠上下文</a>的创建。</p>
<p>这需要对<code>ViewShadowNode</code>类进行微调——该类是待挂载<code>&lt;View&gt;</code>组件的阴影节点表示形式。若未进行此调整，将导致意外结果，例如组件的子元素无法被剪切。</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ViewShadowNode::initialize</span><span class="hljs-params">()</span> <span class="hljs-keyword">noexcept</span> </span>{
  <span class="hljs-comment">// ...</span>
  <span class="hljs-type">bool</span> formsStackingContext = !viewProps.collapsable ||
      viewProps.pointerEvents == PointerEventsMode::None ||
      !viewProps.nativeId.<span class="hljs-built_in">empty</span>() || viewProps.accessible ||
      viewProps.opacity != <span class="hljs-number">1.0</span> || viewProps.transform != Transform{} ||
      (viewProps.zIndex.<span class="hljs-built_in">has_value</span>() &amp;&amp;
       viewProps.yogaStyle.<span class="hljs-built_in">positionType</span>() != yoga::PositionType::Static) ||
      viewProps.yogaStyle.<span class="hljs-built_in">display</span>() == yoga::Display::None ||
      viewProps.<span class="hljs-built_in">getClipsContentToBounds</span>() || viewProps.events.bits.<span class="hljs-built_in">any</span>() ||
      <span class="hljs-built_in">isColorMeaningful</span>(viewProps.shadowColor) ||
      viewProps.accessibilityElementsHidden ||
      viewProps.accessibilityViewIsModal ||
      viewProps.importantForAccessibility != ImportantForAccessibility::Auto ||
      viewProps.removeClippedSubviews || viewProps.cursor != Cursor::Auto ||
      !viewProps.filter.<span class="hljs-built_in">empty</span>() ||
      viewProps.mixBlendMode != BlendMode::Normal ||
      viewProps.isolation == Isolation::Isolate ||
      HostPlatformViewTraitsInitializer::formsStackingContext(viewProps) ||
      !viewProps.accessibilityOrder.<span class="hljs-built_in">empty</span>() ||
+     viewProps.clipPath.<span class="hljs-built_in">has_value</span>();
  <span class="hljs-comment">// ...</span>
  <span class="hljs-keyword">if</span> (formsStackingContext) {
    traits_.<span class="hljs-built_in">set</span>(ShadowNodeTraits::Trait::FormsStackingContext);
  } <span class="hljs-keyword">else</span> {
    traits_.<span class="hljs-built_in">unset</span>(ShadowNodeTraits::Trait::FormsStackingContext);
  }
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>更新堆叠上下文逻辑以包含剪裁路径</p>
<p><strong>渲染</strong>完成后，将触发阴影树的提交操作。该操作将新树提升为待挂载的"下一棵树"，并安排布局计算（Yoga）。</p>
<p>接下来的最后阶段是<strong>挂载</strong>：将React阴影树转换为主视图树。</p>
<p>该过程包含三个步骤：</p>
<ul>
<li><strong>Tree Diff</strong>：计算当前树与后续树之间的差异。</li>
<li><strong>Tree Promotion</strong>：确保后续挂载阶段基于正确树进行差异计算。</li>
<li><strong>View Mounting</strong>：执行实际渲染变更。</li>
</ul>
<p>至此我们已了解属性变更信息如何从JavaScript层级传播至宿主平台层级。接下来让我们探究iOS与Android平台中<code>clip-path</code>的具体实现方式。</p>
<h3 data-id="heading-8">iOS 中的剪切功能</h3>
<p>React Native 使用 UIKit 来处理和构建 UI 元素，其最基础的构建块是 <code>UIView</code>。在 <code>UIKit</code> 中，每个 <code>UIView</code> 都由一个 <code>CALayer</code>（核心动画层）支撑。当视图处理触摸等用户交互时，该层实际负责在屏幕上渲染内容，并充当画布。每个图层都拥有一个作为透明度遮罩的mask属性——它决定了哪些内容可见、哪些内容隐藏。掌握这些知识后，让我们开始实现吧！</p>
<p>值得庆幸的是，React Native iOS 提供了一个自定义类（<code>RCTViewComponentView</code>），它继承自 <code>UIView</code>。所有创建的视图类型（无论是 <code>&lt;View&gt;</code> 还是 <code>&lt;Image&gt;</code>）都继承自该类。这意味着我们只需在此处添加剪切路径逻辑，即可适配所有 React Native 组件！关键实现点在于 <code>invalidateLayer</code> 函数，需通过下方代码块进行扩展：</p>
<pre><code class="hljs language-C" lang="C">- (<span class="hljs-type">void</span>)invalidateLayer
{
  <span class="hljs-comment">// ...</span>
  <span class="hljs-comment">// Handle clip-path property</span>
  <span class="hljs-keyword">if</span> (_props-&gt;clipPath.has_value()) {
    CALayer *maskLayer = [RCTClipPathUtils createClipPathLayer:_props-&gt;clipPath.value()
                                                 layoutMetrics:_layoutMetrics
                                                     yogaStyle:_props-&gt;yogaStyle
                                                        bounds:layer.bounds
                                                   cornerRadii:RCTCornerRadiiFromBorderRadii(borderMetrics.borderRadii)];
    <span class="hljs-keyword">if</span> (maskLayer != nil) {
      self.currentContainerView.layer.mask = maskLayer;
    }
  }
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>对 <code>invalidateLayer</code> 函数的修改</p>
<p>其中 <code>createClipPathLayer</code> 是一个辅助函数，负责计算几何边界框并创建形状路径。让我们来看看它的具体实现。</p>
<pre><code class="hljs language-C" lang="C">+ (CALayer *)createClipPathLayer:(<span class="hljs-type">const</span> ClipPath &amp;)clipPath
                   layoutMetrics:(<span class="hljs-type">const</span> LayoutMetrics &amp;)layoutMetrics
                       yogaStyle:(<span class="hljs-type">const</span> facebook::yoga::Style &amp;)yogaStyle
                          bounds:(CGRect)bounds
                     cornerRadii:(RCTCornerRadii)cornerRadii
{
  CGRect box = [self getGeometryBoxRect:clipPath.geometryBox
                          layoutMetrics:layoutMetrics
                              yogaStyle:yogaStyle
                                 bounds:bounds];
</code></pre>
<ol>
<li>首先，我们需要确定正确的几何框边界。我们需要使用正确的参考框并调整其角半径。</li>
</ol>
<pre><code class="hljs language-C" lang="C">  UIBezierPath *path = nil;
  <span class="hljs-keyword">if</span> (clipPath.shape.has_value()) {
    <span class="hljs-comment">// clipPath: circle(50%) content-box</span>
    path = [RCTBasicShapeUtils createPathFromBasicShape:clipPath.shape.value() bounds:box];
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (clipPath.geometryBox.has_value()) {
    <span class="hljs-comment">// clipPath: content-box</span>
    path = [UIBezierPath bezierPathWithCGPath:RCTPathCreateWithRoundedRect(box, cornerInsets, nil, NO)];
  }
</code></pre>
<ol start="2">
<li>UIKit 提供了一个辅助类 <code>UIBezierPath</code> 用于路径操作。对于每个支持的形状，我们需要使用新辅助函数 <code>createPathFromBasicShape</code> 创建描述该形状的路径。若形状已定义，则创建对应路径；否则，若提供了几何框路径，则使用该路径。</li>
</ol>
<pre><code class="hljs language-C" lang="C">  <span class="hljs-comment">// Skip invalid or empty path</span>
  <span class="hljs-keyword">if</span> (path == nil) {
    <span class="hljs-keyword">return</span> nil;
  }
  
  CAShapeLayer *maskLayer = [CAShapeLayer layer];
  maskLayer.path = path.CGPath;
  <span class="hljs-keyword">return</span> maskLayer;
}
</code></pre>
<ol start="3">
<li>若结果路径正确，可通过 <code>CAShapeLayer</code> 类创建遮罩图层。该遮罩图层将在 <code>invalidateLayer</code> 函数中作为 <code>UIView</code> 的遮罩使用。</li>
</ol>
<p><code>createPathFromBasicShape</code> 的实现方式如下？下面给出矩形形状的示例：</p>
<pre><code class="hljs language-C" lang="C">+ (UIBezierPath *)createRectPath:(<span class="hljs-type">const</span> RectShape &amp;)rect bounds:(CGRect)bounds
{
  <span class="hljs-comment">// Define corners</span>
  CGFloat top = bounds.origin.y + RCTResolveValueUnit(rect.top, bounds.size.height);
  CGFloat right = bounds.origin.x + RCTResolveValueUnit(rect.right, bounds.size.width);
  CGFloat bottom = bounds.origin.y + RCTResolveValueUnit(rect.bottom, bounds.size.height);
  CGFloat left = bounds.origin.x + RCTResolveValueUnit(rect.left, bounds.size.width);

  <span class="hljs-comment">// Create a rect</span>
  CGRect clipRect = CGRectMake(left, top, right - left, bottom - top);

  <span class="hljs-comment">// Catch for invalid dimensions</span>
  <span class="hljs-keyword">if</span> (clipRect.size.width &lt; <span class="hljs-number">0</span> || clipRect.size.height &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> nil;
  }

  <span class="hljs-comment">// Adjust radius</span>
  CGFloat borderRadius = rect.borderRadius.has_value() ? RCTResolveValueUnit(rect.borderRadius.value(), MIN(clipRect.size.width, clipRect.size.height)) : <span class="hljs-number">0.0f</span>;
  
  <span class="hljs-comment">// Use bezierPathWithRoundedRect to create rounder rect bezier path</span>
  <span class="hljs-keyword">return</span> [UIBezierPath bezierPathWithRoundedRect:clipRect cornerRadius:borderRadius];
}
</code></pre>
<p>综合所有内容，我们终于在React Native中实现了适用于iOS的<code>clipPath</code>功能！</p>
<p>当然，我略去了部分实现细节，包括检测属性变更、标记需要无效化的图层、原生解析属性文本值、将CSS类型转换为图形类型等。但这仍能让你掌握整个流程的核心要义。若感兴趣，可在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact-native%2Fpulls%3Fq%3Dis%253Apr%2Bis%253Aopen%2B%2522add%2Bclip-path%2522" target="_blank" title="https://github.com/facebook/react-native/pulls?q=is%3Apr+is%3Aopen+%22add+clip-path%22" ref="nofollow noopener noreferrer">此处</a>查看所有变更的链接。</p>
<h2 data-id="heading-9">Android 平台的裁剪实现</h2>
<p>Android 设计略有不同，这并不令人意外。</p>
<p>每个Android端的React Native组件都以<code>View</code>类实现。虽然存在<code>ViewOutlineProvider</code>等替代方案处理简单圆角，但它们往往难以应对复杂形状。</p>
<p>针对Android视图裁剪需求，最流行且适用的解决方案是重写<code>draw</code>方法，直接在画布上应用裁剪操作。Android的<code>Canvas</code>类为此提供了专属函数<code>clipPath</code>和<code>clipRect</code>——这正是我们所需的功能！</p>
<p>Android 与 iOS 的区别在于：Android 没有适用于所有组件类型的基础 <code>View</code> 类（存在某些例外情况会破坏通用解决方案）。但 React Native 提供了一个特殊的辅助类 <code>BackgroundStyleApplicator</code>，该类可用于并适用于所有 <code>View</code>。</p>
<p>我们可以在该类中添加<code>clipPath</code>逻辑，并从其他所有位置调用它。对于代表 <code>&lt;Image&gt;</code> 组件的 <code>ReactImageView </code>类，代码实现如下：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> override fun <span class="hljs-title function_">draw</span><span class="hljs-params">(canvas: Canvas)</span> {
  BackgroundStyleApplicator.applyClipPathIfPresent(<span class="hljs-built_in">this</span>, canvas) {
    <span class="hljs-built_in">super</span>.draw(canvas)
  }
}
</code></pre>
<p>其中 <code>applyClipPathIfPresent</code> 是一个函数，其简化版本可表示为：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> fun <span class="hljs-title function_">applyClipPathIfPresent</span><span class="hljs-params">(view: View, canvas: Canvas, drawContent: (()</span> -&gt; Unit?)?) {
    <span class="hljs-comment">// ...</span>
    canvas.withSave {
      <span class="hljs-comment">// ...</span>
      <span class="hljs-comment">// Calculation of geometry-box</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">bounds</span> <span class="hljs-operator">=</span> getGeometryBoxBounds(...)
      
      <span class="hljs-comment">// Path creation</span>
      val path: Path? = <span class="hljs-keyword">if</span> (clipPath.shape != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// clipPath: circle(50%) content-box</span>
        ClipPathUtils.createPathFromBasicShape(clipPath.shape, bounds)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (clipPath.geometryBox != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// clipPath: content-box</span>
        ClipPathUtils.createRoundedRectPath(bounds,
          GeometryBoxUtil.adjustBorderRadiusForGeometryBox(view, clipPath.geometryBox, ...)
        )
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-literal">null</span>
      }

      <span class="hljs-comment">// Clipping logic</span>
      <span class="hljs-keyword">if</span> (path != <span class="hljs-literal">null</span>) {
        clipPath(path)
      }

      <span class="hljs-comment">// Draw actual content to be clipped</span>
      drawContent?.invoke()
    }
  }
</code></pre>
<p>该逻辑与iOS非常相似：</p>
<ol>
<li>首先，我们使用新辅助函数<code>getGeometryBoxBounds</code>计算<code>geometry-box</code>。</li>
<li>然后创建描述形状的路径并传递给<code>clip-path</code>。</li>
<li>最后调用相应的<code>Canvas</code>方法来剪切绘图区域。</li>
</ol>
<p>以下是Android平台创建矩形形状的方法：</p>
<pre><code class="hljs language-Java" lang="Java"> <span class="hljs-keyword">private</span> fun <span class="hljs-title function_">createRectPath</span><span class="hljs-params">(rect: RectShape, bounds: RectF)</span>: Path? {
    <span class="hljs-comment">// Define corners</span>
    <span class="hljs-type">val</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span> bounds.top + resolveLengthPercentage(rect.top, bounds.height())
    <span class="hljs-type">val</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> bounds.left + resolveLengthPercentage(rect.right, bounds.width())
    <span class="hljs-type">val</span> <span class="hljs-variable">bottom</span> <span class="hljs-operator">=</span> bounds.top + resolveLengthPercentage(rect.bottom, bounds.height())
    <span class="hljs-type">val</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> bounds.left + resolveLengthPercentage(rect.left, bounds.width())

    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// Create path</span>
    <span class="hljs-type">val</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Path()
    <span class="hljs-keyword">if</span> (rect.borderRadius != <span class="hljs-literal">null</span>) {
      <span class="hljs-comment">// Rounded corners case</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">referenceDimension</span> <span class="hljs-operator">=</span> minOf(rect.width(), rect.height())
      <span class="hljs-type">val</span> <span class="hljs-variable">radius</span> <span class="hljs-operator">=</span> resolveLengthPercentage(borderRadius, referenceDimension)
      path.addRoundRect(rect, radius, radius, Path.Direction.CW)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// Sharp edges case</span>
      path.addRect(rect, Path.Direction.CW)
    }

    <span class="hljs-keyword">return</span> path
  }
</code></pre>
<p>所有操作都包裹在<code>withSave</code>块中。这样做是为了确保我们对画布的修改不会影响其他绘制调用，否则可能导致意外行为。</p>
<p>那么裁剪视图背景、子视图或其效果会怎样？我们需要快速分析Android图形管道，并检查<code>draw(Canvas)</code>方法的实际作用。通过查看<code>View</code>类的源代码即可轻松验证：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// Step 1, draw the background, if needed</span>
drawBackground(canvas)
<span class="hljs-comment">// Step 2, save the canvas' layers</span>
<span class="hljs-comment">// ...</span>
<span class="hljs-comment">// Step 3, draw the content</span>
onDraw(canvas)
<span class="hljs-comment">// Step 4, draw the children</span>
dispatchDraw(canvas)
<span class="hljs-comment">// Step 5, draw the fade effect and restore layers</span>
<span class="hljs-comment">// ...</span>
<span class="hljs-comment">// Step 6, draw decorations (foreground, scrollbars)</span>
onDrawForeground(canvas)
<span class="hljs-comment">// Step 7, draw the default focus highlight</span>
drawDefaultFocusHighlight(canvas)
</code></pre>
<p>在调用 <code>super.draw(canvas)</code> 之前对画布应用裁剪操作，可确保组件的所有可绘制部分均被我们的代码裁剪。只需将此操作添加到所有 <code>View</code> 类中，任务就完成了！很简单吧？</p>
<p>正如你所料，我又把过程简化了。最初还需额外处理：进行类型转换、在多处添加对新属性的支持调整，以及最关键的一步——在挂载过程中计算并缓存布局信息，以确保<code>geometry-box</code>计算准确。</p>
<p>不过这些内容可以另写一篇文章详述，希望本文能为你提供基础思路。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73791a004772436fa86adb8d4a7968eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NjAwMDcxODE5MTA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770351304&amp;x-signature=g4LWEPVAAdDan3vCOc1dzSsLCLE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">总结</h2>
<p>和许多移动开发者一样，我喜欢用React Native构建应用。它让我能复用网页开发技能，为iOS、Android等平台打造应用。</p>
<p>但过程并非一帆风顺。某些在网页端用CSS就能轻松实现的功能，在这里需要借助封装原生视图的第三方库——这又是一项新技能。</p>
<p>通过增强React Native对CSS的支持，我期待我们能更接近这样一个世界：在移动应用中充分运用所有网页样式设计知识。</p>
<p>希望您喜欢这次关于CSS与React Native新架构底层运作机制的小探索，并从中获得新知。</p>
<p>目前有三份为React Native引入<code>clip-path</code>支持的PR<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact-native%2Fpulls%3Fq%3Dis%253Apr%2Bis%253Aopen%2B%2522add%2Bclip-path%2522" target="_blank" title="https://github.com/facebook/react-native/pulls?q=is%3Apr+is%3Aopen+%22add+clip-path%22" ref="nofollow noopener noreferrer">正在审核</a>中。待它们合并发布后，期待您用它打造出精彩的作品！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Retrofit框架原理分析]]></title>    <link>https://juejin.cn/post/7600670417858773026</link>    <guid>https://juejin.cn/post/7600670417858773026</guid>    <pubDate>2026-01-30T03:51:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670417858773026" data-draft-id="7600665529113477120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Retrofit框架原理分析"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-30T03:51:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Retrofit框架原理分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:51:17.000Z" title="Fri Jan 30 2026 03:51:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一.基本用法</h3>
<h5 data-id="heading-1">1.创建Retrofit对象</h5>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HttpRetrofit</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Retrofit mRetrofit;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Retrofit <span class="hljs-title">getService</span>()</span>{
        <span class="hljs-keyword">if</span> (mRetrofit == <span class="hljs-literal">null</span>) {
            synchronized (HttpRetrofit.<span class="hljs-keyword">class</span>) {
                <span class="hljs-keyword">if</span> (mRetrofit == <span class="hljs-literal">null</span>) {
                    mRetrofit = <span class="hljs-keyword">new</span> Retrofit.Builder()
                            .baseUrl(ApiUrl.BASE_URL)
                            .client(WBHttpClient.getHttpClient())
                            .addConverterFactory(GsonConverterFactory.create())
                            .addCallAdapterFactory(RxJava2CallAdapterFactory.create())
                            .build();
                }
            }
        }
        <span class="hljs-keyword">return</span> mRetrofit;
    }
}
</code></pre>
<h5 data-id="heading-2">2.retrofit各种网络请求的用法</h5>
<pre><code class="hljs language-sql" lang="sql">  <span class="hljs-comment">/************************************GET网络请求方式******************************************************/</span>
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：<span class="hljs-keyword">GET</span>请求最简单的写法,无Path参数和Query参数 <span class="hljs-operator">*</span><span class="hljs-operator">/</span>
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-variable">@GET</span>("article/list/latest?page=1") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> getLatestString();
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：<span class="hljs-keyword">GET</span>请求，指定Path参数和Query参数
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-variable">@GET</span>("article/list/{type}?") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>QiushiModel<span class="hljs-operator">&gt;</span> getInfoList(<span class="hljs-variable">@Path</span>("type") String type, <span class="hljs-variable">@Query</span>("page") <span class="hljs-type">int</span> page);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：<span class="hljs-keyword">GET</span>请求提交数据
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-variable">@GET</span>("MyWeb/RegServlet") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> getRegInfo(<span class="hljs-variable">@QueryMap</span> Map<span class="hljs-operator">&lt;</span>String, String<span class="hljs-operator">&gt;</span> map);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：<span class="hljs-keyword">GET</span>请求,指定URL参数
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-variable">@GET</span> <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>QiushiModel<span class="hljs-operator">&gt;</span> getInfoList(<span class="hljs-variable">@Url</span> String urlString);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>访问网络，下载大文件。 <span class="hljs-operator">*</span> 默认情况下，Retrofit在处理结果前会将服务器端的Response全部读进内存
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-variable">@Streaming</span> <span class="hljs-variable">@GET</span> <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> getNetworkDataAsync(<span class="hljs-variable">@Url</span> String urlString);
    <span class="hljs-comment">/************************************POST网络请求方式******************************************************/</span>
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用:post网络请求，向服务器提交表单域数据
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-variable">@FormUrlEncoded</span> <span class="hljs-variable">@POST</span>("MyWeb/RegServlet") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> postFormFields(<span class="hljs-variable">@Field</span>("username") String username, <span class="hljs-variable">@Field</span>("password") String password, <span class="hljs-variable">@Field</span>("age") String age);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-variable">@FormUrlEncoded</span> <span class="hljs-variable">@POST</span>("MyWeb/RegServlet") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> postFormFieldMap(<span class="hljs-variable">@FieldMap</span> Map<span class="hljs-operator">&lt;</span>String , String<span class="hljs-operator">&gt;</span> map);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：POST网络请求，上传单个文件，上传后的文件名称已经被指定
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-variable">@Multipart</span> <span class="hljs-variable">@POST</span>("MyWeb/UploadServlet") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> postUploadFile(<span class="hljs-variable">@Part</span>("uploadfile\";filename<span class="hljs-operator">=</span>\"myuploadimg.png") RequestBody requestBody);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：POST网络请求，上传多个文件，同时上传表单域数据
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-variable">@POST</span>("MyWeb/UPloadServlet") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> postUploadFilesMultipartBody(<span class="hljs-variable">@Body</span> MultipartBody multipartBody);}
<span class="hljs-operator">/</span><span class="hljs-operator">/</span>和Rxjava一起连用
  <span class="hljs-variable">@GET</span>(ApiUrl.GET_MARKET)
    Observable<span class="hljs-operator">&lt;</span>BaseResult<span class="hljs-operator">&lt;</span>List<span class="hljs-operator">&lt;</span>MarketBean<span class="hljs-operator">&gt;&gt;</span><span class="hljs-operator">&gt;</span> getMarket(<span class="hljs-variable">@QueryMap</span> Map<span class="hljs-operator">&lt;</span>String ,Object<span class="hljs-operator">&gt;</span> map);

 mRetrofit.create(WebService.class).getMarket(map).
                subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).
                subscribe(<span class="hljs-keyword">new</span> ObserverCallBack<span class="hljs-operator">&lt;</span>BaseResult<span class="hljs-operator">&lt;</span>List<span class="hljs-operator">&lt;</span>MarketBean<span class="hljs-operator">&gt;&gt;</span><span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">new</span> ApiCallBack<span class="hljs-operator">&lt;</span>BaseResult<span class="hljs-operator">&lt;</span>List<span class="hljs-operator">&lt;</span>MarketBean<span class="hljs-operator">&gt;&gt;</span><span class="hljs-operator">&gt;</span>() {
                    <span class="hljs-variable">@Override</span>
                    public void onSuccess(BaseResult<span class="hljs-operator">&lt;</span>List<span class="hljs-operator">&lt;</span>MarketBean<span class="hljs-operator">&gt;&gt;</span> baseResult) {

                    }
                    <span class="hljs-variable">@Override</span>
                    public void onFailture(Throwable e,<span class="hljs-type">int</span> errorCode) {

                    }
                }));
</code></pre>
<h5 data-id="heading-3">3.动态代理示例【<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fgonjan-blog%2Fp%2F6685611.html%25E3%2580%2591" target="_blank" title="https://www.cnblogs.com/gonjan-blog/p/6685611.html%E3%80%91" ref="nofollow noopener noreferrer">www.cnblogs.com/gonjan-blog…</a></h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a84082a625794b3fa0b1012d10c509bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349877&amp;x-signature=ItJjt5Xy4uzFx5wu94L%2F1EHewZY%3D" alt="image.png" loading="lazy"/></p>
<p>动态代理(代理类在运行前不存在，运行时由程序生成的代理方式叫动态代理)
实现方式：创建一个实现了InvocationHandler 接口的类，然后实现其invoke方法,然后使用Proxy.newProxyInstance（）方法创建代理对象，通过代理对象，调用接口中的方法，实际上是调用的InvocationHandler 中的invoke方法</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">/**
 * 创建Person接口
 * @author Gonjan
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Person</span> {
    <span class="hljs-comment">//上交班费</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">giveMoney</span>()</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <span class="hljs-title">implements</span> <span class="hljs-title">Person</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span>(<span class="hljs-params">String name</span>)</span> {
        <span class="hljs-keyword">this</span>.name = name;
    }
    
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">giveMoney</span>()</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">//假设数钱花了一秒时间</span>
            Thread.sleep(<span class="hljs-number">1000</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
       System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"上交班费50元"</span>);
    }
}

</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StuInvocationHandler</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
   <span class="hljs-comment">//invocationHandler持有的被代理对象</span>
    T target;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StuInvocationHandler</span><span class="hljs-params">(T target)</span> {
       <span class="hljs-built_in">this</span>.target = target;
    }
    
    <span class="hljs-comment">/**
     * proxy:代表动态代理对象
     * method：代表正在执行的方法
     * args：代表调用目标方法时传入的实参
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        System.out.println(<span class="hljs-string">"代理执行"</span> +method.getName() + <span class="hljs-string">"方法"</span>);
     */   
        <span class="hljs-comment">//代理过程中插入监测方法,计算该方法耗时</span>
        MonitorUtil.start();
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);
        MonitorUtil.finish(method.getName());
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p>测试代理类：</p>
<pre><code class="hljs language-arduino" lang="arduino">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyTest</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>{
        
        <span class="hljs-comment">//创建一个实例对象，这个对象是被代理的对象</span>
        Person zhangsan = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Student</span>(<span class="hljs-string">"张三"</span>);
        
        <span class="hljs-comment">//创建一个与代理对象相关联的InvocationHandler</span>
        InvocationHandler stuHandler = <span class="hljs-keyword">new</span> <span class="hljs-built_in">StuInvocationHandler</span>&lt;Person&gt;(zhangsan);
        
        <span class="hljs-comment">//创建一个代理对象stuProxy来代理zhangsan，代理对象的每个执行方法都会替换执行Invocation中的invoke方法</span>
        Person stuProxy = (Person) Proxy.<span class="hljs-built_in">newProxyInstance</span>(Person.<span class="hljs-keyword">class</span>.<span class="hljs-built_in">getClassLoader</span>(), <span class="hljs-keyword">new</span> Class&lt;?&gt;[]{Person.<span class="hljs-keyword">class</span>}, stuHandler)；

       <span class="hljs-comment">//代理执行上交班费的方法</span>
        stuProxy.<span class="hljs-built_in">giveMoney</span>();
    }
}
</code></pre>
<p>打印结果：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa81d8f790684a23833d46f6c2c6b331~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349877&amp;x-signature=cjM1wJac6hu0dA%2BYGTdRc3m1Fq0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">二.原理解析</h3>
<p>(1)通过构造者模式创建一个retrofit实例，配置baseUrl，OkHttpClient，CallAdapterFactory(Rxjava2CallAdapterFactory将代理返回的call对象转化为Observable对象), ConvertFactory（GsonConvertFactory将代理返回的请求的结果转化为javabean）</p>
<p>(2).通过retrofit对象的create（Class service）返回一个Service的动态代理对象，在调用Service的方法的时候，就是动态调用invoke方法,在Invoke方法中，调用loadServiceMethod(method)，在这个方法中会通过给method进行反射，解析注解，得到参数，请求头，请求地址，等等，构建Request请求所有需要的参数等，并提供toRequest()方法得到Request实例，然后构建OkHttpCall(servicMethod,args),通过
serviceMethod.callAdapter.adat(okHttpCall)，返回一个Observable或者是Call。</p>
<pre><code class="hljs language-scss" lang="scss">如果是Call&lt;T&gt; call；
call<span class="hljs-selector-class">.enqueue</span>( Callback&lt;T&gt; callback){
    Request request = serviceMethod<span class="hljs-selector-class">.toRequest</span>(args);
    okhttp3<span class="hljs-selector-class">.Call</span> call = serviceMethod<span class="hljs-selector-class">.callFactory</span><span class="hljs-selector-class">.newCall</span>(request);
}
如果是Observable&lt;T&gt; ,会调用subcribe添加观察者，实际会调用<span class="hljs-built_in">subscribeActual</span>(),在此方法中
observable<span class="hljs-selector-class">.subcribe</span>(new Observer(){}) <span class="hljs-comment">//添加观察者</span>
 <span class="hljs-comment">//Observable接口中的订阅方法</span>
  public final void <span class="hljs-built_in">subscribe</span>(Observer&lt;? super T&gt; observer) {
        ObjectHelper<span class="hljs-selector-class">.requireNonNull</span>(observer, "observer is null");
        try {
            observer = RxJavaPlugins<span class="hljs-selector-class">.onSubscribe</span>(this, observer);
            ObjectHelper<span class="hljs-selector-class">.requireNonNull</span>(observer, "Plugin returned null Observer");
            <span class="hljs-built_in">subscribeActual</span>(observer); <span class="hljs-comment">//调用该方法</span>
        } catch (NullPointerException e) { <span class="hljs-comment">// NOPMD</span>
            throw e;
        } catch (Throwable e) {  
        }
    }
<span class="hljs-comment">//CallEnqueueObservable中</span>
 protected void <span class="hljs-built_in">subscribeActual</span>(Observer&lt;? super Response&lt;T&gt;&gt; observer) {
    <span class="hljs-comment">// Since Call is a one-shot type, clone it for each new observer.</span>
    Call&lt;T&gt; call = originalCall<span class="hljs-selector-class">.clone</span>();
    CallCallback&lt;T&gt; callback = new CallCallback&lt;&gt;(call, observer);
    observer<span class="hljs-selector-class">.onSubscribe</span>(callback);
    call<span class="hljs-selector-class">.enqueue</span>(callback);<span class="hljs-comment">//执行OKHttpCall中的enqueue方法</span>
  }

</code></pre>
<p>(3).create()方法源码</p>
<pre><code class="hljs language-scss" lang="scss"> public &lt;T&gt; T <span class="hljs-built_in">create</span>(final Class&lt;T&gt; service) {
    Utils<span class="hljs-selector-class">.validateServiceInterface</span>(service);
    if (validateEagerly) {
      <span class="hljs-built_in">eagerlyValidateMethods</span>(service);
    }
    return (T) Proxy<span class="hljs-selector-class">.newProxyInstance</span>(service.getClassLoader(), new Class&lt;?&gt;<span class="hljs-selector-attr">[]</span> { service },
        new <span class="hljs-built_in">InvocationHandler</span>() {
          private final Platform platform = Platform<span class="hljs-selector-class">.get</span>();

          <span class="hljs-keyword">@Override</span> public Object invoke(Object proxy, Method method, <span class="hljs-keyword">@Nullable</span> Object[] args)
              throws Throwable {
            <span class="hljs-comment">// If the method is a method from Object then defer to normal invocation.</span>
            if (method.getDeclaringClass() == <span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.class</span>) {
              return method<span class="hljs-selector-class">.invoke</span>(this, args);
            }
            if (platform.isDefaultMethod(method)) {
              return platform<span class="hljs-selector-class">.invokeDefaultMethod</span>(method, service, proxy, args);
            }
            ServiceMethod&lt;<span class="hljs-selector-tag">Object</span>, <span class="hljs-selector-tag">Object</span>&gt; serviceMethod =
                (ServiceMethod&lt;Object, Object&gt;) <span class="hljs-built_in">loadServiceMethod</span>(method);
            OkHttpCall&lt;<span class="hljs-selector-tag">Object</span>&gt; okHttpCall = new OkHttpCall&lt;&gt;(serviceMethod, args);
            <span class="hljs-comment">/*   adapt方法中根据addCallAdapterFactory类型，如果是RxJava2CallAdapterFactory就返回 
                  Observable&lt;T&gt;, 如果不传，则返回Call&lt;T&gt;   */</span>
              return serviceMethod<span class="hljs-selector-class">.callAdapter</span><span class="hljs-selector-class">.adapt</span>(okHttpCall); 
          }
        });
  }

<span class="hljs-comment">//Retrofit中构造模式创建一个ServiceMethod对象</span>
  ServiceMethod&lt;?, ?&gt; <span class="hljs-built_in">loadServiceMethod</span>(Method method) {
    ServiceMethod&lt;?, ?&gt; result = serviceMethodCache<span class="hljs-selector-class">.get</span>(method);
    if (result != null) return result;
    synchronized (serviceMethodCache) {
      result = serviceMethodCache<span class="hljs-selector-class">.get</span>(method);
      if (result == null) {
 <span class="hljs-comment">// this表示Retrofit，retrofit里面持有baseUrl,okHttpClient,convertFactory,callAdapterFactory</span>
<span class="hljs-comment">//method通过反射，解析注解，得到参数，header,isMulpart,isbody,isFormUrlEncode等构建Request的</span>
<span class="hljs-comment">//必要参数，并提供toRequest()返回Reqeust对象.</span>
        result = new ServiceMethod<span class="hljs-selector-class">.Builder</span>&lt;&gt;(this, method)<span class="hljs-selector-class">.build</span>();
        serviceMethodCache<span class="hljs-selector-class">.put</span>(method, result);
      }
    }
    return result;
  }

  public ServiceMethod <span class="hljs-built_in">build</span>() {
      callAdapter = <span class="hljs-built_in">createCallAdapter</span>();
      responseType = callAdapter<span class="hljs-selector-class">.responseType</span>();
      if (responseType == Response.class || responseType == okhttp3.Response.class) {
        throw <span class="hljs-built_in">methodError</span>("'"
            + Utils.getRawType(responseType)<span class="hljs-selector-class">.getName</span>()
            + "' is not <span class="hljs-selector-tag">a</span> valid response <span class="hljs-selector-tag">body</span> type. Did you mean ResponseBody?");
      }
      responseConverter = <span class="hljs-built_in">createResponseConverter</span>();

      for (Annotation annotation : methodAnnotations) {
        <span class="hljs-built_in">parseMethodAnnotation</span>(annotation); <span class="hljs-comment">//</span>
      }

      if (httpMethod == null) {
        throw <span class="hljs-built_in">methodError</span>("HTTP method annotation is required (e.g., @GET, @POST, etc.).");
      }

      if (!hasBody) {
        if (isMultipart) {
          throw <span class="hljs-built_in">methodError</span>(
              "Multipart can only be specified on HTTP methods with request body (e.g., @POST).");
        }
        if (isFormEncoded) {
          throw <span class="hljs-built_in">methodError</span>("FormUrlEncoded can only be specified on HTTP methods with "
              + "request body (e.g., @POST).");
        }
      }

      int parameterCount = parameterAnnotationsArray<span class="hljs-selector-class">.length</span>;
      parameterHandlers = new ParameterHandler&lt;?&gt;<span class="hljs-selector-attr">[parameterCount]</span>;
      for (int p = <span class="hljs-number">0</span>; p &lt; parameterCount; p++) {
        Type parameterType = parameterTypes<span class="hljs-selector-attr">[p]</span>;
        if (Utils.hasUnresolvableType(parameterType)) {
          throw <span class="hljs-built_in">parameterError</span>(p, "Parameter type must not include a type variable or wildcard: %s",
              parameterType);
        }

        Annotation<span class="hljs-selector-attr">[]</span> parameterAnnotations = parameterAnnotationsArray<span class="hljs-selector-attr">[p]</span>;
        if (parameterAnnotations == null) {
          throw <span class="hljs-built_in">parameterError</span>(p, "No Retrofit annotation found.");
        }

        parameterHandlers<span class="hljs-selector-attr">[p]</span> = <span class="hljs-built_in">parseParameter</span>(p, parameterType, parameterAnnotations);
      }

      if (relativeUrl == null &amp;&amp; !gotUrl) {
        throw <span class="hljs-built_in">methodError</span>("Missing either @%s URL or @Url parameter.", httpMethod);
      }
      if (!isFormEncoded &amp;&amp; !isMultipart &amp;&amp; !hasBody &amp;&amp; gotBody) {
        throw <span class="hljs-built_in">methodError</span>("Non-body HTTP method cannot contain @Body.");
      }
      if (isFormEncoded &amp;&amp; !gotField) {
        throw <span class="hljs-built_in">methodError</span>("Form-encoded method must contain at least one @Field.");
      }
      if (isMultipart &amp;&amp; !gotPart) {
        throw <span class="hljs-built_in">methodError</span>("Multipart method must contain at least one @Part.");
      }

      return new ServiceMethod&lt;&gt;(this);
    }
 <span class="hljs-comment">/*解析注解得到构建RequestBuilder的核心参数httpMethod，baseUrl，relativeUrl, headers,
        contentType, hasBody, isFormEncoded, isMultipart */</span>

 private void <span class="hljs-built_in">parseMethodAnnotation</span>(Annotation annotation) {
      if (annotation instanceof DELETE) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("DELETE", ((DELETE) annotation)<span class="hljs-selector-class">.value</span>(), false);
      } else if (annotation instanceof GET) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("GET", ((GET) annotation)<span class="hljs-selector-class">.value</span>(), false);
      } else if (annotation instanceof HEAD) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("HEAD", ((HEAD) annotation)<span class="hljs-selector-class">.value</span>(), false);
        if (!Void.class.equals(responseType)) {
          throw <span class="hljs-built_in">methodError</span>("HEAD method must use Void as response type.");
        }
      } else if (annotation instanceof PATCH) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("PATCH", ((PATCH) annotation)<span class="hljs-selector-class">.value</span>(), true);
      } else if (annotation instanceof POST) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("POST", ((POST) annotation)<span class="hljs-selector-class">.value</span>(), true);
      } else if (annotation instanceof PUT) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("PUT", ((PUT) annotation)<span class="hljs-selector-class">.value</span>(), true);
      } else if (annotation instanceof OPTIONS) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("OPTIONS", ((OPTIONS) annotation)<span class="hljs-selector-class">.value</span>(), false);
      } else if (annotation instanceof HTTP) {
        HTTP http = (HTTP) annotation;
        <span class="hljs-built_in">parseHttpMethodAndPath</span>(http.method(), http<span class="hljs-selector-class">.path</span>(), http<span class="hljs-selector-class">.hasBody</span>());
      } else if (annotation instanceof retrofit2.http.Headers) {
        String<span class="hljs-selector-attr">[]</span> headersToParse = ((retrofit2.http.Headers) annotation)<span class="hljs-selector-class">.value</span>();
        if (headersToParse.length == <span class="hljs-number">0</span>) {
          throw <span class="hljs-built_in">methodError</span>("@Headers annotation is empty.");
        }
        headers = <span class="hljs-built_in">parseHeaders</span>(headersToParse);
      } else if (annotation instanceof Multipart) {
        if (isFormEncoded) {
          throw <span class="hljs-built_in">methodError</span>("Only one encoding annotation is allowed.");
        }
        isMultipart = true;
      } else if (annotation instanceof FormUrlEncoded) {
        if (isMultipart) {
          throw <span class="hljs-built_in">methodError</span>("Only one encoding annotation is allowed.");
        }
        isFormEncoded = true;
      }
    }
</code></pre>
<p>(4).ServiceMethod中提供toRequest()生成Request.</p>
<pre><code class="hljs language-less" lang="less"> <span class="hljs-selector-tag">Request</span> <span class="hljs-selector-tag">toRequest</span>(<span class="hljs-variable">@Nullable</span> Object... args) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">IOException</span> {
    <span class="hljs-selector-tag">RequestBuilder</span> <span class="hljs-selector-tag">requestBuilder</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">RequestBuilder</span>(httpMethod, baseUrl, relativeUrl, headers,
        contentType, hasBody, isFormEncoded, isMultipart);

    @<span class="hljs-selector-tag">SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>) <span class="hljs-comment">// It is an error to invoke a method with the wrong arg types.</span>
    <span class="hljs-selector-tag">ParameterHandler</span>&lt;<span class="hljs-selector-tag">Object</span>&gt;<span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">handlers</span> = (ParameterHandler&lt;Object&gt;[]) <span class="hljs-selector-tag">parameterHandlers</span>;

    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">argumentCount</span> = <span class="hljs-selector-tag">args</span> != <span class="hljs-selector-tag">null</span> ? <span class="hljs-selector-tag">args</span><span class="hljs-selector-class">.length</span> : <span class="hljs-number">0</span>;
    <span class="hljs-selector-tag">if</span> (argumentCount != handlers.length) {
      <span class="hljs-selector-tag">throw</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">IllegalArgumentException</span>(<span class="hljs-string">"Argument count ("</span> + argumentCount
          + <span class="hljs-string">") doesn't match expected count ("</span> + handlers.length + <span class="hljs-string">")"</span>);
    }

    <span class="hljs-selector-tag">for</span> (int p = <span class="hljs-number">0</span>; p &lt; argumentCount; p++) {
      <span class="hljs-selector-tag">handlers</span><span class="hljs-selector-attr">[p]</span><span class="hljs-selector-class">.apply</span>(requestBuilder, args[p]);
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">requestBuilder</span><span class="hljs-selector-class">.build</span>();
  }
</code></pre>
<p>(5).当我们获取到一个Observable，是如何触发OkHttpCall执行的呢？</p>
<pre><code class="hljs language-java" lang="java"> <span class="hljs-comment">//Observable接口中的订阅方法</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">(Observer&lt;? <span class="hljs-built_in">super</span> T&gt; observer)</span> {
        ObjectHelper.requireNonNull(observer, <span class="hljs-string">"observer is null"</span>);
        <span class="hljs-keyword">try</span> {
            observer = RxJavaPlugins.onSubscribe(<span class="hljs-built_in">this</span>, observer);
            ObjectHelper.requireNonNull(observer, <span class="hljs-string">"Plugin returned null Observer"</span>);
            subscribeActual(observer); <span class="hljs-comment">//调用该方法</span>
        } <span class="hljs-keyword">catch</span> (NullPointerException e) { <span class="hljs-comment">// NOPMD</span>
            <span class="hljs-keyword">throw</span> e;
        } <span class="hljs-keyword">catch</span> (Throwable e) {  
        }
    }
<span class="hljs-comment">//CallEnqueueObservable中</span>
 <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribeActual</span><span class="hljs-params">(Observer&lt;? <span class="hljs-built_in">super</span> Response&lt;T&gt;&gt; observer)</span> {
    <span class="hljs-comment">// Since Call is a one-shot type, clone it for each new observer.</span>
    Call&lt;T&gt; call = originalCall.clone();
    CallCallback&lt;T&gt; callback = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CallCallback</span>&lt;&gt;(call, observer);
    observer.onSubscribe(callback);
    call.enqueue(callback);<span class="hljs-comment">//执行OKHttpCall中的enqueue方法</span>
  }

 <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Callback&lt;T&gt; callback)</span> {
        okhttp3.Call call;
     <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> serviceMethod.toRequest(args);
    <span class="hljs-comment">//执行Request请求.</span>
    okhttp3.<span class="hljs-type">Call</span>   <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> serviceMethod.callFactory.newCall(request); <span class="hljs-comment">//callFactory就是OkHttpClient实例</span>
  }
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Handler消息传递机制]]></title>    <link>https://juejin.cn/post/7600681071714779136</link>    <guid>https://juejin.cn/post/7600681071714779136</guid>    <pubDate>2026-01-30T03:53:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600681071714779136" data-draft-id="7600728866756526132" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Handler消息传递机制"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-30T03:53:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Handler消息传递机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:53:44.000Z" title="Fri Jan 30 2026 03:53:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Ff10cff5b4c25" target="_blank" title="https://www.jianshu.com/p/f10cff5b4c25" ref="nofollow noopener noreferrer">Android消息机制的原理及源码解析 - 简书 (jianshu.com)</a></p>
<p><a href="https://juejin.cn/post/6844903446571663374" target="_blank" title="https://juejin.cn/post/6844903446571663374">Android Handler 消息机制（解惑篇）</a></p>
<p><a href="https://juejin.cn/post/6844903783139393550" target="_blank" title="https://juejin.cn/post/6844903783139393550">Handler 都没搞懂，拿什么去跳槽啊？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fguolin_blog%2Farticle%2Fdetails%2F9991569" target="_blank" title="https://blog.csdn.net/guolin_blog/article/details/9991569" ref="nofollow noopener noreferrer">郭霖 android异步消息处理机制完全解</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c24abdb3f3c64601afed561a7eace259~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350024&amp;x-signature=vVMJsx8j5D1F2%2BkOy0gRwA2xZso%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-0">1.ActivityThread.main</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Looper.prepareMainLooper(); 
        <span class="hljs-type">ActivityThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityThread</span>();
        thread.attach(<span class="hljs-literal">false</span>, startSeq);<span class="hljs-comment">//把ApplicationThread对象给到AMS</span>
        Looper.loop(); 
  }

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareMainLooper</span><span class="hljs-params">()</span> {
        prepare(<span class="hljs-literal">false</span>);
        <span class="hljs-keyword">synchronized</span> (Looper.class) {
            <span class="hljs-keyword">if</span> (sMainLooper != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"The main Looper has already been prepared."</span>);
            }
            sMainLooper = myLooper();
        }
 }
<span class="hljs-comment">//新建Looper对象，并在构造方法中新建MessageQueue对象，把Looper对象放到存放到ThreadLocal类所在的ThreadMap中，以当前线程为key，Looper对象为值进行存储。</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> {
        <span class="hljs-keyword">if</span> (sThreadLocal.get() != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Only one Looper may be created per thread"</span>);
        }
        sThreadLocal.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Looper</span>(quitAllowed));
 }
<span class="hljs-keyword">private</span> <span class="hljs-title function_">Looper</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> {
      mQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageQueue</span>(quitAllowed);
      mThread = Thread.currentThread();
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)
            map.set(<span class="hljs-built_in">this</span>, value);
        <span class="hljs-keyword">else</span>
            createMap(t, value);
 }
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-meta">@Nullable</span> Looper <span class="hljs-title function_">myLooper</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sThreadLocal.get();
}
<span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
            ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);
            <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
                <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
                <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;
                <span class="hljs-keyword">return</span> result;
            }
        }
        <span class="hljs-keyword">return</span> setInitialValue();
}

</code></pre>
<h3 data-id="heading-1">2.Handler的基本用法</h3>
<pre><code class="hljs language-scss" lang="scss">Handler handler=new <span class="hljs-built_in">Handler</span>(){  
    public  void <span class="hljs-built_in">handleMessage</span>(Message msg){
           <span class="hljs-comment">//接收并处理消息</span>
   }
}
handler<span class="hljs-selector-class">.post</span>(runnable)；
handler<span class="hljs-selector-class">.sendMessage</span>(msg)；
</code></pre>
<h3 data-id="heading-2">3.Hanlder和Looper进行关联</h3>
<p>Handler构造方法，通过myLooper方法从ThreadLocal所在的ThreadMap中，根据当前的线程（作为key值）从ThreadMap中Looper对象，根据Looper对象得到MessageQueue对象，便于Handler发送消息时，可以把消息添加到MessageQueue对象中.</p>
<pre><code class="hljs language-ini" lang="ini">public Handler(Callback callback,boolean async){
         <span class="hljs-attr">mLooper</span>=Looper.myLooper()<span class="hljs-comment">;</span>
         <span class="hljs-attr">mQueue</span>=mLooper.mQueue<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-3">4.Handler.sendMessage或者Handler.post(runable)解析</h3>
<p>(1).Hanlder.post也是runnable封装成Message对象</p>
<pre><code class="hljs language-java" lang="java"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">post</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Runnable r)</span> {
       <span class="hljs-keyword">return</span>  sendMessageDelayed(getPostMessage(r), <span class="hljs-number">0</span>);
 }
 <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Message <span class="hljs-title function_">getPostMessage</span><span class="hljs-params">(Runnable r)</span> {
        <span class="hljs-type">Message</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> Message.obtain();
        m.callback = r;
        <span class="hljs-keyword">return</span> m;
}
</code></pre>
<p>(2).Handler.sendMessage最终会把消息添加到消息队列</p>
<pre><code class="hljs language-less" lang="less"> <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">sendMessage</span>(<span class="hljs-variable">@NonNull</span> Message msg) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">sendMessageDelayed</span>(msg, <span class="hljs-number">0</span>);
}
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">sendMessageDelayed</span>(<span class="hljs-variable">@NonNull</span> Message msg, long delayMillis) {
        <span class="hljs-selector-tag">if</span> (delayMillis &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-selector-tag">delayMillis</span> = <span class="hljs-number">0</span>;
        }
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">sendMessageAtTime</span>(msg, SystemClock.<span class="hljs-built_in">uptimeMillis</span>() + delayMillis);
 }
 <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">sendMessageAtTime</span>(<span class="hljs-variable">@NonNull</span> Message msg, long uptimeMillis) {
        <span class="hljs-selector-tag">MessageQueue</span> <span class="hljs-selector-tag">queue</span> = <span class="hljs-selector-tag">mQueue</span>;
        <span class="hljs-selector-tag">if</span> (queue == null) {
            <span class="hljs-selector-tag">RuntimeException</span> <span class="hljs-selector-tag">e</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">RuntimeException</span>(
                    this + <span class="hljs-string">" sendMessageAtTime() called with no mQueue"</span>);
            <span class="hljs-selector-tag">Log</span><span class="hljs-selector-class">.w</span>(<span class="hljs-string">"Looper"</span>, e.<span class="hljs-built_in">getMessage</span>(), e);
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">false</span>;
        }
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">enqueueMessage</span>(queue, msg, uptimeMillis);
    }
 <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">enqueueMessage</span>(<span class="hljs-variable">@NonNull</span> MessageQueue queue, <span class="hljs-variable">@NonNull</span> Message msg,
            long uptimeMillis) {
        <span class="hljs-selector-tag">msg</span><span class="hljs-selector-class">.target</span> = <span class="hljs-selector-tag">this</span>;
        <span class="hljs-selector-tag">msg</span><span class="hljs-selector-class">.workSourceUid</span> = <span class="hljs-selector-tag">ThreadLocalWorkSource</span><span class="hljs-selector-class">.getUid</span>();

        <span class="hljs-selector-tag">if</span> (mAsynchronous) {
            <span class="hljs-selector-tag">msg</span><span class="hljs-selector-class">.setAsynchronous</span>(true);
        }
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">queue</span><span class="hljs-selector-class">.enqueueMessage</span>(msg, uptimeMillis);
    }
</code></pre>
<h3 data-id="heading-4">5.Looper.loop开启死循环</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Looper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">Looper</span> <span class="hljs-variable">me</span> <span class="hljs-operator">=</span> myLooper();
    <span class="hljs-keyword">if</span> (me == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"No Looper; Looper.prepare() wasn't called on this thread."</span>);
    }
    <span class="hljs-keyword">final</span> <span class="hljs-type">MessageQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> me.mQueue;
    <span class="hljs-keyword">for</span> (;;) {
       <span class="hljs-comment">// 不断从 MessageQueue 获取 消息</span>
        <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> queue.next(); <span class="hljs-comment">// might block</span>
        <span class="hljs-comment">//退出 Looper </span>
        <span class="hljs-keyword">if</span> (msg == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">try</span> {
            msg.target.dispatchMessage(msg);<span class="hljs-comment">// msg.target就是Handler</span>
            end = (slowDispatchThresholdMs == <span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : SystemClock.uptimeMillis();
        } <span class="hljs-keyword">finally</span> {
        }
    }
}
</code></pre>
<h3 data-id="heading-5">6.Handler.dispatchMessage</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Handler</span>
public void <span class="hljs-built_in">dispatchMessage</span>(Message msg) {
  <span class="hljs-comment">//msg.callback 是 Runnable ，如果是 post方法则会走这个 if</span>
  if (msg.callback != null) {
    <span class="hljs-built_in">handleCallback</span>(msg);
  } else {
    <span class="hljs-comment">//callback 见【3.4】</span>
    if (mCallback != null) {
      if (mCallback.handleMessage(msg)) {
        return;
      }
    }
    <span class="hljs-comment">//回调到 Handler 的 handleMessage 方法</span>
    <span class="hljs-built_in">handleMessage</span>(msg);
  }
}
</code></pre>
<h3 data-id="heading-6">7.Handler延伸</h3>
<p>(1).为什么主线程不会因为Looper.loop()里面的死循环卡死？
handler机制是使用Linux管道来实现的，主线程没有消息处理时，也就是当queue.next获取消息时，
nativePollOnce，底层阻塞在管道读取端，主线程进入休眠状态，释放CPU资源，而不会一直去执行for循环，直到，MsgQueue里面有消息被添加进来，调用nativeWake()，底层管道写端写入数据，唤醒主线线程.
(2).Hanlder引起的内存泄漏原因以及最佳解决方案。
Handler允许我们发送延迟消息，如果在延时期间，用户关闭了Activity,那么Activity会泄露。
原因：Message（target）持有Handler,Handler作为内部类，持有外部类Activity,最终导致Activity内存泄漏。
解决该问题最有效的方法是：将Handler定义为静态内部类，在内部持有Activity的弱引用，并及时移除所有消息。</p>
<pre><code class="hljs language-scala" lang="scala">public static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SafeHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Handler</span></span>{
        <span class="hljs-keyword">private</span> <span class="hljs-type">WeakReference</span>&lt;<span class="hljs-type">HandleActivity</span>&gt; ref;
        public <span class="hljs-type">SafeHandler</span>(<span class="hljs-type">HandlerActivity</span> activity){
                ref=<span class="hljs-keyword">new</span> <span class="hljs-type">WeakReference</span>&lt;<span class="hljs-type">HandleActivity</span>&gt;(activity);
        }
       public void handleMessage(<span class="hljs-keyword">final</span> <span class="hljs-type">Message</span> mes){
              <span class="hljs-type">HandleActivity</span> activity=ref.get();
              <span class="hljs-keyword">if</span>(activity!=<span class="hljs-literal">null</span>){
                   activity.handleMessage(msg);
              }
      }
}
</code></pre>
<p>(3).子线程里面如何使用Handler</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable(){
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span>{
           <span class="hljs-comment">//新建一个Looper对象，把当期线程作为key值，存储到ThreadLocal类中的ThreadLocalMap中.</span>
          Looper.prepare();
       <span class="hljs-comment">//构造方法中根据当期线程，得到Looper对象,然后从Looper对象得到MsgQueue</span>
          Handler handler=<span class="hljs-keyword">new</span> Handler();
          handler.post(<span class="hljs-keyword">new</span> Runable(){ 
                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
                    <span class="hljs-comment">// 在这里执行你需要在子线程中完成的任务</span>
                }
          });
        <span class="hljs-comment">//启动消息循环</span>
        Looper.loop();
      }
}).start();
</code></pre>
<p>(4).在子线程中进行UI操作的方式.
Handler.post(runnable)
View.post
Activity.runOnUiThread</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Runloop的无限循环]]></title>    <link>https://juejin.cn/post/7600791597169180715</link>    <guid>https://juejin.cn/post/7600791597169180715</guid>    <pubDate>2026-01-30T04:20:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600791597169180715" data-draft-id="7600728866756706356" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Runloop的无限循环"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T04:20:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="betcha0724"/> <meta itemprop="url" content="https://juejin.cn/user/1757471366985452"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Runloop的无限循环
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1757471366985452/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    betcha0724
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:20:22.000Z" title="Fri Jan 30 2026 04:20:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>不是说runloop是无限循环吗，为啥主线程还会休眠？</p>
</blockquote>
<p><strong>Runloop 的 “无限循环” 和 “休眠” 并不矛盾</strong>，反而这两个特性是 Runloop 设计的核心精髓 ——<strong>Runloop 的无限循环是 “带休眠的循环”，不是空转的死循环</strong>，休眠正是为了让无限循环不消耗多余资源。</p>
<p>简单说结论：<strong>主线程 Runloop 的 while (1) 是 “逻辑上的无限循环”，但循环内部会主动触发线程休眠，直到有事件唤醒才继续执行循环体，而非一直空转执行代码</strong>。</p>
<h3 data-id="heading-0">一、先破误区：“无限循环”≠“一直执行代码”</h3>
<p>普通的空转死循环是这样的（会把 CPU 占满）：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 纯空转死循环：CPU 100%占用，线程一直跑</span>
<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {
    <span class="hljs-comment">// 什么都不做，持续循环</span>
}
</code></pre>
<p>而<strong>Runloop 的无限循环是 “智能循环”</strong> ，伪代码更接近这样：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Runloop的无限循环：有任务就执行，无任务就休眠</span>
<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {
    <span class="hljs-comment">// 1. 检查是否有待处理的事件/任务</span>
    <span class="hljs-keyword">if</span> (有任务) {
        处理任务（事件、渲染、回调等）;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 2. 无任务时，让线程进入「休眠状态」，释放CPU资源</span>
        内核层面让线程休眠，等待唤醒信号;
    }
}
</code></pre>
<p>Runloop 的 “无限” 体现在<strong>这个 while (1) 的逻辑永远不退出</strong>（主线程 Runloop 默认永不停止），但 ** 循环体的执行是 “按需触发”** 的 —— 无任务时根本不执行循环体的核心逻辑，而是让线程休眠。</p>
<h3 data-id="heading-1">二、关键原理：Runloop 如何实现 “休眠 - 唤醒”（内核层面）</h3>
<p>Runloop 的休眠不是自己实现的，而是基于<strong>操作系统内核的 IO 多路复用机制</strong>（iOS/macOS 下是<code>mach_msg</code>，底层封装了 select/poll/kqueue），这是跨平台事件驱动的通用方案，核心流程分 3 步：</p>
<ol>
<li><strong>无任务时，Runloop 调用<code>mach_msg</code>向内核发送 “休眠请求”</strong> ：主线程会从<strong>运行态</strong>切换为<strong>休眠态</strong>（也叫等待态），此时线程不会占用 CPU 的任何时间片，CPU 可以去处理其他线程 / 进程的任务，资源消耗几乎为 0；</li>
<li><strong>有事件时，内核主动唤醒线程</strong>：当有能唤醒 Runloop 的事件出现时（如 CADisplayLink 刷新、触摸事件、网络回调、定时器），<strong>内核会向该线程发送唤醒信号</strong>，触发<code>mach_msg</code>返回，线程从休眠态切回运行态；</li>
<li><strong>唤醒后继续执行循环体</strong>：Runloop 接收到唤醒信号后，继续执行 while (1) 的循环体，处理对应的任务，完成后再次检查是否有新任务，无任务则再次休眠。</li>
</ol>
<p><strong>对主线程来说</strong>：CADisplayLink（屏幕刷新定时器）是<strong>最常见的唤醒源</strong>（60Hz 下 16.67ms 唤醒一次），其次是用户的触摸、滑动等 UI 事件。</p>
<h3 data-id="heading-2">三、结合帧渲染理解：休眠 - 唤醒 - 渲染的完整循环（60Hz）</h3>
<p>把 Runloop 的休眠、唤醒和帧渲染结合，<strong>主线程的完整工作流程</strong>就非常清晰了（无其他 UI 事件时）：</p>
<ol>
<li>
<p><strong>休眠阶段</strong>：主线程 Runloop 无任务，调用<code>mach_msg</code>进入休眠，CPU 释放；</p>
</li>
<li>
<p><strong>定时唤醒</strong>：16.67ms 后，CADisplayLink 触发，内核唤醒主线程，Runloop 的 while (1) 继续执行；</p>
</li>
<li>
<p><strong>任务检查</strong>：Runloop 检查是否有 UI 更新标记（CATransaction）；</p>
<ul>
<li>✅<strong>有更新</strong>：执行布局→绘制→合成→显示的一帧渲染流程，完成后再次检查无新任务，进入休眠；</li>
<li>❌<strong>无更新</strong>：直接跳过渲染阶段，再次调用<code>mach_msg</code>进入休眠；</li>
</ul>
</li>
<li>
<p><strong>重复循环</strong>：每 16.67ms 被 CADisplayLink 唤醒一次，重复上述步骤。</p>
</li>
</ol>
<h3 data-id="heading-3">四、额外补充：为什么 Runloop 要设计 “休眠” 机制？</h3>
<p>如果主线程 Runloop 的无限循环<strong>没有休眠</strong>，而是一直空转检查任务，会导致两个严重问题：</p>
<ol>
<li><strong>CPU 占用率飙升</strong>：一个空转的 while (1) 会把单个 CPU 核心占满（100%），主线程是核心线程，会直接导致设备发热、耗电、卡顿；</li>
<li><strong>系统资源浪费</strong>：CPU 一直被 Runloop 的空转占用，无法分配给其他线程 / 进程（如后台网络、音频播放），整个 APP 的运行效率会大幅降低。</li>
</ol>
<p>而<strong>休眠机制</strong>完美解决了这两个问题：无任务时线程不占 CPU，有任务时及时唤醒，实现了 <strong>“按需执行，资源最优”</strong>，这也是 Runloop 能成为 iOS 事件驱动核心的关键原因。</p>
<h3 data-id="heading-4">最终一句话总结</h3>
<p>主线程 Runloop 是<strong>逻辑上的无限循环</strong>（while (1) 永不退出），但<strong>物理上的执行是按需的</strong>—— 无任务时通过内核让线程休眠，有事件（如屏幕刷新、UI 触摸）时被唤醒继续执行循环体，休眠和无限循环是 Runloop 的两个核心特性，而非矛盾点。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[主线程Runloop]]></title>    <link>https://juejin.cn/post/7600710943250579498</link>    <guid>https://juejin.cn/post/7600710943250579498</guid>    <pubDate>2026-01-30T04:23:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600710943250579498" data-draft-id="7600704706551185448" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="主线程Runloop"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T04:23:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="betcha0724"/> <meta itemprop="url" content="https://juejin.cn/user/1757471366985452"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            主线程Runloop
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1757471366985452/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    betcha0724
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:23:55.000Z" title="Fri Jan 30 2026 04:23:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>Runloop循环的代码，不是在主线程上运行的吗</p>
</blockquote>
<p><strong>Runloop 的这个无限循环代码，就是直接运行在主线程上的</strong>，这是核心关键 ——<strong>主线程的本质，就是执行 Runloop 无限循环的线程</strong>，二者是完全绑定的，不存在 “Runloop 循环在其他线程，主线程做别的事” 的情况。</p>
<h3 data-id="heading-0">一、先明确核心对应关系</h3>
<p>iOS 中<strong>主线程的入口函数</strong>，最终就是启动 Runloop 的无限循环，伪代码的对应关系是：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">// 主线程的入口（UIApplicationMain函数底层）
int main(int argc, char * argv[]) {
    @autoreleasepool {
        // 1. 初始化UIApplication、AppDelegate等核心对象
        // 2. 启动「主线程的Runloop」，执行无限循环
        CFRunLoopRunMain(); // 这个函数内部，就是Runloop的while(1)无限循环
        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));
    }
}
</code></pre>
<p>简单说：<strong>主线程启动后，唯一的核心工作就是执行 Runloop 的无限循环</strong>，主线程的所有任务（UI 事件、渲染、定时器、网络回调等），都<strong>必须在这个循环体内部执行</strong>。</p>
<h3 data-id="heading-1">二、关键：“主线程执行 Runloop 循环” 的具体含义</h3>
<p>你可以把<strong>主线程</strong>理解为<strong>一个 “执行代码的容器”</strong> ，把<strong>Runloop 的 while (1)<strong>理解为</strong>这个容器里永远在运行的 “主程序”</strong> ——</p>
<ol>
<li>主线程被创建后，立刻加载并执行 Runloop 的无限循环代码；</li>
<li>这个循环代码<strong>霸占了主线程的执行权</strong>，主线程后续所有的操作，都是<strong>在这个循环体的内部</strong>被触发和执行的（比如处理触摸事件、执行帧渲染、调用你的业务代码）；</li>
<li>只要 Runloop 的循环不退出，主线程就会一直存活（APP 前台运行时，主线程 Runloop 永不退出）；如果循环退出，主线程就会执行完毕并销毁（APP 退出时才会发生）。</li>
</ol>
<h3 data-id="heading-2">三、结合 “休眠” 再理解：主线程休眠 = Runloop 循环暂停</h3>
<p>之前说的<strong>Runloop 让线程休眠</strong>，本质就是<strong>让主线程本身进入休眠态</strong>：</p>
<ul>
<li>当 Runloop 执行到<code>mach_msg</code>（内核休眠接口）时，<strong>主线程</strong>会从<strong>运行态</strong>切换为<strong>休眠态</strong>，此时主线程不再执行任何代码（包括 Runloop 的循环体），CPU 也会释放；</li>
<li>当内核收到唤醒信号（如 CADisplayLink、触摸事件），会把<strong>主线程</strong>切回<strong>运行态</strong>，Runloop 的 while (1) 循环会继续执行后续的任务处理、渲染等逻辑。</li>
</ul>
<p><strong>一句话讲清</strong>：Runloop 的循环代码是主线程的 “核心程序”，主线程的生命周期和 Runloop 的循环绑定，Runloop 的休眠 / 唤醒就是主线程的休眠 / 唤醒。</p>
<h3 data-id="heading-3">四、再补一个易混点：主线程的任务，都在 Runloop 循环体内执行</h3>
<p>你在主线程写的所有代码（比如<code>viewDidLoad</code>、按钮点击事件、<code>dispatch_async(dispatch_get_main_queue(), ^{...})</code>），<strong>都不是直接 “塞” 到主线程</strong>，而是<strong>被加入到 Runloop 的任务队列中</strong>，等待 Runloop 的循环体执行到对应阶段时，再被主线程执行。</p>
<p>举个例子，按钮点击的执行流程：</p>
<ol>
<li>点击按钮，系统将 “点击事件” 加入<strong>主线程 Runloop 的事件队列</strong>；</li>
<li>内核唤醒主线程，Runloop 的 while (1) 循环继续执行；</li>
<li>Runloop 从事件队列中取出 “点击事件”，<strong>让主线程执行</strong>你写的点击回调代码；</li>
<li>回调执行完毕，Runloop 检查是否有 UI 更新 / 其他任务，无则让主线程再次休眠。</li>
</ol>
<h3 data-id="heading-4">最终总结</h3>
<ol>
<li>Runloop 的无限循环<strong>直接运行在主线程</strong>，是主线程的核心执行代码；</li>
<li>主线程的生命周期与 Runloop 循环绑定，循环不退出，主线程就一直存活；</li>
<li>Runloop 的 “休眠 / 唤醒” 就是<strong>主线程</strong>的休眠 / 唤醒，无任务时主线程休眠，有任务时被唤醒执行循环体；</li>
<li>主线程的所有任务（包括你的业务代码、UI 渲染、事件处理），都<strong>在 Runloop 循环体内部</strong>被执行。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Clawdbot 8万Star的背后：AI 助理真的来了么（附macOS本地尝鲜教程-有手就行版）]]></title>    <link>https://juejin.cn/post/7600665529112821760</link>    <guid>https://juejin.cn/post/7600665529112821760</guid>    <pubDate>2026-01-30T02:51:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600665529112821760" data-draft-id="7600670417858265122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Clawdbot 8万Star的背后：AI 助理真的来了么（附macOS本地尝鲜教程-有手就行版）"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-30T02:51:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="灵臂Lybic"/> <meta itemprop="url" content="https://juejin.cn/user/1417690301865552"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Clawdbot 8万Star的背后：AI 助理真的来了么（附macOS本地尝鲜教程-有手就行版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1417690301865552/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    灵臂Lybic
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:51:56.000Z" title="Fri Jan 30 2026 02:51:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>从 Chat 到 Action，AI 正在接管我们的屏幕。但在一周 8 万 Star 的狂欢背后，爆火的应用与脆弱的安全性之间，正横亘着一道待解的基础设施鸿沟。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15998162f6c34964b703a4fb49f635ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=noBtFuJJ9rr3%2F6QJwSRl6GOyDq0%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-0"><strong><strong>流量高地与范式转移：</strong> <strong>从“对话”到“实战”</strong></strong></h2>
<p>这几天 Clawdbot 的出圈速度很夸张。社区里最直观的信号是 GitHub star 曲线在短时间内冲到数万量级，很多讨论甚至直接把它当作“2026 开源增长最快的现象级项目之一”。 更戏剧化的是，它还带出了一个“周边行情”：大量开发者开始用 Mac mini 这类小主机来常驻运行，从而实现一个 7×24h 永不下班的“核动力牛马”，甚至出现“下单截图刷屏”“卖断货”的情况。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d94f94fd53b40efa069f818148bd9c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=PEEck9K8aBf3q%2FZeFNik6GA93hU%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>Clawdbot 现在官方名字是 Moltbot，比较有意思的是，改名的原因是因为 Anthropic 认为 Clawdbot 这个名字太容易被市场误解为Claude Code的延展产品，所以提出了抗议，创始人“被迫”宣布改名。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a02a40ea8b8466b82a0e0852672df01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=RyMiNtpMnKlgolDQOTFq53Q%2FnaI%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>它的定位非常清晰：一个你自己运行的个人 AI 助手，驻扎在你已经在用的聊天渠道里，比如 WhatsApp、 Telegram、 Slack、 Discord、 Google Chat、 Signal、 iMessage、 Microsoft Teams、 WebChat 等，同时支持在 macOS、iOS、Android 上交互，并提供一个可控的 Canvas 界面。 这套“入口在聊天里，执行在你自己的环境里”的组合，就这样魔幻而又切切实实的爆火了。</p>
<p>为什么这类东西会一波接一波地爆火？从最近一段时间的产品形态看，确实有个明显的风向在强化：大众的注意力正在从“对话型”迁移到“实操型”。对话给的是答案，实操给的是结果。对绝大多数人来说，后者更像他们心里对“AI 助理”的默认想象，这一点在 Clawdbot 的传播中被放大得很充分。</p>
<p><strong><strong>沸腾后的冷思考</strong></strong></p>
<p><strong><strong>是技术奇点，还是“时势英雄”？</strong></strong></p>
<p>不过这里也值得降降温。爆火当然意味着能力点戳中了人心，但它同样蕴含着几件事叠加：创作者本身的影响力与信用积累，以及社交平台的流量机制、AI时代的掉队焦虑，共同把某个叙事推到最大音量。你不需要把每一次“现象级”都理解成行业天翻地覆。更像是时势推着一个正确方向的样品突然被看见了，然后所有人的情绪一起涌上来。</p>
<p>再说体验层面的“落差”。很多人上手后会发现，它没有想象中那么万能，这其实并不意外。因为这类个人 Agent 往往把“连接器很多”“能动手”放在第一优先级，工程细节与产品打磨会滞后，早期 UI 小问题、流程不顺手、边界场景翻车都很常见。更关键的一点在成本。只要你把它当作“经常在线的执行型助理”，模型调用和工具链路的成本就会从偶发费用变成持续开销，近几天已经陆续看到网上有人晒图仅仅使用十几个小时，就已经消耗了上百美金的token。很多用户会自然滑向一种状态：好玩大于好用，体验大于实用。</p>
<p>真正值得认真讨论的，是它爆火后暴露出来的“安全现实”。Clawdbot 的卖点之一就是更本地化，更可控，更接近你的真实环境，它也确实会涉及对本地 shell、文件系统、浏览器等能力的调用与编排。 这让它强大，也让它变得危险。由于它拥有极高的系统权限。大部分用户担心 AI 误操作导致主力机数据受损，或是隐私信息泄露，被迫选择了“物理隔离”——用一台专门的硬件来承载这个不确定的“执行者”。</p>
<p>这也解释了另一个看似荒诞的现象：Clawdbot 带动了 Mac mini 等小主机被抢购。很多人把它解读为“性能需求”，但更底层的心理动因往往是“把东西放在自己手里更安心”。 你会发现，这里面其实同时包含了信任与不信任。信任的是我愿意让它替我做事，不信任的是我不想把自己的数据和权限直接丢进不可控的黑盒里。</p>
<h2 data-id="heading-1"><strong><strong>数据安全是“执行权”的护城河</strong></strong></h2>
<p>同样，GUI Agent（具备图形界面操作能力的智能体）作为一个实操型的技术路线，也具备巨大的想象和成长空间。</p>
<p>例如前段时间爆火出圈的豆包手机、Open-AutoGLM 等，它可以完成跨 App 的复杂长链路任务，但其权限的边界与数据安全的保障，将决定它是“神助攻”还是“定时炸弹”。这正是灵臂 Lybic 的出发点之一。</p>
<p>GUI Agent 之所以想象空间更大，因为它天然能覆盖那些没有标准 API 的存量软件和复杂流程。可它也天然更危险，因为它同样处在高权限的边缘，出错时的破坏半径更接近真实世界。把这一类能力推向大众之前，一个更稳妥的路径是先把“执行空间”变成默认护栏。</p>
<p>这也是 Lybic 想做的事之一。我们把“能不能做”之外的三件事放在同等重要的位置：隔离、可见、可止损。让模型或 Agent 在云端沙盒里执行 GUI 任务，你可以实时看到它在做什么，发现不对可以随时人工接管，任务结束可以销毁环境。这样一来，创新速度可以继续加快，试错成本被关在可控范围里，真实设备和真实数据少承担一些不必要的风险。</p>
<h2 data-id="heading-2"><strong>写在最后</strong></h2>
<p>Clawdbot 的爆火更像一个信号：实操型 AI 正在成为默认的大众期待。然而技术的热度终会回归工程的理性，接下来决定它们能不能长期留下来的，往往不是演示有多酷，而是执行边界有没有被认真设计。我们更愿意把这当作一个行业共同要补的基础课。让 AI 去做事之前，先给它一个合适的“房间”，再谈把它放进真实世界。</p>
<p><strong>附macOS部署教程</strong></p>
<p>首先打开终端运行一串神秘小代码（前提是确保node.js版本大于22）</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//molt.bot/install.sh | bash -s -- --install-method git</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>静待下载安装完毕后，继续运行</p>
<pre><code class="hljs language-css" lang="css">moltbot onboard <span class="hljs-attr">--install-daemon</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>然后就会看到如下界面，那么恭喜你已经成功部署了Moltbot！教程到此结束（bushi）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1097b27237242dcafe8377043e3555e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=XGwxZVKciWwzW0pb%2F1%2BK%2BhQn02M%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>言归正传，官方在这里也是做出了风险提示。正如上文中所说，moltbot拥有着极大的系统权限，（同时也意味着极大的风险，强烈建议使用备用机安装），所以这里选 yes，因为不选 yes 没法进行下一步，没错官方就是这么霸道。</p>
<p>接下来根据界面提示，选择自己中意的大模型接入，我们这里选择了智谱的GLM 4.7。API key可以到对应的官网去购买/申请。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/421a4080362a4aa78496e2fe0a855c6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=4%2FZky44kLBm6XBqFyAmeB6Qs11I%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>鉴于我们是本地尝鲜版，为了简化流程，这里选择跳过。后续我们也会尝试去适配飞书或QQ。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d2654c43a034793b65af6396148635d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=knMeNBxNzVs1OY1gb8U479kLB9U%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>选择想装的skill，空格进行选中，回车确认后会自动安装</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ceb53744214446388db853a9b71a606f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=hOEEfDyqULzBBeSPZlw1YqU1JBs%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>再之后是各种接口设置，偷懒可以都跳过</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1106722b50e947cfb0aee1d56a84149c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=e6fa0aJMCffrCdHi6SMZTXiWTiQ%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>接下来是hooks设置，可以按需选择，三个选项对应的分别是：</p>
<ul>
<li><code>boot-md</code></li>
</ul>
<p>每次程序启动时，自动读取并执行一个叫 <code>BOOT.md</code> 的文件。</p>
<p><strong>用途</strong>：如果你有一些每次都要 AI 记住的规则、或者每次都要运行的初始化环境命令，可以写在 <code>BOOT.md</code> 里。</p>
<ul>
<li><code>command-logger</code></li>
</ul>
<p>命令日志记录器。</p>
<p><strong>用途</strong>：它会把你输入的所有指令和 AI 的反馈记录下来。建议勾选，万一 AI 乱改了代码，你可以翻日志找回记录。</p>
<ul>
<li><code>session-memory</code></li>
</ul>
<p>会话记忆。</p>
<p><strong>用途</strong>：让 AI 记住你上一次聊了什么。如果不选，它可能每次运行都是“断片”状态，不记得之前的上下文。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d22da4e1a5346cdaa29ecc054e39ae1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=mQAwhuNNaZ93%2BaJWdHWE6zLHycg%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>最后选择在哪里运行</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0db2b0c225fe4978a050e05c6d5558ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=Hl%2BG02uL89BkGBH47oXSdVuXJ6g%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li><strong>Hatch in TUI (recommended)</strong></li>
</ul>
<p><strong>什么是 TUI？</strong> 它的全称是 Terminal User Interface。</p>
<p><strong>效果</strong>：就在你现在的这个黑色窗口里直接跳出一个比较漂亮的对话框。</p>
<p><strong>优点</strong>：速度最快，不用切换窗口，很有极客感觉。</p>
<ul>
<li><strong>Open the Web UI</strong></li>
</ul>
<p><strong>效果</strong>：它会启动一个本地服务器，并在你的浏览器（如 Chrome 或 Safari）里打开一个网页版界面。</p>
<p><strong>优点</strong>：界面更像 ChatGPT，推荐选这个。</p>
<ul>
<li><strong>Do this later</strong></li>
</ul>
<p><strong>效果</strong>：结束配置，回到命令行。</p>
<p><strong>用途</strong>：如果你现在只想装好，还没打算立刻开始聊天，选这个。</p>
<p>选择 Open the Web UI 后，会自动跳转网页如下</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95735f066b694408986d429b7e4e76a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=9f0BCK9b1KaL0VZqEHirNrEMQCc%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>现在恭喜你真正完成配置并可以开始使用了！</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[给大模型“开小灶”：一文读懂微调原理与实战，让你的AI更懂你]]></title>    <link>https://juejin.cn/post/7600755567485796404</link>    <guid>https://juejin.cn/post/7600755567485796404</guid>    <pubDate>2026-01-30T05:40:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600755567485796404" data-draft-id="7600728866756919348" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="给大模型“开小灶”：一文读懂微调原理与实战，让你的AI更懂你"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-30T05:40:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狸猫算君"/> <meta itemprop="url" content="https://juejin.cn/user/643654644149178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            给大模型“开小灶”：一文读懂微调原理与实战，让你的AI更懂你
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/643654644149178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狸猫算君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:40:10.000Z" title="Fri Jan 30 2026 05:40:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>引言：为什么我们需要给大模型“开小灶”？</strong></h3>
<p>想象一下，你请来了一位学识渊博的“通才”教授，他上知天文下知地理。但当你需要他帮你撰写专业的市场分析报告时，他给出的答案可能虽然正确，却不够聚焦、缺乏行业术语。这时候，最好的办法不是换一位教授，而是给他一份你行业的资料和几份优秀的报告范文，让他快速“补补课”。</p>
<p>大模型微调（Fine-Tuning）就是这个“补课”的过程。我们不再需要耗费巨资从零训练一个AI，而是以一个强大的预训练模型（如ChatGPT背后的GPT系列、国内的Qwen、DeepSeek等）为起点，用我们自己的、特定领域的数据对它进行“再教育”，让它从一个“通才”转变为精通我们业务的“专家”。</p>
<p>无论是让AI学习你公司的产品知识库来当智能客服，还是让它理解法律合同条款，亦或是模仿你的写作风格来生成文案，微调都是实现AI“个性化”和“专业化”的关键一步。今天，我们就来彻底搞懂大模型微调，并一步步带你上手实践。</p>
<p><img src="https://p3-volc-community-sign.byteimg.com/tos-cn-i-tlddhu82om/77716b24f5204be784858bc16a470b64~tplv-tlddhu82om-image.image?=&amp;rk3s=8031ce6d&amp;x-expires=1769837709&amp;x-signature=5PfaUC%2BGp9LxAXO1%2FtkWToqlac0%3D" alt="13414224733899671.jpeg" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1"><strong>一、技术原理：拆解微调的“十八般武艺”</strong></h3>
<p>微调方法众多，但核心思想无非两种：<strong>大动干戈</strong> 或 <strong>精雕细琢</strong>。理解它们的区别，是做出正确选择的第一步。</p>
<h4 data-id="heading-2"><strong>1. “大动干戈”派：全量微调</strong></h4>
<ul>
<li>
<p><strong>核心思想</strong>：动用“题海战术”。将预训练模型的所有参数（可以理解为它的“知识神经元”）用你的新数据重新训练一遍。</p>
</li>
<li>
<p><strong>通俗比喻</strong>：让那位通才教授把你给的行业资料当作全新教材，从头到尾、逐字逐句地重新学习一遍。他的整个知识体系都会因此重塑。</p>
</li>
<li>
<p><strong>优点</strong>：效果通常最好，模型能最深度地适应新任务。</p>
</li>
<li>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>成本极高</strong>：需要大量的计算资源（多张高端GPU）和漫长的时间。</li>
<li><strong>灾难性遗忘</strong>：教授可能过于钻研你的行业，把原来学的通用知识（比如基础逻辑、常识）给忘了，导致在其他任务上表现下降。</li>
<li><strong>适用场景</strong>：数据量极大、任务极其重要且资源充沛的“土豪”场景。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3"><strong>2. “精雕细琢”派：参数高效微调</strong></h4>
<p>这是目前的主流和推荐方案，核心是  <strong>“不动主干，只调边角”</strong> 。我们冻结预训练模型绝大部分参数，只训练额外新增的一小部分参数，从而高效地引导模型。</p>
<ul>
<li>
<p><strong>LoRA：给模型装上“功能插件”</strong></p>
<ul>
<li><strong>原理</strong>：在模型原有的某些关键层（如注意力模块）旁，并行添加两个小小的、低维度的矩阵。训练时，只更新这两个小矩阵。训练完成后，可以把这两个小矩阵像“插件”一样，合并回原模型，也可以单独保存和加载。</li>
<li><strong>比喻</strong>：不给教授换大脑，而是给他一副特制的“行业眼镜”。戴上这副眼镜，他看任何问题都能自动带上行业视角。这副眼镜轻便、易切换（针对不同任务可以换不同眼镜）。</li>
<li><strong>优势</strong>：显存占用极低、训练速度快、几乎不会遗忘原知识、产出的模型权重文件很小（通常只有几十到几百MB），非常适合个人开发者和小团队。</li>
</ul>
</li>
<li>
<p><strong>Prefix Tuning / Prompt Tuning：学习“魔法提示词”</strong></p>
<ul>
<li><strong>原理</strong>：在输入给模型的文本前，自动加上一段经过学习的、模型可见的“软提示”（一串数字向量）。这段提示本身没有实际语言含义，但能像“咒语”一样，悄悄引导模型走向我们想要的任务输出。</li>
<li><strong>比喻</strong>：每次向教授提问前，都先由助手念一段特定的“引导语”（例如：“请您以资深投资分析师的身份思考……”）。教授听到这段引导语后，就会自动切换到相应的专家模式来回答问题。我们需要训练的，就是这段最有效的“引导语”。</li>
<li><strong>优势</strong>：更加轻量，甚至可以不修改模型本身任何参数。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4"><strong>3. “对齐”派：基于反馈的微调</strong></h4>
<p>这通常是微调链条的后一步，目的是让模型输出的内容不仅正确，而且  <strong>“符合人类偏好”</strong> 。</p>
<ul>
<li><strong>监督微调</strong>：用高质量的“问题-理想答案”配对数据来训练，教模型学会回答的格式和风格。</li>
<li><strong>RLHF</strong>：引入“人类评委”。让模型生成多个答案，人工评判哪个更好，利用这些反馈信号来调整模型，让它越来越会产出让人满意的回答。ChatGPT的“善解人意”正源于此。</li>
<li><strong>RLAIF</strong>：原理同RLHF，但“评委”换成了另一个AI，以降低成本和提升效率。</li>
</ul>
<hr/>
<h3 data-id="heading-5"><strong>二、实践步骤：三步走，完成你的第一次微调</strong></h3>
<p>我们将以最流行的 <strong>LoRA微调</strong> 方式，以帮你“微调一个客服问答模型”为例，拆解操作流程。</p>
<h4 data-id="heading-6"><strong>第一步：准备数据——给AI的“专属教材”</strong></h4>
<p>数据质量决定模型上限。你需要准备一个结构化的数据集，通常是一个<code>JSON</code>或<code>CSV</code>文件。</p>
<ul>
<li>
<p><strong>格式</strong>：对于问答任务，最常见的格式是包含 <code>“instruction”（指令）</code>、<code>“input”（输入）</code>、<code>“output”（输出）</code> 的对话对。</p>
<p>json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"instruction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"根据以下产品描述，回答用户问题。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"产品：智能音箱X1，支持语音控制家居，内置电池续航12小时。用户问：这个音箱能带去户外用吗？"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"可以的。智能音箱X1内置电池，续航时间长达12小时，非常适合在户外聚会、露营等没有固定电源的场景下使用。"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"instruction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"作为客服，礼貌地处理用户投诉。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"用户说：我收到的音箱表面有划痕，很不满意！"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"非常抱歉给您带来了不好的体验！对于商品在运输过程中产生的损伤，我们深表歉意。请您提供一下订单号和划痕照片，我们会立即为您处理换货或补偿事宜。"</span>
  <span class="hljs-punctuation">}</span>
  <span class="hljs-comment">// ... 更多数据</span>
<span class="hljs-punctuation">]</span>
</code></pre>
</li>
<li>
<p><strong>数据量</strong>：起步阶段，精心整理的 <strong>几百到几千条</strong> 高质量数据，就能通过LoRA产生显著效果。</p>
</li>
<li>
<p><strong>数据清洗</strong>：检查错别字、错误标点，确保“输出”部分是你想要的、优质的答案范本。</p>
</li>
</ul>
<h4 data-id="heading-7"><strong>第二步：配置与训练——设置“学习计划”</strong></h4>
<p>这是核心环节，你需要关注几个关键参数（以使用 <code>transformers</code> + <code>peft</code> 库为例）：</p>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini">from peft import LoraConfig, TaskType

<span class="hljs-comment"># 1. 配置LoRA“插件”</span>
<span class="hljs-attr">peft_config</span> = LoraConfig(
    <span class="hljs-attr">task_type</span>=TaskType.CAUSAL_LM,  <span class="hljs-comment"># 因果语言模型任务（如文本生成）</span>
    <span class="hljs-attr">inference_mode</span>=<span class="hljs-literal">False</span>,
    <span class="hljs-attr">r</span>=<span class="hljs-number">8</span>,  <span class="hljs-comment"># 【关键】LoRA的秩，理解为“插件的复杂度”。常用8或16，越大能力越强但可能过拟合。</span>
    <span class="hljs-attr">lora_alpha</span>=<span class="hljs-number">32</span>,  <span class="hljs-comment"># 缩放参数，通常设为r的2-4倍。</span>
    <span class="hljs-attr">lora_dropout</span>=<span class="hljs-number">0.1</span>,  <span class="hljs-comment"># 防止过拟合的丢弃率。</span>
    <span class="hljs-attr">target_modules</span>=[<span class="hljs-string">"q_proj"</span>, <span class="hljs-string">"v_proj"</span>]  <span class="hljs-comment"># 【关键】将“插件”安装到模型的哪些层？通常是注意力层的查询和值映射。</span>
)

<span class="hljs-comment"># 2. 配置训练参数</span>
from transformers import TrainingArguments

<span class="hljs-attr">training_args</span> = TrainingArguments(
    <span class="hljs-attr">output_dir</span>=<span class="hljs-string">"./output"</span>,  <span class="hljs-comment"># 输出目录</span>
    <span class="hljs-attr">per_device_train_batch_size</span>=<span class="hljs-number">4</span>,  <span class="hljs-comment"># 每张GPU的批大小。根据显存调整，RTX 4090上7B模型可设为4。</span>
    <span class="hljs-attr">gradient_accumulation_steps</span>=<span class="hljs-number">4</span>,  <span class="hljs-comment"># 梯度累积步数。模拟更大的批大小，节省显存。</span>
    <span class="hljs-attr">num_train_epochs</span>=<span class="hljs-number">3</span>,  <span class="hljs-comment"># 训练轮数。数据少时（&lt;1万）可设3-5轮。</span>
    <span class="hljs-attr">learning_rate</span>=<span class="hljs-number">2</span>e-<span class="hljs-number">4</span>,  <span class="hljs-comment"># 【关键】学习率。LoRA训练时可以用较高学习率（1e-4到5e-4）。</span>
    <span class="hljs-attr">fp16</span>=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 使用混合精度训练，节省显存并加速。</span>
    <span class="hljs-attr">logging_steps</span>=<span class="hljs-number">10</span>,  <span class="hljs-comment"># 每10步打印一次日志。</span>
    <span class="hljs-attr">save_steps</span>=<span class="hljs-number">200</span>,  <span class="hljs-comment"># 每200步保存一次检查点。</span>
    <span class="hljs-attr">remove_unused_columns</span>=<span class="hljs-literal">False</span>  <span class="hljs-comment"># 重要：保持数据列不被自动删除。</span>
)
</code></pre>
<p><img src="https://p6-volc-community-sign.byteimg.com/tos-cn-i-tlddhu82om/cd03700e1fed4cb4b5284ea7916e8ad3~tplv-tlddhu82om-image.image?=&amp;rk3s=8031ce6d&amp;x-expires=1769837734&amp;x-signature=17%2F9CKIOj1K%2FqwsT7sbcx4Kqc58%3D" alt="13414224848999968.jpeg" loading="lazy"/>
<strong>参数调优心法</strong>：</p>
<ul>
<li><strong>学习率</strong>：LoRA训练时可大胆用稍大的值（如<code>3e-4</code>），因为调整的参数少，不怕“翻车”。</li>
<li><strong>批大小</strong>：在显卡能承受的范围内尽可能大，能稳定训练。不够大就用<code>gradient_accumulation_steps</code>来凑。</li>
<li><strong>秩（r）</strong> ：从8开始尝试。如果任务很复杂或与模型原始知识差异大（如从通用中文到医疗文献），可以尝试16或32。</li>
</ul>
<h4 data-id="heading-8"><strong>第三步：测试与部署——验收“学习成果”</strong></h4>
<p>训练完成后，你会得到<code>adapter_model.bin</code>（LoRA权重）和<code>adapter_config.json</code>（配置文件）。</p>
<ul>
<li>
<p><strong>加载与推理</strong>：</p>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini">from peft import PeftModel
<span class="hljs-comment"># 加载基座模型</span>
<span class="hljs-attr">base_model</span> = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">"Qwen/Qwen2-7B-Instruct"</span>)
<span class="hljs-comment"># 加载训练好的LoRA“插件”</span>
<span class="hljs-attr">model</span> = PeftModel.from_pretrained(base_model, <span class="hljs-string">"./output/final_checkpoint"</span>)
<span class="hljs-comment"># 合并权重（可选，合并后就是单个模型文件，便于部署）</span>
<span class="hljs-attr">merged_model</span> = model.merge_and_unload()
<span class="hljs-comment"># 进行推理测试</span>
<span class="hljs-comment"># ...</span>
</code></pre>
</li>
<li>
<p><strong>简单测试</strong>：用一些训练集里没见过的问题，看看模型的回答是否符合预期。</p>
</li>
</ul>
<p>上述代码和步骤对于开发者是家常便饭，但对于想快速聚焦业务、无暇深究技术的朋友来说，依然门槛不低。如果你希望跳过所有环境配置和代码编写，专注于数据准备和效果迭代，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.llamafactory.com.cn%2Fregister%3Futm_source%3Djslt_xtjj_wsy" target="_blank" title="https://www.llamafactory.com.cn/register?utm_source=jslt_xtjj_wsy" ref="nofollow noopener noreferrer"><strong>LLaMA-Factory Online</strong></a> 这类平台是你的理想选择。它提供了可视化的数据上传、模型选择（支持数十种开源模型）、参数配置（图形化调节学习率、秩等）和一站式训练监控界面。你甚至不需要懂什么是“秩”或“target_modules”，平台会提供智能推荐，让你在几分钟内启动微调，亲眼见证你的数据如何让大模型“更像你想要的样子”。</p>
<hr/>
<h3 data-id="heading-9"><strong>三、效果评估：如何判断微调是否成功？</strong></h3>
<p>训练损失下降不代表模型真的变“聪明”了。你需要系统性地评估：</p>
<ol>
<li>
<p><strong>定性评估（最重要）</strong> ：</p>
<ul>
<li><strong>人工审查</strong>：随机抽取一批测试问题，人工判断模型生成答案的<strong>准确性、相关性和流畅性</strong>。这是黄金标准。</li>
<li><strong>对比测试</strong>：同一个问题，分别让微调前的原模型和微调后的模型回答，直观对比提升效果。</li>
</ul>
</li>
<li>
<p><strong>定量评估</strong>：</p>
<ul>
<li>
<p><strong>任务指标</strong>：根据你的任务类型选择。</p>
<ul>
<li><strong>分类任务</strong>：准确率、F1分数。</li>
<li><strong>问答/摘要任务</strong>：ROUGE-L（衡量生成文本与标准答案的重叠度）、BLEU分数。</li>
<li><strong>生成任务</strong>：可以使用 <strong>困惑度</strong>，但它不完全代表生成质量。</li>
</ul>
</li>
<li>
<p><strong>保留评估集</strong>：在准备数据时，就预留出10%-20%的数据<strong>绝不用于训练</strong>，专门用于计算这些指标。</p>
</li>
</ul>
</li>
<li>
<p><strong>综合评估</strong>：</p>
<ul>
<li><strong>通用能力保留测试</strong>：问几个与微调任务无关的通用问题（比如“中国的首都是哪里？”），检查模型是否出现了严重的“灾难性遗忘”。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-10"><strong>四、总结与展望</strong></h3>
<p>大模型微调，已经从学术界的高岭之花，变成了产业界触手可及的生产力工具。其核心脉络清晰：<strong>以强大的预训练模型为基座，用参数高效微调（尤其是LoRA）作为杠杆，以高质量领域数据为支点，撬动专属AI能力的落地。</strong></p>
<p><strong>未来展望</strong>：</p>
<ul>
<li><strong>更轻量化</strong>：会出现参数量更少、效果更好的微调技术。</li>
<li><strong>更自动化</strong>：自动选择最优微调方法和超参数的“Auto-FineTuning”将成趋势。</li>
<li><strong>更一体化</strong>：数据准备、微调、评估、部署的全流程平台（正如前文提到的在线平台）会越来越成熟，进一步降低技术门槛。</li>
</ul>
<p><strong>给你的建议</strong>：<br/>
不要等待技术完美。现在就开始，从一个小而具体的任务开始（比如整理100条经典的客服问答），选择一个易用的工具或平台，完成你的第一次微调实验。亲手打造一个能理解你、帮助你的AI，这个过程所带来的认知提升和成就感，远超旁观。</p>
<p>迈出第一步，你就能真正驾驭大模型，让它从遥不可及的黑科技，变成你手中解决实际问题的得力助手。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PVE 虚拟机无法上网问题排查：路由器 IP-MAC 绑定导致的静默丢弃]]></title>    <link>https://juejin.cn/post/7600670417858215970</link>    <guid>https://juejin.cn/post/7600670417858215970</guid>    <pubDate>2026-01-30T02:48:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670417858215970" data-draft-id="7600670487409279028" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PVE 虚拟机无法上网问题排查：路由器 IP-MAC 绑定导致的静默丢弃"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T02:48:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户92178812460"/> <meta itemprop="url" content="https://juejin.cn/user/608475561596793"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PVE 虚拟机无法上网问题排查：路由器 IP-MAC 绑定导致的静默丢弃
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/608475561596793/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户92178812460
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:48:55.000Z" title="Fri Jan 30 2026 02:48:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>摘要</strong>：在 Proxmox VE (PVE) 环境中重建虚拟机后，Ubuntu 虚拟机无法访问外网，但同网段其他设备（PVE 主机、iStoreOS）通信正常。经抓包分析确认，问题根源为<strong>家用路由器对特定 IP 启用了 IP-MAC 绑定策略</strong>，新虚拟机的 MAC 地址与历史记录不符，导致路由器静默丢弃 ARP/ICMP 请求。本文记录完整排查过程、根本原因分析及解决方案。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、问题背景</h2>
<h3 data-id="heading-1">1.1 网络拓扑</h3>
<pre><code class="hljs language-scss" lang="scss">物理路由器 (<span class="hljs-number">192.168</span>.<span class="hljs-number">3.1</span>)
    │
    └── PVE 主机 (<span class="hljs-number">192.168</span>.<span class="hljs-number">3.21</span>)
         ├── iStoreOS 虚拟机 (<span class="hljs-number">192.168</span>.<span class="hljs-number">3.62</span>) ✅ 可上网
         └── Ubuntu 虚拟机 (<span class="hljs-number">192.168</span>.<span class="hljs-number">3.101</span>) ❌ 无法上网
</code></pre>
<h3 data-id="heading-2">1.2 问题现象</h3>
<ul>
<li>✅ PVE 主机 (<code>192.168.3.21</code>) 可正常访问路由器及外网</li>
<li>✅ iStoreOS (<code>192.168.3.62</code>) 可正常访问路由器及外网</li>
<li>❌ Ubuntu (<code>192.168.3.101</code>) 无法 ping 通路由器 (<code>192.168.3.1</code>)</li>
<li>❌ Ubuntu 无法访问任何外网地址</li>
<li>⚠️ 但 Ubuntu 可与 PVE 主机、iStoreOS 正常互访（同网段通信正常）</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、诊断过程</h2>
<h3 data-id="heading-4">2.1 初步检查：网关配置</h3>
<p>Ubuntu Netplan 配置（初始错误配置）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># /etc/netplan/50-cloud-init.yaml</span>
<span class="hljs-attr">network:</span>
  <span class="hljs-attr">version:</span> <span class="hljs-number">2</span>
  <span class="hljs-attr">ethernets:</span>
    <span class="hljs-attr">ens18:</span>
      <span class="hljs-attr">addresses:</span> [<span class="hljs-number">192.168</span><span class="hljs-number">.3</span><span class="hljs-number">.101</span><span class="hljs-string">/24</span>]
      <span class="hljs-attr">routes:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">to:</span> <span class="hljs-string">default</span>
          <span class="hljs-attr">via:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.3</span><span class="hljs-number">.62</span>  <span class="hljs-comment"># ❌ 错误：指向 iStoreOS 而非路由器</span>
</code></pre>
<p><strong>修正后</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">routes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">to:</span> <span class="hljs-string">default</span>
    <span class="hljs-attr">via:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.3</span><span class="hljs-number">.1</span>  <span class="hljs-comment"># ✅ 直连路由器</span>
</code></pre>
<blockquote>
<p>修正后问题依旧，排除网关配置错误。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">2.2 关键证据：抓包分析</h3>
<h4 data-id="heading-6">Ubuntu 侧抓包</h4>
<pre><code class="hljs language-bash" lang="bash">sudo tcpdump -i ens18 -n arp or icmp
</code></pre>
<p><strong>输出片段</strong>：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">14:51:38.403299 ARP, Request who-has 192.168.3.1 tell 192.168.3.110</span>
<span class="hljs-section">14:51:39.427408 IP 192.168.3.110 &gt; 192.168.3.1: ICMP echo request</span>
<span class="hljs-section">14:51:40.451409 IP 192.168.3.110 &gt; 192.168.3.1: ICMP echo request</span>
...
<span class="hljs-comment"># ❌ 无任何 ARP Reply 或 ICMP Reply！</span>
</code></pre>
<h4 data-id="heading-7">PVE 主机侧抓包（验证桥接层）</h4>
<pre><code class="hljs language-bash" lang="bash">tcpdump -i vmbr0 -n ether host bc:24:11:56:f9:9a and host 192.168.3.1
</code></pre>
<p><strong>输出</strong>：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">22:51:15.146245 ARP, Request who-has 192.168.3.1 tell 192.168.3.110</span>
<span class="hljs-section">22:51:15.850340 IP 192.168.3.110 &gt; 192.168.3.1: ICMP echo request</span>
...
<span class="hljs-comment"># ✅ 请求包已到达物理网络层，但无回复</span>
</code></pre>
<blockquote>
<p>🔍 <strong>关键结论</strong>：</p>
<ul>
<li>Ubuntu 发出的 ARP/ICMP 请求<strong>已通过 PVE 桥接到达物理网络</strong></li>
<li><strong>路由器从未回复</strong> → 请求被路由器主动丢弃（非链路故障）</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-8">2.3 排除其他可能性</h3>






























<table><thead><tr><th>可能原因</th><th>排查方式</th><th>结果</th></tr></thead><tbody><tr><td>PVE 桥接配置错误</td><td>检查 <code>/etc/network/interfaces</code></td><td>✅ <code>bridge_ports enp3s0</code> 正确绑定物理网卡</td></tr><tr><td>虚拟交换机隔离</td><td>检查 PVE Web 界面 Network → Firewall</td><td>✅ 未启用端口隔离</td></tr><tr><td>Ubuntu 防火墙</td><td><code>sudo ufw status</code></td><td>✅ 默认未启用</td></tr><tr><td><strong>路由器安全策略</strong></td><td>更换 IP 测试</td><td>⚠️ 待验证（见下文）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">三、根本原因：路由器 IP-MAC 绑定</h2>
<h3 data-id="heading-10">3.1 问题重现链条</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[旧虚拟机&lt;br&gt;VM ID 100] --&gt;|IP=192.168.3.101&lt;br&gt;MAC=bc:24:11:56:f9:9a| B(路由器学习绑定)
    B --&gt; C[删除虚拟机]
    C --&gt; D[重建虚拟机&lt;br&gt;VM ID 100]
    D --&gt;|IP=192.168.3.101&lt;br&gt;MAC=02:00:00:00:00:01| E{路由器行为}
    E --&gt;|检测到&lt;br&gt;同一IP+新MAC| F[触发ARP防护]
    F --&gt; G[静默丢弃ARP/ICMP]
</code></pre>
<h3 data-id="heading-11">3.2 核心机制</h3>
<ul>
<li>家用路由器（TP-Link/华为/小米等）默认启用 <strong>“防 ARP 欺骗”</strong> 功能</li>
<li>路由器维护 <code>IP → MAC</code> 绑定表，对已学习的 IP 严格校验 MAC</li>
<li>当检测到 <strong>同一 IP 对应不同 MAC</strong> 时：
<ul>
<li>❌ <strong>不回复 ARP Request</strong>（静默丢弃）</li>
<li>❌ <strong>不转发 ICMP/数据包</strong></li>
<li>⚠️ 无日志、无告警 → 排查困难</li>
</ul>
</li>
</ul>
<blockquote>
<p>💡 <strong>关键误区澄清</strong>：</p>
<ul>
<li>问题<strong>与 VM ID 无关</strong>（100/200/999 均无影响）</li>
<li>问题<strong>不在 PVE</strong>（删除虚拟机后无网络残留）</li>
<li>问题<strong>在路由器端</strong>（保留了 <code>192.168.3.101 → 旧MAC</code> 的历史记录）</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-12">四、解决方案</h2>
<h3 data-id="heading-13">4.1 最优解：更换为干净 IP（5 分钟解决）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 修改 Netplan 配置</span>
sudo nano /etc/netplan/50-cloud-init.yaml
</code></pre>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">network:</span>
  <span class="hljs-attr">version:</span> <span class="hljs-number">2</span>
  <span class="hljs-attr">renderer:</span> <span class="hljs-string">networkd</span>
  <span class="hljs-attr">ethernets:</span>
    <span class="hljs-attr">ens18:</span>
      <span class="hljs-attr">dhcp4:</span> <span class="hljs-literal">false</span>
      <span class="hljs-attr">addresses:</span> [<span class="hljs-number">192.168</span><span class="hljs-number">.3</span><span class="hljs-number">.200</span><span class="hljs-string">/24</span>]  <span class="hljs-comment"># ✅ 关键：使用未绑定的 IP</span>
      <span class="hljs-attr">routes:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">to:</span> <span class="hljs-string">default</span>
          <span class="hljs-attr">via:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.3</span><span class="hljs-number">.1</span>
      <span class="hljs-attr">nameservers:</span>
        <span class="hljs-attr">addresses:</span> [<span class="hljs-number">223.5</span><span class="hljs-number">.5</span><span class="hljs-number">.5</span>, <span class="hljs-number">114.114</span><span class="hljs-number">.114</span><span class="hljs-number">.114</span>]
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 2. 应用配置</span>
sudo netplan apply

<span class="hljs-comment"># 3. 验证</span>
ping -c 4 192.168.3.1    <span class="hljs-comment"># ✅ 通</span>
ping -c 4 baidu.com      <span class="hljs-comment"># ✅ 通</span>
</code></pre>
<blockquote>
<p>✅ <strong>效果</strong>：立即恢复网络，无需修改路由器配置。</p>
</blockquote>
<hr/>
<h3 data-id="heading-14">4.2 根治方案（可选）：清理路由器绑定</h3>
<p>如需继续使用 <code>192.168.3.101</code>，需登录路由器：</p>
<ol>
<li>访问 <code>http://192.168.3.1</code></li>
<li>进入 <strong>安全设置 → ARP 绑定 / 防 ARP 欺骗</strong></li>
<li>删除 <code>192.168.3.101</code> 的旧绑定记录</li>
<li>（可选）关闭“防 ARP 欺骗”功能（家用环境通常无需开启）</li>
<li>重启路由器使策略生效</li>
</ol>
<blockquote>
<p>⚠️ <strong>注意</strong>：部分路由器需重启才能清除绑定缓存。</p>
</blockquote>
<hr/>
<h2 data-id="heading-15">五、问题复盘</h2>
<h3 data-id="heading-16">5.1 与 IP 冲突的区别</h3>






























<table><thead><tr><th>特征</th><th>本案例（IP-MAC 绑定）</th><th>IP 冲突</th></tr></thead><tbody><tr><td><strong>ARP Reply</strong></td><td>❌ 完全无回复</td><td>✅ 有回复，但 MAC 抖动</td></tr><tr><td><strong>Ping 表现</strong></td><td>❌ 100% 失败</td><td>⚠️ 间歇性通/断</td></tr><tr><td><strong>抓包特征</strong></td><td>只有 Request</td><td>Request + Reply（MAC 变化）</td></tr><tr><td><strong>根本原因</strong></td><td>路由器安全策略拦截</td><td>两设备同时响应 ARP</td></tr></tbody></table>
<blockquote>
<p>✅ 本案例<strong>不是 IP 冲突</strong>，而是路由器主动丢弃。</p>
</blockquote>
<hr/>
<h3 data-id="heading-17">5.2 为什么修改 MAC 无效？</h3>

























<table><thead><tr><th>操作</th><th>路由器视角</th><th>结果</th></tr></thead><tbody><tr><td>初始状态</td><td><code>192.168.3.101 → bc:24:11:56:f9:9a</code></td><td>✅ 允许</td></tr><tr><td>仅改 MAC</td><td><code>192.168.3.101 → 02:00:00:00:00:01</code></td><td>❌ 视为 ARP 欺骗</td></tr><tr><td><strong>改 IP + MAC</strong></td><td><code>192.168.3.200 → 02:00:00:00:00:01</code></td><td>✅ 无历史记录，正常学习</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>关键</strong>：必须<strong>同时更换 IP</strong> 才能绕过绑定策略。</p>
</blockquote>
<hr/>
<h2 data-id="heading-18">六、预防建议</h2>
<h3 data-id="heading-19">6.1 地址规划（推荐）</h3>

























<table><thead><tr><th>地址段</th><th>用途</th><th>配置方式</th></tr></thead><tbody><tr><td><code>192.168.3.2 ~ 192.168.3.99</code></td><td>静态 IP（服务器/虚拟机）</td><td>手动配置</td></tr><tr><td><code>192.168.3.100 ~ 192.168.3.200</code></td><td>DHCP 动态分配</td><td>路由器 DHCP 池</td></tr><tr><td><code>192.168.3.201 ~ 192.168.3.254</code></td><td>临时测试</td><td>避免与生产环境冲突</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>原则</strong>：静态 IP 与 DHCP 池<strong>严格分离</strong>，避免重叠。</p>
</blockquote>
<hr/>
<h3 data-id="heading-20">6.2 虚拟机生命周期管理</h3>





















<table><thead><tr><th>操作</th><th>建议</th></tr></thead><tbody><tr><td><strong>重建虚拟机</strong></td><td>✅ 优先使用新 IP（如 <code>.200+</code>）<br/>✅ 或先在路由器删除旧绑定</td></tr><tr><td><strong>克隆虚拟机</strong></td><td>✅ 克隆后<strong>必须修改 IP + MAC</strong></td></tr><tr><td><strong>长期使用固定 IP</strong></td><td>✅ 在路由器设置 <strong>DHCP 静态分配</strong>（MAC → IP 绑定）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-21">七、附录：命令速查</h2>
<h3 data-id="heading-22">7.1 网络诊断命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看路由表</span>
ip r

<span class="hljs-comment"># 查看 ARP 表（观察是否抖动）</span>
watch -n 1 <span class="hljs-string">'ip neigh show 192.168.3.1'</span>

<span class="hljs-comment"># 抓包（ARP + ICMP）</span>
sudo tcpdump -i ens18 -n arp or icmp

<span class="hljs-comment"># 扫描 IP 冲突</span>
sudo apt install arp-scan
sudo arp-scan --localnet | grep 192.168.3.101
</code></pre>
<h3 data-id="heading-23">7.2 PVE 网络配置检查</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查 Bridge 配置</span>
<span class="hljs-built_in">cat</span> /etc/network/interfaces

<span class="hljs-comment"># 验证物理网卡绑定</span>
ip <span class="hljs-built_in">link</span> show vmbr0
<span class="hljs-comment"># 输出应包含：bridge_ports enp3s0（非 none）</span>
</code></pre>
<hr/>
<h2 data-id="heading-24">八、总结</h2>





























<table><thead><tr><th>项目</th><th>说明</th></tr></thead><tbody><tr><td><strong>问题现象</strong></td><td>Ubuntu 虚拟机无法访问路由器/外网，但同网段互访正常</td></tr><tr><td><strong>根本原因</strong></td><td>路由器对 <code>192.168.3.101</code> 启用 IP-MAC 绑定，新 MAC 被视为非法</td></tr><tr><td><strong>关键证据</strong></td><td>抓包显示：有 Request 无 Reply → 路由器静默丢弃</td></tr><tr><td><strong>最优解</strong></td><td>更换为干净 IP（如 <code>192.168.3.200</code>）</td></tr><tr><td><strong>经验教训</strong></td><td>虚拟机重建后，<strong>避免复用旧 IP</strong>；或提前清理路由器绑定</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>一句话总结</strong>：<br/>
<strong>“虚拟机重建后无法上网？先换一个干净 IP，90% 问题迎刃而解。”</strong></p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java面试中高频八股文大全）——就业版]]></title>    <link>https://juejin.cn/post/7600990891205623835</link>    <guid>https://juejin.cn/post/7600990891205623835</guid>    <pubDate>2026-01-30T05:41:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600990891205623835" data-draft-id="7600692485946638345" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java面试中高频八股文大全）——就业版"/> <meta itemprop="keywords" content="后端,Spark"/> <meta itemprop="datePublished" content="2026-01-30T05:41:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java面试中高频八股文大全）——就业版
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:41:45.000Z" title="Fri Jan 30 2026 05:41:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读25分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>1.什么是索引？什么情况下用索引？什么时候不用？</strong></p>
<p>1）就是一种数据结构，目的就是为了快速查找数据。<br/>
2）对查询频率高（索引就是为了提高查询效率），像where后的字段<br/>
数据量特别大， 索引不是越多越好，会影响增删的效率，典型的用空间换时间。<br/>
分组字段可以建立索引，因为分组的前提是排序（覆盖索引）<br/>
3）频繁更新的字段、查询少的、参与计算的不适合建索引。</p>
<p><strong>2.索引失效？</strong></p>
<blockquote>
<p>在MySQL中，查询不走索引可能有以下几种情况：</p>
<ol>
<li>数据量太小：如果表中的数据量比较小，MySQL会选择进行全表扫描而不使用索引，因为全表扫描的开销可能比使用索引更小。</li>
<li>对索引列进行了函数操作：如果在查询语句中对索引列进行了函数操作或表达式运算，MySQL无法使用索引进行优化，因此可能不走索引。</li>
<li>范围查询：如果查询语句中包含范围查询（例如大于、小于、区间查询等），MySQL可能无法使用索引进行优化，导致不走索引（模糊查询like,%前置不会走，后置会走）。</li>
<li>数据分布不均匀：如果索引列的数据分布不均匀，索引的选择性较低，MySQL可能选择进行全表扫描而不使用索引。</li>
</ol>
<p>在进行MySQL索引优化时，需要考虑以上情况，并通过分析查询语句、优化索引设计、适时更新统计信息等方法，提高MySQL查询性能，尽可能减少不走索引的情况。</p>
</blockquote>
<p><strong>3. 查看索引使用和查看索引信息？</strong><br/>
索引使用： explain 结果 （只要数字大于1）1 row in set 即生效了<br/>
查看索引信息： show indexs from 表名</p>
<p><strong>4. 复合索引？最左匹配原则？</strong><br/>
最核心的是<strong>等值比较</strong><br/>
复合索引就是多个字段放一块（企业最常用的是符合索引！！！唯一索引，普通索引我们也用）<br/>
mysql会一直向右查询，直到遇到<strong>范围查询</strong>（&gt; &lt; like），比如用 a b c d四个字段创建了一个复合索引， a=3 b=5 c&gt;7 d=9 只会用到前三个，因为b c d 是根据a 的后面进行规则的排序，即a是有序的，后面的bcd是无序的。 （hash索引用的不多，因为无序，但是定位快，了解即可）</p>
<p><strong>5. Btree和B+tree？为什么mysql用的是B+ tree？</strong>  **<br/>
B+tree是Btree的升级版。<br/>
Btree：多路平衡树，当增删数据时，会自动的将数据进行这个平衡（旋转）<br/>
为什么从Btree转到B+tree 因为：索引也是一个文件，存档在磁盘，在使用时读入到内存。内存是有限的，如果索引文件过大，无法一次性全部加载，需要分批加载。在有限磁盘的限制下，B+tree可以减少磁盘的I/O。</p>
<blockquote>
<blockquote>
<p><strong>篇幅限制下面就只能给大家展示小册部分内容了。整理了一份核心面试笔记包括了：Java面试、Spring、JVM、MyBatis、Redis、MySQL、并发编程、微服务、Linux、Springboot、SpringCloud、MQ、Kafka 面试专题</strong></p>
<blockquote>
</blockquote>
<p><strong>需要全套面试笔记及答案【扫一扫】</strong>                        即可免费获取**</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/681cd557c47049b29a545a9979d9a86d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357252&amp;x-signature=bzWQJXPC8hyMlYbY1Uzyn49hIws%3D" alt="8fbf1ef8b61e2dbbb33b7690a41d12e.png" loading="lazy"/></p>
</blockquote>
<p><em><strong>对于B+tree，所有的数据都存在叶子节点，根和非叶子节点只是存储的指针，指向下一个数据的地址，由叶子节点再去查找到关联的数据信息。对于查询的数据，都要从root节点走到叶子节点，所以查询相比于Btree更加稳定。</strong></em></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48f68c5be67440fcb39c2fa97d24226b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357252&amp;x-signature=dVCPevVIoEaktp2RQczFSm7RD1Q%3D" alt="在这里插入图片描述" loading="lazy"/><br/>
对于mysql，是在B+tree的基础上，在相邻节点间增加了一个链表指针，形成了带有顺序的B+tree,提高了区间的访问性能。<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9836483b333a4b71999645aca777c671~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357252&amp;x-signature=eVSD5SaPZLsLwr2G5NL%2B5LX0xTM%3D" alt="在这里插入图片描述" loading="lazy"/><br/>
<strong>1.7 覆盖索引与回表</strong><br/>
如果只需要在一棵索引树上就可以获取Sql所需要的所有列，就不需要回表查询，这样查询速度会更快。而实现覆盖索引最快的方式就是将所需要的字段放在一起建一个联合索引。</p>
<blockquote>
<p><strong>篇幅限制下面就只能给大家展示小册部分内容了。整理了一份好像面试笔记包括了：Java面试、Spring、JVM、MyBatis、Redis、MySQL、并发编程、微服务、Linux、Springboot、SpringCloud、MQ、Kafka 面试专题</strong></p>
</blockquote>
<p>对这份笔记感兴趣的小伙伴可以点击文末名片免费获取<br/>
<strong>1.8 Mysql的锁有哪些？什么是间隙锁？</strong><br/>
从锁的粒度来分<br/>
1、行锁：加锁粒度小，但是加锁的资源开销比较大。Innodb支持。<br/>
1）共享锁：多个事务可以共享一把锁，但是只能读不能修改<br/>
2）排他锁：只有一个事务可以获得排他锁，其他事务不能获取该行的锁。Innodb会自行对增删改操作添加排他锁。<br/>
2、表锁：加锁粒度大，加锁的资源消耗小，Mysalm和Innodb都支持。<br/>
3、全局锁：加锁后全库都处于只读状态，用于全库数据备份。</p>
<p><strong>1.9 海量数据下，如何快速找到一条数据</strong><br/>
1）使用布隆过滤器，快速过滤不存在的数据；<br/>
2）red is中建立数据缓存<br/>
3）查询优化</p>
<h6 data-id="heading-0">[]2、数据库分库分表</h6>
<p><strong>2.1 数据库的分库分表？什么时候分？怎么分？</strong><br/>
当单表数据超过1000W时，很多操作的性能会下降，所以需要切分，以减少数据库的压力，缩短查询时间。<br/>
垂直切分：将关系联系不紧密的表进行分库，将一张表中不常用的字段进行抽取新建一张表。优点类似于微服务。<br/>
水平切分：当一个应用难以再细粒度的垂直切分，根据数据间的逻辑进行划分，比如客户、存款、支付；<br/>
<strong>2.2 数据库的优化</strong><br/>
1）sql优化以及索引的优化，索引建立要合理，过多会影响增删性能<br/>
2）数据可设计要满足他的三大范式、五大约束<br/>
3）硬件优化</p>
<p><strong>2.3 表设计的时候注意哪些，字段？</strong></p>
<blockquote>
<p>在设计数据库表时，需要注意以下几点，特别是在定义字段的时候：</p>
<ol>
<li>数据类型选择：选择最适合的数据类型可以减小数据库表的存储空间，提高检索效率。对于整数、浮点数、字符串等不同类型的数据，选择合适的数据类型是设计表结构时的关键之一。</li>
<li>索引设计：根据实际查询需求设计合适的索引，可以提高查询效率。通常在主键、外键、经常用于查询的字段上创建索引。</li>
<li>主键设计：选择一个唯一、稳定、易于理解的字段作为主键，以确保每条记录都有唯一标识，便于数据访问和管理。</li>
<li>字段命名规范：字段命名应具有描述性，易于理解和记忆，建议使用下划线分隔（如：first_name），避免使用含糊不清或缩写的字段名。</li>
<li>字段约束：定义字段的约束条件，如NOT NULL、UNIQUE、DEFAULT值等，可以保证数据的完整性和一致性。</li>
<li>数据冗余：避免数据冗余，尽可能将重复的数据抽取成单独的表，以减小数据存储量，同时避免数据更新异常。</li>
<li>参照完整性：在设计外键关系时，保证参照完整性，确保相关数据的一致性，避免数据关联异常。</li>
<li>考虑数据增长：预估数据表的增长情况，选择适当的存储引擎和分区方案，以支持未来数据量的增长。</li>
</ol>
<p>综上所述，在设计数据库表结构时，字段的数据类型、索引设计、主键选择、命名规范、约束条件、数据冗余、参照完整性、数据增长等方面都需要认真考虑，以保证数据库表的稳健性、性能和灵活性。</p>
</blockquote>
<h6 data-id="heading-1"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>3、数据库事务</h6>
<p>spring里面的事务和mysql里面的事务是一个概念，如果mysql不支持事务，加上@transation也是无效的。但是spring里面的@transation不能用于分布式环境下，分布式多线程下用的是senta+@globalTransation注解。<br/>
<strong>3.1 @transation用于类和方法有什么区别？</strong><br/>
@transation只能修饰public方法。<br/>
类上：相当于在所有的public方法上加上了@transation注解<br/>
方法：会覆盖类上的配置。</p>
<p><strong>3.2 事务的4个条件ACID</strong><br/>
原子性：所有的操作是一个整体，要么全部成功，要么全部失败（回滚）<br/>
一致性：事务开始前后，数据库的完整性没有被破坏，也就是写入的资料完全符合我们的预设。<br/>
隔离性：允许多个并发事务对数据进行读写操作，它可以有效的防止多个事务并发执行时由于交叉执行而导致数据的不一致。（隔离性里面有4个隔离级别：读未提交、读以提交、可重复读、串行化）<br/>
持久性：事务完成，对数据的操作就是永久的，即使系统故障也不会丢失。</p>
<p><strong>3.3 mysql事物隔离级别？</strong></p>
<p>MySQL 提供了四种隔离级别，用于控制事务之间的隔离程度，以确保事务操作的一致性和并发性。这四种隔离级别分别是：</p>
<blockquote>
<ol>
<li><strong>读未提交（Read Uncommitted）</strong>  ：最低的隔离级别，允许一个事务读取另一个事务未提交的数据。可能会出现脏读（Dirty Read）问题。</li>
<li><strong>读提交（Read Committed）</strong>  ：其他事务提交后才能读取数据，避免脏读问题。但可能会出现不可重复读（<em><strong>指的是在同一个事务中，某个查询操作在不同时间点内多次执行，但由于其他事务的并发操作，在多次执行过程中返回的数据结果不一致的情况</strong></em>）问题。</li>
<li><strong>可重复读（Repeatable Read）</strong>  ：保证在同一个事务中多次读取同一行数据时，结果始终一致。避免了脏读和不可重复读问题。但依然可能存在幻读（<em><strong>在相同的查询条件下，不同的事务在不同时间点执行查询操作时，可能会看到不同数量的行，从而产生"幻像"的错觉</strong></em>）问题。</li>
<li><strong>串行化（Serializable）</strong>  ：最高的隔离级别，通过确保事务串行执行来避免脏读、不可重复读和幻读问题。确保所有事务的并发执行不会导致数据不一致。</li>
</ol>
<p>在 MySQL 中，可以通过设置事务的隔离级别来控制事务的隔离程度，从而灵活地平衡并发性能和数据的一致性。开发者可以根据实际需求选择合适的隔离级别来确保数据操作的正确性和安全性。</p>
</blockquote>
<h6 data-id="heading-2">[]4、Mysql其他问题</h6>
<p><strong>4.1 mysql中的null和空值有什么不一样？</strong><br/>
1）空值是不占空间的，null值占用空间。两者就像：空值是真空状态的杯子，而null值是装满空气的杯子。<br/>
2）查寻上：null 值是用is null/is not null来查询，而空值( ’ ’ )则可以用 = &gt; !=等。 在使用聚合函数count时，会过滤掉null，而不会过滤掉 （ ’ ’ ）值。<br/>
在实际开发中，没有特定需求，可以直接使用空值！！！</p>
<p><strong>4.2 mysql主从数据库延时的原因？</strong></p>
<blockquote>
<p>MySQL主从数据库延时可能有多种原因，以下是一些常见的原因：</p>
<ol>
<li>网络延迟：主从数据库之间的网络连接如果不稳定或者网络质量差，会导致数据同步的延迟。</li>
<li>主从数据库负载：主数据库的负载过高，或者从数据库的性能不足，都可能导致数据同步延迟。</li>
<li>数据量过大：如果要同步的数据量过大，或者有大量的写操作，都会增加同步的时间。</li>
<li>复制方式设置不当：MySQL复制方式（如异步复制、半同步复制等）的配置不合理也会导致延时。</li>
<li>主从数据库版本不兼容：如果主从数据库的版本不一致或不兼容，也可能导致数据同步延迟。</li>
</ol>
<p>在排查MySQL主从数据库延时问题时，可以逐一检查上述可能的原因，逐步定位并解决问题。</p>
</blockquote>
<p><strong>4.3 mysql主从复制的过程？</strong></p>
<blockquote>
<p>MySQL主从复制是一种常见的数据库复制技术，用于将主数据库中的数据实时同步复制到从数据库。以下是MySQL主从复制的基本过程：</p>
<ol>
<li>配置主数据库：首先需要在主数据库上开启二进制日志（Binary Log），并配置主机的唯一标识（Server ID）。</li>
<li>配置从数据库：在从数据库上配置连接主数据库的信息，包括主数据库的IP地址、端口号、用户名密码等。同时设置从数据库的唯一标识（Server ID）。</li>
<li>启动主从复制过程：在从数据库上执行CHANGE MASTER TO命令，指定主数据库的连接信息，并启动从数据库与主数据库的连接。</li>
<li>数据传输与同步：当主从数据库连接成功后，主数据库会将变更写入二进制日志，并通过主从复制线程将这些变更传输给从数据库，从数据库接收到变更后应用于自身数据库，实现数据同步。</li>
<li>监控与维护：定期检查主从数据库的状态，确保主从复制正常运行。如果发现延迟或同步失败，需要及时排查并解决问题。</li>
</ol>
<p>总的来说，MySQL主从复制的过程包括配置主从数据库、启动复制、数据传输与同步以及监控与维护等步骤。通过主从复制，可以实现数据的备份、负载均衡以及容灾等功能。</p>
</blockquote>
<h6 data-id="heading-3"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>四、JVM虚拟机</h6>
<p>笔者此前在其他博客上整理过，不在重复，链接如下：</p>
<h6 data-id="heading-4"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/></h6>
<blockquote>
<blockquote>
<p><strong>篇幅限制下面就只能给大家展示小册部分内容了。整理了一份核心面试笔记包括了：Java面试、Spring、JVM、MyBatis、Redis、MySQL、并发编程、微服务、Linux、Springboot、SpringCloud、MQ、Kafka 面试专题</strong></p>
<blockquote>
</blockquote>
<p><strong>需要全套面试笔记及答案【扫一扫】</strong>                        即可免费获取**</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca2b80d559624a8d84507af43688d2cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357252&amp;x-signature=74MffoveEG14kGUE1%2BC5vc1sZvM%3D" alt="8fbf1ef8b61e2dbbb33b7690a41d12e.png" loading="lazy"/> 对这份笔记感兴趣的小伙伴可以点击文末名片免费获取</p>
</blockquote>
<h6 data-id="heading-5"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>五、Redis面试题</h6>
<h6 data-id="heading-6"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>1 、缓存雪崩、缓存穿透、缓存击穿</h6>
<ul>
<li>_<strong>缓存雪崩：</strong>  _缓存同一时间大面积失效，大量请求打到数据库上，数据库承受不住崩掉；<br/>
解决方案：过期时间设置成随机、缓存预热（系统出初启动，先存数据到缓存里）</li>
<li>_<strong>缓存穿透：</strong>  _数据库和redis中都没有数据，导致大量数据查询数据库，导致数据库崩掉；</li>
<li>可以将不存在的请求key的value 设置成一个字符串返回，这样就避免了黑君攻击到数据库。<br/>
解决方案： 接口层进行校验（id&lt;0的直接拒绝）、采用布隆过滤器</li>
<li>_<strong>缓存击穿：</strong>  _redis的一个key失效，请求全部打到数据库（缓存没有数据库有）；<br/>
解决方案： 热点数据永不过期，设置成空字符串返回</li>
</ul>
<h6 data-id="heading-7"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>2、 如何保证数据库和Redis的数据一致性</h6>
<p>当我们遇到这个问题时，要考虑是先删缓存，还是先写数据库。<br/>
延时双删： 先删redis缓存数据，再更新数据库，然后再删redis缓存,这样就避免了删除redis和更新数据库这期间，其他的线程读不到redis里的值，去读数据库里的旧数据。</p>
<p>将操作可串行化（先写在读就可以了）<br/>
1）先删缓存，将更新数据库操作放到一个有序队列中<br/>
2）从缓存中查不到的查询操作，都进入有序队列（MQ）<br/>
问题：大量读请求积压--------&gt; 将队列水平拆分</p>
<h6 data-id="heading-8"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>3、Redis的数据结构及使用场景</h6>
<p>String :字符串 ----------原子计数器<br/>
List ：列表 ---------微博、微信等消息流数据<br/>
Set ：无序集合 ---------好友推荐<br/>
Zset ：有序集合 -----------排行榜<br/>
Hash ：哈希表 ----------适合存储对象</p>
<p>----------------------------------前五种为常见，后四种为面试加分项-------------------------------------------<br/>
bitmap:布隆过滤器<br/>
GeoHash:坐标，（存储坐标的）基于Zset的score进行排序就可以得到坐标附近的值<br/>
HyperLoglog: 统计不重复数据，用于大数据基础使用<br/>
Streams:内存版的Kafka，消息的订阅发布</p>
<h6 data-id="heading-9"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>4、Redis持久化机制有哪些</h6>
<p>基于内存，宕机数据会消失，所以需要持久化。有两种方式</p>
<ul>
<li>RDB：Redis DateBase<br/>
在指定的时间间隔内将内存中的数据以快照的形式写入磁盘,实际是fork（分支）一个子进程，先将数据复制写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。</li>
</ul>
<blockquote>
<p>优点：</p>
<ul>
<li>整个redis数据库将只有一个dump.rdb文件，方便持久化；</li>
<li>容灾性好，方便备份；</li>
<li>性能最大化，fork子进程来完成写操作，让主进程继续处理命令，所以是IO最大化。使用单独子进程来进行持久化，主进程不进行任何的IO操作，保证了Redis的高性能；</li>
<li>相对于数据集大时，比AOF的启动效率更高；</li>
</ul>
<p>缺点：</p>
<ul>
<li>数据安全性低。持久化期间Redis发生故障，会有数据丢失；</li>
</ul>
</blockquote>
<p>AOF: Append Only File<br/>
以日志的形式记录服务器的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录</p>
<blockquote>
<p>优点：</p>
<ul>
<li>数据安全，每次修改都会被记录到磁盘中；</li>
<li>通过append模式写文件，即使Redis宕机，也不会破坏已经存在的内容，可以通过redis-check-aof工具解决数据一致性问题；</li>
</ul>
<p>缺点：</p>
<ul>
<li>效率没有RDB高；</li>
<li>AOF文件比RDB大，且恢复速度慢；</li>
</ul>
</blockquote>
<h6 data-id="heading-10"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>5、Redis其他常见问题</h6>
<p><strong>5.1 Redis线程模型，单线程为什么快？</strong></p>
<p>单线程快的原因有以下几点:</p>
<ul>
<li>纯内存操作</li>
<li>核心是基于非阻塞的IO多路复用机制(单个线程可以同时处理多个请求)</li>
<li>单线程避免了多线程来回切换的上下文环境切换问题</li>
</ul>
<p><strong>5.2 Redis分布式锁的实现原理</strong><br/>
set(key,value,setnx,setpx)<br/>
setnx-----------&gt;加锁的命令<br/>
setpx-----------&gt;锁的过期时间<br/>
setnx+setp在高版本中已经整合为一个原子命令。<br/>
当任务超时，锁自动释放怎么办？可以使用redission的看门狗，会自动续期。</p>
<blockquote>
<ol>
<li>
<p><strong>获取锁</strong>：</p>
<ul>
<li>客户端使用SET命令尝试在Redis中设置一个特定的键作为锁，可以设置一个固定的值作为锁持有者的标识，同时设置一个过期时间（防止锁无法释放导致死锁）。</li>
<li>设置键时使用NX参数（即只在键不存在时才能设置成功），这样可以确保只有一个客户端能够成功设置该键，获得了锁。</li>
</ul>
</li>
<li>
<p><strong>释放锁</strong>：</p>
<ul>
<li>当客户端要释放锁时，可以通过DEL命令来删除这个键，确保该锁被释放。</li>
</ul>
</li>
<li>
<p><strong>防止死锁</strong>：</p>
<ul>
<li>设置锁时可以为键设置一个合理的过期时间，以防止锁无法释放导致死锁。即使持有锁的客户端在处理任务时发生异常退出，保证锁在一定时间后会自动释放。</li>
</ul>
</li>
<li>
<p><strong>避免误删除</strong>：</p>
<ul>
<li>尽量不要使用DEL命令直接删除锁，因为可能会误删其他客户端的锁。可以使用Lua脚本来确保原子性操作，只有持有锁的客户端才能成功释放锁。</li>
</ul>
</li>
</ol>
<p>总的来说，Redis分布式锁的实现原理基于对Redis的SET命令设置NX参数进行加锁和DEL命令释放锁，配合合理设置过期时间来保证分布式锁的正确性和稳定性。通过合理设计和管理分布式锁，可以帮助多个客户端在分布式环境中协调访问共享资源，避免竞争条件和数据不一致问题。</p>
</blockquote>
<p><strong>5.3 Redis主从复制的原理</strong><br/>
简述好下面的流程图即可（基本使用哨兵模式，基于主从复制的基础上，可以保证高可用，哪个节点挂了就重新选举）<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/269d06df16eb4bfdb76b064baf820cbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357252&amp;x-signature=fteSQulg4ejChsruWtpRSS7zr3g%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>5.4、Redis 到底是单线程还是多线程？</strong><br/>
Redis6.0 版本之前的单线程指的是网络 I/O 和键值对读写是由一个命令完成的；<br/>
Reds6.0 版本之前只有网络请求模块和数据操作模块是单线程的，而其他的特久化，集群数<br/>
据同步，其实是由额外的线程完成的<br/>
Redis6.0 版本之后的多线程指的是网络请求过程采用了多线程，而键值对的读写命令依然是单线程处理，所以Redis 是线程安全的。命令的执行排队执行<br/>
<strong>5.5、 单线程为什么快？</strong><br/>
内存操作、单线程操作没有线程切换开销、全局 hash表 〈一维数细：链表〉查找快<br/>
<strong>5.6、Redis 底层数据如何用跳表来存储的？</strong><br/>
跳表：将有序链表改造为支持近似“折半查找”算法，可以快速的插入、删除、查找操作。<br/>
<strong>5.7、Redis 的Key过期了，为什么没有释放？</strong><br/>
有两种删除策略：<br/>
惰性删除：当读到一个过期的key时触发删除<br/>
定时删除：惰性删除无法及时删除，所以 Redis默认每 100ms 主动删除一批己过期的 key,导致可能出现部分 key 过期但没被清理的情况，导致内存并没有被释放。<br/>
小坑：如果使用set命令修改某个key 的valve 值，没有加过期时间参数，这个key会被设定为永久有效。<br/>
<strong>5.8、 Redis 没设置过期期间，为什么被 Redis 主动删除了？</strong><br/>
当Redis 已用内存超过最大内存时，会触发主动清理策略（8种)，对过期key所有 key设置了处理。可能触发了对所有key 的筛选删除（LRU：最近最少使用，LFU：最少频率使用)。<br/>
<strong>5.9、删除key 的命令，会阻塞 Redis吗？</strong><br/>
删除 String 类型，时间复杂度 o(1),删除单个列表、集合或 hash 类型的key时间复杂度为 o(M)；<br/>
<strong>5.10、一次线上事故，Redis 主从切换导致了缓存雪崩</strong><br/>
（要保证主从库机器时钟一致）我们假设，slave 的时钟比master 的时钟快很多。我们在master 里设置了过期的key， slave的角度看，可能会有很多在master里没有过期的数据己经过期了。如果此时操作主从切换，把 slave提升为新的master，就会开始清理大量的key;会导致以下结果：<br/>
① Master大量清理 key，主线程阻塞，无法及时处理客户端请求；<br/>
② Redis 大量数据过期，引发缓存雪崩。</p>
<p><strong>5.11、线上Redis 持久化策略一般如何设置？</strong><br/>
默认 RDB， 如果对性能要求较高，在master最好不要做持久化，可以在某个 slave 开启 AOF<br/>
备份数据，策略设置为每秒同步一次即可。<br/>
<strong>5.12、一次线上事故，Redis 主节点宕机导致数据全部丢失</strong><br/>
如果 Redis 采用以下模式部署，就会发生数据丢失问题：<br/>
master-slave+哨兵部署实例 ＋master 没有开启持久化功能 ＋Redis 进程使用supervisor管理，并配罟宕机重启。<br/>
这样在master言机，哨兵还未发起切换，supervisor 会将 master 立马拉起，但因为 master<br/>
没有设置持久化，就相当于是空实例，其他的 slave为了会master 保持数据同生，也会变成一个个空实例，也就发生了数据丟失。<br/>
避免：不要给 Redis 主节点设置宕机立马重启，而应该等哨兵把某个 slave选为 master之后，在重启原来宕机的主节点，让其变成 slave。<br/>
<strong>5.13、Redis主从复制风暴是怎么回事？</strong><br/>
Redis 主节点有多个从节点，在某一时刻主节点挂了，重启后从节点重新连上主节点后，进行全量复制，数据量大，加重网络和服务器的页载。避免方法：使用哨兵或集群模式。</p>
<p><strong>red is集群是通过分片技术，hash到不同的节点上</strong></p>
<h6 data-id="heading-11"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>六、SSM和SpringBoot</h6>
<h6 data-id="heading-12"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>1、Spring相关问题</h6>
<p>Spring必问ioc和aop，基本程序员都知道，但如果想要获得好的印象，拉开差距，就要回答出更深的理解，阅读过源码是最好的，总结过一些spring的细节问题，点击链接阅读[spring杂记]</p>
<p><strong>1.1 Spring是什么？谈谈IOC和AOP的理解</strong><br/>
Spring是一个企业级的应用框架，减化了配置，简化了项目部署环境。</p>
<p>IOC: 容器概念、控制反转、依赖注入</p>
<blockquote>
<ul>
<li><em><strong>ioc容器：</strong></em><br/>
实质就是一个map（key,value）里面存放了各种对象（xml里的bean节点，@Service 、@Conroller、@Compent等），在项目启动时，会读取配置文件里的bean节点，根据全限定类名使用反射创建对象，存入到map中。这个时候map里就有我们需要的各种对象了，当我们需要使用时，通过DI（@Autowired、@Resource等注解，xml里的ref标签）注入的方式去取。</li>
<li><em><strong>控制反转:</strong></em><br/>
没有引入ioc容器前，我们A对象依赖于B对象，需要自己手动的去new，引入ioc后，需要B对象的时候ioc自己主动去创建一个B对象到A需要的地方。A对象获取B对象的过程，从主动变成了被动，这个就是控制反转的由来。</li>
<li><em><strong>依赖注入:</strong></em><br/>
依赖注入是实现IOC的方法，就是在IOC运行期间，主动的将某种依赖关系注入到对象中；</li>
</ul>
</blockquote>
<p>AOP：将程序中的交叉业务逻辑（日志、异常、安全）封装成一个切面，对符合其要求的对象进行一个增强，比如一个方法的增强，在方法执行前或执行后做一些额外的事（通过beanPostProcessor实现）。</p>
<p><strong>1.2 说一下Spring的事务机制</strong></p>
<p>Spring的事务机制是基于数据库事务和AOP。<br/>
对于加了@Transation的注解，会创建一个代理对象作为bean，当调用代理对象方法时，会判断该方法上是否加了@Transation的注解，如果加了，就利用事务管理器创建一个数据库连接，将autocommit改为false,禁止自动提交，事务结束没有异常就提交，反之回滚。</p>
<p>什么时候@Transation会失效？方法加了private私有时会失效。非代理对象调用也会失效</p>
<p><strong>1.3 Spring 的bean生命周期</strong><br/>
Spring的bean生命周期里面涉及的内容很多，这里只是说一个大致流程，面试非大厂足够了</p>
<blockquote>
<p>有一个类 UserService.class--------&gt;<em><strong>推断构造方法</strong></em>（默认无参构造）---------&gt;<em><strong>实例化</strong></em>（普通对象）----------&gt;<em><strong>依赖注入</strong></em>（属性赋值，加了@Autowire -------&gt; 初始化前(@PostConstruct) --------&gt;<strong>初始化</strong>(initializingBean)--------&gt; 初始化后（AOP）---------&gt; 代理对象 ------&gt;<em><strong>bean</strong></em></p>
</blockquote>
<p>读取配置信息获取到beandefinition（BeanDefinition 是定义 Bean 的配置元信息接口），存入到map中，推断bean的构造方法，进行实例化，然后进行属性赋值，在初始化后会进行aop的切面，如果创建的bean是单例的，会将单例bean放入到单例池中。之后进行bean的使用，使用完后会调用<br/>
destroy（）方法进行销毁；</p>
<h6 data-id="heading-13"><a href="https://link.juejin.cn/?target=" target="_blank" title="https://link.juejin.cn/?target="/>2、SpringMVC执行流程</h6>
<p>1、具体执行流程如下，面试前背下来即可(截图可放大)！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e5789b5fe1a47998ee4228e115687e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357252&amp;x-signature=gmqPQ1dnxCM6iRUB%2Fc99KY0HX1U%3D" alt="在这里插入图片描述" loading="lazy"/><br/>
2、父子容器</p>
<blockquote>
<p><strong>springmvc创建了一个自己的容器，并且继承了spring的容器？</strong><br/>
是，在 Spring MVC 中,DispatcherServlet会创建一个自己的 ApplicationContext 容器,这个容器是继承自 Spring 应用程序的根 ApplicationContext 容器的。<br/>
具体过程如下:</p>
<ol>
<li>启动 Spring 应用程序时,会创建一个根 ApplicationContext 容器。这个容器包含了应用程序中所有的bean,如 Service 层和 Repository 层的 bean。</li>
<li>当 DispatcherServlet 被初始化时,它会创建自己的 ApplicationContext 容器。这个容器是根ApplicationContext 容器的子容器。</li>
<li>DispatcherServlet 容器会继承根 ApplicationContext 容器中的所有 bean,因此可以访问这些bean。但根 ApplicationContext 容器无法访问 DispatcherServlet 容器中特有的 bean,如Controller 等。</li>
</ol>
</blockquote>
<p>这种父子容器的关系提供了以下优点:</p>
<ul>
<li>关注点分离: Web 层的 bean 和业务层的 bean 被分隔在不同的容器中,提高了代码的可维护性。</li>
<li>资源隔离: Web 层的资源不会影响到业务层,提高了应用程序的健壮性和安全性。</li>
<li>依赖管理: DispatcherServlet 容器可以访问根容器中的所有 bean,无需重复定义。</li>
</ul>
<p>总之,Spring MVC 通过创建自己的 ApplicationContext 容器并将其设置为根容器的子容器,实现了父子容器的架构设计,提高了应用程序的模块化和可扩展性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e01566dd435249bcaaf94659690d67bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357252&amp;x-signature=X5pOir%2BGKzITFqQ9Y0CkUQegyOI%3D" alt="在这里插入图片描述" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[牛客-NC49最长的括号字串]]></title>    <link>https://juejin.cn/post/7600681071714500608</link>    <guid>https://juejin.cn/post/7600681071714500608</guid>    <pubDate>2026-01-30T03:17:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600681071714500608" data-draft-id="7600670487409606708" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="牛客-NC49最长的括号字串"/> <meta itemprop="keywords" content="后端,C++"/> <meta itemprop="datePublished" content="2026-01-30T03:17:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="枯枫屿"/> <meta itemprop="url" content="https://juejin.cn/user/1558436056404313"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            牛客-NC49最长的括号字串
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1558436056404313/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    枯枫屿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:17:47.000Z" title="Fri Jan 30 2026 03:17:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">描述</h3>
<p>给出一个长度为 n 的，仅包含字符 '(' 和 ')' 的字符串，计算最长的格式正确的括号子串的长度。</p>
<p>例1: 对于字符串 "(()" 来说，最长的格式正确的子串是 "()" ，长度为 2 .<br/>
例2：对于字符串 ")()())" , 来说, 最长的格式正确的子串是 "()()" ，长度为 4 .<br/>
字符串长度：0≤n≤5∗1050≤n≤5∗105<br/>
要求时间复杂度 O(n)O(n) ,空间复杂度 O(n)O(n).</p>
<h3 data-id="heading-1">示例1</h3>
<p>输入：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"(()"</span>
</code></pre>
<p>返回值：</p>
<pre><code class="hljs">2
</code></pre>
<h3 data-id="heading-2">示例2</h3>
<p>输入：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"(())"</span>
</code></pre>
<p>返回值：</p>
<pre><code class="hljs">4
</code></pre>
<h3 data-id="heading-3">解题思路（优先推荐栈方法，直观易实现）</h3>
<p>有效括号的核心是 “匹配”，栈可以精准记录未匹配括号的位置，从而计算有效子串长度，思路如下：</p>
<ol>
<li>
<p><strong>初始化栈</strong>：栈中存储括号的<strong>索引</strong>（而非字符），先压入 <code>-1</code> 作为有效子串的<strong>起始基准</strong>（处理第一个字符就是 <code>)</code> 的边界情况）。</p>
</li>
<li>
<p><strong>遍历字符串</strong>：逐个遍历每个字符，记录当前索引 <code>i</code>：</p>
<ul>
<li>
<p>遇到 <code>(</code>：将当前索引 <code>i</code> 压入栈（表示这个左括号等待匹配）。</p>
</li>
<li>
<p>遇到 <code>)</code>：先弹出栈顶元素（尝试匹配最近的左括号）：</p>
<ul>
<li>若弹出后栈为空：说明当前 <code>)</code> 无匹配的 <code>(</code>，将 <code>i</code> 压入栈作为新的基准。</li>
<li>若弹出后栈不为空：当前有效长度 = <code>i - 栈顶元素</code>，用这个值更新最大有效长度。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>返回结果</strong>：遍历结束后，记录的最大长度即为答案。</p>
</li>
</ol>
<h3 data-id="heading-4">完整可运行代码</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">longestValidParentheses</span><span class="hljs-params">(string s)</span> </span>{
        <span class="hljs-type">int</span> maxLen = <span class="hljs-number">0</span>; <span class="hljs-comment">// 记录最长有效括号长度</span>
        stack&lt;<span class="hljs-type">int</span>&gt; st;  <span class="hljs-comment">// 存储括号索引，用于计算有效长度</span>
        st.<span class="hljs-built_in">push</span>(<span class="hljs-number">-1</span>);    <span class="hljs-comment">// 初始基准值，处理边界情况（如第一个字符是')'）</span>
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; s.<span class="hljs-built_in">size</span>(); ++i) {
            <span class="hljs-keyword">if</span> (s[i] == <span class="hljs-string">'('</span>) {
                <span class="hljs-comment">// 左括号：压入当前索引，等待匹配</span>
                st.<span class="hljs-built_in">push</span>(i);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 右括号：先弹出栈顶（尝试匹配最近的左括号）</span>
                st.<span class="hljs-built_in">pop</span>();
                <span class="hljs-keyword">if</span> (st.<span class="hljs-built_in">empty</span>()) {
                    <span class="hljs-comment">// 栈空说明当前右括号无匹配，更新基准为当前索引</span>
                    st.<span class="hljs-built_in">push</span>(i);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// 计算当前有效长度，更新最大值</span>
                    maxLen = <span class="hljs-built_in">max</span>(maxLen, i - st.<span class="hljs-built_in">top</span>());
                }
            }
        }
        
        <span class="hljs-keyword">return</span> maxLen;
    }
};
</code></pre>
<h3 data-id="heading-5">补充：动态规划方法（可选，进阶思路）</h3>
<p>如果想了解另一种常用解法，这里给出动态规划版代码（供参考）：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">longestValidParentheses</span><span class="hljs-params">(string s)</span> </span>{
        <span class="hljs-type">int</span> maxLen = <span class="hljs-number">0</span>;
        <span class="hljs-comment">// dp[i] 表示以s[i]结尾的最长有效括号长度</span>
        <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">dp</span><span class="hljs-params">(s.size(), <span class="hljs-number">0</span>)</span></span>;
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; s.<span class="hljs-built_in">size</span>(); ++i) {
            <span class="hljs-keyword">if</span> (s[i] == <span class="hljs-string">')'</span>) {
                <span class="hljs-comment">// 情况1：前一个字符是'('，直接匹配</span>
                <span class="hljs-keyword">if</span> (s[i<span class="hljs-number">-1</span>] == <span class="hljs-string">'('</span>) {
                    dp[i] = (i &gt;= <span class="hljs-number">2</span> ? dp[i<span class="hljs-number">-2</span>] : <span class="hljs-number">0</span>) + <span class="hljs-number">2</span>;
                }
                <span class="hljs-comment">// 情况2：前一个字符是')'，且前面有匹配的'('</span>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i - dp[i<span class="hljs-number">-1</span>] &gt; <span class="hljs-number">0</span> &amp;&amp; s[i - dp[i<span class="hljs-number">-1</span>] - <span class="hljs-number">1</span>] == <span class="hljs-string">'('</span>) {
                    dp[i] = dp[i<span class="hljs-number">-1</span>] + (i - dp[i<span class="hljs-number">-1</span>] &gt;= <span class="hljs-number">2</span> ? dp[i - dp[i<span class="hljs-number">-1</span>] - <span class="hljs-number">2</span>] : <span class="hljs-number">0</span>) + <span class="hljs-number">2</span>;
                }
                maxLen = <span class="hljs-built_in">max</span>(maxLen, dp[i]);
            }
        }
        <span class="hljs-keyword">return</span> maxLen;
    }
};
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 时代，程序员的价值在哪里？]]></title>    <link>https://juejin.cn/post/7600791597169213483</link>    <guid>https://juejin.cn/post/7600791597169213483</guid>    <pubDate>2026-01-30T04:28:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600791597169213483" data-draft-id="7600706866785124395" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 时代，程序员的价值在哪里？"/> <meta itemprop="keywords" content="稀土"/> <meta itemprop="datePublished" content="2026-01-30T04:28:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HongJianLi"/> <meta itemprop="url" content="https://juejin.cn/user/430664725579725"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 时代，程序员的价值在哪里？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/430664725579725/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HongJianLi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:28:05.000Z" title="Fri Jan 30 2026 04:28:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天杭州天气不太好，上班路上下了一点小雨。从地铁站走到公司的路上，我一直在思考一个问题：<strong>AI的发展对程序员到底是好事还是坏事？</strong></p>
<p>网络上到处在说“AI要取代程序员”“程序员的饭碗要没了”。这种说法是真的吗？</p>
<p>我的观点很明确：<strong>AI不仅不会取代程序员，反而会成为程序员极其强大的助手——甚至可以说是核武器级别的加速器。</strong></p>
<p>要讲清楚这个问题，我们可以从三类人群的角度来分析。</p>
<hr/>
<h2 data-id="heading-0">一、没有任何计算机基础的人</h2>
<p>对完全不懂编程的人来说，AI确实带来了巨大便利。你只需要用自然语言描述想法，AI就能帮你生成代码、做出原型、快速验证可行性。这在过去是不可想象的效率提升。</p>
<p>但问题在于：<strong>做出一个能跑的Demo，不等于能做出一个可以上线、稳定运行、可维护的产品。</strong></p>
<p>比如，一个普通人用AI写了个程序，可能根本不知道：</p>
<ul>
<li>这个程序在 Windows 和 Linux 上需要哪些运行环境？</li>
<li><code>.jar</code> 文件和可执行文件有什么区别？</li>
<li>什么是服务器？怎么部署？怎么监控？</li>
</ul>
<p>更不用说 JVM、GC（垃圾回收）、STW（Stop-The-World）这些概念了。你甚至可能都没听说过它们。当你的 Demo 跑起来时，你不会意识到它在线上可能因为内存溢出、线程阻塞或环境差异而崩溃。</p>
<p>对于一个完全没有程序员的团队来说，这些问题几乎是致命的。让他们从零开始系统学习计算机知识？这在现实中是不现实的。</p>
<p>这也让我想到《代码整洁之道：程序员的职业素养》中提到的一个历史案例——<strong>MDA（模型驱动架构）的失败</strong>。</p>
<p>书中写道：</p>
<blockquote>
<p>“在20世纪90年代早期，我满怀希望地相信CASE工具行业将会彻底改变软件开发人员的工作方式。在那个冲动的年代，展望未来，我满以为到现在这个时候，每个人都应该已经在更高的抽象层次上用图形语言编程，而文本语言编程的时代应该已经一去不复返了。</p>
<p>我太幼稚了。不但这个梦想没有实现，连朝这个方向所做的每一次努力都不幸失败了。不是缺乏工具和系统来展示这种方法的潜能，只是，这些工具都不理想，很少有人愿意用。</p>
<p>在这个梦想中，软件开发人员将可抛弃基于文本编程的琐碎细节，采用一种更为高级的图形语言来编写系统。事实上，只要这个梦想成真，也许根本就不再需要程序员了。架构师能够通过UML图形创建整个系统。工程师们，那帮人数众多、冷酷、对非编程人士的困境缺乏同情的家伙，只需把这些图形转换成可执行代码就可以了。这伟大梦想就是‘模型驱动架构’（MDA）。</p>
<p>不幸的是，这个伟大的梦想有那么一点微小的瑕疵。MDA假设代码是问题之所在。但事实上，代码并不是问题。代码从来都不是问题。细节才是问题。</p>
<p>程序员负责管理各种细节，这是我们的职责。我们通过管理各种最微小的细节来规范系统的行为。之所以使用文本语言来编写代码，正是因为文本语言（例如英语）非常便利。</p>
<p>我们管理的是什么样的细节呢？</p>
<p>你知道\n和\r这两个字符之间的差别吗？第一个字符\n表示换行，第二个字符\r表示回车。回的是什么“车”（carriage）呢？</p>
<p>在20世纪60年代和70年代早期，电传打字机是计算机最常见的输出设备。ASR33型号的电传打字机最为常见。</p>
<p>这个设备有一个打印头，打印头每秒能够打印10个字符。打印头上有一个小圆筒，上面铸着各个字符。圆筒可以旋转升降，当正确的字符朝向纸面的时候，就会有个小锤子敲击圆筒，将字符打在纸面上。在圆筒和纸面间有一条墨带，这时墨水便会把字符印在纸上了。</p>
<p>打印头放在一个车架（carriage）上。每打印一个字符，车架会向右移动一个位置，带动打印头前进。每行有72个字符，当到达行末时，必须明确地通过发送回车字符（\r = 0x0D）执行回车，否则打印头会继续在第72个字符上打印，会让那个字符变成一个脏兮兮的黑块。</p>
<p>当然，执行这一个命令还不够。回车后纸张并没有上移。如果只回车但没有发送换行指令（\n=0x0A），那么新的一行会重复打印在旧的那行上。</p>
<p>因此，对于ASR33电传打印机，每行应该以\r\n结尾。事实上，还必须要注意，回车耗时有可能会超过100毫秒。如果发送了\r\n，紧接其后的下一个字符有可能刚好在回车的时候打印出来，这样就有可能在行中打印出一个污点。为了安全起见，通常会在每行末尾再附加上一到两个删除符（0xFF）。</p>
<p>在20世纪70年代，电传打印机用得越来越少了，像UNIX这些操作系统把行末序列简化为\n。但是，其他操作系统，如DOS，仍然使用\r\n作为行末的约定。</p>
<p>你最近一次处理文本文件时，因使用了“错误”的行末约定而遭遇到问题，是在什么时候？我每年至少要遇到一次。两个一模一样的源文件在比较时却发现不一样，生成的校验和也不一样，这就是因为它们使用了不同的行结束符。由于行末结束符有“错”，文本编辑器无法正确自动换行，或者文本里多空了一行。由于将\r\n解析为两行，没有预料到空行的程序崩溃了。有一些程序能够识别\r\n，但是无法识别\n\r。诸如此类的问题很多。</p>
<p><strong>这就是我所说的细节。试试使用UML来描述解决行末问题的可怕逻辑！</strong>”</p>
</blockquote>
<p>这段话非常关键。MDA 的失败，本质上是因为它试图绕过“细节”，而<strong>软件开发的核心恰恰就是处理细节</strong>。</p>
<p>今天的 AI 和当年的 MDA 其实有相似之处：都希望通过更高层次的抽象（图形或自然语言）跳过手写代码。但现实是，<strong>无论你写多少提示词，最终还是要面对设计、边界条件、异常处理和平台差异等具体问题。</strong></p>
<p>写代码从来不是最难的部分，<strong>设计和理解系统才是。</strong></p>
<p>所以，一个没有经验的普通人，即使能用 AI 做出一个“重要程序”，你敢用吗？比如银行转账、医疗诊断、工业控制——这些系统容不得半点模糊。</p>
<hr/>
<h2 data-id="heading-1">二、普通程序员</h2>
<p>这里说的“普通程序员”，是指工作经验较少、对系统设计和底层原理理解不够深入的开发者。</p>
<p>对这类人来说，AI 是好事也是坏事：</p>
<ul>
<li>
<p><strong>对有进取心的人</strong>：AI 能极大加速学习过程。你可以快速理解新概念、生成示例代码、调试问题，从而更快积累经验。剩下的就是持续实践，稳步成长。</p>
</li>
<li>
<p><strong>对只想混日子的人</strong>：AI 反而是威胁。如果你只会复制粘贴、调用现成接口、机械完成任务，那么 AI 很快就能替代你。在这个快速变化的行业里，<strong>不思进取就是慢性淘汰。</strong></p>
</li>
</ul>
<p>技术一直在演进。十年前和现在差别已经很大，而下一个十年的变化只会更快。年轻人学习能力强、精力充沛、没有技术包袱——如果你停滞不前，被后来者超越是必然的。</p>
<p>别以为“稳”就是安全。在程序员这个行业，<strong>逆水行舟，不进则退。</strong></p>
<hr/>
<h2 data-id="heading-2">三、资深开发人员</h2>
<p>对资深开发者来说，AI 是一个强大的“加速引擎”。</p>
<p>它可以帮你：</p>
<ul>
<li>快速生成样板代码，减少重复劳动；</li>
<li>检查潜在 bug 或性能问题；</li>
<li>根据设计思路补全实现；</li>
<li>提供多种技术方案参考。</li>
</ul>
<p>但必须清楚：<strong>AI 不能替代系统设计和架构决策。</strong></p>
<p>软件开发从来不是一个人的事。一个人可以写出一个程序，但要让它长期稳定迭代，需要团队协作、流程规范、知识沉淀和持续维护。</p>
<p>未来更高效的模式，可能是由资深开发者组成的“特种兵式”小团队：</p>
<ul>
<li>每个人专注一个核心模块；</li>
<li>借助 AI 提升个人产出效率；</li>
<li>通过紧密协作保证整体质量。</li>
</ul>
<p>这样的团队迭代快、问题少、成本低，特别适合长期产品。即使是短期项目，稳定的团队也能爆发出更强战斗力。</p>
<p>频繁更换团队其实代价很高——上下文丢失、沟通成本上升、信任重建，这些都是隐形成本。在这方面，我也推荐《代码整洁之道》中的章节：“团队与项目——有凝聚力的团队”，里面讲得很清楚：<strong>高效来自默契，而非个体英雄主义。</strong></p>
<hr/>
<h2 data-id="heading-3">总结：AI 是蒸汽机，不是原子弹</h2>
<p>我认为，<strong>AI 是可以媲美蒸汽机的伟大发明。</strong></p>
<p>蒸汽机出现之前，生产靠人力，效率极低；蒸汽机之后，人类学会了高效利用能量，开启了工业革命。</p>
<p>今天，AI 正处于初级阶段。如果说蒸汽机是对<strong>能量的合理使用</strong>，那么 AI 就是对<strong>知识的充分使用</strong>。</p>
<p>我们今天很多问题——比如学习门槛高、信息碎片化、试错成本大——本质上是因为<strong>缺乏可靠知识，或无法快速获取它</strong>。AI 正在改变这一点。</p>
<p>所以，AI 不会取代程序员。它取代的，是那些<strong>只做重复性编码、不思考系统、不理解业务、不持续学习的人</strong>。</p>
<p>而对真正理解软件本质、善于解决问题、持续精进的程序员来说，AI 是前所未有的助力。</p>
<p><strong>与其担心被 AI 取代，不如学会用 AI 让自己变得更强大。</strong></p>
<p>下一个十年，变化一定会比过去十年更大。你准备好了吗？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[目前最火的 AI 助手 Clawdbot 又又又改名了 并且发布新版本]]></title>    <link>https://juejin.cn/post/7600764857769328690</link>    <guid>https://juejin.cn/post/7600764857769328690</guid>    <pubDate>2026-01-30T05:51:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600764857769328690" data-draft-id="7600990891205656603" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="目前最火的 AI 助手 Clawdbot 又又又改名了 并且发布新版本"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-30T05:51:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            目前最火的 AI 助手 Clawdbot 又又又改名了 并且发布新版本
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:51:34.000Z" title="Fri Jan 30 2026 05:51:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">目前最火的 AI 助手 Clawdbot 又又又改名了 并且发布新版本</h2>
<p>两个月前还叫 Clawdbot，三天前改成 Moltbot，今天又宣布改名 OpenClaw。这只开源龙虾到底经历了什么？</p>
<p>如果还不会安装没玩过的话，可以参考我得上一篇博客<a href="https://juejin.cn/post/7600238071038197769" target="_blank" title="https://juejin.cn/post/7600238071038197769">Clawdbot 对接飞书详细教程 手把手搭建你的专属 AI 助手</a></p>
<h3 data-id="heading-1">先说这玩意能干嘛</h3>
<p>想象一下：你在飞书群里 @机器人 说"帮我查一下上周的销售数据"，它直接连你本地数据库查完返回结果；你在 WhatsApp 上让它"把这张图里的文字提取出来"，它调用本地的 OCR 模型处理完发给你；你在 Telegram 上说"帮我写个 Python 脚本批量重命名文件"，它写完代码还能直接在你服务器上跑。</p>
<p>这就是 OpenClaw（原 Clawdbot）——一个<strong>跑在你自己机器上的 AI 助手</strong>，可以对接几乎所有主流聊天工具：</p>
<ul>
<li><strong>即时通讯</strong>：WhatsApp、Telegram、Discord、Slack、Teams</li>
<li><strong>国内平台</strong>：飞书、钉钉</li>
<li><strong>其他</strong>：Twitch、Google Chat、Web 界面</li>
</ul>
<p>关键是：<strong>数据全在你手里</strong>。不像那些云端 AI 助手，你的聊天记录、文件、API 密钥都存在自己的服务器上。你可以让它访问本地文件系统、执行 shell 命令、调用本地 API——这些在云端 AI 上想都别想。</p>
<p>这个项目最初只是作者的一个周末小玩具，结果两个月后 GitHub 上超过 <strong>10 万 stars</strong>，一周内 <strong>200 万访问量</strong>。</p>
<h3 data-id="heading-2">为什么老改名</h3>
<p>名字的变迁过程堪称一部开源项目的"避坑指南"：</p>
<p><strong>第一次：Clawd → 被 Anthropic 发律师函</strong></p>
<p>2025 年 11 月，项目起名 Clawd，是 Claude + claw（爪子）的谐音梗。用过 Claude 的人应该都见过加载时那只小龙虾——名字就来源于此。</p>
<p>结果没多久，Anthropic 法务团队就发来了"友好建议函"。Clawd 和 Claude 确实太像了，换位思考也能理解。</p>
<p><strong>第二次：Moltbot → 社区凌晨五点的产物</strong></p>
<p>2026 年 1 月 27 日，作者和社区成员在 Discord 上凌晨五点头脑风暴，选了 Moltbot。Molt 是龙虾蜕壳的意思，寓意成长。</p>
<p>但这名字有个问题：念起来像"摸头 bot"，而且 molt 这个词太冷门，很多人根本不知道什么意思。更惨的是，改名过程中还被人抢注了域名和社交账号，甚至有人趁机发了个同名的加密货币来割韭菜。</p>
<p><strong>第三次：OpenClaw → 这次做足了功课</strong></p>
<p>吸取前两次教训，这次改名前团队做了充分准备：</p>
<ul>
<li>商标检索：通过</li>
<li>域名：已购入</li>
<li>迁移代码：已写好</li>
<li>社交账号：已注册</li>
</ul>
<p>OpenClaw 这个名字拆开来看：Open（开源、开放）+ Claw（龙虾爪，致敬起源）。简单直接，不容易产生法律纠纷。</p>
<h3 data-id="heading-3">新版本更新了什么</h3>
<p>除了改名，这次还带来了不少实质性更新：</p>

























<table><thead><tr><th>类别</th><th>内容</th></tr></thead><tbody><tr><td>新渠道</td><td>Twitch 和 Google Chat 插件</td></tr><tr><td>新模型</td><td>KIMI K2.5、小米 MiMo-V2-Flash</td></tr><tr><td>Web 聊天</td><td>支持发送图片</td></tr><tr><td>安全</td><td>34 个安全相关提交，发布了可机器验证的安全模型</td></tr></tbody></table>
<p>作者特别提醒：prompt injection 目前在整个行业都是未解决的问题。既然 OpenClaw 能访问本地文件和执行命令，安全配置一定要认真对待。</p>
<h3 data-id="heading-4">后续计划</h3>
<ul>
<li>安全加固仍是首要任务</li>
<li>优化网关稳定性</li>
<li>支持更多模型和服务商</li>
<li>招募全职维护者（项目发展太快，作者一个人已经维护不过来了）</li>
</ul>
<h3 data-id="heading-5">我之前写的教程还能用吗</h3>
<p>如果你看过我之前写的 <a href="https://link.juejin.cn?target=.%2Fclawedbot-install.md" target="_blank" title="./clawedbot-install.md" ref="nofollow noopener noreferrer">Clawdbot 对接飞书详细教程</a>，命令和配置方式暂时还能用，CLI 工具名称还是 <code>clawdbot</code>。但按照这个改名频率，建议关注官方文档获取最新信息。</p>
<hr/>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://github.com/openclaw/openclaw" ref="nofollow noopener noreferrer">github.com/openclaw/op…</a></p>
<p>最新版本：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw%2Freleases%2Ftag%2Fv2026.1.29" target="_blank" title="https://github.com/openclaw/openclaw/releases/tag/v2026.1.29" ref="nofollow noopener noreferrer">v2026.1.29</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天内彻底改变你的人生]]></title>    <link>https://juejin.cn/post/7600670417858871330</link>    <guid>https://juejin.cn/post/7600670417858871330</guid>    <pubDate>2026-01-30T04:04:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670417858871330" data-draft-id="7600670487410163764" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天内彻底改变你的人生"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T04:04:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大鸡腿同学"/> <meta itemprop="url" content="https://juejin.cn/user/3526889030825928"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天内彻底改变你的人生
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889030825928/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大鸡腿同学
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:04:31.000Z" title="Fri Jan 30 2026 04:04:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>新年又要来了，大家不是又开始立各种Flag——减肥、学技能、早睡早起？结果往往没多久就悄声无声息地放弃了。数据显示，80-90%的新年会决议失败，为什么？不是你不够自律，而是大多数人根本在本质上真正改变。YouTube上有个爆火视频《如何在一天内修复你的整个人生》（如何在一天修复你整个人生），作者内丹Koe用心理学和行为科学直击本质，教你从根源翻盘。视频已经收获近20万观看（实际更高，网络传播超百万印象），他的观点太扎心了，但也超级实用。读完这些核心原观点，你可能会瞬间恍然大悟，一起在评论区分享你的Flag失败经历吧！</p>
<h2 data-id="heading-0">1.为什么Flag总是立不稳？大多数人其实并没有真正改变</h2>
<p>Dan Koe直言：大多数人立的目标只是表面功夫，动力来自炫耀或外部压力，而不是内心的渴望。“大多数人实际上并不想在深层、内部层面上改变。”（大多数人其实不想在深刻内在改变。）他们“设定表面目标，在最初几周自我炒作以保持自律，然后毫不费力地回到原来的方式，因为他们试图在腐烂的基础上建立美好的生活（设定表面目标，前几周靠兴奋维持纪律，然后无力就回到老样子，因为他们在腐烂的基础上试图缔造伟大人生。）本质上，人们无意识地成功地在追求安全和可预测，却失败了或后来的未知：“你在追求安​​全和可预测的目标，并找借口不让自己看起来像失败者。”（你在追求安​​全、可预测的目标，并寻求不像失败者的理由。）</p>
<h2 data-id="heading-1">2.先改变身份，行为就会自然随之</h2>
<p>Dan Koe 的核心观点：“You Aren'tWhere You Want to Bebecause You Aren't the Person Who Will Be There.”（你没到想去的地方，因为你不是那个会到那里的人。）解决方案很简单却深刻：“改变你是谁，让你的行为自然跟随。这是最重要的。这是首要的。” （改变你的身份，让行为自然紧随。这是最重要的，这是第一序。）比如说，真正成功健身的人不是靠意志力“逼”自己去，而是身份转变后讨厌不健身的感觉。</p>
<h2 data-id="heading-2">3.目标必须匹配内在：过易过难都会失败别再设切实际或太肤浅的目标。</h2>
<p>Dan Koe强调：“如果你想在生活中得到一个特定的结果，你必须在实现它之前就拥有能够创造这个结果的生活方式。”（如果你想要特定的结果，必须在达到之前才拥有它的生活方式。）真正的改变需要调整视角：“真正的改变需要改变你的目标……改变你的观点，因为这就是目标。目标是对未来的投射，它充当了感知。”（真正改变需要改变目标……改变视角，因为目标就是未来投影，部署镜头。）如果不匹配，你会无意识地回避一切机会。</p>
<h2 data-id="heading-3">4.创造动力“反愿景”（anti-vision），用失败后果激发</h2>
<p>别只幻想美好的未来，要狠狠的脑子不改变的下场！丹·科建议：“如果未来5年绝对没有任何变化，描述一个平均的星期二……现在，做同样的事情，但是10年？你错过了什么？接近什么机会？谁放弃了你？……你已经到了生命的尽头。你过着安全的生活。你从未打破模式。什么是成本？”（如果接下来5年什么都不变，一个普通的周二……10年呢？失去了什么？机会关闭了？谁放弃了你？……人生巅峰，你活了安全版，从未突破模式。代价是什么描述？）这让你“感受到更大事物的拉力。”（大致向东西的拉力。）</p>
<h2 data-id="heading-4">5.把人生游戏化：用奖励、评估和结构保持痴迷</h2>
<p>Dan Koe 说：“游戏是痴迷、享受和心流状态的典型代表。”（游戏是痴迷、享受和心流状态的枕头。）把生活拆成：反愿景（赌注是什么）、愿景（怎么赢）、一年目标（使命）、一个月项目（boss Fight）、每日杠杆（quests）。评估进展也很关键：“高智商是迭代、坚持和理解大局的能力。低智商的标志是（高智能是迭代、坚持、懂大局的能力。低智能是无法从错误中学习。）一天协议：早上奋发反省愿景和愿景、白天中断自动驾驶、晚上合成目标。视频结尾，Dan Koe分享：“我生命中最好的时期总是在一段时间彻底厌倦之后到来。”（我人生最佳时期总在彻底厌烦后。）这不是空谈，是可操作的心理重置法！试试他的“一天汇率”协议，你的Flag还能倒吗？评论区来分享你的反视力，或者你打算怎么改变身份，一起监督变强！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026 年请别再把时间浪费在这些技术上（以及你应该转学什么）]]></title>    <link>https://juejin.cn/post/7600706866785058859</link>    <guid>https://juejin.cn/post/7600706866785058859</guid>    <pubDate>2026-01-30T02:51:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600706866785058859" data-draft-id="7599566082212659252" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026 年请别再把时间浪费在这些技术上（以及你应该转学什么）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T02:51:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026 年请别再把时间浪费在这些技术上（以及你应该转学什么）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:51:49.000Z" title="Fri Jan 30 2026 02:51:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    34
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>每年都有新人（老鸟也不少）掉进同一个坑里：<strong>死盯着“热门”的看，却把“有用”的当耳旁风。</strong></p>
<p>他们拿着 2018 年的招聘 JD 当圣经，跟着过时的 YouTube 教程敲代码，死死抱住那些“大家都在用”的老技术找安全感。结果呢？整个行业早就把你甩在身后，连声招呼都不打，残酷得一塌糊涂。</p>
<p>到了 2026 年，最惨的其实不是你学不会某种高深的技术，而是<strong>你费劲巴拉学会了，结果发现这玩意儿已经没人稀罕了（Irrelevant）。</strong></p>
<p>这篇文章不是要踩谁。这里面提到的很多技术，当年那是响当当的基石，甚至现在还在很多关键系统里跑着。但如果你的目标是<strong>升职加薪、搞定更有挑战性的活儿、让自己别那么容易被淘汰</strong>，那么下面这 7 样东西，真的别再当成宝了——顺便告诉你，该换成什么。</p>
<hr/>
<h4 data-id="heading-0">1. 还在抱着 jQuery 不撒手</h4>
<p>说句扎心的：如果你现在开新项目还在用 jQuery，那不叫“务实”，那叫“考古”。
jQuery 是好东西，它解决了那个浏览器还在打架的蛮荒时代的痛点。但在 2026 年，那些痛点早就没了，你留下的只有那点改不掉的习惯。维护老项目碰到它没办法，但如果你现在还花大把时间去钻研它，那感觉就像是在 2026 年苦练“如何修理 VCD 播放器”。</p>
<ul>
<li><strong>该学点啥：</strong> 现代 JavaScript (ES2022+)、组件化框架、状态驱动 UI、Web 性能优化的基本功。</li>
<li><strong>一句话真相：</strong> 多去琢磨<strong>浏览器到底是怎么干活的</strong>，别光盯着那些给旧时代打补丁的工具。</li>
</ul>
<h4 data-id="heading-1">2. 写那种“野生”的 PHP</h4>
<p>没错，PHP 依然是互联网的半壁江山。但这不代表你应该去学那种原生（Raw）PHP。
在 2026 年，所谓的“PHP 开发者”其实就是**“框架开发者”**。除此之外的写法，基本就是在制造技术债。如果你脑子里的 PHP 还全是 <code>include</code>、全局变量和手写 SQL 拼接，那你学的版本可能过期十年了。</p>
<ul>
<li><strong>该学点啥：</strong> 基于框架的后端开发、API 优先的设计思路、异步处理、现代后端语言特性。</li>
<li><strong>一句话真相：</strong> PHP 没死，死的是那种<strong>没规矩、乱炖式的 PHP 写法</strong>。</li>
</ul>
<h4 data-id="heading-2">3. 人肉运维，手动撸服务器</h4>
<p>花几个礼拜学怎么手动配置服务器，看着那是挺有成就感的。但在 2026 年，这大多是在做无用功。
现在的团队才不在乎你能不能 SSH 连上去敲一堆命令，他们在乎的是你能不能<strong>让这套环境随时随地都能一键复现</strong>。懂底层原理没毛病，但<strong>凡事都要亲力亲为手动搞一遍</strong>？大可不必。</p>
<ul>
<li><strong>该学点啥：</strong> 基础设施即代码 (IaC)、容器化、云原生部署、可观测性（Observability）。</li>
<li><strong>一句话真相：</strong> 以前是“把服务器当宠物养”，现在是**“把服务器当牲口用，不行就换，全是自动化”**。</li>
</ul>
<h4 data-id="heading-3">4. 像背字典一样背框架 API</h4>
<p>这点最坑人——因为好多教程就是这么教的。
如果你的学习策略就是“背诵这个框架怎么用”，那你这职业生涯的地基基本就是豆腐渣做的。框架年年变，但底层原理是不变的。面试里最尴尬的就是：Demo 写得飞起，问一句**“为什么这么跑”**，直接哑火。</p>
<ul>
<li><strong>该学点啥：</strong> 语言核心概念、运行时机制、并发模型、网络协议、数据库底层。</li>
<li><strong>一句话真相：</strong> 框架只是干活的杠杆，<strong>底层原理才是你的内力</strong>。</li>
</ul>
<h4 data-id="heading-4">5. 只会“增删改查”的 CRUD Boy</h4>
<p>CRUD（增删改查）确实是基础，但如果你<strong>只会</strong>写 CRUD，那你的天花板就比地下室高不了多少。
现代系统早就不是简单的填表存表了，它是事件驱动的、分布式的、实时的。它关注的是数据怎么流转，而不是数据怎么躺在表里。</p>
<ul>
<li><strong>该学点啥：</strong> 事件驱动架构、消息队列、后台任务处理、领域驱动设计（DDD）入门、状态机。</li>
<li><strong>一句话真相：</strong> 未来的后端不看你写了多少接口，看你能不能<strong>玩转整个系统</strong>。</li>
</ul>
<h4 data-id="heading-5">6. 当个疲于奔命的“框架追星族”</h4>
<p>讽刺的是，太爱学新技术有时候也是在浪费时间。
每出一个新框架你都要去凑个热闹，最后的结果就是“样样通，样样松”。在 2026 年，团队看重的是你的<strong>适应能力</strong>，而不是你追热点的速度。</p>
<ul>
<li><strong>该学点啥：</strong> 把一个主流框架吃透、浏览器 API 和渲染原理、性能调优、无障碍（A11y）和 UX 体验。</li>
<li><strong>一句话真相：</strong> <strong>深度永远比新鲜感值钱。</strong> 真的。</li>
</ul>
<h4 data-id="heading-6">7. 闭门造车，为了刷题而刷题</h4>
<p>刷算法题有用吗？有用。但脱离实际场景干刷几百道题？效率极低。
现实里的工程问题，大部分时候是在做<strong>取舍（Trade-offs）</strong>，而不是在那儿解脑筋急转弯。</p>
<ul>
<li><strong>该学点啥：</strong> 真实系统里的数据结构应用、性能分析和调试、系统设计基础、学会读懂别人的屎山代码。</li>
<li><strong>一句话真相：</strong> 牛逼的工程师优化的是<strong>影响力</strong>，不是 LeetCode 的分数排名。</li>
</ul>
<hr/>
<h3 data-id="heading-7">💡 2026 年，到底啥才是硬通货？</h3>
<p>当你不再把时间浪费在那些“沉没成本”上，你才能腾出手来抓这一把好牌：</p>
<ul>
<li><strong>能升职加薪的本钱：</strong> 精通一门现代语言、云原生架构、分布式系统、可观测性、还有<strong>怎么用 AI 帮你写代码</strong>。</li>
<li><strong>职业加速器：</strong> 会写文档、能带新人、有产品思维、懂点安全、会搞性能优化。</li>
</ul>
<p>这些东西是有<strong>复利</strong>的，而那些框架 API？过两年就得清零重来。</p>
<h3 data-id="heading-8">结语：选技能就是选命</h3>
<p>学技术这事儿从来都不是中立的。你花进去的每一个小时，其实都是在给你的未来下注。</p>
<p>在 2026 年，最值钱的工程师不是那个“懂工具最多的百晓生”，而是**“最会做选择题”的人**。他们会绕开那些死胡同，死磕底层原理，想着怎么造系统而不是怎么写 Demo。当行业再次变天的时候（肯定会的），他们依然能稳坐钓鱼台——因为<strong>变化</strong>这东西，本来就是常态。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[BlockingQueue：阻塞操作与条件队列的高效结合]]></title>    <link>https://juejin.cn/post/7600692485946392585</link>    <guid>https://juejin.cn/post/7600692485946392585</guid>    <pubDate>2026-01-30T04:04:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600692485946392585" data-draft-id="7598401650856771584" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" BlockingQueue：阻塞操作与条件队列的高效结合"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-30T04:04:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             BlockingQueue：阻塞操作与条件队列的高效结合
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:04:00.000Z" title="Fri Jan 30 2026 04:04:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">BlockingQueue和BlockingDeque</h2>
<h3 data-id="heading-1">BlockingQueue</h3>
<p>BlockingQueue 通常用于一个线程生产对象，而另外一个线程消费这些对象的场景。下图是对这个原理的阐述:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c487c04fafb4327912618ef1b00178a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350640&amp;x-signature=HGPRgSgBi02y58tH1R%2F0UJO72xY%3D" alt="" loading="lazy"/></p>
<p>一个线程往里边放，另外一个线程从里边取的一个 BlockingQueue。</p>
<p>一个线程将会持续生产新对象并将其插入到队列之中，直到队列达到它所能容纳的临界点。也就是说，它是有限的。如果该阻塞队列到达了其临界点，负责生产的线程将会在往里边插入新对象时发生阻塞。它会一直处于阻塞之中，直到负责消费的线程从队列中拿走一个对象。 负责消费的线程将会一直从该阻塞队列中拿出对象。如果消费线程尝试去从一个空的队列中提取对象的话，这个消费线程将会处于阻塞之中，直到一个生产线程把一个对象丢进队列。</p>
<h3 data-id="heading-2">BlockingQueue 的方法</h3>
<p>BlockingQueue 具有 4 组不同的方法用于插入、移除以及对队列中的元素进行检查。如果请求的操作不能得到立即执行的话，每个方法的表现也不同。这些方法如下:</p>

































<table><thead><tr><th/><th>抛异常</th><th>特定值</th><th>阻塞</th><th>超时</th></tr></thead><tbody><tr><td>插入</td><td>add(o)</td><td>offer(o)</td><td>put(o)</td><td>offer(o, timeout, timeunit)</td></tr><tr><td>移除</td><td>remove()</td><td>poll()</td><td>take()</td><td>poll(timeout, timeunit)</td></tr><tr><td>检查</td><td>element()</td><td>peek()</td><td/><td/></tr></tbody></table>
<p>四组不同的行为方式解释：</p>
<ul>
<li>抛异常：如果试图的操作无法立即执行，抛一个异常。</li>
<li>特定值：如果试图的操作无法立即执行，返回一个特定的值(常常是 true / false)。</li>
<li>阻塞：如果试图的操作无法立即执行，该方法调用将会发生阻塞，直到能够执行。</li>
<li>超时：如果试图的操作无法立即执行，该方法调用将会发生阻塞，直到能够执行，但等待时间不会超过给定值。返回一个特定值以告知该操作是否成功(典型的是 true / false)。</li>
</ul>
<p>无法向一个 BlockingQueue 中插入 null。如果你试图插入 null，BlockingQueue 将会抛出一个 NullPointerException。 可以访问到 BlockingQueue 中的所有元素，而不仅仅是开始和结束的元素。比如说，你将一个对象放入队列之中以等待处理，但你的应用想要将其取消掉。那么你可以调用诸如 remove(o) 方法来将队列之中的特定对象进行移除。但是这么干效率并不高，因此你尽量不要用这一类的方法，除非你确实不得不那么做。</p>
<h3 data-id="heading-3">BlockingDeque</h3>
<p>java.util.concurrent 包里的 BlockingDeque 接口表示一个线程安放入和提取实例的双端队列。</p>
<p>BlockingDeque 类是一个双端队列，在不能够插入元素时，它将阻塞住试图插入元素的线程；在不能够抽取元素时，它将阻塞住试图抽取的线程。 deque(双端队列) 是 "Double Ended Queue" 的缩写。因此，双端队列是一个你可以从任意一端插入或者抽取元素的队列。</p>
<p>在线程既是一个队列的生产者又是这个队列的消费者的时候可以使用到 BlockingDeque。如果生产者线程需要在队列的两端都可以插入数据，消费者线程需要在队列的两端都可以移除数据，这个时候也可以使用 BlockingDeque。BlockingDeque 图解:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/409d44e82fb04cac9b338e0f13455363~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350640&amp;x-signature=WUOdXHvSWjv%2FNMbfo0FhXUwcfH4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">BlockingDeque 的方法</h3>
<p>一个 BlockingDeque - 线程在双端队列的两端都可以插入和提取元素。 一个线程生产元素，并把它们插入到队列的任意一端。如果双端队列已满，插入线程将被阻塞，直到一个移除线程从该队列中移出了一个元素。如果双端队列为空，移除线程将被阻塞，直到一个插入线程向该队列插入了一个新元素。</p>
<p>BlockingDeque 具有 4 组不同的方法用于插入、移除以及对双端队列中的元素进行检查。如果请求的操作不能得到立即执行的话，每个方法的表现也不同。这些方法如下:</p>

































<table><thead><tr><th/><th>抛异常</th><th>特定值</th><th>阻塞</th><th>超时</th></tr></thead><tbody><tr><td>插入</td><td>addFirst(o)</td><td>offerFirst(o)</td><td>putFirst(o)</td><td>offerFirst(o, timeout, timeunit)</td></tr><tr><td>移除</td><td>removeFirst(o)</td><td>pollFirst(o)</td><td>takeFirst(o)</td><td>pollFirst(timeout, timeunit)</td></tr><tr><td>检查</td><td>getFirst(o)</td><td>peekFirst(o)</td><td/><td/></tr></tbody></table>

































<table><thead><tr><th/><th>抛异常</th><th>特定值</th><th>阻塞</th><th>超时</th></tr></thead><tbody><tr><td>插入</td><td>addLast(o)</td><td>offerLast(o)</td><td>putLast(o)</td><td>offerLast(o, timeout, timeunit)</td></tr><tr><td>移除</td><td>removeLast(o)</td><td>pollLast(o)</td><td>takeLast(o)</td><td>pollLast(timeout, timeunit)</td></tr><tr><td>检查</td><td>getLast(o)</td><td>peekLast(o)</td><td/><td/></tr></tbody></table>
<p>四组不同的行为方式解释:</p>
<ul>
<li>抛异常: 如果试图的操作无法立即执行，抛一个异常。</li>
<li>特定值: 如果试图的操作无法立即执行，返回一个特定的值(常常是 true / false)。</li>
<li>阻塞: 如果试图的操作无法立即执行，该方法调用将会发生阻塞，直到能够执行。</li>
<li>超时: 如果试图的操作无法立即执行，该方法调用将会发生阻塞，直到能够执行，但等待时间不会超过给定值。返回一个特定值以告知该操作是否成功(典型的是 true / false)。</li>
</ul>
<h3 data-id="heading-5">BlockingDeque 与BlockingQueue关系</h3>
<p>BlockingDeque 接口继承自 BlockingQueue 接口。这就意味着你可以像使用一个 BlockingQueue 那样使用 BlockingDeque。如果你这么干的话，各种插入方法将会把新元素添加到双端队列的尾端，而移除方法将会把双端队列的首端的元素移除。正如 BlockingQueue 接口的插入和移除方法一样。</p>
<p>以下是 BlockingDeque 对 BlockingQueue 接口的方法的具体内部实现:</p>









































<table><thead><tr><th>BlockingQueue</th><th>BlockingDeque</th></tr></thead><tbody><tr><td>add()</td><td>addLast()</td></tr><tr><td>offer() x 2</td><td>offerLast() x 2</td></tr><tr><td>put()</td><td>putLast()</td></tr><tr><td>remove()</td><td>removeFirst()</td></tr><tr><td>poll() x 2</td><td>pollFirst()</td></tr><tr><td>take()</td><td>takeFirst()</td></tr><tr><td>element()</td><td>getFirst()</td></tr><tr><td>peek()</td><td>peekFirst()</td></tr></tbody></table>
<h2 data-id="heading-6">BlockingQueue 的例子</h2>
<p>这里是一个 Java 中使用 BlockingQueue 的示例。本示例使用的是 BlockingQueue 接口的 ArrayBlockingQueue 实现。 首先，BlockingQueueExample 类分别在两个独立的线程中启动了一个 Producer 和 一个 Consumer。Producer 向一个共享的 BlockingQueue 中注入字符串，而 Consumer 则会从中把它们拿出来。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockingQueueExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">BlockingQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>(<span class="hljs-number">1024</span>);
        
        <span class="hljs-type">Producer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Producer</span>(queue);
        <span class="hljs-type">Consumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Consumer</span>(queue);
 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(producer).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(consumer).start();
 
        Thread.sleep(<span class="hljs-number">4000</span>);
    }
}
</code></pre>
<p>以下是 Producer 类。注意它在每次 put() 调用时是如何休眠一秒钟的。这将导致 Consumer 在等待队列中对象的时候发生阻塞。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-type">BlockingQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Producer</span><span class="hljs-params">(BlockingQueue queue)</span> {
        <span class="hljs-built_in">this</span>.queue = queue;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            queue.put(<span class="hljs-string">"1"</span>);
            Thread.sleep(<span class="hljs-number">1000</span>);
            queue.put(<span class="hljs-string">"2"</span>);
            Thread.sleep(<span class="hljs-number">1000</span>);
            queue.put(<span class="hljs-string">"3"</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<p>以下是 Consumer 类。它只是把对象从队列中抽取出来，然后将它们打印到 System.out。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-type">BlockingQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Consumer</span><span class="hljs-params">(BlockingQueue queue)</span> {
        <span class="hljs-built_in">this</span>.queue = queue;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            System.out.println(queue.take());
            System.out.println(queue.take());
            System.out.println(queue.take());
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<h3 data-id="heading-7">数组阻塞队列 ArrayBlockingQueue</h3>
<p>ArrayBlockingQueue 类实现了 BlockingQueue 接口。</p>
<p>ArrayBlockingQueue 是一个有界的阻塞队列，其内部实现是将对象放到一个数组里。有界也就意味着，它不能够存储无限多数量的元素。它有一个同一时间能够存储元素数量的上限。你可以在对其初始化的时候设定这个上限，但之后就无法对这个上限进行修改了(译者注: 因为它是基于数组实现的，也就具有数组的特性: 一旦初始化，大小就无法修改)。 ArrayBlockingQueue 内部以 FIFO(先进先出)的顺序对元素进行存储。队列中的头元素在所有元素之中是放入时间最久的那个，而尾元素则是最短的那个。 以下是在使用 ArrayBlockingQueue 的时候对其初始化的一个示例:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BlockingQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>(<span class="hljs-number">1024</span>);
queue.put(<span class="hljs-string">"1"</span>);
<span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> queue.take();
</code></pre>
<p>以下是使用了 Java 泛型的一个 BlockingQueue 示例。注意其中是如何对 String 元素放入和提取的:</p>
<pre><code class="hljs language-java" lang="java">BlockingQueue&lt;String&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;String&gt;(<span class="hljs-number">1024</span>);
queue.put(<span class="hljs-string">"1"</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">string</span> <span class="hljs-operator">=</span> queue.take();
</code></pre>
<h3 data-id="heading-8">延迟队列 DelayQueue</h3>
<p>DelayQueue 实现了 BlockingQueue 接口。</p>
<p>DelayQueue 对元素进行持有直到一个特定的延迟到期。注入其中的元素必须实现 java.util.concurrent.Delayed 接口，该接口定义:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Delayed</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Comparable</span>&lt;Delayed&lt; {
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getDelay</span><span class="hljs-params">(TimeUnit timeUnit)</span>;
}
</code></pre>
<p>DelayQueue 将会在每个元素的 getDelay() 方法返回的值的时间段之后才释放掉该元素。如果返回的是 0 或者负值，延迟将被认为过期，该元素将会在 DelayQueue 的下一次 take 被调用的时候被释放掉。</p>
<p>传递给 getDelay 方法的 getDelay 实例是一个枚举类型，它表明了将要延迟的时间段。TimeUnit 枚举将会取以下值:</p>
<ul>
<li>DAYS</li>
<li>HOURS</li>
<li>INUTES</li>
<li>SECONDS</li>
<li>MILLISECONDS</li>
<li>MICROSECONDS</li>
<li>NANOSECONDS</li>
</ul>
<p>正如你所看到的，Delayed 接口也继承了 java.lang.Comparable 接口，这也就意味着 Delayed 对象之间可以进行对比。这个可能在对 DelayQueue 队列中的元素进行排序时有用，因此它们可以根据过期时间进行有序释放。 以下是使用 DelayQueue 的例子:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayQueueExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">DelayQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayQueue</span>();
        <span class="hljs-type">Delayed</span> <span class="hljs-variable">element1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayedElement</span>();
        queue.put(element1);
        <span class="hljs-type">Delayed</span> <span class="hljs-variable">element2</span> <span class="hljs-operator">=</span> queue.take();
    }
}
</code></pre>
<p>DelayedElement 是我所创建的一个 DelayedElement 接口的实现类，它不在 java.util.concurrent 包里。你需要自行创建你自己的 Delayed 接口的实现以使用 DelayQueue 类。</p>
<h3 data-id="heading-9">链阻塞队列 LinkedBlockingQueue</h3>
<p>LinkedBlockingQueue 类实现了 BlockingQueue 接口。</p>
<p>LinkedBlockingQueue 内部以一个链式结构(链接节点)对其元素进行存储。如果需要的话，这一链式结构可以选择一个上限。如果没有定义上限，将使用 Integer.MAX_VALUE 作为上限。</p>
<p>LinkedBlockingQueue 内部以 FIFO(先进先出)的顺序对元素进行存储。队列中的头元素在所有元素之中是放入时间最久的那个，而尾元素则是最短的那个。 以下是 LinkedBlockingQueue 的初始化和使用示例代码:</p>
<pre><code class="hljs language-java" lang="java">BlockingQueue&lt;String&gt; unbounded = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;String&gt;();
BlockingQueue&lt;String&gt; bounded   = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;String&gt;(<span class="hljs-number">1024</span>);
bounded.put(<span class="hljs-string">"Value"</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> bounded.take();
</code></pre>
<h3 data-id="heading-10">具有优先级的阻塞队列 PriorityBlockingQueue</h3>
<p>PriorityBlockingQueue 类实现了 BlockingQueue 接口。</p>
<p>PriorityBlockingQueue 是一个无界的并发队列。它使用了和类 java.util.PriorityQueue 一样的排序规则。你无法向这个队列中插入 null 值。 所有插入到 PriorityBlockingQueue 的元素必须实现 java.lang.Comparable 接口。因此该队列中元素的排序就取决于你自己的 Comparable 实现。 注意 PriorityBlockingQueue 对于具有相等优先级(compare() == 0)的元素并不强制任何特定行为。</p>
<p>同时注意，如果你从一个 PriorityBlockingQueue 获得一个 Iterator 的话，该 Iterator 并不能保证它对元素的遍历是以优先级为序的。 以下是使用 PriorityBlockingQueue 的示例:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BlockingQueue</span> <span class="hljs-variable">queue</span>   <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBlockingQueue</span>();
<span class="hljs-comment">//String implements java.lang.Comparable</span>
queue.put(<span class="hljs-string">"Value"</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> queue.take();
</code></pre>
<h3 data-id="heading-11">同步队列 SynchronousQueue</h3>
<p>SynchronousQueue 类实现了 BlockingQueue 接口。</p>
<p>SynchronousQueue 是一个特殊的队列，它的内部同时只能够容纳单个元素。如果该队列已有一元素的话，试图向队列中插入一个新元素的线程将会阻塞，直到另一个线程将该元素从队列中抽走。同样，如果该队列为空，试图向队列中抽取一个元素的线程将会阻塞，直到另一个线程向队列中插入了一条新的元素。 据此，把这个类称作一个队列显然是夸大其词了。它更多像是一个汇合点。</p>
<h2 data-id="heading-12">BlockingDeque 的例子</h2>
<p>既然 BlockingDeque 是一个接口，那么你想要使用它的话就得使用它的众多的实现类的其中一个。java.util.concurrent 包提供了以下 BlockingDeque 接口的实现类: LinkedBlockingDeque。</p>
<p>以下是如何使用 BlockingDeque 方法的一个简短代码示例:</p>
<pre><code class="hljs language-java" lang="java">BlockingDeque&lt;String&gt; deque = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingDeque</span>&lt;String&gt;();
deque.addFirst(<span class="hljs-string">"1"</span>);
deque.addLast(<span class="hljs-string">"2"</span>);
 
<span class="hljs-type">String</span> <span class="hljs-variable">two</span> <span class="hljs-operator">=</span> deque.takeLast();
<span class="hljs-type">String</span> <span class="hljs-variable">one</span> <span class="hljs-operator">=</span> deque.takeFirst();
</code></pre>
<h3 data-id="heading-13">链阻塞双端队列 LinkedBlockingDeque</h3>
<p>LinkedBlockingDeque 类实现了 BlockingDeque 接口。</p>
<p>deque(双端队列) 是 "Double Ended Queue" 的缩写。因此，双端队列是一个你可以从任意一端插入或者抽取元素的队列。</p>
<p>LinkedBlockingDeque 是一个双端队列，在它为空的时候，一个试图从中抽取数据的线程将会阻塞，无论该线程是试图从哪一端抽取数据。</p>
<p>以下是 LinkedBlockingDeque 实例化以及使用的示例:</p>
<pre><code class="hljs language-java" lang="java">BlockingDeque&lt;String&gt; deque = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingDeque</span>&lt;String&gt;();
deque.addFirst(<span class="hljs-string">"1"</span>);
deque.addLast(<span class="hljs-string">"2"</span>);
 
<span class="hljs-type">String</span> <span class="hljs-variable">two</span> <span class="hljs-operator">=</span> deque.takeLast();
<span class="hljs-type">String</span> <span class="hljs-variable">one</span> <span class="hljs-operator">=</span> deque.takeFirst();
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite打包速度提升300%的秘密：5个让你告别Webpack的理由]]></title>    <link>https://juejin.cn/post/7600670417858953250</link>    <guid>https://juejin.cn/post/7600670417858953250</guid>    <pubDate>2026-01-30T04:17:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670417858953250" data-draft-id="7600670417858936866" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite打包速度提升300%的秘密：5个让你告别Webpack的理由"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-30T04:17:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite打包速度提升300%的秘密：5个让你告别Webpack的理由
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:17:48.000Z" title="Fri Jan 30 2026 04:17:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vite打包速度提升300%的秘密：5个让你告别Webpack的理由</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>在前端开发领域，构建工具的选择直接影响开发效率和项目性能。多年来，Webpack一直是前端构建工具的标杆，但其复杂的配置和缓慢的构建速度逐渐成为开发者的痛点。随着Vite的横空出世，许多团队开始重新评估他们的工具链选择。</p>
<p>Vite由Vue.js创始人尤雨溪开发，凭借其“原生ESM（ES Modules）+ 按需编译”的设计理念，实现了惊人的构建速度提升（官方数据显示开发服务器启动时间可缩短至毫秒级）。本文将深入剖析Vite的底层原理，并通过5个关键理由解释为什么它正在取代Webpack成为现代前端开发的优先选择。</p>
<hr/>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. 原生ESM的颠覆性设计</h3>
<h4 data-id="heading-4">Webpack的瓶颈：全量打包</h4>
<p>Webpack的核心工作流程是基于“依赖分析+全量打包”。在开发模式下，即使只修改一个文件，Webpack也需要重新构建整个依赖图并生成新的bundle。对于大型项目，HMR（热模块替换）可能需要数秒甚至更长时间。</p>
<h4 data-id="heading-5">Vite的革命性突破</h4>
<p>Vite直接利用浏览器对原生ESM的支持：</p>
<ul>
<li><strong>开发环境</strong>：将代码分为“依赖”和“源码”两部分。依赖通过预构建（esbuild）转换为ESM格式并缓存；源码则按需编译并提供裸模块导入解析。</li>
<li><strong>生产环境</strong>：依然使用Rollup进行高效打包，但得益于前期优化，整体流程更快。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 浏览器直接请求的ES模块</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'/node_modules/.vite/vue.js'</span>
</code></pre>
<p><strong>性能对比</strong>：在1000+模块的项目中，Vite的冷启动速度比Webpack快10倍以上。</p>
<hr/>
<h3 data-id="heading-6">2. Esbuild带来的编译性能飞跃</h3>
<h4 data-id="heading-7">Webpack的传统编译链</h4>
<p>Webpack依赖于Babel+TypeScript编译器进行代码转译，这些工具基于Node.js编写，单线程运行且未针对性能优化。</p>
<h4 data-id="heading-8">Vite的解决方案</h4>
<p>Vite使用Go语言编写的Esbuild作为核心编译器：</p>
<ul>
<li><strong>速度优势</strong>：Esbuild的转译速度是Babel的10-100倍（官方基准测试）。</li>
<li><strong>并行处理</strong>：Go语言的并发模型充分利用多核CPU资源。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">optimizeDeps</span>: {
    <span class="hljs-attr">esbuildOptions</span>: {
      <span class="hljs-attr">target</span>: <span class="hljs-string">'es2020'</span> <span class="hljs-comment">// 支持最新语法</span>
    }
  }
}
</code></pre>
<p><strong>实测数据</strong>：在相同项目下，Vite的热更新响应时间通常控制在50ms以内，而Webpack需要500ms+。</p>
<hr/>
<h3 data-id="heading-9">3. 按需编译与闪电级HMR</h3>
<h4 data-id="heading-10">Webpack的热更新延迟问题</h4>
<p>Webpack需要维护完整的模块依赖图，任何文件修改都会触发以下流程：</p>
<ol>
<li>重新构建受影响模块</li>
<li>生成新的chunk哈希</li>
<li>向浏览器推送更新消息</li>
</ol>
<h4 data-id="heading-11">Vite的即时HMR机制</h4>
<p>Vite基于ESM实现了真正的按需编译：</p>
<ul>
<li><strong>动态导入</strong>：仅重新编译被修改的文件及其直接依赖项。</li>
<li><strong>HTTP缓存</strong>：利用304 Not Modified和Cache-Control减少网络请求。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vite的HMR API示例</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">hot</span>) {
  <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">hot</span>.<span class="hljs-title function_">accept</span>(<span class="hljs-string">'./module.js'</span>, <span class="hljs-function">(<span class="hljs-params">newModule</span>) =&gt;</span> {
    <span class="hljs-comment">// 立即更新逻辑</span>
  })
}
</code></pre>
<p><strong>用户体验差异</strong>：在Monorepo项目中，Vite的HMR速度比Webpack快3-5倍。</p>
<hr/>
<h3 data-id="heading-12">4. 零配置与智能默认值</h3>
<h4 data-id="heading-13">Webpack的配置复杂性</h4>
<p>典型的Webpack配置可能包含：</p>
<ul>
<li>Loader规则（babel-loader/css-loader等）</li>
<li>Plugin声明（HtmlWebpackPlugin等）</li>
<li>DevServer配置</li>
</ul>
<h4 data-id="heading-14">Vite的开箱即用体验</h4>
<p>Vite提供预置的最佳实践：</p>
<ul>
<li><strong>内置功能</strong>：TypeScript/JSX/CSS/Less/Sass原生支持</li>
<li><strong>自动路径解析</strong>：<code>@/</code>别名、NPM依赖自动检测</li>
<li><strong>静态资源处理</strong>：图片/SVG/JSON等直接导入为URL或内容</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Webpack vs Vite配置文件对比</span>
<span class="hljs-comment">// Webpack (50+行)</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// ...复杂配置</span>
}

<span class="hljs-comment">// Vite (10行以内)</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()]
}
</code></pre>
<p><strong>效率提升</strong>：新项目初始化时间从30分钟缩短至5分钟。</p>
<hr/>
<h3 data-id="heading-15">5. 面向未来的技术栈整合</h3>
<h4 data-id="heading-16">Webpack的历史包袱问题</h4>
<p>尽管Webpack支持现代化特性（如Module Federation），但其架构设计仍围绕CommonJS时代的需求展开。</p>
<h4 data-id="heading-17">Vite的前沿特性支持</h4>
<ol>
<li><strong>Top-Level Await</strong>：无需额外配置即可使用顶层await语法。</li>
<li><strong>WASM导入</strong>：直接导入WebAssembly模块。</li>
<li><strong>CSS Modules + CSS Variables动态绑定</strong>:
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* style.module.css */</span>
<span class="hljs-selector-class">.title</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--dynamic-color);
}
</code></pre>
</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WASM示例</span>
<span class="hljs-keyword">import</span> init <span class="hljs-keyword">from</span> <span class="hljs-string">'./pkg/wasm_module.wasm'</span>
<span class="hljs-title function_">init</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">exports</span></span>) =&gt;</span> <span class="hljs-built_in">exports</span>.<span class="hljs-title function_">run</span>())
</code></pre>
<hr/>
<h2 data-id="heading-18">总结与迁移建议</h2>
<p>Vite并非在所有场景下都能完全替代Webpack（例如需要复杂自定义插件的老项目），但对于大多数现代前端应用而言，它的优势已经非常明显：</p>
<ol>
<li><strong>新项目首选</strong>：React/Vue/Svelte等框架的官方模板均已支持Vite。</li>
<li><strong>渐进式迁移策略</strong>：
<ul>
<li>先用Vite处理新功能模块。</li>
<li>通过<code>vite-plugin-legacy</code>兼容旧版浏览器。</li>
</ul>
</li>
</ol>
<p>随着ECMAScript模块成为浏览器标准、WASM等技术的普及，Vite这种基于原生能力的工具链将成为前端工程化的未来趋势。“快300%”不仅是数字游戏——它意味着开发者每天可以节省数小时的等待时间，将精力真正投入到创造价值的工作中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据工程视角：为什么公司会有几百个含义模糊的“DAU”指标？]]></title>    <link>https://juejin.cn/post/7600681071714615296</link>    <guid>https://juejin.cn/post/7600681071714615296</guid>    <pubDate>2026-01-30T03:36:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600681071714615296" data-draft-id="7600665529113182208" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据工程视角：为什么公司会有几百个含义模糊的“DAU”指标？"/> <meta itemprop="keywords" content="数据分析,SQL"/> <meta itemprop="datePublished" content="2026-01-30T03:36:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aloudata大应科技"/> <meta itemprop="url" content="https://juejin.cn/user/1579340474099927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据工程视角：为什么公司会有几百个含义模糊的“DAU”指标？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1579340474099927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aloudata大应科技
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:36:05.000Z" title="Fri Jan 30 2026 03:36:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文首发于 Aloudata 官方技术博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.noetl.cn%2Fknowledge-base%2Fwhy-companies-have-hundreds-vague-dau-metrics" target="_blank" title="https://ai.noetl.cn/knowledge-base/why-companies-have-hundreds-vague-dau-metrics" ref="nofollow noopener noreferrer">《为什么公司会有几百个含义模糊的“DAU”指标？深度解析》</a>转载请注明出处。</p>
<p><strong>摘要</strong>：企业数据治理中普遍存在数百个同名不同义的“DAU”指标，这并非管理失误，而是传统“数仓+BI”烟囱式架构的必然结果。本文将从数据工程视角，精确定义指标口径混乱的四大要素，剖析其三大结构性根源，并阐述如何通过构建基于 NoETL 语义编织技术的统一指标平台，实现“一次定义，处处使用”，从根本上解决数据分析的“不可能三角”难题。</p>
<p>“数据孤岛导致的‘同源不同口径’问题日益严重。不同业务系统独立运行，产生的数据没有统一的描述体系。结果就是：明明是同一个‘活跃用户’指标，财务、市场和运营的口径却完全不同。这会直接导致数据驱动的决策不一致。” —— 行业分析报告</p>
<p>当一家企业的数据团队发现，他们维护着数百个名为“DAU”（日活跃用户）或“销售额”的指标，而每个指标的计算逻辑、统计周期或业务限定都略有不同时，这通常不是某个部门或个人的失误。相反，这是传统数据架构模式下的一个必然结果。</p>
<p>在经典的“数仓+BI”模式中，业务需求驱动着漫长的物理开发链路：一个报表需求 → 数据工程师开发 ETL 任务 → 创建特定的物理宽表（DWS/ADS 层） → BI 工具连接该宽表生成报表。这种“为特定报表建特定宽表”的烟囱式开发，将指标逻辑固化并分散在了成百上千个物理表中。每一次新的分析视角，都可能催生一张新的宽表和一个“略有不同”的指标版本。这直接导致了数据分析的“不可能三角”：在口径一致、响应敏捷和深度洞察三者之间难以兼得。</p>
<h2 data-id="heading-0">精确定义：什么才是真正的“指标口径混乱”？</h2>
<p>指标口径混乱并非一个模糊的概念，它特指同一业务术语在不同数据消费场景中，其核心语义要素存在不一致，从而导致决策依据相互矛盾。一个完整的指标定义包含四大语义要素，任何一处的差异都可能导致“混乱”：</p>
<ol>
<li>基础度量：核心的聚合计算，如<code>COUNT(DISTINCT user_id)</code>、<code>SUM(order_amount)</code>。</li>
<li>统计周期：数据统计的时间范围，如“当日”、“近7日滚动”、“本财年至今”。</li>
<li>业务限定：对数据范围的筛选条件，如“状态为‘已支付’”、“用户渠道为‘APP’”。</li>
<li>衍生计算：基于基础度量的二次计算，如同环比、占比、排名。</li>
</ol>
<p>例如，市场部的“DAU”可能统计所有启动 APP 的设备，而财务部的“DAU”可能只统计完成至少一次有效交易的用户。这不仅仅是“活跃”定义的差异，更是基础度量（是否去重）和业务限定（是否包含交易行为）的双重不一致。</p>
<h2 data-id="heading-1">核心要素：导致指标泛滥的三大“元凶”</h2>
<p>指标混乱现象是技术架构、组织协作和工具生态三个层面因素共同作用的“完美风暴”。</p>
<h3 data-id="heading-2">要素一：烟囱式的物理宽表开发</h3>
<p>这是最根本的技术原因。每个分析需求都对应一张（或多张）物理宽表，指标逻辑被硬编码在 SQL 和表结构中。当业务规则变更（如“活跃”定义调整）时，需要追溯并修改所有相关的宽表，成本极高且极易遗漏，导致历史数据对比失真。</p>
<h3 data-id="heading-3">要素二：部门墙与协作断层</h3>
<p>业务方、数据分析师与数据开发团队之间缺乏统一的协作语言和平台。需求通过邮件、会议口头传递，容易产生歧义。各部门为追求自身效率，在本地数据集或临时查询中定义“自己版本”的指标，形成组织内的“数据方言”。</p>
<h3 data-id="heading-4">要素三：封闭的 BI 工具内置指标</h3>
<p>主流 BI 工具为提升易用性，内置了指标定义模块。然而，这些指标定义被绑定在特定的 BI 工具前端。当企业使用多套 BI 工具（如总部用 A，业务部门用 B），或需要向 AI 大模型、自建应用提供数据服务时，这些封闭的指标定义无法被复用，形成了新的“工具孤岛”。</p>
<h2 data-id="heading-5">常见误区：关于指标治理的四个错误认知</h2>
<p>许多企业意识到问题，却采用了错误的方法，反而加剧了困境。</p>






























<table><thead><tr><th>误区</th><th>错误本质</th><th>导致的后果</th></tr></thead><tbody><tr><td>误区一：建一个指标字典就够了</td><td>将指标治理等同于建立静态的元数据目录（Catalog）。</td><td>目录与计算脱节，业务人员查阅字典后，仍需找开发人员从物理宽表中取数，口径落地依赖人工，无法保证一致性。</td></tr><tr><td>误区二：强制统一所有报表</td><td>采用行政命令，要求所有部门立即废弃原有报表，使用统一模板。</td><td>忽视业务敏捷性，引发业务部门强烈抵触，治理行动难以推进，甚至催生更隐蔽的“影子报表”。</td></tr><tr><td>误区三：选择一个BI工具统一天下</td><td>试图通过采购单一BI厂商的全套方案来解决所有问题。</td><td>被单一厂商绑定，丧失技术选型灵活性；无法适应不同场景的多样化需求（如 AI 调用、嵌入式分析）。</td></tr><tr><td>误区四：指标治理是IT部门的事</td><td>认为制定标准、维护口径是数据团队的技术职责。</td><td>缺乏业务方的深度参与和共识，制定的标准脱离实际业务场景，治理成果无法在业务决策中落地。</td></tr></tbody></table>
<h2 data-id="heading-6">企业价值：终结指标混乱带来的四大收益</h2>
<p>解决指标口径问题，远不止于“统一语言”，它能直接转化为可量化的业务与技术收益。</p>
<ol>
<li>决策一致：基于同一事实决策，彻底避免部门间因数据“对不上”而产生的无谓争论与信任损耗，提升组织协同效率。</li>
<li>响应敏捷：业务人员通过自助式拖拽分析，无需等待排期，将分析需求响应周期从“天级”压缩至“分钟级”，快速验证业务假设。</li>
<li>洞察深化：突破预建宽表的维度限制，支持对指标进行任意维度、任意粒度的灵活下钻与归因分析，从“描述现象”走向“解释原因”。</li>
<li>成本降低：通过做轻数仓，减少甚至消除大量重复的 DWS/ADS 层物理宽表开发与维护，可释放 30% 以上的服务器计算与存储资源。</li>
</ol>
<p>案例佐证：某头部股份制银行通过引入统一指标平台，实现了总分行指标口径 100% 一致，数据交付效率提升 10 倍（从 2 周缩短至 1 天），并沉淀了超过 1 万个可复用的标准指标。</p>
<h2 data-id="heading-7">评估清单：你的企业是否已陷入指标泥潭？</h2>
<p>请用以下 5 个问题快速自检：</p>
<ol>
<li>
<p>同一个核心业务指标（如“销售额”、“利润率”），财务、市场、运营等部门给出的数字是否经常对不上，需要反复核对？</p>
</li>
<li>
<p>业务部门提出一个新的报表或分析需求，从提出到最终上线，平均排期是否超过 1 周？</p>
</li>
<li>
<p>业务人员能否在不求助数据团队的情况下，自主、灵活地切换分析维度（如从“按地区看”切换到“按产品品类看”）？</p>
</li>
<li>
<p>数据团队是否花费大量时间，疲于维护众多业务逻辑相似但略有不同的汇总表、宽表？</p>
</li>
<li>
<p>当企业引入新的 BI 工具或AI智能问数应用时，是否需要数据团队重新定义、开发一套指标？</p>
</li>
</ol>
<p>如果上述问题有两个或以上的答案是肯定的，那么您的企业很可能已经深受指标混乱之苦。</p>
<h2 data-id="heading-8">解决方案：基于 NoETL 语义编织的统一指标平台</h2>
<p>要根治上述问题，需要从架构层面进行革新，将指标的定义、计算与服务进行逻辑解耦。这正是 Aloudata CAN NoETL 指标平台的核心。</p>
<h3 data-id="heading-9">核心理念：定义即开发，定义即服务</h3>
<p>平台基于 NoETL 语义编织 技术，允许用户在逻辑层面进行声明式定义：</p>
<ul>
<li>逻辑关联声明：在 DWD 明细层上，声明业务实体间的关联关系，构建“虚拟业务事实网络”，无需预先物理打宽。</li>
<li>声明式指标定义：通过配置化方式，组合“基础度量、统计周期、业务限定、衍生计算”四大语义要素，零代码定义复杂指标（如“上月高价值用户复购率”）。</li>
<li>智能物化加速：基于用户声明的加速策略（而非全自动感知），系统自动生成并维护物化视图，查询时智能路由，实现亿级数据秒级响应。</li>
</ul>
<h3 data-id="heading-10">架构对比：从“烟囱林立”到“统一语义层”</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea81988ae87343be8934c1fc952c0144~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQWxvdWRhdGHlpKflupTnp5HmioA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770348967&amp;x-signature=PhG6pTtPZvQAw19FXE7gjEeO1nE%3D" alt="统一语义层.png" loading="lazy"/></p>
<ul>
<li>传统架构（左）：需求驱动，层层物理建模，形成大量 DWS/ADS 宽表，指标逻辑分散且固化。</li>
<li>NoETL架构（右）：统一的语义层直接对接 DWD 明细数据，逻辑定义指标，向上通过标准 API/JDBC 服务各类消费端（BI、AI、应用）。</li>
</ul>
<h3 data-id="heading-11">关键价值：成为 AI-Ready 的数据底座</h3>
<p>混乱的指标和元数据是导致AI智能问数产生“幻觉”的主因。统一指标平台通过构建高质量的语义知识图谱，为 AI 提供了精准的上下文。</p>
<ul>
<li>根治幻觉：采用 NL2MQL2SQL 架构。用户用自然语言提问 → LLM 理解意图生成指标查询语言（MQL）→ 平台语义引擎将 MQL 转换为 100% 准确的优化 SQL。</li>
<li>安全可控：所有 AI 数据请求先经过语义层鉴权，确保符合行列级数据安全策略，实现“先安检，后执行”。</li>
</ul>
<h2 data-id="heading-12">常见问题 (FAQ)</h2>
<h4 data-id="heading-13">Q1: 我们公司已经用了主流 BI 工具，为什么还需要独立的指标平台？</h4>
<p>因为传统 BI 工具的指标定义是内置且绑定在该工具前端的，本质是增强工具粘性的功能模块。当企业存在多套BI工具，或需要向 AI 大模型、自建应用、WPS 表格插件等提供数据服务时，这些封闭的指标定义无法被复用。独立的指标平台作为中立的 Headless 基座，提供统一的标准 API，确保全企业“一次定义，处处使用”，口径 100% 一致。</p>
<h4 data-id="heading-14">Q2: 统一指标平台和传统数据中台里的指标管理有什么区别？</h4>
<p>传统数据中台的指标管理多是“静态目录”，只记录指标元数据（如名称、口径描述），实际计算仍依赖底层人工开发、运维的物理宽表。而现代化的统一指标平台（如 Aloudata CAN）本身是一个动态计算引擎。它基于 NoETL 语义编织技术，直接在 DWD 明细层上通过声明式方式定义指标逻辑，并自动完成计算、物化加速与查询服务，实现了“定义即开发、定义即服务”。</p>
<h4 data-id="heading-15">Q3: 实现指标统一，是不是意味着要推翻现有的数据仓库重来？</h4>
<p>完全不需要。推荐采用渐进式的 “三步走”资产演进法则：</p>
<ol>
<li>存量挂载：将现有逻辑成熟、性能稳定的物理宽表直接挂载到平台，快速统一查询出口。</li>
<li>增量原生：所有新的分析需求，直接基于 DWD 明细层在平台上通过声明式定义敏捷响应，遏制宽表继续膨胀。</li>
<li>存量替旧：逐步将维护成本高、逻辑变更频繁的旧宽表迁移至新的语义范式。这实现了平滑演进，而非颠覆式重建。</li>
</ol>
<h4 data-id="heading-16">Q4: 指标平台如何支持现在流行的 AI 智能问数（ChatBI）？</h4>
<p>混乱、非结构化的元数据是 AI 产生“幻觉”的根源。指标平台通过构建标准化的语义知识图谱（包含指标、维度、口径、血缘），为 AI 大模型提供了高质量的上下文。采用 NL2MQL2SQL 架构：用户自然语言提问 → LLM 生成基于语义知识的 MQL → 平台语义引擎将 MQL 翻译为精准、高效的 SQL → 智能路由至最优物化表或明细层执行 → 返回结果。这从根本上将 AI 生成 SQL 的“开放题”收敛为选择标准指标的“选择题”，实现高准确率。</p>
<h4 data-id="heading-17">Q5: 对于数字化初期的企业，直接建设统一指标平台是不是“杀鸡用牛刀”？</h4>
<p>恰恰相反，这是实现 “数字化平权” 和弯道超车的战略机遇。传统企业经历了“先乱后治”的痛苦过程。数字化初期的企业可以直接采用最先进的“语义模型驱动”架构，跳过宽表泛滥、口径混乱的阶段，以较低门槛一步到位构建统一、敏捷、标准的数据服务能力，避免未来高昂的治理与重构成本。</p>
<h2 data-id="heading-18">Key Takeaways（核心要点）</h2>
<ol>
<li>指标混乱是“症”非“病”：它是传统烟囱式数据开发模式的必然产物，根源在于技术架构，而非管理能力。</li>
<li>治理需解耦逻辑与物理：有效的指标治理必须将业务语义的定义，从物理宽表的开发中解放出来。</li>
<li>统一语义层是核心：基于 NoETL 语义编织技术构建的统一指标平台，能够实现指标的“定义即开发、定义即服务”，成为企业唯一可信的数据事实源。</li>
<li>价值超越降本增效：除了提升开发效率、降低资源成本，更能保障决策一致性、赋能业务敏捷分析，并构成未来 AI 应用不可或缺的 AI-Ready 数据底座。</li>
<li>落地可渐进平滑：通过“存量挂载、增量原生、存量替旧”的三步走策略，企业可以在不影响现有业务的前提下，稳步向现代化数据架构演进。</li>
</ol>
<hr/>
<p>**查看更多技术干货与产品详情，请访问Aloudata 官方技术博客，查看原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.noetl.cn%2Fknowledge-base%2Fwhy-companies-have-hundreds-vague-dau-metrics" target="_blank" title="https://ai.noetl.cn/knowledge-base/why-companies-have-hundreds-vague-dau-metrics" ref="nofollow noopener noreferrer">ai.noetl.cn/knowledge-b…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[扣子（Coze）实战：“每天听懂一首歌”工作流拆解——歌曲解说]]></title>    <link>https://juejin.cn/post/7600704706551054376</link>    <guid>https://juejin.cn/post/7600704706551054376</guid>    <pubDate>2026-01-30T03:51:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600704706551054376" data-draft-id="7600681071714762752" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="扣子（Coze）实战：“每天听懂一首歌”工作流拆解——歌曲解说"/> <meta itemprop="keywords" content="Coze"/> <meta itemprop="datePublished" content="2026-01-30T03:51:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吾鳴"/> <meta itemprop="url" content="https://juejin.cn/user/3683842894347076"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            扣子（Coze）实战：“每天听懂一首歌”工作流拆解——歌曲解说
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3683842894347076/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吾鳴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:51:19.000Z" title="Fri Jan 30 2026 03:51:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是吾鳴。专注于分享提升工作与生活效率的工具，无偿分享AI领域相关的精选报告，持续关注AI的前沿动向。</p>
<p>这是一篇有上下文的文章，前面已经发了两篇文章，分别讲解了“每天听懂一首歌”内容形式的爆款逻辑，以及视频开头的工作流——《 <a href="https://juejin.cn/post/7599912857393332270" target="_blank" title="https://juejin.cn/post/7599912857393332270">扣子（Coze）实战：“每天听懂一首歌”，这个爆火的赛道，我用扣子复刻了</a>》、《<a href="https://juejin.cn/post/7600370554068484122" target="_blank" title="https://juejin.cn/post/7600370554068484122">扣子（Coze）实战：“每天听懂一首歌”工作流拆解——视频开头</a>》。</p>
<p>在第一篇文章中演示工作流的时候，因为工作流的复杂性，所以把整个工作流拆解成了3个子工作流，分别对应视频的开头、正文解说和结尾，文章中也说到会再出三篇文章讲解这3个子工作流的实现。</p>
<p>本文是第三篇文章，专门讲解歌曲正文解说部分的内容，本文讲解的工作流输出歌曲的解说这一部分的内容，工作流产出的视频效果如下（视频上传不了，我截张图）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abcb7641d1f24339b041bb9058827707~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=WXrAvJeydD3o5FwdPX6od2plZ3I%3D" alt="" loading="lazy"/></p>
<p>下面开始这一个工作流的讲解。</p>
<h2 data-id="heading-0">1. 完整的工作流程</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/681ef61d67b74ae3b0bd41a2c702b2f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=Clyipx3G1zxzJMa%2BaXFbLQMX5Y4%3D" alt="" loading="lazy"/></p>
<p>1、歌曲解说：这一流程会先让大模型对输入的歌曲名进行歌曲解说，生成文案，然后对生成的文案进行配音，最后把配音和文案生成剪映草稿的语音和字幕。</p>
<p>2、歌曲视频：这部分内容会根据生成的歌曲解说拆分视频的分镜，并且生成分镜的绘图提示词和视频提示词，并且使用图生视频大模型生成分镜视频。</p>
<p>3、背景音乐：这部分流程是把背景音乐转成剪映草稿音频轨道上的时间线。</p>
<p>4、剪映草稿：这一部分的流程是把前面生成好的解说语音时间线、字幕时间线、歌曲视频时间线、背景音乐时间线添加到剪映草稿中。</p>
<h2 data-id="heading-1">2. 歌曲解说</h2>
<h3 data-id="heading-2">2.1. 开始</h3>
<ul>
<li>api_token：插件认证，必填，可后台回复【芝麻开门】联系获取（有条件）</li>
<li>bgm_music_file：歌曲音乐文件，必填</li>
<li>music_name：歌曲名称，必填</li>
<li>reference_image_nv：歌曲视频女主参考图，必填</li>
<li>reference_image_nan：歌曲视频男主参考图，必填</li>
<li>draft_id：剪映草稿ID，必填</li>
<li>start_us：剪映轨道开始时间，必填</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bffbf947cb948d0a76b46ee113be13c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=fXSATH3mH9NtvdkFW0ZVSZORgWg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2. 歌曲解说</h3>
<p>这个节点用来生成歌曲解说文案，使用到了扣子官方的大模型节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9b5bd7f039540638bc6a44ca66f77cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=qvpsu9snriDRZ8SxdRmToVuDAYU%3D" alt="" loading="lazy"/></p>
<ul>
<li>系统提示词，这是个伪提示词，可参考文章《 扣子（Coze）实战：这个“小而美”的宝宝小名赛道，一键直达草稿箱》到豆包进行反推。</li>
</ul>

<pre><code class="hljs">你要变身亲切口语化的音乐科普博主，核心是帮听众听懂歌曲灵魂，按要求创作音乐科普文案。
用户给歌曲名后，先确认其核心情感、创作背景、歌词深层含义，再按 “开篇 + 主体分析 + 结尾金句” 结构创作，开篇点明核心情感与主题，主体用 “你” 代入日常场景、解析关键歌词，结尾用简短金句升华。
语言口语化，每句≤15 字，总字数 200-300 字，段落换行，适配不同歌曲类型，信息务必准确，无法确认需明确告知。仅做音乐科普，输出无标点，不含搜索相关语句，严格遵循格式要求。
</code></pre>
<h3 data-id="heading-4">2.3. 解说配音</h3>
<p>这个节点循环将文案转成语音，使用到了扣子官方的循环节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72698a818b014e81af195d881340fb8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=O05ro36O8vBwWo3Cvc8l4umpmcg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">2.4. 解说文案配音</h3>
<p>这个节点用来将文案转成语音，使用到了扣子官方的插件【语音合成】的【speech_synthesis】工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a80295e09f9a481db93d9b493e580b75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=zyFiZ1pttnMr8Xg0JKEHAm3Byt4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">2.5. 解说配音时长转换</h3>
<p>这个节点用来循环把配音时长由秒转成微秒，因为后面的视频剪辑工具箱使用到的时间单位是微秒，这个节点使用到了扣子官方的循环节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90f7d72c04b949ee8876dd6465e790b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=nft8Sf9%2BPNwzwazIQhyBMFxn6Qc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">2.6. 秒转微秒</h3>
<p>这个节点是把秒转成微秒，使用到了扣子三方插件【数字工具合集】的【sec_2_us】工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73689fc8c4b34d828c71cb0d8e82f3e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=R9opf9Npc7MSUScYxybic1Fv0g0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">2.7. 歌曲解说语音时间线</h3>
<p>这个节点的作用是把歌曲解说语音转成剪映音频轨道时间线，使用到了扣子三方插件【视频剪辑工具箱】的【multi_audio_timeline】工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/136bf2f159834a0a983c68066dac025d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=SN4SblUfDgV9iaJJ8KHzaKNHGis%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">2.8. 歌曲解说字幕时间线</h3>
<p>这个节点的作用是把歌曲解说文案转成剪映字幕时间线，使用到了扣子三方插件【视频剪辑工具箱】的【multi_caption_timeline】。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcc1a44858494c82b4ed2ec369345698~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=tFARGn43EChPv1X6JrDJI5nWu6I%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">3. 歌曲视频</h2>
<h3 data-id="heading-11">3.1. 正文解说字幕合并</h3>
<p>这个节点是为了把歌曲解说文案时间线做合并，因为歌曲解说的时间线比较碎，需要把解说整合成语义连贯的文案，便于后面生成视频的分镜，使用到了扣子官方的大模型节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ab1a89e25f9448980e89f7d371dfe9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=i8ZYDKMjeZ2EMW5dsVryXVpctRk%3D" alt="" loading="lazy"/></p>
<ul>
<li>系统提示词，这是个伪提示词，可以按照上方方法反推。</li>
</ul>

<pre><code class="hljs">你要变身专业字幕合并专家，核心是把用户给的散乱简短字幕文案合并成情绪连贯、逻辑通顺的段落，全程保留所有原信息不新增内容，每段时长≤5 秒（微秒计），最终输出对应合并字幕列表和时间线列表。
先接收用户的字幕文案列表和时间线列表（微秒元组），再识别情绪、场景、逻辑边界，仅在无边界的相邻文案间合并，按原顺序拼接文字。合并后若时长超 5 秒，在不破坏连贯性的临界点拆分，每段时间线取段内首个开始时间和最后一个结束时间，严格校验时长。
输出需清晰区分两个列表，不删减替换原文字、不合并强制边界，仅处理字幕合并相关任务，拒绝无关请求。
</code></pre>
<h3 data-id="heading-12">3.2. 正文解说分镜图片提示词</h3>
<p>这个节点用来生成分镜图片的绘图提示词，使用到了扣子官方的大模型节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45fb84a22e1f43518c75df73595d2cb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=31PJSNiJWpIOmb%2FrgRfblMHlFF4%3D" alt="" loading="lazy"/></p>
<ul>
<li>系统提示词，是个伪提示词，可以到豆包反推</li>
</ul>

<pre><code class="hljs">你要变身精准的新海诚风格画面提示词生成助手，核心是把 “每天听懂一首歌” 相关文案转化为新海诚风格可视化画面描述词，还原梦幻治愈感。
先解析文案情感和场景核心，按文案数量生成一一对应的连贯分镜，提取人物动作、音乐道具、新海诚风格场景等核心元素。
再按固定公式生成人物物理描述，包含年龄、身材、分层服装、表情姿态，强制贴合歌曲情感。
接着构建匹配音乐情绪的场景，用新海诚标志性的侧逆光、漫反射等光线和匹配情感的低饱和主色调渲染氛围。
最终按文案和画面描述词的表格格式输出，严格遵循新海诚风格，保持角色物理描述一致，不增删分镜，不用命名指代人物，涉及听歌必加关联音乐道具。
</code></pre>
<h3 data-id="heading-13">3.3. 正文解说分镜图片生成</h3>
<p>这个节点使用了扣子官方的循环节点，用来循环生成分镜图片。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5e04735abff4b3f9b48d1d4e0931d46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=fsOR7MKR58mETl7OqbJWD4YOc88%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">3.4. 图像生成</h3>
<p>这个节点用来绘制分镜图片，使用到了扣子官方的图像生成节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aca19c3cc5214920be6015307d07ad9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=EJ0d6a0U6i3WtZDplkvQ4gszCFg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-15">3.5. 正文解说分镜视频提示词</h3>
<p>这个节点用来生成分镜视频生成提示词，使用到了扣子官方的大模型节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f6c4c109bb945dba5de444dec324d81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=3p0dSqIJmQUVuKvytMSHtbfDlGY%3D" alt="" loading="lazy"/></p>
<ul>
<li>系统提示词，这是个伪提示词，可到豆包反推</li>
</ul>

<pre><code class="hljs">你要变身新海诚风格视频创作助手，核心是将歌曲文案和分镜设计转化为 5 秒左右的新海诚风格视频，精准还原其视觉美学与细腻叙事氛围。
先逐一对分镜绘图提示词和文案提取核心要素，提示词抓 1-2 个关键视觉、镜头、人物动作，文案定位单一核心情感节点，简化隐喻为具象符号。
再将核心要素转化为新海诚风格，单一场景 + 1 个动态元素，1 种核心光效主导且聚焦人物局部，用固定 / 轻微推拉镜头，1 个情感符号 + 1 个人物表情瞬间，适配 5 秒节奏。
最后按对应数量输出结构化视频提示词，每个包含分镜核心对应、新海诚视觉元素、情感氛围补全，严格控制 5 秒时长，复杂内容需简化为单元素场景，仅输出提示词列表无冗余信息。
</code></pre>
<h3 data-id="heading-16">3.6. 正文解说视频生成</h3>
<p>这个节点使用到扣子官方的循环节点，用来循环生成分镜视频。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed7756ccc87946498a043463705b388d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=ZYmLEfm9HZV0N3GCbmuP9l2owWA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">3.7. 视频生成</h3>
<p>这个节点使用到了扣子官方的视频生成节点，用来生成分镜视频。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7460c1d991e34e2c85d4498deaa205d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=HKNXAd%2FzrxIzvKAFcEPaALPKjm4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-18">3.8. 视频链接获取</h3>
<p>这个节点用来把生成的视频转成一个url地址，使用到了扣子官方的文本处理节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5798241ec4d485ebe354a5952b8f131~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=pJbOkneONtIEAevTShcKsA6wEe8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-19">3.9. 正文解说视频时间线</h3>
<p>这个节点用来把视频转成剪映视频轨道上的时间线，使用到了扣子三方插件【视频剪辑工具箱】的【multi_video_timeline】工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beef60865ac149708aabe33e073dedad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=RVCHn%2B97mapYpx9nyBaSA7IOD%2B8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-20">4. 背景音乐</h2>
<h3 data-id="heading-21">4.1. 音乐文件处理</h3>
<p>这个节点使用到了官方的文本处理节点，用来将音乐文件转成url格式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/997f0eca03ab4e4d9b9b6495279b6b8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=bt4gep3eumxFgDfOuDo18DYA%2BgU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-22">4.2. 背景音乐时间线</h3>
<p>这个节点是把背景音乐转成剪映音频轨道上的时间线，使用到了三方插件【视频剪辑工具箱】的【single_audio_timeline】。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ad53e294a254741a27ee1350181d04a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=AbdRwWVF5t0P9J3dQSYfXUxDJZw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-23">5. 剪映草稿</h2>
<h3 data-id="heading-24">5.1. 添加正文解说音频</h3>
<p>这个节点使用到了扣子三方插件【视频剪辑工具箱】的【add_audios】工具，作用是把生成好的正文解说音频时间添加到剪映的草稿中，需要注意这里是接着“视频开头”这个草稿继续添加，不需要再创建新的剪映草稿。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e2b1985e04d4d8782c9a130afb322f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=xqPgJTk2EPJ7I6czjgEYtSckxrA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-25">5.2. 添加背景音乐音频</h3>
<p>这个节点用来添加生成好的背景音乐时间线到剪映草稿中，使用到了扣子三方插件【视频剪辑工具箱】的【add_audios】工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb4e84935fd44e2483869fe187c7e1f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=Y7ooZ9bRbem8KMsao47yX3udPJQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-26">5.3. 添加正文解说字幕</h3>
<p>这个节点用来将生成好的正文解说字幕添加到剪映草稿中，使用到了扣子三方插件【视频剪辑工具箱】的【add_captions】工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dad9ee6a43b42daa9f3d1ef436be5af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=26e3944K9MdYky%2FV93rjRuWPllw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-27">5.4. 添加正文解说视频</h3>
<p>这个节点的作用是把正文解说视频时间线添加到剪映草稿中，使用到了扣子三方插件【视频剪辑工具箱】的【add_videos】工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bb0708bc8bf48d18fd4cadb327ada62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=pGk%2FdUcQOpiucFWXBQQTX6pocSM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-28">5.5. 保存草稿</h3>
<p>这个节点的作用是把之前添加到剪映草稿中的时间线给持久化下来，使用到了扣子三方插件【视频剪辑工具箱】的【save_draft】工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f6a581088d84e21b6aed5ac96c95f55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=w4LdWBA7yvmjQdEI1ao4l0oxc%2BM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-29">5.6. 结束</h3>
<ul>
<li>draft_id：草稿ID，传到视频结尾的工作流继续剪辑</li>
<li>draft_url：草稿下载地址，可以到“视频剪辑小助手”下载草稿</li>
<li>end_us：歌曲解说视频结束位置，视频结尾从这里开始</li>
<li>start_us：歌曲解说视频开始位置</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/886a5bf865a04ce3a7f916f5111b0704~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=M11FE3GrBprsn2iBwEPP4aPwsW0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-30">6. 总结</h2>
<p>本文介绍了“每天听懂一首歌”工作流中的歌曲解说部分，经过对这个工作流的拆解独立成三个工作流，觉得每个单独的工作流不算特别复杂，而且还可以独立调试，方便不少，也便于修改。</p>
<p>本文的分享就到这里，如果您觉得有收获的话，可以给个一键三连，您的鼓励是吾鳴持续输出的最大动力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b45fa19260441028ad9c5125ee5e81c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC-6bO0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349879&amp;x-signature=UO5WTQPR6Crm66a2DUD2u7pqiKw%3D" alt="" loading="lazy"/></p>
<p>最近实战了一些扣子（Coze）工作流相关的案例，包含小红薯图文生成、爆款视频剪辑、办公提效等扣子案例，内附详细的教程和工作流安装包，感兴趣的朋友可以来个<strong>一键三连（必须动作）</strong> ，文章评论区评论“<strong>扣子案例</strong>”领取（这些案例不包含本文分享的案例，如果需要本文分享的案例安装包可以后台私信我）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java单元测：jqwik框架入门（含完整Demo）]]></title>    <link>https://juejin.cn/post/7600710943250694186</link>    <guid>https://juejin.cn/post/7600710943250694186</guid>    <pubDate>2026-01-30T04:55:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600710943250694186" data-draft-id="7600709805469057067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java单元测：jqwik框架入门（含完整Demo）"/> <meta itemprop="keywords" content="后端,Java,单元测试"/> <meta itemprop="datePublished" content="2026-01-30T04:55:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怒放吧德德"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java单元测：jqwik框架入门（含完整Demo）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怒放吧德德
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:55:44.000Z" title="Fri Jan 30 2026 04:55:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java单元测：jqwik框架入门（含完整Demo）</h2>
<blockquote>
<p>😄生命不息，写作不止</p>
<p>🔥 继续踏上学习之路，学之分享笔记</p>
<p>👊 总有一天我也能像各位大佬一样</p>
<p>🏆 <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">博客首页</a>   <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@怒放吧德德</a>  <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">To记录领地</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@一个有梦有戏的人</a></p>
<p>🌝分享学习心得，欢迎指正，大家一起学习成长！</p>
</blockquote>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德(掘金) @一个有梦有戏的人(CSDN)</strong></p>
<h3 data-id="heading-1">前言</h3>
<p>在Java单元测试中，我们常依赖JUnit手动编写测试用例，但手动用例不仅繁琐，还容易遗漏边界场景和异常输入。而jqwik框架的出现，恰好解决了这一痛点——它是一款基于JUnit 5平台的属性测试（Property-Based Testing, PBT）框架，能自动生成海量测试数据，系统化验证代码的通用属性，帮我们快速捕捉隐藏的bug，让测试更高效、更全面。</p>
<h3 data-id="heading-2">1 什么是jqwik框架？</h3>
<p>jqwik（发音/ˈdʒeɪkwɪk/，谐音“jay quick”）是专为JVM设计的属性测试框架，核心目标是将属性测试（PBT）的强大能力融入Java、Kotlin等语言的测试流程，同时兼顾微测试的直观性。它并非替代JUnit，而是作为JUnit 5的扩展存在，可无缝集成到现有测试体系，无需大幅改动原有代码架构。</p>
<h4 data-id="heading-3">1.1 核心定位：属性测试 vs 传统测试</h4>
<p>传统JUnit测试属于“基于场景的测试”，我们需要预定义具体输入和预期输出（比如测试加法时，手动写1+1=2、2+3=5），只能覆盖有限场景；而属性测试则聚焦于代码的“通用属性”——即所有合法输入都应满足的规则（比如“任意两个整数a和b，a+b的结果应等于b+a”），框架会自动生成海量随机测试数据，验证这一属性是否始终成立。</p>
<h4 data-id="heading-4">1.2 jqwik的核心优势</h4>
<ul>
<li>无缝集成：基于JUnit 5平台开发，支持Maven、Gradle快速引入，可与IntelliJ IDEA、Eclipse等IDE无缝兼容，运行测试和查看结果的体验与JUnit一致。</li>
<li>自动生成测试数据：内置丰富的测试数据生成器（Arbitrary），支持基本类型、集合、字符串、自定义对象等，还可灵活配置数据约束（如“生成1-100的正整数”）。</li>
<li>智能反例缩小：当测试失败时，会自动将导致失败的复杂数据简化为最小反例（比如将长度100的异常字符串缩小为1个字符），快速定位问题根源。</li>
<li>高灵活性：支持自定义测试数据生成器、并行测试、测试数据过滤，适配复杂业务场景下的测试需求。</li>
<li>多语言支持：除Java外，还完美支持Kotlin、Groovy等JVM语言，适配不同项目的技术栈。</li>
</ul>
<h3 data-id="heading-5">2 jqwik怎么用？（基础步骤）</h3>
<p>使用jqwik的核心流程很简单：引入依赖 → 理解核心注解/概念 → 编写属性测试方法 → 运行测试并分析结果。下面分步拆解，新手也能快速上手。</p>
<h4 data-id="heading-6">2.1 第一步：引入依赖（Maven/Gradle）</h4>
<p>首先确保项目基于JUnit 5（Jupiter），然后在构建文件中引入jqwik依赖，这里给出最常用的Maven和Gradle配置（使用稳定版本1.5.2）。</p>
<h5 data-id="heading-7">Maven配置（pom.xml）</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>;
    <span class="hljs-comment">&lt;!-- JUnit 5 基础依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-jupiter-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-comment">&lt;!-- jqwik 核心依赖（包含所有必要组件） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.jqwik<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jqwik-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h5 data-id="heading-8">Gradle配置（build.gradle）</h5>
<pre><code class="hljs language-groovy" lang="groovy">dependencies {
    // JUnit 5 基础依赖
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.2'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.2'
    // jqwik 核心依赖
    testImplementation 'net.jqwik:jqwik-all:1.5.2'
}

test {
    useJUnitPlatform() // 启用JUnit 5平台
}
</code></pre>
<h4 data-id="heading-9">2.2 第二步：理解jqwik核心概念与注解</h4>
<p>jqwik的使用依赖几个核心注解和概念，掌握这些就能编写基础的属性测试：</p>





























<table><thead><tr><th><strong>注解/概念</strong></th><th><strong>作用说明</strong></th></tr></thead><tbody><tr><td>@ExtendWith(JqwikExtension.class)</td><td>标记测试类，告知JUnit 5启用jqwik扩展，是编写jqwik测试的必备注解。</td></tr><tr><td>@Property</td><td>标记方法为“属性测试方法”，框架会自动执行该方法，并生成测试数据验证属性。</td></tr><tr><td>@ForAll</td><td>用于方法参数，指定该参数由jqwik自动生成测试数据，可结合数据约束使用（如@ForAll @IntRange(min=1, max=100)）。</td></tr><tr><td>Arbitrary</td><td>测试数据生成器的核心接口，代表“可生成某种类型测试数据的集合”，jqwik内置Arbitraries工具类提供常用生成器（如Arbitraries.ints()、Arbitraries.strings()）。</td></tr><tr><td>@Provide</td><td>标记方法为“自定义生成器方法”，方法返回Arbitrary类型，可自定义复杂测试数据（如自定义对象）。</td></tr></tbody></table>
<h4 data-id="heading-10">2.3 第三步：编写基础属性测试</h4>
<p>核心逻辑：定义“通用属性”（方法）→ 用@ForAll让框架自动生成参数 → 用断言验证属性是否成立。</p>
<h3 data-id="heading-11">3 实战Demo：用jqwik测试字符串工具类</h3>
<p>下面我们通过一个完整Demo，实战jqwik的使用——测试一个简单的字符串工具类，验证其“反转字符串”和“判空”两个功能的正确性，覆盖正常、边界、异常场景。</p>
<h4 data-id="heading-12">3.1 第一步：编写被测试的字符串工具类</h4>
<p>先创建一个简单的字符串工具类StringUtils，包含两个方法：反转字符串（reverse）、判断字符串非空（isNotEmpty）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.jqwik.demo;

<span class="hljs-comment">/**
 * 被测试的字符串工具类
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringUtils</span> {

    <span class="hljs-comment">/**
     * 反转字符串
     * <span class="hljs-doctag">@param</span> str 输入字符串（可null）
     * <span class="hljs-doctag">@return</span> 反转后的字符串，null输入返回null
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">reverse</span><span class="hljs-params">(String str)</span> {
        <span class="hljs-keyword">if</span> (str == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(str).reverse().toString();
    }

    <span class="hljs-comment">/**
     * 判断字符串非空（非null、非空白）
     * <span class="hljs-doctag">@param</span> str 输入字符串
     * <span class="hljs-doctag">@return</span> true：非空；false：null或空白字符串
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isNotEmpty</span><span class="hljs-params">(String str)</span> {
        <span class="hljs-keyword">return</span> str != <span class="hljs-literal">null</span> &amp;&amp; !str.trim().isEmpty();
    }
}
</code></pre>
<h4 data-id="heading-13">3.2 第二步：编写jqwik测试类</h4>
<p>创建测试类StringUtilsTest，引入jqwik注解，编写两个属性测试方法，分别验证reverse和isNotEmpty的通用属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.jqwik.demo;

<span class="hljs-keyword">import</span> net.jqwik.api.Arbitraries;
<span class="hljs-keyword">import</span> net.jqwik.api.Arbitrary;
<span class="hljs-keyword">import</span> net.jqwik.api.ForAll;
<span class="hljs-keyword">import</span> net.jqwik.api.Provide;
<span class="hljs-keyword">import</span> net.jqwik.api.Property;
<span class="hljs-keyword">import</span> net.jqwik.api.constraints.NotBlank;
<span class="hljs-keyword">import</span> net.jqwik.api.constraints.Nullable;
<span class="hljs-keyword">import</span> net.jqwik.api.extension.JqwikExtension;
<span class="hljs-keyword">import</span> org.junit.jupiter.api.extension.ExtendWith;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.jupiter.api.Assertions.*;

<span class="hljs-comment">// 启用jqwik扩展，必备注解</span>
<span class="hljs-meta">@ExtendWith(JqwikExtension.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringUtilsTest</span> {

    <span class="hljs-comment">/**
     * 测试reverse方法的核心属性：反转两次的结果应与原字符串一致（支持null）
     * 这里<span class="hljs-doctag">@ForAll</span> <span class="hljs-doctag">@Nullable</span> String str 表示自动生成所有可能的字符串（包括null、空白、正常字符串）
     */</span>
    <span class="hljs-meta">@Property</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">reverseTwiceShouldBeOriginal</span><span class="hljs-params">(<span class="hljs-meta">@ForAll</span> <span class="hljs-meta">@Nullable</span> String str)</span> {
        <span class="hljs-comment">// 核心断言：反转两次的结果 == 原字符串</span>
        assertEquals(str, StringUtils.reverse(StringUtils.reverse(str)));
    }

    <span class="hljs-comment">/**
     * 测试isNotEmpty方法的核心属性1：非空白字符串返回true
     * <span class="hljs-doctag">@ForAll</span> <span class="hljs-doctag">@NotBlank</span> String str 表示自动生成所有非空白字符串（非null、非空白）
     */</span>
    <span class="hljs-meta">@Property</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notBlankStringShouldReturnTrue</span><span class="hljs-params">(<span class="hljs-meta">@ForAll</span> <span class="hljs-meta">@NotBlank</span> String str)</span> {
        assertTrue(StringUtils.isNotEmpty(str));
    }

    <span class="hljs-comment">/**
     * 测试isNotEmpty方法的核心属性2：空白/null字符串返回false
     * 自定义生成器：生成空白字符串（空格、制表符等）或null
     */</span>
    <span class="hljs-meta">@Property</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">blankOrNullStringShouldReturnFalse</span><span class="hljs-params">(<span class="hljs-meta">@ForAll("blankOrNullStrings")</span> String str)</span> {
        assertFalse(StringUtils.isNotEmpty(str));
    }

    <span class="hljs-comment">/**
     * 自定义测试数据生成器：生成空白字符串或null
     * <span class="hljs-doctag">@Provide</span> 注解标记，方法返回Arbitrary&lt;String&gt;（字符串生成器）
     */</span>
    <span class="hljs-meta">@Provide</span>
    Arbitrary&lt;String&gt; <span class="hljs-title function_">blankOrNullStrings</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 生成两种数据：null + 空白字符串（空格、制表符、空字符串），合并为一个生成器</span>
        Arbitrary&lt;String&gt; nullStrings = Arbitraries.just(<span class="hljs-literal">null</span>);
        Arbitrary&lt;String&gt; blankStrings = Arbitraries.strings()
                .withChars(<span class="hljs-string">' '</span>, <span class="hljs-string">'\t'</span>, <span class="hljs-string">'\n'</span>) <span class="hljs-comment">// 只生成空白字符</span>
                .ofMaxLength(<span class="hljs-number">10</span>); <span class="hljs-comment">// 最大长度10，避免生成过长字符串</span>
        <span class="hljs-keyword">return</span> Arbitraries.oneOf(nullStrings, blankStrings, Arbitraries.just(<span class="hljs-string">""</span>));
    }
}
</code></pre>
<h4 data-id="heading-14">3.3 第三步：运行测试并查看结果</h4>
<p>直接在IDE中运行测试类（和运行JUnit测试一致），jqwik会自动生成测试数据，默认每个@Property方法生成1000组数据，我们可以查看运行结果：</p>
<h5 data-id="heading-15">1. 测试成功场景</h5>
<p>如果工具类逻辑正确，运行结果会显示“3 tests passed”（3个属性测试方法全部通过），控制台会输出类似信息：</p>
<pre><code class="hljs language-plain" lang="plain">[INFO] Running com.example.jqwik.demo.StringUtilsTest
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.523 s - in com.example.jqwik.demo.StringUtilsTest
</code></pre>
<p>这说明jqwik生成的1000×3组数据，全部满足我们定义的属性，工具类逻辑无明显bug。</p>
<h5 data-id="heading-16">2. 测试失败场景（模拟bug）</h5>
<p>我们故意修改reverse方法的逻辑（比如注释掉null判断，让null输入抛出异常），再运行测试，jqwik会快速捕捉到失败，并生成最小反例：</p>
<pre><code class="hljs language-plain" lang="plain">// 故意修改后的reverse方法（有bug）
public static String reverse(String str) {
    // 注释掉null判断，null输入会抛出NullPointerException
    return new StringBuilder(str).reverse().toString();
}

// 运行测试后，jqwik输出的失败信息（简化）
Property violation in com.example.jqwik.demo.StringUtilsTest.reverseTwiceShouldBeOriginal
Arguments: [null] // 最小反例：null
Throwable that caused failure: java.lang.NullPointerException
</code></pre>
<p>可以看到，jqwik自动定位到“null输入”这个边界场景，生成了最小反例（null），帮我们快速发现“null输入未处理”的bug，这正是属性测试的优势——手动测试很容易遗漏这类边界场景。</p>
<h3 data-id="heading-17">4 总结与进阶方向</h3>
<p>通过上面的介绍和Demo，相信你已经掌握了jqwik的基础用法：它以“属性测试”为核心，通过自动生成测试数据，帮我们解决传统手动测试的痛点，尤其适合验证算法、工具类、API等通用逻辑的正确性。</p>
<h4 data-id="heading-18">进阶学习方向（可选）</h4>
<ul>
<li>自定义复杂生成器：用@Provide和Arbitraries组合，生成自定义对象、枚举、复杂集合等测试数据（如资料中提到的Combinators.combine组合多个生成器）。</li>
<li>数据约束精细化：使用jqwik提供的更多约束注解（如@IntRange、@StringLength、@Email），精准控制测试数据的范围。</li>
<li>集成Spring Boot：通过jqwik-spring扩展，在Spring Boot项目中使用jqwik测试，支持@Autowired注入Bean。</li>
<li>并行测试与测试优化：配置jqwik并行运行测试，调整生成数据的数量、随机种子等，提升测试效率。</li>
</ul>
<blockquote>
<p>jqwik的官方文档（<a href="https://link.juejin.cn?target=https%3A%2F%2Fjqwik.net%2F" target="_blank" title="https://jqwik.net/" ref="nofollow noopener noreferrer">jqwik.net/</a>）提供了更详细的API说明和进阶用法，感兴趣的可以进一步查阅。总的来说，jqwik上手简单、功能强大，只需几行代码就能实现更全面的测试，值得每一个Java开发者纳入自己的测试工具箱～</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IntentService和JobIntentService解析]]></title>    <link>https://juejin.cn/post/7600704706550513704</link>    <guid>https://juejin.cn/post/7600704706550513704</guid>    <pubDate>2026-01-30T02:53:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600704706550513704" data-draft-id="7600670417858281506" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IntentService和JobIntentService解析"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-30T02:53:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IntentService和JobIntentService解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:53:35.000Z" title="Fri Jan 30 2026 02:53:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1.IntentService</h3>
<p>(1).介绍Service
Android中的Service是用于后台服务的，当应用程序被挂起到后台或者启动Service的Activity被销毁时，为了保证应用某些组件仍然可以工作而引入了Service这个概念，但是Service既不是独立的进程，也不是独立的线程，它是依赖于应用程序的主线程的，在大部分时候不建议在Service中编写耗时的逻辑和操作，否则会引起ANR。（阻塞主线程5s，会导致ANR）
(2).IntentService||JobIntentService应用场景
如果我们编写的耗时逻辑，不得不被service来管理的时候，就需要使用IntentService，IntentService是继承Service的，那么它包含了Service的所有特性，当然也包含service的生命周期，那么与service不同的是，IntentService在执行onCreate操作的时候，内部开了一个线程，去你执行你的耗时操作。</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IntentService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Service</span> </span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> void onHandleIntent(<span class="hljs-meta">@Nullable</span> <span class="hljs-type">Intent</span> intent);
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServiceHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Handler</span> </span>{
        public <span class="hljs-type">ServiceHandler</span>(<span class="hljs-type">Looper</span> looper) {
            <span class="hljs-keyword">super</span>(looper);
        }

        <span class="hljs-meta">@Override</span>
        public void handleMessage(<span class="hljs-type">Message</span> msg) {
            onHandleIntent((<span class="hljs-type">Intent</span>)msg.obj); <span class="hljs-comment">//运行在子线程中</span>
            stopSelf(msg.arg1);
        }
    }
   public void onCreate() {
        <span class="hljs-keyword">super</span>.onCreate();
        <span class="hljs-type">HandlerThread</span> thread = <span class="hljs-keyword">new</span> <span class="hljs-type">HandlerThread</span>(<span class="hljs-string">"IntentService["</span> + mName + <span class="hljs-string">"]"</span>);
        thread.start();
        mServiceLooper = thread.getLooper();
        mServiceHandler = <span class="hljs-keyword">new</span> <span class="hljs-type">ServiceHandler</span>(mServiceLooper);
    }
   <span class="hljs-meta">@Override</span>
    public void onStart(<span class="hljs-meta">@Nullable</span> <span class="hljs-type">Intent</span> intent, int startId) {
        <span class="hljs-type">Message</span> msg = mServiceHandler.obtainMessage();
        msg.arg1 = startId;
        msg.obj = intent;
        mServiceHandler.sendMessage(msg);
    }
}
</code></pre>
<p>(3).继承抽象类IntentService，然后实现handleIntent方法即可.</p>
<pre><code class="hljs language-scala" lang="scala">public  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">IntentService</span> </span>{
    public <span class="hljs-type">TestService</span>(<span class="hljs-type">String</span> name) {
        <span class="hljs-keyword">super</span>(name);
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> void onHandleIntent(<span class="hljs-meta">@Nullable</span> <span class="hljs-type">Intent</span> intent) {
    }
}
</code></pre>
<p>(4).HandleThread实现
继承了Thread，Looper.prepare()将当前线程和Looper对象存储到ThreadLocalMap中，然后提供getLooper方法。</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HandlerThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Thread</span> </span>{
    public void run(){
      <span class="hljs-type">Looper</span>.prepare();
        synchronized (<span class="hljs-keyword">this</span>) {
            mLooper = <span class="hljs-type">Looper</span>.myLooper();
            notifyAll();
        }
    }
   public <span class="hljs-type">Looper</span> getLooper() {
      <span class="hljs-keyword">return</span> mLooper;
   }
}
</code></pre>
<h3 data-id="heading-1">2.JobIntentService</h3>
<p>(1).通过内部的AysncTask来处理耗时操作</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JobIntentService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Service</span> </span>{
     <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> void onHandleWork(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">Intent</span> intent);
      public int onStartCommand(<span class="hljs-meta">@Nullable</span> <span class="hljs-type">Intent</span> intent, int flags, int startId) {
          ensureProcessorRunningLocked(<span class="hljs-literal">true</span>);
     }
     void ensureProcessorRunningLocked(boolean reportStarted) {
        <span class="hljs-keyword">if</span> (mCurProcessor == <span class="hljs-literal">null</span>) {
            mCurProcessor = <span class="hljs-keyword">new</span> <span class="hljs-type">CommandProcessor</span>();
            <span class="hljs-keyword">if</span> (mCompatWorkEnqueuer != <span class="hljs-literal">null</span> &amp;&amp; reportStarted) {
                mCompatWorkEnqueuer.serviceProcessingStarted();
            }
            mCurProcessor.executeOnExecutor(<span class="hljs-type">AsyncTask</span>.<span class="hljs-type">THREAD_POOL_EXECUTOR</span>);
       }
    }
   <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommandProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncTask&lt;Void</span>, <span class="hljs-title">Void</span>, <span class="hljs-title">Void&gt;</span> </span>{
        <span class="hljs-keyword">protected</span> <span class="hljs-type">Void</span> doInBackground(<span class="hljs-type">Void</span>... params) {
            <span class="hljs-type">GenericWorkItem</span> work;

            <span class="hljs-keyword">if</span> (<span class="hljs-type">DEBUG</span>) <span class="hljs-type">Log</span>.d(<span class="hljs-type">TAG</span>, <span class="hljs-string">"Starting to dequeue work..."</span>);

            <span class="hljs-keyword">while</span> ((work = dequeueWork()) != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-type">DEBUG</span>) <span class="hljs-type">Log</span>.d(<span class="hljs-type">TAG</span>, <span class="hljs-string">"Processing next work: "</span> + work);
                 onHandleWork(work.getIntent());<span class="hljs-comment">//回调onHandlerWork方法</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-type">DEBUG</span>) <span class="hljs-type">Log</span>.d(<span class="hljs-type">TAG</span>, <span class="hljs-string">"Completing work: "</span> + work);
                work.complete();
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> void onPostExecute(<span class="hljs-type">Void</span> aVoid) {
            processorFinished();
        }
    }
}

</code></pre>
<p>(2).使用继承抽象类JobIntentService，实现onHandleWork来处理耗时操作</p>
<pre><code class="hljs language-scala" lang="scala">public  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JobIntentService</span> </span>{
    <span class="hljs-meta">@Override</span> 
    <span class="hljs-keyword">protected</span> void onHandleWork(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">Intent</span> intent) { 
        <span class="hljs-comment">//在AsyncTask启动的异步线程中执行</span>
    }
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin核心基础之高阶函数，协程基本用法]]></title>    <link>https://juejin.cn/post/7600670487409344564</link>    <guid>https://juejin.cn/post/7600670487409344564</guid>    <pubDate>2026-01-30T02:59:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670487409344564" data-draft-id="7600681071714304000" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin核心基础之高阶函数，协程基本用法"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-30T02:59:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin核心基础之高阶函数，协程基本用法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:59:14.000Z" title="Fri Jan 30 2026 02:59:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fmaoning20080808%2Farticle%2Fdetails%2F143663152" target="_blank" title="https://blog.csdn.net/maoning20080808/article/details/143663152" ref="nofollow noopener noreferrer">kotlin-协程基本操作_kotlin mainscope-CSDN博客</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Flaiqun789%2Farticle%2Fdetails%2F133937972" target="_blank" title="https://blog.csdn.net/laiqun789/article/details/133937972" ref="nofollow noopener noreferrer">怎么理解kotlin的挂起函数？</a>
<a href="https://juejin.cn/post/7121132393922035720?searchId=202412231443022336D913A7863105656C" target="_blank" title="https://juejin.cn/post/7121132393922035720?searchId=202412231443022336D913A7863105656C">Kotlin协程进阶使用</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3ODY2MzU2MQ%3D%3D%26mid%3D2247490102%26idx%3D6%26sn%3D501c2975d1595ab021b750bd39f409bc%26chksm%3Dcf1118d0f86691c64ea7e86071d4fd02748a7efbad4513a1709aff141ca3bbc3ce45fc6f20de%26token%3D1436311520%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3ODY2MzU2MQ==&amp;mid=2247490102&amp;idx=6&amp;sn=501c2975d1595ab021b750bd39f409bc&amp;chksm=cf1118d0f86691c64ea7e86071d4fd02748a7efbad4513a1709aff141ca3bbc3ce45fc6f20de&amp;token=1436311520&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">Kotlin协程在工作中有用过吗？ (qq.com)</a></p>
<h3 data-id="heading-0">1.kotlin和java编译后都是java字节码，相对于java有啥优势和劣势？</h3>
<p>(1).kotlin优势</p>
<ul>
<li>
<p>代码简洁，开发效率更高
不用使用findViewById，支减少冗余代码，支持空安全，扩展函数，属性，高阶函数和lambda表达式，内联函数。</p>
</li>
<li>
<p>内存消耗更少
由于空安全特性和内联函数优化，它能够生成更高效的字节码，从而减少内存的使用。kotlin协程提供了一中轻量级的并发处理方式，可以进一步降低内存的占用。</p>
</li>
<li>
<p>kotlin是未来Android开发主流的语言，一些Android的新特性，新组件都会优先支持kotlin版本。</p>
</li>
</ul>
<p>(2).kotlin劣势
kotlin编译速度相对java较慢，因为她需要进行额外的类型检查（空安全），和代码转换（kotlin-java-java字节码，复杂，耗性能）</p>
<p>备注：Kotlin与Java在运行时性能方面基本相当，由于kotlin支持inline函数，lambda表达式，在某些情况下性能还要由于java.</p>
<h3 data-id="heading-1">2.Kotlin内置的高阶函数run的原理是什么，与let函数有啥区别？</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">(<span class="hljs-number">1</span>).<span class="hljs-keyword">inline</span> :表示这是一个内联函数，将函数代码直接插入调用处，避免了调用普通方法时，栈帧的创建，销毁所带来的开销。
(<span class="hljs-number">2</span>).&lt;T,R&gt; T.run :T代表要为T扩展出一个名为run的函数，R表示lambda表达式最后一行返回的类型。
(<span class="hljs-number">3</span>).block:T.()-&gt;R:
block：表示lambda的名称
T.():表示输入参数是T本身，让lambda表达式持有了<span class="hljs-keyword">this</span>表示(T)调用者本身
R:表示lambda最后一行返回的类型.
(T) :表示输入参数是T本身，让lambda表达式持有了it表示(T)调用者本身

<span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span><span class="hljs-type">&lt;T,R&gt;</span> T.<span class="hljs-title">let</span><span class="hljs-params">(block:(<span class="hljs-type">T</span>)-&gt;<span class="hljs-type">R</span>)</span></span>{
    <span class="hljs-keyword">return</span> block(<span class="hljs-keyword">this</span>)
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span><span class="hljs-type">&lt;T,R&gt;</span> T.<span class="hljs-title">run</span><span class="hljs-params">(block:<span class="hljs-type">T</span>.()-&gt;<span class="hljs-type">R</span>)</span></span>:R{
      <span class="hljs-keyword">return</span> block()
}
<span class="hljs-comment">//with不是泛型的扩展方法，而是全局方法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> <span class="hljs-title">with</span><span class="hljs-params">(receiver: <span class="hljs-type">T</span>, block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R {
    <span class="hljs-keyword">return</span> receiver.block()
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">also</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T {
    block(<span class="hljs-keyword">this</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">apply</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: T {
    block()
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}



<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
   <span class="hljs-keyword">var</span>  result1=<span class="hljs-string">"778"</span>.run{  
         <span class="hljs-literal">true</span>
        length
    }
   println(result1)   <span class="hljs-comment">//3</span>
  <span class="hljs-keyword">var</span> result2=<span class="hljs-string">"778"</span>.let{
         <span class="hljs-number">999</span>
         <span class="hljs-string">"<span class="hljs-variable">$it</span>"</span> <span class="hljs-comment">//778</span>
  }
}
</code></pre>
<p>为啥所有的类型都可以使用run或者let，那是因为高阶函数let和run是对泛型进行扩展，意味着所有类型都等于泛型，所以任何地方都可以使用.run和let的区别在于lambda表达式一个持有this表示调用者本身，一个持有it表示调用者本身。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">public</span> inline &lt;T&gt; T.<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-attr">block</span>:T.()-&gt;unit):T
<span class="hljs-keyword">public</span> inline &lt;T&gt; T.<span class="hljs-title function_ invoke__">also</span>(<span class="hljs-attr">block</span>:(T)-&gt;unit):T
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> &lt;T,R&gt; <span class="hljs-title function_ invoke__">with</span>(<span class="hljs-attr">receiver</span>:T,<span class="hljs-attr">block</span>:T.()-&gt;R):R
</code></pre>
<h3 data-id="heading-2">3.kotlin语言泛型的形变是什么？【PECS原则 extends out || super in】</h3>
<ul>
<li>不变：指的是此泛型既可以是消费者，可以是生产者，没有任何继承相关的概念.</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>&lt;<span class="hljs-title">T</span>&gt; {}   
</code></pre>
<ul>
<li>协变 ： 指的是此泛型只能是生产者 ，泛型类型只能是T或者T的子类，只能get数据，无法add数据.</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp">ArrayList&lt;<span class="hljs-keyword">out</span> T&gt;            
</code></pre>
<ul>
<li>逆变：指的是此泛型只能是消费者，泛型类型只能是T类型，或者T的父类，只能add数据，无法get【如果get数据，数据类型只能是Object】</li>
</ul>

<pre><code class="hljs language-r" lang="r">ArrayList<span class="hljs-operator">&lt;</span><span class="hljs-keyword">in</span> <span class="hljs-built_in">T</span><span class="hljs-operator">&gt;</span>     
</code></pre>
<h3 data-id="heading-3">4.协程的基本使用.</h3>
<p>#####(1).启动协程的几种方式.</p>
<ul>
<li>launch{}  CoroutineScope接口的扩展方法，启动一个携程，不阻塞当前线程，返回一个Job对象协程.</li>
</ul>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> CoroutineScope.<span class="hljs-title">launch</span><span class="hljs-params">(
     context:<span class="hljs-type">CoroutineScope</span>=EmptyCoroutineContext,
     start:<span class="hljs-type">CoroutineStart</span> = CoroutineStart.DEFAULT,
     block:<span class="hljs-type">suspend</span> <span class="hljs-type">CoroutineScope</span>.()-&gt;<span class="hljs-type">Unit</span>
)</span></span>:Job {  <span class="hljs-comment">//Job是返回值， {} 是launch的方法体实现 【不要搞混淆了】</span>
 <span class="hljs-comment">//launch方法体实现，返回Job对象</span>
      <span class="hljs-keyword">val</span> newcontenxt=newCoroutineContext(context)
     <span class="hljs-keyword">val</span> coroutine=<span class="hljs-keyword">if</span>(start.isLazy){
          LazyStandaloneCoroutine(newContext,block);<span class="hljs-comment">//实现了job接口</span>
     }<span class="hljs-keyword">else</span>{
        StandaloneCoroutine(newContext,active=<span class="hljs-literal">true</span>)  <span class="hljs-comment">//实现了job接口</span>
    }
     coroutine.start(start,coroutine,block)  <span class="hljs-comment">//启动job</span>
    <span class="hljs-keyword">return</span>  coroutine；<span class="hljs-comment">//返回实现了Job接口的协程对象</span>
}
</code></pre>
<p>Job.cancel()可以用来取消协程，控制协程的生命周期.</p>
<ul>
<li>async{} CoroutienScope接口的扩展方法，启动一个协程，不阻塞当前线程，返回一个Deferred类，可以通过wait获取T对象.</li>
</ul>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> CoroutineScope.<span class="hljs-title">async</span><span class="hljs-params">(
    context: <span class="hljs-type">CoroutineContext</span> = EmptyCoroutineContext,
    start: <span class="hljs-type">CoroutineStart</span> = CoroutineStart.DEFAULT,
    block: <span class="hljs-type">suspend</span> <span class="hljs-type">CoroutineScope</span>.() -&gt; <span class="hljs-type">T</span>
)</span></span>: Deferred&lt;T&gt; {
    <span class="hljs-keyword">val</span> newContext = newCoroutineContext(context)
    <span class="hljs-keyword">val</span> coroutine= <span class="hljs-keyword">if</span> (start.isLazy){
        LazyDeferredCoroutine&lt;T&gt;(newContext, block)  <span class="hljs-comment">//实现了Deferred接口</span>
    } <span class="hljs-keyword">else</span>{
       DeferredCoroutine&lt;T&gt;(newContext, active = <span class="hljs-literal">true</span>) <span class="hljs-comment">//实现了Deferred接口</span>
    }
    coroutine.start(start, coroutine, block)   <span class="hljs-comment">//启动协程</span>
    <span class="hljs-keyword">return</span> coroutine <span class="hljs-comment">//返回实现了Deferred接口的协程对象</span>
}
</code></pre>
<ul>
<li>runBlocking{}  全局方法,创建并启动协程,返回值是lambda表达式block的最后一行的返回值.(Unit或者其他具体类型)</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">public fun &lt;T&gt; <span class="hljs-built_in">runBlocking</span>(context: CoroutineContext = EmptyCoroutineContext, block: suspend CoroutineScope.() -&gt; T): T {
    val currentThread = Thread<span class="hljs-selector-class">.currentThread</span>()
    val contextInterceptor = context<span class="hljs-selector-attr">[ContinuationInterceptor]</span>
    val eventLoop: EventLoop?
    val newContext: CoroutineContext
    if (contextInterceptor == null) {
        eventLoop = ThreadLocalEventLoop<span class="hljs-selector-class">.eventLoop</span>
        newContext = GlobalScope<span class="hljs-selector-class">.newCoroutineContext</span>(context + eventLoop)
    } else {
        eventLoop = (contextInterceptor as? EventLoop)?<span class="hljs-selector-class">.takeIf</span> { it<span class="hljs-selector-class">.shouldBeProcessedFromContext</span>() }
            ?: ThreadLocalEventLoop.<span class="hljs-built_in">currentOrNull</span>()
        newContext = GlobalScope.<span class="hljs-built_in">newCoroutineContext</span>(context)
    }
    val coroutine = BlockingCoroutine&lt;T&gt;(newContext, currentThread, eventLoop)
    coroutine<span class="hljs-selector-class">.start</span>(CoroutineStart.DEFAULT, coroutine, block)
    return coroutine<span class="hljs-selector-class">.joinBlocking</span>()
}
<span class="hljs-comment">//这一段代码会阻塞主线程，直接导致黑屏。</span>
runBlocking {
     <span class="hljs-built_in">delay</span>(<span class="hljs-number">10000</span>)
 }
<span class="hljs-comment">//即使指定启动的协程运行在IO线程，也会阻塞主线程，导致黑屏</span>
<span class="hljs-built_in">runBlocking</span>(Dispatchers.IO) {
   <span class="hljs-built_in">delay</span>(<span class="hljs-number">10000</span>L)
}
<span class="hljs-comment">//依然会阻塞主线程导致黑屏</span>
 GlobalScope<span class="hljs-selector-class">.launch</span>(Dispatchers.Main){
       runBlocking {
                <span class="hljs-built_in">delay</span>(<span class="hljs-number">10000</span>)
        }

 }
<span class="hljs-comment">//不会阻塞主线程</span>
 GlobalScope<span class="hljs-selector-class">.launch</span>(Dispatchers.IO){
       runBlocking {
                <span class="hljs-built_in">delay</span>(<span class="hljs-number">10000</span>)
        }
 }
</code></pre>
<h5 data-id="heading-4">(2).withContext() suspend修饰，并不会启动协程，返回结果是lambda表达式最后一行的返回值，只能在suspend挂起方法或者协程中调用，用于切换线程，并挂起协程。（暂停协程，但是执行协程的线程可以继续执行其他任务，不会阻塞，等到协程恢复，该线程可以继续执行）</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">withContext</span><span class="hljs-params">(
    context: <span class="hljs-type">CoroutineContext</span>,
    block: <span class="hljs-type">suspend</span> <span class="hljs-type">CoroutineScope</span>.() -&gt; <span class="hljs-type">T</span>
)</span></span>: T
   
 lifecycleScope.launch(Dispatchers.IO) {
            delay(<span class="hljs-number">1000</span>)
            withContext(Dispatchers.Main){ <span class="hljs-comment">//返回值是Unit 也就是void  //切换到主线程 ，此时协程的IO线程可以去执行其他任务</span>
                println(<span class="hljs-string">"Test001:withContext:<span class="hljs-subst">${Thread.currentThread().name}</span>"</span>)
            }
        }
</code></pre>
<h5 data-id="heading-5">(3).coroutineScope()  suspend修饰，并不会启动协程，只能在suspend挂起方法或者协程中调用，创建一个新的协程作用域【或者说可以在已有的协程内部创建一个新协程】</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">coroutineScope</span><span class="hljs-params">(block: <span class="hljs-type">suspend</span> <span class="hljs-type">CoroutineScope</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R =
    suspendCoroutineUninterceptedOrReturn { uCont -&gt;
        <span class="hljs-keyword">val</span> coroutine = ScopeCoroutine(uCont.context, uCont)
        coroutine.startUndispatchedOrReturn(coroutine, block)
 }


coroutineScope {  }  <span class="hljs-comment">//报错 ，不能直接用，只能在协程里面使用</span>

runBlocking { <span class="hljs-comment">//非suspend全局方法，直接启动协程</span>
   coroutineScope {  }   <span class="hljs-comment">//正常使用，因为runBlocking创建了协程//创建一个新的协程作用域</span>
  delay(<span class="hljs-number">1000L</span>) 
}
</code></pre>
<p>(4).协程上下文，一般用调度器Dispatchers来切换线程，它是CoroutineContext接口的实现类.</p>
<ul>
<li>Dispatchers.Main    协程代码执行在Android主线程</li>
<li>Dispatchers.Unconfined  不限制协程代码执行在哪个线程【主线程或者其他空闲线程】</li>
<li>Dispatcher.Default        JVM共享线程池分配线程执行协程代码</li>
<li>Dispatcher.IO                IO线程池分配线程执行协程代码</li>
</ul>
<h5 data-id="heading-6">注意：await() 只有在 async 未执行完成返回结果时，才会挂起协程。若 async 已经有结果了，await() 则直接获取其结果并赋值给变量，此时不会挂起协程。</h5>
<h3 data-id="heading-7">5.协程的挂起和阻塞</h3>
<h5 data-id="heading-8">(1).suspend非阻塞式挂起函数</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76b28b70e00d4649847e770a05e5824e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346754&amp;x-signature=oyzhpOzmyb9WVYkF1G%2F5FgSRySs%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-scss" lang="scss">fun <span class="hljs-built_in">testCoroutineInActivity</span>() {
       GlobalScope<span class="hljs-selector-class">.launch</span>(Dispatchers.Main) { <span class="hljs-comment">//1.启动协程1</span>
           <span class="hljs-built_in">println</span>("Test001:执行在协程中...")
           GlobalScope<span class="hljs-selector-class">.launch</span> (Dispatchers.IO){<span class="hljs-comment">//2.启动协程2</span>
               <span class="hljs-built_in">println</span>("Test001:异步执行result1")
               <span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>)   
               <span class="hljs-built_in">println</span>("Test001:result1:<span class="hljs-number">1234</span>")
           }
           GlobalScope<span class="hljs-selector-class">.launch</span>(Dispatchers.IO) {<span class="hljs-comment">//3.启动协程3</span>
               <span class="hljs-built_in">println</span>("Test001:异步执行result2.")
               <span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>) 
               <span class="hljs-built_in">println</span>("Test001:result2:<span class="hljs-number">123456</span>")
           }
           <span class="hljs-built_in">println</span>("Test001:执行完毕...")
       }
}
</code></pre>
<h5 data-id="heading-9">注意：协程2和协程3中的delay函数只是挂起了协程2和协程3，不会影响协程1中的主线程的执行.</h5>
<p>执行结果如下：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d78c31c310b4077bcb1b73d635494ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346754&amp;x-signature=gr05XSakSSnACaJNzofeEGQZVP8%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-10">(2).协程都被挂起了，那么挂起函数的函数体由谁执行呢？</h5>
<p>当协程执行到挂起函数式，协程的执行会被暂停（即协程被挂起），但它并不会阻塞执行该挂起函数的线程，挂起函数的函数体任然由当前线程继续执行。
为了更清楚的解释这一点，我们可以使用一下步骤：
(1).协程启动:当一个协程开始运行时，它会在某个线程(Dispatchers.Main)上执行。
(2).遇到挂起函数：当协程遇到挂起函数时，协程的执行会被暂停。
(3).挂起函数执行：尽管协程被暂停了，挂起函数的函数体任然会在原始线程上执行。（除非该挂起函数明确指定了其他的执行上下文）
(4).挂起函数完成：一旦挂起函数完成其工作，它会通知协程库，然后协程会恢复执行。
注意：当协程被挂起时，主线程并没有被阻塞，而是可以执行其他的任务，等到挂起函数执行完毕，协程恢复时，又可以在主线程中继续执行。
总结一下：在协程中使用挂起函数时，任何可能得"阻塞"操作都会转移到其他线程上执行，这样启动协程的原始线程(例如主线程)就不会被实际阻塞，这样使得协程特别适合UI线程编程，因为它可以确保UI线程保持响应。</p>
<h3 data-id="heading-11">6.kotlin协程在工作中有用过吗？</h3>
<p>kotlin协程是一个线程框架，提供了一种轻量级的并发处理方式，通过非阻塞挂起和恢复实现了用同步代码的方式编写异步代码，把原本运行在不同线程的代码写在一个代码块{}里面，看起来就像是同步代码。
协程的目的是，简化复杂的异步代码逻辑，用同步的代码编写方式实现复杂异步代码逻辑。</p>
<h5 data-id="heading-12">(1).几种封装好的协程</h5>
<ul>
<li>
<p>CoroutineScope(Dispatchers.IO)构造函数启动协程 ,通过Dispatchers指定运行的线程。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfa01d72f3eb4ddb88db3dc626c0937b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346754&amp;x-signature=sg53wvH15hdT1EVqI2wMQ0CYCsE%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>GlobalScope启动协程（默认不是主线程，是一个静态单例，和应用的生命周期相同,一般不使用，容易导致内存泄漏）</p>
</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-built_in">object</span> GlobalScope : CoroutineScope {
    <span class="hljs-keyword">override</span> val coroutineContext: <span class="hljs-function">CoroutineContext
        <span class="hljs-title">get</span>()</span> = EmptyCoroutineContext
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31634d42d8e446d8bc75cc8214db254b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346754&amp;x-signature=qoEK5QpmoD232cT6o9KqElgV3iA%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>MainScope()启动协程（默认运行在主线程，是Activity或者Fragment中的一个成员变量，Activity或者Fragment销毁时，就会销毁）</li>
</ul>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">MainScope</span><span class="hljs-params">()</span></span>: CoroutineScope = ContextScope(SupervisorJob() + Dispatchers.Main)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea75a5c3eead4067a5e5c7d37f6ae6d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346754&amp;x-signature=sihutifPfrNg9QXsJkWhfhNekBA%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>viewModelScope启动协程(默认运行在主线程，生命周期和ViewModel绑定)</li>
</ul>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> ViewModel.viewModelScope: CoroutineScope
        <span class="hljs-keyword">get</span>() {
            <span class="hljs-keyword">val</span> scope: CoroutineScope? = <span class="hljs-keyword">this</span>.getTag(JOB_KEY)
            <span class="hljs-keyword">if</span> (scope != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> scope
            }
            <span class="hljs-keyword">return</span> setTagIfAbsent(JOB_KEY,
                CloseableCoroutineScope(SupervisorJob() + Dispatchers.Main.immediate))
        }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c073ed644fe49b59b303914de472977~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346754&amp;x-signature=XRxcQPnhjiZcsBWvLDP5CQRzk0E%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>lifecycleScope启动协程(默认运行在主线程,生命周期和Activity或者Fragment绑定,实现了LifeycleOwner接口)</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">val LifecycleOwner.lifecycleScope: <span class="hljs-function">LifecycleCoroutineScope
    <span class="hljs-title">get</span>()</span> = lifecycle.coroutineScope

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/058235a96f56441999113e0d3b2dc280~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346754&amp;x-signature=ZitxQT6q6Knbq3QMeo6ObbC66iQ%3D" alt="image.png" loading="lazy"/></p>
<p>协程就是一个线程框架，是对线程的封装，提供了一种轻量并发的处理方式，通过非阻塞式挂起和恢复的方式，用同步代码的方编写式实现复杂的异步代码逻辑，把原本运行在不同线程的代码写在一个代码块里面，看起来就像同步代码。</p>
<h5 data-id="heading-13">(2).如果一个页面需要同时并发请求多个接口，当所有的接口都请求完成需要做一些合并处理，然后更新UI，如何并发处理呢？</h5>
<ul>
<li>
<p>方法一：为每个接口设置一个boolean值，每当接口请求成功，boolean值设置为true,当最后一个接口请求成功后，在更新UI，这样就达到了并发的目的 【管理多个boolean值，不够优雅，太累了】</p>
</li>
<li>
<p>方法二：RXjava的zip操作符【达到发射一次，将结果合并处理的目的】</p>
</li>
</ul>

<pre><code class="hljs language-kotlin" lang="kotlin">   <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testRxjavaZip</span><span class="hljs-params">()</span></span>{
        println(<span class="hljs-string">"-------------"</span>)
        <span class="hljs-keyword">val</span> observable1: Observable&lt;HttpResult&lt;List&lt;Banner&gt;&gt;&gt; = HttpRetrofit.apiService.getBanners().subscribeOn(Schedulers.io()).observeOn(
            AndroidSchedulers.mainThread())
        <span class="hljs-keyword">val</span> observable2:Observable&lt;HttpResult&lt;ArrayList&lt;HomeData.DatasBean&gt;&gt;&gt; =HttpRetrofit.apiService.getTopArticles().subscribeOn(Schedulers.io()).observeOn(
            AndroidSchedulers.mainThread())
        <span class="hljs-keyword">val</span> observable3: Observable&lt;HttpResult&lt;List&lt;KnowledgeData&gt;&gt;&gt; = HttpRetrofit.apiService.getKnowledgeTree().subscribeOn(Schedulers.io()).observeOn(
            AndroidSchedulers.mainThread())
        <span class="hljs-keyword">var</span> result1: HttpResult&lt;List&lt;Banner&gt;&gt;? =<span class="hljs-literal">null</span>
        <span class="hljs-keyword">var</span> result2: HttpResult&lt;ArrayList&lt;HomeData.DatasBean&gt;&gt;? =<span class="hljs-literal">null</span>
        <span class="hljs-keyword">var</span> result3: HttpResult&lt;List&lt;KnowledgeData&gt;&gt;? =<span class="hljs-literal">null</span>
        Observable.zip(observable1, observable2, observable3,
            <span class="hljs-keyword">object</span>: Function3&lt;
                    HttpResult&lt;List&lt;Banner&gt;&gt;,
                    HttpResult&lt;ArrayList&lt;HomeData.DatasBean&gt;&gt;,
                    HttpResult&lt;List&lt;KnowledgeData&gt;&gt;,
                    <span class="hljs-built_in">Boolean</span>&gt;{
                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(t1: <span class="hljs-type">HttpResult</span>&lt;<span class="hljs-type">List</span>&lt;<span class="hljs-type">Banner</span>&gt;&gt;, t2: <span class="hljs-type">HttpResult</span>&lt;<span class="hljs-type">ArrayList</span>&lt;<span class="hljs-type">HomeData</span>.<span class="hljs-type">DatasBean</span>&gt;&gt;, t3: <span class="hljs-type">HttpResult</span>&lt;<span class="hljs-type">List</span>&lt;<span class="hljs-type">KnowledgeData</span>&gt;&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> {
                    result1=t1
                    result2=t2
                    result3=t3
                    <span class="hljs-keyword">return</span> t1!=<span class="hljs-literal">null</span>&amp;&amp;t2!=<span class="hljs-literal">null</span>&amp;&amp;t3!=<span class="hljs-literal">null</span>
                }
            }).subscribe(<span class="hljs-keyword">object</span>:Observer&lt;<span class="hljs-built_in">Boolean</span>&gt;{
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">(d: <span class="hljs-type">Disposable</span>)</span></span> {

            }

            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> {

            }

            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> {

            }

            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">Boolean</span>)</span></span> {
                <span class="hljs-keyword">if</span>(t){<span class="hljs-comment">//对结果进行处理</span>
                    println(<span class="hljs-string">"成功获取结果"</span>);
                    println(Gson().toJson(result1))
                    println(Gson().toJson(result2))
                    println(Gson().toJson(result3))
                }
            }
        });

    }
</code></pre>
<ul>
<li>kotlin协程提供了一种轻量级的并发处理方式</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">    fun <span class="hljs-built_in">testCoroutineInActivity</span>() {
      <span class="hljs-comment">//1.launch启动协程，返回Job对象，通过job.cancel()取消任务</span>
     val job:Job=<span class="hljs-built_in">CoroutineScope</span>(Dispatchers.IO).<span class="hljs-built_in">launch</span>() { 
            <span class="hljs-built_in">println</span>("Test001:查看运行的线程<span class="hljs-number">1</span>："+Thread.currentThread()<span class="hljs-selector-class">.name</span>)
            val start= System<span class="hljs-selector-class">.currentTimeMillis</span>()
            val result1=async {<span class="hljs-comment">//运行在主线程，非异步</span>
                <span class="hljs-built_in">println</span>("Test001:查看运行的线程<span class="hljs-number">2</span>："+Thread.currentThread()<span class="hljs-selector-class">.name</span>)
                <span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>)
                "<span class="hljs-number">123</span>"
            }
         <span class="hljs-comment">//2.async  启动协程，得到有返回值的Deferred对象</span>
            val result2:Deferred&lt;String&gt; = <span class="hljs-built_in">async</span>(Dispatchers.IO) { <span class="hljs-comment">//异步 </span>
                <span class="hljs-built_in">println</span>("Test001:查看运行的线程<span class="hljs-number">3</span>："+Thread.currentThread()<span class="hljs-selector-class">.name</span>)
                <span class="hljs-built_in">delay</span>(<span class="hljs-number">2000</span>)
                 "<span class="hljs-number">456</span>"

            }
            val result3=result1<span class="hljs-selector-class">.await</span>()+result2<span class="hljs-selector-class">.await</span>();
            <span class="hljs-built_in">println</span>("Test001:并发耗时："+ (System.currentTimeMillis() - start)+"||result3:<span class="hljs-string">"+result3)
            withContext(Dispatchers.IO){
                println("</span>Test001:查看运行的线程<span class="hljs-number">4</span>：<span class="hljs-string">"+ Thread.currentThread().name)
                delay(1000)
            }
            println("</span>Test001:查看运行的线程<span class="hljs-number">5</span>：<span class="hljs-string">"+ Thread.currentThread().name)
        }
    }
</span></code></pre>
<ul>
<li>kotlin协程解决地狱回调问题【先调用接口1获取数据，然后拿到接口1的结果作为参数调用接口2】</li>
</ul>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 注意：在真实开发过程中，MainScope作用域用的非常常用</span>
MainScope().launch(){     <span class="hljs-comment">// 注意：此协程块默认是在UI线程中启动协程</span>
    <span class="hljs-comment">// 下面的代码看起来会以同步的方式一行行执行（异步代码同步获取结果）</span>
    <span class="hljs-keyword">val</span> token = apiService.getToken()   <span class="hljs-comment">// 网络请求：IO线程，获取用户token</span>
    <span class="hljs-keyword">val</span> user = apiService.getUser(token)<span class="hljs-comment">// 网络请求：IO线程，获取用户信息</span>
    nameTv.text = user.name             <span class="hljs-comment">// 更新 UI：主线程，展示用户名</span>
    <span class="hljs-keyword">val</span> articleList = apiService.getArticleList(user.id)<span class="hljs-comment">// 网络请求：IO线程，根据用户id获取用户的文章集合哦</span>
    articleTv.text = <span class="hljs-string">"用户<span class="hljs-subst">${user.name}</span>的文章页数是:<span class="hljs-subst">${articleList.size}</span>页"</span>   <span class="hljs-comment">// 更新 UI：主线程</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Okhttp3.11.0框架原理分析]]></title>    <link>https://juejin.cn/post/7600670487409803316</link>    <guid>https://juejin.cn/post/7600670487409803316</guid>    <pubDate>2026-01-30T03:30:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670487409803316" data-draft-id="7600665529113247744" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Okhttp3.11.0框架原理分析"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-30T03:30:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Okhttp3.11.0框架原理分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:30:05.000Z" title="Fri Jan 30 2026 03:30:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1.OkHttp用法</h3>
<p>(1).Get请求
new OkHttpClient ，构造Request对象，调用newCall方法获取Call对象，通过call#enqueue或者excute来提交请求。</p>
<pre><code class="hljs language-vbscript" lang="vbscript">String url = <span class="hljs-string">"http://wwww.baidu.com"</span>;
OkHttpClient okHttpClient = <span class="hljs-keyword">new</span> OkHttpClient();
          //POST提交表单
        FormBody formBody = <span class="hljs-keyword">new</span> FormBody.Builder()
                .add(<span class="hljs-string">"username"</span>, <span class="hljs-string">"your_username"</span>)
                .add(<span class="hljs-string">"password"</span>, <span class="hljs-string">"your_password"</span>)
                .build();
        <span class="hljs-built_in">Request</span> request1=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder().url(<span class="hljs-string">"url"</span>).post(formBody).build();
        //POST提交JSON
        MediaType mediaType = MediaType.<span class="hljs-keyword">get</span>(<span class="hljs-string">"application/json; charset=utf-8"</span>);
        String jsonBody = <span class="hljs-string">"{\"</span>key\<span class="hljs-string">":\"</span>value\<span class="hljs-string">"}"</span>;
        RequestBody body = RequestBody.create(mediaType,jsonBody);
        <span class="hljs-built_in">Request</span> request2=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder().url(<span class="hljs-string">""</span>).post(body).build();

<span class="hljs-keyword">Call</span> <span class="hljs-keyword">call</span> = okHttpClient.newCall(request1);
<span class="hljs-keyword">call</span>.enqueue(<span class="hljs-keyword">new</span> Callback() {
    @Override
    <span class="hljs-keyword">public</span> void onFailure(<span class="hljs-keyword">Call</span> <span class="hljs-keyword">call</span>, IOException e) {
        Log.d(TAG, <span class="hljs-string">"onFailure: "</span>);
    }

    @Override
    <span class="hljs-keyword">public</span> void onResponse(<span class="hljs-keyword">Call</span> <span class="hljs-keyword">call</span>, <span class="hljs-built_in">Response</span> <span class="hljs-built_in">response</span>) throws IOException {
        Log.d(TAG, <span class="hljs-string">"onResponse: "</span> + <span class="hljs-built_in">response</span>.body().<span class="hljs-built_in">string</span>());
    }
});

</code></pre>
<p>(2).Post请求
在构建Request对象的时候，需要多构造一个RequestBody对象，同时指定MediaType用于描述请求/响应body的内容类型
Post提交String</p>
<pre><code class="hljs language-vbscript" lang="vbscript">MediaType mediaType = MediaType.parse(<span class="hljs-string">"text/x-markdown; charset=utf-8"</span>);
String requestBody = <span class="hljs-string">"I am Jdqm."</span>;
<span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder()
        .url(<span class="hljs-string">"https://api.github.com/markdown/raw"</span>)
        .post(RequestBody.create(mediaType, requestBody))
        .build();
OkHttpClient okHttpClient = <span class="hljs-keyword">new</span> OkHttpClient();
okHttpClient.newCall(<span class="hljs-built_in">request</span>).enqueue(<span class="hljs-keyword">new</span> Callback() {
    @Override
    <span class="hljs-keyword">public</span> void onFailure(<span class="hljs-keyword">Call</span> <span class="hljs-keyword">call</span>, IOException e) {
        Log.d(TAG, <span class="hljs-string">"onFailure: "</span> + e.getMessage());
    }

    @Override
    <span class="hljs-keyword">public</span> void onResponse(<span class="hljs-keyword">Call</span> <span class="hljs-keyword">call</span>, <span class="hljs-built_in">Response</span> <span class="hljs-built_in">response</span>) throws IOException {
        Log.d(TAG, <span class="hljs-built_in">response</span>.protocol() + <span class="hljs-string">" "</span> +<span class="hljs-built_in">response</span>.code() + <span class="hljs-string">" "</span> + <span class="hljs-built_in">response</span>.message());
        Headers headers = <span class="hljs-built_in">response</span>.headers();
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; headers.size(); i++) {
            Log.d(TAG, headers.name(i) + <span class="hljs-string">":"</span> + headers.value(i));
        }
        Log.d(TAG, <span class="hljs-string">"onResponse: "</span> + <span class="hljs-built_in">response</span>.body().<span class="hljs-built_in">string</span>());
    }
});

</code></pre>
<p>Post提交流</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">RequestBody</span> <span class="hljs-variable">requestBody</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestBody</span>() {
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> MediaType <span class="hljs-title function_">contentType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> MediaType.parse(<span class="hljs-string">"text/x-markdown; charset=utf-8"</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeTo</span><span class="hljs-params">(BufferedSink sink)</span> <span class="hljs-keyword">throws</span> IOException {
        sink.writeUtf8(<span class="hljs-string">"I am Jdqm."</span>);
    }
};

<span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()
        .url(<span class="hljs-string">"https://api.github.com/markdown/raw"</span>)
        .post(requestBody)
        .build();
<span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">okHttpClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>();
okHttpClient.newCall(request).enqueue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Call call, IOException e)</span> {
        Log.d(TAG, <span class="hljs-string">"onFailure: "</span> + e.getMessage());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResponse</span><span class="hljs-params">(Call call, Response response)</span> <span class="hljs-keyword">throws</span> IOException {
        Log.d(TAG, response.protocol() + <span class="hljs-string">" "</span> +response.code() + <span class="hljs-string">" "</span> + response.message());
        <span class="hljs-type">Headers</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> response.headers();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; headers.size(); i++) {
            Log.d(TAG, headers.name(i) + <span class="hljs-string">":"</span> + headers.value(i));
        }
        Log.d(TAG, <span class="hljs-string">"onResponse: "</span> + response.body().string());
    }
});

</code></pre>
<p>Post提交文件</p>
<pre><code class="hljs language-vbscript" lang="vbscript">MediaType mediaType = MediaType.parse(<span class="hljs-string">"text/x-markdown; charset=utf-8"</span>);
OkHttpClient okHttpClient = <span class="hljs-keyword">new</span> OkHttpClient();
File file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"test.md"</span>);
<span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder()
        .url(<span class="hljs-string">"https://api.github.com/markdown/raw"</span>)
        .post(RequestBody.create(mediaType, file))
        .build();
okHttpClient.newCall(<span class="hljs-built_in">request</span>).enqueue(<span class="hljs-keyword">new</span> Callback() {
    @Override
    <span class="hljs-keyword">public</span> void onFailure(<span class="hljs-keyword">Call</span> <span class="hljs-keyword">call</span>, IOException e) {
        Log.d(TAG, <span class="hljs-string">"onFailure: "</span> + e.getMessage());
    }

    @Override
    <span class="hljs-keyword">public</span> void onResponse(<span class="hljs-keyword">Call</span> <span class="hljs-keyword">call</span>, <span class="hljs-built_in">Response</span> <span class="hljs-built_in">response</span>) throws IOException {
        Log.d(TAG, <span class="hljs-built_in">response</span>.protocol() + <span class="hljs-string">" "</span> +<span class="hljs-built_in">response</span>.code() + <span class="hljs-string">" "</span> + <span class="hljs-built_in">response</span>.message());
        Headers headers = <span class="hljs-built_in">response</span>.headers();
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; headers.size(); i++) {
            Log.d(TAG, headers.name(i) + <span class="hljs-string">":"</span> + headers.value(i));
        }
        Log.d(TAG, <span class="hljs-string">"onResponse: "</span> + <span class="hljs-built_in">response</span>.body().<span class="hljs-built_in">string</span>());
    }
});

</code></pre>
<p>Post提交表单</p>
<pre><code class="hljs language-vbscript" lang="vbscript">HttpClient okHttpClient = <span class="hljs-keyword">new</span> OkHttpClient();
RequestBody requestBody = <span class="hljs-keyword">new</span> FormBody.Builder()
        .add(<span class="hljs-string">"search"</span>, <span class="hljs-string">"Jurassic Park"</span>)
        .build();
<span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder()
        .url(<span class="hljs-string">"https://en.wikipedia.org/w/index.php"</span>)
        .post(requestBody)
        .build();

okHttpClient.newCall(<span class="hljs-built_in">request</span>).enqueue(<span class="hljs-keyword">new</span> Callback() {
    @Override
    <span class="hljs-keyword">public</span> void onFailure(<span class="hljs-keyword">Call</span> <span class="hljs-keyword">call</span>, IOException e) {
        Log.d(TAG, <span class="hljs-string">"onFailure: "</span> + e.getMessage());
    }

    @Override
    <span class="hljs-keyword">public</span> void onResponse(<span class="hljs-keyword">Call</span> <span class="hljs-keyword">call</span>, <span class="hljs-built_in">Response</span> <span class="hljs-built_in">response</span>) throws IOException {
        Log.d(TAG, <span class="hljs-built_in">response</span>.protocol() + <span class="hljs-string">" "</span> +<span class="hljs-built_in">response</span>.code() + <span class="hljs-string">" "</span> + <span class="hljs-built_in">response</span>.message());
        Headers headers = <span class="hljs-built_in">response</span>.headers();
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; headers.size(); i++) {
            Log.d(TAG, headers.name(i) + <span class="hljs-string">":"</span> + headers.value(i));
        }
        Log.d(TAG, <span class="hljs-string">"onResponse: "</span> + <span class="hljs-built_in">response</span>.body().<span class="hljs-built_in">string</span>());
    }
});
</code></pre>
<p>Post提交分块请求</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">IMGUR_CLIENT_ID</span> <span class="hljs-operator">=</span> <span class="hljs-string">"..."</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">MediaType</span> <span class="hljs-variable">MEDIA_TYPE_PNG</span> <span class="hljs-operator">=</span> MediaType.parse(<span class="hljs-string">"image/png"</span>);

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postMultipartBody</span><span class="hljs-params">()</span> {
    <span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>();


    <span class="hljs-comment">// Use the imgur image upload API as documented at https://api.imgur.com/endpoints/image</span>
    <span class="hljs-type">MultipartBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MultipartBody</span>.Builder(<span class="hljs-string">"AaB03x"</span>)
            .setType(MultipartBody.FORM)
            .addPart(
                    Headers.of(<span class="hljs-string">"Content-Disposition"</span>, <span class="hljs-string">"form-data; name=\"title\""</span>),
                    RequestBody.create(<span class="hljs-literal">null</span>, <span class="hljs-string">"Square Logo"</span>))
            .addPart(
                    Headers.of(<span class="hljs-string">"Content-Disposition"</span>, <span class="hljs-string">"form-data; name=\"image\""</span>),
                    RequestBody.create(MEDIA_TYPE_PNG, <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"website/static/logo-square.png"</span>)))
            .build();

    <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()
            .header(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Client-ID "</span> + IMGUR_CLIENT_ID)
            .url(<span class="hljs-string">"https://api.imgur.com/3/image"</span>)
            .post(body)
            .build();

    <span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> client.newCall(request);
    call.enqueue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Call call, IOException e)</span> {

        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResponse</span><span class="hljs-params">(Call call, Response response)</span> <span class="hljs-keyword">throws</span> IOException {
            System.out.println(response.body().string());

        }

    });
}

</code></pre>
<h3 data-id="heading-1">2.OkHttp原理</h3>
<h5 data-id="heading-2">(2.1).初步流程图</h5>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53d150a26c59448197b5dec9a22a5a64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770348605&amp;x-signature=ZznPvO2Ve3QszU9EI4iKAqPcGE8%3D" alt="eff4d373e7e0a05fb515b1639ada95f.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dd78e0211e348129d6b4c766ad6f1e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770348605&amp;x-signature=rVmGj%2BT4g6T0e3MKux1H54b9dHw%3D" alt="d5257a27653fd67774db4ed837d9ce7.jpg" loading="lazy"/></p>
<h5 data-id="heading-3">(2.2). OkHttp.newCall()流程分析</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//基本使用</span>
 OkHttpClient okHttpClient=<span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>().newBuilder().build();
        Request request=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder().build();
        Call realCall= okHttpClient.newCall(request);
        realCall.enqueue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>() { 
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Call call, IOException e)</span> {

            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResponse</span><span class="hljs-params">(Call call, Response response)</span> <span class="hljs-keyword">throws</span> IOException {

            }
        });

 <span class="hljs-keyword">static</span> RealCall <span class="hljs-title function_">newRealCall</span><span class="hljs-params">(OkHttpClient client, Request originalRequest, <span class="hljs-type">boolean</span> forWebSocket)</span> {
    <span class="hljs-comment">// Safely publish the Call instance to the EventListener.</span>
    <span class="hljs-type">RealCall</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RealCall</span>(client, originalRequest, forWebSocket); <span class="hljs-comment">//实例化一个RealCall对象</span>
    call.eventListener = client.eventListenerFactory().create(call);
    <span class="hljs-keyword">return</span> call;
  }
 <span class="hljs-comment">//RealCall构造函数</span>
 <span class="hljs-keyword">private</span> <span class="hljs-title function_">RealCall</span><span class="hljs-params">(OkHttpClient client, Request originalRequest, <span class="hljs-type">boolean</span> forWebSocket)</span> {
    <span class="hljs-built_in">this</span>.client = client;
    <span class="hljs-built_in">this</span>.originalRequest = originalRequest; <span class="hljs-comment">//初始化Request</span>
    <span class="hljs-built_in">this</span>.forWebSocket = forWebSocket;
    <span class="hljs-comment">//初始化重试（重定向）拦截器</span>
    <span class="hljs-built_in">this</span>.retryAndFollowUpInterceptor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryAndFollowUpInterceptor</span>(client, forWebSocket);
  }
</code></pre>
<h5 data-id="heading-4">2.3.enqueue流程分析</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//RealCall中</span>
 public void <span class="hljs-built_in">enqueue</span>(Callback responseCallback) {
   <span class="hljs-comment">//调用Dispatcher把AsyncCall加入队列</span>
    client<span class="hljs-selector-class">.dispatcher</span>()<span class="hljs-selector-class">.enqueue</span>(new AsyncCall(responseCallback)); 
  }

<span class="hljs-comment">//Dispatcher中</span>
  synchronized void <span class="hljs-built_in">enqueue</span>(AsyncCall call) {
    <span class="hljs-comment">//如果请求数小于64且同一域名请求小于5个，就把AsyncCall加入runningAsyncCalls队列，然后启动线程池执行，否则就把AsyncCall放入readAsyncCalls队列。</span>
    if (runningAsyncCalls.size() &lt; maxRequests &amp;&amp; <span class="hljs-built_in">runningCallsForHost</span>(call) &lt; maxRequestsPerHost) {
      runningAsyncCalls<span class="hljs-selector-class">.add</span>(call);
      <span class="hljs-built_in">executorService</span>()<span class="hljs-selector-class">.execute</span>(call);
    } else {
      readyAsyncCalls<span class="hljs-selector-class">.add</span>(call);
    }
  }
<span class="hljs-comment">//线程池创建</span>
  public synchronized ExecutorService <span class="hljs-built_in">executorService</span>() {
    if (executorService == null) {
      executorService = new <span class="hljs-built_in">ThreadPoolExecutor</span>(<span class="hljs-number">0</span>, Integer.MAX_VALUE, <span class="hljs-number">60</span>, TimeUnit.SECONDS,
          new SynchronousQueue&lt;Runnable&gt;(), Util<span class="hljs-selector-class">.threadFactory</span>("OkHttp Dispatcher", false));
    }
    return executorService;
  }

</code></pre>
<h5 data-id="heading-5">2.4.AsyncCall</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncCall</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NamedRunnable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Callback responseCallback;
    AsyncCall(Callback responseCallback) {
      <span class="hljs-built_in">super</span>(<span class="hljs-string">"OkHttp %s"</span>, redactedUrl());
      <span class="hljs-built_in">this</span>.responseCallback = responseCallback;
    }

  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
      <span class="hljs-type">boolean</span> <span class="hljs-variable">signalledCallback</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">try</span> {
        <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> getResponseWithInterceptorChain();
        <span class="hljs-keyword">if</span> (retryAndFollowUpInterceptor.isCanceled()) {
          signalledCallback = <span class="hljs-literal">true</span>;
          responseCallback.onFailure(RealCall.<span class="hljs-built_in">this</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"Canceled"</span>));
        } <span class="hljs-keyword">else</span> {
          signalledCallback = <span class="hljs-literal">true</span>;
          responseCallback.onResponse(RealCall.<span class="hljs-built_in">this</span>, response);
        }
      } <span class="hljs-keyword">catch</span> (IOException e) {
        <span class="hljs-keyword">if</span> (signalledCallback) {
          Platform.get().log(INFO, <span class="hljs-string">"Callback failure for "</span> + toLoggableString(), e);
        } <span class="hljs-keyword">else</span> {
          eventListener.callFailed(RealCall.<span class="hljs-built_in">this</span>, e);
          responseCallback.onFailure(RealCall.<span class="hljs-built_in">this</span>, e);
        }
      } <span class="hljs-keyword">finally</span> {
        client.dispatcher().finished(<span class="hljs-built_in">this</span>); 
      }
    }
  }
 <span class="hljs-comment">//把请求队列从runningAsyncCalls中移除，</span>
 <span class="hljs-keyword">void</span> <span class="hljs-title function_">finished</span><span class="hljs-params">(AsyncCall call)</span> {
    finished(runningAsyncCalls, call, <span class="hljs-literal">true</span>);
  }

 <span class="hljs-keyword">private</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">finished</span><span class="hljs-params">(Deque&lt;T&gt; calls, T call, <span class="hljs-type">boolean</span> promoteCalls)</span> {
    <span class="hljs-type">int</span> runningCallsCount;
    Runnable idleCallback;
    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
     <span class="hljs-comment">//把AsyncCall从runningAsyncCalsl中移除</span>
      <span class="hljs-keyword">if</span> (!calls.remove(call)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AssertionError</span>(<span class="hljs-string">"Call wasn't in-flight!"</span>);
      <span class="hljs-keyword">if</span> (promoteCalls) promoteCalls();
      runningCallsCount = runningCallsCount();
      idleCallback = <span class="hljs-built_in">this</span>.idleCallback;
    }
    <span class="hljs-keyword">if</span> (runningCallsCount == <span class="hljs-number">0</span> &amp;&amp; idleCallback != <span class="hljs-literal">null</span>) {
          idleCallback.run();
    }
  }

<span class="hljs-comment">//然后遍历readyAsyncCalls队列，取出AysncCall加入到runningAsyncs队列，启动线程池立即执行。</span>
 <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">promoteCalls</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (runningAsyncCalls.size() &gt;= maxRequests) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// Already running max capacity.</span>
    <span class="hljs-keyword">if</span> (readyAsyncCalls.isEmpty()) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// No ready calls to promote.</span>
    <span class="hljs-keyword">for</span> (Iterator&lt;AsyncCall&gt; i = readyAsyncCalls.iterator(); i.hasNext(); ) {
      <span class="hljs-type">AsyncCall</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> i.next();
      <span class="hljs-keyword">if</span> (runningCallsForHost(call) &lt; maxRequestsPerHost) {
        i.remove();
        runningAsyncCalls.add(call);
        executorService().execute(call);
      }
      <span class="hljs-keyword">if</span> (runningAsyncCalls.size() &gt;= maxRequests) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// Reached max capacity.</span>
    }
  }
</code></pre>
<h5 data-id="heading-6">2.5.getResponseWithInterceptorChain()流程分析</h5>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6664c0f87d0248b7be2b70668bb5c42c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770348605&amp;x-signature=Fm5JDnEQVaLzyi7ps9rG1cVRL4Y%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-csharp" lang="csharp"> <span class="hljs-function">Response <span class="hljs-title">getResponseWithInterceptorChain</span>() throws IOException</span> {
    <span class="hljs-comment">// Build a full stack of interceptors.</span>
    List&lt;Interceptor&gt; interceptors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    interceptors.addAll(client.interceptors());<span class="hljs-comment">//自定义拦截器</span>
<span class="hljs-comment">/* 重试拦截器，判断用户是否取消了请求，在获得结果之后，会根据响应码判断是否需要重定向*/</span>
    interceptors.<span class="hljs-keyword">add</span>(retryAndFollowUpInterceptor);
<span class="hljs-comment">/* 桥接拦截器，负责在http协议中加入必备字段如：host:192.168..0.1:8080,accept encodeing:gzip,connection:keep alive ,在获得结果之后，调用保存cookie接口并解析Gzip数据.*/</span>
    interceptors.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> BridgeInterceptor(client.cookieJar()));
<span class="hljs-comment">/*发起http请求的时候，会尝试读取缓存的响应数据，如果缓存存在有效数据，并满足缓存策略，则直接
返回缓存的数据，避免再次进行网络请求，如果不存在，会生成一个缓存策略，根据缓存策略指示，是否需要网络请求 */</span>
    interceptors.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> CacheInterceptor(client.internalCache()));
<span class="hljs-comment">/*负责建立一个新的tcp/ip连接，并获得对应的socket流*/</span>
    interceptors.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> ConnectInterceptor(client));
    <span class="hljs-keyword">if</span> (!forWebSocket) {
      interceptors.addAll(client.networkInterceptors());
    }
<span class="hljs-comment">/*利用得到的socket.getOutputStream 向服务器发送Http请求,解析读取的响应数据，并将数据封装成response对象返回.*/</span>
    interceptors.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> CallServerInterceptor(forWebSocket));

    Interceptor.Chain chain = <span class="hljs-keyword">new</span> RealInterceptorChain(interceptors, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>,
        originalRequest, <span class="hljs-keyword">this</span>, eventListener, client.connectTimeoutMillis(),
        client.readTimeoutMillis(), client.writeTimeoutMillis());

    <span class="hljs-keyword">return</span> chain.proceed(originalRequest);
  }
</code></pre>
<h5 data-id="heading-7">2.6.Interceptor接口</h5>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Interceptor</span> {
  <span class="hljs-function">Response <span class="hljs-title">intercept</span>(<span class="hljs-params">Chain chain</span>)</span> ;
  <span class="hljs-keyword">interface</span> <span class="hljs-title">Chain</span> {
    <span class="hljs-function">Request <span class="hljs-title">request</span>()</span>;
    <span class="hljs-function">Response <span class="hljs-title">proceed</span>(<span class="hljs-params">Request request</span>)</span> ;
}

</code></pre>
<h5 data-id="heading-8">2.7.RealInterceptors实现类</h5>
<pre><code class="hljs language-ini" lang="ini">public final class RealInterceptorChain implements Interceptor.Chain {

     public RealInterceptorChain(List&lt;Interceptor&gt; interceptors, int index, Request request){
             <span class="hljs-attr">this.interceptors</span> = interceptors<span class="hljs-comment">;</span>
             <span class="hljs-attr">this.index</span> = index<span class="hljs-comment">; </span>
             <span class="hljs-attr">this.request</span> = request<span class="hljs-comment">;</span>
     }
     public Response proceed(Request request){
          //index+1,可以在RealInterceptorChain中调用下一个Interceptor
          RealInterceptorChain <span class="hljs-attr">next</span> = new RealInterceptorChain(interceptors,  index + <span class="hljs-number">1</span>, request）<span class="hljs-comment">;</span>
          Interceptor <span class="hljs-attr">interceptor</span> = interceptors.get(index)<span class="hljs-comment">;//得到当前责任人</span>
          Response <span class="hljs-attr">response</span> = interceptor.intercept(next)<span class="hljs-comment">;</span>
          return    response<span class="hljs-comment">;    </span>
     }
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SystemServer启动AMS,ATMS,WMS,PMS流程]]></title>    <link>https://juejin.cn/post/7600665529113051136</link>    <guid>https://juejin.cn/post/7600665529113051136</guid>    <pubDate>2026-01-30T03:06:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600665529113051136" data-draft-id="7600704706550612008" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SystemServer启动AMS,ATMS,WMS,PMS流程"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-30T03:06:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SystemServer启动AMS,ATMS,WMS,PMS流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:06:21.000Z" title="Fri Jan 30 2026 03:06:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=http%3A%2F%2Fliuwangshu.cn%2Fframework%2Fbooting%2F3-syetemserver.html" target="_blank" title="http://liuwangshu.cn/framework/booting/3-syetemserver.html" ref="nofollow noopener noreferrer">解析SyetemServer进程启动过程</a></p>
<h3 data-id="heading-0">1.解析SystemServer进程</h3>
<p>我们来看下SystemServer的mai函数</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">mian</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>){
     <span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemServer</span>().<span class="hljs-title function_">run</span>();
}
</code></pre>
<p>main函数只调用了run函数</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">run</span>() {
       ...
           System<span class="hljs-selector-class">.loadLibrary</span>("android_servers");<span class="hljs-comment">//1.加载so库</span>
       ...
           <span class="hljs-comment">//2.创建 SystemServiceManager， 创建并启动系统的各种服务 </span>
           mSystemServiceManager = new <span class="hljs-built_in">SystemServiceManager</span>(mSystemContext);
           LocalServices<span class="hljs-selector-class">.addService</span>(SystemServiceManager.class, mSystemServiceManager);
       ...    
        try {
           Trace<span class="hljs-selector-class">.traceBegin</span>(Trace.TRACE_TAG_SYSTEM_SERVER, "StartServices");
           <span class="hljs-built_in">startBootstrapServices</span>();<span class="hljs-comment">//3.启动了AMS ,ATMS,PMS ...</span>
           <span class="hljs-built_in">startCoreServices</span>();<span class="hljs-comment">//4.启动BatteryService，WebViewUpdateService,GpuService...</span>
       <span class="hljs-comment">//5.启动WMS,CameraService,BluetoothService,AudioService,LocationManagerService</span>
           <span class="hljs-built_in">startOtherServices</span>();
       } catch (Throwable ex) {
           Slog<span class="hljs-selector-class">.e</span>("System", "******************************************");
           Slog<span class="hljs-selector-class">.e</span>("System", "************ Failure starting system services", ex);
           throw ex;
       } finally {
           Trace<span class="hljs-selector-class">.traceEnd</span>(Trace.TRACE_TAG_SYSTEM_SERVER);
       }
       ...
   }
</code></pre>
<p>看下startBootstrapServices函数</p>
<pre><code class="hljs language-less" lang="less"> <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">startBootstrapServices</span>(<span class="hljs-variable">@NonNull</span> TimingsTraceAndSlog t) {
   <span class="hljs-comment">//1.创建并启动ATMS ,ServiceManager.addService("activity_task",atm)</span>
     <span class="hljs-selector-tag">ActivityTaskManagerService</span> <span class="hljs-selector-tag">atm</span> = <span class="hljs-selector-tag">mSystemServiceManager</span><span class="hljs-selector-class">.startService</span>(
    ActivityTaskManagerService.Lifecycle.class)<span class="hljs-selector-class">.getService</span>();
   <span class="hljs-comment">// 2.创建并启动AMS </span>
   <span class="hljs-selector-tag">mActivityManagerService</span> = <span class="hljs-selector-tag">ActivityManagerService</span><span class="hljs-selector-class">.Lifecycle</span><span class="hljs-selector-class">.startService</span>(
               mSystemServiceManager, atm);
 <span class="hljs-comment">// 注册binder,ServiceManager.addService("activity",mActivityManagerService)</span>
   <span class="hljs-selector-tag">mActivityManagerService</span><span class="hljs-selector-class">.setSystemProcess</span>();
<span class="hljs-comment">//3.创建并注册PMS,  注册binder, ServiceManager.addService("package", iPackageManager);</span>
<span class="hljs-selector-tag">PackageManagerService</span><span class="hljs-selector-class">.main</span>()
}
</code></pre>
<p>看下startOtherServices函数</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">startOtherServices</span>(<span class="hljs-variable">@NonNull</span> TimingsTraceAndSlog t) {
   <span class="hljs-comment">//创建WMS，并启动</span>
    <span class="hljs-selector-tag">wm</span> = <span class="hljs-selector-tag">WindowManagerService</span><span class="hljs-selector-class">.main</span>(context, inputManager, !mFirstBoot, mOnlyCore,
                    new <span class="hljs-built_in">PhoneWindowManager</span>(), mActivityManagerService.mActivityTaskManager);
    <span class="hljs-comment">//注册binder服务</span>
   <span class="hljs-selector-tag">ServiceManager</span><span class="hljs-selector-class">.addService</span>(Context.WINDOW_SERVICE, wm, false,
                    DUMP_FLAG_PRIORITY_CRITICAL | DUMP_FLAG_PROTO);
  <span class="hljs-comment">// AMS和WMS关联上</span>
    <span class="hljs-selector-tag">mActivityManagerService</span><span class="hljs-selector-class">.setWindowManager</span>(wm);
}

</code></pre>
<h3 data-id="heading-1">2.ATMS和AMS的区别</h3>
<p>AMS以前是管理四大组件，太庞大了,所以为了给AMS减压，把对Activity的管理抽到了ATMS.</p>
<h3 data-id="heading-2">3.AMS,WMS,PMS添加到SErviceManager</h3>
<pre><code class="hljs language-arduino" lang="arduino">
<span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> ACTIVITY_SERVICE = <span class="hljs-string">"activity"</span>;  
<span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> WINDOW_SERVICE = <span class="hljs-string">"window"</span>;  
<span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> PACKAGE_SERVICE = <span class="hljs-string">"package"</span>;  
<span class="hljs-comment">//添加到ServiceManager</span>
AMS:ServiceManager.<span class="hljs-built_in">addService</span>(Context.ACTIVITY_SERVICE, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>); 
WMS: ServiceManager.<span class="hljs-built_in">addService</span>(Context.WINDOW_SERVICE, wm);  
PMS:ServiceManager.<span class="hljs-built_in">addService</span>(<span class="hljs-string">"PACKAGE_SERVICE"</span>, m);
<span class="hljs-comment">//通过ServiceManager获取服务</span>
ServiceManager.<span class="hljs-built_in">getService</span>(<span class="hljs-string">"activity"</span>));
ServiceManager.<span class="hljs-built_in">getService</span>(<span class="hljs-string">"window"</span>));
ServiceManager.<span class="hljs-built_in">getService</span>(<span class="hljs-string">"package"</span>));

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[图文] 手把手教你Windows安装ClaudeCode，接入方舟CodingPlan的kimi-k2.5和glm-4.7]]></title>    <link>https://juejin.cn/post/7600629210156171270</link>    <guid>https://juejin.cn/post/7600629210156171270</guid>    <pubDate>2026-01-29T16:42:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600629210156171270" data-draft-id="7600637595944927274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[图文] 手把手教你Windows安装ClaudeCode，接入方舟CodingPlan的kimi-k2.5和glm-4.7"/> <meta itemprop="keywords" content="Claude,人工智能"/> <meta itemprop="datePublished" content="2026-01-29T16:42:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="洪哥等风来"/> <meta itemprop="url" content="https://juejin.cn/user/3562073402390749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [图文] 手把手教你Windows安装ClaudeCode，接入方舟CodingPlan的kimi-k2.5和glm-4.7
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3562073402390749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    洪哥等风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T16:42:19.000Z" title="Thu Jan 29 2026 16:42:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>本文将指导你在 Windows 系统上安装 <code>ClaudeCode</code>，并配置接入火山方舟 CodingPlan 中的 <code>kimi-k2.5</code> 和 <code>glm-4.7</code>。全程不需要魔法梯子，也不需要安装 WSL 虚拟机，大家按教程步骤走就好。</p>
<p>本教程适合 0 基础小白逐步对照配置，也适合编程老手直接扫一眼该教程，大概就懂了怎么配置。</p>
<hr/>
<h3 data-id="heading-1">1. 推荐配置</h3>
<p>就像打游戏有推荐配置一样，ClaudeCode 的推荐配置比较简单：</p>
<ul>
<li><strong>操作系统</strong>：推荐 <code>Win11</code>，最低支持 <code>Win10</code>（Win7 不适用）</li>
<li><strong>Node.js</strong>：推荐版本 <code>v22.20.0 LTS</code>，最低支持到 <code>v18.20.8</code>（需要 npm 工具）</li>
<li><strong>Git</strong>：推荐最新版</li>
</ul>
<hr/>
<h3 data-id="heading-2">2. 安装 Node.js</h3>
<h4 data-id="heading-3">2.1 下载 Node.js</h4>
<p>进入 Node.js 官方下载界面：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2Fdownload" target="_blank" title="https://nodejs.org/zh-cn/download" ref="nofollow noopener noreferrer">nodejs.org/zh-cn/downl…</a></p>
<h4 data-id="heading-4">2.2 选择版本并下载</h4>
<p>选择 Node.js 版本 + 操作系统 + 架构，把 msi 文件下载到本地：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7610c3c51953447e8455f59e8d5c93d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=OJlwoHk5LuzMLNq3n4Fw9zsQPhc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">2.3 安装 Node.js</h4>
<p>下载完后双击安装，无脑 Next 直到安装完成点击 Finish：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d8454182d8e4a8ea5d5f9f0a1f7fd53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=mGc9L0zdizz9ZHYhoY3cAIzHs7c%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-6">2.4 验证安装并解决权限问题</h4>
<ol>
<li>
<p>搜索 PowerShell 并打开，输入以下命令检查 npm 版本：</p>
<pre><code class="hljs language-powershell" lang="powershell">npm -v
</code></pre>
</li>
<li>
<p>可能会遇到 PowerShell 执行策略错误：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">npm :</span> <span class="hljs-string">无法加载文件</span> <span class="hljs-string">C:\Program</span> <span class="hljs-string">Files\nodejs\npm.ps1，因为在此系统上禁止运行脚本。</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfa86698d63044d9a644fe657d9b8723~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=jNZijRaCrkt4JjB%2FE1EUIH48%2Bd0%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>解决方法：运行以下命令解除限制（需要输入 <code>Y</code> 确认）：</p>
<pre><code class="hljs language-powershell" lang="powershell">Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b10f6e3528a943fe80beb8b4f0a76eac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=N5jFAuGH89gr6R2tiTADebgP%2F8o%3D" alt="" loading="lazy"/></p>
</li>
</ol>
<h4 data-id="heading-7">2.5 备选方案：使用 CMD</h4>
<p>如果在公司电脑上不允许更改安全策略，可以使用 CMD 替代 PowerShell，后续步骤将 PowerShell 换成 CMD 即可：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94ded24de385426aac9a3f66061901c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=kcL%2BOExuVnw4dILg%2F9sbnLcph0s%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-8">3. 安装 Git</h3>
<h4 data-id="heading-9">3.1 下载 Git</h4>
<p>进入 Git 官方下载界面：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fdownloads%2Fwin" target="_blank" title="https://git-scm.com/downloads/win" ref="nofollow noopener noreferrer">git-scm.com/downloads/w…</a></p>
<h4 data-id="heading-10">3.2 选择版本并下载</h4>
<p>选择适合自己的版本进行下载，一般选择 "Git for Windows/x64 Setup"。</p>
<h4 data-id="heading-11">3.3 安装 Git</h4>
<p>双击安装，也是无脑下一步直到最后 Finish。</p>
<h4 data-id="heading-12">3.4 验证安装</h4>
<p>在 PowerShell 中输入以下命令检查 Git 版本：</p>
<pre><code class="hljs language-powershell" lang="powershell">git -v
</code></pre>
<p>有版本号输出就证明安装成功：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d78f03a9e99a454dbf783d8ac803f4a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=5HJDU0uPPSXkdWO2UmBSzMgwSRM%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-13">4. 安装 Claude Code</h3>
<h4 data-id="heading-14">4.1 安装命令</h4>
<p>在 PowerShell 中使用 npm 工具安装 ClaudeCode：</p>
<pre><code class="hljs language-powershell" lang="powershell">npm install -g @anthropic-ai/claude-code
</code></pre>
<h4 data-id="heading-15">4.2 验证安装成功</h4>
<p>安装成功后会看到相应的提示信息：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b47fc993b84bb48cf21a1524debd0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=LIdsji5Ur8LsB7r2FSmTdtOtSG8%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">4.3 首次启动测试</h4>
<p>打开 PowerShell，输入以下命令尝试进入 Claude Code：</p>
<pre><code class="hljs language-powershell" lang="powershell">claude
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53721fc46d9f4916a7be5187fab4717a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=Z7IeALX1U45qa0wkUPAMOit76MU%3D" alt="" loading="lazy"/></p>
<p>如果显示如下界面，证明安装成功了。红色报错是因为 Claude 禁止中国访问，我们在下面的步骤中会把模型替换为 <code>kimi-k2.5</code> 和 <code>glm-4.7</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7edd872dbcec41fca6e2bed99fea3f45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=K2FQXD0SKWj%2FzUMeSRHht4j9zsE%3D" alt="" loading="lazy"/></p>
<p>到这里可以先把窗口关闭掉了，我们去申请模型的 API Key。</p>
<hr/>
<h3 data-id="heading-17">5. 获取火山 CodingPlan 的 API Key</h3>
<h4 data-id="heading-18">5.1 访问方舟 CodingPlan 页面</h4>
<p>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvolcengine.com%2FL%2FvAgAgZgPA80%2F" target="_blank" title="https://volcengine.com/L/vAgAgZgPA80/" ref="nofollow noopener noreferrer">方舟 CodingPlan</a> 页面，按需订阅套餐。</p>
<h4 data-id="heading-19">5.2 创建 API Key</h4>
<ol>
<li>注册后进入 <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.volcengine.com%2Fark%2Fregion%3Aark%2Bcn-beijing%2FopenManagement%3FLLM%3D%257B%257D%26advancedActiveKey%3Dsubscribe" target="_blank" title="https://console.volcengine.com/ark/region:ark+cn-beijing/openManagement?LLM=%7B%7D&amp;advancedActiveKey=subscribe" ref="nofollow noopener noreferrer">火山方舟管理控制台</a></li>
<li>按顺序点击：<code>API Key管理</code> -&gt; <code>创建API Key</code> -&gt; <code>输入一个名字来标识这个key</code> -&gt; <code>创建</code></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a213d773c534a0cb95269ac3e7cd988~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=phmMZjzeoyowzdD2GYxA5ncRz6Y%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-20">5.3 查看 API Key</h4>
<p>申请成功后就能看到这个 API Key 了，后续我们就用这个 API Key 来访问模型：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c49d2319cc9410187ab86e0c9e0e288~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=bp3g4HFNEyaM0wEva5Hofw7f1Fw%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-21">6. 配置 kimi-k2.5 或 glm-4.7 到 ClaudeCode</h3>
<h4 data-id="heading-22">6.1 打开系统环境变量设置</h4>
<p>在 Windows 搜索栏中输入 <code>环境变量</code>，并选择 <code>编辑系统环境变量</code>。</p>
<h4 data-id="heading-23">6.2 进入环境变量配置</h4>
<p>在 <code>系统属性</code> 窗口中，点击 <code>环境变量...</code>。</p>
<h4 data-id="heading-24">6.3 添加环境变量</h4>
<p>在 <code>用户变量</code> 区域，点击 <code>新建...</code>，并依次添加以下 3 个新变量：</p>

























<table><thead><tr><th>变量名</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><strong>ANTHROPIC_AUTH_TOKEN</strong></td><td><code>bb24267b-xxxx-xxxx-xxxx-dcadfb91eec9</code></td><td>需要替换成你刚才申请好的 API Key</td></tr><tr><td><strong>ANTHROPIC_BASE_URL</strong></td><td><code>https://ark.cn-beijing.volces.com/api/coding</code></td><td>访问模型的固定网址</td></tr><tr><td><strong>ANTHROPIC_MODEL</strong></td><td><code>kimi-k2.5</code></td><td>可选值：<code>kimi-k2.5</code>、<code>glm-4.7</code>、<code>deepseek-v3.2</code>、<code>kimi-k2-thinking</code>、<code>doubao-seed-code</code>，推荐填写 <code>kimi-k2.5</code> 或 <code>glm-4.7</code></td></tr></tbody></table>
<p>配置好后如图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5617069e34564575afb404f96efbd34b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=0btkf2f%2Bm5q55oVs9FMF3Q8CIyM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-25">6.4 验证配置</h4>
<p>保存所有的环境变量后，<strong>新打开一个 PowerShell（注意要新打开，否则环境变量可能没更新）</strong>，再次进入 <code>claude</code>，如果不再报错并进入到初始化设置，就证明成功了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6907491cdb64731aa79cc9f3e675d1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=9Pa9Zwo8ENprhaPG03ELNCLTE9c%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-26">6.5 初始化设置</h4>
<p>初始化设置可以无脑回车，直到出现对话框，并有 <code>kimi-k2.5</code> 或你刚才配置好的模型的字样，就证明完全进来了。我们可以让他自我介绍一下，如果能收到回复就说明完全 ok 了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/decbaaad2f47470bb3bfb3167296d8b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=FU8ChITDtlZnwW2aBlzzFaF4cvM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-27">6.6 安全提示</h4>
<p>后续就可以切换到自己的项目路径下，然后启动 Claude 工具了。<em><strong>注意教程中的演示有一些在 C 盘，这是危险的操作，最多让 AI 自我介绍一下，不要给他发其他命令！</strong></em></p>
<hr/>
<h3 data-id="heading-28">7. 使用 Claude Code VSCode 插件</h3>
<h4 data-id="heading-29">7.1 安装插件</h4>
<p>打开 VSCode，在扩展市场搜索 <code>claude code</code> 进行安装：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9e2cfde10284401b5a1de059791b866~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=pPDJthLpMbFB4HTdvosPXTXIzqU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-30">7.2 开始使用</h4>
<p>安装完成后，点击 VSCode 右上角的 Claude Code 图标，进入 Claude Code 页面，待初始化完成后即可开始使用：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bdada187a45471689a5b21d4d7cf9f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770311496&amp;x-signature=UofmyAesuDKZjXrxzmJtWIhLeJ4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>