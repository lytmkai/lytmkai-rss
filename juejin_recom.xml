<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[ä»Vueåˆ°Bevyä¸Nestjsï¼šæˆ‘ä¸º Vue æ„å»ºäº†ä¸€å¥—â€œæ— å¤´â€ä¸šåŠ¡å¼•æ“]]></title>    <link>https://juejin.cn/post/7603563360329482282</link>    <guid>https://juejin.cn/post/7603563360329482282</guid>    <pubDate>2026-02-06T15:21:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360329482282" data-draft-id="7603563317040529471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»Vueåˆ°Bevyä¸Nestjsï¼šæˆ‘ä¸º Vue æ„å»ºäº†ä¸€å¥—â€œæ— å¤´â€ä¸šåŠ¡å¼•æ“"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-06T15:21:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ArisuYuki"/> <meta itemprop="url" content="https://juejin.cn/user/3727757354470171"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»Vueåˆ°Bevyä¸Nestjsï¼šæˆ‘ä¸º Vue æ„å»ºäº†ä¸€å¥—â€œæ— å¤´â€ä¸šåŠ¡å¼•æ“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3727757354470171/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ArisuYuki
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:21:06.000Z" title="Fri Feb 06 2026 15:21:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸çŸ¥é“å¤§å®¶æ˜¯å¦è§è¿‡é‚£ç§åŠ¨è¾„å‡ åƒè¡Œã€é€»è¾‘åƒä¹±éº»ä¸€æ ·ç¼ ç»•çš„ <code>.vue</code> æ–‡ä»¶ï¼Ÿ</p>
<p>ç¬”è€…åœ¨è®¸å¤šå¼€æºé¡¹ç›®å’Œä¼ä¸šçº§é¡¹ç›®é‡Œéƒ½è§è¿‡ç±»ä¼¼çš„ç°è±¡ï¼šå„ç§ <code>watch</code> äº’ç›¸å¥—å¨ƒã€ç”Ÿå‘½å‘¨æœŸé‡Œå¡æ»¡å¼‚æ­¥é€»è¾‘ã€çˆ¶å­ç»„ä»¶ä¼ å€¼ä¼ åˆ°æ€€ç–‘äººç”Ÿã€‚å½“é¡¹ç›®è¿›å…¥ä¸­åæœŸï¼ŒVue çš„å“åº”å¼ç³»ç»Ÿä»¿ä½›ä»â€˜åˆ©å™¨â€™å˜æˆäº†â€˜è¯…å’’â€™ï¼Œæ¯ä¸€è¡Œä»£ç çš„æ”¹åŠ¨éƒ½åƒæ˜¯åœ¨ç©æ‰«é›·ã€‚</p>
<p>è¿™ç§â€œé¢æ¡ä»£ç â€çš„æ³›æ»¥è®©æˆ‘å¼€å§‹åæ€ï¼š<strong>å½“ä¸‹çš„å‰ç«¯å¼€å‘èŒƒå¼ï¼ŒçœŸçš„èƒ½æ”¯æ’‘èµ·å½“ä»Šé€»è¾‘çˆ†ç‚¸çš„å¤æ‚åº”ç”¨å—ï¼Ÿ</strong></p>
<hr/>
<p>èµ·åˆï¼Œæˆ‘ä»¥ä¸ºè¿™ç§æ··ä¹±åªæ˜¯<strong>äººä¸ºå› ç´ </strong>â€”â€”è§‰å¾—åªè¦é€šè¿‡è§„èŒƒçš„ Code Reviewã€é ç€å¼€å‘è€…çš„è‡ªè§‰ï¼Œå°±èƒ½å‹åˆ¶ä½ä»£ç çš„è…çƒ‚ã€‚ä½†éšç€é¡¹ç›®è§„æ¨¡çš„è†¨èƒ€ï¼Œæˆ‘æ¨ç¿»äº†è‡ªå·±çš„æƒ³æ³•ã€‚æˆ‘å‘ç° <strong>Vue çš„ API ä»¿ä½›è‡ªå¸¦ä¸€ç§ä¼ æŸ“æ€§</strong>ã€‚</p>
<p>åªè¦ä½ çš„ä¸šåŠ¡ä»£ç ä¸­è¿˜ç›´æ¥è°ƒç”¨ç€ <code>ref</code>ã€<code>watch</code>ã€<code>onMounted</code>è¿™äº›Vueæœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œä¸šåŠ¡é€»è¾‘å°±ä¸å¯é¿å…åœ°ä¼šå‘ UI æ¡†æ¶ä½å¤´æˆä¸ºUIçš„é™„åº¸ã€‚ä»Šå¤©ä¸ºäº†çœäº‹é¡ºæ‰‹å†™ä¸‹çš„æ¯ä¸€ä¸ª <code>watch</code>å’Œ<code>computed</code>ï¼Œéƒ½æ˜¯ä¸ºæœªæ¥çš„â€œè°æ”¹äº†æˆ‘çš„å˜é‡â€åŸ‹ä¸‹ä¼ç¬”ã€‚Vueçš„è¿™ç§â€˜å“åº”å¼é“¾è·¯â€™åœ¨é¡¹ç›®åˆæœŸæåº¦ä¸æ»‘ï¼Œä½†åœ¨é¡¹ç›®åæœŸå°±æ˜¯å™©æ¢¦çš„å¼€å§‹ã€‚</p>
<p>ç›´åˆ°æœ€åï¼Œæˆ‘å‘ç°ä¸€ä¸ªå‡ ä¹æ— æ³•é¿å¼€çš„å®äº‹ï¼š<strong>åªè¦ UI æ¡†æ¶è¿˜æŒæ¡ç€çŠ¶æ€çš„â€˜ä¿®æ”¹æƒâ€™ï¼Œä¸šåŠ¡ä»£ç å°±å‡ ä¹æ³¨å®šä¼šé€€åŒ–æˆé¢æ¡ã€‚</strong> äºæ˜¯æˆ‘å¼€å§‹æ„è¯†åˆ°ï¼Œæˆ‘å¿…é¡»ä»ç‰©ç†å±‚é¢ç»™ Vue çš„æƒåŠ›â€˜æ–­ä¾›â€™ã€‚è¿™ä¾¿æ˜¯æˆ‘è®¾è®¡ <strong>Virid</strong> çš„åˆè¡·ï¼š<strong>æˆ‘è¦çš„ä¸æ˜¯æ›´ä¼˜é›…åœ°å†™ Vue ä»£ç çš„æ–¹æ³•ï¼Œè€Œæ˜¯ä¸€å¥—æ ¹æœ¬ä¸å±äº Vue çš„å…¨æ–°ä¸–ç•Œã€‚</strong>â€</p>
<hr/>
<p>åœ¨è¿™æ ·çš„ç†å¿µçš„æ¨åŠ¨ä¸‹ï¼Œæˆ‘äº§ç”Ÿäº†ä¸€ä¸ªæå…¶æ¿€è¿›çš„æƒ³æ³•ï¼š**è®©é€»è¾‘å½»åº•ä» UI ä¸­å‰¥ç¦»ï¼Œæ„å»ºä¸€å¥—å®Œå…¨"æ— å¤´"ï¼ˆHeadlessï¼‰çš„ä¸šåŠ¡å¼•æ“ã€‚**å½“æˆ‘å°†ç›®å…‰æŠ•å‘ <strong>Rust çš„ Bevy ECS æ¶æ„</strong> å’Œ <strong>NestJS çš„ IoC ä¾èµ–æ³¨å…¥</strong>æ—¶ï¼Œæˆ‘å‘ç°äº†æˆ‘è‡ªå·±çš„ç­”æ¡ˆã€‚</p>
<p>Bevy æ˜¯ Rust åœˆå­é‡Œæœ€ç¡¬æ ¸çš„å¼€æºé¡¹ç›®ä¹‹ä¸€ï¼Œå®ƒçš„ ECS ç³»ç»Ÿç¾å¾—åƒè‰ºæœ¯å“ã€‚ä½†å¯æƒœå®ƒä¸ºæ¸¸æˆè€Œç”Ÿï¼Œå¤©ç„¶è‡ªå¸¦é«˜é¢‘ Tickï¼Œç›´æ¥æŒªåˆ°å‰ç«¯å¼€å‘ä¸­ä¼šæ˜¾å¾—æ ¼æ ¼ä¸å…¥ã€‚NestJS æ˜¯ JS é¢†åŸŸé‡Œä¾èµ–æ³¨å…¥æœ€æˆç†Ÿçš„å®è·µã€‚æˆ‘ä¸€ç›´åœ¨æ€è€ƒï¼Œå¦‚æœèƒ½ç”¨ NestJS çš„æ‰‹æ„Ÿå»å†™ä¸€å¥— Bevy å¼çš„è§£è€¦é€»è¾‘ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<strong>@Virid/core</strong> å°±æ˜¯è¿™ä¸ªæ€è€ƒçš„ç­”æ¡ˆã€‚å®ƒå‰”é™¤äº†å¤šä½™çš„èµ„æºæŸè€—ï¼Œä¿ç•™äº†æœ€æ ¸å¿ƒçš„æ¶æ„ç¾æ„Ÿã€‚</p>
<hr/>
<p>ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œæˆ‘ä¸ºå‰ç«¯é‡èº«å®šåˆ¶äº†ä¸€å¥—â€œå¸¦å¸§åŒç¼“å†²ä¸ä¼˜å…ˆçº§è°ƒåº¦çš„æ¶ˆæ¯ä¸­å¿ƒâ€ã€‚</p>
<p>å®ƒç»éç®€å•çš„ Event Bus æˆ– Pub/Sub æ¨¡å¼æ‰€èƒ½æ¯”æ‹Ÿã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªèåˆäº† <strong>NestJS ä¾èµ–æ³¨å…¥</strong>ä¸<strong>Bevyè°ƒåº¦æ ¸å¿ƒ</strong>çš„ç²¾å¯†ç³»ç»Ÿã€‚é€šè¿‡<strong>å¸§åŒç¼“å†²</strong>æœºåˆ¶ï¼Œå®ƒå½»åº•æ¶ˆé™¤äº†å‰ç«¯é€»è¾‘ä¸­å¸¸è§çš„"ç«æ€æ¡ä»¶"ä¸"çŠ¶æ€è¸©è¸"ï¼›é…åˆä¼˜å…ˆçº§è°ƒåº¦ï¼Œå®ƒç¡®ä¿äº†æ¯ä¸€æ¡ä¸šåŠ¡æŒ‡ä»¤éƒ½èƒ½åœ¨æœ€åˆé€‚çš„æ—¶é—´èŠ‚æ‹é‡Œæ‰§è¡Œã€‚</p>
<p>è¦ä½¿ç”¨<code>@Virid/core</code>ï¼Œåªéœ€è¦ç®€å•çš„ä¸‰æ­¥èµ°ã€‚é¦–å…ˆæ´¾ç”Ÿä¸€ä¸ªè‡ªå·±çš„æ¶ˆæ¯ã€‚ä»–å¯ä»¥æºå¸¦ä»»ä½•ä½ æƒ³è¦å‘é€çš„æ•°æ®ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åˆå§‹åŒ–æ ¸å¿ƒå¼•æ“</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createVirid</span>();
<span class="hljs-comment">// æ´¾ç”Ÿä¸€ä¸ªè‡ªå·±çš„æ¶ˆæ¯</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">IncrementMessage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">SingleMessage</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> amount: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">super</span>();
  }
}
</code></pre>
<p>æ¥ç€ï¼Œå®šä¹‰è‡ªå·±çš„Componentå¹¶æ³¨å†Œä»–ï¼Œè¿™æ˜¯â€œæ•°æ®ä¸­å¿ƒâ€ï¼Œä»–åªè´Ÿè´£å­˜å‚¨æ•°æ®ï¼Œé™¤æ­¤ä¹‹å¤–æ²¡æœ‰ä»»ä½•é€»è¾‘ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Component</span>()
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterComponent</span> {
  <span class="hljs-keyword">public</span> count = <span class="hljs-number">0</span>;
}
<span class="hljs-comment">// æ³¨å†Œè¿™ä¸ªæ•°æ®ç»„ä»¶</span>
app.<span class="hljs-title function_">bindComponent</span>(<span class="hljs-title class_">CounterComponent</span>);
</code></pre>
<p>æœ€åï¼Œç¼–å†™ä¸€ä¸ªè‡ªå·±çš„systemã€‚<strong>ä»–æ˜¯çº¯é™æ€çš„ã€ä¸éœ€è¦ä»»ä½•æ³¨å†Œä¸è°ƒç”¨ï¼Œåªéœ€è¦ç¼–å†™ä»–éœ€è¦çš„å‚æ•°ã€‚<code>@Virid/core</code>å°†ä¼šè‡ªå·±å‘ç°å¹¶åœ¨åˆé€‚çš„æ—¶å€™è°ƒç”¨å®ƒã€‚</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//å®šä¹‰ç³»ç»Ÿ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterSystem</span> {
  <span class="hljs-comment">//é»˜è®¤ä¼˜å…ˆçº§</span>
  <span class="hljs-comment">//æ— éœ€ä»»ä½•æ“ä½œï¼Œåªè¦å®šä¹‰å¥½å@Virid/coreå°†ä¼šè‡ªåŠ¨å°†systemä¸å¯¹åº”çš„æ¶ˆæ¯ç±»å‹æŒ‚é’©</span>
  <span class="hljs-comment">//å½“æ¥æ”¶åˆ°å¯¹åº”çš„æ¶ˆæ¯ä¹‹åï¼Œ@Virid/coreå°†ä¼šæ³¨å…¥æ‰€æœ‰éœ€è¦çš„å‚æ•°ï¼Œè‡ªåŠ¨æ‰§è¡Œæ•´ä¸ªsystem</span>
  <span class="hljs-meta">@System</span>()
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">onIncrement</span>(<span class="hljs-params">
    <span class="hljs-meta">@Message</span>(IncrementMessage) message: IncrementMessage,
    count: CounterComponent,
  </span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"---------------------onIncrement----------------------"</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"message :&gt;&gt; "</span>, message);
    count.<span class="hljs-property">count</span> += message.<span class="hljs-property">amount</span>;
  }
   <span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªå¾ˆé«˜çš„ä¼˜å…ˆçº§</span>
  <span class="hljs-meta">@System</span>(<span class="hljs-number">100</span>)
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">onIncrementPriority</span>(<span class="hljs-params">
    <span class="hljs-meta">@Message</span>(IncrementMessage) message: IncrementMessage,
    count: CounterComponent,
  </span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
      <span class="hljs-string">"---------------------onIncrementPriority----------------------"</span>,
    );
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"message :&gt;&gt; "</span>, message);
    count.<span class="hljs-property">count</span> += message.<span class="hljs-property">amount</span>;
  }
}
</code></pre>
<p>åœ¨ä»»ä½•åœ°æ–¹ï¼Œåªè¦å‘é€æ¶ˆæ¯ï¼Œ<code>onIncrement</code>å°†ä¼šè¢«<code>è‡ªåŠ¨è°ƒç”¨</code>ã€‚è€Œä¸”ç”±äºå¸§åŒç¼“å†²æœºåˆ¶ï¼Œå…¶å¤©ç„¶è‡ªå¸¦é˜²æŠ–åŠŸèƒ½ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">IncrementMessage</span>.<span class="hljs-title function_">send</span>(<span class="hljs-number">1</span>);<span class="hljs-comment">//è¿™ä¸ªæ¶ˆæ¯å°†ä¼šè¢«åˆå¹¶ï¼ˆå¦‚æœä½¿ç”¨EventMessageæ´¾ç”Ÿåˆ™ä¸ä¼šè¢«åˆå¹¶ï¼‰</span>
<span class="hljs-title class_">IncrementMessage</span>.<span class="hljs-title function_">send</span>(<span class="hljs-number">5</span>);
<span class="hljs-comment">//åªéœ€è¦å‘é€ä¸Šé¢çš„æ¶ˆæ¯ï¼ŒCounterComponentå°†ä¼šè¢«è‡ªåŠ¨æ³¨å…¥onIncrementPriorityä¸onIncrementçš„è°ƒç”¨ä¸­</span>
<span class="hljs-comment">//å› ä¸ºä¼˜å…ˆçº§çš„å­˜åœ¨ï¼Œæ§åˆ¶å°ä¼šå…ˆåæ˜¾ç¤ºonIncrementPriorityä¸onIncrementçš„æ‰§è¡Œæµç¨‹</span>
<span class="hljs-comment">//---------------------onIncrementPriority----------------------</span>
<span class="hljs-comment">//message :&gt;&gt;  IncrementMessage {</span>
<span class="hljs-comment">//  amount: 5</span>
<span class="hljs-comment">//}</span>
<span class="hljs-comment">//---------------------onIncrement----------------------</span>
<span class="hljs-comment">//message :&gt;&gt;  IncrementMessage {</span>
<span class="hljs-comment">//  amount: 5</span>
<span class="hljs-comment">//}</span>
</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<strong>ä¸šåŠ¡é€»è¾‘ã€UIã€æ•°æ®ä¸‰è€…èƒ½å¤Ÿå½»åº•è§£è€¦</strong>ï¼Œæˆ‘ä»¬å°†ä¸ä¼šå†éœ€è¦Vueåšä»»ä½•äº‹æƒ…æ¥ä»‹å…¥ä¸šåŠ¡ï¼Œåªè¦è§¦å‘ä¸€ä¸ªåˆé€‚çš„ä¿¡å·ï¼Œæ‰€æœ‰çš„ç³»ç»Ÿå°†ä¼šè‡ªåŠ¨åˆé€‚çš„è°ƒç”¨ï¼Œå¹¶ä¸”è°ƒåº¦ç³»ç»Ÿå°†ä¼šä¸¥æ ¼ä¿è¯æ‰§è¡Œçš„å…ˆåé¡ºåºã€‚é€šè¿‡è¿™æ ·çš„è®¾è®¡ï¼Œé…åˆå‡ ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ã€‚å¯ä»¥è½»è€Œæ˜“ä¸¾çš„å®ç°undo/redoä¸æ¶ˆæ¯è·Ÿè¸ªåŠŸèƒ½ï¼Œè¿™æ˜¯åœ¨æ™®é€šçš„Vueä¸­éš¾ä»¥åšåˆ°çš„äº‹ã€‚</p>
<p>ç”±äº System å’Œ Component éƒ½æ˜¯çº¯ç²¹çš„é€»è¾‘å’Œæ•°æ®ï¼Œ<strong>ä½ å¯ä»¥åœ¨å®Œå…¨ä¸å¯åŠ¨æµè§ˆå™¨ã€ä¸æ¸²æŸ“ Vue ç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œå¯¹ä¸šåŠ¡é€»è¾‘è¿›è¡Œ 100% çš„å•å…ƒæµ‹è¯•</strong>ã€‚</p>
<hr/>
<p>è§£å†³äº†ä¸šåŠ¡é€»è¾‘æ”¾å’Œæ•°æ®åœ¨å“ªå„¿çš„é—®é¢˜ï¼Œå‰©ä¸‹çš„å°±æ˜¯è§£å†³ä¸<code>Vue</code>ä¹‹é—´çš„é»åˆé—®é¢˜ã€‚å¦‚ä½•åˆ©ç”¨Vueçš„å“åº”å¼å’Œå„ç§APIï¼Œä¼˜é›…çš„è®©æˆ‘ä»¬çš„æ ¸å¿ƒæ•°æ®æŠ•å½±åˆ°UIä¸Šï¼Ÿåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘åˆ›é€ äº†<code>@virid/vue</code>å’Œå¤§é‡çš„æ ¸å¿ƒæ¦‚å¿µã€‚</p>
<p>è¦æ§åˆ¶Vueï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªâ€œä»£ç†äººâ€ï¼ˆControllerï¼‰æ¥åšè¿™ä»¶äº‹ã€‚è®©ä»–è´Ÿè´£å……å½“<code>Virid</code>ä¸<code>Vue</code>ä¹‹é—´çš„æ²Ÿé€šäººã€‚ä»–å°†ä¼šå…¨æƒæ¥ç®¡Vueçš„æ‰€æœ‰æ“ä½œï¼Œå¹¶ç»Ÿä¸€è½¬å‘ç»™Systemã€‚äºæ˜¯ï¼ŒVueæ–‡ä»¶ä¸­å°†ä¼šåªå‰©ä¸‹ä¸€è¡Œscriptä»£ç ï¼ˆä»¥ä¸€ä¸ªéŸ³ä¹åˆ—è¡¨çš„æ’­æ”¾ä¸ºä¾‹ï¼‰ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>This is a playlist page with many songs<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in plct.playlist"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Song</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Song</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Song</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Song.vue"</span>;
  <span class="hljs-keyword">import</span> { useController } <span class="hljs-keyword">from</span> <span class="hljs-string">"@virid/vue"</span>;
  <span class="hljs-keyword">import</span> { <span class="hljs-title class_">PlaylistController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/logic/controllers/playListController"</span>;
  <span class="hljs-keyword">const</span> plct = <span class="hljs-title function_">useController</span>(<span class="hljs-title class_">PlaylistController</span>, { <span class="hljs-attr">id</span>: <span class="hljs-string">"playlist"</span> });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>åœ¨æ™®é€šçš„Vueä¸­ï¼Œä¸šåŠ¡é€»è¾‘ä¸UIé€»è¾‘å¾€å¾€æºæ‚åœ¨ä¸€èµ·ï¼Œä½†æ˜¯åœ¨<code>Virid</code>çš„æ ¸å¿ƒè°ƒåº¦ä¹‹ä¸‹æˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ªå…¨æ–°çš„é€‰æ‹©ï¼šè®©Vueæ°¸è¿œåªè´Ÿè´£UIçš„æ˜¾ç¤ºä¸ç»˜åˆ¶ï¼Œå°†ä¸šåŠ¡é€»è¾‘è½¬äº¤ç»™<code>@Virid/core</code>ã€‚</p>
<p>ä¸ºäº†å…¼å®¹å“åº”å¼ï¼Œæˆ‘å¼•å…¥äº†å“åº”å¼è£…é¥°å™¨<code>@Responsive()</code>ï¼Œåªè¦ç»™ä»»ä½•å˜é‡æ‰“ä¸Šè¿™ä¸ªè£…é¥°å™¨ï¼Œå½“æˆ‘ä»¬è®¿é—®çš„æ—¶å€™ï¼Œå…¶å°†<strong>ä¼šè¢«Viridè‡ªåŠ¨è½¬æ¢æˆVueçš„å“åº”å¼å˜é‡</strong>ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥å‘Šè¯‰<code>Virid</code>ï¼Œé‚£äº›å˜é‡æ˜¯éœ€è¦å“åº”å¼çš„ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Component</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlaylistComponent</span> {
  <span class="hljs-comment">// å½“å‰æ­£åœ¨æ’­æ”¾çš„æ­Œï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶å°†ä¼šè¢«Viridè½¬åŒ–ä¸ºå“åº”å¼å˜é‡</span>
  <span class="hljs-meta">@Responsive</span>()
  <span class="hljs-keyword">public</span> <span class="hljs-attr">currentSong</span>: <span class="hljs-title class_">Song</span> = <span class="hljs-literal">null</span>!
  <span class="hljs-comment">// æ­Œå•åˆ—è¡¨ï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶å°†ä¼šè¢«Viridè½¬åŒ–ä¸ºå“åº”å¼å˜é‡</span>
  <span class="hljs-meta">@Responsive</span>()
  <span class="hljs-keyword">public</span> <span class="hljs-attr">playlist</span>: <span class="hljs-title class_">Song</span>[] = []
}
</code></pre>
<p><code>@Project()</code>æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„â€œæ¡¥æ¢â€ã€‚ä½¿å¾—<code>Controller</code>èƒ½å¤Ÿç›´æ¥è®¿é—®ä»»ä½•<code>Component</code>ä¸Šçš„å±æ€§ï¼ŒåŒæ—¶å°†å…¶è½¬åŒ–ä¸º<strong>åªè¯»</strong>çš„ã€‚è¿™æ„å‘³ç€ä¸€ä¸ª<code>Controller</code>èƒ½å¤Ÿä»»æ„è§‚å¯Ÿ<code>Component</code>ä¸­çš„æ•°æ®ï¼Œä»è€Œæ›´æ–°Vueç»„ä»¶ï¼ŒåŒæ—¶<strong>åªè¯»</strong>ä¿è¯äº†Componentæ•°æ®çš„å®‰å…¨ã€‚</p>
<p><code>@Listener()</code>è£…é¥°å™¨ç”¨äºâ€œå·å¬â€ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸Systemä¸åŒçš„æ˜¯ï¼Œå…¶åªèƒ½å·å¬ä¸€ç§æ´¾ç”Ÿè‡ª<code>ControllerMessage</code>ç±»å‹çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”æ— æ³•äº«å—ä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€<strong>ä¸€ä¸ª<code>Controller</code>ä¸èƒ½ç›´æ¥æ›´æ”¹<code>Component</code></strong>ã€‚</p>
<p><code>@OnHook('onSetup')</code>è£…é¥°å™¨å‘Šè¯‰<code>Virid</code>ï¼Œéœ€è¦åœ¨<code>Vue</code>çš„ä»€ä¹ˆç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨è°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ã€‚<code>Virid</code>å°†ä¼šåœ¨åˆé€‚çš„æ—¶æœºè‡ªåŠ¨è°ƒç”¨è¢«ä¿®é¥°çš„æ–¹æ³•ã€‚</p>
<p><code>@Watch()</code>æ˜¯ä¸€ä¸ªåœ¨<code>Vue</code>åŸç‰ˆä¸Šï¼Œèåˆäº†<code>Virid</code>ç‰¹ç‚¹çš„æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œå…¶ä¸ä»…èƒ½å¤Ÿæ£€æµ‹<code>Controller</code>è‡ªèº«å“åº”å¼å˜é‡çš„å˜åŒ–ã€‚è¿˜èƒ½å¤Ÿç›‘æµ‹<strong>ä»»æ„ä¸€ä¸ª<code>Component</code>ä¸Šçš„å˜é‡</strong>ã€‚ä½†æ˜¯ï¼Œå› ä¸º**@Watch()**ä¸­åªèƒ½æ›´æ”¹<code>Controller</code>è‡ªèº«çš„å˜é‡ï¼Œå› æ­¤å…¶ä»ç„¶æ— æ³•ä¿®æ”¹ä»»ä½•<code>Component</code>ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SongControllerMessage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ControllerMessage</span> {
  <span class="hljs-comment">//åˆ°åº•æ˜¯å“ªä¸€é¦–æ­Œå‘æ¥çš„æ¶ˆæ¯ï¼Ÿç´¢å¼•</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> index: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">super</span>()
  }
}

<span class="hljs-meta">@Controller</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlaylistController</span> {
   <span class="hljs-comment">//å‘Šè¯‰Viridè‡ªåŠ¨å°†playlistå˜ä¸ºå“åº”å¼çš„</span>
  <span class="hljs-meta">@Responsive</span>()
  <span class="hljs-keyword">public</span> playlist!: <span class="hljs-title class_">Song</span>[]
    
  <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæŠ•å½±ï¼Œä»componentä¸­æ˜ å°„æ•°æ®</span>
  <span class="hljs-meta">@Project</span>(<span class="hljs-title class_">PlaylistComponent</span>, <span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.<span class="hljs-property">currentSong</span>)
  <span class="hljs-keyword">public</span> currentSong!: <span class="hljs-title class_">Song</span>

  <span class="hljs-meta">@Listener</span>(<span class="hljs-title class_">SongControllerMessage</span>)
  <span class="hljs-title function_">onMessage</span>(<span class="hljs-params"><span class="hljs-meta">@Message</span>(SongControllerMessage) message: SongControllerMessage</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'song'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">playlist</span>[message.<span class="hljs-property">index</span>])
    <span class="hljs-comment">//å¯ä»¥åšä¸€äº›æ“ä½œç»Ÿä¸€æ‹¦æˆªï¼Œæˆ–è€…ç›´æ¥è°ƒç”¨æ’­æ”¾å™¨</span>
    <span class="hljs-title class_">PlaySongMesage</span>.<span class="hljs-title function_">send</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">playlist</span>[message.<span class="hljs-property">index</span>])
  }
    
  <span class="hljs-meta">@OnHook</span>(<span class="hljs-string">'onSetup'</span>)
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getPlaylist</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">//åœ¨è¿™é‡Œå¯ä»¥è·å–æ•°æ®ï¼Œä¾‹å¦‚ä»æœåŠ¡å™¨è·å–æ•°æ®,è¿™é‡Œæ¨¡æ‹Ÿä¸€ä¸‹</span>
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>))
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">playlist</span> = [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²1'</span>, <span class="hljs-string">'1'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²2'</span>, <span class="hljs-string">'2'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²3'</span>, <span class="hljs-string">'3'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²4'</span>, <span class="hljs-string">'4'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²5'</span>, <span class="hljs-string">'5'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²6'</span>, <span class="hljs-string">'6'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²7'</span>, <span class="hljs-string">'7'</span>)
    ]
  }
  <span class="hljs-comment">//è§‚æµ‹å½“å‰æ­Œæ›²ï¼Œå¦‚æœå˜äº†å°±è§¦å‘æŸäº›æ“ä½œ</span>
  <span class="hljs-meta">@Watch</span>(<span class="hljs-title class_">PlaylistComponent</span>, <span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.<span class="hljs-property">currentSong</span>, {})
  <span class="hljs-title function_">watchCurrentSong</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç›‘å¬åˆ°å½“å‰æ­Œæ›²æ”¹å˜PlaylistComponentï¼š'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentSong</span>)
  }
}
</code></pre>
<p>å¯¹äºæ¯ä¸€é¦–æ­Œï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„<code>Controller</code>æ¥å……å½“æˆ‘ä»¬å’ŒViridçš„ä»£ç†äººï¼Œä½†æ˜¯ä¸æ­¤åŒæ—¶ï¼Œæ¯ä¸€ä¸ª<code>Song</code>ç»„ä»¶ä¹Ÿéœ€è¦å’Œçˆ¶<code>Playlist</code>ç»„ä»¶é€šè®¯ã€‚å› æ­¤æˆ‘åˆ›å»ºäº†ä¸€äº›æ›´å¼ºå¤§å·¥å…·ã€‚</p>
<p>åœ¨.Vueæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’äº†è¿™æ ·çš„å˜é‡ï¼Œä½†æ˜¯ï¼**æˆ‘ä»¬åªä¼ é€’äº†Songç»„ä»¶çš„ç´¢å¼•ï¼Œå¹¶æ²¡æœ‰ä¼ é€’itemæœ¬èº«ã€‚**å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŸç§æ–¹å¼è·å¾—indexï¼Œå¹¶ä¸”è¿˜è¦èƒ½å¤Ÿè®¿é—®åˆ°çˆ¶ç»„ä»¶çš„å±æ€§ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">&lt;div v-<span class="hljs-keyword">for</span>=<span class="hljs-string">"(item, index) in plct.playlist"</span> :key=<span class="hljs-string">"item.id"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Song</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Song</span>&gt;</span></span>
&lt;/div&gt;
</code></pre>
<p><code>@Env()</code>æ˜¯ä¸€ä¸ªç”¨äºæ ‡è®°çš„æ ‡è®°è£…é¥°å™¨ã€‚å½“ä½ åœ¨å­ç»„ä»¶çš„Controllerä¸­æ ‡è®°ä¸€ä¸ªå±æ€§ä¸º  <code>@Env()</code>æ—¶ï¼Œ<code>Virid</code>å°†ä¼šè´Ÿè´£å°†å…¶å®‰è£…åˆ°è¿™ä¸ªå±æ€§ä¸Šï¼Œè¿™æ„å‘³ç€<strong>ä½ ä¸éœ€è¦è‡ªå·±å®šä¹‰propsï¼ŒæŒ‰éœ€å£°æ˜å–ç”¨å³å¯</strong>ã€‚</p>
<p><code>@Inherit()</code>æ˜¯ä¸€ä¸ªç±»ä¼¼<code>@Project()</code>çš„å·¥å…·ï¼Œå¦‚æœè¯´<code>@Project()</code>æ˜¯<code>Controller</code>ä¸<code>Component</code>ä¹‹é—´çš„åªè¯»æ¡¥æ¢ã€‚é‚£ä¹ˆ<code>@Inherit()</code>å°±æ˜¯<code>Controller</code>ä¸<code>Controller</code>ä¹‹é—´çš„åªè¯»æ¡¥æ¢ã€‚<code>@Inherit</code> å½»åº•ç»ˆç»“äº†å‰ç«¯ç»„ä»¶é€šä¿¡ä¸­å†—é•¿çš„ <code>Emit/Props</code> é“¾è·¯ã€‚å®ƒå»ºç«‹äº†ä¸€ä¸ª<strong>è™«æ´</strong>ï¼Œè®©å­ç»„ä»¶å¯ä»¥ç›´æ¥è§‚å¯Ÿåˆ°è¿œæ–¹çˆ¶ç»„ä»¶çš„çŠ¶æ€çš„åŒæ—¶ï¼Œæ— æ³•å¯¹çˆ¶ç»„ä»¶äº§ç”Ÿä»»ä½•å‰¯ä½œç”¨æ±¡æŸ“ã€‚</p>
<p>é€šè¿‡<code>@Inherit()</code>ä½ å¯ä»¥ä»ä»»æ„ç»„ä»¶å†…â€œç»§æ‰¿â€ä»»æ„<code>Controller</code>çš„çŠ¶æ€ï¼ŒåŒæ—¶ï¼Œä»–ä¹Ÿæ˜¯åªè¯»çš„ï¼Œè¿™ä¿è¯äº†ä¸€ä¸ª<code>Controller</code>æ°¸è¿œæ— æ³•å·å·ä¿®æ”¹å¦ä¸€ä¸ª<code>Controller</code>ä¸­æ•°æ®çš„æƒåˆ©ï¼Œå½“å¦ä¸€ä¸ª<code>Controller</code>å› ä¸ºç»„ä»¶å¸è½½è€Œé”€æ¯çš„æ—¶å€™ï¼Œè¿™æ ·çš„è¿æ¥å°†ä¼šè‡ªåŠ¨æ–­å¼€ï¼Œç±»ä¼¼äºä¸€ç§WeakRefã€‚</p>
<p>é€šè¿‡<code>@Inherit()</code>å’Œ<code>@Project()</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œ<strong>ä¸éœ€è¦çˆ¶ç»„ä»¶ç»™æˆ‘ä»¬æä¾›ä»»ä½•æ•°æ®ï¼ŒSongå°†ä¼šè‡ªå·±çŸ¥é“å“ªä¸ªæ•°æ®æ‰æ˜¯è‡ªå·±åº”è¯¥å¾—åˆ°çš„ã€‚</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Controller</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SongController</span> {
  <span class="hljs-meta">@Env</span>()
  <span class="hljs-keyword">public</span> index!: <span class="hljs-built_in">number</span>
  <span class="hljs-meta">@OnHook</span>(<span class="hljs-string">'onSetup'</span>)
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">onSetup</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æˆ‘çš„ç´¢å¼•æ˜¯ï¼š'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>)
  }
  <span class="hljs-meta">@Inherit</span>(<span class="hljs-title class_">PlaylistController</span>, <span class="hljs-string">'playlist'</span>, <span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.<span class="hljs-property">playlist</span>)
  <span class="hljs-keyword">public</span> playlist!: <span class="hljs-title class_">Song</span>[]

  <span class="hljs-meta">@Project</span>&lt;<span class="hljs-title class_">SongController</span>&gt;(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.<span class="hljs-property">playlist</span>?.[i.<span class="hljs-property">index</span>])
  <span class="hljs-keyword">public</span> song!: <span class="hljs-title class_">Song</span>

  <span class="hljs-title function_">playThisSong</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">//å…¶å®ç›´æ¥æ’­æ”¾ä¹Ÿè¡Œï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹éœ€è¦å‘é€ç»™çˆ¶ç»„ä»¶è®©çˆ¶ç»„ä»¶å¤„ç†çš„æƒ…å†µ</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å‘é€æ’­æ”¾æ¶ˆæ¯:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>)
    <span class="hljs-title class_">SongControllerMessage</span>.<span class="hljs-title function_">send</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>)
  }
}
</code></pre>
<p>æœ€ç»ˆï¼Œæ¶ˆæ¯å°†åœ¨Systemä¸­å¾—åˆ°å¤„ç†ï¼Œä»æ­¤æ•´ä¸ªViridå°†å¾—åˆ°å®Œæ•´çš„é—­ç¯ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//å½“Playlistè°ƒç”¨ PlaySongMesage.send(this.playlist[message.index])æ—¶</span>
<span class="hljs-comment">//æ•´ä¸ªç³»ç»Ÿå°†è¢«æ¿€æ´»ï¼Œä»è€Œæ›´æ–°æ­£ç¡®çš„æ•°æ®</span>
<span class="hljs-meta">@System</span>()
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">playThisSong</span>(<span class="hljs-params">
    <span class="hljs-meta">@Message</span>(PlaySongMesage) message: PlaySongMesage,
    playlist: PlaylistComponent,
    player: PlayerComponent
  </span>) {
    <span class="hljs-comment">//æŠŠè¿™é¦–æ­Œæ·»åŠ åˆ°playlisté‡Œï¼Œå¦‚æœæ²¡æœ‰çš„è¯</span>
    playlist.<span class="hljs-property">playlist</span>.<span class="hljs-title function_">push</span>(message.<span class="hljs-property">song</span>)

    <span class="hljs-comment">//å¼€å§‹æ’­æ”¾è¿™é¦–æ­Œ</span>
    playlist.<span class="hljs-property">currentSong</span> = message.<span class="hljs-property">song</span>
    player.<span class="hljs-property">player</span>.<span class="hljs-title function_">play</span>(message.<span class="hljs-property">song</span>)
    <span class="hljs-comment">//è‡ªåŠ¨å‘é€æ–°æ¶ˆæ¯ï¼Œè®°å½•</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IncreasePlayNumMessage</span>()
  }
</code></pre>
<hr/>
<p><code>Virid</code> ä¸æ˜¯ä¸ºäº†æ¶ˆç­ <code>Vue</code>ï¼Œè€Œæ˜¯ä¸ºäº†è§£å†³ä¸šåŠ¡é€»è¾‘è¢«è€¦åˆåœ¨UIä¸­çš„é—®é¢˜ã€‚å®ƒå¯èƒ½ä¸é€‚åˆæ‰€æœ‰çš„ Todo-listï¼Œä½†å®ƒä¸€å®šé€‚åˆé‚£äº›è®©ä½ å¤œä¸èƒ½å¯çš„å¤æ‚ç³»ç»Ÿã€‚</p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FArisuYuki%2Fvirid" target="_blank" title="https://github.com/ArisuYuki/virid" ref="nofollow noopener noreferrer">github.com/ArisuYuki/vâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ButterKnifeåœ¨Android 35 + Gradle 8.+ç¯å¢ƒä¸‹çš„é€‚é…å›°å¢ƒä¸ç°ä»£åŒ–è¿ç§»æŒ‡å—]]></title>    <link>https://juejin.cn/post/7603581886149230646</link>    <guid>https://juejin.cn/post/7603581886149230646</guid>    <pubDate>2026-02-06T10:34:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603581886149230646" data-draft-id="7603581886149214262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ButterKnifeåœ¨Android 35 + Gradle 8.+ç¯å¢ƒä¸‹çš„é€‚é…å›°å¢ƒä¸ç°ä»£åŒ–è¿ç§»æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-06T10:34:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç å“¥_å¸¸"/> <meta itemprop="url" content="https://juejin.cn/user/705230023172650"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ButterKnifeåœ¨Android 35 + Gradle 8.+ç¯å¢ƒä¸‹çš„é€‚é…å›°å¢ƒä¸ç°ä»£åŒ–è¿ç§»æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/705230023172650/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç å“¥_å¸¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:34:37.000Z" title="Fri Feb 06 2026 10:34:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>é‡è¦å£°æ˜</strong>ï¼šButterKnifeå·²äº2020å¹´ç”±ä½œè€…Jake Whartonæ­£å¼å®£å¸ƒå¼ƒç”¨ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJakeWharton%2Fbutterknife" target="_blank" title="https://github.com/JakeWharton/butterknife" ref="nofollow noopener noreferrer">GitHubå½’æ¡£è¯´æ˜</a>ï¼‰ã€‚æœ¬æ–‡æ ¸å¿ƒç»“è®ºï¼š<strong>å¼ºçƒˆä¸å»ºè®®åœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨ButterKnifeï¼Œç°æœ‰é¡¹ç›®åº”ä¼˜å…ˆè¿ç§»è‡³ViewBinding</strong>ã€‚æœ¬æ–‡ä»…æä¾›æŠ€æœ¯èƒŒæ™¯åˆ†æä¸è¿ç§»è·¯å¾„ï¼Œé¿å…å¼€å‘è€…é™·å…¥ç»´æŠ¤é™·é˜±ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆButterKnifeæ— æ³•é€‚é…Gradle 8.+ä¸Android 35ï¼Ÿ</h2>
<h3 data-id="heading-1">ğŸ”’ æ ¸å¿ƒçŸ›ç›¾ç‚¹</h3>



































<table><thead><tr><th>ç»´åº¦</th><th>ButterKnifeç°çŠ¶</th><th>Gradle 8.+ / AGP 8.+ è¦æ±‚</th><th>Android 35 (API 35) é£é™©</th></tr></thead><tbody><tr><td><strong>ç»´æŠ¤çŠ¶æ€</strong></td><td>2020å¹´å½’æ¡£ï¼Œæœ€åç‰ˆæœ¬10.2.3 (2019)</td><td>è¦æ±‚ä¾èµ–æ˜ç¡®å£°æ˜ã€æ³¨è§£å¤„ç†å™¨å…¼å®¹æ–°API</td><td>åå°„é™åˆ¶å¢å¼ºï¼ˆéSDKæ¥å£ç®¡æ§ï¼‰</td></tr><tr><td><strong>æ³¨è§£å¤„ç†å™¨</strong></td><td>åŸºäºæ—§ç‰ˆJavaPoetï¼Œæœªé€‚é…AGP 8+ SPI</td><td>å¼ºåˆ¶è¦æ±‚<code>compileApiVersion</code>å£°æ˜</td><td>ButterKnifeä¾èµ–åå°„ç»‘å®šViewï¼Œå­˜åœ¨è¿è¡Œæ—¶å´©æºƒé£é™©</td></tr><tr><td><strong>æ„å»ºé…ç½®</strong></td><td>ä¾èµ–<code>apt</code>æ’ä»¶ï¼ˆå·²åºŸå¼ƒï¼‰</td><td>ç§»é™¤<code>compile</code>/<code>provided</code>ï¼Œå¼ºåˆ¶<code>namespace</code></td><td>Android 15å¯¹åå°Activityå¯åŠ¨ç­‰æœ‰æ–°é™åˆ¶ï¼ˆé—´æ¥å½±å“äº‹ä»¶å¤„ç†ï¼‰</td></tr><tr><td><strong>Javaç‰ˆæœ¬</strong></td><td>ç¼–è¯‘äºJava 8</td><td>Gradle 8é»˜è®¤éœ€JDK 17+</td><td>JDK 17æ¨¡å—åŒ–å¯¹åå°„è°ƒç”¨æ›´ä¸¥æ ¼</td></tr></tbody></table>
<h3 data-id="heading-2">âš ï¸ å…¸å‹æŠ¥é”™ç¤ºä¾‹</h3>
<pre><code class="hljs language-log" lang="log"># AGP 8+ ä¸¥æ ¼æ¨¡å¼æŠ¥é”™
&gt; Task :app:compileDebugJavaWithJavac FAILED
error: cannot access butterknife.Unbinder
  class file for butterknife.Unbinder not found

# Gradle 8 ä¾èµ–è§£æå¤±è´¥
Could not resolve com.jakewharton:butterknife-compiler:10.2.3.
Required by: project :app &gt; com.android.tools.build:gradle:8.2.0
</code></pre>
<hr/>
<h2 data-id="heading-3">äºŒã€ä¸´æ—¶æ–¹æ¡ˆï¼ˆä»…é™ç´§æ€¥è¿‡æ¸¡ï¼Œé£é™©è‡ªæ‹…ï¼‰</h2>
<blockquote>
<p>ğŸ“Œ <strong>è­¦å‘Š</strong>ï¼šä»¥ä¸‹æ–¹æ¡ˆæ— æ³•ä¿è¯ç¨³å®šæ€§ï¼Œä»…ä½œçŸ­æœŸåº”æ€¥å‚è€ƒï¼Œ<strong>åˆ‡å‹¿ç”¨äºç”Ÿäº§ç¯å¢ƒé•¿æœŸç»´æŠ¤</strong></p>
</blockquote>
<h3 data-id="heading-4">æ–¹æ¡ˆAï¼šé™çº§æ„å»ºç¯å¢ƒï¼ˆä¸æ¨èï¼‰</h3>
<pre><code class="hljs language-gradle" lang="gradle">// gradle-wrapper.properties
distributionUrl=https\://services.gradle.org/distributions/gradle-7.6-bin.zip

// build.gradle (Project)
classpath 'com.android.tools.build:gradle:7.4.2' // é8.x
</code></pre>
<p><strong>ç¼ºé™·</strong>ï¼šæ— æ³•ä½¿ç”¨Android 35æ–°ç‰¹æ€§ï¼Œå®‰å…¨è¡¥ä¸æ»åï¼Œè¿åGoogle Play targetingè¦æ±‚ã€‚</p>
<h3 data-id="heading-5">æ–¹æ¡ˆBï¼šç¤¾åŒºForkå°è¯•ï¼ˆé«˜é£é™©ï¼‰</h3>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation 'io.github.yuweiguocn:butterknife:10.2.4' // éå®˜æ–¹fork
    annotationProcessor 'io.github.yuweiguocn:butterknife-compiler:10.2.4'
}
</code></pre>
<p><strong>é£é™©</strong>ï¼š</p>
<ul>
<li>æ— å®˜æ–¹ç»´æŠ¤ï¼Œå®‰å…¨æ¼æ´æœªçŸ¥</li>
<li>ä¸AGP 8.3+ä»å¯èƒ½å­˜åœ¨å…¼å®¹é—®é¢˜</li>
<li>Android 35åå°„é™åˆ¶å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶å´©æºƒ</li>
</ul>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€âœ… æ­£ç¡®è·¯å¾„ï¼šè¿ç§»åˆ°ViewBindingï¼ˆå®˜æ–¹æ¨èæ–¹æ¡ˆï¼‰</h2>
<h3 data-id="heading-7">è¿ç§»ä¼˜åŠ¿</h3>
<ul>
<li>âœ… å®Œç¾å…¼å®¹Gradle 8.0+ / AGP 8.0+ / Android 35</li>
<li>âœ… ç¼–è¯‘æœŸç±»å‹å®‰å…¨ï¼Œé›¶åå°„ï¼Œæ€§èƒ½ä¼˜äºButterKnife</li>
<li>âœ… Googleå®˜æ–¹æŒç»­ç»´æŠ¤ï¼Œä¸Composeæ— ç¼è¡”æ¥</li>
<li>âœ… å‡å°‘APKä½“ç§¯ï¼ˆæ— éœ€æ³¨è§£å¤„ç†å™¨ç”Ÿæˆä»£ç ï¼‰</li>
</ul>
<h3 data-id="heading-8">è¿ç§»å››æ­¥æ³•</h3>
<h4 data-id="heading-9">1ï¸âƒ£ å¯ç”¨ViewBindingï¼ˆbuild.gradleï¼‰</h4>
<pre><code class="hljs language-gradle" lang="gradle">android {
    namespace 'com.your.package' // AGP 8+ å¼ºåˆ¶è¦æ±‚
    buildFeatures {
        viewBinding true
    }
}
</code></pre>
<h4 data-id="heading-10">2ï¸âƒ£ Activityè¿ç§»å¯¹æ¯”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ ButterKnife (æ—§)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {
    <span class="hljs-meta">@BindView(R.id.tv_title)</span> TextView title;
    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        ButterKnife.bind(<span class="hljs-built_in">this</span>);
        title.setText(<span class="hljs-string">"Hello"</span>);
    }
}

<span class="hljs-comment">// âœ… ViewBinding (æ–°)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {
    <span class="hljs-keyword">private</span> ActivityMainBinding binding; <span class="hljs-comment">// è‡ªåŠ¨ç”Ÿæˆç±»</span>
    
    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        binding = ActivityMainBinding.inflate(getLayoutInflater());
        setContentView(binding.getRoot());
        binding.tvTitle.setText(<span class="hljs-string">"Hello"</span>); <span class="hljs-comment">// ç±»å‹å®‰å…¨</span>
    }
    
    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>.onDestroy();
        binding = <span class="hljs-literal">null</span>; <span class="hljs-comment">// é¿å…å†…å­˜æ³„æ¼</span>
    }
}
</code></pre>
<h4 data-id="heading-11">3ï¸âƒ£ Fragmentè¿ç§»è¦ç‚¹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlinç¤ºä¾‹ï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeFragment</span> : <span class="hljs-type">Fragment</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _binding: FragmentHomeBinding? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> binding <span class="hljs-keyword">get</span>() = _binding!!

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(inflater: <span class="hljs-type">LayoutInflater</span>, container: <span class="hljs-type">ViewGroup</span>?, savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span>: View {
        _binding = FragmentHomeBinding.inflate(inflater, container, <span class="hljs-literal">false</span>)
        <span class="hljs-keyword">return</span> binding.root
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewCreated</span><span class="hljs-params">(view: <span class="hljs-type">View</span>, savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        binding.btnSubmit.setOnClickListener { <span class="hljs-comment">/* äº‹ä»¶å¤„ç† */</span> }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroyView</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onDestroyView()
        _binding = <span class="hljs-literal">null</span> <span class="hljs-comment">// å…³é”®ï¼é˜²æ­¢Fragmentè§†å›¾æ³„æ¼</span>
    }
}
</code></pre>
<h4 data-id="heading-12">4ï¸âƒ£ æ‰¹é‡è¿ç§»æŠ€å·§</h4>
<ul>
<li><strong>Android Studioè¾…åŠ©</strong>ï¼š<br/>
<code>Refactor &gt; Migrate to ViewBinding</code>ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬æ”¯æŒï¼‰</li>
<li><strong>æ­£åˆ™æ›¿æ¢å‚è€ƒ</strong>ï¼š<br/>
<code>@BindView$R\.id\.(\w+)$\s+\w+\s+(\w+);</code> â†’ <code>binding.$1</code></li>
<li><strong>åˆ†æ¨¡å—æ¨è¿›</strong>ï¼šä¼˜å…ˆè¿ç§»ä½é£é™©æ¨¡å—ï¼Œä¿ç•™ButterKnifeåœ¨ç‹¬ç«‹Moduleä¸­éš”ç¦»</li>
</ul>
<hr/>
<h2 data-id="heading-13">å››ã€Android 35ç‰¹åˆ«æ³¨æ„äº‹é¡¹</h2>
<ol>
<li><strong>åå°„é™åˆ¶</strong>ï¼šButterKnifeé€šè¿‡<code>Class.forName</code>åŠ è½½ç»‘å®šç±»ï¼Œåœ¨Android 35ä¸Šå¯èƒ½è§¦å‘<code>NoSuchMethodError</code>ï¼ˆå°¤å…¶å¯ç”¨<code>strictMode</code>æ—¶ï¼‰</li>
<li><strong>åå°é™åˆ¶</strong>ï¼š<code>@OnClick</code>è‹¥è§¦å‘Activityè·³è½¬ï¼Œéœ€æ£€æŸ¥Android 15çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fabout%2Fversions%2F15%2Fbehavior-changes-15%23pending-intent-mutability" target="_blank" title="https://developer.android.com/about/versions/15/behavior-changes-15#pending-intent-mutability" ref="nofollow noopener noreferrer"> PendingIntenté™åˆ¶</a></li>
<li><strong>è¿ç§»éªŒè¯æ¸…å•</strong>ï¼š
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> åœ¨Android 15æ¨¡æ‹Ÿå™¨/çœŸæœºæµ‹è¯•Viewç»‘å®š</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ£€æŸ¥æ‰€æœ‰ç‚¹å‡»äº‹ä»¶æ˜¯å¦ç¬¦åˆæ–°æƒé™æ¨¡å‹</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ä½¿ç”¨StrictModeæ£€æµ‹åå°„è¿è§„</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-14">äº”ã€ç»“è¯­ï¼šæ‹¥æŠ±ç°ä»£Androidå¼€å‘</h2>





























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å¯è¡Œæ€§</th><th>é•¿æœŸæˆæœ¬</th><th>æ¨èæŒ‡æ•°</th></tr></thead><tbody><tr><td>å¼ºè¡Œé€‚é…ButterKnife</td><td>âŒ æä½</td><td>æé«˜ï¼ˆå®‰å…¨/ç»´æŠ¤é£é™©ï¼‰</td><td>â­</td></tr><tr><td>é™çº§Gradle/AGP</td><td>âš ï¸ ä¸´æ—¶</td><td>é«˜ï¼ˆæŠ€æœ¯å€ºç´¯ç§¯ï¼‰</td><td>â­â­</td></tr><tr><td><strong>è¿ç§»åˆ°ViewBinding</strong></td><td>âœ… 100%</td><td>ä½ï¼ˆä¸€æ¬¡æ€§æŠ•å…¥ï¼‰</td><td>â­â­â­â­â­</td></tr></tbody></table>
<blockquote>
<p><strong>è¡ŒåŠ¨å»ºè®®</strong>ï¼š<br/>
1ï¸âƒ£ ç«‹å³è¯„ä¼°é¡¹ç›®ButterKnifeä½¿ç”¨èŒƒå›´<br/>
2ï¸âƒ£ åˆ¶å®š2-4å‘¨è¿ç§»è®¡åˆ’ï¼ˆå°å›¢é˜Ÿå¯1å‘¨å®Œæˆï¼‰<br/>
3ï¸âƒ£ åˆ©ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftopic%2Flibraries%2Fview-binding" target="_blank" title="https://developer.android.com/topic/libraries/view-binding" ref="nofollow noopener noreferrer">ViewBindingå®˜æ–¹æ–‡æ¡£</a>ä¸<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fstudio%2Fwrite%2Fview-binding-migration" target="_blank" title="https://developer.android.com/studio/write/view-binding-migration" ref="nofollow noopener noreferrer">è¿ç§»æ£€æŸ¥æ¸…å•</a><br/>
4ï¸âƒ£ å°†æ­¤æ¬¡å‡çº§è§†ä¸ºæŠ€æœ¯å€ºæ¸…ç†å¥‘æœºï¼ŒåŒæ­¥ä¼˜åŒ–æ¶æ„</p>
</blockquote>
<p><strong>æŠ€æœ¯æ¼”è¿›ä¸å¯é€†</strong>ã€‚ViewBindingä¸ä»…æ˜¯ButterKnifeçš„æ›¿ä»£å“ï¼Œæ›´æ˜¯é€šå¾€Jetpack Composeçš„æ¡¥æ¢ã€‚æœæ–­è¿ç§»ï¼Œæ–¹èƒ½è½»è£…å‰è¡Œï¼Œæ‹¥æŠ±Androidå¼€å‘çš„æœªæ¥ã€‚</p>
<blockquote>
<p><strong>è½¬è½½å£°æ˜</strong>ï¼š<br/>
1ï¸âƒ£ æœ¬æ–‡ç« æœ€æ—©å‘å¸ƒäºç å®¢<br/>
2ï¸âƒ£ æ–‡ç« åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmake.dxmwl.com%2Fp%2F68" target="_blank" title="https://make.dxmwl.com/p/68" ref="nofollow noopener noreferrer">ButterKnifeåœ¨Android 35 + Gradle 8.+ç¯å¢ƒä¸‹çš„é€‚é…å›°å¢ƒä¸ç°ä»£åŒ–è¿ç§»æŒ‡å—</a><br/>
3ï¸âƒ£ è½¬è½½è¯·å…ˆè·å–ä½œè€…æˆæƒ</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidé«˜æ–¯æ¨¡ç³Šï¼šBackgroundBlurDrawableå®æˆ˜é¿å‘æŒ‡å—]]></title>    <link>https://juejin.cn/post/7603563360329072682</link>    <guid>https://juejin.cn/post/7603563360329072682</guid>    <pubDate>2026-02-06T10:46:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360329072682" data-draft-id="7603581886149247030" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidé«˜æ–¯æ¨¡ç³Šï¼šBackgroundBlurDrawableå®æˆ˜é¿å‘æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-06T10:46:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç å“¥_å¸¸"/> <meta itemprop="url" content="https://juejin.cn/user/705230023172650"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidé«˜æ–¯æ¨¡ç³Šï¼šBackgroundBlurDrawableå®æˆ˜é¿å‘æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/705230023172650/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç å“¥_å¸¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:46:12.000Z" title="Fri Feb 06 2026 10:46:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æ ¸å¿ƒç»“è®ºå‰ç½®</strong>ï¼š<br/>
ğŸ”’ <code>BackgroundBlurDrawable</code> æ˜¯ <strong>Androidç³»ç»Ÿå†…éƒ¨éšè—ç±»</strong>ï¼ˆ<code>com.android.internal.widget.BackgroundBlurDrawable</code>ï¼‰ï¼Œ<strong>æ™®é€šåº”ç”¨æ— æ³•ç›´æ¥è°ƒç”¨</strong>ã€‚<br/>
ğŸŒ çœŸæ­£é¢å‘å¼€å‘è€…çš„APIæ˜¯ <strong>WindowManager.LayoutParams.blurBehindRadius</strong>ï¼ˆAndroid 12+ï¼‰ï¼Œä½†å­˜åœ¨ä¸¥é‡æƒé™ä¸å…¼å®¹æ€§é™åˆ¶ã€‚<br/>
âœ… æœ¬æ–‡å°†å½»åº•å˜æ¸…æ¦‚å¿µæ··æ·†ï¼Œå‰–æç³»ç»Ÿçº§æ¨¡ç³Šåº•å±‚é€»è¾‘ï¼Œå¹¶æä¾›æ™®é€šåº”ç”¨å¯è½åœ°çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ¦‚å¿µæ­£æœ¬æ¸…æºï¼šç ´é™¤â€œBackgroundBlurDrawableå¯ç›´æ¥ä½¿ç”¨â€çš„è¿·æ€</h2>
<h3 data-id="heading-1">âŒ å¸¸è§è¯¯è§£</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šå°è¯•ç›´æ¥ä½¿ç”¨BackgroundBlurDrawableï¼ˆç¼–è¯‘å³å¤±è´¥ï¼ï¼‰</span>
<span class="hljs-keyword">import</span> com.android.internal.widget.BackgroundBlurDrawable; <span class="hljs-comment">// âš ï¸ éšè—APIï¼Œæ™®é€šåº”ç”¨æ— æ³•è®¿é—®</span>
</code></pre>
<ul>
<li><strong>çœŸç›¸</strong>ï¼šè¯¥ç±»ä½äºAOSP <code>frameworks/base/core/java/com/android/internal/widget/</code>ï¼Œè¢«<code>@hide</code>æ³¨è§£æ ‡è®°ï¼Œä»…ç³»ç»Ÿè¿›ç¨‹ï¼ˆå¦‚SystemUIï¼‰å¯ç”¨ã€‚</li>
<li><strong>æ··æ·†æ ¹æº</strong>ï¼šéƒ¨åˆ†æŠ€æœ¯åšå®¢å°†â€œçª—å£æ¨¡ç³Šæ•ˆæœâ€ç¬¼ç»Ÿç§°ä¸ºâ€œBackgroundBlurDrawableå®ç°â€ï¼Œå¯¼è‡´å¼€å‘è€…è¯¯ä»¥ä¸ºå­˜åœ¨å…¬å¼€Drawableç±»ã€‚</li>
</ul>
<h3 data-id="heading-2">âœ… æ­£ç¡®æŠ€æœ¯æ ˆå®šä½</h3>



































<table><thead><tr><th>æŠ€æœ¯æ–¹æ¡ˆ</th><th>é€‚ç”¨åœºæ™¯</th><th>å¯ç”¨æ€§</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>WindowManager Blur API</strong></td><td>ç³»ç»Ÿåº”ç”¨/å®šåˆ¶ROM</td><td>éœ€ç³»ç»Ÿç­¾å</td><td>Android 12+</td></tr><tr><td><strong>RenderScript / R8</strong></td><td>æ™®é€šåº”ç”¨å±€éƒ¨æ¨¡ç³Š</td><td>âœ… æ¨è</td><td>æ€§èƒ½å¯æ§</td></tr><tr><td><strong>BlurViewå¼€æºåº“</strong></td><td>æ™®é€šåº”ç”¨UIæ¨¡ç³Š</td><td>âœ… é¦–é€‰</td><td>ç¤¾åŒºç»´æŠ¤æˆç†Ÿ</td></tr><tr><td><code>BackgroundBlurDrawable</code></td><td>ç³»ç»Ÿå†…éƒ¨å®ç°</td><td>âŒ ä¸å¯ç”¨</td><td>ä»…ä½œåŸç†åˆ†æ</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-3">äºŒã€Window Blurå®æˆ˜ï¼šç³»ç»Ÿçº§æ¨¡ç³Šçš„æ­£ç¡®æ‰“å¼€æ–¹å¼ï¼ˆä»…é™ç³»ç»Ÿåº”ç”¨ï¼‰</h2>
<h3 data-id="heading-4">1ï¸âƒ£ å¯ç”¨çª—å£æ¨¡ç³Šï¼ˆéœ€ç³»ç»Ÿç­¾å + <code>BLUR_BEHIND</code>æƒé™ï¼‰</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// AndroidManifest.xmlï¼ˆç³»ç»Ÿåº”ç”¨ä¸“å±ï¼‰</span>
&lt;uses-permission android:name=<span class="hljs-string">"android.permission.BLUR_BEHIND"</span> 
    android:protectionLevel=<span class="hljs-string">"signature|system"</span> /&gt;

<span class="hljs-comment">// Activityä¸­è®¾ç½®</span>
window.addFlags(WindowManager.LayoutParams.FLAG_BLUR_BEHIND)
<span class="hljs-keyword">val</span> params = window.attributes
params.blurBehindRadius = <span class="hljs-number">30</span> <span class="hljs-comment">// æ¨¡ç³ŠåŠå¾„(åƒç´ )</span>
params.blurBehindFlags = 
    WindowManager.LayoutParams.BLUR_BEHIND_FLAG_USE_BLUR_COLOR or
    WindowManager.LayoutParams.BLUR_BEHIND_FLAG_USE_ALPHA
params.blurBehindColor = Color.argb(<span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// å åŠ è‰²</span>
window.attributes = params
</code></pre>
<h3 data-id="heading-5">2ï¸âƒ£ ç³»ç»Ÿå†…éƒ¨å¦‚ä½•å·¥ä½œï¼Ÿï¼ˆAOSPæºç è§†è§’ï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// WindowManagerService.java (ç®€åŒ–é€»è¾‘)</span>
<span class="hljs-keyword">if</span> (params.blurBehindRadius &gt; <span class="hljs-number">0</span> &amp;&amp; hasBlurPermission) {
    <span class="hljs-comment">// åˆ›å»ºBackgroundBlurDrawableå¹¶è®¾ç½®ä¸ºçª—å£èƒŒæ™¯</span>
    <span class="hljs-type">BackgroundBlurDrawable</span> <span class="hljs-variable">blurDrawable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BackgroundBlurDrawable</span>();
    blurDrawable.setBlurRadius(params.blurBehindRadius);
    blurDrawable.setColor(params.blurBehindColor);
    window.setBackgroundDrawable(blurDrawable); <span class="hljs-comment">// ç³»ç»Ÿå†…éƒ¨è°ƒç”¨</span>
}
</code></pre>
<ul>
<li><strong>å…³é”®ç‚¹</strong>ï¼š<code>BackgroundBlurDrawable</code>ç”±WMSåŠ¨æ€åˆ›å»ºï¼Œæ™®é€šåº”ç”¨çª—å£æ— æƒè§¦å‘æ­¤æµç¨‹ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€è¡€æ³ªBugå®å½•ï¼šWindow Bluräº”å¤§è‡´å‘½é™·é˜±</h2>
<h3 data-id="heading-7">ğŸ Bug 1ï¼šAndroid 13+ æƒé™å½»åº•å°é”ï¼ˆæœ€å¸¸è§å´©æºƒï¼‰</h3>
<pre><code class="hljs language-log" lang="log">// éç³»ç»Ÿåº”ç”¨è°ƒç”¨æ—¶LogcatæŠ¥é”™
W/WindowManager: Permission denial: blur behind requires BLUR_BEHIND permission
E/AndroidRuntime: java.lang.SecurityException: 
    Requires BLUR_BEHIND permission (signature|system)
</code></pre>
<ul>
<li><strong>æ ¹å› </strong>ï¼šAndroid 13 (API 33) å°†<code>BLUR_BEHIND</code>æƒé™ä¿æŠ¤çº§åˆ«æå‡ï¼Œ<strong>å½»åº•å…³é—­ç¬¬ä¸‰æ–¹åº”ç”¨ä½¿ç”¨é€šé“</strong>ã€‚</li>
<li><strong>å½±å“èŒƒå›´</strong>ï¼š99%çš„ä¸Šæ¶åº”ç”¨ï¼ˆGoogle Play/å›½å†…å•†åº—ï¼‰æ— æ³•ä½¿ç”¨ã€‚</li>
</ul>
<h3 data-id="heading-8">ğŸ Bug 2ï¼šå‚å•†ROMé­”æ”¹å¯¼è‡´æ•ˆæœå¤±æ•ˆ</h3>

























<table><thead><tr><th>å‚å•†</th><th>è¡¨ç°</th><th>åŸå› </th></tr></thead><tbody><tr><td>å°ç±³ (MIUI 14+)</td><td>æ¨¡ç³ŠåŒºåŸŸå…¨é»‘</td><td>ç¦ç”¨RenderScriptæ¨¡ç³Šè®¡ç®—</td></tr><tr><td>åä¸º (HarmonyOS)</td><td>ä»…çŠ¶æ€æ æ¨¡ç³Š</td><td>è‡ªå®šä¹‰WindowManagerç­–ç•¥</td></tr><tr><td>OPPO (ColorOS)</td><td>æ¨¡ç³Šé—ªçƒ</td><td>å¤šç¼“å†²åŒºæ¸²æŸ“å†²çª</td></tr></tbody></table>
<h3 data-id="heading-9">ğŸ Bug 3ï¼šåœ†è§’çª—å£æ¨¡ç³Šæº¢å‡ºï¼ˆBackgroundBlurDrawableè£å‰ªç¼ºé™·ï¼‰</h3>
<ul>
<li><strong>ç°è±¡</strong>ï¼šå½“Activityè®¾ç½®<code>android:radius="16dp"</code>ï¼Œæ¨¡ç³ŠåŒºåŸŸä»ä¸ºçŸ©å½¢ï¼Œè¾¹ç¼˜å‡ºç°â€œç™½è¾¹æ³„éœ²â€ã€‚</li>
<li><strong>AOSP Issue</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fissuetracker.google.com%2Fissues%2F221897428" target="_blank" title="https://issuetracker.google.com/issues/221897428" ref="nofollow noopener noreferrer">221897428</a>ï¼ˆå®˜æ–¹å·²ç¡®è®¤ï¼Œä¿®å¤ç¼“æ…¢ï¼‰</li>
<li><strong>ä¸´æ—¶è§„é¿</strong>ï¼š
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç”¨FrameLayoutåŒ…è£¹å†…å®¹ï¼Œæ‰‹åŠ¨è£å‰ªæ¨¡ç³ŠåŒºåŸŸ</span>
blurContainer.clipToOutline = <span class="hljs-literal">true</span>
blurContainer.outlineProvider = <span class="hljs-keyword">object</span> : ViewOutlineProvider() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getOutline</span><span class="hljs-params">(view: <span class="hljs-type">View</span>, outline: <span class="hljs-type">Outline</span>)</span></span> {
        outline.setRoundRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, view.width, view.height, <span class="hljs-number">16f</span>.dp)
    }
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-10">ğŸ Bug 4ï¼šå¤šçª—å£/åˆ†å±æ¨¡å¼ä¸‹æ¨¡ç³Šå¤±æ•ˆ</h3>
<ul>
<li><strong>è§¦å‘æ¡ä»¶</strong>ï¼šè®¾å¤‡å¼€å¯åˆ†å±ï¼Œæ¨¡ç³Šçª—å£è¿›å…¥åå°ã€‚</li>
<li><strong>æ—¥å¿—ç‰¹å¾</strong>ï¼š<code>W/BackgroundBlurDrawable: Skipping blur render for non-visible window</code></li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç›‘å¬<code>onMultiWindowModeChanged</code>ï¼ŒåŠ¨æ€å…³é—­/é‡å¯æ¨¡ç³Šã€‚</li>
</ul>
<h3 data-id="heading-11">ğŸ Bug 5ï¼šå†…å­˜æ³„æ¼ï¼ˆç³»ç»Ÿçº§éšæ‚£ï¼‰</h3>
<ul>
<li><strong>LeakCanaryæ£€æµ‹</strong>ï¼š<code>BackgroundBlurDrawable</code>æŒæœ‰<code>SurfaceControl</code>æœªé‡Šæ”¾ã€‚</li>
<li><strong>è§¦å‘åœºæ™¯</strong>ï¼šå¿«é€Ÿè¿ç»­æ‰“å¼€/å…³é—­æ¨¡ç³Šçª—å£ï¼ˆå¦‚Dialogé¢‘ç¹å¼¹å‡ºï¼‰ã€‚</li>
<li><strong>è§„é¿å»ºè®®</strong>ï¼šç³»ç»Ÿåº”ç”¨éœ€åœ¨<code>onDestroy</code>ä¸­æ˜¾å¼æ¸…é™¤ï¼š
<pre><code class="hljs language-java" lang="java">window.clearFlags(WindowManager.LayoutParams.FLAG_BLUR_BEHIND);
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-12">å››ã€æ™®é€šåº”ç”¨ç ´å±€æ–¹æ¡ˆï¼šä¸‰æ‹›å®ç°å®‰å…¨å¯æ§çš„æ¨¡ç³Šæ•ˆæœ</h2>
<h3 data-id="heading-13">âœ… æ–¹æ¡ˆ1ï¼šBlurViewï¼ˆGitHub 18k+ starsï¼‰â€”â€” é¦–é€‰æ¨è</h3>
<pre><code class="hljs language-gradle" lang="gradle">// build.gradle
implementation 'com.github.mmin18:realtimeblurview:1.2.1'
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- å¸ƒå±€æ–‡ä»¶ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">com.github.mmin18.widget.RealtimeBlurView</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"200dp"</span>
    <span class="hljs-attr">app:realtimeBlurRadius</span>=<span class="hljs-string">"15dp"</span>
    <span class="hljs-attr">app:realtimeOverlayColor</span>=<span class="hljs-string">"#80000000"</span>/&gt;</span>
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨é€‚é…Viewå±‚çº§å˜åŒ–</li>
<li>æ”¯æŒç¡¬ä»¶åŠ é€Ÿï¼Œæ€§èƒ½ä¼˜äºRenderScript</li>
<li>æ— æƒé™è¦æ±‚ï¼Œå®Œç¾å…¼å®¹Android 35</li>
</ul>
<h3 data-id="heading-14">âœ… æ–¹æ¡ˆ2ï¼šViewBinding + RenderScriptï¼ˆè½»é‡çº§ï¼‰</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">blurBitmap</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, source: <span class="hljs-type">Bitmap</span>, radius: <span class="hljs-type">Float</span>)</span></span>: Bitmap {
    <span class="hljs-keyword">val</span> rs = RenderScript.create(context)
    <span class="hljs-keyword">val</span> input = Allocation.createFromBitmap(rs, source)
    <span class="hljs-keyword">val</span> output = Allocation.createTyped(rs, input.type)
    <span class="hljs-keyword">val</span> script = ScriptIntrinsicBlur.create(rs, Element.U8_4(rs))
    script.setRadius(radius.coerceIn(<span class="hljs-number">0f</span>, <span class="hljs-number">25f</span>)) <span class="hljs-comment">// é™åˆ¶èŒƒå›´é˜²å´©æºƒ</span>
    script.setInput(input)
    script.forEach(output)
    <span class="hljs-keyword">val</span> result = Bitmap.createBitmap(source.width, source.height, source.config)
    output.copyTo(result)
    rs.destroy()
    <span class="hljs-keyword">return</span> result
}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šAndroid 12+éœ€åœ¨<code>build.gradle</code>ä¸­å¯ç”¨ï¼š</p>
<pre><code class="hljs language-gradle" lang="gradle">android {
    defaultConfig {
        renderscriptTargetApi 23
        renderscriptSupportModeEnabled true
    }
}
</code></pre>
<h3 data-id="heading-15">âœ… æ–¹æ¡ˆ3ï¼šCompose Blur Modifierï¼ˆæœªæ¥è¶‹åŠ¿ï¼‰</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalComposeUiApi::class)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BlurryBackground</span><span class="hljs-params">()</span></span> {
    Box(
        modifier = Modifier
            .fillMaxSize()
            .blur(<span class="hljs-number">16.</span>dp) <span class="hljs-comment">// Android 12+ åŸç”Ÿæ”¯æŒ</span>
            .background(Color.Black.copy(alpha = <span class="hljs-number">0.4f</span>))
    )
}
</code></pre>
<p><strong>é™åˆ¶</strong>ï¼šä»…Android 12+æœ‰æ•ˆï¼Œä½ç‰ˆæœ¬éœ€é™çº§ä¸ºåŠé€æ˜é®ç½©ã€‚</p>
<hr/>
<h2 data-id="heading-16">äº”ã€æŠ€æœ¯é€‰å‹å†³ç­–æ ‘</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[éœ€è¦é«˜æ–¯æ¨¡ç³Šï¼Ÿ] --&gt;|æ˜¯| B{åº”ç”¨ç±»å‹}
    B --&gt;|ç³»ç»Ÿåº”ç”¨/å®šåˆ¶ROM| C[ä½¿ç”¨WindowManager Blur API&lt;br/&gt;æ³¨æ„æƒé™ä¸å‚å•†å…¼å®¹æ€§]
    B --&gt;|æ™®é€šç¬¬ä¸‰æ–¹åº”ç”¨| D{æ¨¡ç³ŠèŒƒå›´}
    D --&gt;|å…¨å±/çª—å£çº§| E[æ”¾å¼ƒWindow Blur&lt;br/&gt;æ”¹ç”¨åŠé€æ˜é®ç½©+å±€éƒ¨æ¨¡ç³Š]
    D --&gt;|å±€éƒ¨UIå…ƒç´ | F[BlurViewå¼€æºåº“]
    F --&gt; G[æ€§èƒ½æ•æ„Ÿï¼Ÿ]
    G --&gt;|æ˜¯| H[RenderScript + é‡‡æ ·ä¼˜åŒ–]
    G --&gt;|å¦| I[BlurViewé»˜è®¤é…ç½®]
    E --&gt; J[ç”¨æˆ·ä½“éªŒå¦¥åæ–¹æ¡ˆ]
</code></pre>
<hr/>
<h2 data-id="heading-17">å…­ã€ç»“è¯­ï¼šç†æ€§çœ‹å¾…æŠ€æœ¯è¾¹ç•Œ</h2>
<ol>
<li><strong>æ‹’ç»å¹»æƒ³</strong>ï¼š<code>BackgroundBlurDrawable</code> å¯¹æ™®é€šå¼€å‘è€…æ˜¯â€œç©ºä¸­æ¥¼é˜â€ï¼ŒæŠ•å…¥ç ”ç©¶æˆæœ¬æé«˜ä¸”æ— äº§å‡ºã€‚</li>
<li><strong>æ‹¥æŠ±ç°å®</strong>ï¼š
<ul>
<li>ç³»ç»Ÿåº”ç”¨ï¼šç´§ç›¯AOSPæ›´æ–°ï¼Œåšå¥½å‚å•†é€‚é…çŸ©é˜µæµ‹è¯•</li>
<li>æ™®é€šåº”ç”¨ï¼š<strong>BlurViewæ˜¯å½“å‰æœ€ä¼˜è§£</strong>ï¼Œç¤¾åŒºæ´»è·ƒã€æ–‡æ¡£å®Œå–„ã€æ— å…¼å®¹é£é™©</li>
</ul>
</li>
<li><strong>æœªæ¥å±•æœ›</strong>ï¼š
<ul>
<li>Android 15 å¯èƒ½å¼€æ”¾<code>WindowInsetsController</code>æ¨¡ç³ŠAPIï¼ˆéœ€å…³æ³¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fwindow" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/window" ref="nofollow noopener noreferrer">AndroidX Window</a>ï¼‰</li>
<li>Jetpack Compose Blur Modifier å°†æˆä¸ºè·¨ç‰ˆæœ¬æ ‡å‡†æ–¹æ¡ˆ</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>æœ€åå¿ å‘Š</strong>ï¼š<br/>
æŠ€æœ¯é€‰å‹çš„æœ¬è´¨æ˜¯ <strong>â€œåœ¨çº¦æŸæ¡ä»¶ä¸‹å¯»æ‰¾æœ€ä¼˜è§£â€</strong>ã€‚<br/>
å½“ç³»ç»Ÿå…³é—­ä¸€æ‰‡é—¨ï¼Œç¤¾åŒºæ—©å·²ä¸ºä½ æ‰“å¼€ä¸€æ‰‡çª—â€”â€”<br/>
<strong>æ”¾ä¸‹å¯¹éšè—APIçš„æ‰§å¿µï¼Œç”¨æˆç†Ÿæ–¹æ¡ˆäº¤ä»˜ç¨³å®šä½“éªŒï¼Œæ‰æ˜¯å·¥ç¨‹å¸ˆçš„çœŸæ­£æ™ºæ…§ã€‚</strong></p>
</blockquote>
<p>ğŸ“š <strong>å»¶ä¼¸é˜…è¯»</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fwindow" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/window" ref="nofollow noopener noreferrer">AndroidX Window æ¨¡ç³ŠAPIè¿›å±•</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmmin18%2FRealtimeBlurView" target="_blank" title="https://github.com/mmin18/RealtimeBlurView" ref="nofollow noopener noreferrer">BlurView GitHubä»“åº“</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroid%2Fplatform%2Fsuperproject%2F%2B%2Fmaster%3Aframeworks%2Fbase%2Fcore%2Fjava%2Fcom%2Fandroid%2Finternal%2Fwidget%2FBackgroundBlurDrawable.java" target="_blank" title="https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/com/android/internal/widget/BackgroundBlurDrawable.java" ref="nofollow noopener noreferrer">AOSP BackgroundBlurDrawableæºç </a></li>
</ul>
<blockquote>
<p><strong>è½¬è½½å£°æ˜</strong>ï¼š<br/>
1ï¸âƒ£ æœ¬æ–‡ç« æœ€æ—©å‘å¸ƒäºç å®¢<br/>
2ï¸âƒ£ æ–‡ç« åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmake.dxmwl.com%2Fp%2F69" target="_blank" title="https://make.dxmwl.com/p/69" ref="nofollow noopener noreferrer">Androidé«˜æ–¯æ¨¡ç³Šï¼šBackgroundBlurDrawableå®æˆ˜é¿å‘æŒ‡å—</a>
3ï¸âƒ£ è½¬è½½è¯·å…ˆè·å–ä½œè€…æˆæƒ</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸€ï¼‰ï¼šConnectivityServiceä¸ç½‘ç»œç®¡ç†æ¡†æ¶å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7603376587652415538</link>    <guid>https://juejin.cn/post/7603376587652415538</guid>    <pubDate>2026-02-06T10:47:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603376587652415538" data-draft-id="7603556326815809588" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸€ï¼‰ï¼šConnectivityServiceä¸ç½‘ç»œç®¡ç†æ¡†æ¶å…¨è§£æ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-06T10:47:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸€ï¼‰ï¼šConnectivityServiceä¸ç½‘ç»œç®¡ç†æ¡†æ¶å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:47:09.000Z" title="Fri Feb 06 2026 10:47:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»50åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>1ã€ConnectivityService æ¶æ„æ€»è§ˆ</strong></h3>
<h4 data-id="heading-1"><strong>1.1 æ ¸å¿ƒèŒè´£ä¸è®¾è®¡ç†å¿µ</strong></h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-operator">ã€</span><span class="hljs-type">ConnectivityService</span> çš„äº”å¤§æ ¸å¿ƒèŒè´£<span class="hljs-operator">ã€‘</span>
<span class="hljs-operator">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="hljs-number">1</span>ï¸âƒ£ ç½‘ç»œç›‘æ§ä¸å‘ç°ï¼ˆ<span class="hljs-type">Network</span> <span class="hljs-type">Monitoring</span> &amp; <span class="hljs-type">Discoveryï¼‰</span>
<span class="hljs-operator">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

æ ¸å¿ƒåŠŸèƒ½ï¼š
<span class="hljs-operator">â”œâ”€</span> ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£çš„çŠ¶æ€å˜åŒ–
<span class="hljs-operator">â”œâ”€</span> æ£€æµ‹æ–°ç½‘ç»œçš„å‡ºç°ï¼ˆ<span class="hljs-type">WiFi</span><span class="hljs-operator">ã€</span><span class="hljs-type">LTE</span><span class="hljs-operator">ã€</span><span class="hljs-type">Ethernet</span> ç­‰ï¼‰
<span class="hljs-operator">â”œâ”€</span> ç»´æŠ¤ <span class="hljs-type">NetworkAgentInfo</span> åˆ—è¡¨ï¼ˆæ‰€æœ‰å·²çŸ¥ç½‘ç»œï¼‰
<span class="hljs-operator">â”œâ”€</span> è·Ÿè¸ªç½‘ç»œçš„è¿æ¥<span class="hljs-operator">/</span>æ–­å¼€äº‹ä»¶

å®ç°æ–¹å¼ï¼š
<span class="hljs-operator">â”œâ”€</span> é€šè¿‡ <span class="hljs-type">INetworkAgent</span> <span class="hljs-type">AIDL</span> æ¥å£æ¥æ”¶æ¥è‡ªç½‘ç»œæä¾›è€…çš„æ›´æ–°
<span class="hljs-operator">â”œâ”€</span> <span class="hljs-type">NetworkAgent</span> åœ¨ç½‘ç»œçŠ¶æ€å˜åŒ–æ—¶è°ƒç”¨ï¼š
<span class="hljs-operator">â”‚</span>  <span class="hljs-operator">â”œâ”€</span> markConnected() <span class="hljs-operator">-</span> æ ‡è®°ä¸ºè¿æ¥
<span class="hljs-operator">â”‚</span>  <span class="hljs-operator">â”œâ”€</span> unregister() <span class="hljs-operator">-</span> æ ‡è®°ä¸ºæ–­å¼€
<span class="hljs-operator">â”‚</span>  <span class="hljs-operator">â””â”€</span> sendNetworkCapabilities<span class="hljs-operator">/</span><span class="hljs-type">LinkProperties</span> <span class="hljs-operator">-</span> å‘é€èƒ½åŠ›æ›´æ–°
<span class="hljs-operator">â””â”€</span> <span class="hljs-type">ConnectivityService</span> ç»´æŠ¤ç½‘ç»œåˆ—è¡¨å¹¶åŠæ—¶å“åº”

æ•°æ®ç»“æ„ï¼š
```java
<span class="hljs-comment">// æ‰€æœ‰å·²æ³¨å†Œçš„ç½‘ç»œä»£ç†</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">NetworkAgentInfo</span>&gt; mNetworkAgents <span class="hljs-operator">=</span> new <span class="hljs-type">ArrayList</span>&lt;&gt;();

<span class="hljs-comment">// ç½‘ç»œè¯„åˆ†ï¼ˆç”¨äºé€‰æ‹©æœ€ä½³ç½‘ç»œï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">Network</span>, <span class="hljs-type">NetworkScore</span>&gt; mNetworkScores <span class="hljs-operator">=</span> new <span class="hljs-type">HashMap</span>&lt;&gt;();

<span class="hljs-comment">// ç½‘ç»œçŠ¶æ€è·Ÿè¸ª</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">Network</span>, <span class="hljs-type">NetworkInfo</span>&gt; mNetworkInfos <span class="hljs-operator">=</span> new <span class="hljs-type">HashMap</span>&lt;&gt;();
</code></pre>
<p>2ï¸âƒ£ ç½‘ç»œè¯·æ±‚åŒ¹é…ä¸è·¯ç”±ï¼ˆNetwork Request Matching &amp; Routingï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>æ ¸å¿ƒåŠŸèƒ½ï¼š
â”œâ”€ ç®¡ç†åº”ç”¨çš„ç½‘ç»œè¯·æ±‚ï¼ˆNetworkRequestï¼‰
â”œâ”€ åŒ¹é…ç½‘ç»œä¸è¯·æ±‚çš„å…³ç³»
â”œâ”€ ä¸ºåº”ç”¨åˆ†é…æœ€åˆé€‚çš„ç½‘ç»œ
â”œâ”€ å¤„ç†ç½‘ç»œåˆ‡æ¢é€»è¾‘</p>
<p>è¯·æ±‚ç±»å‹ï¼š
â”œâ”€ LISTEN è¯·æ±‚ï¼šç›‘å¬ç‰¹å®šç½‘ç»œï¼ˆä¸ä½¿ç”¨ï¼‰
â”œâ”€ REQUEST è¯·æ±‚ï¼šè¦æ±‚ç‰¹å®šç½‘ç»œï¼ˆä½¿ç”¨ï¼‰
â”œâ”€ TRACK_DEFAULT è¯·æ±‚ï¼šè·Ÿè¸ªé»˜è®¤ç½‘ç»œå˜åŒ–
â””â”€ LISTEN_FOR_BEST è¯·æ±‚ï¼šç›‘å¬æœ€å¥½çš„ç½‘ç»œ</p>
<p>åŒ¹é…ç®—æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rematchAllNetworksAndRequests</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// æ­¥éª¤ 1ï¼šè·å–æ‰€æœ‰ç½‘ç»œï¼ŒæŒ‰è¯„åˆ†æ’åºï¼ˆä»é«˜åˆ°ä½ï¼‰</span>
    List&lt;NetworkAgentInfo&gt; sorted = sortNetworksByScore(mNetworkAgents);
    
    <span class="hljs-comment">// æ­¥éª¤ 2ï¼šå¯¹äºæ¯ä¸ªç½‘ç»œï¼Œæ‰¾å‡ºæ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¯·æ±‚</span>
    <span class="hljs-keyword">for</span> (NetworkAgentInfo nai : sorted) {
        <span class="hljs-keyword">for</span> (NetworkRequestInfo nri : mNetworkRequests) {
            <span class="hljs-keyword">if</span> (networkSatisfiesRequest(nai, nri.request)) {
                <span class="hljs-comment">// æ­¥éª¤ 3ï¼šä¸ºè¯·æ±‚åˆ†é…ç½‘ç»œ</span>
                allocateNetworkForRequest(nai, nri);
            }
        }
    }
    
    <span class="hljs-comment">// æ­¥éª¤ 4ï¼šé€šçŸ¥åº”ç”¨æœ‰æ–°ç½‘ç»œå¯ç”¨</span>
    notifyNetworkCallbacks();
}
</code></pre>
<p>ç½‘ç»œåŒ¹é…çš„æ ¸å¿ƒé€»è¾‘ï¼ˆSimplifyNetworkCapabilitiesï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">networkSatisfiesRequest</span><span class="hljs-params">(
    NetworkAgentInfo nai, NetworkRequest request)</span> {
    
    <span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">caps</span> <span class="hljs-operator">=</span> nai.networkCapabilities;
    
    <span class="hljs-comment">// æ£€æŸ¥ REQUIRED èƒ½åŠ›ï¼ˆå¿…é¡»æ»¡è¶³ï¼‰</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> reqCap : request.getCapabilities()) {
        <span class="hljs-keyword">if</span> (!caps.hasCapability(reqCap)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// âŒ ç½‘ç»œä¸æ»¡è¶³è¦æ±‚</span>
        }
    }
    
    <span class="hljs-comment">// æ£€æŸ¥ UNWANTED èƒ½åŠ›ï¼ˆä¸èƒ½æœ‰ï¼‰</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> unwantedCap : request.getUnwantedCapabilities()) {
        <span class="hljs-keyword">if</span> (caps.hasCapability(unwantedCap)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// âŒ ç½‘ç»œæœ‰ä¸éœ€è¦çš„èƒ½åŠ›</span>
        }
    }
    
    <span class="hljs-comment">// å¦‚æœæŒ‡å®šäº†ç‰¹å®šä¼ è¾“æ–¹å¼</span>
    <span class="hljs-keyword">if</span> (request.hasTransportType()) {
        <span class="hljs-keyword">if</span> (!caps.hasTransport(request.getTransport())) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// âŒ ä¼ è¾“æ–¹å¼ä¸åŒ¹é…</span>
        }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// âœ“ ç½‘ç»œæ»¡è¶³æ‰€æœ‰è¦æ±‚</span>
}
</code></pre>
<p>3ï¸âƒ£ ç½‘ç»œçŠ¶æ€ä¸ŠæŠ¥ä¸å¹¿æ’­ï¼ˆNetwork State Reporting &amp; Broadcastingï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>æ ¸å¿ƒåŠŸèƒ½ï¼š
â”œâ”€ æ”¶é›†ç½‘ç»œçŠ¶æ€ä¿¡æ¯ï¼ˆè¿æ¥ã€æ–­å¼€ã€èƒ½åŠ›å˜åŒ–ç­‰ï¼‰
â”œâ”€ é€šçŸ¥åº”ç”¨ç½‘ç»œå˜åŒ–ï¼ˆé€šè¿‡ NetworkCallbackï¼‰
â”œâ”€ å‘é€ CONNECTIVITY_ACTION å¹¿æ’­ç»™ç³»ç»Ÿ
â”œâ”€ æ›´æ–°é»˜è®¤ç½‘ç»œ</p>
<p>ç½‘ç»œçŠ¶æ€å˜åŒ–çš„ä¸ŠæŠ¥æµç¨‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">NetworkAgent çŠ¶æ€å˜åŒ–
        â†“
ConnectivityService<span class="hljs-selector-class">.handleNetworkInfoChange</span>()
        â†“
<span class="hljs-built_in">notifyNetworkCallbacks</span>(nai, callbackType)
        â†“
é€šçŸ¥æ‰€æœ‰ç›‘å¬è¯¥ç½‘ç»œçš„ NetworkCallback
        â†“
App æ”¶åˆ°å›è°ƒ
    â”œâ”€ <span class="hljs-built_in">onAvailable</span>(Network)
    â”œâ”€ <span class="hljs-built_in">onCapabilitiesChanged</span>(Network, caps)
    â”œâ”€ <span class="hljs-built_in">onLinkPropertiesChanged</span>(Network, lp)
    â””â”€ <span class="hljs-built_in">onLost</span>(Network)
</code></pre>
<p>æ‰€æœ‰æ”¯æŒçš„å›è°ƒç±»å‹ï¼ˆCallbackTypeï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Framework èƒ½åŠ›ç›¸å…³</span>
CALLBACK_PRECHECK           <span class="hljs-comment">// ç½‘ç»œé¢„æ£€æŸ¥ï¼ˆéªŒè¯å‰ï¼‰</span>
CALLBACK_AVAILABLE          <span class="hljs-comment">// ç½‘ç»œå¯ç”¨</span>
CALLBACK_LOSING             <span class="hljs-comment">// ç½‘ç»œå³å°†ä¸§å¤±ï¼ˆLinger çŠ¶æ€ï¼‰</span>
CALLBACK_LOST               <span class="hljs-comment">// ç½‘ç»œå·²ä¸§å¤±</span>
CALLBACK_UNAVAILABLE        <span class="hljs-comment">// ç½‘ç»œä¸å¯ç”¨</span>

<span class="hljs-comment">// èƒ½åŠ›ä¸å±æ€§å˜åŒ–</span>
CALLBACK_CAPABILITIES_CHANGED     <span class="hljs-comment">// èƒ½åŠ›å˜åŒ–</span>
CALLBACK_LINK_PROPERTIES_CHANGED  <span class="hljs-comment">// é“¾è·¯å±æ€§å˜åŒ–</span>
CALLBACK_IP_CHANGED               <span class="hljs-comment">// IP åœ°å€å˜åŒ–</span>

<span class="hljs-comment">// éªŒè¯ç›¸å…³</span>
CALLBACK_NETWORK_STATE_CHANGED    <span class="hljs-comment">// ç½‘ç»œéªŒè¯çŠ¶æ€å˜åŒ–</span>
CALLBACK_PROVISIONING_CHANGED     <span class="hljs-comment">// é…ç½®çŠ¶æ€å˜åŒ–</span>

<span class="hljs-comment">// é«˜çº§å›è°ƒ</span>
CALLBACK_BLK_CHANGED              <span class="hljs-comment">// é˜»å¡çŠ¶æ€å˜åŒ–</span>
CALLBACK_SUSPENDED                <span class="hljs-comment">// ç½‘ç»œæš‚åœ</span>
CALLBACK_RESUMED                  <span class="hljs-comment">// ç½‘ç»œæ¢å¤</span>
</code></pre>
<p>4ï¸âƒ£ ç½‘ç»œéªŒè¯ä¸è¯„ä¼°ï¼ˆNetwork Validation &amp; Assessmentï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>æ ¸å¿ƒåŠŸèƒ½ï¼š
â”œâ”€ ç¡®å®šç½‘ç»œæ˜¯å¦æœ‰çœŸæ­£çš„äº’è”ç½‘è¿æ¥
â”œâ”€ æ£€æµ‹æ˜¯å¦å­˜åœ¨å¼ºåˆ¶é—¨æˆ·ï¼ˆCaptive Portalï¼‰
â”œâ”€ è¯„ä¼°ç½‘ç»œçš„è¿é€šæ€§è´¨é‡
â”œâ”€ æ ¹æ®éªŒè¯ç»“æœæ›´æ–°ç½‘ç»œèƒ½åŠ›</p>
<p>éªŒè¯è¿‡ç¨‹ï¼ˆ3 ä¸ªé˜¶æ®µï¼‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">é˜¶æ®µ</span> <span class="hljs-attr">1:</span> <span class="hljs-string">ç½‘ç»œè¿æ¥</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">NetworkAgent</span> <span class="hljs-string">è°ƒç”¨</span> <span class="hljs-string">markConnected()</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç½‘ç»œæ ‡è®°ä¸ºå·²è¿æ¥ï¼ˆLOCAL_NETWORK</span> <span class="hljs-string">é™¤å¤–ï¼‰</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">å¦‚æœç½‘ç»œæ»¡è¶³</span> <span class="hljs-string">INTERNET</span> <span class="hljs-string">è¦æ±‚ï¼Œè¿›å…¥éªŒè¯</span>

<span class="hljs-string">é˜¶æ®µ</span> <span class="hljs-attr">2:</span> <span class="hljs-string">NetworkMonitor</span> <span class="hljs-string">æ¢æµ‹</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å‘é€</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">è¯·æ±‚åˆ°</span> <span class="hljs-string">captive</span> <span class="hljs-string">portal</span> <span class="hljs-string">æ£€æµ‹æœåŠ¡å™¨</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ£€æŸ¥</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">é‡å®šå‘ï¼ˆå¼ºåˆ¶é—¨æˆ·ï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å‘é€</span> <span class="hljs-string">DNS</span> <span class="hljs-string">æŸ¥è¯¢ï¼ˆDNS</span> <span class="hljs-string">å¯è¾¾æ€§ï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">éªŒè¯</span> <span class="hljs-string">HTTPSï¼ˆç§æœ‰</span> <span class="hljs-string">DNSï¼‰</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">æ ¹æ®ç»“æœè¿”å›éªŒè¯çŠ¶æ€</span>

<span class="hljs-string">é˜¶æ®µ</span> <span class="hljs-attr">3:</span> <span class="hljs-string">æ›´æ–°</span> <span class="hljs-string">NET_CAPABILITY_VALIDATED</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å¦‚æœæ‰€æœ‰æ¢æµ‹é€šè¿‡</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ·»åŠ </span> <span class="hljs-string">NET_CAPABILITY_VALIDATED</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å¦‚æœå­˜åœ¨å¼ºåˆ¶é—¨æˆ·</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ·»åŠ </span> <span class="hljs-string">NET_CAPABILITY_CAPTIVE_PORTAL</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">å¦‚æœåªæœ‰éƒ¨</span>

<span class="hljs-string">åˆ†è¿é€š</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ·»åŠ </span> <span class="hljs-string">NET_CAPABILITY_PARTIAL_CONNECTIVITY</span>
</code></pre>
<p>éªŒè¯æ—¶é—´çº¿ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>: ç½‘ç»œè¿æ¥
     â””â”€ NetworkAgent.markConnected() è¢«è°ƒç”¨

<span class="hljs-attr">T</span>=<span class="hljs-number">1</span>: ConnectivityService åˆ›å»ºç½‘ç»œ
     â”œâ”€ é€šçŸ¥ NetworkMonitor å¼€å§‹éªŒè¯
     â””â”€ å¦‚æœç½‘ç»œæ»¡è¶³ INTERNET è¦æ±‚

<span class="hljs-attr">T</span>=<span class="hljs-number">2</span>-<span class="hljs-number">5</span>s: NetworkMonitor æ¢æµ‹
     â”œâ”€ HTTP GET åˆ° Google çš„æ¢æµ‹æœåŠ¡å™¨
     â”œâ”€ DNS æŸ¥è¯¢ Google åŸŸå
     â””â”€ HTTPS è¿æ¥æµ‹è¯•

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s: éªŒè¯å®Œæˆ
     â”œâ”€ æ›´æ–° NET_CAPABILITY_VALIDATED
     â”œâ”€ å°†ç½‘ç»œæ ‡è®°ä¸º"å°±ç»ª"
     â””â”€ åº”ç”¨å¯ä»¥ä½¿ç”¨è¯¥ç½‘ç»œ
</code></pre>
<p>éªŒè¯ç»“æœï¼ˆ6 ç§ï¼‰ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> NETWORK<span class="hljs-emphasis">_VALIDATION_</span>RESULT<span class="hljs-emphasis">_VALID
   â””â”€ ç½‘ç»œå¯ä»¥è®¿é—®äº’è”ç½‘ï¼Œæ²¡æœ‰å¼ºåˆ¶é—¨æˆ·
   â””â”€ æ·»åŠ  NET_</span>CAPABILITY<span class="hljs-emphasis">_VALIDATED

2. NETWORK_</span>VALIDATION<span class="hljs-emphasis">_RESULT_</span>PARTIAL
   â””â”€ ç½‘ç»œæœ‰éƒ¨åˆ†è¿é€šï¼ˆä¾‹å¦‚åªæœ‰ IPv4 æˆ– IPv6ï¼‰
   â””â”€ æ·»åŠ  NET<span class="hljs-emphasis">_CAPABILITY_</span>PARTIAL<span class="hljs-emphasis">_CONNECTIVITY

3. NETWORK_</span>VALIDATION<span class="hljs-emphasis">_RESULT_</span>SKIPPED
   â””â”€ éªŒè¯è¢«è·³è¿‡ï¼ˆä¾‹å¦‚ LOCAL<span class="hljs-emphasis">_NETWORKï¼‰
   â””â”€ ä¸æ·»åŠ ä»»ä½•éªŒè¯èƒ½åŠ›

4. NETWORK_</span>VALIDATION<span class="hljs-emphasis">_RESULT_</span>PORTAL<span class="hljs-emphasis">_DETECTED
   â””â”€ æ£€æµ‹åˆ°å¼ºåˆ¶é—¨æˆ·
   â””â”€ æ·»åŠ  NET_</span>CAPABILITY<span class="hljs-emphasis">_CAPTIVE_</span>PORTAL

<span class="hljs-bullet">5.</span> NETWORK<span class="hljs-emphasis">_VALIDATION_</span>RESULT<span class="hljs-emphasis">_OFFLINE_</span>DETECTED
   â””â”€ ç½‘ç»œå®Œå…¨ç¦»çº¿ï¼ˆä¸èƒ½è®¿é—®ä»»ä½•å¤–éƒ¨èµ„æºï¼‰
   â””â”€ ä¸æ·»åŠ ä»»ä½•éªŒè¯èƒ½åŠ›

<span class="hljs-bullet">6.</span> NETWORK<span class="hljs-emphasis">_VALIDATION_</span>RESULT<span class="hljs-emphasis">_INVALID
   â””â”€ éªŒè¯å¤±è´¥ï¼ˆæœªçŸ¥åŸå› ï¼‰
   â””â”€ ä¸æ·»åŠ ä»»ä½•éªŒè¯èƒ½åŠ›
</span></code></pre>
<p>5ï¸âƒ£ ç½‘ç»œç­–ç•¥æ‰§è¡Œä¸æµé‡æ§åˆ¶ï¼ˆNetwork Policy &amp; Traffic Controlï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>æ ¸å¿ƒåŠŸèƒ½ï¼š
â”œâ”€ å®æ–½åå°åº”ç”¨é™åˆ¶
â”œâ”€ æ§åˆ¶æµé‡è®¡é‡ï¼ˆMeteredï¼‰
â”œâ”€ æ•°æ®ä½¿ç”¨é™åˆ¶ä¸è­¦å‘Š
â”œâ”€ çœæµé‡æ¨¡å¼ï¼ˆData Saverï¼‰
â”œâ”€ App æƒé™ä¸ç½‘ç»œè®¿é—®æ§åˆ¶</p>
<p>æµé‡æ§åˆ¶å±‚çº§ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Layer 1:</span> <span class="hljs-string">å…¨å±€ç­–ç•¥</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Background</span> <span class="hljs-string">Restrictionï¼ˆåå°é™åˆ¶ï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Data</span> <span class="hljs-string">Saver</span> <span class="hljs-string">Modeï¼ˆçœæµé‡ï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Doze</span> <span class="hljs-string">Modeï¼ˆæ‰“çŒç¡æ¨¡å¼ï¼‰</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">Power</span> <span class="hljs-string">Save</span> <span class="hljs-string">Modeï¼ˆçœç”µï¼‰</span>

        <span class="hljs-string">â†“</span>
<span class="hljs-attr">Layer 2:</span> <span class="hljs-string">UID</span> <span class="hljs-string">çº§é™åˆ¶</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">åº”ç”¨æ˜¯å¦åœ¨åå°è¿è¡Œ</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">åº”ç”¨æ˜¯å¦è¢«å†»ç»“</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">åº”ç”¨æ˜¯å¦è¢«é”å®š</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">åº”ç”¨çš„æƒé™ï¼ˆINTERNET,</span> <span class="hljs-string">ACCESS_NETWORK_STATE</span> <span class="hljs-string">ç­‰ï¼‰</span>

        <span class="hljs-string">â†“</span>
<span class="hljs-attr">Layer 3:</span> <span class="hljs-string">ç½‘ç»œçº§é™åˆ¶</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç½‘ç»œæ˜¯å¦è¢«è®¡é‡ï¼ˆMETEREDï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç½‘ç»œæ˜¯å¦è¢«æ¼«æ¸¸ï¼ˆROAMINGï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç½‘ç»œæ˜¯å¦å—é™ï¼ˆRESTRICTEDï¼‰</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">ç½‘ç»œçš„</span> <span class="hljs-string">VPN</span> <span class="hljs-string">çŠ¶æ€</span>

        <span class="hljs-string">â†“</span>
<span class="hljs-attr">Layer 4:</span> <span class="hljs-string">BPF</span> <span class="hljs-string">é˜²ç«å¢™æ‰§è¡Œ</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">eBPF</span> <span class="hljs-string">åœ¨å†…æ ¸ç½‘ç»œæ ˆä¸­æ‹¦æˆªæ•°æ®åŒ…</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ ¹æ®</span> <span class="hljs-string">UID</span> <span class="hljs-string">+</span> <span class="hljs-string">Network</span> <span class="hljs-string">+</span> <span class="hljs-string">Policy</span> <span class="hljs-string">å†³å®šæ˜¯å¦è½¬å‘</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">å®æ—¶ç”Ÿæ•ˆï¼Œæ— å»¶è¿Ÿ</span>
</code></pre>
<p>æ•°æ®æµä¸ç½‘ç»œè®¿é—®å†³ç­–ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNetworkBlockStatus</span><span class="hljs-params">(<span class="hljs-type">int</span> uid, Network network)</span> {
    <span class="hljs-comment">// æ­¥éª¤ 1: æ£€æŸ¥åº”ç”¨æ˜¯å¦æœ‰ INTERNET æƒé™</span>
    <span class="hljs-keyword">if</span> (!hasPermission(uid, Manifest.permission.INTERNET)) {
        block(uid, network);
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// æ­¥éª¤ 2: æ£€æŸ¥åº”ç”¨æ˜¯å¦åœ¨åå°</span>
    <span class="hljs-keyword">if</span> (isUidInBackground(uid)) {
        <span class="hljs-keyword">if</span> (mRestrictBackgroundEnabled) {
            block(uid, network);
            <span class="hljs-keyword">return</span>;
        }
    }
    
    <span class="hljs-comment">// æ­¥éª¤ 3: æ£€æŸ¥ç½‘ç»œæ˜¯å¦è®¡é‡</span>
    <span class="hljs-keyword">if</span> (isNetworkMetered(network)) {
        <span class="hljs-keyword">if</span> (isDataSaverEnabled() &amp;&amp; !isWhitelisted(uid)) {
            block(uid, network);
            <span class="hljs-keyword">return</span>;
        }
    }
    
    <span class="hljs-comment">// æ­¥éª¤ 4: æ£€æŸ¥ VPN å’Œç‰¹æ®Šè§’è‰²</span>
    <span class="hljs-keyword">if</span> (isNetworkVPN(network)) {
        <span class="hljs-comment">// VPN æµé‡é€šå¸¸æœ‰ç‰¹æ®Šå¤„ç†</span>
    }
    
    <span class="hljs-comment">// æ­¥éª¤ 5: é€šè¿‡ BPF é˜²ç«å¢™æ‰§è¡Œ</span>
    applyFirewallRule(uid, network, ALLOW);
}
</code></pre>
<pre><code class="hljs language-markdown" lang="markdown">
<span class="hljs-section">#### <span class="hljs-strong">**1.2 ä¸å…¶ä»–ç³»ç»ŸæœåŠ¡çš„å…³ç³»**</span></span>

</code></pre>
<p>ã€ConnectivityService çš„ä¾èµ–å…³ç³»ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚      SystemServer               â”‚
      â”‚ (å¯åŠ¨æ‰€æœ‰ç³»ç»ŸæœåŠ¡çš„å…¥å£)        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                â”‚
       â–¼                                â–¼
</span></code></pre>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ConnectivityService     â”‚â—„â”€â”€â”€â”¤ NetworkManagementSvc â”‚
â”‚                         â”‚    â”‚ (Netd æ¥å£)          â”‚
â”‚ æ ¸å¿ƒç½‘ç»œç®¡ç†æœåŠ¡        â”‚    â”‚                      â”‚
â”‚ - ç½‘ç»œç›‘æ§             â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - è¯·æ±‚åŒ¹é…             â”‚             â–³
â”‚ - è·¯ç”±å†³ç­–             â”‚             â”‚
â”‚ - ç­–ç•¥æ‰§è¡Œ             â”‚      INetd æ¥å£
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                          (Linux netlink socket)
â”‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚             â”‚
â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NetworkMonitor                   â”‚    â”‚ DnsResolver     â”‚
â”‚ (ç½‘ç»œéªŒè¯)                       â”‚    â”‚ (DNS è§£æ)      â”‚
â”‚ - æ£€æµ‹å¼ºåˆ¶é—¨æˆ·                   â”‚    â”‚                 â”‚
â”‚ - éªŒè¯äº’è”ç½‘è¿é€šæ€§               â”‚    â”‚ ä¸ NetworkMonitor
â”‚ - æ£€æµ‹ç½‘ç»œè´¨é‡                   â”‚    â”‚ åä½œéªŒè¯ç½‘ç»œ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code class="hljs"> â–¼
</code></pre>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WifiManager / WiFiService    â”‚     â”‚ TelephonyManager     â”‚
â”‚ (WiFi ç½‘ç»œä»£ç†)              â”‚     â”‚ (ç§»åŠ¨ç½‘ç»œä»£ç†)       â”‚
â”‚ - æ³¨å†Œ WifiNetworkAgent      â”‚     â”‚ - æ³¨å†Œ Cellular      â”‚
â”‚ - æŠ¥å‘Š WiFi çŠ¶æ€             â”‚     â”‚   NetworkAgent       â”‚
â”‚ - WiFi æ‰«æä¸è¿æ¥            â”‚     â”‚ - æŠ¥å‘Šèœ‚çªçŠ¶æ€       â”‚
â”‚                              â”‚     â”‚ - ä¿¡å·å¼ºåº¦æ›´æ–°       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code class="hljs language-markdown" lang="markdown"> â”‚                                      â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">                â”‚
     NetworkAgent æ¥å£ (AIDL)
                â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                            â”‚
  â–¼                            â–¼
</span></code></pre>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VpnManager       â”‚         â”‚ EthernetManager  â”‚
â”‚ (VPN ä»£ç†)       â”‚         â”‚ (ä»¥å¤ªç½‘ä»£ç†)     â”‚
â”‚                  â”‚         â”‚                  â”‚
â”‚ - VPN è¿æ¥       â”‚         â”‚ - æœ‰çº¿ç½‘ç»œ       â”‚
â”‚ - åº”ç”¨ VPN è·¯ç”±  â”‚         â”‚ - ä¼ä¸šç½‘ç»œ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code class="hljs">
å…³é”®äº¤äº’æµï¼š

</code></pre>
<p>ã€ç½‘ç»œè¯·æ±‚çš„å®Œæ•´å¤„ç†æµç¨‹ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>åº”ç”¨å±‚
â”œâ”€ App è°ƒç”¨ ConnectivityManager.requestNetwork()
â””â”€ å‘é€ NetworkRequest åˆ° ConnectivityService</p>
<p>ConnectivityService (ä¸»çº¿ç¨‹ Handler)
â”œâ”€ æ¥æ”¶ NetworkRequestï¼ˆé€šè¿‡ Binderï¼‰
â”œâ”€ åˆ›å»º NetworkRequestInfo
â”œâ”€ è°ƒç”¨ rematchAllNetworksAndRequests()
â””â”€ å°†è¯·æ±‚å‘é€ç»™ NetworkFactory</p>
<p>NetworkFactoryï¼ˆé€šå¸¸åœ¨ WifiService æˆ– TelephonyManagerï¼‰
â”œâ”€ æ¥æ”¶è¯·æ±‚
â”œâ”€ æ£€æŸ¥æ˜¯å¦å¯ä»¥æ»¡è¶³ï¼ˆä¿¡å·å¼ºåº¦ã€èµ„æºå¯ç”¨æ€§ï¼‰
â”œâ”€ å¦‚æœå¯ä»¥ï¼šå¯åŠ¨ç½‘ç»œè¿æ¥æµç¨‹
â”œâ”€ å¦‚æœä¸èƒ½ï¼šç­‰å¾…æ¡ä»¶æ”¹å–„æˆ–æ‹’ç»
â””â”€ åˆ›å»º NetworkAgent</p>
<p>NetworkAgentï¼ˆæ–°ç½‘ç»œï¼‰
â”œâ”€ è°ƒç”¨ register() å‘ ConnectivityService æ³¨å†Œ
â”œâ”€ åˆå§‹çŠ¶æ€ï¼šCONNECTING
â”œâ”€ å¾…ç½‘ç»œå°±ç»ªï¼šè°ƒç”¨ markConnected()
â”œâ”€ çŠ¶æ€æ›´æ–°ï¼šè°ƒç”¨ sendNetworkCapabilities(), sendNetworkScore() ç­‰
â””â”€ ç½‘ç»œæ–­å¼€ï¼šè°ƒç”¨ unregister()</p>
<p>ConnectivityService å¯¹ NetworkAgent çš„å“åº”
â”œâ”€ onNetworkInfoChanged()ï¼šç½‘ç»œçŠ¶æ€å˜åŒ–
â”œâ”€ onNetworkCapabilitiesChanged()ï¼šèƒ½åŠ›å˜åŒ–
â”œâ”€ onNetworkScoreChanged()ï¼šè¯„åˆ†å˜åŒ–
â”œâ”€ è§¦å‘é‡æ–°åŒ¹é…ï¼šrematchAllNetworksAndRequests()
â”œâ”€ å‘é€éªŒè¯è¯·æ±‚ï¼šå‘é€ç»™ NetworkMonitor
â””â”€ å¹¿æ’­ç½‘ç»œå˜åŒ–ï¼šnotifyNetworkCallbacks()</p>
<p>NetworkMonitorï¼ˆéªŒè¯ç½‘ç»œï¼‰
â”œâ”€ æ¥æ”¶ç½‘ç»œä¿¡æ¯
â”œâ”€ å‘èµ· HTTP/HTTPS æ¢æµ‹
â”œâ”€ æŸ¥è¯¢ DNS
â”œâ”€ è¿”å›éªŒè¯ç»“æœï¼šVALID, PORTAL, OFFLINE ç­‰
â””â”€ ConnectivityService æ›´æ–°ç½‘ç»œèƒ½åŠ›</p>
<p>æœ€ç»ˆå›è°ƒç»™åº”ç”¨
â”œâ”€ é€šè¿‡ NetworkCallback æ¥å£
â”œâ”€ onAvailable(Network)
â”œâ”€ onCapabilitiesChanged()
â”œâ”€ åº”ç”¨å¯ä»¥å¼€å§‹ä½¿ç”¨ç½‘ç»œ
â””â”€ åº”ç”¨ getActiveNetwork() è¿”å›è¯¥ç½‘ç»œ</p>
<pre><code class="hljs language-markdown" lang="markdown">
<span class="hljs-section">#### <span class="hljs-strong">**1.3 Android 15 çš„æ¶æ„æ¼”è¿›**</span></span>

</code></pre>
<p>ã€Android 14 â†’ Android 15 çš„ä¸»è¦å˜åŒ–ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>Feature 1: æ›´ç²¾ç»†çš„ç½‘ç»œçŠ¶æ€è·Ÿè¸ª
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ ç½‘ç»œçŠ¶æ€ï¼šCONNECTED / DISCONNECTED
â”œâ”€ éªŒè¯çŠ¶æ€ï¼šVALIDATED / UNVALIDATED
â””â”€ åŸºæœ¬çš„è¯„åˆ†æœºåˆ¶</p>
<p>Android 15:
â”œâ”€ ç½‘ç»œçŠ¶æ€ï¼šCONNECTING, CONNECTED, DISCONNECTING, DISCONNECTED
â”œâ”€ Linger çŠ¶æ€ï¼šç½‘ç»œæ–­å¼€å‰å¯ä¿æ´»ä¸€æ®µæ—¶é—´
â”œâ”€ éªŒè¯çŠ¶æ€ç»†åˆ†ï¼š
â”‚  â”œâ”€ VALIDATEDï¼ˆæœ‰æ•ˆçš„äº’è”ç½‘è¿æ¥ï¼‰
â”‚  â”œâ”€ PARTIALï¼ˆéƒ¨åˆ†è¿é€šï¼Œä¾‹å¦‚ä»… IPv4ï¼‰
â”‚  â”œâ”€ CAPTIVE_PORTALï¼ˆå¼ºåˆ¶é—¨æˆ·ï¼‰
â”‚  â”œâ”€ PROVISIONINGï¼ˆé…ç½®ä¸­ï¼‰
â”‚  â””â”€ OFFLINEï¼ˆç¦»çº¿ï¼‰
â”œâ”€ æ›´è¯¦ç»†çš„ç½‘ç»œèƒ½åŠ›ï¼š
â”‚  â”œâ”€ OEM_PAIDï¼ˆOEM ä»˜è´¹ç½‘ç»œï¼‰
â”‚  â”œâ”€ OEM_PRIVATEï¼ˆOEM ç§æœ‰ç½‘ç»œï¼‰
â”‚  â””â”€ LOCAL_NETWORKï¼ˆæœ¬åœ°ç½‘ç»œï¼Œä¸éœ€è¦äº’è”ç½‘ï¼‰
â””â”€ NetworkScore æ›´å¤æ‚çš„è¯„åˆ†ç®—æ³•</p>
<p>Feature 2: LocalNetwork æ”¯æŒ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>é—®é¢˜ï¼šåº”ç”¨éœ€è¦è¿æ¥å±€åŸŸç½‘è®¾å¤‡ï¼ˆæ‰“å°æœºã€NAS ç­‰ï¼‰ï¼Œä½†ä¸éœ€è¦äº’è”ç½‘</p>
<p>Android 14:
â”œâ”€ LocalNetwork æ¦‚å¿µæœ‰é™
â”œâ”€ æœ¬åœ°ç½‘ç»œæ— æ³•ä¸äº’è”ç½‘ç½‘ç»œå…±å­˜
â””â”€ åº”ç”¨éœ€è¦ç‰¹æ®Šå¤„ç†</p>
<p>Android 15:
â”œâ”€ å®Œæ•´çš„ LocalNetwork æ¡†æ¶
â”œâ”€ LocalNetworkConfig å®šä¹‰æœ¬åœ°ç½‘ç»œå±æ€§
â”œâ”€ åº”ç”¨å¯ä»¥ï¼š
â”‚  â”œâ”€ ä½¿ç”¨äº’è”ç½‘ç½‘ç»œï¼ˆé»˜è®¤ï¼‰
â”‚  â”œâ”€ åŒæ—¶ä½¿ç”¨æœ¬åœ°ç½‘ç»œ
â”‚  â”œâ”€ åœ¨ä¸¤è€…ä¹‹é—´åˆ‡æ¢
â”‚  â””â”€ åˆ—ä¸¾æœ¬åœ°ç½‘ç»œè®¾å¤‡
â”œâ”€ DNS è§£ææ”¯æŒï¼š
â”‚  â”œâ”€ å±€åŸŸç½‘ mDNSï¼ˆ.local åŸŸåï¼‰
â”‚  â”œâ”€ ä¼ä¸š DNSï¼ˆActive Directoryï¼‰
â”‚  â””â”€ äº‘ç«¯ DNSï¼ˆAWS, Azure ç­‰ï¼‰
â””â”€ åº”ç”¨æ— éœ€ INTERNET æƒé™ä¹Ÿèƒ½è®¿é—®æœ¬åœ°èµ„æº</p>
<p>Feature 3: æ”¹è¿›çš„ç½‘ç»œéªŒè¯æœºåˆ¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ ç®€å•çš„ HTTP é‡å®šå‘æ£€æµ‹
â”œâ”€ ç¼ºå°‘æŸäº›åœºæ™¯ä¸‹çš„éªŒè¯æ”¯æŒ
â””â”€ éªŒè¯å¤±è´¥å¤„ç†ä¸å¤Ÿç»†è‡´</p>
<p>Android 15:
â”œâ”€ æ›´æ™ºèƒ½çš„é—¨æˆ·æ£€æµ‹ï¼š
â”‚  â”œâ”€ æ”¯æŒå¤šç§é—¨æˆ·ç±»å‹ï¼ˆWifi çƒ­ç‚¹ã€èˆªç­ WiFiï¼‰
â”‚  â”œâ”€ æ›´å¥½çš„å‡é˜³æ€§ï¼ˆfalse positiveï¼‰é¿å…
â”‚  â””â”€ æ”¯æŒè·³è¿‡å·²çŸ¥çš„è‰¯å¥½ç½‘ç»œéªŒè¯
â”œâ”€ éšç§ DNS éªŒè¯ï¼š
â”‚  â”œâ”€ æ”¯æŒ DNS-over-HTTPS (DoH)
â”‚  â”œâ”€ æ”¯æŒ DNS-over-TLS (DoT)
â”‚  â””â”€ æ”¯æŒç§æœ‰ DNS è½¬å‘
â”œâ”€ éƒ¨åˆ†è¿é€šæ€§å¤„ç†ï¼š
â”‚  â”œâ”€ IPv4-only ç½‘ç»œï¼ˆæŸäº›è¿è¥å•†ï¼‰
â”‚  â”œâ”€ IPv6-only ç½‘ç»œï¼ˆæ–°å…´è¿è¥å•†ï¼‰
â”‚  â””â”€ æ··åˆ Dual-stack æ£€æµ‹
â””â”€ éªŒè¯ç¼“å­˜ï¼š
â””â”€ ç›¸åŒ SSID/BSSID çš„ WiFi åœ¨ä¸€å°æ—¶å†…æ— éœ€é‡å¤éªŒè¯</p>
<p>Feature 4: NetworkScore æ¼”è¿›
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ åŸºæœ¬è¯„åˆ†ï¼ˆ-100 åˆ° +100ï¼‰
â”œâ”€ è€ƒè™‘å› ç´ ï¼š
â”‚  â”œâ”€ ç½‘ç»œç±»å‹ï¼ˆWiFi &gt; LTE &gt; 2Gï¼‰
â”‚  â”œâ”€ ä¿¡å·å¼ºåº¦
â”‚  â”œâ”€ æ˜¯å¦è®¡é‡
â”‚  â””â”€ æ˜¯å¦éªŒè¯
â””â”€ ç®€å•çš„æ’åºç®—æ³•</p>
<p>Android 15:
â”œâ”€ æ–°çš„è¯„åˆ†èŒƒå›´ï¼š0 åˆ°ä»»æ„å€¼ï¼ˆæ— ä¸Šé™ï¼‰
â”œâ”€ è€ƒè™‘å› ç´ å¢åŠ ï¼š
â”‚  â”œâ”€ å¸¦å®½ï¼ˆMBpsï¼‰
â”‚  â”œâ”€ å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
â”‚  â”œâ”€ ä¸¢åŒ…ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
â”‚  â”œâ”€ ç½‘ç»œç¨³å®šæ€§ï¼ˆè¿æ¥æŒç»­æ—¶é—´ï¼‰
â”‚  â”œâ”€ åœ°ç†ä½ç½®ï¼ˆä¼˜å…ˆæœ¬åœ°ç½‘ç»œï¼‰
â”‚  â””â”€ è¿è¥å•†ä¼˜å…ˆçº§è®¾ç½®ï¼ˆOEM é…ç½®ï¼‰
â”œâ”€ æ›´ç»†è‡´çš„å†³ç­–ï¼š
â”‚  â”œâ”€ WiFi 5GHz vs 2.4GHzï¼ˆä¸åŒè¯„åˆ†ï¼‰
â”‚  â”œâ”€ WiFi åŠ å¯†å¼ºåº¦ï¼ˆä¸åŒè¯„åˆ†ï¼‰
â”‚  â”œâ”€ LTE vs 5Gï¼ˆåŠ¨æ€è¯„åˆ†ï¼‰
â”‚  â””â”€ ä¸åŒ SIM å¡çš„è¯„åˆ†ï¼ˆå¤šå¡è®¾å¤‡ï¼‰
â””â”€ æœºå™¨å­¦ä¹ é¢„æµ‹ï¼š
â””â”€ åŸºäºå†å²æ•°æ®é¢„æµ‹ç½‘ç»œè´¨é‡ï¼ˆæµ‹è¯•ä¸­ï¼‰</p>
<p>Feature 5: å¤šç½‘ç»œå¹¶è¡Œä½¿ç”¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ å¤šä¸ªåº”ç”¨ä½¿ç”¨ä¸åŒç½‘ç»œï¼ˆé€šè¿‡ NetworkRequestï¼‰
â”œâ”€ ä½†é»˜è®¤ç½‘ç»œé€šå¸¸æ˜¯å•ä¸€çš„ï¼ˆWiFi æˆ– LTEï¼‰
â””â”€ åº”ç”¨å¾ˆéš¾åŒæ—¶ä½¿ç”¨å¤šä¸ªç½‘ç»œ</p>
<p>Android 15:
â”œâ”€ å®Œæ•´çš„å¤šç½‘ç»œæ ˆæ”¯æŒï¼š
â”‚  â”œâ”€ åº”ç”¨å¯ä»¥åŒæ—¶ä½¿ç”¨äº’è”ç½‘ç½‘ç»œ + æœ¬åœ°ç½‘ç»œ
â”‚  â”œâ”€ åº”ç”¨å¯ä»¥åŒæ—¶ä½¿ç”¨ WiFi + ç§»åŠ¨ç½‘ç»œï¼ˆéƒ¨åˆ†åº”ç”¨ï¼‰
â”‚  â””â”€ VPN å¯ä»¥ä¸å…¶ä»–ç½‘ç»œå…±å­˜
â”œâ”€ æ”¹è¿›çš„ DNS å¤„ç†ï¼š
â”‚  â”œâ”€ æ”¯æŒå¤šä¸ª DNS æœç´¢åˆ—è¡¨
â”‚  â”œâ”€ æ ¹æ®åŸŸåé€‰æ‹© DNS æœåŠ¡å™¨
â”‚  â””â”€ ä¼˜åŒ– DNS é‡è¯•ï¼ˆå‡å°‘å»¶è¿Ÿï¼‰
â”œâ”€ è·¯ç”±ç­–ç•¥ï¼ˆç­–ç•¥è·¯ç”±ï¼‰ï¼š
â”‚  â”œâ”€ åŸºäºç›®æ ‡åœ°å€é€‰æ‹©ç½‘ç»œ
â”‚  â”œâ”€ åŸºäºåº”ç”¨ UID é€‰æ‹©ç½‘ç»œ
â”‚  â”œâ”€ åŸºäºæµé‡ä¼˜å…ˆçº§é€‰æ‹©ç½‘ç»œ
â”‚  â””â”€ VPN æµé‡ä¼˜å…ˆçº§å¤„ç†
â””â”€ åº”ç”¨ APIï¼š
â””â”€ æ–°çš„ NetworkCapabilities å’Œ NetworkRequest é€‰é¡¹</p>
<p>Feature 6: æ”¹è¿›çš„åå°é™åˆ¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ å…¨å±€åå°é™åˆ¶
â”œâ”€ åº”ç”¨ç™½åå•æœºåˆ¶
â””â”€ é™åˆ¶ç²’åº¦è¾ƒç²—</p>
<p>Android 15:
â”œâ”€ æ›´ç»†è‡´çš„é™åˆ¶ï¼š
â”‚  â”œâ”€ æŒ‰åŠŸèƒ½é™åˆ¶ï¼ˆå®šä½ã€åå° Sync ç­‰ï¼‰
â”‚  â”œâ”€ ä¸åŒåº”ç”¨è§’è‰²çš„ä¸åŒé™åˆ¶
â”‚  â””â”€ ä¸è®¾å¤‡æ¨¡å¼å…³è”ï¼ˆçœç”µæ¨¡å¼æ—¶æ›´ä¸¥æ ¼ï¼‰
â”œâ”€ æ›´èªæ˜çš„æ£€æµ‹ï¼š
â”‚  â”œâ”€ æ£€æµ‹åº”ç”¨æ˜¯å¦åœ¨å‰å°ï¼ˆåŸºäº Visible Windowï¼‰
â”‚  â”œâ”€ æ£€æµ‹æ˜¯å¦æœ‰ç”¨æˆ·äº¤äº’
â”‚  â””â”€ æ£€æµ‹ä¼˜å…ˆçº§æ ‡ç­¾ï¼ˆPRIORITY, NORMAL, LOWï¼‰
â”œâ”€ æ”¹è¿›çš„ç™½åå•ï¼š
â”‚  â”œâ”€ åŠ¨æ€ç™½åå•ï¼ˆåŸºäºæ¡ä»¶ï¼‰
â”‚  â”œâ”€ æ—¶é—´è¡¨ç™½åå•ï¼ˆç‰¹å®šæ—¶é—´æ®µï¼‰
â”‚  â””â”€ éšç§æ„ŸçŸ¥ç™½åå•ï¼ˆæƒé™ç›¸å…³ï¼‰
â””â”€ ç”¨æˆ·é€æ˜åº¦ï¼š
â””â”€ Settings ä¸­å¯è§çš„ç½‘ç»œé™åˆ¶åŸå› </p>
<p>Feature 7: å®‰å…¨ä¸éšç§å¢å¼º
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ åŸºæœ¬çš„æƒé™æ£€æŸ¥
â”œâ”€ MAC åœ°å€éšè—ï¼ˆWiFiï¼‰
â””â”€ æœ‰é™çš„åŠ å¯†æ”¯æŒ</p>
<p>Android 15:
â”œâ”€ å¢å¼ºçš„æƒé™æ¨¡å‹ï¼š
â”‚  â”œâ”€ ç»†ç²’åº¦æƒé™ï¼ˆCHANGE_NETWORK_STATE åˆ†ç¦»ï¼‰
â”‚  â”œâ”€ æƒé™å§”æ‰˜ï¼ˆåº”ç”¨A å¯ä»£è¡¨åº”ç”¨B è¯·æ±‚ç½‘ç»œï¼‰
â”‚  â””â”€ æƒé™æ£€æŸ¥å®¡è®¡æ—¥å¿—
â”œâ”€ æ›´å¥½çš„éšç§ï¼š
â”‚  â”œâ”€ éšæœºåˆ¶ MAC åœ°å€ï¼ˆéšæœºåŒ–é—´éš”ï¼‰
â”‚  â”œâ”€ MAC åœ°å€æ± ç®¡ç†
â”‚  â”œâ”€ MAC åœ°å€ä¸ SSID ç»‘å®š
â”‚  â””â”€ é˜²æ­¢ MAC åœ°å€è¿½è¸ª
â”œâ”€ åŠ å¯†ç½‘ç»œç®¡ç†ï¼š
â”‚  â”œâ”€ WPA3 å®Œæ•´æ”¯æŒ
â”‚  â”œâ”€ OWEï¼ˆOpen With Encryptionï¼‰
â”‚  â”œâ”€ ä¼ä¸š EAP æ”¹è¿›
â”‚  â””â”€ IoT è®¾å¤‡ç½‘ç»œéš”ç¦»
â””â”€ æ¶æ„ç½‘ç»œé˜²æŠ¤ï¼š
â”œâ”€ æ£€æµ‹å·²çŸ¥çš„æ¶æ„ SSID
â”œâ”€ ä¸­é—´äººæ”»å‡»é˜²æŠ¤ï¼ˆHSTSï¼‰
â””â”€ DNS åŠ«æŒæ£€æµ‹</p>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-meta">---
</span>
<span class="hljs-comment">### **2ã€NetworkAgent æœºåˆ¶æ·±åº¦è§£æ**</span>

<span class="hljs-comment">#### **2.1 NetworkAgent ç”Ÿå‘½å‘¨æœŸ**</span>

</code></pre>
<p>ã€å®Œæ•´çš„ NetworkAgent ç”Ÿå‘½å‘¨æœŸã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>çŠ¶æ€å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NetworkAgent ç”Ÿå‘½å‘¨æœŸ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code class="hljs language-scss" lang="scss">     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
     â”ƒ <span class="hljs-number">1</span>. UNREGISTERED (åˆå§‹åŒ–) â”ƒ
     â”ƒ - åˆ›å»º NetworkAgent       â”ƒ
     â”ƒ - é…ç½®åˆå§‹èƒ½åŠ›å’Œå±æ€§      â”ƒ
     â”ƒ - å°šæœªå‘ç³»ç»Ÿæ³¨å†Œ          â”ƒ
     â”—â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚
         â”‚ <span class="hljs-built_in">register</span>()
         â”‚
     â”â”â”â”â–¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
     â”ƒ <span class="hljs-number">2</span>. REGISTERED (å·²æ³¨å†Œ)   â”ƒ
     â”ƒ - å‘ ConnectivityService â”ƒ
     â”ƒ   æ³¨å†Œ                   â”ƒ
     â”ƒ - æ”¶åˆ° <span class="hljs-built_in">onRegistered</span>()    â”ƒ
     â”ƒ - åˆå§‹çŠ¶æ€ï¼šDISCONNECTED â”ƒ
     â”—â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚
         â”‚ (ç½‘ç»œè¿æ¥è¿‡ç¨‹)
         â”‚ - å‘èµ·è¿æ¥
         â”‚ - å‘é€èƒ½åŠ›/å±æ€§æ›´æ–°
         â”‚
     â”â”â”â”â–¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
     â”ƒ <span class="hljs-number">3</span>. CONNECTING (è¿æ¥ä¸­)   â”ƒ
     â”ƒ - ç½‘ç»œå¤„äºè¿æ¥è¿‡ç¨‹        â”ƒ
     â”ƒ - å‘ ConnectivityService  â”ƒ
     â”ƒ   å‘é€å®æ—¶æ›´æ–°            â”ƒ
     â”ƒ - ä¿¡å·å¼ºåº¦ã€IP åœ°å€ç­‰å¯èƒ½ â”ƒ
     â”ƒ   ä¸å®Œæ•´                  â”ƒ
     â”—â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚
         â”‚ <span class="hljs-built_in">markConnected</span>()
         â”‚ - æ ‡è®°ç½‘ç»œå·²è¿æ¥
         â”‚ - å®Œæ•´ IP é…ç½®
         â”‚ - å¯ä»¥æ¥æ”¶æµé‡
         â”‚
     â”â”â”â”â–¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
     â”ƒ <span class="hljs-number">4</span>. CONNECTED (å·²è¿æ¥)    â”ƒ
     â”ƒ - L3 è¿é€šæ€§å·²å»ºç«‹         â”ƒ
     â”ƒ - åº”ç”¨å¯ä»¥ä½¿ç”¨            â”ƒ
     â”ƒ - å¯ä»¥éªŒè¯äº’è”ç½‘è¿é€šæ€§    â”ƒ
     â”ƒ - NetworkMonitor å¯å¼€å§‹   â”ƒ
     â”ƒ   éªŒè¯å·¥ä½œ                â”ƒ
     â”—â”â”â”â”¯â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚   â”‚
         â”‚   â”‚ (ç½‘ç»œæ›´æ–°)
         â”‚   â”œâ”€ <span class="hljs-built_in">sendNetworkCapabilities</span>()
         â”‚   â”œâ”€ <span class="hljs-built_in">sendLinkProperties</span>()
         â”‚   â”œâ”€ <span class="hljs-built_in">sendNetworkScore</span>()
         â”‚   â””â”€ (é‡å¤å¾ªç¯)
         â”‚
         â”‚ (ç½‘ç»œæ–­å¼€æˆ–è¢«æ›¿æ¢)
         â”‚
     â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                          â”‚
â”â”â”â”â–¼â”â”â”â”â”“         â”â”â”â”â”â”â”â”â”â”â–¼â”â”â”“
â”ƒ <span class="hljs-number">5</span>a. æ­£å¸¸æ–­å¼€   â”ƒ <span class="hljs-number">5</span>b. è¢«æ›¿æ¢  â”ƒ
â”ƒ <span class="hljs-built_in">unregister</span>()   â”ƒ unregisterAfter
â”ƒ               â”ƒ <span class="hljs-built_in">Replacement</span>()
â”—â”â”â”â”¯â”â”â”â”â”›         â”—â”â”â”â”¯â”â”â”â”â”â”›
    â”‚                 â”‚
    â”‚ (ç½‘ç»œæ¸…ç†)      â”‚ (ç½‘ç»œä¿æ´»)
    â”‚ - é‡Šæ”¾èµ„æº      â”‚ - ä»æ»¡è¶³æ—§è¯·æ±‚
    â”‚ - æ–­å¼€ç½‘ç»œ      â”‚ - ä½†æ–°çš„åŒç±»ç½‘ç»œä¼˜å…ˆ
    â”‚ - åœæ­¢éªŒè¯      â”‚ - åœ¨è¶…æ—¶æˆ–æ›¿æ¢å®Œæˆæ—¶æ–­å¼€
    â”‚                 â”‚
â”â”â”â”â–¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â–¼â”â”â”“
â”ƒ <span class="hljs-number">6</span>. DISCONNECTED (å·²æ–­å¼€) â”ƒ
â”ƒ - ç½‘ç»œä¸å†å¯ç”¨           â”ƒ
â”ƒ - èµ„æºå·²é‡Šæ”¾             â”ƒ
â”ƒ - åº”ç”¨å¤±å»è¯¥ç½‘ç»œ         â”ƒ
â”ƒ - <span class="hljs-built_in">onDisconnected</span>() è¢«è°ƒç”¨ â”ƒ
â”ƒ - Agent ä¸å¯å†ä½¿ç”¨        â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
</code></pre>
<pre><code class="hljs language-less" lang="less">
è¯¦ç»†é˜¶æ®µè¯´æ˜ï¼š

```<span class="hljs-selector-tag">java</span>
ã€<span class="hljs-selector-tag">Stage</span> <span class="hljs-number">1</span>: åˆå§‹åŒ– (Initialization)ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<span class="hljs-comment">// WiFi ç½‘ç»œä»£ç†ç¤ºä¾‹</span>
<span class="hljs-selector-tag">WifiNetworkAgent</span> <span class="hljs-selector-tag">agent</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">WifiNetworkAgent</span>(
    context,
    looper,
    <span class="hljs-string">"WifiAgent-2.4GHz"</span>,  <span class="hljs-comment">// æ—¥å¿—æ ‡ç­¾</span>
    
    <span class="hljs-comment">// åˆå§‹ç½‘ç»œèƒ½åŠ›</span>
    new NetworkCapabilities.<span class="hljs-built_in">Builder</span>()
        .<span class="hljs-built_in">addTransportType</span>(TRANSPORT_WIFI)
        .<span class="hljs-built_in">addCapability</span>(NET_CAPABILITY_INTERNET)
        .<span class="hljs-built_in">addCapability</span>(NET_CAPABILITY_<span class="hljs-keyword">NOT</span>_METERED)
        .<span class="hljs-built_in">addCapability</span>(NET_CAPABILITY_<span class="hljs-keyword">NOT</span>_ROAMING)
        .<span class="hljs-built_in">addCapability</span>(NET_CAPABILITY_<span class="hljs-keyword">NOT</span>_SUSPENDED)
        .<span class="hljs-built_in">build</span>(),
    
    <span class="hljs-comment">// åˆå§‹é“¾è·¯å±æ€§</span>
    new LinkProperties.<span class="hljs-built_in">Builder</span>()
        .<span class="hljs-built_in">setInterfaceName</span>(<span class="hljs-string">"wlan0"</span>)
        .<span class="hljs-built_in">addLinkAddress</span>(<span class="hljs-string">"192.168.1.100/24"</span>)
        .<span class="hljs-built_in">addRoute</span>(new <span class="hljs-built_in">RouteInfo</span>(null, <span class="hljs-string">"192.168.1.1"</span>))
        .<span class="hljs-built_in">addDnsServer</span>(InetAddress.<span class="hljs-built_in">getByName</span>(<span class="hljs-string">"8.8.8.8"</span>))
        .<span class="hljs-built_in">build</span>(),
    
    <span class="hljs-comment">// åˆå§‹è¯„åˆ†</span>
    new NetworkScore.<span class="hljs-built_in">Builder</span>()
        .<span class="hljs-built_in">setTransportPrimary</span>(true)
        .<span class="hljs-built_in">setSignalStrength</span>(<span class="hljs-number">85</span>)  <span class="hljs-comment">// WiFi ä¿¡å·å¼ºåº¦ (0-100)</span>
        .<span class="hljs-built_in">build</span>(),
    
    <span class="hljs-comment">// é…ç½®</span>
    config,
    provider
);

<span class="hljs-comment">// åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒAgent å·²åˆ›å»ºä½†å°šæœªæ³¨å†Œ</span>
<span class="hljs-comment">// ç½‘ç»œè¿˜ä¸è¢«ç³»ç»ŸçŸ¥é“</span>


ã€<span class="hljs-selector-tag">Stage</span> <span class="hljs-number">2</span>: æ³¨å†Œ (Registration)ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<span class="hljs-comment">// è°ƒç”¨ register() å‘ ConnectivityService æ³¨å†Œ</span>
<span class="hljs-selector-tag">agent</span><span class="hljs-selector-class">.register</span>();

â†’ <span class="hljs-selector-tag">ConnectivityService</span> å¤„ç†æµç¨‹ï¼š
â”œâ”€ åˆ›å»º <span class="hljs-selector-tag">NetworkAgentInfo</span> åŒ…è£… <span class="hljs-selector-tag">Agent</span>
â”œâ”€ æ·»åŠ åˆ° <span class="hljs-selector-tag">mNetworkAgents</span> åˆ—è¡¨
â”œâ”€ åˆ†é…å”¯ä¸€çš„ <span class="hljs-selector-tag">netId</span>
â”œâ”€ å‘é€ <span class="hljs-selector-tag">onRegistered</span>() å›è°ƒç»™ <span class="hljs-selector-tag">Agent</span>
â””â”€ è§¦å‘ç½‘ç»œé‡åŒ¹é…ï¼ˆ<span class="hljs-selector-tag">rematchAllNetworksAndRequests</span>ï¼‰

<span class="hljs-comment">// åœ¨ register() ä¸­ï¼ŒAgent åˆå§‹çŠ¶æ€æ˜¯ DISCONNECTED</span>
<span class="hljs-comment">// è¿™æ„å‘³ç€ç½‘ç»œè¿˜åœ¨è¿æ¥è¿‡ç¨‹ä¸­</span>


ã€<span class="hljs-selector-tag">Stage</span> <span class="hljs-number">3</span>: è¿æ¥ (Connecting)ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<span class="hljs-comment">// ç½‘ç»œæä¾›è€…å¼€å§‹å»ºç«‹è¿æ¥</span>
<span class="hljs-comment">// ä¾‹å¦‚ WiFi æ¨¡å—æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</span>

<span class="hljs-selector-tag">step</span> <span class="hljs-number">1</span>: æ‰«æå’Œé€‰æ‹© <span class="hljs-selector-tag">AP</span>
â”œâ”€ <span class="hljs-selector-tag">WifiManager</span><span class="hljs-selector-class">.startScan</span>()
â”œâ”€ åˆ—å‡ºå¯ç”¨ <span class="hljs-selector-tag">SSID</span>
â””â”€ é€‰æ‹©æœ€å¥½çš„ <span class="hljs-selector-tag">BSSID</span>

<span class="hljs-selector-tag">step</span> <span class="hljs-number">2</span>: å‘èµ·è¿æ¥
â”œâ”€ è°ƒç”¨ <span class="hljs-selector-tag">WifiManager</span><span class="hljs-selector-class">.connect</span>()
â”œâ”€ å‘é€ <span class="hljs-selector-tag">Association</span> <span class="hljs-selector-tag">Request</span> åˆ° <span class="hljs-selector-tag">AP</span>
â”œâ”€ <span class="hljs-selector-tag">AP</span> éªŒè¯è¯ä¹¦ï¼ˆå¦‚éœ€è¦ï¼‰
â””â”€ å»ºç«‹ <span class="hljs-number">802.11</span> è¿æ¥

<span class="hljs-selector-tag">step</span> <span class="hljs-number">3</span>: è·å– <span class="hljs-selector-tag">IP</span> åœ°å€
â”œâ”€ å‘é€ <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Discovery</span>
â”œâ”€ æ¥æ”¶ <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Offer</span>
â”œâ”€ å‘é€ <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Request</span>
â””â”€ è·å¾— <span class="hljs-selector-tag">IP</span> åœ°å€ï¼Œ<span class="hljs-selector-tag">TTL</span> ç­‰ä¿¡æ¯

<span class="hljs-selector-tag">step</span> <span class="hljs-number">4</span>: å‘ <span class="hljs-selector-tag">ConnectivityService</span> æŠ¥å‘Šè¿›å±•
â”œâ”€ è°ƒç”¨ <span class="hljs-selector-tag">sendNetworkCapabilities</span>()
â”‚  â””â”€ æ›´æ–°èƒ½åŠ›ï¼ˆä¾‹å¦‚åŠ å…¥ <span class="hljs-selector-tag">IPv6</span> èƒ½åŠ›ï¼‰
â”œâ”€ è°ƒç”¨ <span class="hljs-selector-tag">sendLinkProperties</span>()
â”‚  â””â”€ æ›´æ–° <span class="hljs-selector-tag">IP</span> åœ°å€ã€<span class="hljs-selector-tag">DNS</span>ã€<span class="hljs-selector-tag">Gateway</span> ç­‰
â”œâ”€ è°ƒç”¨ <span class="hljs-selector-tag">sendNetworkScore</span>()
â”‚  â””â”€ æ›´æ–°ä¿¡å·å¼ºåº¦å¾—åˆ†
â””â”€ é‡å¤è¿™äº›è°ƒç”¨ï¼Œç›´åˆ°å®Œå…¨å°±ç»ª

<span class="hljs-comment">// åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç½‘ç»œæ˜¯ CONNECTING</span>
<span class="hljs-comment">// ConnectivityService çŸ¥é“è¿™ä¸ªç½‘ç»œæ­£åœ¨å»ºç«‹</span>
<span class="hljs-comment">// ä½†åº”ç”¨å°šä¸èƒ½ä½¿ç”¨</span>


ã€<span class="hljs-selector-tag">Stage</span> <span class="hljs-number">4</span>: å·²è¿æ¥ (Connected)ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<span class="hljs-comment">// å½“ç½‘ç»œå®Œå…¨å°±ç»ªæ—¶ï¼Œè°ƒç”¨ markConnected()</span>

<span class="hljs-selector-tag">agent</span><span class="hljs-selector-class">.markConnected</span>();

â†’ <span class="hljs-selector-tag">ConnectivityService</span> å¤„ç†æµç¨‹ï¼š
â”œâ”€ æ›´æ–°ç½‘ç»œçŠ¶æ€ä¸º <span class="hljs-selector-tag">CONNECTED</span>
â”œâ”€ æ£€æŸ¥ç½‘ç»œæ˜¯å¦éœ€è¦éªŒè¯ï¼ˆæ˜¯å¦æ»¡è¶³ <span class="hljs-selector-tag">INTERNET</span> è¦æ±‚ï¼‰
â”œâ”€ å¦‚éœ€è¦ï¼Œå‘ <span class="hljs-selector-tag">NetworkMonitor</span> å‘é€éªŒè¯è¯·æ±‚
â”œâ”€ æ›´æ–° <span class="hljs-selector-tag">mNetworkAgents</span> ä¸­çš„çŠ¶æ€
â”œâ”€ è§¦å‘ç½‘ç»œé‡åŒ¹é…
â””â”€ åº”ç”¨å¯èƒ½å¼€å§‹æ¥æ”¶è¿™ä¸ªç½‘ç»œçš„å›è°ƒ

<span class="hljs-comment">// æ­¤æ—¶åº”ç”¨å¯ä»¥ï¼š</span>
â”œâ”€ é€šè¿‡ <span class="hljs-selector-tag">NetworkRequest</span> è¯·æ±‚è¯¥ç½‘ç»œ
â”œâ”€ ä½¿ç”¨ <span class="hljs-selector-tag">Network</span><span class="hljs-selector-class">.getSocketFactory</span>() è·å–å¥—æ¥å­—
â”œâ”€ å°†æµé‡å®šå‘åˆ°è¯¥ç½‘ç»œ
â””â”€ æ¥æ”¶è¯¥ç½‘ç»œçš„ <span class="hljs-selector-tag">CALLBACK_AVAILABLE</span>

<span class="hljs-comment">// ç½‘ç»œä»åœ¨éªŒè¯ä¸­ï¼ˆå¦‚æœéœ€è¦ï¼‰</span>
<span class="hljs-comment">// ç½‘ç»œå¯èƒ½æ²¡æœ‰ NET_CAPABILITY_VALIDATED èƒ½åŠ›</span>
</code></pre>
<p>å¥½çš„ï¼Œæˆ‘ç»§ç»­æ·±å…¥è®²è§£ Android 15 ç½‘ç»œå­ç³»ç»Ÿã€‚</p>
<p>ç°åœ¨è®©æˆ‘ç»§ç»­è¯¦ç»†è®²è§£ï¼š</p>
<p>å¥½çš„ï¼Œç»§ç»­è®²è§£ã€‚ç°åœ¨æˆ‘è¿›å…¥ç¬¬ 2-4 éƒ¨åˆ†çš„è¯¦ç»†è®²è§£ï¼š</p>
<hr/>
<h3 data-id="heading-2"><strong>2.2 ç½‘ç»œçŠ¶æ€ä¸ŠæŠ¥æµç¨‹ä¸å›è°ƒæœºåˆ¶</strong></h3>
<pre><code class="hljs language-scss" lang="scss">ã€NetworkAgent ä¸ŠæŠ¥ç½‘ç»œçŠ¶æ€çš„å®Œæ•´æµç¨‹ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ ¸å¿ƒæ¦‚å¿µï¼š
â”œâ”€ NetworkAgent ä½œä¸º"ä¿¡ä½¿"å‘ ConnectivityService ä¸ŠæŠ¥ç½‘ç»œçŠ¶æ€
â”œâ”€ é€šè¿‡ INetworkAgentRegistry AIDL æ¥å£å‘é€æ›´æ–°
â”œâ”€ ConnectivityService åœ¨ä¸“ç”¨çº¿ç¨‹å¤„ç†è¿™äº›æ›´æ–°
â””â”€ æœ€ç»ˆé€šè¿‡ NetworkCallback é€šçŸ¥åº”ç”¨

æ—¶åºä¸è°ƒç”¨é“¾ï¼š

T=<span class="hljs-number">0</span>: ç½‘ç»œäº‹ä»¶å‘ç”Ÿ (ä¾‹å¦‚è·å¾— IP åœ°å€)
     â””â”€ WiFi Driver / Telephony æ£€æµ‹åˆ°äº‹ä»¶

T=<span class="hljs-number">1</span>: NetworkAgent ä¸­çš„äº‹ä»¶å¤„ç†
     â”œâ”€ WiFiNetworkAgent.<span class="hljs-built_in">onNetworkStateChange</span>()
     â”‚  â””â”€ è°ƒç”¨ <span class="hljs-built_in">sendNetworkCapabilities</span>()
     â”‚
     â”œâ”€ <span class="hljs-built_in">sendNetworkCapabilities</span>() å®ç°ï¼š
     â”‚  â”œâ”€ åˆ›å»ºæ–°çš„ NetworkCapabilities å¯¹è±¡
     â”‚  â”œâ”€ é€šè¿‡ <span class="hljs-built_in">queueOrSendMessage</span>() æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—
     â”‚  â””â”€ AsyncResult.<span class="hljs-built_in">forMessage</span>(mMessage)
     â”‚
     â””â”€ <span class="hljs-built_in">queueOrSendMessage</span>() å†…éƒ¨ï¼š
        â”œâ”€ æ£€æŸ¥æ˜¯å¦å¯ä»¥ç«‹å³å‘é€ï¼ˆé€šå¸¸åœ¨åŒä¸€çº¿ç¨‹ï¼‰
        â”œâ”€ æˆ–å°†æ¶ˆæ¯æ’é˜Ÿåˆ° mRegistry Messenger
        â””â”€ æœ€åé€šè¿‡ Binder IPC å‘é€

T=<span class="hljs-number">2</span>: IPC ä¼ è¾“ (Binder)
     â””â”€ AIDL å‚æ•°åºåˆ—åŒ–
        â”œâ”€ NetworkCapabilities è¢« Parcel åŒ–
        â””â”€ é€šè¿‡ Binder å†…æ ¸é©±åŠ¨ä¼ è¾“

T=<span class="hljs-number">3</span>: ConnectivityService æ¥æ”¶ (Handler Thread)
     â”œâ”€ Messenger ä¸­çš„ Handler æ”¶åˆ°æ¶ˆæ¯
     â”œâ”€ è°ƒç”¨ NetworkAgentMessageHandler.<span class="hljs-built_in">handleMessage</span>()
     â”œâ”€ æ ¹æ®æ¶ˆæ¯ç±»å‹åˆ†æ´¾ï¼š
     â”‚  â”œâ”€ ASYNCCHANNEL_CMD_SUBSCRIBE_REPLY
     â”‚  â”œâ”€ REQUEST_NETWORK
     â”‚  â”œâ”€ RELEASE_NETWORK
     â”‚  â”œâ”€ NETWORK_INFO_CHANGED
     â”‚  â”œâ”€ NETWORK_CAPABILITIES_CHANGED
     â”‚  â”œâ”€ LINK_PROPERTIES_CHANGED
     â”‚  â””â”€ ...
     â””â”€ è°ƒç”¨å¯¹åº”çš„å¤„ç†æ–¹æ³•

T=<span class="hljs-number">4</span>: ConnectivityService å¤„ç†çŠ¶æ€å˜åŒ–
     â”œâ”€ æ›´æ–° NetworkAgentInfo ä¸­çš„çŠ¶æ€
     â”œâ”€ å¯èƒ½è§¦å‘ç½‘ç»œé‡åŒ¹é…
     â”œâ”€ éªŒè¯ç½‘ç»œï¼ˆå¦‚éœ€è¦ï¼‰
     â””â”€ å¹¿æ’­é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…

T=<span class="hljs-number">5</span>: åº”ç”¨å›è°ƒ (é€šè¿‡ NetworkCallback)
     â”œâ”€ åŒæ­¥ Handler çº¿ç¨‹ä¸­
     â”œâ”€ æˆ–å¼‚æ­¥é€šè¿‡ Binder å›è°ƒ
     â””â”€ åº”ç”¨æ”¶åˆ°é€šçŸ¥ï¼š
        â”œâ”€ <span class="hljs-built_in">onAvailable</span>()
        â”œâ”€ <span class="hljs-built_in">onCapabilitiesChanged</span>()
        â”œâ”€ <span class="hljs-built_in">onLinkPropertiesChanged</span>()
        â””â”€ ...


ã€<span class="hljs-number">4</span> ç§å…³é”®çš„çŠ¶æ€ä¸ŠæŠ¥æ–¹æ³•ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

<span class="hljs-number">1</span>ï¸âƒ£ <span class="hljs-built_in">sendNetworkCapabilities</span>() - èƒ½åŠ›å˜åŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ç”¨é€”ï¼š
â”œâ”€ ä¸ŠæŠ¥ç½‘ç»œçš„åŠŸèƒ½èƒ½åŠ›
â”œâ”€ ä¾‹å¦‚ï¼šæ”¯æŒ IPv6ã€è®¡é‡ã€éªŒè¯çŠ¶æ€ç­‰
â”œâ”€ åœ¨ç½‘ç»œè¿æ¥çš„ä»»ä½•é˜¶æ®µå¯è°ƒç”¨

ç¤ºä¾‹ä»£ç ï¼š
```java
public void <span class="hljs-built_in">sendNetworkCapabilities</span>(@NonNull NetworkCapabilities networkCapabilities) {
    <span class="hljs-comment">// å‚æ•°éªŒè¯</span>
    if (networkCapabilities == null) {
        throw new <span class="hljs-built_in">NullPointerException</span>("networkCapabilities is null");
    }
    
    <span class="hljs-comment">// æ„å»ºæ–°çš„èƒ½åŠ›å¯¹è±¡</span>
    NetworkCapabilities newCaps = new NetworkCapabilities<span class="hljs-selector-class">.Builder</span>(networkCapabilities)
        <span class="hljs-comment">// å¯é€‰ï¼šæ·»åŠ æˆ–ç§»é™¤èƒ½åŠ›</span>
        <span class="hljs-selector-class">.build</span>();
    
    <span class="hljs-comment">// å‘é€åˆ° ConnectivityService</span>
    <span class="hljs-comment">// å†…éƒ¨è°ƒç”¨ï¼šqueueOrSendMessage(mNetworkCapabilitiesCallback, newCaps);</span>
    <span class="hljs-built_in">queueOrSendMessage</span>(reg -&gt; reg.sendNetworkCapabilities(newCaps));
}
</code></pre>
<p>å¸¸è§çš„èƒ½åŠ›å˜åŒ–ï¼š
â”œâ”€ è·å¾— IPv6ï¼šaddCapability(NET_CAPABILITY_IPV6)
â”œâ”€ ç½‘ç»œéªŒè¯ï¼šaddCapability(NET_CAPABILITY_VALIDATED)
â”œâ”€ æ£€æµ‹é—¨æˆ·ï¼šaddCapability(NET_CAPABILITY_CAPTIVE_PORTAL)
â”œâ”€ ä¿¡å·å˜åŒ–ï¼šsetSignalStrength(85)
â””â”€ è¿é€šæ€§éƒ¨åˆ†ï¼šaddCapability(NET_CAPABILITY_PARTIAL_CONNECTIVITY)</p>
<p>ConnectivityService çš„å¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleNetworkCapabilitiesChanged</span><span class="hljs-params">(
    NetworkAgentInfo nai, NetworkCapabilities caps)</span> {
    
    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦çœŸçš„å‘ç”Ÿäº†å˜åŒ–</span>
    <span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">oldCaps</span> <span class="hljs-operator">=</span> nai.networkCapabilities;
    <span class="hljs-keyword">if</span> (oldCaps.equals(caps)) {
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// æ— å˜åŒ–ï¼Œæ— éœ€å¤„ç†</span>
    }
    
    <span class="hljs-comment">// è®°å½•æ—¥å¿—ï¼ˆç”¨äºè°ƒè¯•ï¼‰</span>
    logNetworkEvent(nai, <span class="hljs-string">"Capabilities changed"</span>, caps);
    
    <span class="hljs-comment">// æ›´æ–°ç½‘ç»œçš„èƒ½åŠ›</span>
    nai.setNetworkCapabilities(caps);
    
    <span class="hljs-comment">// é‡æ–°è¯„ä¼°ç½‘ç»œçš„é€‚ç”¨æ€§ï¼ˆç½‘ç»œå¯èƒ½å¤±å»æŸäº›è¦æ±‚çš„èƒ½åŠ›ï¼‰</span>
    rematchAllNetworksAndRequests();
    
    <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…</span>
    notifyNetworkCallbacks(nai, ConnectivityManager.CALLBACK_CAPABILITIES_CHANGED);
    
    <span class="hljs-comment">// éªŒè¯çŠ¶æ€å˜åŒ–éœ€è¦ç‰¹æ®Šå¤„ç†</span>
    <span class="hljs-keyword">if</span> (oldCaps.hasCapability(NET_CAPABILITY_VALIDATED) 
        != caps.hasCapability(NET_CAPABILITY_VALIDATED)) {
        <span class="hljs-comment">// éªŒè¯çŠ¶æ€æ”¹å˜ï¼Œæ›´æ–° NetworkMonitor</span>
        updateNetworkMonitorForValidation(nai);
    }
}
</code></pre>
<p>2ï¸âƒ£ sendLinkProperties() - é“¾è·¯å±æ€§å˜åŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>ç”¨é€”ï¼š
â”œâ”€ ä¸ŠæŠ¥ç½‘ç»œçš„ L3 å±æ€§ï¼ˆé“¾è·¯å±‚ä»¥ä¸Šï¼‰
â”œâ”€ IP åœ°å€ã€å­ç½‘æ©ç ã€ç½‘å…³ã€DNS ç­‰
â”œâ”€ è·¯ç”±ä¿¡æ¯ã€æ¥å£åç§°</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendLinkProperties</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> LinkProperties linkProperties)</span> {
    <span class="hljs-keyword">if</span> (linkProperties == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"linkProperties is null"</span>);
    }
    
    <span class="hljs-comment">// å…¸å‹åœºæ™¯ï¼šè·å¾— IP åœ°å€åæ›´æ–°</span>
    <span class="hljs-type">LinkProperties</span> <span class="hljs-variable">newProps</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkProperties</span>.Builder(linkProperties)
        .setInterfaceName(<span class="hljs-string">"wlan0"</span>)                <span class="hljs-comment">// æ¥å£å</span>
        .addLinkAddress(<span class="hljs-string">"192.168.1.100/24"</span>)      <span class="hljs-comment">// IP å’Œå­ç½‘æ©ç </span>
        .addRoute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RouteInfo</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">"192.168.1.1"</span>))  <span class="hljs-comment">// é»˜è®¤ç½‘å…³</span>
        .addDnsServer(InetAddress.getByName(<span class="hljs-string">"8.8.8.8"</span>)) <span class="hljs-comment">// DNS æœåŠ¡å™¨</span>
        .build();
    
    queueOrSendMessage(reg -&gt; reg.sendLinkProperties(newProps));
}
</code></pre>
<p>ConnectivityService çš„å¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleLinkPropertiesChanged</span><span class="hljs-params">(
    NetworkAgentInfo nai, LinkProperties lp)</span> {
    
    <span class="hljs-type">LinkProperties</span> <span class="hljs-variable">oldLp</span> <span class="hljs-operator">=</span> nai.linkProperties;
    <span class="hljs-keyword">if</span> (oldLp.equals(lp)) {
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// æ— å˜åŒ–</span>
    }
    
    <span class="hljs-comment">// æ›´æ–° DNS ä¿¡æ¯ï¼ˆç³»ç»Ÿ DNS è§£æå™¨ï¼‰</span>
    updateDnsServers(nai, lp);
    
    <span class="hljs-comment">// æ›´æ–°è·¯ç”±è¡¨ï¼ˆnetdï¼‰</span>
    updateRouting(nai, lp);
    
    <span class="hljs-comment">// æ›´æ–° IP åœ°å€ï¼ˆVPNã€6to4 è½¬æ¢ç­‰ï¼‰</span>
    updateIpv6Configuration(nai, lp);
    
    <span class="hljs-comment">// é€šçŸ¥åº”ç”¨</span>
    notifyNetworkCallbacks(nai, ConnectivityManager.CALLBACK_LINK_PROPERTIES_CHANGED);
    
    <span class="hljs-comment">// å¦‚æœæ¥å£åæ”¹å˜ï¼Œæ›´æ–° BPF é˜²ç«å¢™è§„åˆ™</span>
    <span class="hljs-keyword">if</span> (!oldLp.getInterfaceName().equals(lp.getInterfaceName())) {
        updateBpfRules(nai);
    }
}
</code></pre>
<p>IP åœ°å€å˜åŒ–çš„å½±å“ï¼š
â”œâ”€ åº”ç”¨æ”¶åˆ° CALLBACK_IP_CHANGED
â”œâ”€ Socket è¿æ¥å¯èƒ½éœ€è¦é‡å»º
â”œâ”€ DNS æŸ¥è¯¢å¯èƒ½ä½¿ç”¨æ–°çš„ DNS æœåŠ¡å™¨
â””â”€ è·¯ç”±è¡¨æ”¹å˜å½±å“æµé‡è½¬å‘</p>
<p>3ï¸âƒ£ sendNetworkScore() - ç½‘ç»œè¯„åˆ†
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>ç”¨é€”ï¼š
â”œâ”€ å‘ŠçŸ¥ç³»ç»Ÿç½‘ç»œè´¨é‡ï¼ˆå¥½åï¼‰
â”œâ”€ å½±å“ç½‘ç»œé€‰æ‹©ï¼ˆå†³å®šä½¿ç”¨å“ªä¸ªç½‘ç»œï¼‰
â”œâ”€ åŠ¨æ€æ›´æ–°ï¼ˆç½‘ç»œè´¨é‡å®æ—¶å˜åŒ–ï¼‰</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendNetworkScore</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> NetworkScore score)</span> {
    <span class="hljs-keyword">if</span> (score == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"score is null"</span>);
    }
    
    <span class="hljs-comment">// è¯„åˆ†é€šå¸¸åŸºäºä¿¡å·å¼ºåº¦</span>
    <span class="hljs-comment">// WiFi: 0-100 (RSSI å¼ºåº¦)</span>
    <span class="hljs-comment">// LTE: 0-100 (RSRP å¼ºåº¦)</span>
    
    <span class="hljs-type">NetworkScore</span> <span class="hljs-variable">newScore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkScore</span>.Builder()
        .setTransportPrimary(<span class="hljs-literal">true</span>)      <span class="hljs-comment">// æ˜¯å¦æ˜¯ä¸»è¦ä¼ è¾“æ–¹å¼</span>
        .setSignalStrength(rssiValue)   <span class="hljs-comment">// ä¿¡å·å¼ºåº¦</span>
        .setExiting(<span class="hljs-literal">false</span>)              <span class="hljs-comment">// æ˜¯å¦æ­£åœ¨é€€å‡ºï¼ˆè¢«æ›¿æ¢ï¼‰</span>
        .build();
    
    queueOrSendMessage(reg -&gt; reg.sendNetworkScore(newScore));
}
</code></pre>
<p>è¯„åˆ†å¦‚ä½•å½±å“ç½‘ç»œé€‰æ‹©ï¼ˆSimpleNetworkScorerï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">scoreDiff</span><span class="hljs-params">(NetworkScore score1, NetworkScore score2)</span> {
    <span class="hljs-comment">// æ¯”è¾ƒä¸¤ä¸ªç½‘ç»œçš„è¯„åˆ†</span>
    <span class="hljs-comment">// è¿”å›æ­£æ•°ï¼šscore1 æ›´å¥½</span>
    <span class="hljs-comment">// è¿”å›è´Ÿæ•°ï¼šscore2 æ›´å¥½</span>
    <span class="hljs-comment">// è¿”å› 0ï¼šç›¸åŒè´¨é‡</span>
    
    <span class="hljs-comment">// WiFi é€šå¸¸è¯„åˆ†é«˜äº LTE</span>
    <span class="hljs-comment">// 5GHz WiFi é«˜äº 2.4GHz WiFi</span>
    <span class="hljs-comment">// ä¿¡å·å¼ºçš„ç½‘ç»œé«˜äºä¿¡å·å¼±çš„ç½‘ç»œ</span>
    
    <span class="hljs-comment">// å¦‚æœ score1 æ˜¯ WiFiï¼Œscore2 æ˜¯ LTEï¼š</span>
    <span class="hljs-comment">// â†’ score1 é€šå¸¸èµ¢ï¼ˆå‡è®¾ä¸¤è€…éƒ½è¿æ¥äº†ï¼‰</span>
    
    <span class="hljs-comment">// å¦‚æœéƒ½æ˜¯ WiFiï¼Œä½†ä¿¡å·ä¸åŒï¼š</span>
    <span class="hljs-comment">// â†’ ä¿¡å·å¼ºçš„èµ¢ (80dbm &gt; 70dbm)</span>
}

<span class="hljs-comment">// NetworkRanker ä½¿ç”¨è¿™ä¸ªè¯„åˆ†å†³å®šé»˜è®¤ç½‘ç»œ</span>
<span class="hljs-keyword">private</span> Network <span class="hljs-title function_">selectBestNetwork</span><span class="hljs-params">(List&lt;NetworkAgentInfo&gt; networks)</span> {
    <span class="hljs-comment">// æŒ‰è¯„åˆ†ä»é«˜åˆ°ä½æ’åº</span>
    Collections.sort(networks, (a, b) -&gt; {
        <span class="hljs-keyword">return</span> b.getScore() - a.getScore();
    });
    
    <span class="hljs-comment">// é€‰æ‹©è¯„åˆ†æœ€é«˜çš„</span>
    <span class="hljs-keyword">if</span> (!networks.isEmpty()) {
        <span class="hljs-keyword">return</span> networks.get(<span class="hljs-number">0</span>).network;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p>å…¸å‹çš„è¯„åˆ†å˜åŒ–åœºæ™¯ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">WiFi ä¿¡å·ä» -<span class="hljs-number">60</span>dbm å˜ä¸º -<span class="hljs-number">75</span>dbmï¼ˆå˜å¼±ï¼‰
  â†’ <span class="hljs-built_in">sendNetworkScore</span>(new NetworkScore(..., <span class="hljs-number">75</span>))  (å‡è®¾ <span class="hljs-number">75</span> åˆ†)
  â†’ ConnectivityService é‡æ–°è¯„ä¼°
  â†’ å¦‚æœè¯„åˆ†ä½äº LTEï¼Œå¯èƒ½åˆ‡æ¢åˆ° LTE

ç”¨æˆ·é è¿‘ WiFi è·¯ç”±å™¨ï¼Œä¿¡å·å˜å¼º -<span class="hljs-number">50</span>dbm
  â†’ <span class="hljs-built_in">sendNetworkScore</span>(new NetworkScore(..., <span class="hljs-number">95</span>))  (<span class="hljs-number">95</span> åˆ†)
  â†’ åˆ‡æ¢å› WiFiï¼ˆè¯„åˆ†æ›´é«˜ï¼‰
</code></pre>
<p>4ï¸âƒ£ markConnected() - æ ‡è®°ç½‘ç»œå·²è¿æ¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>ç”¨é€”ï¼š
â”œâ”€ è¡¨ç¤º L3 è¿é€šæ€§å·²å»ºç«‹
â”œâ”€ IP åœ°å€ã€ç½‘å…³ã€DNS éƒ½å·²é…ç½®
â”œâ”€ ç½‘ç»œå¯ä»¥æ¥å—æµé‡</p>
<p>æ–¹æ³•ç­¾åï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">markConnected</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªæ ‡å¿—æ€§æ–¹æ³•ï¼Œè¡¨ç¤ºç½‘ç»œå·²å‡†å¤‡å°±ç»ª</span>
    <span class="hljs-comment">// ä¹‹å‰çš„ CONNECTING çŠ¶æ€ â†’ ç°åœ¨çš„ CONNECTED çŠ¶æ€</span>
    queueOrSendMessage(reg -&gt; reg.markConnected());
}
</code></pre>
<p>ConnectivityService çš„å¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMarkConnected</span><span class="hljs-params">(NetworkAgentInfo nai)</span> {
    <span class="hljs-keyword">if</span> (nai.getNetworkState() == NetworkInfo.State.CONNECTED) {
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// å·²ç»è¿æ¥ï¼Œæ— éœ€å†æ¬¡å¤„ç†</span>
    }
    
    <span class="hljs-comment">// æ›´æ–°ç½‘ç»œä¿¡æ¯</span>
    <span class="hljs-type">NetworkInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> nai.networkInfo;
    info.setDetailedState(NetworkInfo.DetailedState.CONNECTED, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
    
    <span class="hljs-comment">// åˆ›å»ºç½‘ç»œï¼ˆå¦‚æœè¿˜æœªåˆ›å»ºï¼‰</span>
    <span class="hljs-comment">// è¿™ä¼šé€šçŸ¥ netd åˆ›å»º Linux ç½‘ç»œå‘½åç©ºé—´</span>
    createNetwork(nai);
    
    <span class="hljs-comment">// å¯åŠ¨éªŒè¯ï¼ˆå¦‚æœç½‘ç»œè¦æ±‚ INTERNET èƒ½åŠ›ï¼‰</span>
    <span class="hljs-keyword">if</span> (nai.networkCapabilities.hasCapability(NET_CAPABILITY_INTERNET)) {
        startNetworkMonitor(nai);  <span class="hljs-comment">// å¼€å§‹éªŒè¯ç½‘ç»œè¿é€šæ€§</span>
    }
    
    <span class="hljs-comment">// åº”ç”¨ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨è¿™ä¸ªç½‘ç»œ</span>
    <span class="hljs-comment">// è§¦å‘ç½‘ç»œé‡åŒ¹é…ï¼Œåº”ç”¨å¯èƒ½ä¼š onAvailable() å›è°ƒ</span>
    rematchAllNetworksAndRequests();
}
</code></pre>
<p>markConnected() ä¹‹å‰çš„å…¸å‹çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">step <span class="hljs-number">1</span>: <span class="hljs-built_in">register</span>() - ç½‘ç»œæ³¨å†Œï¼Œåˆå§‹çŠ¶æ€ DISCONNECTED
step <span class="hljs-number">2</span>: <span class="hljs-built_in">sendNetworkCapabilities</span>() - ä¸ŠæŠ¥åˆå§‹èƒ½åŠ›
step <span class="hljs-number">3</span>: <span class="hljs-built_in">sendLinkProperties</span>() - ä¸ŠæŠ¥åˆå§‹é“¾è·¯å±æ€§
step <span class="hljs-number">4</span>: <span class="hljs-built_in">sendNetworkScore</span>() - ä¸ŠæŠ¥åˆå§‹è¯„åˆ†
step <span class="hljs-number">5</span>: ... (å¤šæ¬¡æ›´æ–°èƒ½åŠ›/å±æ€§/è¯„åˆ†)
step <span class="hljs-number">6</span>: <span class="hljs-built_in">markConnected</span>() - âœ“ ç°åœ¨å®Œå…¨å°±ç»ª
</code></pre>
<p>æ ‡è®°ä¸ºå·²è¿æ¥åä¼šå‘ç”Ÿä»€ä¹ˆï¼š
â”œâ”€ åº”ç”¨å¯ä»¥é€šè¿‡ NetworkRequest è¯·æ±‚è¯¥ç½‘ç»œ
â”œâ”€ åº”ç”¨æ”¶åˆ° onAvailable() å›è°ƒ
â”œâ”€ ç½‘ç»œè¿›å…¥éªŒè¯æµç¨‹ï¼ˆå¦‚éœ€è¦ï¼‰
â”œâ”€ ç½‘ç»œæˆä¸ºå€™é€‰çš„é»˜è®¤ç½‘ç»œ
â””â”€ å¯ä»¥å¤„ç†åº”ç”¨æµé‡</p>
<p>ã€åº”ç”¨å›è°ƒçš„ç±»å‹ä¸é¡ºåºã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>å‡è®¾åº”ç”¨æ³¨å†Œäº† NetworkCallbackï¼š</p>
<pre><code class="hljs language-java" lang="java">ConnectivityManager.<span class="hljs-type">NetworkCallback</span> <span class="hljs-variable">callback</span> <span class="hljs-operator">=</span> 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectivityManager</span>.NetworkCallback() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAvailable</span><span class="hljs-params">(Network network)</span> {
            <span class="hljs-comment">// â† å½“ç½‘ç»œå¯ç”¨æ—¶è°ƒç”¨</span>
            <span class="hljs-comment">// æ­¤æ—¶ç½‘ç»œå·²è¿æ¥</span>
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCapabilitiesChanged</span><span class="hljs-params">(Network network, 
                                         NetworkCapabilities caps)</span> {
            <span class="hljs-comment">// â† å½“ç½‘ç»œèƒ½åŠ›æ”¹å˜æ—¶è°ƒç”¨</span>
            <span class="hljs-comment">// ä¾‹å¦‚ï¼šè·å¾—éªŒè¯ã€å¤±å»éªŒè¯ç­‰</span>
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLinkPropertiesChanged</span><span class="hljs-params">(Network network, 
                                           LinkProperties lp)</span> {
            <span class="hljs-comment">// â† å½“é“¾è·¯å±æ€§æ”¹å˜æ—¶è°ƒç”¨</span>
            <span class="hljs-comment">// ä¾‹å¦‚ï¼šè·å¾— IPv6 åœ°å€</span>
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLosing</span><span class="hljs-params">(Network network, <span class="hljs-type">int</span> maxMsToLive)</span> {
            <span class="hljs-comment">// â† ç½‘ç»œå³å°†ä¸§å¤±</span>
            <span class="hljs-comment">// Linger çŠ¶æ€ï¼Œåº”ç”¨åº”å‡†å¤‡åˆ‡æ¢</span>
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLost</span><span class="hljs-params">(Network network)</span> {
            <span class="hljs-comment">// â† ç½‘ç»œå·²å®Œå…¨æ–­å¼€</span>
            <span class="hljs-comment">// ä¸å†å¯ç”¨</span>
        }
    };

<span class="hljs-comment">// æ³¨å†Œå›è°ƒ</span>
<span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> context.getSystemService(ConnectivityManager.class);
cm.registerNetworkCallback(request, callback);
</code></pre>
<p>å…¸å‹çš„å›è°ƒåºåˆ—ï¼ˆWiFi è¿æ¥è¿‡ç¨‹ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>: ç”¨æˆ·é€‰æ‹© WiFi SSID å¹¶è¾“å…¥å¯†ç 
     â””â”€ WiFiManager å¼€å§‹è¿æ¥

<span class="hljs-attr">T</span>=<span class="hljs-number">1</span>s: WiFi è¿æ¥å»ºç«‹ï¼Œæ­£åœ¨è·å– IP
     â””â”€ NetworkAgent: sendLinkProperties()
     â””â”€ App: onLinkPropertiesChanged() <span class="hljs-section">[ä»… IP åœ°å€]</span>

<span class="hljs-attr">T</span>=<span class="hljs-number">2</span>s: IP è·å–å®Œæˆï¼Œæ ‡è®°ä¸ºè¿æ¥
     â””â”€ NetworkAgent: markConnected()
     â””â”€ ConnectivityService åˆ›å»ºç½‘ç»œ
     â””â”€ App: onAvailable(network) âœ“ ç½‘ç»œå¯ç”¨ï¼

<span class="hljs-attr">T</span>=<span class="hljs-number">3</span>s: IPv6 è‡ªåŠ¨é…ç½®å®Œæˆ
     â””â”€ NetworkAgent: sendNetworkCapabilities() <span class="hljs-section">[æ·»åŠ  IPv6]</span>
     â””â”€ App: onCapabilitiesChanged() <span class="hljs-section">[æ–°å¢ IPv6]</span>

<span class="hljs-attr">T</span>=<span class="hljs-number">4</span>s: NetworkMonitor éªŒè¯äº’è”ç½‘è¿æ¥
     â””â”€ å‘é€ HTTP æ¢æµ‹...

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s: éªŒè¯æˆåŠŸ
     â””â”€ NetworkAgent: sendNetworkCapabilities() <span class="hljs-section">[æ·»åŠ  VALIDATED]</span>
     â””â”€ App: onCapabilitiesChanged() <span class="hljs-section">[è·å¾— VALIDATED èƒ½åŠ›]</span>
     â””â”€ ç½‘ç»œç°åœ¨æ˜¯"é«˜è´¨é‡"çš„

<span class="hljs-attr">T</span>=<span class="hljs-number">100</span>s: ç”¨æˆ·èµ°å‡º WiFi èŒƒå›´ï¼Œä¿¡å·å˜å¼±
     â””â”€ NetworkAgent: sendNetworkScore() <span class="hljs-section">[è¯„åˆ†ä¸‹é™]</span>
     â””â”€ ConnectivityService é‡æ–°è¯„ä¼°
     â””â”€ å¦‚æœ LTE è¯„åˆ†æ›´é«˜ â†’ è§¦å‘ç½‘ç»œåˆ‡æ¢

<span class="hljs-attr">T</span>=<span class="hljs-number">101</span>s: LTE æˆä¸ºæ–°çš„é»˜è®¤ç½‘ç»œ
     â””â”€ App: onAvailable(lte_network)
     â””â”€ App: onLosing(wifi_network, 120000) <span class="hljs-section">[Linger 120 ç§’]</span>
     â””â”€ WiFi æš‚æ—¶ä¿æ´»ï¼ˆå¯èƒ½é©¬ä¸Šé‡è¿ï¼‰

<span class="hljs-attr">T</span>=<span class="hljs-number">120</span>s: Linger æœŸæ»¡ï¼ŒWiFi æ–­å¼€
     â””â”€ App: onLost(wifi_network)
</code></pre>
<pre><code class="hljs language-markdown" lang="markdown">
ç°åœ¨è¿›å…¥ç¬¬ 3 éƒ¨åˆ†ï¼š

<span class="hljs-section">### <span class="hljs-strong">**3ã€NetworkFactory å·¥ä½œåŸç†**</span></span>

</code></pre>
<p>ã€NetworkFactory çš„ä¸‰å¤§æ ¸å¿ƒèŒè´£ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>NetworkFactory æ˜¯ä¸€ä¸ªå·¥å‚ç±»ï¼Œç”±ç½‘ç»œæä¾›è€…ï¼ˆå¦‚ WifiManagerã€TelephonyManagerï¼‰
åˆ›å»ºå’ŒæŒæœ‰ï¼Œç”¨äºç®¡ç†è¯¥æä¾›è€…èƒ½å¦æ»¡è¶³ç‰¹å®šçš„ç½‘ç»œè¯·æ±‚ã€‚</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NetworkFactory èŒè´£                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è¯„ä¼°è¯·æ±‚                            â”‚
â”‚    â”œâ”€ è¯¥å·¥å‚èƒ½å¦æ»¡è¶³æ­¤è¯·æ±‚ï¼Ÿ          â”‚
â”‚    â”œâ”€ è¯„åˆ†æ˜¯å¤šå°‘ï¼Ÿ                    â”‚
â”‚    â””â”€ ä¾æ®ï¼šèƒ½åŠ›ã€ä¿¡å·å¼ºåº¦ç­‰          â”‚
â”‚                                        â”‚
â”‚ 2. ç®¡ç†ç½‘ç»œç”Ÿå‘½å‘¨æœŸ                    â”‚
â”‚    â”œâ”€ æ¥æ”¶è¯·æ±‚æ—¶å¯åŠ¨ç½‘ç»œ              â”‚
â”‚    â”œâ”€ æ‰€æœ‰è¯·æ±‚ç§»é™¤æ—¶å…³é—­ç½‘ç»œ          â”‚
â”‚    â””â”€ åˆ›å»º NetworkAgent               â”‚
â”‚                                        â”‚
â”‚ 3. åŠ¨æ€è°ƒæ•´è¯„åˆ†                        â”‚
â”‚    â”œâ”€ ä¿¡å·å¼ºåº¦å˜åŒ– â†’ è¯„åˆ†å˜åŒ–        â”‚
â”‚    â”œâ”€ é‡æ–°è¯„ä¼°æ‰€æœ‰è¯·æ±‚                â”‚
â”‚    â””â”€ å½±å“ç½‘ç»œé€‰æ‹©                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>ã€TelephonyNetworkFactory çš„å®ç°ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>èœ‚çªç½‘ç»œå·¥å‚çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TelephonyNetworkFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NetworkFactory</span> {
    
    <span class="hljs-comment">// å·¥å‚ç»´æŒçš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚</span>
    <span class="hljs-keyword">private</span> Map&lt;NetworkRequest, Integer&gt; mNetworkRequests = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-comment">// å½“å‰ Phone å¯¹è±¡ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼Œä»£è¡¨å¤šå¼  SIM å¡ï¼‰</span>
    <span class="hljs-keyword">private</span> Phone mPhone;
    
    <span class="hljs-comment">// å¤šå¡ç®¡ç†å™¨</span>
    <span class="hljs-keyword">private</span> PhoneSwitcher mPhoneSwitcher;
    
    <span class="hljs-comment">/**
     * Called by ConnectivityService when a new NetworkRequest is received
     * that matches this factory's filter.
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">needNetworkFor</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// æ­¥éª¤ 1: æ£€æŸ¥æ˜¯å¦å·²æœ‰ç›¸åŒçš„è¯·æ±‚</span>
        <span class="hljs-keyword">if</span> (mNetworkRequests.containsKey(request)) {
            <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// å·²æœ‰ç›¸åŒè¯·æ±‚ï¼Œæ— éœ€é‡å¤</span>
        }
        
        <span class="hljs-comment">// æ­¥éª¤ 2: è¯„ä¼°æ˜¯å¦å¯ä»¥æ»¡è¶³</span>
        <span class="hljs-comment">// ä¾‹å¦‚ï¼šæ£€æŸ¥ä¿¡å·å¼ºåº¦ã€æ˜¯å¦åœ¨ Airplane Mode ç­‰</span>
        <span class="hljs-keyword">if</span> (!canSatisfyRequest(request)) {
            <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// æ— æ³•æ»¡è¶³ï¼Œæ‹’ç»</span>
        }
        
        <span class="hljs-comment">// æ­¥éª¤ 3: å¦‚æœè¿™æ˜¯ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œå¯åŠ¨æ•°æ®è¿æ¥</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isFirstRequest</span> <span class="hljs-operator">=</span> mNetworkRequests.isEmpty();
        
        <span class="hljs-comment">// æ­¥éª¤ 4: è®°å½•è¯·æ±‚</span>
        mNetworkRequests.put(request, TRANSPORT_CELLULAR);
        
        <span class="hljs-keyword">if</span> (isFirstRequest) {
            <span class="hljs-comment">// è¿™æ˜¯ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œå¯åŠ¨æ•°æ®è¿æ¥</span>
            <span class="hljs-comment">// ä¾‹å¦‚å»ºç«‹ PDP Context</span>
            startDataConnection(request);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å·²ç»æœ‰æ´»è·ƒçš„æ•°æ®è¿æ¥</span>
            <span class="hljs-comment">// æ–°è¯·æ±‚å¯ä»¥ç«‹å³ä½¿ç”¨</span>
        }
    }
    
    <span class="hljs-comment">/**
     * Called by ConnectivityService when a NetworkRequest is withdrawn
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseNetworkFor</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// æ­¥éª¤ 1: ç§»é™¤è¯·æ±‚</span>
        mNetworkRequests.remove(request);
        
        <span class="hljs-comment">// æ­¥éª¤ 2: å¦‚æœæ²¡æœ‰æ›´å¤šè¯·æ±‚ï¼Œå…³é—­æ•°æ®è¿æ¥</span>
        <span class="hljs-keyword">if</span> (mNetworkRequests.isEmpty()) {
            stopDataConnection();  <span class="hljs-comment">// æ–­å¼€ PDP Context</span>
        }
    }
    
    <span class="hljs-comment">/**
     * å¼€å§‹æ•°æ®è¿æ¥
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startDataConnection</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// ä¸ DataNetworkController é€šä¿¡</span>
        mDataNetworkController.requestDataConnection(
            request.getApnType(),   <span class="hljs-comment">// ä¾‹å¦‚ï¼šINTERNET, IMS, MMS</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataConnectionCallback</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onConnected</span><span class="hljs-params">(DataNetwork network, LinkProperties lp)</span> {
                    <span class="hljs-comment">// ç½‘ç»œå·²è¿æ¥</span>
                    <span class="hljs-comment">// åˆ›å»º TelephonyNetworkAgent å‘ç³»ç»Ÿæ³¨å†Œ</span>
                    <span class="hljs-type">TelephonyNetworkAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TelephonyNetworkAgent</span>(
                        mPhone,
                        mLooper,
                        network,   <span class="hljs-comment">// DataNetwork å¯¹è±¡</span>
                        score,     <span class="hljs-comment">// åˆå§‹è¯„åˆ†ï¼ˆåŸºäºä¿¡å·å¼ºåº¦ï¼‰</span>
                        config,
                        <span class="hljs-built_in">this</span>       <span class="hljs-comment">// provider (TelephonyNetworkFactory)</span>
                    );
                    <span class="hljs-comment">// agent.register() åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨</span>
                }
                
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDisconnected</span><span class="hljs-params">()</span> {
                    <span class="hljs-comment">// ç½‘ç»œå·²æ–­å¼€</span>
                    <span class="hljs-comment">// agent å°†è°ƒç”¨ unregister()</span>
                }
            }
        );
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopDataConnection</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// é€šçŸ¥ DataNetworkController å…³é—­æ‰€æœ‰ PDP Context</span>
        mDataNetworkController.releaseDataConnection();
    }
}
</code></pre>
<p>å…³é”®ç‰¹ç‚¹ï¼š
â”œâ”€ ä¸€ä¸ª Factory å¯èƒ½åŒæ—¶æ»¡è¶³å¤šä¸ª NetworkRequest
â”œâ”€ ä½†åº•å±‚å¯èƒ½åªæœ‰ä¸€ä¸ªæ•°æ®è¿æ¥ï¼ˆPDP Contextï¼‰
â”œâ”€ æ‰€æœ‰è¯·æ±‚å…±äº«åŒä¸€ä¸ª NetworkAgent
â”œâ”€ å½“æœ€åä¸€ä¸ªè¯·æ±‚ç§»é™¤æ—¶æ‰æ–­å¼€è¿æ¥</p>
<p>ã€WiFi NetworkFactory çš„å®ç°ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>WiFi å·¥å‚çš„ç‰¹ç‚¹ï¼šä¸€ä¸ª WiFi è¿æ¥ä¸€ä¸ª NetworkAgent</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WifiNetworkFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NetworkFactory</span> {
    
    <span class="hljs-comment">// WiFi æä¾›çš„ç½‘ç»œ Agentï¼ˆé€šå¸¸åªæœ‰ä¸€ä¸ªï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">WifiNetworkAgent</span> <span class="hljs-variable">mWifiAgent</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">// WiFi ç®¡ç†å™¨</span>
    <span class="hljs-keyword">private</span> WifiManager mWifiManager;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">needNetworkFor</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// WiFi å·¥å‚çš„é€»è¾‘ç›¸å¯¹ç®€å•</span>
        
        <span class="hljs-comment">// step 1: å¦‚æœå·²ç»æœ‰ WiFi è¿æ¥</span>
        <span class="hljs-keyword">if</span> (mWifiAgent != <span class="hljs-literal">null</span> &amp;&amp; mWifiAgent.isConnected()) {
            <span class="hljs-comment">// WiFi ç½‘ç»œå·²è¿æ¥ï¼Œå¯ä»¥æ»¡è¶³è¯·æ±‚</span>
            <span class="hljs-comment">// (æ— éœ€é¢å¤–æ“ä½œï¼Œè¯¥ç½‘ç»œå·²æ³¨å†Œ)</span>
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// step 2: å¦‚æœæ²¡æœ‰ WiFiï¼Œå¯èƒ½å¯åŠ¨æ‰«æ</span>
        <span class="hljs-comment">// æˆ–è€…å¦‚æœä¹‹å‰å·²è¿æ¥ä½†æš‚æ—¶æ–­å¼€ï¼Œè‡ªåŠ¨é‡è¿</span>
        <span class="hljs-keyword">if</span> (mWifiManager != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// WiFi åœ¨ä¹‹å‰å·²é…ç½®ï¼Œè‡ªåŠ¨é‡è¿</span>
            mWifiManager.reconnect();
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseNetworkFor</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// WiFi ä¸ä¼šå› ä¸ºä¸€ä¸ªè¯·æ±‚çš„ç§»é™¤å°±æ–­å¼€</span>
        <span class="hljs-comment">// ç”¨æˆ·å¯èƒ½è¿˜åœ¨æµè§ˆç½‘é¡µï¼Œå³ä½¿åº”ç”¨æ²¡æœ‰ç‰¹å®šçš„ç½‘ç»œè¯·æ±‚</span>
        <span class="hljs-comment">// WiFi åº”è¯¥ä¿æ´»</span>
        
        <span class="hljs-comment">// å®é™…ä¸Šï¼ŒWiFi é€šå¸¸ä¸å®ç°è¿™ä¸ªæ–¹æ³•</span>
        <span class="hljs-comment">// æˆ–è€…ç›´æ¥ returnï¼ˆæ— æ“ä½œï¼‰</span>
    }
    
    <span class="hljs-comment">/**
     * å½“ WiFi è¿æ¥æˆåŠŸæ—¶ï¼Œç”± WifiMonitor æˆ– WifiManager è°ƒç”¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onWifiConnected</span><span class="hljs-params">(String ssid, <span class="hljs-type">int</span> rssi)</span> {
        <span class="hljs-comment">// åˆ›å»ºæ–°çš„ WifiNetworkAgent</span>
        mWifiAgent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WifiNetworkAgent</span>(
            mContext,
            mLooper,
            ssid,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkCapabilities</span>.Builder()
                .addTransportType(TRANSPORT_WIFI)
                .addCapability(NET_CAPABILITY_INTERNET)
                .addCapability(NET_CAPABILITY_NOT_METERED)  <span class="hljs-comment">// é€šå¸¸ä¸è®¡é‡</span>
                .setSignalStrength(rssiToSignalLevel(rssi))
                .build(),
            linkProperties,
            networkScore,
            config,
            provider
        );
        
        mWifiAgent.register();  <span class="hljs-comment">// æ³¨å†Œåˆ°ç³»ç»Ÿ</span>
    }
    
    <span class="hljs-comment">/**
     * å½“ WiFi æ–­å¼€è¿æ¥æ—¶
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onWifiDisconnected</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (mWifiAgent != <span class="hljs-literal">null</span>) {
            mWifiAgent.unregister();
            mWifiAgent = <span class="hljs-literal">null</span>;
        }
    }
}
</code></pre>
<p>WiFi å’Œç§»åŠ¨ç½‘ç»œçš„é‡è¦åŒºåˆ«ï¼š
â”œâ”€ WiFi: ä¸€ä¸ªè¿æ¥ä¸€ä¸ª Agentï¼ˆå¤šä¸ªåº”ç”¨å…±äº«ï¼‰
â”œâ”€ ç§»åŠ¨ç½‘ç»œ: å¯èƒ½æœ‰å¤šä¸ª PDP Contextï¼ˆä¸åŒ APNï¼‰
â””â”€ å…³é”®ï¼šè¯„åˆ†å†³å®šä½¿ç”¨å“ªä¸ªç½‘ç»œ</p>
<p>ã€ç½‘ç»œè¯·æ±‚çš„åŒ¹é…ç®—æ³•ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>ConnectivityService å¦‚ä½•å†³å®šå“ªä¸ªå·¥å‚æ¥æ»¡è¶³è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rematchAllNetworksAndRequests</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// æ­¥éª¤ 1: è·å–æ‰€æœ‰ç½‘ç»œï¼ŒæŒ‰è¯„åˆ†æ’åº</span>
    List&lt;NetworkAgentInfo&gt; networks = sortByScore(mNetworkAgents);
    
    <span class="hljs-comment">// æ­¥éª¤ 2: å¯¹äºæ¯ä¸ªç½‘ç»œï¼Œæ£€æŸ¥æ‰€æœ‰æœªåˆ†é…çš„è¯·æ±‚</span>
    <span class="hljs-keyword">for</span> (NetworkAgentInfo network : networks) {
        <span class="hljs-keyword">for</span> (NetworkRequestInfo request : mNetworkRequests) {
            <span class="hljs-keyword">if</span> (request.isAlreadyAssigned()) {
                <span class="hljs-keyword">continue</span>;  <span class="hljs-comment">// å·²åˆ†é…ç»™å…¶ä»–ç½‘ç»œ</span>
            }
            
            <span class="hljs-comment">// æ£€æŸ¥ç½‘ç»œæ˜¯å¦æ»¡è¶³è¯·æ±‚</span>
            <span class="hljs-keyword">if</span> (network.networkCapabilities.canBeSatisfiedBy(
                    request.networkRequest.getCapabilities())) {
                
                <span class="hljs-comment">// åˆ†é…è¯¥ç½‘ç»œç»™è¯¥è¯·æ±‚</span>
                assignNetworkToRequest(network, request);
            }
        }
    }
}
</code></pre>
<p>å…·ä½“çš„åŒ¹é…é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canNetworkSatisfyRequest</span><span class="hljs-params">(
    NetworkAgentInfo network, NetworkRequest request)</span> {
    
    <span class="hljs-comment">// æ£€æŸ¥ 1: èƒ½åŠ›åŒ¹é…</span>
    <span class="hljs-comment">// è¯·æ±‚çš„æ‰€æœ‰ REQUIRED èƒ½åŠ›å¿…é¡»å­˜åœ¨</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> capability : request.getCapabilities()) {
        <span class="hljs-keyword">if</span> (!network.networkCapabilities.hasCapability(capability)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ç½‘ç»œç¼ºå°‘å¿…è¦çš„èƒ½åŠ›</span>
        }
    }
    
    <span class="hljs-comment">// æ£€æŸ¥ 2: UNWANTED èƒ½åŠ›</span>
    <span class="hljs-comment">// è¯·æ±‚è¦æ±‚çš„ä»»ä½• UNWANTED èƒ½åŠ›éƒ½ä¸èƒ½å­˜åœ¨</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> unwanted : request.getUnwantedCapabilities()) {
        <span class="hljs-keyword">if</span> (network.networkCapabilities.hasCapability(unwanted)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ç½‘ç»œæœ‰ä¸éœ€è¦çš„èƒ½åŠ›</span>
        }
    }
    
    <span class="hljs-comment">// æ£€æŸ¥ 3: ä¼ è¾“ç±»å‹</span>
    <span class="hljs-comment">// å¦‚æœè¯·æ±‚æŒ‡å®šäº†ä¼ è¾“ç±»å‹ï¼Œå¿…é¡»åŒ¹é…</span>
    <span class="hljs-keyword">if</span> (request.hasTransport()) {
        <span class="hljs-keyword">if</span> (!network.networkCapabilities.hasTransport(request.getTransport())) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ä¼ è¾“ç±»å‹ä¸åŒ¹é…</span>
        }
    }
    
    <span class="hljs-comment">// æ£€æŸ¥ 4: ç‰¹æ®Šçš„ä¼ä¸šéœ€æ±‚ï¼ˆå¦‚æœæœ‰ï¼‰</span>
    <span class="hljs-comment">// ä¼ä¸š VPN, ç‰¹å®šè¿è¥å•†ç­‰</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// ç½‘ç»œå¯ä»¥æ»¡è¶³è¯·æ±‚</span>
}
</code></pre>
<p>è¯·æ±‚åˆ†é…çš„ä¼˜å…ˆçº§ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">ä¼˜å…ˆçº§ 1: å·²éªŒè¯çš„ç½‘ç»œ (NET<span class="hljs-emphasis">_CAPABILITY_</span>VALIDATED)
<span class="hljs-code">          â”œâ”€ åˆ†é…ç»™ INTERNET è¯·æ±‚
          â”œâ”€ è¯„åˆ†è¶Šé«˜è¶Šä¼˜å…ˆ
          â””â”€ é€šå¸¸æ˜¯ WiFi æˆ–å¼ºä¿¡å·çš„ LTE
</span>
ä¼˜å…ˆçº§ 2: æœªéªŒè¯ä½†è¿æ¥çš„ç½‘ç»œ
<span class="hljs-code">          â”œâ”€ å¯ä»¥æš‚æ—¶æ»¡è¶³è¯·æ±‚
          â”œâ”€ ä½†åº”ç”¨å¯èƒ½æ£€æµ‹åˆ°æ— äº’è”ç½‘
          â””â”€ ç”¨äºæŸäº›ç‰¹æ®Šåº”ç”¨ï¼ˆæœ¬åœ°ç½‘ç»œï¼‰
</span>
ä¼˜å…ˆçº§ 3: VPN ç½‘ç»œ
<span class="hljs-code">          â”œâ”€ è¯„åˆ†é«˜äºåº•å±‚ç½‘ç»œ
          â”œâ”€ æµé‡è¢« VPN åŠ å¯†
          â””â”€ æ‰€æœ‰äº’è”ç½‘è¯·æ±‚è¢«è½¬å‘ VPN
</span>
ä¼˜å…ˆçº§ 4: å…¶ä»–ç‰¹æ®Šç½‘ç»œ
<span class="hljs-code">          â”œâ”€ è“ç‰™ç½‘ç»œ
          â”œâ”€ ä»¥å¤ªç½‘
          â””â”€ æœ¬åœ°ç½‘ç»œï¼ˆä¸éœ€è¦äº’è”ç½‘ï¼‰
</span></code></pre>
<pre><code class="hljs language-markdown" lang="markdown">
è®©æˆ‘ç»§ç»­è®²è§£ç¬¬ 4 éƒ¨åˆ†ï¼š

<span class="hljs-section">### <span class="hljs-strong">**4ã€ç½‘ç»œçŠ¶æ€ç®¡ç†ä¸ Linger æœºåˆ¶**</span></span>

</code></pre>
<p>ã€9 ç§å…³é”®çš„ç½‘ç»œçŠ¶æ€ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>Android ç½‘ç»œæ ˆä¸­ï¼Œä¸€ä¸ªç½‘ç»œå¯ä»¥å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š</p>
<p>1ï¸âƒ£ IDLE / UNREGISTEREDï¼ˆç©ºé—²/æœªæ³¨å†Œï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œè¿˜ä¸å­˜åœ¨æˆ–å°šæœªè¢«ç³»ç»Ÿæ„ŸçŸ¥
â”œâ”€ NetworkAgent å°šæœªåˆ›å»ºæˆ–å·²é”€æ¯
â””â”€ å…¸å‹æƒ…å†µï¼šWiFi æœªè¿æ¥ã€ç§»åŠ¨ç½‘ç»œæ— ä¿¡å·</p>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ æœ€é•¿ï¼ˆç›´åˆ°ç”¨æˆ·è¿æ¥æˆ–è®¾å¤‡ç§»å‡ºä¿¡å·èŒƒå›´ï¼‰
â””â”€ æ— ç¡®å®šçš„ç»ˆæ­¢æ—¶é—´</p>
<p>è½¬æ¢åˆ°ï¼š
â””â”€ â†’ REGISTERING / CONNECTING</p>
<p>2ï¸âƒ£ REGISTERINGï¼ˆæ³¨å†Œä¸­ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ NetworkAgent å·²åˆ›å»ºä½†å°šæœªå‘ ConnectivityService æ³¨å†Œ
â”œâ”€ æˆ–åˆšæ³¨å†Œä½†åˆå§‹çŠ¶æ€è¿˜æ˜¯ DISCONNECTED
â””â”€ ç½‘ç»œè¿˜ä¸å¯ç”¨</p>
<p>ç¤ºä¾‹æµç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// WiFi æˆ–ç§»åŠ¨ç½‘ç»œåˆšå‘ç°ï¼Œåˆ›å»º Agent</span>
<span class="hljs-type">WifiNetworkAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WifiNetworkAgent</span>(...);
<span class="hljs-comment">// æ­¤æ—¶ç½‘ç»œæ˜¯ REGISTERING</span>

<span class="hljs-comment">// Agent å‘ç³»ç»Ÿæ³¨å†Œ</span>
agent.register();
<span class="hljs-comment">// ç°åœ¨åœ¨ ConnectivityService ä¸­è®°å½•ï¼Œä½†çŠ¶æ€ä»æ˜¯ DISCONNECTED</span>
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ éå¸¸çŸ­ï¼ˆé€šå¸¸ &lt; 100msï¼‰
â””â”€ ç›´åˆ° Agent æ„é€ å®Œæˆå¹¶è°ƒç”¨ register()</p>
<p>è½¬æ¢åˆ°ï¼š
â””â”€ â†’ CONNECTING æˆ– DISCONNECTED</p>
<p>3ï¸âƒ£ CONNECTINGï¼ˆè¿æ¥ä¸­ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ NetworkAgent å·²æ³¨å†Œï¼Œæ­£åœ¨å»ºç«‹è¿æ¥
â”œâ”€ åº•å±‚é©±åŠ¨ï¼ˆWiFi Driverã€RILï¼‰æ­£åœ¨å·¥ä½œ
â”œâ”€ å¯èƒ½åœ¨èº«ä»½éªŒè¯ã€è·å– IP ç­‰é˜¶æ®µ
â””â”€ ç½‘ç»œè¿˜ä¸èƒ½æ¥æ”¶æµé‡</p>
<p>å…¸å‹çš„ CONNECTING å­é˜¶æ®µï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">CONNECTING
â”œâ”€ SCANNINGï¼ˆæ‰«æå¯ç”¨ç½‘ç»œï¼‰
â”œâ”€ AUTHENTICATINGï¼ˆéªŒè¯èº«ä»½/å¯†ç ï¼‰
â”œâ”€ OBTAINING_IPADDRï¼ˆé€šè¿‡ DHCP è·å– IPï¼‰
â”œâ”€ VERIFYING_POOR_LINKï¼ˆæ£€æŸ¥è¿æ¥è´¨é‡ï¼‰
â””â”€ <span class="hljs-built_in">CAPTIVE_PORTAL_CHECK</span>ï¼ˆæ£€æŸ¥å¼ºåˆ¶é—¨æˆ·ï¼‰
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">ç”¨æˆ·é€‰æ‹© <span class="hljs-built_in">WiFi</span> SSID å¹¶è¾“å…¥å¯†ç 
â†“
WifiManager.<span class="hljs-built_in">connect</span>()
â†“
WifiNetworkAgent: <span class="hljs-built_in">sendNetworkInfo</span>(CONNECTING)
â†“
ConnectivityService: ç½‘ç»œçŠ¶æ€å˜ä¸º CONNECTING
â†“
åº”ç”¨çœ‹åˆ°ç½‘ç»œåœ¨ CONNECTINGï¼ˆonAvailable è¿˜æœªè°ƒç”¨ï¼‰
â†“
ç»è¿‡æ•°ç§’...
â†“
<span class="hljs-built_in">WiFi</span> Driver è·å¾— IP åœ°å€
â†“
WifiNetworkAgent: <span class="hljs-built_in">markConnected</span>()
â†“
çŠ¶æ€è½¬ä¸º CONNECTED
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ WiFi: 1-5 ç§’ï¼ˆé€šå¸¸ï¼‰
â”œâ”€ ç§»åŠ¨ç½‘ç»œ: 3-10 ç§’ï¼ˆå–å†³äºä¿¡å·ï¼‰
â””â”€ æ¶åŠ£æ¡ä»¶ï¼šå¯èƒ½è¶…è¿‡ 30 ç§’</p>
<p>è½¬æ¢åˆ°ï¼š
â”œâ”€ â†’ CONNECTEDï¼ˆè¿æ¥æˆåŠŸï¼‰
â””â”€ â†’ DISCONNECTEDï¼ˆè¿æ¥å¤±è´¥ï¼‰</p>
<p>4ï¸âƒ£ CONNECTEDï¼ˆå·²è¿æ¥ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œå®Œå…¨è¿æ¥ï¼ŒL3 è¿é€šæ€§å·²å»ºç«‹
â”œâ”€ IP åœ°å€ã€ç½‘å…³ã€DNS é…ç½®å®Œæˆ
â”œâ”€ åº”ç”¨å¯ä»¥é€šè¿‡ NetworkRequest ä½¿ç”¨è¯¥ç½‘ç»œ
â”œâ”€ ç½‘ç»œå¯ä»¥æ¥æ”¶å’Œå‘é€æ•°æ®åŒ…</p>
<p>è¿™æ˜¯æœ€é‡è¦çš„ä¸€ä¸ªçŠ¶æ€ï¼Œåˆ†ä¸ºä¸¤ä¸ªå­é˜¶æ®µï¼š</p>
<p>4a. CONNECTED (UNVALIDATED)
â”œâ”€ ç½‘ç»œå·²è¿æ¥ä½†éªŒè¯çŠ¶æ€æœªçŸ¥
â”œâ”€ å¯èƒ½æ— æ³•è®¿é—®äº’è”ç½‘ï¼ˆä¾‹å¦‚ï¼Œéœ€è¦ç™»å½•é—¨æˆ·ï¼‰
â”œâ”€ NetworkMonitor å¯èƒ½æ­£åœ¨éªŒè¯
â””â”€ åº”ç”¨åº”è¯¥é¢„æœŸéªŒè¯å¤±è´¥</p>
<p>4b. CONNECTED (VALIDATED)
â”œâ”€ ç½‘ç»œå·²è¿æ¥ä¸”éªŒè¯é€šè¿‡
â”œâ”€ æœ‰çœŸå®çš„äº’è”ç½‘è¿æ¥
â”œâ”€ åº”ç”¨å¯ä»¥å®‰å…¨ä½¿ç”¨è¯¥ç½‘ç»œ
â””â”€ ç½‘ç»œæˆä¸ºä¸»è¦ç½‘ç»œçš„å€™é€‰</p>
<p>ç¤ºä¾‹æ—¶é—´çº¿ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>s: ç½‘ç»œ CONNECTEDï¼ˆæœªéªŒè¯ï¼‰
     â””â”€ NetworkMonitor å¯åŠ¨éªŒè¯

<span class="hljs-attr">T</span>=<span class="hljs-number">2</span>-<span class="hljs-number">5</span>s: éªŒè¯åœ¨è¿›è¡Œä¸­
      â””â”€ å‘é€ HTTP æ¢æµ‹ã€DNS æŸ¥è¯¢ç­‰

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s: éªŒè¯å®Œæˆ
     â”œâ”€ æƒ…å†µ A: éªŒè¯æˆåŠŸ â†’ VALIDATED
     â”œâ”€ æƒ…å†µ B: æ£€æµ‹åˆ°å¼ºåˆ¶é—¨æˆ· â†’ CAPTIVE_PORTAL
     â””â”€ æƒ…å†µ C: ç½‘ç»œç¦»çº¿ â†’ UNVALIDATED
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ å¯ä»¥æŒç»­æ•°ç§’åˆ°æ•°å°æ—¶
â”œâ”€ ç›´åˆ°ç½‘ç»œæ–­å¼€æˆ–è¢«æ›¿æ¢
â””â”€ æˆ–è€…ä» VALIDATED é™çº§åˆ° UNVALIDATEDï¼ˆè¿æ¥å˜å·®ï¼‰</p>
<p>è½¬æ¢åˆ°ï¼š
â”œâ”€ â†’ LOSINGï¼ˆè¢«æ›´å¥½çš„ç½‘ç»œæ›¿æ¢ï¼‰
â”œâ”€ â†’ SUSPENDEDï¼ˆä¸´æ—¶æš‚åœï¼Œä¾‹å¦‚é£è¡Œæ¨¡å¼ï¼‰
â””â”€ â†’ DISCONNECTEDï¼ˆç½‘ç»œæ•…éšœæˆ–ç”¨æˆ·æ–­å¼€ï¼‰</p>
<p>5ï¸âƒ£ LOSINGï¼ˆå³å°†ä¸§å¤±ï¼‰â­ Linger çŠ¶æ€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œå³å°†è¢«æ›¿æ¢ä¸ºæ›´å¥½çš„ç½‘ç»œ
â”œâ”€ ä½†ä»ä¿æ´»ä¸€æ®µæ—¶é—´ï¼ˆLinger æ—¶é—´ï¼‰
â”œâ”€ åº”ç”¨æœ‰æœºä¼šå¹³æ»‘åˆ‡æ¢
â”œâ”€ å…¸å‹åœºæ™¯ï¼šWiFi å˜å¼±ï¼Œåˆ‡æ¢åˆ° LTEï¼Œä½† WiFi è¿˜æ´»ç€</p>
<p>ä½•æ—¶è¿›å…¥ LOSINGï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ConnectivityService å‘ç°ï¼š
â”œâ”€ æ–°ç½‘ç»œæ¯”å½“å‰ç½‘ç»œè¯„åˆ†é«˜
â”œâ”€ æ–°ç½‘ç»œä¹Ÿèƒ½æ»¡è¶³ç›¸åŒçš„è¯·æ±‚
â”œâ”€ è®¾ç½® Linger è®¡æ—¶å™¨ï¼ˆé€šå¸¸ <span class="hljs-number">120</span> ç§’ï¼‰
â””â”€ å‘ŠçŸ¥åº”ç”¨ï¼š<span class="hljs-built_in">onLosing</span>(network, maxMsToLive)
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>s: ç”¨æˆ·èµ°å‡º WiFi èŒƒå›´ï¼ŒWiFi ä¿¡å·å˜å¼±
     â””â”€ WiFiNetworkAgent é™ä½è¯„åˆ†

<span class="hljs-attr">T</span>=<span class="hljs-number">1</span>s: LTE ä¿¡å·å¼ºäº WiFi
     â””â”€ ConnectivityService é‡æ–°è¯„ä¼°
     â””â”€ å†³å®šï¼šLTE æ˜¯æ–°çš„é»˜è®¤ç½‘ç»œ

<span class="hljs-attr">T</span>=<span class="hljs-number">2</span>s: WiFi è¿›å…¥ LOSING çŠ¶æ€
     â””â”€ è°ƒç”¨æ‰€æœ‰ç›‘å¬è€…çš„ onLosing()
     â””â”€ è®¾ç½® 120 ç§’ Linger è®¡æ—¶å™¨

<span class="hljs-attr">T</span>=<span class="hljs-number">2</span>-<span class="hljs-number">120</span>s: WiFi ä»å¯ç”¨
         â”œâ”€ å·²è¿æ¥çš„ Socket å¯ç»§ç»­ä½¿ç”¨
         â”œâ”€ æ–°çš„ Socket é»˜è®¤ä½¿ç”¨ LTE
         â”œâ”€ åº”ç”¨å¦‚æœæ„¿æ„å¯ä»¥ç»§ç»­ç”¨ WiFi
         â””â”€ onLosing() å‘Šè¯‰åº”ç”¨ï¼šè¿˜æœ‰ 120 ç§’ï¼

<span class="hljs-attr">T</span>=<span class="hljs-number">122</span>s: Linger æ—¶é—´åˆ°æœŸ
       â””â”€ WiFi è¿›å…¥ DISCONNECTED
       â””â”€ è°ƒç”¨æ‰€æœ‰ç›‘å¬è€…çš„ onLost()
</code></pre>
<p>Linger çš„è®¾ç½®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é»˜è®¤ Linger æ—¶é—´ï¼ˆç§’ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DEFAULT_LINGER_DELAY_MS</span> <span class="hljs-operator">=</span> <span class="hljs-number">120</span> * <span class="hljs-number">1000</span>;  <span class="hljs-comment">// 120 ç§’</span>

<span class="hljs-comment">// ä¸åŒç½‘ç»œç±»å‹çš„ Linger æ—¶é—´</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">WIFI_LINGER_TIME_MS</span> <span class="hljs-operator">=</span> <span class="hljs-number">120</span> * <span class="hljs-number">1000</span>;      <span class="hljs-comment">// WiFi: 120 ç§’</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CELLULAR_LINGER_TIME_MS</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;   <span class="hljs-comment">// LTE: 60 ç§’</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">VPN_LINGER_TIME_MS</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span> * <span class="hljs-number">1000</span>;        <span class="hljs-comment">// VPN: 30 ç§’</span>
</code></pre>
<p>Linger çš„ç”¨é€”ï¼š
â”œâ”€ ç»™åº”ç”¨æ—¶é—´è¿›è¡Œå¹³æ»‘è¿‡æ¸¡
â”œâ”€ é¿å…é¢‘ç¹çš„ç½‘ç»œåˆ‡æ¢
â”œâ”€ ä¿æŠ¤æ—§ç½‘ç»œä¸Šå·²å»ºç«‹çš„è¿æ¥
â”œâ”€ å‡å°‘ç”¨æˆ·æ„ŸçŸ¥çš„ä¸­æ–­</p>
<p>Linger çš„ç¼ºç‚¹ï¼š
â”œâ”€ å»¶è¿Ÿäº†ç½‘ç»œé‡Šæ”¾
â”œâ”€ æ¶ˆè€—ç”µæ± ï¼ˆç½‘ç»œèŠ¯ç‰‡ä¿æŒæ´»è·ƒï¼‰
â”œâ”€ æµªè´¹æµé‡ï¼ˆåŒæ—¶ä½¿ç”¨ä¸¤ä¸ªç½‘ç»œï¼‰
â””â”€ æŸäº› OEM å‡çŸ­æˆ–å…³é—­ Linger</p>
<p>6ï¸âƒ£ SUSPENDEDï¼ˆæš‚åœï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œä»ç„¶è¿æ¥ï¼Œä½†ä¸´æ—¶ä¸å¯ç”¨
â”œâ”€ ä¾‹å¦‚ï¼šé£è¡Œæ¨¡å¼æ‰“å¼€ã€è®¾å¤‡æš‚åœ
â”œâ”€ åº”ç”¨çœ‹ä¸åˆ°è¯¥ç½‘ç»œ</p>
<p>è§¦å‘æ¡ä»¶ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">é£è¡Œæ¨¡å¼å¯ç”¨
  â†’ PhoneStateListener<span class="hljs-selector-class">.onServiceStateChanged</span>()
  â†’ Telephony ç½‘ç»œ SUSPENDED

å±å¹•å…³é—­ + æŸäº› App è¦æ±‚
  â†’ DeviceIdleManager å‘é€ IDLE ä¿¡å·
  â†’ éå¿…è¦ç½‘ç»œ SUSPENDED

VPN è¿æ¥
  â†’ åº•å±‚ç½‘ç»œ SUSPENDED
  â†’ VPN ç½‘ç»œæˆä¸ºå”¯ä¸€çš„ INTERNET ç½‘ç»œ
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>s: WiFi æ­£å¸¸è¿æ¥å¹¶éªŒè¯
     â””â”€ ç½‘ç»œ: CONNECTED, VALIDATED

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s: ç”¨æˆ·å¯ç”¨é£è¡Œæ¨¡å¼
     â””â”€ WifiManager.setAirplaneModeEnabled(true)
     â””â”€ æ‰€æœ‰ç½‘ç»œçŠ¶æ€: SUSPENDED
     â””â”€ onLost() å›è°ƒï¼ˆåº”ç”¨çœ‹ä¸åˆ°ç½‘ç»œï¼‰

<span class="hljs-attr">T</span>=<span class="hljs-number">10</span>s: ç”¨æˆ·å…³é—­é£è¡Œæ¨¡å¼
      â””â”€ WiFi æ¢å¤è¿æ¥
      â””â”€ ç½‘ç»œçŠ¶æ€å›åˆ° CONNECTED
      â””â”€ onAvailable() å›è°ƒ
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ å¯ä»¥æ˜¯ç§’çº§ï¼ˆä¸´æ—¶æš‚åœï¼‰
â”œâ”€ ä¹Ÿå¯ä»¥æ˜¯é•¿æ—¶é—´ï¼ˆç”¨æˆ·ä¸æ”¹å˜è®¾ç½®ï¼‰
â””â”€ æ— è‡ªåŠ¨æ¸…é™¤ï¼Œéœ€è¦ç”¨æˆ·æˆ–ç³»ç»Ÿäº‹ä»¶è§¦å‘æ¢å¤</p>
<p>è½¬æ¢åˆ°ï¼š
â”œâ”€ â†’ CONNECTEDï¼ˆæ¢å¤å¯ç”¨ï¼‰
â””â”€ â†’ DISCONNECTEDï¼ˆæ°¸ä¹…æ–­å¼€ï¼‰</p>
<p>7ï¸âƒ£ DISCONNECTINGï¼ˆæ–­å¼€ä¸­ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œæ­£åœ¨ä¼˜é›…æ–­å¼€è¿æ¥
â”œâ”€ åº•å±‚é©±åŠ¨æ­£åœ¨è¿›è¡Œæ¸…ç†ï¼ˆä¾‹å¦‚æ³¨é”€ä¼šè¯ï¼‰
â”œâ”€ åº”ç”¨åº”è¯¥åœæ­¢ä½¿ç”¨è¯¥ç½‘ç»œ
â”œâ”€ è¿™ä¸ªçŠ¶æ€é€šå¸¸å¾ˆçŸ­</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ç”¨æˆ·æŒ‰"æ–­å¼€è¿æ¥"æŒ‰é’®
â†“
WifiManager<span class="hljs-selector-class">.disconnect</span>()
â†“
WiFi Driver å‘é€æ–­å¼€å¸§åˆ° AP
â†“
NetworkAgent: <span class="hljs-built_in">sendNetworkInfo</span>(DISCONNECTING)
â†“
åº”ç”¨æ”¶åˆ° <span class="hljs-built_in">onLosing</span>() å’Œåç»­çš„ <span class="hljs-built_in">onLost</span>()
â†“
ï¼ˆæ•°ç™¾æ¯«ç§’åï¼‰
â†“
Driver ç¡®è®¤æ–­å¼€å®Œæˆ
â†“
NetworkAgent: <span class="hljs-built_in">unregister</span>()
â†“
çŠ¶æ€å˜ä¸º DISCONNECTED
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ é€šå¸¸ &lt; 1 ç§’
â”œâ”€ WiFi: 100-500ms
â”œâ”€ ç§»åŠ¨ç½‘ç»œ: 500ms - 2 ç§’
â””â”€ è‹¥é©±åŠ¨æœ‰é—®é¢˜å¯èƒ½æ›´é•¿</p>
<p>è½¬æ¢åˆ°ï¼š
â””â”€ â†’ DISCONNECTEDï¼ˆæ–­å¼€å®Œæˆï¼‰</p>
<p>8ï¸âƒ£ DISCONNECTEDï¼ˆå·²æ–­å¼€ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œå·²å®Œå…¨æ–­å¼€
â”œâ”€ NetworkAgent å·² unregister()
â”œâ”€ åº”ç”¨æ— æ³•ä½¿ç”¨è¯¥ç½‘ç»œ
â”œâ”€ è¿™æ˜¯ç½‘ç»œç”Ÿå‘½å‘¨æœŸçš„ç»ˆç‚¹</p>
<p>å¯èƒ½çš„åŸå› ï¼š
â”œâ”€ ç”¨æˆ·æ‰‹åŠ¨æ–­å¼€
â”œâ”€ ç½‘ç»œä¸å¯ç”¨ï¼ˆä¿¡å·ä¸§å¤±ã€äº¤æ¢æœºæ‰çº¿ç­‰ï¼‰
â”œâ”€ è®¾å¤‡è¿›å…¥é£è¡Œæ¨¡å¼
â”œâ”€ ç³»ç»Ÿå…³é—­
â”œâ”€ NetworkFactory å†³å®šé‡Šæ”¾ç½‘ç»œ</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">WiFi ç½‘ç»œä» CONNECTED åˆ° DISCONNECTED çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼š

<span class="hljs-attr">T</span>=<span class="hljs-number">0</span>s: ç”¨æˆ·è¿æ¥åˆ° WiFi
     â”œâ”€ Agent åˆ›å»º: REGISTERING
     â”œâ”€ Agent æ³¨å†Œ: CONNECTING
     â”œâ”€ è·å– IP: CONNECTING
     â””â”€ æ ‡è®°è¿æ¥: CONNECTED

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s: ç”¨æˆ·èµ°å‡ºèŒƒå›´ï¼Œä¿¡å·ä¸§å¤±
     â””â”€ WiFi Driver æ£€æµ‹åˆ°
     â””â”€ NetworkAgent: unregister()
     â””â”€ çŠ¶æ€: DISCONNECTED

<span class="hljs-attr">T</span>=<span class="hljs-number">5.1</span>s: <span class="hljs-literal">on</span>Lost() å›è°ƒç»™åº”ç”¨
       â””â”€ åº”ç”¨åœæ­¢ä½¿ç”¨è¯¥ç½‘ç»œ
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ DISCONNECTED æ²¡æœ‰"æŒç»­æ—¶é—´"
â”œâ”€ å®ƒæ˜¯ç»ˆç‚¹ï¼Œä¸ä¼šè‡ªåŠ¨è½¬å˜
â””â”€ éœ€è¦æ–°çš„ç½‘ç»œè¿æ¥äº‹ä»¶æ‰èƒ½å›åˆ°æ´»è·ƒçŠ¶æ€</p>
<p>ä» DISCONNECTED åˆ°ï¼š
â””â”€ â†’ REGISTERINGï¼ˆæ–°ç½‘ç»œè¿æ¥ï¼‰</p>
<p>9ï¸âƒ£ UNREGISTERED (æœ€åˆå§‹çŠ¶æ€)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œä»æœªè¢«ç³»ç»ŸçŸ¥é“
â”œâ”€ NetworkAgent ä»æœªåˆ›å»º
â”œâ”€ ç­‰åŒäº IDLEï¼Œä½†ä»ç³»ç»Ÿçš„è§’åº¦
â””â”€ è¿™æ˜¯ç½‘ç»œçš„é¢„åˆå§‹åŒ–çŠ¶æ€</p>
<p>è½¬æ¢åˆ°ï¼š
â””â”€ â†’ REGISTERINGï¼ˆç½‘ç»œè¢«å‘ç°å’Œåˆ›å»ºï¼‰</p>
<p>ã€çŠ¶æ€è½¬æ¢çš„å®Œæ•´å›¾è¡¨ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<pre><code class="hljs language-scss" lang="scss">                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ UNREGISTERED â”‚
                   â”‚   (åˆå§‹)      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ ç½‘ç»œè¢«å‘ç°
                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ REGISTERING  â”‚
                   â”‚ (æ³¨å†Œä¸­)      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ <span class="hljs-built_in">register</span>()
                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ CONNECTING   â”‚  â† WiFi æ‰«æã€èº«ä»½éªŒè¯ã€DHCP
                   â”‚ (è¿æ¥ä¸­)      â”‚     é€šå¸¸æŒç»­ <span class="hljs-number">1</span>-<span class="hljs-number">10</span> ç§’
                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚              â”‚ è¿æ¥å¤±è´¥æˆ–è¶…æ—¶
                   â”‚ <span class="hljs-built_in">markConnected</span>()
                   â”‚              â”‚
                   â–¼              â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ CONNECTED    â”‚  â”‚ DISCONNECTED â”‚
            â”‚ (å·²è¿æ¥)      â”‚  â”‚ (å·²æ–­å¼€)      â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
           â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ è¢«æ›¿æ¢
    â”‚ VALIDATED     â”‚     â”‚ (Linger)
    â”‚ (å·²éªŒè¯)       â”‚     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â–¼
           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚         â”‚ LOSING       â”‚
           â”‚         â”‚ (å³å°†ä¸§å¤±)    â”‚  &lt;- Linger <span class="hljs-number">120</span> ç§’
           â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚ Linger æœŸæ»¡
           â”‚              â–¼
           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â””â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ DISCONNECTED â”‚
                     â”‚ (å·²æ–­å¼€)      â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           
           å…¶ä»–å¯èƒ½ï¼š
           ä»»ä½•çŠ¶æ€ â”€â”€é£è¡Œæ¨¡å¼â”€â”€â–º SUSPENDED
           SUSPENDED â”€â”€â”€â”€â”€â”€â”€â”€â–º æ¢å¤ç½‘ç»œæ‰€æœ‰çŠ¶æ€
</code></pre>
<p>ã€Linger æœºåˆ¶çš„è¯¦ç»†å·¥ä½œæµç¨‹ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>Linger æ˜¯ Android ç½‘ç»œæ ˆä¸­æœ€é‡è¦çš„å¹³æ»‘è¿‡æ¸¡æœºåˆ¶ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">Step <span class="hljs-number">1</span>: è§¦å‘æ¡ä»¶ - æ›´å¥½çš„ç½‘ç»œå‡ºç°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

å½“å‰çŠ¶æ€ï¼š
â”œâ”€ é»˜è®¤ç½‘ç»œ: <span class="hljs-built_in">WiFi</span> (è¯„åˆ†: <span class="hljs-number">75</span>, å·²éªŒè¯)
â”œâ”€ å¾…æœºç½‘ç»œ: <span class="hljs-built_in">LTE</span> (è¯„åˆ†: <span class="hljs-number">50</span>, å·²éªŒè¯)
â””â”€ æ´»è·ƒåº”ç”¨: æµè§ˆå™¨ï¼Œé€šè¿‡ <span class="hljs-built_in">WiFi</span> ä¸‹è½½æ–‡ä»¶

ç½‘ç»œè¯„åˆ†å˜åŒ–ï¼š
â”œâ”€ <span class="hljs-built_in">WiFi</span> ä¿¡å·å˜å¼±: <span class="hljs-number">-75</span>dbm â†’ <span class="hljs-number">-85</span>dbm
â”œâ”€ <span class="hljs-built_in">WiFi</span> è¯„åˆ†ä¸‹é™: <span class="hljs-number">75</span> â†’ <span class="hljs-number">45</span>
â”œâ”€ LTE è¯„åˆ†: <span class="hljs-number">50</span> (ä¿æŒä¸å˜)
â””â”€ æ–°çš„è¯„åˆ†: <span class="hljs-built_in">LTE</span> (<span class="hljs-number">50</span>) &gt; <span class="hljs-built_in">WiFi</span> (<span class="hljs-number">45</span>)

ConnectivityService çš„å†³ç­–ï¼š
â”œâ”€ è°ƒç”¨ <span class="hljs-built_in">rematchAllNetworksAndRequests</span>()
â”œâ”€ å‘ç° LTE ç°åœ¨åº”è¯¥æ˜¯é»˜è®¤ç½‘ç»œ
â”œâ”€ ä½† <span class="hljs-built_in">WiFi</span> ä»ç„¶æ»¡è¶³æ‰€æœ‰æ´»è·ƒè¯·æ±‚
â””â”€ å†³å®šï¼šè¿›å…¥ <span class="hljs-built_in">LOSING</span> (Linger)


Step <span class="hljs-number">2</span>: è¿›å…¥ LOSING çŠ¶æ€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ConnectivityService çš„æ“ä½œï¼š
```<span class="hljs-function">java
<span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">handleNetworkLosing</span><span class="hljs-params">(NetworkAgentInfo nai)</span> </span>{
    <span class="hljs-keyword">if</span> (nai.<span class="hljs-built_in">isLosing</span>()) {
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// å·²ç»åœ¨ LOSING çŠ¶æ€</span>
    }
    
    <span class="hljs-comment">// æ ‡è®°ç½‘ç»œä¸º LOSING</span>
    nai.<span class="hljs-built_in">setLosing</span>();
    
    <span class="hljs-comment">// è®¾ç½® Linger è®¡æ—¶å™¨</span>
    <span class="hljs-type">int</span> lingerMs = <span class="hljs-built_in">getLingerTimeoutMs</span>(nai.networkType);
    <span class="hljs-comment">// lingerMs = 120000ms (é»˜è®¤ 120 ç§’)</span>
    
    mHandler.<span class="hljs-built_in">sendMessageDelayed</span>(
        mHandler.<span class="hljs-built_in">obtainMessage</span>(EVENT_LINGER_TIMEOUT, nai),
        lingerMs
    );
    
    <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…ï¼šç½‘ç»œå³å°†ä¸§å¤±</span>
    <span class="hljs-built_in">notifyNetworkCallbacks</span>(nai, 
        ConnectivityManager.CALLBACK_LOSING,
        lingerMs);  <span class="hljs-comment">// å‘Šè¯‰åº”ç”¨è¿˜æœ‰å¤šå°‘æ—¶é—´</span>
}
</code></pre>
<p>åº”ç”¨æ”¶åˆ°çš„å›è°ƒï¼š</p>
<pre><code class="hljs language-java" lang="java">callback.onLosing(wifiNetwork, <span class="hljs-number">120000</span>);  <span class="hljs-comment">// è¿˜æœ‰ 120 ç§’ï¼</span>
</code></pre>
<p>åº”ç”¨çš„å…¸å‹ååº”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLosing</span><span class="hljs-params">(Network network, <span class="hljs-type">int</span> maxMsToLive)</span> {
    <span class="hljs-comment">// åº”ç”¨çŸ¥é“ WiFi å³å°†ä¸å¯ç”¨</span>
    <span class="hljs-comment">// æœ‰ä¸¤ç§é€‰æ‹©ï¼š</span>
    
    <span class="hljs-comment">// é€‰é¡¹ 1: ç«‹å³åœæ­¢ä½¿ç”¨ WiFi</span>
    <span class="hljs-comment">// ä¸»åŠ¨åˆ‡æ¢åˆ° LTE</span>
    <span class="hljs-comment">// ä¼˜ç‚¹ï¼šä¸ä¼šä¸­æ–­</span>
    <span class="hljs-comment">// ç¼ºç‚¹ï¼šå¯èƒ½ä¸ä¼šæœ‰ WiFi çš„é‡æ–°è¿æ¥æœºä¼š</span>
    
    <span class="hljs-comment">// é€‰é¡¹ 2: ç»§ç»­ä½¿ç”¨ WiFi</span>
    <span class="hljs-comment">// å¸Œæœ› Linger æ—¶é—´å†… WiFi ä¿¡å·æ¢å¤</span>
    <span class="hljs-comment">// ä¼˜ç‚¹ï¼šå¦‚æœä¿¡å·æ¢å¤å°±èƒ½ç»§ç»­ç”¨ WiFi</span>
    <span class="hljs-comment">// ç¼ºç‚¹ï¼šå¦‚æœä¸æ¢å¤ä¼šè¢«å¼ºåˆ¶åˆ‡æ¢ï¼Œå¯¼è‡´ä¸­æ–­</span>
}
</code></pre>
<p>Step 3: Linger æœŸé—´ - å¹¶è¡Œç½‘ç»œ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Linger æ—¶é—´å†…å‘ç”Ÿçš„äº‹æƒ…ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">æ—¶é—´: <span class="hljs-number">0</span> - <span class="hljs-number">120</span> ç§’

åº”ç”¨çš„ç½‘ç»œä½¿ç”¨ï¼š
â”œâ”€ å·²å»ºç«‹çš„ Socket/è¿æ¥: ç»§ç»­ç”¨ WiFiï¼ˆä¸ä¸­æ–­ï¼‰
â”œâ”€ æ–°çš„ç½‘ç»œè¯·æ±‚: ä½¿ç”¨ LTEï¼ˆé»˜è®¤ç½‘ç»œï¼‰
â””â”€ æ˜¾å¼ä½¿ç”¨ WiFi çš„åº”ç”¨: ä»ç„¶å¯ç”¨

ç³»ç»Ÿçš„æ“ä½œï¼š
â”œâ”€ WiFi è¯„åˆ†ç»§ç»­å˜åŒ–
â”‚  â”œâ”€ å¦‚æœä¿¡å·æ”¹å–„: å›åˆ° CONNECTEDï¼ˆå–æ¶ˆ Lingerï¼‰
â”‚  â””â”€ å¦‚æœä¿¡å·ç»§ç»­å˜å·®: ä¿æŒ LOSING
â”œâ”€ LTE æˆä¸ºé»˜è®¤ç½‘ç»œ
â”œâ”€ æ–°åº”ç”¨ä½¿ç”¨ LTEï¼ˆè‡ªåŠ¨ï¼‰
â””â”€ æ—§åº”ç”¨ä»åœ¨ WiFi ä¸Šï¼ˆå¦‚æœæ˜¾å¼è¯·æ±‚ï¼‰


Step <span class="hljs-number">4</span>: WiFi ä¿¡å·æ¢å¤ - Linger å–æ¶ˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

åœ¨ Linger æœŸé—´ï¼Œå¦‚æœ WiFi ä¿¡å·æ”¹å–„ï¼š

WiFiNetworkAgent:
â”œâ”€ æ£€æµ‹åˆ°ä¿¡å·æ”¹å–„
â”œâ”€ <span class="hljs-built_in">sendNetworkScore</span>(newScore)
â”‚  â””â”€ è¯„åˆ†æé«˜: <span class="hljs-number">40</span> â†’ <span class="hljs-number">70</span>
â””â”€ ConnectivityService æ”¶åˆ°æ›´æ–°

ConnectivityService:
```java
private void <span class="hljs-built_in">handleNetworkScoreChanged</span>(NetworkAgentInfo nai) {
    int newScore = nai<span class="hljs-selector-class">.getNetworkScore</span>();
    
    if (nai.isLosing()) {
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿˜åº”è¯¥ LOSING</span>
        if (newScore &gt; currentDefaultNetworkScore) {
            <span class="hljs-comment">// è¯„åˆ†æ”¹å–„ï¼Œå–æ¶ˆ Linger</span>
            nai<span class="hljs-selector-class">.clearLosing</span>();
            mHandler<span class="hljs-selector-class">.removeMessages</span>(EVENT_LINGER_TIMEOUT, nai);
            
            <span class="hljs-comment">// WiFi å›åˆ° CONNECTED</span>
            <span class="hljs-comment">// å¹¶å¯èƒ½æˆä¸ºé»˜è®¤ç½‘ç»œï¼ˆå¦‚æœè¯„åˆ†è¶³å¤Ÿé«˜ï¼‰</span>
            <span class="hljs-built_in">rematchAllNetworksAndRequests</span>();
            
            <span class="hljs-comment">// é€šçŸ¥åº”ç”¨ï¼šä¸ç”¨æ‹…å¿ƒäº†</span>
            <span class="hljs-built_in">notifyNetworkCallbacks</span>(nai, 
                CALLBACK_AVAILABLE);
        }
    }
}
</code></pre>
<p>åº”ç”¨æ”¶åˆ°å›è°ƒï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// WiFi æ¢å¤ï¼Œä¸å† LOSING</span>
callback.onAvailable(wifiNetwork);  <span class="hljs-comment">// æˆ–å…¶ä»–èƒ½åŠ›æ›´æ–°å›è°ƒ</span>
</code></pre>
<p>Step 5: Linger æœŸæ»¡ - ç½‘ç»œæ–­å¼€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å¦‚æœ 120 ç§’å†… WiFi è¯„åˆ†æ²¡æœ‰æ¢å¤åˆ°è¶³å¤Ÿé«˜ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleLingerTimeout</span><span class="hljs-params">(NetworkAgentInfo nai)</span> {
    <span class="hljs-keyword">if</span> (!nai.isLosing()) {
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// å·²ç»æ¢å¤äº†</span>
    }
    
    <span class="hljs-comment">// Linger æœŸæ»¡ï¼Œæ–­å¼€ç½‘ç»œ</span>
    nai.clearLosing();
    
    <span class="hljs-comment">// æ ‡è®°ä¸º DISCONNECTED</span>
    handleNetworkDisconnected(nai);
    
    <span class="hljs-comment">// æœ€ç»ˆé€šçŸ¥åº”ç”¨</span>
    notifyNetworkCallbacks(nai, CALLBACK_LOST);
}
</code></pre>
<p>åº”ç”¨æœ€ç»ˆæ”¶åˆ°ï¼š</p>
<pre><code class="hljs language-java" lang="java">callback.onLost(wifiNetwork);  <span class="hljs-comment">// WiFi å½»åº•æ–­å¼€</span>
</code></pre>
<p>å®Œæ•´çš„æ—¶é—´çº¿ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>s:    WiFi ä¿¡å·å¼€å§‹å˜å¼±
         åº”ç”¨: æ”¶åˆ° onCapabilitiesChanged (è¯„åˆ†å˜åŒ–ï¼Œä½†ä» CONNECTED)

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s:    WiFi è¯„åˆ† &lt; LTE è¯„åˆ†
         ConnectivityService: å†³å®šåˆ‡æ¢
         åº”ç”¨: æ”¶åˆ° onLosing(wifiNetwork, 120000)

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>-<span class="hljs-number">60</span>s: ç”¨æˆ·å¯èƒ½é è¿‘ WiFi è·¯ç”±å™¨
         WiFi: sendNetworkScore(æ”¹å–„)
         åº”ç”¨: ç»§ç»­ä½¿ç”¨æ—§è¿æ¥çš„ WiFi

<span class="hljs-attr">T</span>=<span class="hljs-number">60</span>s:   WiFi ä¿¡å·ç»§ç»­å˜å·®æˆ–æœªæ”¹å–„
         ConnectivityService: è¯„åˆ†ä» &lt; LTE
         åº”ç”¨: ä»åœ¨ Linger, ä»å¯ç”¨

<span class="hljs-attr">T</span>=<span class="hljs-number">125</span>s:  Linger æœŸæ»¡
         ConnectivityService: handleLingerTimeout()
         WiFi: å¼ºåˆ¶ DISCONNECTED
         åº”ç”¨: æ”¶åˆ° onLost(wifiNetwork)
         å·²å»ºç«‹çš„ WiFi è¿æ¥: ä¸­æ–­ âŒ
</code></pre>
<p>ã€Linger çš„é…ç½®ä¸ä¼˜åŒ–ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>ç³»ç»Ÿå±æ€§æ§åˆ¶ Linger æ—¶é—´ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ro.config.ip_linger_ms</span>=<span class="hljs-number">120000</span>  <span class="hljs-comment"># 120 ç§’ï¼ˆé»˜è®¤ï¼‰</span>
</code></pre>
<p>OEM å¯ä»¥è‡ªå®šä¹‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ro.config.ip_linger_ms</span>=<span class="hljs-number">60000</span>   <span class="hljs-comment"># æ¿€è¿›ï¼š60 ç§’ï¼ˆæ—©ç‚¹åˆ‡æ¢ï¼‰</span>
<span class="hljs-attr">ro.config.ip_linger_ms</span>=<span class="hljs-number">300000</span>  <span class="hljs-comment"># ä¿å®ˆï¼š5 åˆ†é’Ÿï¼ˆç­‰å¾…ç½‘ç»œæ¢å¤ï¼‰</span>
<span class="hljs-attr">ro.config.ip_linger_ms</span>=<span class="hljs-number">0</span>       <span class="hljs-comment"># ç¦ç”¨ Lingerï¼ˆç«‹å³åˆ‡æ¢ï¼‰</span>
</code></pre>
<p>Linger çš„ä¼˜ç¼ºç‚¹ï¼š</p>
<p>âœ“ ä¼˜ç‚¹ï¼š
â”œâ”€ å¹³æ»‘è¿‡æ¸¡ï¼šåº”ç”¨æ— éœ€æ„ŸçŸ¥ç½‘ç»œå˜åŒ–
â”œâ”€ è‡ªåŠ¨æ¢å¤ï¼šå¦‚æœä¿¡å·æ”¹å–„ï¼Œè‡ªåŠ¨å›åˆ°åŸç½‘ç»œ
â”œâ”€ çµæ´»æ€§ï¼šåº”ç”¨å¯é€‰æ‹©ä½•æ—¶åˆ‡æ¢
â””â”€ ç”¨æˆ·ä½“éªŒï¼šå‡å°‘ä¸­æ–­å’Œå»¶è¿Ÿ</p>
<p>âœ— ç¼ºç‚¹ï¼š
â”œâ”€ ç”µæ± æ¶ˆè€—ï¼šå¤šä¸ªç½‘ç»œåŒæ—¶æ´»è·ƒ
â”œâ”€ æµé‡æµªè´¹ï¼šå¯èƒ½ä½¿ç”¨ä¸¤ä¸ªç½‘ç»œ
â”œâ”€ å»¶è¿Ÿåˆ‡æ¢ï¼šä¸æ˜¯ç«‹å³åˆ‡æ¢åˆ°æœ€å¥½çš„ç½‘ç»œ
â””â”€ å¤æ‚æ€§ï¼šå¢åŠ ç½‘ç»œæ ˆçš„å¤æ‚åº¦</p>
<p>ä¸åŒ OEM çš„é€‰æ‹©ï¼š
â”œâ”€ Google Pixel: 120 ç§’ï¼ˆæ ‡å‡†ï¼‰
â”œâ”€ Samsung: 60-120 ç§’ï¼ˆä¸­ç­‰ï¼‰
â”œâ”€ æŸäº›å›½è¿è¥å•†: 30 ç§’ï¼ˆæ¿€è¿›ï¼‰
â””â”€ ä¼ä¸šè®¾å¤‡: 0 ç§’ï¼ˆç¦ç”¨ï¼Œå¼ºåˆ¶æœ€å¥½ç½‘ç»œï¼‰</p>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-string">ç»§ç»­è®²è§£ç¬¬</span> <span class="hljs-number">5</span><span class="hljs-number">-6</span> <span class="hljs-string">éƒ¨åˆ†ã€‚</span>

<span class="hljs-string">å¥½çš„ï¼Œç°åœ¨å¼€å§‹è®²è§£ç¬¬</span> <span class="hljs-number">5</span><span class="hljs-number">-6</span> <span class="hljs-string">éƒ¨åˆ†ï¼š</span>

<span class="hljs-meta">---
</span>
<span class="hljs-comment">### **5ã€WiFi ä¸ç§»åŠ¨ç½‘ç»œåˆ‡æ¢æ·±åº¦è§£æ**</span>

</code></pre>
<p>ã€NetworkRanker çš„ 3 å±‚å†³ç­–æ¨¡å‹ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>NetworkRanker æ˜¯å†³å®š"å“ªä¸ªç½‘ç»œæœ€å¥½"çš„æ ¸å¿ƒå¼•æ“ã€‚å®ƒé€šè¿‡ä¸€ç³»åˆ—è¿‡æ»¤è§„åˆ™ï¼Œ
é€æ­¥æ’é™¤ä¸åˆæ ¼çš„ç½‘ç»œï¼Œæœ€ç»ˆé€‰å‡ºæœ€ä½³ç½‘ç»œã€‚</p>
<p>Layer 1: ç¡¬æ€§æ¡ä»¶ï¼ˆå¿…é¡»æ»¡è¶³ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>è¿™ä¸€å±‚è¿‡æ»¤æ‰å®Œå…¨ä¸ç¬¦åˆæ¡ä»¶çš„ç½‘ç»œï¼š</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¯·æ±‚å®Œå…¨æ»¡è¶³ (Satisfy Request)                  â”‚
â”‚    â””â”€ ç½‘ç»œå¿…é¡»æœ‰è¯·æ±‚è¦æ±‚çš„æ‰€æœ‰èƒ½åŠ›                â”‚
â”‚       ä¾‹å¦‚ï¼šè¯·æ±‚è¦æ±‚ INTERNET                      â”‚
â”‚       ç½‘ç»œå¿…é¡»æœ‰ NET_CAPABILITY_INTERNET             â”‚
â”‚                                                     â”‚
â”‚ 2. ä¸èƒ½æ˜¯å³å°†é”€æ¯çš„ç½‘ç»œ                            â”‚
â”‚    â””â”€ POLICY_IS_DESTROYED çš„ç½‘ç»œè¢«æ’é™¤             â”‚
â”‚       è¿™æ ·æ–°ç½‘ç»œå¯ä»¥ç›´æ¥æ›¿æ¢                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ­¥éª¤ 1: è¿‡æ»¤å‡ºèƒ½æ»¡è¶³è¯·æ±‚çš„ç½‘ç»œ</span>
List&lt;NetworkAgentInfo&gt; candidates = 
    networks.stream()
        .filter(nai -&gt; nai.satisfies(request))
        .collect(toList());

<span class="hljs-keyword">if</span> (candidates.isEmpty()) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// æ²¡æœ‰ç½‘ç»œæ»¡è¶³è¦æ±‚</span>
}
</code></pre>
<p>Layer 2: ä¼˜å…ˆçº§è¿‡æ»¤ï¼ˆPrioritization Filtersï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>è¿™ä¸€å±‚ä½¿ç”¨ä¸€ç³»åˆ—è§„åˆ™é€æ­¥ç¼©å°å€™é€‰èŒƒå›´ï¼š</p>
<p>è§„åˆ™ 1: ä¸è´¥çš„ç½‘ç»œï¼ˆInvincible Networksï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (any network has POLICY_IS_INVINCIBLE) {
    <span class="hljs-keyword">return</span> that network;  <span class="hljs-comment">// ç›´æ¥è¿”å›ï¼Œå…¶ä»–ç½‘ç»œæ— è®ºå¤šå¥½éƒ½ä¸è¡Œ</span>
}
</code></pre>
<p>ç”¨é€”ï¼š
â”œâ”€ OEM ç‰¹æ®Šé…ç½®çš„ç½‘ç»œ
â”œâ”€ ä¼ä¸š VPNï¼ˆå¦‚é…ç½®ä¸ºä¸è´¥ï¼‰
â””â”€ æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹çš„ä¸“ç½‘</p>
<p>è§„åˆ™ 2: VPN ç½‘ç»œï¼ˆVPN Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (any network is <span class="hljs-title function_">VPN</span> <span class="hljs-params">(POLICY_IS_VPN)</span>) {
    <span class="hljs-keyword">return</span> the VPN network;  <span class="hljs-comment">// VPN é€šå¸¸ä¼˜å…ˆäºåº•å±‚ç½‘ç»œ</span>
}
</code></pre>
<p>åŸå› ï¼š
â”œâ”€ VPN æ˜¯ç”¨æˆ·æ˜ç¡®é€‰æ‹©çš„åŠ å¯†é€šé“
â”œâ”€ æ‰€æœ‰äº’è”ç½‘æµé‡éƒ½åº”è¯¥é€šè¿‡ VPN
â””â”€ VPN çš„è¯„åˆ†é€šå¸¸é«˜äºåº•å±‚ç½‘ç»œ</p>
<p>è§„åˆ™ 3: ç”¨æˆ·é€‰æ‹©çš„ç½‘ç»œï¼ˆUser Selection Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (any network has both:
    - POLICY_EVER_USER_SELECTED (ç”¨æˆ·ä¸»åŠ¨è¿æ¥è¿‡)
    - POLICY_ACCEPT_UNVALIDATED (ç”¨æˆ·æ„¿æ„æ¥å—æœªéªŒè¯)
) {
    prefer that network;
}
</code></pre>
<p>ç”¨é€”ï¼š
â”œâ”€ ç”¨æˆ·å–œæ¬¢ç”¨æŸä¸ªç‰¹å®šçš„ WiFi
â”œâ”€ å³ä½¿æœ‰éªŒè¯å¤±è´¥ï¼Œä¹Ÿåº”è¯¥ä¼˜å…ˆ
â””â”€ ä¾‹å¦‚ï¼šå®¶é‡Œçš„ WiFiï¼Œuser æ˜ç¡®é€‰æ‹©</p>
<p>è§„åˆ™ 4: éªŒè¯çŠ¶æ€ï¼ˆValidation Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (any network is VALIDATED or POLICY_ACCEPT_UNVALIDATED) {
    exclude non-validated networks;
}
</code></pre>
<p>é€»è¾‘ï¼š
â”œâ”€ æœ‰æ•ˆçš„ç½‘ç»œï¼ˆå·²éªŒè¯äº’è”ç½‘è¿æ¥ï¼‰æ€»æ˜¯ä¼˜äºæ— æ•ˆç½‘ç»œ
â”œâ”€ æˆ–è€…å¦‚æœæœ‰ç½‘ç»œçš„ç”¨æˆ·æ¥å—æœªéªŒè¯ï¼Œå°±æ’é™¤æ‰€æœ‰æœªéªŒè¯ç½‘ç»œ
â””â”€ <strong>å…³é”®çš„å†³ç­–ç‚¹</strong></p>
<p>è§„åˆ™ 5: WiFi ä¸èœ‚çªçš„é€‰æ‹©ï¼ˆYield to Bad WiFi Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (some networks have POLICY_YIELD_TO_BAD_WIFI) {
    <span class="hljs-comment">// è¿™ä¸ªè§„åˆ™ç”¨æ¥å¤„ç†"å WiFi vs å¥½èœ‚çª"çš„å›°å¢ƒ</span>
    
    <span class="hljs-keyword">if</span> (POLICY_YIELD_TO_BAD_WIFI &amp;&amp; there are bad WiFis) {
        prefer the bad WiFi;  <span class="hljs-comment">// åå¥½å WiFi</span>
    } <span class="hljs-keyword">else</span> {
        prefer the LTE;  <span class="hljs-comment">// å¦åˆ™ç”¨ LTE</span>
    }
}
</code></pre>
<p>è¿™æ˜¯æœ€å¤æ‚çš„è§„åˆ™ï¼è¯¦è§ä¸‹æ–‡ã€‚</p>
<p>è§„åˆ™ 6: éé€€å‡ºç½‘ç»œï¼ˆNon-Exiting Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (any network doesn<span class="hljs-string">'t have POLICY_EXITING) {
    exclude networks with POLICY_EXITING;  // Linger é˜¶æ®µçš„ç½‘ç»œ
}
</span></code></pre>
<p>ç”¨é€”ï¼š
â”œâ”€ ä¼˜å…ˆé€‰æ‹©ä¸åœ¨ Linger çš„ç½‘ç»œï¼ˆå³å°†æ¶ˆå¤±ï¼‰
â”œâ”€ é¿å…é€‰æ‹©ä¸€ä¸ªå³å°†æ–­å¼€çš„ç½‘ç»œ</p>
<p>è§„åˆ™ 7: ä¸»è¦ä¼ è¾“æ–¹å¼ï¼ˆPrimary Transport Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> each SIM slot {
    <span class="hljs-keyword">if</span> (there<span class="hljs-string">'s a network for primary subscription) {
        prefer it over networks for secondary subscriptions;
    }
}
</span></code></pre>
<p>ç”¨é€”ï¼š
â”œâ”€ å¤šå¡è®¾å¤‡ï¼Œé€šå¸¸æœ‰ä¸€å¼ ä¸»å¡ï¼ˆPrimary SIMï¼‰
â”œâ”€ èœ‚çªç½‘ç»œä¼˜å…ˆä½¿ç”¨ä¸»å¡çš„ä¿¡å·
â””â”€ æ¬¡å¡çš„ç½‘ç»œä½œä¸ºå¤‡é€‰</p>
<p>è§„åˆ™ 8: ä¼ è¾“ä¼˜å…ˆçº§ï¼ˆTransport Priorityï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼˜å…ˆçº§é¡ºåºï¼šä»¥å¤ªç½‘ &gt; WiFi &gt; è“ç‰™ &gt; èœ‚çª</span>
<span class="hljs-keyword">for</span> (transport in [ETHERNET, WIFI, BLUETOOTH, CELLULAR]) {
    <span class="hljs-keyword">if</span> (any network has <span class="hljs-built_in">this</span> transport) {
        prefer <span class="hljs-built_in">this</span> transport over lower ones;
    }
}
</code></pre>
<p>ä¾‹å­ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å€™é€‰ç½‘ç»œï¼š
â”œâ”€ LTE (è¯„åˆ† <span class="hljs-number">80</span>, å·²éªŒè¯)
â”œâ”€ WiFi (è¯„åˆ† <span class="hljs-number">60</span>, å·²éªŒè¯)
â””â”€ ä»¥å¤ªç½‘ (è¯„åˆ† <span class="hljs-number">30</span>, å·²éªŒè¯)

æŒ‰è§„åˆ™ <span class="hljs-number">8</span> è¯„ä¼°ï¼š
â”œâ”€ æœ‰ä»¥å¤ªç½‘ï¼Ÿâ†’ é€‰æ‹©ä»¥å¤ªç½‘ï¼ˆå³ä½¿è¯„åˆ†æœ€ä½ï¼ï¼‰
</code></pre>
<p>è§„åˆ™ 9: ç¨³å®šæ€§å€¾å‘ï¼ˆStickinessï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (currentSatisfier is still in candidates after all rules) {
    keep it;  <span class="hljs-comment">// "ç²˜æ€§"ï¼šå€¾å‘äºä¿æŒå½“å‰ç½‘ç»œ</span>
}
</code></pre>
<p>ç”¨é€”ï¼š
â”œâ”€ é¿å…é¢‘ç¹åˆ‡æ¢ï¼ˆæŠ–åŠ¨ï¼‰
â”œâ”€ å‡å°‘ç”¨æˆ·æ„ŸçŸ¥åˆ°çš„ç½‘ç»œåˆ‡æ¢
â””â”€ å¦‚æœå½“å‰ç½‘ç»œè¶³å¤Ÿå¥½ï¼Œå°±åˆ«æ¢</p>
<p>Layer 3: è¯„åˆ†æ¯”è¾ƒï¼ˆScore Comparisonï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å¦‚æœç»è¿‡æ‰€æœ‰è¿‡æ»¤è§„åˆ™åä»æœ‰å¤šä¸ªå€™é€‰ï¼Œåˆ™æŒ‰è¯„åˆ†æ’åºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">scoreDiff</span> <span class="hljs-operator">=</span> networkA.getScore() - networkB.getScore();
<span class="hljs-keyword">if</span> (scoreDiff &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> networkA;  <span class="hljs-comment">// A è¯„åˆ†æ›´é«˜</span>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> networkB;
</code></pre>
<p>è¯„åˆ†çš„è®¡ç®—ï¼ˆFullScoreï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FullScore</span> {
    <span class="hljs-comment">// WiFi è¯„åˆ†ï¼ˆ0-100ï¼ŒåŸºäº RSSIï¼‰</span>
    <span class="hljs-comment">// RSSI -40dbm: 95 åˆ†ï¼ˆæœ€å¼ºï¼‰</span>
    <span class="hljs-comment">// RSSI -70dbm: 60 åˆ†ï¼ˆä¸­ç­‰ï¼‰</span>
    <span class="hljs-comment">// RSSI -85dbm: 25 åˆ†ï¼ˆå¼±ï¼‰</span>
    <span class="hljs-comment">// RSSI &lt; -90dbm: 0 åˆ†ï¼ˆæ–­çº¿ï¼‰</span>
    
    <span class="hljs-comment">// LTE è¯„åˆ†ï¼ˆ0-100ï¼ŒåŸºäºä¿¡å·å¼ºåº¦ï¼‰</span>
    <span class="hljs-comment">// RSRP -75dbm: 90 åˆ†ï¼ˆæœ€å¼ºï¼‰</span>
    <span class="hljs-comment">// RSRP -100dbm: 60 åˆ†ï¼ˆä¸­ç­‰ï¼‰</span>
    <span class="hljs-comment">// RSRP -120dbm: 20 åˆ†ï¼ˆå¼±ï¼‰</span>
    
    <span class="hljs-comment">// éªŒè¯å¥–åŠ±ï¼š+20 åˆ†</span>
    <span class="hljs-comment">// Linger æƒ©ç½šï¼š-30 åˆ†</span>
    <span class="hljs-comment">// VPN å¥–åŠ±ï¼š+50 åˆ†</span>
}
</code></pre>
<p>ã€Yield to Bad WiFi è§„åˆ™è¯¦è§£ã€‘â­ æœ€å…³é”®çš„ WiFi vs LTE å†³ç­–
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>è¿™ä¸ªè§„åˆ™è§£å†³çš„é—®é¢˜ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">ç”¨æˆ·æœ‰ä¸¤ä¸ªç½‘ç»œå¯ç”¨ï¼š
â”œâ”€ <span class="hljs-built_in">WiFi</span>: <span class="hljs-number">-85</span>dbmï¼ŒæœªéªŒè¯æˆ–å¼ºåˆ¶é—¨æˆ·ï¼ˆ<span class="hljs-string">"å"</span> <span class="hljs-built_in">WiFi</span>ï¼‰
â””â”€ LTE: <span class="hljs-number">-95</span>dbmï¼Œå·²éªŒè¯ï¼ˆ<span class="hljs-string">"å¥½"</span> LTEï¼‰

é—®é¢˜ï¼š
â”œâ”€ è¯„åˆ†ä¸Šï¼ŒLTE å¯èƒ½æ›´é«˜
â”œâ”€ ä½†ç”¨æˆ·å·²è¿æ¥åˆ° <span class="hljs-built_in">WiFi</span>ï¼ˆå¯èƒ½æ˜¯é¢„æœŸçš„ï¼‰
â”œâ”€ ç³»ç»Ÿåº”è¯¥ä¿ç•™ <span class="hljs-built_in">WiFi</span>ï¼ˆå³ä½¿åï¼‰è¿˜æ˜¯ç«‹å³åˆ‡æ¢åˆ° LTEï¼Ÿ
</code></pre>
<p>POLICY_YIELD_TO_BAD_WIFI æ˜¯ä¸€ä¸ªæ ‡å¿—ï¼Œè¡¨ç¤ºï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"å¦‚æœæœ‰åä½†å·²è¿æ¥çš„ WiFiï¼Œä¼˜å…ˆä½¿ç”¨å®ƒï¼Œè€Œä¸æ˜¯åˆ‡æ¢åˆ°æ›´å¥½çš„èœ‚çªç½‘ç»œ"</span>
</code></pre>
<p>ä½•æ—¶è®¾ç½®ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">1.</span> <span class="hljs-built_in">WiFi</span> å·²è¿æ¥ä½†éªŒè¯å¤±è´¥ï¼ˆå¯èƒ½æ˜¯å¼ºåˆ¶é—¨æˆ·ï¼‰
   â”œâ”€ ç”¨æˆ·å¯èƒ½æƒ³é€šè¿‡é—¨æˆ·è®¤è¯
   â”œâ”€ æ­¤æ—¶ä¸åº”ç«‹å³åˆ‡æ¢åˆ° LTE
   â””â”€ è®¾ç½® YIELD_TO_BAD_WIFI

<span class="hljs-number">2.</span> <span class="hljs-built_in">WiFi</span> ä¿¡å·å˜å¼±ä½†ä»è¿æ¥
   â”œâ”€ ç”¨æˆ·å¯èƒ½èµ°è¿‘è·¯ç”±å™¨æ—¶ <span class="hljs-built_in">WiFi</span> ä¼šæ¢å¤
   â”œâ”€ ä¸åº”ç«‹å³åˆ‡æ¢åˆ° LTE
   â””â”€ è®¾ç½® YIELD_TO_BAD_WIFI

<span class="hljs-number">3.</span> <span class="hljs-built_in">WiFi</span> è™½ç„¶æœªéªŒè¯ä½†èƒ½ä¸Šç½‘ï¼ˆä¾‹å¦‚æŸäº›ç‰¹æ®Šåœºæ™¯ï¼‰
   â”œâ”€ å¯èƒ½æ˜¯ä»£ç†ã€ç‰¹æ®Šé…ç½®ç­‰
   â””â”€ ä¼˜å…ˆä¿ç•™ <span class="hljs-built_in">WiFi</span>
</code></pre>
<p>ç®—æ³•ï¼ˆisPreferredBadWiFiï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isPreferredBadWiFi</span><span class="hljs-params">(NetworkScore score, NetworkCapabilities caps)</span> {
    <span class="hljs-comment">// æ¡ä»¶ 1: å¿…é¡»æ˜¯ WiFi</span>
    <span class="hljs-keyword">if</span> (!caps.hasTransport(TRANSPORT_WIFI)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// æ¡ä»¶ 2: ä¸èƒ½æ˜¯å·²éªŒè¯çš„ç½‘ç»œï¼ˆå·²éªŒè¯å°±ä¸æ˜¯"å" WiFiï¼‰</span>
    <span class="hljs-keyword">if</span> (score.hasPolicy(POLICY_IS_VALIDATED)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// æ¡ä»¶ 3: ä¸èƒ½æ˜¯ç”¨æˆ·ä¸»åŠ¨é¿å…çš„ï¼ˆåœ¨ UI ä¸­å–æ¶ˆå‹¾é€‰ï¼‰</span>
    <span class="hljs-keyword">if</span> (score.hasPolicy(POLICY_AVOIDED_WHEN_UNVALIDATED)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// æ¡ä»¶ 4: å¿…é¡»æ›¾ç»è¯„ä¼°è¿‡ï¼ˆåœ¨è¿æ¥è¯„ä¼°é˜¶æ®µï¼‰</span>
    <span class="hljs-keyword">if</span> (!score.hasPolicy(POLICY_EVER_EVALUATED)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// æ¡ä»¶ 5: ä¸èƒ½æ˜¯æ´»è·ƒå¼ºåˆ¶é—¨æˆ·</span>
    <span class="hljs-comment">// ï¼ˆä½†å¦‚æœæ›¾ç»éªŒè¯è¿‡ï¼Œå³ä½¿ç°åœ¨æ˜¯é—¨æˆ·ä¹Ÿå¯ä»¥ï¼‰</span>
    <span class="hljs-keyword">if</span> (caps.hasCapability(NET_CAPABILITY_CAPTIVE_PORTAL)) {
        <span class="hljs-comment">// å¦‚æœæ›¾ç»éªŒè¯è¿‡ï¼Œè¯´æ˜ç”¨æˆ·ä¹‹å‰ç™»å½•è¿‡</span>
        <span class="hljs-comment">// ç°åœ¨é—¨æˆ·å¯èƒ½ç”±äºæŸäº›åŸå› é‡æ–°å‡ºç°</span>
        <span class="hljs-comment">// ä»ç„¶åº”è¯¥ä¼˜å…ˆä½¿ç”¨ WiFi</span>
        <span class="hljs-keyword">if</span> (!score.hasPolicy(POLICY_EVER_VALIDATED)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ä»æœªéªŒè¯è¿‡çš„é—¨æˆ·ï¼Œä¸ä¼˜å…ˆ</span>
        }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ª"ä¼˜å…ˆçš„å WiFi"</span>
}

<span class="hljs-comment">// åœ¨ç½‘ç»œé€‰æ‹©ä¸­ä½¿ç”¨</span>
applyYieldToBadWifiPolicy(validated, unvalidated) {
    <span class="hljs-keyword">if</span> (any network has POLICY_YIELD_TO_BAD_WIFI) {
        List&lt;BadWiFi&gt; badWiFis = unvalidated.stream()
            .filter(nai -&gt; isPreferredBadWiFi(nai.getScore()))
            .collect(toList());
        
        <span class="hljs-keyword">if</span> (!badWiFis.isEmpty()) {
            <span class="hljs-comment">// æœ‰åä½†ä¼˜å…ˆçš„ WiFi</span>
            <span class="hljs-comment">// ç§»é™¤æ‰€æœ‰æœ‰ YIELD_TO_BAD_WIFI çš„é WiFi ç½‘ç»œ</span>
            validated.removeAll(networks_with_YIELD_TO_BAD_WIFI);
            <span class="hljs-comment">// ä¿ç•™å WiFi</span>
        }
    }
}
</code></pre>
<p>å…¸å‹åœºæ™¯çš„å†³ç­–æµç¨‹ï¼š</p>
<p>åœºæ™¯ A: ç”¨æˆ·åœ¨å¼€æ”¾ WiFiï¼ˆå¦‚æœºåœºï¼‰</p>
<pre><code class="hljs language-objectivec" lang="objectivec">WiFi çŠ¶æ€ï¼šè¿æ¥ï¼Œå­˜åœ¨å¼ºåˆ¶é—¨æˆ·ï¼ŒæœªéªŒè¯
LTE çŠ¶æ€ï¼šè¿æ¥ï¼Œå·²éªŒè¯

isPreferredBadWiFi(WiFi)?
â”œâ”€ æ˜¯ WiFi? âœ“ <span class="hljs-literal">YES</span>
â”œâ”€ å·²éªŒè¯? âœ— <span class="hljs-literal">NO</span> (æœªéªŒè¯)
â”œâ”€ è¢«ç”¨æˆ·é¿å…? âœ— <span class="hljs-literal">NO</span>
â”œâ”€ æ›¾è¯„ä¼°è¿‡? âœ“ <span class="hljs-literal">YES</span>
â”œâ”€ æ˜¯å¼ºåˆ¶é—¨æˆ·? âœ“ <span class="hljs-literal">YES</span>ï¼Œä½†æ›¾éªŒè¯? âœ— <span class="hljs-literal">NO</span>
â””â”€ â†’ <span class="hljs-keyword">return</span> <span class="hljs-literal">FALSE</span> (ä¸ä¼˜å…ˆ)

å†³ç­–ï¼šé€‰æ‹© LTEï¼ˆå·²éªŒè¯ï¼‰âŒ
é—®é¢˜ï¼šç”¨æˆ·å¯èƒ½æƒ³ç™»å½• WiFiï¼
</code></pre>
<p>åœºæ™¯ B: ç”¨æˆ·åœ¨å®¶é‡Œ WiFiï¼ˆå·²ç™»å½•è¿‡çš„é—¨æˆ·ï¼‰</p>
<pre><code class="hljs language-objectivec" lang="objectivec">WiFi çŠ¶æ€ï¼šè¿æ¥ï¼Œå¼ºåˆ¶é—¨æˆ·ï¼ŒæœªéªŒè¯ï¼Œä½†æ›¾éªŒè¯
LTE çŠ¶æ€ï¼šè¿æ¥ï¼Œå·²éªŒè¯

isPreferredBadWiFi(WiFi)?
â”œâ”€ æ˜¯ WiFi? âœ“ <span class="hljs-literal">YES</span>
â”œâ”€ å·²éªŒè¯? âœ— <span class="hljs-literal">NO</span> (ç°åœ¨æœªéªŒè¯)
â”œâ”€ è¢«ç”¨æˆ·é¿å…? âœ— <span class="hljs-literal">NO</span>
â”œâ”€ æ›¾è¯„ä¼°è¿‡? âœ“ <span class="hljs-literal">YES</span>
â”œâ”€ æ˜¯å¼ºåˆ¶é—¨æˆ·? âœ“ <span class="hljs-literal">YES</span>ï¼Œä½†æ›¾éªŒè¯? âœ“ <span class="hljs-literal">YES</span>
â””â”€ â†’ <span class="hljs-keyword">return</span> <span class="hljs-literal">TRUE</span> (ä¼˜å…ˆï¼)

å†³ç­–ï¼šé€‰æ‹© WiFiï¼ˆåä½†ä¼˜å…ˆï¼‰âœ“
åŸå› ï¼šç”¨æˆ·ä¹‹å‰ç™»å½•è¿‡ï¼Œç°åœ¨åªæ˜¯é—¨æˆ·é‡æ–°å‡ºç°ï¼Œåº”è¯¥ä¿ç•™ WiFi
</code></pre>
<p>åœºæ™¯ C: WiFi ä¿¡å·å¼±</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">WiFi</span> çŠ¶æ€ï¼šRSSI <span class="hljs-number">-88</span>dbmï¼Œè¯„åˆ† <span class="hljs-number">25</span>ï¼Œå·²éªŒè¯
LTE çŠ¶æ€ï¼šRSSI <span class="hljs-number">-95</span>dbmï¼Œè¯„åˆ† <span class="hljs-number">70</span>ï¼Œå·²éªŒè¯

<span class="hljs-built_in">isPreferredBadWiFi</span>(<span class="hljs-built_in">WiFi</span>)?
â”œâ”€ æ˜¯ <span class="hljs-built_in">WiFi</span>? âœ“ YES
â”œâ”€ å·²éªŒè¯? âœ“ YES
â””â”€ â†’ <span class="hljs-keyword">return</span> <span class="hljs-built_in">FALSE</span> (å·²éªŒè¯ä¸ç®—<span class="hljs-string">"å"</span> <span class="hljs-built_in">WiFi</span>)

è¯„åˆ†æ¯”è¾ƒï¼š
â””â”€ <span class="hljs-built_in">LTE</span> (<span class="hljs-number">70</span>) &gt; <span class="hljs-built_in">WiFi</span> (<span class="hljs-number">25</span>)

å†³ç­–ï¼šé€‰æ‹© LTE âœ“
åŸå› ï¼š<span class="hljs-built_in">WiFi</span> è™½ç„¶éªŒè¯è¿‡ï¼Œä½†è¯„åˆ†å¤ªä½ï¼ŒLTE æ›´å¥½
</code></pre>
<p>ã€ç½‘ç»œåˆ‡æ¢çš„å®Œæ•´æ—¶é—´çº¿ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>å®é™…ç½‘ç»œåˆ‡æ¢çš„å‘ç”Ÿè¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>: ç”¨æˆ·åœ¨ WiFi è¦†ç›–èŒƒå›´å†…
     â”œâ”€ WiFi è¿æ¥ï¼Œå·²éªŒè¯ (RSSI -40dbm, è¯„åˆ† 95)
     â”œâ”€ LTE è¿æ¥ï¼Œå·²éªŒè¯ (RSRP -90dbm, è¯„åˆ† 65)
     â””â”€ é»˜è®¤ç½‘ç»œï¼šWiFi (95 &gt; 65)

<span class="hljs-attr">T</span>=<span class="hljs-number">10</span>s: ç”¨æˆ·èµ°å‡º WiFi è¦†ç›–èŒƒå›´
       â””â”€ WiFi ä¿¡å·å¼€å§‹è¡°å‡ -40 â†’ -50 â†’ -60 ...

<span class="hljs-attr">T</span>=<span class="hljs-number">15</span>s: WiFi ä¿¡å·ç»§ç»­è¡°å‡åˆ° -<span class="hljs-number">85</span>dbm
       â”œâ”€ WiFiNetworkAgent.onSignalStrengthChanged(-85)
       â”œâ”€ æ–°è¯„åˆ†ï¼š25
       â”œâ”€ ConnectivityService.onNetworkScoreChanged()
       â””â”€ è§¦å‘ rematchAllNetworksAndRequests()

<span class="hljs-attr">T</span>=<span class="hljs-number">16</span>s: NetworkRanker.getBestNetwork()
       â”œâ”€ å€™é€‰ï¼šWiFi (è¯„åˆ† 25), LTE (è¯„åˆ† 65)
       â”œâ”€ è§„åˆ™ 1-7ï¼šéƒ½é€šè¿‡ (éƒ½å·²éªŒè¯ï¼Œä¸åœ¨ Linger ç­‰)
       â”œâ”€ ä¼ è¾“ä¼˜å…ˆçº§ï¼šéƒ½ä¸æ˜¯ä»¥å¤ªç½‘/è“ç‰™ï¼Œç»§ç»­
       â”œâ”€ è¯„åˆ†æ¯”è¾ƒï¼šLTE (65) &gt; WiFi (25)
       â””â”€ ç»“è®ºï¼šLTE æ˜¯æ›´å¥½çš„ç½‘ç»œ

<span class="hljs-attr">T</span>=<span class="hljs-number">16.1</span>s: åšå‡ºåˆ‡æ¢å†³å®š
         â””â”€ ConnectivityService: "WiFi è¯„åˆ†å¤ªä½ï¼Œåº”è¯¥åˆ‡æ¢åˆ° LTE"

<span class="hljs-attr">T</span>=<span class="hljs-number">16.2</span>s: è¿›å…¥ Lingerï¼ˆå¦‚æœ WiFi æœ‰æ´»è·ƒè¯·æ±‚ï¼‰
         â”œâ”€ WiFi çŠ¶æ€å˜ä¸º LOSING
         â”œâ”€ è®¾ç½® 120 ç§’ Linger è®¡æ—¶å™¨
         â”œâ”€ è°ƒç”¨ onLosing(wifiNetwork, 120000)
         â””â”€ LTE æˆä¸ºæ–°çš„é»˜è®¤ç½‘ç»œ

<span class="hljs-attr">T</span>=<span class="hljs-number">16.3</span>s: åº”ç”¨è¡Œä¸ºæ”¹å˜
         â”œâ”€ æ–°çš„ç½‘ç»œè¯·æ±‚ â†’ LTE
         â”œâ”€ ç°æœ‰ Socket â†’ WiFi (ä»åœ¨ Linger)
         â”œâ”€ ConnectivityManager.getActiveNetwork() â†’ LTE
         â””â”€ åº”ç”¨å¯èƒ½ä¸æ„ŸçŸ¥ï¼ˆå·²åœ¨ Lingerï¼‰

<span class="hljs-attr">T</span>=<span class="hljs-number">60</span>s: WiFi ä¿¡å·å®Œå…¨ä¸§å¤±
       â”œâ”€ WiFi æ–­å¼€
       â”œâ”€ WiFi çŠ¶æ€å˜ä¸º DISCONNECTED
       â””â”€ onLost() å›è°ƒ

<span class="hljs-attr">T</span>=<span class="hljs-number">136</span>s: å¦‚æœ WiFi ä¿¡å·ä¸€ç›´æ²¡æœ‰æ¢å¤ï¼ŒLinger æœŸæ»¡
        â””â”€ WiFi è¢«å¼ºåˆ¶æ–­å¼€ï¼ˆå¦‚æœä»åœ¨ Lingerï¼‰
</code></pre>
<p>ã€åˆ‡æ¢çš„å¹³æ»‘åº¦ä¼˜åŒ–ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>ä¸ºäº†è®©ç”¨æˆ·æ— æ„ŸçŸ¥åœ°åˆ‡æ¢ç½‘ç»œï¼ŒAndroid é‡‡ç”¨äº†å¤šç§ä¼˜åŒ–ï¼š</p>
<p>ä¼˜åŒ– 1: Linger æœºåˆ¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ ç»™æ—§ç½‘ç»œä¿æ´»æ—¶é—´ï¼ˆ120 ç§’ï¼‰
â”œâ”€ å·²å»ºç«‹çš„è¿æ¥ç»§ç»­ç”¨æ—§ç½‘ç»œ
â”œâ”€ æ–°è¿æ¥è‡ªåŠ¨ç”¨æ–°ç½‘ç»œ
â””â”€ åº”ç”¨æ— éœ€æ”¹å˜ä»£ç </p>
<p>ä¼˜åŒ– 2: è¿æ¥æ± å¤ç”¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HTTP:
â”œâ”€ TCP è¿æ¥æ± ç»‘å®šåˆ°ç½‘ç»œ
â”œâ”€ æ–°ç½‘ç»œï¼Œæ–°è¿æ¥æ± 
â””â”€ æ—§è¿æ¥åœ¨æ—§ç½‘ç»œä¸Šç»§ç»­ç”¨</p>
<p>Socket:
â”œâ”€ ä½¿ç”¨ Network.getSocketFactory() åˆ›å»º
â”œâ”€ ç»‘å®šåˆ°ç‰¹å®šç½‘ç»œ
â””â”€ ç½‘ç»œæ–­å¼€æ—¶æ‰ä¼šä¸­æ–­</p>
<p>ä¼˜åŒ– 3: DNS ç¼“å­˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ åŸŸåè§£æç»“æœè¢«ç¼“å­˜
â”œâ”€ é¿å…é¢‘ç¹é‡æ–°è§£æ
â””â”€ è·¨ç½‘ç»œä½¿ç”¨ç¼“å­˜ç»“æœ</p>
<p>ä¼˜åŒ– 4: é¢„è¿æ¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ è¯†åˆ«å³å°†éœ€è¦çš„èµ„æº
â”œâ”€ åœ¨æ–°ç½‘ç»œä¸Šé¢„å…ˆå»ºç«‹è¿æ¥
â””â”€ ç”¨æˆ·åˆ‡æ¢æ—¶ç«‹å³å¯ç”¨</p>
<p>ä¼˜åŒ– 5: ä¿¡å·é¢„æµ‹
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åŸºäºå†å²æ•°æ®ï¼š
â”œâ”€ WiFi é€šå¸¸åœ¨è¿™ä¸ªä½ç½®ä¼šæ–­å¼€
â”œâ”€ è¿™ä¸ªæ—¶é—´æ®µ LTE ä¿¡å·è¾ƒå¼±
â”œâ”€ æ ¹æ®é¢„æµ‹ä¸»åŠ¨è°ƒæ•´ç½‘ç»œé€‰æ‹©
â””â”€ å‡å°‘ç½‘ç»œå¡é¡¿</p>
<pre><code class="hljs language-markdown" lang="markdown">
ç°åœ¨è¿›å…¥ç¬¬ 6 éƒ¨åˆ†ï¼š

<span class="hljs-section">### <span class="hljs-strong">**6ã€å®æˆ˜ï¼šç½‘ç»œé—®é¢˜è¯Šæ–­ä¸ä¼˜åŒ–**</span></span>

</code></pre>
<p>ã€WiFi è¿æ¥å¤±è´¥çš„æ’æŸ¥æµç¨‹ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>é—®é¢˜ï¼šç”¨æˆ·æ— æ³•è¿æ¥åˆ°ç‰¹å®šçš„ WiFi SSID</p>
<p>è¯Šæ–­æ­¥éª¤ï¼š</p>
<p>Step 1: æ£€æŸ¥åº•å±‚ WiFi é©±åŠ¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat | <span class="hljs-keyword">grep</span> -i <span class="hljs-string">"wifi"</span>
</code></pre>
<p>å…³é”®æ—¥å¿—ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">WifiManager:</span> [Network <span class="hljs-keyword">event</span> callback]
<span class="hljs-symbol">WifiManager:</span> State change: SCANNING
<span class="hljs-symbol">WifiManager:</span> State change: CONNECTING
<span class="hljs-symbol">WifiManager:</span> State change: AUTHENTICATING
<span class="hljs-symbol">WifiManager:</span> State change: OBTAINING_IPADDR
<span class="hljs-symbol">WifiManager:</span> State change: CONNECTED
<span class="hljs-symbol">WifiManager:</span> State change: DISCONNECTED (reason=X)
</code></pre>
<p>å¸¸è§çš„æ–­å¼€åŸå› ä»£ç ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">reason</span>=<span class="hljs-number">1</span>    : WIFI_REASON_UNSPECIFIED (æœªæŒ‡å®š)
<span class="hljs-attr">reason</span>=<span class="hljs-number">2</span>    : WIFI_REASON_WRONG_PASSWORD (å¯†ç é”™è¯¯)
<span class="hljs-attr">reason</span>=<span class="hljs-number">3</span>    : WIFI_REASON_AUTH_FAILED (è®¤è¯å¤±è´¥)
<span class="hljs-attr">reason</span>=<span class="hljs-number">4</span>    : WIFI_REASON_NETWORK_UNAVAILABLE (ç½‘ç»œä¸å¯ç”¨)
<span class="hljs-attr">reason</span>=<span class="hljs-number">5</span>    : WIFI_REASON_DEAUTH_RECEIVED (æ”¶åˆ° Deauth å¸§)
<span class="hljs-attr">reason</span>=<span class="hljs-number">6</span>    : WIFI_REASON_DISASSOC_RECEIVED (æ”¶åˆ° Disassoc å¸§)
<span class="hljs-attr">reason</span>=<span class="hljs-number">7</span>    : WIFI_REASON_ASSOC_FAILED (å…³è”å¤±è´¥)
<span class="hljs-attr">reason</span>=<span class="hljs-number">8</span>    : WIFI_REASON_HAND_SHAKE_TIMEOUT (æ¡æ‰‹è¶…æ—¶)
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">å¦‚æœæ—¥å¿—æ˜¾ç¤º AUTHENTICATING åœç•™å¾ˆä¹…åè·³åˆ° DISCONNECTED
â”œâ”€ å¯èƒ½åŸå› ï¼šå¯†ç é”™è¯¯ã€è·¯ç”±å™¨ä¸æ”¯æŒè¯¥åŠ å¯†æ–¹å¼
â””â”€ è§£å†³ï¼šæ£€æŸ¥å¯†ç ã€æ£€æŸ¥è·¯ç”±å™¨é…ç½®

å¦‚æœå¿«é€Ÿæ˜¾ç¤º DISCONNECTEDï¼Œ<span class="hljs-attr">reason</span>=<span class="hljs-number">5</span>
â”œâ”€ AP æ‹’ç»è¿æ¥ï¼ˆå¯èƒ½ MAC è¿‡æ»¤ã€å®‰å…¨é—®é¢˜ï¼‰
â””â”€ è”ç³» WiFi ç®¡ç†å‘˜
</code></pre>
<p>Step 2: æ£€æŸ¥ IP é…ç½®
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs">adb shell ifconfig wlan0
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">wlan0: <span class="hljs-attr">flags</span>=<span class="hljs-number">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;
       inet 192.168.1.100  netmask 255.255.255.0  broadcast 192.168.1.255
       inet6 fe80::xxxx:yyyy:zzzz:wwww  prefixlen 64  scopeid 0x20&lt;link&gt;
       ...
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœæ²¡æœ‰ inet åœ°å€ï¼š
â”œâ”€ DHCP æ²¡æœ‰ç»™ IP
â”œâ”€ å¯èƒ½è·¯ç”±å™¨ DHCP æ•…éšœ
â””â”€ æˆ–è€… <span class="hljs-built_in">WiFi</span> é©±åŠ¨é—®é¢˜

å¦‚æœæœ‰ inet åœ°å€ï¼Œå¯ä»¥ç»§ç»­
</code></pre>
<p>Step 3: æ£€æŸ¥ç½‘ç»œè¿æ¥æ€§
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-r" lang="r">adb shell ping <span class="hljs-operator">-</span><span class="hljs-built_in">c</span> <span class="hljs-number">4</span> <span class="hljs-number">8.8</span>.8.8
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code class="hljs language-python" lang="python">æˆåŠŸï¼š
PING <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span> (<span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>): <span class="hljs-number">56</span> data <span class="hljs-built_in">bytes</span>
<span class="hljs-number">64</span> <span class="hljs-built_in">bytes</span> <span class="hljs-keyword">from</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>: seq=<span class="hljs-number">0</span> ttl=<span class="hljs-number">57</span> time=<span class="hljs-number">25.3</span> ms
<span class="hljs-number">64</span> <span class="hljs-built_in">bytes</span> <span class="hljs-keyword">from</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>: seq=<span class="hljs-number">1</span> ttl=<span class="hljs-number">57</span> time=<span class="hljs-number">24.8</span> ms
...

å¤±è´¥ï¼š
PING <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span> (<span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>): <span class="hljs-number">56</span> data <span class="hljs-built_in">bytes</span>
(no response)
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs">å¦‚æœ ping æˆåŠŸï¼š
â”œâ”€ IP é…ç½®æ­£å¸¸
â”œâ”€ DNS å¯èƒ½æœ‰é—®é¢˜ï¼ˆè§ä¸‹ä¸€æ­¥ï¼‰
â””â”€ æˆ–è€…æ˜¯åº”ç”¨é—®é¢˜

å¦‚æœ ping å¤±è´¥ï¼š
â”œâ”€ ç½‘ç»œè¿æ¥ç¡®å®æœ‰é—®é¢˜
â”œâ”€ å¯èƒ½åŸå› ï¼š
â”‚  â”œâ”€ è·¯ç”±å™¨ç½‘ç»œæ•…éšœ
â”‚  â”œâ”€ ISP æ–­ç½‘
â”‚  â”œâ”€ é˜²ç«å¢™é˜»æ­¢
â”‚  â””â”€ è·¯ç”±å™¨è®¾ç½®ä¸å½“
</code></pre>
<p>Step 4: æ£€æŸ¥ DNS è§£æ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs">adb shell nslookup google.com
æˆ–
adb shell getprop net.dns1
adb shell getprop net.dns2
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">æˆåŠŸï¼š
<span class="hljs-symbol">Server:</span>         <span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span>
<span class="hljs-symbol">Address:</span>        <span class="hljs-number">8.8</span>.<span class="hljs-number">8.8#</span><span class="hljs-number">53</span>

<span class="hljs-symbol">Name:</span>   google.com
<span class="hljs-symbol">Address:</span> <span class="hljs-number">142.251</span>.<span class="hljs-number">41.14</span>

å¤±è´¥ï¼š
<span class="hljs-symbol">nslookup:</span> can<span class="hljs-comment">'t resolve google.com</span>
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å¦‚æœ DNS å¤±è´¥ï¼š
â”œâ”€ è·¯ç”±å™¨ DNS æ•…éšœ
â”œâ”€ æ”¹ç”¨å…¬å…± DNS (<span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span>, <span class="hljs-number">1.1</span>.<span class="hljs-number">1.1</span>)
â””â”€ æ£€æŸ¥è·¯ç”±å™¨ DHCP é…ç½®

å¦‚æœ DNS æˆåŠŸä½†æµè§ˆå™¨ä¸å·¥ä½œï¼š
â”œâ”€ å¯èƒ½æ˜¯ä»£ç†é—®é¢˜
â”œâ”€ æˆ–è€…é˜²ç«å¢™é—®é¢˜
â””â”€ æˆ–åº”ç”¨æƒé™ä¸è¶³
</code></pre>
<p>Step 5: æ£€æŸ¥ ConnectivityService æ—¥å¿—
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat -b <span class="hljs-keyword">system</span> | <span class="hljs-keyword">grep</span> -i <span class="hljs-string">"connectivity"</span>
</code></pre>
<p>å…³é”®æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">ConnectivityService:</span> <span class="hljs-string">updateNetworkInfo()</span>
<span class="hljs-attr">ConnectivityService:</span> <span class="hljs-string">handleNetworkInfoChange()</span>
<span class="hljs-attr">ConnectivityService:</span> <span class="hljs-string">maybeNotifyNetworkCallbacks()</span>

<span class="hljs-string">//</span> <span class="hljs-string">ç½‘ç»œçŠ¶æ€å˜åŒ–</span>
<span class="hljs-attr">NetworkInfo:</span> <span class="hljs-string">State=CONNECTING</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">State=CONNECTED</span>
<span class="hljs-attr">NetworkInfo:</span> <span class="hljs-string">DetailedState=AUTHENTICATING</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">DetailedState=CONNECTED</span>

<span class="hljs-string">//</span> <span class="hljs-string">èƒ½åŠ›å˜åŒ–</span>
<span class="hljs-attr">NetworkCapabilities:</span> <span class="hljs-string">INTERNET,</span> <span class="hljs-string">NOT_METERED,</span> <span class="hljs-string">NOT_ROAMING,</span> <span class="hljs-string">VALIDATED</span>

<span class="hljs-string">//</span> <span class="hljs-string">è¯„åˆ†</span>
<span class="hljs-attr">Network score:</span> <span class="hljs-number">75</span>
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœçœ‹åˆ° CONNECTED ä½†æ²¡æœ‰ VALIDATEDï¼š
â”œâ”€ NetworkMonitor éªŒè¯å¤±è´¥
â”œâ”€ å¯èƒ½æ˜¯å¼ºåˆ¶é—¨æˆ·ï¼ˆéœ€è¦ç™»å½•ï¼‰
â”œâ”€ æˆ–ç½‘ç»œç¡®å®æ— äº’è”ç½‘
â””â”€ æŸ¥çœ‹ä¸‹ä¸€æ­¥çš„ NetworkMonitor æ—¥å¿—

å¦‚æœæ²¡æœ‰çœ‹åˆ°ç½‘ç»œåˆ›å»ºï¼ˆnetIdï¼‰ï¼š
â”œâ”€ ç½‘ç»œæ²¡æœ‰è¢«æ­£ç¡®æ³¨å†Œ
â”œâ”€ å¯èƒ½ NetworkAgent æœ‰é—®é¢˜
â””â”€ æ£€æŸ¥ <span class="hljs-built_in">WiFi</span> é©±åŠ¨æˆ– WifiService
</code></pre>
<p>Step 6: æ£€æŸ¥ NetworkMonitor éªŒè¯çŠ¶æ€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat | <span class="hljs-keyword">grep</span> -i <span class="hljs-string">"NetworkMonitor"</span>
</code></pre>
<p>å…³é”®æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">NetworkMonitor:</span> Probing network...
<span class="hljs-symbol">NetworkMonitor:</span> <span class="hljs-keyword">GET</span> http://www.google.com/generate_204
<span class="hljs-symbol">NetworkMonitor:</span> Response code: <span class="hljs-number">204</span>
<span class="hljs-symbol">NetworkMonitor:</span> Network validation successful

æˆ–

<span class="hljs-symbol">NetworkMonitor:</span> <span class="hljs-keyword">GET</span> http://...
<span class="hljs-symbol">NetworkMonitor:</span> Captive portal detected
<span class="hljs-symbol">NetworkMonitor:</span> Response code: <span class="hljs-number">302</span> (redirect)

æˆ–

<span class="hljs-symbol">NetworkMonitor:</span> Probe failed
<span class="hljs-symbol">NetworkMonitor:</span> DNS timeout
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœçœ‹åˆ° <span class="hljs-string">"validation successful"</span>ï¼š
â”œâ”€ ç½‘ç»œå·²éªŒè¯ï¼Œåº”è¯¥å¯ä»¥ç”¨
â”œâ”€ å¦‚æœåº”ç”¨è¿˜æ˜¯ä¸èƒ½è”ç½‘ï¼Œå¯èƒ½æ˜¯åº”ç”¨æƒé™é—®é¢˜

å¦‚æœçœ‹åˆ° <span class="hljs-string">"Captive portal detected"</span>ï¼š
â”œâ”€ éœ€è¦ç™»å½• <span class="hljs-built_in">WiFi</span>
â”œâ”€ ç³»ç»Ÿä¼šå¼¹å‡º portal ç™»å½•çª—å£
â””â”€ ç”¨æˆ·éœ€è¦åœ¨æµè§ˆå™¨ä¸­è®¤è¯

å¦‚æœçœ‹åˆ° <span class="hljs-string">"Probe failed"</span>ï¼š
â”œâ”€ éªŒè¯å¤±è´¥ï¼Œç½‘ç»œä¸å¯ç”¨
â”œâ”€ åŸå› ï¼šæ²¡æœ‰ IPv4, IPv6, æˆ– DNS é—®é¢˜
â””â”€ æ£€æŸ¥ç½‘ç»œé…ç½®
</code></pre>
<p>Step 7: æ£€æŸ¥åº”ç”¨æƒé™
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">adb shell cmd appops get com.your.app INTERNET
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code class="hljs language-rust" lang="rust">Allow       <span class="hljs-punctuation">-&gt;</span> æœ‰æƒé™
Deny        <span class="hljs-punctuation">-&gt;</span> æ— æƒé™
<span class="hljs-built_in">Default</span>     <span class="hljs-punctuation">-&gt;</span> è·Ÿéšç³»ç»Ÿè®¾ç½®
</code></pre>
<p>å¦‚æœæ— æƒé™ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">adb shell cmd appops set com.your.app INTERNET allow
</code></pre>
<p>å…¶ä»–éœ€è¦çš„æƒé™ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">ACCESS_NETWORK_STATE      <span class="hljs-punctuation">-&gt;</span> æŸ¥è¯¢ç½‘ç»œçŠ¶æ€
ACCESS_WIFI_STATE         <span class="hljs-punctuation">-&gt;</span> æŸ¥è¯¢ WiFi çŠ¶æ€
CHANGE_NETWORK_STATE      <span class="hljs-punctuation">-&gt;</span> åˆ‡æ¢ç½‘ç»œ
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs">å¦‚æœåº”ç”¨æœ‰ INTERNET æƒé™ä½†ä»ä¸èƒ½è¿ï¼š
â”œâ”€ å¯èƒ½æ˜¯ç½‘ç»œæœ¬èº«çš„é—®é¢˜ï¼ˆè§å‰é¢æ­¥éª¤ï¼‰
â”œâ”€ æˆ–åº”ç”¨æœ‰ bugï¼ˆå‘é€ä¸æ­£ç¡®çš„è¯·æ±‚ï¼‰
â””â”€ ç”¨ tcpdump æŠ“åŒ…æ£€æŸ¥
</code></pre>
<p>Step 8: æŠ“åŒ…åˆ†ææµé‡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">adb shell tcpdump -i wlan0 -w /sdcard/traffic.pcap
<span class="hljs-comment">// è¿è¡Œåº”ç”¨å’Œé‡ç°é—®é¢˜</span>
adb pull /sdcard/traffic.pcap
<span class="hljs-comment">// ç”¨ Wireshark åˆ†æ</span>
</code></pre>
<p>å…³é”®æ£€æŸ¥ç‚¹ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">DHCP é˜¶æ®µï¼š
â”œâ”€ è®¾å¤‡å‘é€ DHCP Discovery
â”œâ”€ è·¯ç”±å™¨å“åº” DHCP Offer
â”œâ”€ è®¾å¤‡å‘é€ DHCP <span class="hljs-built_in">Request</span>
â””â”€ è·¯ç”±å™¨å“åº” DHCP ACK

DNS é˜¶æ®µï¼š
â”œâ”€ è®¾å¤‡å‘é€ DNS Query (A æˆ– AAAA)
â”œâ”€ DNS æœåŠ¡å™¨å“åº”ç»“æœ
â””â”€ æ£€æŸ¥æ˜¯å¦æœ‰è¶…æ—¶æˆ–é”™è¯¯

HTTP/HTTPS é˜¶æ®µï¼š
â”œâ”€ TCP <span class="hljs-number">3</span>-way handshake
â”œâ”€ HTTP <span class="hljs-keyword">GET</span>/POST è¯·æ±‚
â”œâ”€ æ£€æŸ¥å“åº”çŠ¶æ€ç 
â””â”€ æ£€æŸ¥æ˜¯å¦æœ‰è¶…æ—¶
</code></pre>
<p>ã€ç½‘ç»œåˆ‡æ¢å¼‚å¸¸çš„å®šä½ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>é—®é¢˜ï¼šè®¾å¤‡é¢‘ç¹åˆ‡æ¢ WiFi å’Œ LTEï¼ˆæŠ–åŠ¨ï¼‰</p>
<p>è¯Šæ–­ï¼š</p>
<p>Step 1: ç¡®è®¤æ˜¯å¦çœŸçš„åœ¨åˆ‡æ¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat -b <span class="hljs-keyword">system</span> | <span class="hljs-keyword">grep</span> -E <span class="hljs-string">"rematch|default|network.available"</span>
</code></pre>
<p>æ—¥å¿—ç¤ºä¾‹ï¼ˆè¡¨ç¤ºåœ¨åˆ‡æ¢ï¼‰ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">T+0.0s: [WiFi] Network score: 75</span>
<span class="hljs-section">T+1.5s: [LTE] Network score: 65</span>
<span class="hljs-section">T+2.0s: rematchAllNetworksAndRequests() -&gt; é€‰æ‹© WiFi</span>
<span class="hljs-section">T+5.0s: [WiFi] Network score: 45 (ä¿¡å·å˜å¼±)</span>
<span class="hljs-section">T+5.1s: rematchAllNetworksAndRequests() -&gt; é€‰æ‹© LTE</span>
<span class="hljs-section">T+5.2s: WiFi entering LOSING state</span>
<span class="hljs-section">T+8.0s: [WiFi] Network score: 75 (ä¿¡å·æ¢å¤!)</span>
<span class="hljs-section">T+8.1s: rematchAllNetworksAndRequests() -&gt; é€‰æ‹© WiFi (å–æ¶ˆ Linger)</span>
<span class="hljs-section">T+10.0s: (é‡å¤ä¸Šé¢çš„å¾ªç¯)</span>
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœé¢‘ç¹çœ‹åˆ°è¿™ç§æ—¥å¿—ï¼š
â”œâ”€ <span class="hljs-built_in">WiFi</span> ä¿¡å·ä¸ç¨³å®šï¼ˆä¿¡å·åœ¨è¾¹ç•Œï¼Œä¸Šä¸‹æ³¢åŠ¨ï¼‰
â”œâ”€ NetworkRanker æ¯æ¬¡è¯„åˆ†å˜åŒ–éƒ½è§¦å‘é‡æ–°åŒ¹é…
â””â”€ è¿™å¯¼è‡´é¢‘ç¹åˆ‡æ¢
</code></pre>
<p>Step 2: æ£€æŸ¥ä¿¡å·å¼ºåº¦å˜åŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat | <span class="hljs-keyword">grep</span> -E <span class="hljs-string">"SignalStrength|RSSI|RSRP"</span>
</code></pre>
<p>æ—¥å¿—ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">WifiManager: RSSI changed: -<span class="hljs-number">60</span>dbm <span class="hljs-punctuation">-&gt;</span> -<span class="hljs-number">70</span>dbm <span class="hljs-punctuation">-&gt;</span> -<span class="hljs-number">60</span>dbm <span class="hljs-punctuation">-&gt;</span> -<span class="hljs-number">70</span>dbm ...
TelephonyManager: Signal strength: <span class="hljs-number">2</span> bars <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">3</span> bars <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">2</span> bars <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">3</span> bars ...
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœçœ‹åˆ°ä¿¡å·åœ¨è¾¹ç•Œé¢‘ç¹æ³¢åŠ¨ï¼š
â”œâ”€ ç‰©ç†ä½ç½®åœ¨ä¿¡å·è¾¹ç•Œ
â”œâ”€ ç”¨æˆ·èµ°è¿‘/ç¦»å¼€ <span class="hljs-built_in">WiFi</span> è·¯ç”±å™¨
â””â”€ è§£å†³ï¼šå»ºè®®ç”¨æˆ·ç§»åŠ¨ä½ç½®æˆ–åŠ å¼º <span class="hljs-built_in">WiFi</span> è¦†ç›–
</code></pre>
<p>Step 3: æ£€æŸ¥è¯„åˆ†è®¡ç®—
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat | <span class="hljs-keyword">grep</span> <span class="hljs-string">"NetworkScore"</span>
</code></pre>
<p>æ—¥å¿—ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">WiFi score:</span> <span class="hljs-number">60</span> <span class="hljs-string">(RSSI:</span> <span class="hljs-string">-75dbm,</span> <span class="hljs-attr">validated:</span> <span class="hljs-literal">true</span><span class="hljs-string">,</span> <span class="hljs-attr">exiting:</span> <span class="hljs-literal">false</span><span class="hljs-string">)</span>
<span class="hljs-attr">LTE score:</span> <span class="hljs-number">65</span> <span class="hljs-string">(RSRP:</span> <span class="hljs-string">-90dbm,</span> <span class="hljs-attr">validated:</span> <span class="hljs-literal">true</span><span class="hljs-string">,</span> <span class="hljs-attr">exiting:</span> <span class="hljs-literal">false</span><span class="hljs-string">)</span>

<span class="hljs-attr">Decision:</span> <span class="hljs-string">LTE</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">WiFi,</span> <span class="hljs-string">switch</span> <span class="hljs-string">to</span> <span class="hljs-string">LTE</span>
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœè¯„åˆ†éƒ½æ­£ç¡®ï¼Œä½†é¢‘ç¹åˆ‡æ¢ï¼š
â”œâ”€ å¯èƒ½æ˜¯ç½‘ç»œæ’åºç®—æ³•çš„é—®é¢˜
â”œâ”€ æˆ–è€… NetworkRanker çš„ <span class="hljs-string">"stickiness"</span> æ²¡æœ‰ç”Ÿæ•ˆ
â””â”€ æ£€æŸ¥å½“å‰é»˜è®¤ç½‘ç»œæ˜¯å¦åœ¨ candidates ä¸­
</code></pre>
<p>Step 4: è°ƒæ•´å‚æ•°ä»¥å‡å°‘åˆ‡æ¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>ç³»ç»Ÿå±æ€§ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å¢åŠ  Linger æ—¶é—´ï¼ˆç»™ç½‘ç»œæ¢å¤æ›´å¤šæ—¶é—´ï¼‰</span>
<span class="hljs-attr">ro.config.ip_linger_ms</span>=<span class="hljs-number">300000</span>  (é»˜è®¤ <span class="hljs-number">120000</span>)

<span class="hljs-comment"># æ”¹å˜è¯„åˆ†åå¥½</span>
<span class="hljs-attr">persist.sys.wifi.prefer_bad_wifi</span>=<span class="hljs-literal">true</span>  (å€¾å‘äºä¿ç•™ WiFi)

<span class="hljs-comment"># ç¦ç”¨è‡ªåŠ¨åˆ‡æ¢ï¼ˆä¸æ¨èï¼‰</span>
<span class="hljs-attr">persist.sys.disable_network_switching</span>=<span class="hljs-literal">true</span>
</code></pre>
<p>ä»£ç å±‚é¢çš„è§£å†³ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">åœ¨ NetworkRanker ä¸­å¢åŠ <span class="hljs-string">"ç²˜æ€§"</span>è¯„åˆ†å¥–åŠ±ï¼š
â”œâ”€ å¦‚æœå½“å‰ç½‘ç»œè¿˜åœ¨ candidates ä¸­
â”œâ”€ ç»™å½“å‰ç½‘ç»œ +<span class="hljs-number">10</span> åˆ†ï¼ˆç²˜æ€§å¥–åŠ±ï¼‰
â”œâ”€ å‡å°‘ä¸å¿…è¦çš„åˆ‡æ¢
â””â”€ åªåœ¨è¯„åˆ†å·®å¼‚è¶³å¤Ÿå¤§æ—¶æ‰åˆ‡æ¢
</code></pre>
<p>ã€ç½‘ç»œæ€§èƒ½ä¼˜åŒ–ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>ä¼˜åŒ– 1: åŠ é€Ÿç½‘ç»œå°±ç»ªæ—¶é—´
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>é—®é¢˜ï¼šä»æ— ç½‘ç»œåˆ°æœ‰ç½‘ç»œè¦ 10 ç§’</p>
<p>ä¼˜åŒ–æ–¹æ³•ï¼š</p>
<p>a) å¹¶è¡Œåˆå§‹åŒ–</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸æ¨èï¼šä¸²è¡Œ</span>
step1_getIPAddress();  <span class="hljs-comment">// 3 ç§’</span>
step2_startDNS();      <span class="hljs-comment">// 2 ç§’</span>
step3_startValidation();  <span class="hljs-comment">// 5 ç§’</span>
<span class="hljs-comment">// æ€»è€—æ—¶ï¼š10 ç§’</span>

<span class="hljs-comment">// æ¨èï¼šå¹¶è¡Œ</span>
parallel {
    task1: getIPAddress();       <span class="hljs-comment">// 3 ç§’</span>
    task2: startDNS();           <span class="hljs-comment">// 2 ç§’</span>
    task3: startValidation();    <span class="hljs-comment">// 5 ç§’ (å¹¶è¡Œ)</span>
}
<span class="hljs-comment">// æ€»è€—æ—¶ï¼š5 ç§’ (æœ€é•¿çš„ä»»åŠ¡)</span>
</code></pre>
<p>b) éªŒè¯ç¼“å­˜</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœç›¸åŒ SSID çš„ <span class="hljs-built_in">WiFi</span> åœ¨ <span class="hljs-number">1</span> å°æ—¶å†…éªŒè¯è¿‡ï¼š
â”œâ”€ è·³è¿‡éªŒè¯ï¼Œç›´æ¥æ ‡è®°ä¸º VALIDATED
â”œâ”€ æˆ–å‘é€æ¢æµ‹ä½†ä¸ç­‰ç»“æœ
â””â”€ èŠ‚çœ <span class="hljs-number">3</span><span class="hljs-number">-5</span> ç§’
</code></pre>
<p>c) æå‰å¯åŠ¨ç½‘ç»œæœåŠ¡</p>
<pre><code class="hljs">åœ¨ CONNECTING çŠ¶æ€ï¼Œå°±å¯ä»¥ï¼š
â”œâ”€ å¯åŠ¨ DNS è§£æ
â”œâ”€ å¯åŠ¨ HTTP è¿æ¥æ± 
â”œâ”€ é¢„åŠ è½½å¸¸ç”¨èµ„æº
â””â”€ ç­‰ CONNECTED æ—¶ç«‹å³å¯ç”¨
</code></pre>
<p>ä¼˜åŒ– 2: é™ä½ç½‘ç»œåˆ‡æ¢çš„å»¶è¿Ÿ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>é—®é¢˜ï¼šWiFi åˆ° LTE çš„åˆ‡æ¢éœ€è¦ 2-3 ç§’</p>
<p>ä¼˜åŒ–æ–¹æ³•ï¼š</p>
<p>a) é¢„è¿æ¥</p>
<pre><code class="hljs">è¯†åˆ«å³å°†éœ€è¦çš„æœåŠ¡å™¨ï¼š
â”œâ”€ å»ºç«‹ TCP è¿æ¥ï¼ˆSYN å‘é€ï¼‰
â”œâ”€ å»ºç«‹ TLS æ¡æ‰‹ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰
â””â”€ å½“ Linger æ—¶ç”¨æˆ·äº¤äº’æ—¶ï¼Œç«‹å³å¯ç”¨
</code></pre>
<p>b) è¿æ¥å¤ç”¨</p>
<pre><code class="hljs">ä½¿ç”¨ HTTP/2 å’Œ HTTP/3ï¼š
â”œâ”€ å¤šè·¯å¤ç”¨ï¼ˆé¿å…å¤šä¸ª TCP è¿æ¥ï¼‰
â”œâ”€ è¿æ¥è¿ç§»ï¼ˆè·¨ç½‘ç»œä¿æ´»è¿æ¥ï¼‰
â””â”€ å¤´éƒ¨å‹ç¼©ï¼ˆå‡å°‘é‡å»ºè¿æ¥çš„å¼€é”€ï¼‰
</code></pre>
<p>c) ç¼“å­˜å’Œç¦»çº¿æ”¯æŒ</p>
<pre><code class="hljs">ç¼“å­˜å…³é”®èµ„æºï¼š
â”œâ”€ é¿å…ç½‘ç»œåˆ‡æ¢æ—¶é‡æ–°è·å–
â”œâ”€ Service Worker æä¾›ç¦»çº¿æ”¯æŒ
â””â”€ ç”¨æˆ·æ— æ„ŸçŸ¥åˆ‡æ¢
</code></pre>
<p>ä¼˜åŒ– 3: å‡å°‘ç”µæ± æ¶ˆè€—
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>é—®é¢˜ï¼šWiFi å’Œ LTE åŒæ—¶æ´»è·ƒæ¶ˆè€—ç”µæ± </p>
<p>ä¼˜åŒ–æ–¹æ³•ï¼š</p>
<p>a) åŠæ—¶å…³é—­ Linger ä¸­çš„ç½‘ç»œ</p>
<pre><code class="hljs">å½“ç½‘ç»œè´¨é‡å·®æ—¶ï¼š
â”œâ”€ ä¸ç­‰ 120 ç§’ Linger å®Œæˆ
â”œâ”€ ç«‹å³åˆ‡æ¢å¹¶æ–­å¼€æ—§ç½‘ç»œ
â””â”€ çœç”µ
</code></pre>
<p>b) åˆå¹¶ DNS æŸ¥è¯¢</p>
<pre><code class="hljs">ä¸åŒåº”ç”¨çš„ DNS æŸ¥è¯¢ï¼š
â”œâ”€ ç³»ç»Ÿç¼“å­˜ï¼Œé¿å…é‡å¤æŸ¥è¯¢
â”œâ”€ å‡å°‘ç½‘ç»œèŠ¯ç‰‡å”¤é†’æ¬¡æ•°
â””â”€ æ›´çœç”µ
</code></pre>
<p>c) æ™ºèƒ½é¢„æµ‹</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">åŸºäºåº”ç”¨ä½¿ç”¨æ¨¡å¼ï¼š</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">é¢„æµ‹ç”¨æˆ·ä½•æ—¶éœ€è¦ç½‘ç»œ</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æå‰å»ºç«‹ç½‘ç»œï¼Œé¿å…é¢‘ç¹å¼€å…³</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">æ¯”åå¤å¼€å…³æ›´çœç”µ</span>


<span class="hljs-string">ä¼˜åŒ–</span> <span class="hljs-attr">4:</span> <span class="hljs-string">æé«˜ç½‘ç»œç¨³å®šæ€§</span>
<span class="hljs-string">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

<span class="hljs-string">a)</span> <span class="hljs-string">å¢å¼ºå‹æ¡æ‰‹</span>
</code></pre>
<p>åœ¨ä¸ç¨³å®šç½‘ç»œä¸­ï¼š
â”œâ”€ é‡è¯•æœºåˆ¶ï¼ˆTCP fast openï¼‰
â”œâ”€ æ–­çº¿é‡è¿ï¼ˆå¿«é€Ÿæ¢å¤ï¼‰
â”œâ”€ è¯·æ±‚é‡è¯•ï¼ˆè‡ªåŠ¨æ¢å¤ï¼‰
â””â”€ ç”¨æˆ·æ„Ÿå—åˆ°çš„ä¸­æ–­æ›´çŸ­</p>
<pre><code class="hljs language-css" lang="css">
<span class="hljs-selector-tag">b</span>) å¤šç½‘ç»œç»‘å®š
</code></pre>
<p>å…³é”®è¿æ¥ä½¿ç”¨ä¸¤ä¸ªç½‘ç»œï¼š
â”œâ”€ WiFi å’Œ LTE åŒæ—¶ç”¨
â”œâ”€ ä»»ä¸€ç½‘ç»œæ•…éšœè‡ªåŠ¨åˆ‡æ¢
â”œâ”€ æ— ä¸­æ–­ï¼ˆè¶…çº§ç”¨æˆ·ä½“éªŒï¼‰</p>
<pre><code class="hljs language-r" lang="r">
<span class="hljs-built_in">c</span><span class="hljs-punctuation">)</span> ç¼–ç ä¼˜åŒ–
</code></pre>
<p>åœ¨å·®ç½‘ç»œä¸­ï¼š
â”œâ”€ æ›´å¼ºçš„çº é”™ç 
â”œâ”€ æ›´é¢‘ç¹çš„æ ¡éªŒ
â”œâ”€ è‡ªåŠ¨ç ç‡è°ƒæ•´
â””â”€ å‡å°‘é‡ä¼ </p>
<pre><code class="hljs"/></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Navigation3ã€‘åŸºç¡€å…¥é—¨]]></title>    <link>https://juejin.cn/post/7603359026712133642</link>    <guid>https://juejin.cn/post/7603359026712133642</guid>    <pubDate>2026-02-06T15:12:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603359026712133642" data-draft-id="7603352117640200201" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Navigation3ã€‘åŸºç¡€å…¥é—¨"/> <meta itemprop="keywords" content="Composer"/> <meta itemprop="datePublished" content="2026-02-06T15:12:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BUGé›†ç»“è€…"/> <meta itemprop="url" content="https://juejin.cn/user/131597123982871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Navigation3ã€‘åŸºç¡€å…¥é—¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597123982871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BUGé›†ç»“è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:12:42.000Z" title="Fri Feb 06 2026 15:12:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¯å¢ƒé…ç½®</h2>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fguide%2Fnavigation%2Fnavigation-3%2Fget-started%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/guide/navigation/navigation-3/get-started?hl=zh-cn" ref="nofollow noopener noreferrer">å®˜æ–¹æ•™ç¨‹æ–‡æ¡£</a></p>
</blockquote>
<h2 data-id="heading-1">APIä»‹ç»</h2>
<p>Navigation3åŒ…å«é‡è¦é…ç½®å¯¼èˆªå…¥å£<code>NavDisplay</code>ï¼Œåº”ç”¨äºå…¨å±€é…ç½®é¡µé¢å¯¼èˆªã€é¡µé¢å †æ ˆç®¡ç†ã€é¡µé¢åˆ‡æ¢åŠ¨ç”»ç®¡ç†ç­‰ç­‰ï¼Œå…·ä½“å‡½æ•°å£°æ˜ä»£ç å¦‚ä¸‹ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroidx%2Fplatform%2Fframeworks%2Fsupport%2F%2B%2Fandroidx-main%3Anavigation3%2Fnavigation3-ui%2Fsrc%2FcommonMain%2Fkotlin%2Fandroidx%2Fnavigation3%2Fui%2FNavDisplay.kt%3Fhl%3Dzh-cn" target="_blank" title="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:navigation3/navigation3-ui/src/commonMain/kotlin/androidx/navigation3/ui/NavDisplay.kt?hl=zh-cn" ref="nofollow noopener noreferrer">é“¾æ¥ï¼šNavDisplayå‡½æ•°æºç ä½ç½®</a>ï¼‰ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">NavDisplay</span><span class="hljs-params">(
    backStack: <span class="hljs-type">List</span>&lt;<span class="hljs-type">T</span>&gt;,
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    contentAlignment: <span class="hljs-type">Alignment</span> = Alignment.TopStart,
    onBack: () -&gt; <span class="hljs-type">Unit</span> = {
        <span class="hljs-keyword">if</span> (backStack <span class="hljs-keyword">is</span> MutableList&lt;T&gt;)</span></span> {
            backStack.removeLastOrNull()
        }
    },
    entryDecorators: List&lt;NavEntryDecorator&lt;T&gt;&gt; =
        listOf(rememberSaveableStateHolderNavEntryDecorator()),
    sceneStrategy: SceneStrategy&lt;T&gt; = SinglePaneSceneStrategy(),
    sizeTransform: SizeTransform? = <span class="hljs-literal">null</span>,
    transitionSpec: AnimatedContentTransitionScope&lt;Scene&lt;T&gt;&gt;.() -&gt; ContentTransform =
        defaultTransitionSpec(),
    popTransitionSpec: AnimatedContentTransitionScope&lt;Scene&lt;T&gt;&gt;.() -&gt; ContentTransform =
        defaultPopTransitionSpec(),
    predictivePopTransitionSpec:
        AnimatedContentTransitionScope&lt;Scene&lt;T&gt;&gt;.(
            <span class="hljs-meta">@NavigationEvent</span>.SwipeEdge <span class="hljs-built_in">Int</span>
        ) -&gt; ContentTransform =
        defaultPredictivePopTransitionSpec(),
    entryProvider: (key: T) -&gt; NavEntry&lt;T&gt;,
)
</code></pre>
<ul>
<li>å‡½æ•°åŸºç¡€å‚æ•°è¯´æ˜
<ul>
<li><code>backStack</code> æ˜¯ä¸€ä¸ªListé›†åˆï¼Œç”¨äºç®¡ç†é¡µé¢å †æ ˆã€‚å¯¹é›†åˆè¿›è¡Œå¢åˆ æŸ¥æ”¹ä¹‹åï¼Œ<code>Nav3</code>ä¼šè‡ªåŠ¨çš„åˆ‡æ¢é¡µé¢</li>
<li><code>onBack</code> ç³»ç»Ÿè¿”å›é”®å›è°ƒå‡½æ•°</li>
<li><code>entryProvider</code> ç”¨äºå£°æ˜å †æ ˆä¸­çš„Keyä¸é¡µé¢é—´çš„æ˜ å°„å…³ç³»</li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">æ¡ˆä¾‹</h2>
<blockquote>
<p>è¦ä» RouteA å¯¼èˆªåˆ° RouteBï¼Œæˆ‘ä»¬åªéœ€å°† RouteB çš„å®ä¾‹æ·»åŠ åˆ°è¿”å›æ ˆä¸­ã€‚è¯¥ id ä½œä¸ºå‚æ•°ä¼ é€’ç»™ RouteBdata ç±»ã€‚</p>
</blockquote>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> RouteA

<span class="hljs-keyword">private</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouteB</span>(<span class="hljs-keyword">val</span> id: String)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicActivity</span> : <span class="hljs-type">ComponentActivity</span>() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        setEdgeToEdgeConfig()
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContent {
            <span class="hljs-keyword">val</span> backStack = remember { mutableStateListOf&lt;Any&gt;(RouteA) }

            NavDisplay(
                backStack = backStack,
                onBack = { backStack.removeLastOrNull() },
                entryProvider = { key -&gt;
                    <span class="hljs-keyword">when</span> (key) {
                        <span class="hljs-keyword">is</span> RouteA -&gt; NavEntry(key) {
                            ContentGreen(<span class="hljs-string">"Welcome to Nav3"</span>) {
                                Button(onClick = dropUnlessResumed {
                                    backStack.add(RouteB(<span class="hljs-string">"123"</span>))
                                }) {
                                    Text(<span class="hljs-string">"Click to navigate"</span>)
                                }
                            }
                        }

                        <span class="hljs-keyword">is</span> RouteB -&gt; NavEntry(key) {
                            ContentBlue(<span class="hljs-string">"Route id: <span class="hljs-subst">${key.id}</span> "</span>)
                        }

                        <span class="hljs-keyword">else</span> -&gt; {
                            error(<span class="hljs-string">"Unknown route: <span class="hljs-variable">$key</span>"</span>)
                        }
                    }
                }
            )
        }
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[Navigation3]æŒä¹…åŒ–å †æ ˆ]]></title>    <link>https://juejin.cn/post/7603359026712182794</link>    <guid>https://juejin.cn/post/7603359026712182794</guid>    <pubDate>2026-02-06T15:29:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603359026712182794" data-draft-id="7603575763786711066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[Navigation3]æŒä¹…åŒ–å †æ ˆ"/> <meta itemprop="keywords" content="Composer"/> <meta itemprop="datePublished" content="2026-02-06T15:29:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BUGé›†ç»“è€…"/> <meta itemprop="url" content="https://juejin.cn/user/131597123982871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [Navigation3]æŒä¹…åŒ–å †æ ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597123982871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BUGé›†ç»“è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:29:09.000Z" title="Fri Feb 06 2026 15:29:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p><code>Nav3</code>å°†å¯¼èˆªå †æ ˆé›†åˆäº¤ç”±å¼€å‘è€…è®¾ç½®ï¼Œåœ¨ä¸€äº›æç«¯æ¡ä»¶ä¸‹ï¼Œæ¯”å¦‚Activityé…ç½®æ›´æ”¹ã€åº”ç”¨è¿›ç¨‹è¢«æ€æ­»ï¼Œå‡å¯èƒ½ä¼šå¯¼è‡´è®¾ç½®å †æ ˆæ•°æ®çš„ä¸¢å¤±ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æ„å¤–ï¼Œåˆ™éœ€è¦ä¸ºå †æ ˆè¿›è¡ŒæŒä¹…åŒ–é…ç½®</p>
<h2 data-id="heading-1">è§£å†³æ–¹æ¡ˆ</h2>
<ul>
<li>
<h3 data-id="heading-2"><code>rememberNavBackStack</code>å…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼Œå°±ä¸è¿‡å¤šé˜è¿°ã€‚</h3>
</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Serializable</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> RouteA : NavKey

<span class="hljs-meta">@Serializable</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouteB</span>(<span class="hljs-keyword">val</span> id: String) : NavKey

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicSaveableActivity</span> : <span class="hljs-type">ComponentActivity</span>() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        setEdgeToEdgeConfig()
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContent {
            <span class="hljs-keyword">val</span> backStack = rememberNavBackStack(RouteA)

            NavDisplay(
                backStack = backStack,
                onBack = { backStack.removeLastOrNull() },
                entryProvider = { key -&gt;
                    <span class="hljs-keyword">when</span> (key) {
                        <span class="hljs-keyword">is</span> RouteA -&gt; NavEntry(key) {
                            ContentGreen(<span class="hljs-string">"Welcome to Nav3"</span>) {
                                Button(onClick = dropUnlessResumed {
                                    backStack.add(RouteB(<span class="hljs-string">"123"</span>))
                                }) {
                                    Text(<span class="hljs-string">"Click to navigate"</span>)
                                }
                            }
                        }

                        <span class="hljs-keyword">is</span> RouteB -&gt; NavEntry(key) {
                            ContentBlue(<span class="hljs-string">"Route id: <span class="hljs-subst">${key.id}</span> "</span>)
                        }

                        <span class="hljs-keyword">else</span> -&gt; {
                            error(<span class="hljs-string">"Unknown route: <span class="hljs-variable">$key</span>"</span>)
                        }
                    }
                }
            )
        }
    }
}
</code></pre>
<h2 data-id="heading-3">å‚è€ƒèµ„æ–™å¦‚ä¸‹ï¼š</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroidx%2Fplatform%2Fframeworks%2Fsupport%2F%2B%2Fandroidx-main%3Anavigation3%2Fnavigation3-runtime%2Fsrc%2FcommonMain%2Fkotlin%2Fandroidx%2Fnavigation3%2Fruntime%2FRememberNavBackStack.kt%3Fhl%3Dzh-cn" target="_blank" title="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:navigation3/navigation3-runtime/src/commonMain/kotlin/androidx/navigation3/runtime/RememberNavBackStack.kt?hl=zh-cn" ref="nofollow noopener noreferrer">å®˜æ–¹æºç </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fguide%2Fnavigation%2Fnavigation-3%2Fsave-state%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/guide/navigation/navigation-3/save-state?hl=zh-cn" ref="nofollow noopener noreferrer">å®˜æ–¹æ•™ç¨‹</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw é…ç½®é£ä¹¦æ•™ç¨‹ï¼ˆç›´æ¥æ›´æ–°ï¼Œä¸å«å®‰è£…openclaw]]></title>    <link>https://juejin.cn/post/7603352117639725065</link>    <guid>https://juejin.cn/post/7603352117639725065</guid>    <pubDate>2026-02-06T10:58:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603352117639725065" data-draft-id="7603376587652382770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw é…ç½®é£ä¹¦æ•™ç¨‹ï¼ˆç›´æ¥æ›´æ–°ï¼Œä¸å«å®‰è£…openclaw"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-06T10:58:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·557203665058"/> <meta itemprop="url" content="https://juejin.cn/user/2913054520778011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw é…ç½®é£ä¹¦æ•™ç¨‹ï¼ˆç›´æ¥æ›´æ–°ï¼Œä¸å«å®‰è£…openclaw
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2913054520778011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·557203665058
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:58:05.000Z" title="Fri Feb 06 2026 10:58:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Fu%2Fcarlos_star" target="_blank" title="https://linux.do/u/carlos_star" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3065d46c908d48d0844a59e1682b34d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NTU3MjAzNjY1MDU4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980285&amp;x-signature=0m4qiswl1BSrG6IH9uquuKr4cOs%3D" alt="" loading="lazy"/></a></p>
<blockquote>
<p>æœ¬æ–‡æ¡£ä»æ›´æ–° OpenClaw å¼€å§‹ï¼Œä»‹ç»å¦‚ä½•å°† OpenClaw æ¥å…¥é£ä¹¦æœºå™¨äººã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-openclaw-2" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-openclaw-2" ref="nofollow noopener noreferrer"/>ä¸€ã€æ›´æ–° OpenClaw</h2>
<pre><code class="hljs language-bash" lang="bash">openclaw update
</code></pre>
<blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/629ee9bf6f384e488d735dadf40919cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NTU3MjAzNjY1MDU4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980285&amp;x-signature=CBxjDHSHUcsauaYUDc3nMlB%2B0m4%3D" alt=":warning:" loading="lazy"/> å¦‚æœå·²ç»æ¥å…¥è¿‡ç¬¬ä¸‰æ–¹é£ä¹¦æ’ä»¶ï¼Œéœ€è¦å…ˆåˆ é™¤æ—§é…ç½®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">rm</span> -rf ~/.openclaw/extensions/feishu
</code></pre>
<p>å¦‚æœæ²¡æœ‰æ¥å…¥è¿‡ï¼Œå¿½ç•¥æ­¤æ­¥éª¤ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-3" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-3" ref="nofollow noopener noreferrer"/>äºŒã€åˆ›å»ºé£ä¹¦æœºå™¨äºº</h2>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-21-4" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-21-4" ref="nofollow noopener noreferrer"/>2.1 åˆ›å»ºåº”ç”¨</h3>
<ol>
<li>è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.feishu.cn%2Fapp" target="_blank" title="https://open.feishu.cn/app" ref="nofollow noopener noreferrer">é£ä¹¦å¼€å‘è€…åå°</a></li>
<li>ç‚¹å‡»ã€Œåˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨ã€</li>
<li>å¡«å†™åº”ç”¨åç§°å’Œæè¿°ï¼ˆéšæ„å¡«å†™å³å¯ï¼‰</li>
</ol>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-22-5" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-22-5" ref="nofollow noopener noreferrer"/>2.2 æ·»åŠ æœºå™¨äººèƒ½åŠ›</h3>
<ol>
<li>è¿›å…¥åº”ç”¨ï¼Œé€‰æ‹©ã€Œæ·»åŠ åº”ç”¨èƒ½åŠ›ã€</li>
<li>åœ¨å³ä¾§ã€ŒæŒ‰èƒ½åŠ›æ·»åŠ ã€èœå•ä¸­æ‰¾åˆ°ã€Œæœºå™¨äººã€</li>
<li>ç‚¹å‡»æ·»åŠ </li>
</ol>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-23-6" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-23-6" ref="nofollow noopener noreferrer"/>2.3 å¼€é€šæƒé™</h3>
<p>è¿›å…¥ã€Œæƒé™ç®¡ç†ã€ï¼Œå¼€é€šä»¥ä¸‹æƒé™ï¼š<br/>
åœ¨â€œæƒé™â€é¡µé¢ï¼Œç‚¹å‡»â€œæ‰¹é‡å¯¼å…¥â€å¹¶ç²˜è´´ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"scopes"</span>: {
    <span class="hljs-string">"tenant"</span>: [
      <span class="hljs-string">"aily:file:read"</span>,
      <span class="hljs-string">"aily:file:write"</span>,
      <span class="hljs-string">"application:application.app_message_stats.overview:readonly"</span>,
      <span class="hljs-string">"application:application:self_manage"</span>,
      <span class="hljs-string">"application:bot.menu:write"</span>,
      <span class="hljs-string">"contact:user.employee_id:readonly"</span>,
      <span class="hljs-string">"corehr:file:download"</span>,
      <span class="hljs-string">"event:ip_list"</span>,
      <span class="hljs-string">"im:chat.access_event.bot_p2p_chat:read"</span>,
      <span class="hljs-string">"im:chat.members:bot_access"</span>,
      <span class="hljs-string">"im:message"</span>,
      <span class="hljs-string">"im:message.group_at_msg:readonly"</span>,
      <span class="hljs-string">"im:message.p2p_msg:readonly"</span>,
      <span class="hljs-string">"im:message:readonly"</span>,
      <span class="hljs-string">"im:message:send_as_bot"</span>,
      <span class="hljs-string">"im:resource"</span>
    ],
    <span class="hljs-string">"user"</span>: [<span class="hljs-string">"aily:file:read"</span>, <span class="hljs-string">"aily:file:write"</span>, <span class="hljs-string">"im:chat.access_event.bot_p2p_chat:read"</span>]
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-openclaw-7" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-openclaw-7" ref="nofollow noopener noreferrer"/>ä¸‰ã€é…ç½® OpenClaw</h2>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-31-8" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-31-8" ref="nofollow noopener noreferrer"/>3.1 æ·»åŠ é£ä¹¦æ¸ é“</h3>
<pre><code class="hljs language-bash" lang="bash">openclaw channels add
</code></pre>
<p>åœ¨åˆ—è¡¨ä¸­é€‰æ‹© <code>feishu</code>ã€‚</p>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-32-9" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-32-9" ref="nofollow noopener noreferrer"/>3.2 å¤„ç†å·²æœ‰é…ç½®</h3>
<p>å¦‚æœå‡ºç° <code>Feishu already configured</code>ï¼Œé€‰æ‹©ã€Œä¿®æ”¹é…ç½®ã€ã€‚</p>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-33-10" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-33-10" ref="nofollow noopener noreferrer"/>3.3 é…ç½®å‚æ•°</h3>
<p>æŒ‰æç¤ºä¾æ¬¡é…ç½®ï¼š</p>

























<table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Feishu account</td><td>é€‰æ‹© <code>default</code></td></tr><tr><td>domain</td><td>æ ¹æ®åŒºåŸŸé€‰æ‹©ï¼ˆå›½å†…é€‰ <code>feishu</code>ï¼Œå›½é™…é€‰ <code>lark</code>ï¼‰</td></tr><tr><td>App ID</td><td>åœ¨é£ä¹¦å¼€å‘è€…åå°ã€Œå‡­æ®ä¸åŸºç¡€ä¿¡æ¯ã€é¡µé¢è·å–</td></tr><tr><td>App Secret</td><td>åŒä¸Š</td></tr></tbody></table>
<p>å¡«å†™å®Œæˆåé€‰æ‹© <code>finish</code>ã€‚</p>
<h3 data-id="heading-9"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-34-11" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-34-11" ref="nofollow noopener noreferrer"/>3.4 åç»­é…ç½®é€‰é¡¹</h3>
<pre><code class="hljs language-bash" lang="bash">Configure DM access policies now? â†’ é€‰ No
Add display names <span class="hljs-keyword">for</span> these accounts? â†’ é€‰ No
</code></pre>
<h3 data-id="heading-10"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-35-gateway-12" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-35-gateway-12" ref="nofollow noopener noreferrer"/>3.5 é‡å¯ Gateway</h3>
<pre><code class="hljs language-bash" lang="bash">openclaw gateway restart
</code></pre>
<hr/>
<h2 data-id="heading-11"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-13" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-13" ref="nofollow noopener noreferrer"/>å››ã€é…ç½®é£ä¹¦äº‹ä»¶è®¢é˜…</h2>
<p>å›åˆ°é£ä¹¦å¼€å‘è€…åå°ï¼š</p>
<ol>
<li>é€‰æ‹©ã€Œäº‹ä»¶ä¸å›è°ƒã€</li>
<li>æ·»åŠ äº‹ä»¶ï¼š<code>im.message.receive_v1</code></li>
<li>è®¢é˜…æ–¹å¼é€‰æ‹©ã€Œä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶ã€</li>
</ol>
<hr/>
<h2 data-id="heading-12"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-14" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-14" ref="nofollow noopener noreferrer"/>äº”ã€éªŒè¯</h2>
<p>ç°åœ¨å¯ä»¥åœ¨é£ä¹¦ä¸­ä½¿ç”¨ OpenClaw äº†ï¼</p>
<p>æ‰¾åˆ°ä½ åˆ›å»ºçš„æœºå™¨äººåº”ç”¨ï¼Œå‘é€æ¶ˆæ¯æµ‹è¯•æ˜¯å¦æ­£å¸¸å“åº”ã€‚</p>
<hr/>
<h2 data-id="heading-13"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-15" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-15" ref="nofollow noopener noreferrer"/>å…­ã€å¸¸ç”¨å‘½ä»¤</h2>
<pre><code class="hljs language-bash" lang="bash">openclaw update


openclaw channels add


openclaw gateway restart


openclaw gateway status


openclaw logs --follow
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¼ä¸šå¾®ä¿¡æ¥å£åœ¨ç¾å¤‡æ¶æ„ä¸ä¸šåŠ¡è¿ç»­æ€§ä¿éšœä¸­çš„å®è·µ]]></title>    <link>https://juejin.cn/post/7603575399255146536</link>    <guid>https://juejin.cn/post/7603575399255146536</guid>    <pubDate>2026-02-06T13:08:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575399255146536" data-draft-id="7603347438013939747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ä¼ä¸šå¾®ä¿¡æ¥å£åœ¨ç¾å¤‡æ¶æ„ä¸ä¸šåŠ¡è¿ç»­æ€§ä¿éšœä¸­çš„å®è·µ"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-06T13:08:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bot555666"/> <meta itemprop="url" content="https://juejin.cn/user/1092275002677466"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ä¼ä¸šå¾®ä¿¡æ¥å£åœ¨ç¾å¤‡æ¶æ„ä¸ä¸šåŠ¡è¿ç»­æ€§ä¿éšœä¸­çš„å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1092275002677466/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bot555666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T13:08:01.000Z" title="Fri Feb 06 2026 13:08:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¼ä¸šå¾®ä¿¡æ¥å£åœ¨ç¾å¤‡æ¶æ„ä¸ä¸šåŠ¡è¿ç»­æ€§ä¿éšœä¸­çš„å®è·µ</h2>
<p>åœ¨ä¼ä¸šå…³é”®ä¸šåŠ¡ç³»ç»Ÿæ·±åº¦é›†æˆä¼ä¸šå¾®ä¿¡çš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•ç¡®ä¿å½“ä¼ä¸šå¾®ä¿¡æœåŠ¡æœ¬èº«æˆ–é›†æˆé“¾è·¯å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ ¸å¿ƒä¸šåŠ¡æµç¨‹ä»èƒ½æŒç»­è¿è¡Œï¼Œæˆä¸ºä¼ä¸šæ¶æ„è®¾è®¡çš„é‡è¦è€ƒé‡ã€‚æœ¬æ–‡ç³»ç»Ÿæ€§åœ°æ¢è®¨åŸºäºä¼ä¸šå¾®ä¿¡æ¥å£æ„å»ºçš„é«˜å¯ç”¨ç¾å¤‡æ¶æ„ï¼Œå®ç°ä¸šåŠ¡è¿ç»­æ€§çš„å¤šå±‚çº§ä¿éšœã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ä¼ä¸šå¾®ä¿¡é›†æˆåœºæ™¯çš„ç¾å¤‡æŒ‘æˆ˜åˆ†æ</h3>
<p>ä¼ä¸šå¾®ä¿¡ä½œä¸ºé€šä¿¡æ¢çº½ï¼Œå…¶å¼‚å¸¸çŠ¶æ€ä¼šå¯¹ä¾èµ–å®ƒçš„ä¸šåŠ¡ç³»ç»Ÿäº§ç”Ÿè¿é”å½±å“ï¼Œä¸»è¦é£é™©åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>æœåŠ¡ç«¯å¯ç”¨æ€§é£é™©</strong>ï¼šä¼ä¸šå¾®ä¿¡å¹³å°æœåŠ¡ä¸´æ—¶ä¸å¯ç”¨æˆ–ç»´æŠ¤ï¼Œå¯¼è‡´APIè°ƒç”¨å¤±è´¥ã€‚</li>
<li><strong>ç½‘ç»œåˆ†åŒºé£é™©</strong>ï¼šä¼ä¸šç½‘ç»œä¸è…¾è®¯äº‘ä¹‹é—´çš„ç½‘ç»œè¿æ¥ä¸­æ–­ã€‚</li>
<li><strong>å‡­è¯å¤±æ•ˆé£é™©</strong>ï¼šAccess Tokené›†ä¸­å¤±æ•ˆä¸”æ— æ³•åŠæ—¶åˆ·æ–°ã€‚</li>
<li><strong>é…é¢è€—å°½é£é™©</strong>ï¼šä¸šåŠ¡é«˜å³°è§¦å‘APIè°ƒç”¨é¢‘ç‡é™åˆ¶ã€‚</li>
<li><strong>æ•°æ®ä¸€è‡´æ€§é£é™©</strong>ï¼šä¸»å¤‡ç¯å¢ƒåˆ‡æ¢å¯¼è‡´æ¶ˆæ¯é‡å¤æˆ–ä¸¢å¤±ã€‚</li>
</ol>
<h3 data-id="heading-2">äºŒã€å¤šå±‚æ¬¡ç¾å¤‡æ¶æ„è®¾è®¡</h3>
<p>è®¾è®¡ä¸€ä¸ªä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„å®Œæ•´ç¾å¤‡ä½“ç³»ï¼Œé‡‡ç”¨"åˆ†çº§é™çº§ã€å¹³æ»‘åˆ‡æ¢"çš„åŸåˆ™ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[ä¸šåŠ¡åº”ç”¨å±‚]</span>
â”œâ”€â”€ ä¸»ç”¨é€šé“ï¼šä¼ä¸šå¾®ä¿¡API (è…¾è®¯äº‘)
â”œâ”€â”€ å¤‡ç”¨é€šé“<span class="hljs-number">1</span>ï¼šä¼ä¸šå¾®ä¿¡ç§æœ‰åŒ–éƒ¨ç½²
â”œâ”€â”€ å¤‡ç”¨é€šé“<span class="hljs-number">2</span>ï¼šæ··åˆé€šä¿¡ç½‘å…³ï¼ˆçŸ­ä¿¡/é‚®ä»¶/é’‰é’‰ç­‰ï¼‰
â””â”€â”€ æœ¬åœ°åº”æ€¥é€šé“ï¼šæ¶ˆæ¯é˜Ÿåˆ—æŒä¹…åŒ–

<span class="hljs-selector-attr">[æµé‡è°ƒåº¦å±‚]</span>
â”œâ”€â”€ å¥åº·æ£€æŸ¥ä¸æ•…éšœæ£€æµ‹
â”œâ”€â”€ æ™ºèƒ½è·¯ç”±å†³ç­–å¼•æ“
â””â”€â”€ æµé‡åˆ‡æ¢æ§åˆ¶å™¨

<span class="hljs-selector-attr">[æ•°æ®åŒæ­¥å±‚]</span>
â”œâ”€â”€ åŒæ´»æ•°æ®åŒæ­¥
â”œâ”€â”€ çŠ¶æ€ä¸€è‡´æ€§ä¿éšœ
â””â”€â”€ åˆ‡æ¢åæ•°æ®ä¿®å¤
</code></pre>
<h3 data-id="heading-3">ä¸‰ã€æ ¸å¿ƒç¾å¤‡æŠ€æœ¯å®ç°</h3>
<h4 data-id="heading-4">1. å¤šé€šé“å®¢æˆ·ç«¯ä¸æ™ºèƒ½è·¯ç”±</h4>
<p>æ„å»ºå…·å¤‡è‡ªåŠ¨æ•…éšœåˆ‡æ¢èƒ½åŠ›çš„å®¢æˆ·ç«¯SDKï¼Œæ”¯æŒå¤šé€šé“ä¼˜å…ˆçº§é…ç½®ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ”¯æŒå¤šé€šé“ä¸è‡ªåŠ¨æ•…éšœåˆ‡æ¢çš„ä¼ä¸šå¾®ä¿¡å®¢æˆ·ç«¯</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DisasterRecoveryWeComClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WeComClient</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;MessageChannel&gt; channels;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HealthChecker healthChecker;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CircuitBreaker circuitBreaker;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MessageBuffer persistentBuffer;
    
    <span class="hljs-comment">// é€šé“ä¼˜å…ˆçº§é…ç½®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DisasterRecoveryWeComClient</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.channels = Arrays.asList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrimaryWeComChannel</span>(),      <span class="hljs-comment">// ä¸»é€šé“ï¼šä¼ä¸šå¾®ä¿¡å…¬æœ‰äº‘</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivateWeComChannel</span>(),      <span class="hljs-comment">// å¤‡é€šé“1ï¼šä¼ä¸šå¾®ä¿¡ç§æœ‰åŒ–</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">HybridNotificationChannel</span>(), <span class="hljs-comment">// å¤‡é€šé“2ï¼šæ··åˆé€šçŸ¥é€šé“</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersistentQueueChannel</span>()     <span class="hljs-comment">// æœ€ç»ˆå¤‡é€‰ï¼šæœ¬åœ°æŒä¹…åŒ–</span>
        );
        
        <span class="hljs-built_in">this</span>.healthChecker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompositeHealthChecker</span>();
        <span class="hljs-built_in">this</span>.circuitBreaker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resilience4jCircuitBreaker</span>();
        <span class="hljs-built_in">this</span>.persistentBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaMessageBuffer</span>();
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SendResult <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(WeComMessage message)</span> {
        <span class="hljs-comment">// 1. åŸºç¡€æ ¡éªŒä¸æ¶ˆæ¯å‡†å¤‡</span>
        validateMessage(message);
        <span class="hljs-type">EnrichedMessage</span> <span class="hljs-variable">enriched</span> <span class="hljs-operator">=</span> enrichMessage(message);
        
        <span class="hljs-comment">// 2. æŒä¹…åŒ–åˆ°æœ¬åœ°ç¼“å†²åŒºï¼ˆç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">bufferId</span> <span class="hljs-operator">=</span> persistentBuffer.store(enriched);
        
        <span class="hljs-comment">// 3. å°è¯•é€šè¿‡å¯ç”¨é€šé“å‘é€</span>
        <span class="hljs-keyword">for</span> (MessageChannel channel : getAvailableChannels()) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ä½¿ç”¨ç†”æ–­å™¨ä¿æŠ¤æ¯ä¸ªé€šé“</span>
                <span class="hljs-type">SendResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> circuitBreaker.executeSupplier(
                    () -&gt; attemptSendThroughChannel(channel, enriched)
                );
                
                <span class="hljs-keyword">if</span> (result.isSuccess()) {
                    <span class="hljs-comment">// å‘é€æˆåŠŸï¼Œæ ‡è®°ç¼“å†²åŒºæ¶ˆæ¯ä¸ºå·²å¤„ç†</span>
                    persistentBuffer.markAsSent(bufferId, channel.getType());
                    <span class="hljs-keyword">return</span> result;
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.warn(<span class="hljs-string">"é€šé“ {} å‘é€å¤±è´¥: {}"</span>, channel.getType(), e.getMessage());
                <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// å°è¯•ä¸‹ä¸€ä¸ªé€šé“</span>
            }
        }
        
        <span class="hljs-comment">// 4. æ‰€æœ‰é€šé“å‡å¤±è´¥ï¼Œè¿”å›é™çº§ç»“æœ</span>
        <span class="hljs-keyword">return</span> SendResult.degraded(
            <span class="hljs-string">"æ¶ˆæ¯å·²ä¿å­˜åˆ°æœ¬åœ°ç¼“å†²åŒºï¼Œå°†åœ¨æœåŠ¡æ¢å¤åé‡è¯•"</span>,
            bufferId
        );
    }
    
    <span class="hljs-keyword">private</span> List&lt;MessageChannel&gt; <span class="hljs-title function_">getAvailableChannels</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> channels.stream()
            .filter(channel -&gt; {
                <span class="hljs-comment">// æ£€æŸ¥é€šé“å¥åº·çŠ¶æ€</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">isHealthy</span> <span class="hljs-operator">=</span> healthChecker.isHealthy(channel);
                
                <span class="hljs-comment">// æ£€æŸ¥é€šé“æƒé‡é…ç½®ï¼ˆå¯åŠ¨æ€è°ƒæ•´ï¼‰</span>
                <span class="hljs-type">int</span> <span class="hljs-variable">weight</span> <span class="hljs-operator">=</span> channelWeightService.getWeight(channel.getType());
                
                <span class="hljs-comment">// æ£€æŸ¥ä¸šåŠ¡ä¼˜å…ˆçº§åŒ¹é…</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">matchesPriority</span> <span class="hljs-operator">=</span> currentMessagePriority &lt;= channel.getMaxPriority();
                
                <span class="hljs-keyword">return</span> isHealthy &amp;&amp; weight &gt; <span class="hljs-number">0</span> &amp;&amp; matchesPriority;
            })
            .sorted(Comparator.comparingInt(MessageChannel::getPriority))
            .collect(Collectors.toList());
    }
    
    <span class="hljs-keyword">private</span> SendResult <span class="hljs-title function_">attemptSendThroughChannel</span><span class="hljs-params">(MessageChannel channel, EnrichedMessage message)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        
        <span class="hljs-comment">// é€šé“ç‰¹å®šçš„é€‚é…è½¬æ¢</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">channelMessage</span> <span class="hljs-operator">=</span> channel.adaptMessage(message);
        
        <span class="hljs-comment">// æ‰§è¡Œå‘é€ï¼ˆæ”¯æŒè¶…æ—¶æ§åˆ¶ï¼‰</span>
        <span class="hljs-type">ChannelResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> channel.send(channelMessage, <span class="hljs-number">5000</span>); <span class="hljs-comment">// 5ç§’è¶…æ—¶</span>
        
        <span class="hljs-comment">// è®°å½•è¯¦ç»†æŒ‡æ ‡</span>
        metrics.recordChannelAttempt(
            channel.getType(),
            response.isSuccess(),
            System.currentTimeMillis() - startTime
        );
        
        <span class="hljs-keyword">return</span> SendResult.fromChannelResponse(response);
    }
    
    <span class="hljs-comment">// åå°ä»»åŠ¡ï¼šå¤„ç†ç¼“å†²åŒºä¸­æœªå‘é€çš„æ¶ˆæ¯</span>
    <span class="hljs-meta">@Scheduled(fixedDelay = 30000)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">retryBufferedMessages</span><span class="hljs-params">()</span> {
        List&lt;BufferedMessage&gt; failedMessages = persistentBuffer.getFailedMessages(<span class="hljs-number">100</span>);
        
        <span class="hljs-keyword">for</span> (BufferedMessage buffered : failedMessages) {
            <span class="hljs-comment">// æ£€æŸ¥åŸå§‹æ¶ˆæ¯æ˜¯å¦ä»éœ€è¦å‘é€ï¼ˆé¿å…è¿‡æ—¶æ¶ˆæ¯ï¼‰</span>
            <span class="hljs-keyword">if</span> (isMessageStillValid(buffered)) {
                <span class="hljs-comment">// é‡æ–°å°è¯•å‘é€</span>
                sendMessage(buffered.getOriginalMessage());
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// æ¶ˆæ¯å·²è¿‡æœŸï¼Œç§»è‡³æ­»ä¿¡é˜Ÿåˆ—</span>
                persistentBuffer.moveToDeadLetter(buffered.getId());
            }
        }
    }
}

<span class="hljs-comment">// æ··åˆé€šçŸ¥é€šé“å®ç°ï¼šå½“ä¼ä¸šå¾®ä¿¡ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨é™çº§åˆ°å…¶ä»–é€šçŸ¥æ–¹å¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HybridNotificationChannel</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessageChannel</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EmailService emailService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SmsService smmsService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DingTalkService dingTalkService;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ChannelResponse <span class="hljs-title function_">send</span><span class="hljs-params">(Object message, <span class="hljs-type">long</span> timeoutMs)</span> {
        <span class="hljs-type">WeComMessage</span> <span class="hljs-variable">wecomMsg</span> <span class="hljs-operator">=</span> (WeComMessage) message;
        
        <span class="hljs-comment">// æ ¹æ®æ¶ˆæ¯ç±»å‹å’Œæ¥æ”¶äººé€‰æ‹©åˆé€‚çš„é™çº§æ¸ é“</span>
        <span class="hljs-keyword">if</span> (wecomMsg.getMsgType() == MsgType.TEXT) {
            <span class="hljs-comment">// æ–‡æœ¬æ¶ˆæ¯ä¼˜å…ˆå°è¯•çŸ­ä¿¡</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">mobile</span> <span class="hljs-operator">=</span> getUserMobile(wecomMsg.getToUser());
            <span class="hljs-keyword">if</span> (mobile != <span class="hljs-literal">null</span>) {
                <span class="hljs-type">SmsResult</span> <span class="hljs-variable">smsResult</span> <span class="hljs-operator">=</span> smsService.sendSms(
                    mobile,
                    formatForSms(wecomMsg.getContent())
                );
                <span class="hljs-keyword">if</span> (smsResult.isSuccess()) {
                    <span class="hljs-keyword">return</span> ChannelResponse.success(
                        <span class="hljs-string">"sent_via_sms"</span>,
                        smsResult.getMessageId()
                    );
                }
            }
            
            <span class="hljs-comment">// çŸ­ä¿¡å¤±è´¥å°è¯•é‚®ä»¶</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">email</span> <span class="hljs-operator">=</span> getUserEmail(wecomMsg.getToUser());
            <span class="hljs-keyword">if</span> (email != <span class="hljs-literal">null</span>) {
                <span class="hljs-type">EmailResult</span> <span class="hljs-variable">emailResult</span> <span class="hljs-operator">=</span> emailService.sendEmail(
                    email,
                    <span class="hljs-string">"ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯ä»£å‘"</span>,
                    formatForEmail(wecomMsg)
                );
                <span class="hljs-keyword">if</span> (emailResult.isSuccess()) {
                    <span class="hljs-keyword">return</span> ChannelResponse.success(
                        <span class="hljs-string">"sent_via_email"</span>,
                        emailResult.getMessageId()
                    );
                }
            }
        }
        
        <span class="hljs-comment">// å¦‚æœçŸ­ä¿¡å’Œé‚®ä»¶éƒ½ä¸å¯ç”¨ï¼Œå°è¯•å…¶ä»–åä½œå·¥å…·</span>
        <span class="hljs-keyword">if</span> (dingTalkService.isAvailable()) {
            <span class="hljs-type">DingTalkResult</span> <span class="hljs-variable">dtResult</span> <span class="hljs-operator">=</span> dingTalkService.sendMessage(
                convertToDingTalkMessage(wecomMsg)
            );
            <span class="hljs-keyword">if</span> (dtResult.isSuccess()) {
                <span class="hljs-keyword">return</span> ChannelResponse.success(
                    <span class="hljs-string">"sent_via_dingtalk"</span>,
                    dtResult.getMessageId()
                );
            }
        }
        
        <span class="hljs-keyword">return</span> ChannelResponse.failed(<span class="hljs-string">"æ‰€æœ‰å¤‡ç”¨æ¸ é“å‡ä¸å¯ç”¨"</span>);
    }
}
</code></pre>
<h4 data-id="heading-5">2. åŒæ´»æ•°æ®ä¸­å¿ƒçš„æ•°æ®åŒæ­¥</h4>
<p>åœ¨ä¼ä¸šå¾®ä¿¡ç§æœ‰åŒ–éƒ¨ç½²åœºæ™¯ä¸‹ï¼Œå®ç°è·¨æ•°æ®ä¸­å¿ƒçš„åŒæ´»æ¶æ„ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼ä¸šå¾®ä¿¡åŒæ´»æ•°æ®åŒæ­¥æœåŠ¡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DualActiveDataSyncService</span>:
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, primary_client, standby_client, sync_state_store</span>):
        self.primary = primary_client  <span class="hljs-comment"># ä¸»æ•°æ®ä¸­å¿ƒä¼ä¸šå¾®ä¿¡</span>
        self.standby = standby_client  <span class="hljs-comment"># å¤‡æ•°æ®ä¸­å¿ƒä¼ä¸šå¾®ä¿¡</span>
        self.state_store = sync_state_store
        self.sync_queue = RedisPriorityQueue(<span class="hljs-string">"wecom_sync_queue"</span>)
        
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_bidirectional_sync</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å»ºç«‹åŒå‘æ•°æ®åŒæ­¥"""</span>
        <span class="hljs-comment"># 1. åˆå§‹å…¨é‡åŒæ­¥</span>
        <span class="hljs-keyword">await</span> self.perform_initial_sync()
        
        <span class="hljs-comment"># 2. å¯åŠ¨å¢é‡åŒæ­¥ç›‘å¬å™¨</span>
        asyncio.create_task(self.listen_primary_changes())
        asyncio.create_task(self.listen_standby_changes())
        
        <span class="hljs-comment"># 3. å¯åŠ¨å†²çªæ£€æµ‹ä¸è§£å†³</span>
        asyncio.create_task(self.resolve_sync_conflicts())
        
        logger.info(<span class="hljs-string">"åŒæ´»æ•°æ®åŒæ­¥å·²å¯åŠ¨"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">perform_initial_sync</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æ‰§è¡Œåˆå§‹å…¨é‡åŒæ­¥"""</span>
        <span class="hljs-comment"># åŒæ­¥ç»„ç»‡æ¶æ„</span>
        depts_primary = <span class="hljs-keyword">await</span> self.primary.get_department_list()
        depts_standby = <span class="hljs-keyword">await</span> self.standby.get_department_list()
        
        <span class="hljs-comment"># æ¯”è¾ƒå·®å¼‚ï¼Œç”ŸæˆåŒæ­¥ä»»åŠ¡</span>
        dept_diff = self.compare_departments(depts_primary, depts_standby)
        <span class="hljs-keyword">for</span> dept_sync_task <span class="hljs-keyword">in</span> dept_diff:
            <span class="hljs-keyword">await</span> self.sync_queue.put(dept_sync_task, priority=<span class="hljs-number">1</span>)
        
        <span class="hljs-comment"># åŒæ­¥ç”¨æˆ·ä¿¡æ¯</span>
        users_primary = <span class="hljs-keyword">await</span> self.primary.get_user_list()
        users_standby = <span class="hljs-keyword">await</span> self.standby.get_user_list()
        
        user_diff = self.compare_users(users_primary, users_standby)
        <span class="hljs-keyword">for</span> user_sync_task <span class="hljs-keyword">in</span> user_diff:
            <span class="hljs-keyword">await</span> self.sync_queue.put(user_sync_task, priority=<span class="hljs-number">2</span>)
        
        <span class="hljs-comment"># åŒæ­¥å¤–éƒ¨è”ç³»äºº</span>
        external_primary = <span class="hljs-keyword">await</span> self.primary.get_external_contact_list()
        external_standby = <span class="hljs-keyword">await</span> self.standby.get_external_contact_list()
        
        external_diff = self.compare_external_contacts(external_primary, external_standby)
        <span class="hljs-keyword">for</span> external_sync_task <span class="hljs-keyword">in</span> external_diff:
            <span class="hljs-keyword">await</span> self.sync_queue.put(external_sync_task, priority=<span class="hljs-number">3</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">listen_primary_changes</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""ç›‘å¬ä¸»æ•°æ®ä¸­å¿ƒå˜æ›´"""</span>
        <span class="hljs-comment"># ä½¿ç”¨ä¼ä¸šå¾®ä¿¡çš„å›è°ƒæœºåˆ¶ç›‘å¬å˜æ›´</span>
        <span class="hljs-comment"># æˆ–è€…å®šæœŸè½®è¯¢æ£€æŸ¥å¢é‡å˜æ›´</span>
        
        last_seq = <span class="hljs-keyword">await</span> self.state_store.get_last_sync_seq(<span class="hljs-string">"primary"</span>)
        
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                changes = <span class="hljs-keyword">await</span> self.primary.get_incremental_changes(seq=last_seq)
                
                <span class="hljs-keyword">if</span> changes:
                    <span class="hljs-keyword">for</span> change <span class="hljs-keyword">in</span> changes:
                        <span class="hljs-comment"># æ ‡è®°å˜æ›´æ¥æºï¼Œç”¨äºå†²çªæ£€æµ‹</span>
                        change[<span class="hljs-string">'_source'</span>] = <span class="hljs-string">'primary'</span>
                        change[<span class="hljs-string">'_timestamp'</span>] = time.time()
                        
                        <span class="hljs-comment"># æ ¹æ®å˜æ›´ç±»å‹å¤„ç†</span>
                        <span class="hljs-keyword">if</span> change[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'user_change'</span>:
                            <span class="hljs-keyword">await</span> self.handle_user_change(change, <span class="hljs-string">'primary_to_standby'</span>)
                        <span class="hljs-keyword">elif</span> change[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'department_change'</span>:
                            <span class="hljs-keyword">await</span> self.handle_department_change(change, <span class="hljs-string">'primary_to_standby'</span>)
                        <span class="hljs-keyword">elif</span> change[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'external_contact_change'</span>:
                            <span class="hljs-keyword">await</span> self.handle_external_contact_change(change, <span class="hljs-string">'primary_to_standby'</span>)
                        
                        <span class="hljs-comment"># æ›´æ–°åºåˆ—å·</span>
                        last_seq = change[<span class="hljs-string">'seq'</span>]
                        <span class="hljs-keyword">await</span> self.state_store.update_sync_seq(<span class="hljs-string">"primary"</span>, last_seq)
                
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)  <span class="hljs-comment"># çŸ­é—´éš”è½®è¯¢</span>
                
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logger.error(<span class="hljs-string">f"ç›‘å¬ä¸»æ•°æ®ä¸­å¿ƒå˜æ›´å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">5</span>)  <span class="hljs-comment"># é”™è¯¯åç­‰å¾…ç¨é•¿æ—¶é—´</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_user_change</span>(<span class="hljs-params">self, change, direction</span>):
        <span class="hljs-string">"""å¤„ç†ç”¨æˆ·å˜æ›´åŒæ­¥"""</span>
        user_id = change[<span class="hljs-string">'userid'</span>]
        change_type = change[<span class="hljs-string">'changetype'</span>]  <span class="hljs-comment"># create, update, delete</span>
        
        <span class="hljs-comment"># æ£€æŸ¥å†²çª</span>
        conflict = <span class="hljs-keyword">await</span> self.check_conflict(user_id, change)
        <span class="hljs-keyword">if</span> conflict:
            <span class="hljs-keyword">await</span> self.sync_queue.put({
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'conflict'</span>,
                <span class="hljs-string">'data'</span>: conflict,
                <span class="hljs-string">'priority'</span>: <span class="hljs-number">0</span>  <span class="hljs-comment"># æœ€é«˜ä¼˜å…ˆçº§</span>
            })
            <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment"># æ‰§è¡ŒåŒæ­¥</span>
        <span class="hljs-keyword">if</span> direction == <span class="hljs-string">'primary_to_standby'</span>:
            <span class="hljs-keyword">if</span> change_type == <span class="hljs-string">'delete'</span>:
                <span class="hljs-keyword">await</span> self.standby.delete_user(user_id)
            <span class="hljs-keyword">else</span>:
                user_detail = <span class="hljs-keyword">await</span> self.primary.get_user_detail(user_id)
                <span class="hljs-keyword">await</span> self.standby.sync_user(user_detail)
        
        <span class="hljs-comment"># è®°å½•åŒæ­¥çŠ¶æ€</span>
        <span class="hljs-keyword">await</span> self.state_store.record_sync_operation(
            resource_type=<span class="hljs-string">'user'</span>,
            resource_id=user_id,
            direction=direction,
            change_type=change_type,
            timestamp=change[<span class="hljs-string">'_timestamp'</span>]
        )
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">resolve_sync_conflicts</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è§£å†³æ•°æ®åŒæ­¥å†²çª"""</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                conflict_task = <span class="hljs-keyword">await</span> self.sync_queue.get_conflict_task()
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conflict_task:
                    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)
                    <span class="hljs-keyword">continue</span>
                
                conflict = conflict_task[<span class="hljs-string">'data'</span>]
                
                <span class="hljs-comment"># åº”ç”¨å†²çªè§£å†³ç­–ç•¥</span>
                resolution = self.resolve_conflict_by_policy(conflict)
                
                <span class="hljs-comment"># æ‰§è¡Œè§£å†³æ–¹æ¡ˆ</span>
                <span class="hljs-keyword">if</span> resolution[<span class="hljs-string">'action'</span>] == <span class="hljs-string">'use_primary'</span>:
                    <span class="hljs-keyword">await</span> self.apply_change_to_standby(conflict[<span class="hljs-string">'primary_change'</span>])
                <span class="hljs-keyword">elif</span> resolution[<span class="hljs-string">'action'</span>] == <span class="hljs-string">'use_standby'</span>:
                    <span class="hljs-keyword">await</span> self.apply_change_to_primary(conflict[<span class="hljs-string">'standby_change'</span>])
                <span class="hljs-keyword">elif</span> resolution[<span class="hljs-string">'action'</span>] == <span class="hljs-string">'merge'</span>:
                    merged = self.merge_changes(
                        conflict[<span class="hljs-string">'primary_change'</span>],
                        conflict[<span class="hljs-string">'standby_change'</span>]
                    )
                    <span class="hljs-keyword">await</span> self.apply_merged_change(merged)
                
                <span class="hljs-comment"># è®°å½•å†²çªè§£å†³</span>
                <span class="hljs-keyword">await</span> self.state_store.record_conflict_resolution(
                    conflict_id=conflict[<span class="hljs-string">'id'</span>],
                    resolution=resolution[<span class="hljs-string">'action'</span>],
                    resolved_by=<span class="hljs-string">'auto_system'</span>
                )
                
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logger.error(<span class="hljs-string">f"è§£å†³åŒæ­¥å†²çªå¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">5</span>)
</code></pre>
<h4 data-id="heading-6">3. åŸºäºæµé‡åˆ‡ç‰‡çš„ç°åº¦åˆ‡æ¢æœºåˆ¶</h4>
<p>å½“éœ€è¦ä»ä¸»æ•°æ®ä¸­å¿ƒåˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®ä¸­å¿ƒæ—¶ï¼Œé‡‡ç”¨é€æ­¥æµé‡åˆ‡æ¢ç­–ç•¥ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># æµé‡åˆ‡æ¢é…ç½®å®šä¹‰</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">disaster-recovery/v1alpha1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">TrafficSwitchPlan</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">wecom-primary-to-standby</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">wecom-integration</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">strategy:</span> <span class="hljs-string">gradual-traffic-shift</span>  <span class="hljs-comment"># ç­–ç•¥ï¼šé€æ­¥æµé‡åˆ‡æ¢</span>
  <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">é˜¶æ®µä¸€ï¼šåªè¯»æµ‹è¯•</span>
      <span class="hljs-attr">duration:</span> <span class="hljs-string">30m</span>
      <span class="hljs-attr">actions:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">redirect</span>
          <span class="hljs-attr">trafficPercentage:</span> <span class="hljs-number">0</span>
          <span class="hljs-attr">apis:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/user/get</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/department/list</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/tag/get</span>
          <span class="hljs-attr">target:</span> <span class="hljs-string">standby-cluster</span>
      <span class="hljs-attr">validations:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">api-success-rate</span>
          <span class="hljs-attr">threshold:</span> <span class="hljs-number">99.5</span><span class="hljs-string">%</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">latency-p95</span>
          <span class="hljs-attr">threshold:</span> <span class="hljs-string">200ms</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">é˜¶æ®µäºŒï¼šä½é£é™©å†™å…¥</span>
      <span class="hljs-attr">duration:</span> <span class="hljs-string">1h</span>
      <span class="hljs-attr">actions:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">redirect</span>
          <span class="hljs-attr">trafficPercentage:</span> <span class="hljs-number">10</span>
          <span class="hljs-attr">apis:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/message/send</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/appchat/send</span>
          <span class="hljs-attr">target:</span> <span class="hljs-string">standby-cluster</span>
      <span class="hljs-attr">validations:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">message-delivery-rate</span>
          <span class="hljs-attr">threshold:</span> <span class="hljs-number">99</span><span class="hljs-string">%</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">duplicate-rate</span>
          <span class="hljs-attr">threshold:</span> <span class="hljs-number">0.1</span><span class="hljs-string">%</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">é˜¶æ®µä¸‰ï¼šæ ¸å¿ƒä¸šåŠ¡åˆ‡æ¢</span>
      <span class="hljs-attr">duration:</span> <span class="hljs-string">2h</span>
      <span class="hljs-attr">actions:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">redirect</span>
          <span class="hljs-attr">trafficPercentage:</span> <span class="hljs-number">50</span>
          <span class="hljs-attr">apis:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/externalcontact/*</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/oa/*</span>
          <span class="hljs-attr">target:</span> <span class="hljs-string">standby-cluster</span>
      <span class="hljs-attr">validations:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">business-transaction-success</span>
          <span class="hljs-attr">threshold:</span> <span class="hljs-number">99.8</span><span class="hljs-string">%</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">é˜¶æ®µå››ï¼šå®Œå…¨åˆ‡æ¢</span>
      <span class="hljs-attr">duration:</span> <span class="hljs-string">30m</span>
      <span class="hljs-attr">actions:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">redirect</span>
          <span class="hljs-attr">trafficPercentage:</span> <span class="hljs-number">100</span>
          <span class="hljs-attr">apis:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">"/*"</span>  <span class="hljs-comment"># æ‰€æœ‰API</span>
          <span class="hljs-attr">target:</span> <span class="hljs-string">standby-cluster</span>
    
  <span class="hljs-attr">rollbackConditions:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">condition:</span> <span class="hljs-string">api-error-rate</span>
      <span class="hljs-attr">operator:</span> <span class="hljs-string">"&gt;="</span>
      <span class="hljs-attr">value:</span> <span class="hljs-number">5</span>
      <span class="hljs-attr">duration:</span> <span class="hljs-string">5m</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">condition:</span> <span class="hljs-string">critical-business-failure</span>
      <span class="hljs-attr">operator:</span> <span class="hljs-string">"=="</span>
      <span class="hljs-attr">value:</span> <span class="hljs-literal">true</span>
    
  <span class="hljs-attr">notificationRules:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">events:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">switch.started</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">switch.completed</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">switch.rolledback</span>
      <span class="hljs-attr">channels:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">wecom_alert_group</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">sms_admin</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">email_management</span>
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æµé‡åˆ‡æ¢æ§åˆ¶å™¨å®ç°</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TrafficSwitchController</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TrafficRouter trafficRouter;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HealthMonitor healthMonitor;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConfigManager configManager;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AuditLogger auditLogger;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeSwitchPlan</span><span class="hljs-params">(String planId)</span> {
        <span class="hljs-type">TrafficSwitchPlan</span> <span class="hljs-variable">plan</span> <span class="hljs-operator">=</span> configManager.getSwitchPlan(planId);
        <span class="hljs-type">ExecutionContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionContext</span>(plan);
        
        logger.info(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œæµé‡åˆ‡æ¢è®¡åˆ’: {}"</span>, plan.getMetadata().getName());
        
        <span class="hljs-comment">// è®°å½•å¼€å§‹å®¡è®¡</span>
        auditLogger.logSwitchStart(planId, context);
        
        <span class="hljs-comment">// æ‰§è¡Œæ¯ä¸ªé˜¶æ®µ</span>
        <span class="hljs-keyword">for</span> (SwitchStep step : plan.getSpec().getSteps()) {
            <span class="hljs-type">boolean</span> <span class="hljs-variable">stepSuccess</span> <span class="hljs-operator">=</span> executeStep(step, context);
            
            <span class="hljs-keyword">if</span> (!stepSuccess) {
                logger.error(<span class="hljs-string">"é˜¶æ®µæ‰§è¡Œå¤±è´¥: {}"</span>, step.getName());
                
                <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦å›æ»š</span>
                <span class="hljs-keyword">if</span> (shouldRollback(plan, context)) {
                    performRollback(plan, context);
                    <span class="hljs-keyword">return</span>;
                }
            }
            
            <span class="hljs-comment">// é˜¶æ®µé—´ç­‰å¾…</span>
            waitForStepInterval(step);
        }
        
        logger.info(<span class="hljs-string">"æµé‡åˆ‡æ¢è®¡åˆ’æ‰§è¡Œå®Œæˆ"</span>);
        auditLogger.logSwitchCompletion(planId, context);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">executeStep</span><span class="hljs-params">(SwitchStep step, ExecutionContext context)</span> {
        logger.info(<span class="hljs-string">"æ‰§è¡Œé˜¶æ®µ: {}"</span>, step.getName());
        
        <span class="hljs-comment">// 1. åº”ç”¨æµé‡è·¯ç”±è§„åˆ™</span>
        applyTrafficRouting(step.getActions());
        
        <span class="hljs-comment">// 2. ç­‰å¾…ç¨³å®š</span>
        waitForStabilization(step.getDuration());
        
        <span class="hljs-comment">// 3. æ‰§è¡ŒéªŒè¯</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">validationPassed</span> <span class="hljs-operator">=</span> performValidations(step.getValidations());
        
        <span class="hljs-keyword">if</span> (validationPassed) {
            logger.info(<span class="hljs-string">"é˜¶æ®µéªŒè¯é€šè¿‡: {}"</span>, step.getName());
            context.recordStepSuccess(step.getName());
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            logger.warn(<span class="hljs-string">"é˜¶æ®µéªŒè¯å¤±è´¥: {}"</span>, step.getName());
            context.recordStepFailure(step.getName());
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyTrafficRouting</span><span class="hljs-params">(List&lt;TrafficAction&gt; actions)</span> {
        <span class="hljs-keyword">for</span> (TrafficAction action : actions) {
            <span class="hljs-keyword">switch</span> (action.getType()) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"redirect"</span>:
                    <span class="hljs-comment">// æ›´æ–°æµé‡è·¯ç”±é…ç½®</span>
                    trafficRouter.updateRouting(
                        action.getApis(),
                        action.getTarget(),
                        action.getTrafficPercentage()
                    );
                    <span class="hljs-keyword">break</span>;
                    
                <span class="hljs-keyword">case</span> <span class="hljs-string">"drain"</span>:
                    <span class="hljs-comment">// æ’ç©ºæŒ‡å®šAPIçš„æµé‡</span>
                    trafficRouter.drainTraffic(action.getApis());
                    <span class="hljs-keyword">break</span>;
                    
                <span class="hljs-keyword">case</span> <span class="hljs-string">"block"</span>:
                    <span class="hljs-comment">// é˜»æ–­æŒ‡å®šAPI</span>
                    trafficRouter.blockApis(action.getApis());
                    <span class="hljs-keyword">break</span>;
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">performValidations</span><span class="hljs-params">(List&lt;ValidationRule&gt; validations)</span> {
        <span class="hljs-keyword">for</span> (ValidationRule rule : validations) {
            <span class="hljs-type">boolean</span> <span class="hljs-variable">passed</span> <span class="hljs-operator">=</span> validateRule(rule);
            <span class="hljs-keyword">if</span> (!passed) {
                logger.warn(<span class="hljs-string">"éªŒè¯è§„åˆ™æœªé€šè¿‡: {} {}"</span>, rule.getType(), rule.getThreshold());
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validateRule</span><span class="hljs-params">(ValidationRule rule)</span> {
        <span class="hljs-keyword">switch</span> (rule.getType()) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"api-success-rate"</span>:
                <span class="hljs-type">double</span> <span class="hljs-variable">successRate</span> <span class="hljs-operator">=</span> healthMonitor.getApiSuccessRate(
                    rule.getDuration(),
                    rule.getApis()
                );
                <span class="hljs-keyword">return</span> successRate &gt;= rule.getThreshold();
                
            <span class="hljs-keyword">case</span> <span class="hljs-string">"latency-p95"</span>:
                <span class="hljs-type">double</span> <span class="hljs-variable">latency</span> <span class="hljs-operator">=</span> healthMonitor.getLatencyP95(
                    rule.getDuration(),
                    rule.getApis()
                );
                <span class="hljs-keyword">return</span> latency &lt;= rule.getThreshold();
                
            <span class="hljs-keyword">case</span> <span class="hljs-string">"duplicate-rate"</span>:
                <span class="hljs-type">double</span> <span class="hljs-variable">duplicateRate</span> <span class="hljs-operator">=</span> messageMonitor.getDuplicateRate(
                    rule.getDuration()
                );
                <span class="hljs-keyword">return</span> duplicateRate &lt;= rule.getThreshold();
                
            <span class="hljs-keyword">default</span>:
                logger.warn(<span class="hljs-string">"æœªçŸ¥éªŒè¯è§„åˆ™ç±»å‹: {}"</span>, rule.getType());
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performRollback</span><span class="hljs-params">(TrafficSwitchPlan plan, ExecutionContext context)</span> {
        logger.warn(<span class="hljs-string">"å¼€å§‹å›æ»šæµé‡åˆ‡æ¢"</span>);
        
        <span class="hljs-comment">// æ¢å¤åˆ°åˆå§‹çŠ¶æ€</span>
        trafficRouter.restoreDefaultRouting();
        
        <span class="hljs-comment">// é€šçŸ¥ç›¸å…³äººå‘˜</span>
        notificationService.sendRollbackAlert(
            plan.getMetadata().getName(),
            context.getFailureReason()
        );
        
        auditLogger.logSwitchRollback(plan.getMetadata().getName(), context);
    }
}
</code></pre>
<h4 data-id="heading-7">4. ç¾å¤‡æ¼”ç»ƒä¸è‡ªåŠ¨åŒ–éªŒè¯</h4>
<p>å®šæœŸæ‰§è¡Œè‡ªåŠ¨åŒ–ç¾å¤‡æ¼”ç»ƒï¼Œç¡®ä¿ç³»ç»Ÿå®é™…å¯ç”¨æ€§ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è‡ªåŠ¨åŒ–ç¾å¤‡æ¼”ç»ƒå¼•æ“</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DisasterRecoveryDrillEngine</span>:
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, scenario_registry, assertion_engine</span>):
        self.scenarios = scenario_registry
        self.assertion_engine = assertion_engine
        self.report_generator = DrillReportGenerator()
        
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute_drill</span>(<span class="hljs-params">self, scenario_id, drill_level=<span class="hljs-string">"full"</span></span>):
        <span class="hljs-string">"""æ‰§è¡Œç¾å¤‡æ¼”ç»ƒ"""</span>
        scenario = self.scenarios.get_scenario(scenario_id)
        
        logger.info(<span class="hljs-string">f"å¼€å§‹ç¾å¤‡æ¼”ç»ƒ: <span class="hljs-subst">{scenario.name}</span> (çº§åˆ«: <span class="hljs-subst">{drill_level}</span>)"</span>)
        
        <span class="hljs-comment"># 1. é¢„æ£€æŸ¥</span>
        precheck_result = <span class="hljs-keyword">await</span> self.run_prechecks(scenario.prechecks)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> precheck_result.success:
            <span class="hljs-keyword">return</span> DrillResult.failed(<span class="hljs-string">"é¢„æ£€æŸ¥å¤±è´¥"</span>, precheck_result.details)
        
        <span class="hljs-comment"># 2. æ‰§è¡Œæ•…éšœæ³¨å…¥</span>
        fault_results = []
        <span class="hljs-keyword">for</span> fault <span class="hljs-keyword">in</span> scenario.faults:
            <span class="hljs-keyword">if</span> fault.level &lt;= drill_level:
                result = <span class="hljs-keyword">await</span> self.inject_fault(fault)
                fault_results.append(result)
                
                <span class="hljs-comment"># ç­‰å¾…æ•…éšœç”Ÿæ•ˆ</span>
                <span class="hljs-keyword">await</span> asyncio.sleep(fault.ramp_up_time)
        
        <span class="hljs-comment"># 3. éªŒè¯ç³»ç»Ÿè¡Œä¸º</span>
        verification_results = []
        <span class="hljs-keyword">for</span> verification <span class="hljs-keyword">in</span> scenario.verifications:
            result = <span class="hljs-keyword">await</span> self.assertion_engine.verify(
                verification.condition,
                verification.expected_state,
                verification.timeout
            )
            verification_results.append(result)
            
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result.success <span class="hljs-keyword">and</span> verification.is_critical:
                <span class="hljs-comment"># å…³é”®éªŒè¯å¤±è´¥ï¼Œç«‹å³ç»ˆæ­¢æ¼”ç»ƒ</span>
                <span class="hljs-keyword">await</span> self.recover_from_faults(scenario.faults)
                <span class="hljs-keyword">return</span> DrillResult.failed(<span class="hljs-string">"å…³é”®éªŒè¯å¤±è´¥"</span>, result.details)
        
        <span class="hljs-comment"># 4. æ¢å¤ä¸æ¸…ç†</span>
        recovery_results = <span class="hljs-keyword">await</span> self.recover_from_faults(scenario.faults)
        
        <span class="hljs-comment"># 5. ç”Ÿæˆæ¼”ç»ƒæŠ¥å‘Š</span>
        report = self.report_generator.generate(
            scenario=scenario,
            prechecks=precheck_result,
            faults=fault_results,
            verifications=verification_results,
            recovery=recovery_results
        )
        
        <span class="hljs-comment"># 6. è¯†åˆ«æ”¹è¿›é¡¹</span>
        improvements = self.identify_improvements(report)
        
        logger.info(<span class="hljs-string">f"ç¾å¤‡æ¼”ç»ƒå®Œæˆ: <span class="hljs-subst">{scenario.name}</span>"</span>)
        
        <span class="hljs-keyword">return</span> DrillResult.success(report, improvements)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">inject_fault</span>(<span class="hljs-params">self, fault_spec</span>):
        <span class="hljs-string">"""æ³¨å…¥æŒ‡å®šç±»å‹çš„æ•…éšœ"""</span>
        fault_type = fault_spec.<span class="hljs-built_in">type</span>
        
        <span class="hljs-keyword">if</span> fault_type == <span class="hljs-string">"network_partition"</span>:
            <span class="hljs-comment"># æ¨¡æ‹Ÿç½‘ç»œåˆ†åŒº</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.network_partition_fault(fault_spec)
            
        <span class="hljs-keyword">elif</span> fault_type == <span class="hljs-string">"service_outage"</span>:
            <span class="hljs-comment"># æ¨¡æ‹ŸæœåŠ¡ä¸å¯ç”¨</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.service_outage_fault(fault_spec)
            
        <span class="hljs-keyword">elif</span> fault_type == <span class="hljs-string">"high_latency"</span>:
            <span class="hljs-comment"># æ¨¡æ‹Ÿé«˜å»¶è¿Ÿ</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.high_latency_fault(fault_spec)
            
        <span class="hljs-keyword">elif</span> fault_type == <span class="hljs-string">"rate_limit_triggered"</span>:
            <span class="hljs-comment"># æ¨¡æ‹Ÿè§¦å‘é¢‘ç‡é™åˆ¶</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.rate_limit_fault(fault_spec)
            
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"æœªçŸ¥æ•…éšœç±»å‹: <span class="hljs-subst">{fault_type}</span>"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">network_partition_fault</span>(<span class="hljs-params">self, fault_spec</span>):
        <span class="hljs-string">"""ç½‘ç»œåˆ†åŒºæ•…éšœæ³¨å…¥"""</span>
        target_service = fault_spec.target
        
        <span class="hljs-comment"># è®°å½•å½“å‰ç½‘ç»œé…ç½®</span>
        original_config = <span class="hljs-keyword">await</span> self.record_network_config(target_service)
        
        <span class="hljs-comment"># æ³¨å…¥æ•…éšœï¼šé˜»æ–­ç‰¹å®šç½‘ç»œæµé‡</span>
        <span class="hljs-keyword">await</span> self.network_controller.block_traffic(
            source=<span class="hljs-string">"business_zone"</span>,
            destination=target_service,
            port=fault_spec.get(<span class="hljs-string">"port"</span>, <span class="hljs-number">443</span>)
        )
        
        <span class="hljs-comment"># éªŒè¯æ•…éšœå·²ç”Ÿæ•ˆ</span>
        is_blocked = <span class="hljs-keyword">await</span> self.verify_connectivity(target_service)
        
        <span class="hljs-keyword">return</span> FaultInjectionResult(
            <span class="hljs-built_in">type</span>=<span class="hljs-string">"network_partition"</span>,
            target=target_service,
            original_config=original_config,
            success=<span class="hljs-keyword">not</span> is_blocked,
            timestamp=time.time()
        )
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">service_outage_fault</span>(<span class="hljs-params">self, fault_spec</span>):
        <span class="hljs-string">"""æœåŠ¡ä¸å¯ç”¨æ•…éšœæ³¨å…¥"""</span>
        target_service = fault_spec.target
        
        <span class="hljs-keyword">if</span> fault_spec.method == <span class="hljs-string">"pod_termination"</span>:
            <span class="hljs-comment"># ç»ˆæ­¢Kubernetes Podï¼ˆæ¨¡æ‹ŸèŠ‚ç‚¹æ•…éšœï¼‰</span>
            pod_name = <span class="hljs-keyword">await</span> self.k8s_client.get_service_pod(target_service)
            <span class="hljs-keyword">await</span> self.k8s_client.terminate_pod(pod_name)
            
        <span class="hljs-keyword">elif</span> fault_spec.method == <span class="hljs-string">"process_kill"</span>:
            <span class="hljs-comment"># æ€æ­»è¿›ç¨‹</span>
            <span class="hljs-keyword">await</span> self.ssh_client.kill_process(
                fault_spec.host,
                fault_spec.process_pattern
            )
        
        <span class="hljs-comment"># ç­‰å¾…æœåŠ¡å®Œå…¨ä¸å¯ç”¨</span>
        <span class="hljs-keyword">await</span> asyncio.sleep(fault_spec.get(<span class="hljs-string">"downtime_delay"</span>, <span class="hljs-number">10</span>))
        
        <span class="hljs-comment"># éªŒè¯æœåŠ¡çŠ¶æ€</span>
        is_available = <span class="hljs-keyword">await</span> self.health_checker.check_service(target_service)
        
        <span class="hljs-keyword">return</span> FaultInjectionResult(
            <span class="hljs-built_in">type</span>=<span class="hljs-string">"service_outage"</span>,
            target=target_service,
            method=fault_spec.method,
            success=<span class="hljs-keyword">not</span> is_available,
            timestamp=time.time()
        )
</code></pre>
<h3 data-id="heading-8">å››ã€ç›‘æ§ã€å‘Šè­¦ä¸æ¢å¤æœºåˆ¶</h3>
<p>å»ºç«‹å®Œå–„çš„ç¾å¤‡ç›‘æ§ä½“ç³»ï¼Œå®ç°å¿«é€Ÿæ•…éšœæ£€æµ‹ä¸è‡ªåŠ¨æ¢å¤ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¾å¤‡çŠ¶æ€ç›‘æ§æ•°æ®åº“è®¾è®¡</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> disaster_recovery_status (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    component_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    component_type ENUM(<span class="hljs-string">'primary'</span>, <span class="hljs-string">'standby'</span>, <span class="hljs-string">'gateway'</span>, <span class="hljs-string">'sync_service'</span>),
    status ENUM(<span class="hljs-string">'healthy'</span>, <span class="hljs-string">'degraded'</span>, <span class="hljs-string">'unhealthy'</span>, <span class="hljs-string">'unknown'</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    health_score <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">5</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">100.00</span>, <span class="hljs-comment">-- å¥åº·åº¦è¯„åˆ†</span>
    last_check_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    check_interval <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">30</span>, <span class="hljs-comment">-- æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰</span>
    
    <span class="hljs-comment">-- è¯¦ç»†çŠ¶æ€ä¿¡æ¯</span>
    metrics JSON,
    error_message TEXT,
    
    <span class="hljs-comment">-- åˆ‡æ¢ç›¸å…³çŠ¶æ€</span>
    in_traffic <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>, <span class="hljs-comment">-- æ˜¯å¦æ­£åœ¨æ‰¿è½½æµé‡</span>
    traffic_weight <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- æµé‡æƒé‡</span>
    last_switch_time <span class="hljs-type">TIMESTAMP</span>,
    
    INDEX idx_component_type (component_type, status),
    INDEX idx_health_check (last_check_time, health_score),
    INDEX idx_traffic_status (in_traffic, traffic_weight)
);

<span class="hljs-comment">-- æ•…éšœäº‹ä»¶è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> failure_events (
    event_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
    component_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    failure_type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    severity ENUM(<span class="hljs-string">'critical'</span>, <span class="hljs-string">'high'</span>, <span class="hljs-string">'medium'</span>, <span class="hljs-string">'low'</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    detected_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    
    <span class="hljs-comment">-- æ•…éšœè¯¦æƒ…</span>
    error_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>),
    error_message TEXT,
    stack_trace TEXT,
    
    <span class="hljs-comment">-- å½±å“èŒƒå›´</span>
    affected_services JSON,
    user_impact_estimate <span class="hljs-type">INT</span>, <span class="hljs-comment">-- é¢„è®¡å½±å“ç”¨æˆ·æ•°</span>
    
    <span class="hljs-comment">-- æ¢å¤ä¿¡æ¯</span>
    auto_recovery_attempted <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>,
    auto_recovery_success <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>,
    manual_intervention_required <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>,
    resolved_at <span class="hljs-type">TIMESTAMP</span>,
    resolution_notes TEXT,
    
    INDEX idx_failure_type (failure_type, severity),
    INDEX idx_detection_time (detected_at, resolved_at),
    INDEX idx_recovery_status (auto_recovery_success, manual_intervention_required)
);

<span class="hljs-comment">-- è‡ªåŠ¨åˆ›å»ºæ•…éšœæ£€æµ‹äº‹ä»¶</span>
<span class="hljs-keyword">CREATE</span> EVENT monitor_failure_detection
<span class="hljs-keyword">ON</span> SCHEDULE <span class="hljs-keyword">EVERY</span> <span class="hljs-number">10</span> <span class="hljs-keyword">SECOND</span>
DO
<span class="hljs-keyword">BEGIN</span>
    <span class="hljs-comment">-- æ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€</span>
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> failure_events (
        event_id, component_name, failure_type,
        severity, detected_at, error_message
    )
    <span class="hljs-keyword">SELECT</span> 
        UUID() <span class="hljs-keyword">as</span> event_id,
        s.component_name,
        <span class="hljs-keyword">CASE</span> 
            <span class="hljs-keyword">WHEN</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">60</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'component_unhealthy'</span>
            <span class="hljs-keyword">WHEN</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'component_degraded'</span>
            <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'unknown'</span>
        <span class="hljs-keyword">END</span> <span class="hljs-keyword">as</span> failure_type,
        <span class="hljs-keyword">CASE</span>
            <span class="hljs-keyword">WHEN</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'critical'</span>
            <span class="hljs-keyword">WHEN</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">70</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'high'</span>
            <span class="hljs-keyword">WHEN</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'medium'</span>
            <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'low'</span>
        <span class="hljs-keyword">END</span> <span class="hljs-keyword">as</span> severity,
        NOW() <span class="hljs-keyword">as</span> detected_at,
        s.error_message
    <span class="hljs-keyword">FROM</span> disaster_recovery_status s
    <span class="hljs-keyword">WHERE</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>
        <span class="hljs-keyword">AND</span> s.last_check_time <span class="hljs-operator">&gt;=</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> s.check_interval <span class="hljs-keyword">SECOND</span>)
        <span class="hljs-keyword">AND</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (
            <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> failure_events e 
            <span class="hljs-keyword">WHERE</span> e.component_name <span class="hljs-operator">=</span> s.component_name 
                <span class="hljs-keyword">AND</span> e.resolved_at <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>
        );
    
    <span class="hljs-comment">-- è‡ªåŠ¨è§¦å‘æ¢å¤å°è¯•</span>
    <span class="hljs-keyword">CALL</span> attempt_auto_recovery();
<span class="hljs-keyword">END</span>;

<span class="hljs-comment">-- è‡ªåŠ¨æ¢å¤å­˜å‚¨è¿‡ç¨‹</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> attempt_auto_recovery()
<span class="hljs-keyword">BEGIN</span>
    <span class="hljs-keyword">DECLARE</span> done <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>;
    <span class="hljs-keyword">DECLARE</span> v_event_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>);
    <span class="hljs-keyword">DECLARE</span> v_component_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>);
    <span class="hljs-keyword">DECLARE</span> v_failure_type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>);
    
    <span class="hljs-comment">-- æ¸¸æ ‡ï¼šè·å–å¯è‡ªåŠ¨æ¢å¤çš„æ•…éšœäº‹ä»¶</span>
    <span class="hljs-keyword">DECLARE</span> cur <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> 
        <span class="hljs-keyword">SELECT</span> event_id, component_name, failure_type
        <span class="hljs-keyword">FROM</span> failure_events
        <span class="hljs-keyword">WHERE</span> resolved_at <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>
            <span class="hljs-keyword">AND</span> manual_intervention_required <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span>
            <span class="hljs-keyword">AND</span> auto_recovery_attempted <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span>
            <span class="hljs-keyword">AND</span> detected_at <span class="hljs-operator">&lt;=</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">30</span> <span class="hljs-keyword">SECOND</span>) <span class="hljs-comment">-- ç­‰å¾…30ç§’è§‚å¯Ÿ</span>
        LIMIT <span class="hljs-number">10</span>;
    
    <span class="hljs-keyword">DECLARE</span> CONTINUE HANDLER <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">NOT</span> FOUND <span class="hljs-keyword">SET</span> done <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span>;
    
    <span class="hljs-keyword">OPEN</span> cur;
    
    recovery_loop: LOOP
        <span class="hljs-keyword">FETCH</span> cur <span class="hljs-keyword">INTO</span> v_event_id, v_component_name, v_failure_type;
        
        IF done <span class="hljs-keyword">THEN</span>
            LEAVE recovery_loop;
        <span class="hljs-keyword">END</span> IF;
        
        <span class="hljs-comment">-- æ ¹æ®æ•…éšœç±»å‹æ‰§è¡Œä¸åŒçš„æ¢å¤ç­–ç•¥</span>
        <span class="hljs-keyword">CASE</span> v_failure_type
            <span class="hljs-keyword">WHEN</span> <span class="hljs-string">'component_unhealthy'</span>:
                <span class="hljs-comment">-- å°è¯•é‡å¯ç»„ä»¶</span>
                <span class="hljs-keyword">CALL</span> restart_component(v_component_name);
                
                <span class="hljs-comment">-- æ£€æŸ¥æ¢å¤æ˜¯å¦æˆåŠŸ</span>
                <span class="hljs-keyword">SET</span> <span class="hljs-variable">@recovery</span>_success <span class="hljs-operator">=</span> check_component_health(v_component_name);
                
                <span class="hljs-keyword">UPDATE</span> failure_events
                <span class="hljs-keyword">SET</span> auto_recovery_attempted <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span>,
                    auto_recovery_success <span class="hljs-operator">=</span> <span class="hljs-variable">@recovery</span>_success,
                    resolved_at <span class="hljs-operator">=</span> IF(<span class="hljs-variable">@recovery</span>_success, NOW(), <span class="hljs-keyword">NULL</span>)
                <span class="hljs-keyword">WHERE</span> event_id <span class="hljs-operator">=</span> v_event_id;
                
            <span class="hljs-keyword">WHEN</span> <span class="hljs-string">'network_partition'</span>:
                <span class="hljs-comment">-- å°è¯•é‡æ–°å»ºç«‹ç½‘ç»œè¿æ¥</span>
                <span class="hljs-keyword">CALL</span> reestablish_network_connection(v_component_name);
                
                <span class="hljs-comment">-- æ›´æ–°çŠ¶æ€</span>
                <span class="hljs-keyword">UPDATE</span> failure_events
                <span class="hljs-keyword">SET</span> auto_recovery_attempted <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span>,
                    auto_recovery_success <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span>,
                    resolved_at <span class="hljs-operator">=</span> NOW()
                <span class="hljs-keyword">WHERE</span> event_id <span class="hljs-operator">=</span> v_event_id;
                
            <span class="hljs-comment">-- å…¶ä»–æ•…éšœç±»å‹çš„æ¢å¤é€»è¾‘...</span>
        <span class="hljs-keyword">END</span> <span class="hljs-keyword">CASE</span>;
        
    <span class="hljs-keyword">END</span> LOOP;
    
    <span class="hljs-keyword">CLOSE</span> cur;
<span class="hljs-keyword">END</span>;
</code></pre>
<h3 data-id="heading-9">äº”ã€æ€»ç»“</h3>
<p>æ„å»ºä¼ä¸šå¾®ä¿¡æ¥å£çš„ç¾å¤‡æ¶æ„éœ€è¦ä»å¤šä¸ªç»´åº¦è¿›è¡Œç³»ç»Ÿæ€§è®¾è®¡ï¼šé€šè¿‡å¤šé€šé“å®¢æˆ·ç«¯å®ç°æ¥å…¥å±‚çš„é«˜å¯ç”¨ï¼Œé€šè¿‡åŒæ´»æ•°æ®åŒæ­¥ç¡®ä¿æ•°æ®å±‚çš„ä¸€è‡´æ€§ï¼Œé€šè¿‡æ™ºèƒ½æµé‡è°ƒåº¦å®ç°å¹³æ»‘åˆ‡æ¢ï¼Œæœ€åé€šè¿‡è‡ªåŠ¨åŒ–æ¼”ç»ƒéªŒè¯æ•´ä¸ªä½“ç³»çš„å¯é æ€§ã€‚</p>
<p>è¿™ç§æ¶æ„ä¸ä»…èƒ½å¤Ÿåº”å¯¹ä¼ä¸šå¾®ä¿¡æœåŠ¡æœ¬èº«çš„ä¸­æ–­ï¼Œä¹Ÿèƒ½åœ¨ä¼ä¸šç½‘ç»œã€æ•°æ®ä¸­å¿ƒç­‰åŸºç¡€è®¾æ–½å‡ºç°æ•…éšœæ—¶ï¼Œç¡®ä¿å…³é”®ä¸šåŠ¡é€šä¿¡çš„è¿ç»­æ€§ã€‚åœ¨å®é™…å®æ–½ä¸­ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡çš„å…³é”®ç¨‹åº¦ã€RTO/RPOè¦æ±‚ä»¥åŠæˆæœ¬é¢„ç®—ï¼Œé€‰æ‹©åˆé€‚çš„ç¾å¤‡ç­‰çº§å’ŒæŠ€æœ¯æ–¹æ¡ˆã€‚</p>
<pre><code class="hljs language-python" lang="python">string_wxid = <span class="hljs-string">"bot555666"</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆæœ‰çš„å‡½æ•°è¦ç”¨ callï¼Œæœ‰çš„å´å®Œå…¨ä¸ç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603587738160889919</link>    <guid>https://juejin.cn/post/7603587738160889919</guid>    <pubDate>2026-02-07T02:32:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603587738160889919" data-draft-id="7603563360329941034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆæœ‰çš„å‡½æ•°è¦ç”¨ callï¼Œæœ‰çš„å´å®Œå…¨ä¸ç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2026-02-07T02:32:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="DoraBigHead"/> <meta itemprop="url" content="https://juejin.cn/user/1557383746694648"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆæœ‰çš„å‡½æ•°è¦ç”¨ callï¼Œæœ‰çš„å´å®Œå…¨ä¸ç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1557383746694648/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    DoraBigHead
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T02:32:06.000Z" title="Sat Feb 07 2026 02:32:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€”â€”ä» this è®¾è®¡æœ¬è´¨ç†è§£ JavaScript æ–¹æ³•åˆ†ç±»</p>
<p>åœ¨å­¦ä¹  JavaScript çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šäººéƒ½ä¼šå¡åœ¨ä¸€ä¸ªé—®é¢˜ä¸Šï¼š</p>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆ <code>Object.getPrototypeOf(obj)</code> ä¸éœ€è¦ <code>call</code>ï¼Œ<br/>
è€Œ <code>Object.prototype.toString</code> å´å¿…é¡»ç”¨ <code>call</code>ï¼Ÿ</strong></p>
</blockquote>
<p>æ›´è¿›ä¸€æ­¥çš„é—®é¢˜æ˜¯ï¼š</p>
<blockquote>
<p><strong>æˆ‘æ€ä¹ˆæå‰çŸ¥é“ä¸€ä¸ªå‡½æ•°åˆ°åº•æ˜¯â€œå‚æ•°å‹å‡½æ•°â€è¿˜æ˜¯â€œthis å‹å‡½æ•°â€ï¼Ÿ</strong></p>
</blockquote>
<p>æœ¬æ–‡å°†ä»<strong>è®¾è®¡å±‚é¢</strong>è€Œä¸æ˜¯â€œè®°è§„åˆ™â€çš„è§’åº¦ï¼Œå½»åº•è§£é‡Šè¿™ä¸ªé—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€å›°æƒ‘çš„æ ¹æºï¼šæˆ‘ä»¬æ··æ·†äº†ä¸¤ç§â€œå‡½æ•°è®¾è®¡æ–¹å¼â€</h2>
<p>åœ¨ JS é‡Œï¼Œ<strong>å‡½æ•°åªæœ‰ä¸€ç§è¯­æ³•å½¢å¼</strong>ï¼Œä½†å®é™…ä¸Šæœ‰<strong>ä¸¤ç§å®Œå…¨ä¸åŒçš„è®¾è®¡æ€è·¯</strong>ï¼š</p>
<h3 data-id="heading-1">1ï¸âƒ£ å‚æ•°å‹å‡½æ•°ï¼ˆParameter-basedï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj)
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj)
<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ“ä½œå¯¹è±¡ <strong>é€šè¿‡å‚æ•°ä¼ å…¥</strong></li>
<li>å‡½æ•°å†…éƒ¨ <strong>ä¸ä¾èµ– this</strong></li>
<li>this æ˜¯è° <strong>æ— å…³ç´§è¦</strong></li>
</ul>
<hr/>
<h3 data-id="heading-2">2ï¸âƒ£ this å‹å‡½æ•°ï¼ˆThis-basedï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss">obj<span class="hljs-selector-class">.toString</span>()
arr<span class="hljs-selector-class">.push</span>(<span class="hljs-number">1</span>)
<span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.prototype</span><span class="hljs-selector-class">.toString</span><span class="hljs-selector-class">.call</span>(value)
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ“ä½œå¯¹è±¡ <strong>æ¥è‡ª this</strong></li>
<li>å‡½æ•°å†…éƒ¨ <strong>å¼ºä¾èµ– this</strong></li>
<li>å¿…é¡»æ˜ç¡® this æŒ‡å‘è°</li>
</ul>
<hr/>
<p>ğŸ‘‰ <strong>æ˜¯å¦éœ€è¦ä½¿ç”¨ <code>call</code>ï¼Œåªå–å†³äºè¿™ä¸€ç‚¹</strong></p>
<hr/>
<h2 data-id="heading-3">äºŒã€ä¸ºä»€ä¹ˆ <code>Object.getPrototypeOf</code> ä¸éœ€è¦ callï¼Ÿ</h2>
<p>å…ˆçœ‹è°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.getPrototypeOf</span>(<span class="hljs-attribute">left</span>)
</code></pre>
<p>å®ƒçš„â€œè®¾è®¡æ„å›¾â€éå¸¸æ˜ç¡®ï¼š</p>
<ul>
<li>è¦æ“ä½œçš„å¯¹è±¡æ˜¯ <code>left</code></li>
<li><code>left</code> å·²ç»ä½œä¸ºå‚æ•°ä¼ å…¥</li>
<li>å‡½æ•°å†…éƒ¨åªå…³å¿ƒå‚æ•°ï¼Œä¸å…³å¿ƒ this</li>
</ul>
<p>å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¼ªä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">return</span> obj.<span class="hljs-property">__proto__</span>
}
</code></pre>
<p>ğŸ‘‰ <strong>è¿™æ˜¯ä¸€ä¸ªçº¯å·¥å…·å‡½æ•°ï¼ˆutility functionï¼‰</strong></p>
<p>æ‰€ä»¥ï¼š</p>
<ul>
<li>ä¸éœ€è¦ <code>call</code></li>
<li>ç”¨ <code>call</code> åè€Œå¤šä½™</li>
</ul>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€ä¸ºä»€ä¹ˆ <code>Object.prototype.toString</code> å¿…é¡»ç”¨ callï¼Ÿ</h2>
<p>å†çœ‹è¿™ä¸ªç»å…¸å†™æ³•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(value)
</code></pre>
<p>ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥è¿™æ ·ï¼Ÿ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">toString</span>(value) <span class="hljs-comment">// âŒ</span>
</code></pre>
<p>å› ä¸ºè¿™ä¸ªæ–¹æ³•çš„è®¾è®¡æ˜¯ï¼š</p>
<ul>
<li><strong>æ²¡æœ‰å‚æ•°</strong></li>
<li>è¦æ£€æŸ¥çš„å¯¹è±¡åªèƒ½æ¥è‡ª <code>this</code></li>
</ul>
<p>ä¼ªä»£ç ç†è§£ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"[object "</span> + å†…éƒ¨ç±»å‹(<span class="hljs-variable language_">this</span>) + <span class="hljs-string">"]"</span>
}
</code></pre>
<p>ğŸ‘‰ å¦‚æœä½ ä¸å‘Šè¯‰å®ƒ <code>this</code> æ˜¯è°ï¼Œå®ƒæ ¹æœ¬ä¸çŸ¥é“è¦æ£€æŸ¥ä»€ä¹ˆã€‚</p>
<p>è¿™å°±æ˜¯ <strong>å¿…é¡»ä½¿ç”¨ <code>call</code> çš„æ ¹æœ¬åŸå› </strong>ã€‚</p>
<hr/>
<h2 data-id="heading-5">å››ã€ä¸€ä¸ªæå…¶é‡è¦çš„åˆ¤æ–­æ ‡å‡†ï¼ˆ80% å‡†ç¡®ï¼‰</h2>
<blockquote>
<p><strong>çœ‹æ–¹æ³•â€œæŒ‚åœ¨å“ªé‡Œâ€</strong></p>
</blockquote>
<h3 data-id="heading-6">âœ… æŒ‚åœ¨æ„é€ å‡½æ•°æœ¬èº«ä¸Šçš„ï¼ˆå‚æ•°å‹ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property">keys</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property">getPrototypeOf</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property">isArray</span>
<span class="hljs-title class_">Math</span>.<span class="hljs-property">max</span>
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><code>Object.xxx</code></li>
<li><code>Array.xxx</code></li>
<li><code>Math.xxx</code></li>
</ul>
<p>ğŸ‘‰ <strong>å‡ ä¹ä¸€å®šæ˜¯å‚æ•°å‹å‡½æ•°</strong></p>
<hr/>
<h3 data-id="heading-7">âœ… æŒ‚åœ¨ prototype ä¸Šçš„ï¼ˆthis å‹ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">push</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>
<span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">call</span>
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><code>xxx.prototype.xxx</code></li>
<li>æ“ä½œâ€œå½“å‰å¯¹è±¡â€</li>
</ul>
<p>ğŸ‘‰ <strong>å‡ ä¹ä¸€å®šä¾èµ– this</strong></p>
<hr/>
<h3 data-id="heading-8">å£è¯€æ€»ç»“ï¼ˆéå¸¸é‡è¦ï¼‰</h3>
<blockquote>
<p><strong>é™æ€æ–¹æ³•ç”¨å‚æ•°ï¼ŒåŸå‹æ–¹æ³•é  this</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-9">äº”ã€æœ€å¯é çš„æ–¹æ³•ï¼šä¸€è¡Œä»£ç éªŒè¯</h2>
<p>å¦‚æœä½ çœŸçš„ä¸ç¡®å®šï¼Œç›´æ¥ç”¨è¿™ä¸€æ‹›ã€‚</p>
<h3 data-id="heading-10">éªŒè¯æ˜¯å¦ä¾èµ– this</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fn = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>
<span class="hljs-title function_">fn</span>() <span class="hljs-comment">// âŒ æŠ¥é”™æˆ–ç»“æœå¼‚å¸¸</span>
</code></pre>
<p>ğŸ‘‰ æ²¡æœ‰ this å°±ä¸èƒ½å·¥ä½œ â†’ this å‹å‡½æ•°</p>
<hr/>
<h3 data-id="heading-11">éªŒè¯æ˜¯å¦ä¾èµ–å‚æ•°</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">const</span> <span class="hljs-variable">fn</span> <span class="hljs-operator">=</span> Object.getPrototypeOf
<span class="hljs-title function_">fn</span><span class="hljs-params">({})</span> <span class="hljs-comment">// âœ… æ­£å¸¸æ‰§è¡Œ</span>
</code></pre>
<p>ğŸ‘‰ this ä¸é‡è¦ â†’ å‚æ•°å‹å‡½æ•°</p>
<hr/>
<h2 data-id="heading-12">å…­ã€ä¸ºä»€ä¹ˆä¸èƒ½â€œæ‰€æœ‰å‡½æ•°éƒ½ç”¨ callâ€ï¼Ÿ</h2>
<p>æŠ€æœ¯ä¸Šå¯ä»¥ï¼Œä½†<strong>è¯­ä¹‰ä¸Šæ˜¯é”™è¯¯çš„</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property">getPrototypeOf</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>, obj)
</code></pre>
<p>é—®é¢˜åœ¨äºï¼š</p>
<ul>
<li>this è¢«å®Œå…¨å¿½ç•¥</li>
<li>ä»£ç å¯è¯»æ€§å˜å·®</li>
<li>è¿èƒŒ JS API çš„è®¾è®¡åˆè¡·</li>
</ul>
<p>ğŸ‘‰ <strong>call çš„å­˜åœ¨æ˜¯ä¸ºäº†è§£å†³ thisï¼Œè€Œä¸æ˜¯ç»Ÿä¸€å†™æ³•</strong></p>
<hr/>
<h2 data-id="heading-13">ä¸ƒã€æ€»ç»“ä¸€å¥è¯ï¼ˆåšå®¢ç»“å°¾ç‰ˆï¼‰</h2>
<blockquote>
<p><strong>JS ä¸­æ˜¯å¦ä½¿ç”¨ <code>call</code>ï¼Œ<br/>
ä¸å–å†³äºâ€œå‡½æ•°é«˜çº§ä¸é«˜çº§â€ï¼Œ<br/>
åªå–å†³äºâ€œè¿™ä¸ªå‡½æ•°æ˜¯å¦ä¾èµ– thisâ€ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-14">å…«ã€ä½ ç°åœ¨å¡ä½ï¼Œå…¶å®éå¸¸æ­£å¸¸</h2>
<p>ä½ ç°åœ¨é‡åˆ°çš„ä¸æ˜¯â€œè¯­æ³•é—®é¢˜â€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>ä»â€œä¼šç”¨ JSâ€ â†’ â€œç†è§£ JS è®¾è®¡â€ çš„è¿‡æ¸¡é˜¶æ®µ</strong></p>
</blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªæ‰€æœ‰ä¸­é«˜çº§ JS å¼€å‘è€…éƒ½å¿…ç»çš„åã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨AIç¼–ç¨‹å¿«ä¸€å¹´äº†ï¼Œåˆ†äº« 10 ä¸ªè®©æˆ‘æ•ˆç‡ç¿»å€çš„ Claude Code æ ¸å¿ƒ Skills]]></title>    <link>https://juejin.cn/post/7603444191448530978</link>    <guid>https://juejin.cn/post/7603444191448530978</guid>    <pubDate>2026-02-06T10:32:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603444191448530978" data-draft-id="7603444191448514594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨AIç¼–ç¨‹å¿«ä¸€å¹´äº†ï¼Œåˆ†äº« 10 ä¸ªè®©æˆ‘æ•ˆç‡ç¿»å€çš„ Claude Code æ ¸å¿ƒ Skills"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2026-02-06T10:32:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aZheçš„å…¨æ ˆçŸ¥è¯†åˆ†äº«"/> <meta itemprop="url" content="https://juejin.cn/user/1039471959105228"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨AIç¼–ç¨‹å¿«ä¸€å¹´äº†ï¼Œåˆ†äº« 10 ä¸ªè®©æˆ‘æ•ˆç‡ç¿»å€çš„ Claude Code æ ¸å¿ƒ Skills
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1039471959105228/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aZheçš„å…¨æ ˆçŸ¥è¯†åˆ†äº«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:32:30.000Z" title="Fri Feb 06 2026 10:32:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è½¬çœ¼åˆ°äº† 2026 å¹´ï¼Œä½¿ç”¨ AI è¾…åŠ©ç¼–ç¨‹å·²ç»å¿«ä¸€å¹´äº†ã€‚ä»æœ€åˆçš„å°é²œåˆ°ç°åœ¨çš„æ·±åº¦ä¾èµ–ï¼ŒClaude Code å·²ç»å®Œå…¨æ”¹å˜äº†æˆ‘çš„å¼€å‘å·¥ä½œæµã€‚</p>
<p>å¾ˆå¤šäººåªæŠŠ Claude Code å½“ä½œä¸€ä¸ªç®€å•çš„é—®ç­”å·¥å…·ï¼Œå…¶å®å®ƒå†…ç½®çš„ Skills æ‰æ˜¯çœŸæ­£çš„ææ•ˆç¥å™¨ã€‚ç»è¿‡è¿™ä¸€å¹´çš„å®æˆ˜æ‘¸ç´¢ï¼Œæˆ‘æ€»ç»“äº†ä½¿ç”¨é¢‘ç‡æœ€é«˜ã€æœ€èƒ½æ‰“çš„ 10 ä¸ªæ ¸å¿ƒ Skillsã€‚ç†Ÿç»ƒæŒæ¡è¿™äº›ï¼Œä½ çš„å¼€å‘æ•ˆç‡è‡³å°‘èƒ½æå‡ 200%ã€‚</p>
<h2 data-id="heading-0">å®‰è£…ä¸åŸºç¡€</h2>
<p>å¦‚æœä½ è¿˜æ²¡ç”¨è¿‡ï¼Œå…ˆå¿«é€Ÿä¸Šæ‰‹ï¼š</p>
<ol>
<li><strong>å®‰è£…</strong>:Â <code>npm install -g @anthropic-ai/claude-code</code></li>
<li><strong>ç™»å½•</strong>:Â <code>claude login</code></li>
<li><strong>ä½¿ç”¨</strong>: åœ¨äº¤äº’ç•Œé¢è¾“å…¥Â <code>/</code>Â åŠ ä¸Š Skill åç§°å³å¯ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-1">ç¬¬ä¸€é˜¶æ®µï¼šè°‹å®šè€ŒååŠ¨ â€”â€” è§„åˆ’ä¸æ¶æ„</h2>
<h3 data-id="heading-2">1. Plan (<code>/plan</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: å®æ–½è§„åˆ’ä¸æ¶æ„è®¾è®¡</p>
<p>è¿™ç»å¯¹æ˜¯è¢«ä½ä¼°çš„ç¥æŠ€ã€‚ä»¥å‰æ‹¿åˆ°éœ€æ±‚å°±æƒ³å†™ä»£ç ï¼Œç»“æœå†™åˆ°ä¸€åŠå‘ç°é€»è¾‘æ¼æ´ã€‚ç°åœ¨æˆ‘éƒ½ä¼šå…ˆç”¨Â <code>/plan</code>ã€‚å®ƒä¸åªæ˜¯åˆ—ä¸ªæ¸…å•ï¼Œè€Œæ˜¯åƒä¸€ä¸ªèµ„æ·±æ¶æ„å¸ˆä¸€æ ·ï¼Œå¸®ä½ æ‹†è§£æ­¥éª¤ã€é¢„åˆ¤é£é™©ã€è®¾è®¡æ¥å£ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: ä¸è¦åªè¯´â€œå¸®æˆ‘åšä¸ªç™»å½•â€ï¼Œè¯•ç€è¯´ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/plan é‡æ„ç”¨æˆ·è®¤è¯æ¨¡å—ï¼Œæ”¯æŒ OAuth2.0ï¼Œéœ€è¦å…¼å®¹ç°æœ‰çš„ JWT é€»è¾‘
</code></pre>
<p>å®ƒç”Ÿæˆçš„è®¡åˆ’ä¹¦ï¼Œå¾€å¾€æ¯”æˆ‘è‡ªå·±æƒ³çš„è¿˜è¦å‘¨å…¨ã€‚</p>
<hr/>
<h2 data-id="heading-3">ç¬¬äºŒé˜¶æ®µï¼šæé€Ÿç¼–ç  â€”â€” è´¨é‡ä¸é€Ÿåº¦å¹¶é‡</h2>
<h3 data-id="heading-4">2. TDD (<code>/tdd</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: æµ‹è¯•é©±åŠ¨å¼€å‘</p>
<p>â€œå…ˆå†™æµ‹è¯•å†å†™ä»£ç â€æ˜¯å¾ˆå¤šäººçš„ç—›ç‚¹ï¼Œå› ä¸ºå†™æµ‹è¯•å¾ˆç¹çã€‚ä½†æœ‰äº†Â <code>/tdd</code>ï¼Œä¸€åˆ‡éƒ½å˜äº†ã€‚å®ƒä¸¥æ ¼éµå¾ªâ€œçº¢-ç»¿-é‡æ„â€æµç¨‹ï¼Œè‡ªåŠ¨å¸®ä½ å†™æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åå®ç°åŠŸèƒ½é€šè¿‡æµ‹è¯•ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: ç”¨å®ƒæ¥å†™å·¥å…·å‡½æ•°æˆ–å¤æ‚é€»è¾‘ç‰¹åˆ«çˆ½ï¼Œä¿è¯ä»£ç ä¸€å‡ºç‚‰å°±æ˜¯å¥å£®çš„ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/tdd å®ç°ä¸€ä¸ªè§£æ CSV æ–‡ä»¶çš„å·¥å…·å‡½æ•°ï¼Œå¤„ç†å„ç§è¾¹ç¼˜æƒ…å†µ
</code></pre>
<h3 data-id="heading-5">3. Commit (<code>/commit</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: æ™ºèƒ½ Git æäº¤</p>
<p>å†™ Commit Message æ˜¯ä»¶æ¯ç‡¥çš„äº‹ï¼Œä½†åˆå¾ˆé‡è¦ã€‚<code>/commit</code>Â ä¼šè‡ªåŠ¨åˆ†æä½ æš‚å­˜åŒºçš„ä»£ç å˜æ›´ï¼Œç”Ÿæˆç¬¦åˆ Conventional Commits è§„èŒƒçš„æäº¤ä¿¡æ¯ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: å®ƒèƒ½ç²¾å‡†è¯†åˆ«ä½ æ˜¯ featã€fix è¿˜æ˜¯ refactorï¼Œæè¿°æ¯”æˆ‘è‡ªå·±å†™çš„è¿˜å‡†ç¡®ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/commit
</code></pre>
<hr/>
<h2 data-id="heading-6">ç¬¬ä¸‰é˜¶æ®µï¼šè´¨é‡å®ˆæŠ¤ â€”â€” å®‰å…¨ä¸ç¨³å®š</h2>
<h3 data-id="heading-7">4. Code Review (<code>/code-review</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: ä»£ç è´¨é‡å®¡æŸ¥</p>
<p>åœ¨è¿™ä¸ª AI ç”Ÿæˆä»£ç çš„æ—¶ä»£ï¼ŒReview å˜å¾—æ¯”ç¼–å†™æ›´é‡è¦ã€‚æ¯æ¬¡å†™å®Œä»£ç ï¼Œæˆ‘éƒ½ä¼šä¹ æƒ¯æ€§æ•²ä¸€ä¸‹Â <code>/code-review</code>ã€‚å®ƒå°±åƒä¸€ä¸ªä¸çŸ¥ç–²å€¦çš„ Tech Leadï¼Œä»å‘½åè§„èŒƒåˆ°æ½œåœ¨ Bugï¼Œç”šè‡³æ€§èƒ½éšæ‚£ï¼Œéƒ½èƒ½ç»™ä½ æªå‡ºæ¥ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">/code-review
</code></pre>
<h3 data-id="heading-8">5. Security Review (<code>/security-review</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: å®‰å…¨æ€§å®¡è®¡</p>
<p>å®‰å…¨é—®é¢˜å¾€å¾€æ˜¯åçŸ¥åè§‰çš„ã€‚è¿™ä¸ª Skill ä¸“æ³¨äºå®‰å…¨é¢†åŸŸï¼ŒæŒ‰ç…§ OWASP Top 10 æ ‡å‡†æ‰«æä½ çš„ä»£ç ã€‚SQL æ³¨å…¥ã€XSSã€æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œå®ƒæ¯”ä½ æ›´æ•æ„Ÿã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: æ¶‰åŠç”¨æˆ·è¾“å…¥æˆ–æ”¯ä»˜æ¥å£æ—¶ï¼Œå¿…é¡»è·‘ä¸€éã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/security-review æ£€æŸ¥åˆšä¿®æ”¹çš„æ”¯ä»˜æ¥å£é€»è¾‘
</code></pre>
<h3 data-id="heading-9">6. Build Fix (<code>/build-fix</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: æ„å»ºä¸ç¼–è¯‘ä¿®å¤</p>
<p>é¢å¯¹ä¸€å †çº¢è‰²çš„æŠ¥é”™ä¿¡æ¯å¤´å¤§å—ï¼Ÿ<code>/build-fix</code>Â ä¸“é—¨ç”¨æ¥è§£å†³ç¼–è¯‘å¤±è´¥ã€ç±»å‹é”™è¯¯ï¼ˆç‰¹åˆ«æ˜¯ TypeScript å’Œ Goï¼‰ã€‚å®ƒä¸æ˜¯çæ”¹ï¼Œè€Œæ˜¯é€šè¿‡æœ€å°åŒ–çš„å˜æ›´è®©é¡¹ç›®æ¢å¤â€œç»¿è‰²â€ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: CI æŒ‚äº†æˆ–è€…æœ¬åœ°è·‘ä¸èµ·æ¥æ—¶ï¼Œç›´æ¥äº¤ç»™å®ƒã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/build-fix è§£å†³å½“å‰çš„ TypeScript ç¼–è¯‘é”™è¯¯
</code></pre>
<h3 data-id="heading-10">7. E2E (<code>/e2e</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: ç«¯åˆ°ç«¯æµ‹è¯•</p>
<p>Playwright å¾ˆå¥½ç”¨ï¼Œä½†å†™è„šæœ¬å¾ˆç´¯ã€‚<code>/e2e</code>Â å¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€è¿è¡Œå’Œç»´æŠ¤ E2E æµ‹è¯•è„šæœ¬ã€‚å®ƒèƒ½æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œï¼Œç¡®ä¿ä½ çš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼ˆæ¯”å¦‚ä¸‹å•ã€æ³¨å†Œï¼‰åœ¨ä»»ä½•æ—¶å€™éƒ½æ˜¯é€šçš„ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">/e2e ä¸ºè´­ç‰©è½¦ç»“ç®—æµç¨‹åˆ›å»ºæµ‹è¯•
</code></pre>
<hr/>
<h2 data-id="heading-11">ç¬¬å››é˜¶æ®µï¼šæŒç»­è¿›åŒ– â€”â€” ç»´æŠ¤ä¸æˆé•¿</h2>
<h3 data-id="heading-12">8. Refactor Clean (<code>/refactor-clean</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: ä»£ç æ¸…ç†ä¸é‡æ„</p>
<p>é¡¹ç›®è·‘ä¹…äº†ï¼Œæ€»ä¼šå †ç§¯å¾ˆå¤šæ­»ä»£ç ã€‚<code>/refactor-clean</code>Â ç»“åˆäº† knip ç­‰å·¥å…·ï¼Œèƒ½ç²¾å‡†è¯†åˆ«å¹¶å®‰å…¨ç§»é™¤æœªä½¿ç”¨çš„å¯¼å‡ºã€å˜é‡å’Œæ–‡ä»¶ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: å®šæœŸè·‘ä¸€æ¬¡ï¼Œç»™ä»£ç åº“â€œç˜¦èº«â€ï¼Œå¿ƒæƒ…éƒ½ä¼šå˜å¥½ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/refactor-clean æ¸…ç† src/utils ç›®å½•ä¸‹çš„æœªä½¿ç”¨ä»£ç 
</code></pre>
<h3 data-id="heading-13">9. Update Docs (<code>/update-docs</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: æ–‡æ¡£è‡ªåŠ¨åŒ–æ›´æ–°</p>
<p>ä»£ç æ”¹äº†ï¼Œæ–‡æ¡£æ²¡æ”¹ï¼Œè¿™æ˜¯å¸¸æ€ã€‚<code>/update-docs</code>Â è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒèƒ½è‡ªåŠ¨åˆ†æä»£ç å˜æ›´ï¼ŒåŒæ­¥æ›´æ–° README å’Œæ¶æ„å›¾ï¼ˆCodemapsï¼‰ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: ä¿æŒæ–‡æ¡£é²œæ´»çš„ç§˜è¯€ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/update-docs
</code></pre>
<h3 data-id="heading-14">10. Learn (<code>/learn</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: æŒç»­å­¦ä¹ ä¸æ¨¡å¼æå–</p>
<p>è¿™æ˜¯ Claude Code æœ€å…·â€œæˆé•¿æ€§â€çš„åŠŸèƒ½ã€‚å½“ä½ è§£å†³äº†ä¸€ä¸ªæ£˜æ‰‹é—®é¢˜ï¼Œæˆ–è€…é€šè¿‡å¯¹è¯ç£¨åˆå‡ºäº†ä¸€å¥—å®Œç¾çš„ Promptï¼Œç”¨Â <code>/learn</code>Â æŠŠå®ƒè®°å½•ä¸‹æ¥ã€‚ä¸‹æ¬¡å®ƒå°±ä¼šè®°ä½ä½ çš„åå¥½å’Œç»éªŒã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: æŠŠ AI å˜æˆä½ ä¸“å±çš„å½¢çŠ¶ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/learn æ€»ç»“è¿™æ¬¡è§£å†³ Next.js è·¯ç”±é—®é¢˜çš„æ–¹æ¡ˆ
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ chatgpt å­¦ä¹ è‹±è¯­ 90/n C16T3L3 Seed germination (ç§å­å‘èŠ½)]]></title>    <link>https://juejin.cn/post/7603563317040136255</link>    <guid>https://juejin.cn/post/7603563317040136255</guid>    <pubDate>2026-02-06T11:34:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563317040136255" data-draft-id="7603587738160070719" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ chatgpt å­¦ä¹ è‹±è¯­ 90/n C16T3L3 Seed germination (ç§å­å‘èŠ½)"/> <meta itemprop="keywords" content="Gemini"/> <meta itemprop="datePublished" content="2026-02-06T11:34:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="VincentHe"/> <meta itemprop="url" content="https://juejin.cn/user/1398234520758189"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ chatgpt å­¦ä¹ è‹±è¯­ 90/n C16T3L3 Seed germination (ç§å­å‘èŠ½)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234520758189/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    VincentHe
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T11:34:56.000Z" title="Fri Feb 06 2026 11:34:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8624b20d6c7e45b48eec3c21eaf3f78a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmluY2VudEhl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770982496&amp;x-signature=zuaTkVveLXU5ALU2gu0oMwF%2Frp0%3D" alt="banner" loading="lazy"/></p>
<h2 data-id="heading-0">å‰‘é›… 13 Test 1 Listening 3 Seed germination (C13T1L3) (ç§å­å‘èŠ½) å¤ç›˜</h2>
<h3 data-id="heading-1">Section 3 Seed germination (C13T1L3)</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fieltscat.xdf.cn%2Fpractice%2Fanalyze%2Flisten%2F6682%2F276B7F251298D34F" target="_blank" title="https://ieltscat.xdf.cn/practice/analyze/listen/6682/276B7F251298D34F" ref="nofollow noopener noreferrer">Listen 3</a></p>
<h4 data-id="heading-2">ç¬¬ 21 é¢˜ï¼š[é€‰æ‹©é¢˜] å®éªŒé€‰é¢˜åŠ¨æœº</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Jack interested</code></li>
<li><code>investigating</code></li>
<li><code>seed germination</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>reason</code> -&gt; <code>reason</code> (Sent 4)</li>
<li><code>do a module</code> -&gt; <code>optional module</code> (Sent 5)</li>
<li><code>later on</code> -&gt; <code>in the third year</code> (Sent 5)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 5</strong>: "Yeah, but practically everything we do is going to feed into that. No, there's an <code>optional module</code> on seed structure and function <code>in the third year</code> that I might do,"</li>
<li><strong>Sentence 6</strong>: "so I thought it <code>might be useful for that</code>."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ A</strong>ï¼šJack æ˜ç¡®æåˆ°å¤§ä¸‰æœ‰ä¸€ä¸ªé€‰ä¿®æ¨¡å—ï¼ˆoptional moduleï¼‰ï¼Œåšè¿™ä¸ªå®éªŒæ˜¯ä¸ºäº†é‚£ä¸ªæ¨¡å—åšå‡†å¤‡ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ B (career)</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ <strong>â€œæ‰¿è®¤ä½†éä¸»è¦åŸå› â€</strong> çš„å¹²æ‰°ã€‚Emma åœ¨ <strong>Sentence 4</strong> æåˆ° "hoping to work in plant science"ï¼ŒJack åœ¨ <strong>Sentence 5</strong> å¼€å¤´è¯´äº† "Yeah"ï¼Œä½†ä»–é©¬ä¸Šç”¨ "<strong>but</strong>... No..." è¿›è¡Œäº†è½¬æŠ˜ã€‚å¯¹äº 5.5 åˆ†å­¦ç”Ÿæ¥è¯´ï¼Œå¬åˆ° "Yeah" å®¹æ˜“è¯¯ä»¥ä¸ºæ˜¯åœ¨ç¡®è®¤ç­”æ¡ˆï¼Œå¿…é¡»è€å¿ƒå¬å®Œç´§æ¥ç€çš„è½¬æŠ˜è¿è¯ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ C (dissertation)</strong>ï¼š<strong>Sentence 6</strong> æåˆ° "I <code>don't</code> have to do a dissertation module"ï¼Œè¿™æ˜¯æ˜ç¡®çš„å¦å®šä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-3">ç¬¬ 22 é¢˜ï¼š[é€‰æ‹©é¢˜] å®éªŒçš„ä¸»è¦ä¼˜åŠ¿</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>main advantage</code></li>
<li><code>present experiment</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>advantage</code> -&gt; <code>good one to choose</code> (Sent 11)</li>
<li><code>completed in the time available</code> -&gt; <code>That should be fine if we start now</code> (Sent 10)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 10</strong>: "<code>That should be fine if we start now</code>. A lot of the other possible experiments need quite a bit longer."</li>
<li><strong>Sentence 11</strong>: "So that'd <code>make it a good one to choose</code>."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ C</strong>ï¼šJack è¯´å¦‚æœç°åœ¨å¼€å§‹æ—¶é—´æ­£å¥½ï¼ˆfineï¼‰ï¼Œè€Œå…¶ä»–å®éªŒéœ€è¦æ›´é•¿æ—¶é—´ï¼ˆneed quite a bit longerï¼‰ï¼ŒEmma æ€»ç»“è¯´è¿™æ˜¯é€‰æ‹©å®ƒçš„å¥½ç†ç”±ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ B (laboratory/equipment)</strong>ï¼š<strong>Sentence 11</strong> ä¸­ Emma æåˆ°äº† "equipment" å’Œ "laboratory"ï¼Œä½†å¥¹è¯´çš„æ˜¯ "that's <code>not really an issue</code>"ï¼ˆé‚£ä¸æ˜¯ä¸ªé—®é¢˜/é‡ç‚¹ï¼‰ã€‚å†² 7 åˆ†å¿…é¡»å­¦ä¼šåŒºåˆ†â€œæåŠçš„ç»†èŠ‚â€å’Œâ€œè¢«å¼ºè°ƒçš„ä¼˜ç‚¹â€ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-4">ç¬¬ 23 é¢˜ï¼š[é€‰æ‹©é¢˜] éœ€è¦è·Ÿå¯¼å¸ˆç¡®è®¤çš„äº‹é¡¹</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>decide to check</code></li>
<li><code>tutor</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>check with their tutor</code> -&gt; <code>have a word with the tutor</code> (Sent 12)</li>
<li><code>anyone else</code> -&gt; <code>the only ones</code> (Sent 13)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 12</strong>: "Yeah. We need to <code>have a word with the tutor</code> if we're going to go ahead with it though."</li>
<li><strong>Sentence 13</strong>: "But we need to be sure we're <code>the only ones</code> doing it."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ B</strong>ï¼šJack è¯´éœ€è¦ç¡®è®¤ä»–ä»¬æ˜¯å”¯ä¸€åšè¿™ä¸ªé¢˜ç›®çš„äººï¼ˆthe only ones doing itï¼‰ï¼Œå¯¹åº”é€‰é¡¹ B ä¸­çš„ anyone elseã€‚</li>
<li><strong>å¹²æ‰°é¡¹ A (aim)</strong>ï¼š<strong>Sentence 12</strong> æåˆ° "I'm sure our aim's OK"ï¼Œæ—¢ç„¶å·²ç» sureï¼ˆç¡®å®šï¼‰äº†ï¼Œå°±ä¸éœ€è¦å†å» checkï¼ˆæ ¸å®ï¼‰ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ C (final grade)</strong>ï¼š<strong>Sentence 13</strong> æåˆ°äº† "ten percent of our final mark"ï¼Œä½†è¿™åªæ˜¯ä»–ä»¬åœ¨è®¨è®ºåˆ†å€¼ï¼Œå¹¶éè¦æ‰¾å¯¼å¸ˆç¡®è®¤çš„å†…å®¹ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-5">ç¬¬ 24 é¢˜ï¼š[é€‰æ‹©é¢˜] å¯¹ Graves ä¹¦ç±çš„è¯„ä»·</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Graves' book</code></li>
<li><code>disappointing</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>book</code> -&gt; <code>The one by Graves</code> (Sent 16)</li>
<li><code>theoretical</code> -&gt; <code>theory</code> (Sent 16)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 16</strong>: "I found it quite hard to follow - <code>lots about the theory</code>, which I hadn't expected."</li>
<li><strong>Sentence 17</strong>: "Yes, I'd been hoping for something more practical."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ C</strong>ï¼šEmma è¯´ä¹¦é‡Œå…¨æ˜¯ç†è®ºï¼ˆtheoryï¼‰ï¼ŒJack é™„å’Œè¯´ä»–åŸæœ¬å¸Œæœ›èƒ½æ›´å®ç”¨ï¼ˆpracticalï¼‰ã€‚è¯æ€§è½¬æ¢ <code>theory</code> (n.) -&gt; <code>theoretical</code> (adj.) æ˜¯é›…æ€æ ¸å¿ƒè€ƒç‚¹ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ A (recent advances)</strong>ï¼š<strong>Sentence 17</strong> æåˆ°ä¹¦é‡Œç¡®å®åŒ…å«äº† "recent findings"ï¼Œæ‰€ä»¥ A é€‰é¡¹è¯´ "fails to cover"ï¼ˆæ²¡åŒ…å«ï¼‰æ˜¯é”™è¯¯çš„ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-6">ç¬¬ 25 é¢˜ï¼š[é€‰æ‹©é¢˜] å¯¹ Lee Hall æ–‡ç« çš„è¯„ä»·</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Jack say</code></li>
<li><code>Lee Hall</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>analysis of statistics</code> -&gt; <code>analysis of figures</code> (Sent 21)</li>
<li><code>thorough</code> -&gt; <code>detail</code> (Sent 21)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 21</strong>: "His <code>analysis of figures</code> comparing the times of the fires and the proportion of seeds that germinated was done in <code>a lot of detail</code> - very impressive."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ B</strong>ï¼š<code>figures</code> æ˜¯ <code>statistics</code> çš„é«˜é¢‘åŒä¹‰è¯ï¼Œ<code>in a lot of detail</code> å¯¹åº” <code>thorough</code>ï¼ˆå½»åº•çš„/è¯¦å°½çš„ï¼‰ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ A (diagrams/illustrations)</strong>ï¼š<strong>Sentence 22</strong> Emma é—®æ˜¯ä¸æ˜¯é‚£ç¯‡æœ‰æ’å›¾ï¼ˆillustrationsï¼‰çš„æ–‡ç« ï¼Œä½† Jack åœ¨ <strong>Sentence 23</strong> çº æ­£è¯´ "I think those diagrams were in <code>another article</code>"ã€‚å¬åˆ°å¦å®šé€»è¾‘ï¼ˆanother articleï¼‰è¦ç«‹åˆ»æ’é™¤ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-7">ç¬¬ 26 é¢˜ï¼š[åŒ¹é…/å¡«ç©º] ç§å­çš„é€‰æ‹©</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Select seeds</code></li>
<li><code>different</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>types</code> -&gt; <code>sorts</code> (Sent 25)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 25</strong>: "So, how many <code>sorts</code> do we need? About four different ones?"</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ G (types)</strong>ï¼šåŸæ–‡ç”¨äº† <code>sorts</code>ï¼Œè¿™æ˜¯ <code>types</code> çš„ç›´æ¥åŒä¹‰è¯ã€‚</li>
<li><strong>å¤‡è€ƒå»ºè®®</strong>ï¼šåœ¨å¬åˆ° vegetable seeds ä¹‹åï¼ŒJack é—®éœ€è¦å¤šå°‘ç§ <code>sorts</code>ï¼Œè¿™é‡Œè¦ååº”è¿‡æ¥æ˜¯æŒ‡ç§ç±»ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-8">ç¬¬ 27 é¢˜ï¼š[åŒ¹é…/å¡«ç©º] æµ‹é‡è®°å½•</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Measure</code></li>
<li><code>record</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>weight</code> -&gt; <code>weighs</code> (Sent 27)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 27</strong>: "Then, for each seed we need to find out <code>how much it weighs</code>, and also measure its dimensions,"</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ C (weight)</strong>ï¼šåŸæ–‡æ˜¯åŠ¨è¯ <code>weighs</code>ï¼Œé¢˜ç›®è¦æ±‚å¡«åè¯ï¼ˆæˆ–è€…é€‰å¯¹åº”çš„åè¯é€‰é¡¹ <code>weight</code>ï¼‰ã€‚è¿™æ˜¯å…¸å‹çš„è¯æ€§è½¬æ¢è€ƒç‚¹ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-9">ç¬¬ 28 é¢˜ï¼š[åŒ¹é…/å¡«ç©º] ç§æ¤æ·±åº¦</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Decide on</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>depths</code> -&gt; <code>how deep</code> (Sent 28)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 28</strong>: "And we also need to decide <code>how deep</code> we're going to plant the seeds"</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ H (depths)</strong>ï¼šåŸæ–‡ç”¨ <code>how deep</code> è¡¨è¾¾æ·±åº¦ï¼Œå¯¹åº”åè¯ <code>depths</code>ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼šç´§æ¥ç€åé¢åˆ—ä¸¾äº† "surface, a few millimetres down..." è¿™äº›éƒ½æ˜¯æ·±åº¦çš„å…·ä½“ä¾‹å­ï¼Œå¸®åŠ©ç¡®è®¤ç­”æ¡ˆã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-10">ç¬¬ 29 é¢˜ï¼š[åŒ¹é…/å¡«ç©º] å®¹å™¨é€‰æ‹©</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Use a different</code></li>
<li><code>each seed</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>container</code> -&gt; <code>plant pot</code> / <code>one</code> (Sent 29-30)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 29</strong>: "Do you think we can plant several seeds together in the same <code>plant pot</code>?"</li>
<li><strong>Sentence 30</strong>: "No. I think we need a <code>different one</code> for each seed."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ A (container)</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª<strong>ä¸Šä¹‰è¯å½’çº³</strong>ã€‚åŸæ–‡è¯´çš„æ˜¯å…·ä½“çš„ <code>plant pot</code>ï¼ˆèŠ±ç›†ï¼‰ï¼ŒEmma è¯´éœ€è¦ä¸åŒçš„ <code>one</code>ï¼ˆæŒ‡ä»£ potï¼‰ã€‚åœ¨é€‰é¡¹ä¸­ï¼Œåªæœ‰ <code>container</code>ï¼ˆå®¹å™¨ï¼‰å¯ä»¥æ¦‚æ‹¬èŠ±ç›†ã€‚</li>
<li><strong>5.5 åˆ†å¸¸è§ç—›ç‚¹</strong>ï¼šä¸€ç›´åœ¨ç­‰ exact wordï¼ˆåŸè¯ï¼‰ï¼Œä½†é›…æ€ 7 åˆ†è¦æ±‚èƒ½è¯†åˆ«ä¸Šä¸‹ä¹‰å…³ç³»ï¼ˆèŠ±ç›†=å®¹å™¨ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-11">ç¬¬ 30 é¢˜ï¼š[åŒ¹é…/å¡«ç©º] å®éªŒç»“æœè®°å½•</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>After about 3 weeks</code></li>
<li><code>record</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>height</code> -&gt; <code>how tall</code> (Sent 32)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 32</strong>: "Then we see if our plants have come up, and write down <code>how tall</code> they've grown."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ E (height)</strong>ï¼šåŸæ–‡ <code>how tall</code> å¯¹åº”åè¯ <code>height</code>ã€‚</li>
<li><strong>å®šä½æŠ€å·§</strong>ï¼šå¬åˆ° <code>three weeks</code> (Sent 32) æ—¶è¦é«˜åº¦è­¦è§‰ï¼Œç­”æ¡ˆç´§éšå…¶åã€‚æ³¨æ„ <code>write down</code> å’Œ <code>record</code> çš„æ›¿æ¢ã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-12">é›…æ€å¬åŠ›çœŸé¢˜è¯æ±‡ç²¾è®²ç¬”è®° (å‰‘é›…13 Test 1 Section 3)</h2>
<p>æœ¬ç¯‡ç¬”è®°æ•´ç†è‡ªå‰‘æ¡¥é›…æ€çœŸé¢˜ 13-1-3 <em>Seed Germination</em> ç›¸å…³çš„è¯æ±‡æ•™å­¦å¯¹è¯ã€‚é‡ç‚¹æ¶µç›–å­¦æœ¯åœºæ™¯æ ¸å¿ƒè¯è¾¨æã€æ˜“æ··æ·†æ‹¼å†™åŠå¬åŠ›é€»è¾‘ä¿¡å·è¯ã€‚</p>
<h3 data-id="heading-13">Dissertation vs Essay vs Thesisï¼šè®ºæ–‡ä¸‰å…„å¼Ÿ</h3>
<p>åœ¨é›…æ€å¬åŠ›å­¦æœ¯åœºæ™¯ä¸­ï¼Œè™½ç„¶éƒ½æŒ‡â€œè®ºæ–‡â€ï¼Œä½†æ ¹æ®ä½œä¸šæ€§è´¨å’Œç¯‡å¹…æœ‰æ˜æ˜¾åŒºåˆ«ã€‚</p>

























<table><thead><tr><th align="left">è¯æ±‡</th><th align="left">æ ¸å¿ƒå«ä¹‰</th><th align="left">é›…æ€å¬åŠ›åœºæ™¯ç‰¹å¾</th></tr></thead><tbody><tr><td align="left"><code>essay</code></td><td align="left">(è¯¾ç¨‹)çŸ­è®ºæ–‡</td><td align="left">é’ˆå¯¹å…·ä½“è¯¾ç¨‹ (Module) çš„ä½œä¸šï¼Œç¯‡å¹…çŸ­ï¼Œä¾§é‡è®ºè¯ã€‚</td></tr><tr><td align="left"><code>dissertation</code></td><td align="left">(å­¦ä½)é•¿è®ºæ–‡</td><td align="left">æœ¬ç§‘æˆ–ç¡•å£«æ¯•ä¸šè®ºæ–‡ï¼Œç¯‡å¹…é•¿ï¼Œéœ€å¤§é‡é˜…è¯»/ç ”ç©¶ã€‚</td></tr><tr><td align="left"><code>thesis</code></td><td align="left">(å­¦ä½)å¤§è®ºæ–‡</td><td align="left">å¸¸ä¸ <code>dissertation</code> äº’æ¢ï¼Œä¸¥è°¨è¯­å¢ƒä¸‹æŒ‡åšå£«è®ºæ–‡æˆ–æ ¸å¿ƒè®ºç‚¹ã€‚</td></tr></tbody></table>
<blockquote>
<p><strong>ğŸ’¡ æ‹¼å†™åŠ©è®°</strong>
<code>dissertation</code> åŒå†™ <code>ss</code>ã€‚
è®°å¿†é€»è¾‘ï¼šå†™è®ºæ–‡éœ€è¦å¤§é‡çš„è®¨è®º (<code>discuss</code>)ï¼Œ<code>discuss</code> æ˜¯åŒ <code>s</code>ï¼Œæ‰€ä»¥ <code>dissertation</code> ä¹Ÿæ˜¯åŒ <code>ss</code>ã€‚æ³¨æ„ä¸­é—´æ˜¯ <code>er</code> ä¸æ˜¯ <code>ar</code>ã€‚</p>
</blockquote>
<ul>
<li><strong>å®é™…åº”ç”¨</strong>ï¼šå¬åˆ° "final year project" æˆ– "degree" å¾€å¾€å¯¹åº” <code>dissertation</code>ï¼›å¬åˆ° "term paper" å¾€å¾€å¯¹åº” <code>essay</code>ã€‚</li>
</ul>
<h3 data-id="heading-14">Dissertation / Dessert / Desertï¼šS çš„æ•°é‡é€»è¾‘</h3>
<p>è¿™ç»„è¯æ±‡æ˜¯æ‹¼å†™å’Œå¬éŸ³çš„é‡ç¾åŒºï¼Œé€šè¿‡é€»è¾‘è”æƒ³è®°å¿†æœ€ä¸ºç¨³å›ºã€‚</p>





























<table><thead><tr><th align="left">è¯æ±‡</th><th align="left">å«ä¹‰</th><th align="left">æ‹¼å†™ç‰¹å¾</th><th align="left">åŠ©è®°æ³• (Memory Hook)</th></tr></thead><tbody><tr><td align="left"><code>dissertation</code></td><td align="left">è®ºæ–‡</td><td align="left">åŒ <code>ss</code></td><td align="left">éœ€è¦ <code>discuss</code> (è®¨è®º)</td></tr><tr><td align="left"><code>dessert</code></td><td align="left">ç”œç‚¹</td><td align="left">åŒ <code>ss</code></td><td align="left">æƒ³åƒ<strong>ä¸¤ä»½</strong> (Two <strong>S</strong>ervings) / <strong>S</strong>uper <strong>S</strong>weet</td></tr><tr><td align="left"><code>desert</code></td><td align="left">æ²™æ¼ </td><td align="left">å• <code>s</code></td><td align="left">æ²™æ¼ è´«ç˜ ï¼Œåªæœ‰<strong>ä¸€ç²’æ²™</strong> (One <strong>S</strong>and)</td></tr></tbody></table>
<ul>
<li><strong>å®é™…åº”ç”¨</strong>ï¼š
<ul>
<li>"I'm worried about my <strong>dissertation</strong> word count." (è®ºæ–‡)</li>
<li>"We ordered a chocolate <strong>dessert</strong>." (ç”œç‚¹)</li>
</ul>
</li>
</ul>
<h3 data-id="heading-15">Eventuallyï¼šå¬åŠ›é€»è¾‘è·¯æ ‡</h3>
<p>è¿™æ˜¯é›…æ€å¬åŠ›ä¸­çš„<strong>ä¿¡å·è¯ (Signpost Word)</strong>ï¼Œç”¨äºæŒ‡ç¤ºâ€œæœ€ç»ˆå†³å®šâ€ï¼Œé€šå¸¸ä¼´éšç€å¯¹ä¹‹å‰è®¡åˆ’çš„å¦å®šã€‚</p>
<ul>
<li><strong>å¬åŠ›é™·é˜±å…¬å¼</strong>ï¼š
Plan A (å¹²æ‰°é¡¹) + But / However + <code>eventually</code> + Plan B (<strong>æ­£ç¡®ç­”æ¡ˆ</strong>)</li>
</ul>
<blockquote>
<p><strong>ğŸ’¡ å¬é¢˜æŠ€å·§</strong>
å¬åˆ° <code>eventually</code>ã€<code>finally</code> æˆ– <code>in the end</code> æ—¶ï¼Œè¯·å¿½ç•¥å‰é¢çš„å†…å®¹ï¼Œç­”æ¡ˆå°±åœ¨è¿™ä¸€å¥ä¹‹åã€‚(æœ¬ç¯‡ä¾‹å¤–)</p>
</blockquote>
<ul>
<li><strong>å®é™…åº”ç”¨</strong>ï¼š
<ul>
<li>å½•éŸ³ï¼š"At first we thought about Consumer Behavior, but <strong>eventually</strong> we realized <code>Market Research</code> would be more relevant."</li>
<li>ç­”æ¡ˆï¼š<code>Market Research</code> (Consumer Behavior æ˜¯å¹²æ‰°é¡¹)ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-16">Figureï¼šä¸€è¯å¤šä¹‰çš„å˜è‰²é¾™</h3>
<p>è¯¥è¯åœ¨å¬åŠ›ä¸åŒ Section ä¸­æœ‰å®Œå…¨ä¸åŒçš„è€ƒç‚¹ã€‚</p>






























<table><thead><tr><th align="left">å«ä¹‰</th><th align="left">å¸¸è§åœºæ™¯</th><th align="left">å…¸å‹ä¾‹å¥</th></tr></thead><tbody><tr><td align="left"><strong>æ•°å­—</strong></td><td align="left">S1 / S4</td><td align="left">"Look at the sales <code>figures</code>." (åŒ <code>number</code>)</td></tr><tr><td align="left"><strong>å›¾è¡¨</strong></td><td align="left">S3 / é˜…è¯»</td><td align="left">"Refer to <code>Figure</code> 2 on page 5." (åŒ <code>chart</code>/<code>diagram</code>)</td></tr><tr><td align="left"><strong>äººç‰©</strong></td><td align="left">å†å²/ä¼ è®°</td><td align="left">"A key historical <code>figure</code>."</td></tr><tr><td align="left"><strong>è®¤ä¸º/æƒ³å‡º</strong></td><td align="left">å£è¯­/åŠ¨è¯</td><td align="left">"<code>Figure out</code> the problem."</td></tr></tbody></table>
<ul>
<li><strong>å®é™…åº”ç”¨</strong>ï¼š
<ul>
<li>"His analysis of <code>figures</code>..." (æ­¤å¤„æŒ‡å¯¹æ•°æ®çš„åˆ†æ)</li>
<li>"Please look at the <code>figure</code> on the screen." (æ­¤å¤„æŒ‡å›¾è¡¨)</li>
</ul>
</li>
</ul>
<h3 data-id="heading-17">Theoretical vs Practicalï¼šå­¦æœ¯å¯¹ç«‹é¢</h3>
<p>é›…æ€å¬åŠ› Section 3 å¸¸è€ƒçš„ä¸€å¯¹åä¹‰è¯ã€‚</p>
<ul>
<li><code>theoretical</code>ï¼šç†è®ºçš„ (æ³¨é‡ Theory)</li>
<li><code>practical</code>ï¼šå®è·µçš„ (æ³¨é‡ Practice)</li>
</ul>
<blockquote>
<p><strong>ğŸ’¡ æ‹¼å†™/å¬è¾¨æç¤º</strong></p>
<ul>
<li><code>theoretical</code>ï¼šæ³¨æ„ä¸­é—´çš„ <code>o</code> (The-<strong>o</strong>-ret-ical)ã€‚</li>
<li><code>practical</code>ï¼šæ³¨æ„ä¸­é—´æœ‰ <code>c</code> (Prac-ti-cal)ï¼Œåˆ‡å‹¿æ‹¼æˆ praticalã€‚</li>
</ul>
</blockquote>
<ul>
<li><strong>å®é™…åº”ç”¨</strong>ï¼š
<ul>
<li>Student: "The course was too <code>theoretical</code>; I wish we had done more <code>practical</code> work."</li>
</ul>
</li>
</ul>
<h3 data-id="heading-18">Irrelevantï¼šå¦å®šçš„å‰ç¼€é™·é˜±</h3>
<p>è¡¨ç¤ºâ€œä¸ç›¸å…³çš„â€ã€â€œä¸åˆ‡é¢˜çš„â€ã€‚</p>
<ul>
<li><strong>æ„è¯</strong>ï¼šPrefix <code>ir-</code> (å¦å®š) + <code>relevant</code>ã€‚</li>
<li><strong>é‡éŸ³</strong>ï¼šè½åœ¨ç¬¬äºŒä¸ªéŸ³èŠ‚ /ÉªËˆ<strong>re</strong>lÉ™vÉ™nt/ã€‚</li>
<li><strong>åŒä¹‰æ›¿æ¢</strong>ï¼šå¬åŠ›ä¸­å¬åˆ° "nothing to do with" æˆ– "unrelated" æ—¶ï¼Œå³å¯¹åº” <code>irrelevant</code>ã€‚</li>
</ul>
<h3 data-id="heading-19">Feed intoï¼šåœ°é“åŠ¨è¯çŸ­è¯­</h3>
<ul>
<li>
<p><strong>å­—é¢ä¹‰</strong>ï¼š(æ²³æµ) æµå…¥ã€‚</p>
</li>
<li>
<p><strong>æŠ½è±¡ä¹‰</strong>ï¼š(ä¸º...) æä¾›èµ„æº / å¯¹...äº§ç”Ÿå½±å“ / è½¬åŒ–ä¸ºã€‚</p>
</li>
<li>
<p><strong>å®é™…åº”ç”¨</strong>ï¼š</p>
<ul>
<li>"Practically everything we do is going to <code>feed into</code> that." (æˆ‘ä»¬åšçš„æ¯ä»¶äº‹æœ€ç»ˆéƒ½ä¼š<strong>åŠ©ç›Š</strong>äºé‚£ä¸ªç›®æ ‡ã€‚)</li>
<li>æ›¿æ¢è¯ï¼š<code>contribute to</code>, <code>influence</code>ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-20">Laboratory &amp; Analysisï¼šæ‹¼å†™â€œæ‰‹æœ¯å°â€</h3>
<p>è¿™ä¸¤ä¸ªè¯æ˜¯å…¸å‹çš„â€œå¬å¾—æ‡‚ã€å†™ä¸å¯¹â€é«˜å±è¯ã€‚</p>
<p><strong>1. <code>laboratory</code> (å®éªŒå®¤)</strong></p>
<ul>
<li><strong>é™·é˜±</strong>ï¼šè‹±éŸ³å¸¸åæ‰ä¸­é—´çš„ <code>o</code> (/lÉ™ËˆbÉ’rÉ™tri/)ï¼Œå¯¼è‡´æ¼å†™ã€‚</li>
<li><strong>åŠ©è®°</strong>ï¼š<code>labor</code> (åŠ³åŠ¨) + a + <code>tory</code> (åœºæ‰€) â†’ å®éªŒå®¤æ˜¯<strong>åŠ³åŠ¨</strong>çš„åœ°æ–¹ã€‚</li>
</ul>
<p><strong>2. <code>analysis</code> (åˆ†æ)</strong></p>
<ul>
<li>
<p><strong>é™·é˜±</strong>ï¼šä¸­é—´æ˜¯ <code>y</code> ä¸æ˜¯ <code>i</code>ï¼›å•å¤æ•°å˜åŒ–ã€‚</p>
</li>
<li>
<p><strong>å˜å½¢è§„åˆ™</strong>ï¼š</p>
<ul>
<li>å•æ•°ï¼š<code>analysis</code> (ç»“å°¾ <code>is</code> â†’ 1)</li>
<li>å¤æ•°ï¼š<code>analyses</code> (ç»“å°¾ <code>es</code> â†’ å¤šï¼Œå‘éŸ³ /siËz/)</li>
</ul>
</li>
<li>
<p><strong>å®é™…åº”ç”¨</strong>ï¼š</p>
<ul>
<li>"We need plenty of equipment in the <code>laboratory</code>."</li>
<li>"His <code>analysis</code> of the data was impressive."</li>
</ul>
</li>
</ul>
<h3 data-id="heading-21">Bonusï¼šå¬åŠ›åŸæ–‡åœ°é“è¡¨è¾¾ (Collocations)</h3>
<p>æºè‡ªå‰‘é›… 13-1-3 åŸæ–‡çš„åœ°é“å£è¯­çŸ­è¯­ã€‚</p>

























<table><thead><tr><th align="left">çŸ­è¯­</th><th align="left">å«ä¹‰</th><th align="left">å¬åŠ›è€ƒç‚¹/åŒä¹‰æ›¿æ¢</th></tr></thead><tbody><tr><td align="left"><code>come up</code></td><td align="left">(ç§å­)å‘èŠ½ï¼Œé•¿å‡º</td><td align="left">å¯¹åº” <code>germinate</code> / <code>grow</code></td></tr><tr><td align="left"><code>have a word with</code></td><td align="left">å’Œ...è°ˆè°ˆ/å•†é‡</td><td align="left">å¯¹åº” <code>consult</code> / <code>speak to</code></td></tr><tr><td align="left"><code>get going with</code></td><td align="left">å¼€å§‹åš...</td><td align="left">å¯¹åº” <code>start</code></td></tr></tbody></table>
<h3 data-id="heading-22">ğŸŒŸ é›…æ€å­¦æœ¯ç»ˆæä¾‹å¥ (The Ultimate Sentence)</h3>
<blockquote>
<p>"After excluding the irrelevant figures from our laboratory analysis, we realized that the remaining data would eventually feed into the theoretical section of my dissertation."</p>
</blockquote>
<p><strong>ğŸ“ ä¸­æ–‡è¯‘æ–‡</strong></p>
<p>â€œåœ¨æ’é™¤äº†æˆ‘ä»¬å®éªŒå®¤åˆ†æä¸­é‚£äº›ä¸ç›¸å…³çš„å›¾è¡¨/æ•°æ®åï¼Œæˆ‘ä»¬æ„è¯†åˆ°å‰©ä¸‹çš„æ•°æ®æœ€ç»ˆå°†æ±‡å…¥ï¼ˆåŠ©ç›Šäºï¼‰æˆ‘å­¦ä½è®ºæ–‡ä¸­çš„ç†è®ºéƒ¨åˆ†ã€‚â€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ Groq ä¸ Elasticsearch è¿›è¡Œæ™ºèƒ½æŸ¥è¯¢]]></title>    <link>https://juejin.cn/post/7603561363571654719</link>    <guid>https://juejin.cn/post/7603561363571654719</guid>    <pubDate>2026-02-06T22:44:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603561363571654719" data-draft-id="7603563317040709695" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ Groq ä¸ Elasticsearch è¿›è¡Œæ™ºèƒ½æŸ¥è¯¢"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2026-02-06T22:44:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ Groq ä¸ Elasticsearch è¿›è¡Œæ™ºèƒ½æŸ¥è¯¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T22:44:01.000Z" title="Fri Feb 06 2026 22:44:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šæ¥è‡ª ElasticÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fmark-puddick" title="https://www.elastic.co/search-labs/author/mark-puddick" target="_blank" ref="nofollow noopener noreferrer">Mark Puddick</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f19c6c7115454bf4bb74fea10cc0210c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=91BIePLGwKrfSaNrlOSKOcA61p0%3D" alt="" loading="lazy"/></p>
<p>å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Groq ä¸ Elasticsearch åœ¨æ¯«ç§’çº§è¿è¡Œ LLM æŸ¥è¯¢å’Œè‡ªç„¶è¯­è¨€æœç´¢ã€‚</p>
<p>Elasticsearch å…·æœ‰ä¸è¡Œä¸šé¢†å…ˆçš„ Gen AI å·¥å…·å’Œæä¾›å•†çš„åŸç”Ÿé›†æˆã€‚æŸ¥çœ‹æˆ‘ä»¬å…³äº<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fvirtual-events%2Fbeyond-rag-basics" title="https://www.elastic.co/virtual-events/beyond-rag-basics" target="_blank" ref="nofollow noopener noreferrer">è¶…è¶Š RAG åŸºç¡€</a>çš„ç½‘ç»œç ”è®¨ä¼šï¼Œæˆ–æ„å»ºç”Ÿäº§å°±ç»ªçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fvirtual-events%2Fvector-databases-fast-track-production" title="https://www.elastic.co/virtual-events/vector-databases-fast-track-production" target="_blank" ref="nofollow noopener noreferrer">Elastic Vector Database</a> åº”ç”¨ã€‚</p>
<p>ä¸ºäº†ä¸ºä½ çš„ä½¿ç”¨åœºæ™¯æ„å»ºæœ€ä½³æœç´¢è§£å†³æ–¹æ¡ˆï¼Œç°åœ¨å°±å¼€å§‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.elastic.co%2Fregistration%3Fonboarding_token%3Dsearch%26cta%3Dcloudregistration%26tech%3Dtrial%26plcmt%3Dcross%2520module%26pg%3Dsearch-labs" title="https://cloud.elastic.co/registration?onboarding_token=search&amp;cta=cloudregistration&amp;tech=trial&amp;plcmt=cross%20module&amp;pg=search-labs" target="_blank" ref="nofollow noopener noreferrer">å…è´¹äº‘è¯•ç”¨</a>ï¼Œæˆ–åœ¨ä½ çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">æœ¬åœ°æœºå™¨</a>ä¸Šå°è¯• Elasticã€‚</p>
<hr/>
<p>åœ¨å°†å¤§è¯­è¨€æ¨¡å‹ï¼ˆ LLMs ï¼‰ä¸ Elastic ç»“åˆä½¿ç”¨æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªæŒ‘æˆ˜æ˜¯æˆ‘ä»¬é€šå¸¸éœ€è¦éå¸¸å¿«çš„ç»“æœã€‚Elastic åœ¨æä¾›æ¯«ç§’çº§å“åº”æ—¶é—´æ–¹é¢æ²¡æœ‰é—®é¢˜ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬å¼•å…¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F134747557" title="https://elasticstack.blog.csdn.net/article/details/134747557" target="_blank" ref="nofollow noopener noreferrer">LLM</a> è°ƒç”¨æ—¶ï¼Œæ€§èƒ½å¯èƒ½ä¼šä¸‹é™åˆ°ä¸å¯æ¥å—çš„æ°´å¹³ã€‚è¿™æ­£æ˜¯ä½¿ç”¨ Groq çš„ç¡¬ä»¶<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Felastic-inference" title="https://www.elastic.co/docs/explore-analyze/elastic-inference" target="_blank" ref="nofollow noopener noreferrer">æ¨ç†</a>åœ¨å°† Elastic ä¸ LLM ç»“åˆæ—¶å¯ä»¥æå¤§æå‡ç»“æœé€Ÿåº¦çš„åœ°æ–¹ã€‚</p>
<p>Groq æ˜¯ä¸€å®¶ä¸“æ³¨äºåœ¨è§„æ¨¡åŒ–åœºæ™¯ä¸‹æä¾›è¶…ä½å»¶è¿Ÿã€ç¡®å®šæ€§ AI æ¨ç†çš„ç¡¬ä»¶å’Œè½¯ä»¶å…¬å¸ã€‚å…¶æ ¸å¿ƒåˆ›æ–°æ˜¯ Groq Language Processing Unitï¼ˆ LPU ï¼‰æ¨ç†å¼•æ“ï¼Œè¿™æ˜¯ä¸€ç§ä¸“é—¨ä¸ºä»¥æé«˜é€Ÿåº¦è¿è¡Œ LLMs å¹¶ä¿æŒå¯é¢„æµ‹æ€§èƒ½è€Œå®šåˆ¶è®¾è®¡çš„èŠ¯ç‰‡æ¶æ„ã€‚ä¸‹é¢çš„é“¾æ¥æä¾›äº†å¯¹ Groq æ¶æ„æ›´è¯¦ç»†çš„æ¦‚è¿°ã€‚</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgroq.com%2Flpu-architecture" title="https://groq.com/lpu-architecture" target="_blank" ref="nofollow noopener noreferrer">Groqï¼š ä»‹ç» LPU</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgroq.com%2Fblog%2Fartificialanalysis-ai-llm-benchmark-doubles-axis-to-fit-new-groq-lpu-inference-engine-performance-results" title="https://groq.com/blog/artificialanalysis-ai-llm-benchmark-doubles-axis-to-fit-new-groq-lpu-inference-engine-performance-results" target="_blank" ref="nofollow noopener noreferrer">Groqï¼š æ–°çš„ LLM æ¨ç†åŸºå‡†</a></li>
</ul>
<p>ä¸ä¼ ç»ŸåŸºäº GPU çš„ç³»ç»Ÿä¸åŒï¼ŒGroq é¢å‘æ¨ç†çš„ä¸“ç”¨æ¶æ„å¯ä»¥ä»¥ç©ºå‰çš„ååé‡å¤„ç† tokenï¼ŒåŒæ—¶å“åº”æ—¶é—´çš„æ³¢åŠ¨æå°ã€‚è¿™ç›´æ¥è§£å†³äº†é€šå¸¸ä¼šæ‹–æ…¢ä¼ ç»Ÿ LLM è°ƒç”¨çš„å†…å­˜å¸¦å®½ç“¶é¢ˆå’Œè°ƒåº¦å¼€é”€ï¼Œç¡®ä¿å°† LLM ä¸ Elastic çš„æœç´¢ç»“æœé›†æˆæ—¶ä»èƒ½ä¿æŒå®æ—¶çš„ç”¨æˆ·ä½“éªŒã€‚Groq é€šè¿‡ GroqCloud æä¾›è¿™ç§è¡Œä¸šé¢†å…ˆçš„é€Ÿåº¦å’Œæ€§èƒ½ï¼ŒGroqCloud æ˜¯ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„ tokens-as-a-service å¹³å°ï¼Œå¹¶ä¸”é€šå¸¸å…·æœ‰æœ€ä½³çš„æ€§èƒ½ä»·æ ¼æ¯”ã€‚</p>
<p>è®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªå¸¸è§çš„æ™ºèƒ½æŸ¥è¯¢å±‚è¯·æ±‚æ¨¡å¼ï¼Œä»¥åŠæˆ‘ä»¬å¯ä»¥ä»ä¸­è·å¾—å“ªäº›æ”¹è¿›ã€‚</p>
<h2 data-id="heading-0">è‡ªç„¶è¯­è¨€æœç´¢</h2>
<p>è‡ªä» LLMs å¹¿æ³›åº”ç”¨ä»¥æ¥ï¼Œä¸€ä¸ªå¸¸è§çš„æœç´¢éœ€æ±‚æ˜¯èƒ½å¤Ÿä½¿ç”¨è‡ªç„¶è¯­è¨€è¿›è¡Œç‰¹å®šé¢†åŸŸæœç´¢ã€‚ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F134396254" title="https://elasticstack.blog.csdn.net/article/details/134396254" target="_blank" ref="nofollow noopener noreferrer">RAG</a>ï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰å·¥ä½œæµä¸­è¿›è¡Œç®€å•çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F145485873" title="https://elasticstack.blog.csdn.net/article/details/145485873" target="_blank" ref="nofollow noopener noreferrer">è¯­ä¹‰æœç´¢</a>ï¼›ç„¶è€Œï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™å¹¶ä¸èƒ½æä¾›ç†æƒ³çš„ç»“æœã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºé—®é¢˜ä¸­å­˜åœ¨éœ€è¦è½¬æ¢ä¸ºæŸ¥è¯¢è¯çš„ç‰¹å®šå±æ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è®© LLM ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œçš„æŸ¥è¯¢ã€‚ç„¶è€Œï¼Œè¿™ä»ç„¶å­˜åœ¨å¾ˆå¤§é”™è¯¯ç©ºé—´ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å‘ç°ä¸ºå·¥å…·æä¾›ç‰¹å®šé¢†åŸŸçš„å‚æ•°å¹¶ä¸ LLM é…åˆä½¿ç”¨å¯ä»¥å¾—åˆ°æœ€ä½³ç»“æœã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F151350072" title="https://elasticstack.blog.csdn.net/article/details/151350072" target="_blank" ref="nofollow noopener noreferrer">è¿™ç¯‡åšå®¢</a>ã€‚</p>
<p>ä¸ºäº†å®šä¹‰ agentï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹ promptï¼š</p>
<pre><code class="hljs language-sql" lang="sql">`

<span class="hljs-number">1.</span>  You <span class="hljs-keyword">are</span> a helpful banking transaction agent. You help users <span class="hljs-keyword">search</span> <span class="hljs-keyword">and</span> analyze their banking transactions.

<span class="hljs-number">3.</span>  <span class="hljs-keyword">Current</span> <span class="hljs-type">date</span>: {<span class="hljs-built_in">current_date</span>}

<span class="hljs-number">5.</span>  <span class="hljs-keyword">When</span> users ask about transactions, use the appropriate tools:
<span class="hljs-number">6.</span>  <span class="hljs-operator">-</span> Use trans<span class="hljs-operator">-</span><span class="hljs-keyword">search</span> <span class="hljs-keyword">for</span> finding <span class="hljs-keyword">specific</span> transactions

<span class="hljs-number">8.</span>  <span class="hljs-keyword">For</span> <span class="hljs-type">date</span> <span class="hljs-keyword">references</span>:
<span class="hljs-number">9.</span>  <span class="hljs-operator">-</span> "last month" <span class="hljs-operator">=</span> past <span class="hljs-number">30</span> days <span class="hljs-keyword">from</span> today
<span class="hljs-number">10.</span>  <span class="hljs-operator">-</span> "this month" <span class="hljs-operator">=</span> <span class="hljs-keyword">current</span> <span class="hljs-keyword">month</span> <span class="hljs-keyword">from</span> <span class="hljs-number">1</span>st <span class="hljs-keyword">to</span> today
<span class="hljs-number">11.</span>  <span class="hljs-operator">-</span> "last week" <span class="hljs-operator">=</span> past <span class="hljs-number">7</span> days
<span class="hljs-number">12.</span>  <span class="hljs-operator">-</span> "this year" <span class="hljs-operator">=</span> January <span class="hljs-number">1</span>st <span class="hljs-keyword">of</span> <span class="hljs-keyword">current</span> <span class="hljs-keyword">year</span> <span class="hljs-keyword">to</span> today

<span class="hljs-number">14.</span>  <span class="hljs-keyword">By</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">set</span> the make the <span class="hljs-keyword">to</span> <span class="hljs-type">date</span> today <span class="hljs-keyword">and</span> the <span class="hljs-keyword">from</span> <span class="hljs-type">date</span> <span class="hljs-number">1</span> <span class="hljs-keyword">year</span> ago
<span class="hljs-number">15.</span>  Common categories: groceries, dining, gas, shopping, entertainment, utilities, healthcare, transportation, travel, subscriptions, insurance, phone, internet

`AIå†™ä»£ç <span class="hljs-operator">!</span>[](https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>csdnimg.cn<span class="hljs-operator">/</span><span class="hljs-keyword">release</span><span class="hljs-operator">/</span>blogv2<span class="hljs-operator">/</span>dist<span class="hljs-operator">/</span>pc<span class="hljs-operator">/</span>img<span class="hljs-operator">/</span>runCode<span class="hljs-operator">/</span>icon<span class="hljs-operator">-</span>arrowwhite.png)
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d0237c1c76c4b96822a9c818a51c867~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=WvlofFa1I%2FlBRUlu4NkBInWQuZE%3D" alt="" loading="lazy"/></p>
<p>è¿™ç»™æˆ‘ä»¬å¸¦æ¥äº†ä¸é”™çš„ç»“æœï¼Œä½†ç”±äº LLM è°ƒç”¨ï¼Œæˆ‘ä»¬çš„æœç´¢æ—¶é—´ä»ä¸åˆ° 100ms å¢åŠ åˆ°è¶…è¿‡ 1 ç§’ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Groq çš„ç¡¬ä»¶æ¨ç†åœ¨æ›´çŸ­çš„æ—¶é—´å†…è¿è¡Œæ­¤æŸ¥è¯¢ã€‚è¦è¿è¡Œè¿™ä¸ªç¤ºä¾‹ï¼Œä½ éœ€è¦<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.groq.com%2Fhome" title="https://console.groq.com/home" target="_blank" ref="nofollow noopener noreferrer">æ³¨å†Œä¸€ä¸ª Groq è´¦æˆ·</a>ã€‚</p>
<p>ç„¶åä½ å¯ä»¥ä»å³ä¸Šè§’èœå•ç”Ÿæˆä¸€ä¸ª API keyï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46151d89654c4dc5bc3765adba479f0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=dTyZAtfHHVgExbiL%2Fmc4sw70h3M%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarkpudd%2Ftransaction_search_mcp" title="https://github.com/markpudd/transaction_search_mcp" target="_blank" ref="nofollow noopener noreferrer">è¿™é‡Œ</a>åˆ›å»ºäº†è¿™ä¸ªå·¥å…·ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ‰§è¡Œæœç´¢ã€‚</p>
<p>å…‹éš†ä¸Šè¿° repo åï¼Œä½ éœ€è¦æ›´æ–° .env æŒ‡å‘ Groqï¼š</p>
<pre><code class="hljs language-ini" lang="ini">`

<span class="hljs-attr">1.  OPENAI_API_KEY</span>=gsk-........

<span class="hljs-attr">3.  OPENAI_API_BASE</span>=https://api.groq.com/openai/v1

<span class="hljs-attr">5.  OPENAI_MODEL</span>=openai/gpt-oss-<span class="hljs-number">20</span>b

`AIå†™ä»£ç 
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨äº† 20b gpt-oss æ¨¡å‹ï¼Œå› ä¸ºè¿™å¯ä»¥æä¾›å‡†ç¡®çš„ç»“æœã€‚å¯¹äºè¿™ç§ç±»å‹çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨æ›´å¤§çš„æ¨¡å‹å‡ ä¹æ²¡æœ‰ä»»ä½•æ”¶ç›Šã€‚</p>
<p>ç°åœ¨ï¼Œä»æµ‹è¯•æƒ…å†µæ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ UI ä½¿ç”¨ prompt è°ƒç”¨è¯¥å·¥å…·è¿è¡Œï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc52397e442a4a54b93648920122c95b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=F1GDS332%2FIlUBYmy%2FICZfjhnIjE%3D" alt="" loading="lazy"/></p>
<p>ä¸ºäº†æµ‹è¯•æ—¶é—´ï¼Œæˆ‘ä»¬å°†è¿è¡Œè¯¥å·¥å…· 50 æ¬¡ï¼Œå¹¶è®¡ç®—æ€»å“åº”ã€LLM å’Œ Groq çš„å¹³å‡å€¼ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ ChatGPT-4.1-nano å’Œ Groq OSS-20b æ¨¡å‹ã€‚ä»¥ä¸‹æ˜¯æ­¤æ¬¡æµ‹è¯•çš„ç»“æœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a18dc07e089843279e2f19eff9f1e7ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=S7H%2F1rht2YY9ZWAlUDKmv1IJiH4%3D" alt="" loading="lazy"/></p>
<p>æ˜¾ç„¶ï¼Œé€šè¿‡ä½¿ç”¨ Groq çš„ç¡¬ä»¶æ¨ç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤§çº¦ä¸€ç§’çš„å»¶è¿Ÿé™ä½ã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨äº†ä¸€ä¸ªè¾ƒå°çš„æ¨¡å‹ï¼Œå¯¹äºè¿™ä¸ªä½¿ç”¨åœºæ™¯ï¼Œå®ƒä»ç„¶æä¾›äº†è‰¯å¥½çš„ç»“æœã€‚å°†å“åº”æ—¶é—´ä» 1.5 ç§’é™ä½åˆ° 250ms åï¼Œé€šå¸¸å¯ä»¥æ»¡è¶³è®¸å¤šç»„ç»‡çš„æœåŠ¡ç­‰çº§åè®®ï¼ˆSLAï¼‰è¦æ±‚ã€‚</p>
<h2 data-id="heading-1">Elastic Agent Builder</h2>
<p>æˆ‘ä»¬å·²ç»å±•ç¤ºäº†è¿™ä¸ä»…å¯ä»¥ç”¨æ¥åŠ é€Ÿ Elastic çš„è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fmachine-learning%2Fnlp%2Fml-nlp-overview" title="https://www.elastic.co/docs/explore-analyze/machine-learning/nlp/ml-nlp-overview" target="_blank" ref="nofollow noopener noreferrer">NLP</a>ï¼‰æœç´¢ï¼Œè¿˜å¯ä»¥ç”¨æ¥åŠ é€Ÿ Elastic <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Felasticsearch%2Fagent-builder" title="https://www.elastic.co/elasticsearch/agent-builder" target="_blank" ref="nofollow noopener noreferrer">Agent Builder</a>ã€‚Agent Builder æœ€è¿‘å‘å¸ƒäº†æŠ€æœ¯é¢„è§ˆç‰ˆï¼Œç°åœ¨å¯ä»¥é€šè¿‡ Groq ç«¯ç‚¹è¿æ¥ Groqã€‚Agent Builder åœ¨ Elastic 9.1+ å¯ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰ä½¿ç”¨çš„ç›¸åŒ API keyã€‚</p>
<p>ä»¥ä¸‹æ˜¯è®¾ç½®æ–¹æ³•ï¼š<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20f784c300444a039cae542551d60820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=1dmI7sKrHCe8oIycspQJYtW2%2FpE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5b507aedc84e33a98c73f48c7a3f5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=bJ7%2BluLhV0eWqEmqmZ7CiJFZuag%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœä½ ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud%2Fserverless" title="https://www.elastic.co/cloud/serverless" target="_blank" ref="nofollow noopener noreferrer">serverless</a>ï¼Œä½ éœ€è¦ä» Stack Management Connectors é¡µé¢åˆ›å»ºä¸€ä¸ªæ–°çš„ connectorã€‚é¦–å…ˆï¼Œç‚¹å‡» AI Connectorã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f934a9f3582a4def9117f13c98aaa981~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=w8IfXWJo8APQLgf60erLM0kUwZs%3D" alt="" loading="lazy"/></p>
<p>åœ¨ä¸‹ä¸€ä¸ªç•Œé¢ï¼Œé€‰æ‹© Groq ä½œä¸ºæœåŠ¡ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa1f4ac933ef4ba2a0e447fbd2a46538~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=KSaaGic3zRBNI%2Fh0LXznDxLhCcU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97fa7639ed394809bd7b8ddafbac3732~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=ZJHmSYPRHoUevi7S7EZmOjzEkTU%3D" alt="" loading="lazy"/></p>
<p>ç„¶åä½ å¯ä»¥è®¾ç½®è¦ä½¿ç”¨çš„æ¨¡å‹ã€‚æ”¯æŒçš„æ¨¡å‹åˆ—åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.groq.com%2Fdocs%2Fmodels" title="https://console.groq.com/docs/models" target="_blank" ref="nofollow noopener noreferrer">Groq ç½‘ç«™</a>ä¸Šã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce4e0c0d0e5144f48c6a588527724072~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=uoF4sGEyakcjg9v9kFVT7g3y4io%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœä½ éœ€è¦æ·»åŠ ä½ çš„ organization IDï¼Œå¯ä»¥åœ¨ <strong>Settings</strong> ä¸‹å±•å¼€ <strong>More options</strong> æ·»åŠ ã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ‰˜ç®¡ç‰ˆ Elasticï¼Œåœ¨æœ¬æ–‡æ’°å†™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Groq ä¸Šä¸ OpenAI å…¼å®¹çš„ç«¯ç‚¹è¿æ¥ Elasticã€‚ä¸ºæ­¤ï¼Œé€‰æ‹© OpenAI æœåŠ¡ï¼Œå¹¶ä½¿ç”¨æŒ‡å‘ Groq URL çš„è‡ªå®šä¹‰ URLï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7af0e0d0d7f049358a447635c1da9cf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=kFpJtx29BUTxtTk4pY2xYr24Td8%3D" alt="" loading="lazy"/></p>
<p>ä¸€æ—¦ä½ ä½¿ç”¨ä¸Šè¿°ä»»ä¸€æ–¹æ³•è®¾ç½®äº† Groqï¼Œè¿›å…¥ GenAI Settings å¹¶å°† Groq è®¾ç½®ä¸ºé»˜è®¤ GenAIã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9dc307599a14ff3aca4e955e66d13ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=STCywcuvnlbPyLVi5L3BWjcX4rM%3D" alt="" loading="lazy"/></p>
<p>Agent Builder ç°åœ¨å°†é»˜è®¤ä½¿ç”¨ Groq connectorã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯ä»¥åœ¨ Agent Builder ä¸­å¤åˆ¶ NLP æœç´¢å¹¶ä½¿ç”¨ Groqã€‚</p>
<p>ä¸ºäº†åˆ›å»º agentsï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä¸º agent æä¾›ä¸€äº›å·¥å…·ã€‚åœ¨ Agent Builder ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å†…ç½®å·¥å…·æˆ–åˆ›å»ºè‡ªå·±çš„å·¥å…·ã€‚è®¸å¤šå†…ç½®å·¥å…·åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fai-features%2Fagent-builder%2Ftools%2Fbuiltin-tools-reference" title="https://www.elastic.co/docs/explore-analyze/ai-features/agent-builder/tools/builtin-tools-reference" target="_blank" ref="nofollow noopener noreferrer">æ­¤å¤„</a>æœ‰æ–‡æ¡£è¯´æ˜ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·è¿›è¡Œäº¤æ˜“æœç´¢ã€‚LLM å°†ä½¿ç”¨å†…ç½®å·¥å…·ï¼Œå¦‚ <code>index_explorer</code>ã€<code>generate_esql</code> å’Œ <code>execute_esql</code>ï¼Œå®ƒä»¬ä¼šå°è¯•æ‰¾åˆ°ç›¸å…³çš„ç´¢å¼•ã€æ£€æŸ¥ç»“æ„ï¼Œå¹¶æ‰§è¡Œç”Ÿæˆçš„ Elasticsearch Query Languageï¼ˆ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fquery-filter%2Flanguages%2Fesql" title="https://www.elastic.co/docs/explore-analyze/query-filter/languages/esql" target="_blank" ref="nofollow noopener noreferrer">ES|QL</a> ï¼‰æŸ¥è¯¢ã€‚ç„¶è€Œï¼Œè¿™ä¼šå¸¦æ¥ä¸€äº›æŒ‘æˆ˜ï¼š</p>
<ul>
<li>è¿è¡Œ agent çš„æ—¶é—´ä¼šæ˜¾è‘—å¢åŠ ï¼Œå› ä¸ºä¼šæœ‰å¤šä¸ªæ¨ç†æ­¥éª¤å’Œå·¥å…·æ‰§è¡Œã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨ Groq è·å–æ›´å¿«çš„ç»“æœï¼Œè¿™å¹¶ä¸ç†æƒ³ã€‚</li>
<li>éšç€æ­¥éª¤æ•°é‡å’Œå·¥å…·ä½¿ç”¨çš„å¢åŠ ï¼Œæˆ‘ä»¬å°†æ¶ˆè€—æ›´å¤šçš„ tokenï¼Œä»è€Œå¢åŠ æˆæœ¬ã€‚</li>
</ul>
<p>ä¸ºé¿å…ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°å·¥å…·ï¼Œä¸“é—¨ç”¨äºæœç´¢äº¤æ˜“ã€‚åœ¨æœ¬æ–‡æ’°å†™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰ç§ç±»å‹çš„å·¥å…·ï¼š</p>
<ul>
<li>ES|QL å·¥å…·ï¼šå…è®¸ä½ ä½¿ç”¨æ¨¡æ¿åŒ–çš„ ES|QL å®šä¹‰æŸ¥è¯¢ã€‚</li>
<li>Index æœç´¢å·¥å…·ï¼šå…è®¸ä½ æä¾›ç´¢å¼•ï¼ŒLLM åˆ›å»ºæŸ¥è¯¢ã€‚</li>
<li>Model Context Protocolï¼ˆMCPï¼‰å·¥å…·ï¼šå…è®¸ä½ é€šè¿‡ MCP ä½¿ç”¨å¤–éƒ¨å·¥å…·ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„ MCP å·¥å…·ï¼›ç„¶è€Œï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ index æœç´¢å·¥å…·ã€‚ä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è®¾ç½®ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5259935ffdb0441a9e78a75fafd06eed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=uJihVfBGDDT7KLOJcPMzLNeKw4w%3D" alt="" loading="lazy"/></p>
<p>åˆ›å»ºå·¥å…·åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Agent Builder ä¸­åˆ›å»ºä¸€ä¸ª agentã€‚ä¸ºæ­¤ï¼Œç‚¹å‡» Create agent æŒ‰é’®ï¼Œå¹¶æŒ‰ç…§ä¸‹å›¾å¡«å†™ä¿¡æ¯ï¼Œä½¿ç”¨æˆ‘ä»¬åœ¨åŸå§‹ç¤ºä¾‹ä¸­ä½¿ç”¨çš„ promptï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f4ec7e7cc6545f5adc383ae391bd1b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=xOdxxWEqQSVy2dzA77WRt%2FlgmLk%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬è¿˜éœ€è¦é€‰æ‹©æˆ‘ä»¬åˆ›å»ºçš„å·¥å…·ä½œä¸º agent çš„ä¸€éƒ¨åˆ†ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4afa82f1562546e39d585a78d2da683a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=ur80Ws9hpfYMMBkzTvDjY7KsOqg%3D" alt="" loading="lazy"/></p>
<p>ç„¶ååœ¨ Agent Builder UI ä¸­æµ‹è¯•ï¼Œé€šè¿‡æå‡ºå‡ ä¸ªä¸åŒçš„é—®é¢˜ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/409dd2649c1f48c79c985deda0860300~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=PusH%2BpyxJaq6NMNv63t0pz%2FB98k%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe3ca158e81945abb60dc79b02d1f40d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=sMAZ1Mq9LQCffqKRWAMQI%2F4d5hw%3D" alt="" loading="lazy"/></p>
<p>é€šè¿‡ Agent Builderï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥è·å¾—æ›´å¤šåŠŸèƒ½ï¼Œå› ä¸ºå®ƒå¯ä»¥æ ¹æ®æˆ‘ä»¬é€‰æ‹©çš„é¢å¤–å†…ç½®å·¥å…·åˆ›å»ºé¢å¤–æŸ¥è¯¢ã€‚å”¯ä¸€çš„çœŸæ­£ç¼ºç‚¹æ˜¯æ•´ä½“å›ç­”é—®é¢˜çš„æ—¶é—´å¯èƒ½æ›´é•¿ï¼Œå› ä¸º LLM èƒ½åšæ›´å¤šæ“ä½œã€‚åŒæ ·ï¼Œè¿™ä¹Ÿæ˜¯ Groq å¯ä»¥æä¾›å¸®åŠ©çš„åœ°æ–¹ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨ Agent Builder ä¸­ä½¿ç”¨ Groq çš„æ€§èƒ½å·®å¼‚ã€‚</p>
<h2 data-id="heading-2">Agent Builder ä¸­ Groq çš„æ€§èƒ½</h2>
<p>Agent Builder çš„ä¸€ä¸ªå¾ˆæ£’çš„åŠŸèƒ½æ˜¯å®ƒå¼€ç®±å³ç”¨æ”¯æŒ MCP å’Œ agent-to-agentï¼ˆA2Aï¼‰ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹è¿›è¡Œä¸€äº›ç®€å•çš„åŸºå‡†æµ‹è¯•ã€‚é€šè¿‡ A2Aï¼Œæˆ‘ä»¬å¯ä»¥æ›¿æ¢ UI å’Œæµ‹è¯•ç¯å¢ƒä¸­çš„å†…ç½® agentã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ Elastic LLM å’Œ Groq ä¸­çš„å‡ ä¸ªä¸åŒæ¨¡å‹æµ‹è¯• Agent Builderã€‚</p>
<p>æœ‰ä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarkpudd%2Fa2a_chat" title="https://github.com/markpudd/a2a_chat" target="_blank" ref="nofollow noopener noreferrer">æ›´æ–°çš„ repo</a>ï¼Œå…¶ä¸­åŒ…å«åŸºå‡†æµ‹è¯•è„šæœ¬ã€‚</p>
<p>ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬å°†æå‡ºé—®é¢˜ï¼š</p>
<p>æˆ‘åœ¨æ±½æ²¹ä¸ŠèŠ±äº†å¤šå°‘é’±ï¼Ÿ</p>
<p>æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<table><thead><tr><th/><th>Groq -openai/gpt-oss-120b</th><th>Groq llama-3.3-70b-versatile</th><th>Elastic LLM</th></tr></thead><tbody><tr><td>Min: 6.040s</td><td>6.04</td><td>4.433</td><td>15.962</td></tr><tr><td>Max: 9.625s</td><td>9.625</td><td>7.986</td><td>24.037</td></tr><tr><td>Mean: 7.862s</td><td>7.862</td><td>6.216</td><td>17.988</td></tr><tr><td>Median: 7.601s</td><td>7.601</td><td>6.264</td><td>17.027</td></tr><tr><td>StdDev: 1.169s</td><td>1.169</td><td>1.537</td><td>2.541</td></tr></tbody></table>
<p>å¦‚ä½ æ‰€è§ï¼Œå†…ç½®çš„ Elastic LLM è¡¨ç°ä¸é”™ï¼Œä½† Groq å¹³å‡ä»å¿«äº†è¿‘ 3 å€ã€‚ä½ ä¼šæ³¨æ„åˆ°æ•´ä½“é€Ÿåº¦æ¯”å¤–éƒ¨åº”ç”¨æ…¢å¾—å¤šã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ Agent Builder ä¸­è®¾ç½®å·¥å…·æ—¶ä»…ä½¿ç”¨äº† indexã€‚å› æ­¤ï¼Œå¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨äº† Agent Builder çš„æ¨ç†ä¸Šï¼ˆå³æ£€æŸ¥ indexï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡æ¿åŒ–çš„ ES|QL å·¥å…·æ›¿ä»£ indexï¼Œè¿™å°†ä½¿ç»“æœæ›´æ¥è¿‘å¤–éƒ¨åº”ç”¨ã€‚</p>
<h2 data-id="heading-3">ç»“è®º</h2>
<p>æ˜¾è€Œæ˜“è§ï¼Œé€šè¿‡å°† Groq ä¸ Elastic ç»“åˆä½¿ç”¨ï¼Œæˆ‘ä»¬å¼€å¯äº†ä¸€ç³»åˆ—æ–°çš„å¯èƒ½æ€§ï¼Œå…¶ä¸­é€Ÿåº¦æ˜¯ä¸€ä¸ªé‡è¦å› ç´ ã€‚æœ¬æ–‡ä»‹ç»äº†åŸºæœ¬çš„æ™ºèƒ½æŸ¥è¯¢ç¤ºä¾‹ï¼Œä½†è¿˜æœ‰è®¸å¤šå…¶ä»–åº”ç”¨ï¼Œå¦‚å›¾åƒç†è§£ã€æ‘˜è¦å’Œå­—å¹•ç”Ÿæˆï¼Œè¿™äº›åœ¨é€Ÿåº¦æå‡ 10 å€çš„æƒ…å†µä¸‹éƒ½å˜å¾—å¯è¡Œã€‚</p>
<p>åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Fgroq-elasticsearch" title="https://www.elastic.co/search-labs/blog/groq-elasticsearch" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labsâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[316. Java Stream API - æ”¶é›†ä¸º Mapï¼šä½¿ç”¨ Collectors.toMap()]]></title>    <link>https://juejin.cn/post/7603581886149967926</link>    <guid>https://juejin.cn/post/7603581886149967926</guid>    <pubDate>2026-02-07T00:35:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603581886149967926" data-draft-id="7603563317040775231" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="316. Java Stream API - æ”¶é›†ä¸º Mapï¼šä½¿ç”¨ Collectors.toMap() "/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T00:35:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CacheæŠ€æœ¯åˆ†äº«"/> <meta itemprop="url" content="https://juejin.cn/user/1662117313262776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            316. Java Stream API - æ”¶é›†ä¸º Mapï¼šä½¿ç”¨ Collectors.toMap() 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117313262776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CacheæŠ€æœ¯åˆ†äº«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T00:35:23.000Z" title="Sat Feb 07 2026 00:35:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">316. Java Stream API - æ”¶é›†ä¸º Mapï¼šä½¿ç”¨ <code>Collectors.toMap()</code></h2>
<p>é™¤äº†å‰é¢è®²è¿‡çš„ <code>groupingBy()</code> æ”¶é›†å™¨ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªå¼ºå¤§çš„ä¼™ä¼´ï¼š<code>Collectors.toMap()</code>ï¼Œç”¨äºå°† Stream ä¸­çš„å…ƒç´ è½¬æ¢ä¸ºä¸€ä¸ªçœŸæ­£çš„é”®å€¼å¯¹æ˜ å°„ï¼ˆMapï¼‰ã€‚è¿™ä¸€æ–¹æ³•éå¸¸é€‚åˆæ„å»ºç¼“å­˜ã€ç´¢å¼•æˆ–è€…å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„ã€‚</p>
<hr/>
<h4 data-id="heading-1">âœ¨ åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼šä¸¤ä¸ªå‡½æ•°æå®šé”®å’Œå€¼</h4>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹åŸºç¡€è¯­æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java">Map&lt;K, V&gt; map = stream.collect(Collectors.toMap(keyMapper, valueMapper));
</code></pre>
<ul>
<li><code>keyMapper</code>ï¼šç”¨äºç”Ÿæˆ Map çš„ keyã€‚</li>
<li><code>valueMapper</code>ï¼šç”¨äºç”Ÿæˆ Map çš„ valueã€‚</li>
</ul>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼šå¦‚æœå¤šä¸ªå…ƒç´ äº§ç”Ÿç›¸åŒçš„ keyï¼Œä¼šæŠ›å‡º <code>IllegalStateException</code>ï¼Œé™¤éä½ æä¾›åˆå¹¶é€»è¾‘ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-2">âœ… ç¤ºä¾‹ï¼šæ„å»ºç”¨æˆ·ç¼“å­˜</h4>
<p>å‡è®¾ä½ æœ‰ä¸€ä¸ª <code>User</code> ç±»ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ª <code>id</code>ï¼Œä½ æƒ³ç”¨ <code>id</code> ä½œä¸º keyï¼ŒæŠŠç”¨æˆ·ç¼“å­˜èµ·æ¥ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">record</span> <span class="hljs-title class_">User</span><span class="hljs-params">(<span class="hljs-type">long</span> id, String name)</span> {}

List&lt;User&gt; users = List.of(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">"Mary"</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">2L</span>, <span class="hljs-string">"James"</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">3L</span>, <span class="hljs-string">"Patricia"</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">4L</span>, <span class="hljs-string">"Michael"</span>)
);

Map&lt;Long, User&gt; userCache = users.stream()
    .collect(Collectors.toMap(User::id, Function.identity()));

System.out.println(<span class="hljs-string">"Map size = "</span> + userCache.size());
System.out.println(<span class="hljs-string">"Keys = "</span> + userCache.keySet());
</code></pre>
<p><strong>è¿è¡Œç»“æœï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Map</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>
Keys = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]
</code></pre>
<ul>
<li><code>User::id</code> ç”Ÿæˆ key</li>
<li><code>Function.identity()</code> è¿”å›å…ƒç´ æœ¬èº«ä½œä¸º value</li>
</ul>
<p>ğŸ¯ ç”¨é€”ï¼šå¸¸ç”¨äº <strong>ç¼“å­˜</strong>ã€<strong>ç´¢å¼•è¡¨</strong> çš„æ„å»ºã€‚</p>
<hr/>
<h4 data-id="heading-3">â—ï¸å¤„ç†é‡å¤ Keyï¼šä¼ å…¥åˆå¹¶å‡½æ•°</h4>
<p>å¦‚æœä½ é¢„æœŸå¤šä¸ªå…ƒç´ ä¼šç”Ÿæˆç›¸åŒçš„ keyï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ª<strong>åˆå¹¶å‡½æ•°</strong>ï¼ˆ<code>BinaryOperator</code>ï¼‰å‘Šè¯‰ Java å¦‚ä½•åˆå¹¶å€¼ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">Collection&lt;String&gt; strings = List.of(
    <span class="hljs-string">"one"</span>, <span class="hljs-string">"two"</span>, <span class="hljs-string">"three"</span>, <span class="hljs-string">"four"</span>, <span class="hljs-string">"five"</span>, <span class="hljs-string">"six"</span>, <span class="hljs-string">"seven"</span>, <span class="hljs-string">"eight"</span>, <span class="hljs-string">"nine"</span>,
    <span class="hljs-string">"ten"</span>, <span class="hljs-string">"eleven"</span>, <span class="hljs-string">"twelve"</span>);

Map&lt;Integer, String&gt; map = strings.stream()
    .collect(Collectors.toMap(
        str -&gt; str.length(),      <span class="hljs-comment">// key: å­—ç¬¦ä¸²é•¿åº¦</span>
        str -&gt; str,               <span class="hljs-comment">// value: å­—ç¬¦ä¸²æœ¬èº«</span>
        (s1, s2) -&gt; s1 + <span class="hljs-string">", "</span> + s2));  <span class="hljs-comment">// åˆå¹¶å‡½æ•°ï¼šæ‹¼æ¥å­—ç¬¦ä¸²</span>

map.forEach((key, value) -&gt; System.out.println(key + <span class="hljs-string">" :: "</span> + value));
</code></pre>
<p><strong>è¾“å‡ºç»“æœï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">3</span> :: one, two, six, ten
<span class="hljs-number">4</span> :: four, five, nine
<span class="hljs-number">5</span> :: three, seven, eight
<span class="hljs-number">6</span> :: eleven, twelve
</code></pre>
<p>ğŸ“Œ å¦‚æœä¸æä¾›åˆå¹¶å‡½æ•°ï¼Œä¼šåœ¨ key å†²çªæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<hr/>
<h4 data-id="heading-4">ğŸ§° é«˜çº§ç”¨æ³•ï¼šæŒ‡å®š Map å®ç°ç±»</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>toMap()</code> è¿”å›ä¸€ä¸ª <code>HashMap</code>ã€‚ä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬å››ä¸ªå‚æ•°ä¼ å…¥ä½ æƒ³è¦çš„ Map ç±»å‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">TreeMap&lt;Integer, String&gt; sortedMap = strings.stream()
    .collect(Collectors.toMap(
        str -&gt; str.length(),
        str -&gt; str,
        (s1, s2) -&gt; s1 + <span class="hljs-string">", "</span> + s2,
        TreeMap::<span class="hljs-keyword">new</span>));

System.out.println(sortedMap);
</code></pre>
<p>ğŸ§¾ è¾“å‡ºå°†æ˜¯æŒ‰ key æ’åºçš„ï¼š</p>
<pre><code class="hljs language-java" lang="java">{<span class="hljs-number">3</span>=one, two, six, ten, <span class="hljs-number">4</span>=four, five, nine, <span class="hljs-number">5</span>=three, seven, eight, <span class="hljs-number">6</span>=eleven, twelve}
</code></pre>
<hr/>
<h4 data-id="heading-5">ğŸ§µ å¤šçº¿ç¨‹æ”¶é›†ï¼šä½¿ç”¨ <code>toConcurrentMap()</code></h4>
<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>Collectors.toConcurrentMap()</code> æ¥æ„å»ºçº¿ç¨‹å®‰å…¨çš„ Mapï¼Œé€‚åˆå¹¶è¡Œæµæˆ–å¤šçº¿ç¨‹åœºæ™¯ï¼š</p>
<pre><code class="hljs language-java" lang="java">ConcurrentMap&lt;Long, User&gt; userCache = users.parallelStream()
    .collect(Collectors.toConcurrentMap(User::id, Function.identity()));
</code></pre>
<blockquote>
<p>ğŸ’¡ å®é™…ç±»å‹é€šå¸¸æ˜¯ <code>ConcurrentHashMap</code>ï¼Œä½†è§„èŒƒä¸ä¿è¯å…·ä½“å®ç°ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-6">ğŸ“š æ€»ç»“å¯¹æ¯”</h4>

































<table><thead><tr><th>Collector</th><th>ç”¨é€”</th><th>æ”¯æŒé‡å¤ Key</th><th>ä¸‹æ¸¸æ”¶é›†å™¨</th><th>æ§åˆ¶ Map ç±»å‹</th></tr></thead><tbody><tr><td><code>groupingBy()</code></td><td>åˆ†ç»„ã€ç»Ÿè®¡ã€åˆ†ç±»</td><td>âœ…</td><td>âœ… å¯é€‰</td><td>âœ… å¯é€‰</td></tr><tr><td><code>toMap()</code></td><td>æ˜ å°„ã€ç¼“å­˜ã€ç´¢å¼•</td><td>âŒï¼ˆéœ€æ‰‹åŠ¨åˆå¹¶ï¼‰</td><td>âŒ</td><td>âœ… å¯é€‰</td></tr><tr><td><code>toConcurrentMap()</code></td><td>å¹¶å‘å®‰å…¨æ˜ å°„</td><td>âŒï¼ˆéœ€æ‰‹åŠ¨åˆå¹¶ï¼‰</td><td>âŒ</td><td>âœ… é»˜è®¤å¹¶å‘ Map</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-7">ğŸ—£ å°ç»“è¯­å¥ï¼ˆå¯è¯¾å ‚å£æ’­ï¼‰ï¼š</h4>
<blockquote>
<p>ğŸ”Š â€œæˆ‘ä»¬ç”¨ <code>groupingBy()</code> åšç»Ÿè®¡å›¾ã€åšåˆ†ç±»ã€‚ä½†å½“ä½ éœ€è¦æ„å»ºé”®å€¼ç»“æ„ï¼Œæ¯”å¦‚ç¼“å­˜ã€ç´¢å¼•è¡¨ï¼Œå°±è½®åˆ° <code>toMap()</code> ç™»åœºäº†ï¼è¦æ³¨æ„ key å†²çªçš„å¤„ç†ï¼Œé¿å…è¿è¡Œæ—¶ç‚¸é”…ï¼â€</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript æ³›å‹ä»è½»æ¾å…¥é—¨åˆ°çœ‹æ‡‚æºç ]]></title>    <link>https://juejin.cn/post/7603444191449055266</link>    <guid>https://juejin.cn/post/7603444191449055266</guid>    <pubDate>2026-02-06T18:02:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603444191449055266" data-draft-id="7603347438013710371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript æ³›å‹ä»è½»æ¾å…¥é—¨åˆ°çœ‹æ‡‚æºç "/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-02-06T18:02:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SuperEugene"/> <meta itemprop="url" content="https://juejin.cn/user/2366613652515256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript æ³›å‹ä»è½»æ¾å…¥é—¨åˆ°çœ‹æ‡‚æºç 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2366613652515256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SuperEugene
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T18:02:31.000Z" title="Fri Feb 06 2026 18:02:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»ã€Œå®Œå…¨ä¸æ‡‚æ³›å‹ã€ä¸€è·¯èµ°åˆ°ã€Œçœ‹æ‡‚ä¸‹é¢è¿™æ®µä»£ç åˆ°åº•åœ¨å¹²å˜›ã€ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//æ­¤ä»£ä¸ºä¸ºVxeTableç»„ä»¶åº“Gridé…ç½®å¼è¡¨æ ¼æ•°æ®åˆ†é¡µç¤ºä¾‹ä»£ç éƒ¨åˆ†ç‰‡æ®µ</span>
&lt;script lang=<span class="hljs-string">"ts"</span> setup&gt;
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">VxeGridProps</span>, <span class="hljs-title class_">VxeGridListeners</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vxe-table'</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">RowVO</span> {  
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">role</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">sex</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">address</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">const</span> gridOptions = reactive&lt;<span class="hljs-title class_">VxeGridProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;&gt;({  
  <span class="hljs-attr">showOverflow</span>: <span class="hljs-literal">true</span>,  
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,  
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,  
  <span class="hljs-attr">height</span>: <span class="hljs-number">500</span>,  
  <span class="hljs-attr">pagerConfig</span>: pagerVO,  
  <span class="hljs-attr">columns</span>: [    
    { <span class="hljs-attr">type</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">70</span>, <span class="hljs-attr">fixed</span>: <span class="hljs-string">'left'</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Name'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">160</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'email'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Email'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">160</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'nickname'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Nickname'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">160</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Age'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'role'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Role'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">160</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'amount'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Amount'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">140</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'updateDate'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Update Date'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'createDate'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Create Date'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span> },  
  ],  
  <span class="hljs-attr">data</span>: [],
})
&lt;/script&gt;
</code></pre>
<blockquote>
<p>VxeTableç»„ä»¶åº“ç®€ä»‹ï¼š</p>
<ul>
<li>ç”±äºè¿™ç¯‡æ–‡ç« å¼•ç”¨åˆ°äº†VxeTableç»„ä»¶åº“çš„ä»£ç ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œç»™æ²¡æ¥è§¦è¿‡çš„å°ä¼™ä¼´åšä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œè€å¸æœºå¯è‡ªè¡Œè·³è¿‡ã€‚</li>
<li>VxeTableæ˜¯ä¸€ä¸ªåŸºäº Vue çš„è¡¨æ ¼ç»„ä»¶åº“ï¼Œæä¾›è¡¨æ ¼ã€è¡¨å•ã€å·¥å…·æ ã€åˆ†é¡µç­‰ç»„ä»¶ï¼Œé€‚åˆä¸­åå°åœºæ™¯ã€‚æ€§èƒ½ä¸åŠŸèƒ½éƒ½è¾ƒå¼ºï¼Œä½†å­¦ä¹ æˆæœ¬å’ŒæŒ‰éœ€å¼•å…¥çš„é…ç½®éœ€è¦æŠ•å…¥æ—¶é—´ã€‚å¦‚æœä½ çš„é¡¹ç›®ä»¥è¡¨æ ¼ä¸ºæ ¸å¿ƒï¼Œä¸”éœ€è¦è™šæ‹Ÿæ»šåŠ¨ã€å¤æ‚äº¤äº’ç­‰åŠŸèƒ½ï¼ŒVxeTable æ˜¯åˆé€‚çš„é€‰æ‹©ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥é€šè¿‡ä¸‹æ–¹è´´ä¸Šçš„å®˜ç½‘é“¾æ¥å­¦ä¹ äº†è§£ã€‚</li>
</ul>
<p>ï¼ˆPSÂ·å³ä½¿æ²¡ç”¨è¿‡VxeTableä¹Ÿä¸å½±å“ä½ çœ‹æ‡‚è¿™ç¯‡æ–‡ç« ï¼‰</p>
<p>å®˜ç½‘é“¾æ¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fvxetable.cn%2F%23%2Fcomponent%2Fgrid%2Fpager%2FmockPage" target="_blank" title="https://vxetable.cn/#/component/grid/pager/mockPage" ref="nofollow noopener noreferrer">ï¼šVxeTableå®˜ç½‘</a></p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿä¸€å¥è¯ç‰ˆæœ¬</h2>
<p>æ³›å‹ = ç»™ â€œç±»å‹â€ åŠ å‚æ•°ã€‚</p>
<ul>
<li>å‡½æ•°å¯ä»¥æœ‰å‚æ•°ï¼š<code>function fn(x: number) {}</code></li>
<li>ç±»å‹ä¹Ÿå¯ä»¥æœ‰ â€œå‚æ•°â€ï¼š<code>Array&lt;string&gt;</code></li>
</ul>
<p>è¿™é‡Œ <code>Array</code> å°±æ˜¯ä¸€ä¸ªã€Œå¸¦ç±»å‹å‚æ•°ã€çš„ç±»å‹ï¼Œ<code>&lt;string&gt;</code> å°±æ˜¯ã€Œä¼ ç»™å®ƒçš„ç±»å‹å‚æ•°ã€ã€‚</p>
<p>ç”¨äººè¯è¯´ï¼š</p>
<blockquote>
<p>æ³›å‹å°±æ˜¯ï¼š<strong>æˆ‘å†™ä¸€ä»½é€šç”¨çš„ç±»å‹ / å‡½æ•°ï¼ŒçœŸæ­£ç”¨çš„æ—¶å€™å†å‘Šè¯‰å®ƒå…·ä½“ç”¨ä»€ä¹ˆç±»å‹</strong>ã€‚</p>
</blockquote>
<h2 data-id="heading-1">äºŒã€æœ€æ™®é€šçš„ä¸€å±‚æ³›å‹</h2>
<h3 data-id="heading-2">1. æœ€ç†Ÿæ‚‰çš„ä¾‹å­ï¼šæ•°ç»„</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// è¿™ä¿©æ˜¯å®Œå…¨ç­‰ä»·çš„</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">list1</span>: <span class="hljs-built_in">string</span>[] = []
<span class="hljs-keyword">const</span> <span class="hljs-attr">list2</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = []
</code></pre>
<ul>
<li><code>Array&lt;T&gt;</code> æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹</li>
<li><code>T</code> æ˜¯å®ƒçš„ç±»å‹å‚æ•°</li>
<li><code>Array&lt;string&gt;</code> è¡¨ç¤ºã€Œå…ƒç´ ç±»å‹æ˜¯ <code>string</code> çš„æ•°ç»„ã€</li>
</ul>
<h3 data-id="heading-3">2. è‡ªå·±å†™ä¸€ä¸ªæ³›å‹å‡½æ•°</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">value</span>: T): T {  
  <span class="hljs-keyword">return</span> value
}
identity&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">1</span>)      <span class="hljs-comment">// T è¢«æ›¿æ¢æˆ number</span>
identity&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'hi'</span>)   <span class="hljs-comment">// T è¢«æ›¿æ¢æˆ string</span>
</code></pre>
<p>ä½ å¯ä»¥ç†è§£ä¸ºï¼š</p>
<ul>
<li>å®šä¹‰ï¼š<code>identity&lt;T&gt;</code> â†’ <code>T</code> æ˜¯ä¸€ä¸ªã€Œå ä½çš„ç±»å‹ã€</li>
<li>ä½¿ç”¨ï¼š<code>identity&lt;number&gt;</code> â†’ è¿™æ¬¡è°ƒç”¨é‡Œã€ŒæŠŠ <code>T</code> æ¢æˆ <code>number</code>ã€</li>
</ul>
<p>æˆ–è®¸æœ‰åŒå­¦ä¸ç†è§£ä¸ºä»€ä¹ˆè¦åœ¨å‡½æ•°åç§°åé¢å†™<code>&lt;T&gt;</code>ã€‚ä¸ç”¨çº ç»“ï¼Œè¿™æ˜¯å›ºå®šçš„å†™æ³•ï¼Œå°±åƒä½ è¦ä½¿ç”¨å˜é‡ï¼Œå°±è¦å…ˆå£°æ˜ä¸€æ ·,å¦‚ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> data = []
data.<span class="hljs-title function_">push</span>(<span class="hljs-number">123</span>)
</code></pre>
<p>å¦‚æœæ­¤å¤„æ²¡æœ‰å£°æ˜<code>data</code>ï¼Œä¾¿ç”¨ä¸äº†<code>data</code>ã€‚åŒç†å¦‚æœä¸åœ¨å‡½æ•°åç§°åé¢å†™<code>&lt;T&gt;</code>å£°æ˜ä¸€ä¸‹è¿™æ˜¯æ³›å‹å‚æ•°ï¼Œ<code>TypeScript</code> æ— æ³•è¯†åˆ«Â <code>T</code>Â æ˜¯ä»€ä¹ˆ,å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//  é”™è¯¯ï¼šæ‰¾ä¸åˆ°åç§° 'T'</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">identity</span>(<span class="hljs-params">value: T</span>): T {
  <span class="hljs-keyword">return</span> value
}
<span class="hljs-comment">// æŠ¥é”™ï¼šCannot find name 'T'</span>
</code></pre>
<p><code>TypeScript</code> ä¼šæŠŠÂ <code>T</code>Â å½“ä½œä¸€ä¸ªæœªå£°æ˜çš„ç±»å‹ï¼Œå› æ­¤æŠ¥é”™ã€‚</p>
<h2 data-id="heading-4">ä¸‰ã€ç±»å‹ä¹Ÿå¯ä»¥æ˜¯æ³›å‹ï¼šæ¥å£ /type</h2>
<h3 data-id="heading-5">1. æ³›å‹æ¥å£</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// ä½¿ç”¨æ—¶ä¼ å…¥ä¸åŒçš„ T</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; {  
  <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">msg</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">data</span>: T
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {  
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">res1</span>: <span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-title class_">User</span>&gt; = {  
  <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,  
  <span class="hljs-attr">msg</span>: <span class="hljs-string">'ok'</span>,  
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span> },
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">res2</span>: <span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-built_in">string</span>[]&gt; = {  
  <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,  
  <span class="hljs-attr">msg</span>: <span class="hljs-string">'ok'</span>,  
  <span class="hljs-attr">data</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>],
}
</code></pre>
<p>è§‚å¯Ÿï¼š</p>
<ul>
<li><code>ApiResponse&lt;T&gt;</code> è‡ªå·±å¹¶ä¸çŸ¥é“ <code>T</code> æ˜¯å•¥</li>
<li>çœŸæ­£ç”¨çš„æ—¶å€™å†™ <code>ApiResponse&lt;User&gt;</code> / <code>ApiResponse&lt;string[]&gt;</code></li>
<li><code>TypeScript</code> åœ¨è¿™ä¸€åˆ»æ‰æŠŠ <code>T</code> æ›¿æ¢æ‰</li>
</ul>
<h2 data-id="heading-6">å››ã€åµŒå¥—æ³›å‹ï¼šæ³›å‹é‡Œé¢å†å¥—æ³›å‹</h2>
<p>å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ã€Œç±»å‹å‚æ•°æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹ã€ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// ä¸€å±‚ï¼šæ•°ç»„é‡Œæ”¾å­—ç¬¦ä¸²</span>
<span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;

<span class="hljs-comment">// ä¸¤å±‚ï¼šPromise é‡Œæ”¾æ•°ç»„ï¼Œæ•°ç»„é‡Œæ”¾å­—ç¬¦ä¸²</span>
<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;

<span class="hljs-comment">// æ¢ä¸ªå†™æ³•æ›´ç›´è§‚</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StringArray</span> = <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StringArrayPromise</span> = <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">StringArray</span>&gt;
</code></pre>
<p>ä½ å¯ä»¥è¿™ä¹ˆæƒ³ï¼š</p>
<ul>
<li>ç¬¬ä¸€å±‚ï¼š<code>Array&lt;T&gt;</code></li>
<li>ç¬¬äºŒå±‚ï¼š<code>Promise&lt;ç¬¬ä¸€å±‚&gt;</code></li>
</ul>
<h2 data-id="heading-7">äº”ã€å›åˆ°æ–‡ç« æœ€å¼€å§‹çš„ä¾‹å­ï¼š<code>VxeGridProps&lt;RowVO&gt;</code></h2>
<p>å…ˆçœ‹å®šä¹‰çš„è¡Œæ•°æ®ç±»å‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RowVO</span> {  
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">role</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">sex</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">address</span>: <span class="hljs-built_in">string</span>
}
</code></pre>
<p>ç„¶åï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> gridOptions = reactive&lt;<span class="hljs-title class_">VxeGridProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;&gt;({...})
</code></pre>
<p>æ‹†å¼€ç†è§£ï¼š</p>
<ul>
<li><code>VxeGridProps&lt;D = any&gt;</code> æ˜¯ vxe-table æä¾›çš„æ³›å‹æ¥å£</li>
<li>ä½ å†™çš„æ˜¯ <code>VxeGridProps&lt;RowVO&gt;</code></li>
<li>è¿™ä¸€åˆ»ï¼Œ<code>D</code> å°±è¢«æ›¿æ¢æˆäº† <code>RowVO</code></li>
</ul>
<p>ä¹Ÿå°±æ˜¯åœ¨è¿™ä¸€æ•´æ¬¡ä½¿ç”¨é‡Œï¼Œå¯ä»¥æŠŠå®ƒè„‘è¡¥æˆï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// ä¼ªä»£ç ï¼Œä»…ç”¨äºç†è§£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">VxeGridProps</span>_RowVO <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeTableProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; {  
  columns?: <span class="hljs-title class_">VxeGridPropTypes</span>.<span class="hljs-property">Columns</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;  
  proxyConfig?: <span class="hljs-title class_">VxeGridPropTypes</span>.<span class="hljs-property">ProxyConfig</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;  
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å¯èƒ½å¾ˆå¤šåŒå­¦çœ‹åˆ°è¿™é‡Œä¼šæ„Ÿåˆ°äº›ç–‘æƒ‘ï¼Œæ€ä¹ˆä¸€ä¼šå„¿Tä¸€ä¼šå„¿Dçš„ã€‚å…¶å®ä¸ç®¡æ˜¯Tè¿˜æ˜¯Déƒ½æ˜¯ç±»å‹å˜é‡çš„è‡ªå®šä¹‰åç§°ï¼Œå«ä»€ä¹ˆéƒ½æ— æ‰€è°“ï¼Œè¯­æ³•ä¸Šæ²¡æœ‰ä»»ä½•å›ºå®šå«ä¹‰ï¼Œå°±åƒä½ å†™ JS æ—¶ç»™å˜é‡èµ·å<code>num</code>/<code>name</code>/<code>age</code>ä¸€æ ·ï¼Œåªæ˜¯å‰ç«¯ç¤¾åŒºå½¢æˆäº†ã€Œçº¦å®šä¿—æˆçš„å‘½åä¹ æƒ¯ã€ï¼Œç”¨ä¸åŒå­—æ¯å¯¹åº”ä¸åŒè¯­ä¹‰ï¼Œè®©ä»£ç æ›´æ˜“è¯»ã€‚</p>















































<table><thead><tr><th>å­—æ¯</th><th>å…¨ç§°</th><th>å«ä¹‰/ä½¿ç”¨åœºæ™¯</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>T</td><td>Type</td><td>é€šç”¨ç±»å‹ï¼ˆæœ€å¸¸ç”¨ï¼Œæ— ç‰¹æ®Šè¯­ä¹‰æ—¶éƒ½ç”¨ Tï¼‰</td><td><code>first&lt;T&gt;(arr: T[])</code></td></tr><tr><td>D</td><td>Default/Date</td><td>é€šå¸¸æŒ‡ â€œé»˜è®¤ç±»å‹â€ æˆ– â€œæ—¥æœŸç±»å‹â€ï¼ˆå°ä¼—ï¼‰</td><td>æ³›å‹æ¥å£é‡Œçš„é»˜è®¤ç±»å‹ï¼š<code>interface Config&lt;D = string&gt;</code></td></tr><tr><td>K</td><td>KeyKey</td><td>è¡¨ç¤ºå¯¹è±¡çš„ã€Œé”®ã€ç±»å‹</td><td><code>getKey&lt;K extends string&gt;(obj: { [k: K]: any }, key: K)</code></td></tr><tr><td>V</td><td>Value</td><td>è¡¨ç¤ºå¯¹è±¡çš„ã€Œå€¼ã€ç±»å‹</td><td><code>Map&lt;K, V&gt;</code>ï¼ˆTS å†…ç½®çš„ Map æ³›å‹ï¼‰</td></tr><tr><td>E</td><td>Element</td><td>è¡¨ç¤ºæ•°ç»„ / é›†åˆçš„ã€Œå…ƒç´ ã€ç±»å‹</td><td><code>Array&lt;E&gt;</code>ï¼ˆTS å†…ç½®çš„æ•°ç»„æ³›å‹ï¼‰</td></tr><tr><td>P</td><td>Parameter</td><td>è¡¨ç¤ºå‡½æ•°çš„ã€Œå‚æ•°ã€ç±»å‹</td><td><code>function wrap&lt;P&gt;(fn: (arg: P) =&gt; void, arg: P)</code></td></tr></tbody></table>
<h2 data-id="heading-8">å…­ã€ç±»å‹å‚æ•°æ˜¯æ€ä¹ˆä¸€å±‚ä¸€å±‚ â€œä¼ ä¸‹å»â€ çš„ï¼Ÿ</h2>
<p>åˆ°è¿™ä¸€æ­¥ä¸ºäº†æ›´å¥½çš„ç†è§£æ³›å‹ï¼Œæˆ‘å°†å¸¦ç€åŒå­¦ä»¬è¿½æº¯æºç ã€‚ä¸€èµ·æ¥è¿½è¸ªä¸€ä¸‹æºç çœ‹çœ‹å§ã€‚</p>
<h3 data-id="heading-9">1. ç¬¬ä¸€å±‚ï¼š<code>VxeGridProps&lt;D&gt;</code></h3>
<p>æºç é‡Œï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VxeGridProps</span>&lt;D = <span class="hljs-built_in">any</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeTableProps</span>&lt;D&gt; {  
  columns?: <span class="hljs-title class_">VxeGridPropTypes</span>.<span class="hljs-property">Columns</span>&lt;D&gt;  
  proxyConfig?: <span class="hljs-title class_">VxeGridPropTypes</span>.<span class="hljs-property">ProxyConfig</span>&lt;D&gt;  
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å½“ä½ ç”¨ <code>VxeGridProps&lt;RowVO&gt;</code>ï¼š</p>
<ul>
<li><code>extends VxeTableProps&lt;D&gt;</code> â†’ å˜æˆ <code>extends VxeTableProps&lt;RowVO&gt;</code></li>
<li><code>columns?: Columns&lt;D&gt;</code> â†’ å˜æˆ <code>columns?: Columns&lt;RowVO&gt;</code></li>
<li><code>proxyConfig?: ProxyConfig&lt;D&gt;</code> â†’ å˜æˆ <code>proxyConfig?: ProxyConfig&lt;RowVO&gt;</code></li>
</ul>
<blockquote>
<p>è®°å¿†ï¼šå“ªé‡Œå†™äº† <code>&lt;D&gt;</code>ï¼Œå°±ä¼šè¢«æ›¿æ¢æˆ <code>&lt;RowVO&gt;</code>ã€‚</p>
</blockquote>
<h3 data-id="heading-10">2. ç¬¬äºŒå±‚ï¼š<code>Columns&lt;D&gt; = Column&lt;D&gt;[]</code></h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">VxeGridPropTypes</span> {  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Column</span>&lt;D = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">VxeTableDefines</span>.<span class="hljs-property">ColumnOptions</span>&lt;D&gt;  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Columns</span>&lt;D = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">Column</span>&lt;D&gt;[]
}
</code></pre>
<p>å½“ä½ ç”¨çš„æ˜¯ <code>Columns&lt;RowVO&gt;</code> æ—¶ï¼š</p>
<ul>
<li><code>Columns&lt;D&gt;</code> â†’ <code>Columns&lt;RowVO&gt;</code></li>
<li><code>= Column&lt;D&gt;[]</code> è¿™ä¸€è¡Œé‡Œçš„ <code>D</code> åŒæ ·è¢«æ›¿æ¢æˆ <code>RowVO</code>ï¼Œå˜æˆï¼š</li>
<li><code>Columns&lt;RowVO&gt; = Column&lt;RowVO&gt;[]</code></li>
</ul>
<p>æ¥ç€ï¼š</p>
<ul>
<li><code>Column&lt;D&gt; = VxeTableDefines.ColumnOptions&lt;D&gt;</code></li>
<li>ä¹Ÿä¼šå˜æˆï¼š<code>Column&lt;RowVO&gt; = VxeTableDefines.ColumnOptions&lt;RowVO&gt;</code></li>
</ul>
<p>æ‰€ä»¥ï¼š</p>
<blockquote>
<p><code>columns</code> çš„æ¯ä¸€é¡¹ç±»å‹å°±æ˜¯ <code>ColumnOptions&lt;RowVO&gt;</code>ã€‚</p>
</blockquote>
<h3 data-id="heading-11">ä¸ƒã€ç¬¬ä¸‰å±‚ï¼š<code>ColumnOptions&lt;D&gt;</code> é‡Œ <code>D</code> çœŸæ­£ç”¨åœ¨å“ªé‡Œï¼Ÿ</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ColumnOptions</span>&lt;D = <span class="hljs-built_in">any</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeColumnProps</span>&lt;D&gt; {  
  children?: <span class="hljs-title class_">ColumnOptions</span>&lt;D&gt;[]  
  slots?: <span class="hljs-title class_">VxeColumnPropTypes</span>.<span class="hljs-property">Slots</span>&lt;D&gt;
}
</code></pre>
<p>ç»§ç»­æ›¿æ¢ï¼š</p>
<ul>
<li><code>ColumnOptions&lt;D&gt;</code> â†’ <code>ColumnOptions&lt;RowVO&gt;</code></li>
<li><code>extends VxeColumnProps&lt;D&gt;</code> â†’ å˜æˆ <code>extends VxeColumnProps&lt;RowVO&gt;</code></li>
<li><code>children?: ColumnOptions&lt;D&gt;[]</code> â†’ å˜æˆ <code>children?: ColumnOptions&lt;RowVO&gt;[]</code></li>
<li><code>slots?: Slots&lt;D&gt;</code> â†’ å˜æˆ <code>slots?: Slots&lt;RowVO&gt;</code></li>
</ul>
<p>å…³é”®ç‚¹ï¼š<code>ColumnOptions&lt;RowVO&gt;</code> æœ¬èº«å®šä¹‰äº†ã€Œåˆ—é…ç½®ã€çš„ç»“æ„å®ƒç»§æ‰¿çš„ <code>VxeColumnProps&lt;RowVO&gt;</code> + <code>Slots&lt;RowVO&gt;</code> ç­‰åœ°æ–¹ï¼Œä¼šåœ¨ã€Œéœ€è¦è¡Œæ•°æ®çš„å›è°ƒã€é‡Œç”¨åˆ° <code>RowVO</code>ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">formatter</span>(<span class="hljs-attr">params</span>: { <span class="hljs-attr">row</span>: <span class="hljs-title class_">RowVO</span>; ... })
<span class="hljs-title function_">className</span>(<span class="hljs-attr">params</span>: { <span class="hljs-attr">row</span>: <span class="hljs-title class_">RowVO</span>; ... })
</code></pre>
<h2 data-id="heading-12">å…«ã€æˆ‘åœ¨å­¦ä¹ æ—¶å€™çš„ç–‘æƒ‘ï¼Ÿ</h2>
<p>æˆ‘å½“æ—¶å¹¶ä¸ç†è§£<code>TypeScript</code> åšçš„æ˜¯ç»Ÿä¸€æ›¿æ¢</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æŠŠ D æ¢æˆ RowVOï¼š</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Columns</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; = <span class="hljs-title class_">Column</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;[]

<span class="hljs-comment">// å†æŠŠ Column å±•å¼€ï¼š</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Column</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; = <span class="hljs-title class_">VxeTableDefines</span>.<span class="hljs-property">ColumnOptions</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;

<span class="hljs-comment">// åˆèµ·æ¥å°±æ˜¯ï¼š</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Columns</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; = <span class="hljs-title class_">VxeTableDefines</span>.<span class="hljs-property">ColumnOptions</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;[]
</code></pre>
<p>å°±æ‹¿æ–‡ç« ç¤ºä¾‹çš„ä»£ç æ¥çœ‹ï¼Œ<code>TypeScript</code> ä¼šæŠŠå‡½æ•°ä½“ä¸­æ‰€æœ‰çš„<code>&lt;T&gt;</code>éƒ½
æ›¿æ¢æˆä½ åˆ¶å®šçš„ç±»å‹ã€‚</p>
<p>ä¸ç†è§£çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Column</span>&lt;D = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">VxeTableDefines</span>.<span class="hljs-property">ColumnOptions</span>&lt;D&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Columns</span>&lt;D = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">Column</span>&lt;D&gt;[]
</code></pre>
<p>æˆ‘å½“ç‰¹åˆ«ä¸èƒ½ç†è§£<code> Column&lt;D&gt;[]</code>çš„<code>&lt;D&gt;</code>æ˜¯æ€ä¹ˆå˜æˆ<code>&lt;RowVO&gt;</code>çš„ã€‚ç›´åˆ°æˆ‘æ˜ç™½äº†<code>TypeScript</code>ä¼šåšç»Ÿä¸€æ›¿æ¢ï¼Œæ ¹æœ¬ä¸æ˜¯æŒ‰æ•°æ®ä¼ å‚çš„é€»è¾‘å»åšçš„ã€‚</p>
<h2 data-id="heading-13">ä¹ã€æŠŠæ•´ä¸ªé“¾è·¯ä¸²èµ·æ¥ï¼ˆä»å¤–åˆ°å†…ï¼‰</h2>
<p>ä½ å†™äº†ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">reactive&lt;<span class="hljs-title class_">VxeGridProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;&gt;({...})
</code></pre>
<p>äºæ˜¯ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">VxeGridProps</span>&lt;D&gt; â†’ <span class="hljs-title class_">VxeGridProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;
<span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeTableProps</span>&lt;D&gt; â†’ <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeTableProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;
columns?: <span class="hljs-title class_">Columns</span>&lt;D&gt; â†’ columns?: <span class="hljs-title class_">Columns</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;
</code></pre>
<p>ç„¶åï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">Columns</span>&lt;D&gt; = <span class="hljs-title class_">Column</span>&lt;D&gt;[] â†’ <span class="hljs-title class_">Columns</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; = <span class="hljs-title class_">Column</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;[]
<span class="hljs-title class_">Column</span>&lt;D&gt; = <span class="hljs-title class_">ColumnOptions</span>&lt;D&gt; â†’ <span class="hljs-title class_">Column</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; = <span class="hljs-title class_">ColumnOptions</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;
</code></pre>
<p>å†å¾€ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">ColumnOptions</span>&lt;D&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeColumnProps</span>&lt;D&gt; â†’ <span class="hljs-title class_">ColumnOptions</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeColumnProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;
</code></pre>
<p>æœ€ç»ˆæ•ˆæœï¼š</p>
<ul>
<li><code>data</code> çš„ç±»å‹æ˜¯ï¼š<code>RowVO[]</code></li>
<li>æ‰€æœ‰å›è°ƒé‡Œæ¶‰åŠã€Œè¡Œæ•°æ®ã€çš„åœ°æ–¹ï¼Œç±»å‹å‚æ•°æ˜¯ <code>RowVO</code></li>
</ul>
<h2 data-id="heading-14">åã€æ€»ç»“è¿™æ¬¡æ¡ˆä¾‹</h2>
<ul>
<li><code>RowVO</code>ï¼šæè¿° â€œä¸€è¡Œæ•°æ®é•¿ä»€ä¹ˆæ ·â€</li>
<li><code>VxeGridProps&lt;RowVO&gt;</code>ï¼šå‘Šè¯‰è¡¨æ ¼ã€Œæˆ‘çš„æ¯ä¸€è¡Œæ•°æ®éƒ½æ˜¯ <code>RowVO</code>ã€</li>
<li>æ³›å‹å‚æ•° <code>&lt;RowVO&gt;</code> ä¼šä¸€å±‚å±‚å¾€ä¸‹ä¼ ï¼Œå‡¡æ˜¯ç±»å‹é‡Œå†™äº† <code>&lt;D&gt;</code> çš„åœ°æ–¹ï¼Œå°±ä¼šå˜æˆ <code>&lt;RowVO&gt;</code></li>
</ul>
<p>ä½ ç°åœ¨å·²ç»ä¸æ˜¯ â€œä¸æ‡‚æ³›å‹çš„å°ç™½â€ äº†ï¼Œä½ å·²ç»èƒ½ï¼š</p>
<ul>
<li>çœ‹æ‡‚ã€Œç±»å‹å‚æ•°æ˜¯æ€ä¹ˆä¸€å±‚ä¸€å±‚ä¼ ä¸‹å»çš„ã€</li>
<li>é¡ºç€ <code>VxeGridProps&lt;RowVO&gt; â†’ Columns&lt;RowVO&gt; â†’ ColumnOptions&lt;RowVO&gt;</code> è¿™ä¸€æ•´æ¡é“¾è·¯å¾€ä¸‹è¿½</li>
</ul>
<p>è¿™å°±å·²ç»æ˜¯éå¸¸æ‰å®çš„æ³›å‹ç†è§£äº†ã€‚</p>
<h3 data-id="heading-15">æ€»ç»“</h3>
<ol>
<li>æ³›å‹çš„æ ¸å¿ƒæ˜¯ã€Œç»™ç±»å‹åŠ å‚æ•°ã€ï¼Œä½¿ç”¨æ—¶å†æŒ‡å®šå…·ä½“ç±»å‹ï¼Œå¦‚ <code>Array&lt;string&gt;</code>ã€<code>VxeGridProps&lt;RowVO&gt;</code>ï¼›</li>
<li>åµŒå¥—æ³›å‹çš„æœ¬è´¨æ˜¯ã€Œç±»å‹å‚æ•°æœ¬èº«ä¹Ÿæ˜¯æ³›å‹ã€ï¼Œå‚æ•°ä¼šé€å±‚ä¼ é€’æ›¿æ¢ï¼ˆ<code>D</code> â†’ <code>RowVO</code>ï¼‰ï¼›</li>
</ol>
<p>ä»¥ä¸Šä¾¿æ˜¯å¯¹æ³›å‹çš„åˆ†äº«ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ­£è®¨è®ºï¼Œä¸å¤§å®¶å…±å‹‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŒ‘æˆ˜å…¨æ ˆæ¡†æ¶çš„æé™ï¼šä»… 7kb çš„ Lupine.js å‘å¸ƒäº†]]></title>    <link>https://juejin.cn/post/7603588665567051816</link>    <guid>https://juejin.cn/post/7603588665567051816</guid>    <pubDate>2026-02-06T22:55:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603588665567051816" data-draft-id="7603574149773574196" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æŒ‘æˆ˜å…¨æ ˆæ¡†æ¶çš„æé™ï¼šä»… 7kb çš„ Lupine.js å‘å¸ƒäº†"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-06T22:55:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uuware"/> <meta itemprop="url" content="https://juejin.cn/user/2339389938342535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æŒ‘æˆ˜å…¨æ ˆæ¡†æ¶çš„æé™ï¼šä»… 7kb çš„ Lupine.js å‘å¸ƒäº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2339389938342535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uuware
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T22:55:52.000Z" title="Fri Feb 06 2026 22:55:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Lupine.jsï¼šä¸€æ¬¾"æå…¶"é«˜æ•ˆçš„ Web æ¡†æ¶</h2>
<p>åœ¨ä¸€ä¸ªè¢«åºå¤§çš„å…ƒæ¡†æ¶ (Meta-frameworks) å’Œå¤æ‚æ„å»ºé“¾ä¸»å¯¼çš„ä¸–ç•Œé‡Œï¼Œ<strong>Lupine.js</strong> æå‡ºäº†ä¸€ä¸ªç®€å•çš„é—®é¢˜ï¼š<em>å¦‚æœæˆ‘ä»¬èƒ½æ‹¥æœ‰ç°ä»£å…¨æ ˆæ¡†æ¶çš„å¨åŠ›ï¼Œå´ä¸éœ€è¦é‚£äº›è‡ƒè‚¿çš„è´Ÿæ‹…ï¼Œä¼šæ€æ ·ï¼Ÿ</em></p>
<p>Lupine.js æ˜¯ä¸€ä¸ª <strong>è½»é‡çº§ (7kb gzipped)</strong> çš„ <strong>å…¨æ ˆ</strong> Web æ¡†æ¶ï¼Œå®ƒç»“åˆäº†ç±» React çš„å‰ç«¯ä½“éªŒå’Œç±» Express çš„åç«¯æ¶æ„ã€‚å®ƒæ˜¯å®Œå…¨ä»é›¶å¼€å§‹è®¾è®¡ï¼Œæ—¨åœ¨å®ç°æè‡´çš„é€Ÿåº¦ã€ç®€æ´å’Œé«˜æ•ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0aad91329f984831a09dd60e9c663d3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXV3YXJl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771023738&amp;x-signature=Qyi9XESXPC%2F3Kp80SXr%2Fd%2BtxKLg%3D" alt="og-image.png" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆé€‰æ‹© Lupine.jsï¼Ÿ</h3>
<h4 data-id="heading-2">1. ğŸª¶ æå…¶è½»é‡çš„å‰ç«¯</h4>
<p><code>lupine.web</code> å‰ç«¯åŒ…æå…¶å°å·§â€”â€”ä»… <strong>7kb gzipped</strong>ã€‚ç„¶è€Œï¼Œå®ƒä¿ç•™äº†ä½ ç†Ÿæ‚‰å’Œå–œçˆ±çš„å¼€å‘ä½“éªŒï¼š<strong>TSX è¯­æ³•</strong> (React JSX)ã€ç»„ä»¶å’Œ Hooksã€‚æ²¡æœ‰æ²‰é‡çš„è¿è¡Œæ—¶éœ€è¦ä¸‹è½½ï¼Œè¿™æ„å‘³ç€å³ä½¿åœ¨æ…¢é€Ÿç½‘ç»œä¸‹ï¼Œä½ çš„é¡µé¢ä¹Ÿèƒ½ç¬é—´åŠ è½½ã€‚</p>
<h4 data-id="heading-3">2. âš¡ å†…ç½®æœåŠ¡ç«¯æ¸²æŸ“ (SSR)</h4>
<p>å¤§å¤šæ•°æ¡†æ¶å°† SSR è§†ä¸ºé™„åŠ åŠŸèƒ½ã€‚åœ¨ Lupine ä¸­ï¼ŒSSR æ˜¯ <strong>ä¸€ç­‰å…¬æ°‘</strong>ã€‚<code>lupine.api</code> åç«¯ç»è¿‡ä¼˜åŒ–ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“ä½ çš„å‰ç«¯é¡µé¢ã€‚</p>
<ul>
<li><strong>æ— æ ·å¼é—ªçƒ (No FOUC)</strong>: å…³é”® CSS ç”±æœåŠ¡ç«¯æ³¨å…¥ã€‚</li>
<li><strong>é›¶é…ç½® SEO</strong>: Meta æ ‡ç­¾ (<code>og:image</code>, <code>description</code>) åœ¨é¡µé¢ç¦»å¼€æœåŠ¡å™¨å‰å°±å·²ç»è®¡ç®—å®Œæ¯•ã€‚</li>
<li><strong>ç¤¾äº¤åˆ†äº«å°±ç»ª</strong>: åˆ†äº«åˆ° Twitter/å¾®ä¿¡/Facebook çš„é“¾æ¥å¼€ç®±å³ç”¨ï¼Œæ•ˆæœå®Œç¾ã€‚</li>
</ul>
<h4 data-id="heading-4">3. ğŸ¨ åŸç”Ÿ CSS-in-JS å¼•æ“</h4>
<p>å‘Šåˆ«é…ç½® PostCSSã€Tailwind æˆ– styled-components çš„çƒ¦æ¼ã€‚Lupine å†…ç½®äº†ä¸€ä¸ªå¼ºå¤§çš„ CSS-in-JS å¼•æ“ã€‚</p>
<ul>
<li><strong>æ ·å¼éš”ç¦»</strong>: æ ·å¼è‡ªåŠ¨éš”ç¦»åˆ°ä½ çš„ç»„ä»¶ã€‚</li>
<li><strong>åµŒå¥—æ”¯æŒ</strong>: æ”¯æŒ <code>.parent &amp;</code> è¯­æ³•ã€‚</li>
<li><strong>é«˜æ€§èƒ½</strong>: æ ·å¼åœ¨ SSR æœŸé—´è¢«é«˜æ•ˆæå–å’Œæ³¨å…¥ã€‚</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Button</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> css = {
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#0ac92a'</span>,
    <span class="hljs-string">'&amp;:hover'</span>: {
      <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#08a823'</span>,
    },
  };
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">css</span>=<span class="hljs-string">{css}</span>&gt;</span>ç‚¹å‡»æˆ‘<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
};
</code></pre>
<h4 data-id="heading-5">4. ğŸš€ å…¨æ ˆåˆä¸€</h4>
<p>Lupine ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå‰ç«¯åº“ï¼›å®ƒæ˜¯å®Œæ•´çš„åº”ç”¨è§£å†³æ–¹æ¡ˆã€‚</p>
<ul>
<li><strong>åç«¯ (<code>lupine.api</code>)</strong>: ä¸€ä¸ªé«˜æ•ˆã€æç®€çš„ Node.js æ¡†æ¶ï¼Œç±»ä¼¼äº Expressã€‚</li>
<li><strong>å‰ç«¯ (<code>lupine.web</code>)</strong>: ä¸€ä¸ªå“åº”å¼çš„ UI åº“ã€‚</li>
<li><strong>å¼€å‘ä½“éªŒ</strong>: è¿è¡Œ <code>npm run dev</code>ï¼Œå³å¯åœ¨åŒä¸€ä¸ª VS Code ä¼šè¯ä¸­åŒæ—¶è°ƒè¯•å‰ç«¯å’Œåç«¯ã€‚</li>
</ul>
<h3 data-id="heading-6">å¿«é€Ÿå¼€å§‹</h3>
<p>å‡†å¤‡å¥½å°è¯•äº†å—ï¼Ÿå‡ ç§’é’Ÿå°±èƒ½æ­å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ã€‚</p>
<h4 data-id="heading-7">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¡¹ç›®</h4>
<p>ä½¿ç”¨æˆ‘ä»¬çš„ CLI å·¥å…·åˆ›å»ºä¸€ä¸ªæ–°åº”ç”¨ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">npx create-lupine@latest my-awesome-app
</code></pre>
<h4 data-id="heading-8">ç¬¬äºŒæ­¥ï¼šè¿è¡Œé¡¹ç›®</h4>
<p>è¿›å…¥ç›®å½•å¹¶å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> my-awesome-app
npm install
npm run dev
</code></pre>
<p>è®¿é—® <code>http://localhost:11080</code>ï¼Œä½ å°†çœ‹åˆ°ä½ çš„ç¬¬ä¸€ä¸ª Lupine åº”ç”¨æ­£åœ¨è¿è¡Œï¼</p>
<h3 data-id="heading-9">ä»£ç æ´»è·ƒåº¦</h3>
<p>Lupine æ­£åœ¨ç§¯æå¼€å‘ä¸­ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨ GitHub ä¸ŠæŸ¥çœ‹æˆ‘ä»¬çš„ä»£ç é¢‘ç‡å’Œè´¡çŒ®ï¼š
ğŸ‘‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuuware%2Flupine.js" target="_blank" title="https://github.com/uuware/lupine.js" ref="nofollow noopener noreferrer">github.com/uuware/lupiâ€¦</a></p>
<h3 data-id="heading-10">æ€»ç»“</h3>
<p>Lupine.js éå¸¸é€‚åˆè¿™æ ·çš„å¼€å‘è€…ï¼š</p>
<ul>
<li><strong>æŒæ§åŠ›</strong>: æƒ³è¦äº†è§£æŠ€æœ¯æ ˆçš„æ¯ä¸€ä¸ªéƒ¨åˆ†ã€‚</li>
<li><strong>é€Ÿåº¦</strong>: æƒ³ä¸ºç”¨æˆ·æä¾›æœ€å¿«çš„ä½“éªŒã€‚</li>
<li><strong>ç®€æ´</strong>: æ²¡æœ‰éšè—çš„é­”æ³•ï¼Œåªæœ‰å¹²å‡€çš„ä»£ç ã€‚</li>
</ul>
<p>ç»™ <strong>Lupine.js</strong> åœ¨ GitHub ä¸Šç‚¹ä¸ª Starï¼Œå¹¶åœ¨ä½ çš„ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸­å°è¯•ä¸€ä¸‹å§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3ä¸­éå“åº”å¼çš„å…¨å±€çŠ¶æ€ç®¡ç†]]></title>    <link>https://juejin.cn/post/7603587738160578623</link>    <guid>https://juejin.cn/post/7603587738160578623</guid>    <pubDate>2026-02-07T00:14:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603587738160578623" data-draft-id="7603563360329662506" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3ä¸­éå“åº”å¼çš„å…¨å±€çŠ¶æ€ç®¡ç†"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-07T00:14:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="EchoEcho"/> <meta itemprop="url" content="https://juejin.cn/user/2920774267837208"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3ä¸­éå“åº”å¼çš„å…¨å±€çŠ¶æ€ç®¡ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2920774267837208/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    EchoEcho
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T00:14:10.000Z" title="Sat Feb 07 2026 00:14:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨<code>vue</code>é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬è¯´åˆ°çŠ¶æ€ç®¡ç†ï¼Œæˆ‘ä»¬ä¼šæƒ³åˆ°<code>pinia</code>ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†éœ€è¦åœ¨å¤šä¸ªé¡µé¢ã€ç»„ä»¶é—´å…±äº«çš„æ•°æ®ï¼Œå¹¶ä¸”æ ¹æ®æ•°æ®çš„æ›´æ–°è§¦å‘ç›¸å…³çš„æ¸²æŸ“æ›´æ–°ã€‚ä½†å¦‚æœæ˜¯æ•°æ®å˜åŒ–ä¸ä¼šå¼•èµ·é¡µé¢åˆ·æ–°çš„å…¨å±€æ•°æ®å‘¢ï¼Ÿ</p>
<blockquote>
<p>Â æ¯”å¦‚æˆ‘å½“å‰å¼€å‘çš„é¡¹ç›®ä¸­ï¼Œéœ€è¦åœ¨é¡¹ç›®åˆå§‹åŒ–ä¹‹åè·å–å¯¹åº”çš„å¼•æ“å®ä¾‹ï¼Œè¯¥å®ä¾‹æä¾›ç›¸å…³<code>api</code>ç”¨äºå¤„ç†é¡µé¢é€»è¾‘ï¼Œä½†è¯¥å®ä¾‹å¹¶ä¸ä¼šè§¦å‘é¡µé¢çš„æ›´æ–°ï¼Œæ­¤æ—¶å°±éœ€è¦ä¸€ä¸ªÂ <strong>éå“åº”å¼çš„å…¨å±€çŠ¶æ€ç®¡ç†</strong>Â --Â <code>globalState</code></p>
</blockquote>
<h5 data-id="heading-0">é€‚ç”¨åœºæ™¯ï¼š</h5>
<ul>
<li>å…¨å±€é…ç½®ã€ç¼“å­˜ã€ä¸´æ—¶æ•°æ®</li>
<li>è·¨é¡µé¢/ç»„ä»¶çš„äº‹ä»¶é€šçŸ¥</li>
<li>ä¸éœ€è¦å“åº”å¼çš„æ•°æ®å…±äº«</li>
</ul>
<h5 data-id="heading-1">ä¸é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>éœ€è¦æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨åˆ·æ–°é¡µé¢çš„åœºæ™¯ã€ç”¨<code>Pinia</code>æˆ–<code>Vuex</code>ã€‘</li>
</ul>
<h5 data-id="heading-2">é€»è¾‘æ¢³ç†ï¼š</h5>
<ol>
<li>Â å®šä¹‰ä¸€ä¸ª<code>globalState</code>ç±»ï¼Œå…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹</li>
<li>ç»´æŠ¤ä¸€ä»½<code>state</code>æ•°æ®ï¼Œæä¾›<code>set</code>ã€<code>get</code>ã€<code>has</code>ã€<code>delete</code>ã€<code>clear</code></li>
<li>æä¾›äº‹ä»¶æ€»çº¿åŠŸèƒ½ï¼Œç”¨äºåœ¨ä¸åŒç»„ä»¶é—´â€œå¹¿æ’­æ¶ˆæ¯â€ï¼šÂ <code>on</code>ã€ç›‘å¬äº‹ä»¶ã€‘ã€<code>emit</code>ã€è§¦å‘äº‹ä»¶ã€‘ã€<code>off</code>ã€ç§»é™¤ç›‘å¬ã€‘</li>
</ol>
<h4 data-id="heading-3">å…·ä½“å®ç°ä»£ç ï¼š</h4>
<p><code>/stores/globalState.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆéå“åº”å¼ï¼‰</span>
<span class="hljs-comment">/**
Â * è·¨é¡µé¢/ç»„ä»¶å…±äº«æ•°æ®ï¼Œä½†åˆä¸éœ€è¦å“åº”å¼ï¼ˆä¸éœ€è¦è‡ªåŠ¨åˆ·æ–°UIï¼‰ã€‚
Â * å­˜å‚¨å…¨å±€é…ç½®ã€ç¼“å­˜ã€ä¸´æ—¶æ•°æ®ç­‰ã€‚
Â * é¿å…æ±¡æŸ“ windowï¼Œæ¯”ç›´æ¥ç”¨ window.xxx æ›´å®‰å…¨ã€å¯æ§ã€æ˜“ç»´æŠ¤ã€‚
Â * æ¯” Pinia/Vuex æ›´è½»é‡ï¼Œé€‚åˆå­˜å‚¨ä¸éœ€è¦å“åº”å¼çš„æ•°æ®ã€‚
Â */</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalState</span> {
Â  Â  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">GlobalState</span>
Â  Â  <span class="hljs-keyword">private</span> <span class="hljs-attr">state</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
Â  Â  <span class="hljs-keyword">private</span> <span class="hljs-attr">eventListeners</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Function</span>[]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()

Â  Â  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">GlobalState</span> {
Â  Â  Â  Â  <span class="hljs-keyword">if</span>(!<span class="hljs-title class_">GlobalState</span>.<span class="hljs-property">instance</span>) {
Â  Â  Â  Â  Â  Â  <span class="hljs-title class_">GlobalState</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GlobalState</span>()
Â  Â  Â  Â  }
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-title class_">GlobalState</span>.<span class="hljs-property">instance</span>
Â  Â  }
Â  Â Â 
Â  Â  <span class="hljs-title function_">set</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">void</span> {
Â  Â  Â  Â  <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">set</span>(key, value)
Â  Â  }

Â  Â  <span class="hljs-title function_">get</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">any</span> {
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">get</span>(key)
Â  Â  }

Â  Â  <span class="hljs-title function_">has</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span> {
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">has</span>(key)
Â  Â  }

Â  Â  <span class="hljs-title function_">delete</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span> {
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">delete</span>(key)
Â  Â  }

Â  Â  <span class="hljs-title function_">clear</span>(): <span class="hljs-built_in">void</span> {
Â  Â  Â  Â  <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">clear</span>()
Â  Â  }

Â  Â  <span class="hljs-comment">// æ–°å¢äº‹ä»¶æ€»çº¿åŠŸèƒ½</span>
Â  Â  <span class="hljs-title function_">on</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">Function</span>): <span class="hljs-built_in">void</span> {
Â  Â  Â  Â  <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">has</span>(eventName)) {
Â  Â  Â  Â  Â  Â  <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">set</span>(eventName, [])
Â  Â  Â  Â  }
Â  Â  Â  Â  <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">get</span>(eventName)?.<span class="hljs-title function_">push</span>(callback)
Â  Â  }
Â  Â Â 
Â  Â  <span class="hljs-title function_">emit</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, data?: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">void</span> {
Â  Â  Â  Â  <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">get</span>(eventName)
Â  Â  Â  Â  <span class="hljs-keyword">if</span>(listeners) {
Â  Â  Â  Â  Â  Â  listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> {
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">try</span> {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-title function_">callback</span>(data)
Â  Â  Â  Â  Â  Â  Â  Â  } <span class="hljs-keyword">catch</span> (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'äº‹ä»¶å›è°ƒæ‰§è¡Œé”™è¯¯:'</span>, error)
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  }
Â  Â  }

Â  Â  <span class="hljs-title function_">off</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, callback?: <span class="hljs-title class_">Function</span>): <span class="hljs-built_in">void</span> {
Â  Â  Â  Â  <span class="hljs-keyword">if</span> (!callback) {
Â  Â  Â  Â  Â  Â  <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">delete</span>(eventName)
Â  Â  Â  Â  } <span class="hljs-keyword">else</span> {
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">get</span>(eventName)
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">if</span> (listeners) {
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">const</span> index = listeners.<span class="hljs-title function_">indexOf</span>(callback)
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listeners.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> globalState = <span class="hljs-title class_">GlobalState</span>.<span class="hljs-title function_">getInstance</span>()
</code></pre>
<h5 data-id="heading-4">ä½¿ç”¨</h5>
<ol>
<li>ç»„ä»¶A --Â <code>a.vue</code>Â  ã€å½“å¼•æ“å®ä¾‹åŒ–æˆåŠŸåï¼Œè®¾ç½®å¼•æ“æ•°æ®ï¼Œå¹¶è§¦å‘å¹¿æ’­ï¼Œåœ¨é€‚åˆçš„æ—¶æœºé”€æ¯ç›¸å…³æ•°æ®ã€‘</li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// a.vue å½“å¼•æ“å®ä¾‹åŒ–æˆåŠŸåï¼Œè®¾ç½®å¼•æ“æ•°æ®ï¼Œå¹¶è§¦å‘å¹¿æ’­</span>
<span class="hljs-keyword">import</span> { globalState } from <span class="hljs-string">"@/stores/globalState"</span>;
<span class="hljs-keyword">const</span> InstanceHasInited = (<span class="hljs-keyword">data</span>) =&gt; {
Â  Â  Â  <span class="hljs-keyword">if</span> (engine) {
Â  Â  Â  Â  Â  Â  globalState.<span class="hljs-keyword">set</span>(<span class="hljs-string">"engineInstance"</span>, <span class="hljs-keyword">data</span>);
Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// è§¦å‘äº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–ç»„ä»¶</span>
Â  Â  Â  Â  Â  Â  globalState.emit(<span class="hljs-string">"engineInstance:created"</span>, <span class="hljs-keyword">data</span>);
Â  Â  Â  }
});
<span class="hljs-comment">// é”€æ¯ç›¸å…³æ•°æ®</span>
onUnmounted(() =&gt; {
Â  globalState.delete(<span class="hljs-string">"engineInstance"</span>);
Â  globalState.off(<span class="hljs-string">"engineInstance:created"</span>);
});
</code></pre>
<ol>
<li>ç»„ä»¶B --Â <code>b.vue</code>Â  ã€åœ¨éœ€è¦ä½¿ç”¨å¼•æ“<code>api</code>è·å–æ•°æ®çš„ä½ç½®æ·»åŠ ç›‘å¬ã€‘</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">import</span> { globalState } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/globalState"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleInstanceCreated</span> = (<span class="hljs-params">engine: Engine</span>) =&gt; {
Â  Â  <span class="hljs-keyword">if</span>(engine) {
Â  Â  Â  Â  <span class="hljs-comment">// è°ƒç”¨ç›¸å…³api</span>
Â  Â  }
}
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
Â  <span class="hljs-comment">// ç›‘å¬å¼•æ“å®ä¾‹åˆ›å»ºäº‹ä»¶</span>
Â  globalState.<span class="hljs-title function_">on</span>(<span class="hljs-string">"engineInstance:created"</span>, handleInstanceCreated);
})
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android ç½‘ç»œå­ç³»ç»Ÿé¢è¯•çŸ¥è¯†ç‚¹å…¨è§£]]></title>    <link>https://juejin.cn/post/7603595309232029706</link>    <guid>https://juejin.cn/post/7603595309232029706</guid>    <pubDate>2026-02-07T01:36:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603595309232029706" data-draft-id="7603376587652841522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android ç½‘ç»œå­ç³»ç»Ÿé¢è¯•çŸ¥è¯†ç‚¹å…¨è§£"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T01:36:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android ç½‘ç»œå­ç³»ç»Ÿé¢è¯•çŸ¥è¯†ç‚¹å…¨è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:36:21.000Z" title="Sat Feb 07 2026 01:36:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€å®è§‚æ¶æ„ï¼ˆå¿…é—®ï¼‰</h3>
<p><strong>1. NetworkStack çš„å®šä¹‰å’Œç»„æˆ</strong></p>
<pre><code class="hljs language-scss" lang="scss">é—®ï¼šNetworkStack æ˜¯ä»€ä¹ˆï¼Ÿ
ç­”ï¼šä¸æ˜¯å•ä¸€æ¨¡å—ï¼Œè€Œæ˜¯ç½‘ç»œç®¡ç†æ¡†æ¶çš„æ€»ç§°
  â”œâ”€ frameworks_base (ConnectivityService åŸºç¡€)
  â”œâ”€ packages_modules_Connectivity (å¯æ›´æ–°éƒ¨åˆ†ï¼ŒAPEX)
  â”œâ”€ system_netd (å®ˆæŠ¤è¿›ç¨‹)
  â”œâ”€ hardware_ril (ç”µè¯å±‚)
  â””â”€ hardware_interfaces (ç¡¬ä»¶é€‚é…)

å…³é”®è¯ï¼šåˆ†å±‚è§£è€¦ã€APEX å¯æ›´æ–°ã€æ¨¡å—åŒ–
</code></pre>
<p><strong>2. ç³»ç»Ÿå¯åŠ¨æµç¨‹</strong></p>
<pre><code class="hljs language-scss" lang="scss">SystemServer<span class="hljs-selector-class">.main</span>()
  â†“
åˆå§‹åŒ–ç½‘ç»œç›¸å…³æœåŠ¡é¡ºåºï¼ˆé‡ç‚¹è®°ä½ï¼‰ï¼š
  <span class="hljs-number">1</span>. ConnectivityModuleConnector<span class="hljs-selector-class">.init</span>()
  <span class="hljs-number">2</span>. NetworkStackClient<span class="hljs-selector-class">.init</span>()
  <span class="hljs-number">3</span>. NetworkManagementService<span class="hljs-selector-class">.create</span>()  â† netd é€šä¿¡å±‚
  <span class="hljs-number">4</span>. NetworkStatsService<span class="hljs-selector-class">.start</span>()        â† å¿…é¡»åœ¨ NetworkPolicyManager ä¹‹å‰
  <span class="hljs-number">5</span>. <span class="hljs-built_in">NetworkPolicyManagerService</span>()      â† æµé‡é™åˆ¶
  <span class="hljs-number">6</span>. WifiService<span class="hljs-selector-class">.start</span>()                â† WiFi
  <span class="hljs-number">7</span>. ConnectivityService<span class="hljs-selector-class">.start</span>()        â† æ ¸å¿ƒ
  <span class="hljs-number">8</span>. VpnManagerService<span class="hljs-selector-class">.create</span>()
  
<span class="hljs-built_in">systemReady</span>() é˜¶æ®µï¼š
  â”œâ”€ networkManagement<span class="hljs-selector-class">.systemReady</span>()
  â”œâ”€ connectivity<span class="hljs-selector-class">.systemReady</span>()
  â””â”€ NetworkStackClient<span class="hljs-selector-class">.start</span>()         â† çœŸæ­£å¯åŠ¨ NetworkStack
</code></pre>
<p><strong>æ¨¡å—åŠ è½½æ–¹å¼</strong>ï¼ˆé¢è¯•å¸¸é—®ï¼‰ï¼š</p>
<ul>
<li>ä» APEX (<code>com.android.tethering</code>) åŠ è½½</li>
<li>ä½¿ç”¨ AIDL è¿›ç¨‹é—´é€šä¿¡</li>
<li><code>startServiceFromJar()</code> åŠ¨æ€åŠ è½½</li>
</ul>
<hr/>
<h3 data-id="heading-1">äºŒã€æ ¸å¿ƒç»„ä»¶æ·±åº¦ï¼ˆé«˜é¢‘è€ƒç‚¹ï¼‰</h3>
<h4 data-id="heading-2">2.1 ConnectivityServiceï¼ˆæœ€é‡è¦ï¼‰</h4>
<p><strong>èŒè´£äº”å¤§ä»¶</strong>ï¼ˆå¿…èƒŒï¼‰ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ç½‘ç»œç”Ÿå‘½å‘¨æœŸç®¡ç†
<span class="hljs-bullet">   -</span> NetworkAgent æ³¨å†Œ/æ³¨é”€
<span class="hljs-bullet">   -</span> ç½‘ç»œçŠ¶æ€è½¬æ¢ï¼ˆNASCENT â†’ CONNECTED â†’ LINGERING â†’ DESTROYEDï¼‰

<span class="hljs-bullet">2.</span> ç½‘ç»œè¯·æ±‚åŒ¹é…ç®—æ³•
<span class="hljs-bullet">   -</span> NetworkRequest + NetworkCapabilities åŒ¹é…
<span class="hljs-bullet">   -</span> ç½‘ç»œè¯„åˆ†ï¼ˆNetworkRankerï¼‰
<span class="hljs-bullet">   -</span> é»˜è®¤ç½‘ç»œé€‰æ‹©

<span class="hljs-bullet">3.</span> ç½‘ç»œéªŒè¯æœºåˆ¶
<span class="hljs-bullet">   -</span> NetworkMonitor æ¢æµ‹
<span class="hljs-bullet">   -</span> éªŒè¯æµç¨‹ï¼šDNS â†’ HTTP â†’ HTTPS â†’ Private DNS
<span class="hljs-bullet">   -</span> éªŒè¯ç»“æœï¼šVALID/PARTIAL/INVALID/SKIP

<span class="hljs-bullet">4.</span> æƒé™å’Œç­–ç•¥ç®¡ç†
<span class="hljs-bullet">   -</span> UID æƒé™æ£€æŸ¥
<span class="hljs-bullet">   -</span> VPN éš”ç¦»
<span class="hljs-bullet">   -</span> èƒŒæ™¯åº”ç”¨é™åˆ¶

<span class="hljs-bullet">5.</span> ç½‘ç»œå›è°ƒé€šçŸ¥
<span class="hljs-bullet">   -</span> NetworkCallback æœºåˆ¶
<span class="hljs-bullet">   -</span> CONNECTIVITY<span class="hljs-emphasis">_ACTION å¹¿æ’­
   - Settings æ•°æ®åº“åŒæ­¥
</span></code></pre>
<p><strong>é‡è¦æ•°æ®ç»“æ„</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java">NetworkAgentInfo:
  â”œâ”€ ç½‘ç»œæ ‡è¯†
  â”‚  â”œâ”€ Network network
  â”‚  â”œâ”€ NetworkInfo networkInfo
  â”‚  â””â”€ LinkProperties linkProperties
  â”‚
  â”œâ”€ çŠ¶æ€è·Ÿè¸ª
  â”‚  â”œâ”€ mCreatedTime (netd åˆ›å»º)
  â”‚  â”œâ”€ mConnectedTime (å¯ç”¨æ—¶é—´)
  â”‚  â”œâ”€ mFirstValidationTime (é¦–æ¬¡éªŒè¯)
  â”‚  â””â”€ mCurrentValidationTime (æœ€æ–°éªŒè¯)
  â”‚
  â”œâ”€ èƒ½åŠ›æè¿°
  â”‚  â””â”€ NetworkCapabilities (INTERNET, NOT_METEREDç­‰)
  â”‚
  â””â”€ ç½‘ç»œè¯„åˆ†
     â””â”€ FullScore (ç”¨äºæ’åº)
</code></pre>
<p><strong>å¸¸è§é¢è¯•é¢˜</strong>ï¼š</p>
<ul>
<li>
<p>Q: ConnectivityService å¦‚ä½•é€‰æ‹©é»˜è®¤ç½‘ç»œï¼Ÿ
A: é€šè¿‡ NetworkRanker å¯¹æ‰€æœ‰å¯ç”¨ç½‘ç»œè¯„åˆ†ï¼Œé€‰æœ€é«˜åˆ†ã€‚è¯„åˆ†è€ƒè™‘ï¼štransportä¼˜å…ˆçº§ã€éªŒè¯çŠ¶æ€ã€ç”¨æˆ·åå¥½ã€æƒé™ç­‰</p>
</li>
<li>
<p>Q: å¦‚ä½•å®ç°åº”ç”¨ç»‘å®šåˆ°ç‰¹å®šç½‘ç»œï¼Ÿ
A: åº”ç”¨è°ƒç”¨ <code>bindProcessToNetwork(network)</code> â†’ ConnectivityService è®¾ç½® socket mark â†’ è·¯ç”±æŸ¥è¯¢æ—¶ä½¿ç”¨ä¸“ç”¨è·¯ç”±è¡¨</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-3">2.2 NetworkAgentInfo ç½‘ç»œä»£ç†ä¿¡æ¯</h4>
<p><strong>çŠ¶æ€æœº</strong>ï¼ˆé¢è¯•å¿…é—®ï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   NASCENT       â”‚
                     â”‚  (æ–°å»ºï¼Œæœªè¿)    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   CONNECTED     â”‚
                     â”‚   (å·²è¿æ¥)       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   LINGERING     â”‚
                     â”‚   (ä¿æ´»ç­‰é”€æ¯)   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   DESTROYED     â”‚
                     â”‚   (å·²é”€æ¯)       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å…³é”®æ—¶é—´æˆ³</strong>ï¼ˆå¿…èƒŒï¼‰ï¼š</p>
<ul>
<li><code>mCreatedTime</code> - netd åˆ›å»ºæ—¶é—´</li>
<li><code>mConnectedTime</code> - è¿æ¥å¯ç”¨æ—¶é—´ï¼ˆfirst CONNECTEDï¼‰</li>
<li><code>mFirstValidationTime</code> - é¦–æ¬¡éªŒè¯é€šè¿‡ï¼ˆstickyï¼‰</li>
<li><code>mCurrentValidationTime</code> - æœ€æ–°éªŒè¯ç»“æœ</li>
<li><code>mDestroyedTime</code> - é”€æ¯æ—¶é—´</li>
</ul>
<hr/>
<h4 data-id="heading-4">2.3 ç½‘ç»œéªŒè¯ï¼ˆNetworkMonitorï¼‰</h4>
<p><strong>éªŒè¯æµç¨‹</strong>ï¼ˆé¢è¯•é«˜é¢‘ï¼‰ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">ç½‘ç»œè¿æ¥æˆåŠŸ
  â†“
ConnectivityService åˆ›å»º NetworkMonitor
  â†“
éªŒè¯æ­¥éª¤ï¼ˆé¡ºåºæ‰§è¡Œï¼‰ï¼š
  <span class="hljs-number">1</span>. DNS æ¢æµ‹
     â””â”€ æŸ¥è¯¢ <span class="hljs-string">"www.google.com"</span> (å¯é…ç½®)
     
  <span class="hljs-number">2</span>. HTTP æ¢æµ‹
     â””â”€ <span class="hljs-keyword">GET</span> http://www.google.com/generate_204
     â””â”€ æœŸæœ›ï¼š<span class="hljs-number">204</span> No Content
     
  <span class="hljs-number">3</span>. HTTPS æ¢æµ‹
     â””â”€ <span class="hljs-keyword">GET</span> https://www.google.com/generate_204
     â””â”€ æœŸæœ›ï¼š<span class="hljs-number">204</span> No Content
     
  <span class="hljs-number">4</span>. <span class="hljs-keyword">Private</span> DNS æ¢æµ‹ (å¦‚æœå¯ç”¨)
     â””â”€ DNS over TLS/DoH
     â””â”€ å•ç‹¬éªŒè¯æµç¨‹

éªŒè¯ç»“æœï¼š
  â”œâ”€ VALID (å®Œå…¨è¿æ¥ï¼Œæ‰€æœ‰æ¢æµ‹é€šè¿‡)
  â”œâ”€ <span class="hljs-keyword">PARTIAL</span> (éƒ¨åˆ†è¿æ¥ï¼Œéƒ¨åˆ†å¤±è´¥)
  â”œâ”€ INVALID (æ— è¿æ¥ï¼Œæ‰€æœ‰å¤±è´¥)
  â””â”€ <span class="hljs-keyword">SKIP</span> (è·³è¿‡éªŒè¯ï¼Œå¦‚æŸäº›ç‰¹æ®Šç½‘ç»œ)
</code></pre>
<p><strong>éªŒè¯å¤±è´¥åœºæ™¯</strong>ï¼ˆé¢è¯•å¸¸é—®ï¼‰ï¼š</p>
<ul>
<li>å›½å®¶/è¿è¥å•†å¹²æ‰°</li>
<li>ä»£ç†é‡å®šå‘ï¼ˆéªŒè¯ä¸º captive portalï¼‰</li>
<li>DNS é—®é¢˜</li>
<li>é˜²ç«å¢™é™åˆ¶</li>
</ul>
<hr/>
<h4 data-id="heading-5">2.4 DNS ç®¡ç†ï¼ˆDnsManagerï¼‰</h4>
<p><strong>DNS é…ç½®æ¥æº</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">DHCP è·å–çš„ DNS
<span class="hljs-bullet">  +</span> æ‰‹åŠ¨é…ç½®
<span class="hljs-bullet">  +</span> Private DNS (DoH/DoT)
  â†“
DnsManager.updateDnses()
  â†“
IDnsResolver AIDL
  â†“
netd dnsresolver æ¨¡å—
</code></pre>
<p><strong>Private DNS ä¸‰ç§æ¨¡å¼</strong>ï¼ˆå¿…èƒŒï¼‰ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> PRIVATE<span class="hljs-emphasis">_DNS_</span>MODE<span class="hljs-emphasis">_OFF
   â””â”€ å…³é—­ï¼Œä½¿ç”¨æ˜æ–‡ DNS

2. PRIVATE_</span>DNS<span class="hljs-emphasis">_MODE_</span>OPPORTUNISTIC
   â””â”€ å°è¯• DoH/DoTï¼Œå¤±è´¥å›æºåˆ°æ˜æ–‡

<span class="hljs-bullet">3.</span> PRIVATE<span class="hljs-emphasis">_DNS_</span>MODE<span class="hljs-emphasis">_PROVIDER_</span>HOSTNAME
   â””â”€ å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šä¸»æœºçš„ Private DNS
</code></pre>
<hr/>
<h3 data-id="heading-6">ä¸‰ã€è·¯ç”±ç®¡ç†ç³»ç»Ÿï¼ˆé‡è¦ï¼‰</h3>
<h4 data-id="heading-7">3.1 ç­–ç•¥è·¯ç”±ï¼ˆPolicy-based Routingï¼‰</h4>
<p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">ä¼ ç»Ÿè·¯ç”±ï¼šåªçœ‹ç›®æ ‡ IP
   â†“ vs â†“
ç­–ç•¥è·¯ç”±ï¼šçœ‹ç›®æ ‡ IP + fwmark + <span class="hljs-built_in">UID</span> + IIF + OIF ç­‰

Android éœ€è¦ç­–ç•¥è·¯ç”±åŸå› ï¼š
  â”œâ”€ å¤šç½‘ç»œå¹¶å­˜ï¼ˆWiFi + èœ‚çª + VPNï¼‰
  â”œâ”€ <span class="hljs-built_in">UID</span> ç²’åº¦æ§åˆ¶ï¼ˆåº”ç”¨çº§é€‰ç½‘ï¼‰
  â””â”€ VPN éš”ç¦»å’Œåˆ†éš§é“
</code></pre>
<p><strong>Fwmark æ ‡è®°ä½“ç³»</strong>ï¼ˆé¢è¯•å¿…é—®ï¼‰ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Fwmark</span> {
    <span class="hljs-type">uint32_t</span> netId : <span class="hljs-number">16</span>;              <span class="hljs-comment">// ç½‘ç»œID (0-65535)</span>
    <span class="hljs-type">uint32_t</span> explicitlySelected : <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ˜ç¡®é€‰æ‹©è¿˜æ˜¯éšå¼</span>
    <span class="hljs-type">uint32_t</span> protectedFromVpn : <span class="hljs-number">1</span>;    <span class="hljs-comment">// æ˜¯å¦å— VPN ä¿æŠ¤</span>
    <span class="hljs-type">uint32_t</span> permission : <span class="hljs-number">2</span>;          <span class="hljs-comment">// æƒé™ (NONE/SYSTEM/INTERNET)</span>
    <span class="hljs-type">uint32_t</span> reserved : <span class="hljs-number">12</span>;           <span class="hljs-comment">// ä¿ç•™</span>
};
</code></pre>
<p><strong>åº”ç”¨æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨ <span class="hljs-built_in">requestNetwork</span>() æˆ– <span class="hljs-built_in">bindProcessToNetwork</span>()
  â†“
ConnectivityService<span class="hljs-selector-class">.requestNetwork</span>()
  â†“
è®¾ç½® socket <span class="hljs-selector-tag">mark</span>ï¼šfwmark = {netId, explicitlySelected, ...}
  â†“
kernel <span class="hljs-built_in">socket</span>(SO_MARK) or iptables <span class="hljs-selector-tag">MARK</span>
  â†“
routing lookup (æŸ¥è¯¢è§„åˆ™è¡¨)
  â†“
kernel æŒ‰ç…§ FIB è§„åˆ™åŒ¹é…
  â”œâ”€ è§„åˆ™ <span class="hljs-number">1</span> (ä¼˜å…ˆçº§ <span class="hljs-number">9000</span>): æœ¬åœ°è·¯ç”±
  â”œâ”€ è§„åˆ™ <span class="hljs-number">2</span> (ä¼˜å…ˆçº§ <span class="hljs-number">10000</span>): VPN è§„åˆ™
  â”œâ”€ ...
  â””â”€ è§„åˆ™ N (ä¼˜å…ˆçº§æœ€ä½): ä¸»è·¯ç”±è¡¨
  
æ¯æ¡è§„åˆ™æŒ‡å®šï¼š
  â”œâ”€ åŒ¹é…æ¡ä»¶ (fwmark, UID range, IIFç­‰)
  â””â”€ åŠ¨ä½œ (æŒ‡å‘å“ªä¸ªè·¯ç”±è¡¨)
  
æœ€ç»ˆï¼šä½¿ç”¨æŒ‡å®šè·¯ç”±è¡¨æŸ¥æ‰¾ç›®æ ‡ IP
</code></pre>
<h4 data-id="heading-8">3.2 ç½‘ç»œæ¥å£è·¯ç”±è¡¨</h4>
<p><strong>æ¯ä¸ªç‰©ç†æ¥å£çš„è·¯ç”±è¡¨è®¡ç®—</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">table_id</span> = interface_index + ROUTE_TABLE_<span class="hljs-literal">OFF</span>SET_FROM_INDEX

ç¤ºä¾‹ï¼š
  æ¥å£ wlan0  (<span class="hljs-attr">if_index</span>=<span class="hljs-number">2</span>)  â†’ è·¯ç”±è¡¨ <span class="hljs-number">10002</span>
  æ¥å£ rmnet0 (<span class="hljs-attr">if_index</span>=<span class="hljs-number">3</span>)  â†’ è·¯ç”±è¡¨ <span class="hljs-number">10003</span>
  æ¥å£ eth0   (<span class="hljs-attr">if_index</span>=<span class="hljs-number">4</span>)  â†’ è·¯ç”±è¡¨ <span class="hljs-number">10004</span>
</code></pre>
<p><strong>ç‰¹æ®Šè·¯ç”±è¡¨</strong>ï¼ˆå¿…èƒŒï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">RT_TABLE_LOCAL (<span class="hljs-number">255</span>)            - æœ¬åœ°è·¯ç”± (<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>ç­‰)
RT_TABLE_MAIN (<span class="hljs-number">254</span>)             - ä¸»è·¯ç”±è¡¨ (é»˜è®¤)
ROUTE_TABLE_LOCAL_NETWORK (<span class="hljs-number">97</span>)  - æœ¬åœ°ç½‘ç»œç‰¹æ®Šè·¯ç”±
ROUTE_TABLE_LEGACY_NETWORK (<span class="hljs-number">98</span>) - é—ç•™ç½‘ç»œ
ROUTE_TABLE_LEGACY_SYSTEM (<span class="hljs-number">99</span>)  - é—ç•™ç³»ç»Ÿ
</code></pre>
<hr/>
<h3 data-id="heading-9">å››ã€VPN å’Œåˆ†éš§é“ï¼ˆé¢è¯•å¸¸é—®ï¼‰</h3>
<p><strong>VPN æ¶æ„</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨å±‚ VPN Service
  â†“ AIDL
VPN ç®¡ç†å±‚ (VpnManagerService)
  â†“
ç³»ç»Ÿé›†æˆå±‚ (ConnectivityService)
  â”œâ”€ VPN ä½œä¸º NetworkAgent æ³¨å†Œ
  â”œâ”€ NetworkCapabilities æ ‡è®°ä¸º VPN
  â””â”€ ä¸å…¶ä»–ç½‘ç»œç«äº‰ (é€šå¸¸ä¼˜å…ˆçº§é«˜)
  â†“
å†…æ ¸å±‚ (TUN/TAP + netd)
  â”œâ”€ åˆ›å»ºè™šæ‹Ÿç½‘å¡
  â”œâ”€ è·¯ç”±è§„åˆ™é…ç½®
  â””â”€ æ•°æ®åŒ…æ‹¦æˆª/è½¬å‘
</code></pre>
<p><strong>åˆ†éš§é“ï¼ˆSplit Tunnelï¼‰å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">VPN è®¾ç½® declaredUnderlyingNetworks <span class="hljs-operator">=</span> {network1, network2}
  â†“
ConnectivityService æ·»åŠ  fallthrough è§„åˆ™ï¼š
  
  if (packet <span class="hljs-keyword">matches</span> VPN fwmark)
      lookup <span class="hljs-keyword">in</span> VPN routing <span class="hljs-keyword">table</span>
      if found â†’ through VPN
      if <span class="hljs-keyword">NOT</span> found â†’ fallthrough è§„åˆ™ â†’ underlying network <span class="hljs-keyword">table</span>
</code></pre>
<p><strong>å¸¸è§é¢è¯•é¢˜</strong>ï¼š</p>
<ul>
<li>Q: ä¸ºä»€ä¹ˆ VPN è¦æŒ‡å®š underlying networksï¼Ÿ
A: å‘Šè¯‰ç³»ç»Ÿ VPN ä¸‹é¢çœŸå®çš„ç½‘ç»œæ˜¯ä»€ä¹ˆï¼Œç”¨äº split tunnel å’Œæ•…éšœè½¬ç§»</li>
</ul>
<hr/>
<h3 data-id="heading-10">äº”ã€NAT64 å’Œ IPv6ï¼ˆé‡è¦ï¼‰</h3>
<p><strong>NAT64 (464xlat) ç”¨é€”</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">IPv6-only ç½‘ç»œ + åº”ç”¨æœŸæœ› IPv4
  â†“
clatd å®ˆæŠ¤è¿›ç¨‹ï¼š
  â”œâ”€ åˆ›å»ºè™šæ‹Ÿç½‘å¡ (v4-&lt;iface&gt;)
  â”œâ”€ ç›‘å¬ IPv4 æµé‡
  â”œâ”€ ç¿»è¯‘æˆ IPv6 (ä½¿ç”¨ NAT64 å‰ç¼€)
  â”œâ”€ å‘é€åˆ°çœŸå®ç½‘ç»œ
  â””â”€ å“åº”ç¿»è¯‘å› IPv4
</code></pre>
<p><strong>NAT64 å‰ç¼€å‘ç°</strong>ï¼ˆé¢è¯•é«˜é¢‘ï¼‰ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> Router Advertisement (RA)
   â””â”€ ç›´æ¥ä» RA æŠ¥æ–‡ä¸­è·å¾—
   
<span class="hljs-bullet">2.</span> DNS (RFC 7050)
   â””â”€ æŸ¥è¯¢ "ipv4only.arpa"
   â””â”€ è·å¾— AAAA è®°å½•
   
<span class="hljs-bullet">3.</span> é»˜è®¤å‰ç¼€
   â””â”€ 64:ff9b::/96
</code></pre>
<hr/>
<h3 data-id="heading-11">å…­ã€å¤šæ’­è·¯ç”±ï¼ˆè¿›é˜¶ï¼‰</h3>
<p><strong>IPv6 å¤šæ’­è½¬å‘</strong>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">MulticastRoutingCoordinatorService:</span>
  â”œâ”€ æ·»åŠ è™šæ‹Ÿæ¥å£ (MIF index)
  â”œâ”€ æ·»åŠ å¤šæ’­è½¬å‘ç¼“å­˜ (MFC)
  â”‚  â””â”€ <span class="hljs-keyword">Key</span>: (incoming iface, source addr, <span class="hljs-keyword">group</span> addr)
  â”‚  â””â”€ Value: {outgoing interfaces}
  â””â”€ ä¸‰ç§è½¬å‘æ¨¡å¼ï¼š
     â”œâ”€ FORWARD_NONE
     â”œâ”€ FORWARD_WITH_MIN_SCOPE
     â””â”€ FORWARD_SELECTED
</code></pre>
<hr/>
<h3 data-id="heading-12">ä¸ƒã€Android 15 æ–°ç‰¹æ€§ï¼ˆåŠ åˆ†é¡¹ï¼‰</h3>
<p><strong>eBPF ç½‘ç»œç­–ç•¥</strong>ï¼š</p>
<pre><code class="hljs">é«˜æ€§èƒ½è·¯ç”±å’Œæµé‡æ§åˆ¶
  â”œâ”€ Metered ç½‘ç»œæ ‡è®°
  â”œâ”€ åº”ç”¨çº§é˜²ç«å¢™
  â”œâ”€ ç½‘ç»œåˆ‡ç‰‡æ”¯æŒ
  â””â”€ å®æ—¶æ€§èƒ½ç›‘æµ‹
</code></pre>
<p><strong>5G ç½‘ç»œåˆ‡ç‰‡</strong>ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">URSP (UE Route Selection Policy)
Traffic Descriptor åŒ¹é…
<span class="hljs-built_in">NSSAI</span> æ”¯æŒ
</code></pre>
<hr/>
<h3 data-id="heading-13">å…«ã€å®æˆ˜é¢è¯•é¢˜åº“</h3>
<p><strong>åŸºç¡€é¢˜</strong>ï¼ˆå¿…ä¼šï¼‰ï¼š</p>
<ol>
<li>
<p>Q: ä»€ä¹ˆæ˜¯ ConnectivityServiceï¼Ÿ
A: Android æ ¸å¿ƒç½‘ç»œç®¡ç†æœåŠ¡ï¼Œè´Ÿè´£ç½‘ç»œé€‰æ‹©ã€éªŒè¯ã€å›è°ƒç­‰</p>
</li>
<li>
<p>Q: å¦‚ä½•è·å–å½“å‰å¯ç”¨ç½‘ç»œåˆ—è¡¨ï¼Ÿ
A: <code>ConnectivityManager.getAllNetworks()</code> æˆ– <code>getAvailableNetworks()</code></p>
</li>
<li>
<p>Q: å¦‚ä½•è®©åº”ç”¨ä½¿ç”¨ç‰¹å®šç½‘ç»œï¼Ÿ
A: è°ƒç”¨ <code>bindProcessToNetwork(network)</code> æˆ– <code>requestNetwork(request, callback)</code></p>
</li>
</ol>
<p><strong>ä¸­ç­‰é¢˜</strong>ï¼ˆå¸¸è§ï¼‰ï¼š
4. Q: ç½‘ç»œéªŒè¯å¤±è´¥ä¼šæ€æ ·ï¼Ÿ
A: ç½‘ç»œå¤±å» VALIDATED èƒ½åŠ›ï¼Œä¸ä¼šæˆä¸ºé»˜è®¤ç½‘ç»œï¼Œåº”ç”¨å¯æ”¶åˆ°éªŒè¯å¤±è´¥å›è°ƒ</p>
<ol start="5">
<li>
<p>Q: å¦‚ä½•å®ç°åº”ç”¨çº§ VPN æ§åˆ¶ï¼Ÿ
A: åœ¨ NetworkCapabilities ä¸­æŒ‡å®šåº”ç”¨ UID èŒƒå›´ï¼ŒConnectivityService æ ¹æ® UID é€‰æ‹© VPN</p>
</li>
<li>
<p>Q: Split Tunnel VPN å¦‚ä½•å·¥ä½œï¼Ÿ
A: VPN æŒ‡å®š underlying networksï¼ŒæœªåŒ¹é…çš„æµé‡ä½¿ç”¨ fallthrough è§„åˆ™ç»•è¿‡ VPN</p>
</li>
</ol>
<p><strong>é«˜éš¾é¢˜</strong>ï¼ˆæ·±åº¦ï¼‰ï¼š
7. Q: æ€æ ·å®ç°å¤šç½‘ç»œä¼˜å…ˆçº§ç®¡ç†ï¼Ÿ
A: é€šè¿‡ç½‘ç»œè¯„åˆ†ç³»ç»Ÿï¼ŒConnectivityService å¯¹æ‰€æœ‰ç½‘ç»œè¯„åˆ†æ’åºï¼Œé€‰æœ€ä¼˜</p>
<ol start="8">
<li>
<p>Q: ä¸ºä»€ä¹ˆéœ€è¦ policy-based routingï¼Ÿ
A: æ”¯æŒå¤šç½‘ç»œå¹¶å­˜ã€UID ç²’åº¦æ§åˆ¶ã€VPN éš”ç¦»ç­‰ Android ç‰¹æœ‰éœ€æ±‚</p>
</li>
<li>
<p>Q: clatd ä¸ºä»€ä¹ˆéœ€è¦ NAT64 å‰ç¼€ï¼Ÿ
A: å°† IPv4 åœ°å€æ˜ å°„åˆ° IPv6 åœ°å€ç©ºé—´ï¼Œå‰ç¼€ç”¨äºæ ‡è®°è¿™äº›åˆæˆçš„ IPv6 åœ°å€</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-14">ä¹ã€é¢è¯•å‡†å¤‡å»ºè®®</h3>
<p><strong>ä»£ç å¿…è¯»</strong>ï¼ˆä¼˜å…ˆçº§ï¼‰ï¼š</p>
<ol>
<li>â­â­â­ <code>ConnectivityService.java</code> - æ ¸å¿ƒç±»</li>
<li>â­â­â­ <code>NetworkAgentInfo.java</code> - æ•°æ®ç»“æ„</li>
<li>â­â­â­ <code>RouteController.cpp</code> - è·¯ç”±ç®¡ç†</li>
<li>â­â­ <code>DnsManager.java</code> - DNS ç®¡ç†</li>
<li>â­â­ <code>Nat464Xlat.java</code> - NAT64 å®ç°</li>
</ol>
<p><strong>è°ƒè¯•å‘½ä»¤</strong>ï¼ˆåŠ åˆ†ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">dumpsys connectivity --verbose     <span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œçŠ¶æ€</span>
ip rule list [all]                 <span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰ç­–ç•¥è§„åˆ™</span>
ip route show table &lt;table_id&gt;      <span class="hljs-comment"># æŸ¥çœ‹ç‰¹å®šè·¯ç”±è¡¨</span>
netd list_table_for_interface wlan0 <span class="hljs-comment"># netd å‘½ä»¤</span>
adb logcat | grep NetworkMonitor   <span class="hljs-comment"># ç½‘ç»œéªŒè¯æ—¥å¿—</span>
</code></pre>
<p><strong>è¦ç‚¹æ€»ç»“</strong>ï¼ˆé¢è¯•æ—¶å¼ºè°ƒï¼‰ï¼š</p>
<ul>
<li>NetworkStack = åˆ†å±‚æ¶æ„ï¼ˆåº”ç”¨å±‚ â†’ ç³»ç»Ÿå±‚ â†’ netd â†’ å†…æ ¸ï¼‰</li>
<li>APEX å¯æ›´æ–°æ€§æ˜¯è®¾è®¡äº®ç‚¹</li>
<li>ç½‘ç»œè¯„åˆ† + ç­–ç•¥è·¯ç”±æ˜¯æ ¸å¿ƒç®—æ³•</li>
<li>VPN å’Œ split tunnel æ˜¯å¤æ‚ç‰¹æ€§</li>
<li>NAT64 è§£å†³ IPv6-only å…¼å®¹æ€§</li>
</ul>
<hr/>
<p>è¿™äº›çŸ¥è¯†ç‚¹æ˜¯ Android ç½‘ç»œé¢è¯•çš„å®Œæ•´ä½“ç³»ã€‚ç¥ä½ é¢è¯•é¡ºåˆ©ï¼ğŸ¯</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android ç½‘ç»œç­–ç•¥ç®¡ç†æœåŠ¡ï¼ˆNetworkPolicyManagerï¼‰å®Œæ•´æ¶æ„åˆ†æ]]></title>    <link>https://juejin.cn/post/7603591775391989787</link>    <guid>https://juejin.cn/post/7603591775391989787</guid>    <pubDate>2026-02-07T01:59:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603591775391989787" data-draft-id="7603575763787005978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android ç½‘ç»œç­–ç•¥ç®¡ç†æœåŠ¡ï¼ˆNetworkPolicyManagerï¼‰å®Œæ•´æ¶æ„åˆ†æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T01:59:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android ç½‘ç»œç­–ç•¥ç®¡ç†æœåŠ¡ï¼ˆNetworkPolicyManagerï¼‰å®Œæ•´æ¶æ„åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:59:59.000Z" title="Sat Feb 07 2026 01:59:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒæ¨¡å—æ¦‚è§ˆ</h2>
<h3 data-id="heading-1">1. <strong>NetworkPolicyManager</strong>ï¼ˆç”¨æˆ·ç©ºé—´æ¥å£å±‚ï¼‰</h3>
<p>ä½ç½®ï¼š<code>frameworks_base/core/java/android/net/NetworkPolicyManager.java</code></p>
<p><strong>åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>å…¬å¼€ API ç»™åº”ç”¨ç¨‹åºå’Œç³»ç»ŸæœåŠ¡</li>
<li>å®šä¹‰ç½‘ç»œç­–ç•¥ç±»å‹å’Œè§„åˆ™å¸¸é‡</li>
<li>é€šè¿‡ Binder IPC ä¸ <code>NetworkPolicyManagerService</code> é€šä¿¡</li>
</ul>
<p><strong>å…³é”®å¸¸é‡</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">POLICY_NONE</span> = <span class="hljs-number">0</span>x0
<span class="hljs-attr">POLICY_REJECT_METERED_BACKGROUND</span> = <span class="hljs-number">0</span>x1  // åå°æ‹’ç»è®¡è´¹ç½‘ç»œ
<span class="hljs-attr">POLICY_ALLOW_METERED_BACKGROUND</span> = <span class="hljs-number">0</span>x4   // åå°å…è®¸è®¡è´¹ç½‘ç»œ

<span class="hljs-attr">RULE_ALLOW_METERED</span> = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">0</span>      // å…è®¸è®¡è´¹ç½‘ç»œ
<span class="hljs-attr">RULE_ALLOW_ALL</span> = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">1</span>          // å…è®¸æ‰€æœ‰ç½‘ç»œ
<span class="hljs-attr">RULE_REJECT_METERED</span> = ...        // æ‹’ç»è®¡è´¹ç½‘ç»œ
<span class="hljs-attr">RULE_REJECT_ALL</span> = ...            // æ‹’ç»æ‰€æœ‰ç½‘ç»œ
</code></pre>
<hr/>
<h2 data-id="heading-2">äºŒã€æ ¸å¿ƒæœåŠ¡æ¶æ„</h2>
<h3 data-id="heading-3">1. <strong>INetworkPolicyManagerï¼ˆBinder æ¥å£ï¼‰</strong></h3>
<p>ä½ç½®ï¼š<code>frameworks_base/core/java/android/net/INetworkPolicyManager.aidl</code></p>
<p><strong>Binder æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// UID ç­–ç•¥æ§åˆ¶</span>
<span class="hljs-built_in">setUidPolicy</span>(uid, policy)
<span class="hljs-built_in">addUidPolicy</span>(uid, policy)
<span class="hljs-built_in">removeUidPolicy</span>(uid, policy)
<span class="hljs-built_in">getUidPolicy</span>(uid)
<span class="hljs-built_in">getUidsWithPolicy</span>(policy)

<span class="hljs-comment">// ç½‘ç»œç­–ç•¥</span>
<span class="hljs-built_in">setNetworkPolicies</span>(policies[])
<span class="hljs-built_in">getNetworkPolicies</span>()
<span class="hljs-built_in">snoozeLimit</span>(template)

<span class="hljs-comment">// é™åˆ¶èƒŒæ™¯æ•°æ®</span>
<span class="hljs-built_in">setRestrictBackground</span>(enabled)
<span class="hljs-built_in">getRestrictBackground</span>()
<span class="hljs-built_in">getRestrictBackgroundStatus</span>(uid)

<span class="hljs-comment">// é˜²ç«å¢™è§„åˆ™</span>
<span class="hljs-built_in">setDeviceIdleMode</span>(enabled)
<span class="hljs-built_in">setWifiMeteredOverride</span>(networkId, override)
</code></pre>
<h3 data-id="heading-4">2. <strong>NetworkPolicyManagerService</strong>ï¼ˆæ ¸å¿ƒæœåŠ¡å®ç°ï¼‰</h3>
<p>ä½ç½®ï¼š<code>frameworks_base/services/core/java/com/android/server/net/NetworkPolicyManagerService.java</code></p>
<p><strong>å…³é”®èŒè´£</strong>ï¼š</p>
<h4 data-id="heading-5">a) <strong>ç½‘ç»œç­–ç•¥ç®¡ç†</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç»´æŠ¤ NetworkPolicy å¯¹è±¡</span>
<span class="hljs-comment">// - template: ç½‘ç»œåŒ¹é…æ¨¡æ¿ (ç§»åŠ¨ç½‘ç»œ/WiFi/ä»¥å¤ªç½‘)</span>
<span class="hljs-comment">// - cycleRule: ä½¿ç”¨å‘¨æœŸ (æœˆåº¦ã€å‘¨åº¦ç­‰)</span>
<span class="hljs-comment">// - warningBytes: è­¦å‘Šé™åˆ¶ (è§¦å‘ç”¨æˆ·é€šçŸ¥)</span>
<span class="hljs-comment">// - limitBytes: ç¡¬é™åˆ¶ (è§¦å‘ç½‘ç»œç¦ç”¨)</span>
</code></pre>
<h4 data-id="heading-6">b) <strong>UID è§„åˆ™ç®¡ç†</strong></h4>
<p>ç»´æŠ¤ 6 ä¸ªé˜²ç«å¢™é“¾ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">FIREWALL_CHAIN_DOZABLE        (Doze æ¨¡å¼)
FIREWALL_CHAIN_STANDBY        (App Standby/åº”ç”¨é—²ç½®)
FIREWALL_CHAIN_POWERSAVE       (ç”µæ± çœç”µæ¨¡å¼)
FIREWALL_CHAIN_BACKGROUND     (åå°ç½‘ç»œé™åˆ¶)
FIREWALL_CHAIN_RESTRICTED     (å—é™æ¨¡å¼)
FIREWALL_CHAIN_LOW_POWER_STANDBY
</code></pre>
<h4 data-id="heading-7">c) <strong>åå°ç½‘ç»œé™åˆ¶ï¼ˆData Saver æ¨¡å¼ï¼‰</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç»´æŠ¤ä¸‰æ¡é“¾</span>
bw_penalty_box        <span class="hljs-comment">// æ‹’ç»åå• (UID è¢«é˜»æ­¢)</span>
bw_happy_box          <span class="hljs-comment">// å…è®¸åå• (UID è¢«å…è®¸)</span>
bw_data_saver         <span class="hljs-comment">// æ•°æ®ä¿æŠ¤æ¨¡å¼ (å…¨å±€é™åˆ¶)</span>
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">åº”ç”¨å‘èµ·ç½‘ç»œè¯·æ±‚
<span class="hljs-code">    â†“
æ£€æŸ¥ UID æ˜¯å¦åœ¨å„ä¸ªé™åˆ¶é“¾ä¸­
    â”œâ†’ FIREWALL_CHAIN_DOZABLE
    â”œâ†’ FIREWALL_CHAIN_STANDBY
    â”œâ†’ FIREWALL_CHAIN_POWERSAVE
    â”œâ†’ FIREWALL_CHAIN_BACKGROUND
    â”œâ†’ FIREWALL_CHAIN_RESTRICTED
    â””â†’ bw_penalty_box (æ•°æ®é™åˆ¶)
    â†“
åº”ç”¨è¢«å…è®¸/æ‹’ç»ç½‘ç»œè®¿é—®
</span></code></pre>
<hr/>
<h2 data-id="heading-8">ä¸‰ã€æ•°æ®ç»“æ„è¯¦è§£</h2>
<h3 data-id="heading-9">1. <strong>NetworkPolicyï¼ˆç½‘ç»œç­–ç•¥ï¼‰</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkPolicy</span> {
    NetworkTemplate template;      <span class="hljs-comment">// åŒ¹é…è§„åˆ™ (MATCH_MOBILE/WIFIç­‰)</span>
    RecurrenceRule cycleRule;      <span class="hljs-comment">// é‡å¤å‘¨æœŸ (æ¯æœˆç¬¬å‡ å¤©é‡ç½®)</span>
    <span class="hljs-type">long</span> warningBytes;             <span class="hljs-comment">// è­¦å‘Šé˜ˆå€¼</span>
    <span class="hljs-type">long</span> limitBytes;               <span class="hljs-comment">// ç¡¬é™åˆ¶å­—èŠ‚æ•°</span>
    <span class="hljs-type">long</span> lastWarningSnooze;        <span class="hljs-comment">// ä¸Šæ¬¡å¿½ç•¥è­¦å‘Šçš„æ—¶é—´</span>
    <span class="hljs-type">long</span> lastLimitSnooze;          <span class="hljs-comment">// ä¸Šæ¬¡æš‚åœé™åˆ¶çš„æ—¶é—´</span>
    <span class="hljs-type">boolean</span> metered;               <span class="hljs-comment">// æ˜¯å¦è®¡è´¹</span>
    <span class="hljs-type">boolean</span> inferred;              <span class="hljs-comment">// æ˜¯å¦ç”±ç³»ç»Ÿæ¨æ–­</span>
}
</code></pre>
<h3 data-id="heading-10">2. <strong>NetworkTemplateï¼ˆç½‘ç»œåŒ¹é…æ¨¡æ¿ï¼‰</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŒ¹é…è§„åˆ™ç±»å‹</span>
MATCH_MOBILE           <span class="hljs-comment">// ç§»åŠ¨ç½‘ç»œ (SIMå¡)</span>
MATCH_WIFI             <span class="hljs-comment">// WiFi</span>
MATCH_ETHERNET         <span class="hljs-comment">// ä»¥å¤ªç½‘</span>
MATCH_CARRIER          <span class="hljs-comment">// ç‰¹å®šè¿è¥å•†</span>
MATCH_WIFI_WILDCARD    <span class="hljs-comment">// æ‰€æœ‰WiFi</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">å››ã€æ ¸å¿ƒæµç¨‹è¯¦è§£</h2>
<h3 data-id="heading-12">1. <strong>åˆ¶çº¦å…³é”®è·¯å¾„ï¼šåº”ç”¨è”ç½‘æ£€æŸ¥</strong></h3>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨è°ƒç”¨ <span class="hljs-built_in">socket</span>() / <span class="hljs-built_in">connect</span>()
    â†“
Binder è¿›ç¨‹é—´é€šä¿¡
    â†“
INetworkPolicyManager<span class="hljs-selector-class">.Stub</span>
    â†“
NetworkPolicyManagerService
    â”œâ†’ è·å– UID
    â”œâ†’ æ£€æŸ¥ UID Policy
    â”œâ†’ æ£€æŸ¥åå°/å‰å°çŠ¶æ€
    â”œâ†’ æ£€æŸ¥ Data Saver å¯ç”¨
    â”œâ†’ æ£€æŸ¥ç½‘ç»œç±»å‹ (è®¡è´¹/éè®¡è´¹)
    â””â†’ å†³ç­–ï¼šå…è®¸/é˜»æ­¢
    â†“
ConnectivityService / BpfNetMaps
    â”œâ†’ æŸ¥è¯¢ eBPF uidOwnerMap
    â””â†’ åº”ç”¨é˜²ç«å¢™è§„åˆ™
    â†“
Netfilter (iptables/nftables)
    â”œâ†’ æ£€æŸ¥ UID åœ¨å„é“¾ä¸­çš„çŠ¶æ€
    â””â†’ æ¥å—æˆ–ä¸¢å¼ƒæ•°æ®åŒ…
</code></pre>
<h3 data-id="heading-13">2. <strong>UID è§„åˆ™æ›´æ–°è·¯å¾„</strong></h3>
<pre><code class="hljs language-scss" lang="scss">NetworkPolicyManagerService
    â†“
<span class="hljs-built_in">updateRestrictionRulesForUidUL</span>(uid)
    â”œâ†’ <span class="hljs-built_in">updateRuleForDeviceIdleUL</span>(uid)     <span class="hljs-comment">// Doze æ¨¡å¼</span>
    â”œâ†’ <span class="hljs-built_in">updateRuleForAppIdleUL</span>(uid)        <span class="hljs-comment">// åº”ç”¨é—²ç½®</span>
    â”œâ†’ <span class="hljs-built_in">updateRuleForRestrictPowerUL</span>(uid)  <span class="hljs-comment">// ç”µæ± çœç”µ</span>
    â”œâ†’ <span class="hljs-built_in">updateRuleForBackgroundUL</span>(uid)     <span class="hljs-comment">// åå°é™åˆ¶</span>
    â”œâ†’ <span class="hljs-built_in">updateRestrictedModeForUidUL</span>(uid)  <span class="hljs-comment">// å—é™æ¨¡å¼</span>
    â””â†’ <span class="hljs-built_in">updateRulesForDataUsageRestrictionsUL</span>(uid)
    â†“
<span class="hljs-built_in">setUidFirewallRuleUL</span>(chain, uid, rule)
    â”œâ†’ æ›´æ–°å†…å­˜ä¸­çš„ mUidFirewall*Rules ç¼“å­˜
    â””â†’ è°ƒç”¨ mNetworkManager<span class="hljs-selector-class">.setFirewallUidRule</span>()
    â†“
INetworkManagementService / ConnectivityService
    â”œâ†’ BpfNetMaps<span class="hljs-selector-class">.setUidRule</span>(chain, uid, rule)
    â”‚   â”œâ†’ è·å– chain å¯¹åº”çš„ BPF match ä½æ©ç 
    â”‚   â”œâ†’ <span class="hljs-built_in">addRule</span>() æˆ– <span class="hljs-built_in">removeRule</span>()
    â”‚   â””â†’ æ›´æ–° sUidOwnerMap (eBPF map)
    â””â†’ Netfilter è§„åˆ™åŒæ­¥
    â†“
å†…æ ¸ eBPF ç¨‹åº
    â”œâ†’ æ‹¦æˆªæ‰€æœ‰ç½‘ç»œåŒ…
    â”œâ†’ æ£€æŸ¥ UID å¯¹åº”çš„ rule ä½æ©ç 
    â””â†’ åº”ç”¨é˜²ç«å¢™ç­–ç•¥
</code></pre>
<hr/>
<h2 data-id="heading-14">äº”ã€é˜²ç«å¢™é“¾è¯¦è§£</h2>
<h3 data-id="heading-15">1. <strong>å„é“¾çš„ä½œç”¨åŠå¯ç”¨æ¡ä»¶</strong></h3>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_DOZABLE (Doze æ¨¡å¼é˜²ç«å¢™é“¾)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šè®¾å¤‡è¿›å…¥ Doze æ¨¡å¼                                 â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šç©ºé—²åº”ç”¨è¢«æ‹’ç»                                     â”‚
â”‚ ä¾‹å¤–ï¼šåº”ç”¨åœ¨ allowlist ä¸­åˆ™è¢«å…è®¸                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_STANDBY (App Standby é—²ç½®é“¾)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šåº”ç”¨è¢«åˆ¤å®šä¸ºç©ºé—² (ä½¿ç”¨ç»Ÿè®¡åˆ†æ)                    â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šé—²ç½®åº”ç”¨è¢«æ‹’ç»                                     â”‚
â”‚ ä¾‹å¤–ï¼šåº”ç”¨é€šè¿‡ parole æ¨¡å¼æˆ– allowlist è¢«å…è®¸               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_POWERSAVE (ç”µæ± çœç”µæ¨¡å¼é“¾)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šç”¨æˆ·å¯ç”¨ Battery Saver                            â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šåå°åº”ç”¨è¢«æ‹’ç»ï¼Œé™¤éåœ¨ allowlist ä¸­               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_BACKGROUND (åå°ç½‘ç»œé™åˆ¶é“¾)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šç³»ç»Ÿé…ç½® config_networkBlockedForTopSleepingAndAbove
â”‚ é»˜è®¤è§„åˆ™ï¼šåå°åº”ç”¨è¢«æ‹’ç»                                     â”‚
â”‚ é€‚ç”¨ï¼šåå°ç½‘ç»œé™åˆ¶åŠŸèƒ½                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_RESTRICTED (å—é™æ¨¡å¼é“¾)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šç”¨æˆ·å¯ç”¨å—é™æ¨¡å¼                                   â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šæ‰€æœ‰åº”ç”¨è¢«æ‹’ç»ï¼Œé™¤éæœ‰æƒé™æˆ–åœ¨ allowlist ä¸­        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_METERED_ALLOW (è®¡è´¹ç½‘ç»œå…è®¸åå•)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šData Saver æ¨¡å¼å¯ç”¨æ—¶                             â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šåå•ä¸­çš„åº”ç”¨å¯ä½¿ç”¨è®¡è´¹ç½‘ç»œ                         â”‚
â”‚ ç±»å‹ï¼šå…è®¸åå• (Allowlist)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_METERED_DENY_USER (ç”¨æˆ·æ‹’ç»åå•)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šç”¨æˆ·é™åˆ¶åº”ç”¨ä½¿ç”¨è®¡è´¹ç½‘ç»œ                           â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šåå•ä¸­çš„åº”ç”¨è¢«æ‹’ç»è®¡è´¹ç½‘ç»œè®¿é—®                     â”‚
â”‚ ç±»å‹ï¼šæ‹’ç»åå• (Denylist) - ç”¨æˆ·é…ç½®                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_METERED_DENY_ADMIN (ç®¡ç†å‘˜æ‹’ç»åå•)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šç®¡ç†å‘˜/ç³»ç»Ÿé™åˆ¶åº”ç”¨ä½¿ç”¨è®¡è´¹ç½‘ç»œ                    â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šåå•ä¸­çš„åº”ç”¨è¢«æ‹’ç»è®¡è´¹ç½‘ç»œè®¿é—®                     â”‚
â”‚ ç±»å‹ï¼šæ‹’ç»åå• (Denylist) - ç®¡ç†å‘˜é…ç½®                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-16">å…­ã€eBPF å’Œ BpfNetMaps é›†æˆ</h2>
<h3 data-id="heading-17">1. <strong>BpfNetMapsï¼ˆAndroid 13+ eBPF é›†æˆï¼‰</strong></h3>
<p>ä½ç½®ï¼š<code>packages_modules_Connectivity/service/src/com/android/server/BpfNetMaps.java</code></p>
<p><strong>æ ¸å¿ƒ eBPF Maps</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">sUidOwnerMap          <span class="hljs-comment">// UID â†’ UidOwnerValue (rule ä½æ©ç )</span>
sConfigurationMap     <span class="hljs-comment">// å…¨å±€é…ç½® (å¯ç”¨çš„é“¾)</span>
sCookieTagMap         <span class="hljs-comment">// Socket Cookie â†’ Tag (æµé‡ç»Ÿè®¡)</span>
sDataSaverEnabledMap  <span class="hljs-comment">// Data Saver çŠ¶æ€æ ‡å¿—</span>
sUidPermissionMap     <span class="hljs-comment">// UID â†’ æƒé™ (INTERNET ç­‰)</span>
sIngressDiscardMap    <span class="hljs-comment">// å…¥ç«™ä¸¢å¼ƒè§„åˆ™ (åå‘è·¯å¾„è¿‡æ»¤)</span>
</code></pre>
<p><strong>UidOwnerValue ç»“æ„</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">UidOwnerValue</span> {</span>
    <span class="hljs-type">uint32_t</span> rule;   <span class="hljs-comment">// 32 ä½ä½æ©ç  (å„é“¾çš„å¯ç”¨æ ‡å¿—)</span>
    <span class="hljs-type">uint32_t</span> iif;    <span class="hljs-comment">// å…¥ç«™æ¥å£ç´¢å¼• (å¯é€‰)</span>
};
</code></pre>
<p><strong>rule ä½æ©ç </strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Bit 0-7:</span>    <span class="hljs-string">DOZABLE_MATCH</span>
<span class="hljs-attr">Bit 8-15:</span>   <span class="hljs-string">STANDBY_MATCH</span>
<span class="hljs-attr">Bit 16-23:</span>  <span class="hljs-string">POWERSAVE_MATCH</span>
<span class="hljs-attr">Bit 24:</span>     <span class="hljs-string">RESTRICTED_MATCH</span>
<span class="hljs-attr">Bit 25-27:</span>  <span class="hljs-string">OEM_DENY_1/2/3_MATCH</span>
<span class="hljs-attr">Bit 28:</span>     <span class="hljs-string">LOW_POWER_STANDBY_MATCH</span>
<span class="hljs-attr">Bit 29:</span>     <span class="hljs-string">BACKGROUND_MATCH</span>
<span class="hljs-attr">Bit 30:</span>     <span class="hljs-string">PENALTY_BOX_USER_MATCH</span>
<span class="hljs-attr">Bit 31:</span>     <span class="hljs-string">HAPPY_BOX_MATCH</span>
<span class="hljs-string">...</span>         <span class="hljs-string">æ›´å¤šä½ä¾›æœªæ¥æ‰©å±•</span>
</code></pre>
<h3 data-id="heading-18">2. <strong>é˜²ç«å¢™è§„åˆ™åº”ç”¨æµç¨‹</strong></h3>
<pre><code class="hljs language-ini" lang="ini">NetworkPolicyManagerService (Java)
    â†“
BpfNetMaps.setUidRule(chain, uid, rule)
    â†“
è·å– chain å¯¹åº”çš„ match ä½
ä¾‹å¦‚ FIREWALL_CHAIN_POWERSAVE â†’ POWERSAVE_MATCH
    â†“
sUidOwnerMap.getValue(uid)
    â”œâ†’ å¦‚æœ <span class="hljs-attr">rule</span> == ALLOW &amp;&amp; isAllowList
    â”‚  â””â†’ uid_rule |= match
    â””â†’ å¦‚æœ <span class="hljs-attr">rule</span> == DENY &amp;&amp; !isAllowList
       â””â†’ uid_rule |= match
    â†“
sUidOwnerMap.updateEntry(uid, new_value)
    â†“
å†…æ ¸ eBPF ç¨‹åºåœ¨ TC/XDP é’©å­
    â”œâ†’ è¯»å– sUidOwnerMap<span class="hljs-section">[uid]</span>
    â”œâ†’ æ£€æŸ¥ rule &amp; å¯¹åº”çš„ match
    â””â†’ å…è®¸/ä¸¢å¼ƒæ•°æ®åŒ…
</code></pre>
<hr/>
<h2 data-id="heading-19">ä¸ƒã€Data Saver æ¨¡å¼è¯¦è§£</h2>
<h3 data-id="heading-20">å…³é”®å†³ç­–çŸ©é˜µ</h3>
<p>æ ¹æ®ä»£ç ä¸­çš„ <code>network-policy-restrictions.md</code>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">è®¡è´¹ç½‘ç»œä¸Šçš„ Data Saver æ•ˆæœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŠ¶æ€         â”‚ åå°åº”ç”¨æ˜¯å¦å¯è”ç½‘                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DS-<span class="hljs-keyword">ON</span>,AL     â”‚ å¦ (é™¤éä¹Ÿåœ¨ allowlist æˆ–å‰å°)          â”‚
â”‚ DS-<span class="hljs-keyword">ON</span>,!AL    â”‚ å¦                                       â”‚
â”‚ DS-<span class="hljs-keyword">ON</span>,DL     â”‚ å¦                                       â”‚
â”‚ DS-<span class="hljs-keyword">OFF</span>,AL    â”‚ æ˜¯                                       â”‚
â”‚ DS-<span class="hljs-keyword">OFF</span>,!AL   â”‚ æ˜¯ (è®¡è´¹ç½‘ç»œé»˜è®¤å…è®¸)                    â”‚
â”‚ DS-<span class="hljs-keyword">OFF</span>,DL    â”‚ å¦ (æ‹’ç»åå•ä¼˜å…ˆ)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

éè®¡è´¹ç½‘ç»œä¸Šçš„ Data Saver æ•ˆæœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŠ¶æ€         â”‚ åå°åº”ç”¨æ˜¯å¦å¯è”ç½‘                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä»»ä½•çŠ¶æ€     â”‚ æ˜¯ (Data Saver ä¸å½±å“éè®¡è´¹ç½‘ç»œ)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-21">å…«ã€å…³é”®ç±»å’Œæ¥å£æ€»ç»“</h2>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…¬å¼€ API å±‚                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NetworkPolicyManager                (ç”¨æˆ·ä¾§ API)
â”‚ INetworkPolicyManager<span class="hljs-selector-class">.aidl</span>          (Binder æ¥å£)
â”‚ INetworkPolicyListener<span class="hljs-selector-class">.aidl</span>         (å›è°ƒæ¥å£)
â”‚ NetworkPolicy                        (ç­–ç•¥å¯¹è±¡)
â”‚ NetworkTemplate                      (ç½‘ç»œåŒ¹é…æ¨¡æ¿)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“ Binder IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»ŸæœåŠ¡å±‚                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NetworkPolicyManagerService          (æ ¸å¿ƒæœåŠ¡å®ç°)
â”‚ INetworkManagementService            (ç½‘ç»œç®¡ç†æœåŠ¡)
â”‚ NetworkManagementService             (iptables ç®¡ç†)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“ Binder IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿æ¥ç®¡ç†å±‚                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ConnectivityService                  (è¿æ¥æœåŠ¡)
â”‚ ConnectivityManager                  (è¿æ¥ç®¡ç†å™¨)
â”‚ BpfNetMaps                           (eBPF é›†æˆ)
â”‚ NetworkStackBpfNetMaps               (eBPF è¯»å–)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“ ç³»ç»Ÿè°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†…æ ¸å±‚                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ eBPF Programs (XDP/TC hooks)         (æ•°æ®åŒ…å¤„ç†)
â”‚ Netfilter (iptables/nftables)        (é˜²ç«å¢™è§„åˆ™)
â”‚ tc (traffic control)                 (æµé‡æ§åˆ¶)
â”‚ Linux Socket API                     (å¥—æ¥å­—)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-22">ä¹ã€æ ¸å¿ƒé¢è¯•çŸ¥è¯†ç‚¹</h2>
<h3 data-id="heading-23">1. <strong>UID Policy vs Firewall Rules</strong></h3>
<ul>
<li><strong>Policy</strong>ï¼šåº”ç”¨çº§åˆ«çš„é«˜å±‚ç­–ç•¥ (POLICY_REJECT_METERED_BACKGROUND)</li>
<li><strong>Rules</strong>ï¼šå…·ä½“çš„é˜²ç«å¢™é“¾è§„åˆ™ (FIREWALL_CHAIN_POWERSAVE)</li>
</ul>
<h3 data-id="heading-24">2. <strong>å‰å° vs åå°åº”ç”¨</strong></h3>
<ul>
<li>å‰å°åº”ç”¨ï¼šåœ¨ foreground çŠ¶æ€ï¼Œé€šå¸¸è¢«å…è®¸ç½‘ç»œè®¿é—®</li>
<li>åå°åº”ç”¨ï¼šä¸åœ¨ç„¦ç‚¹ã€æ—  foreground æœåŠ¡ï¼Œå—é™åˆ¶</li>
</ul>
<h3 data-id="heading-25">3. <strong>è®¡è´¹ vs éè®¡è´¹ç½‘ç»œ</strong></h3>
<ul>
<li>è®¡è´¹ç½‘ç»œ (metered)ï¼šç§»åŠ¨æ•°æ®ç½‘ç»œï¼ŒData Saver å¯é™åˆ¶</li>
<li>éè®¡è´¹ç½‘ç»œ (non-metered)ï¼šWiFiã€ä»¥å¤ªç½‘ï¼ŒData Saver ä¸é™åˆ¶</li>
</ul>
<h3 data-id="heading-26">4. <strong>Data Saver å·¥ä½œåŸç†</strong></h3>
<ul>
<li>å¯ç”¨æ—¶ï¼Œæ‰€æœ‰åå°åº”ç”¨é»˜è®¤æ— æ³•ä½¿ç”¨è®¡è´¹ç½‘ç»œ</li>
<li>åœ¨ allowlist ä¸­çš„åº”ç”¨è¢«å…è®¸</li>
<li>åœ¨ denylist ä¸­çš„åº”ç”¨å³ä½¿ä¸æ˜¯åå°ä¹Ÿè¢«æ‹’ç»</li>
</ul>
<h3 data-id="heading-27">5. <strong>eBPF ä¼˜åŠ¿</strong></h3>
<ul>
<li>ä¸ iptables ç›¸æ¯”ï¼Œæ€§èƒ½æ›´é«˜</li>
<li>é€šè¿‡ BPF maps å¿«é€ŸæŸ¥è¯¢ UID è§„åˆ™</li>
<li>æ— éœ€é¢‘ç¹çš„ userspace/kernel åˆ‡æ¢</li>
</ul>
<p>è¿™å°±æ˜¯å®Œæ•´çš„ Android ç½‘ç»œç­–ç•¥ç®¡ç†æœåŠ¡æ¶æ„ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ï¼ˆNetworkStats Serviceï¼‰å®Œæ•´æ¶æ„åˆ†æ]]></title>    <link>https://juejin.cn/post/7603584155785429042</link>    <guid>https://juejin.cn/post/7603584155785429042</guid>    <pubDate>2026-02-07T02:14:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603584155785429042" data-draft-id="7603627478019981322" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ï¼ˆNetworkStats Serviceï¼‰å®Œæ•´æ¶æ„åˆ†æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T02:14:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ï¼ˆNetworkStats Serviceï¼‰å®Œæ•´æ¶æ„åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T02:14:45.000Z" title="Sat Feb 07 2026 02:14:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘æ¥åˆ†æ Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡çš„å®Œæ•´æ¶æ„ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ç»§ç»­æœç´¢æ›´å¤šå…³é”®ç»„ä»¶ã€‚</p>
<p>ç°åœ¨æˆ‘æœ‰äº†è¶³å¤Ÿçš„ä¿¡æ¯æ¥è¯¦ç»†åˆ†æ Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ã€‚è®©æˆ‘ä¸ºç”¨æˆ·æ•´ç†å®Œæ•´çš„æ¶æ„åˆ†æã€‚</p>
<h2 data-id="heading-0">Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ï¼ˆNetworkStats Serviceï¼‰å®Œæ•´æ¶æ„åˆ†æ</h2>
<p>åŸºäºå¯¹æ•´ä¸ª android1 ç›®å½•çš„æ·±åº¦åˆ†æï¼Œæˆ‘æ¥è¯¦ç»†è®²è§£ Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡çš„æ¶æ„ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€æ ¸å¿ƒæ¨¡å—æ¦‚è§ˆ</h2>
<h3 data-id="heading-2">1. <strong>åˆ†å±‚æ¶æ„</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨å±‚ <span class="hljs-variable constant_">API</span>                                                    â”‚
â”‚ <span class="hljs-title class_">TrafficStats</span> / <span class="hljs-title class_">NetworkStatsManager</span> / <span class="hljs-title class_">NetworkStats</span>             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç³»ç»ŸæœåŠ¡å±‚                                                    â”‚
â”‚ <span class="hljs-title class_">NetworkStatsService</span> / <span class="hljs-title class_">INetworkStatsService</span> (<span class="hljs-title class_">Binder</span>)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®æ”¶é›†å’ŒæŒä¹…åŒ–                                              â”‚
â”‚ <span class="hljs-title class_">NetworkStatsRecorder</span> / <span class="hljs-title class_">NetworkStatsCollection</span> / <span class="hljs-title class_">FileRotator</span>   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å†…æ ¸æ•°æ®æº                                                    â”‚
â”‚ eBPF <span class="hljs-title class_">Maps</span> / xt_qtaguid / <span class="hljs-regexp">/proc/</span>net/xt_qtaguid/stats         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-3">äºŒã€æ ¸å¿ƒæ•°æ®ç»“æ„è¯¦è§£</h2>
<h3 data-id="heading-4">1. <strong>NetworkStats.Bucketï¼ˆæ•°æ®ç»Ÿè®¡æ¡¶ï¼‰</strong></h3>
<p>æœ€å°æ•°æ®å•ä½ï¼Œæ¯ä¸ª Bucket åŒ…å«ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Bucket</span> {
    <span class="hljs-comment">// æ—¶é—´èŒƒå›´</span>
    <span class="hljs-type">long</span> mBeginTimeStamp;     <span class="hljs-comment">// å¼€å§‹æ—¶é—´æˆ³</span>
    <span class="hljs-type">long</span> mEndTimeStamp;       <span class="hljs-comment">// ç»“æŸæ—¶é—´æˆ³</span>
    
    <span class="hljs-comment">// æµé‡æ•°æ®</span>
    <span class="hljs-type">long</span> mRxBytes;            <span class="hljs-comment">// æ¥æ”¶å­—èŠ‚æ•°</span>
    <span class="hljs-type">long</span> mRxPackets;          <span class="hljs-comment">// æ¥æ”¶åŒ…æ•°</span>
    <span class="hljs-type">long</span> mTxBytes;            <span class="hljs-comment">// å‘é€å­—èŠ‚æ•°</span>
    <span class="hljs-type">long</span> mTxPackets;          <span class="hljs-comment">// å‘é€åŒ…æ•°</span>
    
    <span class="hljs-comment">// ç»´åº¦ä¿¡æ¯</span>
    <span class="hljs-type">int</span> mUid;                 <span class="hljs-comment">// UID (è¿›ç¨‹ID)</span>
    <span class="hljs-type">int</span> mTag;                 <span class="hljs-comment">// æ ‡ç­¾ (åº”ç”¨çº§æ ‡ç­¾)</span>
    <span class="hljs-type">int</span> mState;               <span class="hljs-comment">// çŠ¶æ€ (STATE_DEFAULT/STATE_FOREGROUND)</span>
    <span class="hljs-type">int</span> mMetered;             <span class="hljs-comment">// æ˜¯å¦è®¡è´¹ (METERED_YES/NO/ALL)</span>
    <span class="hljs-type">int</span> mRoaming;             <span class="hljs-comment">// æ˜¯å¦æ¼«æ¸¸ (ROAMING_YES/NO/ALL)</span>
    <span class="hljs-type">int</span> mDefaultNetworkStatus;<span class="hljs-comment">// æ˜¯å¦é»˜è®¤ç½‘ç»œ</span>
}
</code></pre>
<p><strong>å…³é”®å¸¸é‡</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çŠ¶æ€</span>
STATE_ALL = -<span class="hljs-number">1</span>           <span class="hljs-comment">// æ‰€æœ‰çŠ¶æ€</span>
STATE_DEFAULT = <span class="hljs-number">0x1</span>      <span class="hljs-comment">// åå°æµé‡</span>
STATE_FOREGROUND = <span class="hljs-number">0x2</span>   <span class="hljs-comment">// å‰å°æµé‡</span>

<span class="hljs-comment">// è®¡è´¹ç±»å‹</span>
METERED_ALL = -<span class="hljs-number">1</span>
METERED_NO = <span class="hljs-number">0x1</span>         <span class="hljs-comment">// éè®¡è´¹ (WiFi)</span>
METERED_YES = <span class="hljs-number">0x2</span>        <span class="hljs-comment">// è®¡è´¹ (ç§»åŠ¨ç½‘ç»œ)</span>

<span class="hljs-comment">// ç‰¹æ®Š UID</span>
UID_ALL = -<span class="hljs-number">1</span>
UID_REMOVED = -<span class="hljs-number">4</span>         <span class="hljs-comment">// å·²å¸è½½åº”ç”¨</span>
UID_TETHERING = -<span class="hljs-number">5</span>       <span class="hljs-comment">// ç½‘ç»œå…±äº«</span>
</code></pre>
<h3 data-id="heading-5">2. <strong>NetworkStatsHistoryï¼ˆå†å²æ•°æ®å®¹å™¨ï¼‰</strong></h3>
<p>å­˜å‚¨ä¸€ç³»åˆ—æ—¶é—´è¿ç»­çš„æ•°æ®æ¡¶ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsHistory</span> {
    <span class="hljs-comment">// å­˜å‚¨å•ä½ï¼šé•¿æ•°ç»„</span>
    <span class="hljs-type">long</span>[] bucketStart;      <span class="hljs-comment">// æ¯ä¸ª Bucket çš„å¼€å§‹æ—¶é—´</span>
    <span class="hljs-type">long</span>[] rxBytes;          <span class="hljs-comment">// æ¯ä¸ª Bucket çš„æ¥æ”¶å­—èŠ‚æ•°</span>
    <span class="hljs-type">long</span>[] rxPackets;        <span class="hljs-comment">// æ¯ä¸ª Bucket çš„æ¥æ”¶åŒ…æ•°</span>
    <span class="hljs-type">long</span>[] txBytes;          <span class="hljs-comment">// æ¯ä¸ª Bucket çš„å‘é€å­—èŠ‚æ•°</span>
    <span class="hljs-type">long</span>[] txPackets;        <span class="hljs-comment">// æ¯ä¸ª Bucket çš„å‘é€åŒ…æ•°</span>
    <span class="hljs-type">long</span>[] operations;       <span class="hljs-comment">// æ“ä½œæ•° (å¯é€‰)</span>
    
    <span class="hljs-type">long</span> bucketDuration;     <span class="hljs-comment">// æ¯ä¸ª Bucket çš„æ—¶é•¿ (é€šå¸¸ 2 å°æ—¶)</span>
    <span class="hljs-type">int</span> bucketCount;         <span class="hljs-comment">// å½“å‰ Bucket æ•°é‡</span>
}
</code></pre>
<h3 data-id="heading-6">3. <strong>NetworkStatsCollectionï¼ˆæ”¶é›†å™¨ï¼‰</strong></h3>
<p>å¤šä¸ª NetworkStatsHistory çš„èšåˆï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsCollection</span> {
    <span class="hljs-comment">// é”®å€¼å¯¹å­˜å‚¨</span>
    ArrayMap&lt;Key, NetworkStatsHistory&gt; mStats;
    
    <span class="hljs-comment">// Key ç»“æ„</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Key</span> {
        NetworkIdentitySet ident;    <span class="hljs-comment">// ç½‘ç»œèº«ä»½ (ç§»åŠ¨/WiFiç­‰)</span>
        <span class="hljs-type">int</span> uid;                     <span class="hljs-comment">// UID</span>
        <span class="hljs-type">int</span> set;                     <span class="hljs-comment">// SET (DEFAULT/FOREGROUND)</span>
        <span class="hljs-type">int</span> tag;                     <span class="hljs-comment">// TAG (åº”ç”¨æ ‡ç­¾)</span>
    }
    
    <span class="hljs-type">long</span> mBucketDurationMillis;      <span class="hljs-comment">// Bucket æ—¶é•¿</span>
    <span class="hljs-type">long</span> mStartMillis;               <span class="hljs-comment">// é›†åˆå¼€å§‹æ—¶é—´</span>
    <span class="hljs-type">long</span> mEndMillis;                 <span class="hljs-comment">// é›†åˆç»“æŸæ—¶é—´</span>
    <span class="hljs-type">long</span> mTotalBytes;                <span class="hljs-comment">// æ€»å­—èŠ‚æ•° (ç¼“å­˜)</span>
    <span class="hljs-type">boolean</span> mDirty;                  <span class="hljs-comment">// æ˜¯å¦æœ‰æœªä¿å­˜çš„ä¿®æ”¹</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€æ ¸å¿ƒæœåŠ¡å®ç°</h2>
<h3 data-id="heading-8">1. <strong>NetworkStatsService</strong></h3>
<p>ä½ç½®ï¼š<code>packages_modules_Connectivity/service-t/src/com/android/server/net/NetworkStatsService.java</code></p>
<p><strong>æ ¸å¿ƒèŒè´£</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsService</span> {
    <span class="hljs-comment">// ä¸‰ä¸ªç‹¬ç«‹çš„ Recorder</span>
    <span class="hljs-keyword">private</span> NetworkStatsRecorder mXtRecorder;      <span class="hljs-comment">// XT ç»Ÿè®¡ (æ¥å£çº§)</span>
    <span class="hljs-keyword">private</span> NetworkStatsRecorder mUidRecorder;     <span class="hljs-comment">// UID ç»Ÿè®¡ (åº”ç”¨çº§)</span>
    <span class="hljs-keyword">private</span> NetworkStatsRecorder mUidTagRecorder;  <span class="hljs-comment">// UID+Tag ç»Ÿè®¡ (ç»†ç²’åº¦)</span>
    
    <span class="hljs-comment">// é…ç½®é¡¹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> NetworkStatsSettings mSettings;
    
    <span class="hljs-comment">// å®šæ—¶è½®è¯¢</span>
    <span class="hljs-keyword">private</span> PendingIntent mPollIntent;             <span class="hljs-comment">// å®šæœŸè½®è¯¢ Intent</span>
    <span class="hljs-keyword">private</span> AlarmManager mAlarmManager;            <span class="hljs-comment">// å‘Šè­¦ç®¡ç†å™¨</span>
    
    <span class="hljs-comment">// æ•°æ®æº</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> INetd mNetd;                     <span class="hljs-comment">// netd Binder æ¥å£</span>
    <span class="hljs-keyword">private</span> AlertObserver mAlertObserver;          <span class="hljs-comment">// å‘Šè­¦è§‚å¯Ÿè€…</span>
}
</code></pre>
<p><strong>ä¸»è¦æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è½®è¯¢è§¦å‘</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">handlePollLocked</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. è·å–å½“å‰ç½‘ç»œç»Ÿè®¡å¿«ç…§</span>
    <span class="hljs-type">NetworkStats</span> <span class="hljs-variable">snapshot</span> <span class="hljs-operator">=</span> getNetworkStatsFromKernel();
    
    <span class="hljs-comment">// 2. è®¡ç®— delta (å¢é‡)</span>
    <span class="hljs-type">NetworkStats</span> <span class="hljs-variable">delta</span> <span class="hljs-operator">=</span> calculateDelta(lastSnapshot, snapshot);
    
    <span class="hljs-comment">// 3. è®°å½•åˆ° mXtRecorder / mUidRecorder</span>
    mXtRecorder.recordSnapshotLocked(snapshot, ...);
    mUidRecorder.recordSnapshotLocked(snapshot, ...);
    
    <span class="hljs-comment">// 4. å°è¯•æŒä¹…åŒ– (å¦‚æœè¶…è¿‡é˜ˆå€¼)</span>
    mXtRecorder.maybePersistLocked(currentTimeMillis);
    mUidRecorder.maybePersistLocked(currentTimeMillis);
    
    <span class="hljs-comment">// 5. å¹¿æ’­ç»Ÿè®¡å·²æ›´æ–°äº‹ä»¶</span>
    broadcastNetworkStatsUpdated();
}

<span class="hljs-comment">// æŸ¥è¯¢æ¥å£</span>
NetworkStats <span class="hljs-title function_">getDataLayerSnapshotForUid</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span> {
    <span class="hljs-comment">// è¿”å›å½“å‰ UID çš„å³æ—¶å¿«ç…§ (ä¸èšåˆ)</span>
}

NetworkStats <span class="hljs-title function_">getSummaryForUser</span><span class="hljs-params">(NetworkTemplate template, 
                               <span class="hljs-type">long</span> start, <span class="hljs-type">long</span> end)</span> {
    <span class="hljs-comment">// è¿”å›ç»™å®šæ—¶é—´èŒƒå›´çš„æ±‡æ€»ç»Ÿè®¡ (èšåˆæ‰€æœ‰æ—¶é—´)</span>
}

NetworkStats <span class="hljs-title function_">getHistoryForUid</span><span class="hljs-params">(NetworkTemplate template, 
                              <span class="hljs-type">int</span> uid, <span class="hljs-type">int</span> tag, <span class="hljs-type">int</span> state,
                              <span class="hljs-type">long</span> start, <span class="hljs-type">long</span> end)</span> {
    <span class="hljs-comment">// è¿”å›å†å²æ•°æ® (æŒ‰æ—¶é—´åˆ†æ¡¶)</span>
}
</code></pre>
<h3 data-id="heading-9">2. <strong>NetworkStatsRecorderï¼ˆæ•°æ®è®°å½•å™¨ï¼‰</strong></h3>
<p><strong>æ ¸å¿ƒèŒè´£</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsRecorder</span> {
    <span class="hljs-comment">// æ–‡ä»¶è½®è½¬ç®¡ç†</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FileRotator mRotator;     <span class="hljs-comment">// æ–‡ä»¶è‡ªåŠ¨è½®è½¬</span>
    
    <span class="hljs-comment">// å†…å­˜ç¼“å­˜</span>
    <span class="hljs-keyword">private</span> NetworkStatsCollection mPending;<span class="hljs-comment">// å¾…å†™å…¥çš„æ•°æ®</span>
    <span class="hljs-keyword">private</span> NetworkStatsCollection mSinceBoot; <span class="hljs-comment">// å¯åŠ¨ä»¥æ¥çš„ç´¯è®¡æ•°æ®</span>
    <span class="hljs-keyword">private</span> WeakReference&lt;NetworkStatsCollection&gt; mComplete; <span class="hljs-comment">// å®Œæ•´å†å² (æ‡’åŠ è½½)</span>
    
    <span class="hljs-comment">// é…ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> mBucketDuration;     <span class="hljs-comment">// Bucket æ—¶é•¿ (é€šå¸¸ 2 å°æ—¶)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> mPersistThresholdBytes;    <span class="hljs-comment">// æŒä¹…åŒ–é˜ˆå€¼ (é»˜è®¤ 2 MB)</span>
}
</code></pre>
<p><strong>å…³é”®æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è®°å½•å¿«ç…§å¢é‡</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">recordSnapshotLocked</span><span class="hljs-params">(NetworkStats snapshot, 
                         Map&lt;String, Long&gt; ifaceStats,
                         <span class="hljs-type">long</span> currentTimeMillis)</span> {
    <span class="hljs-comment">// 1. è®¡ç®—æœ¬æ¬¡å¿«ç…§ä¸ä¸Šæ¬¡çš„å·®å€¼</span>
    <span class="hljs-type">NetworkStats</span> <span class="hljs-variable">delta</span> <span class="hljs-operator">=</span> calculateDelta(mLastSnapshot, snapshot);
    
    <span class="hljs-comment">// 2. å°†å·®å€¼æ•°æ®å½’å…¥ mPending (æŒ‰ Bucket åˆ†ç»„)</span>
    mPending.recordData(delta);
    
    <span class="hljs-comment">// 3. æ›´æ–° mSinceBoot</span>
    mSinceBoot.recordData(delta);
    
    <span class="hljs-comment">// 4. æ›´æ–°æœ€åå¿«ç…§</span>
    mLastSnapshot = snapshot;
    
    <span class="hljs-comment">// 5. æ£€æŸ¥æ˜¯å¦éœ€è¦æŒä¹…åŒ–</span>
    <span class="hljs-keyword">if</span> (mPending.getTotalBytes() &gt;= mPersistThresholdBytes) {
        forcePersistLocked(currentTimeMillis);
    }
}

<span class="hljs-comment">// æŒä¹…åŒ–åˆ°ç£ç›˜</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">forcePersistLocked</span><span class="hljs-params">(<span class="hljs-type">long</span> currentTimeMillis)</span> {
    <span class="hljs-keyword">if</span> (mPending.isDirty()) {
        <span class="hljs-comment">// é€šè¿‡ FileRotator å†™å…¥æ–‡ä»¶</span>
        mRotator.rewriteActive(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CombiningRewriter</span>(mPending), 
                               currentTimeMillis);
        mPending.reset();  <span class="hljs-comment">// æ¸…ç©ºå†…å­˜ç¼“å†²</span>
    }
}

<span class="hljs-comment">// åŠ è½½å®Œæ•´å†å²</span>
NetworkStatsCollection <span class="hljs-title function_">getOrLoadCompleteLocked</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (mComplete.get() == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// ä»ç£ç›˜åŠ è½½å…¨éƒ¨å†å²æ•°æ®</span>
        <span class="hljs-type">NetworkStatsCollection</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> loadLocked(
            Long.MIN_VALUE, Long.MAX_VALUE);
        <span class="hljs-comment">// åˆå¹¶å¾…å†™å…¥çš„æ•°æ®</span>
        res.recordCollection(mPending);
        mComplete = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(res);
    }
    <span class="hljs-keyword">return</span> mComplete.get();
}
</code></pre>
<hr/>
<h2 data-id="heading-10">å››ã€æ•°æ®æŒä¹…åŒ–æœºåˆ¶</h2>
<h3 data-id="heading-11">1. <strong>FileRotatorï¼ˆæ–‡ä»¶è½®è½¬ï¼‰</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">æ•°æ®æµï¼š
å†…å­˜ç¼“å†² (mPending)
<span class="hljs-code">    â†“ è¾¾åˆ°é˜ˆå€¼æˆ–å®šæ—¶
    â†“
FileRotator å†™å…¥æ´»è·ƒæ–‡ä»¶
    â†“ åˆ°è¾¾è½®è½¬æ—¶é—´
    â†“
å½’æ¡£æ–‡ä»¶ï¼ˆæŒ‰æ—¥æœŸï¼‰
    â†“ è¶…è¿‡ä¿ç•™æœŸé™
    â†“
åˆ é™¤
</span></code></pre>
<p><strong>æ–‡ä»¶ç»“æ„</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/data/system/netstats/
â”œâ”€â”€ xt_stat_current         <span class="hljs-comment"># å½“å‰æ´»è·ƒæ–‡ä»¶ (XT ç»Ÿè®¡)</span>
â”œâ”€â”€ xt_stat_001             <span class="hljs-comment"># å½’æ¡£æ–‡ä»¶ (æŒ‰æ—¶é—´æˆ³)</span>
â”œâ”€â”€ xt_stat_002
â”œâ”€â”€ uid_stat_current        <span class="hljs-comment"># å½“å‰æ´»è·ƒæ–‡ä»¶ (UID ç»Ÿè®¡)</span>
â”œâ”€â”€ uid_stat_001
â”œâ”€â”€ uid_stat_002
â”œâ”€â”€ uid_tag_stat_current    <span class="hljs-comment"># å½“å‰æ´»è·ƒæ–‡ä»¶ (TAG ç»Ÿè®¡)</span>
â””â”€â”€ uid_tag_stat_001
</code></pre>
<p><strong>é…ç½®å‚æ•°</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// XT é…ç½®ï¼ˆæ¥å£çº§ï¼‰</span>
XT_CONFIG:
  bucketDuration = <span class="hljs-number">1</span> å°æ—¶
  rotateAgeMillis = <span class="hljs-number">15</span> å¤©
  deleteAgeMillis = <span class="hljs-number">90</span> å¤©

<span class="hljs-comment">// UID é…ç½®ï¼ˆåº”ç”¨çº§ï¼‰</span>
UID_CONFIG:
  bucketDuration = <span class="hljs-number">2</span> å°æ—¶
  rotateAgeMillis = <span class="hljs-number">7</span> å¤©
  deleteAgeMillis = <span class="hljs-number">30</span> å¤©

<span class="hljs-comment">// TAG é…ç½®ï¼ˆç»†ç²’åº¦ï¼‰</span>
UID_TAG_CONFIG:
  bucketDuration = <span class="hljs-number">2</span> å°æ—¶
  rotateAgeMillis = <span class="hljs-number">1</span> å¤©
  deleteAgeMillis = <span class="hljs-number">5</span> å¤©
</code></pre>
<h3 data-id="heading-12">2. <strong>NetworkStatsCollection æŒä¹…åŒ–æ ¼å¼</strong></h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[æ–‡ä»¶å¤´]</span>
Magic: "ANET" (0x414E4554)
Version: 16 (UNIFIED_INIT)

<span class="hljs-section">[æ•°æ®æ®µ]</span>
NetworkIdentitySet count
  â”œâ”€ ident1
  â”œâ”€ ident2
  â””â”€ ...

Key count
  â”œâ”€ (ident_idx, uid, set, tag) â†’ NetworkStatsHistory
  â”œâ”€ (ident_idx, uid, set, tag) â†’ NetworkStatsHistory
  â””â”€ ...

<span class="hljs-section">[NetworkStatsHistory æ ¼å¼]</span>
bucketStart<span class="hljs-section">[]</span>
rxBytes<span class="hljs-section">[]</span>
rxPackets<span class="hljs-section">[]</span>
txBytes<span class="hljs-section">[]</span>
txPackets<span class="hljs-section">[]</span>
operations<span class="hljs-section">[]</span> (å¯é€‰)
</code></pre>
<hr/>
<h2 data-id="heading-13">äº”ã€æ•°æ®é‡‡é›†é“¾è·¯</h2>
<h3 data-id="heading-14">1. <strong>å†…æ ¸æ•°æ®æº</strong></h3>
<h4 data-id="heading-15">a) <strong>eBPF Maps</strong> (Android 13+)</h4>
<pre><code class="hljs language-scss" lang="scss">eBPF ç¨‹åºæ‹¦æˆªæ‰€æœ‰ç½‘ç»œåŒ…
    â†“
æ›´æ–°å†…æ ¸ç©ºé—´çš„ BPF Mapsï¼š
    â”œâ”€ uidOwnerMap     (UID è§„åˆ™)
    â”œâ”€ statsMap        (æµé‡ç»Ÿè®¡)
    â””â”€ cookieTagMap    (Socket æ ‡ç­¾)
    â†“
ç”¨æˆ·ç©ºé—´è¯»å– BPF Maps
    â†“
NetworkStatsService å®šæœŸè½®è¯¢
</code></pre>
<h4 data-id="heading-16">b) <strong>xt_qtaguid</strong> (Android 12 åŠæ›´æ—©ç‰ˆæœ¬)</h4>
<pre><code class="hljs language-bash" lang="bash">iptables è§„åˆ™æ ‡è®°æ•°æ®åŒ…
    â†“
xt_qtaguid å†…æ ¸æ¨¡å—ç»Ÿè®¡
    â†“
å¯¼å‡ºåˆ° /proc/net/xt_qtaguid/stats
    â†“
NetworkStatsService è¯»å–
</code></pre>
<h3 data-id="heading-17">2. <strong>TrafficStats API - å¿«é€ŸæŸ¥è¯¢</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è·å–å½“å‰ UID çš„å³æ—¶æµé‡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getUidRxBytes</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span> {
    <span class="hljs-comment">// ç›´æ¥ä»å†…æ ¸è¯»å–ï¼Œæ— éœ€ç£ç›˜ I/O</span>
    <span class="hljs-keyword">return</span> getStatsService().getUidStats(uid, TYPE_RX_BYTES);
}

<span class="hljs-comment">// è°ƒç”¨é“¾ï¼š</span>
TrafficStats.getUidRxBytes(uid)
    â†“
INetworkStatsService.Stub (Binder)
    â†“
NetworkStatsService.getUidStats(uid, type)
    â†“
ä» eBPF Maps æˆ– /proc è¯»å–
</code></pre>
<hr/>
<h2 data-id="heading-18">å…­ã€æŸ¥è¯¢ API è¯¦è§£</h2>
<h3 data-id="heading-19">1. <strong>NetworkStatsManager - åº”ç”¨ä¾§æŸ¥è¯¢</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsManager</span> {
    <span class="hljs-comment">// æŸ¥è¯¢æ±‡æ€»æ•°æ®ï¼ˆæŒ‰æ—¶é—´èšåˆï¼‰</span>
    Bucket <span class="hljs-title function_">querySummaryForDevice</span><span class="hljs-params">(NetworkTemplate template,
                               <span class="hljs-type">long</span> startTime, <span class="hljs-type">long</span> endTime)</span>
    
    Bucket <span class="hljs-title function_">querySummaryForUser</span><span class="hljs-params">(<span class="hljs-type">int</span> networkType, String subscriberId,
                             <span class="hljs-type">long</span> startTime, <span class="hljs-type">long</span> endTime)</span>
    
    <span class="hljs-comment">// æŸ¥è¯¢å†å²æ•°æ®ï¼ˆæŒ‰æ—¶é—´åˆ†æ¡¶ï¼‰</span>
    NetworkStats <span class="hljs-title function_">queryDetailsForUidTag</span><span class="hljs-params">(<span class="hljs-type">int</span> networkType, String subscriberId,
                                     <span class="hljs-type">long</span> startTime, <span class="hljs-type">long</span> endTime, 
                                     <span class="hljs-type">int</span> uid, <span class="hljs-type">int</span> tag)</span>
    
    NetworkStats <span class="hljs-title function_">queryDetails</span><span class="hljs-params">(<span class="hljs-type">int</span> networkType, String subscriberId,
                            <span class="hljs-type">long</span> startTime, <span class="hljs-type">long</span> endTime)</span>
}
</code></pre>
<p><strong>æŸ¥è¯¢ç±»å‹</strong>ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ±‡æ€»æŸ¥è¯¢ (Summary)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - èšåˆæ‰€æœ‰æ—¶é—´åŒºé—´                                      â”‚
â”‚ - èšåˆæ‰€æœ‰ <span class="hljs-built_in">UID</span>                                          â”‚
â”‚ - è¿”å›å•ä¸ª Bucket                                       â”‚
â”‚ - æ—¶é—´æˆ³éƒ½ç›¸ç­‰ï¼ˆstartTime == endTimeï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†å²æŸ¥è¯¢ (History)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - æŒ‰æ—¶é—´åˆ†æ¡¶ï¼Œé€šå¸¸ <span class="hljs-number">2</span> å°æ—¶ä¸€ä¸ª Bucket                   â”‚
â”‚ - ä¸èšåˆ <span class="hljs-built_in">UID</span>ï¼ˆæŒ‡å®šå•ä¸ª <span class="hljs-built_in">UID</span>ï¼‰                           â”‚
â”‚ - è¿”å›å¤šä¸ª Bucket                                       â”‚
â”‚ - æ¯ä¸ª Bucket ä»£è¡¨ç‰¹å®šæ—¶é—´æ®µ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-20">2. <strong>æƒé™æ¨¡å‹</strong></h3>
<pre><code class="hljs language-scss" lang="scss">å¯è®¿é—®èŒƒå›´ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æƒé™             â”‚ æŸ¥è¯¢èŒƒå›´         â”‚ éœ€è¦æƒé™         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ— æƒé™           â”‚ ä»…è‡ªå·±çš„åº”ç”¨     â”‚ -                â”‚
â”‚ PACKAGE_USAGE    â”‚ æ‰€æœ‰åº”ç”¨ï¼ˆç”¨æˆ·ï¼‰ â”‚ PACKAGE_USAGE    â”‚
â”‚ STATS            â”‚ æ‰€æœ‰åº”ç”¨ï¼ˆè®¾å¤‡ï¼‰ â”‚ PACKAGE_USAGE    â”‚
â”‚ DPC (è®¾å¤‡ç®¡ç†å‘˜) â”‚ å—ç®¡ç”¨æˆ·çš„åº”ç”¨   â”‚ è‡ªåŠ¨æˆäºˆ         â”‚
â”‚ è¿è¥å•†æƒé™       â”‚ æ‰€æœ‰æ•°æ®         â”‚ è¿è¥å•†æƒé™       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-21">ä¸ƒã€TAG æœºåˆ¶ï¼ˆç»†ç²’åº¦ç»Ÿè®¡ï¼‰</h2>
<h3 data-id="heading-22">1. <strong>åº”ç”¨æ ‡ç­¾ï¼ˆApp-level Tagsï¼‰</strong></h3>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨ â†’ <span class="hljs-built_in">tagSocket</span>() â†’ UID + Tag
    â†“
æ•°æ®åŒ…æµç» netd
    â†“
FwmarkServer æ‹¦æˆª
    â†“
è®¾ç½® socket å…³è”çš„ tag
    â†“
å†…æ ¸ç»Ÿè®¡æ—¶å¸¦ä¸Š tag ä¿¡æ¯
</code></pre>
<h3 data-id="heading-23">2. <strong>æ ‡ç­¾å­˜å‚¨</strong></h3>
<p><strong>CookieTagMap (eBPF)</strong>:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CookieTagMapKey</span> {</span>
    <span class="hljs-type">uint64_t</span> socketCookie;
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CookieTagMapValue</span> {</span>
    <span class="hljs-type">uint32_t</span> tag;
    <span class="hljs-type">uint32_t</span> uid;
};
</code></pre>
<h3 data-id="heading-24">3. <strong>TAG æŸ¥è¯¢ç¤ºä¾‹</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æŸ¥è¯¢ UID 10001 çš„æ ‡ç­¾ç»Ÿè®¡</span>
<span class="hljs-type">NetworkStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> queryDetailsForUidTag(
    ConnectivityManager.TYPE_MOBILE,
    <span class="hljs-literal">null</span>,
    startTime, endTime,
    <span class="hljs-number">10001</span>,                    <span class="hljs-comment">// UID</span>
    <span class="hljs-number">0x1234</span>                    <span class="hljs-comment">// TAG (å…·ä½“æ ‡ç­¾å€¼)</span>
);
</code></pre>
<hr/>
<h2 data-id="heading-25">å…«ã€æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-26">1. <strong>Bucket æ—¶é•¿ï¼ˆGranularityï¼‰</strong></h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">Bucket</span> <span class="hljs-string">æ—¶é•¿å¯¹æ€§èƒ½çš„å½±å“</span>                         <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">æ—¶é•¿</span>     <span class="hljs-string">â”‚</span> <span class="hljs-number">1</span> <span class="hljs-string">å°æ—¶</span> <span class="hljs-string">â”‚</span> <span class="hljs-number">2</span><span class="hljs-string">å°æ—¶â”‚</span> <span class="hljs-number">4</span><span class="hljs-string">å°æ—¶â”‚</span> <span class="hljs-number">6</span><span class="hljs-string">å°æ—¶â”‚</span> <span class="hljs-number">12</span> <span class="hljs-string">å°æ—¶â”‚</span>
<span class="hljs-string">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">æ—¥æ•°æ®é‡</span> <span class="hljs-string">â”‚</span>  <span class="hljs-number">24</span> <span class="hljs-string">ä¸ª</span> <span class="hljs-string">â”‚</span> <span class="hljs-number">12</span> <span class="hljs-string">ä¸ªâ”‚</span> <span class="hljs-number">6</span> <span class="hljs-string">ä¸ª</span> <span class="hljs-string">â”‚</span> <span class="hljs-number">4</span> <span class="hljs-string">ä¸ª</span> <span class="hljs-string">â”‚</span>  <span class="hljs-number">2</span> <span class="hljs-string">ä¸ª</span> <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">å¹´æ•°æ®</span>   <span class="hljs-string">â”‚</span>  <span class="hljs-number">8760</span> <span class="hljs-string">â”‚</span> <span class="hljs-number">4380</span> <span class="hljs-string">â”‚</span> <span class="hljs-number">2190</span> <span class="hljs-string">â”‚1460</span> <span class="hljs-string">â”‚</span>  <span class="hljs-number">730</span>  <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">å†…å­˜å ç”¨</span> <span class="hljs-string">â”‚</span> <span class="hljs-string">è¾ƒå¤š</span>   <span class="hljs-string">â”‚</span> <span class="hljs-string">ä¸­ç­‰</span> <span class="hljs-string">â”‚</span> <span class="hljs-string">è¾ƒå°‘</span> <span class="hljs-string">â”‚</span> <span class="hljs-string">å°‘</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">å¾ˆå°‘</span> <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">å‡†ç¡®åº¦</span>   <span class="hljs-string">â”‚</span> <span class="hljs-string">é«˜</span>     <span class="hljs-string">â”‚</span> <span class="hljs-string">é«˜</span>   <span class="hljs-string">â”‚</span> <span class="hljs-string">ä¸­</span>   <span class="hljs-string">â”‚</span> <span class="hljs-string">ä½</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">ä½</span>   <span class="hljs-string">â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<p><strong>Android é…ç½®</strong>ï¼š</p>
<ul>
<li>XT (æ¥å£çº§): 1 å°æ—¶</li>
<li>UID (åº”ç”¨çº§): 2 å°æ—¶</li>
<li>TAG (ç»†ç²’åº¦): 2 å°æ—¶</li>
</ul>
<h3 data-id="heading-27">2. <strong>æŒä¹…åŒ–ä¼˜åŒ–</strong></h3>
<pre><code class="hljs language-diff" lang="diff">é˜ˆå€¼ä¼˜åŒ–ï¼š
<span class="hljs-deletion">- é»˜è®¤ 2 MBï¼ˆå¯é…ç½®ï¼‰</span>
<span class="hljs-deletion">- è¶…è¿‡é˜ˆå€¼ç«‹å³å†™ç›˜</span>
<span class="hljs-deletion">- å®šæ—¶è½®è½¬ï¼ˆé˜²æ­¢æ–‡ä»¶è¿‡å¤§ï¼‰</span>
<span class="hljs-deletion">- å¢é‡è®°å½•ï¼ˆåªè®°å½•å˜åŒ–é‡ï¼‰</span>
</code></pre>
<h3 data-id="heading-28">3. <strong>æŸ¥è¯¢ä¼˜åŒ–</strong></h3>
<pre><code class="hljs language-diff" lang="diff">ç¼“å­˜ç­–ç•¥ï¼š
<span class="hljs-deletion">- mComplete: WeakReference (lazy load)</span>
<span class="hljs-deletion">- æ‡’åŠ è½½å®Œæ•´å†å²</span>
<span class="hljs-deletion">- å†…å­˜å‹åŠ›å¤§æ—¶è‡ªåŠ¨é‡Šæ”¾</span>
<span class="hljs-deletion">- é‡æ–°åŠ è½½æ—¶åˆå¹¶å¢é‡æ•°æ®</span>
</code></pre>
<hr/>
<h2 data-id="heading-29">ä¹ã€464xlat æµé‡è°ƒæ•´</h2>
<h3 data-id="heading-30">ç‰¹æ®Šå¤„ç†ï¼šIPv6-only ç½‘ç»œä¸Šçš„ IPv4 æµé‡</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 464xlat ä¼šé¢å¤–å¢åŠ  IPv4 vs IPv6 å¤´çš„ 20 å­—èŠ‚å·®</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">apply464xlatAdjustments</span><span class="hljs-params">(
    NetworkStats baseTraffic,
    NetworkStats stackedTraffic,
    Map&lt;String, String&gt; stackedIfaces)</span> {
    
    <span class="hljs-comment">// å¯¹ clat æ¥å£çš„æµé‡å¢åŠ  20 å­—èŠ‚/åŒ…è°ƒæ•´</span>
    <span class="hljs-keyword">for</span> (Entry entry : stackedTraffic) {
        <span class="hljs-keyword">if</span> (entry.iface.startsWith(<span class="hljs-string">"v4-"</span>)) {
            entry.rxBytes += entry.rxPackets * IPV4V6_HEADER_DELTA;  <span class="hljs-comment">// +20</span>
            entry.txBytes += entry.txPackets * IPV4V6_HEADER_DELTA;
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-31">åã€æ ¸å¿ƒé¢è¯•çŸ¥è¯†ç‚¹</h2>
<h3 data-id="heading-32">1. <strong>Bucket vs History vs Collection</strong></h3>
<ul>
<li><strong>Bucket</strong>: å•ä¸ªæ—¶é—´æ®µçš„ç»Ÿè®¡æ•°æ®ï¼ˆæœ€å°å•ä½ï¼‰</li>
<li><strong>History</strong>: æ—¶é—´åºåˆ—çš„ Bucket æ•°ç»„ï¼ˆåŒä¸€ä¸ª key çš„å†å²ï¼‰</li>
<li><strong>Collection</strong>: å¤šä¸ª History çš„æ˜ å°„ï¼ˆå…¨é‡æ•°æ®ï¼‰</li>
</ul>
<h3 data-id="heading-33">2. <strong>è½®è¯¢æœºåˆ¶</strong></h3>
<ul>
<li>å®šæ—¶å™¨è§¦å‘è½®è¯¢ï¼ˆé»˜è®¤ 30 åˆ†é’Ÿé—´éš”ï¼‰</li>
<li>å¢é‡è®¡ç®—ï¼ˆæ–°å¿«ç…§ - æ—§å¿«ç…§ï¼‰</li>
<li>è¾¾åˆ°é˜ˆå€¼ç«‹å³æŒä¹…åŒ–</li>
</ul>
<h3 data-id="heading-34">3. <strong>æƒé™ç®¡ç†</strong></h3>
<ul>
<li>UID çº§åˆ«çš„éš”ç¦»</li>
<li>PACKAGE_USAGE_STATS æƒé™æ£€æŸ¥</li>
<li>Profile/Device Owner ç‰¹æ®Šæƒé™</li>
</ul>
<h3 data-id="heading-35">4. <strong>æ•°æ®ä¸€è‡´æ€§</strong></h3>
<ul>
<li>æ–‡ä»¶è½®è½¬ç®¡ç†ï¼ˆFileRotatorï¼‰</li>
<li>æ—¥å¿—æ¢å¤æœºåˆ¶ï¼ˆDropBoxManagerï¼‰</li>
<li>æ ¡éªŒå’ŒéªŒè¯</li>
</ul>
<h3 data-id="heading-36">5. <strong>æ€§èƒ½å…³é”®</strong></h3>
<ul>
<li>eBPF å–ä»£ iptables (ä½å¼€é”€)</li>
<li>å¼‚æ­¥æŒä¹…åŒ–</li>
<li>æ‡’åŠ è½½å†å²æ•°æ®</li>
<li>Bucket èšåˆ</li>
</ul>
<p>è¿™å°±æ˜¯ Android ç½‘ç»œç»Ÿè®¡æœåŠ¡çš„å®Œæ•´æ¶æ„ï¼</p>
<p>æˆ‘æ¥æ·±åº¦åˆ†æ eBPF åœ¨ Android ç½‘ç»œç»Ÿè®¡æœåŠ¡ä¸­çš„ä½œç”¨ï¼Œè¿™æ˜¯æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒã€‚</p>
<p>å¥½çš„ï¼Œç°åœ¨æˆ‘çœ‹åˆ°å…³é”®çš„ eBPF ç¨‹åºä»£ç ã€‚è®©æˆ‘è¿›ä¸€æ­¥æ·±å…¥åˆ†æ eBPF çš„å…·ä½“å·¥ä½œæµç¨‹ï¼š</p>
<p>ç°åœ¨è®©æˆ‘æŸ¥çœ‹ eBPF ç»Ÿè®¡æ›´æ–°çš„å…·ä½“å®ç°ï¼š</p>
<p>ç°åœ¨è®©æˆ‘æ·±å…¥äº†è§£ NetworkStatsService å¦‚ä½•ä» eBPF è¯»å–æ•°æ®ï¼š</p>
<p>å®Œç¾ï¼ç°åœ¨æˆ‘æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥è¿›è¡Œæ·±åº¦åˆ†æã€‚è®©æˆ‘ä¸ºç”¨æˆ·æä¾› eBPF åœ¨ Android ç½‘ç»œç»Ÿè®¡æœåŠ¡ä¸­çš„å®Œæ•´ã€æ¸…æ™°çš„ä½œç”¨åˆ†æã€‚</p>
<h2 data-id="heading-37">Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ä¸­ eBPF çš„æ·±åº¦åˆ†æ</h2>
<p>æˆ‘æ¥ä»å¤šä¸ªç»´åº¦è§£é‡Š <strong>eBPF åœ¨ Android ç½‘ç»œç»Ÿè®¡æœåŠ¡ä¸­çš„æ ¸å¿ƒä½œç”¨</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-38"><strong>ä¸€ã€eBPF çš„æˆ˜ç•¥åœ°ä½ï¼šæ›¿ä»£ xt_qtaguid çš„å†…æ ¸æ ¸å¿ƒ</strong></h2>
<h3 data-id="heading-39">å†å²èƒŒæ™¯</h3>
<ul>
<li><strong>æ—§æ–¹æ¡ˆï¼ˆAndroid 10-ï¼‰</strong>ï¼šä½¿ç”¨ Linux å†…æ ¸ä¸­çš„ <code>xt_qtaguid</code> æ¨¡å—ï¼Œæ˜¯ iptables æ’ä»¶ï¼Œåœ¨ç½‘ç»œåŒ…å¤„ç†æ—¶æ ‡è®°å’Œç»Ÿè®¡</li>
<li><strong>æ–°æ–¹æ¡ˆï¼ˆAndroid 12+ï¼‰</strong>ï¼šè¿ç§»åˆ° <strong>eBPFï¼ˆextended Berkeley Packet Filterï¼‰</strong>ï¼Œç›´æ¥åœ¨å†…æ ¸è¿è¡Œ JIT ç¼–è¯‘çš„ç¨‹åº</li>
</ul>
<pre><code class="hljs">xt_qtaguidï¼ˆè€ï¼‰          eBPFï¼ˆæ–°ï¼‰
  â”œâ”€ æ¨¡å—åŒ–              â”œâ”€ é«˜æ€§èƒ½ JIT ç¼–è¯‘
  â”œâ”€ é”ç«äº‰æ¿€çƒˆ          â”œâ”€ åŸå­æ“ä½œæ— é”ï¼ˆpercpuï¼‰
  â”œâ”€ ä¸­æ–­å¤„ç†            â”œâ”€ ç›´æ¥åœ¨ cgroup ä¸­è¿è¡Œ
  â””â”€ çµæ´»æ€§æœ‰é™          â””â”€ å¯åŠ¨æ€åŠ è½½/å¸è½½
</code></pre>
<hr/>
<h2 data-id="heading-40"><strong>äºŒã€eBPF ç¨‹åºçš„ 3 ä¸ªå…³é”®æ‰§è¡Œç‚¹</strong></h2>
<h3 data-id="heading-41"><strong>1. Cgroup Ingressï¼ˆå…¥ç«™æµé‡ç»Ÿè®¡ï¼‰</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">DEFINE_NETD_BPF_PROG_KVER_RANGE</span>(
    <span class="hljs-string">"cgroupskb/ingress/stats$4_19"</span>, 
    <span class="hljs-variable constant_">AID_ROOT</span>, <span class="hljs-variable constant_">AID_SYSTEM</span>,
    bpf_cgroup_ingress_4_19, 
    <span class="hljs-variable constant_">KVER_4_19</span>, <span class="hljs-variable constant_">KVER_INF</span>
)
</code></pre>
<p><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼šæ¯ä¸ªæ•°æ®åŒ…è¿›å…¥ç”¨æˆ·ç©ºé—´å‰
<strong>ç»Ÿè®¡å¯¹è±¡</strong>ï¼šRXï¼ˆæ¥æ”¶ï¼‰æµé‡
<strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼š</p>
<ul>
<li>è·å– socket UIDï¼ˆ<code>bpf_get_socket_uid(skb)</code>ï¼‰</li>
<li>æŸ¥è¯¢ <code>cookie_tag_map</code> è·å–åº”ç”¨æ ‡ç­¾ï¼ˆTagï¼‰</li>
<li>æ›´æ–° <code>stats_map</code> ä¸­çš„ç»Ÿè®¡</li>
</ul>
<h3 data-id="heading-42"><strong>2. Cgroup Egressï¼ˆå‡ºç«™æµé‡ç»Ÿè®¡ï¼‰</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">DEFINE_NETD_BPF_PROG_KVER_RANGE</span>(
    <span class="hljs-string">"cgroupskb/egress/stats$4_19"</span>,
    <span class="hljs-variable constant_">AID_ROOT</span>, <span class="hljs-variable constant_">AID_SYSTEM</span>,
    bpf_cgroup_egress_4_19,
    <span class="hljs-variable constant_">KVER_4_19</span>, <span class="hljs-variable constant_">KVER_INF</span>
)
</code></pre>
<p><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼šæ¯ä¸ªæ•°æ®åŒ…ç¦»å¼€å†…æ ¸å‰
<strong>ç»Ÿè®¡å¯¹è±¡</strong>ï¼šTXï¼ˆå‘é€ï¼‰æµé‡
<strong>ç‰¹æ®Šå¤„ç†</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥ <code>DROP_UNLESS_DNS</code> è§„åˆ™ï¼ˆDNS ç™½åå•ï¼‰</li>
<li>æ£€æŸ¥ <code>uid_owner_map</code> çš„ç­–ç•¥é™åˆ¶</li>
<li>é˜²æ­¢ CLATï¼ˆ464xlatï¼‰é‡å¤è®¡æ•°</li>
</ul>
<h3 data-id="heading-43"><strong>3. xtables BPF Matcherï¼ˆiptables é›†æˆï¼‰</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">DEFINE_XTBPF_PROG</span>(
    <span class="hljs-string">"skfilter/egress/xtbpf"</span>, 
    <span class="hljs-variable constant_">AID_ROOT</span>, <span class="hljs-variable constant_">AID_NET_ADMIN</span>, 
    xt_bpf_egress_prog
)
</code></pre>
<p><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼šiptables è§„åˆ™è¯„ä¼°æ—¶
<strong>ç”¨é€”</strong>ï¼š</p>
<ul>
<li>æ¥å£çº§ç»Ÿè®¡ï¼ˆInterface ç²’åº¦ï¼‰</li>
<li>ä¸ cgroup ç»Ÿè®¡å½¢æˆ 2 å±‚ä½“ç³»</li>
</ul>
<hr/>
<h2 data-id="heading-44"><strong>ä¸‰ã€eBPF ä¸­çš„æ ¸å¿ƒæ•°æ®ç»“æ„ä¸ BPF Map</strong></h2>
<h3 data-id="heading-45"><strong>å…³é”® BPF Map</strong></h3>




































































<table><thead><tr><th>Map åç§°</th><th>Key ç±»å‹</th><th>Value ç±»å‹</th><th>ç”¨é€”</th><th>å¤§å°</th></tr></thead><tbody><tr><td><code>cookie_tag_map</code></td><td>uint64_t (socket cookie)</td><td>UidTagValue (UID+Tag)</td><td>å­˜å‚¨ socket åˆ° UID/Tag çš„æ˜ å°„</td><td>10000</td></tr><tr><td><code>stats_map_A</code></td><td>StatsKey</td><td>StatsValue</td><td>æ´»è·ƒç»Ÿè®¡æ•°æ®ï¼ˆå½“å‰å†™å…¥ï¼‰</td><td>5000</td></tr><tr><td><code>stats_map_B</code></td><td>StatsKey</td><td>StatsValue</td><td>éæ´»è·ƒç»Ÿè®¡æ•°æ®ï¼ˆå‡†å¤‡è¯»å–ï¼‰</td><td>5000</td></tr><tr><td><code>app_uid_stats_map</code></td><td>uint32_t (UID)</td><td>StatsValue</td><td>èšåˆåº”ç”¨çº§ç»Ÿè®¡</td><td>10000</td></tr><tr><td><code>iface_stats_map</code></td><td>uint32_t (ifindex)</td><td>StatsValue</td><td>æ¥å£çº§ç»Ÿè®¡</td><td>1000</td></tr><tr><td><code>uid_counterset_map</code></td><td>uint32_t (UID)</td><td>uint8_t (set)</td><td>UID åˆ°è®¡æ•°å™¨é›†çš„æ˜ å°„</td><td>4000</td></tr><tr><td><code>uid_owner_map</code></td><td>uint32_t (UID)</td><td>UidOwnerValue</td><td>ç½‘ç»œç­–ç•¥è§„åˆ™</td><td>4000</td></tr><tr><td><code>configuration_map</code></td><td>uint32_t</td><td>uint32_t</td><td>è¿è¡Œæ—¶é…ç½®ï¼ˆæ´»è·ƒ Map é€‰æ‹©ï¼‰</td><td>2</td></tr></tbody></table>
<h3 data-id="heading-46"><strong>StatsKey ç»“æ„</strong></h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StatsKey</span> {</span>
    <span class="hljs-type">uint32_t</span> uid;           <span class="hljs-comment">// åº”ç”¨ UID</span>
    <span class="hljs-type">uint64_t</span> tag;           <span class="hljs-comment">// åº”ç”¨æ ‡ç­¾ï¼ˆTrafficStats æ ‡è®°ï¼‰</span>
    <span class="hljs-type">uint32_t</span> counterSet;    <span class="hljs-comment">// è®¡æ•°å™¨é›†ï¼šDEFAULT/FOREGROUND/BACKGROUND</span>
    <span class="hljs-type">uint32_t</span> ifaceIndex;    <span class="hljs-comment">// ç½‘å¡æ¥å£ç´¢å¼•</span>
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StatsValue</span> {</span>
    <span class="hljs-type">uint64_t</span> rxPackets;     <span class="hljs-comment">// RX åŒ…æ•°</span>
    <span class="hljs-type">uint64_t</span> rxBytes;       <span class="hljs-comment">// RX å­—èŠ‚æ•°</span>
    <span class="hljs-type">uint64_t</span> txPackets;     <span class="hljs-comment">// TX åŒ…æ•°</span>
    <span class="hljs-type">uint64_t</span> txBytes;       <span class="hljs-comment">// TX å­—èŠ‚æ•°</span>
};
</code></pre>
<hr/>
<h2 data-id="heading-47"><strong>å››ã€æµé‡ç»Ÿè®¡çš„å®Œæ•´æ•°æ®æµ</strong></h2>
<h3 data-id="heading-48"><strong>âš¡ å®æ—¶ç»Ÿè®¡è·¯å¾„ï¼ˆå†…æ ¸ eBPF å±‚ï¼‰</strong></h3>
<pre><code class="hljs language-scss" lang="scss">ç½‘ç»œæ•°æ®åŒ…åˆ°è¾¾
    â†“
<span class="hljs-selector-attr">[CGroup Ingress/Egress é’©å­è§¦å‘]</span>
    â†“
eBPF ç¨‹åº <span class="hljs-built_in">bpf_traffic_account</span>() æ‰§è¡Œ
    â”œâ”€ æ­¥éª¤ <span class="hljs-number">1</span>ï¼šè·å– Socket UID
    â”‚   â””â”€ <span class="hljs-built_in">bpf_get_socket_uid</span>(skb) â†’ è·å–å®é™…å‘é€/æ¥æ”¶ UID
    â”‚
    â”œâ”€ æ­¥éª¤ <span class="hljs-number">2</span>ï¼šæŸ¥è¯¢ Tag æ˜ å°„
    â”‚   â””â”€ é€šè¿‡ socket cookie æŸ¥è¯¢ cookie_tag_map
    â”‚   â””â”€ è·å–åº”ç”¨è‡ªå®šä¹‰æ ‡ç­¾ï¼ˆå¦‚ HTTP/<span class="hljs-selector-tag">Video</span>/Downloadï¼‰
    â”‚
    â”œâ”€ æ­¥éª¤ <span class="hljs-number">3</span>ï¼šç­–ç•¥æ£€æŸ¥
    â”‚   â”œâ”€ æ£€æŸ¥ uid_owner_map ä¸­çš„è§„åˆ™
    â”‚   â”œâ”€ æ£€æŸ¥ Data Saverã€Per-App Restrictions
    â”‚   â””â”€ DROP/PASS å†³ç­–
    â”‚
    â””â”€ æ­¥éª¤ <span class="hljs-number">4</span>ï¼šåŸå­æ›´æ–°ç»Ÿè®¡
        â”œâ”€ æ„å»º StatsKey = {uid, tag, counterSet, ifaceIndex}
        â”œâ”€ æŸ¥è¯¢/åˆ›å»º stats_map<span class="hljs-selector-attr">[StatsKey]</span>
        â””â”€ <span class="hljs-built_in">__sync_fetch_and_add</span>(&amp;value-&gt;txBytes, bytes)  <span class="hljs-comment">// åŸå­æ“ä½œ</span>
           <span class="hljs-built_in">__sync_fetch_and_add</span>(&amp;value-&gt;txPackets, <span class="hljs-number">1</span>)

æ›´æ–°å®Œæˆï¼Œè¿”å› PASS/DROP
</code></pre>
<p><strong>å…³é”®ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>__sync_fetch_and_add()</code>ï¼šåŸå­ CAS æŒ‡ä»¤ï¼Œ<strong>æ— é”</strong>æ›´æ–°</li>
<li>å¤„äºä¸­æ–­ä¸Šä¸‹æ–‡ï¼š<strong>ç²¾ç¡®çš„æ—¶é—´æˆ³</strong></li>
<li>percpu æ•°æ®ç»“æ„ï¼šCPU ä¹‹é—´<strong>æ— ç¼“å­˜å†²çª</strong></li>
</ul>
<hr/>
<h2 data-id="heading-49"><strong>äº”ã€ç”¨æˆ·ç©ºé—´çš„æ•°æ®é‡‡é›†æµç¨‹</strong></h2>
<h3 data-id="heading-50"><strong>å‘¨æœŸæ€§è½®è¯¢</strong></h3>
<pre><code class="hljs language-scss" lang="scss">NetworkStatsService<span class="hljs-selector-class">.performPollLocked</span>()
    â†“
æ¯ <span class="hljs-number">2</span> å°æ—¶æ‰§è¡Œä¸€æ¬¡ (å¯é…ç½®)
    â†“
<span class="hljs-selector-attr">[Map Swap æ“ä½œ]</span>
    <span class="hljs-number">1</span>. è¯»å– configuration_map è·å–å½“å‰æ´»è·ƒ Mapï¼ˆ<span class="hljs-selector-tag">A</span> æˆ– <span class="hljs-selector-tag">B</span>ï¼‰
    <span class="hljs-number">2</span>. åˆ‡æ¢åˆ°éæ´»è·ƒ Mapï¼ˆ<span class="hljs-selector-tag">B</span> â†’ <span class="hljs-selector-tag">A</span> æˆ– <span class="hljs-selector-tag">A</span> â†’ <span class="hljs-selector-tag">B</span>ï¼‰
    <span class="hljs-number">3</span>. è°ƒç”¨ <span class="hljs-built_in">synchronizeKernelRCU</span>()
       â””â”€ ç­‰å¾…æ‰€æœ‰ CPU çš„ eBPF ç¨‹åºå®Œæˆ
    
    â†“
ä»éæ´»è·ƒï¼ˆæ—§ï¼‰Map è¯»å–æ•°æ®
    â”‚
    â”œâ”€ <span class="hljs-built_in">nativeReadNetworkStatsDetail</span>()  <span class="hljs-selector-attr">[C++ å‡½æ•°]</span>
    â”‚   â”œâ”€ éå† stats_mapï¼ˆéæ´»è·ƒï¼‰
    â”‚   â”œâ”€ èšåˆ UID/Tag/Interface ç»´åº¦
    â”‚   â””â”€ è¿”å› NetworkStats å¯¹è±¡
    â”‚
    â””â”€ æ¸…ç©ºå·²è¯»çš„æ—§ Map
        â””â”€ inactiveStatsMap-&gt;<span class="hljs-attribute">clear</span>()

æ›´æ–°å®Œæˆåï¼š
    <span class="hljs-number">1</span>. å°†å¢é‡åˆå¹¶åˆ° mPersistSnapshot
    <span class="hljs-number">2</span>. è°ƒç”¨ NetworkStatsRecorder æŒä¹…åŒ–
    <span class="hljs-number">3</span>. é‡æ–°åˆ‡æ¢ Mapï¼ˆæ¢å¤åŸå§‹æ´»è·ƒ Mapï¼‰
</code></pre>
<h3 data-id="heading-51"><strong>ä»£ç ç¤ºä¾‹</strong>ï¼ˆBpfNetworkStats.cppï¼‰</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">parseBpfNetworkStatsDetail</span><span class="hljs-params">(std::vector&lt;stats_line&gt;* lines)</span> </span>{
    <span class="hljs-comment">// è¯»å–å½“å‰é…ç½®</span>
    <span class="hljs-keyword">auto</span> configuration = configurationMap.<span class="hljs-built_in">readValue</span>(
        CURRENT_STATS_MAP_CONFIGURATION_KEY);
    
    <span class="hljs-comment">// é€‰æ‹©éæ´»è·ƒ Map</span>
    BpfMap&lt;StatsKey, StatsValue&gt; *inactiveStatsMap;
    <span class="hljs-keyword">if</span> (configuration.<span class="hljs-built_in">value</span>() == SELECT_MAP_A) {
        inactiveStatsMap = &amp;statsMapB;  <span class="hljs-comment">// è¯»å– Bï¼ˆå¦‚æœ A æ˜¯æ´»è·ƒï¼‰</span>
    } <span class="hljs-keyword">else</span> {
        inactiveStatsMap = &amp;statsMapA;
    }
    
    <span class="hljs-comment">// è¿­ä»£è¯»å–æ‰€æœ‰æ¡ç›®</span>
    <span class="hljs-built_in">parseBpfNetworkStatsDetailInternal</span>(
        *lines, 
        *inactiveStatsMap, 
        ifindex2name
    );
    
    <span class="hljs-comment">// æ¸…ç©ºå·²è¯» Map</span>
    inactiveStatsMap-&gt;<span class="hljs-built_in">clear</span>();
}
</code></pre>
<hr/>
<h2 data-id="heading-52"><strong>å…­ã€åŒ Map æœºåˆ¶çš„å¦™å¤„</strong></h2>
<h3 data-id="heading-53"><strong>ä¸ºä»€ä¹ˆéœ€è¦ stats_map_A å’Œ stats_map_Bï¼Ÿ</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript">é—®é¢˜ï¼šå¦‚æœåªç”¨ <span class="hljs-number">1</span> ä¸ª <span class="hljs-title class_">Map</span>
  â”œâ”€ ç”¨æˆ·ç©ºé—´è¿­ä»£è¯» <span class="hljs-title class_">Map</span> éœ€è¦ ms çº§æ—¶é—´
  â”œâ”€ æœŸé—´å†…æ ¸ eBPF ç»§ç»­å†™å…¥
  â”œâ”€ æ•°æ®ä¸ä¸€è‡´ï¼å¯èƒ½è¯»åˆ°åŠæˆå“æ•°æ®

è§£å†³æ–¹æ¡ˆï¼šåŒ <span class="hljs-title class_">Map</span> + åŸå­äº¤æ¢
  â”œâ”€ <span class="hljs-title class_">Map</span> Aï¼ˆæ´»è·ƒå†™å…¥ï¼‰
  â”‚   â””â”€ å†…æ ¸ eBPF ç¨‹åºæŒç»­æ›´æ–°
  â”‚
  â”œâ”€ <span class="hljs-title class_">Map</span> Bï¼ˆå‡†å¤‡è¯»å–ï¼‰
  â”‚   â””â”€ ç”¨æˆ·ç©ºé—´å®‰å…¨è¯»å–
  â”‚
  â””â”€ åŒæ­¥æ—¶æœº
      <span class="hljs-number">1.</span> ç”¨æˆ·ç©ºé—´ï¼šäº¤æ¢ configuration_map
      <span class="hljs-number">2.</span> å†…æ ¸ï¼š<span class="hljs-variable constant_">RCU</span> åŒæ­¥ï¼Œç¡®ä¿æ‰€æœ‰ eBPF å®Œæˆ
      <span class="hljs-number">3.</span> ç”¨æˆ·ç©ºé—´ï¼šå®‰å…¨è¯» <span class="hljs-title class_">Map</span> Bï¼ˆæ²¡æœ‰å¹¶å‘å†™ï¼‰
      <span class="hljs-number">4.</span> ç”¨æˆ·ç©ºé—´ï¼šæ¸…ç©º <span class="hljs-title class_">Map</span> B
      <span class="hljs-number">5.</span> ç”¨æˆ·ç©ºé—´ï¼šæ¢å¤é…ç½®ï¼ˆå›åˆ°åŸæ¥çš„ Aï¼‰
</code></pre>
<p><strong>æ—¶åºå›¾</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">æ—¶é—´çº¿
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T0  <span class="hljs-built_in">Map_A</span>(æ´»)    <span class="hljs-built_in">Map_B</span>(ç©º)
    eBPFå†™â†’       ç”¨æˆ·è¯»(ä¸Šæ¬¡ç»“æœ)
    
T1  <span class="hljs-selector-attr">[é…ç½®äº¤æ¢]</span> configuration_map = <span class="hljs-selector-tag">B</span>
    
T2  <span class="hljs-selector-attr">[RCUåŒæ­¥]</span> <span class="hljs-built_in">synchronizeKernelRCU</span>()
    æ‰€æœ‰ CPU eBPF å®Œæˆ
    
T3  <span class="hljs-built_in">Map_A</span>(ä¸Šæ¬¡æ•°æ®)  <span class="hljs-built_in">Map_B</span>(æ´»ï¼Œæ–°æ•°æ®)
    ç”¨æˆ·è¯»â†’          eBPFå†™â†’
    
T4  <span class="hljs-selector-attr">[æ¸…ç©º Map_A]</span> Map_A<span class="hljs-selector-class">.clear</span>()
    
T5  <span class="hljs-selector-attr">[æ¢å¤é…ç½®]</span> configuration_map = <span class="hljs-selector-tag">A</span>
    
T6  å‡†å¤‡ä¸‹ä¸€è½®å¾ªç¯
</code></pre>
<hr/>
<h2 data-id="heading-54"><strong>ä¸ƒã€eBPF çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§</strong></h2>
<h3 data-id="heading-55"><strong>1. åŸå­æ“ä½œæ›¿ä»£é”</strong></h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// ä¸ç”¨äº’æ–¥é”ï¼Œç”¨ CPU çº§åŸå­æ“ä½œ</span>
__sync_fetch_and_add(&amp;value-&gt;txBytes, bytes);
<span class="hljs-comment">// ç¼–è¯‘ä¸ºå•æ¡ LOCK ADD æŒ‡ä»¤ï¼ˆx86ï¼‰æˆ– STXRï¼ˆARMï¼‰</span>
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼š</p>
<ul>
<li>äº’æ–¥é”ï¼šéœ€è¦è°ƒåº¦å™¨åˆ‡æ¢ï¼ŒÎ¼s é‡çº§å»¶è¿Ÿ</li>
<li>åŸå­æ“ä½œï¼šå•æ¡æŒ‡ä»¤ï¼Œns é‡çº§</li>
</ul>
<h3 data-id="heading-56"><strong>2. æ¡ä»¶ç¼–è¯‘å¤šç‰ˆæœ¬æ”¯æŒ</strong></h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// ä¸ºä¸åŒå†…æ ¸ç‰ˆæœ¬ç¼–è¯‘ä¸åŒ eBPF ä»£ç </span>
DEFINE_NETD_BPF_PROG_KVER_RANGE(
    <span class="hljs-string">"cgroupskb/egress/stats$4_19"</span>, 
    ..., 
    KVER_4_19,   <span class="hljs-comment">// æœ€ä½æ”¯æŒ 4.19</span>
    KVER_INF     <span class="hljs-comment">// æœ€é«˜æ— é™åˆ¶</span>
)

DEFINE_NETD_BPF_PROG_KVER_RANGE(
    <span class="hljs-string">"cgroupskb/egress/stats$4_14"</span>,
    ...,
    KVER_NONE,   <span class="hljs-comment">// æœ€ä½ 4.14</span>
    KVER_4_19    <span class="hljs-comment">// æœ€é«˜ 4.19</span>
)
</code></pre>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>4.14ï¼šåŠŸèƒ½æœ‰é™ï¼Œç”¨åŸºç¡€ API</li>
<li>4.19+ï¼šæ”¯æŒ <code>bpf_skb_load_bytes_relative()</code>ï¼Œæ›´å‡†ç¡®çš„åŒ…å¤´è¯»å–</li>
<li>5.8+ï¼šæ”¯æŒ ringbufï¼Œå¯åšåŒ…è·Ÿè¸ª</li>
</ul>
<h3 data-id="heading-57"><strong>3. æ•°æ®åŒ…å¤§å°é‡ç®—</strong></h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// MTU åˆ†æ®µé‡ç®—</span>
<span class="hljs-keyword">if</span> (bytes &gt; mtu) {  <span class="hljs-comment">// 1500 å­—èŠ‚</span>
    <span class="hljs-type">int</span> tcp_overhead = ip_overhead + <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> tcphdr) + <span class="hljs-number">12</span>;
    <span class="hljs-type">int</span> mss = mtu - tcp_overhead;
    
    <span class="hljs-comment">// è®¡ç®—åˆ†æ®µåå®é™…å‘é€çš„åŒ…æ•°å’Œå­—èŠ‚æ•°</span>
    <span class="hljs-type">uint64_t</span> payload = bytes - tcp_overhead;
    packets = (payload + mss - <span class="hljs-number">1</span>) / mss;  <span class="hljs-comment">// ceil é™¤æ³•</span>
    bytes = tcp_overhead * packets + payload;
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆé‡è¦</strong>ï¼Ÿ</p>
<ul>
<li>åº”ç”¨å±‚çœ‹åˆ° 1KB çš„æ•°æ®</li>
<li>ç½‘ç»œå±‚éœ€è¦ 1500 å­—èŠ‚ MTU æ‹†åˆ†æˆ 1 åŒ…</li>
<li><strong>ç»Ÿè®¡çš„æ˜¯ç½‘ç»œå±‚å­—èŠ‚æ•°</strong>ï¼Œéœ€è¦é‡ç®—</li>
</ul>
<hr/>
<h2 data-id="heading-58"><strong>å…«ã€eBPF Map çš„å†…å­˜ç®¡ç†</strong></h2>
<h3 data-id="heading-59"><strong>Map å¤§å°è®¡ç®—</strong></h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">cookie_tag_map:</span>     <span class="hljs-number">10000</span> <span class="hljs-string">entries</span> <span class="hljs-string">Ã—</span> <span class="hljs-string">(8B</span> <span class="hljs-string">key</span> <span class="hljs-string">+</span> <span class="hljs-string">12B</span> <span class="hljs-string">value)</span>  <span class="hljs-string">=</span> <span class="hljs-number">200</span> <span class="hljs-string">KB</span>
<span class="hljs-attr">stats_map_A/B:</span>      <span class="hljs-number">5000 </span><span class="hljs-string">entries</span> <span class="hljs-string">Ã—</span> <span class="hljs-string">(16B</span> <span class="hljs-string">key</span> <span class="hljs-string">+</span> <span class="hljs-string">32B</span> <span class="hljs-string">value)</span> <span class="hljs-string">=</span> <span class="hljs-number">240</span> <span class="hljs-string">KB</span> <span class="hljs-string">(Ã—2)</span>
<span class="hljs-attr">uid_counterset_map:</span> <span class="hljs-number">4000 </span><span class="hljs-string">entries</span> <span class="hljs-string">Ã—</span> <span class="hljs-string">(4B</span> <span class="hljs-string">+</span> <span class="hljs-string">1B)</span>            <span class="hljs-string">=</span> <span class="hljs-number">20</span> <span class="hljs-string">KB</span>
<span class="hljs-attr">iface_stats_map:</span>    <span class="hljs-number">1000 </span><span class="hljs-string">entries</span> <span class="hljs-string">Ã—</span> <span class="hljs-string">(4B</span> <span class="hljs-string">+</span> <span class="hljs-string">32B)</span>           <span class="hljs-string">=</span> <span class="hljs-number">36</span> <span class="hljs-string">KB</span>
<span class="hljs-attr">uid_owner_map:</span>      <span class="hljs-number">4000 </span><span class="hljs-string">entries</span> <span class="hljs-string">Ã—</span> <span class="hljs-string">(4B</span> <span class="hljs-string">+</span> <span class="hljs-string">8B)</span>            <span class="hljs-string">=</span> <span class="hljs-number">48</span> <span class="hljs-string">KB</span>
<span class="hljs-string">...</span>
<span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
<span class="hljs-string">æ€»è®¡ï¼š~</span> <span class="hljs-number">4.9</span> <span class="hljs-string">MB</span>
</code></pre>
<p><strong>å†…æ ¸è¦æ±‚</strong>ï¼š</p>
<ul>
<li>éœ€è¦ memlock rlimit â‰¥ 5MBï¼ˆå¯ç”¨ <code>ulimit -l</code> æŸ¥çœ‹ï¼‰</li>
<li>ç›¸æ¯” xt_qtaguid çš„å†…å­˜ç®¡ç†æ›´é«˜æ•ˆ</li>
</ul>
<hr/>
<h2 data-id="heading-60"><strong>ä¹ã€ä¸ç½‘ç»œç­–ç•¥ç®¡ç†çš„åä½œ</strong></h2>
<p>eBPF ä¸ä»…ç»Ÿè®¡ï¼Œè¿˜<strong>æ‰§è¡Œç½‘ç»œç­–ç•¥</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">uid_owner_map è§„åˆ™æ£€æŸ¥
    â”œâ”€ BACKGROUND_MATCHï¼šåå°åº”ç”¨é™åˆ¶
    â”œâ”€ DOZABLE_MATCHï¼šä½ç”µé‡æ¨¡å¼é™åˆ¶
    â”œâ”€ POWERSAVE_MATCHï¼šçœç”µæ¨¡å¼é™åˆ¶
    â”œâ”€ IIF_MATCHï¼šç‰¹å®šæ¥å£é™åˆ¶
    â”œâ”€ LOCKDOWN_VPN_MATCHï¼šVPN éš”ç¦»
    â””â”€ DROP_UNLESS_DNSï¼šä»…å…è®¸ DNS

å®æ—¶å†³ç­–
    <span class="hljs-keyword">if</span> (enabledRules &amp; BACKGROUND_MATCH &amp;&amp; uidRules &amp; BACKGROUND_MATCH)
        <span class="hljs-keyword">return</span> DROP;  <span class="hljs-comment">// eBPF ç›´æ¥ä¸¢åŒ…ï¼Œä¸éœ€ç”¨æˆ·ç©ºé—´å¹²é¢„</span>
</code></pre>
<p><strong>æ€§èƒ½æ„ä¹‰</strong>ï¼š</p>
<ul>
<li>åå°åº”ç”¨é™åˆ¶ç›´æ¥åœ¨å†…æ ¸æ‰§è¡Œ</li>
<li>æ— éœ€ç³»ç»Ÿè°ƒç”¨ï¼Œ<strong>é˜²æ­¢æ•°æ®æ³„éœ²</strong></li>
<li><strong>Sub-microsecond åˆ¤å†³å»¶è¿Ÿ</strong></li>
</ul>
<hr/>
<h2 data-id="heading-61"><strong>åã€æ•°æ®æŒä¹…åŒ–ç®¡ç†</strong></h2>
<h3 data-id="heading-62"><strong>NetworkStatsRecorder çš„è§’è‰²</strong></h3>
<pre><code class="hljs language-python" lang="python">å‘¨æœŸè½®è¯¢                    æ–‡ä»¶å­˜å‚¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
eBPF Map(å®æ—¶)
    â†“
NetworkStatsFactory
    â†“
NetworkStatsService
    â”œâ”€ mUidStatsï¼ˆå†…å­˜ï¼‰      â†’ NetworkStatsRecorder
    â”œâ”€ mIfaceStats            â†’ FileRotator
    â””â”€ mNetworkStats          â†’ /data/system/netstats/
                                 â””â”€ current.<span class="hljs-built_in">bin</span>
                                 â””â”€ xt_stat_YYYY-MM-DD.<span class="hljs-built_in">bin</span>
                                 â””â”€ uid_stat_YYYY-MM-DD.<span class="hljs-built_in">bin</span>
                                 â””â”€ uid_tag_stat_YYYY-MM-DD.<span class="hljs-built_in">bin</span>
</code></pre>
<p><strong>FileRotator ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>2 å°æ—¶æ»šåŠ¨ä¸€æ¬¡ï¼ˆnetwork statsï¼‰</li>
<li>5 å¤©å­˜å‚¨ï¼ˆuid statsï¼‰</li>
<li>15 å¤©å­˜å‚¨ï¼ˆtag statsï¼‰</li>
</ul>
<h3 data-id="heading-63"><strong>æŒä¹…åŒ–æ¡ä»¶</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NetworkStatsRecorder.maybePersistLocked()</span>
<span class="hljs-keyword">if</span> (pendingBytes &gt;= PERSIST_THRESHOLD) {  <span class="hljs-comment">// é»˜è®¤ 2MB</span>
    forcePersistLocked();
}
</code></pre>
<hr/>
<h2 data-id="heading-64"><strong>åä¸€ã€å®Œæ•´äº¤äº’æµç¨‹æ€»ç»“</strong></h2>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[åº”ç”¨å±‚]</span> App å‘é€ HTTP è¯·æ±‚
    â†“
<span class="hljs-section">[ç³»ç»Ÿè°ƒç”¨]</span> write(socket_fd, data)
    â†“
<span class="hljs-section">[å†…æ ¸ Socket å±‚]</span> __sock_sendmsg()
    â”œâ”€ eBPF Cgroup Socket Create Hookï¼šæ ‡è®° socket
    â”‚   â””â”€ <span class="hljs-attr">TAG_HTTP</span> = <span class="hljs-number">0</span>x123 å†™å…¥ cookie_tag_map
    â”‚
    â””â”€ eBPF Cgroup Egress Hookï¼šç»Ÿè®¡ TX
        â”œâ”€ è·å– <span class="hljs-attr">UID</span> = <span class="hljs-number">10086</span>ï¼ˆå‡è®¾ WeChatï¼‰
        â”œâ”€ æŸ¥è¯¢ <span class="hljs-attr">tag</span> = <span class="hljs-number">0</span>x123ï¼ˆHTTPï¼‰
        â”œâ”€ æ£€æŸ¥ uid_owner_map ç­–ç•¥
        â”œâ”€ åŸå­æ›´æ–° stats_map<span class="hljs-section">[{uid=10086, tag=0x123, ...}]</span>
        â”‚   += {txPackets: 1, txBytes: 1024}
        â””â”€ è¿”å› PASSï¼ŒåŒ…ç»§ç»­å‘é€
    â†“
<span class="hljs-section">[ç½‘ç»œé©±åŠ¨]</span> åŒ…ç¦»å¼€ç½‘å¡
    â†“
<span class="hljs-section">[å†…æ ¸ eBPF TC å±‚]</span> skfilter/egress/xtbpf Hook
    â””â”€ æ›´æ–° iface_stats_mapï¼ˆæ¥å£çº§ç»Ÿè®¡ï¼‰
    â†“
<span class="hljs-section">[å‘¨æœŸè½®è¯¢ 2 å°æ—¶]</span> NetworkStatsService.performPollLocked()
    â”œâ”€ äº¤æ¢ Mapï¼ˆA â†” Bï¼‰
    â”œâ”€ ä»éæ´»è·ƒ Map è¯»å–æ‰€æœ‰ç»Ÿè®¡
    â”œâ”€ èšåˆæ•°æ®ï¼šstats_map â†’ NetworkStats å¯¹è±¡
    â”œâ”€ NetworkStatsRecorder å†™å…¥ç£ç›˜
    â”‚   â””â”€ /data/system/netstats/current.bin
    â””â”€ App å¯é€šè¿‡ TrafficStats.getUidTxBytes(10086) æŸ¥è¯¢
       æˆ–é€šè¿‡ NetworkStatsManager æŸ¥è¯¢å†å²æ•°æ®
</code></pre>
<hr/>
<h2 data-id="heading-65"><strong>æ€»ç»“ï¼šeBPF çš„æ ¸å¿ƒä»·å€¼</strong></h2>


















































<table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆxt_qtaguidï¼‰</th><th>eBPF æ–°æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œä½ç½®</strong></td><td>å†…æ ¸æ¨¡å—ï¼ˆé¢„ç¼–è¯‘ï¼‰</td><td>å†…æ ¸ eBPF VMï¼ˆJIT ç¼–è¯‘ï¼‰</td></tr><tr><td><strong>å¹¶å‘æ§åˆ¶</strong></td><td>é”ç«äº‰ï¼ˆè‡ªæ—‹é”ï¼‰</td><td>åŸå­æ“ä½œï¼ˆæ— é”ï¼‰</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td>å›ºå®šåŠŸèƒ½</td><td>åŠ¨æ€åŠ è½½/å¸è½½</td></tr><tr><td><strong>å¼€é”€</strong></td><td>é«˜ï¼ˆç¼“å­˜è¡Œå¤±æ•ˆï¼‰</td><td>ä½ï¼ˆpercpu æ•°æ®ï¼‰</td></tr><tr><td><strong>æ—¶é—´ç²¾åº¦</strong></td><td>ms çº§</td><td>ns çº§</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>å¤§ï¼ˆçµæ´»ä½†æ•£ä¹±ï¼‰</td><td>å°ï¼ˆç»“æ„åŒ– Mapï¼‰</td></tr><tr><td><strong>å¯å®¡è®¡æ€§</strong></td><td>é»‘ç›’</td><td>eBPF æºç å¯è¯»</td></tr><tr><td><strong>æ›´æ–°å‘¨æœŸ</strong></td><td>éœ€è¦é‡ç¼–å†…æ ¸</td><td>APEX æ¨¡å—åŒ–æ›´æ–°</td></tr></tbody></table>
<p><strong>eBPF æ˜¯ Android ç½‘ç»œç»Ÿè®¡çš„"å¿ƒè„"</strong>ï¼š</p>
<ul>
<li>ç›´æ¥åœ¨æ•°æ®åŒ…ç»è¿‡å†…æ ¸æ—¶é‡‡é›†ï¼ˆ<strong>é›¶æ‹·è´</strong>ï¼‰</li>
<li>ç­–ç•¥æ‰§è¡Œï¼ˆDROP/PASSï¼‰åŒæ­¥è¿›è¡Œ</li>
<li>åŒ Map æœºåˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
<li>åŸå­æ“ä½œå®ç°é«˜æ€§èƒ½æ— é”æ›´æ–°</li>
<li>æ”¯æŒçƒ­æ›´æ–°å’Œç‰ˆæœ¬çµæ´»æ€§</li>
</ul>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Android 12+ å…¨é¢è¿ç§»åˆ° eBPF çš„åŸå› ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android å…±äº«è¿æ¥ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æ¶æ„åˆ†æ]]></title>    <link>https://juejin.cn/post/7603575763787087898</link>    <guid>https://juejin.cn/post/7603575763787087898</guid>    <pubDate>2026-02-07T02:53:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575763787087898" data-draft-id="7603567912592900123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android å…±äº«è¿æ¥ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æ¶æ„åˆ†æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T02:53:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android å…±äº«è¿æ¥ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æ¶æ„åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T02:53:58.000Z" title="Sat Feb 07 2026 02:53:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€ç³»ç»Ÿæ•´ä½“æ¶æ„</h3>
<p>Android Tethering ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¤šå±‚çš„ç½‘ç»œå…±äº«ç®¡ç†æ¡†æ¶ï¼Œå…è®¸è®¾å¤‡é€šè¿‡ä¸åŒçš„ä¸‹æ¸¸æ¥å£ï¼ˆWiFi çƒ­ç‚¹ã€USBã€è“ç‰™ã€ä»¥å¤ªç½‘ç­‰ï¼‰å‘å…¶ä»–è®¾å¤‡å…±äº«ç½‘ç»œè¿æ¥ã€‚</p>
<h4 data-id="heading-1">æ ¸å¿ƒå±‚çº§ç»“æ„ï¼š</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       åº”ç”¨å±‚ (SystemUI / Framework APIs)              â”‚
â”‚  TetheringManager, HotspotController, ConnectivityUI  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    FrameworkæœåŠ¡å±‚ (packages_modules_Connectivity)   â”‚
â”‚  TetheringService, Tethering (ä¸»çŠ¶æ€æœº)ï¼ŒUpstreamNetworkMonitor
â”‚  IpServer (ä¸‹æ¸¸æ¥å£çŠ¶æ€æœº)ï¼ŒBpfCoordinator           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç³»ç»ŸæœåŠ¡å±‚ (system_netd / INetd Binder)            â”‚
â”‚  TetherController (DHCP/DNS), NetworkController      â”‚
â”‚  RouteController (IPè½¬å‘/NAT), iptablesè§„åˆ™ç®¡ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å†…æ ¸å±‚ (Linux Kernel)                             â”‚
â”‚  iptables, netfilter, IPè½¬å‘ï¼ŒTC (æµé‡æ§åˆ¶)ï¼ŒBPF     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-2">äºŒã€æ ¸å¿ƒæ¨¡å—è¯¦è§£</h3>
<h4 data-id="heading-3">2.1 TetheringManager / TetheringServiceï¼ˆåº”ç”¨å…¥å£ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·ä¾§ API</span>
TetheringManager.startTethering(TetheringRequest, Executor, callback)
TetheringManager.stopTethering(type)

<span class="hljs-comment">// å†…éƒ¨å¤„ç†</span>
TetheringService
â”œâ”€â”€ TetheringConnector (Binderæ¥å£)
â””â”€â”€ Tethering (æ ¸å¿ƒçŠ¶æ€æœºæœåŠ¡)
</code></pre>
<p><strong>æ ¸å¿ƒæµç¨‹</strong>ï¼š</p>
<ul>
<li>åº”ç”¨è°ƒç”¨ <code>startTethering()</code> æ—¶ï¼ŒæŒ‡å®šå…±äº«ç±»å‹ï¼ˆWiFiã€USBã€Bluetoothç­‰ï¼‰</li>
<li>è§¦å‘æƒé™æ£€æŸ¥å’Œé…é¢æ£€æŸ¥</li>
<li>å¯åŠ¨ Tethering æœåŠ¡çŠ¶æ€æœº</li>
</ul>
<h4 data-id="heading-4">2.2 Tethering ä¸»çŠ¶æ€æœº</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Tethering</span> {
    <span class="hljs-comment">// ç»´æŠ¤å„æ¥å£çš„çŠ¶æ€</span>
    SparseArray&lt;TetherState&gt; mTetherStates;  <span class="hljs-comment">// æŒ‰æ¥å£ç±»å‹ç´¢å¼•</span>
    
    <span class="hljs-comment">// ä¸Šæ¸¸ç½‘ç»œç›‘æ§</span>
    UpstreamNetworkMonitor mUpstreamNetworkMonitor;
    
    <span class="hljs-comment">// ä¸»çŠ¶æ€æœº</span>
    TetherMainSM mTetherMainSM;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TetherState</span> {
    IpServer ipServer;           <span class="hljs-comment">// è¯¥æ¥å£çš„IPé…ç½®æœº</span>
    <span class="hljs-type">int</span> lastState;               <span class="hljs-comment">// AVAILABLE/TETHERED/LOCAL_ONLY/UNAVAILABLE</span>
    <span class="hljs-type">int</span> lastError;               <span class="hljs-comment">// é”™è¯¯ä»£ç </span>
    <span class="hljs-type">boolean</span> isNcm;               <span class="hljs-comment">// USB NCM æ ‡å¿—</span>
}
</code></pre>
<p><strong>å…³é”®èŒè´£</strong>ï¼š</p>
<ol>
<li><strong>æ¥å£ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šåˆ›å»º/é”€æ¯ä¸‹æ¸¸æ¥å£å¯¹åº”çš„ IpServer</li>
<li><strong>ä¸Šæ¸¸ç½‘ç»œè·Ÿè¸ª</strong>ï¼šç›‘å¬ç³»ç»Ÿé»˜è®¤ç½‘ç»œå˜åŒ–</li>
<li><strong>è½¬å‘è§„åˆ™åè°ƒ</strong>ï¼šä¸ netd é€šä¿¡è®¾ç½® NAT å’Œè½¬å‘</li>
<li><strong>é…é¢/ç»Ÿè®¡ç®¡ç†</strong>ï¼šé€šè¿‡ BpfCoordinator æ”¶é›†è½¬å‘æµé‡ç»Ÿè®¡</li>
</ol>
<h4 data-id="heading-5">2.3 IpServer ä¸‹æ¸¸æ¥å£çŠ¶æ€æœºï¼ˆæ ¸å¿ƒï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IpServer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StateMachineShim</span> {
    <span class="hljs-comment">// ===== 5ä¸ªçŠ¶æ€ =====</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_UNAVAILABLE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ¥å£æœªå°±ç»ª</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_AVAILABLE</span>   <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ¥å£å°±ç»ªï¼Œç­‰å¾…è¯·æ±‚</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_TETHERED</span>    <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;  <span class="hljs-comment">// æ­£åœ¨å…±äº«ï¼ˆå…¨å±€ä¸Šæ¸¸ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_LOCAL_ONLY</span>  <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;  <span class="hljs-comment">// æœ¬åœ°çƒ­ç‚¹ï¼ˆæ— ä¸Šæ¸¸ï¼‰</span>
    <span class="hljs-comment">// (å†…éƒ¨) WaitingForRestart         // é‡å¯ä¸­</span>
    
    <span class="hljs-comment">// ===== å…³é”®æˆå‘˜ =====</span>
    String mIfaceName;                       <span class="hljs-comment">// æ¥å£å (wlan0, usb0, etc.)</span>
    LinkAddress mIpv4Address;               <span class="hljs-comment">// åˆ†é…çš„æœåŠ¡å™¨ IPv4 åœ°å€</span>
    LinkProperties mLinkProperties;         <span class="hljs-comment">// é“¾è·¯å±æ€§</span>
    IDhcpServer mDhcpServer;                <span class="hljs-comment">// DHCP æœåŠ¡å™¨</span>
    RouterAdvertisementDaemon mRaDaemon;    <span class="hljs-comment">// IPv6 RA è¿›ç¨‹</span>
    InterfaceSet mUpstreamIfaceSet;         <span class="hljs-comment">// ä¸Šæ¸¸æ¥å£é›†åˆ</span>
    List&lt;TetheredClient&gt; mDhcpLeases;       <span class="hljs-comment">// DHCP ç§Ÿçº¦åˆ—è¡¨</span>
    
    <span class="hljs-comment">// BPF å¸è½½åŠ é€Ÿ</span>
    BpfCoordinator mBpfCoordinator;
}
</code></pre>
<p><strong>5ä¸ªæ ¸å¿ƒçŠ¶æ€è¯¦è§£</strong>ï¼š</p>









































<table><thead><tr><th>çŠ¶æ€</th><th>å«ä¹‰</th><th>ä½•æ—¶è¿›å…¥</th><th>ä½•æ—¶é€€å‡º</th></tr></thead><tbody><tr><td>UNAVAILABLE</td><td>æ¥å£ä¸å¯ç”¨</td><td>æ¥å£ç§»é™¤/é©±åŠ¨å´©æºƒ</td><td>æ¥å£é‡æ–°åŠ å…¥</td></tr><tr><td>AVAILABLE</td><td>æ¥å£å°±ç»ª</td><td>åˆå§‹çŠ¶æ€/åœæ­¢å…±äº«</td><td>æ”¶åˆ° CMD_TETHER_REQUESTED</td></tr><tr><td>TETHERED</td><td>æ­£åœ¨å…±äº«</td><td>ç”¨æˆ·å¯ç”¨å…±äº«</td><td>ç”¨æˆ·åœç”¨/ä¸Šæ¸¸æ”¹å˜</td></tr><tr><td>LOCAL_ONLY</td><td>æœ¬åœ°çƒ­ç‚¹</td><td>ç”¨æˆ·å¯ç”¨æœ¬åœ°çƒ­ç‚¹</td><td>ç”¨æˆ·åœç”¨/æ¥å£ä¸‹çº¿</td></tr><tr><td>WaitingForRestart</td><td>é‡å¯ä¸­</td><td>å‰ç¼€å†²çª</td><td>é‡å¯å®Œæˆ</td></tr></tbody></table>
<p><strong>çŠ¶æ€è½¬ç§»å›¾</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                 â”‚
    â–¼                                 â–¼
<span class="hljs-section">[UNAVAILABLE]</span>  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º <span class="hljs-section">[AVAILABLE]</span>
    â”‚                               â”‚
    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ CMD_TETHER_REQUESTED
                           â”‚        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                    â”‚   <span class="hljs-attr">arg1</span>=STATE_TETHEREDâ”‚ or
                    â”‚   <span class="hljs-attr">arg1</span>=STATE_LOCAL   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ TETHEREDâ”‚  â”‚ LOCAL_ONLY  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜  â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚ WaitingForRestart  â”‚
                    â”‚ (prefix conflict)  â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚ <span class="hljs-section">[Restart]</span>  â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Back to TETHERED   â”‚
                    â”‚ or LOCAL_ONLY      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-6">ä¸‰ã€IPv4 é…ç½®æµç¨‹</h3>
<h4 data-id="heading-7">3.1 IPv4 åœ°å€åˆ†é…</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">startIPv4</span>() 
    â”‚
    â”œâ”€â–º <span class="hljs-built_in">requestIpv4Address</span>(scope)
    â”‚   â””â”€â–º PrivateAddressCoordinator<span class="hljs-selector-class">.requestDownstream</span>()
    â”‚       â”œâ”€ å…¨å±€ä½œç”¨åŸŸ(TETHERED): ä½¿ç”¨ PrefixUtils ä»é…ç½®æ± é€‰æ‹©
    â”‚       â””â”€ æœ¬åœ°ä½œç”¨åŸŸ(LOCAL_ONLY): ä½¿ç”¨ç‰¹å®šå‰ç¼€ (e.g., <span class="hljs-number">192.168</span>.<span class="hljs-number">43</span>.x)
    â”‚
    â”œâ”€â–º <span class="hljs-built_in">configureIPv4</span>(enabled, scope)
    â”‚   â”œâ”€ å¯¹äº WiFi/Ethernet: ä¸è®¾ç½® interface upï¼ˆé©±åŠ¨å·²ç®¡ç†ï¼‰
    â”‚   â”œâ”€ å¯¹äº USB/Bluetooth: è°ƒç”¨ InterfaceController è®¾ç½® up
    â”‚   â””â”€ mInterfaceCtrl.<span class="hljs-built_in">setInterfaceConfiguration</span>(linkAddress, setIfaceUp)
    â”‚
    â””â”€â–º <span class="hljs-built_in">configureDhcp</span>(enabled, serverAddr, clientAddr)
        â””â”€â–º <span class="hljs-built_in">startDhcp</span>() / <span class="hljs-built_in">stopDhcp</span>()
</code></pre>
<h4 data-id="heading-8">3.2 DHCP æœåŠ¡å™¨å¯åŠ¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// IpServer.java - startDhcp()</span>
<span class="hljs-type">IDhcpServer</span> <span class="hljs-variable">mDhcpServer</span> <span class="hljs-operator">=</span> mDeps.makeDhcpServer(
    ifaceName,                              <span class="hljs-comment">// æ¥å£å</span>
    DhcpServingParamsParcel {
        Inet4Address defaultRouter;         <span class="hljs-comment">// é»˜è®¤ç½‘å…³ (e.g., 192.168.43.1)</span>
        Inet4Address dnsServer;             <span class="hljs-comment">// DNS æœåŠ¡å™¨ (e.g., 192.168.43.1)</span>
        LinkAddress serverAddr;             <span class="hljs-comment">// æœåŠ¡å™¨åœ°å€ (192.168.43.1/24)</span>
        Inet4Address singleClientAddr;      <span class="hljs-comment">// å•ä¸€å®¢æˆ·ç«¯åœ°å€ (ä»…USB/NCM)</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">dhcpLeaseTimeSecs</span> <span class="hljs-operator">=</span> <span class="hljs-number">3600</span>;       <span class="hljs-comment">// ç§Ÿçº¦æ—¶é—´ (1å°æ—¶)</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">metered</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;             <span class="hljs-comment">// æ ‡è®°ä¸ºè®¡è´¹</span>
        <span class="hljs-type">int</span> leasesSubnetPrefixLength;        <span class="hljs-comment">// P2P å‰ç¼€é•¿åº¦</span>
    },
    DhcpEventCallback {
        onLeasesChanged(DhcpLeaseParcelable[])  <span class="hljs-comment">// è·å– DHCP ç§Ÿçº¦</span>
        onNewPrefixRequest(IpPrefix)             <span class="hljs-comment">// å‰ç¼€æ”¹å˜é€šçŸ¥</span>
    }
)
</code></pre>
<p><strong>DHCP å®¢æˆ·ç«¯ä¿¡æ¯æ”¶é›†</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// DhcpEventCallback.onLeasesChanged() </span>
List&lt;DhcpLeaseParcelable&gt; leases â†’ TetheredClient[] {
    MacAddress macAddress;                  <span class="hljs-comment">// å®¢æˆ·ç«¯ MAC</span>
    LinkAddress address;                    <span class="hljs-comment">// åˆ†é…çš„ IP (å«è¿‡æœŸæ—¶é—´)</span>
    String hostname;                        <span class="hljs-comment">// å®¢æˆ·ç«¯ä¸»æœºå</span>
    <span class="hljs-type">int</span> tetheringType;                      <span class="hljs-comment">// å…±äº«ç±»å‹ (WiFi/USB/BT)</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-9">å››ã€IPv6 é…ç½®ä¸ RAï¼ˆè·¯ç”±é€šå‘Šï¼‰</h3>
<h4 data-id="heading-10">4.1 IPv6 è®¾ç½®æ­¥éª¤</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">startIPv6</span>()
    â”‚
    â”œâ”€â–º <span class="hljs-built_in">configureForIPv6Router</span>(interface)
    â”‚   â”œâ”€ <span class="hljs-built_in">setEnableIPv6</span>(iface, <span class="hljs-number">0</span>) â†’ <span class="hljs-built_in">setEnableIPv6</span>(iface, <span class="hljs-number">1</span>)
    â”‚   â”œâ”€ <span class="hljs-built_in">setAcceptIPv6Ra</span>(iface, <span class="hljs-number">0</span>)        <span class="hljs-comment">// ç¦ç”¨å®¢æˆ·ç«¯ RA</span>
    â”‚   â”œâ”€ <span class="hljs-built_in">setAcceptIPv6Dad</span>(iface, <span class="hljs-number">0</span>)       <span class="hljs-comment">// ç¦ç”¨ DAD</span>
    â”‚   â””â”€ <span class="hljs-built_in">setIPv6DadTransmits</span>(iface, "<span class="hljs-number">0</span>")  <span class="hljs-comment">// ç¦ç”¨ DAD å‘é€</span>
    â”‚
    â”œâ”€â–º RouterAdvertisementDaemon<span class="hljs-selector-class">.start</span>()
    â”‚   â””â”€ å‘¨æœŸå‘é€ RA (Router Advertisement)
    â”‚       â”œâ”€ å‰ç¼€ä¿¡æ¯ (Prefix Information)
    â”‚       â”œâ”€ MTU ä¿¡æ¯
    â”‚       â””â”€ DNS æœåŠ¡å™¨ (RDNSS é€‰é¡¹)
    â”‚
    â””â”€â–º <span class="hljs-built_in">startIPv6TetheringCoordinator</span>()
        â””â”€ ç®¡ç† IPv6 å‰ç¼€åå•†
</code></pre>
<h4 data-id="heading-11">4.2 NAT64/464XLAT</h4>
<p>For IPv6-only or dual-stack scenarios, IpServer can coordinate with:</p>
<ul>
<li><strong>IPv6TetheringCoordinator</strong>: Allocates IPv6 prefixes to downstreams</li>
<li><strong>Nat464Xlat</strong>: Manages NAT64 translation if needed</li>
</ul>
<hr/>
<h3 data-id="heading-12">äº”ã€ä¸Šæ¸¸ç½‘ç»œé€‰æ‹©æœºåˆ¶</h3>
<h4 data-id="heading-13">5.1 UpstreamNetworkMonitor</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UpstreamNetworkMonitor</span> {
    <span class="hljs-comment">// è·Ÿè¸ªç³»ç»Ÿé»˜è®¤ç½‘ç»œ</span>
    Network mDefaultInternetNetwork;
    
    <span class="hljs-comment">// æ‰€æœ‰å¯ç”¨çš„ä¸Šæ¸¸ç½‘ç»œ</span>
    Map&lt;Network, UpstreamNetworkState&gt; mNetworkMap;
    
    <span class="hljs-comment">// é…ç½®æ ‡å¿—</span>
    <span class="hljs-type">boolean</span> mTryCell;              <span class="hljs-comment">// æ˜¯å¦å°è¯•èœ‚çªç½‘ç»œ</span>
    <span class="hljs-type">boolean</span> mDunRequired;          <span class="hljs-comment">// æ˜¯å¦éœ€è¦ DUNï¼ˆDial-Up Networkï¼‰</span>
    <span class="hljs-type">boolean</span> mAutoUpstream;         <span class="hljs-comment">// è‡ªåŠ¨é€‰æ‹©ä¸Šæ¸¸</span>
    <span class="hljs-type">boolean</span> mIsDefaultCellularUpstream;  <span class="hljs-comment">// å½“å‰é»˜è®¤æ˜¯èœ‚çª</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UpstreamNetworkState</span> {
    Network network;
    NetworkCapabilities capabilities;
    LinkProperties linkProperties;
}
</code></pre>
<h4 data-id="heading-14">5.2 ä¸Šæ¸¸é€‰æ‹©é€»è¾‘</h4>
<pre><code class="hljs language-java" lang="java">getCurrentPreferredUpstream() {
    <span class="hljs-comment">// 1. è·å–ç³»ç»Ÿé»˜è®¤ç½‘ç»œçŠ¶æ€</span>
    <span class="hljs-type">UpstreamNetworkState</span> <span class="hljs-variable">dfltState</span> <span class="hljs-operator">=</span> mNetworkMap.get(mDefaultInternetNetwork);
    
    <span class="hljs-comment">// 2. ä¼˜å…ˆé€‰æ‹©éèœ‚çªç½‘ç»œ (WiFi/æœ‰çº¿)</span>
    <span class="hljs-keyword">if</span> (isNetworkUsableAndNotCellular(dfltState)) 
        <span class="hljs-keyword">return</span> dfltState;
    
    <span class="hljs-comment">// 3. æ£€æŸ¥æ˜¯å¦å…è®¸èœ‚çªä¸Šæ¸¸</span>
    <span class="hljs-keyword">if</span> (!isCellularUpstreamPermitted()) 
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// æ— ä¸Šæ¸¸ï¼Œæœ¬åœ°çƒ­ç‚¹æ¨¡å¼</span>
    
    <span class="hljs-comment">// 4. å¦‚æœéœ€è¦ DUNï¼ˆæŸäº›è¿è¥å•†è¦æ±‚ï¼‰</span>
    <span class="hljs-keyword">if</span> (!mDunRequired) 
        <span class="hljs-keyword">return</span> dfltState;
    
    <span class="hljs-comment">// 5. æœç´¢ DUN ä¸“ç”¨ç½‘ç»œ</span>
    <span class="hljs-keyword">return</span> findFirstDunNetwork(mNetworkMap.values());
}
</code></pre>
<p><strong>äº‹ä»¶é€šçŸ¥</strong>ï¼š</p>
<ul>
<li><code>EVENT_DEFAULT_SWITCHED</code>: ç³»ç»Ÿé»˜è®¤ç½‘ç»œæ”¹å˜</li>
<li><code>EVENT_IFACE_SERVING_STATE_ACTIVE</code>: ä¸‹æ¸¸å¼€å§‹å…±äº«</li>
<li><code>EVENT_IFACE_SERVING_STATE_INACTIVE</code>: ä¸‹æ¸¸åœæ­¢å…±äº«</li>
</ul>
<hr/>
<h3 data-id="heading-15">å…­ã€NAT ä¸ IP è½¬å‘</h3>
<h4 data-id="heading-16">6.1 TetherController - netd ä¸­çš„è½¬å‘ç®¡ç†</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// system_netd/server/TetherController.cpp</span>

<span class="hljs-comment">// 1. å¯ç”¨ IP è½¬å‘</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">enableForwarding</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* requester)</span> </span>{
    mForwardingRequests.<span class="hljs-built_in">insert</span>(requester);      <span class="hljs-comment">// å¼•ç”¨è®¡æ•°</span>
    <span class="hljs-built_in">writeToFile</span>(<span class="hljs-string">"/proc/sys/net/ipv4/ip_forward"</span>, <span class="hljs-string">"1"</span>);
    <span class="hljs-built_in">writeToFile</span>(<span class="hljs-string">"/proc/sys/net/ipv6/conf/all/forwarding"</span>, <span class="hljs-string">"1"</span>);
}

<span class="hljs-comment">// 2. å¯åŠ¨ dnsmasqï¼ˆDHCP/DNS æœåŠ¡ï¼‰</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">startTethering</span><span class="hljs-params">(<span class="hljs-type">bool</span> usingLegacyDnsProxy, <span class="hljs-type">char</span>** dhcpRanges)</span> </span>{
    <span class="hljs-comment">// ä¸º dnsmasq åˆ›å»ºç®¡é“é€šä¿¡</span>
    <span class="hljs-built_in">Pipe</span>(pipeRead, pipeWrite);
    
    <span class="hljs-comment">// fork() å¯åŠ¨ dnsmasq è¿›ç¨‹</span>
    <span class="hljs-type">pid_t</span> pid = fork();
    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">execve</span>(<span class="hljs-string">"/system/bin/dnsmasq"</span>, args, <span class="hljs-literal">NULL</span>);
    }
    
    <span class="hljs-comment">// ä¸ dnsmasq é€šä¿¡ï¼šupdate_ifaces|wlan0|usb0</span>
    <span class="hljs-built_in">write</span>(daemonFd, update_ifaces_cmd);
    <span class="hljs-built_in">write</span>(daemonFd, update_dns_cmd);
}

<span class="hljs-comment">// 3. è®¾ç½® NAT è½¬å‘è§„åˆ™</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">enableNat</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* intIface, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* extIface)</span> </span>{
    <span class="hljs-comment">// ç¬¬ä¸€æ¬¡å¯ç”¨è½¬å‘æ—¶ï¼Œæ·»åŠ  MASQUERADE è§„åˆ™</span>
    iptables-restore &lt;&lt; EOF
*nat
-A tetherctrl_nat_POSTROUTING -o $extIface -j MASQUERADE
COMMIT
EOF
    
    <span class="hljs-comment">// ä¸ºè¯¥è½¬å‘å¯¹æ·»åŠ è½¬å‘è§„åˆ™</span>
    iptables-restore &lt;&lt; EOF
*raw
-A tetherctrl_raw_PREROUTING -i $intIface -m rpfilter --invert ! -s fe80::/<span class="hljs-number">64</span> -j DROP
COMMIT

*filter
-A tetherctrl_FORWARD -i $extIface -o $intIface -m state --state ESTABLISHED,RELATED -g tetherctrl_counters
-A tetherctrl_FORWARD -i $intIface -o $extIface -m state --state INVALID -j DROP
-A tetherctrl_FORWARD -i $intIface -o $extIface -g tetherctrl_counters
COMMIT
EOF
}
</code></pre>
<h4 data-id="heading-17">6.2 iptables è§„åˆ™ç»“æ„</h4>
<pre><code class="hljs language-markdown" lang="markdown">è½¬å‘é“¾ (tetherctrl<span class="hljs-emphasis">_FORWARD):

ä¸‹æ¸¸æ¥çš„åŒ… (intIfaceâ†’extIface)ï¼š
    â”‚
    â”œâ”€ çŠ¶æ€æ£€æŸ¥: INVALID â†’ DROP
    â”œâ”€ æµé‡è®¡æ•°: goto tetherctrl_</span>counters
<span class="hljs-code">    â””â”€ é»˜è®¤: DROP
</span>
ä¸Šæ¸¸æ¥çš„åŒ… (extIfaceâ†’intIface)ï¼š
<span class="hljs-code">    â”‚
    â”œâ”€ çŠ¶æ€æ£€æŸ¥: ESTABLISHED,RELATED â†’ goto tetherctrl_counters
    â””â”€ é»˜è®¤: DROP
</span>
MASQUERADE è§„åˆ™ (natè¡¨):
<span class="hljs-code">    å‡ºæ¥å£ $extIface â†’ æ”¹å†™æºåœ°å€ä¸ºå‡ºæ¥å£åœ°å€
</span></code></pre>
<p><strong>å…³é”®é“¾å®šä¹‰</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">LOCAL_FORWARD</span>                = <span class="hljs-string">"tetherctrl_FORWARD"</span>
<span class="hljs-attr">LOCAL_MANGLE_FORWARD</span>         = <span class="hljs-string">"tetherctrl_mangle_FORWARD"</span>
<span class="hljs-attr">LOCAL_NAT_POSTROUTING</span>        = <span class="hljs-string">"tetherctrl_nat_POSTROUTING"</span>
<span class="hljs-attr">LOCAL_RAW_PREROUTING</span>         = <span class="hljs-string">"tetherctrl_raw_PREROUTING"</span>
<span class="hljs-attr">LOCAL_TETHER_COUNTERS_CHAIN</span>  = <span class="hljs-string">"tetherctrl_counters"</span>
</code></pre>
<hr/>
<h3 data-id="heading-18">ä¸ƒã€DHCP ä¸ DNS è½¬å‘</h3>
<h4 data-id="heading-19">7.1 dnsmasq é›†æˆ</h4>
<pre><code class="hljs language-ini" lang="ini">TetherController ä¸­çš„ dnsmasq ç®¡ç†ï¼š

å¯åŠ¨æµç¨‹ï¼š
    startTethering()
    â””â”€â–º fork() + execve("/system/bin/dnsmasq", args)
        
dnsmasq å‚æ•°é…ç½®ï¼š
    --keep-in-foreground       <span class="hljs-comment"># å‰å°è¿è¡Œï¼ˆé¿å…å®ˆæŠ¤åŒ–ï¼‰</span>
    --no-resolv               <span class="hljs-comment"># ä¸è¯»å– /etc/resolv.conf</span>
    --no-poll                 <span class="hljs-comment"># ä¸è½®è¯¢ resolv.conf</span>
    --dhcp-authoritative      <span class="hljs-comment"># æ­¤ DHCP æ˜¯æƒå¨æœåŠ¡</span>
    <span class="hljs-attr">--dhcp-range</span>=start,end,<span class="hljs-number">1</span>h <span class="hljs-comment"># DHCP èŒƒå›´å’Œç§Ÿçº¦æ—¶é—´</span>
    <span class="hljs-attr">--listen-mark</span>=<span class="hljs-number">0</span>x...       <span class="hljs-comment"># Socket markï¼ˆç”¨äºè·¯ç”±ç­–ç•¥ï¼‰</span>
    <span class="hljs-attr">--user</span>=dns_tether         <span class="hljs-comment"># è¿è¡Œç”¨æˆ·</span>
    <span class="hljs-attr">--port</span>=<span class="hljs-number">0</span>                  <span class="hljs-comment"># ç¦ç”¨ DNS é€’å½’æŸ¥è¯¢ç«¯å£</span>
    
ä¸ dnsmasq çš„åŠ¨æ€é€šä¿¡ï¼ˆé€šè¿‡ pipeï¼‰ï¼š
    å‘½ä»¤æ ¼å¼: "command|arg1|arg2|..."
    
    update_ifaces|wlan0|usb0
        â””â”€ å‘Šè¯‰ dnsmasq åœ¨å“ªäº›æ¥å£ä¸Šæä¾› DHCP
    
    update_dns|0x12345|8.8.8.8|8.8.4.4
        â””â”€ å‘Šè¯‰ dnsmasq è½¬å‘ DNS è¯·æ±‚åˆ°è¿™äº›åœ°å€
           0x12345 æ˜¯ Fwmark (ç”¨äºæŒ‡å®šä½¿ç”¨å“ªä¸ªç½‘ç»œ)
</code></pre>
<h4 data-id="heading-20">7.2 DNS æŸ¥è¯¢æµç¨‹</h4>
<pre><code class="hljs language-markdown" lang="markdown">ä¸‹æ¸¸å®¢æˆ·ç«¯ DNS æŸ¥è¯¢:

<span class="hljs-bullet">1.</span> å®¢æˆ·ç«¯å‘é€ DNS æŸ¥è¯¢åˆ° dnsmasq (IpServer åˆ†é…çš„IP:53)
<span class="hljs-bullet">2.</span> dnsmasq æŸ¥è¯¢ç¼“å­˜ â†’ æœªå‘½ä¸­ï¼Œåˆ™è½¬å‘ç»™ä¸Šæ¸¸
<span class="hljs-bullet">3.</span> DNS è½¬å‘è§„åˆ™:
<span class="hljs-bullet">   -</span> æºåœ°å€æ”¹å†™: ä» dnsmasq å‡ºå‘
<span class="hljs-bullet">   -</span> Fwmark æ ‡è®°: ç¡®ä¿ä½¿ç”¨æŒ‡å®šçš„ä¸Šæ¸¸ç½‘ç»œ
<span class="hljs-bullet">   -</span> ç›®æ ‡åœ°å€: ä¸Šæ¸¸ DNS æœåŠ¡å™¨ (é€šè¿‡ setDnsForwarders() é…ç½®)
<span class="hljs-bullet">4.</span> ä¸Šæ¸¸ DNS å“åº” â†’ dnsmasq ç¼“å­˜ â†’ å›å¤ç»™å®¢æˆ·ç«¯
</code></pre>
<hr/>
<h3 data-id="heading-21">å…«ã€ä¸åŒä¸‹æ¸¸ç±»å‹çš„ç‰¹æ®Šå¤„ç†</h3>
<h4 data-id="heading-22">8.1 WiFi çƒ­ç‚¹ (TETHERING_WIFI)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯ç”¨æµç¨‹</span>
setWifiTethering(enable) {
    <span class="hljs-type">WifiManager</span> <span class="hljs-variable">mgr</span> <span class="hljs-operator">=</span> getWifiManager();
    <span class="hljs-keyword">if</span> (enable) {
        mgr.startTetheredHotspot(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// å¯åŠ¨ SoftAP</span>
    } <span class="hljs-keyword">else</span> {
        mgr.stopSoftAp();                 <span class="hljs-comment">// åœæ­¢ SoftAP</span>
    }
}

<span class="hljs-comment">// WiFi ç‰¹æ€§:</span>
<span class="hljs-comment">// - æ¥å£ç”± WiFi Framework ç®¡ç† (up/downçŠ¶æ€)</span>
<span class="hljs-comment">// - IpServer ä¸è°ƒç”¨ setIfaceUp()</span>
<span class="hljs-comment">// - æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯</span>
<span class="hljs-comment">// - å¯é…ç½® SSIDã€å¯†ç ã€é¢‘æ®µ</span>
<span class="hljs-comment">// - MAC åœ°å€å¯èƒ½æ˜¯éšæœºçš„</span>
</code></pre>
<h4 data-id="heading-23">8.2 USB å…±äº« (TETHERING_USB / TETHERING_NCM)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// USB é©±åŠ¨ç®¡ç†</span>
setUsbTethering(enable) {
    <span class="hljs-type">UsbManager</span> <span class="hljs-variable">mgr</span> <span class="hljs-operator">=</span> getUsbManager();
    String[] functions = enable 
        ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] { USB_FUNCTION_RNDIS }  <span class="hljs-comment">// æ—§è®¾å¤‡</span>
        : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] { USB_FUNCTION_NCM };   <span class="hljs-comment">// Android 10+</span>
    mgr.setCurrentFunctions(functions);
}

<span class="hljs-comment">// USB ç‰¹æ€§:</span>
<span class="hljs-comment">// - IpServer éœ€è¦ç®¡ç† interface up/down</span>
<span class="hljs-comment">// - é€šå¸¸ä¸ºå•ä¸€å®¢æˆ·ç«¯ (PC/Mac)</span>
<span class="hljs-comment">// - é™æ€ IP åœ°å€é…ç½®å¯é€‰ (--dhcp-range=å•ä¸ªåœ°å€)</span>
<span class="hljs-comment">// - é«˜é€Ÿã€ç¨³å®šè¿æ¥</span>
<span class="hljs-comment">// - Prefix å˜åŒ–æ—¶éœ€è¦åå•† (NCM ç‰¹æ€§)</span>
</code></pre>
<p><strong>USB NCM çš„å‰ç¼€åå•†</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// onNewPrefixRequest() å¤„ç†</span>
<span class="hljs-comment">// å½“ netd è¯·æ±‚æ–°å‰ç¼€æ—¶ï¼š</span>
handleNewPrefixRequest(IpPrefix newPrefix) {
    <span class="hljs-comment">// 1. ç§»é™¤æ—§åœ°å€å’Œè·¯ç”±</span>
    removeRoutesFromLocalNetwork(oldRoutes);
    
    <span class="hljs-comment">// 2. æ·»åŠ æ–°åœ°å€</span>
    mInterfaceCtrl.addAddress(newAddr, prefixLen);
    
    <span class="hljs-comment">// 3. æ›´æ–° DHCP å‚æ•°</span>
    mDhcpServer.updateParams(newParams);
    
    <span class="hljs-comment">// 4. æ›´æ–° RA å‚æ•° (IPv6)</span>
    mRaDaemon.updateParams(newRaParams);
}
</code></pre>
<h4 data-id="heading-24">8.3 è“ç‰™å…±äº« (TETHERING_BLUETOOTH)</h4>
<pre><code class="hljs language-java" lang="java">setBluetoothTethering(enable, listener) {
    <span class="hljs-type">BluetoothAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> deps.getBluetoothAdapter();
    <span class="hljs-keyword">if</span> (adapter == <span class="hljs-literal">null</span> || !adapter.isEnabled())
        <span class="hljs-keyword">return</span> TETHER_ERROR_SERVICE_UNAVAIL;
    
    <span class="hljs-comment">// è·å– PAN æœåŠ¡</span>
    <span class="hljs-type">BluetoothPan</span> <span class="hljs-variable">pan</span> <span class="hljs-operator">=</span> mBluetoothPan;
    
    <span class="hljs-keyword">if</span> (enable) {
        pan.enable();  <span class="hljs-comment">// å¯ç”¨ PAN è§’è‰²</span>
    } <span class="hljs-keyword">else</span> {
        pan.disable(); <span class="hljs-comment">// ç¦ç”¨ PAN è§’è‰²</span>
    }
}

<span class="hljs-comment">// è“ç‰™ç‰¹æ€§:</span>
<span class="hljs-comment">// - æ¥å£é¢„é…ç½®: 192.168.44.1/24 (å›ºå®š)</span>
<span class="hljs-comment">// - å•ä¸€å®¢æˆ·ç«¯è¿æ¥ (PAN åè®®)</span>
<span class="hljs-comment">// - è¾ƒä½å¸¦å®½ã€é«˜å»¶è¿Ÿ</span>
<span class="hljs-comment">// - ç”µæºæ¶ˆè€—å¤§</span>
</code></pre>
<h4 data-id="heading-25">8.4 ä»¥å¤ªç½‘å…±äº« (TETHERING_ETHERNET)</h4>
<pre><code class="hljs language-java" lang="java">setEthernetTethering(enable) {
    <span class="hljs-type">EthernetManager</span> <span class="hljs-variable">mgr</span> <span class="hljs-operator">=</span> getEthernetManager();
    <span class="hljs-comment">// å°†ä»¥å¤ªç½‘æ¥å£åŠ å…¥ tethering ç®¡ç†</span>
    
    <span class="hljs-comment">// ä»¥å¤ªç½‘ç‰¹æ€§:</span>
    <span class="hljs-comment">// - æ¥å£ç”±ç½‘ç»œæ¡†æ¶ç®¡ç†</span>
    <span class="hljs-comment">// - é«˜é€Ÿã€ä½å»¶è¿Ÿ</span>
    <span class="hljs-comment">// - å¯å¤šä¸ªæ¥å£</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-26">ä¹ã€BPF å¸è½½åŠ é€Ÿæœºåˆ¶</h3>
<h4 data-id="heading-27">9.1 BpfCoordinator å·¥ä½œæµç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BpfCoordinator</span> {
    <span class="hljs-comment">// BPF æ˜ å°„è·¯å¾„</span>
    /sys/fs/bpf/tethering/map_offload_tether_*_map
    
    <span class="hljs-comment">// å…³é”® BPF æ˜ å°„:</span>
    tether_stats_map      <span class="hljs-comment">// æŒ‰ä¸Šæ¸¸æ¥å£ç´¢å¼•ï¼Œè®°å½•è½¬å‘å­—èŠ‚/åŒ…æ•°</span>
    tether_limit_map      <span class="hljs-comment">// è½¬å‘æ•°æ®é™åˆ¶</span>
    tether_downstream4_map   <span class="hljs-comment">// IPv4 ä¸‹æ¸¸è§„åˆ™ (æº/ç›®çš„)</span>
    tether_downstream6_map   <span class="hljs-comment">// IPv6 ä¸‹æ¸¸è§„åˆ™</span>
    tether_upstream4_map     <span class="hljs-comment">// IPv4 ä¸Šæ¸¸è§„åˆ™</span>
    tether_upstream6_map     <span class="hljs-comment">// IPv6 ä¸Šæ¸¸è§„åˆ™</span>
    tether_downstream64_map  <span class="hljs-comment">// NAT64 è½¬æ¢è§„åˆ™</span>
}
</code></pre>
<h4 data-id="heading-28">9.2 BPF è½¬å‘æµç¨‹</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">ä¸‹è¡ŒåŒ…</span> <span class="hljs-string">(downstream</span> <span class="hljs-string">â†’</span> <span class="hljs-string">upstream):</span>
    
    <span class="hljs-string">kernel</span> <span class="hljs-string">æ”¶åˆ°åŒ…ï¼ˆæ¥è‡ªä¸‹æ¸¸æ¥å£ï¼‰</span>
        <span class="hljs-string">â”‚</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">BPF_TC_INGRESS</span> <span class="hljs-string">hook</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">bpf_tether_downstream_ipv4/ipv6()</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æŸ¥æ‰¾è½¬å‘è§„åˆ™:</span> <span class="hljs-string">tether_downstream*_map</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ä¿®æ”¹åŒ…å¤´:</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æº</span> <span class="hljs-attr">MAC:</span> <span class="hljs-string">ä¸‹æ¸¸</span> <span class="hljs-string">â†’</span> <span class="hljs-string">ä¸Šæ¸¸æ¥å£</span> <span class="hljs-string">MAC</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç›®çš„</span> <span class="hljs-attr">MAC:</span> <span class="hljs-string">è·å–ä¸Šæ¸¸ç½‘å…³</span> <span class="hljs-string">MAC</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æº/ç›®çš„</span> <span class="hljs-attr">IP:</span> <span class="hljs-string">æŒ‰</span> <span class="hljs-string">NAT64/444xlat</span> <span class="hljs-string">ä¿®æ”¹</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ›´æ–°ç»Ÿè®¡:</span> <span class="hljs-string">tether_stats_map[upstream_ifindex]</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ£€æŸ¥æ•°æ®é™åˆ¶:</span> <span class="hljs-string">tether_limit_map</span>
        <span class="hljs-string">â””â”€</span> <span class="hljs-attr">TC_ACT_REDIRECT:</span> <span class="hljs-string">é‡å®šå‘åˆ°ä¸Šæ¸¸æ¥å£</span>
        
<span class="hljs-string">ä¸Šè¡ŒåŒ…</span> <span class="hljs-string">(upstream</span> <span class="hljs-string">â†’</span> <span class="hljs-string">downstream):</span>
    
    <span class="hljs-string">kernel</span> <span class="hljs-string">æ”¶åˆ°åŒ…ï¼ˆæ¥è‡ªä¸Šæ¸¸æ¥å£ï¼‰</span>
        <span class="hljs-string">â”‚</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">BPF_TC_EGRESS</span> <span class="hljs-string">hook</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">bpf_tether_upstream_ipv4/ipv6()</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æŸ¥æ‰¾è½¬å‘è§„åˆ™:</span> <span class="hljs-string">tether_upstream*_map</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ä¿®æ”¹åŒ…å¤´:</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æº</span> <span class="hljs-attr">MAC:</span> <span class="hljs-string">ä¸Šæ¸¸</span> <span class="hljs-string">â†’</span> <span class="hljs-string">ä¸‹æ¸¸æ¥å£</span> <span class="hljs-string">MAC</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç›®çš„</span> <span class="hljs-attr">MAC:</span> <span class="hljs-string">è·å–ä¸‹æ¸¸å®¢æˆ·ç«¯</span> <span class="hljs-string">MAC</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">IP</span> <span class="hljs-string">åœ°å€åå‘è½¬æ¢</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ›´æ–°ç»Ÿè®¡:</span> <span class="hljs-string">tether_stats_map[upstream_ifindex]</span>
        <span class="hljs-string">â””â”€</span> <span class="hljs-attr">TC_ACT_REDIRECT:</span> <span class="hljs-string">é‡å®šå‘åˆ°ä¸‹æ¸¸æ¥å£</span>
</code></pre>
<h4 data-id="heading-29">9.3 ç»Ÿè®¡æ”¶é›†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å®šæœŸè½®è¯¢ (é»˜è®¤ 500ms)</span>
maybeSchedulePollingStats() {
    handler.postDelayed(() -&gt; {
        updateForwardedStats();  <span class="hljs-comment">// ä» BPF æ˜ å°„è¯»å–ç»Ÿè®¡</span>
        maybeSchedulePollingStats();  <span class="hljs-comment">// é‡æ–°è°ƒåº¦</span>
    }, getPollingInterval());
}

updateForwardedStats() {
    SparseArray&lt;TetherStatsValue&gt; stats = 
        bpfCoordinatorShim.tetherOffloadGetStats();
    
    <span class="hljs-comment">// ç»Ÿè®¡å€¼ {</span>
    <span class="hljs-comment">//   long rxBytes;</span>
    <span class="hljs-comment">//   long rxPackets;</span>
    <span class="hljs-comment">//   long txBytes;</span>
    <span class="hljs-comment">//   long txPackets;</span>
    <span class="hljs-comment">// }</span>
    
    <span class="hljs-comment">// ä¸ NetworkStatsManager åŒæ­¥ï¼Œç”¨äº:</span>
    <span class="hljs-comment">// - åº”ç”¨æŸ¥è¯¢æ•°æ®ç”¨é‡</span>
    <span class="hljs-comment">// - æ£€æŸ¥æ•°æ®é™åˆ¶</span>
    <span class="hljs-comment">// - è§¦å‘è­¦æŠ¥</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-30">åã€å…³é”®æ•°æ®æµ</h3>
<h4 data-id="heading-31">10.1 å¯ç”¨å…±äº«çš„å®Œæ•´æµç¨‹</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. ç”¨æˆ·åœ¨ SystemUI å¯ç”¨ WiFi çƒ­ç‚¹
   â”‚
   â”œâ”€â–º HotspotControllerImpl<span class="hljs-selector-class">.setHotspotEnabled</span>(true)
   â”‚
   â”œâ”€â–º TetheringManager<span class="hljs-selector-class">.startTethering</span>(
   â”‚       TetheringRequest.Builder(TETHERING_WIFI)<span class="hljs-selector-class">.build</span>()
   â”‚   )
   â”‚
   â”œâ”€â–º TetheringService<span class="hljs-selector-class">.TetheringConnector</span><span class="hljs-selector-class">.startTethering</span>()
   â”‚
   â”œâ”€â–º Tethering<span class="hljs-selector-class">.startTethering</span>(request)
   â”‚
   â”œâ”€â–º Tethering<span class="hljs-selector-class">.enableTetheringInternal</span>(TETHERING_WIFI, true)
   â”‚
   â”œâ”€â–º <span class="hljs-built_in">setWifiTethering</span>(true)
   â”‚   â””â”€â–º WifiManager<span class="hljs-selector-class">.startTetheredHotspot</span>()
   â”‚       â””â”€ WiFi Framework å¯åŠ¨ SoftAPï¼Œå¹¿æ’­ IFACE_IP_MODE_TETHERED
   â”‚
   â”œâ”€ Tethering<span class="hljs-selector-class">.onInterfaceServingStateActive</span>(ifname, mode)
   â”‚
   â”œâ”€â–º Tethering<span class="hljs-selector-class">.enableIpServing</span>(type, ifname, STATE_TETHERED)
   â”‚
   â”œâ”€â–º IpServer<span class="hljs-selector-class">.enable</span>(STATE_TETHERED, request)
   â”‚   â””â”€ å‘é€ CMD_TETHER_REQUESTED
   â”‚
   â”œâ”€ IpServer çŠ¶æ€è½¬ç§»: InitialState â†’ TetheredState
   â”‚   (è¿›å…¥ TetheredState)
   â”‚
   â”œâ”€â–º BaseServingState.<span class="hljs-built_in">enter</span>()
   â”‚   â”œâ”€â–º <span class="hljs-built_in">startServingInterface</span>()
   â”‚   â”‚   â”œâ”€â–º <span class="hljs-built_in">startIPv4</span>()
   â”‚   â”‚   â”‚   â”œâ”€ è¯·æ±‚ IPv4 åœ°å€ (<span class="hljs-number">192.168</span>.<span class="hljs-number">43.1</span>/<span class="hljs-number">24</span>)
   â”‚   â”‚   â”‚   â”œâ”€ InterfaceController.<span class="hljs-built_in">setInterfaceConfiguration</span>()
   â”‚   â”‚   â”‚   â””â”€â–º <span class="hljs-built_in">startDhcp</span>()
   â”‚   â”‚   â”‚       â””â”€ DHCP æœåŠ¡å™¨å¯åŠ¨
   â”‚   â”‚   â”‚
   â”‚   â”‚   â”œâ”€â–º NetdUtils.<span class="hljs-built_in">tetherInterface</span>()
   â”‚   â”‚   â”‚   â””â”€â–º INetd.<span class="hljs-built_in">tetherInterfaceAdd</span>()
   â”‚   â”‚   â”‚       â””â”€â–º TetherController.<span class="hljs-built_in">tetherInterface</span>()
   â”‚   â”‚   â”‚
   â”‚   â”‚   â””â”€â–º <span class="hljs-built_in">startIPv6</span>()
   â”‚   â”‚       â”œâ”€ é…ç½® IPv6 ä¸ºè·¯ç”±å™¨æ¨¡å¼
   â”‚   â”‚       â””â”€ å¯åŠ¨ RA è¿›ç¨‹
   â”‚   â”‚
   â”‚   â”œâ”€â–º TetherMainSM.EVENT_IFACE_SERVING_STATE_ACTIVE
   â”‚   â”‚   (ä¸» SM é…ç½®è½¬å‘è§„åˆ™)
   â”‚   â”‚
   â”‚   â””â”€â–º <span class="hljs-built_in">setInterfaceState</span>(STATE_TETHERED)
   â”‚
   â””â”€ å…±äº«å·²å¯ç”¨ï¼

<span class="hljs-number">2</span>. ä¸‹æ¸¸å®¢æˆ·ç«¯è¿æ¥
   â”‚
   â”œâ”€ å®¢æˆ·ç«¯è¿æ¥åˆ° WiFi çƒ­ç‚¹
   â”œâ”€ DHCP æœåŠ¡å™¨åˆ†é… IP (<span class="hljs-number">192.168</span>.<span class="hljs-number">43</span>.x)
   â”œâ”€ IpServer.DhcpEventCallback.<span class="hljs-built_in">onLeasesChanged</span>()
   â””â”€ Tethering.<span class="hljs-built_in">dhcpLeasesChanged</span>() â†’ æ›´æ–°å®¢æˆ·ç«¯åˆ—è¡¨

<span class="hljs-number">3</span>. æ•°æ®è½¬å‘å¼€å§‹
   â”‚
   â”œâ”€ ä¸‹æ¸¸å®¢æˆ·ç«¯å‘é€æ•°æ®åŒ…
   â”œâ”€ Netfilter hooks è§¦å‘
   â”œâ”€ BPF ç¨‹åºæ£€æŸ¥è½¬å‘è§„åˆ™å’Œæ•°æ®é™åˆ¶
   â”œâ”€ å¦‚æœå¯ç”¨å¸è½½ï¼ŒBPF ç›´æ¥è½¬å‘å¹¶æ›´æ–°ç»Ÿè®¡
   â”œâ”€ å¦åˆ™ç”± iptables è§„åˆ™å¤„ç†
   â””â”€ ç»Ÿè®¡å®šæœŸé‡‡æ ·å¹¶ä¸ŠæŠ¥
</code></pre>
<h4 data-id="heading-32">10.2 ç¦ç”¨å…±äº«çš„å®Œæ•´æµç¨‹</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. ç”¨æˆ·åœ¨ SystemUI ç¦ç”¨ WiFi çƒ­ç‚¹
   â”‚
   â”œâ”€â–º HotspotControllerImpl<span class="hljs-selector-class">.setHotspotEnabled</span>(false)
   â”‚
   â”œâ”€â–º TetheringManager<span class="hljs-selector-class">.stopTethering</span>(TETHERING_WIFI)
   â”‚
   â”œâ”€â–º Tethering<span class="hljs-selector-class">.stopTethering</span>(TETHERING_WIFI)
   â”‚
   â”œâ”€â–º Tethering<span class="hljs-selector-class">.stopTetheringInternal</span>(TETHERING_WIFI)
   â”‚   â””â”€â–º <span class="hljs-built_in">enableTetheringInternal</span>(TETHERING_WIFI, false)
   â”‚
   â”œâ”€â–º <span class="hljs-built_in">setWifiTethering</span>(false)
   â”‚   â””â”€â–º WifiManager<span class="hljs-selector-class">.stopSoftAp</span>()
   â”‚       â””â”€ WiFi å¹¿æ’­ IFACE_IP_MODE_CONFIGURATION_ERROR
   â”‚
   â”œâ”€ Tethering<span class="hljs-selector-class">.onInterfaceServingStateInactive</span>()
   â”‚
   â”œâ”€â–º IpServer<span class="hljs-selector-class">.unwanted</span>()
   â”‚   â””â”€ å‘é€ CMD_TETHER_UNREQUESTED
   â”‚
   â”œâ”€ IpServer çŠ¶æ€è½¬ç§»: TetheredState â†’ InitialState
   â”‚   (ç¦»å¼€ BaseServingState)
   â”‚
   â”œâ”€â–º BaseServingState.<span class="hljs-built_in">exit</span>()
   â”‚   â”œâ”€â–º <span class="hljs-built_in">stopIPv6</span>()
   â”‚   â”‚   â””â”€ åœæ­¢ RA è¿›ç¨‹
   â”‚   â”‚
   â”‚   â”œâ”€â–º NetdUtils.<span class="hljs-built_in">untetherInterface</span>()
   â”‚   â”‚   â””â”€â–º INetd.<span class="hljs-built_in">tetherInterfaceRemove</span>()
   â”‚   â”‚       â””â”€â–º TetherController.<span class="hljs-built_in">untetherInterface</span>()
   â”‚   â”‚
   â”‚   â”œâ”€â–º <span class="hljs-built_in">stopIPv4</span>()
   â”‚   â”‚   â”œâ”€ åœæ­¢ DHCP æœåŠ¡
   â”‚   â”‚   â”œâ”€ æ¸…é™¤æ¥å£åœ°å€
   â”‚   â”‚   â”œâ”€ é‡Šæ”¾ IPv4 åœ°å€
   â”‚   â”‚   â””â”€ BpfCoordinator.<span class="hljs-built_in">tetherOffloadClientClear</span>()
   â”‚   â”‚
   â”‚   â””â”€ <span class="hljs-built_in">resetLinkProperties</span>()
   â”‚
   â””â”€ å…±äº«å·²ç¦ç”¨ï¼
</code></pre>
<hr/>
<h3 data-id="heading-33">åä¸€ã€æ ¸å¿ƒæ•°æ®ç»“æ„</h3>
<h4 data-id="heading-34">11.1 TetheringRequest</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Parcelable</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TetheringRequest</span> {
    <span class="hljs-type">int</span> tetheringType;              <span class="hljs-comment">// TETHERING_WIFI/USB/BLUETOOTH</span>
    <span class="hljs-type">boolean</span> showProvisioningUi;     <span class="hljs-comment">// æ˜¯å¦æ˜¾ç¤ºé…é¢æ£€æŸ¥ UI</span>
    <span class="hljs-type">boolean</span> exemptFromEntitlementCheck;  <span class="hljs-comment">// è±å…é…é¢æ£€æŸ¥</span>
    Inet4Address localIPv4Address;  <span class="hljs-comment">// æœ¬åœ° IPv4 åœ°å€ (å¯é€‰)</span>
    Inet4Address staticClientAddress;  <span class="hljs-comment">// é™æ€å®¢æˆ·ç«¯åœ°å€ (å¯é€‰)</span>
}
</code></pre>
<h4 data-id="heading-35">11.2 LinkProperties</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkProperties</span> {
    List&lt;LinkAddress&gt; mLinkAddresses;   <span class="hljs-comment">// IPv4/IPv6 åœ°å€</span>
    List&lt;RouteInfo&gt; mRoutes;            <span class="hljs-comment">// è·¯ç”±è§„åˆ™</span>
    Collection&lt;InetAddress&gt; mDnses;     <span class="hljs-comment">// DNS æœåŠ¡å™¨</span>
    String mDomains;                    <span class="hljs-comment">// DNS æœç´¢åŸŸ</span>
    List&lt;InetAddress&gt; mValidatedDnses;  <span class="hljs-comment">// å·²éªŒè¯çš„ DNS</span>
    Inet4Address mDhcpServerAddress;    <span class="hljs-comment">// DHCP æœåŠ¡å™¨åœ°å€</span>
    String mHttpProxy;                  <span class="hljs-comment">// HTTP ä»£ç†</span>
    String mPrivateDnsServerName;       <span class="hljs-comment">// ç§æœ‰ DNS</span>
}
</code></pre>
<h4 data-id="heading-36">11.3 TetheredClient</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TetheredClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Parcelable</span> {
    MacAddress mMacAddress;             <span class="hljs-comment">// å®¢æˆ·ç«¯ MAC åœ°å€</span>
    List&lt;AddressInfo&gt; mAddresses;       <span class="hljs-comment">// åˆ†é…çš„åœ°å€åˆ—è¡¨</span>
    <span class="hljs-type">int</span> mTetheringType;                 <span class="hljs-comment">// å…±äº«ç±»å‹</span>
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">AddressInfo</span> {
        LinkAddress mAddress;           <span class="hljs-comment">// IP åœ°å€ + å‰ç¼€é•¿åº¦</span>
        String mHostname;               <span class="hljs-comment">// DHCP æŠ¥å‘Šçš„ä¸»æœºå</span>
        <span class="hljs-type">long</span> <span class="hljs-title function_">getExpirationTime</span><span class="hljs-params">()</span>;       <span class="hljs-comment">// ç§Ÿçº¦è¿‡æœŸæ—¶é—´</span>
    }
}
</code></pre>
<h4 data-id="heading-37">11.4 UpstreamNetworkState</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UpstreamNetworkState</span> {
    Network network;
    NetworkCapabilities capabilities;
    LinkProperties linkProperties;
    <span class="hljs-comment">// ç”¨äºåˆ¤æ–­æ˜¯å¦é€‚åˆä½œä¸ºä¸Šæ¸¸</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCellular</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* æ£€æŸ¥ capability */</span> }
}
</code></pre>
<hr/>
<h3 data-id="heading-38">åäºŒã€æƒé™ä¸é…é¢æ£€æŸ¥</h3>
<h4 data-id="heading-39">12.1 æƒé™æ¨¡å‹</h4>
<pre><code class="hljs">Binder æƒé™ï¼ˆTethering APIï¼‰:
â”œâ”€ android.Manifest.permission.TETHER_PRIVILEGED
â”‚  â””â”€ ç³»ç»Ÿåº”ç”¨ï¼ˆSystemUIã€Settingsï¼‰
â”‚
â”œâ”€ android.Manifest.permission.WRITE_SETTINGS
â”‚  â””â”€ æ™®é€šåº”ç”¨ï¼ˆéœ€è¦ç”¨æˆ·æˆäºˆï¼‰
â”‚
â””â”€ android.Manifest.permission.NETWORK_SETTINGS
   â””â”€ ç³»ç»Ÿåº”ç”¨
</code></pre>
<h4 data-id="heading-40">12.2 é…é¢æœºåˆ¶</h4>
<pre><code class="hljs language-markdown" lang="markdown">EntitlementManager æ£€æŸ¥:

<span class="hljs-bullet">1.</span> è¿è¥å•†é…é¢æ£€æŸ¥
   â”œâ”€ è¯»å– CarrierConfig
   â”œâ”€ æ£€æŸ¥ KEY<span class="hljs-emphasis">_TETHER_</span>DUN<span class="hljs-emphasis">_REQUIRED_</span>BOOL (æ˜¯å¦éœ€è¦ DUN)
   â””â”€ æ£€æŸ¥ KEY<span class="hljs-emphasis">_CARRIER_</span>PROVISIONING<span class="hljs-emphasis">_* (è¿è¥å•†é…ç½®)

2. DUN (Dial-Up Network) ç½‘ç»œ
   â”œâ”€ æŸäº›è¿è¥å•†è¦æ±‚ tethering ä½¿ç”¨ DUN APN
   â”œâ”€ DUN ç½‘ç»œå•ç‹¬è®¡è´¹æˆ–æœ‰é™åˆ¶
   â””â”€ Tethering é€šè¿‡ ConnectivityManager è¯·æ±‚ DUN ç½‘ç»œ

3. æ•°æ®é™åˆ¶
   â”œâ”€ æ¯ä¸ªä¸Šæ¸¸æ¥å£å¯ä»¥è®¾ç½®æ•°æ®é™åˆ¶
   â”œâ”€ ç”± BpfCoordinator åœ¨å†…æ ¸çº§åˆ«æ£€æŸ¥
   â””â”€ è¶…é™æ—¶ä¸¢åŒ…å¹¶é€šçŸ¥åº”ç”¨
</span></code></pre>
<hr/>
<h3 data-id="heading-41">åä¸‰ã€é”™è¯¯å¤„ç†ä¸æ¢å¤</h3>
<h4 data-id="heading-42">13.1 IpServer é”™è¯¯ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_NO_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_UNKNOWN_IFACE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_UNKNOWN_TYPE</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_UNAVAIL_IFACE</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_INTERNAL_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_SERVICE_UNAVAIL</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_UNSUPPORTED</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_IFACE_CFG_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_TETHER_IFACE_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_UNTETHER_IFACE_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_DHCPSERVER_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
</code></pre>
<h4 data-id="heading-43">13.2 å‰ç¼€å†²çªå¤„ç†</h4>
<pre><code class="hljs language-objectivec" lang="objectivec">å½“æ£€æµ‹åˆ° IPv6 å‰ç¼€å†²çªæ—¶ï¼š

<span class="hljs-number">1.</span> IpServer æ”¶åˆ° <span class="hljs-built_in">CMD_NOTIFY_PREFIX_CONFLICT</span>
   â”‚
   â”œâ”€ è½¬ç§»åˆ° WaitingForRestartState
   â”‚
   â”œâ”€ è§¦å‘ mCallback.requestEnableTethering(type, <span class="hljs-literal">false</span>)
   â”‚   â””â”€ ç¦ç”¨å½“å‰å…±äº«
   â”‚
   â”œâ”€ æ¸…é™¤æ‰€æœ‰ç°æœ‰é…ç½®
   â”‚
   â””â”€ è¿”å› <span class="hljs-built_in">AVAILABLE</span> çŠ¶æ€

<span class="hljs-number">2.</span> ç¨åé‡æ–°å¯ç”¨æ—¶
   â”‚
   â”œâ”€ è¯·æ±‚æ–°çš„ IPv6 å‰ç¼€
   â”‚
   â”œâ”€ é‡æ–°é…ç½®æ¥å£
   â”‚
   â””â”€ æ¢å¤å…±äº«
</code></pre>
<hr/>
<h3 data-id="heading-44">åå››ã€ç›‘æ§ä¸è°ƒè¯•</h3>
<h4 data-id="heading-45">14.1 Dumpsys è¾“å‡º</h4>
<pre><code class="hljs language-bash" lang="bash">adb shell dumpsys connectivity | grep -A 100 <span class="hljs-string">"Tethering"</span>
</code></pre>
<p>è¾“å‡ºåŒ…æ‹¬ï¼š</p>
<ul>
<li>å½“å‰ tethering çŠ¶æ€</li>
<li>æ´»è·ƒçš„ä¸‹æ¸¸æ¥å£åŠå…¶çŠ¶æ€</li>
<li>è½¬å‘ç»Ÿè®¡</li>
<li>BPF è½¬å‘è§„åˆ™</li>
<li>iptables è§„åˆ™</li>
</ul>
<h4 data-id="heading-46">14.2 æ—¥å¿—æ”¶é›†</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ Tethering æ—¥å¿—</span>
adb logcat -s Tethering IpServer TetherController UpstreamNetworkMonitor

<span class="hljs-comment"># æŸ¥çœ‹ DHCP æ—¥å¿—</span>
adb logcat -s dnsmasq dhcpserver

<span class="hljs-comment"># æŸ¥çœ‹ netd æ—¥å¿—</span>
adb logcat -s netd
</code></pre>
<hr/>
<h3 data-id="heading-47">åäº”ã€æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹</h3>
<ol>
<li>
<p><strong>BPF å¸è½½åŠ é€Ÿ</strong>ï¼š</p>
<ul>
<li>å‡è½»å†…æ ¸è½¬å‘è´Ÿæ‹…</li>
<li>é™ä½ CPU ä½¿ç”¨ç‡</li>
<li>æé«˜ååé‡ï¼ˆå¯è¾¾ Gbps çº§åˆ«ï¼‰</li>
</ul>
</li>
<li>
<p><strong>TCP MSS é’³åˆ¶</strong>ï¼š</p>
<ul>
<li>iptables mangle è¡¨è®¾ç½® TCPMSS</li>
<li>é˜²æ­¢å¤§åŒ…è¢«åˆ†ç‰‡</li>
</ul>
</li>
<li>
<p><strong>Conntrack ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>é…ç½® nf_conntrack å‚æ•°</li>
<li>å¢åŠ è¿æ¥è·Ÿè¸ªç¼“å†²åŒº</li>
</ul>
</li>
<li>
<p><strong>DNS ç¼“å­˜</strong>ï¼š</p>
<ul>
<li>dnsmasq ç¼“å­˜ DNS å“åº”</li>
<li>å‡å°‘ä¸Šæ¸¸ DNS æŸ¥è¯¢</li>
</ul>
</li>
<li>
<p><strong>ç»Ÿè®¡é‡‡æ ·é—´éš”</strong>ï¼š</p>
<ul>
<li>å¹³è¡¡ç²¾åº¦å’Œ CPU å¼€é”€</li>
<li>é»˜è®¤ 500ms</li>
</ul>
</li>
</ol>
<hr/>
<p>è¿™ä¸ªå®Œæ•´çš„åˆ†ææ¶µç›–äº† Android å…±äº«è¿æ¥ç®¡ç†ç³»ç»Ÿçš„å„ä¸ªæ–¹é¢ï¼Œä»ç”¨æˆ·è§¦å‘åˆ°å†…æ ¸è½¬å‘ï¼ŒåŒ…æ‹¬æ‰€æœ‰å…³é”®ç»„ä»¶å’Œæ•°æ®æµã€‚è¿™æ˜¯é¢è¯•æ—¶çš„æ ¸å¿ƒçŸ¥è¯†ä½“ç³»ã€‚</p>
<p>å®Œç¾ï¼æˆ‘å·²ç»å®Œæˆäº†å¯¹ Android å…±äº«è¿æ¥ç®¡ç†ç³»ç»Ÿçš„æ·±åº¦åˆ†æã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å…¨é¢çš„æ€»ç»“ï¼Œæ¶µç›–äº†ï¼š</p>
<h2 data-id="heading-48">ğŸ“‹ åˆ†æå†…å®¹æ€»è§ˆ</h2>
<p>âœ… <strong>15 ä¸ªé‡ç‚¹ä¸»é¢˜</strong>ï¼š</p>
<ol>
<li><strong>ç³»ç»Ÿæ•´ä½“æ¶æ„</strong> - 4å±‚æ¨¡å‹ï¼ˆåº”ç”¨å±‚ã€Frameworkã€ç³»ç»ŸæœåŠ¡ã€å†…æ ¸å±‚ï¼‰</li>
<li><strong>TetheringManager &amp; TetheringService</strong> - ç”¨æˆ·å…¥å£ API</li>
<li><strong>Tethering ä¸»çŠ¶æ€æœº</strong> - æ ¸å¿ƒçš„æ¥å£ç”Ÿå‘½å‘¨æœŸç®¡ç†</li>
<li><strong>IpServer ä¸‹æ¸¸æ¥å£çŠ¶æ€æœº</strong> - 5ä¸ªçŠ¶æ€ã€è½¬ç§»å›¾ã€çŠ¶æ€å¤„ç†</li>
<li><strong>IPv4 é…ç½®æµç¨‹</strong> - åœ°å€åˆ†é…ã€DHCP å¯åŠ¨ã€å®¢æˆ·ç«¯ç®¡ç†</li>
<li><strong>IPv6 é…ç½®ä¸ RA</strong> - Router Advertisementã€NAT64</li>
<li><strong>ä¸Šæ¸¸ç½‘ç»œé€‰æ‹©</strong> - UpstreamNetworkMonitorã€DUN åè®®ã€ä¼˜å…ˆçº§</li>
<li><strong>NAT ä¸ IP è½¬å‘</strong> - TetherControllerã€iptables è§„åˆ™ã€MASQUERADE</li>
<li><strong>DHCP ä¸ DNS è½¬å‘</strong> - dnsmasq é›†æˆã€åŠ¨æ€é…ç½®ã€DNS æŸ¥è¯¢æµç¨‹</li>
<li><strong>5 ç§ä¸‹æ¸¸ç±»å‹å¤„ç†</strong> - WiFiã€USBã€Bluetoothã€Ethernetã€å„è‡ªç‰¹ç‚¹</li>
<li><strong>BPF å¸è½½åŠ é€Ÿ</strong> - BpfCoordinatorã€å†…æ ¸è½¬å‘ä¼˜åŒ–ã€ç»Ÿè®¡æ”¶é›†</li>
<li><strong>å®Œæ•´æ•°æ®æµ</strong> - å¯ç”¨/ç¦ç”¨çš„å…¨æµç¨‹è¯¦è§£</li>
<li><strong>æ ¸å¿ƒæ•°æ®ç»“æ„</strong> - TetheringRequestã€LinkPropertiesã€TetheredClient</li>
<li><strong>æƒé™ä¸é…é¢</strong> - Binder æƒé™æ¨¡å‹ã€è¿è¥å•†é…é¢ã€DUN ç½‘ç»œ</li>
<li><strong>ç›‘æ§ã€è°ƒè¯•ã€æ€§èƒ½ä¼˜åŒ–</strong> - dumpsysã€æ—¥å¿—ã€å…³é”®ä¼˜åŒ–ç‚¹</li>
</ol>
<h2 data-id="heading-49">ğŸ¯ é€‚ç”¨äºé¢è¯•çš„æ ¸å¿ƒè¦ç‚¹</h2>
<p>è¿™ä»½åˆ†ææ¶µç›–äº†æ‰€æœ‰å¯èƒ½å‡ºç°çš„é¢è¯•é—®é¢˜ï¼š</p>
<ul>
<li><strong>æ¶æ„ç›¸å…³</strong>ï¼šç³»ç»Ÿå¦‚ä½•è®¾è®¡ã€å„å±‚èŒè´£</li>
<li><strong>çŠ¶æ€æœº</strong>ï¼šIpServer çš„ 5 ä¸ªçŠ¶æ€åŠè½¬ç§»</li>
<li><strong>ç½‘ç»œé…ç½®</strong>ï¼šIPv4/IPv6 åœ°å€åˆ†é…ã€DHCP/DNS</li>
<li><strong>æ•°æ®è½¬å‘</strong>ï¼šiptables è§„åˆ™ã€NATã€BPF åŠ é€Ÿ</li>
<li><strong>æ•…éšœå¤„ç†</strong>ï¼šé”™è¯¯ä»£ç ã€å‰ç¼€å†²çªå¤„ç†</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šBPF å¸è½½ã€TCP MSSã€Conntrack</li>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šå„ç±»å‹æ¥å£çš„ç‰¹æ®Šå¤„ç†</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[16 ä¸ª AI Agent åä½œä»é›¶å†™å‡º C ç¼–è¯‘å™¨ï¼Œè¿˜èƒ½ç¼–è¯‘ Linux å†…æ ¸â€”â€”Claude 4.6 åšåˆ°äº†]]></title>    <link>https://juejin.cn/post/7603376587653169202</link>    <guid>https://juejin.cn/post/7603376587653169202</guid>    <pubDate>2026-02-07T01:16:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603376587653169202" data-draft-id="7603584155785166898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="16 ä¸ª AI Agent åä½œä»é›¶å†™å‡º C ç¼–è¯‘å™¨ï¼Œè¿˜èƒ½ç¼–è¯‘ Linux å†…æ ¸â€”â€”Claude 4.6 åšåˆ°äº†"/> <meta itemprop="keywords" content="Agent,Claude,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-07T01:16:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­Ÿå¥AIç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            16 ä¸ª AI Agent åä½œä»é›¶å†™å‡º C ç¼–è¯‘å™¨ï¼Œè¿˜èƒ½ç¼–è¯‘ Linux å†…æ ¸â€”â€”Claude 4.6 åšåˆ°äº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­Ÿå¥AIç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:16:15.000Z" title="Sat Feb 07 2026 01:16:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å­Ÿå¥ã€‚</p>
<p>16 ä¸ª AIï¼Œ2 å‘¨æ—¶é—´ï¼Œ10 ä¸‡è¡Œä»£ç ï¼Œä»é›¶å†™å‡ºäº†ä¸€ä¸ªèƒ½ç¼–è¯‘ Linux å†…æ ¸çš„ C ç¼–è¯‘å™¨ã€‚</p>
<p>ä¸æ˜¯äººå†™çš„ã€‚æ˜¯ Claude è‡ªå·±å†™çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/477226ae6e714f66a85410714e5c4119~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771031774&amp;x-signature=JauUVTPXxMDzd06zNHvBRuNyGAo%3D" alt="" loading="lazy"/></p>
<hr/>
<p>æ˜¨å¤© Anthropic å‘äº†ä¸€ç¯‡åšå®¢ï¼Œæ ‡é¢˜å¾ˆæœ´ç´ â€”â€”"We tasked Opus 4.6 using agent teams to build a C Compiler"ã€‚</p>
<p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š<strong>æˆ‘ä»¬è®©ä¸€ç¾¤ Claude è‡ªå·±å»å†™äº†ä¸ª C ç¼–è¯‘å™¨ï¼Œç„¶åæˆ‘ä»¬èµ°å¼€äº†ã€‚</strong></p>
<p>è¯»å®Œè¿™ç¯‡åšå®¢ï¼Œæˆ‘æ•´ä¸ªäººæ˜¯æ‡µçš„ã€‚ä¸æ˜¯å› ä¸º"AI åˆè¿›æ­¥äº†"è¿™ç§ç©ºè¯ï¼Œè€Œæ˜¯å› ä¸ºè¿™ä»¶äº‹èƒŒåçš„å«ä¹‰ï¼Œå¯èƒ½æ¯”å¤§å¤šæ•°äººæƒ³åˆ°çš„è¦æ·±å¾—å¤šã€‚</p>
<h2 data-id="heading-0">01 åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h2>
<p>Anthropic çš„ç ”ç©¶å‘˜ Nicholas Carlini åšäº†ä¸ªå®éªŒï¼š</p>
<p><strong>16 ä¸ª Claude Opus 4.6 å®ä¾‹ï¼ŒåŒæ—¶å·¥ä½œï¼Œç”¨ Rust ä»é›¶å¼€å§‹å†™ä¸€ä¸ª C ç¼–è¯‘å™¨ã€‚</strong></p>
<p>æ²¡æœ‰äººæ‰‹æŠŠæ‰‹å¸¦ã€‚æ²¡æœ‰äººé€è¡Œ reviewã€‚æ²¡æœ‰æ¶æ„å¸ˆç”»è®¾è®¡å›¾ã€‚</p>
<p>Carlini åªåšäº†ä¸€ä»¶äº‹ï¼šæ­å¥½ Docker å®¹å™¨ã€Git ä»“åº“ã€æµ‹è¯•å¥—ä»¶ï¼Œç„¶åæŒ‰ä¸‹å¯åŠ¨é”®ï¼Œèµ°å¼€äº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/672577c3ba974ed2b506d444b95b5002~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771031774&amp;x-signature=E2EiWn24mhPfsNX29hGMif7S4TA%3D" alt="" loading="lazy"/></p>
<p>ä¸¤å‘¨åå›æ¥ï¼Œè¿™äº› AI Agent äº¤å‡ºäº†æˆæœï¼š</p>
<ul>
<li>
<p>ğŸ“¦ <strong>10 ä¸‡è¡Œ Rust ä»£ç </strong></p>
</li>
<li>
<p>âœ… GCC torture test é€šè¿‡ç‡ <strong>99%</strong></p>
</li>
<li>
<p>ğŸ§ èƒ½ç¼–è¯‘ <strong>Linux 6.9 å†…æ ¸</strong>ï¼ˆx86ã€ARMã€RISC-V ä¸‰ä¸ªæ¶æ„ï¼‰</p>
</li>
<li>
<p>ğŸ® èƒ½ç¼–è¯‘ <strong>Doomã€ PostgreSQL ã€Redisã€FFmpegã€ SQLite ã€QEMU</strong></p>
</li>
<li>
<p>ğŸ’° æ€»èŠ±è´¹ï¼š<strong>$20,000</strong>ï¼ˆçº¦ 14 ä¸‡äººæ°‘å¸ï¼‰</p>
</li>
<li>
<p>â±ï¸ æ€»è€—æ—¶ï¼š<strong>2 å‘¨</strong>ï¼Œè¿‘ 2000 ä¸ª Claude Code session</p>
</li>
</ul>
<p>ä¸€ä¸ªåœ¨ Google èŠ±äº†è¿‘åå¹´æ‰æå®šçš„äº‹æƒ…ï¼ˆè®© Clang ç¼–è¯‘ Linux å†…æ ¸ï¼‰ï¼ŒAI ç”¨ä¸¤å‘¨åšåˆ°äº†ã€‚ä¸€ä½ HN ç½‘å‹çš„åŸè¯æ˜¯ï¼š"This LLM did it in ï¼ˆchecks notesï¼‰... 2,000 sessions."</p>
<h2 data-id="heading-1">02 å®ƒä»¬æ˜¯æ€ä¹ˆåä½œçš„ï¼Ÿ</h2>
<p>è¿™æ˜¯æœ€è®©æˆ‘éœ‡æ’¼çš„éƒ¨åˆ†â€”â€”<strong>æ²¡æœ‰"è€æ¿ Agent"ã€‚</strong></p>
<p>16 ä¸ª Claude å„è‡ªç‹¬ç«‹è¿è¡Œåœ¨ Docker å®¹å™¨é‡Œï¼Œå…±äº«ä¸€ä¸ª Git ä»“åº“ã€‚æ¯ä¸ª Agent çš„å·¥ä½œæµç¨‹æ˜¯ï¼š</p>
<ol>
<li>
<p>ä»ä»“åº“æ‹‰ä»£ç </p>
</li>
<li>
<p>è‡ªå·±æ‰¾"ä¸‹ä¸€ä¸ªæœ€æ˜æ˜¾è¦ä¿®çš„é—®é¢˜"</p>
</li>
<li>
<p>åˆ›å»º lock æ–‡ä»¶å å‘</p>
</li>
<li>
<p>å†™ä»£ç ã€è·‘æµ‹è¯•</p>
</li>
<li>
<p>æ¨ä»£ç å›ä¸»å¹²</p>
</li>
<li>
<p>é‡åˆ° merge å†²çªï¼Ÿè‡ªå·±è§£å†³</p>
</li>
</ol>
<p>æœ‰çš„ Agent ä¸“é—¨æ¸…ç†é‡å¤ä»£ç ï¼Œæœ‰çš„ä¸“æ³¨ä¼˜åŒ–æ€§èƒ½ï¼Œæœ‰çš„åƒ Rust ä¸“å®¶ä¸€æ ·åš code reviewï¼Œè¿˜æœ‰çš„è´Ÿè´£æ›´æ–°æ–‡æ¡£ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e34c2d9dc670473bb7fc63fd1255c7f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771031774&amp;x-signature=abYVM0YOEercfaEn6wmJ%2FLiyxNg%3D" alt="" loading="lazy"/></p>
<p><strong>æ²¡æœ‰äººåˆ†é…ä»»åŠ¡ï¼Œæ²¡æœ‰ project manager ï¼Œæ²¡æœ‰ Jiraã€‚</strong></p>
<p>å®ƒä»¬è‡ªå·±å½¢æˆäº†åˆ†å·¥ã€‚</p>
<p>å¦‚æœä½ åšè¿‡å›¢é˜Ÿç®¡ç†ï¼Œä½ åº”è¯¥èƒ½æ„Ÿå—åˆ°è¿™æœ‰å¤šç¦»è°±â€”â€”16 ä¸ª"äºº"åä½œä¸¤å‘¨ï¼Œæ²¡æœ‰ä¸€æ¬¡ standup ä¼šè®®ï¼Œæ²¡æœ‰ä¸€ä¸ªéœ€æ±‚æ–‡æ¡£ï¼Œäº§å‡º 10 ä¸‡è¡Œèƒ½è·‘çš„ä»£ç ã€‚</p>
<h2 data-id="heading-2">03 å®ƒçš„å±€é™åœ¨å“ªï¼Ÿ</h2>
<p>å…ˆåˆ«æ€¥ç€ææ…Œã€‚è¿™ä¸ªç¼–è¯‘å™¨å‰å®³ï¼Œä½†ä¸æ˜¯å®Œç¾çš„ï¼š</p>
<p><strong>1ï¼‰ç”Ÿæˆçš„ä»£ç æ•ˆç‡å¾ˆä½ã€‚</strong> å³ä½¿å¼€äº†æ‰€æœ‰ä¼˜åŒ–ï¼Œè¾“å‡ºçš„æœºå™¨ç è¿˜ä¸å¦‚ GCC å…³æ‰ä¼˜åŒ–çš„æ•ˆæœã€‚æ¢å¥è¯è¯´â€”â€”èƒ½ç”¨ï¼Œä½†æ€§èƒ½æ‹‰èƒ¯ã€‚</p>
<p><strong>2ï¼‰16 ä½ x86 ä¸è¡Œã€‚</strong> Linux å†…æ ¸å¯åŠ¨éœ€è¦ 16 ä½å®æ¨¡å¼ä»£ç ï¼ŒClaude æä¸å®šè¿™å—ï¼Œæœ€å"ä½œå¼Š"è°ƒç”¨äº† GCC æ¥å¤„ç†ã€‚</p>
<p><strong>3ï¼‰æ²¡æœ‰è‡ªå·±çš„ æ±‡ç¼–å™¨ å’Œé“¾æ¥å™¨ã€‚</strong> è¿˜æ˜¯ä¾èµ– GNU çš„å·¥å…·é“¾ã€‚</p>
<p><strong>4ï¼‰ä»£ç è´¨é‡"å¤Ÿç”¨ä½†ä¸ç²¾"ã€‚</strong> Carlini åŸè¯ï¼š"The resulting compiler has nearly reached the limits of Opus's abilitiesã€‚"â€”â€”å·²ç»æ¥è¿‘è¿™ä¸ªæ¨¡å‹èƒ½åŠ›çš„å¤©èŠ±æ¿äº†ã€‚</p>
<p>è¿™äº›å±€é™å¾ˆé‡è¦ï¼Œä½†ä¸å½±å“æ ¸å¿ƒç»“è®ºï¼š<strong>AI å·²ç»èƒ½ç‹¬ç«‹å®Œæˆä¸€ä¸ªæå…¶å¤æ‚çš„ç³»ç»Ÿçº§è½¯ä»¶é¡¹ç›®ã€‚</strong></p>
<h2 data-id="heading-3">04 ä¸ºä»€ä¹ˆè¿™äº‹æ¯”ä½ æƒ³çš„æ›´é‡è¦ï¼Ÿ</h2>
<p>æœ‰äººä¼šè¯´ï¼š"ç¼–è¯‘å™¨è§„èŒƒå¾ˆæˆç†Ÿï¼Œæµ‹è¯•å¥—ä»¶å¾ˆå®Œæ•´ï¼Œè¿™æ˜¯ AI æ“…é•¿çš„ç±»å‹å•Šã€‚"</p>
<p>æ²¡é”™ã€‚Ars Technica çš„æŠ¥é“ä¹ŸæŒ‡å‡ºâ€”â€”C ç¼–è¯‘å™¨æ˜¯"near-ideal task for semi-autonomous AI coding"ï¼Œå› ä¸ºè§„èŒƒæ¸…æ™°ã€æµ‹è¯•å¥—ä»¶ç°æˆã€æœ‰å‚è€ƒå®ç°å¯ä»¥å¯¹ç…§ã€‚</p>
<p>ä½†é—®é¢˜æ˜¯ï¼š<strong>å»å¹´ AI è¿˜åšä¸åˆ°è¿™ä»¶äº‹ã€‚</strong></p>
<p>Carlini è‡ªå·±è¯´äº†ä¸€å¥è®©æˆ‘å°è±¡å¾ˆæ·±çš„è¯ï¼š</p>
<blockquote>
<p>"I did not expect this to be anywhere near possible so early in 2026."</p>
</blockquote>
<p>ä»–æ²¡æœ‰é¢„æ–™åˆ° 2026 å¹´åˆå°±èƒ½èµ°åˆ°è¿™ä¸€æ­¥ã€‚</p>
<p>è¿›æ­¥çš„é€Ÿåº¦æ‰æ˜¯æœ€å€¼å¾—å…³æ³¨çš„ä¿¡å·ã€‚</p>
<p>è€Œä¸”è¿™æ¬¡å®éªŒçœŸæ­£éªŒè¯çš„ä¸æ˜¯"AI èƒ½å†™ä»£ç "â€”â€”è¿™ä¸ªæˆ‘ä»¬æ—©å°±çŸ¥é“äº†ã€‚<strong>å®ƒéªŒè¯çš„æ˜¯ï¼šå¤šä¸ª AI Agent å¯ä»¥åƒä¸€ä¸ªå›¢é˜Ÿä¸€æ ·åä½œï¼Œå®Œæˆéœ€è¦æ¶æ„è®¾è®¡ã€æ¨¡å—åˆ†å·¥ã€å†²çªè§£å†³çš„å¤§å‹å·¥ç¨‹ã€‚</strong></p>
<p>ä¸€ä¸ª Agent å†™å‡½æ•°ï¼Œå¤§å®¶éƒ½è§è¿‡ã€‚16 ä¸ª Agent åä½œå†™ç¼–è¯‘å™¨ï¼Œè¿™æ˜¯è´¨å˜ã€‚</p>
<h2 data-id="heading-4">05 å¯¹æˆ‘ä»¬æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</h2>
<p><strong>å¦‚æœä½ æ˜¯ç¨‹åºå‘˜â€”â€”</strong></p>
<p>è¿™ä¸æ˜¯"AI è¦å–ä»£ä½ "çš„æ•…äº‹ã€‚ç¼–è¯‘å™¨æ˜¯æœ€é€‚åˆ AI åšçš„ä»»åŠ¡ç±»å‹ï¼šè§„èŒƒç¡®å®šã€æµ‹è¯•å®Œå–„ã€æœ‰å‚è€ƒå®ç°ã€‚å¤§éƒ¨åˆ†çœŸå®é¡¹ç›®ä¸å…·å¤‡è¿™äº›æ¡ä»¶ã€‚çœŸå®çš„è½¯ä»¶å¼€å‘éš¾çš„ä¸æ˜¯å†™ä»£ç ï¼Œæ˜¯ææ¸…æ¥šéœ€æ±‚åˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p>
<p>ä½†ä½ åº”è¯¥å¼€å§‹è®¤çœŸå­¦ä¹ å¦‚ä½•<strong>ç®¡ç† AI Agent å›¢é˜Ÿ</strong>äº†ã€‚æœªæ¥çš„ç¼–ç¨‹å¯èƒ½ä¸æ˜¯"ä½ å†™ä»£ç "ï¼Œè€Œæ˜¯"ä½ å®šä¹‰ç›®æ ‡ã€å‡†å¤‡æµ‹è¯•ã€è®© Agent å¹²æ´»ã€ä½ åš review"ã€‚</p>
<p><strong>å¦‚æœä½ æ˜¯åˆ›ä¸šè€…â€”â€”</strong></p>
<p>$20,000 å†™ 10 ä¸‡è¡Œç¼–è¯‘å™¨çº§ä»£ç ã€‚è¿™ä¸ªæˆæœ¬è¿˜åœ¨å¿«é€Ÿä¸‹é™ã€‚æƒ³æƒ³åŠå¹´åã€ä¸€å¹´åä¼šæ˜¯ä»€ä¹ˆä»·æ ¼ã€‚ç‹¬ç«‹å¼€å‘è€…åšå¤æ‚é¡¹ç›®çš„é—¨æ§›æ­£åœ¨è¢«å½»åº•é‡æ–°å®šä¹‰ã€‚</p>
<p><strong>å¦‚æœä½ æ˜¯æŠ€æœ¯ç®¡ç†è€…â€”â€”</strong></p>
<p>å¤š Agent åä½œçš„èŒƒå¼å·²ç»è¢«éªŒè¯äº†ã€‚ä¸æ˜¯ PPT é‡Œçš„æ¦‚å¿µï¼Œæ˜¯èƒ½ç¼–è¯‘ Linux å†…æ ¸çš„çœŸå®äº§å‡ºã€‚ä½ éœ€è¦å¼€å§‹æ€è€ƒï¼šå›¢é˜Ÿé‡Œå“ªäº›å·¥ä½œå¯ä»¥ç”¨ Agent å›¢é˜Ÿæ¥åšï¼Ÿ</p>
<hr/>
<p>Carlini åœ¨åšå®¢ç»“å°¾è¯´äº†ä¸€æ®µå¾ˆçœŸè¯šçš„è¯ã€‚ä»–è¯´è‡ªå·±åšè¿‡æ¸—é€æµ‹è¯•ï¼Œæ·±çŸ¥æ²¡æœ‰äººå·¥éªŒè¯çš„ä»£ç æœ‰å¤šå±é™©ã€‚é¢å¯¹ 10 ä¸‡è¡Œä»æœªäº²çœ¼çœ‹è¿‡çš„ä»£ç ï¼Œä»–æ—¢å…´å¥‹åˆä¸å®‰ã€‚</p>
<p>è¿™å¤§æ¦‚å°±æ˜¯ 2026 å¹´åšæŠ€æœ¯çš„äººå…±åŒçš„å¿ƒæƒ…ã€‚</p>
<p><strong>å…´å¥‹çš„æ˜¯ï¼Œå·¥å…·å°±æ‘†åœ¨é‚£é‡Œï¼Œæ¯”æƒ³è±¡ä¸­å¼ºå¤ªå¤šã€‚ä¸å®‰çš„æ˜¯ï¼Œæˆ‘ä»¬è¿˜ä¸å®Œå…¨çŸ¥é“è¯¥æ€ä¹ˆç”¨å¥½å®ƒã€‚</strong></p>
<p>ä½†æœ‰ä¸€ä»¶äº‹æ˜¯ç¡®å®šçš„â€”â€”AI ç¼–ç¨‹çš„èŒƒå¼å·²ç»ä»"ä¸€ä¸ªäºº+ä¸€ä¸ª Copilot"ï¼Œè¿›åŒ–åˆ°äº†"ä¸€ä¸ªäºº+ä¸€æ”¯ AI å›¢é˜Ÿ"ã€‚</p>
<p>è¿™ä¸æ˜¯æœªæ¥ã€‚è¿™æ˜¯æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚</p>
<hr/>
<p>ğŸ”— <strong>ç›¸å…³é“¾æ¥ï¼š</strong></p>
<ul>
<li>
<p>Anthropic åšå®¢åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fbuilding-c-compiler" target="_blank" title="https://www.anthropic.com/engineering/building-c-compiler" ref="nofollow noopener noreferrer">www.anthropic.com/engineeringâ€¦</a></p>
</li>
<li>
<p>ç¼–è¯‘å™¨ GitHub æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaudes-c-compiler" target="_blank" title="https://github.com/anthropics/claudes-c-compiler" ref="nofollow noopener noreferrer">github.com/anthropics/â€¦</a></p>
</li>
<li>
<p>Hacker News è®¨è®ºï¼ˆ400+è¯„è®ºï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D46903616" target="_blank" title="https://news.ycombinator.com/item?id=46903616" ref="nofollow noopener noreferrer">news.ycombinator.com/item?id=469â€¦</a></p>
</li>
</ul>
<hr/>
<p>å¦‚æœè¿™ç¯‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼Œä½ çš„æ”¯æŒæ˜¯æˆ‘æŒç»­è¾“å‡ºçš„åŠ¨åŠ› âœ¨</p>
<hr/>
<p>æˆ‘çš„å…¶ä»–å¹³å°è´¦å·å’Œå¼€æºé¡¹ç›®åœ¨ä¸ªäººä¸»é¡µä¸­ï¼Œæ¬¢è¿äº¤æµ ğŸ¤</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•ä¸ºä¸åŒç±»å‹ä¸è§„æ¨¡çš„é¡¹ç›®é€‰æ‹©æµ‹è¯•æ¡†æ¶]]></title>    <link>https://juejin.cn/post/7603575763786940442</link>    <guid>https://juejin.cn/post/7603575763786940442</guid>    <pubDate>2026-02-07T01:28:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575763786940442" data-draft-id="7603376587653218354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•ä¸ºä¸åŒç±»å‹ä¸è§„æ¨¡çš„é¡¹ç›®é€‰æ‹©æµ‹è¯•æ¡†æ¶"/> <meta itemprop="keywords" content="æµ‹è¯•"/> <meta itemprop="datePublished" content="2026-02-07T01:28:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•ä¸ºä¸åŒç±»å‹ä¸è§„æ¨¡çš„é¡¹ç›®é€‰æ‹©æµ‹è¯•æ¡†æ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:28:41.000Z" title="Sat Feb 07 2026 01:28:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ç°ä»£è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œâ€œ<strong>æµ‹è¯•</strong>â€å·²ä¸å†æ˜¯é¡¹ç›®æ”¶å°¾é˜¶æ®µçš„è¡¥å……æ­¥éª¤ï¼Œè€Œæ˜¯è´¯ç©¿æ•´ä¸ªå¼€å‘ç”Ÿå‘½å‘¨æœŸçš„æ ¸å¿ƒç¯èŠ‚ã€‚<br/>
é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æµ‹è¯•æ¡†æ¶ï¼Œèƒ½å†³å®šå›¢é˜Ÿåœ¨ <strong>ä»£ç è´¨é‡ã€äº¤ä»˜æ•ˆç‡ã€æŒç»­é›†æˆèƒ½åŠ›</strong> ç­‰æ–¹é¢çš„ä¸Šé™ã€‚</p>
<p>ä½†é¢å¯¹ä¸°å¯Œçš„æµ‹è¯•ç”Ÿæ€ï¼ˆå¦‚ Jestã€Vitestã€Cypressã€Playwrightã€JUnitã€Pytest ç­‰ï¼‰ï¼Œå¼€å‘è€…å¸¸å¸¸é™·å…¥é€‰æ‹©å›°éš¾ï¼š</p>
<blockquote>
<p>å“ªä¸ªæ¡†æ¶é€‚åˆå•å…ƒæµ‹è¯•ï¼Ÿå“ªä¸ªæ›´é€‚åˆç«¯åˆ°ç«¯æµ‹è¯•ï¼Ÿå°å‹é¡¹ç›®è¯¥ä¸è¯¥ä¸Š CIï¼Ÿ</p>
</blockquote>
<p>æœ¬æ–‡å°†ä» <strong>é¡¹ç›®è§„æ¨¡ã€è¯­è¨€æ ˆå’Œæµ‹è¯•ç›®æ ‡</strong> ä¸‰ä¸ªç»´åº¦å‡ºå‘ï¼Œå¸¦ä½ æ¢³ç†ä¸€å¥—ç§‘å­¦çš„æµ‹è¯•æ¡†æ¶é€‰å‹ç­–ç•¥ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€é—®é¢˜å®šä¹‰ï¼šæµ‹è¯•ç³»ç»Ÿçš„ä¸‰å±‚ç»“æ„</h2>
<p>æ— è®ºé¡¹ç›®è§„æ¨¡å¦‚ä½•ï¼Œæµ‹è¯•ç³»ç»Ÿé€šå¸¸åˆ†ä¸ºä¸‰å±‚ï¼š</p>





























<table><thead><tr><th>å±‚çº§</th><th>ç›®æ ‡</th><th>å…¸å‹å·¥å…·</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å•å…ƒæµ‹è¯• (Unit Test)</td><td>éªŒè¯å‡½æ•°/ç±»çš„é€»è¾‘æ­£ç¡®æ€§</td><td>Jest, Vitest, JUnit, Pytest</td><td>è‡ªåŠ¨å¿«é€Ÿï¼Œç²’åº¦å°</td></tr><tr><td>é›†æˆæµ‹è¯• (Integration Test)</td><td>éªŒè¯æ¨¡å—é—´äº¤äº’</td><td>Supertest, Mocha, Postman/Newman</td><td>æ¨¡æ‹Ÿæ¥å£ã€ä¾èµ–æ³¨å…¥</td></tr><tr><td>ç«¯åˆ°ç«¯æµ‹è¯• (E2E Test)</td><td>æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œ</td><td>Cypress, Playwright, Selenium</td><td>DevOps é˜¶æ®µç”¨äºå…¨é“¾è·¯æµ‹è¯•</td></tr></tbody></table>
<p>åœ¨é€‰æ‹©æ¡†æ¶æ—¶ï¼Œåº”é¦–å…ˆæ˜ç¡®ä½ è¦æµ‹è¯•çš„ç²’åº¦ä¸ç›®æ ‡ã€‚</p>
<hr/>
<h2 data-id="heading-2">äºŒã€ä¸åŒè§„æ¨¡é¡¹ç›®çš„æµ‹è¯•æ¡†æ¶æ¨è</h2>
<h3 data-id="heading-3">1ï¸âƒ£ å°å‹é¡¹ç›®ï¼šè½»é‡å¿«é€Ÿï¼Œé›†æˆæœ€å°‘ä¾èµ–</h3>
<p><strong>å…¸å‹ç‰¹å¾ï¼š</strong></p>
<ul>
<li>å•äººæˆ–å°å›¢é˜Ÿç»´æŠ¤</li>
<li>å‰åç«¯è€¦åˆå¼º</li>
<li>å¼€å‘èŠ‚å¥å¿«ã€åŠŸèƒ½ç®€å•</li>
</ul>
<p><strong>æ¨èæ¡†æ¶ç»„åˆï¼š</strong></p>

























<table><thead><tr><th>åœºæ™¯</th><th>æ¡†æ¶</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>å‰ç«¯</td><td><strong>Vitest</strong> / <strong>Jest</strong></td><td>é›¶é…ç½®ã€é›†æˆ TypeScript æ”¯æŒã€è¿è¡Œå¿«</td></tr><tr><td>åç«¯</td><td><strong>Jest</strong> / <strong>Supertest</strong></td><td>å¿«é€Ÿæµ‹è¯• API ä¸æœåŠ¡é€»è¾‘</td></tr><tr><td>E2E</td><td><strong>Playwright</strong></td><td>å†…ç½®æµè§ˆå™¨é©±åŠ¨ï¼Œæ˜“äºæœ¬åœ°è¿è¡Œ</td></tr></tbody></table>
<p><strong>ç¤ºä¾‹ä»£ç ï¼ˆVitest + Vue3ï¼‰</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils/math.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt; a + b;
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// tests/math.test.ts</span>
<span class="hljs-keyword">import</span> { describe, it, expect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vitest'</span>;
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/utils/math'</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">'math utils'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'should add two numbers correctly'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">expect</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">5</span>);
  });
});
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å­¦ä¹ æˆæœ¬ä½ï¼›</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œå¿«ï¼›</li>
<li>å¯é›†æˆè‡³ Vite æˆ– npm scriptã€‚</li>
</ul>
<p><strong>å»ºè®®ï¼š</strong></p>
<blockquote>
<p>å°å‹é¡¹ç›®å¯åªéœ€å•å…ƒæµ‹è¯• + åŸºç¡€ E2Eï¼Œä¸å¼ºæ±‚è¦†ç›–ç‡å’ŒæŠ¥å‘Šç³»ç»Ÿã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">2ï¸âƒ£ ä¸­å‹é¡¹ç›®ï¼šæ¨¡å—åŒ–ç³»ç»Ÿï¼Œéœ€è¦æŒç»­é›†æˆæ”¯æŒ</h3>
<p><strong>å…¸å‹ç‰¹å¾ï¼š</strong></p>
<ul>
<li>å¤šæ¨¡å—ç³»ç»Ÿï¼Œå¦‚ä¸­å°æœåŠ¡ã€ç®¡ç†å¹³å°ç­‰</li>
<li>æµ‹è¯•éœ€è¦†ç›– API å±‚å’Œæ¨¡å—æ¥å£</li>
<li>ä½¿ç”¨ CI/CDï¼ˆGitHub Actionsã€GitLab CI ç­‰ï¼‰</li>
</ul>
<p><strong>æ¨èæ¡†æ¶ç»„åˆï¼š</strong></p>






























<table><thead><tr><th>å±‚çº§</th><th>æ¡†æ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å•å…ƒæµ‹è¯•</td><td><strong>Jest</strong> / <strong>Mocha + Chai</strong></td><td>ä¸°å¯Œæ’ä»¶ç”Ÿæ€</td></tr><tr><td>é›†æˆæµ‹è¯•</td><td><strong>Supertest / Testcontainers</strong></td><td>çœŸå®æœåŠ¡äº¤äº’éªŒè¯</td></tr><tr><td>E2Eæµ‹è¯•</td><td><strong>Cypress</strong></td><td>UI è‡ªåŠ¨åŒ–ã€æ¨¡æ‹ŸçœŸå®äº¤äº’</td></tr><tr><td>æŠ¥å‘Šå·¥å…·</td><td><strong>Allure / Coverage Report</strong></td><td>é›†æˆåˆ° CI æµç¨‹ä¸­</td></tr></tbody></table>
<p><strong>ç¤ºä¾‹ï¼ˆNode.js + Jest + Supertestï¼‰</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// user.controller.test.ts</span>
<span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'supertest'</span>;
<span class="hljs-keyword">import</span> { app } <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/app'</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">'User API'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'GET /api/users returns 200'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">request</span>(app).<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/users'</span>);
    <span class="hljs-title function_">expect</span>(response.<span class="hljs-property">status</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">200</span>);
    <span class="hljs-title function_">expect</span>(response.<span class="hljs-property">body</span>).<span class="hljs-title function_">toHaveProperty</span>(<span class="hljs-string">'data'</span>);
  });
});
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>æ¨¡å—è§£è€¦æ¸…æ™°ï¼Œæµ‹è¯•å¯å¤ç”¨ï¼›</li>
<li>å®¹æ˜“é›†æˆè‡ªåŠ¨åŒ–æµæ°´çº¿ï¼›</li>
<li>æ–¹ä¾¿ç”ŸæˆæŠ¥å‘Šä¸è¦†ç›–ç‡ç»Ÿè®¡ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æ¡†æ¶è¾ƒå¤šï¼Œé…ç½®ç›¸å¯¹å¤æ‚ï¼›</li>
<li>CI æ‰§è¡Œæ—¶é—´è¾ƒé•¿ã€‚</li>
</ul>
<p><strong>å»ºè®®ï¼š</strong></p>
<blockquote>
<p>é‡ç‚¹å…³æ³¨ <strong>æœåŠ¡é—´çš„ç¨³å®šæ€§æµ‹è¯•</strong> ä¸ <strong>æŒç»­é›†æˆä¸­çš„è‡ªåŠ¨è§¦å‘ç­–ç•¥</strong>ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">3ï¸âƒ£ å¤§å‹é¡¹ç›®ï¼šå¾®æœåŠ¡ä¸å¤šæŠ€æœ¯æ ˆå…±å­˜çš„å¤æ‚ç³»ç»Ÿ</h3>
<p><strong>å…¸å‹ç‰¹å¾ï¼š</strong></p>
<ul>
<li>æ‹†åˆ†ä¸ºå¤šä¸ªå­ç³»ç»Ÿï¼ˆå‰ç«¯ã€åç«¯ã€æ•°æ®å±‚ï¼‰</li>
<li>å¤šè¯­è¨€ç»„åˆï¼ˆJava + Node + Python + Goï¼‰</li>
<li>DevOps è¦æ±‚é«˜ï¼Œæµ‹è¯•è¦†ç›–å…¨æµç¨‹</li>
</ul>
<p><strong>æ¨èæ¡†æ¶ä½“ç³»ï¼š</strong></p>



































<table><thead><tr><th>å±‚çº§</th><th>å·¥å…·</th><th>ä¼˜åŠ¿</th></tr></thead><tbody><tr><td>å•å…ƒæµ‹è¯•</td><td><strong>JUnit5 / Pytest / Jest</strong></td><td>é’ˆå¯¹ä¸åŒè¯­è¨€æ¨¡å—</td></tr><tr><td>é›†æˆæµ‹è¯•</td><td><strong>Testcontainers / WireMock</strong></td><td>æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–ï¼ˆDBã€APIï¼‰</td></tr><tr><td>E2E</td><td><strong>Cypress / Playwright / Selenium Grid</strong></td><td>å¤šæµè§ˆå™¨è‡ªåŠ¨å›å½’æµ‹è¯•</td></tr><tr><td>æ€§èƒ½ä¸ç¨³å®šæ€§æµ‹è¯•</td><td><strong>Locust / k6 / JMeter</strong></td><td>å‹æµ‹ä¸ç›‘æ§é›†æˆ Grafana</td></tr><tr><td>æµ‹è¯•ç®¡ç†å¹³å°</td><td><strong>Allure / TestRail / SonarQube</strong></td><td>å…¨å±€æµ‹è¯•å¯è§†åŒ–ä¸å†å²åˆ†æ</td></tr></tbody></table>
<p><strong>ç¤ºæ„æ¶æ„å›¾ï¼š</strong></p>
<pre><code class="hljs language-lua" lang="lua">[ CI Pipeline ]
      |
      v
 +<span class="hljs-comment">-------------------------------+</span>
 | Unit Test (Jest, JUnit, Pytest)
 +<span class="hljs-comment">-------------------------------+</span>
      |
      v
 +<span class="hljs-comment">-------------------------------+</span>
 | Integration Test (Testcontainers, WireMock)
 +<span class="hljs-comment">-------------------------------+</span>
      |
      v
 +<span class="hljs-comment">-------------------------------+</span>
 | E2E Test (Cypress) + Perf Test (k6)
 +<span class="hljs-comment">-------------------------------+</span>
</code></pre>
<p><strong>ä¼˜ç¼ºç‚¹åˆ†æï¼š</strong></p>





















<table><thead><tr><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>é«˜å¯ç»´æŠ¤æ€§ï¼Œæµ‹è¯•ä½“ç³»åŒ–</td><td>æ„å»ºåŠè¿è¡Œæ—¶é—´è¾ƒé•¿</td></tr><tr><td>è¦†ç›–å¤šå±‚çº§ç³»ç»Ÿ</td><td>å¯¹å·¥ç¨‹å¸ˆä¸“ä¸šè¦æ±‚é«˜</td></tr><tr><td>æ”¯æ’‘ DevOps ä¸ç‰ˆæœ¬è¿½è¸ª</td><td>éœ€ä¸“äººç»´æŠ¤æµ‹è¯•ç¯å¢ƒ</td></tr></tbody></table>
<p><strong>å»ºè®®ï¼š</strong></p>
<blockquote>
<p>å¤§å‹ç³»ç»Ÿåº”å°†æµ‹è¯•æ¡†æ¶çº³å…¥ <strong>æ¶æ„æ²»ç†ä½“ç³»</strong>ï¼Œç¡®ä¿æµ‹è¯•ç»“æœä¸éƒ¨ç½²ã€ç›‘æ§ç³»ç»Ÿè”åŠ¨ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€æµ‹è¯•æ¡†æ¶çš„é€‰æ‹©é€»è¾‘æ€»ç»“</h2>









































<table><thead><tr><th>ç»´åº¦</th><th>å°å‹é¡¹ç›®</th><th>ä¸­å‹é¡¹ç›®</th><th>å¤§å‹é¡¹ç›®</th></tr></thead><tbody><tr><td>æµ‹è¯•ç›®æ ‡</td><td>å‡½æ•°æ­£ç¡®æ€§</td><td>æ¨¡å—ç¨³å®šæ€§</td><td>ç³»ç»Ÿå¯é æ€§</td></tr><tr><td>æ¡†æ¶æ•°é‡</td><td>å°‘é‡ï¼ˆVitest + Playwrightï¼‰</td><td>æ¨¡å—åŒ–ï¼ˆJest + Cypressï¼‰</td><td>ä½“ç³»åŒ–ï¼ˆJUnit + Cypress + Allureï¼‰</td></tr><tr><td>æˆæœ¬</td><td>ä½</td><td>ä¸­ç­‰</td><td>é«˜</td></tr><tr><td>æ˜¯å¦ä½¿ç”¨ CI</td><td>å¯é€‰</td><td>å»ºè®®</td><td>å¿…é¡»</td></tr><tr><td>æ˜¯å¦å…³æ³¨è¦†ç›–ç‡</td><td>å¦</td><td>æ˜¯</td><td>æ˜¯ï¼ˆç”±CIç»Ÿè®¡ï¼‰</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">ç»“è®º</h2>
<p>æµ‹è¯•æ¡†æ¶çš„é€‰æ‹©ï¼Œå®è´¨ä¸Šæ˜¯ <strong>è´¨é‡æˆ˜ç•¥çš„è½åœ°é€‰æ‹©</strong>ã€‚</p>
<ul>
<li>å°å‹é¡¹ç›®è¿½æ±‚ <strong>å¿«é€ŸéªŒè¯</strong>ï¼Œä¸å®œè¿‡åº¦å·¥ç¨‹åŒ–ï¼›</li>
<li>ä¸­å‹é¡¹ç›®å¼ºè°ƒ <strong>å›¢é˜Ÿåä½œä¸æŒç»­é›†æˆ</strong>ï¼›</li>
<li>å¤§å‹é¡¹ç›®åˆ™éœ€å…³æ³¨ <strong>è‡ªåŠ¨åŒ–ã€æ²»ç†ä¸ä½“ç³»åŒ–æµ‹è¯•</strong>ã€‚</li>
</ul>
<p>æœªæ¥è¶‹åŠ¿ä¸Šï¼Œéšç€ <strong>AI è¾…åŠ©æµ‹è¯•</strong>ã€<strong>æ— ä»£ç æµ‹è¯•å¹³å°</strong>ã€<strong>äº‘åŸç”Ÿæµ‹è¯•ç¯å¢ƒ</strong> çš„å‘å±•ï¼Œæ¡†æ¶çš„è¾¹ç•Œæ­£è¢«æ¨¡ç³ŠåŒ–ã€‚<br/>
å¼€å‘è€…ä¸åº”è¿½æ±‚â€œæ¡†æ¶æœ€å…¨â€ï¼Œè€Œåº”è¿½æ±‚â€œæµ‹è¯•ä½“ç³»æœ€åˆé€‚â€ã€‚</p>
<hr/>
<h2 data-id="heading-8">å‚è€ƒèµ„æ–™</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjestjs.io%2F" target="_blank" title="https://jestjs.io/" ref="nofollow noopener noreferrer">Jest å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitest.dev%2F" target="_blank" title="https://vitest.dev/" ref="nofollow noopener noreferrer">Vitest å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cypress.io%2F" target="_blank" title="https://www.cypress.io/" ref="nofollow noopener noreferrer">Cypress.io Testing Framework</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplaywright.dev%2F" target="_blank" title="https://playwright.dev/" ref="nofollow noopener noreferrer">Playwright å®˜ç½‘æŒ‡å—</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjunit.org%2Fjunit5%2Fdocs%2Fcurrent%2Fuser-guide%2F" target="_blank" title="https://junit.org/junit5/docs/current/user-guide/" ref="nofollow noopener noreferrer">JUnit 5 User Guide</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.testcontainers.org%2F" target="_blank" title="https://www.testcontainers.org/" ref="nofollow noopener noreferrer">Testcontainers Official Site</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•é€‰æ‹©åˆé€‚çš„è·¨ç«¯æ¡†æ¶ï¼šä»å°ç¨‹åºåˆ°å¤šå¹³å°ç»Ÿä¸€å¼€å‘]]></title>    <link>https://juejin.cn/post/7603376587653234738</link>    <guid>https://juejin.cn/post/7603376587653234738</guid>    <pubDate>2026-02-07T01:31:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603376587653234738" data-draft-id="7603595309231980554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•é€‰æ‹©åˆé€‚çš„è·¨ç«¯æ¡†æ¶ï¼šä»å°ç¨‹åºåˆ°å¤šå¹³å°ç»Ÿä¸€å¼€å‘"/> <meta itemprop="keywords" content="å…¨æ ˆ"/> <meta itemprop="datePublished" content="2026-02-07T01:31:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•é€‰æ‹©åˆé€‚çš„è·¨ç«¯æ¡†æ¶ï¼šä»å°ç¨‹åºåˆ°å¤šå¹³å°ç»Ÿä¸€å¼€å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:31:41.000Z" title="Sat Feb 07 2026 01:31:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨å‰ç«¯ç”Ÿæ€è“¬å‹ƒå‘å±•çš„ä»Šå¤©ï¼Œåº”ç”¨å·²ç»ä¸ä»…ä»…è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ã€‚å¼€å‘è€…éœ€è¦åŒæ—¶æ”¯æŒï¼š</p>
<ul>
<li><strong>Web ç½‘ç«™ï¼›</strong></li>
<li><strong>iOS å’Œ Android åº”ç”¨ï¼›</strong></li>
<li><strong>å„ç±»å°ç¨‹åºï¼ˆå¾®ä¿¡ã€æ”¯ä»˜å®ã€æŠ–éŸ³ç­‰ï¼‰ï¼›</strong></li>
<li><strong>æ¡Œé¢å®¢æˆ·ç«¯ï¼ˆElectronã€Tauri ç­‰ï¼‰ã€‚</strong></li>
</ul>
<p>è¿™å‚¬ç”Ÿäº†å¤§é‡â€œ<strong>è·¨ç«¯å¼€å‘æ¡†æ¶</strong>â€â€”â€”ä¾‹å¦‚ <strong>UniAppã€Taroã€Flutterã€React Nativeã€Capacitor</strong> ç­‰ã€‚<br/>
ç„¶è€Œï¼Œé€‰æ‹©å®ƒä»¬å¹¶éç®€å•çœ‹çƒ­åº¦ï¼Œè€Œè¦é¦–å…ˆå›ç­”ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š</p>
<blockquote>
<ol>
<li>æˆ‘éœ€è¦æ”¯æŒå“ªäº›ç«¯ï¼Ÿ</li>
<li>å›¢é˜Ÿç†Ÿæ‚‰çš„æŠ€æœ¯æ ˆæ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>æ€§èƒ½ä¸å¼€å‘æ•ˆç‡å“ªä¸ªæ›´é‡è¦ï¼Ÿ</li>
</ol>
</blockquote>
<p>æœ¬æ–‡å°†å¸¦ä½ ç†æ¸…ä¸åŒåœºæ™¯ä¸‹æ¡†æ¶çš„ä¼˜åŠ¿å·®å¼‚ï¼Œå¸®åŠ©å›¢é˜Ÿåšå‡ºç§‘å­¦çš„é€‰å‹å†³ç­–ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€é—®é¢˜èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆéœ€è¦è·¨ç«¯æ¡†æ¶ï¼Ÿ</h2>
<p>è·¨ç«¯æ¡†æ¶çš„ä½¿å‘½ï¼Œæ˜¯<strong>ä¸€æ¬¡ç¼–ç ï¼Œå¤šç«¯è¿è¡Œ</strong>ã€‚</p>
<p>ç†æƒ³ç›®æ ‡ï¼š</p>
<blockquote>
<p>ç¼–å†™ä¸€å¥—ä»£ç ï¼Œå¯è¾“å‡º Webã€Appã€å°ç¨‹åºç­‰å¤šç‰ˆæœ¬åº”ç”¨ã€‚</p>
</blockquote>
<p>å®ƒè§£å†³çš„æ ¸å¿ƒé—®é¢˜åŒ…æ‹¬ï¼š</p>
<ul>
<li>å¤šç«¯ä»£ç é‡å¤å¼€å‘æˆæœ¬é«˜ï¼›</li>
<li>å›¢é˜Ÿç»´æŠ¤é‡å¤§ã€ç‰ˆæœ¬ä¸ä¸€è‡´ï¼›</li>
<li>UI è¡¨ç°ä¸é€»è¾‘è¡Œä¸ºéœ€è¦ç»Ÿä¸€ã€‚</li>
</ul>
<p>ä½†ä¸åŒæ¡†æ¶çš„åº•å±‚æŠ€æœ¯å·®å¼‚å·¨å¤§ï¼Œå¸¦æ¥ä¸åŒçš„ç‰¹æ€§ä¸é™åˆ¶ã€‚</p>
<hr/>
<h2 data-id="heading-2">äºŒã€å¸¸è§è·¨ç«¯æ¡†æ¶åˆ†ç±»ä¸åŸç†</h2>



































<table><thead><tr><th>ç±»å‹</th><th>ä»£è¡¨æ¡†æ¶</th><th>æŠ€æœ¯åŸç†</th><th>ä¸»è¦è¦†ç›–å¹³å°</th></tr></thead><tbody><tr><td><strong>å¤šç«¯ç¼–è¯‘å‹ (Compile-Time)</strong></td><td>Taroã€UniAppã€Chameleon</td><td>å°†æºç è½¬è¯‘æˆç›®æ ‡ç«¯åŸç”Ÿä»£ç ï¼ˆå¦‚å°ç¨‹åºè¯­æ³•ï¼‰</td><td>Web + å„ç±»å°ç¨‹åº + App</td></tr><tr><td><strong>åŸç”Ÿæ¸²æŸ“å‹ (Native Render)</strong></td><td>React Nativeã€Weexã€Flutter</td><td>ç”¨ JS/Dart è°ƒç”¨åŸç”Ÿæ¸²æŸ“å¼•æ“</td><td>iOS + Android</td></tr><tr><td><strong>Web å®¹å™¨å‹ (WebView Hybrid)</strong></td><td>Cordovaã€Capacitorã€Ionic</td><td>ä½¿ç”¨ WebView å®¹å™¨åµŒå…¥ç½‘é¡µ</td><td>App ä¸»ä½“ç®€å•åœºæ™¯å¼€å‘</td></tr><tr><td><strong>æ¡Œé¢è·¨ç«¯å‹</strong></td><td>Electronã€Tauri</td><td>Web + åŸç”Ÿæ¡Œé¢å®¹å™¨</td><td>PC/Mac åº”ç”¨å¼€å‘</td></tr></tbody></table>
<p>æ¯ç§æ¡†æ¶å¯¹åº”ä¸åŒçš„ç›®æ ‡å’Œå¦¥åç‚¹ï¼Œç†è§£å®ƒä»¬çš„å–èˆæ˜¯æ­£ç¡®é€‰æ‹©çš„å‰æã€‚</p>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€ä¸åŒé¡¹ç›®è§„æ¨¡ä¸‹çš„é€‰å‹å»ºè®®</h2>
<h3 data-id="heading-4">1ï¸âƒ£ å°å‹é¡¹ç›®ï¼šæ³¨é‡å¼€å‘æ•ˆç‡ä¸ç”Ÿæ€</h3>
<p><strong>å…¸å‹åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¯åŠ¨æœŸåº”ç”¨ã€å°ç¨‹åº MVPã€æ´»åŠ¨é¡µé¢ï¼›</li>
<li>å›¢é˜Ÿå‰ç«¯ä¸ºä¸»ï¼Œä¸ç†Ÿæ‚‰åŸç”Ÿå¼€å‘ã€‚</li>
</ul>
<p><strong>æ¨èæ¡†æ¶ï¼š</strong></p>
<ul>
<li><strong>UniApp</strong> æˆ– <strong>Taro</strong>ï¼ˆVue/React é£æ ¼ï¼‰</li>
</ul>
<p>è¿™ç±»æ¡†æ¶é€šè¿‡ç¼–è¯‘å™¨å°† Vue æˆ– React ä»£ç è½¬è¯‘æˆå¯¹åº”å¹³å°çš„ä»£ç ç»“æ„ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆTaro3 + React è¯­æ³•ï¼‰</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">View</span>, <span class="hljs-title class_">Text</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tarojs/components'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./index.scss'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Index</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"index"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Hello Taro!<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å­¦ä¹ æˆæœ¬ä½ï¼ˆæ²¿ç”¨å‰ç«¯ç”Ÿæ€ï¼‰ï¼›</li>
<li>å¯åŒæ—¶ç¼–è¯‘åˆ°å°ç¨‹åºå’Œ H5ï¼›</li>
<li>ç”Ÿæ€å®Œå–„ï¼ˆUI åº“ã€æ’ä»¶é½å…¨ï¼‰ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å®šåˆ¶èƒ½åŠ›æœ‰é™ï¼›</li>
<li>æ€§èƒ½å—é™ï¼Œå¤æ‚äº¤äº’å¯èƒ½å¡é¡¿ã€‚</li>
</ul>
<blockquote>
<p>âœ… <strong>å»ºè®®ï¼š</strong> å°é¡¹ç›®ä¼˜å…ˆé€‰æ‹© <strong>UniApp/Taro</strong> ç­‰â€œç¼–è¯‘å‹æ–¹æ¡ˆâ€ï¼Œå¿«é€Ÿä¸Šçº¿ã€ä½æˆæœ¬è¿­ä»£ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">2ï¸âƒ£ ä¸­å‹é¡¹ç›®ï¼šè¿½æ±‚å¹³è¡¡çš„æ€§èƒ½ä¸å¯ç»´æŠ¤æ€§</h3>
<p><strong>å…¸å‹åœºæ™¯ï¼š</strong></p>
<ul>
<li>ä¼ä¸š Appã€B ç«¯å°ç¨‹åºã€CRMã€è½»é‡ SaaSã€‚</li>
<li>å¯¹äº¤äº’æµç•…æ€§å’Œç»„ä»¶ä¸°å¯Œåº¦æœ‰ä¸€å®šè¦æ±‚ã€‚</li>
</ul>
<p><strong>æ¨èæ¡†æ¶ï¼š</strong></p>
<ul>
<li><strong>React Native</strong>ï¼ˆæˆç†Ÿç”Ÿæ€ã€å›¢é˜Ÿæ˜“ä¸Šæ‰‹ï¼‰</li>
<li><strong>Flutter</strong>ï¼ˆé«˜æ€§èƒ½ã€UI æ§åˆ¶åŠ›å¼ºï¼‰</li>
</ul>
<p><strong>React Native ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Text</span>, <span class="hljs-title class_">View</span>, <span class="hljs-title class_">StyleSheet</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.container}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Hello React Native!<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">const</span> styles = <span class="hljs-title class_">StyleSheet</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">container</span>: { <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-string">'center'</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span> },
});
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>åŸç”Ÿæ¸²æŸ“ï¼Œæ€§èƒ½æ¥è¿‘åŸç”Ÿï¼›</li>
<li>çƒ­é‡è½½ã€é«˜å¼€å‘æ•ˆç‡ï¼›</li>
<li>ä¸°å¯Œçš„æ’ä»¶ç³»ç»Ÿå’ŒåŸç”Ÿæ¡¥æ¥èƒ½åŠ›ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å¤šç‰ˆæœ¬ç»´æŠ¤å¤æ‚ï¼ˆiOS/Android å·®å¼‚ï¼‰ï¼›</li>
<li>å¯¹åŸç”Ÿç¯å¢ƒå’Œæ‰“åŒ…æµç¨‹è¦æ±‚è¾ƒé«˜ã€‚</li>
</ul>
<p><strong>å¯¹æ¯” Flutterï¼š</strong></p>






























<table><thead><tr><th>é¡¹ç›®éœ€æ±‚</th><th>React Native</th><th>Flutter</th></tr></thead><tbody><tr><td>ç”Ÿæ€å…¼å®¹æ€§</td><td>âœ… å¼ºï¼ˆä¸ Web/React åŒæºï¼‰</td><td>âŒ è¾ƒç‹¬ç«‹</td></tr><tr><td>æ€§èƒ½</td><td>ä¸­ç­‰åé«˜</td><td>âœ… å“è¶Š</td></tr><tr><td>å¼€å‘è¯­è¨€</td><td>JavaScript/TypeScript</td><td>Dart</td></tr><tr><td>å­¦ä¹ æˆæœ¬</td><td>ä½</td><td>ä¸­ç­‰åé«˜</td></tr></tbody></table>
<blockquote>
<p>âœ… <strong>å»ºè®®ï¼š</strong> ä¸­å‹é¡¹ç›®å…³æ³¨<strong>é•¿æœŸç»´æŠ¤æ€§</strong>ä¸<strong>æ€§èƒ½å¹³è¡¡</strong>ï¼ŒRN æ›´é€‚åˆå‰ç«¯å›¢é˜Ÿï¼ŒFlutter æ›´é€‚åˆåŸç”Ÿå›¢é˜Ÿã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">3ï¸âƒ£ å¤§å‹é¡¹ç›®ï¼šè¿½æ±‚æè‡´æ€§èƒ½ä¸è·¨å¹³å°ä¸€è‡´ä½“éªŒ</h3>
<p><strong>å…¸å‹åœºæ™¯ï¼š</strong></p>
<ul>
<li>ä¼ä¸šè‡ªç ” App å¹³å°ã€è¶…çº§ Appã€SaaS ç§»åŠ¨ç«¯ï¼›</li>
<li>è¦æ±‚å¤šç«¯ç»Ÿä¸€ã€äº¤äº’æµç•…ã€UI å®šåˆ¶æ·±ã€‚</li>
</ul>
<p><strong>æ¨èæ¡†æ¶ï¼š</strong></p>
<ul>
<li><strong>Flutter</strong>ï¼ˆé¦–é€‰ï¼‰</li>
<li><strong>ç‹¬ç«‹å‰åç«¯æ¡¥æ¥å‹æ–¹æ¡ˆï¼ˆå¦‚ Mangoã€Lynxã€QuickAppï¼‰</strong></li>
</ul>
<p><strong>Flutter ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>è‡ªå¸¦ Skia æ¸²æŸ“å¼•æ“ï¼Œç»•è¿‡ç³»ç»Ÿæ§ä»¶ï¼›</li>
<li>ä¸€å¥—ä»£ç åŒæ—¶ç”Ÿæˆ iOS/Android/Webï¼›</li>
<li>æ€§èƒ½åª²ç¾åŸç”Ÿåº”ç”¨ï¼›</li>
<li>å¯æä¾›ç»Ÿä¸€ UI è§„èŒƒåº“ã€‚</li>
</ul>
<p><strong>å…³é”®ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> '<span class="hljs-keyword">package</span>:flutter/material.dart';

void main() =&gt; runApp(const <span class="hljs-type">MyApp</span>());

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  const <span class="hljs-type">MyApp</span>({<span class="hljs-keyword">super</span>.key});
  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">MaterialApp</span>(
      home: <span class="hljs-type">Scaffold</span>(
        body: <span class="hljs-type">Center</span>(child: <span class="hljs-type">Text</span>('<span class="hljs-type">Hello</span> <span class="hljs-type">Flutter</span>')),
      ),
    );
  }
}
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>æ€§èƒ½æœ€ä½³ã€UI æ§åˆ¶å½»åº•ï¼›</li>
<li>å¤šç«¯ä¸€è‡´æ€§æä½³ï¼›</li>
<li>æ”¯æŒ Web ä¸æ¡Œé¢ç«¯æ‰©å±•ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>äºŒè¿›åˆ¶ä½“ç§¯è¾ƒå¤§ï¼›</li>
<li>å›¢é˜Ÿè½¬å‹æˆæœ¬é«˜ã€‚</li>
</ul>
<blockquote>
<p>âœ… <strong>å»ºè®®ï¼š</strong> å¤§å‹è·¨ç«¯ç³»ç»Ÿåº”ä»¥ <strong>Flutter æˆ–å®šåˆ¶æ··åˆæ–¹æ¡ˆ</strong> ä¸ºæ ¸å¿ƒï¼ŒåŒæ—¶é…åˆ CI/CD æµ‹è¯•ä¸ç‰ˆæœ¬æ§åˆ¶ä½“ç³»ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">å››ã€ç»¼åˆé€‰å‹æŒ‡å—</h2>








































<table><thead><tr><th>é¡¹ç›®è§„æ¨¡</th><th>æŠ€æœ¯å›¢é˜ŸèƒŒæ™¯</th><th>æ¨èæ¡†æ¶</th><th>ä¸»è¦ç«¯</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>å°å‹</td><td>Webå‰ç«¯ä¸ºä¸»</td><td>UniApp / Taro</td><td>H5 + å°ç¨‹åº</td><td>å¿«é€Ÿä¸Šçº¿ã€ä½é—¨æ§›</td></tr><tr><td>ä¸­å‹</td><td>æ··åˆå›¢é˜Ÿ</td><td>React Native / Flutter</td><td>App ä¸»å¯¼</td><td>æ€§èƒ½ä¸æ•ˆç‡å¹³è¡¡</td></tr><tr><td>å¤§å‹</td><td>å¤šç«¯ç»Ÿä¸€å¹³å°</td><td>Flutter / å®šåˆ¶å®¢åˆ¶å¼•æ“</td><td>å…¨å¹³å°</td><td>é«˜æ€§èƒ½ã€é«˜ä¸€è‡´æ€§</td></tr><tr><td>PC ç«¯</td><td>Web å›¢é˜Ÿ</td><td>Electron / Tauri</td><td>æ¡Œé¢</td><td>Web æŠ€æœ¯æ„å»ºæ¡Œé¢å®¢æˆ·ç«¯</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">äº”ã€ç»“è®º</h2>
<p>è·¨ç«¯å¼€å‘çš„ç›®æ ‡ï¼Œæ˜¯åœ¨ä¸åŒç»ˆç«¯ä¹‹é—´å–å¾— <strong>å¼€å‘æ•ˆç‡ã€æ€§èƒ½ã€ç”Ÿæ€å…¼å®¹</strong> çš„æœ€ä¼˜å¹³è¡¡ç‚¹ã€‚</p>
<ul>
<li><strong>UniApp / Taroï¼š</strong> æœ€é€‚åˆä¸­å°é¡¹ç›®å¿«é€ŸéªŒè¯å’Œä¸Šçº¿ï¼›</li>
<li><strong>React Nativeï¼š</strong> æˆç†Ÿç¨³å®šã€ç”Ÿæ€åºå¤§ï¼Œä¸“æ³¨äº App å±‚å¼€å‘ï¼›</li>
<li><strong>Flutterï¼š</strong> æ€§èƒ½é¢†å…ˆï¼Œé€‚åˆä¼ä¸šçº§ç»Ÿä¸€æŠ€æœ¯æ ˆæˆ˜ç•¥ï¼›</li>
<li><strong>Electron / Tauriï¼š</strong> è®© Web æŠ€æœ¯å»¶ä¼¸è‡³æ¡Œé¢ç«¯ã€‚</li>
</ul>
<p>æœªæ¥ï¼Œéšç€ <strong>WebAssemblyã€è·¨ç«¯æ¸²æŸ“å¼•æ“ï¼ˆå¦‚ RN Fabricã€Flutter Impellerï¼‰</strong> çš„å‘å±•ï¼Œ<br/>
è·¨ç«¯æ¡†æ¶çš„è¾¹ç•Œå°†è¶Šæ¥è¶Šæ¨¡ç³Šâ€”â€”æˆ–è®¸ç»ˆå°†è¿æ¥çœŸæ­£çš„ã€Œä¸€æ¬¡å¼€å‘ï¼Œå…¨æ ˆè¿è¡Œã€ã€‚</p>
<hr/>
<h2 data-id="heading-9">å…­ã€å‚è€ƒèµ„æ–™</h2>
<ol>
<li>[Taro å®˜æ–¹æ–‡æ¡£ â€“ äº¬ä¸œå¼€æºé¡¹ç›®]</li>
<li>[UniApp å¼€å‘è€…ä¸­å¿ƒ â€“ DCloud]</li>
<li>[React Native å®˜æ–¹æ–‡æ¡£]</li>
<li>[Flutter.dev å®˜æ–¹ç½‘ç«™]</li>
<li>[Capacitor by Ionic å®˜æ–¹æ–‡æ¡£]</li>
<li>[Electron æ¡†æ¶æŒ‡å—]</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¹Ÿè®¸ä½ ä¸éœ€è¦åˆ›å»º.venv, æ­¤è§„èŒƒä½¿pythonè„šæœ¬è‡ªå¤‡ä¾èµ–]]></title>    <link>https://juejin.cn/post/7603591775391891483</link>    <guid>https://juejin.cn/post/7603591775391891483</guid>    <pubDate>2026-02-07T01:41:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603591775391891483" data-draft-id="7603591775391858715" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¹Ÿè®¸ä½ ä¸éœ€è¦åˆ›å»º.venv, æ­¤è§„èŒƒä½¿pythonè„šæœ¬è‡ªå¤‡ä¾èµ–"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-07T01:41:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¹Ÿè®¸ä½ ä¸éœ€è¦åˆ›å»º.venv, æ­¤è§„èŒƒä½¿pythonè„šæœ¬è‡ªå¤‡ä¾èµ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:41:50.000Z" title="Sat Feb 07 2026 01:41:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Python å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é™·å…¥ä¸€ç§â€œç¯å¢ƒé€šèƒ€â€ï¼šä¸ºäº†è¿è¡Œä¸€ä¸ªä¸åˆ° 50 è¡Œçš„ç®€å•è„šæœ¬ï¼ˆæ¯”å¦‚æŠ“ä¸ªæ¥å£æ•°æ®ã€å†™ä¸ª Streamlit æ¼”ç¤ºï¼‰ï¼Œå´ä¸å¾—ä¸ç»å† <code>python -m venv .venv</code>ã€æ¿€æ´»ç¯å¢ƒã€<code>pip install</code> ç­‰ä¸€ç³»åˆ—ç¹çåŠ¨ä½œã€‚</p>
<p>å¦‚æœä½ æ‰‹å¤´æœ‰åä¸ªè¿™æ ·çš„è„šæœ¬ï¼Œä½ çš„ç£ç›˜å°±ä¼šè¢«å‡ åä¸ªé‡å¤çš„ <code>.venv</code> æ–‡ä»¶å¤¹å æ»¡ã€‚<strong>Astral æ¨å‡ºçš„ <code>uv</code> å·¥å…·æ­£åœ¨ç»ˆç»“è¿™ç§ä½æ•ˆã€‚</strong> é…åˆ <strong>PEP 723 (Inline script metadata)</strong> è§„èŒƒï¼Œæˆ‘ä»¬å¯ä»¥çœŸæ­£å®ç°â€œå•æ–‡ä»¶å³é¡¹ç›®â€çš„ä¼˜é›…ä½“éªŒã€‚</p>
<hr/>
<h2 data-id="heading-0">1. æ ¸å¿ƒçº åï¼šuv init è¿˜æ˜¯ uv venvï¼Ÿ</h2>
<p>å¾ˆå¤šåˆå­¦è€…åœ¨åˆšæ¥è§¦ <code>uv</code> æ—¶ä¼šæ„Ÿåˆ°å›°æƒ‘ã€‚å…¶å®ï¼Œé’ˆå¯¹ä¸åŒçš„é¢—ç²’åº¦ï¼Œ<code>uv</code> æä¾›äº†ä¸‰æ¡æ¸…æ™°çš„è·¯å¾„ï¼š</p>

























<table><thead><tr><th>å‘½ä»¤</th><th>é€‚ç”¨åœºæ™¯</th><th>äº§ç‰©</th></tr></thead><tbody><tr><td><strong><code>uv init</code></strong></td><td><strong>æ­£è§„å†›</strong>ï¼šéœ€è¦é•¿æœŸç»´æŠ¤ã€å¤šäººåä½œçš„å¤æ‚åº”ç”¨ã€‚</td><td><code>pyproject.toml</code>, <code>.python-version</code></td></tr><tr><td><strong><code>uv venv</code></strong></td><td><strong>ä¼ ç»Ÿæ´¾</strong>ï¼šåªæ˜¯æƒ³å¿«ç‚¹åˆ›å»ºç¯å¢ƒï¼Œç»§ç»­ç”¨ä¼ ç»Ÿçš„ <code>pip</code> ä¹ æƒ¯ã€‚</td><td><code>.venv</code> æ–‡ä»¶å¤¹</td></tr><tr><td><strong><code>uv run</code></strong></td><td><strong>ç‰¹ç§å…µ</strong>ï¼šå•è„šæœ¬è¿è¡Œï¼Œ<strong>ä¸äº§ç”Ÿä»»ä½•æœ¬åœ°ä¾èµ–æ–‡ä»¶å¤¹</strong>ã€‚</td><td>ä¸´æ—¶ç¼“å­˜ç¯å¢ƒï¼ˆè‡ªåŠ¨ç®¡ç†ï¼‰</td></tr></tbody></table>
<blockquote>
<p>[!TIP]
å¯¹äºç®€å•çš„å·¥å…·è„šæœ¬ï¼Œ<strong>å¿˜æ‰å‰ä¸¤ä¸ªå‘½ä»¤</strong>ã€‚ä½ åªéœ€è¦ <code>uv run</code>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">2. ç°ä»£æ–¹æ¡ˆï¼šPEP 723 è„šæœ¬å…ƒæ•°æ®</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpeps.python.org%2Fpep-0723%2F" target="_blank" title="https://peps.python.org/pep-0723/" ref="nofollow noopener noreferrer">PEP 723</a> æ˜¯ Python ç¤¾åŒºçš„ä¸€ä¸ªé‡Œç¨‹ç¢‘ã€‚å®ƒå…è®¸æˆ‘ä»¬å°†ä¾èµ–ä¿¡æ¯ç›´æ¥ä»¥â€œä»£ç æ³¨é‡Šâ€çš„å½¢å¼åµŒå…¥åˆ°è„šæœ¬å¤´éƒ¨ã€‚è¿™æ„å‘³ç€ä½ çš„è„šæœ¬å…·å¤‡äº†<strong>è‡ªæè¿°æ€§</strong>â€”â€”å®ƒæ˜¯è‡ªç»™è‡ªè¶³çš„ã€‚</p>
<h3 data-id="heading-2">è§„èŒƒç¤ºä¾‹</h3>
<p>å½“ä½ è¿è¡Œä¸€ä¸ªåŒ…å«ä»¥ä¸‹ä»£ç å—çš„è„šæœ¬æ—¶ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># /// script</span>
<span class="hljs-comment"># dependencies = [</span>
<span class="hljs-comment">#   "httpx",</span>
<span class="hljs-comment">#   "streamlit",</span>
<span class="hljs-comment"># ]</span>
<span class="hljs-comment"># ///</span>

<span class="hljs-keyword">import</span> httpx
<span class="hljs-keyword">import</span> streamlit <span class="hljs-keyword">as</span> st

st.title(<span class="hljs-string">"Token åˆ·æ–°å·¥å…·"</span>)
<span class="hljs-comment"># è„šæœ¬é€»è¾‘...</span>

</code></pre>
<h3 data-id="heading-3">ä¸ºä»€ä¹ˆè¿™ç§æ–¹å¼æ›´ä¼˜ç§€ï¼Ÿ</h3>
<ol>
<li><strong>ç¯å¢ƒå…¨è‡ªåŠ¨åŒ–</strong>ï¼šè¿è¡Œ <code>uv run script.py</code> æ—¶ï¼Œ<code>uv</code> ä¼šç¬æ—¶åœ¨åå°åˆ›å»ºä¸´æ—¶ç¯å¢ƒã€‚å¦‚æœä¾èµ–æ²¡å˜ï¼Œä¸‹æ¬¡è¿è¡Œä¼šç›´æ¥ç§’å¼€ã€‚</li>
<li><strong>é›¶æ±¡æŸ“</strong>ï¼šå®ƒä¸ä¼šåœ¨ä½ çš„è„šæœ¬ç›®å½•ä¸‹ç•™ä¸‹ <code>.venv</code> æ–‡ä»¶å¤¹ï¼Œå…¨å±€ç¯å¢ƒæ°¸è¿œä¿æŒæ´å‡€ã€‚</li>
<li><strong>æç®€åˆ†å‘</strong>ï¼šæŠŠè„šæœ¬å‘ç»™åŒäº‹æ—¶ï¼Œä¸ç”¨å†é™„å¸¦ <code>requirements.txt</code>ã€‚å¯¹æ–¹åªè¦è£…äº† <code>uv</code>ï¼Œç›´æ¥è¿è¡Œå³å¯ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-4">3. å®æˆ˜æŠ€å·§ï¼šå¦‚ä½•å¿«é€Ÿé…ç½®</h2>
<p>ä¸æƒ³æ‰‹åŠ¨æ‰“é‚£å † <code># ///</code> æ³¨é‡Šï¼Ÿ<code>uv</code> æ—©å°±å¸®ä½ æƒ³å¥½äº†è‡ªåŠ¨åŒ–æ–¹æ¡ˆã€‚</p>
<p>å¦‚æœä½ å·²ç»å†™å¥½äº†ä¸€ä¸ªè„šæœ¬ <code>refresh_token.py</code>ï¼Œåªéœ€åœ¨ç»ˆç«¯è¾“å…¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸ºè„šæœ¬ä¸€é”®æ·»åŠ ä¾èµ–å£°æ˜</span>
uv add --script refresh_token.py <span class="hljs-string">"streamlit"</span> <span class="hljs-string">"httpx"</span>

</code></pre>
<p>è¿™ä¼šè‡ªåŠ¨åœ¨æ–‡ä»¶å¤´æ’å…¥ç¬¦åˆ PEP 723 è§„èŒƒçš„å…ƒæ•°æ®ã€‚ä¹‹åï¼Œä½ åªéœ€ä¸€è¡Œå‘½ä»¤å³å¯å¯åŠ¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">uv run refresh_token.py

</code></pre>
<hr/>
<h2 data-id="heading-5">4. è¿›é˜¶ç‰¹æ€§ï¼šç²¾ç»†åŒ–æ§åˆ¶</h2>
<p>é™¤äº†åŸºç¡€çš„ä¾èµ–ç®¡ç†ï¼Œä½ è¿˜å¯ä»¥åœ¨è„šæœ¬å¤´éƒ¨ç©å‡ºæ›´å¤šèŠ±æ ·ï¼š</p>
<ul>
<li><strong>ç‰ˆæœ¬çº¦æŸ</strong>ï¼š<code>"requests&gt;=2.31.0"</code>ï¼Œç¡®ä¿è„šæœ¬ä¸ä¼šå› ä¸ºåº“å‡çº§è€Œå´©æ‰ã€‚</li>
<li><strong>æŒ‡å®š Python ç‰ˆæœ¬</strong>ï¼š<code># requires-python = "&gt;=3.12"</code>ï¼Œè‡ªåŠ¨è°ƒç”¨åˆé€‚çš„è§£é‡Šå™¨ã€‚</li>
<li><strong>å·¥å…·é“¾é…ç½®</strong>ï¼šé€šè¿‡ <code>[tool.uv]</code> å—è‡ªå®šä¹‰é•œåƒæºï¼Œè§£å†³å›½å†…ä¸‹è½½æ…¢çš„é—®é¢˜ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-6">ç»“è®ºä¸è¡ŒåŠ¨å»ºè®®</h2>
<p>Python è„šæœ¬çš„å¼€å‘æ¨¡å¼æ­£åœ¨ä»â€œæ‰‹åŠ¨å»ºæ¡£â€è½¬å‘â€œå£°æ˜å¼è¿è¡Œâ€ã€‚</p>
<ul>
<li><strong>ç«‹å³å¯åš</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.astral.sh%2Fuv%2Fgetting-started%2Finstallation%2F" target="_blank" title="https://docs.astral.sh/uv/getting-started/installation/" ref="nofollow noopener noreferrer">å®‰è£… uv</a>ï¼Œå¹¶å°è¯•ç”¨ <code>uv run --with &lt;åº“å&gt; &lt;è„šæœ¬&gt;</code> è¿è¡Œä¸€ä¸ªä¸´æ—¶è„šæœ¬ã€‚</li>
<li><strong>é•¿æœŸå®è·µ</strong>ï¼šå¯¹äºæ‰€æœ‰çš„å·¥å…·ç±»è„šæœ¬ï¼Œç»Ÿä¸€ä½¿ç”¨ <code>uv add --script</code> å†™å…¥å…ƒæ•°æ®ï¼ŒæŠŠæ¯ä¸€ä¸ªè„šæœ¬éƒ½æ‰“é€ æˆä¸€ä¸ª<strong>è‡ªç»™è‡ªè¶³çš„â€œå•å…µä½œæˆ˜å•å…ƒâ€</strong>ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LocalDate,LocalDateTime,Date,æ—¥æœŸä¸²ç›¸äº’è½¬æ¢]]></title>    <link>https://juejin.cn/post/7603581886149312566</link>    <guid>https://juejin.cn/post/7603581886149312566</guid>    <pubDate>2026-02-06T11:24:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603581886149312566" data-draft-id="7603587738160037951" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LocalDate,LocalDateTime,Date,æ—¥æœŸä¸²ç›¸äº’è½¬æ¢"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-02-06T11:24:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_æ¨ç€šåš"/> <meta itemprop="url" content="https://juejin.cn/user/1890815727123815"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LocalDate,LocalDateTime,Date,æ—¥æœŸä¸²ç›¸äº’è½¬æ¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1890815727123815/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _æ¨ç€šåš
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T11:24:26.000Z" title="Fri Feb 06 2026 11:24:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">LocalDate,LocalDateTime,Date,æ—¥æœŸä¸²ç›¸äº’è½¬æ¢</h2>
<h3 data-id="heading-1">1. è·å–å½“å‰æ—¶é—´ XXX.now()</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCurrentDate</span><span class="hljs-params">()</span> {
  <span class="hljs-type">LocalDate</span> <span class="hljs-variable">curLocalDate</span> <span class="hljs-operator">=</span> LocalDate.now();
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span>+curLocalDate.toString());
  <span class="hljs-type">LocalTime</span> <span class="hljs-variable">curLoacalTime</span> <span class="hljs-operator">=</span> LocalTime.now();
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span>+curLoacalTime.toString());
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">curLocalDateTime</span> <span class="hljs-operator">=</span> LocalDateTime.now();
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span>+curLocalDateTime.toString());
  <span class="hljs-type">Instant</span> <span class="hljs-variable">curInstant</span> <span class="hljs-operator">=</span> Instant.now();
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span>+ curInstant.toString());
}
</code></pre>
<p>è¾“å‡ºç»“æœ</p>
<pre><code class="hljs language-txt" lang="txt">åœ°å¿ƒä¾ å£«: 2026-02-04
åœ°å¿ƒä¾ å£«: 17:15:59.715639800
åœ°å¿ƒä¾ å£«: 2026-02-04T17:15:59.715639800
åœ°å¿ƒä¾ å£«: 2026-02-04T09:15:59.715639800Z
</code></pre>
<p>è¯´æ˜:</p>
<ul>
<li>LocalDate,LocalTime,LocalDateTimeéƒ½æ˜¯å½“å‰æ—¶åŒºå¯¹åº”æ—¥æœŸæˆ–æ—¶é—´</li>
<li>Instantè·å–åˆ°çš„æ˜¯UTC+0 æ—¥æœŸå’Œæ—¶é—´</li>
<li><strong>Z</strong> ä»£è¡¨é›¶æ—¶åŒºï¼ˆUTC+0ï¼‰ <strong>T</strong> æ—¥æœŸå’Œæ—¶é—´çš„åˆ†å‰²ç¬¦</li>
</ul>
<h3 data-id="heading-2">2. æ—¶é—´æˆ³è½¬æˆLocalDateTime</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTimestamp</span><span class="hljs-params">()</span> {
  <span class="hljs-type">Long</span> <span class="hljs-variable">timeStamp</span> <span class="hljs-operator">=</span> <span class="hljs-number">1769577638767L</span>;
  <span class="hljs-type">Instant</span> <span class="hljs-variable">instant</span> <span class="hljs-operator">=</span> Instant.ofEpochMilli(timeStamp);
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + instant.toString());
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">cvLocalDate</span> <span class="hljs-operator">=</span> LocalDateTime.ofInstant(instant, ZoneId.systemDefault());
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + cvLocalDate.toString());
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">localDateT1</span> <span class="hljs-operator">=</span> LocalDateTime.ofEpochSecond(timeStamp / <span class="hljs-number">1000</span>, <span class="hljs-number">0</span>, ZoneOffset.ofHours(<span class="hljs-number">8</span>));
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + localDateT1.toString());
}
</code></pre>
<p>è¾“å‡ºç»“æœ</p>
<pre><code class="hljs language-txt" lang="txt">åœ°å¿ƒä¾ å£«: 2026-01-28T05:20:38.767Z
åœ°å¿ƒä¾ å£«: 2026-01-28T13:20:38.767
åœ°å¿ƒä¾ å£«: 2026-01-28T13:20:38
</code></pre>
<p>è¯´æ˜:</p>
<ul>
<li>ä½¿ç”¨æ–¹æ³• LocalDateTime.ofInstant æˆ–è€… LocalDateTime.ofEpochSecond</li>
<li>ä½¿ç”¨ ofInstant ,æ¯«ç§’æ—¶é—´æˆ³å¯ä»¥ç›´æ¥ä½¿ç”¨</li>
<li>ä½¿ç”¨ ofEpochSecond ,æ¯«ç§’æ—¶é—´æˆ³éœ€è¦é™¤ä»¥1000</li>
<li>ofInstant ä½¿ç”¨ ZoneId.systemDefault() è·å–å½“æ—¶åŒº</li>
<li>OfEpochSecond ä½¿ç”¨ ZoneOffset.ofHours(8) æŒ‡å®šéœ€è¦çš„æ—¶åŒº</li>
<li>ZoneId.systemDefault() å½“å‰æ—¶åŒº,ç­‰åŒçš„æœ‰ <code>ZoneId.of("Asia/Shanghai")</code> <code>ZoneId.of("GMT+8")</code> <code>ZoneId.of("UTC+08:00")</code> <code>ZoneId.of("+08:00")</code></li>
</ul>
<h3 data-id="heading-3">3. æ—¶é—´ä¸²è½¬æ¢æˆLocalDateTime</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDateStr</span><span class="hljs-params">()</span> {
  <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">df</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss.SSS"</span>);
  <span class="hljs-type">String</span> <span class="hljs-variable">dateStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"2026-01-28 18:20:38.767"</span>;
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">localDateTime</span> <span class="hljs-operator">=</span> LocalDateTime.parse(dateStr, df);
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + localDateTime.toString());
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">defaultParse</span> <span class="hljs-operator">=</span> LocalDateTime.parse(<span class="hljs-string">"2026-01-28T18:20:38"</span>);
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + defaultParse.toString());
  <span class="hljs-type">DateTimeFormatterBuilder</span> <span class="hljs-variable">dfBuild</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTimeFormatterBuilder</span>();
  <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">dynmicDf</span> <span class="hljs-operator">=</span> dfBuild.appendPattern(<span class="hljs-string">"yyyy-MM-dd"</span>)
  		.optionalStart()
  		.appendLiteral(<span class="hljs-string">' '</span>)
  		.optionalEnd()
  		.optionalStart()
  		.appendLiteral(<span class="hljs-string">'T'</span>)
  		.optionalEnd()
  		.appendPattern(<span class="hljs-string">"HH:mm:ss"</span>)
  		.toFormatter();
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">dynamic1</span> <span class="hljs-operator">=</span> LocalDateTime.parse(<span class="hljs-string">"2026-01-28T18:20:38"</span>, dynmicDf);
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + dynamic1.toString());
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">dynamc2</span> <span class="hljs-operator">=</span> LocalDateTime.parse(<span class="hljs-string">"2026-01-28 18:20:38"</span>, dynmicDf);
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + dynamc2.toString());
}
</code></pre>
<p>è¾“å‡ºç»“æœ:</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">åœ°å¿ƒä¾ å£«: 2026-01-28T18:20:38.767</span>
<span class="hljs-section">åœ°å¿ƒä¾ å£«: 2026-01-28T18:20:38</span>
<span class="hljs-section">åœ°å¿ƒä¾ å£«: 2026-01-28T18:20:38</span>
<span class="hljs-section">åœ°å¿ƒä¾ å£«: 2026-01-28T18:20:38</span>
</code></pre>
<p>è¯´æ˜:</p>
<ul>
<li>ä½¿ç”¨æ–¹æ³•LocalDateTime.parseç»“åˆDateTimeFormatterè½¬æ¢</li>
<li>é»˜è®¤è½¬æ¢æ ¼å¼ä¸ºyyyy-MM-ddTHH:mm:ss</li>
<li>ä½¿ç”¨ <code>DateTimeFormatterBuilder</code> å¯ä»¥å®ç°å¤šç§æ—¥æœŸä¸²è½¬æ¢æˆLocalDateTime</li>
</ul>
<h3 data-id="heading-4">4. LocalDateTimeè½¬æ¢æˆæˆLocalDateå’ŒDate</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDateConvert</span><span class="hljs-params">()</span> {
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">dt</span> <span class="hljs-operator">=</span> LocalDateTime.now();
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£« "</span> + dt.toString());
  System.out.println(<span class="hljs-string">"LocalDateTime=&gt;LocalDate"</span>);
  <span class="hljs-type">LocalDate</span> <span class="hljs-variable">localDate</span> <span class="hljs-operator">=</span> dt.toLocalDate();
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£« "</span> + localDate.toString());
  System.out.println(<span class="hljs-string">"LocalDateTime=&gt;Date"</span>);
  <span class="hljs-type">Instant</span> <span class="hljs-variable">instant</span> <span class="hljs-operator">=</span> dt.toInstant(ZoneOffset.ofHours(<span class="hljs-number">8</span>));
  <span class="hljs-type">Date</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> Date.from(instant);
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£« "</span> + d);
}
</code></pre>
<p>è¾“å‡ºç»“æœ:</p>
<pre><code class="hljs language-txt" lang="txt">åœ°å¿ƒä¾ å£« 2026-02-06T19:09:35.092605300
LocalDateTime=&gt;LocalDate
åœ°å¿ƒä¾ å£« 2026-02-06
LocalDateTime=&gt;Date
åœ°å¿ƒä¾ å£« Fri Feb 06 19:09:35 CST 2026
</code></pre>
<h3 data-id="heading-5">5. Date è½¬æ¢æˆLocalDateTime</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDateConvert2</span><span class="hljs-params">()</span> {
  <span class="hljs-type">Date</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£« "</span> + date.toString());
  System.out.println(<span class="hljs-string">"Date=&gt;LocalDateTime"</span>);
  <span class="hljs-type">Instant</span> <span class="hljs-variable">instant</span> <span class="hljs-operator">=</span> date.toInstant();
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">lcd</span> <span class="hljs-operator">=</span> LocalDateTime.ofInstant(instant, ZoneId.systemDefault());
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£« "</span> + lcd.toString());
}
</code></pre>
<p>è¾“å‡ºç»“æœ:</p>
<pre><code class="hljs language-txt" lang="txt">åœ°å¿ƒä¾ å£« Fri Feb 06 19:15:38 CST 2026
Date=&gt;LocalDateTime
åœ°å¿ƒä¾ å£« 2026-02-06T19:15:38.122

</code></pre>
<h3 data-id="heading-6">6. åŒ—äº¬æ—¶é—´æ—¶åŒºè¡¨ç¤º</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testZone</span><span class="hljs-params">()</span> {
  <span class="hljs-type">ZoneId</span> <span class="hljs-variable">zonidGMT8</span> <span class="hljs-operator">=</span> ZoneId.of(<span class="hljs-string">"GMT+8"</span>);
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">gmt8</span> <span class="hljs-operator">=</span> LocalDateTime.ofInstant(Instant.now(), zonidGMT8);
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + gmt8.toString());
  <span class="hljs-type">ZoneId</span> <span class="hljs-variable">zonidAS</span> <span class="hljs-operator">=</span> ZoneId.of(<span class="hljs-string">"Asia/Shanghai"</span>);
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">as</span> <span class="hljs-operator">=</span> LocalDateTime.ofInstant(Instant.now(), zonidAS);
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + as.toString());
  <span class="hljs-type">ZoneId</span> <span class="hljs-variable">zonidUTC8</span> <span class="hljs-operator">=</span> ZoneId.of(<span class="hljs-string">"UTC+08:00"</span>);
  <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">utc</span> <span class="hljs-operator">=</span> LocalDateTime.ofInstant(Instant.now(), zonidUTC8);
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + utc.toString());
  <span class="hljs-type">ZoneId</span> <span class="hljs-variable">zonid8</span> <span class="hljs-operator">=</span> ZoneId.of(<span class="hljs-string">"+08:00"</span>);
  LocalDateTime ad8= LocalDateTime.ofInstant(Instant.now(), zonid8);
  System.out.println(<span class="hljs-string">"åœ°å¿ƒä¾ å£«: "</span> + ad8.toString());
}
</code></pre>
<p>è¾“å‡ºç»“æœ:</p>
<pre><code class="hljs language-txt" lang="txt">åœ°å¿ƒä¾ å£«: 2026-02-06T18:35:26.921795200
åœ°å¿ƒä¾ å£«: 2026-02-06T18:35:26.928776600
åœ°å¿ƒä¾ å£«: 2026-02-06T18:35:26.928776600
åœ°å¿ƒä¾ å£«: 2026-02-06T18:35:26.928776600
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FvH0TJKl89CfV3ehvHllgNg" target="_blank" title="https://mp.weixin.qq.com/s/vH0TJKl89CfV3ehvHllgNg" ref="nofollow noopener noreferrer">åŸæ–‡åœ°å€:https://mp.weixin.qq.com/s/vH0TJKl89CfV3ehvHllgNg</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è„šæœ¬ä¼ªè£…ï¼šè®© Python ä¸ Node.js åƒåŸç”Ÿ Shell å‘½ä»¤ä¸€æ ·è¿è¡Œ]]></title>    <link>https://juejin.cn/post/7603591775391973403</link>    <guid>https://juejin.cn/post/7603591775391973403</guid>    <pubDate>2026-02-07T01:59:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603591775391973403" data-draft-id="7603584155785379890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è„šæœ¬ä¼ªè£…ï¼šè®© Python ä¸ Node.js åƒåŸç”Ÿ Shell å‘½ä»¤ä¸€æ ·è¿è¡Œ"/> <meta itemprop="keywords" content="JavaScript,Python,è¿ç»´"/> <meta itemprop="datePublished" content="2026-02-07T01:59:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è„šæœ¬ä¼ªè£…ï¼šè®© Python ä¸ Node.js åƒåŸç”Ÿ Shell å‘½ä»¤ä¸€æ ·è¿è¡Œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:59:16.000Z" title="Sat Feb 07 2026 01:59:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¼€å‘è‡ªåŠ¨åŒ–å·¥å…·æˆ–å‘½ä»¤è¡Œå°ç©å…·æ—¶ï¼Œé¢‘ç¹è¾“å…¥ <code>python myscript.py</code> æˆ– <code>node index.js</code> éš¾å…æ˜¾å¾—ç¬¨æ‹™ã€‚ä¸ºäº†è®©è¿™äº›è„šæœ¬çœ‹èµ·æ¥æ›´åƒç³»ç»ŸåŸç”Ÿçš„äºŒè¿›åˆ¶å·¥å…·ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œâ€œä¼ªè£…â€ã€‚</p>
<p>æœ¬æ–‡å°†å¸¦ä½ æ”»å…‹ Linux å’Œ Windows ä¸¤å¤§å¹³å°ï¼Œå®ç°è„šæœ¬çš„ç›´æ¥è°ƒç”¨ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ Linux ç¯å¢ƒï¼šåˆ©ç”¨ Shebang å®ç°ä¼˜é›…è°ƒç”¨</h2>
<p>åœ¨ç±» Unix ç³»ç»Ÿï¼ˆLinux, macOS, BSDï¼‰ä¸­ï¼Œå†…æ ¸æ”¯æŒä¸€ç§åä¸º <strong>Shebang</strong> çš„æœºåˆ¶ã€‚é€šè¿‡åœ¨æ–‡ä»¶å¤´éƒ¨æŒ‡å®šè§£é‡Šå™¨è·¯å¾„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ç›¸åº”çš„ç¯å¢ƒæ¥è¿è¡Œä»£ç ã€‚</p>
<h4 data-id="heading-1">1. æ ¸å¿ƒæ­¥éª¤ï¼šShebang + å¯æ‰§è¡Œæƒé™</h4>
<p>è¦åœ¨ Linux ä¸Šå®ç°â€œä¼ªè£…â€ï¼Œä½ éœ€è¦å®Œæˆä»¥ä¸‹ä¸¤ä¸ªåŠ¨ä½œï¼š</p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šåœ¨è„šæœ¬é¦–è¡Œæ·»åŠ  Shebang</strong>
æ¨èä½¿ç”¨ <code>/usr/bin/env</code> æ–¹å¼ï¼Œå®ƒä¼šè‡ªåŠ¨ä»ç”¨æˆ·çš„ <code>PATH</code> ç¯å¢ƒå˜é‡ä¸­å¯»æ‰¾è§£é‡Šå™¨ï¼Œå…·æœ‰æå¼ºçš„å¯ç§»æ¤æ€§ã€‚</p>
<ul>
<li><strong>Python ç¤ºä¾‹ï¼š</strong></li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">import</span> sys
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Python æ­£åœ¨è¿è¡Œï¼Œå‚æ•°ä¸º: <span class="hljs-subst">{sys.argv[<span class="hljs-number">1</span>:]}</span>"</span>)

</code></pre>
<ul>
<li><strong>Node.js ç¤ºä¾‹ï¼š</strong></li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Node.js è„šæœ¬å·²å¯åŠ¨ï¼Œå½“å‰å·¥ä½œç›®å½•:"</span>, process.<span class="hljs-title function_">cwd</span>());

</code></pre>
<p><strong>ç¬¬äºŒæ­¥ï¼šèµ‹äºˆæ‰§è¡Œæƒé™</strong>
åœ¨ç»ˆç«¯è¿è¡Œ <code>chmod +x</code> å‘½ä»¤ï¼Œå‘Šè¯‰æ–‡ä»¶ç³»ç»Ÿè¯¥æ–‡ä»¶å¯ä»¥è¢«æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x my_script.py

</code></pre>
<p>æ­¤æ—¶ï¼Œä½ å°±å¯ä»¥é€šè¿‡ <code>./my_script.py</code> ç›´æ¥è¿è¡Œå®ƒäº†ã€‚</p>
<h4 data-id="heading-2">2. è¿›é˜¶ï¼šå»é™¤åç¼€å¹¶å…¨å±€åŒ–</h4>
<p>å¦‚æœä½ æƒ³åœ¨ä»»ä½•è·¯å¾„ä¸‹é€šè¿‡è¾“å…¥ <code>mytool</code>ï¼ˆè€Œä¸æ˜¯ <code>./mytool.py</code>ï¼‰æ¥è¿è¡Œè„šæœ¬ï¼š</p>
<ol>
<li><strong>é‡å‘½åå¹¶å»æ‰åç¼€</strong>ï¼š<code>mv my_script.py mytool</code></li>
<li><strong>ç§»å…¥ PATH è·¯å¾„</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mv</span> mytool /usr/local/bin/

</code></pre>
<p><em>æ³¨ï¼š<code>/usr/local/bin</code> é€šå¸¸é»˜è®¤åœ¨ç³»ç»Ÿ PATH ä¸­ï¼Œè¿™æ ·ä½ åªéœ€è¾“å…¥ <code>mytool</code> å³å¯ç›´æ¥è§¦å‘ã€‚</em></p>
<hr/>
<h2 data-id="heading-3">äºŒã€ Windows ç¯å¢ƒï¼šä»æ‰¹å¤„ç†åˆ°ç¯å¢ƒå…³è”</h2>
<p>Windows å¹¶ä¸åŸç”Ÿæ”¯æŒ Shebang æœºåˆ¶ï¼ˆé™¤éåœ¨ WSL å†…éƒ¨è¿è¡Œï¼‰ã€‚å®ƒä¸»è¦ä¾é <strong>æ–‡ä»¶æ‰©å±•åå…³è”</strong>ã€‚</p>
<h4 data-id="heading-4">1. æ–¹æ¡ˆ Aï¼šä½¿ç”¨ .bat åŒ…è£…å™¨ï¼ˆæ¨èï¼‰</h4>
<p>è¿™æ˜¯æœ€ç¨³å¦¥çš„æ–¹æ³•ã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªç®€å•çš„æ‰¹å¤„ç†æ–‡ä»¶ï¼Œå°†æ¥æ”¶åˆ°çš„æ‰€æœ‰å‚æ•°ï¼ˆç”¨ <code>%*</code> è¡¨ç¤ºï¼‰è½¬å‘ç»™è„šæœ¬è§£é‡Šå™¨ã€‚</p>
<ul>
<li><strong>åˆ›å»º <code>mytool.bat</code>ï¼š</strong></li>
</ul>
<pre><code class="hljs language-batch" lang="batch">@echo off
python "C:\scripts\my_script.py" %*

</code></pre>
<p><em>æ³¨ï¼š<code>@echo off</code> ç”¨äºéšè—å‘½ä»¤æœ¬èº«çš„æ‰§è¡Œè¡Œï¼Œ<code>%*</code> ç¡®ä¿ä½ ä¼ é€’ç»™ <code>.bat</code> çš„å‚æ•°èƒ½åŸå°ä¸åŠ¨åœ°ä¼ ç»™ Pythonã€‚</em></p>
<h4 data-id="heading-5">2. æ–¹æ¡ˆ Bï¼šåˆ©ç”¨æ–‡ä»¶å…³è”</h4>
<p>å¦‚æœä½ å®‰è£… Python æ—¶å‹¾é€‰äº† <strong>"Add Python to PATH"</strong>ï¼ŒWindows ä¼šè‡ªåŠ¨å°† <code>.py</code> æ–‡ä»¶å…³è”åˆ° <code>python.exe</code>ã€‚</p>
<ul>
<li>åœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥ <code>script.py</code> å³å¯è¿è¡Œã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼š<code>.js</code> æ–‡ä»¶åœ¨ Windows ä¸Šé»˜è®¤å…³è”çš„æ˜¯è€æ—§çš„ <code>WScript</code> (Windows Script Host)ï¼Œè¿™ä¼šå¯¼è‡´è¿è¡Œ Node.js è„šæœ¬æ—¶æŠ¥é”™ã€‚ä½ éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ <code>.js</code> çš„æ‰“å¼€æ–¹å¼ä¸º <code>node.exe</code>ã€‚</li>
</ul>
<h4 data-id="heading-6">3. æ–¹æ¡ˆ Cï¼šPowerShell åˆ«åï¼ˆAliasï¼‰</h4>
<p>å¦‚æœä½ æ˜¯ PowerShell ç”¨æˆ·ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰å‡½æ•°æ¥å®ç°ï¼š</p>
<pre><code class="hljs language-powershell" lang="powershell"># åœ¨ $PROFILE æ–‡ä»¶ä¸­æ·»åŠ 
function Run-MyTool { python "C:\path\to\script.py" $args }
Set-Alias -Name mytool -Value Run-MyTool

</code></pre>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€ è·¨å¹³å°å¯¹æ¯”æ€»ç»“</h2>






























<table><thead><tr><th>ç‰¹æ€§</th><th>Linux / macOS</th><th>Windows</th></tr></thead><tbody><tr><td><strong>åº•å±‚æœºåˆ¶</strong></td><td>Shebang (<code>#!</code>)</td><td>æ–‡ä»¶åç¼€åå…³è”</td></tr><tr><td><strong>æ¨èåšæ³•</strong></td><td><code>chmod +x</code> + <code>/usr/bin/env</code></td><td><code>.bat</code> æˆ– <code>.cmd</code> åŒ…è£…</td></tr><tr><td><strong>å…¨å±€è°ƒç”¨</strong></td><td>æ”¾å…¥ <code>/usr/local/bin</code></td><td>å°†è„šæœ¬æ‰€åœ¨æ–‡ä»¶å¤¹åŠ å…¥ç¯å¢ƒå˜é‡ <code>Path</code></td></tr><tr><td><strong>å‚æ•°ä¼ é€’</strong></td><td>åŸç”Ÿæ”¯æŒ</td><td>éœ€åœ¨æ‰¹å¤„ç†ä¸­ä½¿ç”¨ <code>%*</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">å››ã€ ç»“è®ºä¸è¡ŒåŠ¨å»ºè®®</h2>
<p>å°†è„šæœ¬è½¬åŒ–ä¸ºå·¥å…·ä¸ä»…æ˜¯ä¸ºäº†â€œå¥½çœ‹â€ï¼Œæ›´æ˜¯ä¸ºäº†æå‡è‡ªåŠ¨åŒ–æµè½¬çš„æ•ˆç‡ã€‚</p>
<h4 data-id="heading-9">æ ¸å¿ƒè¡ŒåŠ¨å»ºè®®ï¼š</h4>
<ol>
<li>**ä¼˜å…ˆä½¿ç”¨ <code>/usr/bin/env**</code>ï¼šæ— è®ºå¼€å‘ä»€ä¹ˆè„šæœ¬ï¼Œé¦–è¡Œå…»æˆå†™ Shebang çš„ä¹ æƒ¯ï¼Œè¿™èƒ½æ˜¾è‘—é™ä½ Linux ç”¨æˆ·çš„ä½¿ç”¨é—¨æ§›ã€‚</li>
<li><strong>å°è£…ä¸ºå·¥å…·åŒ…</strong>ï¼šå¦‚æœä½ çš„è„šæœ¬è¾ƒå¤šï¼Œå»ºè®®å°†å…¶ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼ˆå¦‚ <code>~/bin</code> æˆ– <code>C:\tools</code>ï¼‰ï¼Œå¹¶å°†è¯¥ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿçš„ <code>PATH</code> ç¯å¢ƒå˜é‡ä¸­ã€‚</li>
<li><strong>å¤„ç†è·¨å¹³å°å·®å¼‚</strong>ï¼šå¯¹äºéœ€è¦è·¨å¹³å°åˆ†å‘çš„å·¥å…·ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>poetry</code> (Python) æˆ– <code>npm bin</code> (Node.js) æä¾›çš„ Entry Points åŠŸèƒ½ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆé€‚é…å„å¹³å°çš„å¯åŠ¨å™¨ã€‚</li>
</ol>
<hr/>
<p><strong>å‚è€ƒæ¥æºï¼š</strong></p>
<ul>
<li>Linux Manual Pages: <a href="https://link.juejin.cn?target=https%3A%2F%2Fman7.org%2Flinux%2Fman-pages%2Fman2%2Fexecve.2.html" target="_blank" title="https://man7.org/linux/man-pages/man2/execve.2.html" ref="nofollow noopener noreferrer">execve(2) - Shebang mechanism</a></li>
<li>Python Documentation: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.python.org%2F3%2Fusing%2Fwindows.html" target="_blank" title="https://docs.python.org/3/using/windows.html" ref="nofollow noopener noreferrer">Using Python on Windows</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ«ç¯å¢ƒé…ç½®å™©æ¢¦ï¼RustFS + Docker ç»ˆæéƒ¨ç½²æŒ‡å—ï¼Œä»é›¶ç›´è¾¾ç”Ÿäº§ç¯å¢ƒ]]></title>    <link>https://juejin.cn/post/7603383311531327503</link>    <guid>https://juejin.cn/post/7603383311531327503</guid>    <pubDate>2026-02-06T12:18:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603383311531327503" data-draft-id="7603355275258511400" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«ç¯å¢ƒé…ç½®å™©æ¢¦ï¼RustFS + Docker ç»ˆæéƒ¨ç½²æŒ‡å—ï¼Œä»é›¶ç›´è¾¾ç”Ÿäº§ç¯å¢ƒ"/> <!----> <meta itemprop="datePublished" content="2026-02-06T12:18:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¯¹è±¡å­˜å‚¨ä¸RustFS"/> <meta itemprop="url" content="https://juejin.cn/user/652466093570057"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«ç¯å¢ƒé…ç½®å™©æ¢¦ï¼RustFS + Docker ç»ˆæéƒ¨ç½²æŒ‡å—ï¼Œä»é›¶ç›´è¾¾ç”Ÿäº§ç¯å¢ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/652466093570057/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¯¹è±¡å­˜å‚¨ä¸RustFS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:18:05.000Z" title="Fri Feb 06 2026 12:18:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‘Šåˆ«ç¯å¢ƒé…ç½®å™©æ¢¦ï¼RustFS + Docker ç»ˆæéƒ¨ç½²æŒ‡å—ï¼Œä»é›¶ç›´è¾¾ç”Ÿäº§ç¯å¢ƒ</h2>
<p>å…„å¼Ÿä»¬ï¼Œä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰è¢«ç¯å¢ƒé…ç½®æŠ˜ç£¨åˆ°æ€€ç–‘äººç”Ÿï¼Ÿåæ­£æˆ‘æ˜¯å—å¤Ÿäº†ï¼ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥ä¸€ä»½ä¿å§†çº§æ•™ç¨‹â€”â€”ç”¨Dockeréƒ¨ç½²RustFSå¯¹è±¡å­˜å‚¨ï¼Œä»å®‰è£…åˆ°ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼Œæ‰‹æŠŠæ‰‹å¸¦ä½ é¿å¼€æ‰€æœ‰å‘ï¼</p>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆè¦é€‰æ‹©RustFS + Dockerï¼Ÿ</h3>
<p>å…ˆè¯´è¯´æˆ‘çš„è¡€æ³ªå²ï¼šä¹‹å‰åœ¨å…¬å¸éƒ¨ç½²MinIOï¼Œå…‰ä¾èµ–åŒ…å°±è£…äº†ä¸€ä¸‹åˆï¼Œç‰ˆæœ¬å†²çªã€æƒé™é—®é¢˜å±‚å‡ºä¸ç©·ã€‚ç›´åˆ°å‘ç°äº†RustFSè¿™ä¸ªå®è—é¡¹ç›®ï¼Œç»“åˆDockerçš„å®¹å™¨åŒ–ä¼˜åŠ¿ï¼ŒçœŸé¦™ï¼</p>
<p><strong>ä¸‰å¤§ä¼˜åŠ¿è®©ä½ æ— æ³•æ‹’ç»ï¼š</strong></p>
<ul>
<li>ğŸš€ æ€§èƒ½ç¢¾å‹ï¼šæ¯”MinIOå¿«2.3å€ï¼Œè°ç”¨è°çŸ¥é“</li>
<li>ğŸ“¦ å¼€ç®±å³ç”¨ï¼šDockeré•œåƒåŒ…å«æ‰€æœ‰ä¾èµ–ï¼Œå‘Šåˆ«ç¯å¢ƒå†²çª</li>
<li>ğŸ”§ ç”Ÿäº§å°±ç»ªï¼šæ”¯æŒé«˜å¯ç”¨ã€ç›‘æ§ã€å¤‡ä»½ï¼Œç›´æ¥ä¸Šçº¿æ— å¿§</li>
</ul>
<h3 data-id="heading-2">ä¸€ã€ç¯å¢ƒå‡†å¤‡ï¼ˆ5åˆ†é’Ÿæå®šï¼‰</h3>
<h4 data-id="heading-3">1.1 å®‰è£…Dockerå’ŒDocker Compose</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Ubuntu/CentOS ä¸€é”®å®‰è£…</span>
curl -fsSL https://get.docker.com | sh
sudo systemctl start docker
sudo systemctl <span class="hljs-built_in">enable</span> docker

<span class="hljs-comment"># å®‰è£…Docker Compose</span>
sudo curl -L <span class="hljs-string">"https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-<span class="hljs-subst">$(uname -s)</span>-<span class="hljs-subst">$(uname -m)</span>"</span> -o /usr/local/bin/docker-compose
sudo <span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose
</code></pre>
<h4 data-id="heading-4">1.2 åˆ›å»ºé¡¹ç›®ç›®å½•</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p rustfs-production/{data,logs,config}
<span class="hljs-built_in">cd</span> rustfs-production
</code></pre>
<p>â€‹<strong>é‡è¦æç¤º</strong>ï¼šè¿™é‡Œå…ˆä¸è¦æ€¥ç€æ”¹æƒé™ï¼Œåé¢ä¼šå‘Šè¯‰ä½ ä¸ºä»€ä¹ˆï¼</p>
<h3 data-id="heading-5">äºŒã€å•æœºç‰ˆå¿«é€Ÿä½“éªŒï¼ˆ10åˆ†é’Ÿä¸Šæ‰‹ï¼‰</h3>
<h4 data-id="heading-6">2.1 æœ€ç®€å•çš„å¯åŠ¨æ–¹å¼</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç›´æ¥è¿è¡Œï¼Œé€‚åˆæµ‹è¯•ç¯å¢ƒ</span>
docker run -d \
  --name rustfs \
  -p 9000:9000 \
  -p 9001:9001 \
  -v $(<span class="hljs-built_in">pwd</span>)/data:/data \
  -v $(<span class="hljs-built_in">pwd</span>)/logs:/logs \
  rustfs/rustfs:latest
</code></pre>
<p>è®¿é—® <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A9000%2F" target="_blank" title="http://localhost:9000/" ref="nofollow noopener noreferrer">http://localhost:9000</a>ï¼Œç”¨æˆ·åå¯†ç éƒ½æ˜¯ <code>rustfsadmin</code>ï¼Œç¬é—´æ‹¥æœ‰ä¸€ä¸ªå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼</p>
<h4 data-id="heading-7">2.2 é‡åˆ°æƒé™é—®é¢˜ï¼Ÿè¿™æ ·è§£å†³ï¼</h4>
<p>å¾ˆå¤šæ•™ç¨‹ä¼šå‘Šè¯‰ä½ ç›´æ¥chownï¼Œå…¶å®æœ‰æ›´ä¼˜é›…çš„æ–¹å¼ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰Dockerfile</span>
FROM rustfs/rustfs:latest
USER root
RUN <span class="hljs-built_in">mkdir</span> -p /app_data &amp;&amp; <span class="hljs-built_in">chown</span> -R 10001:10001 /app_data
USER 10001
</code></pre>
<p>æˆ–è€…ç›´æ¥åœ¨docker-composeä¸­å¤„ç†ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">rustfs:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">rustfs/rustfs:latest</span>
    <span class="hljs-attr">user:</span> <span class="hljs-string">"10001:10001"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./data:/data</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./logs:/logs</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">&gt;
      sh -c "
        chown -R 10001:10001 /data /logs &amp;&amp;
        /entrypoint.sh server /data
      "
</span></code></pre>
<h3 data-id="heading-8">ä¸‰ã€ç”Ÿäº§ç¯å¢ƒå®Œæ•´é…ç½®ï¼ˆä¼ä¸šçº§éƒ¨ç½²ï¼‰</h3>
<h4 data-id="heading-9">3.1 å®Œæ•´çš„docker-compose.yml</h4>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">rustfs:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">rustfs/rustfs:1.0.0-alpha.69</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">rustfs</span>
    <span class="hljs-attr">hostname:</span> <span class="hljs-string">rustfs</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    
    <span class="hljs-comment"># ç«¯å£é…ç½®</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9000:9000"</span>  <span class="hljs-comment"># APIç«¯å£</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9001:9001"</span>  <span class="hljs-comment"># æ§åˆ¶å°ç«¯å£</span>
    
    <span class="hljs-comment"># æ•°æ®å·</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./data:/data</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./logs:/logs</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./config:/config</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/localtime:/etc/localtime:ro</span>
    
    <span class="hljs-comment"># ç¯å¢ƒå˜é‡é…ç½®</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_ACCESS_KEY=ä½ çš„è®¿é—®å¯†é’¥</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_SECRET_KEY=ä½ çš„å®‰å…¨å¯†é’¥</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_REGION=cn-east-1</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_BROWSER=on</span>
      
    <span class="hljs-comment"># èµ„æºé™åˆ¶</span>
    <span class="hljs-attr">deploy:</span>
      <span class="hljs-attr">resources:</span>
        <span class="hljs-attr">limits:</span>
          <span class="hljs-attr">memory:</span> <span class="hljs-string">2G</span>
          <span class="hljs-attr">cpus:</span> <span class="hljs-string">'1.0'</span>
        <span class="hljs-attr">reservations:</span>
          <span class="hljs-attr">memory:</span> <span class="hljs-string">1G</span>
          <span class="hljs-attr">cpus:</span> <span class="hljs-string">'0.5'</span>
    
    <span class="hljs-comment"># å¥åº·æ£€æŸ¥</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"curl"</span>, <span class="hljs-string">"-f"</span>, <span class="hljs-string">"http://localhost:9000/minio/health/live"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span>
      <span class="hljs-attr">start_period:</span> <span class="hljs-string">40s</span>

  <span class="hljs-comment"># Redisç¼“å­˜ï¼ˆå¯é€‰ï¼‰</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7-alpine</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis_data:/data</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">--appendonly</span> <span class="hljs-literal">yes</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">redis_data:</span>
</code></pre>
<h4 data-id="heading-10">3.2 å¯åŠ¨å‘½ä»¤å’ŒéªŒè¯</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯åŠ¨æœåŠ¡</span>
docker-compose up -d

<span class="hljs-comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span>
docker-compose ps

<span class="hljs-comment"># æŸ¥çœ‹æ—¥å¿—</span>
docker-compose logs -f rustfs

<span class="hljs-comment"># å¥åº·æ£€æŸ¥</span>
docker inspect --format=<span class="hljs-string">'{{.State.Health.Status}}'</span> rustfs
</code></pre>
<h3 data-id="heading-11">å››ã€æ€§èƒ½ä¼˜åŒ–é…ç½®ï¼ˆè®©RustFSé£èµ·æ¥ï¼‰</h3>
<h4 data-id="heading-12">4.1 ä¼˜åŒ–å­˜å‚¨æ€§èƒ½</h4>
<pre><code class="hljs language-bash" lang="bash">environment:
  - RUSTFS_CACHE_DRIVES=/data/cache
  - RUSTFS_CACHE_MAXSIZE=80
  - RUSTFS_CACHE_EXPIRY=90
  - RUSTFS_CACHE_QUOTA=70
</code></pre>
<h4 data-id="heading-13">4.2 ç½‘ç»œä¼˜åŒ–</h4>
<pre><code class="hljs language-bash" lang="bash">sysctls:
  - net.core.somaxconn=1024
  - net.ipv4.tcp_max_syn_backlog=1024
ulimits:
  nofile:
    soft: 65536
    hard: 65536
</code></pre>
<h3 data-id="heading-14">äº”ã€ç›‘æ§å’Œæ—¥å¿—ç®¡ç†ï¼ˆè¿ç»´å¿…å¤‡ï¼‰</h3>
<h4 data-id="heading-15">5.1 é›†æˆPrometheusç›‘æ§</h4>
<pre><code class="hljs language-bash" lang="bash">environment:
  - RUSTFS_PROMETHEUS_AUTH_TYPE=public
  - RUSTFS_PROMETHEUS_URL=http://prometheus:9090
</code></pre>
<h4 data-id="heading-16">5.2 æ—¥å¿—é…ç½®</h4>
<p>åˆ›å»º <code>config/logging.json</code>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"formatters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"detailed"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"%(asctime)s %(name)-15s %(levelname)-8s %(message)s"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"handlers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"file"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"class"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"logging.handlers.RotatingFileHandler"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"filename"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/logs/rustfs.log"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"maxBytes"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10485760</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"backupCount"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"root"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"level"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"INFO"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"handlers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"file"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-17">å…­ã€å¤‡ä»½å’Œæ¢å¤ï¼ˆæ•°æ®å®‰å…¨ç¬¬ä¸€ï¼‰</h3>
<h4 data-id="heading-18">6.1 è‡ªåŠ¨å¤‡ä»½è„šæœ¬</h4>
<p>åˆ›å»º <code>scripts/backup.sh</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
BACKUP_DIR=<span class="hljs-string">"/backup/<span class="hljs-subst">$(date +%Y%m%d)</span>"</span>
<span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$BACKUP_DIR</span>

<span class="hljs-comment"># å¤‡ä»½å…ƒæ•°æ®</span>
docker <span class="hljs-built_in">exec</span> rustfs tar czf /data/metadata.tar.gz /data/.metadata
docker <span class="hljs-built_in">cp</span> rustfs:/data/metadata.tar.gz <span class="hljs-variable">$BACKUP_DIR</span>/

<span class="hljs-comment"># å¤‡ä»½é…ç½®</span>
tar czf <span class="hljs-variable">$BACKUP_DIR</span>/config.tar.gz ./config

<span class="hljs-built_in">echo</span> <span class="hljs-string">"å¤‡ä»½å®Œæˆ: <span class="hljs-variable">$BACKUP_DIR</span>"</span>
</code></pre>
<h4 data-id="heading-19">6.2 è®¾ç½®å®šæ—¶ä»»åŠ¡</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½</span>
0 2 * * * /opt/rustfs/scripts/backup.sh
</code></pre>
<h3 data-id="heading-20">ä¸ƒã€å¸¸è§é—®é¢˜æ’å‘æŒ‡å—</h3>
<h4 data-id="heading-21">é—®é¢˜1ï¼šæ§åˆ¶å°æ— æ³•è®¿é—®</h4>
<p>â€‹<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ£€æŸ¥é˜²ç«å¢™å’ŒSELinux</p>
<pre><code class="hljs language-bash" lang="bash">sudo firewall-cmd --add-port=9000-9001/tcp --permanent
sudo firewall-cmd --reload
</code></pre>
<h4 data-id="heading-22">é—®é¢˜2ï¼šå­˜å‚¨ç©ºé—´ä¸è¶³</h4>
<p>â€‹<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨å¤–éƒ¨å­˜å‚¨</p>
<pre><code class="hljs language-bash" lang="bash">volumes:
  - /mnt/nas/rustfs_data:/data
</code></pre>
<h4 data-id="heading-23">é—®é¢˜3ï¼šæ€§èƒ½ç“¶é¢ˆ</h4>
<p>â€‹<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå¯ç”¨SSDç¼“å­˜å’Œè°ƒæ•´å‚æ•°</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">environment:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_READ_AFTER_WRITE_QUORUM=1</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_WRITE_QUORUM=1</span>
</code></pre>
<h3 data-id="heading-24">å…«ã€æœ€ç»ˆçš„ç”Ÿäº§çº§éƒ¨ç½²è„šæœ¬</h3>
<p>åˆ›å»º <code>deploy-production.sh</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">set</span> -e

<span class="hljs-built_in">echo</span> <span class="hljs-string">"å¼€å§‹éƒ¨ç½²RustFSç”Ÿäº§ç¯å¢ƒ..."</span>

<span class="hljs-comment"># æ£€æŸ¥Docker</span>
<span class="hljs-keyword">if</span> ! <span class="hljs-built_in">command</span> -v docker &amp;&gt; /dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"å®‰è£…Docker..."</span>
    curl -fsSL https://get.docker.com | sh
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># åˆ›å»ºç½‘ç»œ</span>
docker network create rustfs-net 2&gt;/dev/null || <span class="hljs-literal">true</span>

<span class="hljs-comment"># å¯åŠ¨æœåŠ¡</span>
docker-compose down
docker-compose up -d

<span class="hljs-comment"># ç­‰å¾…æœåŠ¡å°±ç»ª</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ç­‰å¾…æœåŠ¡å¯åŠ¨..."</span>
<span class="hljs-built_in">sleep</span> 30

<span class="hljs-comment"># éªŒè¯éƒ¨ç½²</span>
<span class="hljs-keyword">if</span> curl -f http://localhost:9000/minio/health/live; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"RustFSéƒ¨ç½²æˆåŠŸï¼"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"æ§åˆ¶å°åœ°å€: http://ä½ çš„IP:9001"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"APIåœ°å€: http://ä½ çš„IP:9000"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"éƒ¨ç½²å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"</span>
    docker-compose logs rustfs
<span class="hljs-keyword">fi</span>
</code></pre>
<h3 data-id="heading-25">å†™åœ¨æœ€å</h3>
<p>è¯´å®è¯ï¼Œç¬¬ä¸€æ¬¡ç”¨Dockeréƒ¨ç½²RustFSçš„æ—¶å€™ï¼Œæˆ‘çœŸçš„è¢«è¿™ç§ç®€æ´é«˜æ•ˆçš„æ–¹å¼éœ‡æƒŠäº†ã€‚ä»ç¯å¢ƒé…ç½®åˆ°ç”Ÿäº§éƒ¨ç½²ï¼ŒåŸæœ¬éœ€è¦ä¸€å¤©çš„å·¥ä½œç°åœ¨åŠå°æ—¶æå®šã€‚</p>
<p>â€‹<strong>æœ€é‡è¦çš„å»ºè®®</strong>ï¼š</p>
<ol>
<li>ä¸€å®šè¦åšå¥½æ•°æ®å¤‡ä»½</li>
<li>ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…é…ç½®èµ„æºé™åˆ¶</li>
<li>å®šæœŸæ›´æ–°åˆ°ç¨³å®šç‰ˆæœ¬</li>
</ol>
<p>è¿™ä»½æŒ‡å—æ˜¯æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­æ€»ç»“å‡ºæ¥çš„ç²¾åï¼Œåº”è¯¥èƒ½å¸®ä½ é¿å¼€90%çš„å‘ã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµï¼</p>
<p>è®°å¾—ç»™æ–‡ç« ç‚¹ä¸ªèµï¼Œæ”¶è—ä¸è¿·è·¯ï¼ä¸‹æ¬¡ç»™å¤§å®¶åˆ†äº«RustFSçš„é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²æ–¹æ¡ˆï½</p>
<hr/>
<p>ä»¥ä¸‹æ˜¯æ·±å…¥å­¦ä¹  RustFS çš„æ¨èèµ„æºï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frustfs%2Frustfs" target="_blank" title="https://github.com/rustfs/rustfs" ref="nofollow noopener noreferrer">RustFS</a></p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fdocs.rustfs.com%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//docs.rustfs.com/" ref="nofollow noopener noreferrer">RustFS å®˜æ–¹æ–‡æ¡£</a>- æä¾›æ¶æ„ã€å®‰è£…æŒ‡å—å’Œ API å‚è€ƒã€‚</p>
<p>GitHub ä»“åº“ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fdocs.rustfs.com%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//docs.rustfs.com/" ref="nofollow noopener noreferrer">GitHub ä»“åº“</a> - è·å–æºä»£ç ã€æäº¤é—®é¢˜æˆ–è´¡çŒ®ä»£ç ã€‚</p>
<p>ç¤¾åŒºæ”¯æŒï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Forgs%2Frustfs%2Fdiscussions" target="_blank" title="https://link.zhihu.com/?target=https%3A//github.com/orgs/rustfs/discussions" ref="nofollow noopener noreferrer">GitHub Discussions</a>- ä¸å¼€å‘è€…äº¤æµç»éªŒå’Œè§£å†³æ–¹æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <!----></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[springbooté›†æˆElasticsearchå’Œç®€å•åº”ç”¨]]></title>    <link>https://juejin.cn/post/7603567912592375835</link>    <guid>https://juejin.cn/post/7603567912592375835</guid>    <pubDate>2026-02-06T14:01:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912592375835" data-draft-id="7603321550247837746" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="springbooté›†æˆElasticsearchå’Œç®€å•åº”ç”¨"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-06T14:01:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜ggbond"/> <meta itemprop="url" content="https://juejin.cn/user/1118632795448713"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            springbooté›†æˆElasticsearchå’Œç®€å•åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1118632795448713/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜ggbond
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T14:01:20.000Z" title="Fri Feb 06 2026 14:01:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Boot + Elasticsearch</h2>
<hr/>
<h3 data-id="heading-1">ä¸€ã€é¡¹ç›®ç»“æ„</h3>
<pre><code class="hljs language-css" lang="css">es-demo/
â”œâ”€â”€ pom<span class="hljs-selector-class">.xml</span>
â”œâ”€â”€ <span class="hljs-attribute">src</span>/
â”‚ Â  â”œâ”€â”€ <span class="hljs-selector-tag">main</span>/
â”‚ Â  â”‚ Â  â”œâ”€â”€ java/com/nd/es/
â”‚ Â  â”‚ Â  â”‚ Â  â”œâ”€â”€ EsApplication<span class="hljs-selector-class">.java</span>
â”‚ Â  â”‚ Â  â”‚ Â  â”œâ”€â”€ config/
â”‚ Â  â”‚ Â  â”‚ Â  â”‚ Â  â”œâ”€â”€ ElasticsearchConfig<span class="hljs-selector-class">.java</span>
â”‚ Â  â”‚ Â  â”‚ Â  â”‚ Â  â””â”€â”€ ElasticsearchIndexInitializer<span class="hljs-selector-class">.java</span>
â”‚ Â  â”‚ Â  â”‚ Â  â”œâ”€â”€ controller/
â”‚ Â  â”‚ Â  â”‚ Â  â”‚ Â  â””â”€â”€ BookController<span class="hljs-selector-class">.java</span>
â”‚ Â  â”‚ Â  â”‚ Â  â”œâ”€â”€ entity/
â”‚ Â  â”‚ Â  â”‚ Â  â”‚ Â  â””â”€â”€ Book<span class="hljs-selector-class">.java</span>
â”‚ Â  â”‚ Â  â”‚ Â  â”œâ”€â”€ repository/
â”‚ Â  â”‚ Â  â”‚ Â  â”‚ Â  â””â”€â”€ BookRepository<span class="hljs-selector-class">.java</span>
â”‚ Â  â”‚ Â  â”‚ Â  â””â”€â”€ service/
â”‚ Â  â”‚ Â  â”‚ Â  Â  Â  â””â”€â”€ BookService<span class="hljs-selector-class">.java</span>
â”‚ Â  â”‚ Â  â””â”€â”€ resources/
â”‚ Â  â”‚ Â  Â  Â  â””â”€â”€ application<span class="hljs-selector-class">.yml</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">äºŒã€<code>pom.xml</code></h3>
<pre><code class="hljs language-xml" lang="xml">â€‹
<span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-comment">&lt;!-- âœ… é™çº§åˆ° 2.3.xï¼Œè¯¥ç‰ˆæœ¬é»˜è®¤é›†æˆ ES 7.6 --&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.12.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
 Â  Â 
 Â  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-comment">&lt;!-- Spring Data Elasticsearch --&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
â€‹
 Â  Â  Â  Â <span class="hljs-comment">&lt;!-- Spring Boot Web --&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
â€‹
 Â  Â  Â  Â <span class="hljs-comment">&lt;!-- Lombok --&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
â€‹
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
â€‹
</code></pre>
<hr/>
<h3 data-id="heading-3">ä¸‰ã€<code>application.yml</code></h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">elasticsearch:</span>
 Â   <span class="hljs-attr">rest:</span>
 Â  Â   <span class="hljs-attr">uris:</span> <span class="hljs-string">http://192.168.135.132:9200</span>
<span class="hljs-string">â€‹</span>
<span class="hljs-string">â€‹</span>
<span class="hljs-comment"># è‡ªå®šä¹‰ç´¢å¼•é…ç½®</span>
<span class="hljs-attr">elasticsearch:</span>
  <span class="hljs-attr">index:</span>
 Â   <span class="hljs-attr">name:</span> <span class="hljs-string">book</span>
 Â   <span class="hljs-attr">shards:</span> <span class="hljs-number">5</span>
 Â   <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">å››ã€<code>entity/Book.java</code></h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Document</span>(indexName = <span class="hljs-string">"book"</span>, shards = <span class="hljs-number">5</span>, replicas = <span class="hljs-number">1</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {
 Â  Â <span class="hljs-meta">@Id</span>
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> id;
â€‹
 Â  Â <span class="hljs-meta">@Field</span>(<span class="hljs-keyword">type</span> = <span class="hljs-title class_">FieldType</span>.<span class="hljs-property">Text</span>, analyzer = <span class="hljs-string">"ik_max_word"</span>)
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;
â€‹
 Â  Â <span class="hljs-meta">@Field</span>(<span class="hljs-keyword">type</span> = <span class="hljs-title class_">FieldType</span>.<span class="hljs-property">Keyword</span>)
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> auth;
â€‹
 Â  Â <span class="hljs-meta">@Field</span>(<span class="hljs-keyword">type</span> = <span class="hljs-title class_">FieldType</span>.<span class="hljs-property">Long</span>)
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">Long</span> count;
â€‹
 Â  Â <span class="hljs-meta">@Field</span>(<span class="hljs-keyword">type</span> = <span class="hljs-title class_">FieldType</span>.<span class="hljs-property">Date</span>, format = <span class="hljs-title class_">DateFormat</span>.<span class="hljs-property">date</span>)
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">Date</span> createtime;
â€‹
 Â  Â <span class="hljs-meta">@Field</span>(<span class="hljs-keyword">type</span> = <span class="hljs-title class_">FieldType</span>.<span class="hljs-property">Text</span>, analyzer = <span class="hljs-string">"ik_max_word"</span>)
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> desc;
}
</code></pre>
<hr/>
<h3 data-id="heading-5">äº”ã€<code>repository/BookRepository.java</code></h3>
<pre><code class="hljs language-arduino" lang="arduino">package com.nd.es.repository;
â€‹
@Repository
<span class="hljs-keyword">public</span> interface BookRepository extends ElasticsearchRepository&lt;Book, <span class="hljs-type">String</span>&gt; {
 Â  Â <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findByName</span><span class="hljs-params">(<span class="hljs-type">String</span> name)</span></span>;
 Â  Â <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findByNameIn</span><span class="hljs-params">(List&lt;<span class="hljs-type">String</span>&gt; names)</span></span>;
 Â  Â <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findByNameLike</span><span class="hljs-params">(<span class="hljs-type">String</span> name)</span></span>;
 Â  Â <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findByCountBetween</span><span class="hljs-params">(Long min, Long max)</span></span>;
 Â  Â <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findByNameStartingWith</span><span class="hljs-params">(<span class="hljs-type">String</span> prefix)</span></span>;
 Â  Â <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findByNameAndAuth</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">String</span> auth)</span></span>;
 Â  Â <span class="hljs-function">List&lt;Book&gt; <span class="hljs-title">findByNameOrAuth</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">String</span> auth)</span></span>;
}
</code></pre>
<hr/>
<h3 data-id="heading-6">å…­ã€<code>service/BookService.java</code></h3>
<pre><code class="hljs language-scss" lang="scss">package com<span class="hljs-selector-class">.nd</span><span class="hljs-selector-class">.es</span><span class="hljs-selector-class">.service</span>;
â€‹
import com<span class="hljs-selector-class">.nd</span><span class="hljs-selector-class">.es</span><span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.Book</span>;
import com<span class="hljs-selector-class">.nd</span><span class="hljs-selector-class">.es</span><span class="hljs-selector-class">.repository</span><span class="hljs-selector-class">.BookRepository</span>;
import lombok<span class="hljs-selector-class">.extern</span><span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.Slf4j</span>;
import org<span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.geo</span><span class="hljs-selector-class">.GeoPoint</span>;
import org<span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.unit</span><span class="hljs-selector-class">.DistanceUnit</span>;
import org<span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.index</span><span class="hljs-selector-class">.query</span>.*;
import org<span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.search</span><span class="hljs-selector-class">.aggregations</span><span class="hljs-selector-class">.AggregationBuilders</span>;
import org<span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.search</span><span class="hljs-selector-class">.aggregations</span><span class="hljs-selector-class">.bucket</span><span class="hljs-selector-class">.range</span><span class="hljs-selector-class">.Range</span>;
import org<span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.search</span><span class="hljs-selector-class">.aggregations</span><span class="hljs-selector-class">.metrics</span><span class="hljs-selector-class">.Cardinality</span>;
import org<span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.search</span><span class="hljs-selector-class">.aggregations</span><span class="hljs-selector-class">.metrics</span><span class="hljs-selector-class">.ExtendedStats</span>;
import org<span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.search</span><span class="hljs-selector-class">.fetch</span><span class="hljs-selector-class">.subphase</span><span class="hljs-selector-class">.highlight</span><span class="hljs-selector-class">.HighlightBuilder</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.PageRequest</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.core</span>.*;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.mapping</span><span class="hljs-selector-class">.IndexCoordinates</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.query</span><span class="hljs-selector-class">.NativeSearchQuery</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.query</span><span class="hljs-selector-class">.NativeSearchQueryBuilder</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.stereotype</span><span class="hljs-selector-class">.Service</span>;
â€‹
import java<span class="hljs-selector-class">.util</span>.*;
import java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.stream</span><span class="hljs-selector-class">.Collectors</span>;
import java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.stream</span><span class="hljs-selector-class">.StreamSupport</span>;
â€‹
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@Service</span>
public class BookService {
â€‹
 Â  Â <span class="hljs-keyword">@Autowired</span>
 Â  Â private BookRepository bookRepository;
â€‹
 Â  Â <span class="hljs-keyword">@Autowired</span>
 Â  Â private ElasticsearchRestTemplate template;
â€‹
 Â  Â <span class="hljs-comment">// ==================== ç´¢å¼•ç®¡ç† ====================</span>
 Â  Â public void <span class="hljs-built_in">createIndex</span>() {
 Â  Â  Â  Â if (!template.indexOps(Book.class)<span class="hljs-selector-class">.exists</span>()) {
 Â  Â  Â  Â  Â  Â template<span class="hljs-selector-class">.indexOps</span>(Book.class)<span class="hljs-selector-class">.create</span>();
 Â  Â  Â  Â  Â  Â log<span class="hljs-selector-class">.info</span>("ç´¢å¼•åˆ›å»ºæˆåŠŸ");
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â public void <span class="hljs-built_in">deleteIndex</span>() {
 Â  Â  Â  Â if (template.indexOps(Book.class)<span class="hljs-selector-class">.exists</span>()) {
 Â  Â  Â  Â  Â  Â template<span class="hljs-selector-class">.indexOps</span>(Book.class)<span class="hljs-selector-class">.delete</span>();
 Â  Â  Â  Â  Â  Â log<span class="hljs-selector-class">.info</span>("ç´¢å¼•åˆ é™¤æˆåŠŸ");
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== æ–‡æ¡£æ“ä½œ ====================</span>
 Â  Â public Book <span class="hljs-built_in">save</span>(Book book) {
 Â  Â  Â  Â return bookRepository<span class="hljs-selector-class">.save</span>(book);
 Â   }
â€‹
 Â  Â public void <span class="hljs-built_in">saveAll</span>(List&lt;Book&gt; books) {
 Â  Â  Â  Â bookRepository<span class="hljs-selector-class">.saveAll</span>(books);
 Â   }
â€‹
 Â  Â public Optional&lt;Book&gt; <span class="hljs-built_in">findById</span>(String id) {
 Â  Â  Â  Â return bookRepository<span class="hljs-selector-class">.findById</span>(id);
 Â   }
â€‹
 Â  Â public void <span class="hljs-built_in">deleteById</span>(String id) {
 Â  Â  Â  Â bookRepository<span class="hljs-selector-class">.deleteById</span>(id);
 Â   }
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">findAll</span>() {
 Â  Â  Â  Â Iterable&lt;Book&gt; iterable = bookRepository<span class="hljs-selector-class">.findAll</span>();
 Â  Â  Â  Â return StreamSupport<span class="hljs-selector-class">.stream</span>(iterable.spliterator(), false)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== æ‰¹é‡æ“ä½œ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">bulkCreate</span>(List&lt;Book&gt; books) {
 Â  Â  Â  Â return (List&lt;Book&gt;) bookRepository<span class="hljs-selector-class">.saveAll</span>(books);
 Â   }
â€‹
 Â  Â public void <span class="hljs-built_in">bulkDelete</span>(List&lt;String&gt; ids) {
 Â  Â  Â  Â List&lt;Book&gt; books = ids<span class="hljs-selector-class">.stream</span>()<span class="hljs-selector-class">.map</span>(id -&gt; {
 Â  Â  Â  Â  Â  Â Book book = new Book();
 Â  Â  Â  Â  Â  Â book<span class="hljs-selector-class">.setId</span>(id);
 Â  Â  Â  Â  Â  Â return book;
 Â  Â  Â   })<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â  Â  Â  Â bookRepository<span class="hljs-selector-class">.deleteAll</span>(books);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== TermæŸ¥è¯¢ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">findByName</span>(String name) {
 Â  Â  Â  Â return bookRepository<span class="hljs-selector-class">.findByName</span>(name);
 Â   }
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">findByNameIn</span>(List&lt;String&gt; names) {
 Â  Â  Â  Â return bookRepository<span class="hljs-selector-class">.findByNameIn</span>(names);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== MatchæŸ¥è¯¢ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">searchByName</span>(String name) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.matchQuery</span>("name", name);
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">searchByNameLike</span>(String name) {
 Â  Â  Â  Â return bookRepository<span class="hljs-selector-class">.findByNameLike</span>(name);
 Â   }
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">multiMatchSearch</span>(String keyword) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.multiMatchQuery</span>(keyword, "name", "desc");
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== å¸ƒå°”æŸ¥è¯¢ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">boolSearch</span>(String name, String auth) {
 Â  Â  Â  Â BoolQueryBuilder boolQuery = QueryBuilders<span class="hljs-selector-class">.boolQuery</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.must</span>(QueryBuilders.matchQuery("name", name))
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.must</span>(QueryBuilders.termQuery("auth", auth));
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(boolQuery)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">boolShouldSearch</span>(String name, String auth) {
 Â  Â  Â  Â BoolQueryBuilder boolQuery = QueryBuilders<span class="hljs-selector-class">.boolQuery</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.should</span>(QueryBuilders.matchQuery("name", name))
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.should</span>(QueryBuilders.matchQuery("auth", auth))
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.minimumShouldMatch</span>(<span class="hljs-number">1</span>);
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(boolQuery)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== èŒƒå›´æŸ¥è¯¢ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">rangeSearch</span>(Long min, Long max) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.rangeQuery</span>("count")<span class="hljs-selector-class">.from</span>(min)<span class="hljs-selector-class">.to</span>(max);
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">dateRangeSearch</span>(String startDate, String endDate) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.rangeQuery</span>("createtime")
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.from</span>(startDate)<span class="hljs-selector-class">.to</span>(endDate)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.format</span>("yyyy-MM-dd");
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== å‰ç¼€æŸ¥è¯¢ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">prefixSearch</span>(String prefix) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.prefixQuery</span>("name", prefix);
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== é€šé…ç¬¦æŸ¥è¯¢ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">wildcardSearch</span>(String pattern) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.wildcardQuery</span>("name", pattern);
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== æ¨¡ç³ŠæŸ¥è¯¢ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">fuzzySearch</span>(String value, int prefixLength) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.fuzzyQuery</span>("name", value)<span class="hljs-selector-class">.prefixLength</span>(prefixLength);
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== æ­£åˆ™æŸ¥è¯¢ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">regexpSearch</span>(String regexp) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.regexpQuery</span>("name", regexp);
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== IDæŸ¥è¯¢ ====================</span>
 Â  Â public Book <span class="hljs-built_in">findByIdQuery</span>(String id) {
 Â  Â  Â  Â return bookRepository<span class="hljs-selector-class">.findById</span>(id)<span class="hljs-selector-class">.orElse</span>(null);
 Â   }
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">findByIds</span>(List&lt;String&gt; ids) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.idsQuery</span>()<span class="hljs-selector-class">.addIds</span>(ids.toArray(new String[<span class="hljs-number">0</span>]));
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== é«˜äº®æŸ¥è¯¢ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">highlightSearch</span>(String keyword) {
 Â  Â  Â  Â HighlightBuilder highlightBuilder = new <span class="hljs-built_in">HighlightBuilder</span>();
 Â  Â  Â  Â HighlightBuilder<span class="hljs-selector-class">.Field</span> nameField = new HighlightBuilder<span class="hljs-selector-class">.Field</span>("name")
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.preTags</span>("&lt;font color='red'&gt;")
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.postTags</span>("&lt;/font&gt;");
 Â  Â  Â  Â HighlightBuilder<span class="hljs-selector-class">.Field</span> descField = new HighlightBuilder<span class="hljs-selector-class">.Field</span>("desc")
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.preTags</span>("&lt;font color='red'&gt;")
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.postTags</span>("&lt;/font&gt;");
â€‹
 Â  Â  Â  Â highlightBuilder<span class="hljs-selector-class">.field</span>(nameField);
 Â  Â  Â  Â highlightBuilder<span class="hljs-selector-class">.field</span>(descField);
â€‹
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.multiMatchQuery</span>(keyword, "name", "desc");
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withHighlightBuilder</span>(highlightBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
â€‹
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.getSearchHits</span>()<span class="hljs-selector-class">.stream</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.map</span>(hit -&gt; {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Book book = hit.getContent();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Map&lt;String, List&lt;String&gt;&gt; highlightFields = hit<span class="hljs-selector-class">.getHighlightFields</span>();
â€‹
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (highlightFields.containsKey("name")) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â book<span class="hljs-selector-class">.setName</span>(highlightFields.get("name")<span class="hljs-selector-class">.get</span>(<span class="hljs-number">0</span>));
 Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (highlightFields.containsKey("desc")) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â book<span class="hljs-selector-class">.setDesc</span>(highlightFields.get("desc")<span class="hljs-selector-class">.get</span>(<span class="hljs-number">0</span>));
 Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return book;
 Â  Â  Â  Â  Â  Â  Â   })
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== èšåˆæŸ¥è¯¢ ====================</span>
 Â  Â public Map&lt;String, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-built_in">statsSearch</span>() {
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.addAggregation</span>(AggregationBuilders.extendedStats("count_stats")<span class="hljs-selector-class">.field</span>("count"))
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â ExtendedStats extendedStats = searchHits<span class="hljs-selector-class">.getAggregations</span>()<span class="hljs-selector-class">.get</span>("count_stats");
â€‹
 Â  Â  Â  Â Map&lt;String, <span class="hljs-selector-tag">Object</span>&gt; stats = new HashMap&lt;&gt;();
 Â  Â  Â  Â stats<span class="hljs-selector-class">.put</span>("max", extendedStats.getMax());
 Â  Â  Â  Â stats<span class="hljs-selector-class">.put</span>("min", extendedStats.getMin());
 Â  Â  Â  Â stats<span class="hljs-selector-class">.put</span>("avg", extendedStats.getAvg());
 Â  Â  Â  Â stats<span class="hljs-selector-class">.put</span>("sum", extendedStats.getSum());
 Â  Â  Â  Â stats<span class="hljs-selector-class">.put</span>("count", extendedStats.getCount());
 Â  Â  Â  Â return stats;
 Â   }
â€‹
 Â  Â public long <span class="hljs-built_in">cardinalitySearch</span>(String field) {
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.addAggregation</span>(AggregationBuilders.cardinality("cardinality_agg")<span class="hljs-selector-class">.field</span>(field))
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â Cardinality cardinality = searchHits<span class="hljs-selector-class">.getAggregations</span>()<span class="hljs-selector-class">.get</span>("cardinality_agg");
 Â  Â  Â  Â return cardinality<span class="hljs-selector-class">.getValue</span>();
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== ä»¥ä¸‹æ˜¯è¡¥å……çš„ç¼ºå¤±æ–¹æ³• ====================</span>
â€‹
 Â  Â public Map&lt;String, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-built_in">rangeStats</span>(Long min, Long max) {
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.addAggregation</span>(AggregationBuilders.range("count_ranges")
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.field</span>("count")
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.addUnboundedTo</span>(min) Â  Â  Â  Â <span class="hljs-comment">// &lt; min</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.addRange</span>(min, max) Â  Â  Â  Â  <span class="hljs-comment">// min - max</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.addUnboundedFrom</span>(max)) Â  Â  <span class="hljs-comment">// &gt; max</span>
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â Range rangeAgg = searchHits<span class="hljs-selector-class">.getAggregations</span>()<span class="hljs-selector-class">.get</span>("count_ranges");
â€‹
 Â  Â  Â  Â Map&lt;String, <span class="hljs-selector-tag">Object</span>&gt; result = new HashMap&lt;&gt;();
 Â  Â  Â  Â for (Range.Bucket bucket : rangeAgg.getBuckets()) {
 Â  Â  Â  Â  Â  Â result<span class="hljs-selector-class">.put</span>(bucket.getKeyAsString(), bucket<span class="hljs-selector-class">.getDocCount</span>());
 Â  Â  Â   }
 Â  Â  Â  Â return result;
 Â   }
â€‹
 Â  Â public long <span class="hljs-built_in">deleteByQuery</span>(String field, String value) {
 Â  Â  Â  Â <span class="hljs-comment">// æ„å»ºæŸ¥è¯¢æ¡ä»¶</span>
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.matchQuery</span>(field, value);
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// æ‰§è¡Œæœç´¢è·å–ç»“æœ</span>
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// æ”¶é›†æ‰€æœ‰åŒ¹é…æ–‡æ¡£çš„ID</span>
 Â  Â  Â  Â List&lt;String&gt; idsToDelete = searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent()<span class="hljs-selector-class">.getId</span>())
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.collect</span>(Collectors.toList());
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// æ ¹æ®IDåˆ—è¡¨åˆ é™¤æ–‡æ¡£</span>
 Â  Â  Â  Â if (!idsToDelete.isEmpty()) {
 Â  Â  Â  Â  Â  Â Iterable&lt;Book&gt; booksToDelete = idsToDelete<span class="hljs-selector-class">.stream</span>()<span class="hljs-selector-class">.map</span>(id -&gt; {
 Â  Â  Â  Â  Â  Â  Â  Â Book book = new Book();
 Â  Â  Â  Â  Â  Â  Â  Â book<span class="hljs-selector-class">.setId</span>(id);
 Â  Â  Â  Â  Â  Â  Â  Â return book;
 Â  Â  Â  Â  Â   })<span class="hljs-selector-class">.collect</span>(Collectors.toList());
â€‹
 Â  Â  Â  Â  Â  Â bookRepository<span class="hljs-selector-class">.deleteAll</span>(booksToDelete);
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â return idsToDelete<span class="hljs-selector-class">.size</span>(); <span class="hljs-comment">// è¿”å›åˆ é™¤çš„æ–‡æ¡£æ•°é‡</span>
 Â   }
â€‹
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">boostingSearch</span>(String positiveField, String positiveValue,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  String negativeField, String negativeValue,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  float negativeBoost) {
 Â  Â  Â  Â BoostingQueryBuilder boostingQuery = QueryBuilders<span class="hljs-selector-class">.boostingQuery</span>(
 Â  Â  Â  Â  Â  Â  Â  Â QueryBuilders.matchQuery(positiveField, positiveValue),
 Â  Â  Â  Â  Â  Â  Â  Â QueryBuilders<span class="hljs-selector-class">.matchQuery</span>(negativeField, negativeValue)
 Â  Â  Â   )<span class="hljs-selector-class">.negativeBoost</span>(negativeBoost);
â€‹
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(boostingQuery)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">filterSearch</span>(String mustField, String mustValue,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  String filterField, String filterValue,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Long minCount, Long maxCount) {
 Â  Â  Â  Â BoolQueryBuilder boolQuery = QueryBuilders<span class="hljs-selector-class">.boolQuery</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.must</span>(QueryBuilders.matchQuery(mustField, mustValue))
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.filter</span>(QueryBuilders.termQuery(filterField, filterValue))
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.filter</span>(QueryBuilders.rangeQuery("count")<span class="hljs-selector-class">.from</span>(minCount)<span class="hljs-selector-class">.to</span>(maxCount));
â€‹
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(boolQuery)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== æ·±åˆ†é¡µ Scroll ====================</span>
 Â  Â public Map&lt;String, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-built_in">scrollSearchFirst</span>(int size) {
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(QueryBuilders.matchAllQuery())
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withPageable</span>(PageRequest.of(<span class="hljs-number">0</span>, size))
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â SearchScrollHits&lt;Book&gt; scrollHits = template<span class="hljs-selector-class">.searchScrollStart</span>(<span class="hljs-number">60000</span>, query, Book.class, IndexCoordinates.of("book"));
 Â  Â  Â  Â String scrollId = scrollHits<span class="hljs-selector-class">.getScrollId</span>();
 Â  Â  Â  Â List&lt;Book&gt; books = scrollHits<span class="hljs-selector-class">.getSearchHits</span>()<span class="hljs-selector-class">.stream</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.map</span>(hit -&gt; hit.getContent())
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.collect</span>(Collectors.toList());
â€‹
 Â  Â  Â  Â Map&lt;String, <span class="hljs-selector-tag">Object</span>&gt; result = new HashMap&lt;&gt;();
 Â  Â  Â  Â result<span class="hljs-selector-class">.put</span>("scrollId", scrollId);
 Â  Â  Â  Â result<span class="hljs-selector-class">.put</span>("data", books);
 Â  Â  Â  Â result<span class="hljs-selector-class">.put</span>("totalHits", scrollHits.getTotalHits());
 Â  Â  Â  Â return result;
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// æ›¿æ¢åŸæœ‰çš„ scrollSearchNext æ–¹æ³•</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">scrollSearchNext</span>(String scrollId) {
 Â  Â  Â  Â SearchScrollHits&lt;Book&gt; scrollHits = template<span class="hljs-selector-class">.searchScrollContinue</span>(scrollId, <span class="hljs-number">60000</span>, Book.class, IndexCoordinates.of("book"));
â€‹
 Â  Â  Â  Â return scrollHits<span class="hljs-selector-class">.getSearchHits</span>()<span class="hljs-selector-class">.stream</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.map</span>(SearchHit::getContent)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
â€‹
 Â  Â public void <span class="hljs-built_in">scrollClear</span>(String scrollId) {
 Â  Â  Â  Â template<span class="hljs-selector-class">.searchScrollClear</span>(Collections.singletonList(scrollId));
 Â   }
â€‹
â€‹
 Â  Â <span class="hljs-comment">// ==================== åœ°å›¾æŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">// ==================== åœ°å›¾æŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">// ==================== åœ°å›¾æŸ¥è¯¢ - è¿”å›Bookå®ä½“ ====================</span>
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">geoDistanceSearch</span>(double lat, double lon, String distance) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.geoDistanceQuery</span>("location")
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.point</span>(lat, lon)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.distance</span>(distance, DistanceUnit.KILOMETERS);
â€‹
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(SearchHit::getContent)<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">geoBoundingBoxSearch</span>(GeoPoint topLeft, GeoPoint bottomRight) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.geoBoundingBoxQuery</span>("location")
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.setCorners</span>(topLeft, bottomRight);
â€‹
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(SearchHit::getContent)<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
â€‹
 Â  Â public List&lt;Book&gt; <span class="hljs-built_in">geoPolygonSearch</span>(List&lt;GeoPoint&gt; points) {
 Â  Â  Â  Â QueryBuilder queryBuilder = QueryBuilders<span class="hljs-selector-class">.geoPolygonQuery</span>("location", points);
â€‹
 Â  Â  Â  Â NativeSearchQuery query = new <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.withQuery</span>(queryBuilder)
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.build</span>();
â€‹
 Â  Â  Â  Â SearchHits&lt;Book&gt; searchHits = template<span class="hljs-selector-class">.search</span>(query, Book.class);
 Â  Â  Â  Â return searchHits<span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.map</span>(SearchHit::getContent)<span class="hljs-selector-class">.collect</span>(Collectors.toList());
 Â   }
}
</code></pre>
<hr/>
<h3 data-id="heading-7">åäºŒã€<code>controller/BookController.java</code></h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.nd</span><span class="hljs-selector-class">.es</span><span class="hljs-selector-class">.controller</span>;
â€‹
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.nd</span><span class="hljs-selector-class">.es</span><span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.Book</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.nd</span><span class="hljs-selector-class">.es</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.BookService</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.elasticsearch</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.geo</span><span class="hljs-selector-class">.GeoPoint</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
â€‹
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.HashMap</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Map</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Optional</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.stream</span><span class="hljs-selector-class">.Collectors</span>;
â€‹
@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/api/books"</span>)
@<span class="hljs-selector-tag">CrossOrigin</span>(origins = <span class="hljs-string">"*"</span>)
<span class="hljs-comment">/**
 * BookControllerç±» - å¤„ç†å›¾ä¹¦ç›¸å…³çš„HTTPè¯·æ±‚
 * è¯¥æ§åˆ¶å™¨æä¾›äº†å›¾ä¹¦çš„ç´¢å¼•ç®¡ç†ã€æ–‡æ¡£æ“ä½œã€æ‰¹é‡æ“ä½œã€å„ç§æŸ¥è¯¢æ–¹å¼ç­‰åŠŸèƒ½
 */</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">BookController</span> {
 Â  Â <span class="hljs-comment">/**
 Â  Â  * è‡ªåŠ¨æ³¨å…¥BookServiceæœåŠ¡
 Â  Â  * ç”¨äºå¤„ç†å›¾ä¹¦ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘
 Â  Â  */</span>
 Â  Â <span class="hljs-variable">@Autowired</span>
 Â  Â private BookService bookService;
â€‹
 Â  Â <span class="hljs-comment">// ==================== ç´¢å¼•ç®¡ç† ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * åˆ›å»ºç´¢å¼•
 Â  Â  * @return è¿”å›åˆ›å»ºæˆåŠŸçš„æ¶ˆæ¯
 Â  Â  */</span>
 Â  Â <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/index"</span>)
 Â  Â public String <span class="hljs-built_in">createIndex</span>() {
 Â  Â  Â  Â <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.createIndex</span>();
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> "ç´¢å¼•åˆ›å»ºæˆåŠŸ";
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * åˆ é™¤ç´¢å¼•
 Â  Â  * @return è¿”å›åˆ é™¤æˆåŠŸçš„æ¶ˆæ¯
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">DeleteMapping</span>(<span class="hljs-string">"/index"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">deleteIndex</span>() {
 Â  Â  Â  Â <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.deleteIndex</span>();
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> "ç´¢å¼•åˆ é™¤æˆåŠŸ";
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== æ–‡æ¡£æ“ä½œ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * ä¿å­˜å•ä¸ªå›¾ä¹¦
 Â  Â  * @param book è¦ä¿å­˜çš„å›¾ä¹¦å¯¹è±¡
 Â  Â  * @return è¿”å›ä¿å­˜åçš„å›¾ä¹¦å¯¹è±¡
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">PostMapping</span>
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Book</span> <span class="hljs-selector-tag">save</span>(<span class="hljs-variable">@RequestBody</span> Book book) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.save</span>(book);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ‰¹é‡ä¿å­˜å›¾ä¹¦
 Â  Â  * @param books å›¾ä¹¦åˆ—è¡¨
 Â  Â  * @return è¿”å›æ‰¹é‡æ·»åŠ æˆåŠŸçš„æ¶ˆæ¯
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/batch"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">saveAll</span>(<span class="hljs-variable">@RequestBody</span> List&lt;Book&gt; books) {
 Â  Â  Â  Â <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.saveAll</span>(books);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> "æ‰¹é‡æ·»åŠ æˆåŠŸ";
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ ¹æ®IDæŸ¥æ‰¾å›¾ä¹¦
 Â  Â  * @param id å›¾ä¹¦ID
 Â  Â  * @return è¿”å›æ‰¾åˆ°çš„å›¾ä¹¦å¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›null
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/{id}"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Book</span> <span class="hljs-selector-tag">findById</span>(<span class="hljs-variable">@PathVariable</span> String id) {
 Â  Â  Â  Â <span class="hljs-selector-tag">Optional</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">book</span> = <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.findById</span>(id);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">book</span><span class="hljs-selector-class">.orElse</span>(null);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ ¹æ®IDåˆ é™¤å›¾ä¹¦
 Â  Â  * @param id å›¾ä¹¦ID
 Â  Â  * @return è¿”å›åˆ é™¤æˆåŠŸçš„æ¶ˆæ¯
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">DeleteMapping</span>(<span class="hljs-string">"/{id}"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">deleteById</span>(<span class="hljs-variable">@PathVariable</span> String id) {
 Â  Â  Â  Â <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.deleteById</span>(id);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> "åˆ é™¤æˆåŠŸ";
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æŸ¥æ‰¾æ‰€æœ‰å›¾ä¹¦
 Â  Â  * @return è¿”å›æ‰€æœ‰å›¾ä¹¦çš„åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">findAll</span>() {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.findAll</span>();
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== æ‰¹é‡æ“ä½œ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ‰¹é‡åˆ›å»ºå›¾ä¹¦
 Â  Â  * @param books å›¾ä¹¦åˆ—è¡¨
 Â  Â  * @return è¿”å›åˆ›å»ºæˆåŠŸçš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/batch/create"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">bulkCreate</span>(<span class="hljs-variable">@RequestBody</span> List&lt;Book&gt; books) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.bulkCreate</span>(books);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ‰¹é‡åˆ é™¤å›¾ä¹¦
 Â  Â  * @param ids è¦åˆ é™¤çš„å›¾ä¹¦IDåˆ—è¡¨
 Â  Â  * @return è¿”å›æ‰¹é‡åˆ é™¤æˆåŠŸçš„æ¶ˆæ¯
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/batch/delete"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">bulkDelete</span>(<span class="hljs-variable">@RequestBody</span> List&lt;String&gt; ids) {
 Â  Â  Â  Â <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.bulkDelete</span>(ids);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> "æ‰¹é‡åˆ é™¤æˆåŠŸ";
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== TermæŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ ¹æ®åç§°ç²¾ç¡®æŸ¥è¯¢å›¾ä¹¦
 Â  Â  * @param name å›¾ä¹¦åç§°
 Â  Â  * @return è¿”å›åŒ¹é…åç§°çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/name"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">findByName</span>(<span class="hljs-variable">@RequestParam</span> String name) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.findByName</span>(name);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ ¹æ®åç§°åˆ—è¡¨æŸ¥è¯¢å›¾ä¹¦
 Â  Â  * @param names å›¾ä¹¦åç§°åˆ—è¡¨
 Â  Â  * @return è¿”å›åŒ¹é…åç§°åˆ—è¡¨çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/search/names"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">findByNameIn</span>(<span class="hljs-variable">@RequestBody</span> List&lt;String&gt; names) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.findByNameIn</span>(names);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== MatchæŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ ¹æ®åç§°è¿›è¡Œå…¨æ–‡æœç´¢
 Â  Â  * @param name æœç´¢å…³é”®è¯
 Â  Â  * @return è¿”å›åŒ¹é…çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/match"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">searchByName</span>(<span class="hljs-variable">@RequestParam</span> String name) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.searchByName</span>(name);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ ¹æ®åç§°è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢
 Â  Â  * @param name æœç´¢å…³é”®è¯
 Â  Â  * @return è¿”å›åŒ¹é…çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/like"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">searchByNameLike</span>(<span class="hljs-variable">@RequestParam</span> String name) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.searchByNameLike</span>(name);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * å¤šå­—æ®µå…¨æ–‡æœç´¢
 Â  Â  * @param keyword æœç´¢å…³é”®è¯
 Â  Â  * @return è¿”å›åŒ¹é…çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/multi-match"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">multiMatchSearch</span>(<span class="hljs-variable">@RequestParam</span> String keyword) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.multiMatchSearch</span>(keyword);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== å¸ƒå°”æŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * å¸ƒå°”æŸ¥è¯¢
 Â  Â  * @param name å›¾ä¹¦åç§°
 Â  Â  * @param auth ä½œè€…
 Â  Â  * @return è¿”å›åŒ¹é…çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/bool"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">boolSearch</span>(<span class="hljs-variable">@RequestParam</span> String name, <span class="hljs-variable">@RequestParam</span> String auth) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.boolSearch</span>(name, auth);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * å¸ƒå°”ShouldæŸ¥è¯¢
 Â  Â  * @param name å›¾ä¹¦åç§°
 Â  Â  * @param auth ä½œè€…
 Â  Â  * @return è¿”å›åŒ¹é…çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/bool/should"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">boolShouldSearch</span>(<span class="hljs-variable">@RequestParam</span> String name, <span class="hljs-variable">@RequestParam</span> String auth) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.boolShouldSearch</span>(name, auth);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== èŒƒå›´æŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ•°å€¼èŒƒå›´æŸ¥è¯¢
 Â  Â  * @param min æœ€å°å€¼
 Â  Â  * @param max æœ€å¤§å€¼
 Â  Â  * @return è¿”å›åœ¨æŒ‡å®šèŒƒå›´å†…çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/range"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">rangeSearch</span>(<span class="hljs-variable">@RequestParam</span> Long min, <span class="hljs-variable">@RequestParam</span> Long max) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.rangeSearch</span>(min, max);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ—¥æœŸèŒƒå›´æŸ¥è¯¢
 Â  Â  * @param startDate å¼€å§‹æ—¥æœŸ
 Â  Â  * @param endDate ç»“æŸæ—¥æœŸ
 Â  Â  * @return è¿”å›åœ¨æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/date-range"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">dateRangeSearch</span>(<span class="hljs-variable">@RequestParam</span> String startDate, <span class="hljs-variable">@RequestParam</span> String endDate) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.dateRangeSearch</span>(startDate, endDate);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== å‰ç¼€æŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * å‰ç¼€æŸ¥è¯¢
 Â  Â  * @param prefix å‰ç¼€å­—ç¬¦ä¸²
 Â  Â  * @return è¿”å›ä»¥å‰ç¼€å¼€å¤´çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/prefix"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">prefixSearch</span>(<span class="hljs-variable">@RequestParam</span> String prefix) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.prefixSearch</span>(prefix);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== é€šé…ç¬¦æŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * é€šé…ç¬¦æŸ¥è¯¢
 Â  Â  * @param pattern é€šé…ç¬¦æ¨¡å¼
 Â  Â  * @return è¿”å›åŒ¹é…é€šé…ç¬¦æ¨¡å¼çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/wildcard"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">wildcardSearch</span>(<span class="hljs-variable">@RequestParam</span> String pattern) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.wildcardSearch</span>(pattern);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== æ¨¡ç³ŠæŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ¨¡ç³ŠæŸ¥è¯¢
 Â  Â  * @param value æœç´¢å€¼
 Â  Â  * @param prefixLength å‰ç¼€é•¿åº¦ï¼Œé»˜è®¤ä¸º2
 Â  Â  * @return è¿”å›æ¨¡ç³ŠåŒ¹é…çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/fuzzy"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">fuzzySearch</span>(<span class="hljs-variable">@RequestParam</span> String value, <span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"2"</span>) int prefixLength) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.fuzzySearch</span>(value, prefixLength);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== æ­£åˆ™æŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢
 Â  Â  * @param regexp æ­£åˆ™è¡¨è¾¾å¼
 Â  Â  * @return è¿”å›åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/regexp"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">regexpSearch</span>(<span class="hljs-variable">@RequestParam</span> String regexp) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.regexpSearch</span>(regexp);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== IDæŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ ¹æ®IDæŸ¥è¯¢å›¾ä¹¦
 Â  Â  * @param id å›¾ä¹¦ID
 Â  Â  * @return è¿”å›åŒ¹é…IDçš„å›¾ä¹¦
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/id/{id}"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Book</span> <span class="hljs-selector-tag">findByIdQuery</span>(<span class="hljs-variable">@PathVariable</span> String id) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.findByIdQuery</span>(id);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ ¹æ®IDåˆ—è¡¨æŸ¥è¯¢å›¾ä¹¦
 Â  Â  * @param ids å›¾ä¹¦IDåˆ—è¡¨
 Â  Â  * @return è¿”å›åŒ¹é…IDåˆ—è¡¨çš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/search/ids"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">findByIds</span>(<span class="hljs-variable">@RequestBody</span> List&lt;String&gt; ids) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.findByIds</span>(ids);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== é«˜äº®æŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * é«˜äº®æœç´¢
 Â  Â  * @param keyword æœç´¢å…³é”®è¯
 Â  Â  * @return è¿”å›é«˜äº®æ˜¾ç¤ºçš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/highlight"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">highlightSearch</span>(<span class="hljs-variable">@RequestParam</span> String keyword) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.highlightSearch</span>(keyword);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== èšåˆæŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * ç»Ÿè®¡æŸ¥è¯¢
 Â  Â  * @return è¿”å›åŒ…å«å„ç§ç»Ÿè®¡ä¿¡æ¯çš„Map
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/stats"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">statsSearch</span>() {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.statsSearch</span>();
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * åŸºæ•°æŸ¥è¯¢
 Â  Â  * @param field è¦æŸ¥è¯¢çš„å­—æ®µ
 Â  Â  * @return è¿”å›åŒ…å«åŸºæ•°ç»Ÿè®¡ä¿¡æ¯çš„Map
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/stats/cardinality"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">cardinalitySearch</span>(<span class="hljs-variable">@RequestParam</span> String field) {
 Â  Â  Â  Â <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">count</span> = <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.cardinalitySearch</span>(field);
 Â  Â  Â  Â <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">map</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">HashMap</span>&lt;&gt;();
 Â  Â  Â  Â <span class="hljs-selector-tag">map</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"count"</span>, count);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">map</span>;
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * èŒƒå›´ç»Ÿè®¡æŸ¥è¯¢
 Â  Â  * @param min æœ€å°å€¼
 Â  Â  * @param max æœ€å¤§å€¼
 Â  Â  * @return è¿”å›åŒ…å«èŒƒå›´ç»Ÿè®¡ä¿¡æ¯çš„Map
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/stats/range"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">rangeStats</span>(<span class="hljs-variable">@RequestParam</span> Long min, <span class="hljs-variable">@RequestParam</span> Long max) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.rangeStats</span>(min, max);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== delete-by-query ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ ¹æ®æ¡ä»¶åˆ é™¤æ–‡æ¡£
 Â  Â  * @param field å­—æ®µå
 Â  Â  * @param value å­—æ®µå€¼
 Â  Â  * @return è¿”å›åˆ é™¤çš„æ–‡æ¡£æ•°é‡
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">DeleteMapping</span>(<span class="hljs-string">"/delete/by-query"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">deleteByQuery</span>(<span class="hljs-variable">@RequestParam</span> String field, <span class="hljs-variable">@RequestParam</span> String value) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.deleteByQuery</span>(field, value);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== boosting æŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * BoostingæŸ¥è¯¢
 Â  Â  * @param positiveField æ­£å‘å­—æ®µå
 Â  Â  * @param positiveValue æ­£å‘å­—æ®µå€¼
 Â  Â  * @param negativeField è´Ÿå‘å­—æ®µå
 Â  Â  * @param negativeValue è´Ÿå‘å­—æ®µå€¼
 Â  Â  * @param negativeBoost è´Ÿå‘æƒé‡ï¼Œé»˜è®¤ä¸º0.2
 Â  Â  * @return è¿”å›BoostingæŸ¥è¯¢ç»“æœçš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/boosting"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">boostingSearch</span>(<span class="hljs-variable">@RequestParam</span> String positiveField,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> String positiveValue,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> String negativeField,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> String negativeValue,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"0.2"</span>) float negativeBoost) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.boostingSearch</span>(positiveField, positiveValue,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â negativeField, negativeValue, negativeBoost);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== filter æŸ¥è¯¢ ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * FilteræŸ¥è¯¢
 Â  Â  * @param mustField å¿…é¡»åŒ¹é…çš„å­—æ®µå
 Â  Â  * @param mustValue å¿…é¡»åŒ¹é…çš„å­—æ®µå€¼
 Â  Â  * @param filterField è¿‡æ»¤å­—æ®µå
 Â  Â  * @param filterValue è¿‡æ»¤å­—æ®µå€¼
 Â  Â  * @param minCount æœ€å°æ•°é‡
 Â  Â  * @param maxCount æœ€å¤§æ•°é‡
 Â  Â  * @return è¿”å›FilteræŸ¥è¯¢ç»“æœçš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/filter"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">filterSearch</span>(<span class="hljs-variable">@RequestParam</span> String mustField,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> String mustValue,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> String filterField,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> String filterValue,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> Long minCount,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> Long maxCount) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.filterSearch</span>(mustField, mustValue, filterField, filterValue, minCount, maxCount);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== æ·±åˆ†é¡µ Scroll ====================</span>
 Â  Â <span class="hljs-comment">/**
 Â  Â  * é¦–æ¬¡ScrollæŸ¥è¯¢
 Â  Â  * @param size æ¯é¡µå¤§å°ï¼Œé»˜è®¤ä¸º10
 Â  Â  * @return è¿”å›åŒ…å«ç»“æœå’ŒscrollIdçš„Map
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/scroll/first"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">scrollSearchFirst</span>(<span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"10"</span>) int size) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.scrollSearchFirst</span>(size);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * åç»­ScrollæŸ¥è¯¢
 Â  Â  * @param scrollId ä¸Šæ¬¡æŸ¥è¯¢è¿”å›çš„scrollId
 Â  Â  * @return è¿”å›ä¸‹ä¸€é¡µçš„å›¾ä¹¦åˆ—è¡¨
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/scroll/next"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">scrollSearchNext</span>(<span class="hljs-variable">@RequestParam</span> String scrollId) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.scrollSearchNext</span>(scrollId);
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ¸…é™¤Scrollä¸Šä¸‹æ–‡
 Â  Â  * @param scrollId è¦æ¸…é™¤çš„scrollId
 Â  Â  * @return è¿”å›æ¸…é™¤æˆåŠŸçš„æ¶ˆæ¯
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">DeleteMapping</span>(<span class="hljs-string">"/search/scroll/clear"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">scrollClear</span>(<span class="hljs-variable">@RequestParam</span> String scrollId) {
 Â  Â  Â  Â <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.scrollClear</span>(scrollId);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> "æ¸…é™¤æˆåŠŸ";
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ==================== åœ°å›¾æŸ¥è¯¢ ====================</span>
<span class="hljs-comment">//</span>
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/geo/distance"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">geoDistanceSearch</span>(<span class="hljs-variable">@RequestParam</span> double lat,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span> double lon,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span> String distance) {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.geoDistanceSearch</span>(lat, lon, distance);
 Â   }
â€‹
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search/geo/box"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">geoBoundingBoxSearch</span>(<span class="hljs-variable">@RequestParam</span> double topLeftLat,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> double topLeftLon,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> double bottomRightLat,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable">@RequestParam</span> double bottomRightLon) {
 Â  Â  Â  Â <span class="hljs-selector-tag">GeoPoint</span> <span class="hljs-selector-tag">topLeft</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">GeoPoint</span>(topLeftLat, topLeftLon);
 Â  Â  Â  Â <span class="hljs-selector-tag">GeoPoint</span> <span class="hljs-selector-tag">bottomRight</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">GeoPoint</span>(bottomRightLat, bottomRightLon);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.geoBoundingBoxSearch</span>(topLeft, bottomRight);
 Â   }
â€‹
 Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/search/geo/polygon"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">geoPolygonSearch</span>(<span class="hljs-variable">@RequestBody</span> List&lt;double[]&gt; points) {
 Â  Â  Â  Â <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">GeoPoint</span>&gt; <span class="hljs-selector-tag">geoPoints</span> = <span class="hljs-selector-tag">points</span><span class="hljs-selector-class">.stream</span>()
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.map</span>(p -&gt; new <span class="hljs-built_in">GeoPoint</span>(p[<span class="hljs-number">0</span>], p[<span class="hljs-number">1</span>]))
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.collect</span>(Collectors.<span class="hljs-built_in">toList</span>());
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.geoPolygonSearch</span>(geoPoints);
 Â   }
}
</code></pre>
<hr/>
<h3 data-id="heading-8">åä¸‰ã€é…ç½®ç±»</h3>
<h4 data-id="heading-9"><code>config/ElasticsearchIndexInitializer.java</code></h4>
<p><strong>åœ¨ Spring Boot åº”ç”¨å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨æ£€æŸ¥å¹¶åˆ›å»º Elasticsearch ç´¢å¼•</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.nd.es.config;
â€‹
â€‹
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ElasticsearchIndexInitializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> {
 Â  Â <span class="hljs-meta">@Autowired</span>
 Â  Â <span class="hljs-keyword">private</span> ElasticsearchOperations operations;
 Â  Â 
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception {
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (!operations.indexOps(Book.class).exists()) {
 Â  Â  Â  Â  Â  Â operations.indexOps(Book.class).create();
 Â  Â  Â   }
 Â   }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">åå››ã€<code>EsApplication.java</code></h3>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">nd</span>.<span class="hljs-property">es</span>;
â€‹
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;
â€‹
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EsApplication</span> {
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
 Â  Â  Â  Â <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">EsApplication</span>.<span class="hljs-property">class</span>, args);
 Â   }
}
</code></pre>
<h2 data-id="heading-11">Elasticsearch Query</h2>
<hr/>
<h3 data-id="heading-12">ä¸€ã€å…¨æ–‡æŸ¥è¯¢ï¼ˆFull-Text Queriesï¼‰</h3>
<p><strong>ç‰¹ç‚¹</strong>ï¼šä¼šå¯¹æŸ¥è¯¢æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼Œè®¡ç®—ç›¸å…³æ€§å¾—åˆ†ï¼ˆ<code>_score</code>ï¼‰ï¼Œç”¨äº <code>text</code> å­—æ®µã€‚</p>













































<table><thead><tr><th>æŸ¥è¯¢ç±»å‹</th><th>ç”¨é€”</th><th>DSL ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong><code>match</code></strong></td><td>å•å­—æ®µå…¨æ–‡æœç´¢ï¼ˆæœ€å¸¸ç”¨ï¼‰</td><td><code>{"match": {"title": "Elasticsearchå®æˆ˜"}}</code></td></tr><tr><td><strong><code>multi_match</code></strong></td><td>å¤šå­—æ®µå…¨æ–‡æœç´¢</td><td><code>{"multi_match": {"query": "ES", "fields": ["title", "desc"]}}</code></td></tr><tr><td><strong><code>match_phrase</code></strong></td><td>çŸ­è¯­ç²¾ç¡®åŒ¹é…ï¼ˆä¿æŒè¯åºï¼‰</td><td><code>{"match_phrase": {"desc": "åˆ†å¸ƒå¼æœç´¢å¼•æ“"}}</code></td></tr><tr><td><strong><code>match_phrase_prefix</code></strong></td><td>çŸ­è¯­å‰ç¼€åŒ¹é…ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰</td><td><code>{"match_phrase_prefix": {"title": "Elastic"}}</code></td></tr><tr><td><strong><code>query_string</code></strong></td><td>æ”¯æŒLuceneè¯­æ³•çš„é«˜çº§æŸ¥è¯¢</td><td><code>{"query_string": {"query": "title:ES AND auth:å¼ ä¸‰"}}</code></td></tr><tr><td><strong><code>simple_query_string</code></strong></td><td>ç®€åŒ–ç‰ˆ query_stringï¼ˆå®¹é”™æ€§æ›´å¥½ï¼‰</td><td><code>{"simple_query_string": {"query": "title:ES auth:å¼ ä¸‰"}}</code></td></tr><tr><td><strong><code>fuzzy</code></strong></td><td>æ¨¡ç³ŠåŒ¹é…ï¼ˆå…è®¸æ‹¼å†™é”™è¯¯ï¼‰</td><td><code>{"fuzzy": {"title": {"value": "Elastcsearch", "fuzziness": 2}}}</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">äºŒã€ç²¾ç¡®æŸ¥è¯¢ï¼ˆTerm-Level Queriesï¼‰</h3>
<p><strong>ç‰¹ç‚¹</strong>ï¼šä¸å¯¹æŸ¥è¯¢æ¡ä»¶åˆ†è¯ï¼Œç”¨äºç²¾ç¡®å€¼åŒ¹é…ï¼ˆ<code>keyword</code>ã€æ•°å­—ã€æ—¥æœŸç­‰ï¼‰ã€‚</p>


















































<table><thead><tr><th>æŸ¥è¯¢ç±»å‹</th><th>ç”¨é€”</th><th>DSL ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong><code>term</code></strong></td><td>å•å€¼ç²¾ç¡®åŒ¹é…</td><td><code>{"term": {"status": 1}}</code></td></tr><tr><td><strong><code>terms</code></strong></td><td>å¤šå€¼ç²¾ç¡®åŒ¹é…ï¼ˆORå…³ç³»ï¼‰</td><td><code>{"terms": {"tag": ["java", "python"]}}</code></td></tr><tr><td><strong><code>range</code></strong></td><td>èŒƒå›´æŸ¥è¯¢ï¼ˆgte/lte/gt/ltï¼‰</td><td><code>{"range": {"price": {"gte": 50, "lte": 100}}}</code></td></tr><tr><td><strong><code>prefix</code></strong></td><td>å‰ç¼€åŒ¹é…</td><td><code>{"prefix": {"name.keyword": "El"}}</code></td></tr><tr><td><strong><code>wildcard</code></strong></td><td>é€šé…ç¬¦åŒ¹é…ï¼ˆ<code>* ?</code>ï¼‰</td><td><code>{"wildcard": {"name.keyword": "El*ch"}}</code></td></tr><tr><td><strong><code>regexp</code></strong></td><td>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</td><td><code>{"regexp": {"code.keyword": "A\d{3}"}}</code></td></tr><tr><td><strong><code>exists</code></strong></td><td>å­—æ®µæ˜¯å¦å­˜åœ¨</td><td><code>{"exists": {"field": "desc"}}</code></td></tr><tr><td><strong><code>ids</code></strong></td><td>æ ¹æ®IDåˆ—è¡¨æŸ¥è¯¢</td><td><code>{"ids": {"values": ["1", "2", "3"]}}</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-14">ä¸‰ã€å¤åˆæŸ¥è¯¢ï¼ˆCompound Queriesï¼‰</h3>
<p><strong>ç‰¹ç‚¹</strong>ï¼šç»„åˆå¤šä¸ªå­æŸ¥è¯¢ï¼Œå®ç°å¤æ‚é€»è¾‘ã€‚</p>
<p><strong>ç®—åˆ†ï¼ˆScoringï¼‰</strong> ï¼šElasticsearch ä¸ºæ¯ä¸ªåŒ¹é…çš„æ–‡æ¡£è®¡ç®—ä¸€ä¸ª<strong>ç›¸å…³æ€§å¾—åˆ†ï¼ˆ_scoreï¼‰</strong> ï¼Œç”¨äº<strong>æ’åº</strong>ã€‚å¾—åˆ†è¶Šé«˜ï¼Œæ–‡æ¡£è¶Šç›¸å…³</p>
<h4 data-id="heading-15"><strong>1. bool æŸ¥è¯¢ï¼ˆæœ€å¸¸ç”¨ï¼‰</strong></h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
 Â <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
 Â  Â <span class="hljs-attr">"bool"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
 Â  Â  Â <span class="hljs-attr">"must"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> Â  Â  Â  Â <span class="hljs-comment">// AND - å¿…é¡»åŒ¹é…ï¼Œå‚ä¸ç®—åˆ†</span>
 Â  Â  Â <span class="hljs-attr">"filter"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> Â  Â  Â <span class="hljs-comment">// AND - å¿…é¡»åŒ¹é…ï¼Œä¸å‚ä¸ç®—åˆ†ï¼ˆå¯ç¼“å­˜ï¼Œé«˜æ€§èƒ½ï¼‰</span>
 Â  Â  Â <span class="hljs-attr">"should"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> Â  Â  Â <span class="hljs-comment">// OR  - åº”è¯¥åŒ¹é…ï¼Œå‚ä¸ç®—åˆ†</span>
 Â  Â  Â <span class="hljs-attr">"must_not"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> Â  Â  <span class="hljs-comment">// NOT - å¿…é¡»ä¸åŒ¹é…ï¼Œä¸å‚ä¸ç®—åˆ†</span>
 Â   <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">{
 Â "query": {
 Â  Â "bool": {
 Â  Â  Â "must": [
 Â  Â  Â   {"match": {"title": <span class="hljs-string">"ES"</span>}}
 Â  Â   ],
 Â  Â  Â "<span class="hljs-attribute">filter</span>": [
 Â  Â  Â   {"range": {"price": {"gte": <span class="hljs-number">50</span>}}},
 Â  Â  Â   {"term": {"status": <span class="hljs-number">1</span>}}
 Â  Â   ],
 Â  Â  Â "should": [
 Â  Â  Â   {"term": {"tag<span class="hljs-selector-class">.keyword</span>": <span class="hljs-string">"hot"</span>}}
 Â  Â   ],
 Â  Â  Â "must_not": [
 Â  Â  Â   {"term": {"stock": <span class="hljs-number">0</span>}}
 Â  Â   ]
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-16"><strong>2. å…¶ä»–å¤åˆæŸ¥è¯¢</strong></h4>

























<table><thead><tr><th>æŸ¥è¯¢ç±»å‹</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><strong><code>boosting</code></strong></td><td>æå‡/é™ä½ç›¸å…³æ€§å¾—åˆ†</td></tr><tr><td><strong><code>constant_score</code></strong></td><td>å›ºå®šå¾—åˆ†æŸ¥è¯¢ï¼ˆfilterç»“æœè®¾å›ºå®šåˆ†ï¼‰</td></tr><tr><td><strong><code>dis_max</code></strong></td><td>è¿”å›å¤šä¸ªæŸ¥è¯¢ä¸­å¾—åˆ†æœ€é«˜çš„ç»“æœ</td></tr><tr><td><strong><code>function_score</code></strong></td><td>ä½¿ç”¨å‡½æ•°è‡ªå®šä¹‰è¯„åˆ†é€»è¾‘</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-17">å››ã€å…³è”æŸ¥è¯¢ï¼ˆJoin Queriesï¼‰</h3>
<p><strong>ç”¨äºå¤„ç†æ–‡æ¡£é—´å…³ç³»ï¼ˆåµŒå¥—ã€çˆ¶å­ï¼‰</strong></p>





















<table><thead><tr><th>æŸ¥è¯¢ç±»å‹</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><strong><code>nested</code></strong></td><td>æŸ¥è¯¢åµŒå¥—å¯¹è±¡æ•°ç»„</td></tr><tr><td><strong><code>has_child</code></strong></td><td>æŸ¥è¯¢æœ‰ç‰¹å®šå­æ–‡æ¡£çš„çˆ¶æ–‡æ¡£</td></tr><tr><td><strong><code>has_parent</code></strong></td><td>æŸ¥è¯¢æœ‰ç‰¹å®šçˆ¶æ–‡æ¡£çš„å­æ–‡æ¡£</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">äº”ã€ç‰¹æ®ŠåŒ–æŸ¥è¯¢ï¼ˆSpecialized Queriesï¼‰</h3>

























<table><thead><tr><th>æŸ¥è¯¢ç±»å‹</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><strong><code>more_like_this</code></strong></td><td>æŸ¥æ‰¾ç›¸ä¼¼æ–‡æ¡£ï¼ˆå†…å®¹æ¨èï¼‰</td></tr><tr><td><strong><code>script</code></strong></td><td>ä½¿ç”¨è„šæœ¬æ‰§è¡ŒæŸ¥è¯¢</td></tr><tr><td><strong><code>percolate</code></strong></td><td>åå‘æŸ¥è¯¢ï¼ˆæ–‡æ¡£åŒ¹é…æŸ¥è¯¢ï¼‰</td></tr><tr><td><strong><code>wrapper</code></strong></td><td>åŒ…è£…å…¶ä»–æŸ¥è¯¢ï¼ˆå¦‚Base64ç¼–ç ï¼‰</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-19">å…­ã€åœ°ç†æŸ¥è¯¢ï¼ˆGeo Queriesï¼‰</h3>

























<table><thead><tr><th>æŸ¥è¯¢ç±»å‹</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><strong><code>geo_distance</code></strong></td><td>è·ç¦»æŸç‚¹æŒ‡å®šèŒƒå›´å†…çš„æ–‡æ¡£</td></tr><tr><td><strong><code>geo_bounding_box</code></strong></td><td>çŸ©å½¢åŒºåŸŸå†…çš„æ–‡æ¡£</td></tr><tr><td><strong><code>geo_polygon</code></strong></td><td>å¤šè¾¹å½¢åŒºåŸŸå†…çš„æ–‡æ¡£</td></tr><tr><td><strong><code>geo_shape</code></strong></td><td>å¤æ‚åœ°ç†å½¢çŠ¶æŸ¥è¯¢</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-20">ä¸ƒã€ç‰¹æ®ŠæŸ¥è¯¢</h3>
<h4 data-id="heading-21"><strong>1. åŒ¹é…æ‰€æœ‰æ–‡æ¡£</strong></h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"match_all"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-22"><strong>2. ä¸åŒ¹é…ä»»ä½•æ–‡æ¡£</strong></h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"match_none"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-23"><strong>Query ä¸ Filter çš„åŒºåˆ«</strong></h3>

























<table><thead><tr><th>ç‰¹æ€§</th><th>Query</th><th>Filter</th></tr></thead><tbody><tr><td><strong>æ˜¯å¦ç®—åˆ†</strong></td><td>æ˜¯ï¼ˆå½±å“æ’åºï¼‰</td><td>å¦ï¼ˆå›ºå®šåˆ†ä¸º0ï¼‰</td></tr><tr><td><strong>æ˜¯å¦ç¼“å­˜</strong></td><td>å¦</td><td>æ˜¯ï¼ˆæ€§èƒ½æ›´é«˜ï¼‰</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>å…¨æ–‡æœç´¢ã€ç›¸å…³æ€§åŒ¹é…</td><td>ç²¾ç¡®è¿‡æ»¤ã€èŒƒå›´ç­›é€‰</td></tr></tbody></table>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼šè¿‡æ»¤æ¡ä»¶æ”¾åœ¨ <code>bool.filter</code> ä¸­ï¼Œæœç´¢æ¡ä»¶æ”¾åœ¨ <code>bool.must/should</code> ä¸­ã€‚</p>
<h2 data-id="heading-24">å¯¹åº”çš„ Elasticsearch DSL è¯­å¥</h2>
<hr/>
<h3 data-id="heading-25">ä¸€ã€ç´¢å¼•ç®¡ç†</h3>
<h4 data-id="heading-26">1. åˆ›å»ºç´¢å¼• <code>createIndex()</code></h4>
<pre><code class="hljs language-bash" lang="bash">PUT /book
{
  <span class="hljs-string">"settings"</span>: {
 Â   <span class="hljs-string">"number_of_shards"</span>: 5,
 Â   <span class="hljs-string">"number_of_replicas"</span>: 1
  },
  <span class="hljs-string">"mappings"</span>: {
 Â   <span class="hljs-string">"properties"</span>: {
 Â  Â   <span class="hljs-string">"id"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"keyword"</span>},
 Â  Â   <span class="hljs-string">"name"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>, <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>},
 Â  Â   <span class="hljs-string">"auth"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"keyword"</span>},
 Â  Â   <span class="hljs-string">"count"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"long"</span>},
 Â  Â   <span class="hljs-string">"createtime"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"date"</span>},
 Â  Â   <span class="hljs-string">"desc"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>, <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>}
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-27">2. åˆ é™¤ç´¢å¼• <code>deleteIndex()</code></h4>
<pre><code class="hljs language-bash" lang="bash">DELETE /book
</code></pre>
<hr/>
<h3 data-id="heading-28">äºŒã€æ–‡æ¡£æ“ä½œ</h3>
<h4 data-id="heading-29">3. ä¿å­˜å•ä¸ªæ–‡æ¡£ <code>save(@RequestBody Book book)</code></h4>
<pre><code class="hljs language-bash" lang="bash">POST /book/_doc
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Elasticsearchå®æˆ˜"</span>,
  <span class="hljs-string">"auth"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
  <span class="hljs-string">"count"</span>: 100,
  <span class="hljs-string">"createtime"</span>: <span class="hljs-string">"2024-01-01"</span>,
  <span class="hljs-string">"desc"</span>: <span class="hljs-string">"Elasticsearchå…¥é—¨åˆ°ç²¾é€š"</span>
}
<span class="hljs-comment"># æˆ–æŒ‡å®šIDæ›´æ–°</span>
PUT /book/_doc/{<span class="hljs-built_in">id</span>}
</code></pre>
<h4 data-id="heading-30">4. æ‰¹é‡ä¿å­˜ <code>saveAll(@RequestBody List&lt;Book&gt; books)</code></h4>
<pre><code class="hljs language-bash" lang="bash">POST /book/_bulk
{<span class="hljs-string">"index"</span>:{<span class="hljs-string">"_id"</span>:<span class="hljs-string">"1"</span>}}
{<span class="hljs-string">"name"</span>:<span class="hljs-string">"Book1"</span>,<span class="hljs-string">"auth"</span>:<span class="hljs-string">"Author1"</span>,<span class="hljs-string">"count"</span>:10,<span class="hljs-string">"createtime"</span>:<span class="hljs-string">"2024-01-01"</span>,<span class="hljs-string">"desc"</span>:<span class="hljs-string">"desc1"</span>}
{<span class="hljs-string">"index"</span>:{<span class="hljs-string">"_id"</span>:<span class="hljs-string">"2"</span>}}
{<span class="hljs-string">"name"</span>:<span class="hljs-string">"Book2"</span>,<span class="hljs-string">"auth"</span>:<span class="hljs-string">"Author2"</span>,<span class="hljs-string">"count"</span>:20,<span class="hljs-string">"createtime"</span>:<span class="hljs-string">"2024-01-02"</span>,<span class="hljs-string">"desc"</span>:<span class="hljs-string">"desc2"</span>}
</code></pre>
<h4 data-id="heading-31">5. æ ¹æ®IDæŸ¥æ‰¾ <code>findById(@PathVariable String id)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_doc/{<span class="hljs-built_in">id</span>}
</code></pre>
<h4 data-id="heading-32">6. æ ¹æ®IDåˆ é™¤ <code>deleteById(@PathVariable String id)</code></h4>
<pre><code class="hljs language-bash" lang="bash">DELETE /book/_doc/{<span class="hljs-built_in">id</span>}
</code></pre>
<h4 data-id="heading-33">7. æŸ¥æ‰¾æ‰€æœ‰ <code>findAll()</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {<span class="hljs-string">"match_all"</span>: {}},
  <span class="hljs-string">"size"</span>: 100
}
</code></pre>
<hr/>
<h3 data-id="heading-34">ä¸‰ã€æ‰¹é‡æ“ä½œ</h3>
<h4 data-id="heading-35">8. æ‰¹é‡åˆ›å»º <code>bulkCreate(@RequestBody List&lt;Book&gt; books)</code></h4>
<pre><code class="hljs language-bash" lang="bash">POST /book/_bulk
{<span class="hljs-string">"index"</span>:{<span class="hljs-string">"_id"</span>:<span class="hljs-string">"1"</span>}}
{<span class="hljs-string">"name"</span>:<span class="hljs-string">"Book1"</span>,<span class="hljs-string">"auth"</span>:<span class="hljs-string">"Author1"</span>,<span class="hljs-string">"count"</span>:10,<span class="hljs-string">"createtime"</span>:<span class="hljs-string">"2024-01-01"</span>,<span class="hljs-string">"desc"</span>:<span class="hljs-string">"desc1"</span>}
{<span class="hljs-string">"index"</span>:{<span class="hljs-string">"_id"</span>:<span class="hljs-string">"2"</span>}}
{<span class="hljs-string">"name"</span>:<span class="hljs-string">"Book2"</span>,<span class="hljs-string">"auth"</span>:<span class="hljs-string">"Author2"</span>,<span class="hljs-string">"count"</span>:20,<span class="hljs-string">"createtime"</span>:<span class="hljs-string">"2024-01-02"</span>,<span class="hljs-string">"desc"</span>:<span class="hljs-string">"desc2"</span>}
</code></pre>
<h4 data-id="heading-36">9. æ‰¹é‡åˆ é™¤ <code>bulkDelete(@RequestBody List&lt;String&gt; ids)</code></h4>
<pre><code class="hljs language-bash" lang="bash">POST /book/_bulk
{<span class="hljs-string">"delete"</span>:{<span class="hljs-string">"_id"</span>:<span class="hljs-string">"1"</span>}}
{<span class="hljs-string">"delete"</span>:{<span class="hljs-string">"_id"</span>:<span class="hljs-string">"2"</span>}}
{<span class="hljs-string">"delete"</span>:{<span class="hljs-string">"_id"</span>:<span class="hljs-string">"3"</span>}}
</code></pre>
<hr/>
<h3 data-id="heading-37">å››ã€TermæŸ¥è¯¢ï¼ˆç²¾ç¡®å€¼ï¼‰</h3>
<h4 data-id="heading-38">10. æ ¹æ®åç§°ç²¾ç¡®æŸ¥è¯¢ <code>findByName(@RequestParam String name)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"term"</span>: {
 Â  Â   <span class="hljs-string">"name.keyword"</span>: <span class="hljs-string">"Elasticsearchå®æˆ˜"</span>
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-39">11. æ ¹æ®åç§°åˆ—è¡¨æŸ¥è¯¢ <code>findByNameIn(@RequestBody List&lt;String&gt; names)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"terms"</span>: {
 Â  Â   <span class="hljs-string">"name.keyword"</span>: [<span class="hljs-string">"Book1"</span>, <span class="hljs-string">"Book2"</span>, <span class="hljs-string">"Book3"</span>]
 Â   }
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-40">äº”ã€MatchæŸ¥è¯¢ï¼ˆå…¨æ–‡ï¼‰</h3>
<h4 data-id="heading-41">12. å…¨æ–‡æœç´¢ <code>searchByName(@RequestParam String name)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"match"</span>: {
 Â  Â   <span class="hljs-string">"name"</span>: <span class="hljs-string">"Elasticsearch"</span>
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-42">13. æ¨¡ç³ŠæŸ¥è¯¢ <code>searchByNameLike(@RequestParam String name)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"match"</span>: {
 Â  Â   <span class="hljs-string">"name"</span>: {
 Â  Â  Â   <span class="hljs-string">"query"</span>: <span class="hljs-string">"Elastcsearch"</span>,
 Â  Â  Â   <span class="hljs-string">"fuzziness"</span>: <span class="hljs-string">"AUTO"</span>,
 Â  Â  Â   <span class="hljs-string">"prefix_length"</span>: 2
 Â  Â   }
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-43">14. å¤šå­—æ®µå…¨æ–‡æœç´¢ <code>multiMatchSearch(@RequestParam String keyword)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"multi_match"</span>: {
 Â  Â   <span class="hljs-string">"query"</span>: <span class="hljs-string">"Elasticsearch å®æˆ˜"</span>,
 Â  Â   <span class="hljs-string">"fields"</span>: [<span class="hljs-string">"name"</span>, <span class="hljs-string">"desc"</span>]
 Â   }
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-44">å…­ã€å¸ƒå°”æŸ¥è¯¢</h3>
<h4 data-id="heading-45">15. å¸ƒå°”mustæŸ¥è¯¢ <code>boolSearch(@RequestParam String name, @RequestParam String auth)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"bool"</span>: {
 Â  Â   <span class="hljs-string">"must"</span>: [
 Â  Â  Â   {<span class="hljs-string">"match"</span>: {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Elasticsearch"</span>}},
 Â  Â  Â   {<span class="hljs-string">"term"</span>: {<span class="hljs-string">"auth.keyword"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>}}
 Â  Â   ]
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-46">16. å¸ƒå°”shouldæŸ¥è¯¢ <code>boolShouldSearch(@RequestParam String name, @RequestParam String auth)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"bool"</span>: {
 Â  Â   <span class="hljs-string">"should"</span>: [
 Â  Â  Â   {<span class="hljs-string">"match"</span>: {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Elasticsearch"</span>}},
 Â  Â  Â   {<span class="hljs-string">"term"</span>: {<span class="hljs-string">"auth.keyword"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>}}
 Â  Â   ],
 Â  Â   <span class="hljs-string">"minimum_should_match"</span>: 1
 Â   }
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-47">ä¸ƒã€èŒƒå›´æŸ¥è¯¢</h3>
<h4 data-id="heading-48">17. æ•°å€¼èŒƒå›´æŸ¥è¯¢ <code>rangeSearch(@RequestParam Long min, @RequestParam Long max)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"range"</span>: {
 Â  Â   <span class="hljs-string">"count"</span>: {
 Â  Â  Â   <span class="hljs-string">"gte"</span>: 10,
 Â  Â  Â   <span class="hljs-string">"lte"</span>: 100
 Â  Â   }
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-49">18. æ—¥æœŸèŒƒå›´æŸ¥è¯¢ <code>dateRangeSearch(@RequestParam String startDate, @RequestParam String endDate)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"range"</span>: {
 Â  Â   <span class="hljs-string">"createtime"</span>: {
 Â  Â  Â   <span class="hljs-string">"gte"</span>: <span class="hljs-string">"2024-01-01"</span>,
 Â  Â  Â   <span class="hljs-string">"lte"</span>: <span class="hljs-string">"2024-12-31"</span>,
 Â  Â  Â   <span class="hljs-string">"format"</span>: <span class="hljs-string">"yyyy-MM-dd"</span>
 Â  Â   }
 Â   }
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-50">å…«ã€å…¶ä»–æŸ¥è¯¢</h3>
<h4 data-id="heading-51">19. å‰ç¼€æŸ¥è¯¢ <code>prefixSearch(@RequestParam String prefix)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"prefix"</span>: {
 Â  Â   <span class="hljs-string">"name.keyword"</span>: <span class="hljs-string">"Es"</span>
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-52">20. é€šé…ç¬¦æŸ¥è¯¢ <code>wildcardSearch(@RequestParam String pattern)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"wildcard"</span>: {
 Â  Â   <span class="hljs-string">"name.keyword"</span>: <span class="hljs-string">"El*ic*"</span>
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-53">21. æ¨¡ç³ŠæŸ¥è¯¢ <code>fuzzySearch(@RequestParam String value, @RequestParam(defaultValue = "2") int prefixLength)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"fuzzy"</span>: {
 Â  Â   <span class="hljs-string">"name"</span>: {
 Â  Â  Â   <span class="hljs-string">"value"</span>: <span class="hljs-string">"elastcsearch"</span>,
 Â  Â  Â   <span class="hljs-string">"fuzziness"</span>: 2,
 Â  Â  Â   <span class="hljs-string">"prefix_length"</span>: 2
 Â  Â   }
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-54">22. æ­£åˆ™æŸ¥è¯¢ <code>regexpSearch(@RequestParam String regexp)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"regexp"</span>: {
 Â  Â   <span class="hljs-string">"name.keyword"</span>: <span class="hljs-string">"Elasticsearch.*"</span>
 Â   }
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-55">ä¹ã€IDæŸ¥è¯¢</h3>
<h4 data-id="heading-56">23. æ ¹æ®IDæŸ¥è¯¢ <code>findByIdQuery(@PathVariable String id)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_doc/{<span class="hljs-built_in">id</span>}
</code></pre>
<h4 data-id="heading-57">24. æ ¹æ®IDåˆ—è¡¨æŸ¥è¯¢ <code>findByIds(@RequestBody List&lt;String&gt; ids)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"ids"</span>: {
 Â  Â   <span class="hljs-string">"values"</span>: [<span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>]
 Â   }
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-58">åã€é«˜äº®æŸ¥è¯¢</h3>
<h4 data-id="heading-59">25. é«˜äº®æœç´¢ <code>highlightSearch(@RequestParam String keyword)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"match"</span>: {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Elasticsearch"</span>}
  },
  <span class="hljs-string">"highlight"</span>: {
 Â   <span class="hljs-string">"pre_tags"</span>: [<span class="hljs-string">"&lt;em&gt;"</span>],
 Â   <span class="hljs-string">"post_tags"</span>: [<span class="hljs-string">"&lt;/em&gt;"</span>],
 Â   <span class="hljs-string">"fields"</span>: {
 Â  Â   <span class="hljs-string">"name"</span>: {},
 Â  Â   <span class="hljs-string">"desc"</span>: {}
 Â   }
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-60">åä¸€ã€èšåˆæŸ¥è¯¢</h3>
<h4 data-id="heading-61">26. ç»Ÿè®¡æŸ¥è¯¢ <code>statsSearch()</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"size"</span>: 0,
  <span class="hljs-string">"aggs"</span>: {
 Â   <span class="hljs-string">"count_stats"</span>: {
 Â  Â   <span class="hljs-string">"stats"</span>: {<span class="hljs-string">"field"</span>: <span class="hljs-string">"count"</span>}
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-62">27. åŸºæ•°ç»Ÿè®¡ <code>cardinalitySearch(@RequestParam String field)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"size"</span>: 0,
  <span class="hljs-string">"aggs"</span>: {
 Â   <span class="hljs-string">"auth_count"</span>: {
 Â  Â   <span class="hljs-string">"cardinality"</span>: {<span class="hljs-string">"field"</span>: <span class="hljs-string">"auth.keyword"</span>}
 Â   }
  }
}
</code></pre>
<h4 data-id="heading-63">28. èŒƒå›´ç»Ÿè®¡ <code>rangeStats(@RequestParam Long min, @RequestParam Long max)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"range"</span>: {
 Â  Â   <span class="hljs-string">"count"</span>: {<span class="hljs-string">"gte"</span>: 10, <span class="hljs-string">"lte"</span>: 100}
 Â   }
  },
  <span class="hljs-string">"size"</span>: 0,
  <span class="hljs-string">"aggs"</span>: {
 Â   <span class="hljs-string">"count_stats"</span>: {
 Â  Â   <span class="hljs-string">"stats"</span>: {<span class="hljs-string">"field"</span>: <span class="hljs-string">"count"</span>}
 Â   }
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-64">åäºŒã€åˆ é™¤æŸ¥è¯¢</h3>
<h4 data-id="heading-65">29. æ ¹æ®æ¡ä»¶åˆ é™¤ <code>deleteByQuery(@RequestParam String field, @RequestParam String value)</code></h4>
<pre><code class="hljs language-bash" lang="bash">POST /book/_delete_by_query
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"term"</span>: {<span class="hljs-string">"auth.keyword"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>}
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-66">åä¸‰ã€BoostingæŸ¥è¯¢</h3>
<h4 data-id="heading-67">30. BoostingæŸ¥è¯¢ <code>boostingSearch(...)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"boosting"</span>: {
 Â  Â   <span class="hljs-string">"positive"</span>: {<span class="hljs-string">"match"</span>: {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Elasticsearch"</span>}},
 Â  Â   <span class="hljs-string">"negative"</span>: {<span class="hljs-string">"term"</span>: {<span class="hljs-string">"auth.keyword"</span>: <span class="hljs-string">"æå››"</span>}},
 Â  Â   <span class="hljs-string">"negative_boost"</span>: 0.2
 Â   }
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-68">åå››ã€FilteræŸ¥è¯¢</h3>
<h4 data-id="heading-69">31. FilteræŸ¥è¯¢ <code>filterSearch(...)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
 Â   <span class="hljs-string">"bool"</span>: {
 Â  Â   <span class="hljs-string">"must"</span>: [{<span class="hljs-string">"match"</span>: {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Elasticsearch"</span>}}],
 Â  Â   <span class="hljs-string">"filter"</span>: [
 Â  Â  Â   {<span class="hljs-string">"range"</span>: {<span class="hljs-string">"count"</span>: {<span class="hljs-string">"gte"</span>: 10, <span class="hljs-string">"lte"</span>: 100}}}
 Â  Â   ]
 Â   }
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-70">åäº”ã€æ·±åˆ†é¡µ Scroll</h3>
<h4 data-id="heading-71">32. é¦–æ¬¡ScrollæŸ¥è¯¢ <code>scrollSearchFirst(@RequestParam(defaultValue = "10") int size)</code></h4>
<pre><code class="hljs language-bash" lang="bash">POST /book/_search?scroll=1m
{
  <span class="hljs-string">"size"</span>: 10,
  <span class="hljs-string">"query"</span>: {<span class="hljs-string">"match_all"</span>: {}}
}
â€‹
<span class="hljs-comment"># è¿”å›ç»“æœåŒ…å« _scroll_id</span>
</code></pre>
<h4 data-id="heading-72">33. åç»­ScrollæŸ¥è¯¢ <code>scrollSearchNext(@RequestParam String scrollId)</code></h4>
<pre><code class="hljs language-bash" lang="bash">POST /_search/scroll
{
  <span class="hljs-string">"scroll"</span>: <span class="hljs-string">"1m"</span>,
  <span class="hljs-string">"scroll_id"</span>: <span class="hljs-string">"DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAD4WYm9laVYtZndUQlNsdDcwakFMNjU1QQ=="</span>
}
</code></pre>
<h4 data-id="heading-73">34. æ¸…é™¤Scroll <code>scrollClear(@RequestParam String scrollId)</code></h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-operator">/</span>_search<span class="hljs-operator">/</span><span class="hljs-keyword">scroll</span>
{
  "scroll_id": ["DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAD4WYm9laVYtZndUQlNsdDcwakFMNjU1QQ=="]
}
</code></pre>
<hr/>
<h3 data-id="heading-74">åå…­ã€åœ°å›¾æŸ¥è¯¢</h3>
<h4 data-id="heading-75">35. åœ°ç†è·ç¦»æŸ¥è¯¢ <code>geoDistanceSearch(@RequestParam double lat, @RequestParam double lon, @RequestParam String distance)</code></h4>
<p>æ·»åŠ å­—æ®µ</p>
<p>æ­¥éª¤ 1 æŠŠ location åŠ å…¥ mappingï¼ˆå‡è®¾åŸ mapping é‡Œæ²¡æœ‰è¯¥å­—æ®µï¼‰</p>
<pre><code class="hljs language-bash" lang="bash">PUT /book/_mapping
{
  <span class="hljs-string">"properties"</span>: {
    <span class="hljs-string">"location"</span>: {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"geo_point"</span>
    }
  }
}
</code></pre>
<p>æ­¥éª¤ 2 ç»™å·²æœ‰æ–‡æ¡£å†™å…¥åæ ‡ï¼ˆç¤ºä¾‹æ›´æ–° id=1 çš„æ–‡æ¡£ï¼‰</p>
<pre><code class="hljs language-bash" lang="bash">POST /book/_update/1
{
  <span class="hljs-string">"doc"</span>: {
    <span class="hljs-string">"location"</span>: {
      <span class="hljs-string">"lat"</span>: 40.12,
      <span class="hljs-string">"lon"</span>: -71.34
    }
  }
}
</code></pre>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
    <span class="hljs-string">"geo_distance"</span>: {
      <span class="hljs-string">"distance"</span>: <span class="hljs-string">"10km"</span>,
      <span class="hljs-string">"location"</span>: {
        <span class="hljs-string">"lat"</span>: 40.12,
        <span class="hljs-string">"lon"</span>: -71.34
      }
    }
  }
}
</code></pre>
<h4 data-id="heading-76">36. åœ°ç†è¾¹ç•Œæ¡†æŸ¥è¯¢ <code>geoBoundingBoxSearch(...)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
    <span class="hljs-string">"geo_bounding_box"</span>: {
      <span class="hljs-string">"location"</span>: {
        <span class="hljs-string">"top_left"</span>: {<span class="hljs-string">"lat"</span>: 40.73, <span class="hljs-string">"lon"</span>: -74.1},
        <span class="hljs-string">"bottom_right"</span>: {<span class="hljs-string">"lat"</span>: 40.01, <span class="hljs-string">"lon"</span>: -71.12}
      }
    }
  }
}
</code></pre>
<h4 data-id="heading-77">37. åœ°ç†å¤šè¾¹å½¢æŸ¥è¯¢ <code>geoPolygonSearch(@RequestBody List&lt;double[]&gt; points)</code></h4>
<pre><code class="hljs language-bash" lang="bash">GET /book/_search
{
  <span class="hljs-string">"query"</span>: {
    <span class="hljs-string">"geo_polygon"</span>: {
      <span class="hljs-string">"location"</span>: {
        <span class="hljs-string">"points"</span>: [
          {<span class="hljs-string">"lat"</span>: 40, <span class="hljs-string">"lon"</span>: -70},
          {<span class="hljs-string">"lat"</span>: 42, <span class="hljs-string">"lon"</span>: -72},
          {<span class="hljs-string">"lat"</span>: 41, <span class="hljs-string">"lon"</span>: -74}
        ]
      }
    }
  }
}
</code></pre>
<hr/>
<p><strong>ä½¿ç”¨è¯´æ˜ï¼š</strong></p>
<ul>
<li>å°† <code>{id}</code>ã€<code>{field}</code>ã€<code>{value}</code> æ›¿æ¢ä¸ºå®é™…å‚æ•°</li>
<li>åœ°ç†æŸ¥è¯¢éœ€è¦ <code>location</code> å­—æ®µç±»å‹ä¸º <code>geo_point</code></li>
<li>ScrollæŸ¥è¯¢éœ€è¦ä¿å­˜è¿”å›çš„ <code>_scroll_id</code> ç”¨äºåç»­è¯·æ±‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†³ç­–æ ‘æç®€å…¥é—¨]]></title>    <link>https://juejin.cn/post/7603556326816710708</link>    <guid>https://juejin.cn/post/7603556326816710708</guid>    <pubDate>2026-02-07T00:06:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603556326816710708" data-draft-id="7603556326816694324" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†³ç­–æ ‘æç®€å…¥é—¨"/> <meta itemprop="keywords" content="Python,æœºå™¨å­¦ä¹ ,scikit-learn"/> <meta itemprop="datePublished" content="2026-02-07T00:06:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†³ç­–æ ‘æç®€å…¥é—¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T00:06:48.000Z" title="Sat Feb 07 2026 00:06:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘ä»¬åœ¨å­¦ä¹ æœºå™¨å­¦ä¹ ç®—æ³•æ—¶ï¼Œå¾€å¾€ä¼šè¢«å„ç§æ¯ç‡¥çš„æ•°å­¦å…¬å¼æ‰€åŠé€€ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘å°†å°è¯•ç”¨ç»“åˆå®é™…ç”Ÿæ´»çš„æ–¹å¼ï¼Œæ¥ä»‹ç»ä¸€ä¸ªéå¸¸ç»å…¸ï¼Œè€Œä¸”å¯èƒ½æ˜¯æœ€â€œæ‡‚ä½ å¿ƒæ„â€çš„ç®—æ³•â€”â€”å†³ç­–æ ‘ (Decision Tree)ã€‚ã€‚</p>
<p>åˆ«è¢«è¿™ä¸ªæœ¯è¯­å“åˆ°äº†ï¼Œå…¶å®ä½ æ¯å¤©ç‚¹å¤–å–çš„æ—¶å€™éƒ½åœ¨ç”¨å®ƒã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä¸‹åˆä¸‰ç‚¹ï¼Œä½ ç«™åœ¨å¥¶èŒ¶åº—é—¨å£ï¼ˆæˆ–è€…æ‰“å¼€äº†å¤–å–Appï¼‰ï¼Œé¢å¯¹çœ¼èŠ±ç¼­ä¹±çš„èœå•ï¼Œä½ çš„å¤§è„‘ä¸ºäº†ä¿æŠ¤ä½ çš„ä½“é‡ï¼Œç«‹åˆ»å¯åŠ¨äº†ä¸€ä¸ªâ€œå†³ç­–æ ‘â€ç¨‹åºï¼š</p>
<ol>
<li>è¿™æ¯å¥¶èŒ¶å«ç³–å—ï¼Ÿ -&gt; å¦‚æœæ˜¯å…¨ç³– -&gt; ä¸å–ï¼Œä¼šèƒ–æ­» âŒã€‚</li>
<li>-&gt; å¦‚æœæ˜¯æ— ç³– -&gt; å†çœ‹çœ‹ã€‚</li>
<li>åŠ æ²¡åŠ å°æ–™ï¼Ÿ -&gt; æ²¡åŠ ï¼Ÿ -&gt; æ²¡çµé­‚ï¼Œä¸å– âŒã€‚</li>
<li>-&gt; åŠ äº†æ³¢éœ¸/çç ï¼Ÿ -&gt; å®Œç¾ï¼ä¹°å®ƒï¼ âœ…</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30fcac0abe4547a28b77001f598834bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771027608&amp;x-signature=BTgCFKXIgfOX1h3B%2FyXvneR475s%3D" alt="ç”»æ¿" loading="lazy"/></p>
<p>çœ‹ï¼Œè¿™å°±æ˜¯ä¸€æ£µå†³ç­–æ ‘ï¼æŠŠä½ è„‘æµ·é‡Œçº ç»“çš„è¿‡ç¨‹ç”»ä¸‹æ¥ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå€’ç«‹çš„æ ‘çŠ¶æµç¨‹å›¾ã€‚</p>
<p>ä½†åœ¨æœºå™¨å­¦ä¹ é‡Œï¼Œæˆ‘ä»¬ä¸æ˜¯è‡ªå·±ç”»å›¾ï¼Œè€Œæ˜¯è®©è®¡ç®—æœºé€šè¿‡å­¦ä¹ å†å²è®¢å•æ•°æ®ï¼Œè‡ªå·±æ€»ç»“å‡ºè¿™å¥—â€œç‚¹å•ç§˜ç±â€ã€‚</p>
<p>å®ƒæ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿåˆ«æ€¥ï¼Œæˆ‘ä»¬è¦ç”¨å‡ æ¯å¥¶èŒ¶æ¥æ•™ä¼šä½ ã€‚ğŸ§‹</p>
<h2 data-id="heading-0">ğŸŒ² ç¬¬ä¸€éƒ¨åˆ†ï¼šè§£å‰–å†³ç­–æ ‘</h2>
<p>åœ¨æ·±å…¥ä¹‹å‰ï¼Œå’±ä»¬å…ˆå¯¹é½ä¸€ä¸‹ <strong>â€œè¡Œè¯â€</strong>ã€‚è™½ç„¶å®ƒå«æ ‘ï¼Œä½†åœ¨è®¡ç®—æœºç§‘å­¦é‡Œï¼Œè¿™æ£µæ ‘é€šå¸¸æ˜¯å€’ç€é•¿çš„ï¼ˆæ ¹åœ¨ä¸Šé¢ï¼Œå¶å­åœ¨ä¸‹é¢ï¼‰ã€‚</p>
<ul>
<li><strong>æ ¹èŠ‚ç‚¹</strong> (<code>Root Node</code>): æ ‘çš„æœ€é¡¶ç«¯ã€‚ä¹Ÿå°±æ˜¯æœ€å…³é”®çš„é‚£ä¸ªé—®é¢˜ï¼ˆæ¯”å¦‚ï¼šç”œåº¦æ˜¯å¤šå°‘ï¼Ÿï¼‰ã€‚</li>
<li><strong>å†³ç­–èŠ‚ç‚¹</strong> (<code>Decision Node</code>): ä¸­é—´çš„é‚£äº›ç«™ç‚¹ï¼Œè´Ÿè´£æ ¹æ®æŸä¸ªç‰¹å¾ï¼ˆæ¯”å¦‚å°æ–™ã€å†·çƒ­ï¼‰æŠŠæ•°æ®åˆ†æµã€‚</li>
<li><strong>å¶èŠ‚ç‚¹</strong> (<code>Leaf Node</code>): æ ‘çš„æœ«ç«¯ã€‚åˆ°äº†è¿™é‡Œï¼Œä¸å†é—®é—®é¢˜äº†ï¼Œç›´æ¥ç»™å‡ºæœ€ç»ˆåˆ¤å†³ï¼ˆæ¯”å¦‚ï¼šå–ï¼ æˆ–è€… å¿«é€ƒï¼ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-1">ğŸ§  ç¬¬äºŒéƒ¨åˆ†ï¼šæ ‘æ˜¯æ€ä¹ˆâ€œé•¿â€å‡ºæ¥çš„ï¼Ÿ</h2>
<p>è¿™æ‰æ˜¯æœ€è¿·äººçš„åœ°æ–¹ã€‚å¦‚æœä½ ç»™æ¨¡å‹ä¸€å †å¥¶èŒ¶æ•°æ®ï¼Œå®ƒæ€ä¹ˆçŸ¥é“å…ˆçœ‹â€œç”œåº¦â€è¿˜æ˜¯å…ˆçœ‹â€œä»·æ ¼â€ï¼Ÿ</p>
<p>è¿™å°±æ¶‰åŠåˆ°ä¸¤ä¸ªè¶…çº§é‡è¦çš„æ¦‚å¿µï¼š<strong>ç†µ</strong> (<code>Entropy</code>) å’Œ <strong>ä¿¡æ¯å¢ç›Š</strong> (<code>Information Gain</code>)ã€‚</p>
<h3 data-id="heading-2">1. ä»€ä¹ˆæ˜¯ç†µ (Entropy)ï¼Ÿ</h3>
<p>ç‰©ç†å­¦é‡Œè¯´<strong>ç†µ</strong>ä»£è¡¨<strong>æ··ä¹±ç¨‹åº¦</strong>ã€‚åœ¨å†³ç­–æ ‘é‡Œï¼Œ<strong>ç†µ</strong>ä»£è¡¨æ•°æ®çš„ <strong>â€œä¸çº¯åº¦â€</strong>ï¼ˆä½ ä¹Ÿå¯ä»¥ç†è§£ä¸º** â€œçº ç»“ç¨‹åº¦â€ **ï¼‰ã€‚</p>
<ul>
<li><strong>åœºæ™¯ A</strong>: ä½ é¢å‰æœ‰10æ¯å¥¶èŒ¶ï¼Œå…¨æ˜¯æ— ç³–æ³¢éœ¸å¥¶èŒ¶ã€‚è¿™æ•°æ®å¤ªçº¯äº†ï¼Œç†µ = 0ã€‚ä½ é—­ç€çœ¼æ‹¿ä¸€æ¯éƒ½æ˜¯ä½ æƒ³å–çš„ï¼Œå®Œå…¨ä¸ç”¨çº ç»“ã€‚</li>
<li><strong>åœºæ™¯ B:</strong> ä½ é¢å‰æœ‰10æ¯å¥¶èŒ¶ï¼Œ5æ¯æ˜¯ä½ æœ€çˆ±çš„æ— ç³–ï¼Œ5æ¯æ˜¯ç”œåˆ°é½çš„å…¨ç³–ï¼Œæ··åœ¨ä¸€èµ·ã€‚è¿™å¤ªæ··ä¹±äº†ï¼Œç†µ = 1ï¼ˆæœ€é«˜ï¼‰ã€‚ä½ å®Œå…¨çŒœä¸åˆ°ä¸‹ä¸€æ¯æ˜¯ä¸æ˜¯â€œé›·â€ã€‚</li>
</ul>
<p>æœºå™¨å­¦ä¹ çš„ç›®æ ‡å°±æ˜¯ï¼šé€šè¿‡é—®é—®é¢˜ï¼ˆåˆ†è£‚ï¼‰ï¼Œè®©æ•°æ®çš„ç†µè¶Šæ¥è¶Šå°ï¼Œç›´åˆ°å˜æˆ 0ï¼ˆå®Œå…¨çº¯å‡€ï¼‰ã€‚</p>
<h3 data-id="heading-3">2. ä¿¡æ¯å¢ç›Š (Information Gain)</h3>
<p>è¿™å°±æ˜¯æˆ‘ä»¬çš„ <strong>â€œç­›é€‰æ ‡å‡†â€</strong>ã€‚</p>
<ul>
<li><strong>ä¿¡æ¯å¢ç›Š</strong> = <strong>åˆ†è£‚å‰çš„ç†µ</strong> - <strong>åˆ†è£‚åçš„ç†µ</strong></li>
</ul>
<p>ç®€å•è¯´ï¼šå¦‚æœæˆ‘æŒ‰â€œç”œåº¦â€åˆ†ï¼Œèƒ½è®©è¿™å †æ•°æ®å˜å¾—å¤šâ€œå¹²å‡€â€ï¼Ÿ å“ªä¸ªé—®é¢˜èƒ½å¸®æˆ‘æ’é™¤æ‰æœ€å¤šçš„å¹²æ‰°é¡¹ï¼Œæˆ‘ä»¬å°±é€‰å“ªä¸ªé—®é¢˜å½“è€å¤§ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰ï¼</p>
<h2 data-id="heading-4">ğŸ“Š ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ‰‹åŠ¨ç®—ä¸€ç®— (å¥¶èŒ¶æ¡ˆä¾‹)</h2>
<p>å‡è®¾æˆ‘ä»¬æ”¶é›†äº†ä½ è¿‡å»ä¹°çš„50æ¬¡å¥¶èŒ¶è®°å½•ï¼Œä½ çš„å£å‘³åå¥½éå¸¸æ˜æ˜¾ï¼šåªå–æ— ç³–ã€‚<br/>
æ•°æ®åˆ†å¸ƒå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>å…¨ç³–</strong>: <code>25</code>æ¯ -&gt; ç»“æœå…¨æ˜¯ ä¸å– (âŒ)</li>
<li><strong>æ— ç³–</strong>: <code>25</code>æ¯ -&gt; ç»“æœæ˜¯ å– (âœ…)</li>
</ul>
<p>æˆ‘ä»¬è¦å†³å®šï¼šå…ˆæŒ‰â€œç”œåº¦â€åˆ†ï¼Œè¿˜æ˜¯å…ˆæŒ‰â€œåŠ æ²¡åŠ å†°â€åˆ†ï¼Ÿ</p>
<h3 data-id="heading-5">æ–¹æ¡ˆä¸€ï¼šæŒ‰â€œç”œåº¦â€åˆ‡ä¸€åˆ€ ğŸ”ª</h3>
<ul>
<li>å·¦è¾¹ï¼ˆ<strong>å…¨ç³–å †</strong>ï¼‰: 25æ¯å…¨æ˜¯âŒã€‚å®Œç¾ï¼è¿™å †æ•°æ®çš„ç†µç›´æ¥å˜æˆ0äº†ï¼ï¼ˆä¸ç”¨å†é—®åˆ«çš„äº†ï¼Œç›´æ¥æ‰”æ‰ï¼‰ã€‚</li>
<li>å³è¾¹ï¼ˆ<strong>æ— ç³–å †</strong>ï¼‰: 25æ¯å…¨æ˜¯âœ…ã€‚å®Œç¾ï¼ç†µä¹Ÿæ˜¯0ï¼</li>
</ul>
<h3 data-id="heading-6">æ–¹æ¡ˆäºŒï¼šæŒ‰â€œåŠ å†°â€åˆ‡ä¸€åˆ€ ğŸ§Š</h3>
<p>å‡è®¾å…¨ç³–å’Œæ— ç³–é‡Œéƒ½æœ‰åŠ å†°å’Œå»å†°çš„æƒ…å†µã€‚</p>
<ul>
<li>å·¦è¾¹ï¼ˆ<strong>åŠ å†°å †</strong>ï¼‰: æ··æ‚ç€å…¨ç³–(âŒ)å’Œæ— ç³–(âœ…)ã€‚è¿˜æ˜¯å¾ˆä¹±ï¼Œç†µå¾ˆé«˜ã€‚</li>
<li>å³è¾¹ï¼ˆ<strong>å»å†°å †</strong>ï¼‰: åŒæ ·æ··æ‚ã€‚</li>
</ul>
<p>å¾ˆæ˜æ˜¾ï¼ŒæŒ‰<strong>ç”œåº¦åˆ†</strong>çš„ä¿¡æ¯å¢ç›Šæœ€å¤§ï¼Œå› ä¸ºå®ƒèƒ½å¸®æˆ‘ä»¬ç¬é—´æŠŠâ€œç»å¯¹ä¸å–â€çš„é‚£éƒ¨åˆ†æŒ‘å‡ºæ¥ã€‚</p>
<p>æ‰€ä»¥ï¼Œæœºå™¨ä¼šé€‰æ‹© <strong>ç”œåº¦</strong> ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼</p>
<h2 data-id="heading-7">ğŸ’» ç¬¬å››éƒ¨åˆ†ï¼šPython ä»£ç å®æˆ˜</h2>
<p>å…‰è¯´ä¸ç»ƒå‡æŠŠå¼ã€‚ä½œä¸ºå·¥ç¨‹å¸ˆï¼Œæˆ‘ä»¬è¦ç”¨ä»£ç è¯´è¯ã€‚æˆ‘ä»¬ä¼šä½¿ç”¨ Python çš„ <code>scikit-learn</code> åº“ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æ•´ç†å¥½äº†æ•°æ® <code>milktea.csv</code>ï¼š</p>






























<table><thead><tr><th>Sugar (ç”œåº¦)</th><th>Topping (å°æ–™)</th><th>Decision (å–å—?)</th></tr></thead><tbody><tr><td>Full (å…¨ç³–)</td><td>Pearls (çç )</td><td>0 (No)</td></tr><tr><td>Zero (æ— ç³–)</td><td>None (æ— )</td><td>0 (No - å¤ªå¯¡æ·¡)</td></tr><tr><td>Zero (æ— ç³–)</td><td>Pearls (çç )</td><td>1 (Yes)</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table>
<h3 data-id="heading-8">1. é¢„å¤„ç†ä¸è®­ç»ƒ</h3>
<p>æœºå™¨çœ‹ä¸æ‡‚ä¸­æ–‡æˆ–å•è¯ï¼Œæˆ‘ä»¬è¦æŠŠå®ƒç¿»è¯‘æˆæ•°å­—ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> tree
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. æ¨¡æ‹Ÿä¸€ç‚¹å¥¶èŒ¶æ•°æ®</span>
<span class="hljs-comment"># å‡è®¾æˆ‘ä»¬çš„é€»è¾‘æ˜¯ï¼šåªæœ‰"æ— ç³–(Zero)"ä¸”"åŠ çç (Pearls)"æ‰å–</span>
data = pd.DataFrame({
    <span class="hljs-string">'Sugar'</span>:   [<span class="hljs-string">'Full'</span>, <span class="hljs-string">'Zero'</span>, <span class="hljs-string">'Full'</span>, <span class="hljs-string">'Zero'</span>, <span class="hljs-string">'Half'</span>, <span class="hljs-string">'Zero'</span>],
    <span class="hljs-string">'Topping'</span>: [<span class="hljs-string">'Pearls'</span>, <span class="hljs-string">'None'</span>, <span class="hljs-string">'None'</span>, <span class="hljs-string">'Pearls'</span>, <span class="hljs-string">'Pearls'</span>, <span class="hljs-string">'Pudding'</span>],
    <span class="hljs-string">'Drink'</span>:   [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]  <span class="hljs-comment"># 1=å–, 0=ä¸å– (å‡è®¾åªè¦æ˜¯æ— ç³–ä¸”æœ‰å°æ–™å°±å–)</span>
})

<span class="hljs-comment"># 2. æ•°æ®é¢„å¤„ç†ï¼šæŠŠæ–‡å­—å˜æˆæ•°å­— (Mapping)</span>
<span class="hljs-comment"># ç”œåº¦: Full=0, Zero=1, Half=2</span>
<span class="hljs-comment"># å°æ–™: Pearls=0, None=1, Pudding=2</span>
data[<span class="hljs-string">'Sugar_Code'</span>] = data[<span class="hljs-string">'Sugar'</span>].<span class="hljs-built_in">map</span>({<span class="hljs-string">'Full'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'Zero'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'Half'</span>: <span class="hljs-number">2</span>})
data[<span class="hljs-string">'Topping_Code'</span>] = data[<span class="hljs-string">'Topping'</span>].<span class="hljs-built_in">map</span>({<span class="hljs-string">'Pearls'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'None'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'Pudding'</span>: <span class="hljs-number">2</span>})

features = [<span class="hljs-string">'Sugar_Code'</span>, <span class="hljs-string">'Topping_Code'</span>]
X = data[features]
Y = data[<span class="hljs-string">'Drink'</span>]

<span class="hljs-comment"># 3. è®­ç»ƒæ¨¡å‹</span>
<span class="hljs-comment"># criterion='entropy' è¡¨ç¤ºæˆ‘ä»¬ä½¿ç”¨â€œç†µâ€æ¥ä½œä¸ºåˆ†è£‚æ ‡å‡†</span>
clf = tree.DecisionTreeClassifier(criterion=<span class="hljs-string">'entropy'</span>)
clf = clf.fit(X, Y)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ¤– å¥¶èŒ¶é‰´å®šæ¨¡å‹è®­ç»ƒå®Œæ¯•ï¼"</span>)
</code></pre>
<h3 data-id="heading-9">2. å¯è§†åŒ–è¿™æ£µæ ‘</h3>
<p>è®©æˆ‘ä»¬çœ‹çœ‹æœºå™¨è„‘å­é‡Œæƒ³çš„å›¾é•¿ä»€ä¹ˆæ ·ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 4. ç”»å‡ºå†³ç­–æ ‘</span>
plt.figure(figsize=(<span class="hljs-number">10</span>,<span class="hljs-number">6</span>))
tree.plot_tree(clf, 
               feature_names=[<span class="hljs-string">'Sugar'</span>, <span class="hljs-string">'Topping'</span>],  
               class_names=[<span class="hljs-string">'Pass'</span>, <span class="hljs-string">'Drink'</span>], <span class="hljs-comment"># Pass=ä¸å–, Drink=å–</span>
               filled=<span class="hljs-literal">True</span>, <span class="hljs-comment"># é¢œè‰²è¶Šæ·±ä»£è¡¨æœºå™¨è¶Šç¡®ä¿¡</span>
               rounded=<span class="hljs-literal">True</span>)
plt.show()
</code></pre>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93c2d643724542cebd3b255831a9bae8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771027608&amp;x-signature=CY6PZ9JBokvZjtEvREWUVMUUiXI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">3. é¢„æµ‹æ–°æ•°æ®</h3>
<p>è¿™æ—¶å€™ï¼Œè€æ¿æ¨å‡ºäº†ä¸€æ¬¾æ–°å“ï¼šæ— ç³– + çç ã€‚ä½ è¦ä¸è¦å°å°ï¼Ÿ</p>
<ul>
<li>æ— ç³– = 1</li>
<li>çç  = 0</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é¢„æµ‹ [Sugar=1, Topping=0]</span>
new_tea = [[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]]
prediction = clf.predict(new_tea)

<span class="hljs-keyword">if</span> prediction[<span class="hljs-number">0</span>] == <span class="hljs-number">1</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å†³ç­–ç»“æœï¼šä¹°å®ƒï¼ğŸ§‹ğŸ˜‹"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å†³ç­–ç»“æœï¼šå“’å’©ï¼âŒ"</span>)

<span class="hljs-comment">## è¿è¡Œç»“æœï¼š</span>
<span class="hljs-string">'''
å†³ç­–ç»“æœï¼šä¹°å®ƒï¼ğŸ§‹ğŸ˜‹
'''</span>
</code></pre>
<h2 data-id="heading-11">ğŸš€ æ€»ç»“</h2>
<p>ä»Šå¤©æˆ‘ä»¬é€šè¿‡ä¸€æ¯å¥¶èŒ¶å­¦ä¹ äº†ï¼š</p>
<ol>
<li><strong>å†³ç­–æ ‘</strong>å°±æ˜¯ä¸€å¥—å¸®ä½ åšé€‰æ‹©çš„â€œæµç¨‹å›¾â€ã€‚</li>
<li>æœºå™¨åˆ©ç”¨<strong>ç†µ</strong>ï¼ˆä¹±ä¸ä¹±ï¼‰å’Œ<strong>ä¿¡æ¯å¢ç›Š</strong>ï¼ˆå˜å¹²å‡€äº†å—ï¼‰æ¥å¯»æ‰¾æœ€ä½³çš„ç­›é€‰æ¡ä»¶ã€‚</li>
<li>ç”¨ <code>scikit-learn</code> å‡ è¡Œä»£ç å°±èƒ½æå®šã€‚</li>
</ol>
<p>æœºå™¨å­¦ä¹ å…¶å®ç¦»ç”Ÿæ´»å¾ˆè¿‘ã€‚å¸Œæœ›è¿™æ£µâ€œæ ‘â€èƒ½å¸®ä½ ä¸ä»…é€‰å¯¹æ¨¡å‹ï¼Œè¿˜èƒ½é€‰å¯¹æœ€é€‚åˆä½ çš„é‚£æ¯ä¸‹åˆèŒ¶ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Suno æ­Œæ›²ç”Ÿæˆ API å¯¹æ¥è¯´æ˜]]></title>    <link>https://juejin.cn/post/7603575399255310376</link>    <guid>https://juejin.cn/post/7603575399255310376</guid>    <pubDate>2026-02-06T15:59:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575399255310376" data-draft-id="7603556326816514100" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Suno æ­Œæ›²ç”Ÿæˆ API å¯¹æ¥è¯´æ˜"/> <meta itemprop="keywords" content="API,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-06T15:59:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å´”åº†æ‰ä¸¨é™è§…"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Suno æ­Œæ›²ç”Ÿæˆ API å¯¹æ¥è¯´æ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å´”åº†æ‰ä¸¨é™è§…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:59:53.000Z" title="Fri Feb 06 2026 15:59:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»46åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>éšç€ AI çš„åº”ç”¨å˜å¹¿ï¼Œå„ç±» AI ç¨‹åºå·²é€æ¸æ™®åŠã€‚AI å·²é€æ¸æ·±å…¥åˆ°äººä»¬çš„å·¥ä½œç”Ÿæ´»æ–¹æ–¹é¢é¢ã€‚è€Œ AI æ¶‰åŠçš„è¡Œä¸šä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œä»æœ€åˆçš„å†™ä½œï¼Œåˆ°åŒ»ç–—æ•™è‚²ï¼Œå†åˆ°ç°åœ¨çš„éŸ³ä¹ã€‚</p>
<p>Suno æ˜¯ä¸€ä¸ªä¸“ä¸šé«˜è´¨é‡çš„ AI æ­Œæ›²å’ŒéŸ³ä¹åˆ›ä½œå¹³å°ï¼Œç”¨æˆ·åªéœ€è¾“å…¥ç®€å•çš„æ–‡æœ¬æç¤ºè¯ï¼Œå³å¯æ ¹æ®æµæ´¾é£æ ¼å’Œæ­Œè¯ç”Ÿæˆå¸¦æœ‰äººå£°çš„æ­Œæ›²ã€‚è¯¥ AI éŸ³ä¹ç”Ÿæˆå™¨ç”±æ¥è‡ª Metaã€TikTokã€Kensho ç­‰çŸ¥åç§‘æŠ€å…¬å¸çš„å›¢é˜Ÿæˆå‘˜å¼€å‘ï¼Œç›®æ ‡æ˜¯ä¸éœ€è¦ä»»ä½•ä¹å™¨å·¥å…·ï¼Œè®©æ‰€æœ‰äººéƒ½å¯ä»¥åˆ›é€ ç¾å¦™çš„éŸ³ä¹ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æ¨¡å‹æ›´æ–°çš„è¿›åº¦ï¼š</p>





















































<table><thead><tr><th align="left">ç‰ˆæœ¬</th><th align="left">model</th><th align="left">ä¸Šçº¿æ—¶é—´</th><th align="left">prompt é™åˆ¶</th><th align="left">style é™åˆ¶</th><th align="left">æ­Œæ›²æœ€é•¿æ—¶é•¿</th></tr></thead><tbody><tr><td align="left">v5</td><td align="left">chirp-v5</td><td align="left">2025.09.23</td><td align="left">5000</td><td align="left">1000</td><td align="left">8 åˆ†é’Ÿ</td></tr><tr><td align="left">v4.5+</td><td align="left">chirp-v4-5-plus</td><td align="left">2025.07.17</td><td align="left">5000</td><td align="left">1000</td><td align="left">8 åˆ†é’Ÿ</td></tr><tr><td align="left">v4.5</td><td align="left">chirp-v4-5</td><td align="left">2025.05.03</td><td align="left">5000</td><td align="left">1000</td><td align="left">4 åˆ†é’Ÿ</td></tr><tr><td align="left">v4</td><td align="left">chirp-v4</td><td align="left">2024.12.17</td><td align="left">3000</td><td align="left">200</td><td align="left">150 ç§’</td></tr><tr><td align="left">v3.5</td><td align="left">chirp-v3-5</td><td align="left">---</td><td align="left">3000</td><td align="left">200</td><td align="left">120 ç§’</td></tr></tbody></table>
<p>Suno æœ€æ–°å·²å°†éŸ³ä¹ç”Ÿæˆæ¨¡å‹å‡çº§åˆ° V5 ç‰ˆæœ¬ï¼Œè°ƒç”¨æœ€æ–°çš„ V5 åªéœ€è¦æŠŠ model å‚æ•°ä¿®æ”¹ä¸º<code>chirp-v5</code>ï¼Œå¯ç”Ÿæˆ 9 åˆ†é’Ÿçš„æ­Œæ›²ã€‚</p>
<p>ç„¶è€Œ Suno å®˜æ–¹æ˜¯å¹¶æ²¡æœ‰æä¾› API çš„ï¼ŒAceDataCloud æä¾›äº†ä¸€å¥— Suno çš„ APIï¼Œæ¨¡æ‹Ÿå¯¹æ¥äº† Suno å®˜æ–¹ï¼Œå¯ä»¥æ–¹ä¾¿å¿«æ·åœ°ç”Ÿæˆæƒ³è¦çš„éŸ³ä¹ã€‚</p>
<h2 data-id="heading-0">ç”³è¯·å’Œä½¿ç”¨</h2>
<p>è¦ä½¿ç”¨ Suno Audios APIï¼Œé¦–å…ˆå¯ä»¥åˆ° <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F4da95d9d-7722-4a72-857d-bf6be86036e9" target="_blank" title="https://platform.acedata.cloud/documents/4da95d9d-7722-4a72-857d-bf6be86036e9" ref="nofollow noopener noreferrer">Suno Audios Generation API</a> é¡µé¢ç‚¹å‡»ã€ŒAcquireã€æŒ‰é’®ï¼Œè·å–è¯·æ±‚æ‰€éœ€è¦çš„å‡­è¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92b95384eb93468ebfc146a57c188efc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=DaNfS0%2BgXv1%2B%2BYgaVocvm8TFd6g%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœä½ å°šæœªç™»å½•æˆ–æ³¨å†Œï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢é‚€è¯·æ‚¨æ¥æ³¨å†Œå’Œç™»å½•ï¼Œç™»å½•æ³¨å†Œä¹‹åä¼šè‡ªåŠ¨è¿”å›å½“å‰é¡µé¢ã€‚</p>
<p>åœ¨é¦–æ¬¡ç”³è¯·æ—¶ä¼šæœ‰å…è´¹é¢åº¦èµ é€ï¼Œå¯ä»¥å…è´¹ä½¿ç”¨è¯¥ APIã€‚</p>
<h2 data-id="heading-1">åŸºæœ¬ä½¿ç”¨</h2>
<p>æƒ³äº›ä»€ä¹ˆæ­Œæ›²ï¼Œå¯ä»¥ä»»æ„è¾“å…¥ä¸€æ®µæ–‡å­—ï¼Œæ¯”å¦‚æˆ‘æƒ³ç”Ÿæˆä¸€ä¸ªå…³äºåœ£è¯çš„æ­Œæ›²ï¼Œå°±å¯ä»¥è¾“å…¥ <code>a song for Christmas</code>ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b0ba7d1abc64d388b414a3e64fcc9a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=8jNvi%2BCuV25DeEGYLymjztwpVDQ%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬è®¾ç½®äº† Request Headersï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>accept</code>ï¼šæƒ³è¦æ¥æ”¶æ€æ ·æ ¼å¼çš„å“åº”ç»“æœï¼Œè¿™é‡Œå¡«å†™ä¸º <code>application/json</code>ï¼Œå³ JSON æ ¼å¼ã€‚</li>
<li><code>authorization</code>ï¼šè°ƒç”¨ API çš„å¯†é’¥ï¼Œç”³è¯·ä¹‹åå¯ä»¥ç›´æ¥ä¸‹æ‹‰é€‰æ‹©ã€‚</li>
</ul>
<p>å¦å¤–è®¾ç½®äº† Request Bodyï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>action</code>ï¼šæ­¤æ¬¡éŸ³ä¹ç”Ÿæˆä»»åŠ¡çš„è¡Œä¸ºï¼Œé»˜è®¤æ˜¯ <code>generate</code>ï¼Œä¸»è¦åŒ…å«ï¼š<code>extend</code>ã€<code>upload_extend</code>ã€<code>cover</code>ã€<code>upload_cover</code>ã€<code>replace_section</code>ã€<code>replace_section</code>ã€<code>concat</code>ã€<code>stems</code>ã€<code>all_stems</code>ã€<code>remaster</code>ã€‚</li>
<li><code>prompt</code>ï¼šSuno å®˜æ–¹çš„çµæ„Ÿæ¨¡å¼çš„æç¤ºè¯ã€‚</li>
<li><code>model</code>ï¼šæ­¤æ¬¡éŸ³ä¹ç”Ÿæˆä»»åŠ¡çš„æ¨¡å‹ï¼Œé»˜è®¤æ˜¯ <code>chirp-v3-5</code>ï¼Œä¸»è¦åŒ…å«ï¼š<code>chirp-v3</code>ã€<code>chirp-v4</code>ã€<code>chirp-v3-5</code>ã€<code>chirp-v4-5</code>ã€<code>chirp-v4-5-plus</code>ã€ <code>chirp-v5</code>ã€‚</li>
<li><code>lyric</code>ï¼šSuno å®˜æ–¹çš„è‡ªå®šä¹‰æ¨¡å¼çš„æ­Œè¯å†…å®¹ã€‚</li>
<li><code>custom</code>ï¼šæ˜¯å¦é‡‡ç”¨è‡ªå®šä¹‰æ¨¡å¼ï¼Œé»˜è®¤æ˜¯: <code>false</code>ã€‚</li>
<li><code>instrumental</code>ï¼šSuno å®˜æ–¹çš„çµæ„Ÿæ¨¡å¼çš„çº¯éŸ³ä¹é€‰é¡¹ã€‚</li>
<li><code>title</code>ï¼šSuno å®˜æ–¹çš„è‡ªå®šä¹‰æ¨¡å¼çš„éŸ³ä¹æ ‡é¢˜ã€‚</li>
<li><code>style</code>ï¼šSuno å®˜æ–¹çš„è‡ªå®šä¹‰æ¨¡å¼çš„éŸ³ä¹é£æ ¼ã€‚</li>
<li><code>style_negative</code>ï¼šSuno å®˜æ–¹çš„è‡ªå®šä¹‰æ¨¡å¼çš„æ’é™¤é£æ ¼ã€‚</li>
<li><code>audio_weight</code>ï¼šä¸Šä¼ çš„å‚è€ƒéŸ³é¢‘å æ¯”ï¼ŒèŒƒå›´ 0-1ï¼Œè¶Šå¤§è¶Šä¾èµ–å‚è€ƒéŸ³é¢‘ã€‚</li>
<li><code>audio_id</code>ï¼šå‚è€ƒéŸ³ä¹çš„ IDã€‚</li>
<li><code>overpainting_start</code>/<code>overpainting_end</code>ï¼šä¸ºå·²æœ‰çº¯éŸ³ä¹è¡¥å……äººå£°çš„èµ·æ­¢æ—¶é—´ï¼Œå•ä½ç§’ã€‚</li>
<li><code>underpainting_start</code>/<code>underpainting_end</code>ï¼šä¸ºæ¸…å”±åŠ ä¼´å¥çš„èµ·æ­¢æ—¶é—´ï¼Œå•ä½ç§’ã€‚</li>
<li><code>persona_id</code>ï¼šè‰ºæœ¯å®¶çš„æ­Œæ›² IDã€‚</li>
<li><code>continue_at</code>ï¼šä»¥ç§’ä¸ºå•ä½ç»§ç»­ç°æœ‰éŸ³é¢‘çš„æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œ213.5 è¡¨ç¤ºç»§ç»­åˆ° 3 åˆ† 33.5 ç§’ã€‚</li>
<li><code>style_influence</code>ï¼š<code>style_influence</code> é«˜çº§å‚æ•°ã€‚</li>
<li><code>replace_section_end</code>ï¼šæ›¿æ¢ç‰‡æ®µçš„æœ€ç»ˆæ—¶é—´ã€‚</li>
<li><code>replace_section_start</code>ï¼šæ›¿æ¢ç‰‡æ®µçš„èµ·å§‹æ—¶é—´ã€‚</li>
<li><code>vocal_gender</code>ï¼šæ§åˆ¶ç”·å¥³å£°ï¼Œå¥³å£° <code>f</code>ï¼Œç”·å£° <code>m</code>ï¼Œ4.5 åŠä»¥ä¸Šæ¨¡å‹æœ‰æ•ˆã€‚</li>
<li><code>weirdness</code>ï¼š<code>weirdness</code> é«˜çº§å‚æ•°ã€‚</li>
<li><code>lyric_prompt</code>ï¼šç”Ÿæˆæ­Œè¯çš„ promptï¼Œå½“ä¸”ä»…å½“ <code>custom</code> ä¸º <code>true</code> å¹¶ä¸” <code>lyric</code> æ²¡æœ‰ä¼ çš„æ—¶å€™ç”Ÿæ•ˆã€‚</li>
<li><code>callback_url</code>ï¼šéœ€è¦å›è°ƒç»“æœçš„ URLã€‚</li>
</ul>
<p>ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4efea0d2888a43acba95265f71963bf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=xgrPY%2B890LKsYNH1IQ2LYHvcAC8%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¯ä»¥ç‚¹å‡»ã€ŒTryã€æŒ‰é’®ç›´æ¥æµ‹è¯• APIï¼Œç¨ç­‰ 1-2 åˆ†é’Ÿï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e72fb249-bd5b-4e2a-b20c-8a06fea5ac14"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7dbc5b6a-b2c0-4d85-9d39-fa8a8a785ccf"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b481b17a-bf50-4e10-8adc-4d5635050893"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Under the Mistletoe"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b481b17a-bf50-4e10-8adc-4d5635050893.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnowflakes falling on the ground\nTwinkling lights all around\nThe scent of pine fills the air\nChristmas magic everywhere\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nItâ€™s Christmas time\nIt feels so right\n[Verse 2]\nStockings hung by the fireâ€™s glow\nWarmth inside while the cold winds blow\nCookies baking\nSweet delight\nA season of joy shining bright\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nItâ€™s Christmas time\nIt feels so right\n[Bridge]\nCarols sung by candlelight\nStars above make the world feel tight\nPeace and love\nA seasonâ€™s creed\nFilling hearts with all we need\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nItâ€™s Christmas time\nIt feels so right"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b481b17a-bf50-4e10-8adc-4d5635050893.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T15:59:32.468Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, cheerful, male vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fbf22dab-5e2b-4e02-84c0-6d7605f14c3d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Under the Mistletoe"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_fbf22dab-5e2b-4e02-84c0-6d7605f14c3d.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnowflakes falling on the ground\nTwinkling lights all around\nThe scent of pine fills the air\nChristmas magic everywhere\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nItâ€™s Christmas time\nIt feels so right\n[Verse 2]\nStockings hung by the fireâ€™s glow\nWarmth inside while the cold winds blow\nCookies baking\nSweet delight\nA season of joy shining bright\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nItâ€™s Christmas time\nIt feels so right\n[Bridge]\nCarols sung by candlelight\nStars above make the world feel tight\nPeace and love\nA seasonâ€™s creed\nFilling hearts with all we need\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nItâ€™s Christmas time\nIt feels so right"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/fbf22dab-5e2b-4e02-84c0-6d7605f14c3d.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T15:59:32.468Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, cheerful, male vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">158.48</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¯ä»¥çœ‹åˆ°è¿™æ—¶å€™æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸¤é¦–æ­Œçš„å†…å®¹ï¼ŒåŒ…æ‹¬æ ‡é¢˜ã€é¢„è§ˆå›¾ã€æ­Œè¯ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å†…å®¹ã€‚</p>
<p>å­—æ®µè¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>successï¼šç”Ÿæˆæ˜¯å¦æˆåŠŸï¼Œå¦‚æœæˆåŠŸåˆ™ä¸º <code>true</code>ï¼Œå¦åˆ™ä¸º <code>false</code></li>
<li>dataï¼šæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«äº†ç”Ÿæˆçš„æ­Œæ›²çš„è¯¦ç»†ä¿¡æ¯ã€‚
<ul>
<li>stateï¼š æ­Œæ›²ç”ŸæˆçŠ¶æ€ï¼Œä¸»è¦åŒ…å«å››ç§ï¼Œå…·ä½“çš„å¦‚ä¸‹ï¼š
<ul>
<li>succeededï¼šç”ŸæˆæˆåŠŸ</li>
<li>pendingï¼šé˜Ÿåˆ—ä¸­</li>
<li>runningï¼šæ‰§è¡Œä¸­</li>
<li>errorï¼šå¤±è´¥</li>
</ul>
</li>
<li>idï¼šæ­Œæ›² ID</li>
<li>titleï¼šæ­Œæ›²çš„æ ‡é¢˜</li>
<li>image_urlï¼šæ­Œæ›²çš„å°é¢å›¾ç‰‡</li>
<li>lyricï¼šæ­Œæ›²çš„æ­Œè¯</li>
<li>audio_urlï¼šæ­Œæ›²çš„éŸ³é¢‘æ–‡ä»¶ï¼Œæ‰“å¼€å°±æ˜¯ä¸€ä¸ª mp3 éŸ³é¢‘ã€‚</li>
<li>video_urlï¼šæ­Œæ›²çš„è§†é¢‘æ–‡ä»¶ï¼Œæ‰“å¼€å°±æ˜¯ä¸€ä¸ª mp4 è§†é¢‘ã€‚</li>
<li>created_atï¼šåˆ›å»ºçš„æ—¶é—´</li>
<li>modelï¼šä½¿ç”¨çš„æ¨¡å‹ï¼Œä¸€èˆ¬æ˜¯æœ€æ–°çš„ v3 æ¨¡å‹</li>
<li>styleï¼šé£æ ¼</li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">è‡ªå®šä¹‰ç”Ÿæˆ</h2>
<p>å¦‚æœæƒ³è‡ªå®šä¹‰ç”Ÿæˆæ­Œè¯ï¼Œå¯ä»¥è¾“å…¥æ­Œè¯ï¼š</p>
<p>è¿™æ—¶å€™ <code>lyric</code> å­—æ®µå¯ä»¥ä¼ å…¥ç±»ä¼¼å¦‚ä¸‹å†…å®¹ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Verse]</span>\nSnowflakes falling <span class="hljs-attribute">all</span> around\nGlistening white\nCovering the ground\nChildren laughing\nFull of delight\nIn this winter wonderland tonight\nSanta's sleigh\nUp in the sky\nRudolph's nose shining bright\nOh my\nHear the jingle bells\nRinging so <span class="hljs-attribute">clear</span>\nBringing joy and holiday cheer\n<span class="hljs-selector-attr">[Verse 2]</span>\nRoasting chestnuts by the fire's glow\nChristmas lights\nThey twinkle and show\nFamilies gathering with love and cheer\nSpreading warmth <span class="hljs-selector-tag">to</span> everyone near
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„æ­Œè¯ä¸­ <code>\n</code> æ˜¯æ¢è¡Œç¬¦ï¼Œå¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•ç”Ÿæˆæ­Œè¯ï¼Œå¯ä»¥ä½¿ç”¨ AceDataCloud æä¾›çš„æ­Œè¯ç”Ÿæˆ API æ¥é€šè¿‡ prompt ç”Ÿæˆæ­Œè¯ï¼ŒAPI æ˜¯ <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F514d82dc-f7ab-4638-9f21-8b9275916b08" target="_blank" title="https://platform.acedata.cloud/documents/514d82dc-f7ab-4638-9f21-8b9275916b08" ref="nofollow noopener noreferrer">Suno Lyrics Generation API</a>ã€‚</p>
</blockquote>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ ¹æ®æ­Œè¯ã€æ ‡é¢˜ã€é£æ ¼è‡ªå®šä¹‰ç”Ÿæˆæ­Œæ›²ï¼Œå°±å¯ä»¥æŒ‡å®šå¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>lyricï¼šæ­Œè¯æ–‡æœ¬</li>
<li>customï¼šå¡«å†™ä¸º <code>true</code>ï¼Œä»£è¡¨è‡ªå®šä¹‰ç”Ÿæˆï¼Œè¯¥å‚æ•°é»˜è®¤ä¸º falseï¼Œä»£è¡¨ä½¿ç”¨ <code>prompt</code> ç”Ÿæˆã€‚</li>
<li>titleï¼šæ­Œæ›²çš„æ ‡é¢˜ã€‚</li>
<li>styleï¼šæ­Œæ›²çš„é£æ ¼ï¼Œé€‰å¡«ã€‚</li>
</ul>
<p>å¡«å†™æ ·ä¾‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/650e76020cda4dda82d613d7687979f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=SscCFqHs5U85aPR6QPx36XjBum4%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¡«å†™å®Œæ¯•ä¹‹åè‡ªåŠ¨ç”Ÿæˆäº†ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f27a8257c398422495d708bc0dc800bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=9ZEP1mkqjuzz6XGNq11ECQNzX20%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¯¹åº”çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/suno/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "generate",
  "prompt": "A song for Christmas",
  "model": "chirp-v4-5",
  "lyric": "[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near",
  "custom": true
}'
</code></pre>
<p>æµ‹è¯•å…è®¸ï¼Œç”Ÿæˆçš„æ•ˆæœæ˜¯ç±»ä¼¼çš„ã€‚</p>
<h2 data-id="heading-3">è‡ªå®šä¹‰æ­Œæ‰‹é£æ ¼ç”ŸæˆåŠŸèƒ½</h2>
<p>å¦‚æœæƒ³ä½¿ç”¨æ­Œæ‰‹é£æ ¼æ¥ç”Ÿæˆæ­Œæ›²çš„è¯ï¼Œé¦–å…ˆé€šè¿‡ä¸Šæ–‡çš„åŸºæœ¬ä½¿ç”¨ç”Ÿæˆä¸€é¦–æ­Œæ›²ï¼Œ
æœ€åå¾—åˆ°äº†éœ€è¦è®¾ç½®è¿™ä¸ªæ­Œæ›²ä¸ºæ­Œæ‰‹é£æ ¼ï¼Œç„¶åéœ€è¦è¿›å…¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F78bb6c62-6ce0-490f-a7df-e89d80ec0583" target="_blank" title="https://platform.acedata.cloud/documents/78bb6c62-6ce0-490f-a7df-e89d80ec0583" ref="nofollow noopener noreferrer">Suno Persona API</a>æ ¹æ®å®˜æ–¹ç”Ÿæˆçš„éŸ³ä¹ ID <code>audio_id</code> æ¥ç”Ÿæˆä¸€ä¸ªæ­Œæ‰‹é£æ ¼çš„ id å‚æ•° <code>persona_id</code>ï¼Œå…·ä½“çš„å‚æ•°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b9f31bd7e7d42c58e20448eaf3b0b7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=XR6NrApo%2BQBC%2FsZbRbssI83SW28%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¡«å†™å®Œæ¯•ä¹‹åè‡ªåŠ¨ç”Ÿæˆäº†ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1df81d7340304db5bf21540cf0e743b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=1QoGBTH%2BLMMzJeEBLrQiKTQpaPI%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¯¹åº”çš„ Python ä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/persona"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"test"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>ç‚¹å‡»è¿è¡Œï¼Œå¯ä»¥å‘ç°ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7628b754-4fe7-4e79-bda4-806d0dd8bf6e"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"persona_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e0d7319e-aa2a-44cb-b00a-916218d7cb0b"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æˆ‘ä»¬ä»¥ä¸Šé¢çš„ <code>audio_id</code> å’Œ <code>persona_id</code> åˆ†åˆ«ä¸º <code>97efc9f4-0e8d-4b3e-88df-14568fa1b11f</code>ã€<code>e0d7319e-aa2a-44cb-b00a-916218d7cb0b</code> ä¸ºæ­¤æ¬¡çš„ç¤ºä¾‹æ•°æ®ã€‚ ç„¶åå¯ä»¥å°†å‚æ•° <code>action</code> è®¾ç½®ä¸º <code>artist_consistency</code> (å¦‚æœæ˜¯æ–°ç‰ˆçš„æ­Œæ‰‹é£æ ¼Persona-v2-voxï¼Œ<code>action</code> å¿…é¡»è®¾ç½®ä¸º <code>artist_consistency_vox</code>)ï¼Œå¹¶ä¸”è¾“å…¥éœ€è¦ç»§ç»­ç”Ÿæˆæ­Œæ›²çš„ ID ã€ æ­Œæ‰‹é£æ ¼ IDï¼Œå¡«å†™æ ·ä¾‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56c4f4055d534772bd9b8a50c09e73f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=vRkE%2BjykA%2BwFAoHL5o7p5MfgB9k%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¡«å†™å®Œæ¯•ä¹‹åè‡ªåŠ¨ç”Ÿæˆäº†ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc66f818bf4f4fd1b06eaddaaddd6479~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=AQ1ltfDPdJifj0nofM0Y%2F9x%2BRKE%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¯¹åº”çš„ Python ä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"artist_consistency"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"A song for Christmas"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"persona_id"</span>: <span class="hljs-string">"e0d7319e-aa2a-44cb-b00a-916218d7cb0b"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>ç‚¹å‡»è¿è¡Œï¼Œå¯ä»¥å‘ç°ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9b732b1a-bd67-48bc-95e4-90140e06836f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"30fcd88e-7687-4137-92d7-913b58115204"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"727a36e2-8dce-4df7-99e5-14e44635c80f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_727a36e2-8dce-4df7-99e5-14e44635c80f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/727a36e2-8dce-4df7-99e5-14e44635c80f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:27:33.979Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">244.4</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3b33301a-b17e-4b25-8842-09b46dab1a36"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_3b33301a-b17e-4b25-8842-09b46dab1a36.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/3b33301a-b17e-4b25-8842-09b46dab1a36.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:27:33.979Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">229.88</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼Œç»“æœå†…å®¹ä¸ä¸Šæ–‡çš„æ˜¯ä¸€è‡´çš„ï¼Œè¿™ä¹Ÿå°±å®ç°ä½¿ç”¨æ­Œæ‰‹é£æ ¼æ¥ç”Ÿæˆæ­Œæ›²çš„åŠŸèƒ½ã€‚</p>
<h2 data-id="heading-4">ç»§ç»­ç”ŸæˆåŠŸèƒ½</h2>
<p>å¦‚æœæƒ³å¯¹å·²ç»ç”Ÿæˆçš„ Suno æ­Œæ›²è¿›è¡Œç»§ç»­ç”Ÿæˆçš„è¯ï¼Œå¯ä»¥å°†å‚æ•° <code>action</code> è®¾ç½®ä¸º <code>extend</code> ï¼Œå¹¶ä¸”è¾“å…¥éœ€è¦ç»§ç»­ç”Ÿæˆæ­Œæ›²çš„ IDï¼Œæ­Œæ›² ID çš„è·å–æ˜¯æ ¹æ®åŸºæœ¬ä½¿ç”¨æ¥è·å–ï¼Œé€šè¿‡ä¸Šæ–‡å¯çŸ¥ï¼Œè¿™æ—¶å€™å¯ä»¥çœ‹åˆ°æ­Œæ›²çš„ ID ä¸ºï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„æ­Œè¯ä¸­ <code>id</code> æ˜¯ç”Ÿæˆåæ­Œæ›²çš„ IDï¼Œå¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•ç”Ÿæˆæ­Œæ›²ï¼Œå¯ä»¥å‚è€ƒä¸Šæ–‡çš„åŸºæœ¬ä½¿ç”¨æ¥ç”Ÿæˆæ­Œæ›²ã€‚</p>
</blockquote>
<p>å¦‚æœæƒ³å¯¹è‡ªå·±ä¸Šä¼ çš„æ­Œæ›²è¿›è¡Œç»§ç»­ç”Ÿæˆçš„è¯ï¼Œå¯ä»¥å°†å‚æ•° <code>action</code> è®¾ç½®ä¸º <code>upload_extend</code> ï¼Œå¹¶ä¸”è¾“å…¥éœ€è¦ç»§ç»­ç”Ÿæˆè‡ªå®šä¹‰ä¸Šä¼ çš„æ­Œæ›² IDï¼Œæ­Œæ›² ID çš„è·å–æ˜¯ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F766db278-012c-43c4-9245-5f18d8dc4d82" target="_blank" title="https://platform.acedata.cloud/documents/766db278-012c-43c4-9245-5f18d8dc4d82" ref="nofollow noopener noreferrer">Suno Upload Generation API</a>æ¥è·å–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58b7faa73caa4329bf1f9a8fb0aaa960~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=Q2rbr%2FqGxvN4Kt2FHBr8NR7wkVg%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦å¿…é¡»å¡«æ­Œè¯ã€é£æ ¼è‡ªå®šä¹‰ç”Ÿæˆæ­Œæ›²ï¼Œå°±å¯ä»¥æŒ‡å®šå¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>lyricï¼šæ­Œè¯æ–‡æœ¬</li>
<li>customï¼šå¡«å†™ä¸º <code>true</code>ï¼Œä»£è¡¨è‡ªå®šä¹‰ç”Ÿæˆï¼Œè¯¥å‚æ•°é»˜è®¤ä¸º falseï¼Œä»£è¡¨ä½¿ç”¨ <code>prompt</code> ç”Ÿæˆã€‚</li>
<li>styleï¼šæ­Œæ›²çš„é£æ ¼ï¼Œé€‰å¡«ã€‚</li>
<li>continue_atï¼šä»¥ç§’ä¸ºå•ä½ç»§ç»­ç°æœ‰éŸ³é¢‘çš„æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œ213.5 è¡¨ç¤ºç»§ç»­åˆ° 3 åˆ† 33.5 ç§’ã€‚</li>
</ul>
<p>å¡«å†™æ ·ä¾‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdd5c75161e242c3adb572d98a395c50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=P7Z66q2Ot%2BzCDZLZ3dbjzX153o8%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¡«å†™å®Œæ¯•ä¹‹åè‡ªåŠ¨ç”Ÿæˆäº†ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50b047bb4ef04bc885149d7239e43715~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=%2Bo6UBUIkyAkq%2BkYkBUqSoUULNLk%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¯¹åº”çš„ Python ä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"extend"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"A song for Christmas"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>,
    <span class="hljs-string">"continue_at"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">"lyric"</span>: <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span>,
    <span class="hljs-string">"custom"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"instrumental"</span>: <span class="hljs-literal">False</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>ç‚¹å‡»è¿è¡Œï¼Œå¯ä»¥å‘ç°ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"75b835d9-30d1-4641-8524-0aeedbdc9e1a"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"44c41045-a2e1-4d19-aafc-7abd239d0d5c"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_0a1e1b10-c36a-41c9-9bfb-b26d9d25db98.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/0a1e1b10-c36a-41c9-9bfb-b26d9d25db98.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:38:35.509Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">165.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4334c5b4-0a44-4b26-a8f6-66cc4dbb8fc3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_4334c5b4-0a44-4b26-a8f6-66cc4dbb8fc3.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/4334c5b4-0a44-4b26-a8f6-66cc4dbb8fc3.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:38:35.509Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">158.84</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼Œç»“æœå†…å®¹ä¸ä¸Šæ–‡çš„æ˜¯ä¸€è‡´çš„ï¼Œè¿™ä¹Ÿå°±å®ç°æ­Œæ›²çš„ç»§ç»­ç”ŸæˆåŠŸèƒ½ã€‚</p>
<h2 data-id="heading-5">è·å–å®Œæ•´æ­Œæ›²</h2>
<p>å½“åŸºäºåŸæœ‰çš„æ­Œæ›²ç»§ç»­ç”Ÿæˆæ­Œæ›²ä¹‹åï¼Œè¿”å›çš„æ­Œæ›²å¹¶ä¸åŒ…å«åŸæ¥çš„æ­Œæ›²å†…å®¹ã€‚å¦‚æœè¦è·å¾—å®Œæ•´çš„æ­Œæ›²å†…å®¹ï¼Œéœ€è¦ä½¿ç”¨æ‹¼æ¥åŠŸèƒ½ï¼Œå°±å¯ä»¥æŒ‡å®šå¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>actionï¼šå†…å®¹ä¸º <code>concat</code>ã€‚</li>
<li>audio_idï¼šæœ€åä¸€ä¸ªç‰‡æ®µçš„ IDã€‚</li>
</ul>
<p>æ¯”å¦‚æ‰©å±•åçš„æ­Œæ›² ID æ˜¯ï¼š0a1e1b10-c36a-41c9-9bfb-b26d9d25db98ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"concat"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å…¶ä»–å‚æ•°ä¸å˜ï¼Œè¿”å›çš„å°±æ˜¯ä¸€é¦–å®Œæ•´çš„æ­Œæ›²ï¼Œå°±æ˜¯æ‰€æœ‰æ­Œæ›²ç‰‡æ®µçš„æ‹¼æ¥ç»“æœï¼Œä½†ç»“æœåªæœ‰ä¸€é¦–æ­Œï¼Œæ ·ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0f794915-8418-4124-93f5-b7eb3a417167"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"62afcce0-e7e5-44b8-8c2e-4bba12a4f414"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0efec7e0-11bf-4313-9981-2c0e7218d7dd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_0a1e1b10-c36a-41c9-9bfb-b26d9d25db98.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near\n[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/0efec7e0-11bf-4313-9981-2c0e7218d7dd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:43:06.718Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">167.91997916666668</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"concat_history"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"continue_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"web"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gen"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-6">éŸ³ä¹ç¿»ç‰ˆ</h2>
<p>å½“åŸºäºåŸæœ‰çš„æ­Œæ›²ç»§ç»­ç”Ÿæˆæ­Œæ›²ä¹‹åï¼Œè¿”å›çš„æ­Œæ›²çš„é£æ ¼å¯èƒ½ä¸å¤ªåˆé€‚ã€‚å¦‚æœè¦å¯¹åŸå…ˆç”Ÿæˆçš„æ­Œæ›²(è‹¥æ˜¯è‡ªå®šä¹‰ä¸Šä¼ çš„éŸ³ä¹ä¹Ÿæ”¯æŒ)è¿›è¡Œç¿»ç‰ˆï¼Œéœ€è¦ä½¿ç”¨éŸ³ä¹ç¿»ç‰ˆæ–¹æ³•ï¼Œå°±å¯ä»¥æŒ‡å®šå¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>actionï¼šå†…å®¹ä¸º <code>cover</code>ï¼Œå½“æ˜¯å¯¹è‡ªå®šä¹‰ä¸Šä¼ çš„éŸ³ä¹è¿›è¡Œç¿»ç‰ˆæ“ä½œçš„æ—¶å€™å¿…é¡»æŒ‡å®šå†…å®¹ä¸ºï¼š<code>upload_cover</code>ã€‚</li>
<li>audio_idï¼šä¹‹å‰ç”Ÿæˆæ­Œæ›²çš„ IDã€‚</li>
</ul>
<p>æ¯”å¦‚åŸå…ˆç”Ÿæˆåçš„æ­Œæ›² ID æ˜¯ï¼š0a1e1b10-c36a-41c9-9bfb-b26d9d25db98ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cover"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4-5"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å…¶ä»–å‚æ•°ä¸å˜ï¼Œè¿”å›çš„å°±æ˜¯ä¸€é¦–ç¿»ç‰ˆåçš„æ­Œæ›²ï¼Œå°±æ˜¯å¯¹åŸå…ˆç”Ÿæˆçš„æ­Œæ›²è¿›è¡Œç¿»ç‰ˆåçš„ç»“æœï¼Œæ ·ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b9d43d06-2e0a-4b5e-9e0d-7dfab32e00ab"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6c5e567d-0fdc-4c44-9b36-4090d9a75ff5"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6988fa57-f810-41cf-afab-7838db2c77dc"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_6988fa57-f810-41cf-afab-7838db2c77dc.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/6988fa57-f810-41cf-afab-7838db2c77dc.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:44:13.007Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">182.4</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ce98b991-0258-4f05-8245-e43d4efa8fb8"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_ce98b991-0258-4f05-8245-e43d4efa8fb8.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/ce98b991-0258-4f05-8245-e43d4efa8fb8.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:44:13.007Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">179.72</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç”Ÿæˆçš„ç»“æœä¸ä¸Šæ–‡ç±»ä¼¼ï¼Œè¿™å°±å®Œæˆäº†å¯¹åŸå…ˆç”Ÿæˆçš„æ­Œæ›²è¿›è¡Œç¿»ç‰ˆç”Ÿæˆçš„è¿‡ç¨‹ã€‚</p>
<h2 data-id="heading-7">æ›¿æ¢ç‰‡æ®µ</h2>
<p>å½“ç”Ÿæˆæ­Œæ›²ä¹‹åéœ€è¦è¿›è¡Œæ›¿æ¢æ­Œæ›²ç‰‡æ®µå•ç‹¬æ“ä½œçš„äºŒæ¬¡åˆ›ä½œæ—¶ï¼Œå¯ä»¥å¯¹æ­Œæ›²çš„æŸä¸ªç‰‡æ®µè¿›è¡Œæ›¿æ¢æ“ä½œã€‚å°±å¯ä»¥æŒ‡å®šå¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>actionï¼šå†…å®¹ä¸º <code>replace_section</code>ã€‚</li>
<li>audio_idï¼šä¹‹å‰ç”Ÿæˆæ­Œæ›²çš„ IDã€‚</li>
<li>model: æ­Œæ›²ç”Ÿæˆæ¨¡å‹ï¼Œ</li>
<li>lyric: æ›¿æ¢åçš„å®Œæ•´æ­Œè¯ï¼ˆåªéœ€è¦ä¸ prompt æœ‰é‡å¤å°±è¡Œï¼Œä¸éœ€è¦å®Œå…¨çš„æ­Œè¯ï¼‰ï¼Œ</li>
<li>promptï¼šéœ€è¦æ›¿æ¢çš„æ­Œè¯éƒ¨åˆ†ã€‚</li>
<li>styleï¼šæ­Œæ›²çš„é£æ ¼ï¼Œé€‰å¡«ã€‚</li>
<li>replace_section_startï¼š<code>lyric</code>å¯¹åº”çš„æ­Œè¯æ—¶é—´è½´çš„èµ·å§‹æ—¶é—´ã€‚</li>
<li>replace_section_endï¼š<code>lyric</code>å¯¹åº”çš„æ­Œè¯æ—¶é—´è½´çš„ç»ˆç‚¹æ—¶é—´ã€‚</li>
</ul>
<p>æ¯”å¦‚åŸå…ˆç”Ÿæˆåçš„æ­Œæ›² ID æ˜¯ï¼šade7241b-0357-4a5e-9b3d-4ec4f4b3a0c0ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"replace_section"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Chorus]\næ–°å¹´å¿«ä¹ äººäººæ¬¢å¿«æ­Œ\nç¥ç¦æ´’æ»¡æ¯ä¸€ç‰‡è§’è½\næ–°å¹´å¿«ä¹ å¿ƒä¸­èŠ±ç«å¤š\næ„¿æœ›æˆçœŸç”Ÿæ´»ä¼¼é‡‘è‰²æ³¢\n[Verse 2]\næ¢…èŠ±ç»½æ”¾æ˜¥æ„æ´‹æº¢æ»¡åœ°\næ¢…èŠ±ç»½æ”¾æ˜¥æ„æ´‹æº¢æ»¡åœ°"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ¢…èŠ±ç»½æ”¾æ˜¥æ„æ´‹æº¢æ»¡åœ°\næ¢…èŠ±ç»½æ”¾æ˜¥æ„æ´‹æº¢æ»¡åœ°"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"replace_section_start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28.94100580270793</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"replace_section_end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85.39410058027079</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ade7241b-0357-4a5e-9b3d-4ec4f4b3a0c0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"custom"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"instrumental"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å…¶ä»–å‚æ•°ä¸å˜ï¼Œè¿”å›çš„å°±æ˜¯ä¸€é¦–æ›¿æ¢åçš„æ­Œæ›²ï¼Œå°±æ˜¯å¯¹åŸå…ˆç”Ÿæˆçš„æ­Œæ›²è¿›è¡Œæ›¿æ¢ç‰‡æ®µåçš„ç»“æœï¼Œæ ·ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7a37c35d-7081-413d-908d-ab2d3f8139bf"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1ed92d6e-9a19-48f7-ab34-68c82c792303"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2a1467dc-51a4-4872-9ccc-ccd96e4fbbb6"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ–°å¹´å¿«ä¹"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_dc1b5edc-fbae-44a3-8962-d596dbd2b0d7.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Chorus]\næ–°å¹´å¿«ä¹ äººäººæ¬¢å¿«æ­Œ\nç¥ç¦æ´’æ»¡æ¯ä¸€ç‰‡è§’è½\næ–°å¹´å¿«ä¹ å¿ƒä¸­èŠ±ç«å¤š\næ„¿æœ›æˆçœŸç”Ÿæ´»ä¼¼é‡‘è‰²æ³¢\n[Verse 2]\næ¢…èŠ±ç»½æ”¾æ˜¥æ„æ´‹æº¢æ»¡åœ°\næ¢…èŠ±ç»½æ”¾æ˜¥æ„æ´‹æº¢æ»¡åœ°"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2a1467dc-51a4-4872-9ccc-ccd96e4fbbb6.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-04-18T01:55:02.930Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"traditional influences, female vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">202.52</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"concat_history"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ade7241b-0357-4a5e-9b3d-4ec4f4b3a0c0"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gen"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ios"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_start_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28.94100580270793</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_end_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85.39410058027079</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_dur_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">56.45309477756285</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_context_start_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_context_end_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">115.39410058027079</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"include_future_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"include_history_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_lyrics"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ¢…èŠ±ç»½æ”¾æ˜¥æ„æ´‹æº¢æ»¡åœ°\næ¢…èŠ±ç»½æ”¾æ˜¥æ„æ´‹æº¢æ»¡åœ°"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dc1b5edc-fbae-44a3-8962-d596dbd2b0d7"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç”Ÿæˆçš„ç»“æœä¸ä¸Šæ–‡ç±»ä¼¼ï¼Œè¿™å°±å®Œæˆäº†å¯¹åŸå…ˆç”Ÿæˆçš„æ­Œæ›²è¿›è¡Œæ›¿æ¢ç‰‡æ®µçš„è¿‡ç¨‹ã€‚</p>
<h2 data-id="heading-8">å£°æ›²åˆ†ç¦»</h2>
<p>å½“ç”Ÿæˆæ­Œæ›²ä¹‹åéœ€è¦è¿›è¡Œä¼´å¥å’Œäººå£°å•ç‹¬æ“ä½œçš„äºŒæ¬¡åˆ›ä½œæ—¶ï¼Œå¯ä»¥åˆ†ç¦»çº¯éŸ³ä¹ä¼´å¥å’Œæ¸…å”±äººå£°ã€‚å°±å¯ä»¥æŒ‡å®šå¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>actionï¼šå†…å®¹ä¸º <code>stems</code>ã€‚</li>
<li>audio_idï¼šä¹‹å‰ç”Ÿæˆæ­Œæ›²çš„ IDã€‚</li>
</ul>
<p>æ¯”å¦‚åŸå…ˆç”Ÿæˆåçš„æ­Œæ›² ID æ˜¯ï¼šec13e502-d043-4eb2-92ee-e900c6da69d1ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stems"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ec13e502-d043-4eb2-92ee-e900c6da69d1"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é€šè¿‡ä»¥ä¸Šå‚æ•°å³å¯å¾—åˆ°å£°æ›²åˆ†ç¦»çš„ç»“æœï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4050affc-f8a6-4cba-a86c-bf201eed053d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5107ee58-687d-422f-9195-fa0e82e1fcc8"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e3de0928-085a-42c4-b982-3b24738d1989"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Deck the Sky - Vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_e3de0928-085a-42c4-b982-3b24738d1989.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnowflakes dance on rooftops high\nChildren's laughter fills the sky\nCarols ring from church bells loud\nHolidays a joyful crowd\n[Verse 2]\nCandy canes and cocoa warm\nWrapped up tight in our own storm\nStockings hung with dreams and cheer\nMagic growing every year\n[Chorus]\nDeck the sky with twinkling stars\nHoliday joy feels ours and ours\nSing the songs of love and light\nChristmas glows so pure and bright\n[Verse 3]\nFireside tales of long ago\nReindeer prance in icy glow\nEvergreen and tinselâ€™s gleam\nChristmas time a lovely dream\n[Bridge]\nHearts are full with friends and kin\nMistletoe for love to win\nGifts of love and hope we share\nChristmas spirit everywhere\n[Chorus]\nDeck the sky with twinkling stars\nHoliday joy feels ours and ours\nSing the songs of love and light\nChristmas glows so pure and bright"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/e3de0928-085a-42c4-b982-3b24738d1989.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/e3de0928-085a-42c4-b982-3b24738d1989.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-01-05T07:49:16.881Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, jolly"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">174.16</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Deck the Sky - Instrumental"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-01-05T07:49:16.892Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, jolly"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">174.16</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç”Ÿæˆçš„ç»“æœä¸ä¸Šæ–‡ç±»ä¼¼ï¼Œè¿™å°±å®Œæˆäº†å¯¹åŸå…ˆç”Ÿæˆçš„æ­Œæ›²è¿›è¡Œå£°æ›²åˆ†ç¦»çš„è¿‡ç¨‹ã€‚</p>
<h2 data-id="heading-9">å…¨è½¨é“å£°æ›²åˆ†ç¦»</h2>
<p>å½“ç”Ÿæˆæ­Œæ›²ä¹‹åéœ€è¦è¿›è¡Œå…¨è½¨é“å£°æ›²åˆ†ç¦»æ“ä½œæ—¶ï¼Œå°±å¯ä»¥æŒ‡å®šå¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>actionï¼šå†…å®¹ä¸º <code>all_stems</code>ã€‚</li>
<li>audio_idï¼šä¹‹å‰ç”Ÿæˆæ­Œæ›²çš„ IDã€‚</li>
</ul>
<p>æ¯”å¦‚åŸå…ˆç”Ÿæˆåçš„æ­Œæ›² ID æ˜¯ï¼šbdf23a5a-59f5-4103-b452-054a824a7f9fï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"all_stems"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bdf23a5a-59f5-4103-b452-054a824a7f9f"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é€šè¿‡ä»¥ä¸Šå‚æ•°å³å¯å¾—åˆ°å…¨è½¨é“å£°æ›²åˆ†ç¦»çš„ç»“æœï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f4b16fb9-8478-4857-88c7-b9a1f0bb9518"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9c560ebd-4fc6-4bdb-988a-8890160a92fb"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f86ca64a-9519-4ea7-a592-52438e001412"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_f86ca64a-9519-4ea7-a592-52438e001412.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/f86ca64a-9519-4ea7-a592-52438e001412.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"99e649a7-a394-47b9-a915-d7f847285a36"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Backing Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_99e649a7-a394-47b9-a915-d7f847285a36.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/99e649a7-a394-47b9-a915-d7f847285a36.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6d710bf7-809f-4fdc-bb63-b8cb3a456d42"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Drums)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_6d710bf7-809f-4fdc-bb63-b8cb3a456d42.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/6d710bf7-809f-4fdc-bb63-b8cb3a456d42.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e05f07e3-7d80-4713-8e51-7f176c733543"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Bass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_e05f07e3-7d80-4713-8e51-7f176c733543.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/e05f07e3-7d80-4713-8e51-7f176c733543.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"93fe7cd8-62fd-4739-b78e-142c7e0b8562"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Guitar)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_93fe7cd8-62fd-4739-b78e-142c7e0b8562.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/93fe7cd8-62fd-4739-b78e-142c7e0b8562.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8367d71c-fdd3-441c-8ebe-70c33cca821b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Keyboard)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_8367d71c-fdd3-441c-8ebe-70c33cca821b.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/8367d71c-fdd3-441c-8ebe-70c33cca821b.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"28c03590-731c-416e-8fd3-95cdb3d75043"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Percussion)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_28c03590-731c-416e-8fd3-95cdb3d75043.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/28c03590-731c-416e-8fd3-95cdb3d75043.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3d4c1a28-4e1c-485a-8201-d21bb93aca2f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Strings)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_3d4c1a28-4e1c-485a-8201-d21bb93aca2f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/3d4c1a28-4e1c-485a-8201-d21bb93aca2f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b9db8ded-01ec-4e37-b8a5-64aab3a814c2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Synth)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b9db8ded-01ec-4e37-b8a5-64aab3a814c2.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b9db8ded-01ec-4e37-b8a5-64aab3a814c2.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"10a5248e-32e6-42b9-8da1-678a8a392aef"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (FX)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_10a5248e-32e6-42b9-8da1-678a8a392aef.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/10a5248e-32e6-42b9-8da1-678a8a392aef.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2d272128-111f-4901-8f62-5ae1eb43095a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Brass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_2d272128-111f-4901-8f62-5ae1eb43095a.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2d272128-111f-4901-8f62-5ae1eb43095a.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4a7c19a5-f8d4-4e4a-add9-aa0bad9307cc"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Woodwinds)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_4a7c19a5-f8d4-4e4a-add9-aa0bad9307cc.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/4a7c19a5-f8d4-4e4a-add9-aa0bad9307cc.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1ca774f9-3e75-48a6-941b-808875eadcd2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_1ca774f9-3e75-48a6-941b-808875eadcd2.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/1ca774f9-3e75-48a6-941b-808875eadcd2.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"14c5ffc7-addf-4fee-afd2-4b8b3e7ee470"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Backing Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_14c5ffc7-addf-4fee-afd2-4b8b3e7ee470.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/14c5ffc7-addf-4fee-afd2-4b8b3e7ee470.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9d044557-450d-48ab-90dc-8eaf6f1cdb6c"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Drums)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_9d044557-450d-48ab-90dc-8eaf6f1cdb6c.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/9d044557-450d-48ab-90dc-8eaf6f1cdb6c.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"efd052d0-c12f-47b3-8282-1f3ef7610e1f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Bass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_efd052d0-c12f-47b3-8282-1f3ef7610e1f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/efd052d0-c12f-47b3-8282-1f3ef7610e1f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5775372b-292e-4420-96ef-60e57a60cc1f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Guitar)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_5775372b-292e-4420-96ef-60e57a60cc1f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/5775372b-292e-4420-96ef-60e57a60cc1f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dab3f220-19cd-408e-9b96-30ec18f5b049"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Keyboard)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_dab3f220-19cd-408e-9b96-30ec18f5b049.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/dab3f220-19cd-408e-9b96-30ec18f5b049.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2d0cd6d4-af82-4bb5-86fe-d92bdb367157"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Percussion)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_2d0cd6d4-af82-4bb5-86fe-d92bdb367157.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2d0cd6d4-af82-4bb5-86fe-d92bdb367157.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f3191a1a-5e8d-4afe-b638-3add222d52cd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Strings)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_f3191a1a-5e8d-4afe-b638-3add222d52cd.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/f3191a1a-5e8d-4afe-b638-3add222d52cd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a8834ea5-200b-4206-a812-9780ef336660"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Synth)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a8834ea5-200b-4206-a812-9780ef336660.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a8834ea5-200b-4206-a812-9780ef336660.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f50d1a31-ef72-400a-b8ae-0367849d007d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (FX)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_f50d1a31-ef72-400a-b8ae-0367849d007d.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/f50d1a31-ef72-400a-b8ae-0367849d007d.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cb581673-23cc-40d6-9f9b-0f76720f0d18"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Brass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_cb581673-23cc-40d6-9f9b-0f76720f0d18.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/cb581673-23cc-40d6-9f9b-0f76720f0d18.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d91cfb52-f0a3-4546-bf8a-2ad14c3775a5"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®‰å…¨ä¹‹å¼¦ (Woodwinds)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_d91cfb52-f0a3-4546-bf8a-2ad14c3775a5.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/d91cfb52-f0a3-4546-bf8a-2ad14c3775a5.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç”Ÿæˆçš„ç»“æœä¸ä¸Šæ–‡ç±»ä¼¼ï¼Œè¿™å°±å®Œæˆäº†å¯¹åŸå…ˆç”Ÿæˆçš„æ­Œæ›²è¿›è¡Œå£°æ›²åˆ†ç¦»çš„è¿‡ç¨‹ã€‚</p>
<h2 data-id="heading-10">è‡ªå®šä¹‰ç”Ÿæˆçš„é«˜çº§å‚æ•°</h2>
<p>å®˜æ–¹å…è®¸åœ¨è‡ªå®šä¹‰æ¨¡å¼ä¸‹ä½¿ç”¨é«˜çº§å‚æ•° <code>weirdness</code>==&gt;<code>Weirdness</code>ã€<code>style_influence</code>==&gt;<code>Style Influence</code>ã€<code>audio_weight</code>==&gt;<code>Audio Influence</code>æ¥è¿›è¡Œç”Ÿæˆï¼Œå¯¹åº”å¦‚ä¸‹å¦‚çš„å®˜æ–¹ç¤ºä¾‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/656344f7831b40288277e83e7bf13c23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=Gm10k755vsF2EbcUe9gAOTO9Z7I%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å…¶ä¸­é«˜çº§å‚æ•°çš„èŒƒå›´éƒ½åœ¨ 0-1 ä¹‹é—´ï¼Œå…·ä½“çš„å‚æ•°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa9bdef609f74b14baac97dadae7851f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=99TESMqCpwvoMjVsZWS5jf5HmDQ%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¡«å†™å®Œæ¯•ä¹‹åè‡ªåŠ¨ç”Ÿæˆäº†ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16556d6fdc0b45b2afda8f8979ddeb11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=7325eq4CmUx2R0MkOo4wUOHVMYo%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¯¹åº”çš„ Python ä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"generate"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"lyric"</span>: <span class="hljs-string">"Hello Hello Hello "</span>,
    <span class="hljs-string">"custom"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"weirdness"</span>: <span class="hljs-number">0.4</span>,
    <span class="hljs-string">"style_influence"</span>: <span class="hljs-number">0.4</span>,
    <span class="hljs-string">"audio_weight"</span>: <span class="hljs-number">0.4</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>ç‚¹å‡»è¿è¡Œï¼Œå¯ä»¥å‘ç°ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2f3aa682-e1a7-43a9-9fbb-ed0ce8668a4b"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"07408194-7deb-4a52-a36d-9a9a13143b5f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c66e2077-7580-43f2-9937-c67a8afcd8bd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_c66e2077-7580-43f2-9937-c67a8afcd8bd.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Hello Hello Hello "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/c66e2077-7580-43f2-9937-c67a8afcd8bd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-07-10T12:54:35.199Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">187.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a922f97b-307c-4c4d-aae3-a47ba8202a10"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a922f97b-307c-4c4d-aae3-a47ba8202a10.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Hello Hello Hello "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a922f97b-307c-4c4d-aae3-a47ba8202a10.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-07-10T12:54:35.199Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">229.64</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™æ ·å°±ä½¿ç”¨äº†é«˜çº§å‚æ•°è¿›è¡Œç”Ÿæˆè‡ªå®šä¹‰æ­Œæ›²ï¼Œç»“æœä¸ä¸Šæ–‡ç±»ä¼¼ã€‚</p>
<h2 data-id="heading-11">Add Insterumental åŠŸèƒ½</h2>
<p>2025 å¹´ 8 æœˆä»½ suno æ–°å‡º Add Insterumental åŠŸèƒ½ï¼Œé¦–å…ˆéœ€è¦ä¸Šä¼ ä¸€é¦–æ¸…å”±æ— é…éŸ³çš„æ­Œæ›², è®© suno å¸®ä½ é…ä¹ï¼Œé¦–å…ˆå¯ä»¥å…ˆåˆ° <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F766db278-012c-43c4-9245-5f18d8dc4d82" target="_blank" title="https://platform.acedata.cloud/documents/766db278-012c-43c4-9245-5f18d8dc4d82" ref="nofollow noopener noreferrer">Suno Upload API</a>ä¸Šä¼ ä¸€é¦–æ¸…å”±æ— é…ä¹çš„æ­Œæ›²ï¼Œå¯¹åº”å¦‚ä¸‹å¦‚çš„æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/147e7631221d45429996ed2d62aa9442~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=2SFrXHqOGyjfDMXeNGSuQvI%2FoUo%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>ç„¶åéœ€è¦è®°å½•ä¸Šä¼ åçš„<code>audio_id</code>ï¼Œå…·ä½“çš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d81e5fe62a947d0a38ab72374dfa7e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=ZTZDf%2FSzdSVGyWWppcS%2FWs6KVl0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>æœ€åå¾—åˆ°äº†ä¸€ä¸ª<code>audio_id</code>ï¼š92254cab-3372-4d9e-bce9-cdcfdbc39070ï¼Œç„¶åæˆ‘ä»¬è¿˜éœ€è¦å¡«å†™å¦‚ä¸‹å‚æ•°ï¼š</p>
<ul>
<li>actionï¼šå†…å®¹ä¸º <code>underpainting</code>ã€‚</li>
<li>underpainting_startï¼šå¯¹ä¸Šä¼ çš„æ­Œæ›²è¿›è¡Œæ·»åŠ ä¼´å¥çš„èµ·å§‹æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯ 0ã€‚</li>
<li>underpainting_endï¼šå¯¹ä¸Šä¼ çš„æ­Œæ›²è¿›è¡Œæ·»åŠ ä¼´å¥çš„ç»ˆç‚¹æ—¶é—´ï¼Œå¿…é¡»å°äºæ­Œæ›²çš„æ€»æ—¶é•¿ã€‚</li>
<li>audio_idï¼šä¸Šä¼ çš„æ¸…å”±æ— é…éŸ³çš„æ­Œæ›² IDã€‚</li>
<li>styleï¼šä¼´å¥çš„é£æ ¼ï¼Œæœ€å¥½æ˜¯ä¸ç”¨æ­Œè¯ æ¯•ç«Ÿæ˜¯é…éŸ³ã€‚</li>
</ul>
<p>å¡«å†™å®Œæ¯•ä¹‹åè‡ªåŠ¨ç”Ÿæˆäº†ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56fe49a2d3684fe5954828475f01b65e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=lIrhhEg3xzyjA%2B7QINIatUEyRO8%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¯¹åº”çš„ Python ä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"underpainting"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"style"</span>: <span class="hljs-string">"Pop rap, uplifting, magnetic male vocals, piano, synth, electric guitar, driving bass, clear structure"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"92254cab-3372-4d9e-bce9-cdcfdbc39070"</span>,
    <span class="hljs-string">"underpainting_end"</span>: <span class="hljs-number">120</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>ç‚¹å‡»è¿è¡Œï¼Œå¯ä»¥å‘ç°ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"822d2e14-c535-4d48-a4e5-1b6ab00b04a7"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"257eac2c-8e4f-44d0-8454-5e215111eefa"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2788cd21-bd84-422d-beb5-859c60fbf5b6"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_2788cd21-bd84-422d-beb5-859c60fbf5b6.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2788cd21-bd84-422d-beb5-859c60fbf5b6.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:25:42.548Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pop rap, uplifting, magnetic male vocals, piano, synth, electric guitar, driving bass, clear structure"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10.16</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a4bb7220-e971-4cbf-a626-b86c648bcf55"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a4bb7220-e971-4cbf-a626-b86c648bcf55.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a4bb7220-e971-4cbf-a626-b86c648bcf55.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:25:42.548Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pop rap, uplifting, magnetic male vocals, piano, synth, electric guitar, driving bass, clear structure"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.52</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™æ ·å°±å®Œæˆäº†å¯¹ä¸Šä¼ çš„æ¸…å”±æ— é…éŸ³æ­Œæ›²è¿›è¡Œé…ä¹çš„æ“ä½œï¼Œç»“æœä¸ä¸Šæ–‡ç±»ä¼¼ã€‚</p>
<h2 data-id="heading-12">Add Vocals åŠŸèƒ½</h2>
<p>2025 å¹´ 8 æœˆä»½ suno æ–°å‡º Add Vocals åŠŸèƒ½ï¼Œé¦–å…ˆéœ€è¦ä¸Šä¼ ä¸€é¦–çº¯éŸ³ä¹ï¼Œè®© suno å¡«è¯ã€å‡ºäººå£°æ­Œå”±ï¼Œé¦–å…ˆå¯ä»¥å…ˆåˆ° <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F766db278-012c-43c4-9245-5f18d8dc4d82" target="_blank" title="https://platform.acedata.cloud/documents/766db278-012c-43c4-9245-5f18d8dc4d82" ref="nofollow noopener noreferrer">Suno Upload API</a>ä¸Šä¼ ä¸€é¦–æ¸…å”±æ— é…ä¹çš„æ­Œæ›²ï¼Œå¯¹åº”å¦‚ä¸‹å¦‚çš„æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3476d60a40934285bd0778221e00e903~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=3eeK4%2F4NWUa9FkxHaNZefH0kbmE%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>ç„¶åéœ€è¦è®°å½•ä¸Šä¼ åçš„<code>audio_id</code>ï¼Œå…·ä½“çš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28290bdc768f45a9a051085c760c3684~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=CL0UHNd8od%2BM17h3CZ%2FzZjaTyB0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>æœ€åå¾—åˆ°äº†ä¸€ä¸ª<code>audio_id</code>ï¼š92254cab-3372-4d9e-bce9-cdcfdbc39070ï¼Œç„¶åæˆ‘ä»¬è¿˜éœ€è¦å¡«å†™å¦‚ä¸‹å‚æ•°ï¼š</p>
<ul>
<li>actionï¼šå†…å®¹ä¸º <code>overpainting</code>ã€‚</li>
<li>overpainting_startï¼šå¯¹ä¸Šä¼ çš„æ­Œæ›²è¿›è¡Œæ·»åŠ äººå£°çš„èµ·å§‹æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯ 0ã€‚</li>
<li>overpainting_endï¼šå¯¹ä¸Šä¼ çš„æ­Œæ›²è¿›è¡Œæ·»åŠ äººå£°çš„ç»ˆç‚¹æ—¶é—´ï¼Œå¿…é¡»å°äºæ­Œæ›²çš„æ€»æ—¶é•¿ã€‚</li>
<li>audio_idï¼šä¸Šä¼ çš„æ¸…å”±æ— é…éŸ³çš„æ­Œæ›² IDã€‚</li>
<li>customï¼šè¯¥æ¨¡å¼ä¸‹å¿…é¡»ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å¼å¡«å…¥æ­Œè¯ã€‚</li>
<li>lyricï¼šè‡ªå®šä¹‰æ¨¡å¼ä¸‹å¡«å†™çš„æ­Œè¯ã€‚</li>
<li>styleï¼šä¼´å¥çš„é£æ ¼ã€‚</li>
</ul>
<p>å¡«å†™å®Œæ¯•ä¹‹åè‡ªåŠ¨ç”Ÿæˆäº†ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd79402af97841adb0d7b42c8ba1759a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=ntavZzCyDlhkOIKGTUHB%2FXnSOh4%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¯¹åº”çš„ Python ä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"overpainting"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"lyric"</span>: <span class="hljs-string">"Yea your were the best I could get \\nBut I knew that it couldnâ€™t last \\nStayed down since we were friends \\nHad to leave those thoughts in the past \\nMade like 40k just last week \\nOn top of the 20 with my babe\\ndonâ€™t care for what niggas say"</span>,
    <span class="hljs-string">"custom"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"92254cab-3372-4d9e-bce9-cdcfdbc39070"</span>,
    <span class="hljs-string">"overpainting_end"</span>: <span class="hljs-number">120</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>ç‚¹å‡»è¿è¡Œï¼Œå¯ä»¥å‘ç°ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"31bb250e-6614-49ec-ac85-631f224daeba"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"efe8e7f3-9a65-4f13-a9f8-51e8478899df"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a597f945-64df-4722-a631-d436450832bd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a597f945-64df-4722-a631-d436450832bd.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Yea your were the best I could get \\nBut I knew that it couldnâ€™t last \\nStayed down since we were friends \\nHad to leave those thoughts in the past \\nMade like 40k just last week \\nOn top of the 20 with my babe\\ndonâ€™t care for what niggas say"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a597f945-64df-4722-a631-d436450832bd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:33:51.550Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">105.32</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b41a8b91-3d88-4ebd-a6cf-732764b24954"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b41a8b91-3d88-4ebd-a6cf-732764b24954.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Yea your were the best I could get \\nBut I knew that it couldnâ€™t last \\nStayed down since we were friends \\nHad to leave those thoughts in the past \\nMade like 40k just last week \\nOn top of the 20 with my babe\\ndonâ€™t care for what niggas say"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b41a8b91-3d88-4ebd-a6cf-732764b24954.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:33:51.550Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">148.16</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™æ ·å°±å®Œæˆäº†å¯¹ä¸Šä¼ çš„æ¸…å”±æ— é…éŸ³æ­Œæ›²è¿›è¡Œé…äººå£°çš„æ“ä½œï¼Œç»“æœä¸ä¸Šæ–‡ç±»ä¼¼ã€‚</p>
<h2 data-id="heading-13">Remaster åŠŸèƒ½</h2>
<p>2025 å¹´ 12 æœˆä»½ suno æ–°å‡º Remaster åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å¯ä»¥é‡æ–°ç”Ÿæˆæ­Œæ›²ï¼Œä¸å¯è·¨è´¦å·ï¼Œç„¶åæˆ‘ä»¬è¿˜éœ€è¦å¡«å†™å¦‚ä¸‹å‚æ•°ï¼š</p>
<ul>
<li>actionï¼šå†…å®¹ä¸º <code>remaster</code>ã€‚</li>
<li>audio_idï¼šéœ€è¦é‡æ–°ç”Ÿæˆçš„æ­Œæ›² IDã€‚</li>
<li>modelï¼šä»…æ”¯æŒ v4.5+ã€v5ã€‚</li>
<li>variation_categoryï¼šä»…åœ¨ v5 ä»¥ä¸Šç‰ˆæœ¬æ”¯æŒï¼Œè€Œä¸”åªæœ‰ 3 ä¸ªå€¼ high normal subtleã€‚</li>
</ul>
<p>å¡«å†™å®Œæ¯•ä¹‹åè‡ªåŠ¨ç”Ÿæˆäº†ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d95ce4ed02347c39a03951f83e44942~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=fQNkNgVLhItez9vVSCjrYzwwV38%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>å¯¹åº”çš„ Python ä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"remaster"</span>,
    <span class="hljs-string">"variation_category"</span>: <span class="hljs-string">"high"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"21fd46d4-45c3-4826-bec9-3f3df667902e"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>ç‚¹å‡»è¿è¡Œï¼Œå¯ä»¥å‘ç°ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"791ee74c-9363-4352-afe7-babb19b89899"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"77acda57-c3d4-4e11-a506-4f50e0609916"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b0515cdf-9cb5-46cd-b0fe-10a239dc9274"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Navidad en costura  (Remastered)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b0515cdf-9cb5-46cd-b0fe-10a239dc9274.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_large_b0515cdf-9cb5-46cd-b0fe-10a239dc9274.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"En Teror las clases siguen,\nni en Navidad hay parÃ³n;\ncose el grupo entre villancicos\ny un buen trocito de turrÃ³n.\nLa Popular abre sus puertas,\ny el taller suena mejor;\nhilo, aguja y canto alegre\nlo pasaremos mejor\nSeguimos en las costuras,\ncon mÃºsica y diversiÃ³n;\nlos alumnos comeremos\nGolosinas un montÃ³n "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b0515cdf-9cb5-46cd-b0fe-10a239dc9274.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-04T13:09:59.936Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Villancico"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">32.2</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"06edab94-a4f9-4c0c-abac-a2e8a97c76a8"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Navidad en costura  (Remastered)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_06edab94-a4f9-4c0c-abac-a2e8a97c76a8.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_large_06edab94-a4f9-4c0c-abac-a2e8a97c76a8.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"En Teror las clases siguen,\nni en Navidad hay parÃ³n;\ncose el grupo entre villancicos\ny un buen trocito de turrÃ³n.\nLa Popular abre sus puertas,\ny el taller suena mejor;\nhilo, aguja y canto alegre\nlo pasaremos mejor\nSeguimos en las costuras,\ncon mÃºsica y diversiÃ³n;\nlos alumnos comeremos\nGolosinas un montÃ³n "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/06edab94-a4f9-4c0c-abac-a2e8a97c76a8.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-04T13:09:59.936Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Villancico"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">32.2</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™æ ·å°±å®Œæˆäº†å¯¹å·²ç”Ÿæˆæ­Œæ›²é‡æ–°ç”Ÿæˆçš„æ“ä½œï¼Œç»“æœä¸ä¸Šæ–‡ç±»ä¼¼ã€‚</p>
<h2 data-id="heading-14">å¼‚æ­¥å›è°ƒ</h2>
<p>ç”±äº Suno ç”ŸæˆéŸ³ä¹çš„æ—¶é—´ç›¸å¯¹è¾ƒé•¿ï¼Œå¤§çº¦éœ€è¦ 1-2 åˆ†é’Ÿï¼Œå¦‚æœ API é•¿æ—¶é—´æ— å“åº”ï¼ŒHTTP è¯·æ±‚ä¼šä¸€ç›´ä¿æŒè¿æ¥ï¼Œå¯¼è‡´é¢å¤–çš„ç³»ç»Ÿèµ„æºæ¶ˆè€—ï¼Œæ‰€ä»¥æœ¬ API ä¹Ÿæä¾›äº†å¼‚æ­¥å›è°ƒçš„æ”¯æŒã€‚</p>
<p>æ•´ä½“æµç¨‹æ˜¯ï¼šå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œé¢å¤–æŒ‡å®šä¸€ä¸ª <code>callback_url</code> å­—æ®µï¼Œå®¢æˆ·ç«¯å‘èµ· API è¯·æ±‚ä¹‹åï¼ŒAPI ä¼šç«‹é©¬è¿”å›ä¸€ä¸ªç»“æœï¼ŒåŒ…å«ä¸€ä¸ª <code>task_id</code> çš„å­—æ®µä¿¡æ¯ï¼Œä»£è¡¨å½“å‰çš„ä»»åŠ¡ IDã€‚å½“ä»»åŠ¡å®Œæˆä¹‹åï¼Œç”ŸæˆéŸ³ä¹çš„ç»“æœä¼šé€šè¿‡ POST JSON çš„å½¢å¼å‘é€åˆ°å®¢æˆ·ç«¯æŒ‡å®šçš„ <code>callback_url</code>ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬äº† <code>task_id</code> å­—æ®µï¼Œè¿™æ ·ä»»åŠ¡ç»“æœå°±å¯ä»¥é€šè¿‡ ID å…³è”èµ·æ¥äº†ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹æ¥äº†è§£ä¸‹å…·ä½“æ€æ ·æ“ä½œã€‚</p>
<p>é¦–å…ˆï¼ŒWebhook å›è°ƒæ˜¯ä¸€ä¸ªå¯ä»¥æ¥æ”¶ HTTP è¯·æ±‚çš„æœåŠ¡ï¼Œå¼€å‘è€…åº”è¯¥æ›¿æ¢ä¸ºè‡ªå·±æ­å»ºçš„ HTTP æœåŠ¡å™¨çš„ URLã€‚æ­¤å¤„ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œä½¿ç”¨ä¸€ä¸ªå…¬å¼€çš„ Webhook æ ·ä¾‹ç½‘ç«™ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F%25EF%25BC%258C%25E6%2589%2593%25E5%25BC%2580%25E8%25AF%25A5%25E7%25BD%2591%25E7%25AB%2599%25E5%258D%25B3%25E5%258F%25AF%25E5%25BE%2597%25E5%2588%25B0%25E4%25B8%2580%25E4%25B8%25AA" target="_blank" title="https://webhook.site/%EF%BC%8C%E6%89%93%E5%BC%80%E8%AF%A5%E7%BD%91%E7%AB%99%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0%E4%B8%80%E4%B8%AA" ref="nofollow noopener noreferrer">webhook.site/ï¼Œæ‰“å¼€è¯¥ç½‘ç«™å³å¯å¾—åˆ°ä¸€â€¦</a> Webhook URLï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52c23a19fa544512ad5efe1d9005f768~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=PsoR1wQ9qhS6IsWwdJYO9%2Fge6ps%3D" alt="" loading="lazy"/></p>
<p>å°†æ­¤ URL å¤åˆ¶ä¸‹æ¥ï¼Œå°±å¯ä»¥ä½œä¸º Webhook æ¥ä½¿ç”¨ï¼Œæ­¤å¤„çš„æ ·ä¾‹ä¸º <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F03e60575-3d96-4132-b681-b713d78116e2%25E3%2580%2582" target="_blank" title="https://webhook.site/03e60575-3d96-4132-b681-b713d78116e2%E3%80%82" ref="nofollow noopener noreferrer">webhook.site/03e60575-3dâ€¦</a></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å­—æ®µ <code>callback_url</code> ä¸ºä¸Šè¿° Webhook URLï¼ŒåŒæ—¶å¡«å…¥ <code>prompt</code>ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5568437cfa3401cb6bd0e39684643b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=h16jdQXvcu7%2FIQQe8WRDSl2rOcI%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»è¿è¡Œï¼Œå¯ä»¥å‘ç°ä¼šç«‹å³å¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"44472ab8-783b-4054-b861-5bf14e462f60"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç¨ç­‰ç‰‡åˆ»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F03e60575-3d96-4132-b681-b713d78116e2" target="_blank" title="https://webhook.site/03e60575-3d96-4132-b681-b713d78116e2" ref="nofollow noopener noreferrer">webhook.site/03e60575-3dâ€¦</a> ä¸Šè§‚å¯Ÿåˆ°ç”Ÿæˆæ­Œæ›²çš„ç»“æœï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72033db0e0e74ee99896c08a770a4906~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=hEf51F4dDBKkwD%2Fe7LWgi6%2FE7w4%3D" alt="" loading="lazy"/></p>
<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"44472ab8-783b-4054-b861-5bf14e462f60"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"da4324e5-84b2-484b-b0e9-dd261381c594"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Winter Whispers"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/image_da4324e5-84b2-484b-b0e9-dd261381c594.png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnow falling gently from the sky\nChildren giggling as they pass by\nFire crackling\nCozy and warm\nChristmas spirit begins to swarm\n[Verse 2]\nTwinkling lights\nA sight to behold\nStockings hung\nWaiting to be filled with gold\nGifts wrapped with love\nPiled high\nExcitement in the air\nYou can't deny\n[Chorus]\nWinter whispers in the wind\nJoy and love it brings\nLet's celebrate this season\nWith the ones we're missing"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/da4324e5-84b2-484b-b0e9-dd261381c594.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/da4324e5-84b2-484b-b0e9-dd261381c594.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-05-11T07:33:05.430Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pop"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b878a87b-a0db-4046-8ccd-ecd2fb3d4372"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Winter Whispers"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/image_b878a87b-a0db-4046-8ccd-ecd2fb3d4372.png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnow falling gently from the sky\nChildren giggling as they pass by\nFire crackling\nCozy and warm\nChristmas spirit begins to swarm\n[Verse 2]\nTwinkling lights\nA sight to behold\nStockings hung\nWaiting to be filled with gold\nGifts wrapped with love\nPiled high\nExcitement in the air\nYou can't deny\n[Chorus]\nWinter whispers in the wind\nJoy and love it brings\nLet's celebrate this season\nWith the ones we're missing"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b878a87b-a0db-4046-8ccd-ecd2fb3d4372.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b878a87b-a0db-4046-8ccd-ecd2fb3d4372.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-05-11T07:33:05.430Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pop"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ç»“æœä¸­æœ‰ä¸€ä¸ª <code>task_id</code> å­—æ®µï¼Œå…¶ä»–çš„å­—æ®µéƒ½å’Œä¸Šæ–‡ç±»ä¼¼ï¼Œé€šè¿‡è¯¥å­—æ®µå³å¯å®ç°ä»»åŠ¡çš„å…³è”ã€‚</p>
<p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æµå¼è°ƒç”¨æ¥è·å–ç»“æœï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¯·æ±‚å¤´é‡Œé¢çš„<code>accept</code>çš„å€¼è®¾ç½®ä¸º<code>application/x-ndjson</code>å³å¯ï¼Œä¸‹é¢ç”¨ä¸€ä¸ªç¤ºä¾‹è¾“å…¥ä½œä¸ºç¤ºèŒƒï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9684399b0264fcda9edc0fe2c4d8528~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=%2FjdVATaXU%2Fs%2FB%2BEunND3NWf0iZ0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>ç­‰å¾…è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe catâ€™s knocked over the wreath\nCookies burning in the oven too\nBut Iâ€™m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nIâ€™ve got a feeling this yearâ€™s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandmaâ€™s singing a little off-key\nThe kids are laughing too loud\nThe dogâ€™s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fireâ€™s crackling\nWarm and bright\nAnd my heartâ€™s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"pending"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe catâ€™s knocked over the wreath\nCookies burning in the oven too\nBut Iâ€™m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nIâ€™ve got a feeling this yearâ€™s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandmaâ€™s singing a little off-key\nThe kids are laughing too loud\nThe dogâ€™s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fireâ€™s crackling\nWarm and bright\nAnd my heartâ€™s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"pending"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe catâ€™s knocked over the wreath\nCookies burning in the oven too\nBut Iâ€™m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nIâ€™ve got a feeling this yearâ€™s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandmaâ€™s singing a little off-key\nThe kids are laughing too loud\nThe dogâ€™s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fireâ€™s crackling\nWarm and bright\nAnd my heartâ€™s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe catâ€™s knocked over the wreath\nCookies burning in the oven too\nBut Iâ€™m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nIâ€™ve got a feeling this yearâ€™s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandmaâ€™s singing a little off-key\nThe kids are laughing too loud\nThe dogâ€™s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fireâ€™s crackling\nWarm and bright\nAnd my heartâ€™s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe catâ€™s knocked over the wreath\nCookies burning in the oven too\nBut Iâ€™m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nIâ€™ve got a feeling this yearâ€™s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandmaâ€™s singing a little off-key\nThe kids are laughing too loud\nThe dogâ€™s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fireâ€™s crackling\nWarm and bright\nAnd my heartâ€™s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.92</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe catâ€™s knocked over the wreath\nCookies burning in the oven too\nBut Iâ€™m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nIâ€™ve got a feeling this yearâ€™s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandmaâ€™s singing a little off-key\nThe kids are laughing too loud\nThe dogâ€™s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fireâ€™s crackling\nWarm and bright\nAnd my heartâ€™s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe catâ€™s knocked over the wreath\nCookies burning in the oven too\nBut Iâ€™m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nIâ€™ve got a feeling this yearâ€™s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandmaâ€™s singing a little off-key\nThe kids are laughing too loud\nThe dogâ€™s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fireâ€™s crackling\nWarm and bright\nAnd my heartâ€™s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp4"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.92</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe catâ€™s knocked over the wreath\nCookies burning in the oven too\nBut Iâ€™m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nIâ€™ve got a feeling this yearâ€™s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandmaâ€™s singing a little off-key\nThe kids are laughing too loud\nThe dogâ€™s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fireâ€™s crackling\nWarm and bright\nAnd my heartâ€™s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"4440342a-41c4-4140-8bb1-3537a598ca2e"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe catâ€™s knocked over the wreath\nCookies burning in the oven too\nBut Iâ€™m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nIâ€™ve got a feeling this yearâ€™s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandmaâ€™s singing a little off-key\nThe kids are laughing too loud\nThe dogâ€™s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fireâ€™s crackling\nWarm and bright\nAnd my heartâ€™s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.92</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe catâ€™s knocked over the wreath\nCookies burning in the oven too\nBut Iâ€™m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nIâ€™ve got a feeling this yearâ€™s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandmaâ€™s singing a little off-key\nThe kids are laughing too loud\nThe dogâ€™s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fireâ€™s crackling\nWarm and bright\nAnd my heartâ€™s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/d1a3109d-799b-401e-b032-4b501bcf26f3.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">127.16</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>å¾—åˆ°çš„ç»“æœè·ŸåŸºæœ¬è°ƒç”¨ç±»ä¼¼ï¼Œä¸Šé¢å¤šä¸ªç»“æœå°±å®ç°äº†æµå¼è°ƒç”¨ã€‚</p>
<h2 data-id="heading-15">é”™è¯¯å¤„ç†</h2>
<p>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œæ‚¨å°†å¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„é”™è¯¯ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"forbidden"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Song Description contained artist name: eminem"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9bb7c2f4-3b7b-4965-b50a-f663874b1b6f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9bb3a2a6-c438-436d-a9f3-fa466abc077c"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä¸‹é¢æ˜¯ HTTP Status Code, <code>error.code</code>, <code>error.message</code> çš„åˆ—è¡¨ï¼š</p>
































































































































































<table><thead><tr><th>Status Code</th><th><code>error.code</code></th><th><code>error.message</code></th></tr></thead><tbody><tr><td>400</td><td><code>bad_request</code></td><td><code>The song id does not exist or has been taken offline.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Prompt too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Tags too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Uploaded audio matches existing work of art.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>instrumental must be a boolean</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Title too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Topic too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>style must be less than or equal 120</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>custom must be a boolean</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>audio_id is required when extend audio</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>continue_at is required when extend audio</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>continue_at must be a number greater than 0</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>lyric is required when extend audio and instrumental is false</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>prompt is required when generate audio</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>lyric is required when generate custom audio</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt likely malformed</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt likely copyrighted</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt contained inappropriate material</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Song Description flagged for moderation</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Song Description contained artist name</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Tags contained artist name</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Lyrics contained copyrighted material</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Song Description contained producer tag</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Generic openAI error</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt flagged for moderation</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>Unable to generate lyrics from song description</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>job failed with unknown error</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>no available worker in system</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>service under maintenance, generation paused</code></td></tr><tr><td>504</td><td><code>timeout</code></td><td><code>timeout while waiting for audio generation</code></td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Batchå®æˆ˜]]></title>    <link>https://juejin.cn/post/7603575763786874906</link>    <guid>https://juejin.cn/post/7603575763786874906</guid>    <pubDate>2026-02-06T23:44:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575763786874906" data-draft-id="7603352117640134665" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Batchå®æˆ˜"/> <meta itemprop="keywords" content="Java,Spring"/> <meta itemprop="datePublished" content="2026-02-06T23:44:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Batchå®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T23:44:29.000Z" title="Fri Feb 06 2026 23:44:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Batchå®æˆ˜</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨ä¼ä¸šçº§åº”ç”¨ä¸­ï¼Œæ‰¹é‡æ•°æ®å¤„ç†æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„éœ€æ±‚ã€‚æ¯”å¦‚æœˆåº•çš„å·¥èµ„ä»£å‘ã€é“¶è¡Œå¯¹è´¦ã€æ•°æ®æŠ¥è¡¨ç”Ÿæˆç­‰ã€‚å½“æ•°æ®é‡è¾¾åˆ°å‡ åä¸‡ç”šè‡³ä¸Šç™¾ä¸‡æ—¶ï¼Œå¦‚ä½•é«˜æ•ˆã€å¯é åœ°å¤„ç†è¿™äº›æ•°æ®ï¼Œå°±æˆäº†ä¸€ä¸ªæŠ€æœ¯æŒ‘æˆ˜ã€‚</p>
<p>æœ¬æ–‡å°†ä»¥"50ä¸‡ç¬”å·¥èµ„ä»£å‘"ä¸ºå®é™…åœºæ™¯ï¼Œè¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Spring Batchæ¡†æ¶æ¥å¤„ç†å¤§è§„æ¨¡æ‰¹é‡æ•°æ®ï¼Œå¹¶é‡ç‚¹è®²è§£å½“å¤„ç†å¤±è´¥æ—¶ï¼Œå¦‚ä½•å®ç°<strong>éƒ¨åˆ†å›æ»šæœºåˆ¶</strong>ï¼Œç¡®ä¿å·²æˆåŠŸå¤„ç†çš„æ•°æ®ä¸ä¼šå› ä¸ºå°‘é‡å¤±è´¥è®°å½•è€Œå…¨éƒ¨å›æ»šã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€ä»€ä¹ˆæ˜¯Spring Batchï¼Ÿ</h3>
<h4 data-id="heading-3">1.1 Spring Batchç®€ä»‹</h4>
<p>Spring Batchæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€å…¨é¢çš„æ‰¹å¤„ç†æ¡†æ¶ï¼Œç”±Springå›¢é˜Ÿå¼€å‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¼ä¸šå¼€å‘å¥å£®çš„æ‰¹å¤„ç†åº”ç”¨ç¨‹åºã€‚å®ƒäº2008å¹´é¦–æ¬¡å‘å¸ƒï¼Œç»è¿‡åå¤šå¹´çš„å‘å±•ï¼Œå·²ç»æˆä¸ºJavaæ‰¹å¤„ç†é¢†åŸŸçš„äº‹å®æ ‡å‡†ã€‚</p>
<p>Spring Batchçš„æ ¸å¿ƒè®¾è®¡ç†å¿µåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>Chunk-oriented Processingï¼ˆå—çº§å¤„ç†ï¼‰</strong>ï¼šå°†å¤§é‡æ•°æ®åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º</li>
<li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šæ¯ä¸ªChunkä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„äº‹åŠ¡ï¼Œæ”¯æŒéƒ¨åˆ†å›æ»š</li>
<li><strong>å®¹é”™æœºåˆ¶</strong>ï¼šæ”¯æŒè·³è¿‡ï¼ˆSkipï¼‰ã€é‡è¯•ï¼ˆRetryï¼‰ç­‰å®¹é”™ç­–ç•¥</li>
<li><strong>ä½œä¸šè°ƒåº¦</strong>ï¼šæ”¯æŒå®šæ—¶ä»»åŠ¡ã€æ‰‹åŠ¨è§¦å‘ç­‰å¤šç§è°ƒåº¦æ–¹å¼</li>
<li><strong>ç›‘æ§ä¸ç»Ÿè®¡</strong>ï¼šæä¾›å®Œæ•´çš„æ‰§è¡Œè®°å½•å’Œç»Ÿè®¡ä¿¡æ¯</li>
</ul>
<h4 data-id="heading-4">1.2 æ ¸å¿ƒæ¦‚å¿µè¯¦è§£</h4>
<h5 data-id="heading-5">Jobï¼ˆä½œä¸šï¼‰</h5>
<p>Jobæ˜¯æ‰¹å¤„ç†çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„æ‰¹å¤„ç†ä»»åŠ¡ã€‚ä¸€ä¸ªJobå¯ä»¥åŒ…å«å¤šä¸ªStepï¼ŒæŒ‰é¡ºåºæˆ–å¹¶è¡Œæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Job <span class="hljs-title function_">salaryPaymentJob</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> jobBuilderFactory.get(<span class="hljs-string">"salaryPaymentJob"</span>)
        .start(step1())
        .next(step2())
        .build();
}
</code></pre>
<h5 data-id="heading-6">Stepï¼ˆæ­¥éª¤ï¼‰</h5>
<p>Stepæ˜¯Jobçš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œæ¯ä¸ªStepåŒ…å«ï¼š</p>
<ul>
<li><strong>ItemReader</strong>ï¼šè¯»å–æ•°æ®</li>
<li><strong>ItemProcessor</strong>ï¼šå¤„ç†æ•°æ®ï¼ˆå¯é€‰ï¼‰</li>
<li><strong>ItemWriter</strong>ï¼šå†™å…¥æ•°æ®</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Step <span class="hljs-title function_">salaryPaymentStep</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> stepBuilderFactory.get(<span class="hljs-string">"salaryPaymentStep"</span>)
        .&lt;SalaryPayment, SalaryPayment&gt;chunk(<span class="hljs-number">1000</span>)
        .reader(reader())
        .processor(processor())
        .writer(writer())
        .build();
}
</code></pre>
<h5 data-id="heading-7">Chunkï¼ˆæ•°æ®å—ï¼‰</h5>
<p>Chunkæ˜¯Spring Batchå¤„ç†æ•°æ®çš„åŸºæœ¬å•ä½ã€‚æ¯æ¬¡ä»Readerè¯»å–æŒ‡å®šæ•°é‡çš„è®°å½•ï¼Œå¤„ç†åä¸€èµ·æäº¤åˆ°æ•°æ®åº“ï¼š</p>
<pre><code class="hljs">è¯»å–1000æ¡ â†’ å¤„ç†1000æ¡ â†’ å†™å…¥1000æ¡ â†’ æäº¤äº‹åŠ¡
</code></pre>
<h4 data-id="heading-8">1.3 åº”ç”¨åœºæ™¯</h4>
<p>Spring Batché€‚ç”¨äºä»¥ä¸‹å…¸å‹åœºæ™¯ï¼š</p>






























<table><thead><tr><th>åœºæ™¯</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>æ•°æ®è¿ç§»</td><td>è·¨ç³»ç»Ÿæ•°æ®åŒæ­¥</td><td>ä»æ—§ç³»ç»Ÿè¿ç§»æ•°æ®åˆ°æ–°ç³»ç»Ÿ</td></tr><tr><td>æ•°æ®è½¬æ¢</td><td>ETLè¿‡ç¨‹</td><td>ä»æ•°æ®åº“è¯»å–ã€è½¬æ¢ã€å†™å…¥æ•°æ®ä»“åº“</td></tr><tr><td>æ‰¹é‡å¤„ç†</td><td>å®šæœŸæ‰¹é‡æ“ä½œ</td><td>æœˆåº•å·¥èµ„ä»£å‘ã€é“¶è¡Œå¯¹è´¦</td></tr><tr><td>æŠ¥è¡¨ç”Ÿæˆ</td><td>å®šæœŸç”ŸæˆæŠ¥è¡¨</td><td>æ¯æ—¥äº¤æ˜“æ±‡æ€»æŠ¥è¡¨</td></tr></tbody></table>
<h4 data-id="heading-9">1.4 ä¸å…¶ä»–æ¡†æ¶å¯¹æ¯”</h4>









































<table><thead><tr><th>ç‰¹æ€§</th><th>Spring Batch</th><th>Quartz</th><th>Scheduled Executor</th></tr></thead><tbody><tr><td>æ‰¹é‡å¤„ç†</td><td>âœ… ä¸“ç”¨</td><td>éœ€è¦</td><td>éœ€è¦</td></tr><tr><td>äº‹åŠ¡ç®¡ç†</td><td>âœ… å†…ç½®</td><td>æ— </td><td>æ— </td></tr><tr><td>å®¹é”™æœºåˆ¶</td><td>âœ… å®Œå–„çš„Skip/Retry</td><td>æ— </td><td>æ— </td></tr><tr><td>ç›‘æ§ç»Ÿè®¡</td><td>âœ… æ•°æ®åº“æŒä¹…åŒ–</td><td>åŸºç¡€</td><td>æ— </td></tr><tr><td>å¹¶è¡Œå¤„ç†</td><td>âœ… å¤šç§æ¨¡å¼</td><td>æ— </td><td>åŸºç¡€</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦éƒ¨åˆ†å›æ»šï¼Ÿ</strong></p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼šä½ éœ€è¦å¤„ç†50ä¸‡ç¬”å·¥èµ„ä»£å‘ï¼Œå¦‚æœç¬¬49ä¸‡ç¬”è®°å½•å› ä¸ºé“¶è¡Œå¡å·é”™è¯¯è€Œå¤±è´¥ï¼Œåœ¨æ²¡æœ‰éƒ¨åˆ†å›æ»šæœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå‰é¢489,999ç¬”å·²æˆåŠŸå¤„ç†çš„æ•°æ®ä¼šå…¨éƒ¨å›æ»šï¼è¿™å¯¹äºä¸šåŠ¡æ¥è¯´æ˜¯ä¸å¯æ¥å—çš„ã€‚</p>
<hr/>
<h3 data-id="heading-10">äºŒã€ç³»ç»Ÿæ¶æ„è®¾è®¡</h3>
<p>ä¸ºäº†å®ç°50ä¸‡ç¬”å·¥èµ„ä»£å‘çš„é«˜æ•ˆå¤„ç†ï¼Œæˆ‘ä»¬è®¾è®¡äº†å¦‚ä¸‹çš„ç³»ç»Ÿæ¶æ„ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcd00eb304e3405bba04e396f8f17e3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=6U7zJ6OTXz6gkHUmSzFWbDGsk6w%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†Spring Batchå·¥èµ„ä»£å‘ç³»ç»Ÿçš„åˆ†å±‚æ¶æ„ï¼š</p>
<ul>
<li><strong>Webå±‚</strong>ï¼šæä¾›ç›‘æ§é¢æ¿ï¼Œæ”¯æŒJobå¯åŠ¨/åœæ­¢ã€å®æ—¶çŠ¶æ€ç›‘æ§å’Œç»Ÿè®¡ä¿¡æ¯æŸ¥è¯¢</li>
<li><strong>Batchæ§åˆ¶å±‚</strong>ï¼šREST APIæ¥å£ï¼ŒåŒ…å«JobLauncherå’ŒJobRepository</li>
<li><strong>Spring Batchæ ¸å¿ƒå±‚</strong>ï¼šJobâ†’Stepâ†’Chunkçš„å¤„ç†æµç¨‹ï¼ŒåŒ…å«Readerã€Processorã€Writerä¸‰å¤§ç»„ä»¶</li>
<li><strong>æ•°æ®å­˜å‚¨å±‚</strong>ï¼šMySQLæ•°æ®åº“ã€CSVæ–‡ä»¶å’ŒJobæ‰§è¡Œæ—¥å¿—</li>
</ul>
<h4 data-id="heading-11">2.1 æ ¸å¿ƒç»„ä»¶è¯´æ˜</h4>



































<table><thead><tr><th>ç»„ä»¶</th><th>èŒè´£</th><th>å®ç°ç±»</th></tr></thead><tbody><tr><td>Job</td><td>æ•´ä¸ªæ‰¹å¤„ç†ä»»åŠ¡</td><td>SalaryPaymentJob</td></tr><tr><td>Step</td><td>ä»»åŠ¡ä¸­çš„ä¸€ä¸ªæ­¥éª¤</td><td>SalaryPaymentStep</td></tr><tr><td>ItemReader</td><td>æ•°æ®è¯»å–å™¨</td><td>FlatFileItemReaderï¼ˆè¯»å–CSVï¼‰</td></tr><tr><td>ItemProcessor</td><td>æ•°æ®å¤„ç†å™¨</td><td>SalaryPaymentProcessorï¼ˆæ•°æ®éªŒè¯ï¼‰</td></tr><tr><td>ItemWriter</td><td>æ•°æ®å†™å…¥å™¨</td><td>JdbcBatchItemWriterï¼ˆæ‰¹é‡å†™å…¥æ•°æ®åº“ï¼‰</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-12">ä¸‰ã€éƒ¨åˆ†å›æ»šæœºåˆ¶åŸç†</h3>
<h4 data-id="heading-13">3.1 Chunk-Oriented Processing</h4>
<p>Spring Batché‡‡ç”¨**Chunk-Oriented Processingï¼ˆå—çº§å¤„ç†ï¼‰**æ¨¡å¼ï¼Œè¿™æ˜¯å®ç°éƒ¨åˆ†å›æ»šçš„æ ¸å¿ƒæœºåˆ¶ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d084688d1ebe463c9652b1ba0d53c668~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=UuFoHlDwgOOpU%2FXE5sMRjhtTvc8%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†Batchå¤„ç†çš„æ ¸å¿ƒæµç¨‹ï¼šReaderè¯»å–æ•°æ® â†’ Processorå¤„ç†éªŒè¯ â†’ Writeræ‰¹é‡å†™å…¥ï¼Œå½¢æˆå®Œæ•´çš„å¤„ç†ç®¡é“ã€‚</p>
<p>å¯¹äº50ä¸‡ç¬”æ•°æ®çš„å¤„ç†ï¼ŒChunkæœºåˆ¶çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">50</span>ä¸‡ç¬”æ•°æ®
    â”‚
    â”œâ”€â–º Chunk <span class="hljs-number">1</span> (<span class="hljs-number">1</span>-<span class="hljs-number">1000</span>ç¬”)   â”€â”€â–º ç‹¬ç«‹äº‹åŠ¡ â”€â”€â–º æˆåŠŸæäº¤
    â”œâ”€â–º Chunk <span class="hljs-number">2</span> (<span class="hljs-number">1001</span>-<span class="hljs-number">2000</span>ç¬”) â”€â”€â–º ç‹¬ç«‹äº‹åŠ¡ â”€â”€â–º æˆåŠŸæäº¤
    â”œâ”€â–º Chunk <span class="hljs-number">3</span> (<span class="hljs-number">2001</span>-<span class="hljs-number">3000</span>ç¬”) â”€â”€â–º ç‹¬ç«‹äº‹åŠ¡ â”€â”€â–º ç¬¬<span class="hljs-number">2500</span>ç¬”å¤±è´¥ â†’ é‡è¯•<span class="hljs-number">3</span>æ¬¡ â†’ è·³è¿‡ â†’ å…¶ä½™<span class="hljs-number">999</span>ç¬”æäº¤
    â”œâ”€â–º Chunk <span class="hljs-number">4</span> (<span class="hljs-number">3001</span>-<span class="hljs-number">4000</span>ç¬”) â”€â”€â–º ç‹¬ç«‹äº‹åŠ¡ â”€â”€â–º æˆåŠŸæäº¤
    ...
    â””â”€â–º Chunk <span class="hljs-number">500</span> (<span class="hljs-number">499001</span>-<span class="hljs-number">500000</span>ç¬”) â”€â”€â–º ç‹¬ç«‹äº‹åŠ¡ â”€â”€â–º æˆåŠŸæäº¤

æœ€ç»ˆç»“æœï¼š<span class="hljs-number">499</span>,<span class="hljs-number">999</span>ç¬”æˆåŠŸï¼Œ<span class="hljs-number">1</span>ç¬”è¢«è·³è¿‡
</code></pre>
<p><strong>å…³é”®é…ç½®ï¼š</strong></p>
<ul>
<li><strong>chunkSize</strong>: 1000ï¼ˆæ¯1000ç¬”æäº¤ä¸€æ¬¡ï¼‰</li>
<li><strong>skipLimit</strong>: 100ï¼ˆæœ€å¤šè·³è¿‡100ç¬”å¤±è´¥è®°å½•ï¼‰</li>
<li><strong>retryLimit</strong>: 3ï¼ˆæ¯ç¬”å¤±è´¥é‡è¯•3æ¬¡ï¼‰</li>
</ul>
<h4 data-id="heading-14">3.2 äº‹åŠ¡è¾¹ç•Œä¸éƒ¨åˆ†å›æ»š</h4>
<p>æ¯ä¸ªChunkæ˜¯ç‹¬ç«‹çš„äº‹åŠ¡å•å…ƒï¼Œè¿™æ˜¯å®ç°éƒ¨åˆ†å›æ»šçš„å…³é”®ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3cadc7def044954ab96efb3b4f174c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=tDesgDqGrq9SQu7Kbxsq%2FXq2ljQ%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾æ¸…æ™°åœ°å±•ç¤ºäº†äº‹åŠ¡è¾¹ç•Œå’Œéƒ¨åˆ†å›æ»šçš„å·¥ä½œæœºåˆ¶ï¼š</p>
<p><strong>äº‹åŠ¡è§„åˆ™ï¼š</strong></p>
<ul>
<li>Chunkå†…ä»»æ„è®°å½•å¤±è´¥ â†’ æ•´ä¸ªChunkå›æ»š</li>
<li>é‡è¯•æˆåŠŸ â†’ ç»§ç»­å¤„ç†</li>
<li>é‡è¯•å¤±è´¥ä¸”å¯è·³è¿‡ â†’ è·³è¿‡è¯¥è®°å½•ï¼Œç»§ç»­å¤„ç†Chunkå†…å‰©ä½™è®°å½•</li>
<li>è·³è¿‡æ¬¡æ•°è¶…é™ â†’ æ•´ä¸ªJobå¤±è´¥</li>
</ul>
<p><strong>å®é™…æ¡ˆä¾‹ï¼š</strong>
å‡è®¾Chunk 3ä¸­æœ‰1000ç¬”æ•°æ®ï¼Œç¬¬500ç¬”éªŒè¯å¤±è´¥ï¼š</p>
<ol>
<li>Spring Batchå›æ»šæ•´ä¸ªChunk 3</li>
<li>é‡æ–°è¯»å–Chunk 3çš„1000ç¬”æ•°æ®</li>
<li>å¤„ç†åˆ°ç¬¬500ç¬”æ—¶ï¼Œæ•è·å¼‚å¸¸</li>
<li>é‡è¯•3æ¬¡åä»ç„¶å¤±è´¥</li>
<li>æ£€æŸ¥æ˜¯å¦å¯è·³è¿‡ï¼ˆIllegalArgumentExceptionåœ¨è·³è¿‡åˆ—è¡¨ä¸­ï¼‰</li>
<li>è·³è¿‡ç¬¬500ç¬”ï¼Œç»§ç»­å¤„ç†501-1000ç¬”</li>
<li>æœ€ç»ˆChunk 3æˆåŠŸæäº¤999ç¬”ï¼Œ1ç¬”è¢«è·³è¿‡</li>
</ol>
<h4 data-id="heading-15">3.3 å®¹é”™ç­–ç•¥é…ç½®</h4>
<pre><code class="hljs language-java" lang="java">.faultTolerant()                    <span class="hljs-comment">// å¯ç”¨å®¹é”™</span>
    .skipLimit(<span class="hljs-number">100</span>)                 <span class="hljs-comment">// æœ€å¤šè·³è¿‡100æ¡</span>
    .skip(IllegalArgumentException.class)    <span class="hljs-comment">// è·³è¿‡æ•°æ®éªŒè¯å¼‚å¸¸</span>
    .skip(NullPointerException.class)        <span class="hljs-comment">// è·³è¿‡ç©ºæŒ‡é’ˆå¼‚å¸¸</span>
    .retryLimit(<span class="hljs-number">3</span>)                  <span class="hljs-comment">// å¤±è´¥é‡è¯•3æ¬¡</span>
    .retry(Exception.class)         <span class="hljs-comment">// é‡è¯•æ‰€æœ‰å¼‚å¸¸</span>
</code></pre>
<hr/>
<h3 data-id="heading-16">å››ã€50ä¸‡ç¬”å·¥èµ„ä»£å‘æ•°æ®å¤„ç†æµç¨‹</h3>
<p>åœ¨ç†è§£äº†éƒ¨åˆ†å›æ»šæœºåˆ¶åï¼Œæˆ‘ä»¬æ¥çœ‹å®Œæ•´çš„å·¥èµ„ä»£å‘æ•°æ®å¤„ç†æµç¨‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8b9318892e8425abf7d289b608db5bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=SIsXxsWk3rb%2BjcCk4aE465G5rXg%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†ä»CSVæ–‡ä»¶è¯»å–åˆ°æ•°æ®åº“å†™å…¥çš„å®Œæ•´æ•°æ®æµï¼ŒåŒ…å«ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š</p>
<ol>
<li><strong>æ•°æ®è¯»å–</strong>ï¼šFlatFileItemReaderè¯»å–CSVæ–‡ä»¶ï¼Œæ¯è¡Œæ˜ å°„ä¸ºSalaryPaymentå¯¹è±¡</li>
<li><strong>æ•°æ®éªŒè¯</strong>ï¼šSalaryPaymentProcessorè¿›è¡Œæ•°æ®æ ¡éªŒ
<ul>
<li>å‘˜å·¥IDéç©ºéªŒè¯</li>
<li>é‡‘é¢èŒƒå›´éªŒè¯ï¼ˆ0.01-100ä¸‡ï¼‰</li>
<li>é“¶è¡Œå¡å·æ ¼å¼éªŒè¯ï¼ˆ16-19ä½æ•°å­—ï¼‰</li>
</ul>
</li>
<li><strong>çŠ¶æ€æ›´æ–°</strong>ï¼šè®¾ç½®çŠ¶æ€ä¸ºPROCESSINGï¼Œç”Ÿæˆå”¯ä¸€äº¤æ˜“ID</li>
<li><strong>æ‰¹é‡å†™å…¥</strong>ï¼šJdbcBatchItemWriteræ‰¹é‡å†™å…¥æ•°æ®åº“</li>
<li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šéªŒè¯å¤±è´¥çš„è®°å½•è¢«è·³è¿‡ï¼Œè®°å½•åˆ°å¤±è´¥åˆ—è¡¨</li>
</ol>
<hr/>
<h3 data-id="heading-17">äº”ã€æ ¸å¿ƒä»£ç å®ç°</h3>
<h4 data-id="heading-18">5.1 Jobé…ç½®</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryPaymentJobConfig</span> {

    <span class="hljs-meta">@Value("${batch.chunk.size:1000}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> chunkSize;  <span class="hljs-comment">// æ¯æ¬¡å¤„ç†çš„è®°å½•æ•°</span>

    <span class="hljs-meta">@Value("${batch.skip.limit:100}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> skipLimit;  <span class="hljs-comment">// è·³è¿‡é™åˆ¶</span>

    <span class="hljs-meta">@Value("${batch.retry.limit:3}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> retryLimit; <span class="hljs-comment">// é‡è¯•æ¬¡æ•°</span>

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Step <span class="hljs-title function_">salaryPaymentStep</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> stepBuilderFactory
            .get(<span class="hljs-string">"salaryPaymentStep"</span>)
            .&lt;SalaryPayment, SalaryPayment&gt;chunk(chunkSize)
            .reader(salaryPaymentReader())
            .processor(salaryPaymentProcessor())
            .writer(salaryPaymentWriter())
            .faultTolerant()  <span class="hljs-comment">// å¯ç”¨å®¹é”™</span>
            .skipLimit(skipLimit)
            .skip(IllegalArgumentException.class)
            .skip(NullPointerException.class)
            .retryLimit(retryLimit)
            .retry(Exception.class)
            .listener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalaryItemReadListener</span>())
            .listener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalaryItemWriteListener</span>())
            .build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Job <span class="hljs-title function_">salaryPaymentJob</span><span class="hljs-params">(Step step, SalaryJobExecutionListener listener)</span> {
        <span class="hljs-keyword">return</span> jobBuilderFactory.get(<span class="hljs-string">"salaryPaymentJob"</span>)
            .incrementer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RunIdIncrementer</span>())
            .listener(listener)
            .start(step)
            .build();
    }
}
</code></pre>
<h4 data-id="heading-19">5.2 æ•°æ®è¯»å–å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> FlatFileItemReader&lt;SalaryPayment&gt; <span class="hljs-title function_">salaryPaymentReader</span><span class="hljs-params">()</span> {
    FlatFileItemReader&lt;SalaryPayment&gt; reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlatFileItemReader</span>&lt;&gt;();
    reader.setName(<span class="hljs-string">"salaryPaymentReader"</span>);
    reader.setResource(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">"input/salary-payments.csv"</span>));
    reader.setLinesToSkip(<span class="hljs-number">1</span>);  <span class="hljs-comment">// è·³è¿‡CSVæ ‡é¢˜è¡Œ</span>

    <span class="hljs-comment">// è®¾ç½®åˆ—æ˜ å°„</span>
    <span class="hljs-type">DelimitedLineTokenizer</span> <span class="hljs-variable">tokenizer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelimitedLineTokenizer</span>();
    tokenizer.setNames(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{
        <span class="hljs-string">"employeeId"</span>, <span class="hljs-string">"employeeName"</span>, <span class="hljs-string">"accountNumber"</span>,
        <span class="hljs-string">"accountName"</span>, <span class="hljs-string">"bankName"</span>, <span class="hljs-string">"amount"</span>, <span class="hljs-string">"currency"</span>,
        <span class="hljs-string">"paymentDate"</span>, <span class="hljs-string">"remark"</span>
    });

    <span class="hljs-comment">// è®¾ç½®å­—æ®µæ˜ å°„</span>
    BeanWrapperFieldSetMapper&lt;SalaryPayment&gt; mapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanWrapperFieldSetMapper</span>&lt;&gt;();
    mapper.setTargetType(SalaryPayment.class);

    DefaultLineMapper&lt;SalaryPayment&gt; lineMapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultLineMapper</span>&lt;&gt;();
    lineMapper.setLineTokenizer(tokenizer);
    lineMapper.setFieldSetMapper(mapper);
    reader.setLineMapper(lineMapper);

    <span class="hljs-keyword">return</span> reader;
}
</code></pre>
<h4 data-id="heading-20">5.3 æ•°æ®å¤„ç†å™¨ï¼ˆéªŒè¯é€»è¾‘ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryPaymentProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ItemProcessor</span>&lt;SalaryPayment, SalaryPayment&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">MIN_AMOUNT</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.01"</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">MAX_AMOUNT</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"1000000"</span>);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SalaryPayment <span class="hljs-title function_">process</span><span class="hljs-params">(SalaryPayment item)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. æ•°æ®éªŒè¯</span>
        <span class="hljs-keyword">if</span> (item.getEmployeeId() == <span class="hljs-literal">null</span> || item.getEmployeeId().trim().isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å‘˜å·¥IDä¸èƒ½ä¸ºç©º"</span>);
        }

        <span class="hljs-comment">// 2. é‡‘é¢éªŒè¯</span>
        <span class="hljs-keyword">if</span> (item.getAmount() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å‘æ”¾é‡‘é¢ä¸èƒ½ä¸ºç©º"</span>);
        }
        <span class="hljs-keyword">if</span> (item.getAmount().compareTo(MIN_AMOUNT) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å‘æ”¾é‡‘é¢ä¸èƒ½å°äº0.01å…ƒ"</span>);
        }
        <span class="hljs-keyword">if</span> (item.getAmount().compareTo(MAX_AMOUNT) &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å‘æ”¾é‡‘é¢ä¸èƒ½å¤§äº100ä¸‡å…ƒ"</span>);
        }

        <span class="hljs-comment">// 3. é“¶è¡Œå¡å·éªŒè¯</span>
        <span class="hljs-keyword">if</span> (item.getAccountNumber() == <span class="hljs-literal">null</span> ||
            item.getAccountNumber().length() &lt; <span class="hljs-number">16</span> ||
            item.getAccountNumber().length() &gt; <span class="hljs-number">19</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"é“¶è¡Œè´¦å·é•¿åº¦å¿…é¡»åœ¨16-19ä½ä¹‹é—´"</span>);
        }

        <span class="hljs-comment">// 4. è®¾ç½®å¤„ç†çŠ¶æ€</span>
        item.setStatus(<span class="hljs-string">"PROCESSING"</span>);
        item.setTransactionId(<span class="hljs-string">"SAL"</span> + System.currentTimeMillis() + item.getEmployeeId());

        <span class="hljs-keyword">return</span> item;
    }
}
</code></pre>
<h4 data-id="heading-21">5.4 æ•°æ®å†™å…¥å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryPaymentWriter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ItemWriter</span>&lt;SalaryPayment&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JdbcBatchItemWriter&lt;SalaryPayment&gt; delegate;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SalaryPaymentWriter</span><span class="hljs-params">(DataSource dataSource)</span> {
        <span class="hljs-built_in">this</span>.delegate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcBatchItemWriter</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.delegate.setDataSource(dataSource);
        <span class="hljs-built_in">this</span>.delegate.setSql(
            <span class="hljs-string">"INSERT INTO salary_payment "</span> +
            <span class="hljs-string">"(employee_id, employee_name, account_number, account_name, "</span> +
            <span class="hljs-string">"bank_name, amount, currency, payment_date, remark, "</span> +
            <span class="hljs-string">"status, transaction_id, create_time, update_time) "</span> +
            <span class="hljs-string">"VALUES (:employeeId, :employeeName, :accountNumber, :accountName, "</span> +
            <span class="hljs-string">":bankName, :amount, :currency, :paymentDate, :remark, "</span> +
            <span class="hljs-string">":status, :transactionId, :createTime, :updateTime)"</span>);
        <span class="hljs-built_in">this</span>.delegate.setItemSqlParameterSourceProvider(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanPropertyItemSqlParameterSourceProvider</span>&lt;&gt;()
        );
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(List&lt;? extends SalaryPayment&gt; items)</span> <span class="hljs-keyword">throws</span> Exception {
        delegate.write(items);
    }
}
</code></pre>
<h4 data-id="heading-22">5.5 è‡ªå®šä¹‰SkipPolicy</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PartialRollbackHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SkipPolicy</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SKIP_LIMIT</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldSkip</span><span class="hljs-params">(Throwable throwable, <span class="hljs-type">int</span> skipCount)</span> {
        <span class="hljs-comment">// è¶…è¿‡è·³è¿‡é™åˆ¶</span>
        <span class="hljs-keyword">if</span> (skipCount &gt;= SKIP_LIMIT) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸èƒ½è·³è¿‡</span>
        <span class="hljs-keyword">if</span> (throwable <span class="hljs-keyword">instanceof</span> FileNotFoundException) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// æ•°æ®æ ¼å¼é”™è¯¯ï¼Œå¯ä»¥è·³è¿‡</span>
        <span class="hljs-keyword">if</span> (throwable <span class="hljs-keyword">instanceof</span> FlatFileParseException) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">// æ•°æ®éªŒè¯å¤±è´¥ï¼Œå¯ä»¥è·³è¿‡</span>
        <span class="hljs-keyword">if</span> (throwable <span class="hljs-keyword">instanceof</span> IllegalArgumentException ||
            throwable <span class="hljs-keyword">instanceof</span> NullPointerException) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-23">å…­ã€ç›‘æ§ä¸è°ƒåº¦æ¶æ„</h3>
<p>é™¤äº†æ•°æ®å¤„ç†ï¼ŒSpring Batchè¿˜æä¾›äº†å®Œå–„çš„ç›‘æ§å’Œè°ƒåº¦èƒ½åŠ›ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75d4b1910c2744e1ae48875ce1ce6e31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=6ByRneA25pJ%2BsYmXWs9B49dsOdQ%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†å®Œæ•´çš„ç›‘æ§ä¸è°ƒåº¦æ¶æ„ï¼š</p>
<p><strong>è°ƒåº¦å±‚</strong>ï¼šæ”¯æŒä¸‰ç§è°ƒåº¦æ–¹å¼</p>
<ul>
<li>Quartzè°ƒåº¦å™¨ï¼šæ”¯æŒåˆ†å¸ƒå¼è°ƒåº¦ï¼Œé€‚åˆé›†ç¾¤ç¯å¢ƒ</li>
<li>Spring Taskè°ƒåº¦ï¼šç®€å•çš„å®šæ—¶ä»»åŠ¡ï¼Œè½»é‡çº§é€‰æ‹©</li>
<li>Cronè¡¨è¾¾å¼ï¼šçµæ´»çš„æ—¶é—´é…ç½®</li>
</ul>
<p><strong>æ‰§è¡Œå±‚</strong>ï¼šæ ¸å¿ƒæ‰§è¡Œç»„ä»¶</p>
<ul>
<li>JobLauncherï¼šå¯åŠ¨ä½œä¸šï¼Œåˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡</li>
<li>JobOperatorï¼šæ“ä½œä½œä¸šï¼Œæ”¯æŒåœæ­¢/é‡å¯/é‡è¯•</li>
<li>StepExecutionï¼šæ­¥éª¤æ‰§è¡Œï¼Œé‡‡ç”¨Chunkå¤„ç†æ¨¡å¼</li>
<li>ThreadPoolExecutorï¼šçº¿ç¨‹æ± ï¼Œå®ç°å¹¶å‘å¤„ç†</li>
</ul>
<p><strong>ç›‘æ§å±‚</strong>ï¼šç›‘æ§ä¸ç»Ÿè®¡</p>
<ul>
<li>JobRepositoryï¼šå­˜å‚¨å…ƒæ•°æ®ï¼ˆBATCH_JOB_INSTANCEã€BATCH_JOB_EXECUTIONã€BATCH_STEP_EXECUTIONï¼‰</li>
<li>JobExplorerï¼šæŸ¥è¯¢ä½œä¸šçŠ¶æ€ã€è·å–æ‰§è¡Œå†å²</li>
<li>Metricsï¼šå¤„ç†è®°å½•æ•°ã€æ‰§è¡Œæ—¶é—´ã€å¤±è´¥ç‡ç»Ÿè®¡</li>
</ul>
<p><strong>æ•°æ®å±‚</strong>ï¼šæ•°æ®å­˜å‚¨</p>
<ul>
<li>MySQL 8.0ï¼šå­˜å‚¨å…ƒæ•°æ®è¡¨ã€ä¸šåŠ¡æ•°æ®è¡¨ã€æ—¥å¿—è®°å½•</li>
<li>Redisç¼“å­˜ï¼šæ‰§è¡ŒçŠ¶æ€ç¼“å­˜ã€è®¡æ•°å™¨ã€åˆ†å¸ƒå¼é”</li>
</ul>
<hr/>
<h3 data-id="heading-24">ä¸ƒã€æ•°æ®åº“è®¾è®¡</h3>
<h4 data-id="heading-25">7.1 å·¥èµ„ä»£å‘è¡¨</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> salary_payment (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    employee_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‘˜å·¥ID'</span>,
    employee_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‘˜å·¥å§“å'</span>,
    account_number <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'é“¶è¡Œè´¦å·'</span>,
    account_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è´¦æˆ·åç§°'</span>,
    bank_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å¼€æˆ·è¡Œ'</span>,
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‘æ”¾é‡‘é¢'</span>,
    currency <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'CNY'</span> COMMENT <span class="hljs-string">'å¸ç§'</span>,
    payment_date DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‘æ”¾æ—¥æœŸ'</span>,
    remark <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) COMMENT <span class="hljs-string">'å¤‡æ³¨'</span>,
    status <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'PENDING'</span> COMMENT <span class="hljs-string">'çŠ¶æ€'</span>,
    transaction_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">'äº¤æ˜“ID'</span>,
    error_message <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">1000</span>) COMMENT <span class="hljs-string">'é”™è¯¯ä¿¡æ¯'</span>,
    create_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    update_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    INDEX idx_employee_id (employee_id),
    INDEX idx_status (status)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;
</code></pre>
<h4 data-id="heading-26">7.2 Spring Batchå…ƒè¡¨</h4>
<p>Spring Batchæ¡†æ¶ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹å…ƒè¡¨æ¥å­˜å‚¨Jobæ‰§è¡Œä¿¡æ¯ï¼š</p>
<ul>
<li><code>batch_job_instance</code> - Jobå®ä¾‹è¡¨</li>
<li><code>batch_job_execution</code> - Jobæ‰§è¡Œè¡¨</li>
<li><code>batch_job_execution_params</code> - Jobå‚æ•°è¡¨</li>
<li><code>batch_step_execution</code> - Stepæ‰§è¡Œè¡¨</li>
<li><code>batch_step_execution_context</code> - Stepä¸Šä¸‹æ–‡è¡¨</li>
</ul>
<hr/>
<h3 data-id="heading-27">å…«ã€REST APIè®¾è®¡</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/batch")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchJobController</span> {

    <span class="hljs-comment">// å¯åŠ¨Job</span>
    <span class="hljs-meta">@PostMapping("/start")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">startJob</span><span class="hljs-params">(
        <span class="hljs-meta">@RequestParam</span> String inputFile
    )</span> {
        <span class="hljs-type">JobParameters</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobParametersBuilder</span>()
            .addLong(<span class="hljs-string">"startTime"</span>, System.currentTimeMillis())
            .addString(<span class="hljs-string">"inputFile"</span>, inputFile)
            .toJobParameters();
        <span class="hljs-type">JobExecution</span> <span class="hljs-variable">execution</span> <span class="hljs-operator">=</span> jobLauncher.run(salaryPaymentJob, params);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    }

    <span class="hljs-comment">// è·å–JobçŠ¶æ€</span>
    <span class="hljs-meta">@GetMapping("/status/{jobExecutionId}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">getJobStatus</span><span class="hljs-params">(
        <span class="hljs-meta">@PathVariable</span> Long jobExecutionId
    )</span> {
        <span class="hljs-type">JobExecution</span> <span class="hljs-variable">execution</span> <span class="hljs-operator">=</span> jobRepository.getJobExecution(jobExecutionId);
        <span class="hljs-comment">// è¿”å›æ‰§è¡Œè¯¦æƒ…</span>
    }

    <span class="hljs-comment">// åœæ­¢Job</span>
    <span class="hljs-meta">@PostMapping("/stop/{jobExecutionId}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">stopJob</span><span class="hljs-params">(
        <span class="hljs-meta">@PathVariable</span> Long jobExecutionId
    )</span> {
        <span class="hljs-type">JobExecution</span> <span class="hljs-variable">execution</span> <span class="hljs-operator">=</span> jobRepository.getJobExecution(jobExecutionId);
        execution.stop();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    }

    <span class="hljs-comment">// è·å–ç»Ÿè®¡ä¿¡æ¯</span>
    <span class="hljs-meta">@GetMapping("/statistics")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">getStatistics</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è¿”å›æ€»æ•°ã€æˆåŠŸæ•°ã€å¤±è´¥æ•°ç­‰ç»Ÿè®¡</span>
    }

    <span class="hljs-comment">// å¥åº·æ£€æŸ¥</span>
    <span class="hljs-meta">@GetMapping("/health")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">health</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è¿”å›ç³»ç»Ÿå¥åº·çŠ¶æ€</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-28">ä¹ã€æ€§èƒ½ä¼˜åŒ–ä¸å¹¶è¡Œå¤„ç†</h3>
<p>å½“æ•°æ®é‡è¾¾åˆ°50ä¸‡ç”šè‡³æ›´å¤šæ—¶ï¼Œå•çº¿ç¨‹å¤„ç†å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚Spring Batchæä¾›äº†å¤šç§å¹¶è¡Œå¤„ç†æ–¹å¼ã€‚</p>
<h4 data-id="heading-29">9.1 å¤šçº¿ç¨‹å¹¶å‘å¤„ç†</h4>
<p>Spring Batchæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘å¤„ç†ï¼Œå¤§å¹…æå‡å¤„ç†æ•ˆç‡ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/316e23bab05d4fe596fe18021513b6c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=0BkUFvIWBtjJgwbQoXjOKq2s7MQ%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†å¤šçº¿ç¨‹å¹¶å‘å¤„ç†çš„å·¥ä½œåŸç†ï¼š</p>
<p><strong>æ ¸å¿ƒæœºåˆ¶ï¼š</strong></p>
<ul>
<li><strong>ä¸»çº¿ç¨‹</strong>ï¼šåˆ›å»ºçº¿ç¨‹æ± ï¼Œåˆ†é…ä»»åŠ¡</li>
<li><strong>å·¥ä½œçº¿ç¨‹</strong>ï¼šå¹¶å‘æ‰§è¡Œå¤šä¸ªStepæˆ–Chunk</li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šJobRepositoryä¿è¯çº¿ç¨‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†</li>
<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šä»»åŠ¡å‡åŒ€åˆ†é…åˆ°å„ä¸ªçº¿ç¨‹</li>
</ul>
<p><strong>é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> TaskExecutor <span class="hljs-title function_">taskExecutor</span><span class="hljs-params">()</span> {
    <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
    executor.setCorePoolSize(<span class="hljs-number">5</span>);
    executor.setMaxPoolSize(<span class="hljs-number">10</span>);
    executor.setQueueCapacity(<span class="hljs-number">100</span>);
    executor.setThreadNamePrefix(<span class="hljs-string">"salary-batch-"</span>);
    executor.initialize();
    <span class="hljs-keyword">return</span> executor;
}

<span class="hljs-comment">// åœ¨Stepä¸­ä½¿ç”¨</span>
.step(stepName)
.chunk(chunkSize)
.taskExecutor(taskExecutor())
.throttleLimit(<span class="hljs-number">10</span>)  <span class="hljs-comment">// é™åˆ¶å¹¶å‘æ•°</span>
.build();
</code></pre>
<h4 data-id="heading-30">9.2 åˆ†åŒºå¤„ç†ï¼ˆPartitioningï¼‰</h4>
<p>å¯¹äºè¶…å¤§æ•°æ®é›†ï¼Œå¯ä»¥ä½¿ç”¨åˆ†åŒºå¤„ç†å®ç°æ›´é«˜ç¨‹åº¦çš„å¹¶è¡Œï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f2a8815f01144f197a00ba5ad2c0802~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=9I%2BjxPUBFL%2B5Vi3qT9oI4Xub9sM%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†åˆ†åŒºå¤„ç†çš„æ¶æ„ï¼š</p>
<p><strong>æ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
<ul>
<li><strong>Master Step</strong>ï¼šè´Ÿè´£åˆ›å»ºå’Œç®¡ç†åˆ†åŒº</li>
<li><strong>Slave Step</strong>ï¼šæ¯ä¸ªåˆ†åŒºç‹¬ç«‹æ‰§è¡Œ</li>
<li><strong>Partitioner</strong>ï¼šå°†æ•°æ®åˆ†æˆå¤šä¸ªåˆ†åŒº</li>
<li><strong>TaskExecutor</strong>ï¼šçº¿ç¨‹æ± æ‰§è¡Œåˆ†åŒºä»»åŠ¡</li>
</ul>
<p><strong>é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Step <span class="hljs-title function_">masterStep</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> stepBuilderFactory.get(<span class="hljs-string">"masterStep"</span>)
        .partitioner(slaveStep().getName(), rangePartitioner(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
        .step(slaveStep())
        .gridSize(<span class="hljs-number">10</span>)  <span class="hljs-comment">// åˆ†æˆ10ä¸ªåˆ†åŒº</span>
        .taskExecutor(taskExecutor())
        .build();
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Partitioner <span class="hljs-title function_">rangePartitioner</span><span class="hljs-params">(<span class="hljs-type">int</span> min, <span class="hljs-type">int</span> max)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Partitioner</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Map&lt;String, ExecutionContext&gt; <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span> gridSize)</span> {
            Map&lt;String, ExecutionContext&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-type">int</span> <span class="hljs-variable">range</span> <span class="hljs-operator">=</span> (max - min) / gridSize;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; gridSize; i++) {
                <span class="hljs-type">ExecutionContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionContext</span>();
                context.putInt(<span class="hljs-string">"minValue"</span>, min + i * range);
                context.putInt(<span class="hljs-string">"maxValue"</span>, min + (i + <span class="hljs-number">1</span>) * range - <span class="hljs-number">1</span>);
                result.put(<span class="hljs-string">"partition"</span> + i, context);
            }
            <span class="hljs-keyword">return</span> result;
        }
    };
}
</code></pre>
<h4 data-id="heading-31">9.3 è°ƒä¼˜å‚æ•°</h4>






























<table><thead><tr><th>å‚æ•°</th><th>æ¨èå€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>chunkSize</td><td>1000-5000</td><td>æ ¹æ®è®°å½•å¤§å°è°ƒæ•´ï¼Œè¶Šå¤§ååé‡è¶Šé«˜ä½†å†…å­˜å ç”¨ä¹Ÿè¶Šå¤§</td></tr><tr><td>skipLimit</td><td>100-500</td><td>æ ¹æ®æ•°æ®è´¨é‡è®¾ç½®</td></tr><tr><td>retryLimit</td><td>3-5</td><td>è¿‡å¤šä¼šæµªè´¹æ—¶é—´ï¼Œè¿‡å°‘å¯èƒ½è¯¯åˆ¤æš‚æ—¶æ€§æ•…éšœ</td></tr><tr><td>çº¿ç¨‹æ± å¤§å°</td><td>CPUæ ¸å¿ƒæ•°*2</td><td>ç”¨äºå¤šçº¿ç¨‹å¤„ç†</td></tr></tbody></table>
<h4 data-id="heading-32">9.4 æ‰¹é‡å†™å…¥ä¼˜åŒ–</h4>
<p>ä½¿ç”¨JDBCæ‰¹é‡æ“ä½œä»£æ›¿å•æ¡æ’å…¥ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å•æ¡æ’å…¥ï¼ˆæ…¢ï¼‰</span>
<span class="hljs-keyword">for</span> (SalaryPayment p : payments) {
    jdbcTemplate.update(sql, p.getId(), p.getName(), ...);
}

<span class="hljs-comment">// æ‰¹é‡æ’å…¥ï¼ˆå¿«ï¼‰</span>
jdbcTemplate.batchUpdate(sql, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BatchPreparedStatementSetter</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setValues</span><span class="hljs-params">(PreparedStatement ps, <span class="hljs-type">int</span> i)</span> <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// è®¾ç½®å‚æ•°</span>
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getBatchSize</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> payments.size();
    }
});
</code></pre>
<h4 data-id="heading-33">9.5 ç´¢å¼•ä¼˜åŒ–</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_employee_id <span class="hljs-keyword">ON</span> salary_payment(employee_id);
<span class="hljs-keyword">CREATE</span> INDEX idx_status <span class="hljs-keyword">ON</span> salary_payment(status);
<span class="hljs-keyword">CREATE</span> INDEX idx_create_time <span class="hljs-keyword">ON</span> salary_payment(create_time);

<span class="hljs-comment">-- å¤åˆç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_status_employee <span class="hljs-keyword">ON</span> salary_payment(status, employee_id);
</code></pre>
<hr/>
<h3 data-id="heading-34">åã€å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-35">åœºæ™¯1ï¼šæœˆåº•å·¥èµ„ä»£å‘</h4>
<p>æŸå…¬å¸æœˆåº•éœ€è¦ä¸º50,000åå‘˜å·¥å‘æ”¾å·¥èµ„ï¼Œä½¿ç”¨Spring Batchï¼š</p>
<ul>
<li>è®¾ç½®chunkSize=1000ï¼Œåˆ†æˆ50ä¸ªChunkå¤„ç†</li>
<li>å‡è®¾ç¬¬23ä¸ªChunkä¸­ç¬¬23,456å·å‘˜å·¥é“¶è¡Œå¡å·é”™è¯¯</li>
<li>ç³»ç»Ÿé‡è¯•3æ¬¡åè·³è¿‡è¯¥è®°å½•</li>
<li>æœ€ç»ˆç»“æœï¼š49,999ç¬”æˆåŠŸï¼Œ1ç¬”è®°å½•åˆ°å¤±è´¥åˆ—è¡¨ä¾›åç»­å¤„ç†</li>
</ul>
<h4 data-id="heading-36">åœºæ™¯2ï¼šé“¶è¡Œå¯¹è´¦æ–‡ä»¶å¤„ç†</h4>
<p>é“¶è¡Œæä¾›100ä¸‡ç¬”äº¤æ˜“å¯¹è´¦æ–‡ä»¶ï¼š</p>
<ul>
<li>è®¾ç½®chunkSize=5000ï¼Œæé«˜å¤„ç†æ•ˆç‡</li>
<li>ä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘å¤„ç†ï¼ˆPartitioningï¼‰</li>
<li>å®Œæˆåç”Ÿæˆå¯¹è´¦å·®å¼‚æŠ¥å‘Š</li>
</ul>
<h4 data-id="heading-37">åœºæ™¯3ï¼šæ•°æ®æŠ¥è¡¨ç”Ÿæˆ</h4>
<p>æ¯å¤©å‡Œæ™¨ç”ŸæˆT+1äº¤æ˜“æŠ¥è¡¨ï¼š</p>
<ul>
<li>ä½¿ç”¨Spring Taskå®šæ—¶è°ƒåº¦</li>
<li>è¯»å–å½“æ—¥äº¤æ˜“æ•°æ®</li>
<li>ç”ŸæˆExcelæŠ¥è¡¨å¹¶å‘é€é‚®ä»¶</li>
</ul>
<hr/>
<h3 data-id="heading-38">åä¸€ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-39">Q1: Jobæ‰§è¡Œä¸€åŠæŒ‚äº†æ€ä¹ˆåŠï¼Ÿ</h4>
<p>Spring Batchæ”¯æŒJobé‡å¯ã€‚é€šè¿‡JobRepositoryè®°å½•çš„æ‰§è¡ŒçŠ¶æ€ï¼Œå¯ä»¥ä»ä¸Šæ¬¡å¤±è´¥çš„ä½ç½®ç»§ç»­æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-java" lang="java">.job(salaryPaymentJob)
    .allowStartIfComplete(<span class="hljs-literal">false</span>)  <span class="hljs-comment">// å·²å®Œæˆçš„Jobä¸é‡æ–°æ‰§è¡Œ</span>
    .restartable(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// å…è®¸é‡å¯</span>
</code></pre>
<h4 data-id="heading-40">Q2: å¦‚ä½•å®ç°å¹¶è¡Œå¤„ç†ï¼Ÿ</h4>
<p>ä½¿ç”¨Partitioningæ–¹å¼å®ç°å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Step <span class="hljs-title function_">masterStep</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> stepBuilderFactory.get(<span class="hljs-string">"masterStep"</span>)
        .partitioner(slaveStep().getName(), partitioner())
        .step(slaveStep())
        .gridSize(<span class="hljs-number">10</span>)  <span class="hljs-comment">// åˆ†æˆ10ä¸ªåˆ†åŒºå¹¶è¡Œå¤„ç†</span>
        .taskExecutor(taskExecutor())
        .build();
}
</code></pre>
<h4 data-id="heading-41">Q3: å¤„ç†å¤±è´¥çš„æ•°æ®å¦‚ä½•é‡è¯•ï¼Ÿ</h4>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é‡è¯•ï¼š</p>
<ol>
<li>æŸ¥è¯¢status='FAILED'çš„è®°å½•</li>
<li>ä¿®æ­£é”™è¯¯æ•°æ®</li>
<li>å°†statusæ”¹å›'PENDING'</li>
<li>é‡æ–°æ‰§è¡ŒJob</li>
</ol>
<hr/>
<h3 data-id="heading-42">åäºŒã€æ€»ç»“</h3>
<p>Spring Batchä½œä¸ºæˆç†Ÿçš„æ‰¹å¤„ç†æ¡†æ¶ï¼Œæä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆæ¥å¤„ç†å¤§è§„æ¨¡æ‰¹é‡æ•°æ®ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é“¶è¡Œå¯¹è´¦ã€æ¸…ç®—</li>
<li>å·¥èµ„ä»£å‘ã€æ‰¹é‡è½¬è´¦</li>
<li>æŠ¥è¡¨ç”Ÿæˆã€æ•°æ®å¯¼å‡º</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>åˆç†è®¾ç½®chunkSizeï¼Œå¹³è¡¡å†…å­˜å’Œæ€§èƒ½</li>
<li>é…ç½®åˆé€‚çš„Skipå’ŒRetryç­–ç•¥</li>
<li>åšå¥½å¤±è´¥è®°å½•çš„é‡å¤„ç†æœºåˆ¶</li>
<li>å®šæœŸæ¸…ç†Jobæ‰§è¡Œå†å²æ•°æ®</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python3åŸºç¡€ï¼šå‡½æ•°åŸºç¡€ï¼Œè§£é”æ¨¡å—åŒ–ç¼–ç¨‹æ–°æŠ€èƒ½]]></title>    <link>https://juejin.cn/post/7603563360329465898</link>    <guid>https://juejin.cn/post/7603563360329465898</guid>    <pubDate>2026-02-06T15:08:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360329465898" data-draft-id="7603563317040480319" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python3åŸºç¡€ï¼šå‡½æ•°åŸºç¡€ï¼Œè§£é”æ¨¡å—åŒ–ç¼–ç¨‹æ–°æŠ€èƒ½"/> <meta itemprop="keywords" content="åç«¯,Python"/> <meta itemprop="datePublished" content="2026-02-06T15:08:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ€’æ”¾å§å¾·å¾·"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python3åŸºç¡€ï¼šå‡½æ•°åŸºç¡€ï¼Œè§£é”æ¨¡å—åŒ–ç¼–ç¨‹æ–°æŠ€èƒ½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ€’æ”¾å§å¾·å¾·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:08:24.000Z" title="Fri Feb 06 2026 15:08:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»28åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬äº”é˜¶æ®µï¼šå‡½æ•°åŸºç¡€ï¼Œè§£é”æ¨¡å—åŒ–ç¼–ç¨‹æ–°æŠ€èƒ½</h2>
<blockquote>
<p>ğŸ˜„ç”Ÿå‘½ä¸æ¯ï¼Œå†™ä½œä¸æ­¢</p>
<p>ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°</p>
<p>ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·</p>
<p>ğŸ† <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">åšå®¢é¦–é¡µ</a> Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@æ€’æ”¾å§å¾·å¾·</a>Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">Toè®°å½•é¢†åœ°</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</a></p>
<p>ğŸŒåˆ†äº«å­¦ä¹ å¿ƒå¾—ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ æˆé•¿ï¼</p>
<p>ğŸ”¥è±†åŒ…AI</p>
</blockquote>
<p><em>è½¬å‘è¯·æºå¸¦ä½œè€…ä¿¡æ¯</em>Â  <strong>@æ€’æ”¾å§å¾·å¾·(æ˜é‡‘) @ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº(CSDN)</strong></p>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨ç¬¬å››é˜¶æ®µï¼Œæˆ‘ä»¬åƒé€äº†åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ã€é›†åˆå››å¤§å®¹å™¨ï¼Œè¿˜æŒæ¡äº†å­—ç¬¦ä¸²é«˜çº§æ“ä½œï¼Œèƒ½å¤Ÿé«˜æ•ˆå­˜å‚¨å’Œå¤„ç†å„ç±»æ•°æ®ã€‚ä½†åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸ä¼šé‡åˆ°é‡å¤ä½¿ç”¨çš„ä»£ç â€”â€”æ¯”å¦‚å¤šæ¬¡ç­›é€‰åˆ—è¡¨ä¸­çš„æœ‰æ•ˆæ•°æ®ã€åå¤è®¡ç®—ä¸åŒæ•°å€¼çš„æ±‚å’Œ/å¹³å‡å€¼ã€æ‰¹é‡æ ¼å¼åŒ–è¾“å‡ºå†…å®¹ï¼Œé€è¡Œç¼–å†™ä¸ä»…ç¹çï¼Œè¿˜å®¹æ˜“å‡ºé”™ã€éš¾ä»¥ä¿®æ”¹ã€‚</p>
<p>è€Œç¬¬äº”é˜¶æ®µæˆ‘ä»¬è¦é‡ç‚¹æ”»å…‹çš„ã€Œå‡½æ•°åŸºç¡€ã€ï¼Œå°±æ˜¯è§£å†³è¿™ä¸€é—®é¢˜çš„â€œç¥å™¨â€ã€‚å‡½æ•°çš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>ä»£ç å¤ç”¨ä¸æ¨¡å—åŒ–</strong>ï¼šå°†é‡å¤é€»è¾‘å°è£…æˆä¸€ä¸ªâ€œä»£ç æ¨¡å—â€ï¼Œä¸€æ¬¡å®šä¹‰ã€å¤šæ¬¡è°ƒç”¨ï¼Œæ—¢èƒ½å‡å°‘é‡å¤ä»£ç é‡ï¼Œè¿˜èƒ½è®©ä»£ç ç»“æ„æ›´æ¸…æ™°ã€æ›´æ˜“ç»´æŠ¤ã€‚è¿™ä¹Ÿæ˜¯Pythonç¼–ç¨‹ä»â€œé›¶æ•£ä»£ç â€èµ°å‘â€œè§„èŒƒç¼–ç¨‹â€çš„å…³é”®ä¸€æ­¥ï¼Œä¸ºåç»­å­¦ä¹ å‡½æ•°è¿›é˜¶ã€é¢å‘å¯¹è±¡ã€æ¨¡å—ä¸åŒ…æ‰“ä¸‹åšå®åŸºç¡€ã€‚</p>
<p>æœ¬æ¬¡ç¬¬äº”é˜¶æ®µï¼Œæˆ‘ä»¬å°†ä¸¥æ ¼æŒ‰ç…§ã€Œå‡½æ•°å®šä¹‰ä¸è°ƒç”¨â†’å‡½æ•°å‚æ•°â†’å‡½æ•°è¿”å›å€¼â†’å±€éƒ¨å˜é‡ä¸å…¨å±€å˜é‡â†’åŒ¿åå‡½æ•°â†’å‡½æ•°åµŒå¥—ä¸é€’å½’ï¼ˆåŸºç¡€ç‰ˆï¼‰ã€çš„èŠ‚å¥ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½æ­é…å¯ç›´æ¥å¤åˆ¶è¿è¡Œçš„ä»£ç ç¤ºä¾‹ã€é€šä¿—è§£æå’Œæ–°æ‰‹é¿å‘æŠ€å·§ï¼Œå…¨ç¨‹è´´åˆæ–°æ‰‹å­¦ä¹ èŠ‚å¥ï¼Œè·Ÿç€æ•²ä»£ç ã€ç»ƒæ¡ˆä¾‹ï¼Œå°±èƒ½è½»æ¾åƒé€å‡½æ•°åŸºç¡€ï½</p>
<h3 data-id="heading-2">1ã€å‡½æ•°çš„å®šä¹‰ä¸è°ƒç”¨ï¼šä»â€œé›¶æ•£ä»£ç â€åˆ°â€œæ¨¡å—åŒ–å°è£…â€</h3>
<p>ç®€å•æ¥è¯´ï¼Œå‡½æ•°å°±æ˜¯â€œæå‰å†™å¥½çš„ã€å¯é‡å¤è°ƒç”¨çš„ä»£ç å—â€â€”â€”å°±åƒå·¥å‚é‡Œçš„â€œæ ‡å‡†åŒ–ç”Ÿäº§çº¿â€ï¼Œæå‰è®¾å®šå¥½æµç¨‹ï¼ˆä»£ç é€»è¾‘ï¼‰ï¼Œæ¯æ¬¡æŠ•å…¥åŸææ–™ï¼ˆå‚æ•°ï¼‰ï¼Œå°±èƒ½äº§å‡ºå¯¹åº”äº§å“ï¼ˆç»“æœï¼‰ã€‚Pythonä¸­å®šä¹‰å‡½æ•°å¿…é¡»ä½¿ç”¨ <code>def</code> å…³é”®å­—ï¼Œè¯­æ³•å›ºå®šï¼Œæ–°æ‰‹åªéœ€ç‰¢è®°æ¨¡æ¿å³å¯ã€‚</p>
<h4 data-id="heading-3">1.1 å‡½æ•°çš„å®šä¹‰ï¼ˆå›ºå®šæ¨¡æ¿ï¼‰</h4>
<p>å®šä¹‰å‡½æ•°çš„æ ¸å¿ƒè¯­æ³•ï¼ˆæ–°æ‰‹å¿…èƒŒï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å‡½æ•°å®šä¹‰æ¨¡æ¿</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">å‡½æ•°å</span>(<span class="hljs-params">å‚æ•°åˆ—è¡¨</span>):
    <span class="hljs-string">"""å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼Œç”¨äºè¯´æ˜å‡½æ•°åŠŸèƒ½ã€å‚æ•°ã€è¿”å›å€¼ï¼‰"""</span>
    <span class="hljs-comment"># å‡½æ•°ä½“ï¼ˆè¦æ‰§è¡Œçš„ä»£ç é€»è¾‘ï¼‰</span>
    ä»£ç å—
    <span class="hljs-comment"># è¿”å›å€¼ï¼ˆå¯é€‰ï¼Œç”¨returnè¯­å¥ï¼Œåç»­è¯¦è§£ï¼‰</span>
</code></pre>
<p>è§£ææ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ï¼Œæ–°æ‰‹ä¸€çœ‹å°±æ‡‚ï¼š</p>
<ul>
<li><code>def</code>ï¼šå®šä¹‰å‡½æ•°çš„å…³é”®å­—ï¼Œå¿…é¡»æ”¾åœ¨æœ€å‰é¢ï¼ˆç›¸å½“äºâ€œå£°æ˜è¿™æ˜¯ä¸€ä¸ªå‡½æ•°â€ï¼‰ï¼›</li>
<li>å‡½æ•°åï¼šéµå¾ªå˜é‡å‘½åè§„èŒƒï¼ˆå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ç»„æˆï¼Œä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼Œä¸èƒ½ç”¨Pythonå…³é”®å­—ï¼Œå¦‚defã€ifï¼‰ï¼Œå»ºè®®è§åçŸ¥æ„ï¼ˆæ¯”å¦‚è®¡ç®—æ±‚å’Œçš„å‡½æ•°å«sum_numsï¼Œä¸€ç›®äº†ç„¶ï¼‰ï¼›</li>
<li>å‚æ•°åˆ—è¡¨ï¼šæ‹¬å·å†…çš„å†…å®¹ï¼Œå¯é€‰ï¼ˆæ— å‚æ•°åˆ™æ‹¬å·ä¸ºç©ºï¼‰ï¼Œç”¨äºæ¥æ”¶å¤–éƒ¨ä¼ å…¥çš„â€œåŸææ–™â€ï¼Œåç»­è¯¦ç»†è®²è§£ï¼›</li>
<li>æ–‡æ¡£å­—ç¬¦ä¸²ï¼šç”¨ä¸‰å¼•å·åŒ…è£¹ï¼Œå¯é€‰ï¼Œç”¨äºè¯´æ˜å‡½æ•°åŠŸèƒ½ï¼Œæ–¹ä¾¿è‡ªå·±å’Œä»–äººæŸ¥çœ‹ï¼ˆè°ƒç”¨æ—¶ç”¨help(å‡½æ•°å)å¯æŸ¥çœ‹ï¼‰ï¼›</li>
<li>å‡½æ•°ä½“ï¼šç¼©è¿›çš„ä»£ç å—ï¼ˆæ¨è4ä¸ªç©ºæ ¼ï¼Œå’Œifã€forå¾ªç¯ç¼©è¿›ä¸€è‡´ï¼‰ï¼Œæ˜¯å‡½æ•°çš„æ ¸å¿ƒé€»è¾‘ï¼Œè°ƒç”¨å‡½æ•°æ—¶ä¼šæ‰§è¡Œè¿™é‡Œçš„ä»£ç ï¼›</li>
<li>è¿”å›å€¼ï¼šç”¨returnè¯­å¥ï¼Œå¯é€‰ï¼Œç”¨äºå°†å‡½æ•°çš„æ‰§è¡Œç»“æœè¿”å›ç»™è°ƒç”¨è€…ï¼Œæ²¡æœ‰returnåˆ™é»˜è®¤è¿”å›Noneã€‚</li>
</ul>
<p>æ–°æ‰‹å…¥é—¨ç¤ºä¾‹ï¼ˆä¸¤ä¸ªåŸºç¡€å‡½æ•°ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šæ— å‚æ•°ã€æ— è¿”å›å€¼çš„å‡½æ•°ï¼ˆä»…æ‰§è¡Œç®€å•æ“ä½œï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>():
    <span class="hljs-string">"""æ— å‚æ•°å‡½æ•°ï¼Œç”¨äºè¾“å‡ºé—®å€™è¯­"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, Python! æ¬¢è¿å­¦ä¹ ç¬¬äº”é˜¶æ®µå‡½æ•°åŸºç¡€ï½"</span>)

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šæœ‰å‚æ•°ã€æ— è¿”å›å€¼çš„å‡½æ•°ï¼ˆæ¥æ”¶å‚æ•°ï¼Œæ‰§è¡Œæ“ä½œï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_name</span>(<span class="hljs-params">name</span>):
    <span class="hljs-string">"""æœ‰å‚æ•°å‡½æ•°ï¼Œç”¨äºè¾“å‡ºä¼ å…¥çš„å§“å
    å‚æ•°ï¼šname -- è¦è¾“å‡ºçš„å§“åï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æˆ‘çš„åå­—æ˜¯ï¼š<span class="hljs-subst">{name}</span>"</span>)

<span class="hljs-comment"># ç¤ºä¾‹3ï¼šæœ‰å‚æ•°ã€æœ‰ç®€å•é€»è¾‘çš„å‡½æ•°ï¼ˆè®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œï¼Œæš‚æ—¶ä¸è¿”å›ç»“æœï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-string">"""è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œï¼Œå¹¶æ‰“å°ç»“æœ
    å‚æ•°ï¼ša -- ç¬¬ä¸€ä¸ªæ•°å­—ï¼Œb -- ç¬¬äºŒä¸ªæ•°å­—
    """</span>
    result = a + b
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{a}</span> + <span class="hljs-subst">{b}</span> = <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<h4 data-id="heading-4">1.2 å‡½æ•°çš„è°ƒç”¨ï¼ˆæ ¸å¿ƒï¼šå®šä¹‰åå¿…é¡»è°ƒç”¨æ‰ä¼šæ‰§è¡Œï¼‰</h4>
<p>å‡½æ•°å®šä¹‰åï¼Œåªæ˜¯â€œå†™å¥½äº†ç”Ÿäº§çº¿â€ï¼Œä¸ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œå¿…é¡»é€šè¿‡ã€Œå‡½æ•°å(å‚æ•°)ã€çš„æ–¹å¼è°ƒç”¨ï¼Œæ‰èƒ½è§¦å‘å‡½æ•°ä½“çš„æ‰§è¡Œâ€”â€”è¿™æ˜¯æ–°æ‰‹æœ€å®¹æ˜“å¿½ç•¥çš„ç‚¹ï¼è°ƒç”¨è¯­æ³•å’Œå‚æ•°ä¼ é€’ï¼Œè¦å’Œå‡½æ•°å®šä¹‰æ—¶çš„å‚æ•°åˆ—è¡¨å¯¹åº”ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è°ƒç”¨ç¤ºä¾‹1ï¼šè°ƒç”¨æ— å‚æ•°å‡½æ•°ï¼ˆæ‹¬å·ä¸ºç©ºï¼Œæ— éœ€ä¼ å‚ï¼‰</span>
greet()  <span class="hljs-comment"># è¾“å‡ºï¼šHello, Python! æ¬¢è¿å­¦ä¹ ç¬¬äº”é˜¶æ®µå‡½æ•°åŸºç¡€ï½</span>

<span class="hljs-comment"># è°ƒç”¨ç¤ºä¾‹2ï¼šè°ƒç”¨æœ‰ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼ˆå¿…é¡»ä¼ å…¥1ä¸ªå‚æ•°ï¼Œä¸å®šä¹‰æ—¶çš„nameå¯¹åº”ï¼‰</span>
print_name(<span class="hljs-string">"å¼ ä¸‰"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šæˆ‘çš„åå­—æ˜¯ï¼šå¼ ä¸‰</span>
print_name(<span class="hljs-string">"æå››"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šæˆ‘çš„åå­—æ˜¯ï¼šæå››</span>

<span class="hljs-comment"># è°ƒç”¨ç¤ºä¾‹3ï¼šè°ƒç”¨æœ‰ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼ˆå¿…é¡»ä¼ å…¥2ä¸ªå‚æ•°ï¼Œä¸å®šä¹‰æ—¶çš„aã€bå¯¹åº”ï¼‰</span>
add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š3 + 5 = 8</span>
add(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š10 + 20 = 30</span>

<span class="hljs-comment"># æŸ¥çœ‹å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆæ–°æ‰‹å¿…å¤‡ï¼Œå¿˜è®°å‡½æ•°åŠŸèƒ½æ—¶ä½¿ç”¨ï¼‰</span>
<span class="hljs-built_in">help</span>(print_name)  <span class="hljs-comment"># è¾“å‡ºå‡½æ•°çš„æ–‡æ¡£è¯´æ˜ï¼ŒåŒ…å«å‚æ•°è§£é‡Š</span>
</code></pre>
<h4 data-id="heading-5">3. æ–°æ‰‹é¿å‘æŒ‡å—ï¼ˆå¿…çœ‹ï¼‰</h4>
<ul>
<li>é¿å‘1ï¼šå‡½æ•°åä¸èƒ½ç”¨Pythonå…³é”®å­—ï¼ˆå¦‚defã€ifã€forã€listï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼›</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">if</span>():
  File <span class="hljs-string">"&lt;stdin&gt;"</span>, line <span class="hljs-number">1</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">if</span>():
        ^^
SyntaxError: invalid synta
</code></pre>
<ul>
<li>é¿å‘2ï¼šå‡½æ•°ä½“å¿…é¡»ç¼©è¿›ï¼ˆ4ä¸ªç©ºæ ¼ï¼‰ï¼Œä¸ç¼©è¿›ä¼šè¢«è§†ä¸ºæ™®é€šä»£ç ï¼Œä¸”æŠ¥é”™ï¼›</li>
<li>é¿å‘3ï¼šå®šä¹‰å‡½æ•°åï¼Œå¿…é¡»è°ƒç”¨æ‰ä¼šæ‰§è¡Œï¼Œåªå®šä¹‰ä¸è°ƒç”¨ï¼Œå‡½æ•°ä½“çš„ä»£ç æ°¸è¿œä¸ä¼šè¿è¡Œï¼›</li>
<li>é¿å‘4ï¼šè°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¸ªæ•°ã€ç±»å‹ï¼Œè¦å’Œå‡½æ•°å®šä¹‰æ—¶çš„å‚æ•°åˆ—è¡¨å¯¹åº”ï¼ˆæ¯”å¦‚add(a,b)å¿…é¡»ä¼ 2ä¸ªå‚æ•°ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-6">2 å‡½æ•°å‚æ•°ï¼šçµæ´»ä¼ é€’â€œåŸææ–™â€ï¼Œé€‚é…ä¸åŒåœºæ™¯</h3>
<p>å‡½æ•°çš„å‚æ•°ï¼Œå°±æ˜¯å‡½æ•°ä¸å¤–éƒ¨äº¤äº’çš„â€œæ¥å£â€â€”â€”é€šè¿‡å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å‘å‡½æ•°ä¼ é€’ä¸åŒçš„æ•°æ®ï¼Œè®©åŒä¸€ä¸ªå‡½æ•°å®ç°ä¸åŒçš„åŠŸèƒ½ï¼ˆæ¯”å¦‚add(a,b)ï¼Œä¼ å…¥3å’Œ5å¾—åˆ°8ï¼Œä¼ å…¥10å’Œ20å¾—åˆ°30ï¼‰ã€‚</p>
<p>æŒ‰ç…§ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬é‡ç‚¹æŒæ¡4ç§æ ¸å¿ƒå‚æ•°ç±»å‹ï¼ŒæŒ‰â€œåŸºç¡€â†’è¿›é˜¶â€çš„é¡ºåºè®²è§£ï¼Œæ¯ä¸ªç±»å‹é…ä»£ç ã€è§£æåŒºåˆ«ï¼Œæ–°æ‰‹å¯é€æ­¥æŒæ¡ï¼š<strong>ä½ç½®å‚æ•°ã€å…³é”®å­—å‚æ•°ã€é»˜è®¤å‚æ•°ã€å¯å˜å‚æ•°</strong>ï¼Œç»“åˆå‚è€ƒèµ„æ–™ä¸­çš„å‚æ•°ç”¨æ³•ï¼Œç®€åŒ–é€‚é…æ–°æ‰‹å­¦ä¹ ã€‚</p>
<h4 data-id="heading-7">2.1 ä½ç½®å‚æ•°ï¼ˆæœ€åŸºç¡€ã€æœ€å¸¸ç”¨ï¼‰</h4>
<p>ä½ç½®å‚æ•°ï¼Œä¹Ÿå«â€œå¿…é€‰å‚æ•°â€ï¼Œæ˜¯æœ€åŸºç¡€çš„å‚æ•°ç±»å‹ï¼Œç‰¹ç‚¹æ˜¯ï¼š<strong>è°ƒç”¨æ—¶å¿…é¡»æŒ‰å‡½æ•°å®šä¹‰çš„å‚æ•°é¡ºåºä¼ å‚ï¼Œå‚æ•°ä¸ªæ•°å¿…é¡»ä¸€è‡´</strong>ï¼Œç¼ºä¸€ä¸å¯ã€å¤šä¸€ä¸å¯ï¼Œå°±åƒâ€œæŒ‰é¡ºåºæ’é˜Ÿâ€ä¸€æ ·ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªè®¡ç®—ä¸¤ä¸ªæ•°å·®å€¼çš„å‡½æ•°ï¼ˆä½ç½®å‚æ•°ç¤ºä¾‹ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-string">"""è®¡ç®—a - bçš„å·®å€¼ï¼Œaå’Œbéƒ½æ˜¯ä½ç½®å‚æ•°"""</span>
    result = a - b
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{a}</span> - <span class="hljs-subst">{b}</span> = <span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-comment"># æ­£ç¡®è°ƒç”¨ï¼šæŒ‰å‚æ•°é¡ºåºä¼ å‚ï¼ˆa=10ï¼Œb=5ï¼‰</span>
subtract(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š10 - 5 = 5</span>

<span class="hljs-comment"># æ­£ç¡®è°ƒç”¨ï¼šæŒ‰å‚æ•°é¡ºåºä¼ å‚ï¼ˆa=20ï¼Œb=8ï¼‰</span>
subtract(<span class="hljs-number">20</span>, <span class="hljs-number">8</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š20 - 8 = 12</span>

<span class="hljs-comment"># é”™è¯¯è°ƒç”¨1ï¼šå‚æ•°ä¸ªæ•°ä¸è¶³ï¼ˆå°‘ä¼ 1ä¸ªå‚æ•°ï¼‰</span>
<span class="hljs-comment"># subtract(10)  # æŠ¥é”™ï¼šmissing 1 required positional argument: 'b'</span>

<span class="hljs-comment"># é”™è¯¯è°ƒç”¨2ï¼šå‚æ•°ä¸ªæ•°è¿‡å¤šï¼ˆå¤šä¼ 1ä¸ªå‚æ•°ï¼‰</span>
<span class="hljs-comment"># subtract(10, 5, 3)  # æŠ¥é”™ï¼štakes 2 positional arguments but 3 were given</span>

<span class="hljs-comment"># é”™è¯¯è°ƒç”¨3ï¼šå‚æ•°é¡ºåºé¢ å€’ï¼ˆå¾—åˆ°é”™è¯¯ç»“æœï¼Œä¸æŠ¥é”™ä½†é€»è¾‘é”™è¯¯ï¼‰</span>
subtract(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š5 - 10 = -5ï¼ˆé¡ºåºé”™ï¼Œç»“æœé”™ï¼‰</span>
</code></pre>
<p>æ ¸å¿ƒæ€»ç»“ï¼šä½ç½®å‚æ•°â€œæŒ‰é¡ºåºã€å®šä¸ªæ•°â€ï¼Œè°ƒç”¨æ—¶å¿…é¡»ä¸¥æ ¼åŒ¹é…å‡½æ•°å®šä¹‰çš„å‚æ•°é¡ºåºå’Œä¸ªæ•°ï¼Œæ–°æ‰‹ä¼˜å…ˆæŒæ¡è¿™ç§å‚æ•°ç”¨æ³•ã€‚</p>
<h4 data-id="heading-8">2.2 å…³é”®å­—å‚æ•°ï¼ˆæ›´çµæ´»ï¼Œæ— éœ€è®°é¡ºåºï¼‰</h4>
<p>å…³é”®å­—å‚æ•°ï¼Œæ˜¯åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œé€šè¿‡ã€Œå‚æ•°å=å‚æ•°å€¼ã€çš„æ–¹å¼ä¼ å‚ï¼Œç‰¹ç‚¹æ˜¯ï¼š<strong>æ— éœ€æŒ‰å‚æ•°é¡ºåºä¼ å‚ï¼Œåªè¦å‚æ•°åæ­£ç¡®ï¼Œå°±èƒ½åŒ¹é…åˆ°å¯¹åº”çš„å‚æ•°</strong>ï¼Œé€‚åˆå‚æ•°è¾ƒå¤šçš„åœºæ™¯ï¼Œé¿å…è®°æ··é¡ºåºã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¤ç”¨ä¸Šé¢çš„subtractå‡½æ•°ï¼ˆaå’Œbæ˜¯ä½ç½®å‚æ•°ï¼Œè°ƒç”¨æ—¶å¯æ”¹ç”¨å…³é”®å­—å‚æ•°ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">a, b</span>):
    result = a - b
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{a}</span> - <span class="hljs-subst">{b}</span> = <span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-comment"># æ­£ç¡®è°ƒç”¨1ï¼šå…¨éƒ¨ç”¨å…³é”®å­—å‚æ•°ï¼ˆé¡ºåºå¯é¢ å€’ï¼‰</span>
subtract(a=<span class="hljs-number">10</span>, b=<span class="hljs-number">5</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š10 - 5 = 5</span>
subtract(b=<span class="hljs-number">5</span>, a=<span class="hljs-number">10</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š10 - 5 = 5ï¼ˆé¡ºåºé¢ å€’ï¼Œç»“æœæ­£ç¡®ï¼‰</span>

<span class="hljs-comment"># æ­£ç¡®è°ƒç”¨2ï¼šä½ç½®å‚æ•°å’Œå…³é”®å­—å‚æ•°æ··åˆä½¿ç”¨ï¼ˆé‡ç‚¹ï¼šä½ç½®å‚æ•°å¿…é¡»åœ¨å…³é”®å­—å‚æ•°å‰é¢ï¼‰</span>
subtract(<span class="hljs-number">10</span>, b=<span class="hljs-number">5</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š10 - 5 = 5ï¼ˆaç”¨ä½ç½®å‚æ•°ï¼Œbç”¨å…³é”®å­—å‚æ•°ï¼‰</span>

<span class="hljs-comment"># é”™è¯¯è°ƒç”¨ï¼šå…³é”®å­—å‚æ•°åœ¨ä½ç½®å‚æ•°å‰é¢ï¼ˆé¡ºåºé”™è¯¯ï¼‰</span>
<span class="hljs-comment"># subtract(a=10, 5)  # æŠ¥é”™ï¼špositional argument follows keyword argument</span>
</code></pre>
<p>æ ¸å¿ƒæ€»ç»“ï¼šå…³é”®å­—å‚æ•°â€œæŒ‰åå­—ã€ä¸æŒ‰é¡ºåºâ€ï¼Œæ··åˆä½¿ç”¨æ—¶ï¼Œä½ç½®å‚æ•°å¿…é¡»åœ¨å…³é”®å­—å‚æ•°å‰é¢ï¼Œæ–°æ‰‹å¯åœ¨å‚æ•°è¾ƒå¤šæ—¶ä¼˜å…ˆä½¿ç”¨ï¼Œå‡å°‘å‡ºé”™ã€‚</p>
<h4 data-id="heading-9">2.3 é»˜è®¤å‚æ•°ï¼ˆå¯é€‰ä¼ å‚ï¼Œç®€åŒ–è°ƒç”¨ï¼‰</h4>
<p>é»˜è®¤å‚æ•°ï¼Œæ˜¯åœ¨å‡½æ•°å®šä¹‰æ—¶ï¼Œç»™å‚æ•°æŒ‡å®šä¸€ä¸ªâ€œé»˜è®¤å€¼â€ï¼Œç‰¹ç‚¹æ˜¯ï¼š<strong>è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¯ä¼ å‚ï¼ˆè¦†ç›–é»˜è®¤å€¼ï¼‰ï¼Œä¹Ÿå¯ä¸ä¼ å‚ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰</strong>ï¼Œé€‚åˆå‚æ•°å€¼ç»å¸¸é‡å¤çš„åœºæ™¯ï¼Œèƒ½ç®€åŒ–å‡½æ•°è°ƒç”¨ã€‚</p>
<p>é‡ç‚¹è§„åˆ™ï¼šé»˜è®¤å‚æ•°å¿…é¡»æ”¾åœ¨<strong>ä½ç½®å‚æ•°çš„åé¢</strong>ï¼ˆå¦åˆ™æŠ¥é”™ï¼‰ï¼Œå‚è€ƒèµ„æ–™ä¸­é»˜è®¤å‚æ•°çš„ç”¨æ³•ï¼Œé€‚é…æ–°æ‰‹ç¼–å†™ç®€å•æ¡ˆä¾‹ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªè®¡ç®—æŠ˜æ‰£ä»·çš„å‡½æ•°ï¼ˆé»˜è®¤å‚æ•°ç¤ºä¾‹ï¼‰</span>
<span class="hljs-comment"># priceï¼šä½ç½®å‚æ•°ï¼ˆå¿…ä¼ ï¼‰ï¼Œdiscountï¼šé»˜è®¤å‚æ•°ï¼ˆé»˜è®¤0.9ï¼Œå³9æŠ˜ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_discount</span>(<span class="hljs-params">price, discount=<span class="hljs-number">0.9</span></span>):
    <span class="hljs-string">"""è®¡ç®—å•†å“æŠ˜æ‰£ä»·
    å‚æ•°ï¼šprice -- å•†å“åŸä»·ï¼ˆå¿…ä¼ ï¼Œä½ç½®å‚æ•°ï¼‰
          discount -- æŠ˜æ‰£ç‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤0.9ï¼Œå³9æŠ˜ï¼‰
    """</span>
    final_price = price * discount
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å•†å“åŸä»·ï¼š<span class="hljs-subst">{price}</span>å…ƒï¼ŒæŠ˜æ‰£ç‡ï¼š<span class="hljs-subst">{discount}</span>ï¼ŒæŠ˜åä»·ï¼š<span class="hljs-subst">{final_price}</span>å…ƒ"</span>)

<span class="hljs-comment"># è°ƒç”¨1ï¼šä¸ä¼ é»˜è®¤å‚æ•°ï¼ˆä½¿ç”¨é»˜è®¤æŠ˜æ‰£0.9ï¼‰</span>
calculate_discount(<span class="hljs-number">100</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šå•†å“åŸä»·ï¼š100å…ƒï¼ŒæŠ˜æ‰£ç‡ï¼š0.9ï¼ŒæŠ˜åä»·ï¼š90.0å…ƒ</span>

<span class="hljs-comment"># è°ƒç”¨2ï¼šä¼ é»˜è®¤å‚æ•°ï¼ˆè¦†ç›–é»˜è®¤å€¼ï¼Œæ¯”å¦‚8æŠ˜ï¼‰</span>
calculate_discount(<span class="hljs-number">100</span>, <span class="hljs-number">0.8</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šæŠ˜åä»·ï¼š80.0å…ƒ</span>

<span class="hljs-comment"># è°ƒç”¨3ï¼šç”¨å…³é”®å­—å‚æ•°ä¼ é»˜è®¤å‚æ•°ï¼ˆæ›´æ¸…æ™°ï¼‰</span>
calculate_discount(<span class="hljs-number">100</span>, discount=<span class="hljs-number">0.7</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šæŠ˜åä»·ï¼š70.0å…ƒ</span>

<span class="hljs-comment"># é”™è¯¯å®šä¹‰ï¼šé»˜è®¤å‚æ•°æ”¾åœ¨ä½ç½®å‚æ•°å‰é¢ï¼ˆé¡ºåºé”™è¯¯ï¼‰</span>
<span class="hljs-comment"># def calculate_discount(discount=0.9, price):  # æŠ¥é”™ï¼šnon-default argument follows default argument</span>
</code></pre>
<p>æ–°æ‰‹é¿å‘ï¼šé»˜è®¤å‚æ•°çš„é»˜è®¤å€¼ï¼Œæœ€å¥½æ˜¯ä¸å¯å˜ç±»å‹ï¼ˆå¦‚æ•°å­—ã€å­—ç¬¦ä¸²ã€å…ƒç»„ï¼‰ï¼Œä¸è¦ç”¨åˆ—è¡¨ã€å­—å…¸ç­‰å¯å˜ç±»å‹ï¼ˆä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é”™è¯¯ï¼Œåç»­è¿›é˜¶å†è¯¦ç»†è®²è§£ï¼‰ã€‚</p>
<h4 data-id="heading-10">2.4 å¯å˜å‚æ•°ï¼ˆä¸å®šä¸ªæ•°ï¼Œçµæ´»é€‚é…ï¼‰</h4>
<p>å¯å˜å‚æ•°ï¼Œæ˜¯æŒ‡å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¸ªæ•°å¯ä»¥ä»»æ„ï¼ˆ0ä¸ªã€1ä¸ªã€å¤šä¸ªï¼‰ï¼Œé€‚åˆå‚æ•°ä¸ªæ•°ä¸ç¡®å®šçš„åœºæ™¯ï¼ˆæ¯”å¦‚è®¡ç®—å¤šä¸ªæ•°çš„æ€»å’Œã€æ‰“å°å¤šä¸ªä¿¡æ¯ï¼‰ã€‚Pythonä¸­å¸¸ç”¨ä¸¤ç§å¯å˜å‚æ•°ï¼š</p>
<ul>
<li><code>*args</code>ï¼šæ¥æ”¶ä»»æ„ä¸ªæ•°çš„<strong>ä½ç½®å‚æ•°</strong>ï¼Œä¼ å…¥åä¼šè‡ªåŠ¨æ‰“åŒ…æˆä¸€ä¸ª<strong>å…ƒç»„</strong>ï¼›</li>
<li><code>**kwargs</code>ï¼šæ¥æ”¶ä»»æ„ä¸ªæ•°çš„<strong>å…³é”®å­—å‚æ•°</strong>ï¼Œä¼ å…¥åä¼šè‡ªåŠ¨æ‰“åŒ…æˆä¸€ä¸ª<strong>å­—å…¸</strong>ã€‚</li>
</ul>
<p>é‡ç‚¹ï¼š<code>*args</code> å’Œ <code>**kwargs</code> åªæ˜¯çº¦å®šä¿—æˆçš„åå­—ï¼Œargså’Œkwargså¯ä»¥æ¢æˆå…¶ä»–åå­—ï¼Œä½†æ˜Ÿå·*å’Œ**ä¸èƒ½å°‘ï¼Œå‚è€ƒèµ„æ–™ä¸­å¯å˜å‚æ•°çš„æ¡ˆä¾‹ï¼Œç®€åŒ–åé€‚é…æ–°æ‰‹ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼š*args æ¥æ”¶ä»»æ„ä¸ªæ•°çš„ä½ç½®å‚æ•°ï¼ˆè®¡ç®—å¤šä¸ªæ•°çš„æ€»å’Œï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">sum_nums</span>(<span class="hljs-params">*args</span>):
    <span class="hljs-string">"""è®¡ç®—ä»»æ„ä¸ªæ•°çš„æ€»å’Œï¼Œ*argsæ¥æ”¶ä½ç½®å‚æ•°ï¼Œæ‰“åŒ…æˆå…ƒç»„"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ä¼ å…¥çš„å‚æ•°æ‰“åŒ…æˆå…ƒç»„ï¼š"</span>, args)  <span class="hljs-comment"># æŸ¥çœ‹argsçš„ç±»å‹ï¼ˆå…ƒç»„ï¼‰</span>
    total = <span class="hljs-built_in">sum</span>(args)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ‰€æœ‰æ•°çš„æ€»å’Œï¼š<span class="hljs-subst">{total}</span>"</span>)

<span class="hljs-comment"># è°ƒç”¨ï¼šå¯ä¼ 0ä¸ªã€1ä¸ªã€å¤šä¸ªå‚æ•°</span>
sum_nums()  <span class="hljs-comment"># è¾“å‡ºï¼šæ€»å’Œï¼š0ï¼ˆargsä¸ºç©ºå…ƒç»„ï¼‰</span>
sum_nums(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šæ€»å’Œï¼š6ï¼ˆargs=(1,2,3)ï¼‰</span>
sum_nums(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šæ€»å’Œï¼š100ï¼ˆargs=(10,20,30,40)ï¼‰</span>

<span class="hljs-comment"># ç¤ºä¾‹2ï¼š**kwargs æ¥æ”¶ä»»æ„ä¸ªæ•°çš„å…³é”®å­—å‚æ•°ï¼ˆæ‰“å°ç”¨æˆ·ä¿¡æ¯ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_user_info</span>(<span class="hljs-params">**kwargs</span>):
    <span class="hljs-string">"""æ‰“å°ç”¨æˆ·ä¿¡æ¯ï¼Œ**kwargsæ¥æ”¶å…³é”®å­—å‚æ•°ï¼Œæ‰“åŒ…æˆå­—å…¸"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ä¼ å…¥çš„å‚æ•°æ‰“åŒ…æˆå­—å…¸ï¼š"</span>, kwargs)  <span class="hljs-comment"># æŸ¥çœ‹kwargsçš„ç±»å‹ï¼ˆå­—å…¸ï¼‰</span>
    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> kwargs.items():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{key}</span>ï¼š<span class="hljs-subst">{value}</span>"</span>)

<span class="hljs-comment"># è°ƒç”¨ï¼šå¯ä¼ 0ä¸ªã€1ä¸ªã€å¤šä¸ªå…³é”®å­—å‚æ•°</span>
print_user_info(name=<span class="hljs-string">"å¼ ä¸‰"</span>, age=<span class="hljs-number">18</span>, gender=<span class="hljs-string">"ç”·"</span>, score=<span class="hljs-number">95</span>)
<span class="hljs-comment"># è¾“å‡ºï¼šnameï¼šå¼ ä¸‰ï¼Œageï¼š18ï¼Œgenderï¼šç”·ï¼Œscoreï¼š95ï¼ˆkwargsæ˜¯å¯¹åº”çš„å­—å…¸ï¼‰</span>
print_user_info()  <span class="hljs-comment"># è¾“å‡ºï¼šæ— ä¿¡æ¯ï¼ˆkwargsä¸ºç©ºå­—å…¸ï¼‰</span>

<span class="hljs-comment"># ç¤ºä¾‹3ï¼š*args å’Œ **kwargs æ··åˆä½¿ç”¨ï¼ˆæ¥æ”¶ä»»æ„ä½ç½®å‚æ•°å’Œå…³é”®å­—å‚æ•°ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">mix_params</span>(<span class="hljs-params">a, b, *args, **kwargs</span>):
    <span class="hljs-string">"""æ··åˆä½¿ç”¨å¤šç§å‚æ•°ï¼Œé¡ºåºï¼šä½ç½®å‚æ•° â†’ *args â†’ **kwargsï¼ˆå¿…è®°ï¼‰"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä½ç½®å‚æ•°aï¼š<span class="hljs-subst">{a}</span>ï¼Œbï¼š<span class="hljs-subst">{b}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¯å˜ä½ç½®å‚æ•°argsï¼š<span class="hljs-subst">{args}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¯å˜å…³é”®å­—å‚æ•°kwargsï¼š<span class="hljs-subst">{kwargs}</span>"</span>)

<span class="hljs-comment"># è°ƒç”¨ï¼šæŒ‰é¡ºåºä¼ å‚</span>
mix_params(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, name=<span class="hljs-string">"å¼ ä¸‰"</span>, age=<span class="hljs-number">18</span>)
<span class="hljs-comment"># è¾“å‡ºï¼ša=1, b=2ï¼›args=(3,4,5)ï¼›kwargs={'name':'å¼ ä¸‰','age':18}</span>
</code></pre>
<p>æ ¸å¿ƒæ€»ç»“ï¼šå¯å˜å‚æ•°é€‚åˆâ€œå‚æ•°ä¸ªæ•°ä¸ç¡®å®šâ€çš„åœºæ™¯ï¼Œ<code>*args</code> å¯¹åº”å…ƒç»„ï¼Œ<code>**kwargs</code> å¯¹åº”å­—å…¸ï¼Œæ··åˆä½¿ç”¨æ—¶ï¼Œå‚æ•°é¡ºåºå¿…é¡»æ˜¯ï¼š**ä½ç½®å‚æ•° â†’ é»˜è®¤å‚æ•° â†’ *args â†’ <strong>kwargs</strong>ï¼ˆæ–°æ‰‹è®°ç‰¢è¿™ä¸ªé¡ºåºï¼Œé¿å…æŠ¥é”™ï¼‰ã€‚</p>
<h3 data-id="heading-11">3 å‡½æ•°è¿”å›å€¼ï¼šç”¨returnè¯­å¥ï¼Œè·å–å‡½æ•°çš„â€œæ‰§è¡Œç»“æœâ€</h3>
<p>å‰é¢æˆ‘ä»¬å†™çš„å‡½æ•°ï¼Œå¤§å¤šæ˜¯â€œæ‰§è¡Œæ“ä½œå¹¶æ‰“å°ç»“æœâ€ï¼Œä½†åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å°†å‡½æ•°çš„æ‰§è¡Œç»“æœä¿å­˜èµ·æ¥ï¼Œç”¨äºåç»­çš„è®¡ç®—ã€åˆ¤æ–­ç­‰æ“ä½œâ€”â€”è¿™å°±éœ€è¦ç”¨åˆ°å‡½æ•°çš„è¿”å›å€¼ï¼Œreturnè¯­å¥å°±æ˜¯å‡½æ•°çš„â€œè¾“å‡ºå£â€ï¼Œè´Ÿè´£å°†å‡½æ•°å†…éƒ¨çš„ç»“æœä¼ é€’ç»™è°ƒç”¨è€…ï¼Œå‚è€ƒèµ„æ–™4ä¸­returnçš„ç”¨æ³•ï¼Œæ‹†è§£æˆæ–°æ‰‹æ˜“æ‡‚çš„çŸ¥è¯†ç‚¹ã€‚</p>
<h4 data-id="heading-12">3.1 returnè¯­å¥çš„åŸºç¡€ç”¨æ³•ï¼ˆæ ¸å¿ƒï¼‰</h4>
<p>è¯­æ³•ï¼š<code>return ç»“æœ</code>ï¼Œä½œç”¨æœ‰ä¸¤ä¸ªï¼šâ‘  å°†â€œç»“æœâ€è¿”å›ç»™å‡½æ•°è°ƒç”¨è€…ï¼›â‘¡ ç»ˆæ­¢å‡½æ•°æ‰§è¡Œï¼ˆreturnåé¢çš„ä»£ç ï¼Œæ°¸è¿œä¸ä¼šè¿è¡Œï¼‰ã€‚</p>
<p>é‡ç‚¹ï¼šå¦‚æœå‡½æ•°æ²¡æœ‰returnè¯­å¥ï¼Œé»˜è®¤è¿”å› <code>None</code>ï¼ˆPythonä¸­çš„ç©ºå€¼ï¼Œç›¸å½“äºâ€œæ— ç»“æœâ€ï¼‰ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šæœ‰returnè¯­å¥çš„å‡½æ•°ï¼ˆè¿”å›ä¸¤ä¸ªæ•°çš„å’Œï¼Œç”¨äºåç»­è®¡ç®—ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-string">"""è®¡ç®—a + bçš„å’Œï¼Œå¹¶ç”¨returnè¿”å›ç»“æœ"""</span>
    result = a + b
    <span class="hljs-keyword">return</span> result  <span class="hljs-comment"># è¿”å›è®¡ç®—ç»“æœ</span>
    <span class="hljs-comment"># returnåé¢çš„ä»£ç ä¸ä¼šæ‰§è¡Œ</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è¿™å¥è¯æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œï¼"</span>)

<span class="hljs-comment"># è°ƒç”¨å‡½æ•°ï¼Œæ¥æ”¶è¿”å›å€¼ï¼ˆå°†returnçš„ç»“æœèµ‹å€¼ç»™å˜é‡totalï¼‰</span>
total1 = add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"3+5çš„å’Œï¼š<span class="hljs-subst">{total1}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š8</span>
<span class="hljs-comment"># ç”¨è¿”å›å€¼è¿›è¡Œåç»­è®¡ç®—</span>
total2 = add(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"10+20çš„å’Œä¹˜ä»¥2ï¼š<span class="hljs-subst">{total2 * <span class="hljs-number">2</span>}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š60</span>

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šæ— returnè¯­å¥çš„å‡½æ•°ï¼ˆé»˜è®¤è¿”å›Noneï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_hello</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, Python!"</span>)

<span class="hljs-comment"># æ¥æ”¶è¿”å›å€¼ï¼ˆé»˜è®¤æ˜¯Noneï¼‰</span>
res = print_hello()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‡½æ•°çš„è¿”å›å€¼ï¼š<span class="hljs-subst">{res}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šNone</span>

<span class="hljs-comment"># ç¤ºä¾‹3ï¼šreturnç»ˆæ­¢å‡½æ•°æ‰§è¡Œ</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">judge_num</span>(<span class="hljs-params">num</span>):
    <span class="hljs-keyword">if</span> num &gt; <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ­£æ•°"</span>  <span class="hljs-comment"># æ»¡è¶³æ¡ä»¶ï¼Œè¿”å›ç»“æœï¼Œç»ˆæ­¢å‡½æ•°</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è¿™å¥è¯åœ¨num&gt;0æ—¶ï¼Œä¸ä¼šæ‰§è¡Œï¼"</span>)
    <span class="hljs-keyword">if</span> num == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"é›¶"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"è´Ÿæ•°"</span>

<span class="hljs-built_in">print</span>(judge_num(<span class="hljs-number">5</span>))  <span class="hljs-comment"># è¾“å‡ºï¼šæ­£æ•°ï¼ˆreturnåé¢çš„ä»£ç æœªæ‰§è¡Œï¼‰</span>
</code></pre>
<h4 data-id="heading-13">3.2 returnè¿”å›å¤šä¸ªå€¼ï¼ˆå®ç”¨æŠ€å·§ï¼‰</h4>
<p>Pythonä¸­ï¼Œreturnå¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼Œç”¨é€—å·åˆ†éš”å³å¯â€”â€”æœ¬è´¨ä¸Šï¼Œreturnè¿”å›çš„æ˜¯ä¸€ä¸ª<strong>å…ƒç»„</strong>ï¼Œè°ƒç”¨æ—¶å¯ä»¥ç”¨å¤šä¸ªå˜é‡â€œè§£åŒ…â€æ¥æ”¶ï¼Œéå¸¸å®ç”¨ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹ï¼šä¸€ä¸ªå‡½æ•°è¿”å›å¤šä¸ªç»“æœï¼ˆè®¡ç®—ä¸¤ä¸ªæ•°çš„åŠ ã€å‡ã€ä¹˜ã€é™¤ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calc</span>(<span class="hljs-params">a, b</span>):
    add_res = a + b
    sub_res = a - b
    mul_res = a * b
    div_res = a / b <span class="hljs-keyword">if</span> b != <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"é™¤æ•°ä¸èƒ½ä¸º0"</span>
    <span class="hljs-comment"># è¿”å›å¤šä¸ªå€¼ï¼Œç”¨é€—å·åˆ†éš”</span>
    <span class="hljs-keyword">return</span> add_res, sub_res, mul_res, div_res

<span class="hljs-comment"># æ–¹å¼1ï¼šç”¨å¤šä¸ªå˜é‡è§£åŒ…æ¥æ”¶ï¼ˆæ¨èï¼Œæ¸…æ™°ç›´è§‚ï¼‰</span>
add_r, sub_r, mul_r, div_r = calc(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"åŠ æ³•ï¼š<span class="hljs-subst">{add_r}</span>ï¼Œå‡æ³•ï¼š<span class="hljs-subst">{sub_r}</span>ï¼Œä¹˜æ³•ï¼š<span class="hljs-subst">{mul_r}</span>ï¼Œé™¤æ³•ï¼š<span class="hljs-subst">{div_r}</span>"</span>)
<span class="hljs-comment"># è¾“å‡ºï¼šåŠ æ³•ï¼š15ï¼Œå‡æ³•ï¼š5ï¼Œä¹˜æ³•ï¼š50ï¼Œé™¤æ³•ï¼š2.0</span>

<span class="hljs-comment"># æ–¹å¼2ï¼šç”¨ä¸€ä¸ªå˜é‡æ¥æ”¶ï¼ˆå¾—åˆ°çš„æ˜¯å…ƒç»„ï¼‰</span>
all_res = calc(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ‰€æœ‰ç»“æœï¼ˆå…ƒç»„ï¼‰ï¼š<span class="hljs-subst">{all_res}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š(15, 5, 50, 2.0)</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä¹˜æ³•ç»“æœï¼š<span class="hljs-subst">{all_res[<span class="hljs-number">2</span>]}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š50ï¼ˆé€šè¿‡ç´¢å¼•è·å–å…ƒç»„ä¸­çš„å€¼ï¼‰</span>

<span class="hljs-comment"># å¤„ç†é™¤æ•°ä¸º0çš„æƒ…å†µ</span>
add_r2, sub_r2, mul_r2, div_r2 = calc(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>)
<span class="hljs-built_in">print</span>(div_r2)  <span class="hljs-comment"># è¾“å‡ºï¼šé™¤æ•°ä¸èƒ½ä¸º0</span>
</code></pre>
<h4 data-id="heading-14">3.3 æ–°æ‰‹é¿å‘æŒ‡å—</h4>
<ul>
<li>é¿å‘1ï¼šreturnå’Œprintçš„åŒºåˆ«ï¼ˆæ–°æ‰‹æœ€æ˜“æ··æ·†ï¼‰â€”â€”printåªæ˜¯â€œæ‰“å°ç»“æœåˆ°å±å¹•â€ï¼Œä¸ä¼šè¿”å›ä»»ä½•å€¼ï¼›returnæ˜¯â€œå°†ç»“æœè¿”å›ç»™è°ƒç”¨è€…â€ï¼Œå¯ä»¥ç”¨äºåç»­è®¡ç®—ï¼›</li>
<li>é¿å‘2ï¼šreturnåé¢çš„ä»£ç ä¸ä¼šæ‰§è¡Œï¼Œä¸è¦åœ¨returnåé¢å†™é€»è¾‘ä»£ç ï¼›</li>
<li>é¿å‘3ï¼šreturnè¿”å›å¤šä¸ªå€¼æ—¶ï¼Œè°ƒç”¨è€…å¯ä»¥ç”¨ä»»æ„ä¸ªæ•°çš„å˜é‡æ¥æ”¶ï¼ˆå°‘æ¥æ”¶ä¼šæŠ¥é”™ï¼Œå¤šæ¥æ”¶å¯ç”¨*argsæ¥æ”¶å‰©ä½™å€¼ï¼‰ï¼›</li>
<li>é¿å‘4ï¼šå‡½æ•°ä¸­å¯ä»¥æœ‰å¤šä¸ªreturnè¯­å¥ï¼Œä½†åªæœ‰ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„returnä¼šç”Ÿæ•ˆï¼ˆå› ä¸ºreturnä¼šç»ˆæ­¢å‡½æ•°ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-15">4 å±€éƒ¨å˜é‡ä¸å…¨å±€å˜é‡ï¼šææ‡‚â€œå˜é‡çš„ä½œç”¨èŒƒå›´â€ï¼Œé¿å…æŠ¥é”™</h3>
<p>åœ¨å‡½æ•°å­¦ä¹ ä¸­ï¼Œæ–°æ‰‹å¾ˆå®¹æ˜“é‡åˆ°â€œå˜é‡æ‰¾ä¸åˆ°â€â€œå˜é‡ä¿®æ”¹æ— æ•ˆâ€çš„é—®é¢˜ï¼Œæ ¸å¿ƒåŸå› æ˜¯æ²¡ææ‡‚ã€Œå˜é‡çš„ä½œç”¨èŒƒå›´ã€â€”â€”å˜é‡åˆ†ä¸ºå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ï¼Œå„è‡ªæœ‰ä¸åŒçš„ä½œç”¨åŸŸï¼ˆå³â€œèƒ½è¢«è®¿é—®çš„èŒƒå›´â€ï¼‰ï¼Œç»“åˆå‚è€ƒèµ„æ–™1å’Œ3ä¸­å±€éƒ¨ä¸å…¨å±€å˜é‡çš„æ¡ˆä¾‹ï¼Œç®€åŒ–è®²è§£ï¼Œé‡ç‚¹çªç ´æ–°æ‰‹ç—›ç‚¹ã€‚</p>
<h4 data-id="heading-16">4.1 å±€éƒ¨å˜é‡ï¼ˆå‡½æ•°å†…éƒ¨çš„â€œä¸´æ—¶å˜é‡â€ï¼‰</h4>
<p>å±€éƒ¨å˜é‡ï¼šåœ¨<strong>å‡½æ•°å†…éƒ¨</strong>å®šä¹‰çš„å˜é‡ï¼Œä½œç”¨åŸŸä»…é™äºå‡½æ•°å†…éƒ¨ï¼ˆåªèƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®ã€ä¿®æ”¹ï¼Œå‡½æ•°æ‰§è¡Œç»“æŸåï¼Œå±€éƒ¨å˜é‡ä¼šè¢«é”€æ¯ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®ï¼‰ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å±€éƒ¨å˜é‡ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-comment"># resultæ˜¯åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„ï¼Œå±äºå±€éƒ¨å˜é‡</span>
    result = a + b
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‡½æ•°å†…éƒ¨è®¿é—®å±€éƒ¨å˜é‡resultï¼š<span class="hljs-subst">{result}</span>"</span>)  <span class="hljs-comment"># æ­£ç¡®ï¼šå‡½æ•°å†…éƒ¨å¯è®¿é—®</span>

<span class="hljs-comment"># è°ƒç”¨å‡½æ•°</span>
add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šå‡½æ•°å†…éƒ¨è®¿é—®å±€éƒ¨å˜é‡resultï¼š8</span>

<span class="hljs-comment"># é”™è¯¯ï¼šå‡½æ•°å¤–éƒ¨è®¿é—®å±€éƒ¨å˜é‡ï¼ˆè¶…å‡ºä½œç”¨åŸŸï¼‰</span>
<span class="hljs-comment"># print(f"å‡½æ•°å¤–éƒ¨è®¿é—®å±€éƒ¨å˜é‡resultï¼š{result}")  # æŠ¥é”™ï¼šname 'result' is not defined</span>
</code></pre>
<p>æ ¸å¿ƒï¼šå±€éƒ¨å˜é‡æ˜¯å‡½æ•°å†…éƒ¨çš„â€œä¸´æ—¶å˜é‡â€ï¼Œä»…ä¾›å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®ï¼Œå‡½æ•°æ‰§è¡Œå®Œå°±æ¶ˆå¤±ã€‚</p>
<h4 data-id="heading-17">4.2 å…¨å±€å˜é‡ï¼ˆå‡½æ•°å¤–éƒ¨çš„â€œå…¬å…±å˜é‡â€ï¼‰</h4>
<p>å…¨å±€å˜é‡ï¼šåœ¨<strong>å‡½æ•°å¤–éƒ¨</strong>å®šä¹‰çš„å˜é‡ï¼Œä½œç”¨åŸŸæ˜¯æ•´ä¸ªç¨‹åºï¼ˆæ—¢èƒ½åœ¨å‡½æ•°å¤–éƒ¨è®¿é—®ã€ä¿®æ”¹ï¼Œä¹Ÿèƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®ï¼Œä½†ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œéœ€è¦ç”¨å…³é”®å­—å£°æ˜ï¼‰ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å…¨å±€å˜é‡ç¤ºä¾‹ï¼ˆåœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰ï¼‰</span>
global_num = <span class="hljs-number">100</span>  <span class="hljs-comment"># global_numæ˜¯å…¨å±€å˜é‡</span>

<span class="hljs-comment"># å‡½æ•°å†…éƒ¨è®¿é—®å…¨å±€å˜é‡ï¼ˆæ— éœ€å£°æ˜ï¼Œç›´æ¥è®¿é—®ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_global</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‡½æ•°å†…éƒ¨è®¿é—®å…¨å±€å˜é‡global_numï¼š<span class="hljs-subst">{global_num}</span>"</span>)  <span class="hljs-comment"># æ­£ç¡®ï¼šå¯ç›´æ¥è®¿é—®</span>

<span class="hljs-comment"># å‡½æ•°å¤–éƒ¨è®¿é—®å…¨å±€å˜é‡ï¼ˆç›´æ¥è®¿é—®ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‡½æ•°å¤–éƒ¨è®¿é—®å…¨å±€å˜é‡global_numï¼š<span class="hljs-subst">{global_num}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š100</span>

<span class="hljs-comment"># è°ƒç”¨å‡½æ•°</span>
print_global()  <span class="hljs-comment"># è¾“å‡ºï¼šå‡½æ•°å†…éƒ¨è®¿é—®å…¨å±€å˜é‡global_numï¼š100</span>
</code></pre>
<h4 data-id="heading-18">4.3 é‡ç‚¹ï¼šå‡½æ•°å†…éƒ¨ä¿®æ”¹å…¨å±€å˜é‡ï¼ˆå¿…é¡»ç”¨globalå…³é”®å­—ï¼‰</h4>
<p>æ–°æ‰‹æœ€æ˜“è¸©å‘ï¼šå‡½æ•°å†…éƒ¨<strong>ä¸èƒ½ç›´æ¥ä¿®æ”¹å…¨å±€å˜é‡</strong>â€”â€”å¦‚æœåœ¨å‡½æ•°å†…éƒ¨ç›´æ¥ç»™å…¨å±€å˜é‡èµ‹å€¼ï¼ŒPythonä¼šè®¤ä¸ºä½ æ˜¯åœ¨å®šä¹‰ä¸€ä¸ªâ€œæ–°çš„å±€éƒ¨å˜é‡â€ï¼Œè€Œä¸æ˜¯ä¿®æ”¹å…¨å±€å˜é‡ï¼Œæ­¤æ—¶ä¼šæŠ¥é”™æˆ–å‡ºç°é€»è¾‘é”™è¯¯ã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼šåœ¨å‡½æ•°å†…éƒ¨ï¼Œç”¨ <code>global å…¨å±€å˜é‡å</code> å£°æ˜è¯¥å˜é‡æ˜¯å…¨å±€å˜é‡ï¼Œç„¶åå†ä¿®æ”¹ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šé”™è¯¯ä¿®æ”¹å…¨å±€å˜é‡ï¼ˆæœªç”¨globalå£°æ˜ï¼‰</span>
global_num = <span class="hljs-number">100</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">wrong_modify</span>():
    <span class="hljs-comment"># é”™è¯¯ï¼šæœªå£°æ˜globalï¼ŒPythonè®¤ä¸ºæ˜¯å®šä¹‰å±€éƒ¨å˜é‡</span>
    global_num = <span class="hljs-number">200</span>  <span class="hljs-comment"># è¿™é‡Œçš„global_numæ˜¯æ–°çš„å±€éƒ¨å˜é‡ï¼Œä¸æ˜¯å…¨å±€å˜é‡</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‡½æ•°å†…éƒ¨ï¼ˆé”™è¯¯ä¿®æ”¹ï¼‰ï¼š<span class="hljs-subst">{global_num}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š200</span>

wrong_modify()
<span class="hljs-comment"># å‡½æ•°å¤–éƒ¨æŸ¥çœ‹å…¨å±€å˜é‡ï¼ˆæœªè¢«ä¿®æ”¹ï¼Œè¿˜æ˜¯åŸæ¥çš„å€¼ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‡½æ•°å¤–éƒ¨æŸ¥çœ‹å…¨å±€å˜é‡ï¼š<span class="hljs-subst">{global_num}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š100ï¼ˆæœªä¿®æ”¹æˆåŠŸï¼‰</span>

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šæ­£ç¡®ä¿®æ”¹å…¨å±€å˜é‡ï¼ˆç”¨globalå£°æ˜ï¼‰</span>
global_num2 = <span class="hljs-number">100</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">correct_modify</span>():
    <span class="hljs-keyword">global</span> global_num2  <span class="hljs-comment"># å£°æ˜ï¼šglobal_num2æ˜¯å…¨å±€å˜é‡ï¼Œåç»­ä¿®æ”¹çš„æ˜¯å…¨å±€å˜é‡</span>
    global_num2 = <span class="hljs-number">200</span>  <span class="hljs-comment"># æ­£ç¡®ä¿®æ”¹å…¨å±€å˜é‡</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‡½æ•°å†…éƒ¨ï¼ˆæ­£ç¡®ä¿®æ”¹ï¼‰ï¼š<span class="hljs-subst">{global_num2}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š200</span>

correct_modify()
<span class="hljs-comment"># å‡½æ•°å¤–éƒ¨æŸ¥çœ‹å…¨å±€å˜é‡ï¼ˆå·²è¢«ä¿®æ”¹ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‡½æ•°å¤–éƒ¨æŸ¥çœ‹å…¨å±€å˜é‡ï¼š<span class="hljs-subst">{global_num2}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š200ï¼ˆä¿®æ”¹æˆåŠŸï¼‰</span>
</code></pre>
<h4 data-id="heading-19">4.4 æ–°æ‰‹é¿å‘æŒ‡å—</h4>
<ul>
<li>é¿å‘1ï¼šå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡åŒåæ—¶ï¼Œå‡½æ•°å†…éƒ¨ä¼˜å…ˆä½¿ç”¨å±€éƒ¨å˜é‡ï¼ˆå…¨å±€å˜é‡è¢«â€œå±è”½â€ï¼‰ï¼›</li>
<li>é¿å‘2ï¼šå‡½æ•°å†…éƒ¨è®¿é—®å…¨å±€å˜é‡ï¼Œæ— éœ€å£°æ˜ï¼›ä¿®æ”¹å…¨å±€å˜é‡ï¼Œå¿…é¡»ç”¨globalå…³é”®å­—å£°æ˜ï¼›</li>
<li>é¿å‘3ï¼šå°½é‡ä¸è¦è®©å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡åŒåï¼Œå®¹æ˜“æ··æ·†ï¼Œå¯¼è‡´é€»è¾‘é”™è¯¯ï¼›</li>
<li>é¿å‘4ï¼šå…¨å±€å˜é‡é€‚åˆå­˜å‚¨â€œæ•´ä¸ªç¨‹åºéƒ½éœ€è¦ä½¿ç”¨çš„å…¬å…±æ•°æ®â€ï¼Œä¸è¦æ»¥ç”¨ï¼ˆå¦åˆ™ä¼šè®©ä»£ç é€»è¾‘æ··ä¹±ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-20">5 åŒ¿åå‡½æ•°ï¼ˆlambdaè¡¨è¾¾å¼ï¼‰ï¼šç®€æ´çš„â€œä¸€æ¬¡æ€§å°å‡½æ•°â€</h3>
<p>åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸ä¼šé‡åˆ°â€œåªéœ€è¦ä½¿ç”¨ä¸€æ¬¡çš„ç®€å•å‡½æ•°â€ï¼ˆæ¯”å¦‚ç®€å•çš„è®¡ç®—ã€æ’åºæ—¶çš„keyå‡½æ•°ï¼‰ï¼Œæ­¤æ—¶ç”¨defå®šä¹‰å‡½æ•°ä¼šæ˜¾å¾—ç¹çâ€”â€”è€ŒåŒ¿åå‡½æ•°ï¼ˆlambdaè¡¨è¾¾å¼ï¼‰ï¼Œå°±æ˜¯ä¸ºè¿™ç§åœºæ™¯è®¾è®¡çš„ï¼š<strong>ä¸€è¡Œä»£ç å®šä¹‰ç®€å•å‡½æ•°ï¼Œæ— éœ€å‡½æ•°åï¼Œç”¨å®Œå³ä¸¢</strong>ï¼Œç»“åˆå‚è€ƒèµ„æ–™2ä¸­lambdaçš„ç”¨æ³•ï¼Œç®€åŒ–é€‚é…æ–°æ‰‹ã€‚</p>
<h4 data-id="heading-21">5.1 lambdaè¡¨è¾¾å¼çš„åŸºç¡€è¯­æ³•ï¼ˆä¸€è¡Œæå®šï¼‰</h4>
<p>è¯­æ³•ï¼ˆæ–°æ‰‹å¿…è®°ï¼‰ï¼š<code>lambda å‚æ•°åˆ—è¡¨: è¡¨è¾¾å¼</code></p>
<p>è§£æï¼š</p>
<ul>
<li><code>lambda</code>ï¼šå®šä¹‰åŒ¿åå‡½æ•°çš„å…³é”®å­—ï¼ˆç›¸å½“äºdefï¼‰ï¼›</li>
<li>å‚æ•°åˆ—è¡¨ï¼šå’Œæ™®é€šå‡½æ•°çš„å‚æ•°ä¸€è‡´ï¼ˆå¯æ¥æ”¶ä½ç½®å‚æ•°ã€é»˜è®¤å‚æ•°ã€*argsç­‰ï¼Œé€šå¸¸å‚æ•°è¾ƒå°‘ï¼‰ï¼›</li>
<li>è¡¨è¾¾å¼ï¼šå‡½æ•°çš„æ ¸å¿ƒé€»è¾‘ï¼Œåªèƒ½æœ‰<strong>ä¸€ä¸ªè¡¨è¾¾å¼</strong>ï¼ˆä¸èƒ½æœ‰å¾ªç¯ã€å¤šè¡Œæ¡ä»¶è¯­å¥ï¼‰ï¼Œè¡¨è¾¾å¼çš„ç»“æœä¼šè‡ªåŠ¨ä½œä¸ºè¿”å›å€¼ï¼ˆæ— éœ€å†™returnï¼‰ï¼›</li>
<li>åŒ¿åå‡½æ•°æ²¡æœ‰å‡½æ•°åï¼Œé€šå¸¸èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œé€šè¿‡å˜é‡è°ƒç”¨ï¼Œæˆ–ç›´æ¥ä½œä¸ºå‚æ•°ä¼ é€’ï¼ˆæ¯”å¦‚é…åˆsortedã€mapç­‰å‡½æ•°ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šç”¨lambdaå®šä¹‰ç®€å•çš„åŠ æ³•å‡½æ•°ï¼ˆå¯¹æ¯”defå®šä¹‰ï¼‰</span>
<span class="hljs-comment"># ç”¨defå®šä¹‰ï¼ˆç¹çï¼Œé€‚åˆå¤æ‚å‡½æ•°ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add_def</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-comment"># ç”¨lambdaå®šä¹‰ï¼ˆç®€æ´ï¼Œé€‚åˆç®€å•å‡½æ•°ï¼‰</span>
add_lambda = <span class="hljs-keyword">lambda</span> a, b: a + b  <span class="hljs-comment"># èµ‹å€¼ç»™å˜é‡add_lambdaï¼Œé€šè¿‡å˜é‡è°ƒç”¨</span>

<span class="hljs-comment"># ä¸¤ç§å‡½æ•°çš„è°ƒç”¨æ–¹å¼ä¸€è‡´</span>
<span class="hljs-built_in">print</span>(add_def(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))  <span class="hljs-comment"># è¾“å‡ºï¼š8</span>
<span class="hljs-built_in">print</span>(add_lambda(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))  <span class="hljs-comment"># è¾“å‡ºï¼š8</span>

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šlambdaè¡¨è¾¾å¼çš„æ ¸å¿ƒç‰¹ç‚¹ï¼ˆä¸€ä¸ªè¡¨è¾¾å¼ã€è‡ªåŠ¨è¿”å›ç»“æœï¼‰</span>
<span class="hljs-comment"># è®¡ç®—ä¸¤ä¸ªæ•°çš„æœ€å¤§å€¼ï¼ˆç”¨lambdaï¼Œä¸€è¡Œæå®šï¼‰</span>
max_lambda = <span class="hljs-keyword">lambda</span> a, b: a <span class="hljs-keyword">if</span> a &gt; b <span class="hljs-keyword">else</span> b  <span class="hljs-comment"># å•è¡Œæ¡ä»¶è¡¨è¾¾å¼ï¼ˆå…è®¸ï¼‰</span>
<span class="hljs-built_in">print</span>(max_lambda(<span class="hljs-number">5</span>, <span class="hljs-number">8</span>))  <span class="hljs-comment"># è¾“å‡ºï¼š8</span>

<span class="hljs-comment"># ç¤ºä¾‹3ï¼šæ— å‚æ•°çš„lambdaè¡¨è¾¾å¼</span>
hello_lambda = <span class="hljs-keyword">lambda</span>: <span class="hljs-string">"Hello, lambda!"</span>
<span class="hljs-built_in">print</span>(hello_lambda())  <span class="hljs-comment"># è¾“å‡ºï¼šHello, lambda!</span>

<span class="hljs-comment"># ç¤ºä¾‹4ï¼šå¸¦é»˜è®¤å‚æ•°çš„lambdaè¡¨è¾¾å¼</span>
power_lambda = <span class="hljs-keyword">lambda</span> x, n=<span class="hljs-number">2</span>: x **n  <span class="hljs-comment"># né»˜è®¤å€¼ä¸º2ï¼ˆå¹³æ–¹ï¼‰</span>
<span class="hljs-built_in">print</span>(power_lambda(<span class="hljs-number">3</span>))  <span class="hljs-comment"># è¾“å‡ºï¼š9ï¼ˆ3çš„å¹³æ–¹ï¼‰</span>
<span class="hljs-built_in">print</span>(power_lambda(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># è¾“å‡ºï¼š27ï¼ˆ3çš„ç«‹æ–¹ï¼‰</span>
</code></pre>
<h4 data-id="heading-22">5.2 lambdaè¡¨è¾¾å¼çš„å¸¸ç”¨åœºæ™¯ï¼ˆæ–°æ‰‹å¿…å­¦ï¼‰</h4>
<p>lambdaçš„æ ¸å¿ƒä»·å€¼æ˜¯â€œç®€æ´â€ï¼Œæœ€å¸¸ç”¨çš„åœºæ™¯æ˜¯ï¼šä½œä¸ºâ€œä¸´æ—¶å‡½æ•°â€ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼ˆæ¯”å¦‚é…åˆsortedæ’åºã€mapæ˜ å°„ï¼‰ï¼Œç»“åˆç¬¬å››é˜¶æ®µçš„å®¹å™¨ç±»å‹ï¼Œå®ç°é«˜æ•ˆç¼–ç¨‹ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åœºæ™¯1ï¼šé…åˆsorted()æ’åºï¼ˆæŒ‰åˆ—è¡¨ä¸­å…ƒç»„çš„ç¬¬äºŒä¸ªå…ƒç´ æ’åºï¼‰</span>
<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªåŒ…å«å…ƒç»„çš„åˆ—è¡¨ï¼ˆå­˜å‚¨å§“åå’Œå¹´é¾„ï¼‰</span>
students = [(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-number">19</span>), (<span class="hljs-string">"æå››"</span>, <span class="hljs-number">17</span>), (<span class="hljs-string">"ç‹äº”"</span>, <span class="hljs-number">18</span>)]

<span class="hljs-comment"># ç”¨lambdaä½œä¸ºkeyå‡½æ•°ï¼ŒæŒ‰å¹´é¾„æ’åºï¼ˆå‡åºï¼‰</span>
sorted_students = <span class="hljs-built_in">sorted</span>(students, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æŒ‰å¹´é¾„å‡åºæ’åºï¼š"</span>, sorted_students)
<span class="hljs-comment"># è¾“å‡ºï¼š[('æå››', 17), ('ç‹äº”', 18), ('å¼ ä¸‰', 19)]</span>

<span class="hljs-comment"># åœºæ™¯2ï¼šé…åˆmap()æ˜ å°„ï¼ˆå°†åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ä¹˜ä»¥2ï¼‰</span>
nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
<span class="hljs-comment"># ç”¨lambdaå®šä¹‰æ˜ å°„é€»è¾‘ï¼Œmap()æ‰¹é‡å¤„ç†å…ƒç´ </span>
new_nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x * <span class="hljs-number">2</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ‰€æœ‰å…ƒç´ ä¹˜ä»¥2ï¼š"</span>, new_nums)  <span class="hljs-comment"># è¾“å‡ºï¼š[2, 4, 6, 8, 10]</span>

<span class="hljs-comment"># åœºæ™¯3ï¼šé…åˆfilter()è¿‡æ»¤ï¼ˆç­›é€‰åˆ—è¡¨ä¸­çš„å¶æ•°ï¼‰</span>
nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]
<span class="hljs-comment"># ç”¨lambdaå®šä¹‰è¿‡æ»¤æ¡ä»¶ï¼Œfilter()ç­›é€‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ </span>
even_nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç­›é€‰åˆ—è¡¨ä¸­çš„å¶æ•°ï¼š"</span>, even_nums)  <span class="hljs-comment"># è¾“å‡ºï¼š[2, 4, 6]</span>
</code></pre>
<h4 data-id="heading-23">5.3 æ–°æ‰‹é¿å‘æŒ‡å—</h4>
<ul>
<li>é¿å‘1ï¼šlambdaè¡¨è¾¾å¼åªèƒ½æœ‰<strong>ä¸€ä¸ªè¡¨è¾¾å¼</strong>ï¼Œä¸èƒ½æœ‰å¾ªç¯ã€å¤šè¡Œæ¡ä»¶è¯­å¥ï¼ˆif...elif...elseï¼‰ï¼Œå¤æ‚é€»è¾‘è¯·ç”¨defå®šä¹‰æ™®é€šå‡½æ•°ï¼›</li>
<li>é¿å‘2ï¼šlambdaè¡¨è¾¾å¼æ²¡æœ‰å‡½æ•°åï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œå¿…é¡»èµ‹å€¼ç»™å˜é‡ï¼Œæˆ–ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼›</li>
<li>é¿å‘3ï¼šlambdaé€‚åˆâ€œç®€å•ã€ä¸€æ¬¡æ€§â€çš„å‡½æ•°åœºæ™¯ï¼Œä¸è¦ç”¨lambdaå†™å¤æ‚é€»è¾‘ï¼ˆå¦åˆ™ä¼šè®©ä»£ç å¯è¯»æ€§å˜å·®ï¼‰ï¼›</li>
<li>é¿å‘4ï¼šlambdaè¡¨è¾¾å¼çš„å‚æ•°åˆ—è¡¨ï¼Œå’Œæ™®é€šå‡½æ•°çš„å‚æ•°è§„åˆ™ä¸€è‡´ï¼Œä¼ å‚æ—¶è¦åŒ¹é…å‚æ•°ä¸ªæ•°å’Œç±»å‹ã€‚</li>
</ul>
<h3 data-id="heading-24">6 å‡½æ•°åµŒå¥—ä¸é€’å½’ï¼ˆåŸºç¡€ç‰ˆï¼‰ï¼šè§£é”æ›´å¤æ‚çš„å‡½æ•°é€»è¾‘</h3>
<p>æŒæ¡äº†å‰é¢çš„åŸºç¡€åï¼Œæˆ‘ä»¬æ¥å­¦ä¹ å‡½æ•°çš„è¿›é˜¶ç”¨æ³•â€”â€”å‡½æ•°åµŒå¥—ä¸é€’å½’ï¼ˆåŸºç¡€ç‰ˆï¼‰ã€‚å‡½æ•°åµŒå¥—æ˜¯â€œå‡½æ•°å†…éƒ¨å®šä¹‰å‡½æ•°â€ï¼Œå®ç°é€»è¾‘å°è£…ï¼›é€’å½’æ˜¯â€œå‡½æ•°è°ƒç”¨è‡ªèº«â€ï¼Œè§£å†³å¯æ‹†åˆ†çš„ç®€å•é—®é¢˜ï¼Œç»“åˆå‚è€ƒèµ„æ–™1å’Œ3ä¸­çš„æ¡ˆä¾‹ï¼Œç®€åŒ–æˆæ–°æ‰‹èƒ½ç†è§£çš„åŸºç¡€ç‰ˆæœ¬ï¼Œä¸æ·±å…¥å¤æ‚é€»è¾‘ã€‚</p>
<h4 data-id="heading-25">6.1 å‡½æ•°åµŒå¥—ï¼ˆå‡½æ•°å†…éƒ¨å®šä¹‰å‡½æ•°ï¼‰</h4>
<p>å‡½æ•°åµŒå¥—ï¼šåœ¨ä¸€ä¸ªå‡½æ•°ï¼ˆå¤–éƒ¨å‡½æ•°ï¼‰çš„å†…éƒ¨ï¼Œå†å®šä¹‰å¦ä¸€ä¸ªå‡½æ•°ï¼ˆå†…éƒ¨å‡½æ•°ï¼‰ï¼Œæ ¸å¿ƒç‰¹ç‚¹ï¼š</p>
<ul>
<li>å†…éƒ¨å‡½æ•°åªèƒ½åœ¨<strong>å¤–éƒ¨å‡½æ•°å†…éƒ¨</strong>è®¿é—®å’Œè°ƒç”¨ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®ï¼›</li>
<li>å†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼ˆå®ç°é€»è¾‘å°è£…ï¼Œéšè—å†…éƒ¨ç»†èŠ‚ï¼‰ï¼›</li>
<li>å¤–éƒ¨å‡½æ•°å¯ä»¥è¿”å›å†…éƒ¨å‡½æ•°ï¼Œè®©å†…éƒ¨å‡½æ•°åœ¨å¤–éƒ¨è¢«è°ƒç”¨ï¼ˆåç»­è¿›é˜¶è®²è§£ï¼ŒåŸºç¡€ç‰ˆæš‚ä¸æ·±å…¥ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å‡½æ•°åµŒå¥—ç¤ºä¾‹ï¼ˆå¤–éƒ¨å‡½æ•°+å†…éƒ¨å‡½æ•°ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">outer_func</span>():
    <span class="hljs-string">"""å¤–éƒ¨å‡½æ•°"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è¿›å…¥å¤–éƒ¨å‡½æ•°"</span>)
    
    <span class="hljs-comment"># å†…éƒ¨å‡½æ•°ï¼ˆåœ¨å¤–éƒ¨å‡½æ•°å†…éƒ¨å®šä¹‰ï¼‰</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner_func</span>():
        <span class="hljs-string">"""å†…éƒ¨å‡½æ•°ï¼Œåªèƒ½åœ¨å¤–éƒ¨å‡½æ•°å†…éƒ¨è®¿é—®"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"è¿›å…¥å†…éƒ¨å‡½æ•°ï¼Œè®¿é—®å¤–éƒ¨å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼š"</span>, outer_num)
    
    <span class="hljs-comment"># å¤–éƒ¨å‡½æ•°çš„å±€éƒ¨å˜é‡</span>
    outer_num = <span class="hljs-number">100</span>
    <span class="hljs-comment"># å¤–éƒ¨å‡½æ•°å†…éƒ¨è°ƒç”¨å†…éƒ¨å‡½æ•°ï¼ˆæ­£ç¡®ï¼‰</span>
    inner_func()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"é€€å‡ºå¤–éƒ¨å‡½æ•°"</span>)

<span class="hljs-comment"># è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼ˆä¼šè§¦å‘å†…éƒ¨å‡½æ•°çš„è°ƒç”¨ï¼‰</span>
outer_func()
<span class="hljs-comment"># è¾“å‡ºé¡ºåºï¼šè¿›å…¥å¤–éƒ¨å‡½æ•° â†’ è¿›å…¥å†…éƒ¨å‡½æ•°ï¼Œè®¿é—®å¤–éƒ¨å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼š100 â†’ é€€å‡ºå¤–éƒ¨å‡½æ•°</span>

<span class="hljs-comment"># é”™è¯¯ï¼šå¤–éƒ¨ç›´æ¥è°ƒç”¨å†…éƒ¨å‡½æ•°ï¼ˆè¶…å‡ºä½œç”¨åŸŸï¼‰</span>
<span class="hljs-comment"># inner_func()  # æŠ¥é”™ï¼šname 'inner_func' is not defined</span>

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šå†…éƒ¨å‡½æ•°è®¿é—®å¤–éƒ¨å‡½æ•°çš„å‚æ•°</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-string">"""å¤–éƒ¨å‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>():
        <span class="hljs-comment"># å†…éƒ¨å‡½æ•°è®¿é—®å¤–éƒ¨å‡½æ•°çš„å‚æ•°aå’Œb</span>
        <span class="hljs-keyword">return</span> a + b
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>():
        <span class="hljs-keyword">return</span> a - b
    
    <span class="hljs-comment"># å¤–éƒ¨å‡½æ•°è¿”å›å†…éƒ¨å‡½æ•°çš„æ‰§è¡Œç»“æœ</span>
    <span class="hljs-keyword">return</span> add(), subtract()

<span class="hljs-comment"># è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼Œè·å–å†…éƒ¨å‡½æ•°çš„ç»“æœ</span>
add_res, sub_res = calculate(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"åŠ æ³•ç»“æœï¼š<span class="hljs-subst">{add_res}</span>ï¼Œå‡æ³•ç»“æœï¼š<span class="hljs-subst">{sub_res}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š15ï¼Œ5</span>
</code></pre>
<p>æ ¸å¿ƒæ€»ç»“ï¼šå‡½æ•°åµŒå¥—çš„æ ¸å¿ƒæ˜¯â€œå°è£…å†…éƒ¨é€»è¾‘â€ï¼Œå°†å¤æ‚é€»è¾‘æ‹†åˆ†æˆå¤šä¸ªå°å‡½æ•°ï¼Œéšè—å†…éƒ¨ç»†èŠ‚ï¼Œè®©å¤–éƒ¨å‡½æ•°çš„è°ƒç”¨æ›´ç®€æ´ã€‚</p>
<h4 data-id="heading-26">6.2 é€’å½’ï¼ˆåŸºç¡€ç‰ˆï¼‰ï¼šå‡½æ•°è°ƒç”¨è‡ªèº«ï¼Œè§£å†³ç®€å•é—®é¢˜</h4>
<p>é€’å½’çš„æ ¸å¿ƒï¼š<strong>å‡½æ•°è‡ªå·±è°ƒç”¨è‡ªå·±</strong>ï¼Œå°±åƒâ€œå¥—å¨ƒâ€ä¸€æ ·ï¼Œé€‚åˆè§£å†³â€œå¯ä»¥æ‹†åˆ†æˆå¤šä¸ªç›¸åŒå°é—®é¢˜â€çš„åœºæ™¯ï¼ˆæ¯”å¦‚è®¡ç®—é˜¶ä¹˜ã€æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼‰ã€‚</p>
<p>æ–°æ‰‹å¿…è®°ï¼šé€’å½’å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼ˆå¦åˆ™ä¼šé™·å…¥æ— é™é€’å½’ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒï¼‰ï¼š</p>
<ul>
<li>
<ol>
<li>ç»ˆæ­¢æ¡ä»¶ï¼šå­˜åœ¨ä¸€ä¸ªæ˜ç¡®çš„ç»ˆæ­¢é€’å½’çš„æ¡ä»¶ï¼ˆå½“æ»¡è¶³æ¡ä»¶æ—¶ï¼Œä¸å†è°ƒç”¨è‡ªèº«ï¼‰ï¼›</li>
</ol>
</li>
<li>
<ol start="2">
<li>é€’æ¨å…³ç³»ï¼šæ¯æ¬¡é€’å½’è°ƒç”¨ï¼Œéƒ½è¦è®©é—®é¢˜çš„è§„æ¨¡â€œç¼©å°â€ï¼ˆæ¯”å¦‚è®¡ç®—n!ï¼Œé€’æ¨å…³ç³»æ˜¯n! = n * (n-1)!ï¼Œè§„æ¨¡ä»nç¼©å°åˆ°n-1ï¼‰ã€‚</li>
</ol>
</li>
</ul>
<p>åŸºç¡€ç¤ºä¾‹1ï¼šè®¡ç®—nçš„é˜¶ä¹˜ï¼ˆn! = 1Ã—2Ã—3Ã—...Ã—nï¼Œç»ˆæ­¢æ¡ä»¶ï¼šn=1æ—¶ï¼Œ1! = 1ï¼‰ï¼Œå‚è€ƒèµ„æ–™1ä¸­çš„é˜¶ä¹˜æ¡ˆä¾‹ï¼Œç®€åŒ–é€‚é…æ–°æ‰‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é€’å½’è®¡ç®—nçš„é˜¶ä¹˜ï¼ˆåŸºç¡€ç‰ˆï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">factorial</span>(<span class="hljs-params">n</span>):
    <span class="hljs-string">"""é€’å½’è®¡ç®—nçš„é˜¶ä¹˜
    å‚æ•°ï¼šn -- éè´Ÿæ•´æ•°
    ç»ˆæ­¢æ¡ä»¶ï¼šn == 1 æˆ– n == 0 æ—¶ï¼Œè¿”å›1
    é€’æ¨å…³ç³»ï¼šn! = n * (n-1)!
    """</span>
    <span class="hljs-comment"># ç»ˆæ­¢æ¡ä»¶ï¼ˆå¿…é¡»æœ‰ï¼Œå¦åˆ™æ— é™é€’å½’ï¼‰</span>
    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> n == <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
    <span class="hljs-comment"># é€’æ¨å…³ç³»ï¼šå‡½æ•°è°ƒç”¨è‡ªèº«ï¼Œé—®é¢˜è§„æ¨¡ç¼©å°ï¼ˆn â†’ n-1ï¼‰</span>
    <span class="hljs-keyword">return</span> n * factorial(n - <span class="hljs-number">1</span>)

<span class="hljs-comment"># è°ƒç”¨å‡½æ•°ï¼Œæµ‹è¯•ç»“æœ</span>
<span class="hljs-built_in">print</span>(factorial(<span class="hljs-number">5</span>))  <span class="hljs-comment"># è¾“å‡ºï¼š120ï¼ˆ5! = 5Ã—4Ã—3Ã—2Ã—1 = 120ï¼‰</span>
<span class="hljs-built_in">print</span>(factorial(<span class="hljs-number">3</span>))  <span class="hljs-comment"># è¾“å‡ºï¼š6ï¼ˆ3! = 3Ã—2Ã—1 = 6ï¼‰</span>
<span class="hljs-built_in">print</span>(factorial(<span class="hljs-number">0</span>))  <span class="hljs-comment"># è¾“å‡ºï¼š1ï¼ˆ0! è§„å®šä¸º1ï¼‰</span>
</code></pre>
<p>åŸºç¡€ç¤ºä¾‹2ï¼šé€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆå‰ä¸¤é¡¹ä¸º1ï¼Œä»ç¬¬ä¸‰é¡¹å¼€å§‹ï¼Œæ¯ä¸€é¡¹ç­‰äºå‰ä¸¤é¡¹ä¹‹å’Œï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬né¡¹ï¼ˆåŸºç¡€ç‰ˆï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">fibonacci</span>(<span class="hljs-params">n</span>):
    <span class="hljs-string">"""é€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ç¬¬né¡¹
    ç»ˆæ­¢æ¡ä»¶ï¼šn == 1 æˆ– n == 2 æ—¶ï¼Œè¿”å›1
    é€’æ¨å…³ç³»ï¼šfib(n) = fib(n-1) + fib(n-2)
    """</span>
    <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> n == <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> fibonacci(n - <span class="hljs-number">1</span>) + fibonacci(n - <span class="hljs-number">2</span>)

<span class="hljs-comment"># è°ƒç”¨å‡½æ•°ï¼Œè¾“å‡ºå‰10é¡¹æ–æ³¢é‚£å¥‘æ•°åˆ—</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>):
    <span class="hljs-built_in">print</span>(fibonacci(i), end=<span class="hljs-string">" "</span>)  <span class="hljs-comment"># è¾“å‡ºï¼š1 1 2 3 5 8 13 21 34 55</span>
</code></pre>
<h4 data-id="heading-27">6.3 æ–°æ‰‹é¿å‘æŒ‡å—ï¼ˆé€’å½’é‡ç‚¹ï¼ï¼‰</h4>
<ul>
<li>é¿å‘1ï¼šé€’å½’å¿…é¡»æœ‰<strong>æ˜ç¡®çš„ç»ˆæ­¢æ¡ä»¶</strong>ï¼Œå¦åˆ™ä¼šé™·å…¥æ— é™é€’å½’ï¼ˆç¨‹åºä¼šæŠ¥é”™â€œRecursionErrorâ€ï¼Œæ ˆæº¢å‡ºï¼‰ï¼›</li>
<li>é¿å‘2ï¼šé€’å½’çš„é€’æ¨å…³ç³»å¿…é¡»è®©â€œé—®é¢˜è§„æ¨¡ç¼©å°â€ï¼Œå¦åˆ™å³ä½¿æœ‰ç»ˆæ­¢æ¡ä»¶ï¼Œä¹Ÿæ— æ³•è§¦å‘ï¼›</li>
<li>é¿å‘3ï¼šPythonçš„é€’å½’æ·±åº¦æœ‰é™ï¼ˆé»˜è®¤çº¦1000å±‚ï¼‰ï¼Œé€’å½’æ¬¡æ•°è¿‡å¤šä¼šæŠ¥é”™ï¼ŒåŸºç¡€é˜¶æ®µä¸è¦ç”¨é€’å½’è§£å†³å¤§è§„æ¨¡é—®é¢˜ï¼›</li>
<li>é¿å‘4ï¼šé€’å½’é€‚åˆâ€œç®€å•ã€å¯æ‹†åˆ†â€çš„é—®é¢˜ï¼Œå¤æ‚é—®é¢˜ç”¨å¾ªç¯ï¼ˆfor/whileï¼‰å®ç°æ›´é«˜æ•ˆï¼ˆåç»­ä¼šå¯¹æ¯”ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-28">7 æ€»ç»“</h3>
<p>åˆ°è¿™é‡Œï¼ŒPython3åŸºç¡€å­¦ä¹ ç¬¬äº”é˜¶æ®µã€Œå‡½æ•°åŸºç¡€ã€çš„æ ¸å¿ƒå†…å®¹å°±å…¨éƒ¨æ¢³ç†å®Œæ¯•äº†ï¼è¿™ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬ä»â€œå‡½æ•°çš„å®šä¹‰ä¸è°ƒç”¨â€å…¥æ‰‹ï¼Œé€æ­¥æŒæ¡äº†å‚æ•°ã€è¿”å›å€¼ã€å±€éƒ¨ä¸å…¨å±€å˜é‡ã€åŒ¿åå‡½æ•°ã€å‡½æ•°åµŒå¥—ä¸é€’å½’ï¼ˆåŸºç¡€ç‰ˆï¼‰ï¼Œæ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹éƒ½æ˜¯Pythonæ¨¡å—åŒ–ç¼–ç¨‹çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯åç»­å­¦ä¹ æ›´é«˜çº§å†…å®¹ï¼ˆå‡½æ•°è¿›é˜¶ã€é¢å‘å¯¹è±¡ã€æ¨¡å—ä¸åŒ…ï¼‰çš„å…³é”®ã€‚</p>
<p>å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œè¿™ä¸€é˜¶æ®µçš„é‡ç‚¹ä¸æ˜¯æ­»è®°ç¡¬èƒŒè¯­æ³•ï¼Œè€Œæ˜¯ç†è§£å‡½æ•°çš„æ ¸å¿ƒä»·å€¼ï¼ˆä»£ç å¤ç”¨ã€æ¨¡å—åŒ–ï¼‰ï¼Œå¹¶å¤šåŠ¨æ‰‹ç»ƒä¹ ï¼Œé‡ç‚¹æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>å‡½æ•°çš„å®šä¹‰ä¸è°ƒç”¨æ˜¯åŸºç¡€ï¼Œç‰¢è®°defå…³é”®å­—çš„æ¨¡æ¿ï¼Œæ³¨æ„ç¼©è¿›å’Œè°ƒç”¨æ–¹å¼ï¼Œé¿å…â€œåªå®šä¹‰ä¸è°ƒç”¨â€ï¼›</li>
<li>å‡½æ•°å‚æ•°æ˜¯é‡ç‚¹ï¼Œåˆ†æ¸…4ç§å‚æ•°ç±»å‹çš„ç”¨æ³•å’Œé¡ºåºï¼Œå°¤å…¶æ˜¯å¯å˜å‚æ•°<code>*args</code>å’Œ<code>**kwargs</code>ï¼Œå¤šç»ƒä¹ æ··åˆä¼ å‚ï¼›</li>
<li>åˆ†æ¸…returnå’Œprintçš„åŒºåˆ«ï¼ŒæŒæ¡returnè¿”å›å¤šä¸ªå€¼çš„æŠ€å·§ï¼Œè¿™æ˜¯åç»­æ•°æ®å¤„ç†çš„å¸¸ç”¨æ–¹æ³•ï¼›</li>
<li>ææ‡‚å±€éƒ¨å˜é‡ä¸å…¨å±€å˜é‡çš„ä½œç”¨åŸŸï¼Œè®°ä½â€œä¿®æ”¹å…¨å±€å˜é‡å¿…é¡»ç”¨globalå£°æ˜â€ï¼Œé¿å…å˜é‡æŠ¥é”™ï¼›</li>
<li>åŒ¿åå‡½æ•°é€‚åˆç®€å•ã€ä¸€æ¬¡æ€§åœºæ™¯ï¼Œå¤æ‚é€»è¾‘ç”¨æ™®é€šå‡½æ•°ï¼Œä¸è¦æ»¥ç”¨lambdaï¼›</li>
<li>é€’å½’åŸºç¡€é‡ç‚¹è®°â€œç»ˆæ­¢æ¡ä»¶+é€’æ¨å…³ç³»â€ï¼Œæ–°æ‰‹å…ˆç»ƒä¹ ç®€å•æ¡ˆä¾‹ï¼ˆé˜¶ä¹˜ã€æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼‰ï¼Œä¸è¦è¿½æ±‚å¤æ‚é€’å½’ã€‚</li>
</ol>
<p>ç¬¬äº”é˜¶æ®µçš„å­¦ä¹ ï¼Œéš¾åº¦æ¯”å‰å››é˜¶æ®µç•¥æœ‰æå‡ï¼Œå°¤å…¶æ˜¯å‚æ•°ã€å±€éƒ¨å…¨å±€å˜é‡ã€é€’å½’è¿™ä¸‰ä¸ªçŸ¥è¯†ç‚¹ï¼Œæ–°æ‰‹å®¹æ˜“è¸©å‘ã€‚å»ºè®®å¤§å®¶æ¯å¤©èŠ±30åˆ†é’Ÿï¼Œäº²æ‰‹æ•²å†™æ¯ä¸ªçŸ¥è¯†ç‚¹çš„ä»£ç ç¤ºä¾‹ï¼Œä¿®æ”¹å‚æ•°ã€è°ƒè¯•æŠ¥é”™ï¼Œæ„Ÿå—å‡½æ•°çš„ç”¨æ³•â€”â€”åªæœ‰å¤šåŠ¨æ‰‹ï¼Œæ‰èƒ½çœŸæ­£åƒé€å‡½æ•°ï¼Œè®©ä»£ç å˜å¾—æ›´ç®€æ´ã€æ›´é«˜æ•ˆã€‚</p>
<p>ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å°†è¿›å…¥ã€Œå‡½æ•°è¿›é˜¶ã€çš„å­¦ä¹ ï¼Œé‡ç‚¹æ”»å…‹é€’å½’è¿›é˜¶ã€é«˜é˜¶å‡½æ•°ã€è£…é¥°å™¨ç­‰å†…å®¹ï¼Œè¿›ä¸€æ­¥æå‡ä»£ç çš„å¤ç”¨æ€§å’Œå¯è¯»æ€§ã€‚ç»§ç»­åŠ æ²¹ï¼Œç¨³æ­¥è§£é”Pythonç¼–ç¨‹çš„æ›´å¤šæŠ€èƒ½ï¼Œç¦»â€œåˆæ ¼çš„Pythonåˆå­¦è€…â€åˆè¿‘äº†ä¸€æ­¥ï½</p>
<hr/>
<p><em>è½¬å‘è¯·æºå¸¦ä½œè€…ä¿¡æ¯</em>  <strong>@æ€’æ”¾å§å¾·å¾· @ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</strong><br/>
æŒç»­åˆ›ä½œå¾ˆä¸å®¹æ˜“ï¼Œä½œè€…å°†ä»¥å°½å¯èƒ½çš„è¯¦ç»†æŠŠæ‰€å­¦çŸ¥è¯†åˆ†äº«å„ä½å¼€å‘è€…ï¼Œä¸€èµ·è¿›æ­¥ä¸€èµ·å­¦ä¹ ã€‚<strong>è½¬è½½è¯·æºå¸¦é“¾æ¥ï¼Œè½¬è½½åˆ°å¾®ä¿¡å…¬ä¼—å·è¯·å‹¿é€‰æ‹©åŸåˆ›ï¼Œè°¢è°¢ï¼</strong><br/>
ğŸ‘åˆ›ä½œä¸æ˜“ï¼Œå¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£ï¼Œæ„Ÿè°¢è§‚çœ‹ï¼è®°å¾—ç‚¹èµå“¦ï¼ğŸ‘<br/>
è°¢è°¢æ”¯æŒï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python3åŸºç¡€ï¼šè¿›é˜¶åŸºç¡€ï¼Œç­‘ç‰¢ç¼–ç¨‹åº•å±‚èƒ½åŠ›]]></title>    <link>https://juejin.cn/post/7603561363571490879</link>    <guid>https://juejin.cn/post/7603561363571490879</guid>    <pubDate>2026-02-06T15:09:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603561363571490879" data-draft-id="7603563317040496703" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python3åŸºç¡€ï¼šè¿›é˜¶åŸºç¡€ï¼Œç­‘ç‰¢ç¼–ç¨‹åº•å±‚èƒ½åŠ›"/> <meta itemprop="keywords" content="åç«¯,Python"/> <meta itemprop="datePublished" content="2026-02-06T15:09:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ€’æ”¾å§å¾·å¾·"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python3åŸºç¡€ï¼šè¿›é˜¶åŸºç¡€ï¼Œç­‘ç‰¢ç¼–ç¨‹åº•å±‚èƒ½åŠ›
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ€’æ”¾å§å¾·å¾·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:09:55.000Z" title="Fri Feb 06 2026 15:09:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»27åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬å…­é˜¶æ®µï¼šè¿›é˜¶åŸºç¡€ï¼Œç­‘ç‰¢ç¼–ç¨‹åº•å±‚èƒ½åŠ›</h2>
<blockquote>
<p>ğŸ˜„ç”Ÿå‘½ä¸æ¯ï¼Œå†™ä½œä¸æ­¢</p>
<p>ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°</p>
<p>ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·</p>
<p>ğŸ† <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">åšå®¢é¦–é¡µ</a> Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@æ€’æ”¾å§å¾·å¾·</a>Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">Toè®°å½•é¢†åœ°</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</a></p>
<p>ğŸŒåˆ†äº«å­¦ä¹ å¿ƒå¾—ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ æˆé•¿ï¼</p>
<p>ğŸ”¥è±†åŒ…AI</p>
</blockquote>
<p><em>è½¬å‘è¯·æºå¸¦ä½œè€…ä¿¡æ¯</em>Â  <strong>@æ€’æ”¾å§å¾·å¾·(æ˜é‡‘) @ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº(CSDN)</strong></p>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨ç¬¬äº”é˜¶æ®µï¼Œæˆ‘ä»¬åƒé€äº†å‡½æ•°åŸºç¡€çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹â€”â€”ä»å‡½æ•°çš„å®šä¹‰ä¸è°ƒç”¨ï¼Œåˆ°å‚æ•°ã€è¿”å›å€¼ã€å±€éƒ¨ä¸å…¨å±€å˜é‡ï¼Œå†åˆ°åŒ¿åå‡½æ•°ã€å‡½æ•°åµŒå¥—ä¸é€’å½’ï¼Œæˆ‘ä»¬ç»ˆäºæ‘†è„±äº†â€œé›¶æ•£ä»£ç â€çš„å›°å¢ƒï¼Œå®ç°äº†ä»£ç çš„å¤ç”¨ä¸æ¨¡å—åŒ–ã€‚</p>
<p>è€Œç¬¬å…­é˜¶æ®µæˆ‘ä»¬è¦æ”»å…‹çš„ã€Œè¿›é˜¶åŸºç¡€ã€ï¼Œæ˜¯Pythonç¼–ç¨‹ä»â€œä¼šç”¨â€èµ°å‘â€œæ´»ç”¨â€çš„å…³é”®ä¸€æ­¥ï¼Œæ›´æ˜¯åç»­å­¦ä¹ å¤æ‚é¡¹ç›®ã€æ¡†æ¶ï¼ˆå¦‚Djangoã€PyTorchï¼‰çš„æ ¸å¿ƒåŸºçŸ³ã€‚è¿™ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å°†é‡ç‚¹å­¦ä¹ å››å¤§æ ¸å¿ƒå†…å®¹ï¼šæ¨¡å—ä¸åŒ…ï¼ˆå®ç°ä»£ç çš„è§„æ¨¡åŒ–å¤ç”¨ï¼‰ã€æ–‡ä»¶æ“ä½œï¼ˆå®ç°æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ï¼‰ã€å¼‚å¸¸å¤„ç†ï¼ˆè®©ä»£ç æ›´å¥å£®ã€å®¹é”™æ€§æ›´å¼ºï¼‰ã€é¢å‘å¯¹è±¡åŸºç¡€ï¼ˆè§£é”æ›´çµæ´»çš„ç¼–ç¨‹æ€ç»´ï¼‰ã€‚</p>
<p>æœ¬é˜¶æ®µçš„å­¦ä¹ éš¾åº¦ç›¸è¾ƒäºå‰äº”ä¸ªé˜¶æ®µç•¥æœ‰æå‡ï¼Œæ ¸å¿ƒç›®æ ‡ä¸å†æ˜¯â€œè®°ä½è¯­æ³•â€ï¼Œè€Œæ˜¯â€œç†è§£é€»è¾‘ã€çµæ´»è¿ç”¨â€ã€‚å…¨ç¨‹å°†å»¶ç»­â€œçŸ¥è¯†ç‚¹è§£æ+å¯è¿è¡Œä»£ç +é¿å‘æŠ€å·§â€çš„æ¨¡å¼ï¼Œè´´åˆæ–°æ‰‹å­¦ä¹ èŠ‚å¥ï¼Œæ¯ä¸ªä»£ç ç¤ºä¾‹éƒ½å¯ç›´æ¥å¤åˆ¶è¿è¡Œï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½æ­é…é€šä¿—è§£è¯»ï¼Œè·Ÿç€æ•²ä»£ç ã€ç»ƒæ¡ˆä¾‹ï¼Œå°±èƒ½è½»æ¾æŒæ¡è¿›é˜¶åŸºç¡€çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œç¨³æ­¥å‘â€œåˆæ ¼çš„Pythonåˆå­¦è€…â€è¿ˆè¿›ï½</p>
<h3 data-id="heading-2">1 æ¨¡å—ä¸åŒ…ï¼šå®ç°ä»£ç è§„æ¨¡åŒ–å¤ç”¨ï¼Œå‘Šåˆ«â€œå¤åˆ¶ç²˜è´´â€</h3>
<p>åœ¨ç¬¬äº”é˜¶æ®µï¼Œæˆ‘ä»¬ç”¨å‡½æ•°å®ç°äº†â€œä»£ç ç‰‡æ®µçš„å¤ç”¨â€ï¼Œä½†å½“é¡¹ç›®è¶Šæ¥è¶Šå¤§ã€å‡½æ•°è¶Šæ¥è¶Šå¤šï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼šå¤§é‡å‡½æ•°å †ç Œåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸ä»…éš¾ä»¥æŸ¥æ‰¾ã€ç»´æŠ¤ï¼Œè¿˜å®¹æ˜“å‡ºç°å‘½åå†²çªã€‚è€Œã€Œæ¨¡å—ä¸åŒ…ã€ï¼Œå°±æ˜¯ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿçš„â€”â€”å®ƒä»¬èƒ½å¸®æˆ‘ä»¬å°†ä»£ç æŒ‰åŠŸèƒ½åˆ†ç±»ã€ç»„ç»‡ï¼Œå®ç°â€œè·¨æ–‡ä»¶å¤ç”¨â€ï¼Œè®©ä»£ç ç»“æ„æ›´æ¸…æ™°ã€æ›´å…·å¯æ‰©å±•æ€§ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼š<strong>æ¨¡å—ï¼ˆModuleï¼‰</strong> æ˜¯ä¸€ä¸ªåŒ…å«Pythonä»£ç çš„ <code>.py</code> æ–‡ä»¶ï¼ˆæ¯”å¦‚my_module.pyï¼‰ï¼Œé‡Œé¢å¯ä»¥å®šä¹‰å‡½æ•°ã€ç±»ã€å˜é‡ï¼›<strong>åŒ…ï¼ˆPackageï¼‰</strong> æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—ï¼ˆ.pyæ–‡ä»¶ï¼‰çš„ç›®å½•ï¼Œç›®å½•ä¸‹å¿…é¡»æœ‰ä¸€ä¸ª <code>__init__.py</code> æ–‡ä»¶ï¼ˆå¯ä¸ºç©ºï¼‰ï¼Œç”¨äºæ ‡è¯†è¿™ä¸ªç›®å½•æ˜¯ä¸€ä¸ªPythonåŒ…ã€‚</p>
<h4 data-id="heading-3">1.1 æ¨¡å—çš„ä½¿ç”¨ï¼šimportå¯¼å…¥ï¼ˆæ ¸å¿ƒæ“ä½œï¼‰</h4>
<p>Pythonæä¾›äº†å¤šç§å¯¼å…¥æ¨¡å—çš„æ–¹å¼ï¼Œæ ¸å¿ƒæ˜¯ä½¿ç”¨ <code>import</code> å…³é”®å­—ï¼Œæ–°æ‰‹é‡ç‚¹æŒæ¡4ç§å¸¸ç”¨æ–¹å¼ï¼Œç»“åˆç¤ºä¾‹ç†è§£ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ–¹å¼1ï¼šå¯¼å…¥æ•´ä¸ªæ¨¡å—ï¼ˆæœ€åŸºç¡€ï¼‰</span>
<span class="hljs-comment"># è¯­æ³•ï¼šimport æ¨¡å—å</span>
<span class="hljs-keyword">import</span> random  <span class="hljs-comment"># å¯¼å…¥Pythonå†…ç½®çš„éšæœºæ•°æ¨¡å—ï¼ˆæ— éœ€è‡ªå·±åˆ›å»ºï¼‰</span>

<span class="hljs-comment"># ä½¿ç”¨æ¨¡å—ä¸­çš„å‡½æ•°/å˜é‡ï¼šæ¨¡å—å.å‡½æ•°å() / æ¨¡å—å.å˜é‡å</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"éšæœºæ•´æ•°ï¼ˆ1-10ï¼‰ï¼š"</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"éšæœºæµ®ç‚¹æ•°ï¼ˆ0-1ï¼‰ï¼š"</span>, random.random())

<span class="hljs-comment"># æ–¹å¼2ï¼šå¯¼å…¥æ¨¡å—å¹¶æŒ‡å®šåˆ«åï¼ˆç®€åŒ–è°ƒç”¨ï¼Œå¸¸ç”¨ï¼‰</span>
<span class="hljs-comment"># è¯­æ³•ï¼šimport æ¨¡å—å as åˆ«å</span>
<span class="hljs-keyword">import</span> datetime <span class="hljs-keyword">as</span> dt  <span class="hljs-comment"># å¯¼å…¥å†…ç½®æ—¥æœŸæ—¶é—´æ¨¡å—ï¼Œåˆ«ådt</span>

<span class="hljs-comment"># ä½¿ç”¨åˆ«åè°ƒç”¨ï¼Œæ›´ç®€æ´</span>
now = dt.datetime.now()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰æ—¶é—´ï¼š"</span>, now.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>))

<span class="hljs-comment"># æ–¹å¼3ï¼šä»æ¨¡å—ä¸­å¯¼å…¥æŒ‡å®šçš„å‡½æ•°/å˜é‡ï¼ˆæ¨èï¼ŒæŒ‰éœ€å¯¼å…¥ï¼‰</span>
<span class="hljs-comment"># è¯­æ³•ï¼šfrom æ¨¡å—å import å‡½æ•°å1, å‡½æ•°å2, å˜é‡å</span>
<span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> pi, sqrt  <span class="hljs-comment"># ä»å†…ç½®æ•°å­¦æ¨¡å—å¯¼å…¥piï¼ˆåœ†å‘¨ç‡ï¼‰å’Œsqrtï¼ˆå¼€å¹³æ–¹ï¼‰</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"åœ†å‘¨ç‡piï¼š"</span>, pi)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"9çš„å¹³æ–¹æ ¹ï¼š"</span>, sqrt(<span class="hljs-number">9</span>))  <span class="hljs-comment"># è¾“å‡º3.0</span>

<span class="hljs-comment"># æ–¹å¼4ï¼šä»æ¨¡å—ä¸­å¯¼å…¥æ‰€æœ‰å†…å®¹ï¼ˆä¸æ¨èï¼Œæ˜“å‡ºç°å‘½åå†²çªï¼‰</span>
<span class="hljs-comment"># è¯­æ³•ï¼šfrom æ¨¡å—å import *</span>
<span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> *

<span class="hljs-built_in">print</span>(<span class="hljs-string">"éšæœºé€‰æ‹©åˆ—è¡¨å…ƒç´ ï¼š"</span>, choice([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]))
<span class="hljs-comment"># æ³¨æ„ï¼šè¿™ç§æ–¹å¼ä¼šå¯¼å…¥æ¨¡å—ä¸­æ‰€æœ‰å¯å¯¼å…¥çš„å†…å®¹ï¼Œè‹¥ä¸è‡ªèº«å®šä¹‰çš„å‡½æ•°/å˜é‡åŒåï¼Œä¼šè¦†ç›–</span>
</code></pre>
<h4 data-id="heading-4">1.2 è‡ªå®šä¹‰æ¨¡å—ï¼šè‡ªå·±å†™æ¨¡å—ï¼Œå®ç°è·¨æ–‡ä»¶å¤ç”¨</h4>
<p>é™¤äº†ä½¿ç”¨Pythonå†…ç½®æ¨¡å—ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå·±ç¼–å†™æ¨¡å—ï¼ˆ.pyæ–‡ä»¶ï¼‰ï¼Œå°†è‡ªå·±å®šä¹‰çš„å‡½æ•°ã€ç±»ã€å˜é‡æ”¾å…¥å…¶ä¸­ï¼Œä¾›å…¶ä»–æ–‡ä»¶å¯¼å…¥ä½¿ç”¨â€”â€”è¿™æ˜¯å®é™…ç¼–ç¨‹ä¸­å¸¸ç”¨çš„æŠ€å·§ï¼Œå®ç°ä»£ç çš„è·¨æ–‡ä»¶å¤ç”¨ã€‚</p>
<p>æ­¥éª¤ï¼šâ‘  åˆ›å»ºä¸€ä¸ª <code>.py</code> æ–‡ä»¶ï¼ˆæ¨¡å—æ–‡ä»¶ï¼‰ï¼Œç¼–å†™ä»£ç ï¼ˆå‡½æ•°ã€ç±»ç­‰ï¼‰ï¼›â‘¡ åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç”¨importå¯¼å…¥è¿™ä¸ªæ¨¡å—ï¼Œå³å¯ä½¿ç”¨å…¶ä¸­çš„å†…å®¹ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè‡ªå®šä¹‰æ¨¡å—ï¼ˆæ–‡ä»¶åï¼šmy_module.pyï¼Œä¸å½“å‰è¿è¡Œæ–‡ä»¶æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹ï¼‰</span>
<span class="hljs-comment"># ------------------ my_module.py å†…å®¹ ------------------</span>
<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªè®¡ç®—ä¸¤æ•°ä¹‹å’Œçš„å‡½æ•°</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªè®¡ç®—ä¸¤æ•°ä¹‹å·®çš„å‡½æ•°</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a - b

<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡</span>
PI = <span class="hljs-number">3.1415926</span>

<span class="hljs-comment"># æ¨¡å—è‡ªæµ‹ï¼šå½“æ¨¡å—è¢«ç›´æ¥è¿è¡Œæ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼ˆå¯¼å…¥æ—¶ä¸æ‰§è¡Œï¼‰</span>
<span class="hljs-comment"># æ§åˆ¶æ¨¡å—æ‰§è¡Œï¼ˆå…¥å£ç‚¹ï¼‰</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¨¡å—è‡ªæµ‹ï¼š3+5 ="</span>, add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¨¡å—è‡ªæµ‹ï¼š10-4 ="</span>, subtract(<span class="hljs-number">10</span>, <span class="hljs-number">4</span>))
<span class="hljs-comment"># ------------------------------------------------------</span>

<span class="hljs-comment"># ç¬¬äºŒæ­¥ï¼šåœ¨å½“å‰æ–‡ä»¶ï¼ˆæ¯”å¦‚main.pyï¼‰ä¸­å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—ï¼Œä½¿ç”¨å…¶ä¸­çš„å†…å®¹</span>
<span class="hljs-comment"># å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—</span>
<span class="hljs-keyword">import</span> my_module

<span class="hljs-comment"># ä½¿ç”¨æ¨¡å—ä¸­çš„å‡½æ•°</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"3+5 ="</span>, my_module.add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))  <span class="hljs-comment"># è¾“å‡º8</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"10-4 ="</span>, my_module.subtract(<span class="hljs-number">10</span>, <span class="hljs-number">4</span>))  <span class="hljs-comment"># è¾“å‡º6</span>

<span class="hljs-comment"># ä½¿ç”¨æ¨¡å—ä¸­çš„å˜é‡</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åœ†å‘¨ç‡ï¼ˆè‡ªå®šä¹‰æ¨¡å—ï¼‰ï¼š"</span>, my_module.PI)  <span class="hljs-comment"># è¾“å‡º3.1415926</span>

<span class="hljs-comment"># ä¹Ÿå¯ä»¥ç”¨åˆ«åå¯¼å…¥</span>
<span class="hljs-keyword">import</span> my_module <span class="hljs-keyword">as</span> mm
<span class="hljs-built_in">print</span>(<span class="hljs-string">"5+8 ="</span>, mm.add(<span class="hljs-number">5</span>, <span class="hljs-number">8</span>))  <span class="hljs-comment"># è¾“å‡º13</span>

<span class="hljs-comment"># ä¹Ÿå¯ä»¥æŒ‰éœ€å¯¼å…¥</span>
<span class="hljs-keyword">from</span> my_module <span class="hljs-keyword">import</span> add, PI
<span class="hljs-built_in">print</span>(<span class="hljs-string">"2+7 ="</span>, add(<span class="hljs-number">2</span>, <span class="hljs-number">7</span>))  <span class="hljs-comment"># è¾“å‡º9</span>
</code></pre>
<p>å…³é”®çŸ¥è¯†ç‚¹ï¼š<code>if __name__ == "__main__":</code> â€”â€” æ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ª <code>__name__</code> å±æ€§ï¼Œå½“æ¨¡å—è¢«ç›´æ¥è¿è¡Œæ—¶ï¼Œ<code>__name__</code> çš„å€¼ä¸º <code>"__main__"</code>ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œè¯¥åˆ¤æ–­ä¸‹çš„ä»£ç ï¼ˆç”¨äºæ¨¡å—è‡ªæµ‹ï¼‰ï¼›å½“æ¨¡å—è¢«å¯¼å…¥æ—¶ï¼Œ<code>__name__</code> çš„å€¼ä¸ºæ¨¡å—åï¼Œè¯¥åˆ¤æ–­ä¸‹çš„ä»£ç ä¸ä¼šæ‰§è¡Œã€‚</p>
<blockquote>
<p>ç±»ä¼¼ Java çš„ main æ–¹æ³•</p>
<p>public class MyClass {</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {

    <span class="hljs-comment">// å…¥å£ç‚¹</span>

}
</code></pre>
<p>}</p>
</blockquote>
<h4 data-id="heading-5">1.3 åŒ…çš„ä½¿ç”¨ï¼šç»„ç»‡å¤šä¸ªæ¨¡å—ï¼Œå®ç°åŠŸèƒ½åˆ†ç±»</h4>
<p>å½“è‡ªå®šä¹‰æ¨¡å—è¶Šæ¥è¶Šå¤šï¼ˆæ¯”å¦‚10ä¸ªã€20ä¸ªï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨â€œåŒ…â€å°†å®ƒä»¬æŒ‰åŠŸèƒ½åˆ†ç±»ï¼ˆæ¯”å¦‚æ•°æ®å¤„ç†ç›¸å…³çš„æ¨¡å—æ”¾åœ¨ä¸€ä¸ªåŒ…ï¼Œå·¥å…·ç±»æ¨¡å—æ”¾åœ¨å¦ä¸€ä¸ªåŒ…ï¼‰ã€‚åŒ…çš„æ ¸å¿ƒæ˜¯â€œç›®å½•+<strong>init</strong>.pyæ–‡ä»¶â€ã€‚</p>
<p>ç¤ºä¾‹ï¼ˆåŒ…çš„åˆ›å»ºä¸å¯¼å…¥ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåŒ…ï¼ˆç›®å½•ç»“æ„å¦‚ä¸‹ï¼‰</span>
<span class="hljs-comment"># my_package/  # åŒ…ç›®å½•</span>
<span class="hljs-comment">#     __init__.py  # å¿…é¡»æœ‰ï¼Œå¯ä¸ºç©ºæ–‡ä»¶ï¼ˆæ ‡è¯†è¯¥ç›®å½•æ˜¯PythonåŒ…ï¼‰</span>
<span class="hljs-comment">#     calc_module.py  # æ¨¡å—1ï¼šè®¡ç®—ç›¸å…³å‡½æ•°</span>
<span class="hljs-comment">#     tool_module.py  # æ¨¡å—2ï¼šå·¥å…·ç›¸å…³å‡½æ•°</span>

<span class="hljs-comment"># ç¬¬äºŒæ­¥ï¼šç¼–å†™åŒ…å†…æ¨¡å—çš„ä»£ç </span>
<span class="hljs-comment"># ------------------ calc_module.py å†…å®¹ ------------------</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a * b

<span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a / b <span class="hljs-keyword">if</span> b != <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"é™¤æ•°ä¸èƒ½ä¸º0"</span>
<span class="hljs-comment"># ------------------------------------------------------</span>

<span class="hljs-comment"># ------------------ tool_module.py å†…å®¹ ------------------</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_info</span>(<span class="hljs-params">info</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ã€ä¿¡æ¯ã€‘ï¼š<span class="hljs-subst">{info}</span>"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">is_positive</span>(<span class="hljs-params">num</span>):
    <span class="hljs-keyword">return</span> num &gt; <span class="hljs-number">0</span>
<span class="hljs-comment"># ------------------------------------------------------</span>

<span class="hljs-comment"># ç¬¬ä¸‰æ­¥ï¼šå¯¼å…¥åŒ…ä¸­çš„æ¨¡å—ï¼Œä½¿ç”¨å…¶ä¸­çš„å†…å®¹</span>
<span class="hljs-comment"># æ–¹å¼1ï¼šå¯¼å…¥åŒ…ä¸­çš„æŸä¸ªæ¨¡å—</span>
<span class="hljs-keyword">from</span> my_package <span class="hljs-keyword">import</span> calc_module, tool_module

<span class="hljs-built_in">print</span>(<span class="hljs-string">"3Ã—5 ="</span>, calc_module.multiply(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))  <span class="hljs-comment"># è¾“å‡º15</span>
tool_module.print_info(<span class="hljs-string">"PythonåŒ…çš„ä½¿ç”¨ç¤ºä¾‹"</span>)  <span class="hljs-comment"># è¾“å‡ºã€ä¿¡æ¯ã€‘ï¼šPythonåŒ…çš„ä½¿ç”¨ç¤ºä¾‹</span>

<span class="hljs-comment"># æ–¹å¼2ï¼šå¯¼å…¥åŒ…ä¸­æ¨¡å—çš„æŒ‡å®šå‡½æ•°</span>
<span class="hljs-keyword">from</span> my_package.calc_module <span class="hljs-keyword">import</span> multiply
<span class="hljs-keyword">from</span> my_package.tool_module <span class="hljs-keyword">import</span> is_positive

<span class="hljs-built_in">print</span>(<span class="hljs-string">"4Ã—6 ="</span>, multiply(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>))  <span class="hljs-comment"># è¾“å‡º24</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"5æ˜¯å¦ä¸ºæ­£æ•°ï¼š"</span>, is_positive(<span class="hljs-number">5</span>))  <span class="hljs-comment"># è¾“å‡ºTrue</span>

<span class="hljs-comment"># æ–¹å¼3ï¼šç»™åŒ…/æ¨¡å—æŒ‡å®šåˆ«å</span>
<span class="hljs-keyword">from</span> my_package <span class="hljs-keyword">import</span> tool_module <span class="hljs-keyword">as</span> tm
tm.print_info(<span class="hljs-string">"åˆ«åå¯¼å…¥ç¤ºä¾‹"</span>)  <span class="hljs-comment"># è¾“å‡ºã€ä¿¡æ¯ã€‘ï¼šåˆ«åå¯¼å…¥ç¤ºä¾‹</span>
</code></pre>
<h4 data-id="heading-6">1.4 å¸¸ç”¨å†…ç½®æ¨¡å—ï¼ˆæ–°æ‰‹å¿…å­¦ï¼Œç›´æ¥å¯ç”¨ï¼‰</h4>
<p>Pythonå†…ç½®äº†å¤§é‡å®ç”¨æ¨¡å—ï¼Œæ— éœ€è‡ªå·±ç¼–å†™ï¼Œå¯¼å…¥å³å¯ä½¿ç”¨ï¼Œæ–°æ‰‹é‡ç‚¹æŒæ¡ä»¥ä¸‹5ä¸ªï¼Œèƒ½è§£å†³80%çš„åŸºç¡€ç¼–ç¨‹åœºæ™¯ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. randomï¼šéšæœºæ•°æ¨¡å—ï¼ˆå¸¸ç”¨ï¼‰</span>
<span class="hljs-keyword">import</span> random
<span class="hljs-built_in">print</span>(<span class="hljs-string">"éšæœºæ•´æ•°ï¼ˆ1-100ï¼‰ï¼š"</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"éšæœºé€‰æ‹©å…ƒç´ ï¼š"</span>, random.choice([<span class="hljs-string">"è‹¹æœ"</span>, <span class="hljs-string">"é¦™è•‰"</span>, <span class="hljs-string">"æ©™å­"</span>]))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ‰“ä¹±åˆ—è¡¨ï¼š"</span>, random.shuffle([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]))  <span class="hljs-comment"># åŸåœ°æ‰“ä¹±</span>

<span class="hljs-comment"># 2. datetimeï¼šæ—¥æœŸæ—¶é—´æ¨¡å—ï¼ˆå¸¸ç”¨ï¼‰</span>
<span class="hljs-keyword">import</span> datetime
now = datetime.datetime.now()  <span class="hljs-comment"># è·å–å½“å‰æ—¶é—´</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰æ—¶é—´ï¼š"</span>, now)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ ¼å¼åŒ–æ—¶é—´ï¼ˆå¹´-æœˆ-æ—¥ï¼‰ï¼š"</span>, now.strftime(<span class="hljs-string">"%Y-%m-%d"</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"3å¤©åçš„æ—¥æœŸï¼š"</span>, now + datetime.timedelta(days=<span class="hljs-number">3</span>))

<span class="hljs-comment"># 3. mathï¼šæ•°å­¦æ¨¡å—ï¼ˆå¸¸ç”¨ï¼‰</span>
<span class="hljs-keyword">import</span> math
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åœ†å‘¨ç‡ï¼š"</span>, math.pi)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"16çš„å¹³æ–¹æ ¹ï¼š"</span>, math.sqrt(<span class="hljs-number">16</span>))  <span class="hljs-comment"># 4.0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç»å¯¹å€¼ï¼š"</span>, math.fabs(-<span class="hljs-number">5.2</span>))  <span class="hljs-comment"># 5.2</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ­£å¼¦å€¼ï¼ˆå¼§åº¦ï¼‰ï¼š"</span>, math.sin(math.pi/<span class="hljs-number">2</span>))  <span class="hljs-comment"># 1.0</span>

<span class="hljs-comment"># 4. osï¼šæ“ä½œç³»ç»Ÿç›¸å…³æ¨¡å—ï¼ˆæ–‡ä»¶è·¯å¾„ã€ç›®å½•æ“ä½œï¼‰</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰ç›®å½•è·¯å¾„ï¼š"</span>, os.getcwd())  <span class="hljs-comment"># è·å–å½“å‰å·¥ä½œç›®å½•</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š"</span>, os.listdir())  <span class="hljs-comment"># åˆ—å‡ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶/ç›®å½•</span>
<span class="hljs-comment"># os.mkdir("test_dir")  # åˆ›å»ºä¸€ä¸ªåä¸ºtest_dirçš„ç›®å½•ï¼ˆéœ€ç¡®ä¿ç›®å½•ä¸å­˜åœ¨ï¼‰</span>

<span class="hljs-comment"># 5. sysï¼šç³»ç»Ÿç›¸å…³æ¨¡å—ï¼ˆç®€å•äº†è§£ï¼‰</span>
<span class="hljs-keyword">import</span> sys
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Pythonç‰ˆæœ¬ï¼š"</span>, sys.version)  <span class="hljs-comment"># æŸ¥çœ‹Pythonç‰ˆæœ¬</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å‘½ä»¤è¡Œå‚æ•°ï¼š"</span>, sys.argv)  <span class="hljs-comment"># æŸ¥çœ‹å‘½ä»¤è¡Œå‚æ•°</span>
</code></pre>
<h4 data-id="heading-7">1.5 æ–°æ‰‹é¿å‘æŒ‡å—ï¼ˆæ¨¡å—ä¸åŒ…å¿…çœ‹ï¼‰</h4>
<ul>
<li>é¿å‘1ï¼šè‡ªå®šä¹‰æ¨¡å—åã€åŒ…åï¼Œä¸è¦ä¸Pythonå†…ç½®æ¨¡å—åé‡åï¼ˆæ¯”å¦‚ä¸è¦å‘½åä¸ºrandom.pyã€math.pyï¼‰ï¼Œå¦åˆ™ä¼šè¦†ç›–å†…ç½®æ¨¡å—ï¼Œå¯¼è‡´æŠ¥é”™ï¼›</li>
<li>é¿å‘2ï¼šå¯¼å…¥æ¨¡å—æ—¶ï¼Œè‹¥æ¨¡å—ä¸åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œä¼šæŠ¥é”™â€”â€”è§£å†³æ–¹æ¡ˆï¼šå°†æ¨¡å—æ‰€åœ¨ç›®å½•æ·»åŠ åˆ°Pythonçš„æœç´¢è·¯å¾„ï¼Œæˆ–æŠŠæ¨¡å—æ”¾åœ¨å½“å‰è¿è¡Œæ–‡ä»¶åŒä¸€ç›®å½•ï¼›</li>
<li>é¿å‘3ï¼šåŒ…ç›®å½•ä¸‹å¿…é¡»æœ‰ <code>__init__.py</code> æ–‡ä»¶ï¼ˆå¯ä¸ºç©ºï¼‰ï¼Œå¦åˆ™Pythonä¸ä¼šå°†å…¶è¯†åˆ«ä¸ºåŒ…ï¼Œæ— æ³•å¯¼å…¥ï¼›</li>
<li>é¿å‘4ï¼šå°½é‡é¿å…ä½¿ç”¨ <code>from æ¨¡å—å import *</code>ï¼Œå®¹æ˜“å‡ºç°å‘½åå†²çªï¼Œæ¨èæŒ‰éœ€å¯¼å…¥ï¼ˆfrom æ¨¡å—å import å‡½æ•°åï¼‰ï¼›</li>
<li>é¿å‘5ï¼š<code>if __name__ == "__main__":</code> ä»…ç”¨äºæ¨¡å—è‡ªæµ‹ï¼Œå¯¼å…¥æ¨¡å—æ—¶ä¸ä¼šæ‰§è¡Œï¼Œä¸è¦ä¾èµ–å®ƒå®ç°æ ¸å¿ƒåŠŸèƒ½ã€‚</li>
</ul>
<h3 data-id="heading-8">2 æ–‡ä»¶æ“ä½œï¼šå®ç°æ•°æ®æŒä¹…åŒ–ï¼Œè®©æ•°æ®â€œå­˜å¾—ä½â€</h3>
<p>åœ¨å‰é¢çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å¤„ç†çš„æ•°æ®ï¼ˆæ¯”å¦‚åˆ—è¡¨ã€å­—å…¸ã€å˜é‡ï¼‰ï¼Œéƒ½æ˜¯â€œä¸´æ—¶æ•°æ®â€â€”â€”ç¨‹åºè¿è¡Œç»“æŸåï¼Œæ•°æ®å°±ä¼šè¢«é”€æ¯ã€‚è€Œå®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å°†æ•°æ®â€œä¿å­˜åˆ°æ–‡ä»¶ä¸­â€ï¼ˆæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€æ—¥å¿—ã€æ•°æ®ç»“æœï¼‰ï¼Œä¹Ÿéœ€è¦ä»æ–‡ä»¶ä¸­â€œè¯»å–æ•°æ®â€â€”â€”è¿™å°±æ˜¯ã€Œæ–‡ä»¶æ“ä½œã€çš„æ ¸å¿ƒä½œç”¨ï¼šå®ç°æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚</p>
<p>Pythonä¸­æ–‡ä»¶æ“ä½œçš„æ ¸å¿ƒæ˜¯ <code>open()</code> å‡½æ•°ï¼Œç”¨äºæ‰“å¼€æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ç›¸å…³æ–¹æ³•å®ç°è¯»å–ã€å†™å…¥ã€å…³é—­ï¼Œé‡ç‚¹æŒæ¡â€œæ‰“å¼€â†’æ“ä½œâ†’å…³é—­â€çš„æµç¨‹ï¼Œä»¥åŠæ›´ç®€æ´ã€å®‰å…¨çš„ <code>with</code> ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚</p>
<h4 data-id="heading-9">2.1 æ–‡ä»¶æ“ä½œçš„æ ¸å¿ƒæµç¨‹ï¼šæ‰“å¼€â†’è¯»å–/å†™å…¥â†’å…³é—­</h4>
<p>æ–‡ä»¶æ“ä½œå¿…é¡»éµå¾ªâ€œæ‰“å¼€æ–‡ä»¶â†’æ“ä½œæ–‡ä»¶ï¼ˆè¯»/å†™ï¼‰â†’å…³é—­æ–‡ä»¶â€çš„æµç¨‹â€”â€”å…³é—­æ–‡ä»¶æ˜¯é‡ä¸­ä¹‹é‡ï¼Œè‹¥å¿˜è®°å…³é—­ï¼Œä¼šå¯¼è‡´æ–‡ä»¶èµ„æºæ³„éœ²ã€æ–‡ä»¶è¢«å ç”¨ï¼ˆæ— æ³•å†æ¬¡æ‰“å¼€ï¼‰ï¼Œç”šè‡³æ•°æ®ä¸¢å¤±ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ ¸å¿ƒè¯­æ³•ï¼šopen(æ–‡ä»¶è·¯å¾„, æ‰“å¼€æ¨¡å¼, encoding=ç¼–ç æ ¼å¼)</span>
<span class="hljs-comment"># 1. æ‰“å¼€æ–‡ä»¶ï¼ˆä»¥è¯»å–æ¨¡å¼æ‰“å¼€ï¼Œencoding='utf-8'é¿å…ä¸­æ–‡ä¹±ç ï¼‰</span>
<span class="hljs-comment"># æ³¨æ„ï¼šè‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œræ¨¡å¼ä¼šæŠ¥é”™</span>
file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>)

<span class="hljs-comment"># 2. è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆä¸‰ç§å¸¸ç”¨æ–¹å¼ï¼‰</span>
<span class="hljs-comment"># æ–¹å¼1ï¼šread()ï¼šè¯»å–å…¨éƒ¨å†…å®¹ï¼Œè¿”å›å­—ç¬¦ä¸²</span>
content1 = file.read()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"read()è¯»å–å…¨éƒ¨å†…å®¹ï¼š"</span>, content1)

<span class="hljs-comment"># æ–¹å¼2ï¼šreadline()ï¼šè¯»å–ä¸€è¡Œå†…å®¹ï¼Œæ¯æ¬¡è°ƒç”¨è¯»å–ä¸‹ä¸€è¡Œ</span>
file.seek(<span class="hljs-number">0</span>)  <span class="hljs-comment"># é‡ç½®æ–‡ä»¶æŒ‡é’ˆåˆ°å¼€å¤´ï¼ˆå¦åˆ™ä¼šä»ä¸Šæ¬¡è¯»å–çš„ä½ç½®ç»§ç»­ï¼‰</span>
content2 = file.readline()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"readline()è¯»å–ç¬¬ä¸€è¡Œï¼š"</span>, content2)
content3 = file.readline()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"readline()è¯»å–ç¬¬äºŒè¡Œï¼š"</span>, content3)

<span class="hljs-comment"># æ–¹å¼3ï¼šreadlines()ï¼šè¯»å–æ‰€æœ‰è¡Œï¼Œè¿”å›åˆ—è¡¨ï¼ˆæ¯è¡Œä¸ºä¸€ä¸ªå…ƒç´ ï¼‰</span>
file.seek(<span class="hljs-number">0</span>)
content4 = file.readlines()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"readlines()è¯»å–æ‰€æœ‰è¡Œï¼š"</span>, content4)  <span class="hljs-comment"># è¾“å‡ºï¼š['ç¬¬ä¸€è¡Œå†…å®¹\n', 'ç¬¬äºŒè¡Œå†…å®¹\n', 'ç¬¬ä¸‰è¡Œå†…å®¹']</span>

<span class="hljs-comment"># 3. å…³é—­æ–‡ä»¶ï¼ˆå¿…é¡»æ‰§è¡Œï¼Œå¦åˆ™ä¼šå¯¼è‡´èµ„æºæ³„éœ²ï¼‰</span>
file.close()

<span class="hljs-comment"># è¡¥å……ï¼šå†™å…¥æ–‡ä»¶ï¼ˆwæ¨¡å¼ï¼šè¦†ç›–å†™å…¥ï¼Œè‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</span>
file2 = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
file2.write(<span class="hljs-string">"è¿™æ˜¯è¦†ç›–å†™å…¥çš„å†…å®¹\n"</span>)  <span class="hljs-comment"># å†™å…¥å­—ç¬¦ä¸²</span>
file2.write(<span class="hljs-string">"è¿™æ˜¯ç¬¬äºŒè¡Œå†™å…¥çš„å†…å®¹"</span>)
file2.close()  <span class="hljs-comment"># å…³é—­æ–‡ä»¶åï¼Œå†™å…¥å†…å®¹æ‰ä¼šç”Ÿæ•ˆ</span>

<span class="hljs-comment"># è¡¥å……ï¼šè¿½åŠ å†™å…¥ï¼ˆaæ¨¡å¼ï¼šåœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ ï¼Œä¸è¦†ç›–åŸæœ‰å†…å®¹ï¼‰</span>
file3 = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"a"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
file3.write(<span class="hljs-string">"\nè¿™æ˜¯è¿½åŠ çš„å†…å®¹"</span>)
file3.close()
</code></pre>
<h4 data-id="heading-10">2.2 å…³é”®çŸ¥è¯†ç‚¹ï¼šæ‰“å¼€æ¨¡å¼ï¼ˆå¿…è®°ï¼‰</h4>
<p>open()å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°â€œæ‰“å¼€æ¨¡å¼â€ï¼Œå†³å®šäº†æ–‡ä»¶æ“ä½œçš„ç±»å‹ï¼ˆè¯»/å†™/è¿½åŠ ï¼‰ï¼Œæ–°æ‰‹é‡ç‚¹è®°ä»¥ä¸‹6ç§å¸¸ç”¨æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¸¸ç”¨æ‰“å¼€æ¨¡å¼ï¼ˆæ ¸å¿ƒå¿…è®°ï¼‰</span>
<span class="hljs-comment"># 1. rï¼šåªè¯»æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼Œè‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™æŠ¥é”™ï¼Œåªèƒ½è¯»å–ï¼Œä¸èƒ½å†™å…¥</span>
<span class="hljs-comment"># 2. wï¼šè¦†ç›–å†™å…¥æ¨¡å¼ï¼Œè‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œè‹¥æ–‡ä»¶å­˜åœ¨åˆ™è¦†ç›–åŸæœ‰å†…å®¹</span>
<span class="hljs-comment"># 3. aï¼šè¿½åŠ å†™å…¥æ¨¡å¼ï¼Œè‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå†™å…¥å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾</span>
<span class="hljs-comment"># 4. r+ï¼šè¯»å†™æ¨¡å¼ï¼Œæ—¢èƒ½è¯»å–ï¼Œä¹Ÿèƒ½å†™å…¥ï¼ˆä¸ä¼šè¦†ç›–åŸæœ‰å†…å®¹ï¼Œä»æŒ‡é’ˆä½ç½®å¼€å§‹å†™å…¥ï¼‰</span>
<span class="hljs-comment"># 5. w+ï¼šè¯»å†™æ¨¡å¼ï¼Œè¦†ç›–å†™å…¥ï¼ˆè‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰ï¼Œæ—¢èƒ½å†™ä¹Ÿèƒ½è¯»</span>
<span class="hljs-comment"># 6. a+ï¼šè¯»å†™æ¨¡å¼ï¼Œè¿½åŠ å†™å…¥ï¼Œæ—¢èƒ½å†™ä¹Ÿèƒ½è¯»</span>

<span class="hljs-comment"># ç¤ºä¾‹ï¼šr+æ¨¡å¼ï¼ˆè¯»å†™ï¼‰</span>
file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r+"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
content = file.read()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"è¯»å–å†…å®¹ï¼š"</span>, content)
file.write(<span class="hljs-string">"\nr+æ¨¡å¼å†™å…¥çš„å†…å®¹"</span>)  <span class="hljs-comment"># åœ¨æ–‡ä»¶æœ«å°¾å†™å…¥ï¼ˆå› ä¸ºæŒ‡é’ˆåœ¨è¯»å–ååˆ°äº†æœ«å°¾ï¼‰</span>
file.close()

<span class="hljs-comment"># ç¤ºä¾‹ï¼šw+æ¨¡å¼ï¼ˆè¦†ç›–è¯»å†™ï¼‰</span>
file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test2.txt"</span>, <span class="hljs-string">"w+"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
file.write(<span class="hljs-string">"w+æ¨¡å¼è¦†ç›–å†™å…¥çš„å†…å®¹"</span>)
file.seek(<span class="hljs-number">0</span>)  <span class="hljs-comment"># é‡ç½®æŒ‡é’ˆåˆ°å¼€å¤´ï¼Œå¦åˆ™è¯»å–ä¸åˆ°å†…å®¹</span>
content = file.read()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"w+æ¨¡å¼è¯»å–å†…å®¹ï¼š"</span>, content)
file.close()
</code></pre>
<h4 data-id="heading-11">2.3 withä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼šè‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼Œæ›´ç®€æ´ã€æ›´å®‰å…¨</h4>
<p>æ–°æ‰‹æœ€å®¹æ˜“è¸©çš„å‘ï¼šå¿˜è®°å…³é—­æ–‡ä»¶ï¼ˆfile.close()ï¼‰ï¼Œå¯¼è‡´æ–‡ä»¶èµ„æºæ³„éœ²ã€‚è€Œ <code>with</code> ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œèƒ½å¸®æˆ‘ä»¬è‡ªåŠ¨å…³é—­æ–‡ä»¶â€”â€”è¿›å…¥withä»£ç å—æ—¶ï¼Œè‡ªåŠ¨æ‰“å¼€æ–‡ä»¶ï¼›é€€å‡ºwithä»£ç å—æ—¶ï¼Œè‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼ˆæ— è®ºä»£ç æ˜¯å¦æŠ¥é”™ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨close()ï¼Œæ˜¯æ–‡ä»¶æ“ä½œçš„â€œé¦–é€‰æ–¹å¼â€ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># withä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆè¯»å–æ–‡ä»¶ï¼Œæ¨èç”¨æ³•ï¼‰</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-comment"># ç¼©è¿›å†…çš„ä»£ç çš„æ˜¯æ–‡ä»¶æ“ä½œèŒƒå›´ï¼Œé€€å‡ºç¼©è¿›åï¼Œæ–‡ä»¶è‡ªåŠ¨å…³é—­</span>
    content = file.read()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"withè¯»å–æ–‡ä»¶ï¼š"</span>, content)
<span class="hljs-comment"># é€€å‡ºwithåï¼Œæ–‡ä»¶å·²è‡ªåŠ¨å…³é—­ï¼Œæ— éœ€æ‰‹åŠ¨close()</span>
<span class="hljs-comment"># print(file.read())  # æŠ¥é”™ï¼šæ–‡ä»¶å·²å…³é—­ï¼Œæ— æ³•è¯»å–</span>

<span class="hljs-comment"># withå†™å…¥æ–‡ä»¶ï¼ˆè¦†ç›–å†™å…¥ï¼‰</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test3.txt"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    file.write(<span class="hljs-string">"withæ¨¡å¼å†™å…¥çš„å†…å®¹\n"</span>)
    file.write(<span class="hljs-string">"è‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ"</span>)

<span class="hljs-comment"># withè¿½åŠ å†™å…¥</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test3.txt"</span>, <span class="hljs-string">"a"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    file.write(<span class="hljs-string">"\nè¿½åŠ å†™å…¥çš„å†…å®¹"</span>)

<span class="hljs-comment"># withåŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶ï¼ˆæ¯”å¦‚å¤åˆ¶æ–‡ä»¶å†…å®¹ï¼‰</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test3.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> read_file, \
     <span class="hljs-built_in">open</span>(<span class="hljs-string">"test4.txt"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> write_file:
    <span class="hljs-comment"># è¯»å–test3.txtçš„å†…å®¹ï¼Œå†™å…¥test4.txtï¼ˆå®ç°æ–‡ä»¶å¤åˆ¶ï¼‰</span>
    content = read_file.read()
    write_file.write(content)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ–‡ä»¶å¤åˆ¶å®Œæˆï¼"</span>)
</code></pre>
<p>æ ¸å¿ƒä¼˜åŠ¿ï¼šç”¨withæ“ä½œæ–‡ä»¶ï¼Œæ—¢ç®€æ´ï¼ˆå°‘å†™close()ï¼‰ï¼Œåˆå®‰å…¨ï¼ˆå³ä½¿ä»£ç å—ä¸­æŠ¥é”™ï¼Œä¹Ÿä¼šè‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼‰ï¼Œæ–°æ‰‹å…¨ç¨‹ä¼˜å…ˆä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</p>
<h4 data-id="heading-12">2.4 æ–‡ä»¶è·¯å¾„ï¼šæ‰¾åˆ°æ–‡ä»¶çš„â€œå‡†ç¡®ä½ç½®â€</h4>
<p>æ–‡ä»¶æ“ä½œæ—¶ï¼Œè‹¥æ–‡ä»¶ä¸åœ¨å½“å‰è¿è¡Œç›®å½•ä¸‹ï¼Œç›´æ¥å†™æ–‡ä»¶åä¼šæŠ¥é”™â€”â€”æ­¤æ—¶éœ€è¦æŒ‡å®šâ€œæ–‡ä»¶è·¯å¾„â€ï¼Œæ–‡ä»¶è·¯å¾„åˆ†ä¸ºä¸¤ç§ï¼šç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. ç›¸å¯¹è·¯å¾„ï¼ˆå¸¸ç”¨ï¼‰ï¼šä»¥å½“å‰è¿è¡Œæ–‡ä»¶çš„ç›®å½•ä¸ºåŸºå‡†ï¼ŒæŸ¥æ‰¾æ–‡ä»¶</span>
<span class="hljs-comment"># ç¤ºä¾‹1ï¼šæ–‡ä»¶åœ¨å½“å‰ç›®å½•ä¸‹ï¼ˆç›´æ¥å†™æ–‡ä»¶åï¼‰</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šæ–‡ä»¶åœ¨å½“å‰ç›®å½•çš„å­ç›®å½•ä¸‹ï¼ˆæ¯”å¦‚dataç›®å½•ä¸‹ï¼‰</span>
<span class="hljs-comment"># ç›®å½•ç»“æ„ï¼šå½“å‰æ–‡ä»¶ â†’ data â†’ test5.txt</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"data/test5.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># ç¤ºä¾‹3ï¼šæ–‡ä»¶åœ¨å½“å‰ç›®å½•çš„ä¸Šçº§ç›®å½•ä¸‹</span>
<span class="hljs-comment"># ç›®å½•ç»“æ„ï¼šä¸Šçº§ç›®å½• â†’ å½“å‰æ–‡ä»¶ç›®å½• â†’ å½“å‰æ–‡ä»¶ï¼›ä¸Šçº§ç›®å½• â†’ test6.txt</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"../test6.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>  <span class="hljs-comment"># ../ è¡¨ç¤ºä¸Šçº§ç›®å½•</span>

<span class="hljs-comment"># 2. ç»å¯¹è·¯å¾„ï¼ˆç²¾å‡†ï¼Œä¸ä¼šå‡ºé”™ï¼‰ï¼šä»ç”µè„‘çš„æ ¹ç›®å½•å¼€å§‹ï¼ŒæŒ‡å®šå®Œæ•´è·¯å¾„</span>
<span class="hljs-comment"># Windowsç³»ç»Ÿï¼ˆæ³¨æ„è·¯å¾„ä¸­çš„åæ–œæ ç”¨\\ï¼Œæˆ–ç”¨æ­£æ–œæ /ï¼‰</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"D:\\Python\\test7.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>
<span class="hljs-comment"># æˆ–</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"D:/Python/test7.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># Mac/Linuxç³»ç»Ÿï¼ˆè·¯å¾„ç”¨æ­£æ–œæ /ï¼‰</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"/Users/xxx/Python/test7.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># è¡¥å……ï¼šç”¨osæ¨¡å—è·å–å½“å‰è·¯å¾„ï¼Œé¿å…è·¯å¾„é”™è¯¯ï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-comment"># è·å–å½“å‰è¿è¡Œæ–‡ä»¶çš„ç›®å½•è·¯å¾„</span>
current_dir = os.path.dirname(os.path.abspath(__file__))
<span class="hljs-comment"># æ‹¼æ¥æ–‡ä»¶è·¯å¾„ï¼ˆå…¼å®¹Windowså’ŒMac/Linuxï¼‰</span>
file_path = os.path.join(current_dir, <span class="hljs-string">"test.txt"</span>)
<span class="hljs-comment"># ä½¿ç”¨æ‹¼æ¥åçš„è·¯å¾„æ‰“å¼€æ–‡ä»¶</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    content = file.read()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"é€šè¿‡osæ¨¡å—æ‹¼æ¥è·¯å¾„è¯»å–ï¼š"</span>, content)
</code></pre>
<h4 data-id="heading-13">2.5 æ–°æ‰‹é¿å‘æŒ‡å—ï¼ˆæ–‡ä»¶æ“ä½œå¿…çœ‹ï¼‰</h4>
<ul>
<li>é¿å‘1ï¼šæ“ä½œä¸­æ–‡æ–‡ä»¶æ—¶ï¼Œå¿…é¡»æŒ‡å®š <code>encoding="utf-8"</code>ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸­æ–‡ä¹±ç æˆ–æŠ¥é”™ï¼›</li>
<li>é¿å‘2ï¼šå¿˜è®°å…³é—­æ–‡ä»¶â€”â€”ä¼˜å…ˆä½¿ç”¨withä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œï¼›</li>
<li>é¿å‘3ï¼šwæ¨¡å¼æ˜¯â€œè¦†ç›–å†™å…¥â€ï¼Œæ…ç”¨ï¼ä¸€æ—¦ä½¿ç”¨wæ¨¡å¼æ‰“å¼€å·²æœ‰æ–‡ä»¶ï¼ŒåŸæœ‰å†…å®¹ä¼šè¢«å…¨éƒ¨æ¸…ç©ºï¼Œæ— æ³•æ¢å¤ï¼›</li>
<li>é¿å‘4ï¼šè¯»å–æ–‡ä»¶åï¼Œæ–‡ä»¶æŒ‡é’ˆä¼šç§»åŠ¨åˆ°è¯»å–ç»“æŸçš„ä½ç½®ï¼Œå†æ¬¡è¯»å–ä¼šè¯»å–ä¸åˆ°å†…å®¹ï¼Œéœ€ç”¨ <code>file.seek(0)</code> é‡ç½®æŒ‡é’ˆï¼›</li>
<li>é¿å‘5ï¼šæ–‡ä»¶è·¯å¾„é”™è¯¯â€”â€”è‹¥æ–‡ä»¶ä¸åœ¨å½“å‰ç›®å½•ï¼Œéœ€æŒ‡å®šç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ï¼Œæ¨èç”¨osæ¨¡å—æ‹¼æ¥è·¯å¾„ï¼Œé¿å…æ‰‹åŠ¨å†™è·¯å¾„å‡ºé”™ï¼›</li>
<li>é¿å‘6ï¼šwithä»£ç å—å¤–ï¼Œæ— æ³•è®¿é—®æ–‡ä»¶å¯¹è±¡ï¼ˆæ–‡ä»¶å·²è‡ªåŠ¨å…³é—­ï¼‰ï¼Œä¸è¦åœ¨withå¤–æ“ä½œæ–‡ä»¶ã€‚</li>
</ul>
<h3 data-id="heading-14">3 å¼‚å¸¸å¤„ç†ï¼šè®©ä»£ç æ›´å¥å£®ï¼Œä»å®¹åº”å¯¹â€œæŠ¥é”™â€</h3>
<p>åœ¨å‰é¢çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å†™çš„ä»£ç ä¸€æ—¦å‡ºç°é”™è¯¯ï¼ˆæ¯”å¦‚æ–‡ä»¶ä¸å­˜åœ¨ã€é™¤ä»¥é›¶ã€è¾“å…¥é”™è¯¯ï¼‰ï¼Œç¨‹åºå°±ä¼šç›´æ¥å´©æºƒï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼ˆæŠ¥é”™ä¿¡æ¯ï¼‰ã€‚è€Œã€Œå¼‚å¸¸å¤„ç†ã€ï¼Œå°±æ˜¯é€šè¿‡ç‰¹å®šçš„è¯­æ³•ï¼Œæ•è·ç¨‹åºè¿è¡Œä¸­çš„å¼‚å¸¸ï¼Œå¤„ç†å¼‚å¸¸ï¼ˆæ¯”å¦‚ç»™å‡ºå‹å¥½æç¤ºï¼‰ï¼Œè®©ç¨‹åºä¸ä¼šå´©æºƒï¼Œç»§ç»­æ‰§è¡Œâ€”â€”è¿™æ˜¯ç¼–å†™â€œå¥å£®ä»£ç â€çš„æ ¸å¿ƒæŠ€èƒ½ã€‚</p>
<p>Pythonä¸­å¼‚å¸¸å¤„ç†çš„æ ¸å¿ƒè¯­æ³•æ˜¯<code>try-except</code>ï¼Œé…åˆ <code>finally</code>ã€<code>raise</code>ï¼Œå®ç°å®Œæ•´çš„å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚</p>
<h4 data-id="heading-15">3.1 åŸºç¡€å¼‚å¸¸å¤„ç†ï¼štry-exceptï¼ˆæ•è·å¼‚å¸¸ï¼‰</h4>
<p>è¯­æ³•é€»è¾‘ï¼šå°è¯•æ‰§è¡Œtryä»£ç å—ä¸­çš„ä»£ç ï¼Œè‹¥å‡ºç°å¼‚å¸¸ï¼Œå°±æ‰§è¡Œexceptä»£ç å—ä¸­çš„ä»£ç ï¼ˆå¤„ç†å¼‚å¸¸ï¼‰ï¼›è‹¥æ²¡æœ‰å¼‚å¸¸ï¼Œå°±è·³è¿‡exceptä»£ç å—ï¼Œæ‰§è¡Œåç»­ä»£ç ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šæ•è·æ‰€æœ‰å¼‚å¸¸ï¼ˆç®€å•ï¼Œä½†ä¸æ¨èï¼Œæ— æ³•å®šä½å…·ä½“å¼‚å¸¸ç±»å‹ï¼‰</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># å°è¯•æ‰§è¡Œçš„ä»£ç ï¼ˆå¯èƒ½ä¼šæŠ¥é”™çš„ä»£ç ï¼‰</span>
    num1 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—ï¼š"</span>))
    num2 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—ï¼š"</span>))
    result = num1 / num2
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç»“æœï¼š<span class="hljs-subst">{num1}</span> Ã· <span class="hljs-subst">{num2}</span> = <span class="hljs-subst">{result}</span>"</span>)
<span class="hljs-keyword">except</span>:
    <span class="hljs-comment"># å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ‰§è¡Œçš„ä»£ç ï¼ˆå¤„ç†å¼‚å¸¸ï¼‰</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å‡ºé”™äº†ï¼è¯·è¾“å…¥æ­£ç¡®çš„æ•°å­—ï¼Œä¸”é™¤æ•°ä¸èƒ½ä¸º0ï¼"</span>)

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šæ•è·æŒ‡å®šç±»å‹çš„å¼‚å¸¸ï¼ˆæ¨èï¼Œèƒ½ç²¾å‡†å¤„ç†ä¸åŒå¼‚å¸¸ï¼‰</span>
<span class="hljs-keyword">try</span>:
    num1 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—ï¼š"</span>))
    num2 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—ï¼š"</span>))
    result = num1 / num2
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç»“æœï¼š<span class="hljs-subst">{num1}</span> Ã· <span class="hljs-subst">{num2}</span> = <span class="hljs-subst">{result}</span>"</span>)
<span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-comment"># æ•è·â€œå€¼é”™è¯¯â€ï¼ˆæ¯”å¦‚è¾“å…¥çš„ä¸æ˜¯æ•°å­—ï¼‰</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å‡ºé”™äº†ï¼è¯·è¾“å…¥æ•´æ•°ç±»å‹çš„æ•°å­—ï¼"</span>)
<span class="hljs-keyword">except</span> ZeroDivisionError:
    <span class="hljs-comment"># æ•è·â€œé™¤ä»¥é›¶é”™è¯¯â€</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å‡ºé”™äº†ï¼é™¤æ•°ä¸èƒ½ä¸º0ï¼Œè¯·é‡æ–°è¾“å…¥ï¼"</span>)

<span class="hljs-comment"># ç¤ºä¾‹3ï¼šæ•è·å¤šä¸ªæŒ‡å®šå¼‚å¸¸ï¼Œç»Ÿä¸€å¤„ç†</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># å°è¯•æ‰“å¼€æ–‡ä»¶è¯»å–</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test_not_exist.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
        content = file.read()
<span class="hljs-keyword">except</span> (FileNotFoundError, UnicodeDecodeError):
    <span class="hljs-comment"># æ•è·â€œæ–‡ä»¶ä¸å­˜åœ¨â€æˆ–â€œç¼–ç é”™è¯¯â€</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å‡ºé”™äº†ï¼æ–‡ä»¶ä¸å­˜åœ¨æˆ–ç¼–ç æ ¼å¼é”™è¯¯ï¼"</span>)

<span class="hljs-comment"># ç¤ºä¾‹4ï¼šæ•è·å¼‚å¸¸ï¼Œå¹¶è·å–å¼‚å¸¸ä¿¡æ¯ï¼ˆä¾¿äºè°ƒè¯•ï¼‰</span>
<span class="hljs-keyword">try</span>:
    num1 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—ï¼š"</span>))
    num2 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—ï¼š"</span>))
    result = num1 / num2
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># e æ˜¯å¼‚å¸¸å¯¹è±¡ï¼Œå­˜å‚¨å¼‚å¸¸ä¿¡æ¯</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å€¼é”™è¯¯ï¼š<span class="hljs-subst">{e}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šinvalid literal for int() with base 10: 'abc'</span>
<span class="hljs-keyword">except</span> ZeroDivisionError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é™¤ä»¥é›¶é”™è¯¯ï¼š<span class="hljs-subst">{e}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šdivision by zero</span>
</code></pre>
<h4 data-id="heading-16">3.2 finallyè¯­å¥ï¼šæ— è®ºæ˜¯å¦å¼‚å¸¸ï¼Œéƒ½å¿…é¡»æ‰§è¡Œ</h4>
<p><code>finally</code> è¯­å¥ç”¨äºå®šä¹‰â€œæ— è®ºæ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œéƒ½å¿…é¡»æ‰§è¡Œçš„ä»£ç â€ï¼Œå¸¸ç”¨åœºæ™¯ï¼šèµ„æºæ¸…ç†ï¼ˆæ¯”å¦‚å…³é—­æ–‡ä»¶ã€æ–­å¼€æ•°æ®åº“è¿æ¥ï¼‰â€”â€”å³ä½¿tryä»£ç å—æŠ¥é”™ï¼Œfinallyä»£ç å—ä¹Ÿä¼šæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šfinallyåŸºæœ¬ç”¨æ³•</span>
<span class="hljs-keyword">try</span>:
    num1 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°å­—ï¼š"</span>))
    num2 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°å­—ï¼š"</span>))
    result = num1 / num2
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç»“æœï¼š<span class="hljs-subst">{result}</span>"</span>)
<span class="hljs-keyword">except</span> ZeroDivisionError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"é™¤æ•°ä¸èƒ½ä¸º0ï¼"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># æ— è®ºæ˜¯å¦å¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œ</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼ˆæ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼‰"</span>)

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šfinallyç”¨äºèµ„æºæ¸…ç†ï¼ˆå³ä½¿æŠ¥é”™ï¼Œä¹Ÿä¼šå…³é—­æ–‡ä»¶ï¼‰</span>
file = <span class="hljs-literal">None</span>
<span class="hljs-keyword">try</span>:
    file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
    content = file.read()
    <span class="hljs-built_in">print</span>(content)
<span class="hljs-keyword">except</span> FileNotFoundError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ–‡ä»¶ä¸å­˜åœ¨ï¼"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># æ— è®ºæ˜¯å¦å¼‚å¸¸ï¼Œéƒ½å…³é—­æ–‡ä»¶ï¼ˆé¿å…èµ„æºæ³„éœ²ï¼‰</span>
    <span class="hljs-keyword">if</span> file:  <span class="hljs-comment"># åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æˆåŠŸæ‰“å¼€</span>
        file.close()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ–‡ä»¶å·²å…³é—­"</span>)

<span class="hljs-comment"># è¡¥å……ï¼šwithä¸Šä¸‹æ–‡ç®¡ç†å™¨å·²è‡ªåŠ¨å¤„ç†å…³é—­æ–‡ä»¶ï¼Œæ— éœ€ç”¨finallyï¼Œä½†å…¶ä»–èµ„æºæ¸…ç†å¯ä½¿ç”¨</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
        content = file.read()
<span class="hljs-keyword">except</span> FileNotFoundError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ–‡ä»¶ä¸å­˜åœ¨ï¼"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ–‡ä»¶æ“ä½œæµç¨‹ç»“æŸ"</span>)
</code></pre>
<h4 data-id="heading-17">3.3 raiseè¯­å¥ï¼šä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæ§åˆ¶ç¨‹åºé€»è¾‘</h4>
<p><code>raise</code> è¯­å¥ç”¨äºâ€œä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸â€â€”â€”å½“æˆ‘ä»¬æ£€æµ‹åˆ°ä¸ç¬¦åˆé¢„æœŸçš„æ¡ä»¶æ—¶ï¼Œä¸»åŠ¨è®©ç¨‹åºæŠ›å‡ºå¼‚å¸¸ï¼Œä¸­æ–­æ‰§è¡Œï¼Œæˆ–è®©ä¸Šå±‚ä»£ç å¤„ç†å¼‚å¸¸ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼ˆåŸºç¡€ç”¨æ³•ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">check_age</span>(<span class="hljs-params">age</span>):
    <span class="hljs-comment"># æ£€æµ‹å¹´é¾„æ˜¯å¦åˆæ³•ï¼Œä¸åˆæ³•åˆ™ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸</span>
    <span class="hljs-keyword">if</span> age &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> age &gt; <span class="hljs-number">120</span>:
        <span class="hljs-comment"># ä¸»åŠ¨æŠ›å‡ºValueErrorå¼‚å¸¸ï¼Œå¹¶æŒ‡å®šå¼‚å¸¸ä¿¡æ¯</span>
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"å¹´é¾„ä¸åˆæ³•ï¼å¹´é¾„å¿…é¡»åœ¨0-120ä¹‹é—´"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¹´é¾„åˆæ³•ï¼š<span class="hljs-subst">{age}</span>å²"</span>)

<span class="hljs-comment"># è°ƒç”¨å‡½æ•°ï¼Œæ•è·ä¸»åŠ¨æŠ›å‡ºçš„å¼‚å¸¸</span>
<span class="hljs-keyword">try</span>:
    check_age(-<span class="hljs-number">5</span>)  <span class="hljs-comment"># ä¸ç¬¦åˆæ¡ä»¶ï¼Œä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸</span>
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ•è·å¼‚å¸¸ï¼š<span class="hljs-subst">{e}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šæ•è·å¼‚å¸¸ï¼šå¹´é¾„ä¸åˆæ³•ï¼å¹´é¾„å¿…é¡»åœ¨0-120ä¹‹é—´</span>

<span class="hljs-keyword">try</span>:
    check_age(<span class="hljs-number">25</span>)  <span class="hljs-comment"># åˆæ³•ï¼Œæ­£å¸¸æ‰§è¡Œ</span>
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ•è·å¼‚å¸¸ï¼š<span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šç»“åˆå‡½æ•°ï¼Œä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæ§åˆ¶é€»è¾‘</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">username, password</span>):
    <span class="hljs-comment"># æ¨¡æ‹Ÿç™»å½•éªŒè¯ï¼Œè‹¥ç”¨æˆ·åæˆ–å¯†ç ä¸ºç©ºï¼Œä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username:
        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"ç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> password:
        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"å¯†ç ä¸èƒ½ä¸ºç©ºï¼"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç™»å½•éªŒè¯é€šè¿‡ï¼Œæ­£åœ¨è¿›å…¥ç³»ç»Ÿ..."</span>)

<span class="hljs-comment"># è°ƒç”¨ç™»å½•å‡½æ•°</span>
<span class="hljs-keyword">try</span>:
    login(<span class="hljs-string">""</span>, <span class="hljs-string">"123456"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç™»å½•å¤±è´¥ï¼š<span class="hljs-subst">{e}</span>"</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šç™»å½•å¤±è´¥ï¼šç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼</span>
</code></pre>
<h4 data-id="heading-18">3.4 æ–°æ‰‹é¿å‘æŒ‡å—ï¼ˆå¼‚å¸¸å¤„ç†å¿…çœ‹ï¼‰</h4>
<ul>
<li>é¿å‘1ï¼šä¸è¦æ»¥ç”¨ <code>except:</code> æ•è·æ‰€æœ‰å¼‚å¸¸â€”â€”æ— æ³•å®šä½å…·ä½“çš„é”™è¯¯ç±»å‹ï¼Œä¸åˆ©äºè°ƒè¯•ï¼Œæ¨èæ•è·æŒ‡å®šç±»å‹çš„å¼‚å¸¸ï¼›</li>
<li>é¿å‘2ï¼šfinallyä»£ç å—ä¸­ä¸è¦å†™returnè¯­å¥â€”â€”ä¼šè¦†ç›–try/exceptä¸­çš„returnå€¼ï¼Œå¯¼è‡´å¼‚å¸¸ä¿¡æ¯ä¸¢å¤±ï¼›</li>
<li>é¿å‘3ï¼šraiseè¯­å¥æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¿…é¡»æœ‰å¯¹åº”çš„exceptæ•è·ï¼Œå¦åˆ™ç¨‹åºä¾ç„¶ä¼šå´©æºƒï¼›</li>
<li>é¿å‘4ï¼šå¼‚å¸¸å¤„ç†çš„æ ¸å¿ƒæ˜¯â€œå¤„ç†å¼‚å¸¸â€ï¼Œä¸æ˜¯â€œéšè—å¼‚å¸¸â€â€”â€”ä¸è¦åªæ•è·å¼‚å¸¸ï¼Œä¸ç»™å‡ºä»»ä½•æç¤ºï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¨‹åºå¼‚å¸¸å´æ— æ³•æ’æŸ¥ï¼›</li>
<li>é¿å‘5ï¼šèµ„æºæ¸…ç†ï¼ˆå¦‚å…³é—­æ–‡ä»¶ï¼‰ï¼Œä¼˜å…ˆç”¨withä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè‹¥æ‰‹åŠ¨æ‰“å¼€æ–‡ä»¶ï¼Œéœ€åœ¨finallyä¸­å…³é—­ï¼Œé¿å…èµ„æºæ³„éœ²ã€‚</li>
</ul>
<h3 data-id="heading-19">4 é¢å‘å¯¹è±¡åŸºç¡€ï¼šè§£é”æ›´çµæ´»çš„ç¼–ç¨‹æ€ç»´</h3>
<p>åœ¨å‰é¢çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ç”¨â€œé¢å‘è¿‡ç¨‹â€çš„æ€ç»´ç¼–å†™ä»£ç â€”â€”æŒ‰æ­¥éª¤æ‹†è§£é—®é¢˜ï¼Œä¸€æ­¥ä¸€æ­¥æ‰§è¡Œï¼ˆæ¯”å¦‚å…ˆå®šä¹‰å‡½æ•°ï¼Œå†è°ƒç”¨å‡½æ•°ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œé€»è¾‘ï¼‰ã€‚è€Œã€Œé¢å‘å¯¹è±¡ã€ï¼Œæ˜¯ä¸€ç§æ›´çµæ´»ã€æ›´è´´è¿‘ç°å®ä¸–ç•Œçš„ç¼–ç¨‹æ€ç»´â€”â€”å°†ç°å®ä¸–ç•Œä¸­çš„äº‹ç‰©ï¼ˆæ¯”å¦‚äººã€æ±½è½¦ã€å­¦ç”Ÿï¼‰æŠ½è±¡æˆâ€œç±»â€ï¼Œç”¨ç±»åˆ›å»ºâ€œå¯¹è±¡â€ï¼Œé€šè¿‡å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å®ç°åŠŸèƒ½ã€‚</p>
<p>é¢å‘å¯¹è±¡çš„æ ¸å¿ƒæ¦‚å¿µï¼š<strong>ç±»ï¼ˆClassï¼‰</strong> å’Œ <strong>å¯¹è±¡ï¼ˆObjectï¼‰</strong>ã€‚ç±»æ˜¯â€œæ¨¡æ¿â€ï¼ˆæ¯”å¦‚â€œå­¦ç”Ÿâ€ç±»ï¼‰ï¼Œå¯¹è±¡æ˜¯â€œæ¨¡æ¿çš„å®ä¾‹â€ï¼ˆæ¯”å¦‚â€œå¼ ä¸‰â€â€œæå››â€è¿™ä¸¤ä¸ªå…·ä½“çš„å­¦ç”Ÿï¼‰ï¼›ç±»ä¸­åŒ…å«â€œå±æ€§â€ï¼ˆäº‹ç‰©çš„ç‰¹å¾ï¼Œæ¯”å¦‚å­¦ç”Ÿçš„å§“åã€å¹´é¾„ï¼‰å’Œâ€œæ–¹æ³•â€ï¼ˆäº‹ç‰©çš„è¡Œä¸ºï¼Œæ¯”å¦‚å­¦ç”Ÿçš„å­¦ä¹ ã€åƒé¥­ï¼‰ã€‚</p>
<h4 data-id="heading-20">4.1 ç±»ä¸å¯¹è±¡ï¼šæ ¸å¿ƒæ¦‚å¿µä¸åˆ›å»º</h4>
<p>Pythonä¸­ç”¨ <code>class</code> å…³é”®å­—å®šä¹‰ç±»ï¼Œç±»åé€šå¸¸é‡‡ç”¨â€œå¤§é©¼å³°å‘½åæ³•â€ï¼ˆé¦–å­—æ¯å¤§å†™ï¼Œå¤šä¸ªå•è¯é¦–å­—æ¯å‡å¤§å†™ï¼Œæ¯”å¦‚Studentã€Personï¼‰ï¼›é€šè¿‡â€œç±»å()â€åˆ›å»ºå¯¹è±¡ï¼ˆå®ä¾‹åŒ–å¯¹è±¡ï¼‰ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šå®šä¹‰ä¸€ä¸ªç®€å•çš„ç±»ï¼ˆStudentç±»ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-comment"># ç±»çš„å±æ€§ï¼ˆå­¦ç”Ÿçš„ç‰¹å¾ï¼‰ï¼šå¯ä»¥ç›´æ¥å®šä¹‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åˆå§‹åŒ–æ–¹æ³•å®šä¹‰</span>
    <span class="hljs-comment"># ç±»å±æ€§ï¼šæ‰€æœ‰å¯¹è±¡å…±äº«çš„å±æ€§ï¼ˆæ¯”å¦‚å­¦ç”Ÿçš„å­¦æ ¡ï¼‰</span>
    school = <span class="hljs-string">"åŒ—äº¬å¤§å­¦"</span>

    <span class="hljs-comment"># ç±»çš„æ–¹æ³•ï¼ˆå­¦ç”Ÿçš„è¡Œä¸ºï¼‰ï¼šå®šä¹‰åœ¨ç±»ä¸­çš„å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯self</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">study</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># self ä»£è¡¨å½“å‰å¯¹è±¡ï¼ˆè°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ï¼‰ï¼Œå¿…é¡»ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span> æ­£åœ¨å­¦ä¹ PythonåŸºç¡€ï¼"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">eat</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span> æ­£åœ¨åƒé¥­ï¼"</span>)

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šåˆ›å»ºå¯¹è±¡ï¼ˆå®ä¾‹åŒ–å¯¹è±¡ï¼‰</span>
<span class="hljs-comment"># åˆ›å»ºç¬¬ä¸€ä¸ªå¯¹è±¡ï¼ˆå¼ ä¸‰ï¼‰</span>
stu1 = Student()
<span class="hljs-comment"># ç»™å¯¹è±¡æ·»åŠ å®ä¾‹å±æ€§ï¼ˆæ¯ä¸ªå¯¹è±¡ç‹¬æœ‰çš„å±æ€§ï¼Œæ¯”å¦‚å§“åã€å¹´é¾„ï¼‰</span>
stu1.name = <span class="hljs-string">"å¼ ä¸‰"</span>
stu1.age = <span class="hljs-number">18</span>
<span class="hljs-comment"># è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•</span>
stu1.study()  <span class="hljs-comment"># è¾“å‡ºï¼šå¼ ä¸‰ æ­£åœ¨å­¦ä¹ PythonåŸºç¡€ï¼</span>
stu1.eat()    <span class="hljs-comment"># è¾“å‡ºï¼šå¼ ä¸‰ æ­£åœ¨åƒé¥­ï¼</span>
<span class="hljs-comment"># è®¿é—®å¯¹è±¡çš„å±æ€§ï¼ˆå®ä¾‹å±æ€§å’Œç±»å±æ€§ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å§“åï¼š<span class="hljs-subst">{stu1.name}</span>ï¼Œå¹´é¾„ï¼š<span class="hljs-subst">{stu1.age}</span>ï¼Œå­¦æ ¡ï¼š<span class="hljs-subst">{stu1.school}</span>"</span>)

<span class="hljs-comment"># åˆ›å»ºç¬¬äºŒä¸ªå¯¹è±¡ï¼ˆæå››ï¼‰</span>
stu2 = Student()
stu2.name = <span class="hljs-string">"æå››"</span>
stu2.age = <span class="hljs-number">19</span>
stu2.study()  <span class="hljs-comment"># è¾“å‡ºï¼šæå›› æ­£åœ¨å­¦ä¹ PythonåŸºç¡€ï¼</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å§“åï¼š<span class="hljs-subst">{stu2.name}</span>ï¼Œå¹´é¾„ï¼š<span class="hljs-subst">{stu2.age}</span>ï¼Œå­¦æ ¡ï¼š<span class="hljs-subst">{stu2.school}</span>"</span>)

<span class="hljs-comment"># è®¿é—®ç±»å±æ€§ï¼ˆé€šè¿‡ç±»åè®¿é—®ï¼Œæ‰€æœ‰å¯¹è±¡å…±äº«ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç±»å±æ€§ï¼ˆå­¦æ ¡ï¼‰ï¼š"</span>, Student.school)
</code></pre>
<p>å…³é”®çŸ¥è¯†ç‚¹ï¼š<code>self</code> â€”â€” ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯selfï¼Œselfä»£è¡¨â€œå½“å‰è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡â€ï¼Œé€šè¿‡selfå¯ä»¥è®¿é—®å¯¹è±¡çš„å±æ€§å’Œå…¶ä»–æ–¹æ³•ï¼Œè°ƒç”¨æ–¹æ³•æ—¶ï¼Œæ— éœ€æ‰‹åŠ¨ä¼ é€’selfå‚æ•°ï¼ˆPythonä¼šè‡ªåŠ¨ä¼ é€’ï¼‰ã€‚</p>
<h4 data-id="heading-21">4.2 __init__åˆå§‹åŒ–æ–¹æ³•ï¼šåˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨åˆå§‹åŒ–å±æ€§</h4>
<p>å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºå¯¹è±¡åï¼Œéœ€è¦æ‰‹åŠ¨ç»™å¯¹è±¡æ·»åŠ å®ä¾‹å±æ€§ï¼ˆstu1.name = "å¼ ä¸‰"ï¼‰ï¼Œéå¸¸ç¹çã€‚è€Œ <code>__init__</code> æ–¹æ³•ï¼ˆåˆå§‹åŒ–æ–¹æ³•ï¼‰ï¼Œæ˜¯ç±»çš„ç‰¹æ®Šæ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡æ—¶ä¼š<strong>è‡ªåŠ¨è°ƒç”¨</strong>ï¼Œç”¨äºåˆå§‹åŒ–å¯¹è±¡çš„å±æ€§â€”â€”ç›¸å½“äºâ€œå¯¹è±¡çš„æ„é€ å‡½æ•°â€ï¼Œèƒ½å¸®æˆ‘ä»¬ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p>
<p>é‡ç‚¹ï¼š<code>__init__</code> å‰åå„æœ‰ä¸¤ä¸ªä¸‹åˆ’çº¿ï¼ˆåŒä¸‹åˆ’çº¿ï¼‰ï¼Œæ˜¯Pythonçš„ç‰¹æ®Šæ–¹æ³•å‘½åè§„èŒƒï¼›ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯selfï¼Œåç»­å‚æ•°ç”¨äºæ¥æ”¶åˆ›å»ºå¯¹è±¡æ—¶ä¼ é€’çš„å±æ€§å€¼ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹ï¼šå®šä¹‰å¸¦æœ‰__init__åˆå§‹åŒ–æ–¹æ³•çš„Studentç±»ï¼ˆæ¨èç”¨æ³•ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-comment"># ç±»å±æ€§ï¼ˆæ‰€æœ‰å¯¹è±¡å…±äº«ï¼‰</span>
    school = <span class="hljs-string">"åŒ—äº¬å¤§å­¦"</span>

    <span class="hljs-comment"># __init__åˆå§‹åŒ–æ–¹æ³•ï¼šåˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œåˆå§‹åŒ–å®ä¾‹å±æ€§</span>
    <span class="hljs-comment"># selfï¼šå¿…é¡»æœ‰ï¼Œä»£è¡¨å½“å‰å¯¹è±¡</span>
    <span class="hljs-comment"># nameã€ageï¼šæ¥æ”¶åˆ›å»ºå¯¹è±¡æ—¶ä¼ é€’çš„å‚æ•°ï¼Œä½œä¸ºå®ä¾‹å±æ€§</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        <span class="hljs-comment"># ç»™å½“å‰å¯¹è±¡æ·»åŠ å®ä¾‹å±æ€§ï¼Œç»‘å®šå‚æ•°å€¼</span>
        self.name = name
        self.age = age
        <span class="hljs-comment"># å¯ä»¥åœ¨__init__ä¸­æ·»åŠ é¢å¤–çš„åˆå§‹åŒ–é€»è¾‘</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"åˆ›å»ºå­¦ç”Ÿå¯¹è±¡ï¼š<span class="hljs-subst">{self.name}</span>ï¼Œ<span class="hljs-subst">{self.age}</span>å²"</span>)

    <span class="hljs-comment"># ç±»ä¸­çš„æ–¹æ³•</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">study</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>ï¼ˆ<span class="hljs-subst">{self.age}</span>å²ï¼‰æ­£åœ¨å­¦ä¹ Pythonç¬¬å…­é˜¶æ®µå†…å®¹ï¼"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">introduce</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># è®¿é—®å®ä¾‹å±æ€§å’Œç±»å±æ€§</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯<span class="hljs-subst">{self.name}</span>ï¼Œä»Šå¹´<span class="hljs-subst">{self.age}</span>å²ï¼Œæ¥è‡ª<span class="hljs-subst">{self.school}</span>"</span>)

<span class="hljs-comment"># åˆ›å»ºå¯¹è±¡ï¼šåˆ›å»ºæ—¶ç›´æ¥ä¼ é€’å‚æ•°ï¼Œ__init__è‡ªåŠ¨è°ƒç”¨ï¼Œåˆå§‹åŒ–å±æ€§</span>
stu1 = Student(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-number">18</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šåˆ›å»ºå­¦ç”Ÿå¯¹è±¡ï¼šå¼ ä¸‰ï¼Œ18å²</span>
stu2 = Student(<span class="hljs-string">"æå››"</span>, <span class="hljs-number">19</span>)  <span class="hljs-comment"># è¾“å‡ºï¼šåˆ›å»ºå­¦ç”Ÿå¯¹è±¡ï¼šæå››ï¼Œ19å²</span>

<span class="hljs-comment"># ç›´æ¥è®¿é—®å¯¹è±¡çš„å®ä¾‹å±æ€§ï¼ˆæ— éœ€æ‰‹åŠ¨æ·»åŠ ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"stu1ï¼š<span class="hljs-subst">{stu1.name}</span>ï¼Œ<span class="hljs-subst">{stu1.age}</span>å²"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"stu2ï¼š<span class="hljs-subst">{stu2.name}</span>ï¼Œ<span class="hljs-subst">{stu2.age}</span>å²"</span>)

<span class="hljs-comment"># è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•</span>
stu1.study()  <span class="hljs-comment"># è¾“å‡ºï¼šå¼ ä¸‰ï¼ˆ18å²ï¼‰æ­£åœ¨å­¦ä¹ Pythonç¬¬å…­é˜¶æ®µå†…å®¹ï¼</span>
stu2.introduce()  <span class="hljs-comment"># è¾“å‡ºï¼šå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æå››ï¼Œä»Šå¹´19å²ï¼Œæ¥è‡ªåŒ—äº¬å¤§å­¦</span>

<span class="hljs-comment"># è¡¥å……ï¼šä¿®æ”¹å®ä¾‹å±æ€§å’Œç±»å±æ€§</span>
stu1.age = <span class="hljs-number">20</span>  <span class="hljs-comment"># ä¿®æ”¹stu1çš„å®ä¾‹å±æ€§ï¼ˆä»…å½±å“stu1ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¼ ä¸‰ä¿®æ”¹åçš„å¹´é¾„ï¼š<span class="hljs-subst">{stu1.age}</span>å²"</span>)
Student.school = <span class="hljs-string">"æ¸…åå¤§å­¦"</span>  <span class="hljs-comment"># ä¿®æ”¹ç±»å±æ€§ï¼ˆæ‰€æœ‰å¯¹è±¡å…±äº«ï¼Œéƒ½ä¼šå½±å“ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"stu1çš„å­¦æ ¡ï¼š<span class="hljs-subst">{stu1.school}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"stu2çš„å­¦æ ¡ï¼š<span class="hljs-subst">{stu2.school}</span>"</span>)
</code></pre>
<p>å…³é”®æé†’ï¼š<code>__init__</code> æ–¹æ³•ä¸æ˜¯â€œæ„é€ å‡½æ•°â€ï¼ŒPythonä¸­å¯¹è±¡çš„åˆ›å»ºç”± <code>__new__</code> æ–¹æ³•å®Œæˆï¼Œ<code>__init__</code> ä»…ç”¨äºå¯¹åˆ›å»ºå¥½çš„å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œæ–°æ‰‹æ— éœ€æ·±ç©¶ <code>__new__</code> æ–¹æ³•ï¼Œé‡ç‚¹æŒæ¡<code>__init__</code> çš„ç”¨æ³•å³å¯ã€‚</p>
<blockquote>
<p>æ„é€ æ–¹æ³•ï¼Œç±»ä¼¼ Javaï¼š</p>
<p>public class MyClass {</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyClass</span>()</span> {  <span class="hljs-comment">// æ„é€ æ–¹æ³•</span>

    <span class="hljs-comment">// åˆå§‹åŒ–ä»£ç </span>

}
</code></pre>
<p>}</p>
</blockquote>
<h4 data-id="heading-22">4.3 ç±»çš„å±æ€§ä¸æ–¹æ³•ï¼šè¯¦ç»†è§£æ</h4>
<p>ç±»ä¸­åŒ…å«ä¸¤ç§æ ¸å¿ƒå…ƒç´ ï¼šå±æ€§ï¼ˆç‰¹å¾ï¼‰å’Œæ–¹æ³•ï¼ˆè¡Œä¸ºï¼‰ï¼ŒæŒ‰ä½œç”¨èŒƒå›´å¯åˆ†ä¸ºâ€œç±»å±æ€§/ç±»æ–¹æ³•â€å’Œâ€œå®ä¾‹å±æ€§/å®ä¾‹æ–¹æ³•â€ï¼Œæ–°æ‰‹é‡ç‚¹æŒæ¡å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹ï¼šè¯¦ç»†åŒºåˆ†å®ä¾‹å±æ€§ã€ç±»å±æ€§ã€å®ä¾‹æ–¹æ³•</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    <span class="hljs-comment"># 1. ç±»å±æ€§ï¼šå®šä¹‰åœ¨ç±»ä¸­ï¼Œä¸åœ¨ä»»ä½•æ–¹æ³•ä¸­ï¼Œæ‰€æœ‰å¯¹è±¡å…±äº«</span>
    species = <span class="hljs-string">"äººç±»"</span>  <span class="hljs-comment"># æ‰€æœ‰Personå¯¹è±¡çš„specieså±æ€§éƒ½æ˜¯â€œäººç±»â€</span>

    <span class="hljs-comment"># 2. __init__åˆå§‹åŒ–æ–¹æ³•ï¼šåˆå§‹åŒ–å®ä¾‹å±æ€§ï¼ˆæ¯ä¸ªå¯¹è±¡ç‹¬æœ‰ï¼‰</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        <span class="hljs-comment"># å®ä¾‹å±æ€§ï¼šå®šä¹‰åœ¨__init__ä¸­ï¼Œé€šè¿‡selfç»‘å®šï¼Œæ¯ä¸ªå¯¹è±¡ç‹¬æœ‰</span>
        self.name = name
        self.age = age

    <span class="hljs-comment"># 3. å®ä¾‹æ–¹æ³•ï¼šå®šä¹‰åœ¨ç±»ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯selfï¼Œåªèƒ½é€šè¿‡å¯¹è±¡è°ƒç”¨</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>ï¼ˆ<span class="hljs-subst">{self.age}</span>å²ï¼‰æ­£åœ¨ç¡è§‰"</span>)

    <span class="hljs-comment"># 4. ç±»æ–¹æ³•ï¼ˆç®€å•äº†è§£ï¼‰ï¼šå®šä¹‰åœ¨ç±»ä¸­ï¼Œç”¨@classmethodè£…é¥°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯clsï¼ˆä»£è¡¨ç±»ï¼‰</span>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">show_species</span>(<span class="hljs-params">cls</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç‰©ç§ï¼š<span class="hljs-subst">{cls.species}</span>"</span>)  <span class="hljs-comment"># é€šè¿‡clsè®¿é—®ç±»å±æ€§</span>

<span class="hljs-comment"># è®¿é—®ç±»å±æ€§ï¼ˆä¸¤ç§æ–¹å¼ï¼‰</span>
<span class="hljs-built_in">print</span>(Person.species)  <span class="hljs-comment"># æ–¹å¼1ï¼šé€šè¿‡ç±»åè®¿é—®ï¼ˆæ¨èï¼‰</span>
p1 = Person(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-number">18</span>)
<span class="hljs-built_in">print</span>(p1.species)      <span class="hljs-comment"># æ–¹å¼2ï¼šé€šè¿‡å¯¹è±¡è®¿é—®ï¼ˆä¸æ¨èï¼Œç±»å±æ€§åº”é€šè¿‡ç±»åè®¿é—®ï¼‰</span>

<span class="hljs-comment"># è®¿é—®å®ä¾‹å±æ€§ï¼ˆåªèƒ½é€šè¿‡å¯¹è±¡è®¿é—®ï¼‰</span>
<span class="hljs-built_in">print</span>(p1.name, p1.age)
<span class="hljs-comment"># print(Person.name)  # æŠ¥é”™ï¼šç±»ä¸èƒ½è®¿é—®å®ä¾‹å±æ€§</span>

<span class="hljs-comment"># è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼ˆåªèƒ½é€šè¿‡å¯¹è±¡è®¿é—®ï¼‰</span>
p1.sleep()

<span class="hljs-comment"># è°ƒç”¨ç±»æ–¹æ³•ï¼ˆä¸¤ç§æ–¹å¼ï¼‰</span>
Person.show_species()  <span class="hljs-comment"># æ–¹å¼1ï¼šé€šè¿‡ç±»åè®¿é—®ï¼ˆæ¨èï¼‰</span>
p1.show_species()      <span class="hljs-comment"># æ–¹å¼2ï¼šé€šè¿‡å¯¹è±¡è®¿é—®</span>

<span class="hljs-comment"># è¡¥å……ï¼šä¿®æ”¹å±æ€§</span>
<span class="hljs-comment"># ä¿®æ”¹ç±»å±æ€§ï¼ˆå½±å“æ‰€æœ‰å¯¹è±¡ï¼‰</span>
Person.species = <span class="hljs-string">"æ™ºäºº"</span>
p2 = Person(<span class="hljs-string">"æå››"</span>, <span class="hljs-number">19</span>)
<span class="hljs-built_in">print</span>(p1.species)  <span class="hljs-comment"># è¾“å‡ºï¼šæ™ºäºº</span>
<span class="hljs-built_in">print</span>(p2.species)  <span class="hljs-comment"># è¾“å‡ºï¼šæ™ºäºº</span>

<span class="hljs-comment"># ä¿®æ”¹å®ä¾‹å±æ€§ï¼ˆä»…å½±å“å½“å‰å¯¹è±¡ï¼‰</span>
p1.age = <span class="hljs-number">20</span>
<span class="hljs-built_in">print</span>(p1.age)  <span class="hljs-comment"># è¾“å‡ºï¼š20</span>
<span class="hljs-built_in">print</span>(p2.age)  <span class="hljs-comment"># è¾“å‡ºï¼š19</span>
</code></pre>
<h4 data-id="heading-23">4.4 æ–°æ‰‹é¿å‘æŒ‡å—ï¼ˆé¢å‘å¯¹è±¡åŸºç¡€å¿…çœ‹ï¼‰</h4>
<ul>
<li>é¿å‘1ï¼š<code>__init__</code> æ–¹æ³•å‰åå¿…é¡»å„æœ‰ä¸¤ä¸ªä¸‹åˆ’çº¿ï¼Œå°‘å†™æˆ–å¤šå†™éƒ½ä¼šå˜æˆæ™®é€šæ–¹æ³•ï¼Œæ— æ³•è‡ªåŠ¨è°ƒç”¨ï¼›</li>
<li>é¿å‘2ï¼šç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯selfï¼ˆå®ä¾‹æ–¹æ³•ï¼‰æˆ–clsï¼ˆç±»æ–¹æ³•ï¼‰ï¼Œå¦åˆ™è°ƒç”¨æ—¶ä¼šæŠ¥é”™ï¼›</li>
<li>é¿å‘3ï¼šå®ä¾‹å±æ€§åªèƒ½é€šè¿‡å¯¹è±¡è®¿é—®ï¼Œç±»ä¸èƒ½è®¿é—®å®ä¾‹å±æ€§ï¼›ç±»å±æ€§å¯ä»¥é€šè¿‡ç±»åæˆ–å¯¹è±¡è®¿é—®ï¼Œä½†æ¨èé€šè¿‡ç±»åè®¿é—®ï¼›</li>
<li>é¿å‘4ï¼šä¿®æ”¹ç±»å±æ€§æ—¶ï¼Œå¿…é¡»é€šè¿‡â€œç±»å.ç±»å±æ€§â€ä¿®æ”¹ï¼Œé€šè¿‡â€œå¯¹è±¡.ç±»å±æ€§â€ä¿®æ”¹ï¼Œæœ¬è´¨æ˜¯ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªåŒåçš„å®ä¾‹å±æ€§ï¼Œä¸ä¼šä¿®æ”¹ç±»å±æ€§ï¼›</li>
<li>é¿å‘5ï¼šä¸è¦æ··æ·†â€œç±»â€å’Œâ€œå¯¹è±¡â€â€”â€”ç±»æ˜¯æ¨¡æ¿ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨æ–¹æ³•/å±æ€§ï¼ˆé™¤ç±»æ–¹æ³•ã€ç±»å±æ€§ï¼‰ï¼Œå¿…é¡»åˆ›å»ºå¯¹è±¡ï¼Œé€šè¿‡å¯¹è±¡ä½¿ç”¨å®ä¾‹æ–¹æ³•å’Œå®ä¾‹å±æ€§ï¼›</li>
<li>é¿å‘6ï¼š<code>__init__</code> æ–¹æ³•ä¸èƒ½æœ‰returnè¯­å¥ï¼ˆé™¤éreturn Noneï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li>
</ul>
<h3 data-id="heading-24">5 æ€»ç»“</h3>
<p>æ­å–œå¤§å®¶ï¼Python3åŸºç¡€å­¦ä¹ ç¬¬å…­é˜¶æ®µã€Œè¿›é˜¶åŸºç¡€ã€çš„æ ¸å¿ƒå†…å®¹ï¼Œåˆ°è¿™é‡Œå°±å…¨éƒ¨æ¢³ç†å®Œæ¯•äº†ï¼è¿™ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬è·³å‡ºäº†â€œåŸºç¡€è¯­æ³•â€çš„èŒƒç•´ï¼Œå­¦ä¹ äº†å››å¤§æ ¸å¿ƒè¿›é˜¶çŸ¥è¯†ç‚¹ï¼Œæ¯ä¸€ä¸ªéƒ½å¯¹åç»­çš„Pythonå­¦ä¹ è‡³å…³é‡è¦ï¼š</p>
<ul>
<li>æ¨¡å—ä¸åŒ…ï¼šå¸®æˆ‘ä»¬ç»„ç»‡ä»£ç ã€å®ç°è·¨æ–‡ä»¶å¤ç”¨ï¼Œå‘Šåˆ«ä»£ç å †ç Œå’Œå‘½åå†²çªï¼Œä¸ºç¼–å†™å¤§å‹é¡¹ç›®æ‰“ä¸‹åŸºç¡€ï¼›</li>
<li>æ–‡ä»¶æ“ä½œï¼šå®ç°æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œè®©æˆ‘ä»¬èƒ½è¯»å–ã€å†™å…¥æ–‡ä»¶ï¼Œå¤„ç†å®é™…åœºæ™¯ä¸­çš„æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ã€æ—¥å¿—ï¼‰ï¼›</li>
<li>å¼‚å¸¸å¤„ç†ï¼šè®©ä»£ç æ›´å¥å£®ã€å®¹é”™æ€§æ›´å¼ºï¼Œä»å®¹åº”å¯¹ç¨‹åºè¿è¡Œä¸­çš„é”™è¯¯ï¼Œé¿å…ç¨‹åºå´©æºƒï¼›</li>
<li>é¢å‘å¯¹è±¡åŸºç¡€ï¼šè§£é”â€œé¢å‘å¯¹è±¡â€çš„ç¼–ç¨‹æ€ç»´ï¼Œå°†ç°å®ä¸–ç•Œçš„äº‹ç‰©æŠ½è±¡æˆç±»å’Œå¯¹è±¡ï¼Œè®©ä»£ç æ›´çµæ´»ã€æ›´æ˜“ç»´æŠ¤ã€‚</li>
</ul>
<p>ç¬¬å…­é˜¶æ®µçš„å­¦ä¹ ï¼Œéš¾åº¦æ˜æ˜¾æå‡â€”â€”ä¸ä»…éœ€è¦è®°ä½è¯­æ³•ï¼Œæ›´éœ€è¦ç†è§£é€»è¾‘ã€è½¬å˜æ€ç»´ï¼ˆå°¤å…¶æ˜¯é¢å‘å¯¹è±¡æ€ç»´ï¼Œä»â€œé¢å‘è¿‡ç¨‹â€åˆ°â€œé¢å‘å¯¹è±¡â€çš„è½¬å˜ï¼Œæ–°æ‰‹å¯èƒ½éœ€è¦ä¸€å®šæ—¶é—´é€‚åº”ï¼‰ã€‚å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œé‡ç‚¹æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>æ¨¡å—ä¸åŒ…ï¼šé‡ç‚¹æŒæ¡importå¯¼å…¥çš„4ç§æ–¹å¼ã€è‡ªå®šä¹‰æ¨¡å—çš„ç¼–å†™ä¸å¯¼å…¥ï¼Œä»¥åŠå¸¸ç”¨å†…ç½®æ¨¡å—çš„ä½¿ç”¨ï¼Œå¤šç»ƒä¹ è·¨æ–‡ä»¶å¤ç”¨ä»£ç ï¼›</li>
<li>æ–‡ä»¶æ“ä½œï¼šå…¨ç¨‹ä¼˜å…ˆä½¿ç”¨withä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œç‰¢è®°å¸¸ç”¨æ‰“å¼€æ¨¡å¼ï¼ŒæŒæ¡ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„çš„API.</li>
</ol>
<hr/>
<p><em>è½¬å‘è¯·æºå¸¦ä½œè€…ä¿¡æ¯</em>  <strong>@æ€’æ”¾å§å¾·å¾· @ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</strong><br/>
æŒç»­åˆ›ä½œå¾ˆä¸å®¹æ˜“ï¼Œä½œè€…å°†ä»¥å°½å¯èƒ½çš„è¯¦ç»†æŠŠæ‰€å­¦çŸ¥è¯†åˆ†äº«å„ä½å¼€å‘è€…ï¼Œä¸€èµ·è¿›æ­¥ä¸€èµ·å­¦ä¹ ã€‚<strong>è½¬è½½è¯·æºå¸¦é“¾æ¥ï¼Œè½¬è½½åˆ°å¾®ä¿¡å…¬ä¼—å·è¯·å‹¿é€‰æ‹©åŸåˆ›ï¼Œè°¢è°¢ï¼</strong><br/>
ğŸ‘åˆ›ä½œä¸æ˜“ï¼Œå¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£ï¼Œæ„Ÿè°¢è§‚çœ‹ï¼è®°å¾—ç‚¹èµå“¦ï¼ğŸ‘<br/>
è°¢è°¢æ”¯æŒï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸»æµæ¨¡å‹å¯¹æ¯”-02]]></title>    <link>https://juejin.cn/post/7603575399255261224</link>    <guid>https://juejin.cn/post/7603575399255261224</guid>    <pubDate>2026-02-06T15:28:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575399255261224" data-draft-id="7603574149773312052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸»æµæ¨¡å‹å¯¹æ¯”-02"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-06T15:28:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€è¯ºæ»šé›ªçƒ"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸»æµæ¨¡å‹å¯¹æ¯”-02
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€è¯ºæ»šé›ªçƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:28:08.000Z" title="Fri Feb 06 2026 15:28:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>GPT-4ã€Claudeã€Llamaã€Qwenã€DeepSeek...</p>
<p>é¢å¯¹å±‚å‡ºä¸ç©·çš„å¤§è¯­è¨€æ¨¡å‹ï¼Œä½ æ˜¯å¦ä¹Ÿæ›¾æ„Ÿåˆ°è¿·èŒ«ï¼Ÿ</p>
<ul>
<li>é€‰è´µçš„ GPT-4ï¼Œè¿˜æ˜¯ç”¨å…è´¹çš„å¼€æºæ¨¡å‹ï¼Ÿ</li>
<li>ä¸­æ–‡åœºæ™¯åº”è¯¥ç”¨ä»€ä¹ˆæ¨¡å‹ï¼Ÿ</li>
<li>æœ¬åœ°éƒ¨ç½²å’Œäº‘ç«¯ API å„æœ‰ä»€ä¹ˆä¼˜åŠ£ï¼Ÿ</li>
<li>æ€§ä»·æ¯”æœ€é«˜çš„é€‰æ‹©æ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ul>
<p>é€‰å¯¹æ¨¡å‹ï¼Œä¸ä»…èƒ½èŠ‚çœæˆæœ¬ï¼Œè¿˜èƒ½è·å¾—æ›´å¥½çš„æ•ˆæœã€‚ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠå¦‚ä½•åšå‡ºæ˜æ™ºçš„é€‰æ‹©ã€‚</p>
<hr/>
<h2 data-id="heading-1">1. ä»€ä¹ˆæ˜¯æ¨¡å‹é€‰å‹</h2>
<h3 data-id="heading-2">1.1 é—­æºæ¨¡å‹ vs å¼€æºæ¨¡å‹</h3>








































<table><thead><tr><th>ç‰¹ç‚¹</th><th>é—­æºæ¨¡å‹</th><th>å¼€æºæ¨¡å‹</th></tr></thead><tbody><tr><td><strong>ä»£è¡¨</strong></td><td>GPT-4ã€Claudeã€Gemini</td><td>Llamaã€Qwenã€DeepSeek</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>æ€§èƒ½æœ€å¼º</td><td>å¿«é€Ÿè¿½èµ¶ä¸­</td></tr><tr><td><strong>æˆæœ¬</strong></td><td>ä»·æ ¼æ˜‚è´µ</td><td>å…è´¹æˆ–ä½ä»·</td></tr><tr><td><strong>éƒ¨ç½²</strong></td><td>ä»…äº‘ç«¯</td><td>å¯æœ¬åœ°éƒ¨ç½²</td></tr><tr><td><strong>éšç§</strong></td><td>æ•°æ®ä¸Šä¼ äº‘ç«¯</td><td>å®Œå…¨ç§å¯†</td></tr><tr><td><strong>å®šåˆ¶</strong></td><td>éš¾ä»¥å®šåˆ¶</td><td>é«˜åº¦å¯å®šåˆ¶</td></tr></tbody></table>
<h3 data-id="heading-3">1.2 é‡è¦æŒ‡æ ‡</h3>





























<table><thead><tr><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å‚æ•°é‡</strong></td><td>æ¨¡å‹è§„æ¨¡ï¼Œé€šå¸¸è¶Šå¤§è¶Šå¼º</td></tr><tr><td><strong>ä¸Šä¸‹æ–‡é•¿åº¦</strong></td><td>èƒ½å¤„ç†çš„æ–‡æœ¬é•¿åº¦</td></tr><tr><td><strong>æ¨ç†èƒ½åŠ›</strong></td><td>é€»è¾‘æ€è€ƒå’Œé—®é¢˜è§£å†³èƒ½åŠ›</td></tr><tr><td><strong>ä¸­æ–‡èƒ½åŠ›</strong></td><td>å¯¹ä¸­æ–‡çš„ç†è§£å’Œç”Ÿæˆè´¨é‡</td></tr><tr><td><strong>API ä»·æ ¼</strong></td><td>æ¯ 1M tokens çš„è´¹ç”¨</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">2. æ¡ˆä¾‹</h2>
<h3 data-id="heading-5">æ¡ˆä¾‹ 1ï¼šä¸»æµé—­æºæ¨¡å‹å¯¹æ¯”</h3>





























<table><thead><tr><th>æ¨¡å‹</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>ä»·æ ¼</th><th>æœ€ä½³åœºæ™¯</th></tr></thead><tbody><tr><td><strong>GPT-4o</strong></td><td>ç»¼åˆèƒ½åŠ›æœ€å¼º</td><td>$5/1M è¾“å…¥</td><td>å¤æ‚ä»»åŠ¡ã€å¤šæ¨¡æ€</td></tr><tr><td><strong>Claude 3.5 Sonnet</strong></td><td>é•¿æ–‡æœ¬ã€æ¨ç†å¼º</td><td>$3/1M è¾“å…¥</td><td>ç¼–ç¨‹ã€å†™ä½œ</td></tr><tr><td><strong>Gemini 1.5 Pro</strong></td><td>è¶…é•¿ä¸Šä¸‹æ–‡(1M)</td><td>æŒ‰ç”¨é‡è®¡è´¹</td><td>è§†é¢‘ã€é•¿æ–‡æ¡£å¤„ç†</td></tr></tbody></table>
<p><strong>é€‰å‹å»ºè®®</strong>ï¼šè¿½æ±‚æè‡´æ€§èƒ½æ—¶é€‰æ‹©é—­æºæ¨¡å‹ã€‚</p>
<h3 data-id="heading-6">æ¡ˆä¾‹ 2ï¼šä¸»æµå¼€æºæ¨¡å‹å¯¹æ¯”</h3>








































<table><thead><tr><th>æ¨¡å‹</th><th>å‚æ•°é‡</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>ç¡¬ä»¶è¦æ±‚</th><th>æœ€ä½³åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Qwen2.5 7B</strong></td><td>70äº¿</td><td>ä¸­æ–‡ä¼˜ç§€</td><td>6GB æ˜¾å­˜</td><td>ä¸­æ–‡æœ¬åœ°éƒ¨ç½²</td></tr><tr><td><strong>Llama 3.1 8B</strong></td><td>80äº¿</td><td>é€šç”¨å¹³è¡¡</td><td>8GB æ˜¾å­˜</td><td>è‹±æ–‡åœºæ™¯</td></tr><tr><td><strong>DeepSeek-V3</strong></td><td>680äº¿</td><td>æ€§ä»·æ¯”ä¹‹ç‹</td><td>24GB æ˜¾å­˜</td><td>ç¼–ç¨‹ä»»åŠ¡</td></tr><tr><td><strong>GLM-4 9B</strong></td><td>90äº¿</td><td>å›½äº§åŒ–</td><td>6GB æ˜¾å­˜</td><td>ä¼ä¸šåº”ç”¨</td></tr></tbody></table>
<p><strong>é€‰å‹å»ºè®®</strong>ï¼šé¢„ç®—æœ‰é™æˆ–å…³æ³¨éšç§æ—¶é€‰æ‹©å¼€æºæ¨¡å‹ã€‚</p>
<h3 data-id="heading-7">æ¡ˆä¾‹ 3ï¼šæŒ‰åœºæ™¯é€‰æ¨¡å‹</h3>
<p><strong>åœºæ™¯ 1ï¼šä¸­æ–‡æ—¥å¸¸å¯¹è¯</strong></p>
<pre><code class="hljs language-diff" lang="diff">æ¨èï¼šQwen2.5 7B æˆ– DeepSeek-V3
åŸå› ï¼š
<span class="hljs-deletion">- ä¸­æ–‡èƒ½åŠ›å¼º</span>
<span class="hljs-deletion">- API ä»·æ ¼ä½ï¼ˆÂ¥1/1M è¾“å…¥ï¼‰</span>
<span class="hljs-deletion">- å“åº”é€Ÿåº¦å¿«</span>
</code></pre>
<p><strong>åœºæ™¯ 2ï¼šä»£ç ç”Ÿæˆ</strong></p>
<pre><code class="hljs language-diff" lang="diff">æ¨èï¼šDeepSeek-V3 æˆ– Claude 3.5 Sonnet
åŸå› ï¼š
<span class="hljs-deletion">- ä»£ç è´¨é‡é«˜</span>
<span class="hljs-deletion">- ç†è§£ä¸Šä¸‹æ–‡èƒ½åŠ›å¼º</span>
<span class="hljs-deletion">- è°ƒè¯•èƒ½åŠ›å‡ºè‰²</span>
</code></pre>
<p><strong>åœºæ™¯ 3ï¼šé•¿æ–‡æ¡£å¤„ç†</strong></p>
<pre><code class="hljs language-diff" lang="diff">æ¨èï¼šClaude 3 æˆ– Gemini 1.5 Pro
åŸå› ï¼š
<span class="hljs-deletion">- æ”¯æŒ 200K-1M tokens ä¸Šä¸‹æ–‡</span>
<span class="hljs-deletion">- æ€»ç»“èƒ½åŠ›å¼º</span>
<span class="hljs-deletion">- ç»†èŠ‚ä¿ç•™å¥½</span>
</code></pre>
<p><strong>åœºæ™¯ 4ï¼šæœ¬åœ°éƒ¨ç½²</strong></p>
<pre><code class="hljs language-diff" lang="diff">æ¨èï¼šQwen2.5 7B (INT4 é‡åŒ–)
åŸå› ï¼š
<span class="hljs-deletion">- æ˜¾å­˜éœ€æ±‚ä½ï¼ˆ~4GBï¼‰</span>
<span class="hljs-deletion">- ä¸­æ–‡ä¼˜åŒ–å¥½</span>
<span class="hljs-deletion">- æ€§èƒ½æ¥è¿‘ GPT-3.5</span>
</code></pre>
<h3 data-id="heading-8">æ¡ˆä¾‹ 4ï¼šæ€§ä»·æ¯”å¯¹æ¯”</h3>
<p><strong>äº‘ç«¯ API ä»·æ ¼å¯¹æ¯”ï¼ˆ1M tokensï¼‰</strong>ï¼š</p>



































<table><thead><tr><th>æ¨¡å‹</th><th>è¾“å…¥ä»·æ ¼</th><th>è¾“å‡ºä»·æ ¼</th><th>æ€§ä»·æ¯”è¯„çº§</th></tr></thead><tbody><tr><td>DeepSeek-V3</td><td>Â¥1</td><td>Â¥2</td><td>â­â­â­â­â­</td></tr><tr><td>Qwen-turbo</td><td>Â¥0.8</td><td>Â¥2</td><td>â­â­â­â­â­</td></tr><tr><td>GPT-4o</td><td>$5</td><td>$15</td><td>â­â­</td></tr><tr><td>Claude 3.5</td><td>$3</td><td>$15</td><td>â­â­</td></tr></tbody></table>
<p><strong>ç»“è®º</strong>ï¼šDeepSeek å’Œ Qwen æ€§ä»·æ¯”æœ€é«˜ã€‚</p>
<h3 data-id="heading-9">æ¡ˆä¾‹ 5ï¼šæœ¬åœ°éƒ¨ç½²æˆæœ¬åˆ†æ</h3>


























<table><thead><tr><th>é…ç½®</th><th>ç¡¬ä»¶æˆæœ¬</th><th>æœˆç”µè´¹</th><th>å¹´æ€»æˆæœ¬</th><th>ä½•æ—¶å›æœ¬</th></tr></thead><tbody><tr><td>Qwen2.5 7B</td><td>Â¥3000</td><td>Â¥50</td><td>Â¥3600</td><td>ä½¿ç”¨ &gt; 1 å¹´</td></tr><tr><td>Qwen2.5 14B</td><td>Â¥6000</td><td>Â¥80</td><td>Â¥6960</td><td>ä½¿ç”¨ &gt; 1.5 å¹´</td></tr></tbody></table>
<p><strong>ç»“è®º</strong>ï¼šé•¿æœŸä½¿ç”¨ï¼ˆ&gt;1å¹´ï¼‰ï¼Œæœ¬åœ°éƒ¨ç½²æ›´åˆ’ç®—ã€‚</p>
<hr/>
<h2 data-id="heading-10">æ€»ç»“</h2>
<ol>
<li><strong>æ²¡æœ‰æœ€å¥½çš„æ¨¡å‹ï¼Œåªæœ‰æœ€é€‚åˆçš„æ¨¡å‹</strong></li>
<li><strong>æ ¹æ®å®é™…åœºæ™¯é€‰æ‹©ï¼Œè€Œéç›²ç›®è¿½æ±‚æœ€æ–°æœ€å¼º</strong></li>
<li><strong>æ€§ä»·æ¯”å¾ˆé‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡ä½¿ç”¨æ—¶</strong></li>
<li><strong>å¼€æºæ¨¡å‹å·²è¶³å¤Ÿåº”å¯¹å¤§éƒ¨åˆ†åœºæ™¯</strong></li>
<li><strong>é•¿æœŸä½¿ç”¨è€ƒè™‘æœ¬åœ°éƒ¨ç½²ï¼ŒçŸ­æœŸé¡¹ç›®ç”¨äº‘ç«¯ API</strong></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æç¤ºè¯å·¥ç¨‹å…¥é—¨-03]]></title>    <link>https://juejin.cn/post/7603575399255277608</link>    <guid>https://juejin.cn/post/7603575399255277608</guid>    <pubDate>2026-02-06T15:29:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575399255277608" data-draft-id="7603444191448940578" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æç¤ºè¯å·¥ç¨‹å…¥é—¨-03"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-06T15:29:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€è¯ºæ»šé›ªçƒ"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æç¤ºè¯å·¥ç¨‹å…¥é—¨-03
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€è¯ºæ»šé›ªçƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:29:16.000Z" title="Fri Feb 06 2026 15:29:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>"å†™ä¸ªä»£ç "
"å¸®æˆ‘å†™ä¸ªå¿«é€Ÿæ’åºå‡½æ•°ï¼Œç”¨ Python å®ç°ï¼Œè¦æ±‚æ—¶é—´å¤æ‚åº¦ O(n log n)ï¼Œæ·»åŠ è¯¦ç»†æ³¨é‡Š"</p>
<p>åŒæ ·æ˜¯è®© AI å†™ä»£ç ï¼Œä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªæŒ‡ä»¤å¾—åˆ°çš„æ˜¯æ¨¡ç³Šçš„å›å¤ï¼Œè€Œç¬¬äºŒä¸ªèƒ½å¾—åˆ°ç²¾ç¡®æ»¡è¶³éœ€æ±‚çš„ä»£ç ï¼Ÿ</p>
<p>è¿™å°±æ˜¯æç¤ºè¯å·¥ç¨‹ï¼ˆPrompt Engineeringï¼‰çš„é­”åŠ›ã€‚</p>
<p>å¥½çš„ Prompt = å¥½çš„è¾“å‡ºã€‚ä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ å¦‚ä½•å†™å‡ºè®© AI "ç§’æ‡‚"çš„æç¤ºè¯ã€‚</p>
<hr/>
<h2 data-id="heading-1">1. ä»€ä¹ˆæ˜¯æç¤ºè¯å·¥ç¨‹</h2>
<p><strong>æç¤ºè¯ï¼ˆPromptï¼‰</strong>ï¼šä½ ç»™å¤§æ¨¡å‹çš„è¾“å…¥æŒ‡ä»¤</p>
<p><strong>æç¤ºè¯å·¥ç¨‹ï¼ˆPrompt Engineeringï¼‰</strong>ï¼šè®¾è®¡å’Œä¼˜åŒ– Prompt çš„è‰ºæœ¯å’Œç§‘å­¦</p>
<h3 data-id="heading-2">Prompt çš„é»„é‡‘ç»“æ„</h3>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Prompt ç»“æ„æ¨¡æ¿                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  <span class="hljs-number">1.</span> è§’è‰²ï¼ˆRoleï¼‰                         â”‚
â”‚     <span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªç»éªŒä¸°å¯Œçš„ç¨‹åºå‘˜..."</span>        â”‚
â”‚                                         â”‚
â”‚  <span class="hljs-number">2.</span> ä»»åŠ¡ï¼ˆ<span class="hljs-built_in">Task</span>ï¼‰                         â”‚
â”‚     <span class="hljs-string">"è¯·å†™ä¸€ä¸ªå¿«é€Ÿæ’åºå‡½æ•°..."</span>           â”‚
â”‚                                         â”‚
â”‚  <span class="hljs-number">3.</span> ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰                    â”‚
â”‚     <span class="hljs-string">"ç”¨äºå¤„ç†æ•´æ•°æ•°ç»„..."</span>               â”‚
â”‚                                         â”‚
â”‚  <span class="hljs-number">4.</span> çº¦æŸï¼ˆConstraintsï¼‰                  â”‚
â”‚     <span class="hljs-string">"è¦æ±‚O(n log n)æ—¶é—´å¤æ‚åº¦..."</span>       â”‚
â”‚                                         â”‚
â”‚  <span class="hljs-number">5.</span> æ ¼å¼ï¼ˆFormatï¼‰                       â”‚
â”‚     <span class="hljs-string">"è¿”å›JSONæ ¼å¼ï¼ŒåŒ…å«codeå’Œè¯´æ˜..."</span>    â”‚
â”‚                                         â”‚
â”‚  <span class="hljs-number">6.</span> ç¤ºä¾‹ï¼ˆExamplesï¼‰                     â”‚
â”‚     <span class="hljs-string">"è¾“å…¥:[3,1,2] è¾“å‡º:[1,2,3]"</span>         â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-3">2. æ¡ˆä¾‹</h2>
<h3 data-id="heading-4">æ¡ˆä¾‹ 1ï¼šæ˜ç¡®è§’è‰²çš„åŠ›é‡</h3>
<p><strong>âŒ æ²¡æœ‰è§’è‰²</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"æ€ä¹ˆæé«˜ç¼–ç¨‹èƒ½åŠ›ï¼Ÿ"</span>
</code></pre>
<p><strong>âœ… æœ‰è§’è‰²</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"ä½ æ˜¯ä¸€ä½æœ‰10å¹´ç»éªŒçš„ç¼–ç¨‹å¯¼å¸ˆï¼Œ
æ›¾ç»æŒ‡å¯¼è¿‡æ•°ç™¾ååˆå­¦è€…æˆä¸ºèµ„æ·±å·¥ç¨‹å¸ˆã€‚
è¯·ç»™æˆ‘æä¾›æé«˜ç¼–ç¨‹èƒ½åŠ›çš„å»ºè®®ã€‚"</span>
</code></pre>
<p><strong>æ•ˆæœå·®å¼‚</strong>ï¼šæœ‰è§’è‰²çš„ Prompt èƒ½å¾—åˆ°æ›´æœ‰é’ˆå¯¹æ€§ã€æ›´æœ‰æ·±åº¦çš„å›ç­”ã€‚</p>
<h3 data-id="heading-5">æ¡ˆä¾‹ 2ï¼šå…·ä½“æ˜ç¡®çš„ä»»åŠ¡</h3>
<p><strong>âŒ æ¨¡ç³Šçš„ä»»åŠ¡</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"å¸®æˆ‘å†™ä¸ªæ–‡ç« "</span>
</code></pre>
<p><strong>âœ… æ˜ç¡®çš„ä»»åŠ¡</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">"è¯·å†™ä¸€ç¯‡å…³äºäººå·¥æ™ºèƒ½å‘å±•å†å²çš„æ–‡ç« ï¼Œ
è¦æ±‚ï¼š
<span class="hljs-bullet">1.</span> å­—æ•°800-1000å­—
<span class="hljs-bullet">2.</span> åŒ…å«ä¸‰ä¸ªä¸»è¦å‘å±•é˜¶æ®µ
<span class="hljs-bullet">3.</span> æåˆ°GPTã€Llamaç­‰å…³é”®æ¨¡å‹
<span class="hljs-bullet">4.</span> è¯­è¨€é£æ ¼é€šä¿—æ˜“æ‡‚"
</code></pre>
<p><strong>SMART åŸåˆ™</strong>ï¼š</p>
<ul>
<li><strong>Specific</strong>ï¼ˆå…·ä½“æ˜ç¡®ï¼‰ï¼šå†™ Python ä»£ç è€Œé"å†™ä»£ç "</li>
<li><strong>Measurable</strong>ï¼ˆå¯è¡¡é‡ï¼‰ï¼š100å­—ä»¥å†…</li>
<li><strong>Achievable</strong>ï¼ˆå¯è¾¾æˆï¼‰ï¼šä¸è¦æ±‚è¶…å‡ºæ¨¡å‹èƒ½åŠ›</li>
<li><strong>Relevant</strong>ï¼ˆç›¸å…³æ€§ï¼‰ï¼šä»»åŠ¡ä¸ä¸Šä¸‹æ–‡ç›¸å…³</li>
<li><strong>Time-bound</strong>ï¼ˆæœ‰æ—¶é™ï¼‰ï¼š30ç§’å†…èƒ½è¯»å®Œçš„ä»‹ç»</li>
</ul>
<h3 data-id="heading-6">æ¡ˆä¾‹ 3ï¼šæä¾›å……è¶³ä¸Šä¸‹æ–‡</h3>
<p><strong>âŒ ç¼ºå°‘ä¸Šä¸‹æ–‡</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"è¿™ä¸ªä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"</span>
[ç²˜è´´ä¸€æ®µä»£ç ]
</code></pre>
<p><strong>âœ… å……è¶³ä¸Šä¸‹æ–‡</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ªç”µå•†ç½‘ç«™çš„ç”¨æˆ·è®¤è¯åŠŸèƒ½ã€‚
è¿™æ®µPythonä»£ç ç”¨äºéªŒè¯ç”¨æˆ·å¯†ç ï¼Œ
ä½†æ€»æ˜¯è¿”å›Falseï¼Œå¸®æˆ‘æ‰¾å‡ºé—®é¢˜ï¼š

[ç²˜è´´ä»£ç ]

é¢„æœŸè¡Œä¸ºï¼šæ­£ç¡®å¯†ç è¿”å›Trueï¼Œé”™è¯¯å¯†ç è¿”å›False
å®é™…è¡Œä¸ºï¼šæ‰€æœ‰å¯†ç éƒ½è¿”å›False"</span>
</code></pre>
<p><strong>ä¸Šä¸‹æ–‡è¦ç´ æ¸…å•</strong>ï¼š</p>
<ul>
<li>èƒŒæ™¯ï¼šè¿™æ˜¯ä»€ä¹ˆé¡¹ç›®/åœºæ™¯ï¼Ÿ</li>
<li>ç›®æ ‡ï¼šæƒ³è¦è¾¾åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ</li>
<li>ç°çŠ¶ï¼šå½“å‰æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ</li>
<li>é—®é¢˜ï¼šé‡åˆ°äº†ä»€ä¹ˆå…·ä½“é—®é¢˜ï¼Ÿ</li>
</ul>
<h3 data-id="heading-7">æ¡ˆä¾‹ 4ï¼šä½¿ç”¨ç¤ºä¾‹çš„é­”åŠ›</h3>
<p><strong>å°‘æ ·æœ¬å­¦ä¹ ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs">ä¾‹å­1ï¼š
è¾“å…¥ï¼šè‹¹æœ
åˆ†ç±»ï¼šæ°´æœ

ä¾‹å­2ï¼š
èƒ¡èåœ
åˆ†ç±»ï¼šè”¬èœ

ä¾‹å­3ï¼š
é¦™è•‰
åˆ†ç±»ï¼šï¼Ÿ
</code></pre>
<p><strong>æ€ç»´é“¾ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">é—®é¢˜ï¼šå°æ˜æœ‰5ä¸ªè‹¹æœï¼Œåƒäº†2ä¸ªï¼Œåˆä¹°äº†3ä¸ªï¼Œç°åœ¨æœ‰å‡ ä¸ªï¼Ÿ

æ€è€ƒè¿‡ç¨‹ï¼š
1. åˆå§‹ï¼šå°æ˜æœ‰5ä¸ªè‹¹æœ
2. åƒäº†2ä¸ªï¼š5 - <span class="hljs-attr">2</span> = <span class="hljs-number">3</span>ä¸ª
3. ä¹°äº†3ä¸ªï¼š3 + <span class="hljs-attr">3</span> = <span class="hljs-number">6</span>ä¸ª
ç­”æ¡ˆï¼š6ä¸ª

ç°åœ¨è¯·è§£å†³ï¼š
å°çº¢æœ‰10é¢—ç³–ï¼Œç»™äº†å¦¹å¦¹3é¢—ï¼Œå¦ˆå¦ˆåˆç»™äº†å¥¹5é¢—ï¼Œç°åœ¨æœ‰å‡ é¢—ï¼Ÿ
</code></pre>
<p><strong>æ•ˆæœ</strong>ï¼šç¤ºä¾‹èƒ½è®© AI å¿«é€Ÿç†è§£ä½ æƒ³è¦çš„è¾“å‡ºæ¨¡å¼ã€‚</p>
<h3 data-id="heading-8">æ¡ˆä¾‹ 5ï¼šæ ¼å¼åŒ–è¾“å‡º</h3>
<p><strong>âŒ ä¸å¥½çš„ Prompt</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"åˆ†æè¿™æ®µä»£ç "</span>
</code></pre>
<p><strong>âœ… å¥½çš„ Prompt</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">"è¯·åˆ†æä»¥ä¸‹ä»£ç ï¼Œå¹¶æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š

<span class="hljs-comment">## ä»£ç åŠŸèƒ½</span>
<span class="hljs-section">[ç®€è¦è¯´æ˜ä»£ç çš„åŠŸèƒ½]</span>

<span class="hljs-comment">## æ—¶é—´å¤æ‚åº¦</span>
<span class="hljs-section">[åˆ†ææ—¶é—´å¤æ‚åº¦]</span>

<span class="hljs-comment">## æ”¹è¿›å»ºè®®</span>
<span class="hljs-section">[åˆ—å‡º3æ¡å…·ä½“æ”¹è¿›å»ºè®®]</span>

<span class="hljs-comment">## é‡æ„ä»£ç </span>
\`\`\`python
<span class="hljs-section">[é‡æ„åçš„ä»£ç ]</span>
\`\`\`"
</code></pre>
<h3 data-id="heading-9">æ¡ˆä¾‹ 6ï¼šå¸¸ç”¨ Prompt æ¨¡æ¿</h3>
<p><strong>ä»£ç ç”Ÿæˆæ¨¡æ¿</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">ä½ æ˜¯ä¸€ä¸ª{è¯­è¨€}ä¸“å®¶ã€‚
è¯·å†™ä¸€ä¸ª{åŠŸèƒ½æè¿°}çš„{è¯­è¨€}å‡½æ•°ï¼Œ
è¦æ±‚ï¼š
<span class="hljs-bullet">1.</span> {è¦æ±‚1}
<span class="hljs-bullet">2.</span> {è¦æ±‚2}
<span class="hljs-bullet">3.</span> {è¦æ±‚3}

è¯·åŒ…å«ï¼š
<span class="hljs-bullet">-</span> è¯¦ç»†çš„æ³¨é‡Š
<span class="hljs-bullet">-</span> é”™è¯¯å¤„ç†
<span class="hljs-bullet">-</span> ä½¿ç”¨ç¤ºä¾‹
</code></pre>
<p><strong>Bug è°ƒè¯•æ¨¡æ¿</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">æˆ‘åœ¨å¼€å‘ä¸€ä¸ª{é¡¹ç›®ç±»å‹}é¡¹ç›®ï¼Œ
è¿™æ®µ{è¯­è¨€}ä»£ç å‡ºç°äº†{é—®é¢˜æè¿°}ï¼š

\<span class="hljs-code">`\`</span>\`{è¯­è¨€}
{ä»£ç }
\<span class="hljs-code">`\`</span>\`

é¢„æœŸè¡Œä¸ºï¼š{é¢„æœŸ}
å®é™…è¡Œä¸ºï¼š{å®é™…}

è¯·å¸®æˆ‘ï¼š
<span class="hljs-bullet">1.</span> æ‰¾å‡ºé—®é¢˜æ‰€åœ¨
<span class="hljs-bullet">2.</span> è§£é‡Šé—®é¢˜åŸå› 
<span class="hljs-bullet">3.</span> æä¾›ä¿®å¤æ–¹æ¡ˆ
</code></pre>
<hr/>
<h2 data-id="heading-10">æ€»ç»“</h2>
<h3 data-id="heading-11">æ ¸å¿ƒæŠ€å·§é€Ÿè®°</h3>



































<table><thead><tr><th>æŠ€å·§</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>æ˜ç¡®è§’è‰²</strong></td><td>ç»™ AI åˆ†é…èº«ä»½</td><td>"ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„ç¨‹åºå‘˜"</td></tr><tr><td><strong>å…·ä½“ä»»åŠ¡</strong></td><td>æ¸…æ¥šè¯´æ˜è¦åšä»€ä¹ˆ</td><td>"å†™ä¸€ä¸ªå¿«é€Ÿæ’åºï¼ŒO(n log n)"</td></tr><tr><td><strong>å……è¶³ä¸Šä¸‹æ–‡</strong></td><td>æä¾›èƒŒæ™¯ä¿¡æ¯</td><td>"è¿™æ˜¯ç”µå•†ç½‘ç«™çš„æ¨èåŠŸèƒ½"</td></tr><tr><td><strong>ä½¿ç”¨ç¤ºä¾‹</strong></td><td>å±•ç¤ºæœŸæœ›æ ¼å¼</td><td>"è¾“å…¥Aè¾“å‡ºBï¼Œè¾“å…¥Cè¾“å‡ºï¼Ÿ"</td></tr><tr><td><strong>æ˜ç¡®æ ¼å¼</strong></td><td>è¯´æ˜è¾“å‡ºå½¢å¼</td><td>"ä»¥ JSON æ ¼å¼è¿”å›"</td></tr></tbody></table>
<h3 data-id="heading-12">Prompt æ£€æŸ¥æ¸…å•</h3>
<p>å‘é€ Prompt å‰ï¼Œé—®è‡ªå·±ï¼š</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> è§’è‰²æ¸…æ™°ï¼šæ˜¯å¦å‘Šè¯‰ AI å®ƒçš„è§’è‰²ï¼Ÿ</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ä»»åŠ¡æ˜ç¡®ï¼šæ˜¯å¦æ¸…æ¥šè¯´æ˜äº†è¦åšä»€ä¹ˆï¼Ÿ</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ä¸Šä¸‹æ–‡å……è¶³ï¼šæ˜¯å¦æä¾›äº†è¶³å¤Ÿçš„èƒŒæ™¯ä¿¡æ¯ï¼Ÿ</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> çº¦æŸå…·ä½“ï¼šæ˜¯å¦è¯´æ˜äº†é™åˆ¶å’Œè¦æ±‚ï¼Ÿ</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ ¼å¼æ˜ç¡®ï¼šæ˜¯å¦è¯´æ˜äº†è¾“å‡ºæ ¼å¼ï¼Ÿ</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ç¤ºä¾‹å……åˆ†ï¼šæ˜¯å¦æä¾›äº†å‚è€ƒç¤ºä¾‹ï¼Ÿ</li>
</ul>
<h3 data-id="heading-13">å¸¸è§é™·é˜±</h3>






























<table><thead><tr><th>é™·é˜±</th><th>é—®é¢˜</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>è¿‡äºç®€çŸ­</strong></td><td>"å¸®æˆ‘ä¼˜åŒ–ä»£ç "</td><td>è¯´æ˜å…·ä½“ä¼˜åŒ–ç›®æ ‡</td></tr><tr><td><strong>çŸ›ç›¾è¦æ±‚</strong></td><td>"æ€§èƒ½æœ€å¥½ä½†ä»£ç ç®€æ´"</td><td>æ˜ç¡®ä¼˜å…ˆçº§</td></tr><tr><td><strong>ä¸€æ¬¡å¤ªå¤š</strong></td><td>"å†™å®Œæ•´ç”µå•†ç³»ç»Ÿ"</td><td>åˆ†è§£ä¸ºå°ä»»åŠ¡</td></tr><tr><td><strong>ç¼ºå°‘éªŒè¯</strong></td><td>"è®¡ç®—å¤æ‚æ•°å­¦"</td><td>è¦æ±‚ç»™å‡ºè®¡ç®—æ­¥éª¤</td></tr></tbody></table>
<h3 data-id="heading-14">é«˜çº§æŠ€å·§</h3>
<p><strong>1. è¿­ä»£ä¼˜åŒ–</strong></p>
<pre><code class="hljs">ç¬¬ä¸€æ¬¡å°è¯• â†’ è¯„ä¼°ç»“æœ â†’ ä¿®æ”¹ Prompt â†’ å†æ¬¡å°è¯•
</code></pre>
<p><strong>2. æ¸©åº¦å‚æ•°è°ƒæ•´</strong></p>
<ul>
<li><strong>ä½æ¸©åº¦ï¼ˆ0.1-0.3ï¼‰</strong>ï¼šæ›´ç¡®å®šã€ä¸€è‡´çš„è¾“å‡º</li>
<li><strong>ä¸­ç­‰æ¸©åº¦ï¼ˆ0.4-0.7ï¼‰</strong>ï¼šå¹³è¡¡åˆ›é€ æ€§å’Œå‡†ç¡®æ€§</li>
<li><strong>é«˜æ¸©åº¦ï¼ˆ0.8-1.0ï¼‰</strong>ï¼šæ›´åˆ›é€ æ€§ã€å¤šæ ·åŒ–çš„è¾“å‡º</li>
</ul>
<p><strong>3. åˆ†è§£å¤æ‚ä»»åŠ¡</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"è®¾è®¡ä¸€ä¸ªåšå®¢ç³»ç»Ÿ"</span>
â†“ åˆ†è§£ä¸º
<span class="hljs-string">"1. è®¾è®¡æ•°æ®åº“ç»“æ„"</span>
<span class="hljs-string">"2. è®¾è®¡ç”¨æˆ·è®¤è¯ API"</span>
<span class="hljs-string">"3. è®¾è®¡æ–‡ç« å‘å¸ƒ API"</span>
</code></pre>
<ol>
<li><strong>ä¸è¦æœŸæœ›ä¸€æ¬¡å®Œç¾</strong>ï¼šè¿­ä»£ä¼˜åŒ–æ˜¯å¸¸æ€</li>
<li><strong>ä»ç®€å•å¼€å§‹</strong>ï¼šå…ˆéªŒè¯åŸºæœ¬æ–¹å‘ï¼Œå†æ·»åŠ ç»†èŠ‚</li>
<li><strong>ä¿å­˜å¥½ç”¨çš„ Prompt</strong>ï¼šå»ºç«‹è‡ªå·±çš„æ¨¡æ¿åº“</li>
<li><strong>å¯¹æ¯”å®éªŒ</strong>ï¼šç”¨ä¸åŒç‰ˆæœ¬æµ‹è¯•æ•ˆæœå·®å¼‚</li>
<li><strong>å­¦ä¹ ä»–äººç»éªŒ</strong>ï¼šå‚è€ƒä¼˜ç§€çš„ Prompt ç¤ºä¾‹</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Three.js é€è§†ç›¸æœºå®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç²¾é€š]]></title>    <link>https://juejin.cn/post/7603584155784626226</link>    <guid>https://juejin.cn/post/7603584155784626226</guid>    <pubDate>2026-02-06T14:25:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603584155784626226" data-draft-id="7602982045138288686" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Three.js é€è§†ç›¸æœºå®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç²¾é€š"/> <meta itemprop="keywords" content="JavaScript,three.js,WebGL"/> <meta itemprop="datePublished" content="2026-02-06T14:25:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çƒ›é˜´"/> <meta itemprop="url" content="https://juejin.cn/user/950397795841032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Three.js é€è§†ç›¸æœºå®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç²¾é€š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/950397795841032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çƒ›é˜´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T14:25:01.000Z" title="Fri Feb 06 2026 14:25:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»€ä¹ˆæ˜¯é€è§†ç›¸æœºï¼Ÿ</h2>
<h3 data-id="heading-1">ç”Ÿæ´»ä¸­çš„ç±»æ¯”</h3>
<p>æƒ³è±¡ä½ æ‹¿ç€ä¸€éƒ¨æ‰‹æœºæ‘„åƒå¤´å¯¹ç€ä¸€ä¸ªæˆ¿é—´ï¼š</p>
<ul>
<li>ğŸ“± <strong>æ‰‹æœºæ‘„åƒå¤´</strong> = Three.js ä¸­çš„ç›¸æœº</li>
<li>ğŸ¬ <strong>æ‘„åƒå¤´èƒ½çœ‹åˆ°çš„èŒƒå›´</strong> = è§†é”¥ä½“ï¼ˆFrustumï¼‰</li>
<li>ğŸ“ <strong>æ‘„åƒå¤´çš„è§†è§’å®½åº¦</strong> = è§†é‡è§’åº¦ï¼ˆFOVï¼‰</li>
</ul>
<p>é€è§†ç›¸æœºå°±åƒçœŸå®çš„æ‘„åƒå¤´ä¸€æ ·ï¼Œ<strong>ç¦»ç‰©ä½“è¶Šè¿‘ï¼Œçœ‹åˆ°çš„èŒƒå›´è¶Šå°ï¼›ç¦»ç‰©ä½“è¶Šè¿œï¼Œçœ‹åˆ°çš„èŒƒå›´è¶Šå¤§</strong>ã€‚è¿™å°±æ˜¯"é€è§†"çš„å«ä¹‰ã€‚</p>
<h3 data-id="heading-2">ä»£ç ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'three'</span>;

<span class="hljs-comment">// åˆ›å»ºé€è§†ç›¸æœº</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
    <span class="hljs-number">40</span>,      <span class="hljs-comment">// è§†é‡è§’åº¦ï¼ˆFOVï¼‰</span>
    <span class="hljs-number">2</span>,       <span class="hljs-comment">// å®½é«˜æ¯”ï¼ˆaspect ratioï¼‰(ä¸€èˆ¬3Dæ¸¸æˆä¸­çš„å±å¹•é€‚é…éƒ½æ˜¯åœ¨è°ƒæ•´è¿™ä¸ªå€¼ï¼‰</span>
    <span class="hljs-number">0.1</span>,     <span class="hljs-comment">// è¿‘è£å‰ªé¢ï¼ˆnearï¼‰</span>
    <span class="hljs-number">1000</span>     <span class="hljs-comment">// è¿œè£å‰ªé¢ï¼ˆfarï¼‰</span>
);

camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">120</span>; <span class="hljs-comment">// ç›¸æœºä½ç½®</span>
</code></pre>
<hr/>
<h2 data-id="heading-3">å››ä¸ªå…³é”®å‚æ•°è¯¦è§£</h2>
<h3 data-id="heading-4">å‚æ•° 1ï¸âƒ£ï¼šè§†é‡è§’åº¦ï¼ˆFOV - Field of Viewï¼‰</h3>
<p><strong>å®šä¹‰</strong>ï¼šç›¸æœºèƒ½çœ‹åˆ°çš„<strong>å‚ç›´è§†è§’èŒƒå›´</strong>ï¼Œå•ä½æ˜¯åº¦æ•°ï¼ˆÂ°ï¼‰ã€‚</p>
<p><strong>ç›´è§‚ç†è§£</strong>ï¼š</p>
<ul>
<li>ğŸ”­ <strong>FOV = 10Â°</strong> â†’ åƒç”¨æœ›è¿œé•œçœ‹ï¼Œè§†è§’å¾ˆçª„ï¼Œçœ‹åˆ°çš„ä¸œè¥¿å¾ˆå°ä½†å¾ˆæ¸…æ™°</li>
<li>ğŸ“· <strong>FOV = 40Â°</strong> â†’ åƒç”¨æ™®é€šæ‰‹æœºæ‘„åƒå¤´ï¼Œè§†è§’é€‚ä¸­</li>
<li>ğŸŸ <strong>FOV = 90Â°</strong> â†’ åƒç”¨é±¼çœ¼é•œå¤´ï¼Œè§†è§’å¾ˆå®½ï¼Œçœ‹åˆ°å¾ˆå¤šä¸œè¥¿ä½†ä¼šå˜å½¢</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å°è§†è§’ - çœ‹å¾—æ¸…æ¥šä½†èŒƒå›´å°</span>
<span class="hljs-keyword">const</span> camera1 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">20</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// ä¸­ç­‰è§†è§’ - å¹³è¡¡</span>
<span class="hljs-keyword">const</span> camera2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">40</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// å¤§è§†è§’ - çœ‹å¾—å¤šä½†å®¹æ˜“å˜å½¢</span>
<span class="hljs-keyword">const</span> camera3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);
</code></pre>
<p><strong>å®é™…åº”ç”¨</strong>ï¼š</p>
<ul>
<li>ğŸ® <strong>ç¬¬ä¸€äººç§°æ¸¸æˆ</strong>ï¼šFOV é€šå¸¸ 60-90Â°</li>
<li>ğŸ¢ <strong>å»ºç­‘å¯è§†åŒ–</strong>ï¼šFOV é€šå¸¸ 40-50Â°</li>
<li>ğŸ¥ <strong>ç”µå½±æ•ˆæœ</strong>ï¼šFOV é€šå¸¸ 24-35Â°</li>
</ul>
<hr/>
<h3 data-id="heading-5">å‚æ•° 2ï¸âƒ£ï¼šå®½é«˜æ¯”ï¼ˆAspect Ratioï¼‰</h3>
<p><strong>å®šä¹‰</strong>ï¼šç›¸æœºç”»é¢çš„<strong>å®½åº¦ä¸é«˜åº¦çš„æ¯”ä¾‹</strong>ã€‚</p>
<p><strong>è®¡ç®—æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> aspect = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
<span class="hljs-comment">// ä¾‹å¦‚ï¼š1920 / 1080 = 1.777...</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆé‡è¦</strong>ï¼Ÿ</p>
<ul>
<li>âœ… å¦‚æœ aspect ä¸å®é™…ç”»å¸ƒæ¯”ä¾‹ä¸€è‡´ï¼Œç”»é¢ä¸ä¼šè¢«æ‹‰ä¼¸</li>
<li>âŒ å¦‚æœä¸ä¸€è‡´ï¼Œåœ†å½¢ä¼šå˜æˆæ¤­åœ†ï¼Œæ­£æ–¹å½¢ä¼šå˜æˆçŸ©å½¢</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‡è®¾çª—å£æ˜¯ 1920Ã—1080</span>
<span class="hljs-keyword">const</span> aspect = <span class="hljs-number">1920</span> / <span class="hljs-number">1080</span>; <span class="hljs-comment">// â‰ˆ 1.78</span>

<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">40</span>, aspect, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);
</code></pre>
<p><strong>å“åº”å¼è®¾è®¡</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">onWindowResize</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> width = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>;
    <span class="hljs-keyword">const</span> height = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
    
    camera.<span class="hljs-property">aspect</span> = width / height;
    camera.<span class="hljs-title function_">updateProjectionMatrix</span>(); <span class="hljs-comment">// é‡è¦ï¼æ›´æ–°æŠ•å½±çŸ©é˜µ</span>
    
    renderer.<span class="hljs-title function_">setSize</span>(width, height);
}

<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, onWindowResize);
</code></pre>
<hr/>
<h3 data-id="heading-6">å‚æ•° 3ï¸âƒ£ï¼šè¿‘è£å‰ªé¢ï¼ˆNearï¼‰</h3>
<p><strong>å®šä¹‰</strong>ï¼šç›¸æœºèƒ½çœ‹åˆ°çš„<strong>æœ€è¿‘è·ç¦»</strong>ã€‚æ¯”è¿™ä¸ªè·ç¦»æ›´è¿‘çš„ç‰©ä½“ä¸ä¼šè¢«æ˜¾ç¤ºã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒ</strong>ï¼Ÿ</p>
<ul>
<li>ğŸ¯ <strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šä¸æ¸²æŸ“ç›¸æœºèƒŒåçš„ç‰©ä½“</li>
<li>ğŸ” <strong>é¿å…ç©¿æ¨¡</strong>ï¼šé˜²æ­¢ç›¸æœºè¿›å…¥ç‰©ä½“å†…éƒ¨æ—¶çœ‹åˆ°å†…éƒ¨ç»“æ„</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// near = 0.1 æ„å‘³ç€è·ç¦»ç›¸æœº 0.1 å•ä½ä»¥å†…çš„ç‰©ä½“çœ‹ä¸åˆ°</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">40</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// å¦‚æœç‰©ä½“åœ¨ z = 0.05ï¼Œå®ƒä¼šè¢«è£å‰ªæ‰</span>
<span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
cube.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">0.05</span>; <span class="hljs-comment">// âŒ çœ‹ä¸åˆ°</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">å‚æ•° 4ï¸âƒ£ï¼šè¿œè£å‰ªé¢ï¼ˆFarï¼‰</h3>
<p><strong>å®šä¹‰</strong>ï¼šç›¸æœºèƒ½çœ‹åˆ°çš„<strong>æœ€è¿œè·ç¦»</strong>ã€‚æ¯”è¿™ä¸ªè·ç¦»æ›´è¿œçš„ç‰©ä½“ä¸ä¼šè¢«æ˜¾ç¤ºã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒ</strong>ï¼Ÿ</p>
<ul>
<li>ğŸ¯ <strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šä¸æ¸²æŸ“å¤ªè¿œçš„ç‰©ä½“</li>
<li>ğŸ” <strong>æ·±åº¦ç²¾åº¦</strong>ï¼šæé«˜æ·±åº¦ç¼“å†²çš„ç²¾åº¦</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// far = 1000 æ„å‘³ç€è·ç¦»ç›¸æœº 1000 å•ä½ä»¥å¤–çš„ç‰©ä½“çœ‹ä¸åˆ°</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">40</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// å¦‚æœç‰©ä½“åœ¨ z = 1500ï¼Œå®ƒä¼šè¢«è£å‰ªæ‰</span>
<span class="hljs-keyword">const</span> star = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
star.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">1500</span>; <span class="hljs-comment">// âŒ çœ‹ä¸åˆ°</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">è§†é”¥ä½“çš„å¯è§†èŒƒå›´è®¡ç®—</h2>
<h3 data-id="heading-9">ä»€ä¹ˆæ˜¯è§†é”¥ä½“ï¼Ÿ</h3>
<p>è§†é”¥ä½“æ˜¯ä¸€ä¸ª<strong>å››æ£±é”¥å½¢çš„ç©ºé—´</strong>ï¼Œåªæœ‰åœ¨è¿™ä¸ªç©ºé—´å†…çš„ç‰©ä½“æ‰èƒ½è¢«çœ‹åˆ°ã€‚</p>
<h3 data-id="heading-10">è®¡ç®—å¯è§†èŒƒå›´çš„å…¬å¼</h3>
<p>åœ¨è·ç¦»ç›¸æœº <code>distance</code> å¤„ï¼Œå¯è§†èŒƒå›´çš„å¤§å°ä¸ºï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å‚ç›´é«˜åº¦ = <span class="hljs-number">2</span> Ã— <span class="hljs-built_in">tan</span>(FOV/<span class="hljs-number">2</span>) Ã— distance
æ°´å¹³å®½åº¦ = å‚ç›´é«˜åº¦ Ã— aspect
</code></pre>
<h3 data-id="heading-11">å®é™…è®¡ç®—ç¤ºä¾‹</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·çš„ç›¸æœºé…ç½®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fov = <span class="hljs-number">40</span>;           <span class="hljs-comment">// è§†é‡è§’åº¦</span>
<span class="hljs-keyword">const</span> aspect = <span class="hljs-number">2</span>;         <span class="hljs-comment">// å®½é«˜æ¯”ï¼ˆ2:1ï¼‰</span>
<span class="hljs-keyword">const</span> distance = <span class="hljs-number">120</span>;     <span class="hljs-comment">// ç›¸æœºè·ç¦»ï¼ˆz = 120ï¼‰</span>

<span class="hljs-comment">// è®¡ç®—å‚ç›´å¯è§†é«˜åº¦</span>
<span class="hljs-keyword">const</span> vFOV = fov * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>; <span class="hljs-comment">// è½¬æ¢ä¸ºå¼§åº¦</span>
<span class="hljs-keyword">const</span> height = <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">tan</span>(vFOV / <span class="hljs-number">2</span>) * distance;
<span class="hljs-comment">// height = 2 Ã— tan(20Â°) Ã— 120</span>
<span class="hljs-comment">// height = 2 Ã— 0.364 Ã— 120</span>
<span class="hljs-comment">// height â‰ˆ 87.2</span>

<span class="hljs-comment">// è®¡ç®—æ°´å¹³å¯è§†å®½åº¦</span>
<span class="hljs-keyword">const</span> width = height * aspect;
<span class="hljs-comment">// width = 87.2 Ã— 2</span>
<span class="hljs-comment">// width â‰ˆ 174.4</span>
</code></pre>
<p><strong>ç»“è®º</strong>ï¼šåœ¨ z=120 å¤„ï¼Œç›¸æœºèƒ½çœ‹åˆ°çš„èŒƒå›´æ˜¯ï¼š</p>
<ul>
<li>ğŸ“ <strong>å®½åº¦</strong>ï¼š174.4 å•ä½</li>
<li>ğŸ“ <strong>é«˜åº¦</strong>ï¼š87.2 å•ä½</li>
</ul>
<hr/>
<h2 data-id="heading-12">åæ ‡èŒƒå›´çš„ç¡®å®š</h2>
<h3 data-id="heading-13">åœºæ™¯å¸ƒå±€ç¤ºä¾‹</h3>
<p>å‡è®¾æˆ‘ä»¬è¦åœ¨åœºæ™¯ä¸­æ”¾ç½®ä¸€ä¸ª 5Ã—4 çš„ç½‘æ ¼ï¼ˆ5åˆ— 4è¡Œï¼‰ï¼Œæ¯ä¸ªç‰©ä½“ä¹‹é—´é—´è·ä¸º 15 å•ä½ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> spread = <span class="hljs-number">15</span>; <span class="hljs-comment">// é—´è·</span>

<span class="hljs-comment">// ç‰©ä½“ä½ç½®è®¡ç®—</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = -<span class="hljs-number">2</span>; x &lt;= <span class="hljs-number">2</span>; x++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = -<span class="hljs-number">1</span>; y &lt;= <span class="hljs-number">2</span>; y++) {
        <span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">createObject</span>();
        obj.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = x * spread;  <span class="hljs-comment">// x: -30, -15, 0, 15, 30</span>
        obj.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = y * spread;  <span class="hljs-comment">// y: -15, 0, 15, 30</span>
        scene.<span class="hljs-title function_">add</span>(obj);
    }
}
</code></pre>
<p><strong>å¯¹è±¡åˆ†å¸ƒèŒƒå›´</strong>ï¼š</p>
<ul>
<li>X è½´ï¼š-30 åˆ° 30ï¼ˆå®½åº¦ 60ï¼‰</li>
<li>Y è½´ï¼š-15 åˆ° 30ï¼ˆé«˜åº¦ 45ï¼‰</li>
</ul>
<h3 data-id="heading-14">æ£€æŸ¥æ˜¯å¦è¶…å‡ºå¯è§†èŒƒå›´</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç›¸æœºå¯è§†èŒƒå›´</span>
<span class="hljs-keyword">const</span> visibleWidth = <span class="hljs-number">174.4</span>;
<span class="hljs-keyword">const</span> visibleHeight = <span class="hljs-number">87.2</span>;

<span class="hljs-comment">// å¯¹è±¡èŒƒå›´</span>
<span class="hljs-keyword">const</span> objectWidth = <span class="hljs-number">60</span>;
<span class="hljs-keyword">const</span> objectHeight = <span class="hljs-number">45</span>;

<span class="hljs-comment">// æ£€æŸ¥</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å®½åº¦æ˜¯å¦è¶…å‡º: <span class="hljs-subst">${objectWidth &gt; visibleWidth}</span>`</span>); <span class="hljs-comment">// false âœ…</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`é«˜åº¦æ˜¯å¦è¶…å‡º: <span class="hljs-subst">${objectHeight &gt; visibleHeight}</span>`</span>); <span class="hljs-comment">// false âœ…</span>
</code></pre>
<h3 data-id="heading-15">å¦‚æœè¶…å‡ºèŒƒå›´æ€ä¹ˆåŠï¼Ÿ</h3>
<p><strong>é—®é¢˜</strong>ï¼šå½“ spread=20 æ—¶ï¼Œå¯¹è±¡èŒƒå›´å˜ä¸º 80Ã—60ï¼Œè¶…å‡ºäº†å¯è§†èŒƒå›´ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<h4 data-id="heading-16">æ–¹æ¡ˆ 1ï¼šå¢åŠ ç›¸æœºè·ç¦»</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŸæ¥</span>
camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">120</span>;

<span class="hljs-comment">// æ”¹ä¸º</span>
camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">160</span>; <span class="hljs-comment">// è·ç¦»è¶Šè¿œï¼Œçœ‹åˆ°çš„èŒƒå›´è¶Šå¤§</span>
</code></pre>
<h4 data-id="heading-17">æ–¹æ¡ˆ 2ï¼šå¢åŠ è§†é‡è§’åº¦</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŸæ¥</span>
<span class="hljs-keyword">const</span> fov = <span class="hljs-number">40</span>;

<span class="hljs-comment">// æ”¹ä¸º</span>
<span class="hljs-keyword">const</span> fov = <span class="hljs-number">60</span>; <span class="hljs-comment">// è§†è§’è¶Šå¤§ï¼Œçœ‹åˆ°çš„èŒƒå›´è¶Šå¤§</span>
</code></pre>
<h4 data-id="heading-18">æ–¹æ¡ˆ 3ï¼šå‡å°é—´è·</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŸæ¥</span>
<span class="hljs-keyword">const</span> spread = <span class="hljs-number">20</span>;

<span class="hljs-comment">// æ”¹ä¸º</span>
<span class="hljs-keyword">const</span> spread = <span class="hljs-number">15</span>; <span class="hljs-comment">// ç‰©ä½“é å¾—æ›´è¿‘</span>
</code></pre>
<h4 data-id="heading-19">æ–¹æ¡ˆ 4ï¼šä½¿ç”¨æ­£äº¤ç›¸æœº</h4>
<p>å¦‚æœä½ ä¸éœ€è¦é€è§†æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨æ­£äº¤ç›¸æœºï¼ˆOrthographicCameraï¼‰ï¼Œå®ƒçš„å¯è§†èŒƒå›´ä¸ä¼šéšè·ç¦»å˜åŒ–ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">OrthographicCamera</span>(
    -<span class="hljs-number">100</span>,  <span class="hljs-comment">// left</span>
    <span class="hljs-number">100</span>,   <span class="hljs-comment">// right</span>
    <span class="hljs-number">50</span>,    <span class="hljs-comment">// top</span>
    -<span class="hljs-number">50</span>,   <span class="hljs-comment">// bottom</span>
    <span class="hljs-number">0.1</span>,   <span class="hljs-comment">// near</span>
    <span class="hljs-number">1000</span>   <span class="hljs-comment">// far</span>
);
</code></pre>
<hr/>
<h2 data-id="heading-20">å®æˆ˜ä»£ç </h2>
<h3 data-id="heading-21">å®Œæ•´çš„å“åº”å¼ç›¸æœºè®¾ç½®</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'three'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponsiveCamera</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fov</span> = <span class="hljs-number">40</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">near</span> = <span class="hljs-number">0.1</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">far</span> = <span class="hljs-number">1000</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">distance</span> = <span class="hljs-number">120</span>;
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateCamera</span>();
    }
    
    <span class="hljs-title function_">updateCamera</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> aspect = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">fov</span>,
            aspect,
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">near</span>,
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">far</span>
        );
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">distance</span>;
    }
    
    <span class="hljs-comment">// è®¡ç®—æŒ‡å®šæ·±åº¦å¤„çš„å¯è§†èŒƒå›´</span>
    <span class="hljs-title function_">getVisibleRange</span>(<span class="hljs-params">depth = <span class="hljs-literal">null</span></span>) {
        <span class="hljs-keyword">const</span> vFOV = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">fov</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) / <span class="hljs-number">180</span>;
        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æŒ‡å®šæ·±åº¦ï¼Œä½¿ç”¨ç›¸æœºçš„é»˜è®¤è·ç¦»</span>
        <span class="hljs-keyword">const</span> distance = depth !== <span class="hljs-literal">null</span> ? depth : <span class="hljs-variable language_">this</span>.<span class="hljs-property">distance</span>;
        <span class="hljs-keyword">const</span> height = <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">tan</span>(vFOV / <span class="hljs-number">2</span>) * distance;
        <span class="hljs-keyword">const</span> width = height * (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);

        <span class="hljs-keyword">return</span> { width, height };
    }
    
    <span class="hljs-comment">// æ£€æŸ¥ç‰©ä½“æ˜¯å¦åœ¨å¯è§†èŒƒå›´å†…</span>
    <span class="hljs-title function_">isObjectVisible</span>(<span class="hljs-params">obj</span>) {
        <span class="hljs-keyword">const</span> pos = obj.<span class="hljs-property">position</span>;
        
        <span class="hljs-comment">// è®¡ç®—ç‰©ä½“ç›¸å¯¹äºç›¸æœºçš„è·ç¦»ï¼ˆæ²¿ç€ç›¸æœºçš„è§†çº¿æ–¹å‘ï¼‰</span>
        <span class="hljs-keyword">const</span> distanceFromCamera = <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> - pos.<span class="hljs-property">z</span>;
        
        <span class="hljs-comment">// è®¡ç®—ç‰©ä½“æ‰€åœ¨æ·±åº¦çš„å¯è§†èŒƒå›´</span>
        <span class="hljs-keyword">const</span> range = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getVisibleRange</span>(distanceFromCamera);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç‰©ä½“è·ç¦»ç›¸æœº:'</span>, distanceFromCamera, <span class="hljs-string">'è¯¥æ·±åº¦çš„å¯è§†èŒƒå›´:'</span>, range);

        <span class="hljs-keyword">return</span> (
            <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(pos.<span class="hljs-property">x</span>) &lt;= range.<span class="hljs-property">width</span> / <span class="hljs-number">2</span> &amp;&amp;
            <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(pos.<span class="hljs-property">y</span>) &lt;= range.<span class="hljs-property">height</span> / <span class="hljs-number">2</span> &amp;&amp;
            distanceFromCamera &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">near</span> &amp;&amp;
            distanceFromCamera &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">far</span>
        );
    }
    
    <span class="hljs-comment">// çª—å£å¤§å°æ”¹å˜æ—¶æ›´æ–°</span>
    <span class="hljs-title function_">onWindowResize</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateCamera</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>.<span class="hljs-title function_">updateProjectionMatrix</span>();
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();
scene.<span class="hljs-property">background</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0x222222</span>);

<span class="hljs-comment">// 4. åˆ›å»ºæ¸²æŸ“å™¨ï¼šå°†3Dåœºæ™¯æ¸²æŸ“åˆ°ç½‘é¡µä¸Š</span>
<span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({ <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// antialiaså¼€å¯æŠ—é”¯é½¿</span>
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>); <span class="hljs-comment">// è®¾ç½®æ¸²æŸ“å°ºå¯¸</span>
<span class="hljs-comment">// å°†æ¸²æŸ“å™¨çš„ç”»å¸ƒæ·»åŠ åˆ°ç½‘é¡µä¸­</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);

<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponsiveCamera</span>();
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> camera.<span class="hljs-title function_">onWindowResize</span>());

<span class="hljs-comment">// æ·»åŠ å…‰æº</span>
<span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.6</span>);
scene.<span class="hljs-title function_">add</span>(ambientLight);

<span class="hljs-keyword">const</span> directionalLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.8</span>);
directionalLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>);
scene.<span class="hljs-title function_">add</span>(directionalLight);

<span class="hljs-comment">// æ£€æŸ¥ç‰©ä½“æ˜¯å¦å¯è§</span>
<span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>), <span class="hljs-title function_">createMaterial</span>());
cube.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>, -<span class="hljs-number">10</span>);
scene.<span class="hljs-title function_">add</span>(cube);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params">time</span>) {
    renderer.<span class="hljs-title function_">render</span>(scene, camera.<span class="hljs-title function_">getCamera</span>());
    <span class="hljs-title function_">requestAnimationFrame</span>(animate);
}

<span class="hljs-title function_">requestAnimationFrame</span>(animate);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(camera.<span class="hljs-title function_">isObjectVisible</span>(cube)); <span class="hljs-comment">// true or false</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">å°ç»“</h2>
<ol>
<li>
<p><strong>FOV å’Œ distance å†³å®šå¯è§†èŒƒå›´</strong></p>
<ul>
<li>FOV è¶Šå¤§ï¼Œçœ‹åˆ°çš„èŒƒå›´è¶Šå¤§</li>
<li>distance è¶Šå¤§ï¼Œçœ‹åˆ°çš„èŒƒå›´è¶Šå¤§</li>
</ul>
</li>
<li>
<p><strong>aspect å¿…é¡»ä¸ç”»å¸ƒæ¯”ä¾‹ä¸€è‡´</strong></p>
<ul>
<li>å¦åˆ™ç”»é¢ä¼šè¢«æ‹‰ä¼¸å˜å½¢</li>
</ul>
</li>
<li>
<p><strong>near å’Œ far å®šä¹‰äº†æ·±åº¦èŒƒå›´</strong></p>
<ul>
<li>åœ¨è¿™ä¸ªèŒƒå›´å¤–çš„ç‰©ä½“çœ‹ä¸åˆ°</li>
</ul>
</li>
</ol>
<p>ğŸ“‚Â <strong>æ ¸å¿ƒä»£ç ä¸å®Œæ•´ç¤ºä¾‹ï¼š</strong> Â Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fqq790git%2Fmy-three-app.git" target="_blank" title="https://github.com/qq790git/my-three-app.git" ref="nofollow noopener noreferrer">my-three-app</a></p>
<h3 data-id="heading-23">æ€»ç»“</h3>
<p><strong>å¦‚æœä½ å–œæ¬¢æœ¬æ•™ç¨‹ï¼Œè®°å¾—ç‚¹èµ+æ”¶è—ï¼å…³æ³¨æˆ‘è·å–æ›´å¤šThree.jså¼€å‘å¹²è´§</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ87ï¼‰å¦‚ä½•åœ¨å®‰å…¨æµ‹è¯•ä¸­ä½¿ç”¨Hibernateï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603563317040349247</link>    <guid>https://juejin.cn/post/7603563317040349247</guid>    <pubDate>2026-02-06T14:25:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563317040349247" data-draft-id="7603563360329367594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ87ï¼‰å¦‚ä½•åœ¨å®‰å…¨æµ‹è¯•ä¸­ä½¿ç”¨Hibernateï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-06T14:25:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ87ï¼‰å¦‚ä½•åœ¨å®‰å…¨æµ‹è¯•ä¸­ä½¿ç”¨Hibernateï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T14:25:35.000Z" title="Fri Feb 06 2026 14:25:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å®‰å…¨æµ‹è¯•ä¸­ä½¿ç”¨Hibernateï¼Œå¯ä»¥å¸®åŠ©ä½ è¯†åˆ«å’Œè§£å†³ä¸ORMæ¡†æ¶ç›¸å…³çš„å®‰å…¨æ¼æ´ï¼Œå¦‚SQLæ³¨å…¥ã€æ•°æ®æ³„éœ²ç­‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¯¦ç»†çš„ç¤ºä¾‹ï¼Œç»“åˆä»£ç è®²è§£å¦‚ä½•åœ¨å®‰å…¨æµ‹è¯•ä¸­ä½¿ç”¨Hibernateï¼ŒåŒ…æ‹¬æ•°æ®åº“é…ç½®ã€ç¼–å†™å®ä½“ç±»ã€æ¨¡æ‹Ÿæ½œåœ¨çš„å®‰å…¨æ¼æ´ã€ç¼–å†™å®‰å…¨æµ‹è¯•è„šæœ¬ä»¥åŠä½¿ç”¨å·¥å…·è¿›è¡Œå®‰å…¨è¯„ä¼°ã€‚</p>
<h3 data-id="heading-0">å‰ææ¡ä»¶</h3>
<ul>
<li>ä½¿ç”¨MySQLä½œä¸ºæ•°æ®åº“ã€‚</li>
<li>ä½¿ç”¨Gradleä½œä¸ºæ„å»ºå·¥å…·ã€‚</li>
<li>ä½¿ç”¨JUnitè¿›è¡Œå®‰å…¨æµ‹è¯•ã€‚</li>
<li>ä½¿ç”¨Hibernateè¿›è¡ŒORMæ“ä½œã€‚</li>
<li>ä½¿ç”¨OWASP ZAPè¿›è¡Œå®‰å…¨æ‰«æã€‚</li>
</ul>
<h3 data-id="heading-1">1. è®¾ç½®Hibernateé…ç½®</h3>
<p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªHibernateé…ç½®æ–‡ä»¶<code>hibernate.cfg.xml</code>ï¼Œç”¨äºè¿æ¥æ•°æ®åº“ã€‚</p>
<h4 data-id="heading-2"><code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span> <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/security_test_db<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>db_user<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>db_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. åˆ›å»ºå®ä½“ç±»</h3>
<p>å®šä¹‰ä¸€ä¸ªç®€å•çš„å®ä½“ç±»æ¥è¡¨ç¤ºæ•°æ®åº“è¡¨ä¸­çš„æ•°æ®ã€‚</p>
<h4 data-id="heading-4"><code>User.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-comment">// Getters and setters</span>
}
</code></pre>
<h3 data-id="heading-5">3. é…ç½®Gradle</h3>
<p>åœ¨Gradleæ„å»ºè„šæœ¬ä¸­æ·»åŠ Hibernateå’ŒJUnitä¾èµ–ã€‚</p>
<h4 data-id="heading-6"><code>build.gradle</code></h4>
<pre><code class="hljs language-groovy" lang="groovy">plugins {
    id 'java'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.hibernate:hibernate-core:5.6.5.Final'
    implementation 'mysql:mysql-connector-java:8.0.27'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.8.2'
}

test {
    useJUnitPlatform()
}
</code></pre>
<h3 data-id="heading-7">4. ç¼–å†™æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰</h3>
<p>ç¼–å†™ä¸€ä¸ªæ•°æ®è®¿é—®å¯¹è±¡ç±»ï¼Œç”¨äºæ‰§è¡Œæ•°æ®åº“æ“ä½œã€‚</p>
<h4 data-id="heading-8"><code>UserDAO.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDAO</span> {
    <span class="hljs-keyword">private</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserDAO</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>);
        sessionFactory = config.buildSessionFactory();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        session.save(user);
        transaction.commit();
        session.close();
    }

    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findAllUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        List&lt;User&gt; users = session.createQuery(<span class="hljs-string">"FROM User"</span>, User.class).list();
        session.close();
        <span class="hljs-keyword">return</span> users;
    }

    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findUserByNameUnsafe</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        List&lt;User&gt; users = session.createQuery(<span class="hljs-string">"FROM User WHERE name = '"</span> + name + <span class="hljs-string">"'"</span>, User.class).list();
        session.close();
        <span class="hljs-keyword">return</span> users.isEmpty() ? <span class="hljs-literal">null</span> : users.get(<span class="hljs-number">0</span>);
    }
}
</code></pre>
<h3 data-id="heading-9">5. ç¼–å†™å®‰å…¨æµ‹è¯•</h3>
<p>ç¼–å†™JUnitæµ‹è¯•ç±»ï¼Œæ¨¡æ‹Ÿæ½œåœ¨çš„SQLæ³¨å…¥æ”»å‡»å¹¶æ£€æµ‹å®‰å…¨æ¼æ´ã€‚</p>
<h4 data-id="heading-10"><code>UserDAOTest.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.*;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.jupiter.api.Assertions.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDAOTest</span> {
    <span class="hljs-keyword">private</span> UserDAO userDAO;

    <span class="hljs-meta">@BeforeEach</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> {
        userDAO = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDAO</span>();
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setName(<span class="hljs-string">"admin"</span>);
        user.setEmail(<span class="hljs-string">"admin@example.com"</span>);
        userDAO.saveUser(user);
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSQLInjection</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">maliciousInput</span> <span class="hljs-operator">=</span> <span class="hljs-string">"admin' OR '1'='1"</span>;
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userDAO.findUserByNameUnsafe(maliciousInput);
        assertNotNull(user, <span class="hljs-string">"SQL injection vulnerability detected!"</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">6. ä½¿ç”¨OWASP ZAPè¿›è¡Œå®‰å…¨æ‰«æ</h3>
<p>OWASP ZAPæ˜¯ä¸€ä¸ªå¼€æºçš„å®‰å…¨æ‰«æå·¥å…·ï¼Œå¯ä»¥ç”¨äºæ£€æµ‹Webåº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ¼æ´ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨OWASP ZAPè¿›è¡Œå®‰å…¨æ‰«æçš„æ­¥éª¤ã€‚</p>
<h4 data-id="heading-12">å®‰è£…OWASP ZAP</h4>
<p>ä»<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zaproxy.org%2Fdownload%2F" target="_blank" title="https://www.zaproxy.org/download/" ref="nofollow noopener noreferrer">OWASP ZAPå®˜ç½‘</a>ä¸‹è½½å¹¶å®‰è£…ZAPã€‚</p>
<h4 data-id="heading-13">é…ç½®OWASP ZAPä»£ç†</h4>
<p>OWASP ZAPå¯ä»¥é…ç½®ä¸ºä»£ç†ï¼Œæ‹¦æˆªå’Œåˆ†æåº”ç”¨ç¨‹åºçš„HTTPè¯·æ±‚å’Œå“åº”ã€‚</p>
<ol>
<li>å¯åŠ¨OWASP ZAPã€‚</li>
<li>é…ç½®æµè§ˆå™¨ä»£ç†ä¸ºZAPä»£ç†ï¼ˆé»˜è®¤ç›‘å¬ç«¯å£ä¸º8080ï¼‰ã€‚</li>
</ol>
<h4 data-id="heading-14">è¿è¡Œå®‰å…¨æ‰«æ</h4>
<ol>
<li>å¯åŠ¨ä½ çš„Webåº”ç”¨ç¨‹åºã€‚</li>
<li>åœ¨æµè§ˆå™¨ä¸­é€šè¿‡ä»£ç†è®¿é—®ä½ çš„åº”ç”¨ç¨‹åºï¼Œè®©ZAPæ‹¦æˆªè¯·æ±‚ã€‚</li>
<li>ä½¿ç”¨ZAPè¿›è¡Œè‡ªåŠ¨æ‰«æï¼ŒæŸ¥æ‰¾æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚</li>
</ol>
<h3 data-id="heading-15">7. é›†æˆåˆ°CI/CDæµç¨‹</h3>
<p>å°†å®‰å…¨æµ‹è¯•å’Œæ‰«æé›†æˆåˆ°ä½ çš„CI/CDæµç¨‹ä¸­ï¼Œç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½è¿›è¡Œå®‰å…¨è¯„ä¼°ã€‚</p>
<h4 data-id="heading-16"><code>.github/workflows/security-test.yml</code></h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Security</span> <span class="hljs-string">Test</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>

    <span class="hljs-attr">services:</span>
      <span class="hljs-attr">mysql:</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span>
        <span class="hljs-attr">ports:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">security_test_db</span>
          <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">db_user</span>
          <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">db_password</span>
        <span class="hljs-attr">options:</span> <span class="hljs-string">--health-cmd="mysqladmin</span> <span class="hljs-string">ping</span> <span class="hljs-string">--silent"</span> <span class="hljs-string">--health-interval=10s</span> <span class="hljs-string">--health-timeout=5s</span> <span class="hljs-string">--health-retries=3</span>

    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">JDK</span> <span class="hljs-number">11</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">java-version:</span> <span class="hljs-string">'11'</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Grant</span> <span class="hljs-string">execute</span> <span class="hljs-string">permission</span> <span class="hljs-string">for</span> <span class="hljs-string">gradlew</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">chmod</span> <span class="hljs-string">+x</span> <span class="hljs-string">gradlew</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">security</span> <span class="hljs-string">tests</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">./gradlew</span> <span class="hljs-string">test</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">OWASP</span> <span class="hljs-string">ZAP</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">zaproxy/action-full-scan@v0.4.0</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">target:</span> <span class="hljs-string">'http://localhost:8080'</span>
        <span class="hljs-attr">docker_name:</span> <span class="hljs-string">'owasp/zap2docker-stable'</span>
      <span class="hljs-attr">env:</span>
        <span class="hljs-attr">GITHUB_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.GITHUB_TOKEN</span> <span class="hljs-string">}}</span>
</code></pre>
<h3 data-id="heading-17">ä¾‹å­è§£é‡Š</h3>
<ol>
<li><strong>Hibernateé…ç½®ï¼š</strong> é…ç½®ä¸€ä¸ªHibernateé…ç½®æ–‡ä»¶ï¼Œç”¨äºè¿æ¥æ•°æ®åº“ã€‚</li>
<li><strong>å®ä½“ç±»ï¼š</strong> åˆ›å»ºä¸€ä¸ªç®€å•çš„å®ä½“ç±»æ¥è¡¨ç¤ºæ•°æ®åº“è¡¨ä¸­çš„æ•°æ®ã€‚</li>
<li><strong>Gradleé…ç½®ï¼š</strong> åœ¨Gradleæ„å»ºè„šæœ¬ä¸­æ·»åŠ Hibernateå’ŒJUnitä¾èµ–ã€‚</li>
<li><strong>æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰ï¼š</strong> ç¼–å†™ä¸€ä¸ªæ•°æ®è®¿é—®å¯¹è±¡ç±»ï¼Œç”¨äºæ‰§è¡Œæ•°æ®åº“æ“ä½œã€‚</li>
<li><strong>å®‰å…¨æµ‹è¯•ï¼š</strong> ç¼–å†™JUnitæµ‹è¯•ç±»ï¼Œæ¨¡æ‹Ÿæ½œåœ¨çš„SQLæ³¨å…¥æ”»å‡»å¹¶æ£€æµ‹å®‰å…¨æ¼æ´ã€‚</li>
<li><strong>ä½¿ç”¨OWASP ZAPè¿›è¡Œå®‰å…¨æ‰«æï¼š</strong> é…ç½®å¹¶ä½¿ç”¨OWASP ZAPè¿›è¡Œå®‰å…¨æ‰«æï¼ŒæŸ¥æ‰¾åº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ¼æ´ã€‚</li>
<li><strong>é›†æˆåˆ°CI/CDæµç¨‹ï¼š</strong> å°†å®‰å…¨æµ‹è¯•å’Œæ‰«æé›†æˆåˆ°CI/CDæµç¨‹ä¸­ï¼Œç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½è¿›è¡Œå®‰å…¨è¯„ä¼°ã€‚</li>
</ol>
<p>é€šè¿‡ä»¥ä¸Šé…ç½®å’Œä»£ç ç¤ºä¾‹ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨å®‰å…¨æµ‹è¯•ä¸­ä½¿ç”¨Hibernateã€‚è¿™åŒ…æ‹¬å¦‚ä½•é…ç½®Hibernateã€å®šä¹‰å®ä½“ç±»ã€ç¼–å†™æ•°æ®è®¿é—®å¯¹è±¡ã€æ¨¡æ‹Ÿæ½œåœ¨çš„å®‰å…¨æ¼æ´ã€ç¼–å†™å®‰å…¨æµ‹è¯•è„šæœ¬ä»¥åŠä½¿ç”¨OWASP ZAPè¿›è¡Œå®‰å…¨æ‰«æã€‚æ­¤æµç¨‹å¸®åŠ©è¯†åˆ«å’Œè§£å†³ä¸ORMæ¡†æ¶ç›¸å…³çš„å®‰å…¨æ¼æ´ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ88ï¼‰å¦‚ä½•åœ¨è´Ÿè½½æµ‹è¯•ä¸­ä½¿ç”¨Hibernateï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603563317040382015</link>    <guid>https://juejin.cn/post/7603563317040382015</guid>    <pubDate>2026-02-06T14:26:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563317040382015" data-draft-id="7603561363571425343" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ88ï¼‰å¦‚ä½•åœ¨è´Ÿè½½æµ‹è¯•ä¸­ä½¿ç”¨Hibernateï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-06T14:26:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ88ï¼‰å¦‚ä½•åœ¨è´Ÿè½½æµ‹è¯•ä¸­ä½¿ç”¨Hibernateï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T14:26:15.000Z" title="Fri Feb 06 2026 14:26:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨è´Ÿè½½æµ‹è¯•ä¸­ä½¿ç”¨Hibernateï¼Œå¯ä»¥å¸®åŠ©ä½ è¯†åˆ«å’Œè§£å†³åº”ç”¨ç¨‹åºåœ¨é«˜è´Ÿè½½ä¸‹çš„æ€§èƒ½ç“¶é¢ˆã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¯¦ç»†çš„ç¤ºä¾‹ï¼Œç»“åˆä»£ç è®²è§£å¦‚ä½•åœ¨è´Ÿè½½æµ‹è¯•ä¸­ä½¿ç”¨Hibernateï¼ŒåŒ…æ‹¬æ•°æ®åº“é…ç½®ã€ç¼–å†™å®ä½“ç±»ã€è®¾ç½®æ•°æ®è®¿é—®å¯¹è±¡ (DAO)ã€è´Ÿè½½æµ‹è¯•è„šæœ¬ä»¥åŠä½¿ç”¨å·¥å…·è¿›è¡Œè´Ÿè½½æµ‹è¯•ã€‚</p>
<h3 data-id="heading-0">å‰ææ¡ä»¶</h3>
<ul>
<li>ä½¿ç”¨MySQLä½œä¸ºæ•°æ®åº“ã€‚</li>
<li>ä½¿ç”¨Gradleä½œä¸ºæ„å»ºå·¥å…·ã€‚</li>
<li>ä½¿ç”¨JUnitè¿›è¡Œè´Ÿè½½æµ‹è¯•ã€‚</li>
<li>ä½¿ç”¨Hibernateè¿›è¡ŒORMæ“ä½œã€‚</li>
<li>ä½¿ç”¨Gatlingè¿›è¡Œè´Ÿè½½æµ‹è¯•ã€‚</li>
</ul>
<h3 data-id="heading-1">1. è®¾ç½®Hibernateé…ç½®</h3>
<p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªHibernateé…ç½®æ–‡ä»¶ <code>hibernate.cfg.xml</code>ï¼Œç”¨äºè¿æ¥æ•°æ®åº“ã€‚</p>
<h4 data-id="heading-2"><code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span> <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/load_test_db<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>db_user<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>db_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. åˆ›å»ºå®ä½“ç±»</h3>
<p>å®šä¹‰ä¸€ä¸ªç®€å•çš„å®ä½“ç±»æ¥è¡¨ç¤ºæ•°æ®åº“è¡¨ä¸­çš„æ•°æ®ã€‚</p>
<h4 data-id="heading-4"><code>User.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-comment">// Getters and setters</span>
}
</code></pre>
<h3 data-id="heading-5">3. é…ç½®Gradle</h3>
<p>åœ¨Gradleæ„å»ºè„šæœ¬ä¸­æ·»åŠ Hibernateå’ŒJUnitä¾èµ–ã€‚</p>
<h4 data-id="heading-6"><code>build.gradle</code></h4>
<pre><code class="hljs language-groovy" lang="groovy">plugins {
    id 'java'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.hibernate:hibernate-core:5.6.5.Final'
    implementation 'mysql:mysql-connector-java:8.0.27'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.8.2'
}

test {
    useJUnitPlatform()
}
</code></pre>
<h3 data-id="heading-7">4. ç¼–å†™æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰</h3>
<p>ç¼–å†™ä¸€ä¸ªæ•°æ®è®¿é—®å¯¹è±¡ç±»ï¼Œç”¨äºæ‰§è¡Œæ•°æ®åº“æ“ä½œã€‚</p>
<h4 data-id="heading-8"><code>UserDAO.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDAO</span> {
    <span class="hljs-keyword">private</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserDAO</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>);
        sessionFactory = config.buildSessionFactory();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        session.save(user);
        transaction.commit();
        session.close();
    }

    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findAllUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        List&lt;User&gt; users = session.createQuery(<span class="hljs-string">"FROM User"</span>, User.class).list();
        session.close();
        <span class="hljs-keyword">return</span> users;
    }
}
</code></pre>
<h3 data-id="heading-9">5. ç¼–å†™è´Ÿè½½æµ‹è¯•è„šæœ¬</h3>
<p>ä½¿ç”¨JUnitç¼–å†™è´Ÿè½½æµ‹è¯•è„šæœ¬ï¼Œæ¨¡æ‹Ÿé«˜å¹¶å‘ç¯å¢ƒä¸‹çš„æ•°æ®åº“æ“ä½œã€‚</p>
<h4 data-id="heading-10"><code>UserDAOTest.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.*;
<span class="hljs-keyword">import</span> java.util.concurrent.*;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.jupiter.api.Assertions.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDAOTest</span> {
    <span class="hljs-keyword">private</span> UserDAO userDAO;

    <span class="hljs-meta">@BeforeEach</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> {
        userDAO = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDAO</span>();
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testConcurrentUserInserts</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">int</span> <span class="hljs-variable">numberOfThreads</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(numberOfThreads);
        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(numberOfThreads);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; numberOfThreads; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> i;
            executorService.submit(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
                    user.setName(<span class="hljs-string">"User"</span> + index);
                    user.setEmail(<span class="hljs-string">"user"</span> + index + <span class="hljs-string">"@example.com"</span>);
                    userDAO.saveUser(user);
                } <span class="hljs-keyword">finally</span> {
                    latch.countDown();
                }
            });
        }

        latch.await();
        executorService.shutdown();

        <span class="hljs-comment">// Verify that all users were inserted</span>
        List&lt;User&gt; users = userDAO.findAllUsers();
        assertEquals(numberOfThreads, users.size());
    }
}
</code></pre>
<h3 data-id="heading-11">6. ä½¿ç”¨Gatlingè¿›è¡Œè´Ÿè½½æµ‹è¯•</h3>
<p>Gatlingæ˜¯ä¸€ä¸ªå¼€æºçš„è´Ÿè½½æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥ç”Ÿæˆé«˜å¹¶å‘è¯·æ±‚æ¥æ¨¡æ‹Ÿå®é™…çš„ç”¨æˆ·è¡Œä¸ºã€‚</p>
<h4 data-id="heading-12">å®‰è£…Gatling</h4>
<p>ä»<a href="https://link.juejin.cn?target=https%3A%2F%2Fgatling.io%2Fopen-source%2F%23download" target="_blank" title="https://gatling.io/open-source/#download" ref="nofollow noopener noreferrer">Gatlingå®˜ç½‘</a>ä¸‹è½½å¹¶å®‰è£…Gatlingã€‚</p>
<h4 data-id="heading-13">ç¼–å†™Gatlingè„šæœ¬</h4>
<p>åˆ›å»ºä¸€ä¸ªGatlingè„šæœ¬æ¥æ¨¡æ‹Ÿé«˜å¹¶å‘è¯·æ±‚ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªREST API endpointæ¥ä¿å­˜ç”¨æˆ·æ•°æ®ã€‚</p>
<h4 data-id="heading-14"><code>UserSimulation.scala</code></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> io.gatling.core.<span class="hljs-type">Predef</span>._
<span class="hljs-keyword">import</span> io.gatling.http.<span class="hljs-type">Predef</span>._
<span class="hljs-keyword">import</span> scala.concurrent.duration._

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserSimulation</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Simulation</span> </span>{

  <span class="hljs-keyword">val</span> httpProtocol = http
    .baseUrl(<span class="hljs-string">"http://localhost:8080"</span>) <span class="hljs-comment">// ä½ çš„åº”ç”¨ç¨‹åºçš„åŸºURL</span>
    .acceptHeader(<span class="hljs-string">"application/json"</span>)
    .contentTypeHeader(<span class="hljs-string">"application/json"</span>)

  <span class="hljs-keyword">val</span> scn = scenario(<span class="hljs-string">"User Simulation"</span>)
    .exec(
      http(<span class="hljs-string">"Save User"</span>)
        .post(<span class="hljs-string">"/users"</span>)
        .body(<span class="hljs-type">StringBody</span>(<span class="hljs-string">"""{"name": "John Doe", "email": "john.doe@example.com"}"""</span>)).asJson
        .check(status.is(<span class="hljs-number">200</span>))
    )

  setUp(
    scn.inject(
      atOnceUsers(<span class="hljs-number">1000</span>) <span class="hljs-comment">// æ¨¡æ‹Ÿ1000ä¸ªå¹¶å‘ç”¨æˆ·</span>
    )
  ).protocols(httpProtocol)
}
</code></pre>
<h4 data-id="heading-15">è¿è¡ŒGatlingè„šæœ¬</h4>
<p>åœ¨Gatlingç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ‰§è¡Œè´Ÿè½½æµ‹è¯•ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">gatling.sh -s UserSimulation
</code></pre>
<h3 data-id="heading-16">7. é›†æˆåˆ°CI/CDæµç¨‹</h3>
<p>å°†è´Ÿè½½æµ‹è¯•é›†æˆåˆ°CI/CDæµç¨‹ä¸­ï¼Œç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½è¿›è¡Œè´Ÿè½½æµ‹è¯•è¯„ä¼°ã€‚</p>
<h4 data-id="heading-17"><code>.github/workflows/load-test.yml</code></h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Load</span> <span class="hljs-string">Test</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>

    <span class="hljs-attr">services:</span>
      <span class="hljs-attr">mysql:</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span>
        <span class="hljs-attr">ports:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">load_test_db</span>
          <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">db_user</span>
          <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">db_password</span>
        <span class="hljs-attr">options:</span> <span class="hljs-string">--health-cmd="mysqladmin</span> <span class="hljs-string">ping</span> <span class="hljs-string">--silent"</span> <span class="hljs-string">--health-interval=10s</span> <span class="hljs-string">--health-timeout=5s</span> <span class="hljs-string">--health-retries=3</span>

    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">JDK</span> <span class="hljs-number">11</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">java-version:</span> <span class="hljs-string">'11'</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Grant</span> <span class="hljs-string">execute</span> <span class="hljs-string">permission</span> <span class="hljs-string">for</span> <span class="hljs-string">gradlew</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">chmod</span> <span class="hljs-string">+x</span> <span class="hljs-string">gradlew</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">load</span> <span class="hljs-string">tests</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">./gradlew</span> <span class="hljs-string">test</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">Gatling</span> <span class="hljs-string">load</span> <span class="hljs-string">test</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">gatling.sh</span> <span class="hljs-string">-s</span> <span class="hljs-string">UserSimulation</span>
</code></pre>
<h3 data-id="heading-18">ä¾‹å­è§£é‡Š</h3>
<ol>
<li><strong>Hibernateé…ç½®ï¼š</strong> é…ç½®ä¸€ä¸ªHibernateé…ç½®æ–‡ä»¶ï¼Œç”¨äºè¿æ¥æ•°æ®åº“ã€‚</li>
<li><strong>å®ä½“ç±»ï¼š</strong> åˆ›å»ºä¸€ä¸ªç®€å•çš„å®ä½“ç±»æ¥è¡¨ç¤ºæ•°æ®åº“è¡¨ä¸­çš„æ•°æ®ã€‚</li>
<li><strong>Gradleé…ç½®ï¼š</strong> åœ¨Gradleæ„å»ºè„šæœ¬ä¸­æ·»åŠ Hibernateå’ŒJUnitä¾èµ–ã€‚</li>
<li><strong>æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰ï¼š</strong> ç¼–å†™ä¸€ä¸ªæ•°æ®è®¿é—®å¯¹è±¡ç±»ï¼Œç”¨äºæ‰§è¡Œæ•°æ®åº“æ“ä½œã€‚</li>
<li><strong>è´Ÿè½½æµ‹è¯•è„šæœ¬ï¼š</strong> ä½¿ç”¨JUnitç¼–å†™è´Ÿè½½æµ‹è¯•è„šæœ¬ï¼Œæ¨¡æ‹Ÿé«˜å¹¶å‘ç¯å¢ƒä¸‹çš„æ•°æ®åº“æ“ä½œã€‚</li>
<li><strong>ä½¿ç”¨Gatlingè¿›è¡Œè´Ÿè½½æµ‹è¯•ï¼š</strong> ç¼–å†™Gatlingè„šæœ¬ï¼Œæ¨¡æ‹Ÿé«˜å¹¶å‘è¯·æ±‚æ¥æµ‹è¯•åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</li>
<li><strong>é›†æˆåˆ°CI/CDæµç¨‹ï¼š</strong> å°†è´Ÿè½½æµ‹è¯•é›†æˆåˆ°CI/CDæµç¨‹ä¸­ï¼Œç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½è¿›è¡Œè´Ÿè½½æµ‹è¯•è¯„ä¼°ã€‚</li>
</ol>
<p>é€šè¿‡ä»¥ä¸Šé…ç½®å’Œä»£ç ç¤ºä¾‹ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨è´Ÿè½½æµ‹è¯•ä¸­ä½¿ç”¨Hibernateã€‚è¿™åŒ…æ‹¬é…ç½®Hibernateã€å®šä¹‰å®ä½“ç±»ã€ç¼–å†™æ•°æ®è®¿é—®å¯¹è±¡ã€ç¼–å†™è´Ÿè½½æµ‹è¯•è„šæœ¬ã€ä½¿ç”¨Gatlingè¿›è¡Œè´Ÿè½½æµ‹è¯•ï¼Œä»¥åŠå°†è´Ÿè½½æµ‹è¯•é›†æˆåˆ°CI/CDæµç¨‹ä¸­ã€‚æ­¤æµç¨‹å¸®åŠ©è¯†åˆ«å’Œè§£å†³åº”ç”¨ç¨‹åºåœ¨é«˜è´Ÿè½½ä¸‹çš„æ€§èƒ½ç“¶é¢ˆï¼Œç¡®ä¿åœ¨å®é™…ä½¿ç”¨ç¯å¢ƒä¸­ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œé«˜æ•ˆæ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«åªä¼šâ€œåŠ ç´¢å¼•â€äº†ï¼è¿™ 3 ä¸ª PostgreSQL åå¸¸è¯†ä¼˜åŒ–ï¼Œèƒ½æŠŠæ€§èƒ½å’Œæˆæœ¬ä¸€èµ·æ‰“ä¸‹æ¥]]></title>    <link>https://juejin.cn/post/7603567912592506907</link>    <guid>https://juejin.cn/post/7603567912592506907</guid>    <pubDate>2026-02-06T14:55:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912592506907" data-draft-id="7603352117640167433" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«åªä¼šâ€œåŠ ç´¢å¼•â€äº†ï¼è¿™ 3 ä¸ª PostgreSQL åå¸¸è¯†ä¼˜åŒ–ï¼Œèƒ½æŠŠæ€§èƒ½å’Œæˆæœ¬ä¸€èµ·æ‰“ä¸‹æ¥"/> <meta itemprop="keywords" content="æ•°æ®åº“,åç«¯"/> <meta itemprop="datePublished" content="2026-02-06T14:55:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dcs"/> <meta itemprop="url" content="https://juejin.cn/user/3679404422861902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«åªä¼šâ€œåŠ ç´¢å¼•â€äº†ï¼è¿™ 3 ä¸ª PostgreSQL åå¸¸è¯†ä¼˜åŒ–ï¼Œèƒ½æŠŠæ€§èƒ½å’Œæˆæœ¬ä¸€èµ·æ‰“ä¸‹æ¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3679404422861902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dcs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T14:55:22.000Z" title="Fri Feb 06 2026 14:55:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://files.mdnice.com/user/44095/0ac2522b-136d-4b10-b6a0-32ecdc8ca589.jpg" alt="image" loading="lazy"/></p>
<p>æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–è¿™äº‹å„¿ï¼Œå¾ˆå¤šäººæ¡ä»¶åå°„å°±ä¸‰æ¿æ–§ï¼š<strong>æ”¹ SQLã€åŠ ç´¢å¼•ã€å†åŠ ç´¢å¼•</strong>ã€‚ä¸€é€šæ“ä½œä¸‹æ¥ï¼ŒæŸ¥è¯¢å¿«äº†ï¼Œç£ç›˜ç‚¸äº†ï¼›å»¶è¿Ÿé™äº†ï¼Œç»´æŠ¤æˆæœ¬ä¸Šå¤©ï¼›æ›´æ‰å¿ƒçš„æ˜¯â€”â€”ä½ è¿˜ä»¥ä¸ºè‡ªå·±â€œä¼˜åŒ–å¾—å¾ˆä¸“ä¸šâ€ã€‚ğŸ˜…</p>
<p>è¿™ç¯‡æ–‡ç« çš„æ€è·¯å¾ˆâ€œå›é€†â€ï¼šä¸å…¶åœ¨å¸¸è§„å¥—è·¯é‡Œæ‰“è½¬ï¼Œä¸å¦‚æ¢ä¸ªè§’åº¦ï¼Œåˆ©ç”¨ PostgreSQL æœ¬èº«çš„ä¸€äº›æœºåˆ¶åšâ€œéå¸¸è§„ä¼˜åŒ–â€ã€‚ä¸‹é¢æŒ‘ 3 ä¸ªæœ€å®¹æ˜“è½åœ°ã€åŒæ—¶æœ€å®¹æ˜“è¢«å¿½ç•¥çš„ç‚¹ï¼Œè®²é€å®ƒä»¬ä¸ºä»€ä¹ˆèƒ½çœé’±åˆæé€Ÿã€‚</p>
<hr/>
<h2 data-id="heading-0">1ï¼‰åˆ«å†å…¨è¡¨æ‰«äº†</h2>
<p>å…ˆçœ‹ä¸€ä¸ªç‰¹åˆ«çœŸå®çš„åœºæ™¯ï¼šç”¨æˆ·è¡¨åªæœ‰ä¸¤ç§ planï¼š<code>free</code> å’Œ <code>pro</code>ï¼Œå¹¶ä¸”å†™äº†çº¦æŸï¼Œä¿è¯ä¸ä¼šå‡ºç°åˆ«çš„å€¼ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    username TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    plan TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    <span class="hljs-keyword">CONSTRAINT</span> plan_check <span class="hljs-keyword">CHECK</span> (plan <span class="hljs-keyword">IN</span> (<span class="hljs-string">'free'</span>, <span class="hljs-string">'pro'</span>))
);
</code></pre>
<p>ç„¶åæŸä½å¤§ä½¬åœ¨æŠ¥è¡¨å·¥å…·é‡Œä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œå†™äº†ä¸ªï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> plan <span class="hljs-operator">=</span> <span class="hljs-string">'Pro'</span>;
</code></pre>
<p>æ³¨æ„å¤§å°å†™ï¼š<code>Pro</code> â‰  <code>pro</code>ã€‚ç»“æœå½“ç„¶æ˜¯ 0 è¡Œã€‚é—®é¢˜æ˜¯â€”â€”å®ƒä¸ºäº†å¾—åˆ°â€œ0 è¡Œâ€ï¼Œå±…ç„¶å¯èƒ½ <strong>æŠŠå…¨è¡¨æ‰«äº†ä¸€é</strong>ï¼Œè¿™å°±å¾ˆç¦»è°±ï¼šæ˜æ˜çº¦æŸå‘Šè¯‰ä½ â€œæ ¹æœ¬ä¸å¯èƒ½æœ‰ Proâ€ï¼Œä½ è¿˜æ‰«ä»€ä¹ˆæ‰«ï¼Ÿæ‰«å¾—æˆ‘ CPU é£æ‰‡éƒ½å¿«èµ·é£äº†ã€‚</p>
<p>è¿™æ—¶å¯ä»¥æ‰“å¼€ä¸€ä¸ªâ€œçœ‹èµ·æ¥å†·é—¨ä½†å¯¹æŠ¥è¡¨åœºæ™¯å¾ˆé¦™â€çš„å¼€å…³ï¼š<code>constraint_exclusion</code>ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SET</span> constraint_exclusion <span class="hljs-keyword">to</span> <span class="hljs-string">'on'</span>;
</code></pre>
<p>å¼€å¯åï¼ŒPostgreSQL ä¼šåœ¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ—¶å‚è€ƒçº¦æŸä¿¡æ¯ï¼Œå‘ç°æ¡ä»¶æ°¸è¿œä¸ºå‡ï¼Œå°±ç›´æ¥å˜æˆâ€œç§’å› 0 è¡Œâ€ï¼Œå½»åº•é¿å…æ— æ„ä¹‰çš„ Seq Scanã€‚</p>
<p>ä¸ºä»€ä¹ˆå®ƒé»˜è®¤ä¸æ˜¯ <code>on</code>ï¼Ÿå› ä¸ºå®ƒä¼šå¢åŠ è§„åˆ’é˜¶æ®µå¼€é”€ï¼šå¯¹â€œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„ç®€å•æŸ¥è¯¢â€ï¼Œå¤§æ¦‚ç‡ç”¨ä¸ä¸Šï¼›ä½†å¯¹ BI/æŠ¥è¡¨è¿™ç§<strong>äººè‚‰æ‰‹å†™ SQL</strong>çš„åœºæ™¯ï¼Œå†™é”™å€¼ã€å†™é”™æ¡ä»¶å¤ªå¸¸è§äº†ã€‚
ç»“è®ºå¾ˆç›´ç™½ï¼š<strong>å¦‚æœä½ çš„æ•°æ®åº“ç»å¸¸è¢«æŠ¥è¡¨å·¥å…·/åˆ†æå¸ˆ/ä¸´æ—¶æŸ¥è¯¢æŠ˜è…¾ï¼Œè€ƒè™‘åœ¨æŠ¥è¡¨ç¯å¢ƒæŠŠå®ƒæ‰“å¼€ï¼Œèƒ½çœä¸å°‘å†¤æ‰èµ„æºã€‚</strong></p>
<hr/>
<h2 data-id="heading-1">2ï¼‰åªè¦â€œæŒ‰å¤©ç»Ÿè®¡â€ï¼Œå°±åˆ«ç”¨â€œç²¾ç¡®åˆ°ç§’â€çš„ç´¢å¼•</h2>
<p>å‡½æ•°ç´¢å¼•çœ 3 å€ç©ºé—´è¿˜æ›´å¿«</p>
<p>ç¬¬äºŒä¸ªåœºæ™¯æ›´åƒæ—¥å¸¸ä¼˜åŒ–ç°åœºï¼š10M çš„é”€å”®è¡¨ <code>sale</code>ï¼Œåˆ†æå¸ˆè¦åšæŒ‰å¤©æ±‡æ€»ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>), <span class="hljs-built_in">SUM</span>(charged)
<span class="hljs-keyword">FROM</span> sale
<span class="hljs-keyword">WHERE</span> <span class="hljs-string">'2025-01-01 UTC'</span> <span class="hljs-operator">&lt;=</span> sold_at <span class="hljs-keyword">AND</span> sold_at <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2025-02-01 UTC'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</code></pre>
<p>å¤§å®¶çš„ç¬¬ä¸€ååº”ï¼šç»™ <code>sold_at</code> ä¸Š B-Tree ç´¢å¼•ï¼</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX sale_sold_at_ix <span class="hljs-keyword">ON</span> sale(sold_at);
</code></pre>
<p>æŸ¥è¯¢ç¡®å®å¿«äº†ï¼Œä½†ä½ ä¸€çœ‹ç´¢å¼•ä½“ç§¯â€”â€”214MBï¼Œå¿ƒé‡Œä¹Ÿè·Ÿç€â€œå’¯å™”â€ä¸€ä¸‹ï¼šä¸ºäº†æŒ‰å¤©ç»Ÿè®¡ï¼Œå»ºäº†ä¸ªç²¾ç¡®åˆ°æ¯«ç§’çº§çš„ç´¢å¼•ï¼Œè¿™å±äº<strong>ç”¨å¤§ç‚®æ‰“èšŠå­</strong>ã€‚</p>
<p>æ›´èªæ˜çš„åšæ³•æ˜¯ï¼šåªç´¢å¼•â€œå¤©â€ï¼Œåˆ«ç´¢å¼•â€œç§’â€ã€‚ç›´æ¥ä¸Šè¡¨è¾¾å¼ç´¢å¼•ï¼ˆå‡½æ•°ç´¢å¼•ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX sale_sold_at_date_ix <span class="hljs-keyword">ON</span> sale((date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>))::<span class="hljs-type">date</span>);
</code></pre>
<p>ç„¶åæŠŠæŸ¥è¯¢å†™æˆåŒæ ·è¡¨è¾¾å¼ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>), <span class="hljs-built_in">SUM</span>(charged)
<span class="hljs-keyword">FROM</span> sale
<span class="hljs-keyword">WHERE</span> date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>)::<span class="hljs-type">date</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-31'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</code></pre>
<p>ç»“æœï¼šç´¢å¼•ä½“ç§¯ä» 214MB å˜æˆ 66MBï¼Œç›´æ¥å°äº† 3 å€å¤šï¼Œè¿˜æ›´å¿«ã€‚åŸå› ä¸åªæ˜¯ <code>date</code> æ¯” <code>timestamptz</code> å°ï¼Œè€Œæ˜¯<strong>ç¦»æ•£å€¼æ›´å°‘</strong>ï¼ŒB-Tree å¯ä»¥åšå»é‡ä¼˜åŒ–ï¼ˆdeduplicationï¼‰ï¼Œç´¢å¼•å˜å¾—æ›´ç´§å‡‘ã€‚</p>
<p>ä½†å‡½æ•°ç´¢å¼•æœ‰ä¸ªâ€œè„¾æ°”â€ï¼šè¡¨è¾¾å¼å¾—ä¸€æ¨¡ä¸€æ ·ï¼Œç¨å¾®æ¢ä¸ªå†™æ³•å°±å¯èƒ½ç”¨ä¸ä¸Šç´¢å¼•ï¼Œæ¯”å¦‚æŠŠ <code>date_trunc</code> æ¢æˆ <code>::date</code>ï¼Œå°±ç›´æ¥é€€åŒ–å› Seq Scanã€‚ç°å®é‡Œè®©å…¨å›¢é˜Ÿâ€œä¸¥æ ¼å†™åŒä¸€è¡¨è¾¾å¼â€ï¼ŒåŸºæœ¬ç­‰åŒäºè¦æ±‚å¤§å®¶æ¯å¤©ä¸çŠ¯é”™ï¼ˆè¿™äº‹æ¯”ä¸Šç­å‡†ç‚¹è¿˜éš¾ğŸ™‚ï¼‰ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p>
<h3 data-id="heading-2">æ–¹æ¡ˆ Aï¼šViewï¼ŒæŠŠè¡¨è¾¾å¼å›ºåŒ–æˆåˆ—</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_sale <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>, date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>)::<span class="hljs-type">date</span> <span class="hljs-keyword">AS</span> sold_at_date
<span class="hljs-keyword">FROM</span> sale;
</code></pre>
<h3 data-id="heading-3">æ–¹æ¡ˆ Bï¼šGenerated Columnï¼ˆæ›´åƒâ€œå®˜æ–¹è‡ªå¸¦çš„ view åˆ—â€ï¼‰</h3>
<p>ä» PostgreSQL 14 èµ·æ”¯æŒç”Ÿæˆåˆ—ï¼›æ–‡ç« é‡Œæåˆ° PostgreSQL 18 è¿˜æ”¯æŒ<strong>è™šæ‹Ÿç”Ÿæˆåˆ—</strong>ï¼šçœ‹èµ·æ¥æ˜¯åˆ—ï¼Œå®é™…ä¸Šæ˜¯æ¯æ¬¡è®¿é—®æ—¶è®¡ç®—çš„è¡¨è¾¾å¼ï¼Œæ—¢ä¿è¯è¡¨è¾¾å¼ä¸€è‡´ï¼Œåˆä¸é¢å¤–å­˜å‚¨ï¼ˆä¸»æ‰“ä¸€ä¸ªâ€œæ—¢è¦åˆè¦â€ï¼‰ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> sale <span class="hljs-keyword">ADD</span> sold_at_date <span class="hljs-type">DATE</span>
GENERATED ALWAYS <span class="hljs-keyword">AS</span> (date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>));
</code></pre>
<p>ç„¶åæŸ¥è¯¢å°±ç»Ÿä¸€å†™ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> sold_at_date, <span class="hljs-built_in">SUM</span>(charged)
<span class="hljs-keyword">FROM</span> sale
<span class="hljs-keyword">WHERE</span> sold_at_date <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-31'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</code></pre>
<p>è¿™ç±»ä¼˜åŒ–ç‰¹åˆ«é€‚åˆé‚£ç§â€œæŒ‡æ ‡æŒ‰å¤©/æŒ‰å‘¨/æŒ‰æœˆç»Ÿè®¡â€çš„ç³»ç»Ÿï¼š<strong>åˆ«è®©ç´¢å¼•ä¸ºä½ ç”¨ä¸åˆ°çš„ç²¾åº¦ä¹°å•</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-4">3ï¼‰é•¿ URL å”¯ä¸€çº¦æŸæŠŠç´¢å¼•æ’‘çˆ†ï¼Ÿ</h2>
<p>ç”¨æ’ä»–çº¦æŸ + Hash ç´¢å¼•ï¼Œ5 å€ç¼©å®¹ï¼ˆä½†æœ‰å‘ï¼‰</p>
<p>å½“ä½ è¦å¯¹ä¸€ä¸ªè¶…é•¿å­—æ®µï¼ˆæ¯”å¦‚ URLï¼‰åšå”¯ä¸€çº¦æŸæ—¶ï¼ŒB-Tree ç´¢å¼•å¯èƒ½æ¥è¿‘è¡¨æœ¬ä½“å¤§å°ï¼Œå› ä¸º B-Tree å¶å­èŠ‚ç‚¹ä¼šå­˜å‚¨è¢«ç´¢å¼•å€¼æœ¬èº«ã€‚URL åˆé•¿åˆå‡ ä¹ä¸é‡å¤ï¼Œç´¢å¼•å¾ˆå®¹æ˜“â€œèƒ–æˆçƒâ€ã€‚</p>
<p>é‚£èƒ½ä¸èƒ½ç”¨ Hash ç´¢å¼•ï¼ŸHash ç´¢å¼•å­˜çš„æ˜¯ hash å€¼ï¼Œé€šå¸¸å°å¾ˆå¤šã€‚é—®é¢˜æ¥äº†ï¼šPostgreSQL çš„ Hash ç´¢å¼• <strong>ä¸æ”¯æŒ unique index</strong>ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX urls_url_unique_hash <span class="hljs-keyword">ON</span> urls <span class="hljs-keyword">USING</span> HASH(url);
<span class="hljs-comment">-- ERROR: access method "hash" does not support unique indexes</span>
</code></pre>
<p>ä½† PostgreSQL è¿˜æœ‰ä¸ªå¾ˆå°‘äººç”¨ã€åå­—å¾ˆéœ¸æ°”çš„çº¦æŸï¼š<strong>Exclusion Constraintï¼ˆæ’ä»–çº¦æŸï¼‰</strong>ã€‚å®ƒèƒ½é…åˆ Hash ç´¢å¼•åšâ€œç­‰å€¼æ’ä»–â€ï¼Œæ•ˆæœç­‰åŒå”¯ä¸€çº¦æŸï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> urls <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> urls_url_unique_hash EXCLUDE <span class="hljs-keyword">USING</span> HASH (url <span class="hljs-keyword">WITH</span> <span class="hljs-operator">=</span>);
</code></pre>
<p>äºæ˜¯ä½ å¾—åˆ°äº†ä¸€ä¸ªâ€œç”¨ Hash ç´¢å¼•å®ç°çš„å”¯ä¸€æ€§â€ã€‚ç´¢å¼•ä½“ç§¯å¯èƒ½ä» 154MB æ‰åˆ° 32MBï¼Œçº¦ 5 å€ç¼©æ°´ï¼Œè€Œä¸”ç­‰å€¼æŸ¥è¯¢åŒæ ·èƒ½ç”¨ç´¢å¼•ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> urls <span class="hljs-keyword">WHERE</span> url <span class="hljs-operator">=</span> <span class="hljs-string">'https://hakibenita.com'</span>;
</code></pre>
<p>ä¸è¿‡å®ƒä¸æ˜¯é“¶å¼¹ï¼Œæœ‰å‡ ä¸ªç¡¬å‘å¿…é¡»çŸ¥é“ï¼š</p>
<ul>
<li><strong>ä¸èƒ½è¢«å¤–é”®å¼•ç”¨</strong>ï¼šå¤–é”®è¦æ±‚å¼•ç”¨â€œå”¯ä¸€çº¦æŸâ€ï¼Œè€Œæ’ä»–çº¦æŸä¸ç®—ä¼ ç»Ÿæ„ä¹‰çš„ unique constraintï¼Œæ‰€ä»¥å¼•ç”¨ä¼šå¤±è´¥ã€‚</li>
<li><strong><code>INSERT ... ON CONFLICT</code> æœ‰é™åˆ¶</strong>ï¼š
<code>ON CONFLICT (url)</code> å¯èƒ½ä¸è®¤ï¼›éœ€è¦å†™ <code>ON CONFLICT ON CONSTRAINT ...</code>ï¼›æ›´ç³Ÿçš„æ˜¯ <code>DO UPDATE</code> ä¸æ”¯æŒæ’ä»–çº¦æŸã€‚</li>
<li>æ›´é€šç”¨çš„æ›¿ä»£å†™æ³•æ˜¯ç”¨ <code>MERGE</code>ï¼ˆå¦‚æœä½ çš„ç‰ˆæœ¬æ”¯æŒï¼‰ï¼š</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">MERGE</span> <span class="hljs-keyword">INTO</span> urls t
<span class="hljs-keyword">USING</span> (<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1000004</span>, <span class="hljs-string">'https://hakibenita.com'</span>)) <span class="hljs-keyword">AS</span> s(id, url)
<span class="hljs-keyword">ON</span> t.url <span class="hljs-operator">=</span> s.url
<span class="hljs-keyword">WHEN</span> MATCHED <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> id <span class="hljs-operator">=</span> s.id
<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">NOT</span> MATCHED <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">INSERT</span> (id, url) <span class="hljs-keyword">VALUES</span> (s.id, s.url);
</code></pre>
<p>é€‚ç”¨åœºæ™¯ä¸€å¥è¯æ€»ç»“ï¼š<strong>è¶…é•¿å­—ç¬¦ä¸²å­—æ®µéœ€è¦å”¯ä¸€æ€§ï¼Œä½†ä¸éœ€è¦è¢«å¤–é”®å¼•ç”¨ï¼Œä¸”å†™å…¥å†²çªå¤„ç†å¯ä»¥æ¥å—ç”¨ MERGE/ä¸šåŠ¡å±‚é€»è¾‘æ›¿ä»£</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-5">ç»“è¯­</h2>
<p>çœŸæ­£çš„ä¼˜åŒ–ï¼Œä¸æ˜¯â€œæ›´å¿«â€ï¼Œè€Œæ˜¯â€œæ›´åˆé€‚â€âœ…</p>
<p>è¿™ 3 ä¸ªæŠ€å·§çš„å…±åŒç‚¹å¾ˆæœ´ç´ ï¼š
ä¸æ˜¯è®©æ•°æ®åº“â€œæ›´åŠªåŠ›â€ï¼Œè€Œæ˜¯è®©æ•°æ®åº“<strong>åˆ«åšæ— æ„ä¹‰çš„äº‹</strong>ã€‚</p>
<ul>
<li>æŠ¥è¡¨æŸ¥é”™å€¼ï¼Ÿè®©çº¦æŸå¸®ä½ ç§’åˆ¤ falseï¼Œåˆ«å…¨è¡¨æ‰«</li>
<li>åªæŒ‰å¤©ç»Ÿè®¡ï¼Ÿç´¢å¼•å°±æŒ‰å¤©å»ºï¼Œåˆ«ä¸ºç§’çº§ç²¾åº¦ä»˜è´¦</li>
<li>é•¿å­—æ®µå”¯ä¸€æ€§æ’‘çˆ†ç´¢å¼•ï¼Ÿæ¢æ€è·¯ï¼Œç”¨æ’ä»–çº¦æŸæŠŠ Hash ç´¢å¼•ç”¨èµ·æ¥</li>
</ul>
<p>ä¸‹æ¬¡ä½ å‡†å¤‡â€œå†åŠ ä¸€ä¸ªç´¢å¼•â€ä¹‹å‰ï¼Œä¸å¦¨å…ˆé—®ä¸€å¥ï¼š
<strong>éœ€æ±‚åˆ°åº•éœ€è¦å¤šç²¾ï¼Ÿè¿™æ¡æŸ¥è¯¢çœŸçš„å€¼å¾—æˆ‘ä¸ºå®ƒå…»ä¸€ä¸ª 200MB çš„ç´¢å¼•å—ï¼Ÿ</strong>
èƒ½æŠŠæ€§èƒ½ã€æˆæœ¬ã€ç»´æŠ¤å¤æ‚åº¦ä¸€èµ·ä¼˜åŒ–çš„ï¼Œæ‰æ˜¯æœ€çˆ½çš„ä¼˜åŒ–ğŸ˜‰</p>
<hr/>
<p><strong>å–œæ¬¢å°±å¥–åŠ±ä¸€ä¸ªâ€œğŸ‘â€å’Œâ€œåœ¨çœ‹â€å‘—~</strong></p>
<p><img src="https://files.mdnice.com/user/44095/f9363b7e-9738-44f3-9ac6-8ee2cddf995d.png" alt="image" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ä¸ªå®ç”¨çš„Android Perfettoåˆ†æå™¨]]></title>    <link>https://juejin.cn/post/7603321550247690290</link>    <guid>https://juejin.cn/post/7603321550247690290</guid>    <pubDate>2026-02-06T13:05:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603321550247690290" data-draft-id="7601843004959195182" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ä¸ªå®ç”¨çš„Android Perfettoåˆ†æå™¨"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2026-02-06T13:05:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨€æœ‰çŒ¿è¯‰"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ä¸ªå®ç”¨çš„Android Perfettoåˆ†æå™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨€æœ‰çŒ¿è¯‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T13:05:37.000Z" title="Fri Feb 06 2026 13:05:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¯‘è‡ªã€ŒBuilding a Deterministic Perfetto Analyzer for Androidã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fproandroiddev.com%2Fbuilding-a-deterministic-perfetto-analyzer-for-android-95877b3e083e" target="_blank" title="https://proandroiddev.com/building-a-deterministic-perfetto-analyzer-for-android-95877b3e083e" ref="nofollow noopener noreferrer">proandroiddev.com/building-a-â€¦</a>ï¼Œç”±Sumeet Singh Aroraå‘å¸ƒäº2026å¹´1æœˆ6æ—¥ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/545e6c1506a5467aa2e109f0a6fa2255~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770987937&amp;x-signature=C5zjzErT1qD49Or6rhcArI8lEUc%3D" alt="æ’å›¾ç”±ä½œè€…ä½¿ç”¨ AI å›¾åƒç”Ÿæˆå·¥å…·ç”Ÿæˆã€‚" loading="lazy"/></p>
<h2 data-id="heading-0">æ¯ä¸ª Android æ€§èƒ½å·¥ç¨‹å¸ˆéƒ½é¢ä¸´çš„é—®é¢˜</h2>
<p>å½“ä½ æ‰“å¼€ä¸€ä¸ª <a href="https://link.juejin.cn?target=https%3A%2F%2Fperfetto.dev%2F" target="_blank" title="https://perfetto.dev/" ref="nofollow noopener noreferrer">Perfetto</a> traceã€‚</p>
<p>ä¼šæœ‰æˆåƒä¸Šä¸‡ä¸ªåˆ‡ç‰‡ã€‚æ•°åä¸ªçº¿ç¨‹ã€‚æ•°ç™¾ä¸‡ä¸ªæ•°æ®ç‚¹ã€‚ä¸€æ¡çœ‹èµ·æ¥åƒæŠ½è±¡è‰ºæœ¯çš„æ—¶é—´çº¿ã€‚</p>
<p>è€Œåœ¨è¿™å…¶ä¸­çš„æŸä¸ªåœ°æ–¹â€”â€”è¢«å±‚å±‚ç³»ç»Ÿå™ªå£°ã€æ¡†æ¶å›è°ƒå’Œçº¿ç¨‹äº¤é”™æ‰€æ©ç›–â€”â€”éšè—ç€ä¸€ä¸ªç®€å•é—®é¢˜çš„ç­”æ¡ˆï¼š<em>ä¸ºä»€ä¹ˆæˆ‘çš„åº”ç”¨è¿è¡Œç¼“æ…¢ï¼Ÿ</em></p>
<p>æˆ‘èŠ±äº†æ•°å¹´æ—¶é—´å¤§è§„æ¨¡è°ƒè¯• Android æ€§èƒ½ã€‚æ¨¡å¼æ€»æ˜¯åƒç¯‡ä¸€å¾‹ï¼š</p>
<ol>
<li>
<p>ç”¨æˆ·æŠ±æ€¨å¯åŠ¨å¡é¡¿/ç¼“æ…¢</p>
</li>
<li>
<p>å·¥ç¨‹å¸ˆæ•è·è·Ÿè¸ªä¿¡æ¯</p>
</li>
<li>
<p>å·¥ç¨‹å¸ˆæ‰“å¼€ Perfetto ç”¨æˆ·ç•Œé¢</p>
</li>
<li>
<p>å·¥ç¨‹å¸ˆèŠ±è´¹ 2 å°æ—¶æ»šåŠ¨ã€ç¼©æ”¾ã€çœ¯çœ¼æŸ¥çœ‹</p>
</li>
<li>
<p>å·¥ç¨‹å¸ˆ_å¯èƒ½_æ‰¾åˆ°äº†æ ¹æœ¬åŸå› </p>
</li>
</ol>
<p>è·Ÿè¸ªä¿¡æ¯æ— æ³•è®²è¿°æ•…äº‹ã€‚å®ƒä»¬åªæ˜¯ç½—åˆ—äº‹å®â€”â€”å¸¦æœ‰æ—¶é—´æˆ³ã€å±‚å±‚åµŒå¥—ã€ä»¤äººçœ¼èŠ±ç¼­ä¹±ã€‚â€œæ‹¥æœ‰è·Ÿè¸ªä¿¡æ¯â€å’Œâ€œç†è§£æ€§èƒ½â€ä¹‹é—´å­˜åœ¨ç€å·¨å¤§çš„é¸¿æ²Ÿã€‚</p>
<p><strong>æœ¬æ–‡æ—¨åœ¨é€šè¿‡ç¼–ç¨‹æ–¹å¼å¼¥åˆè¿™ä¸€é¸¿æ²Ÿã€‚</strong></p>
<p>åœ¨è¿‡å»çš„å‡ å‘¨é‡Œï¼Œæˆ‘ä¸€ç›´åœ¨æ„å»ºä¸€ä¸ª<strong>Perfetto è·Ÿè¸ªåˆ†æå™¨</strong>ï¼Œå®ƒå¯ä»¥å°†åŸå§‹è·Ÿè¸ªä¿¡æ¯è½¬æ¢ä¸ºç»“æ„åŒ–çš„ã€æ˜“äºç†è§£çš„æ´å¯Ÿã€‚æ²¡æœ‰ä»ªè¡¨ç›˜ã€‚åªæœ‰ç¡®å®šæ€§åˆ†æï¼Œå®ƒåæ˜ äº†ç»éªŒä¸°å¯Œçš„å·¥ç¨‹å¸ˆå®é™…æ€è€ƒæ€§èƒ½é—®é¢˜çš„æ–¹å¼ã€‚</p>
<p>è¯»å®Œæœ¬æ–‡ï¼Œä½ å°†äº†è§£å¦‚ä½•ï¼š</p>
<ol>
<li>
<p>ä½¿è·Ÿè¸ªä¿¡æ¯<strong>å¯è¯»</strong>â€”â€”å¯åŠ¨æ—¶é—´ã€é•¿æ—¶é—´ä»»åŠ¡ã€å¸§å¥åº·çŠ¶å†µ</p>
</li>
<li>
<p>ä½¿è·Ÿè¸ªä¿¡æ¯<strong>å¯å½’å±</strong>â€”â€”è¿›ç¨‹ã€çº¿ç¨‹ã€ç»„ä»¶æ‰€æœ‰æƒ</p>
</li>
<li>
<p>åˆ†ç¦»<strong>èŒè´£</strong>â€”â€”åº”ç”¨ç¨‹åºã€æ¡†æ¶å’Œç³»ç»Ÿ</p>
</li>
<li>
<p>ä½¿ç”¨<strong>æ—¶é—´çª—å£</strong>æŸ¥æ‰¾å…³é”®äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ç‚¹</p>
</li>
<li>
<p>ç”Ÿæˆ<strong>ç¡®å®šæ€§å«Œç–‘å¯¹è±¡</strong>â€”â€”ç”¨äºè°ƒæŸ¥çš„ä¼˜å…ˆçº§ä¿¡å·</p>
</li>
</ol>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆ Perfetto è·Ÿè¸ªéš¾ä»¥é˜…è¯»</h2>
<p>Perfetto åŠŸèƒ½æå…¶å¼ºå¤§ã€‚å®ƒå¯ä»¥æ•è·ï¼š</p>
<ul>
<li>
<p>CPU è°ƒåº¦</p>
</li>
<li>
<p>å¸§æ¸²æŸ“</p>
</li>
<li>
<p>Binder äº‹åŠ¡</p>
</li>
<li>
<p>åº”ç”¨è‡ªå®šä¹‰è·Ÿè¸ªéƒ¨åˆ†</p>
</li>
<li>
<p>ç³»ç»ŸæœåŠ¡æ´»åŠ¨</p>
</li>
</ul>
<p>ä½†å¼ºå¤§çš„åŠŸèƒ½ä¹Ÿå¸¦â€‹â€‹æ¥äº†å¤æ‚æ€§ã€‚ä¸€ä¸ªå…¸å‹çš„è·Ÿè¸ªå¯èƒ½åŒ…å«ï¼š</p>
<ul>
<li>
<p>è¶…è¿‡ 50,000 ä¸ªåˆ‡ç‰‡</p>
</li>
<li>
<p>è¶…è¿‡ 100 ä¸ªä¸åŒçš„çº¿ç¨‹åç§°</p>
</li>
<li>
<p>è¶…è¿‡ 10 å±‚çš„åµŒå¥—å±‚çº§ç»“æ„</p>
</li>
</ul>
<p>å½“ä½ è°ƒè¯•å¡é¡¿çš„æ»šåŠ¨æˆ–ç¼“æ…¢çš„å¯åŠ¨é—®é¢˜æ—¶ï¼Œä½ å¹¶ä¸éœ€è¦æ‰€æœ‰è¿™äº›ä¿¡æ¯ã€‚ä½ éœ€è¦çš„æ˜¯ï¼š</p>
<ol>
<li>
<p><strong>å‘ç”Ÿäº†ä»€ä¹ˆ</strong> â€” å¯åŠ¨æ—¶é—´ã€è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ã€å¸§å¥åº·çŠ¶å†µ</p>
</li>
<li>
<p><strong>è°åšçš„</strong> â€” å“ªä¸ªè¿›ç¨‹ã€å“ªä¸ªçº¿ç¨‹</p>
</li>
<li>
<p><strong>ä»€ä¹ˆç±»å‹çš„å·¥ä½œ</strong> â€” åº”ç”¨ä»£ç ã€æ¡†æ¶è¿˜æ˜¯ç³»ç»Ÿä»£ç </p>
</li>
</ol>
<p>è®©æˆ‘ä»¬é€ä¸€è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
<h2 data-id="heading-2">ç¬¬ä¸€æ­¥ï¼šä½¿è·Ÿè¸ªæ›´æ˜“è¯»</h2>
<p>é¦–è¦ç›®æ ‡æ˜¯æå–äººä»¬çœŸæ­£å…³å¿ƒçš„é«˜çº§æŒ‡æ ‡ã€‚</p>
<h3 data-id="heading-3">å¯åŠ¨æ—¶é—´</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsinghsume123%2Fperfetto-agent" target="_blank" title="https://github.com/singhsume123/perfetto-agent" ref="nofollow noopener noreferrer">åˆ†æå™¨</a> ä½¿ç”¨å°½åŠ›è€Œä¸ºçš„å¯å‘å¼æ–¹æ³•æ¥ä¼°ç®—å¯åŠ¨æ—¶é—´ï¼š<strong>ä»æœ€æ—©çš„åˆ‡ç‰‡åˆ°ç¬¬ä¸€ä¸ª <code>Choreographer#doFrame</code></strong> çš„æ—¶é—´ã€‚</p>
<p>è¿™ç§æ–¹æ³•å¹¶ä¸å®Œç¾â€”â€”å®ƒæ— æ³•æ¶µç›–æ‰€æœ‰â€‹â€‹å¯åŠ¨åœºæ™¯â€”â€”ä½†å®ƒæä¾›äº†ä¸€ä¸ªæœ‰ç”¨çš„åŸºå‡†è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>ä»¥ä¸‹æ˜¯ <a href="https://link.juejin.cn?target=http%3A%2F%2Fmedium.com%2Fr%3Furl%3Dhttps%253A%252F%252Fgithub.com%252Fsinghsume123%252FTraceToy" target="_blank" title="http://medium.com/r?url=https%3A%2F%2Fgithub.com%2Fsinghsume123%2FTraceToy" ref="nofollow noopener noreferrer">TraceToy</a> æµ‹è¯•è·Ÿè¸ªçš„ç¤ºä¾‹ï¼ˆTraceToy æ˜¯æˆ‘ä¸“é—¨æ„å»ºçš„ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œç”¨äºç”Ÿæˆæœ‰è¶£çš„æµ‹è¯•è·Ÿè¸ªâ€”â€”ç¨åä¼šè¯¦ç»†ä»‹ç»ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"startup_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2910.15</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯¹äºä¼˜åŒ–è‰¯å¥½çš„å†·å¯åŠ¨ï¼Œä½ é€šå¸¸ä¼šçœ‹åˆ° 500â€“1500 æ¯«ç§’çš„å¯åŠ¨æ—¶é—´ï¼›è€Œå¯¹äºåˆå§‹åŒ–ç¹é‡çš„åº”ç”¨ç¨‹åºï¼Œå¯åŠ¨æ—¶é—´åˆ™å¯èƒ½è¾¾åˆ° 2000â€“5000 æ¯«ç§’ç”šè‡³æ›´é•¿ã€‚å…·ä½“çš„æ•°å€¼å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯è·Ÿè¸ªå…¶éšæ—¶é—´çš„å˜åŒ–â€”â€”æ— è®ºåŸºçº¿æ˜¯ 800 æ¯«ç§’è¿˜æ˜¯ 3000 æ¯«ç§’ï¼Œ20% çš„æ€§èƒ½ä¸‹é™å°±æ˜¯ 20% çš„æ€§èƒ½ä¸‹é™ã€‚</p>
<p>ç”Ÿäº§ç¯å¢ƒçš„åº”ç”¨é€šå¸¸ä¼šæ›´ç²¾ç¡®åœ°æ£€æµ‹å¯åŠ¨è¿‡ç¨‹â€”â€”ä½¿ç”¨ <code>reportFullyDrawn()</code>ã€è‡ªå®šä¹‰è·Ÿè¸ªæ ‡è®°ï¼ˆä¾‹å¦‚ <code>Startup#complete</code>ï¼‰æˆ– Jetpack App Startup ç­‰åº“ã€‚å½“è¿™äº›æ–¹æ³•ä¸å¯ç”¨æ—¶ï¼Œåˆ†æå™¨çš„å¯å‘å¼æ–¹æ³•æ˜¯ä¸€ä¸ªåˆç†çš„å¤‡é€‰æ–¹æ¡ˆï¼Œä½†ä½ å¯ä»¥ï¼ˆä¹Ÿåº”è¯¥ï¼‰å¯¹å…¶è¿›è¡Œè°ƒæ•´ï¼Œä½¿å…¶ä¸åº”ç”¨å¯¹â€œå¯åŠ¨å®Œæˆâ€çš„å®é™…å®šä¹‰ç›¸åŒ¹é…ã€‚</p>
<p>ä¸€ä¸ªæ•°å€¼ã€‚å¯ç«‹å³ç”¨äºæ€§èƒ½ä¸‹é™æ£€æµ‹ã€‚</p>
<h3 data-id="heading-4">UI çº¿ç¨‹ä¸Šçš„é•¿ä»»åŠ¡</h3>
<p>é•¿ä»»åŠ¡æ˜¯æŒ‡è¶…è¿‡é˜ˆå€¼å¹¶é˜»å¡ä¸»çº¿ç¨‹çš„ä»»åŠ¡ç‰‡æ®µã€‚è¿™äº›æ˜¯å¯¼è‡´å¡é¡¿å’Œæ— å“åº”çš„ä¸»è¦åŸå› ã€‚</p>
<p>åˆ†æå™¨é»˜è®¤ä½¿ç”¨ <strong>50 æ¯«ç§’çš„é˜ˆå€¼</strong>ï¼ˆå¯é€šè¿‡ <code>--long-task-ms</code> é…ç½®ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"ui_thread_long_tasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"threshold_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"top"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;internal slice&gt;"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16572.1</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"216"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4103.2</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Handler: android.view.View"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">312.5</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>çœ‹å‡ºé—®é¢˜äº†å—ï¼Ÿæ˜¯æ•°å­— IDã€‚å†…éƒ¨åˆ‡ç‰‡ã€‚æ— ä¸Šä¸‹æ–‡ã€‚æ— å½’å±ä¿¡æ¯ã€‚</p>
<p>æŠ€æœ¯ä¸Šæ­£ç¡®ã€‚å®é™…åº”ç”¨ä»·å€¼æœ‰é™ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“_æŸäº›ä¸œè¥¿_é˜»å¡äº†ä¸»çº¿ç¨‹ 16 ç§’ã€‚ä½†æˆ‘ä»¬ä¸çŸ¥é“_æ˜¯ä»€ä¹ˆ_ï¼Œä¹Ÿä¸çŸ¥é“_æ˜¯è°_é€ æˆçš„ã€‚è¿™å°±æ˜¯åŸå§‹åˆ†æå¤±æ•ˆçš„åœ°æ–¹â€”â€”ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ­¥éª¤ 2ï¼ˆå½’å±ä¿¡æ¯ï¼‰è‡³å…³é‡è¦çš„åŸå› ã€‚</p>
<h3 data-id="heading-5">å¸§å¥åº·çŠ¶å†µ</h3>
<p>ä¸¢å¸§ä¼šå¯¼è‡´æ˜æ˜¾çš„å¡é¡¿ã€‚åˆ†æå™¨ä» <code>Choreographer#doFrame</code> åˆ‡ç‰‡ä¸­æå–å¸§æ—¶é—´ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"frame_features"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total_frames"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">888</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"janky_frames"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"p95_frame_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14.35</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>åœ¨è¿™é‡Œï¼Œç™¾åˆ†ä½æ•°æ¯”å¹³å‡å€¼æ›´é‡è¦â€”â€”å³ä½¿å¤§å¤šæ•°å¸§éƒ½å¾ˆå¿«ï¼Œå°‘æ•°å‡ ä¸ªåå¸§ä¹Ÿä¼šç ´åæµç•…åº¦ã€‚</p>
<h3 data-id="heading-6">å±€é™æ€§</h3>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å›ç­”ï¼š<em>å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</em></p>
<p>ä½†æˆ‘ä»¬æ— æ³•å›ç­”ï¼š<em>è°è¯¥è´Ÿè´£ï¼Ÿ</em></p>
<h2 data-id="heading-7">æ­¥éª¤ 2ï¼šä½¿è·Ÿè¸ªæ•°æ®å¯å½’å› </h2>
<p>å½’å› æ˜¯æŒ‡å°†æ€§èƒ½æ•°æ®ä¸æ‰€æœ‰æƒå…³è”èµ·æ¥ã€‚åœ¨è°ƒè¯•å®é™…é—®é¢˜æ—¶ï¼Œå·¥ç¨‹å¸ˆä¼šé—®ï¼š</p>
<ul>
<li>
<p><em>å“ªä¸ª</em> <em><strong>è¿›ç¨‹</strong></em> <em>æ‰§è¡Œäº†æ­¤æ“ä½œï¼Ÿ</em></p>
</li>
<li>
<p><em>å“ªä¸ª</em> <em><strong>çº¿ç¨‹</strong></em>*ï¼Ÿ*</p>
</li>
<li>
<p><em>æ˜¯æˆ‘çš„</em> <em><strong>åº”ç”¨</strong></em> <em>è¿˜æ˜¯å…¶ä»–ç¨‹åº</em>ï¼Ÿ_</p>
</li>
</ul>
<h3 data-id="heading-8">èšç„¦è¿›ç¨‹è¿‡æ»¤</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è¿‡æ»¤æ‰å™ªå£°ã€‚è·Ÿè¸ªæ•°æ®ä¼šæ•è·è®¾å¤‡ä¸Šçš„_æ‰€æœ‰_æ´»åŠ¨â€”â€”ç³»ç»ŸæœåŠ¡ã€å…¶ä»–åº”ç”¨ã€å†…æ ¸æ´»åŠ¨ã€‚å…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ— å…³ç´§è¦ã€‚</p>
<p>åˆ†æå™¨æ”¯æŒèšç„¦æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python3 -m perfetto_agent.cli analyze \
  --trace tracetoy_trace.perfetto-trace \
  --focus-process com.example.tracetoy \
  --out analysis.json
</code></pre>
<p>è¿™ä¼šå°†è¾“å‡ºä»â€œè®¾å¤‡ä¸Šå‘ç”Ÿçš„ä¸€åˆ‡â€è½¬ç§»åˆ°â€œä¸_æ­¤_åº”ç”¨ç›¸å…³çš„å†…å®¹â€ã€‚è¿™æ˜¯ä¸€ä¸ªå°å°çš„æ ‡å¿—ï¼Œå´èƒ½æå¤§åœ°æé«˜ä¿¡å™ªæ¯”ã€‚</p>
<h3 data-id="heading-9">è¿›ç¨‹å’Œçº¿ç¨‹è¯†åˆ«</h3>
<p>è®¾ç½®èšç„¦è¿›ç¨‹åï¼Œæ¯ä¸ªåˆ‡ç‰‡éƒ½ä¼šåŒ…å«æ‰€æœ‰æƒæ•°æ®ã€‚åˆ†æå™¨ä¼šå°† <code>pid</code> å’Œ <code>tid</code> è¿æ¥åˆ°è¿›ç¨‹åå’Œçº¿ç¨‹åï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"BG#churn"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">267.29</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5664</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5664</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"thread_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xample.tracetoy"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"process_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.tracetoy"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å°†å…¶ä¸æ­¥éª¤ 1 ä¸­æ— ç”¨çš„ <code>"name": "216"</code> è¿›è¡Œæ¯”è¾ƒã€‚ç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼š</p>
<ul>
<li>
<p>âœ… å®ƒæ¥è‡ªæˆ‘çš„åº”ç”¨ç¨‹åº (<code>com.example.tracetoy</code>)</p>
</li>
<li>
<p>âœ… å®ƒè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Š (tid == pid)</p>
</li>
<li>
<p>âœ… è¿™æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºå®šä¹‰çš„æ®µï¼ˆ<code>BG#</code> å‰ç¼€ï¼‰</p>
</li>
</ul>
<h3 data-id="heading-10">ä¸»çº¿ç¨‹æ£€æµ‹</h3>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå¾®å¦™ä½†é‡è¦çš„ç»†èŠ‚ï¼š<strong>ä¸»çº¿ç¨‹åœ¨è·Ÿè¸ªä¿¡æ¯ä¸­å¹¶ä¸æ€»æ˜¯æ ‡è®°ä¸ºâ€œmainâ€</strong>ã€‚</p>
<p>åˆ†æå™¨é‡‡ç”¨å°½åŠ›è€Œä¸ºçš„å¯å‘å¼æ–¹æ³•ï¼š</p>
<ol>
<li>
<p>å¦‚æœåº”ç”¨è¿›ç¨‹å­˜åœ¨åä¸º <code>"main"</code> çš„çº¿ç¨‹ â†’ ä½¿ç”¨è¯¥çº¿ç¨‹</p>
</li>
<li>
<p>å¦åˆ™ï¼Œå›é€€åˆ° <code>tid == pid</code>ï¼ˆåœ¨ Android ä¸­é€šå¸¸é€‚ç”¨äºä¸»çº¿ç¨‹ï¼‰</p>
</li>
</ol>
<p>è¿™æ¨¡æ‹Ÿäº†ç»éªŒä¸°å¯Œçš„å·¥ç¨‹å¸ˆåœ¨å…ƒæ•°æ®ä¸å®Œæ•´æ—¶çš„æ¨ç†æ–¹å¼â€”â€”ä¸ºäº†é€æ˜èµ·è§ï¼Œåˆ†æå™¨ä¼šè®°å½•æ‰€ä½¿ç”¨çš„å¯å‘å¼æ–¹æ³•ã€‚</p>
<h3 data-id="heading-11">åº”ç”¨è‡ªå®šä¹‰èŠ‚æˆä¸ºä¸€ç­‰å…¬æ°‘</h3>
<p>Android çš„ <code>Trace.beginSection()</code> API å…è®¸å¼€å‘è€…æ ‡è®°è‡ªå®šä¹‰ spanï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Trace.beginSection(<span class="hljs-string">"UI#loadUserProfile"</span>)
<span class="hljs-comment">// ... work ...</span>
Trace.endSection()
</code></pre>
<p>åˆ†æå™¨ä¼šæ˜¾å¼åœ°æå–å¹¶èšåˆè¿™äº›ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"app_sections"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"top_by_total_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"BG#churn"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"total_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11811.05</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">194</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"UI#stall_button_click"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"total_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">818.05</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™å›ç­”äº†ä»¥ä¸‹é—®é¢˜ï¼š<em>æˆ‘çš„ä»£ç çš„å“ªäº›éƒ¨åˆ†_ä¸»å¯¼äº†æ‰§è¡Œï¼Ÿ</em></p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²å°†åŒ¿ååˆ‡ç‰‡è½¬æ¢ä¸ºå…·æœ‰å±æ€§çš„ã€å¯æ“ä½œçš„æ•°æ®ã€‚ä½†æˆ‘ä»¬ä»ç„¶æ²¡æœ‰å›ç­”æœ€é‡è¦çš„é—®é¢˜ï¼š<strong>ç©¶ç«Ÿæ˜¯è°çš„é”™â€”â€”æˆ‘çš„åº”ç”¨ã€æ¡†æ¶è¿˜æ˜¯ç³»ç»Ÿï¼Ÿ</strong></p>
<h2 data-id="heading-12">ç¬¬ä¸‰æ­¥ï¼šèŒè´£åˆ†ç¦»</h2>
<p>å…³äºç§»åŠ¨æ€§èƒ½ï¼Œæœ‰ä¸€ä¸ªä»¤äººä¸å®‰çš„çœŸç›¸ï¼š</p>
<p><strong>å½“ä½ çš„åº”ç”¨è¿è¡Œç¼“æ…¢æ—¶ï¼Œå¹¶éæ‰€æœ‰é—®é¢˜éƒ½å‡ºåœ¨ä½ èº«ä¸Šã€‚</strong></p>
<p>å„ç§æ•°æ®æ··æ‚åœ¨ä¸€èµ·ï¼š</p>
<ul>
<li>
<p>ä½ çš„åº”ç”¨ä»£ç </p>
</li>
<li>
<p>Android æ¡†æ¶å†…éƒ¨ä»£ç </p>
</li>
<li>
<p>ç³»ç»Ÿå’Œå†…æ ¸æ´»åŠ¨</p>
</li>
</ul>
<p>å¦‚æœä¸å°†è¿™äº›æ•°æ®åˆ†ç¦»ï¼Œå¾ˆå®¹æ˜“å¾—å‡ºé”™è¯¯çš„ç»“è®ºï¼Œå¹¶ä¼˜åŒ–é”™è¯¯çš„åœ°æ–¹ã€‚</p>
<h3 data-id="heading-13">ç¡®å®šæ€§åˆ†ç±»</h3>
<p>æ¯ä¸ªåˆ‡ç‰‡ç°åœ¨éƒ½è¢«æ ‡è®°ä¸ºä»¥ä¸‹ç±»åˆ«ä¹‹ä¸€ï¼š</p>
<ul>
<li>
<p>ğŸŸ¢ <strong>app</strong> â€” ç„¦ç‚¹è¿›ç¨‹ä¸Šçš„åº”ç”¨ç¨‹åºæ ‡è®°ï¼ˆä¾‹å¦‚ï¼Œ<code>UI#stall_button_click</code>ï¼‰</p>
</li>
<li>
<p>ğŸ”µ <strong>framework</strong> â€” ç„¦ç‚¹è¿›ç¨‹ä¸Šçš„æ¡†æ¶æ ‡è®°ï¼ˆä¾‹å¦‚ï¼Œ<code>Choreographer#doFrame</code>ï¼‰</p>
</li>
<li>
<p>ğŸ”´ <strong>system</strong> â€” éç„¦ç‚¹è¿›ç¨‹ ID æˆ–ç³»ç»Ÿæ ‡è®°ï¼ˆä¾‹å¦‚ï¼Œ<code>binder transaction</code>ï¼‰</p>
</li>
<li>
<p>âšª <strong>unknown</strong> â€” æ— æ³•ç¡®å®šåˆ†ç±»ï¼ˆä¾‹å¦‚ï¼Œæ•°å­— IDï¼‰</p>
</li>
</ul>
<p>åˆ†ç±»å™¨æœ‰æ„é‡‡ç”¨<strong>ä¿å®ˆ</strong>çš„åˆ†ç±»æ–¹å¼ï¼š</p>
<ul>
<li>
<p>åŸºäºè¿›ç¨‹ ID çš„æ‰€æœ‰æƒ</p>
</li>
<li>
<p>åŸºäºçº¿ç¨‹çš„æ‰€æœ‰æƒ</p>
</li>
<li>
<p>åŸºäºæ˜ç¡®çš„åç§°æ ‡è®°è§„åˆ™</p>
</li>
</ul>
<p>å¦‚æœä¸€ä¸ªåˆ‡ç‰‡æ— æ³•æ˜ç¡®å½’ç±»ï¼Œåˆ™ä¼šè¢«æ ‡è®°ä¸ºâ€œunknownâ€ã€‚è¿™å¹¶éé”™è¯¯ï¼Œè€Œæ˜¯è¯šå®ã€‚</p>
<h3 data-id="heading-14">å¸¦æœ‰è´£ä»»æ ‡ç­¾çš„é•¿ä»»åŠ¡</h3>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå·²åˆ†ç±»çš„é•¿ä»»åŠ¡åˆ‡ç‰‡ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"BG#churn"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">267.29</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5664</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5664</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"thread_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xample.tracetoy"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"process_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.tracetoy"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä»¥åŠä¸€ä¸ªæ¡†æ¶å¯†é›†å‹ä»»åŠ¡åˆ‡ç‰‡ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dequeueBuffer - VRI[MainActivity]#0(BLAST Consumer)0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">180.4</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5664</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5688</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"thread_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"RenderThread"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"framework"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç›¸åŒçš„è·Ÿè¸ªè®°å½•ï¼Œä½†å¯¹ä¼˜åŒ–æ–¹å‘çš„å½±å“å´æˆªç„¶ä¸åŒã€‚</p>
<h3 data-id="heading-15">èšåˆåˆ†è§£</h3>
<p>åˆ†æå™¨æ— éœ€æ‰‹åŠ¨æŸ¥çœ‹æ•°ç™¾ä¸ªåˆ‡ç‰‡ï¼Œè€Œæ˜¯è®¡ç®—ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"work_breakdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"by_category_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"app"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12603.72</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">305.77</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"system"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"unknown"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5167.50</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™ä¸€ä¸ªä»£ç å—å›ç­”äº†ä¸€ä¸ªé‡è¦çš„é—®é¢˜ï¼š</p>
<blockquote>
<p>æ­¤æ€§èƒ½é—®é¢˜ä¸»è¦æ˜¯åº”ç”¨ç¨‹åºæœ¬èº«çš„é—®é¢˜å—ï¼Ÿ</p>
</blockquote>
<p>æœ‰æ—¶ç­”æ¡ˆä»¤äººä¸å®‰ï¼Œæœ‰æ—¶å´ä»¤äººæ¬£æ…°ã€‚æ— è®ºå¦‚ä½•ï¼Œå®ƒéƒ½åŸºäºæ•°æ®ã€‚</p>
<h3 data-id="heading-16">ä¸»çº¿ç¨‹é˜»å¡ï¼šç©¶ç«Ÿæ˜¯è°çš„è´£ä»»ï¼Ÿ</h3>
<p>åˆ†æå™¨æŒ‰ç±»åˆ«åˆ†è§£ä¸»çº¿ç¨‹é˜»å¡æ—¶é—´ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"main_thread_blocking"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"app_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12603.72</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"framework_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">305.77</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"system_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unknown_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2840.88</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è´£ä»»å½’å±åœ¨æ­¤å˜å¾—ä¸å¯å›é¿ã€‚</p>
<p>å¦‚æœä¸»çº¿ç¨‹ä¸»è¦è¢«åº”ç”¨ç¨‹åºå·¥ä½œé˜»å¡ï¼ˆå°±åƒè¿™ä¸ªè·Ÿè¸ªè®°å½•ä¸­æ˜¾ç¤ºçš„é‚£æ ·ï¼‰ï¼Œ<strong>ä½ å°±èƒ½å‡†ç¡®åœ°çŸ¥é“åº”è¯¥æŠŠä¼˜åŒ–å·¥ä½œé›†ä¸­åœ¨å“ªäº›æ–¹é¢</strong>ã€‚</p>
<h3 data-id="heading-17">æ‘˜è¦å—</h3>
<p>æ‰€æœ‰å†…å®¹éƒ½æ±‡æ€»æˆä¸€ä¸ªæœ€ç®€æ´çš„æ‘˜è¦ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"summary"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"main_thread_found"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"top_app_sections"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"BG#churn"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"dequeueBuffer - VRI[MainActivity]#0..."</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"UI#stall_button_click"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"top_long_slice_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"BG#churn"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dominant_work_category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"main_thread_blocked_by"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™ä¸æ˜¯è§£é‡Šï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>ä¿¡å·</strong>â€”â€”å‘Šè¯‰ä½ åº”è¯¥å…³æ³¨å“ªé‡Œï¼Œä»¥åŠå“ªäº›åœ°æ–¹ä¸åº”è¯¥å…³æ³¨ã€‚</p>
<h2 data-id="heading-18">ç¬¬å››æ­¥ï¼šæ—¶é—´çª—å£å’Œå«Œç–‘å¯¹è±¡</h2>
<p>çŸ¥é“æ˜¯è°æ‰§è¡Œäº†æ“ä½œå›ºç„¶é‡è¦ï¼Œä½†æ€§èƒ½ä¸‹é™å¾ˆå°‘æ˜¯å…¨å±€æ€§çš„â€”â€”å®ƒä»¬å¾€å¾€æ˜¯<strong>æš‚æ—¶æ€§çš„</strong>ã€‚</p>
<p>å…¸å‹çš„é—®é¢˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><em>ä¸ºä»€ä¹ˆå¯åŠ¨è¿™ä¹ˆæ…¢ï¼Ÿ</em></p>
</li>
<li>
<p><em>ä¸ºä»€ä¹ˆå¡é¡¿åªåœ¨ç¬¬ä¸€ä¸ªå±å¹•ä¹‹åæ‰å‡ºç°ï¼Ÿ</em></p>
</li>
<li>
<p><em>ä¸ºä»€ä¹ˆ UI çº¿ç¨‹åœ¨äº¤äº’è¿‡ç¨‹ä¸­è¢«é˜»å¡ï¼Œä½†åœ¨å¯åŠ¨æ—¶å´æ²¡æœ‰ï¼Ÿ</em></p>
</li>
</ul>
<p>ç¼ºä¹æ—¶é—´ä¸Šä¸‹æ–‡çš„å½’å› åˆ†æä»ç„¶éœ€è¦æ‰‹åŠ¨æ¢³ç†æ—¶é—´çº¿ã€‚ç¬¬å››æ­¥å¯ä»¥å‡è½»è¿™ç§è®¤çŸ¥è´Ÿæ‹…ã€‚</p>
<h3 data-id="heading-19">æ—¶é—´çª—å£ï¼šæ˜ç¡®â€œä½•æ—¶â€â±ï¸</h3>
<p>åˆ†æå™¨ä¸å†å°†è·Ÿè¸ªä¿¡æ¯è§†ä¸ºä¸€æ¡é•¿é•¿çš„æ—¶é—´çº¿ï¼Œè€Œæ˜¯å°†å…¶åˆ’åˆ†ä¸ºç²—ç•¥çš„ã€ç¡®å®šæ€§çš„çª—å£ï¼š</p>
<ul>
<li>
<p><strong>å¯åŠ¨çª—å£</strong> â€” ä»è¿›ç¨‹å¯åŠ¨åˆ°å¯åŠ¨ç»“æŸ</p>
</li>
<li>
<p><strong>ç¨³å®šçŠ¶æ€çª—å£</strong> â€” å¯åŠ¨åçš„æ—¶é—´æ®µï¼ˆé»˜è®¤å€¼ï¼š5 ç§’ï¼‰</p>
</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"time_windows"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"startup"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"start_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"end_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2910.15</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup_ms"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"steady_state"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"start_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2910.15</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"end_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">7910.15</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup_end + 5000ms"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä»…æ­¤ä¸€é¡¹å°±æ”¹å˜äº†ä½ å¯¹è·Ÿè¸ªä¿¡æ¯çš„æ¨ç†æ–¹å¼ã€‚</p>
<h3 data-id="heading-20">çª—å£åˆ†è§£ï¼šä¸Šä¸‹æ–‡ä¸­çš„è´£ä»»å½’å± ğŸ“Š</h3>
<p>å¯¹äºæ¯ä¸ªçª—å£ï¼Œåˆ†æå™¨è®¡ç®—ï¼š</p>
<ul>
<li>
<p>æŒ‰ç±»åˆ«åˆ’åˆ†çš„æ€»å·¥ä½œé‡ï¼ˆ<code>app</code>ã€<code>framework</code>ã€<code>system</code>ã€<code>unknown</code>ï¼‰</p>
</li>
<li>
<p>æŒ‰ç±»åˆ«åˆ’åˆ†çš„ä¸»çº¿ç¨‹é˜»å¡</p>
</li>
</ul>
<p>æ¥è‡ª TraceToy è·Ÿè¸ªï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"window_breakdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"startup"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"by_category_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"app"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">378.43</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"unknown"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101.34</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"main_thread_blocking_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"app_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"framework_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"unknown_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101.34</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"steady_state"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-comment">/* ... */</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™å¯ä»¥ç¡®å®šæ€§åœ°å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š</p>
<blockquote>
<p>å¯åŠ¨é˜¶æ®µä¸»è¦ç”±ç³»ç»Ÿå·¥ä½œä¸»å¯¼ã€‚ç¨³å®šé˜¶æ®µæœ‰å¤§é‡æœªçŸ¥å·¥ä½œé˜»å¡äº†ä¸»çº¿ç¨‹ã€‚</p>
</blockquote>
<p>æ— éœ€çŒœæµ‹ã€‚</p>
<h3 data-id="heading-21">ä»æ•°æ®åˆ°å«Œç–‘äºº ğŸ•µï¸</h3>
<p>ä¸€æ—¦æŒæ¡äº†å½’å› ã€è´£ä»»å’Œæ—¶é—´çª—å£ï¼Œå°±å¯ä»¥æ‰¾å‡º<strong>å«Œç–‘äºº</strong>ã€‚</p>
<p>å«Œç–‘äºº<strong>å¹¶éè§£é‡Š</strong>ï¼Œè€Œæ˜¯ä¸€ä¸ª_ä¼˜å…ˆçº§ä¿¡å·_ã€‚</p>
<p>åˆ†æå™¨ç”Ÿæˆä¸€ä¸ªç¡®å®šæ€§åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"suspects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Startup main thread dominated by unknown work"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"window"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"evidence"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"unknown_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101.34</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Startup dominated by system work"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"window"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"evidence"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"system_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">378.43</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
    <span class="hljs-comment">// ... more suspects for steady_state</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™äº›æ ‡ç­¾æ˜¯æ¨¡æ¿åŒ–çš„ã€å¯å¤ç°çš„ï¼Œå¹¶ä¸”æœ‰è¯æ®æ”¯æŒã€‚</p>
<p>å®ƒä»¬ä¸è§£é‡Šé—®é¢˜ï¼Œè€Œæ˜¯æŒ‡æ˜æ–¹å‘ã€‚</p>
<h3 data-id="heading-22">æ‘˜è¦ç°åœ¨æ›´æœ‰æ„ä¹‰äº†ğŸ§­</h3>
<p>æ‘˜è¦å—å˜å¾—å¯æ“ä½œï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"summary"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"startup_dominant_category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"system"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"steady_state_dominant_category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"unknown"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"top_suspect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Startup main thread dominated by unknown work"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¦‚æœä½ åªé˜…è¯»æ­¤æ‘˜è¦ï¼Œä½ å°±å·²ç»çŸ¥é“ï¼š</p>
<ul>
<li>
<p>ä»å“ªé‡Œå¼€å§‹è°ƒæŸ¥</p>
</li>
<li>
<p>åº”è¯¥æŸ¥çœ‹å“ªç§ç±»å‹çš„å·¥ä½œ</p>
</li>
<li>
<p>å“ªä¸ªé˜¶æ®µæœ€é‡è¦</p>
</li>
</ul>
<p>è¿™ä¸åŸå§‹è·Ÿè¸ªä¿¡æ¯ç›¸æ¯”æ˜¯ä¸€ä¸ªå·¨å¤§çš„è½¬å˜ã€‚</p>
<h2 data-id="heading-23">æ•´åˆæ‰€æœ‰æ­¥éª¤</h2>
<p>ä»¥ä¸‹æ˜¯å®Œæ•´çš„å·¥ä½œæµç¨‹ï¼š</p>
<h3 data-id="heading-24">1. æ•è·è·Ÿè¸ª</h3>
<p>ä½¿ç”¨ Android Studio çš„æ€§èƒ½åˆ†æå™¨æˆ–å‘½ä»¤è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">adb shell perfetto -o /data/misc/perfetto-traces/trace.perfetto-trace -t 10s \
  <span class="hljs-built_in">sched</span> freq idle am wm gfx view binder_driver hal dalvik camera input res memory
</code></pre>
<h3 data-id="heading-25">2. è¿è¡Œåˆ†æå™¨</h3>
<pre><code class="hljs language-bash" lang="bash">python3 -m perfetto_agent.cli analyze \
  --trace trace.perfetto-trace \
  --focus-process com.example.myapp \
  --out analysis.json \
  --long-task-ms 50 \
  --top-n 10
</code></pre>
<h3 data-id="heading-26">3.é˜…è¯»è¾“å‡º</h3>
<p>é¦–å…ˆæŸ¥çœ‹ <code>summary</code> å—ï¼Œäº†è§£ä¸»è¦ç±»åˆ«å’Œä¸»è¦å«Œç–‘äººï¼Œç„¶åæ·±å…¥æŸ¥çœ‹å…·ä½“ä¿¡æ¯ï¼š</p>
<ul>
<li>
<p><code>work_breakdown</code> ç”¨äºæŸ¥çœ‹ç±»åˆ«åˆ†å¸ƒ</p>
</li>
<li>
<p><code>features.long_slices_attributed</code> ç”¨äºæŸ¥çœ‹å•ä¸ªå«Œç–‘äºº</p>
</li>
<li>
<p><code>features.app_sections</code> ç”¨äºæŸ¥çœ‹ä½ çš„æ’æ¡©ä»£ç </p>
</li>
</ul>
<h2 data-id="heading-27">æ­¤åŠŸèƒ½æ— æ³•å®ç°çš„åŠŸèƒ½</h2>
<p>è®©æˆ‘ä»¬æ˜ç¡®ä¸€ä¸‹å®ƒçš„å±€é™æ€§ï¼š</p>
<ul>
<li>
<p>âŒ <strong>ä¸è¿½ç©¶è´£ä»»</strong> â€” ä»…æ˜¾ç¤ºè¯æ®</p>
</li>
<li>
<p>âŒ <strong>ä¸ç”Ÿæˆå»ºè®®</strong> â€” è¿™éœ€è¦ç†è§£æ„å›¾</p>
</li>
<li>
<p>âŒ <strong>ä¸å£°æ˜å› æœå…³ç³»</strong> â€” ç›¸å…³æ€§ä¸ç­‰äºå› æœå…³ç³»</p>
</li>
</ul>
<p>è¯¥ç³»ç»Ÿä½¿è´£ä»»<strong>å¯è§</strong>ã€‚è¿™å°±è¶³å¤Ÿäº†ã€‚</p>
<h2 data-id="heading-28">ä½¿ç”¨ TraceToy è¿›è¡Œæµ‹è¯•</h2>
<p>æˆ‘æ„å»ºäº†ä¸€ä¸ªåä¸º <strong>TraceToy</strong> çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œç”¨äºç”Ÿæˆæœ‰è¶£çš„è·Ÿè¸ªä¿¡æ¯ï¼Œä»¥ä¾¿æµ‹è¯•åˆ†æå™¨ã€‚</p>
<p>å®ƒåŒ…å«ï¼š</p>
<ul>
<li>
<p><strong>å¯åŠ¨åˆå§‹åŒ–</strong>ï¼ˆä½¿ç”¨ <code>StartupInit</code> æ ‡è®°ï¼‰</p>
</li>
<li>
<p><strong>UI é˜»å¡æŒ‰é’®</strong> â€” ä½¿ç”¨ <code>UI#stall_button_click</code> æ•…æ„é˜»å¡ UI çº¿ç¨‹ 200 æ¯«ç§’</p>
</li>
<li>
<p><strong>åå°åŠ è½½åˆ‡æ¢</strong> â€” ç”Ÿæˆ <code>BG#churn</code> æ ‡è®°</p>
</li>
<li>
<p><strong>å¯æ»šåŠ¨åˆ—è¡¨</strong> â€” ç”Ÿæˆå¸§æ¸²æŸ“äº‹ä»¶</p>
</li>
</ul>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4818d302d5584cfc904545a0977c2f32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770987937&amp;x-signature=R9CxaIdfumR0XYki0a16Qi7bX5w%3D" alt="" width="50%" loading="lazy"/></p>
<p>æˆªå›¾ç”±ä½œè€…ä» Android TraceToys ç¤ºä¾‹åº”ç”¨ä¸­æˆªå–ã€‚</p>
<h3 data-id="heading-29">å¿«é€Ÿå…¥é—¨</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Record a 20-second trace</span>
adb shell perfetto -o /data/misc/perfetto-traces/trace -t 20s <span class="hljs-built_in">sched</span> gfx view dalvik
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Interact with the app (tap UI Stall, scroll, toggle background load)# Pull and analyze</span>
adb pull /data/misc/perfetto-traces/trace tracetoy_trace.perfetto-trace
python3 -m perfetto_agent.cli analyze \
  --trace tracetoy_trace.perfetto-trace \
  --focus-process com.example.tracetoy \
  --out analysis.json
</code></pre>
<p>è¾“å‡ºåº”åŒ…å«ï¼š</p>
<ul>
<li>
<p>å·²è¯†åˆ« TraceToy è¿›ç¨‹ï¼ˆ<code>com.example.tracetoy</code>ï¼Œè¿›ç¨‹ ID 5664ï¼‰</p>
</li>
<li>
<p>åº”ç”¨éƒ¨åˆ†ä¸­å‡ºç° <code>BG#churn</code>ï¼ˆ194 æ¬¡ï¼Œæ€»è®¡ 11.8 ç§’ï¼‰å’Œ <code>UI#stall_button_click</code>ï¼ˆ4 æ¬¡ï¼Œæ€»è®¡ 818 æ¯«ç§’ï¼‰</p>
</li>
<li>
<p>199 ä¸ªè€—æ—¶è¶…è¿‡ 50 æ¯«ç§’é˜ˆå€¼çš„é•¿ä»»åŠ¡</p>
</li>
<li>
<p>888 å¸§ï¼Œå…¶ä¸­ 37 å¸§å¡é¡¿ï¼ˆp95ï¼š14.35 æ¯«ç§’ï¼‰</p>
</li>
</ul>
<h2 data-id="heading-30">å®ç°äº®ç‚¹ï¼šåˆ‡ç‰‡åˆ†ç±»</h2>
<p>åˆ†æå™¨ä¸­æœ€æœ‰è¶£çš„éƒ¨åˆ†æ˜¯åˆ†ç±»å™¨ã€‚å®ƒä½¿ç”¨æ˜¾å¼æ ‡è®°åˆ—è¡¨ï¼Œå¹¶ä¸”æœ‰æ„é‡‡ç”¨ä¿å®ˆçš„åˆ†ç±»æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">classify_slice_name</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>, pid: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span>, focus_pid: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""Classify a slice into app/framework/system/unknown using pid + name tokens."""</span>
    <span class="hljs-comment"># If not from focus process, it's system</span>
    <span class="hljs-keyword">if</span> focus_pid <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> pid <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> pid != focus_pid:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"system"</span>    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>    
    
    lower_name = name.lower()        
    app_tokens = [<span class="hljs-string">"ui#"</span>, <span class="hljs-string">"bg#"</span>, <span class="hljs-string">"startupinit"</span>]
    framework_tokens = [
        <span class="hljs-string">"choreographer"</span>, <span class="hljs-string">"doframe"</span>, <span class="hljs-string">"renderthread"</span>, 
        <span class="hljs-string">"viewrootimpl"</span>, <span class="hljs-string">"dequeuebuffer"</span>, <span class="hljs-string">"blast"</span>, <span class="hljs-string">"hwui"</span>
    ]
    system_tokens = [<span class="hljs-string">"binder"</span>, <span class="hljs-string">"surfaceflinger"</span>, <span class="hljs-string">"sched"</span>, <span class="hljs-string">"kworker"</span>, <span class="hljs-string">"irq"</span>, <span class="hljs-string">"futex"</span>]    
    <span class="hljs-comment"># Check app tokens first (highest confidence)</span>
    <span class="hljs-keyword">if</span> focus_pid <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> pid == focus_pid:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(token <span class="hljs-keyword">in</span> lower_name <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> app_tokens):
            <span class="hljs-keyword">return</span> <span class="hljs-string">"app"</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(token <span class="hljs-keyword">in</span> lower_name <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> framework_tokens):
            <span class="hljs-keyword">return</span> <span class="hljs-string">"framework"</span>    
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(token <span class="hljs-keyword">in</span> lower_name <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> system_tokens):
        <span class="hljs-keyword">return</span> <span class="hljs-string">"system"</span>    
    <span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>
</code></pre>
<p>å…³é”®è§è§£ï¼š<strong>ä¿å®ˆçš„åˆ†ç±»æ–¹æ³•ä¼˜äºé”™è¯¯çš„ç½®ä¿¡åº¦</strong>ã€‚å¦‚æœæ— æ³•å‡†ç¡®åˆ†ç±»ï¼Œåˆ™â€œæœªçŸ¥â€æ˜¯ è¯šå®çš„ç­”æ¡ˆã€‚</p>
<p>è¯·å‚é˜…<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsinghsume123%2Fperfetto-agent" target="_blank" title="https://github.com/singhsume123/perfetto-agent" ref="nofollow noopener noreferrer">å®Œæ•´å®ç°</a>ï¼Œäº†è§£å¯åŠ¨æ£€æµ‹ã€ä¸»çº¿ç¨‹è§£æå’Œå¸§å¥åº·è®¡ç®—ã€‚</p>
<h2 data-id="heading-31">ä¸ºä½ çš„åº”ç”¨æ·»åŠ æ’æ¡©</h2>
<p>ä¸ºäº†æœ€å¤§é™åº¦åœ°åˆ©ç”¨æ­¤åˆ†æï¼Œè¯·å¯¹ä½ çš„ä»£ç è¿›è¡Œæ’æ¡©ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> android.os.Trace
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfileLoader</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadProfile</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: UserProfile {
        Trace.beginSection(<span class="hljs-string">"UI#loadUserProfile"</span>)
        <span class="hljs-keyword">try</span> {
            Trace.beginSection(<span class="hljs-string">"UI#fetchFromCache"</span>)
            <span class="hljs-keyword">val</span> cached = cache.<span class="hljs-keyword">get</span>(userId)
            Trace.endSection()                        
            <span class="hljs-keyword">if</span> (cached != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> cached                        
            
            Trace.beginSection(<span class="hljs-string">"IO#fetchFromNetwork"</span>)
            <span class="hljs-keyword">val</span> profile = api.fetchProfile(userId)
            Trace.endSection()                        
            <span class="hljs-keyword">return</span> profile
        } <span class="hljs-keyword">finally</span> {
            Trace.endSection()
        }
    }
}
</code></pre>
<p>ä½¿ç”¨ä¸€è‡´çš„å‘½åçº¦å®šï¼š</p>
<ul>
<li>
<p><code>UI#</code> â€” ä¸»çº¿ç¨‹/UI æ“ä½œ</p>
</li>
<li>
<p><code>BG#</code> â€” åå°çº¿ç¨‹æ“ä½œ</p>
</li>
<li>
<p><code>IO#</code> â€” I/O æ“ä½œ</p>
</li>
<li>
<p><code>DB#</code> â€” æ•°æ®åº“æ“ä½œ</p>
</li>
</ul>
<p>è¿™ä½¿å¾—åˆ†æå™¨çš„è¾“å‡ºèƒ½å¤Ÿç«‹å³è½¬åŒ–ä¸ºå®é™…æ“ä½œã€‚</p>
<h2 data-id="heading-32">äº²è‡ªå°è¯•</h2>
<p>è¯¥åˆ†æå™¨æ˜¯å¼€æºçš„ï¼š</p>
<p>ğŸ”— <strong>Perfetto åˆ†æå™¨</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsinghsume123%2Fperfetto-agent" target="_blank" title="https://github.com/singhsume123/perfetto-agent" ref="nofollow noopener noreferrer">github.com/singhsume12â€¦</a></p>
<p>ğŸ”— <strong>TraceToy æµ‹è¯•åº”ç”¨</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsinghsume123%2FTraceToy" target="_blank" title="https://github.com/singhsume123/TraceToy" ref="nofollow noopener noreferrer">github.com/singhsume12â€¦</a></p>
<p>è¯¥ä»“åº“åŒ…å«ï¼š</p>
<ul>
<li>
<p>Python å‘½ä»¤è¡Œåˆ†æå™¨</p>
</li>
<li>
<p>ç¤ºä¾‹è·Ÿè¸ªå’Œè¾“å‡º (<code>analysis.json</code>)</p>
</li>
<li>
<p>è®¾ç½®è¯´æ˜</p>
</li>
</ul>
<h2 data-id="heading-33">è¦ç‚¹æ€»ç»“</h2>
<ol>
<li>
<p><strong>Perfetto è·Ÿè¸ªåŠŸèƒ½å¼ºå¤§ä½†ä¿¡æ¯é‡åºå¤§</strong> â€” ç¨‹åºåŒ–åˆ†æèƒ½å¤Ÿä»å™ªå£°ä¸­æå–æœ‰æ•ˆä¿¡æ¯</p>
</li>
<li>
<p><strong>å½’å±è‡³å…³é‡è¦</strong> â€” äº†è§£è°æ‰§è¡Œäº†å·¥ä½œï¼ˆè¿›ç¨‹ã€çº¿ç¨‹ã€ç»„ä»¶ï¼‰è‡³å…³é‡è¦</p>
</li>
<li>
<p><strong>æ˜ç¡®èŒè´£åˆ†ç¦»</strong> â€” åº”ç”¨ã€æ¡†æ¶å’Œç³»ç»Ÿä¹‹é—´çš„èŒè´£åˆ’åˆ†æœ€é‡è¦çš„åŒºåˆ«</p>
</li>
<li>
<p><strong>æ—¶é—´çª—å£è‡³å…³é‡è¦</strong> â€” å¯åŠ¨é˜¶æ®µå’Œç¨³å®šé˜¶æ®µé€šå¸¸å…·æœ‰æˆªç„¶ä¸åŒçš„ç‰¹å¾</p>
</li>
<li>
<p><strong>å«Œç–‘äººæŒ‡å‡ºé—®é¢˜æ‰€åœ¨ï¼Œè€Œéè§£é‡Šé—®é¢˜åŸå› </strong> â€” ç¡®å®šæ€§ä¿¡å·å‘Šè¯‰ä½ åº”è¯¥é¦–å…ˆä»å“ªé‡Œå…¥æ‰‹</p>
</li>
<li>
<p><strong>ä¿å®ˆçš„åˆ†ç±»èƒœè¿‡é”™è¯¯çš„è‡ªä¿¡</strong> â€” â€œæœªçŸ¥â€æ€»æ¯”é”™è¯¯å¥½</p>
</li>
<li>
<p><strong>ä¸ºä½ çš„ä»£ç æ·»åŠ æ’æ¡©</strong> â€” <code>Trace.beginSection()</code> æ˜¯ä½ çš„å¥½å¸®æ‰‹</p>
</li>
</ol>
<p>æ€§èƒ½è°ƒè¯•å¹¶éè¦æ‰¾å‡º_æ‰€æœ‰_å‘ç”Ÿçš„äº‹æƒ…ã€‚è€Œæ˜¯è¦æ‰¾å‡ºï¼š</p>
<ul>
<li>
<p><strong>ä»€ä¹ˆæ‰æ˜¯å…³é”®çš„</strong></p>
</li>
<li>
<p><strong>ä½•æ—¶æ‰æ˜¯å…³é”®çš„</strong></p>
</li>
<li>
<p><strong>è°è´Ÿè´£</strong></p>
</li>
</ul>
<p>æ­¤åˆ†æå™¨å°†è¿™ä¸ªæ¨¡å‹æ¸…æ™°åœ°å‘ˆç°å‡ºæ¥ï¼Œå¹¶ä¸”æœºå™¨å¯è¯»ã€‚</p>
<p>_æœ‰ä»»ä½•é—®é¢˜æˆ–åé¦ˆï¼Ÿè¯·åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fsumeet-singh-arora-50605153%2F" target="_blank" title="https://www.linkedin.com/in/sumeet-singh-arora-50605153/" ref="nofollow noopener noreferrer"><em>LinkedIn</em></a> ä¸Šè”ç³»æˆ‘ã€‚</p>
<blockquote>
<p>æ¬¢è¿æœç´¢å¹¶å…³æ³¨ <em>å…¬ä¼—å·<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">ã€Œç¨€æœ‰çŒ¿è¯‰ã€</a></em> è·å–æ›´å¤šçš„ä¼˜è´¨æ–‡ç« ï¼</p>
<p>ä¿æŠ¤åŸåˆ›ï¼Œè¯·å‹¿è½¬è½½ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆç¬¬14ç¯‡ï¼‰ï¼šCC Workflow Studio - å¯è§†åŒ–AIå·¥ä½œæµç¼–è¾‘å™¨ï¼Œè®©AIè‡ªåŠ¨åŒ–æ›´ç®€å•]]></title>    <link>https://juejin.cn/post/7603563360329285674</link>    <guid>https://juejin.cn/post/7603563360329285674</guid>    <pubDate>2026-02-06T13:08:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360329285674" data-draft-id="7603563360329269290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆç¬¬14ç¯‡ï¼‰ï¼šCC Workflow Studio - å¯è§†åŒ–AIå·¥ä½œæµç¼–è¾‘å™¨ï¼Œè®©AIè‡ªåŠ¨åŒ–æ›´ç®€å•"/> <meta itemprop="keywords" content="Claude,å·¥ä½œæµå¼•æ“,AIGC"/> <meta itemprop="datePublished" content="2026-02-06T13:08:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆç¬¬14ç¯‡ï¼‰ï¼šCC Workflow Studio - å¯è§†åŒ–AIå·¥ä½œæµç¼–è¾‘å™¨ï¼Œè®©AIè‡ªåŠ¨åŒ–æ›´ç®€å•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T13:08:24.000Z" title="Fri Feb 06 2026 13:08:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<blockquote>
<p>"å¦‚æœè®¾è®¡AIå·¥ä½œæµå°±åƒç”»æµç¨‹å›¾ä¸€æ ·ç®€å•ï¼Œé‚£è¯¥å¤šå¥½ï¼Ÿ"</p>
</blockquote>
<p>è¿™æ˜¯"ä¸€å¤©ä¸€ä¸ªå¼€æºé¡¹ç›®"ç³»åˆ—çš„ç¬¬14ç¯‡æ–‡ç« ã€‚ä»Šå¤©å¸¦ä½ äº†è§£çš„é¡¹ç›®æ˜¯ <strong>CC Workflow Studio</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbreaking-brake%2Fcc-wf-studio" target="_blank" title="https://github.com/breaking-brake/cc-wf-studio" ref="nofollow noopener noreferrer">GitHub</a>ï¼‰ã€‚</p>
<p>åœ¨AIè¾…åŠ©ç¼–ç¨‹çš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦è®¾è®¡å¤æ‚çš„å·¥ä½œæµï¼šå¤šä¸ªå­Agentåä½œã€æ¡ä»¶åˆ†æ”¯ã€å¾ªç¯å¤„ç†ã€MCPå·¥å…·è°ƒç”¨ç­‰ã€‚ä¼ ç»Ÿçš„æ–‡æœ¬é…ç½®æ–¹å¼è™½ç„¶çµæ´»ï¼Œä½†ä¸å¤Ÿç›´è§‚ï¼Œéš¾ä»¥å¿«é€Ÿç†è§£å’Œä¿®æ”¹ã€‚CC Workflow Studio æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„æ‹–æ‹½å¼ç¼–è¾‘å™¨ï¼Œè®©ä½ åƒç”»æµç¨‹å›¾ä¸€æ ·è®¾è®¡AIå·¥ä½œæµï¼Œè¿˜æ”¯æŒAIè¾…åŠ©ç¼–è¾‘ï¼Œè®©å¤æ‚çš„å·¥ä½œæµè®¾è®¡å˜å¾—ç®€å•ç›´è§‚ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªé¡¹ç›®ï¼Ÿ</strong></p>
<ul>
<li>ğŸ¨ <strong>å¯è§†åŒ–ç¼–è¾‘</strong>ï¼šæ‹–æ‹½å¼ç•Œé¢ï¼Œç›´è§‚è®¾è®¡å¤æ‚å·¥ä½œæµ</li>
<li>âœ¨ <strong>AIè¾…åŠ©ç¼–è¾‘</strong>ï¼šé€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯æ”¹è¿›å’Œä¼˜åŒ–å·¥ä½œæµ</li>
<li>âš¡ <strong>ä¸€é”®å¯¼å‡ºè¿è¡Œ</strong>ï¼šæ”¯æŒå¯¼å‡ºåˆ° Claude Codeã€GitHub Copilotã€OpenAI Codex</li>
<li>ğŸ”€ <strong>å­Agentç¼–æ’</strong>ï¼šæ”¯æŒå¤æ‚çš„å¤šAgentåä½œå’Œæ¡ä»¶åˆ†æ”¯</li>
<li>ğŸŒŸ <strong>ç¤¾åŒºè®¤å¯</strong>ï¼š3.4k+ Starsï¼Œ398+ Forksï¼ŒæŒç»­æ´»è·ƒæ›´æ–°</li>
</ul>
<h3 data-id="heading-1">ä½ å°†å­¦åˆ°ä»€ä¹ˆ</h3>
<ul>
<li>CC Workflow Studio çš„æ ¸å¿ƒæ¶æ„å’Œè®¾è®¡ç†å¿µ</li>
<li>å¦‚ä½•ä½¿ç”¨å¯è§†åŒ–ç¼–è¾‘å™¨è®¾è®¡AIå·¥ä½œæµ</li>
<li>AIè¾…åŠ©ç¼–è¾‘åŠŸèƒ½çš„ä½¿ç”¨æ–¹æ³•</li>
<li>å¦‚ä½•å¯¼å‡ºå·¥ä½œæµåˆ°ä¸åŒçš„AIç¼–ç¨‹å¹³å°</li>
<li>å­Agentç¼–æ’å’Œæ¡ä»¶åˆ†æ”¯çš„å®ç°</li>
<li>ä¸å…¶ä»–å·¥ä½œæµå·¥å…·çš„å¯¹æ¯”åˆ†æ</li>
<li>å®é™…å¼€å‘åœºæ™¯ä¸­çš„åº”ç”¨æ¡ˆä¾‹</li>
</ul>
<h3 data-id="heading-2">å‰ç½®çŸ¥è¯†</h3>
<ul>
<li>å¯¹AIè¾…åŠ©ç¼–ç¨‹æœ‰åŸºæœ¬äº†è§£ï¼ˆClaude Codeã€GitHub Copilotç­‰ï¼‰</li>
<li>äº†è§£å·¥ä½œæµå’Œè‡ªåŠ¨åŒ–æ¦‚å¿µ</li>
<li>ç†Ÿæ‚‰JSONé…ç½®æ–‡ä»¶æ ¼å¼</li>
<li>å¯¹Reactå’ŒTypeScriptæœ‰åŸºæœ¬è®¤è¯†ï¼ˆå¯é€‰ï¼Œæœ‰åŠ©äºç†è§£å®ç°åŸç†ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-3">é¡¹ç›®èƒŒæ™¯</h2>
<h3 data-id="heading-4">é¡¹ç›®ç®€ä»‹</h3>
<p><strong>CC Workflow Studio</strong> æ˜¯ä¸€ä¸ª<strong>å¯è§†åŒ–AIå·¥ä½œæµç¼–è¾‘å™¨</strong>ï¼Œä¸“ä¸ºè®¾è®¡å¤æ‚çš„AI Agentå·¥ä½œæµè€Œæ‰“é€ ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç›´è§‚çš„æ‹–æ‹½å¼ç•Œé¢ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿé€šè¿‡å›¾å½¢åŒ–æ–¹å¼è®¾è®¡ã€ç¼–è¾‘å’Œä¼˜åŒ–AIè‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œç„¶åä¸€é”®å¯¼å‡ºåˆ° Claude Codeã€GitHub Copilot æˆ– OpenAI Codex ç­‰å¹³å°ä½¿ç”¨ã€‚</p>
<p><strong>é¡¹ç›®è§£å†³çš„æ ¸å¿ƒé—®é¢˜</strong>ï¼š</p>
<ul>
<li>AIå·¥ä½œæµé…ç½®å¤æ‚ï¼Œæ–‡æœ¬æ–¹å¼ä¸å¤Ÿç›´è§‚</li>
<li>éš¾ä»¥å¿«é€Ÿç†è§£å’Œä¿®æ”¹ç°æœ‰çš„å·¥ä½œæµé…ç½®</li>
<li>ç¼ºä¹å¯è§†åŒ–å·¥å…·æ¥è®¾è®¡å¤æ‚çš„å¤šAgentåä½œæµç¨‹</li>
<li>ä¸åŒAIå¹³å°çš„å·¥ä½œæµæ ¼å¼ä¸ç»Ÿä¸€ï¼Œéš¾ä»¥è¿ç§»</li>
<li>å·¥ä½œæµè®¾è®¡éœ€è¦åå¤è°ƒè¯•ï¼Œç¼ºä¹äº¤äº’å¼ç¼–è¾‘ä½“éªŒ</li>
</ul>
<p><strong>é¢å‘çš„ç”¨æˆ·ç¾¤ä½“</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ Claude Codeã€GitHub Copilot ç­‰AIç¼–ç¨‹å·¥å…·çš„å¼€å‘è€…</li>
<li>éœ€è¦è®¾è®¡å¤æ‚AIè‡ªåŠ¨åŒ–å·¥ä½œæµçš„å›¢é˜Ÿ</li>
<li>å¸Œæœ›å¯è§†åŒ–ç®¡ç†AI Agentåä½œçš„å¼€å‘è€…</li>
<li>éœ€è¦å°†å·¥ä½œæµåœ¨ä¸åŒAIå¹³å°é—´è¿ç§»çš„å¼€å‘è€…</li>
</ul>
<h3 data-id="heading-5">ä½œè€…/å›¢é˜Ÿä»‹ç»</h3>
<p><strong>ä½œè€…ï¼šbreaking-brake</strong></p>
<ul>
<li><strong>èƒŒæ™¯</strong>ï¼šä¸“æ³¨äºAIå·¥å…·å’Œå¼€å‘è€…ä½“éªŒçš„å¼€æºè´¡çŒ®è€…</li>
<li><strong>é¡¹ç›®åˆ›å»ºæ—¶é—´</strong>ï¼š2025å¹´ï¼ˆå…·ä½“æœˆä»½æœªæ˜ç¡®ï¼‰</li>
<li><strong>ç†å¿µ</strong>ï¼šè®©AIå·¥ä½œæµè®¾è®¡å˜å¾—ç®€å•ã€ç›´è§‚ã€é«˜æ•ˆ</li>
<li><strong>æŠ€æœ¯æ ˆ</strong>ï¼šTypeScriptã€React Flowã€VS Code Extension API</li>
</ul>
<h3 data-id="heading-6">é¡¹ç›®æ•°æ®</h3>
<ul>
<li>â­ <strong>GitHub Stars</strong>: 3.4k+ï¼ˆæŒç»­å¢é•¿ä¸­ï¼‰</li>
<li>ğŸ´ <strong>Forks</strong>: 398+</li>
<li>ğŸ“¦ <strong>ç‰ˆæœ¬</strong>: v3.19.2ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼Œ2026å¹´2æœˆ6æ—¥å‘å¸ƒï¼‰</li>
<li>ğŸ“„ <strong>License</strong>: AGPL-3.0-or-laterï¼ˆå¼€æºï¼Œä½†ä¿®æ”¹åéœ€å¼€æºï¼‰</li>
<li>ğŸŒ <strong>å®˜ç½‘</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-vsx.org%2Fextension%2Fbreaking-brake%2Fcc-wf-studio" target="_blank" title="https://open-vsx.org/extension/breaking-brake/cc-wf-studio" ref="nofollow noopener noreferrer">OpenVSX</a></li>
<li>ğŸ’¬ <strong>ç¤¾åŒº</strong>: GitHub Issues æ´»è·ƒï¼Œ22ä¸ªå¼€æ”¾Issuesï¼Œ8ä¸ªPull Requests</li>
</ul>
<p><strong>é¡¹ç›®å‘å±•å†ç¨‹</strong>ï¼š</p>
<ul>
<li>2025å¹´ï¼šé¡¹ç›®åˆ›å»ºï¼Œå‘å¸ƒåˆå§‹ç‰ˆæœ¬</li>
<li>2025-2026å¹´ï¼šæŒç»­è¿­ä»£ï¼Œæ·»åŠ æ–°åŠŸèƒ½</li>
<li>2026å¹´2æœˆï¼šå‘å¸ƒ v3.19.2ï¼ŒåŠŸèƒ½ç¨³å®š</li>
<li>æŒç»­ç»´æŠ¤ï¼šé¡¹ç›®æŒç»­æ´»è·ƒï¼Œç¤¾åŒºè´¡çŒ®ä¸æ–­</li>
</ul>
<hr/>
<h2 data-id="heading-7">ä¸»è¦åŠŸèƒ½</h2>
<h3 data-id="heading-8">æ ¸å¿ƒä½œç”¨</h3>
<p>CC Workflow Studio çš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>é€šè¿‡å¯è§†åŒ–ç¼–è¾‘å™¨è®¾è®¡å’Œç®¡ç†AIå·¥ä½œæµ</strong>ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>å¯è§†åŒ–å·¥ä½œæµç¼–è¾‘</strong>ï¼šæ‹–æ‹½å¼ç•Œé¢ï¼Œç›´è§‚è®¾è®¡å¤æ‚å·¥ä½œæµ</li>
<li><strong>AIè¾…åŠ©ç¼–è¾‘</strong>ï¼šé€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯æ”¹è¿›å’Œä¼˜åŒ–å·¥ä½œæµ</li>
<li><strong>å¤šå¹³å°å¯¼å‡º</strong>ï¼šæ”¯æŒå¯¼å‡ºåˆ° Claude Codeã€GitHub Copilotã€OpenAI Codex</li>
<li><strong>å­Agentç¼–æ’</strong>ï¼šæ”¯æŒå¤æ‚çš„å¤šAgentåä½œå’Œæ¡ä»¶åˆ†æ”¯</li>
<li><strong>ä¸€é”®è¿è¡Œ</strong>ï¼šç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­è¿è¡Œå·¥ä½œæµï¼Œå³æ—¶éªŒè¯æ•ˆæœ</li>
<li><strong>å·¥ä½œæµä¿å­˜åŠ è½½</strong>ï¼šä¿å­˜ä¸ºJSONæ ¼å¼ï¼Œæ–¹ä¾¿ç‰ˆæœ¬ç®¡ç†å’Œåˆ†äº«</li>
</ol>
<h3 data-id="heading-9">ä½¿ç”¨åœºæ™¯</h3>
<ol>
<li>
<p><strong>è®¾è®¡PRä»£ç å®¡æŸ¥å·¥ä½œæµ</strong></p>
<ul>
<li>éœ€è¦å¤šä¸ªæ­¥éª¤ï¼šä»£ç åˆ†æã€å®‰å…¨æ£€æŸ¥ã€æ€§èƒ½è¯„ä¼°ã€ç”ŸæˆæŠ¥å‘Š</li>
<li>ä½¿ç”¨å¯è§†åŒ–ç¼–è¾‘å™¨è®¾è®¡æµç¨‹ï¼Œæ·»åŠ æ¡ä»¶åˆ†æ”¯</li>
<li>å¯¼å‡ºåˆ° Claude Codeï¼Œä½¿ç”¨ <code>/pr-review</code> å‘½ä»¤è§¦å‘</li>
</ul>
</li>
<li>
<p><strong>åˆ›å»ºå¤šAgentåä½œæµç¨‹</strong></p>
<ul>
<li>è®¾è®¡è€…Agentè´Ÿè´£æ¶æ„è®¾è®¡</li>
<li>å¼€å‘è€…Agentè´Ÿè´£ä»£ç å®ç°</li>
<li>æµ‹è¯•è€…Agentè´Ÿè´£æµ‹è¯•ç”¨ä¾‹</li>
<li>ä½¿ç”¨å¯è§†åŒ–ç•Œé¢ç¼–æ’Agentä¹‹é—´çš„åä½œå…³ç³»</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–ç°æœ‰å·¥ä½œæµ</strong></p>
<ul>
<li>å¯¼å…¥ç°æœ‰çš„ <code>.claude</code> é…ç½®æ–‡ä»¶</li>
<li>ä½¿ç”¨AIè¾…åŠ©ç¼–è¾‘åŠŸèƒ½ï¼Œé€šè¿‡å¯¹è¯ä¼˜åŒ–å·¥ä½œæµ</li>
<li>æ·»åŠ æ–°çš„æ­¥éª¤æˆ–ä¿®æ”¹é€»è¾‘åˆ†æ”¯</li>
</ul>
</li>
<li>
<p><strong>è·¨å¹³å°å·¥ä½œæµè¿ç§»</strong></p>
<ul>
<li>åœ¨ Claude Code ä¸­è®¾è®¡çš„å·¥ä½œæµ</li>
<li>å¯¼å‡ºä¸º GitHub Copilot æ ¼å¼</li>
<li>åœ¨ä¸åŒå¹³å°é—´å¤ç”¨ç›¸åŒçš„å·¥ä½œæµé€»è¾‘</li>
</ul>
</li>
<li>
<p><strong>å­¦ä¹ å’Œç†è§£å·¥ä½œæµ</strong></p>
<ul>
<li>å¯¼å…¥å¤æ‚çš„å·¥ä½œæµé…ç½®</li>
<li>é€šè¿‡å¯è§†åŒ–ç•Œé¢ç†è§£å·¥ä½œæµçš„æ‰§è¡Œé€»è¾‘</li>
<li>å­¦ä¹ æœ€ä½³å®è·µå’Œè®¾è®¡æ¨¡å¼</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">å¿«é€Ÿå¼€å§‹</h3>
<h4 data-id="heading-11">å®‰è£…æ‰©å±•</h4>
<ol>
<li>
<p><strong>VS Code æ‰©å±•å¸‚åœº</strong></p>
<ul>
<li>æ‰“å¼€ VS Code</li>
<li>æœç´¢ "CC Workflow Studio"</li>
<li>ç‚¹å‡»å®‰è£…</li>
</ul>
</li>
<li>
<p><strong>OpenVSXï¼ˆå¼€æºVS Codeæ‰©å±•å¸‚åœºï¼‰</strong></p>
<ul>
<li>è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-vsx.org%2Fextension%2Fbreaking-brake%2Fcc-wf-studio" target="_blank" title="https://open-vsx.org/extension/breaking-brake/cc-wf-studio" ref="nofollow noopener noreferrer">OpenVSX</a></li>
<li>ä¸‹è½½ <code>.vsix</code> æ–‡ä»¶</li>
<li>åœ¨ VS Code ä¸­é€šè¿‡ "Install from VSIX" å®‰è£…</li>
</ul>
</li>
</ol>
<h4 data-id="heading-12">å¯åŠ¨ç¼–è¾‘å™¨</h4>
<ol>
<li>
<p><strong>æ–¹å¼ä¸€ï¼šç‚¹å‡»å›¾æ ‡</strong></p>
<ul>
<li>åœ¨ VS Code å³ä¸Šè§’æ‰¾åˆ° CC Workflow Studio å›¾æ ‡</li>
<li>ç‚¹å‡»æ‰“å¼€ç¼–è¾‘å™¨</li>
</ul>
</li>
<li>
<p><strong>æ–¹å¼äºŒï¼šå‘½ä»¤é¢æ¿</strong></p>
<ul>
<li>æŒ‰ <code>Cmd+Shift+P</code>ï¼ˆMacï¼‰æˆ– <code>Ctrl+Shift+P</code>ï¼ˆWindows/Linuxï¼‰</li>
<li>è¾“å…¥ "CC Workflow Studio: Open Editor"</li>
<li>é€‰æ‹©å‘½ä»¤æ‰“å¼€ç¼–è¾‘å™¨</li>
</ul>
</li>
</ol>
<h4 data-id="heading-13">åˆ›å»ºç¬¬ä¸€ä¸ªå·¥ä½œæµ</h4>
<ol>
<li>
<p><strong>æ·»åŠ èŠ‚ç‚¹</strong></p>
<ul>
<li>ä»å·¦ä¾§èŠ‚ç‚¹é¢æ¿æ‹–æ‹½èŠ‚ç‚¹åˆ°ç”»å¸ƒ</li>
<li>å¸¸è§èŠ‚ç‚¹ç±»å‹ï¼šAgentã€Conditionã€Actionã€MCP Toolç­‰</li>
</ul>
</li>
<li>
<p><strong>è¿æ¥èŠ‚ç‚¹</strong></p>
<ul>
<li>ç‚¹å‡»èŠ‚ç‚¹çš„è¾“å‡ºç«¯å£</li>
<li>æ‹–æ‹½åˆ°ç›®æ ‡èŠ‚ç‚¹çš„è¾“å…¥ç«¯å£</li>
<li>å»ºç«‹èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»</li>
</ul>
</li>
<li>
<p><strong>é…ç½®èŠ‚ç‚¹</strong></p>
<ul>
<li>ç‚¹å‡»èŠ‚ç‚¹æ‰“å¼€é…ç½®é¢æ¿</li>
<li>è®¾ç½®èŠ‚ç‚¹åç§°ã€æè¿°ã€å‚æ•°ç­‰</li>
<li>ä¿å­˜é…ç½®</li>
</ul>
</li>
<li>
<p><strong>ä¿å­˜å·¥ä½œæµ</strong></p>
<ul>
<li>ç‚¹å‡»å·¥å…·æ çš„ä¿å­˜æŒ‰é’®</li>
<li>å·¥ä½œæµä¿å­˜ä¸º <code>.vscode/workflows/*.json</code></li>
</ul>
</li>
<li>
<p><strong>å¯¼å‡ºå·¥ä½œæµ</strong></p>
<ul>
<li>ç‚¹å‡»å·¥å…·æ çš„å¯¼å‡ºæŒ‰é’®</li>
<li>é€‰æ‹©ç›®æ ‡å¹³å°ï¼ˆClaude Codeã€GitHub Copilotç­‰ï¼‰</li>
<li>å¯¼å‡ºä¸ºå¯¹åº”çš„æ ¼å¼æ–‡ä»¶</li>
</ul>
</li>
</ol>
<h3 data-id="heading-14">æ ¸å¿ƒç‰¹æ€§</h3>
<ol>
<li>
<p><strong>å¯è§†åŒ–æ‹–æ‹½ç¼–è¾‘</strong></p>
<ul>
<li>åŸºäº React Flow çš„ç°ä»£åŒ–ç•Œé¢</li>
<li>ç›´è§‚çš„èŠ‚ç‚¹å’Œè¿æ¥çº¿è¡¨ç¤º</li>
<li>æ”¯æŒç¼©æ”¾ã€å¹³ç§»ã€å¤šé€‰ç­‰æ“ä½œ</li>
<li>å®æ—¶é¢„è§ˆå·¥ä½œæµç»“æ„</li>
</ul>
</li>
<li>
<p><strong>AIè¾…åŠ©ç¼–è¾‘ï¼ˆEdit with AIï¼‰</strong></p>
<ul>
<li>é€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯æ”¹è¿›å·¥ä½œæµ</li>
<li>æ”¯æŒæ·»åŠ åŠŸèƒ½ã€ä¼˜åŒ–é€»è¾‘ã€ä¿®å¤é—®é¢˜</li>
<li>ä½¿ç”¨ Claude Code æˆ– GitHub Copilot ä½œä¸ºAIæä¾›è€…</li>
<li>è¿­ä»£å¼ä¼˜åŒ–ï¼Œé€æ­¥å®Œå–„å·¥ä½œæµ</li>
</ul>
</li>
<li>
<p><strong>å¤šå¹³å°å¯¼å‡ºæ”¯æŒ</strong></p>
<ul>
<li><strong>Claude Code</strong>ï¼šå¯¼å‡ºä¸º <code>.claude/agents/</code> å’Œ <code>.claude/commands/</code></li>
<li><strong>GitHub Copilot Chat</strong>ï¼šå¯¼å‡ºä¸º <code>.github/prompts/</code></li>
<li><strong>GitHub Copilot CLI</strong>ï¼šå¯¼å‡ºä¸º <code>.github/skills/</code></li>
<li><strong>OpenAI Codex CLI</strong>ï¼šå¯¼å‡ºä¸º <code>.codex/skills/</code></li>
</ul>
</li>
<li>
<p><strong>å­Agentç¼–æ’</strong></p>
<ul>
<li>æ”¯æŒåˆ›å»ºå¤šä¸ªå­Agent</li>
<li>å®šä¹‰Agentä¹‹é—´çš„åä½œå…³ç³»</li>
<li>æ”¯æŒæ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯é€»è¾‘</li>
<li>å®ç°å¤æ‚çš„å¤šAgentå·¥ä½œæµ</li>
</ul>
</li>
<li>
<p><strong>æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯</strong></p>
<ul>
<li>æ”¯æŒ if-else æ¡ä»¶åˆ¤æ–­</li>
<li>æ”¯æŒå¾ªç¯å¤„ç†é€»è¾‘</li>
<li>å¯è§†åŒ–å±•ç¤ºæ§åˆ¶æµ</li>
<li>çµæ´»çš„å·¥ä½œæµæ§åˆ¶</li>
</ul>
</li>
<li>
<p><strong>MCPå·¥å…·é›†æˆ</strong></p>
<ul>
<li>æ”¯æŒè°ƒç”¨ MCPï¼ˆModel Context Protocolï¼‰å·¥å…·</li>
<li>å¯è§†åŒ–é…ç½®å·¥å…·å‚æ•°</li>
<li>é›†æˆå¤–éƒ¨æœåŠ¡å’Œæ•°æ®æº</li>
</ul>
</li>
<li>
<p><strong>ä¸€é”®è¿è¡Œæµ‹è¯•</strong></p>
<ul>
<li>åœ¨ç¼–è¾‘å™¨ä¸­ç›´æ¥è¿è¡Œå·¥ä½œæµ</li>
<li>å®æ—¶æŸ¥çœ‹æ‰§è¡Œç»“æœ</li>
<li>å¿«é€ŸéªŒè¯å·¥ä½œæµé€»è¾‘</li>
<li>è°ƒè¯•å’Œä¼˜åŒ–å·¥ä½œæµ</li>
</ul>
</li>
<li>
<p><strong>å·¥ä½œæµç‰ˆæœ¬ç®¡ç†</strong></p>
<ul>
<li>ä¿å­˜ä¸ºJSONæ ¼å¼</li>
<li>æ”¯æŒç‰ˆæœ¬æ§åˆ¶å’ŒGitç®¡ç†</li>
<li>æ–¹ä¾¿å›¢é˜Ÿåä½œå’Œåˆ†äº«</li>
<li>å¯¼å…¥å¯¼å‡ºåŠŸèƒ½å®Œå–„</li>
</ul>
</li>
</ol>
<h3 data-id="heading-15">é¡¹ç›®ä¼˜åŠ¿</h3>















































<table><thead><tr><th align="left">å¯¹æ¯”é¡¹</th><th align="left">CC Workflow Studio</th><th align="left">æ–‡æœ¬é…ç½®</th><th align="left">å…¶ä»–å¯è§†åŒ–å·¥å…·</th></tr></thead><tbody><tr><td align="left"><strong>æ˜“ç”¨æ€§</strong></td><td align="left">â­â­â­â­â­ æ‹–æ‹½å¼ç¼–è¾‘</td><td align="left">â­â­ éœ€è¦æ‰‹å†™é…ç½®</td><td align="left">â­â­â­ ä¸­ç­‰</td></tr><tr><td align="left"><strong>å¯è§†åŒ–</strong></td><td align="left">â­â­â­â­â­ å›¾å½¢åŒ–ç•Œé¢</td><td align="left">â­ çº¯æ–‡æœ¬</td><td align="left">â­â­â­â­ å›¾å½¢åŒ–</td></tr><tr><td align="left"><strong>AIè¾…åŠ©</strong></td><td align="left">â­â­â­â­â­ å†…ç½®AIç¼–è¾‘</td><td align="left">â­ æ— </td><td align="left">â­â­ éƒ¨åˆ†æ”¯æŒ</td></tr><tr><td align="left"><strong>å¤šå¹³å°æ”¯æŒ</strong></td><td align="left">â­â­â­â­â­ 4ç§æ ¼å¼</td><td align="left">â­â­ å•ä¸€æ ¼å¼</td><td align="left">â­â­â­ 2-3ç§æ ¼å¼</td></tr><tr><td align="left"><strong>å­¦ä¹ æ›²çº¿</strong></td><td align="left">â­â­â­â­ è¾ƒä½</td><td align="left">â­â­ éœ€è¦å­¦ä¹ è¯­æ³•</td><td align="left">â­â­â­ ä¸­ç­‰</td></tr><tr><td align="left"><strong>è°ƒè¯•èƒ½åŠ›</strong></td><td align="left">â­â­â­â­â­ ä¸€é”®è¿è¡Œ</td><td align="left">â­â­ æ‰‹åŠ¨æµ‹è¯•</td><td align="left">â­â­â­ éƒ¨åˆ†æ”¯æŒ</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªé¡¹ç›®ï¼Ÿ</strong></p>
<ul>
<li>ğŸ¯ <strong>é™ä½é—¨æ§›</strong>ï¼šå¯è§†åŒ–ç¼–è¾‘è®©éæŠ€æœ¯ç”¨æˆ·ä¹Ÿèƒ½è®¾è®¡å·¥ä½œæµ</li>
<li>ğŸš€ <strong>æå‡æ•ˆç‡</strong>ï¼šAIè¾…åŠ©ç¼–è¾‘å¿«é€Ÿä¼˜åŒ–å·¥ä½œæµï¼Œå‡å°‘åå¤è°ƒè¯•</li>
<li>ğŸ”„ <strong>è·¨å¹³å°å…¼å®¹</strong>ï¼šä¸€å¥—å·¥ä½œæµå¯ä»¥å¯¼å‡ºåˆ°å¤šä¸ªå¹³å°ä½¿ç”¨</li>
<li>ğŸ¨ <strong>ç›´è§‚ç†è§£</strong>ï¼šå›¾å½¢åŒ–ç•Œé¢è®©å¤æ‚å·¥ä½œæµä¸€ç›®äº†ç„¶</li>
<li>ğŸ’ª <strong>åŠŸèƒ½å®Œæ•´</strong>ï¼šæ”¯æŒå­Agentã€æ¡ä»¶åˆ†æ”¯ã€MCPå·¥å…·ç­‰é«˜çº§ç‰¹æ€§</li>
</ul>
<hr/>
<h2 data-id="heading-16">é¡¹ç›®è¯¦ç»†å‰–æ</h2>
<h3 data-id="heading-17">æ¶æ„è®¾è®¡</h3>
<p>CC Workflow Studio é‡‡ç”¨ç°ä»£åŒ–çš„å‰ç«¯æ¶æ„ï¼ŒåŸºäº VS Code Extension API å’Œ React Flow æ„å»ºã€‚</p>
<h4 data-id="heading-18">æ ¸å¿ƒç»„ä»¶</h4>
<ol>
<li>
<p><strong>VS Code Extension ä¸»ç¨‹åº</strong></p>
<ul>
<li>ä½¿ç”¨ TypeScript ç¼–å†™</li>
<li>å®ç°æ‰©å±•çš„æ¿€æ´»å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†</li>
<li>æä¾›å‘½ä»¤å’ŒWebViewæ¥å£</li>
</ul>
</li>
<li>
<p><strong>React Flow å¯è§†åŒ–å¼•æ“</strong></p>
<ul>
<li>åŸºäº React Flow æ„å»ºèŠ‚ç‚¹å›¾</li>
<li>å¤„ç†èŠ‚ç‚¹æ‹–æ‹½ã€è¿æ¥ã€å¸ƒå±€ç­‰äº¤äº’</li>
<li>æä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒ</li>
</ul>
</li>
<li>
<p><strong>å·¥ä½œæµå¼•æ“</strong></p>
<ul>
<li>è§£æå’ŒéªŒè¯å·¥ä½œæµé…ç½®</li>
<li>æ‰§è¡Œå·¥ä½œæµé€»è¾‘</li>
<li>å¤„ç†èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®æµè½¬</li>
</ul>
</li>
<li>
<p><strong>å¯¼å‡ºè½¬æ¢å™¨</strong></p>
<ul>
<li>å°†å¯è§†åŒ–å·¥ä½œæµè½¬æ¢ä¸ºä¸åŒå¹³å°çš„æ ¼å¼</li>
<li>æ”¯æŒ Claude Codeã€GitHub Copilotã€OpenAI Codex ç­‰æ ¼å¼</li>
<li>ä¿æŒå·¥ä½œæµé€»è¾‘çš„ä¸€è‡´æ€§</li>
</ul>
</li>
</ol>
<h4 data-id="heading-19">æ•°æ®æ¨¡å‹</h4>
<p>å·¥ä½œæµä»¥JSONæ ¼å¼å­˜å‚¨ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»“æ„ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"nodes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node-1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"agent"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä»£ç å®¡æŸ¥Agent"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®¡æŸ¥ä»£ç è´¨é‡å’Œå®‰å…¨æ€§"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>...<span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"x"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"y"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"edges"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"edge-1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node-1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node-2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"default"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"viewport"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"x"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"y"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"zoom"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-20">å…³é”®å®ç°</h3>
<h4 data-id="heading-21">å¯è§†åŒ–ç¼–è¾‘å™¨å®ç°</h4>
<p>CC Workflow Studio ä½¿ç”¨ React Flow ä½œä¸ºå¯è§†åŒ–å¼•æ“ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ„å»ºèŠ‚ç‚¹å›¾çš„Reactåº“ã€‚</p>
<p><strong>èŠ‚ç‚¹ç±»å‹ç³»ç»Ÿ</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ”¯æŒçš„èŠ‚ç‚¹ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NodeType</span> = 
  | <span class="hljs-string">'agent'</span>      <span class="hljs-comment">// AgentèŠ‚ç‚¹</span>
  | <span class="hljs-string">'condition'</span>  <span class="hljs-comment">// æ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹</span>
  | <span class="hljs-string">'action'</span>      <span class="hljs-comment">// åŠ¨ä½œèŠ‚ç‚¹</span>
  | <span class="hljs-string">'mcp-tool'</span>    <span class="hljs-comment">// MCPå·¥å…·èŠ‚ç‚¹</span>
  | <span class="hljs-string">'input'</span>       <span class="hljs-comment">// è¾“å…¥èŠ‚ç‚¹</span>
  | <span class="hljs-string">'output'</span>;     <span class="hljs-comment">// è¾“å‡ºèŠ‚ç‚¹</span>
</code></pre>
<p><strong>èŠ‚ç‚¹æ¸²æŸ“</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹ç±»å‹æœ‰å¯¹åº”çš„Reactç»„ä»¶</li>
<li>èŠ‚ç‚¹å¯ä»¥è‡ªå®šä¹‰æ ·å¼å’Œäº¤äº’è¡Œä¸º</li>
<li>æ”¯æŒèŠ‚ç‚¹é…ç½®é¢æ¿ï¼Œç¼–è¾‘èŠ‚ç‚¹å±æ€§</li>
</ul>
<p><strong>è¿æ¥å¤„ç†</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ React Flow çš„ Edge ç»„ä»¶è¡¨ç¤ºè¿æ¥</li>
<li>æ”¯æŒæ¡ä»¶è¿æ¥ï¼ˆå¸¦æ ‡ç­¾çš„åˆ†æ”¯ï¼‰</li>
<li>éªŒè¯è¿æ¥çš„æœ‰æ•ˆæ€§ï¼ˆç±»å‹åŒ¹é…ç­‰ï¼‰</li>
</ul>
<h4 data-id="heading-22">AIè¾…åŠ©ç¼–è¾‘åŠŸèƒ½</h4>
<p>AIè¾…åŠ©ç¼–è¾‘æ˜¯ CC Workflow Studio çš„æ ¸å¿ƒåˆ›æ–°åŠŸèƒ½ï¼Œè®©ç”¨æˆ·å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯æ¥æ”¹è¿›å·¥ä½œæµã€‚</p>
<p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p>
<ol>
<li>
<p><strong>ç”¨æˆ·è¾“å…¥éœ€æ±‚</strong></p>
<ul>
<li>ç‚¹å‡» "Edit with AI" æŒ‰é’®</li>
<li>è¾“å…¥è‡ªç„¶è¯­è¨€æè¿°ï¼ˆå¦‚"æ·»åŠ ä»£ç å®‰å…¨æ£€æŸ¥æ­¥éª¤"ï¼‰</li>
</ul>
</li>
<li>
<p><strong>AIç†è§£éœ€æ±‚</strong></p>
<ul>
<li>å°†å·¥ä½œæµå½“å‰çŠ¶æ€å‘é€ç»™AI</li>
<li>AIåˆ†æå·¥ä½œæµç»“æ„</li>
<li>ç†è§£ç”¨æˆ·çš„æ”¹è¿›éœ€æ±‚</li>
</ul>
</li>
<li>
<p><strong>ç”Ÿæˆæ”¹è¿›æ–¹æ¡ˆ</strong></p>
<ul>
<li>AIç”Ÿæˆä¿®æ”¹å»ºè®®</li>
<li>å¯èƒ½åŒ…æ‹¬ï¼šæ·»åŠ èŠ‚ç‚¹ã€ä¿®æ”¹è¿æ¥ã€è°ƒæ•´é…ç½®ç­‰</li>
<li>ä»¥JSONæ ¼å¼è¿”å›ä¿®æ”¹æ–¹æ¡ˆ</li>
</ul>
</li>
<li>
<p><strong>åº”ç”¨ä¿®æ”¹</strong></p>
<ul>
<li>è§£æAIè¿”å›çš„ä¿®æ”¹æ–¹æ¡ˆ</li>
<li>åº”ç”¨åˆ°å·¥ä½œæµå›¾ä¸­</li>
<li>ç”¨æˆ·ç¡®è®¤åä¿å­˜</li>
</ul>
</li>
</ol>
<p><strong>AIæä¾›è€…æ”¯æŒ</strong>ï¼š</p>
<ul>
<li><strong>Claude Code</strong>ï¼šé»˜è®¤æ”¯æŒï¼Œä½¿ç”¨ Claude æ¨¡å‹</li>
<li><strong>GitHub Copilot</strong>ï¼šéœ€è¦å®‰è£… Copilot æ‰©å±•</li>
<li><strong>OpenAI Codex</strong>ï¼šéœ€è¦é…ç½® API å¯†é’¥</li>
</ul>
<h4 data-id="heading-23">å¤šå¹³å°å¯¼å‡ºæœºåˆ¶</h4>
<p>CC Workflow Studio æ”¯æŒå°†å¯è§†åŒ–å·¥ä½œæµå¯¼å‡ºä¸ºå¤šç§æ ¼å¼ï¼Œé€‚é…ä¸åŒçš„AIç¼–ç¨‹å¹³å°ã€‚</p>
<p><strong>å¯¼å‡ºæµç¨‹</strong>ï¼š</p>
<ol>
<li>
<p><strong>å·¥ä½œæµéªŒè¯</strong></p>
<ul>
<li>æ£€æŸ¥èŠ‚ç‚¹é…ç½®å®Œæ•´æ€§</li>
<li>éªŒè¯è¿æ¥çš„æœ‰æ•ˆæ€§</li>
<li>ç¡®ä¿å·¥ä½œæµé€»è¾‘æ­£ç¡®</li>
</ul>
</li>
<li>
<p><strong>æ ¼å¼è½¬æ¢</strong></p>
<ul>
<li>æ ¹æ®ç›®æ ‡å¹³å°é€‰æ‹©è½¬æ¢å™¨</li>
<li>å°†èŠ‚ç‚¹å›¾è½¬æ¢ä¸ºç›®æ ‡æ ¼å¼</li>
<li>å¤„ç†å¹³å°ç‰¹å®šçš„é…ç½®é¡¹</li>
</ul>
</li>
<li>
<p><strong>æ–‡ä»¶ç”Ÿæˆ</strong></p>
<ul>
<li>ç”Ÿæˆå¯¹åº”çš„é…ç½®æ–‡ä»¶</li>
<li>ä¿å­˜åˆ°æŒ‡å®šç›®å½•</li>
<li>æ›´æ–°å¹³å°é…ç½®ç´¢å¼•</li>
</ul>
</li>
</ol>
<p><strong>Claude Code å¯¼å‡ºç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># .claude/agents/code-review-agent.md</span>

<span class="hljs-section">## Agent: ä»£ç å®¡æŸ¥Agent</span>

<span class="hljs-section">### Description</span>
å®¡æŸ¥ä»£ç è´¨é‡å’Œå®‰å…¨æ€§

<span class="hljs-section">### Steps</span>
<span class="hljs-bullet">1.</span> åˆ†æä»£ç ç»“æ„
<span class="hljs-bullet">2.</span> æ£€æŸ¥å®‰å…¨é—®é¢˜
<span class="hljs-bullet">3.</span> è¯„ä¼°ä»£ç è´¨é‡
<span class="hljs-bullet">4.</span> ç”Ÿæˆå®¡æŸ¥æŠ¥å‘Š

<span class="hljs-section">### Tools</span>
<span class="hljs-bullet">-</span> file-reader
<span class="hljs-bullet">-</span> security-scanner
</code></pre>
<p><strong>GitHub Copilot å¯¼å‡ºç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/prompts/code-review.yml</span>

<span class="hljs-attr">name:</span> <span class="hljs-string">Code</span> <span class="hljs-string">Review</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">å®¡æŸ¥ä»£ç è´¨é‡å’Œå®‰å…¨æ€§</span>
<span class="hljs-attr">steps:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Analyze</span> <span class="hljs-string">Code</span>
    <span class="hljs-attr">action:</span> <span class="hljs-string">analyze</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">Security</span>
    <span class="hljs-attr">action:</span> <span class="hljs-string">security-scan</span>
</code></pre>
<h4 data-id="heading-24">å­Agentç¼–æ’æœºåˆ¶</h4>
<p>CC Workflow Studio æ”¯æŒåˆ›å»ºå¤šä¸ªå­Agentï¼Œå¹¶ç¼–æ’å®ƒä»¬ä¹‹é—´çš„åä½œå…³ç³»ã€‚</p>
<p><strong>å­Agentè®¾è®¡</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªå­Agentæœ‰ç‹¬ç«‹çš„é…ç½®å’Œæç¤ºè¯</li>
<li>å­Agentå¯ä»¥è°ƒç”¨MCPå·¥å…·</li>
<li>æ”¯æŒå­Agentä¹‹é—´çš„æ•°æ®ä¼ é€’</li>
</ul>
<p><strong>åä½œæ¨¡å¼</strong>ï¼š</p>
<ol>
<li>
<p><strong>é¡ºåºæ‰§è¡Œ</strong></p>
<ul>
<li>Agent A å®Œæˆåï¼Œå°†ç»“æœä¼ é€’ç»™ Agent B</li>
<li>é€‚åˆæµæ°´çº¿å¼å¤„ç†</li>
</ul>
</li>
<li>
<p><strong>å¹¶è¡Œæ‰§è¡Œ</strong></p>
<ul>
<li>å¤šä¸ªAgentåŒæ—¶æ‰§è¡Œ</li>
<li>æœ€ååˆå¹¶ç»“æœ</li>
</ul>
</li>
<li>
<p><strong>æ¡ä»¶åˆ†æ”¯</strong></p>
<ul>
<li>æ ¹æ®æ¡ä»¶é€‰æ‹©ä¸åŒçš„Agentæ‰§è¡Œ</li>
<li>å®ç°åŠ¨æ€è·¯ç”±</li>
</ul>
</li>
</ol>
<p><strong>å®ç°ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"nodes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"designer"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"agent"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ¶æ„è®¾è®¡å¸ˆ"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"developer"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"agent"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä»£ç å¼€å‘è€…"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"condition"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"condition"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"condition"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"needs_refactor"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"edges"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"designer"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"condition"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"condition"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"developer"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"condition"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"true"</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-25">æ‰©å±•æœºåˆ¶</h3>
<h4 data-id="heading-26">è‡ªå®šä¹‰èŠ‚ç‚¹ç±»å‹</h4>
<p>CC Workflow Studio æ”¯æŒæ‰©å±•è‡ªå®šä¹‰èŠ‚ç‚¹ç±»å‹ï¼Œå¼€å‘è€…å¯ä»¥ï¼š</p>
<ol>
<li>
<p><strong>å®šä¹‰èŠ‚ç‚¹ç»„ä»¶</strong></p>
<ul>
<li>åˆ›å»ºReactç»„ä»¶</li>
<li>å®ç°èŠ‚ç‚¹æ¸²æŸ“é€»è¾‘</li>
<li>å®šä¹‰é…ç½®é¢æ¿</li>
</ul>
</li>
<li>
<p><strong>æ³¨å†ŒèŠ‚ç‚¹ç±»å‹</strong></p>
<ul>
<li>åœ¨æ‰©å±•é…ç½®ä¸­æ³¨å†Œ</li>
<li>æ·»åŠ åˆ°èŠ‚ç‚¹é¢æ¿</li>
<li>æ”¯æŒèŠ‚ç‚¹éªŒè¯</li>
</ul>
</li>
<li>
<p><strong>å®ç°èŠ‚ç‚¹é€»è¾‘</strong></p>
<ul>
<li>å®šä¹‰èŠ‚ç‚¹çš„æ‰§è¡Œé€»è¾‘</li>
<li>å¤„ç†è¾“å…¥è¾“å‡º</li>
<li>é›†æˆåˆ°å·¥ä½œæµå¼•æ“</li>
</ul>
</li>
</ol>
<h4 data-id="heading-27">MCPå·¥å…·é›†æˆ</h4>
<p>CC Workflow Studio æ”¯æŒé›†æˆ MCPï¼ˆModel Context Protocolï¼‰å·¥å…·ï¼Œæ‰©å±•AIçš„èƒ½åŠ›è¾¹ç•Œã€‚</p>
<p><strong>é›†æˆæ–¹å¼</strong>ï¼š</p>
<ol>
<li>
<p><strong>å‘ç°MCPæœåŠ¡å™¨</strong></p>
<ul>
<li>æ‰«æå·²å®‰è£…çš„MCPæœåŠ¡å™¨</li>
<li>è¯»å–å·¥å…·å®šä¹‰</li>
<li>ç”Ÿæˆå·¥å…·èŠ‚ç‚¹</li>
</ul>
</li>
<li>
<p><strong>å·¥å…·èŠ‚ç‚¹</strong></p>
<ul>
<li>æ¯ä¸ªMCPå·¥å…·å¯¹åº”ä¸€ä¸ªèŠ‚ç‚¹</li>
<li>å¯è§†åŒ–é…ç½®å·¥å…·å‚æ•°</li>
<li>æ”¯æŒå·¥å…·é“¾å¼è°ƒç”¨</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®æµè½¬</strong></p>
<ul>
<li>å·¥å…·è¾“å‡ºå¯ä»¥ä½œä¸ºå…¶ä»–èŠ‚ç‚¹çš„è¾“å…¥</li>
<li>æ”¯æŒå¤æ‚çš„æ•°æ®å¤„ç†æµç¨‹</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-28">é¡¹ç›®åœ°å€ä¸èµ„æº</h2>
<h3 data-id="heading-29">å®˜æ–¹èµ„æº</h3>
<ul>
<li>ğŸŒŸ <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbreaking-brake%2Fcc-wf-studio" target="_blank" title="https://github.com/breaking-brake/cc-wf-studio" ref="nofollow noopener noreferrer">github.com/breaking-brâ€¦</a></li>
</ul>
<h3 data-id="heading-30">é€‚ç”¨äººç¾¤</h3>
<p><strong>CC Workflow Studio ç‰¹åˆ«é€‚åˆä»¥ä¸‹å¼€å‘è€…</strong>ï¼š</p>
<ol>
<li>
<p><strong>AIå·¥å…·ä½¿ç”¨è€…</strong></p>
<ul>
<li>æ­£åœ¨ä½¿ç”¨ Claude Codeã€GitHub Copilot ç­‰AIç¼–ç¨‹å·¥å…·</li>
<li>å¸Œæœ›è®¾è®¡å¤æ‚çš„å·¥ä½œæµè‡ªåŠ¨åŒ–</li>
<li>éœ€è¦å¯è§†åŒ–ç®¡ç†å’Œä¼˜åŒ–å·¥ä½œæµ</li>
</ul>
</li>
<li>
<p><strong>å›¢é˜Ÿåä½œå¼€å‘è€…</strong></p>
<ul>
<li>éœ€è¦ç»Ÿä¸€å›¢é˜Ÿçš„å·¥ä½œæµæ ‡å‡†</li>
<li>å¸Œæœ›åˆ†äº«å’Œå¤ç”¨å·¥ä½œæµé…ç½®</li>
<li>éœ€è¦ç‰ˆæœ¬ç®¡ç†å·¥ä½œæµ</li>
</ul>
</li>
<li>
<p><strong>å·¥ä½œæµè®¾è®¡è€…</strong></p>
<ul>
<li>éœ€è¦è®¾è®¡å¤šAgentåä½œæµç¨‹</li>
<li>å¸Œæœ›å¿«é€Ÿè¿­ä»£å’Œä¼˜åŒ–å·¥ä½œæµ</li>
<li>éœ€è¦è·¨å¹³å°è¿ç§»å·¥ä½œæµ</li>
</ul>
</li>
<li>
<p><strong>å­¦ä¹ ç ”ç©¶è€…</strong></p>
<ul>
<li>æƒ³äº†è§£AIå·¥ä½œæµçš„è®¾è®¡æ¨¡å¼</li>
<li>ç ”ç©¶Agentç¼–æ’å’Œåä½œæœºåˆ¶</li>
<li>å­¦ä¹ å¯è§†åŒ–ç¼–è¾‘å™¨çš„å®ç°</li>
</ul>
</li>
</ol>
<p><strong>ä½¿ç”¨å»ºè®®</strong>ï¼š</p>
<ul>
<li>ä»ç®€å•çš„å·¥ä½œæµå¼€å§‹ï¼Œé€æ­¥å­¦ä¹ å¤æ‚åŠŸèƒ½</li>
<li>å……åˆ†åˆ©ç”¨AIè¾…åŠ©ç¼–è¾‘åŠŸèƒ½ï¼Œå¿«é€Ÿä¼˜åŒ–å·¥ä½œæµ</li>
<li>å¤šä½¿ç”¨ä¸€é”®è¿è¡ŒåŠŸèƒ½ï¼ŒåŠæ—¶éªŒè¯å·¥ä½œæµé€»è¾‘</li>
<li>å‚è€ƒç¤¾åŒºç¤ºä¾‹ï¼Œå­¦ä¹ æœ€ä½³å®è·µ</li>
</ul>
<hr/>
<p><em>æ¬¢è¿æ¥æˆ‘ä¸­çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">ä¸ªäººä¸»é¡µ</a>æ‰¾åˆ°æ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†å’Œæœ‰è¶£çš„äº§å“</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Kotlinç³»åˆ—18ã€‘è¿›é˜¶ä¹‹è·¯ï¼šä»è¯­è¨€ç‰¹æ€§åˆ°æ¶æ„æ€ç»´]]></title>    <link>https://juejin.cn/post/7603563360329302058</link>    <guid>https://juejin.cn/post/7603563360329302058</guid>    <pubDate>2026-02-06T13:23:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360329302058" data-draft-id="7603563317040250943" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Kotlinç³»åˆ—18ã€‘è¿›é˜¶ä¹‹è·¯ï¼šä»è¯­è¨€ç‰¹æ€§åˆ°æ¶æ„æ€ç»´"/> <meta itemprop="keywords" content="ç¼–ç¨‹è¯­è¨€,Android,Kotlin"/> <meta itemprop="datePublished" content="2026-02-06T13:23:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Kotlinç³»åˆ—18ã€‘è¿›é˜¶ä¹‹è·¯ï¼šä»è¯­è¨€ç‰¹æ€§åˆ°æ¶æ„æ€ç»´
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T13:23:21.000Z" title="Fri Feb 06 2026 13:23:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>"æˆ‘å·²ç»å­¦å®Œäº†Kotlinçš„æ‰€æœ‰è¯­æ³•ç‰¹æ€§,ä½†æ€»è§‰å¾—ç¼ºå°‘ä»€ä¹ˆã€‚"â€”â€”è¿™æ˜¯è®¸å¤šå­¦å®ŒKotlinåŸºç¡€æ•™ç¨‹çš„å¼€å‘è€…çš„å›°æƒ‘ã€‚</p>
<p>ä¸¤å¹´å‰,æˆ‘å¸¦é¢†å›¢é˜Ÿå°†ä¸€ä¸ªå¤§å‹Androidé¡¹ç›®ä»Javaè¿ç§»åˆ°Kotlinã€‚è¿ç§»åˆæœŸ,å›¢é˜Ÿæˆå‘˜è™½ç„¶æŒæ¡äº†Kotlinè¯­æ³•,ä½†å†™å‡ºçš„ä»£ç ä»ç„¶å……æ»¡"Javaæ€ç»´":å¤§é‡çš„å¯ç©ºç±»å‹æ£€æŸ¥ã€å†—é•¿çš„æ¡ä»¶åˆ¤æ–­ã€é‡å¤çš„æ¨¡æ¿ä»£ç ã€‚<strong>æˆ‘ä»¬ä¼šç”¨Kotlin,ä½†æ²¡æœ‰ç”¨å¥½Kotlinã€‚</strong></p>
<p>çœŸæ­£çš„è½¬å˜å‘ç”Ÿåœ¨æˆ‘ä»¬å¼€å§‹æ€è€ƒ"ä¸ºä»€ä¹ˆKotlinè¦è¿™æ ·è®¾è®¡"ä¹‹åã€‚å½“æˆ‘ä»¬ç†è§£äº†:</p>
<ul>
<li>ä¸ºä»€ä¹ˆKotlinè¦åŒºåˆ†å¯ç©ºç±»å‹å’Œéç©ºç±»å‹?</li>
<li>ä¸ºä»€ä¹ˆè¦æä¾›<code>let</code>ã€<code>apply</code>ã€<code>also</code>ç­‰ä½œç”¨åŸŸå‡½æ•°?</li>
<li>ä¸ºä»€ä¹ˆè¦æ”¯æŒåç¨‹è€Œä¸æ˜¯ä¼ ç»Ÿçº¿ç¨‹æ¨¡å‹?</li>
<li>ä¸ºä»€ä¹ˆè¦æä¾›DSLæ„å»ºèƒ½åŠ›?</li>
</ul>
<p>æˆ‘ä»¬çš„ä»£ç æ‰çœŸæ­£å˜å¾—"Kotlinish"â€”â€”ç®€æ´ã€å®‰å…¨ã€é«˜æ•ˆã€ä¼˜é›…ã€‚</p>
<p><strong>æœ¬æ–‡æ˜¯ã€ŠKotlinå®Œå…¨å­¦ä¹ æŒ‡å—ã€‹ç³»åˆ—çš„æœ€åä¸€ç¯‡,ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ç¯‡ã€‚</strong> æˆ‘ä»¬å°†ç«™åœ¨æ›´é«˜çš„è§†è§’,å›é¡¾è¿™17ç¯‡æ–‡ç« å­¦åˆ°çš„çŸ¥è¯†,æ¢³ç†çŸ¥è¯†ä½“ç³»,æ¢ç´¢è®¾è®¡å“²å­¦,å»ºç«‹ä»è¯­è¨€ç‰¹æ€§åˆ°æ¶æ„è®¾è®¡çš„æ€ç»´æ¡†æ¶ã€‚</p>
<p>è¿™ä¸æ˜¯ä¸€ç¯‡æ–°çŸ¥è¯†çš„æ–‡ç« ,è€Œæ˜¯ä¸€æ¬¡ç³»ç»ŸåŒ–æ€ç»´çš„å‡åã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€çŸ¥è¯†ä½“ç³»å›é¡¾:ä»å…¥é—¨åˆ°ç²¾é€šçš„å®Œæ•´åœ°å›¾</h2>
<h3 data-id="heading-2">1.1 ç³»åˆ—æ–‡ç« çŸ¥è¯†æ¶æ„</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aeea0d7bbda94e2b812ba174ba392e9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770989000&amp;x-signature=qpinziwyNoX%2BUKxWmysttlqD7DE%3D" alt="18-01-kotlin-knowledge-map.png" loading="lazy"/></p>
<p>è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ•´ä¸ªç³»åˆ—çš„çŸ¥è¯†ç»“æ„:</p>
<p><strong>ç¬¬é›¶é˜¶æ®µ:å¿«é€Ÿå…¥é—¨(5ç¯‡)</strong> â­</p>
<ul>
<li>ç¯å¢ƒæ­å»ºã€Hello Worldã€REPL</li>
<li>å˜é‡ã€æ•°æ®ç±»å‹ã€ç©ºå®‰å…¨åŸºç¡€</li>
<li>æ§åˆ¶æµã€å‡½æ•°ã€Lambdaè¡¨è¾¾å¼</li>
<li>ç±»ä¸å¯¹è±¡ã€Data Class</li>
<li>é›†åˆæ¡†æ¶ä¸å‡½æ•°å¼æ“ä½œ</li>
</ul>
<p><strong>ç¬¬ä¸€é˜¶æ®µ:è¿›é˜¶åŸºç¡€(3ç¯‡)</strong> â­â­â­</p>
<ul>
<li>é¢å‘å¯¹è±¡è¿›é˜¶:æ¥å£ã€æŠ½è±¡ç±»ã€å¤šæ€ã€å¯†å°ç±»</li>
<li>ç±»å‹ç³»ç»Ÿæ·±åº¦è§£æ:å¯ç©ºç±»å‹ã€æ™ºèƒ½è½¬æ¢ã€ç±»å‹æ¨æ–­</li>
<li>æ³›å‹è¿›é˜¶:å‹å˜ã€å…·ä½“åŒ–ç±»å‹å‚æ•°ã€PECSåŸåˆ™</li>
</ul>
<p><strong>ç¬¬äºŒé˜¶æ®µ:æ ¸å¿ƒç‰¹æ€§(4ç¯‡)</strong> â­â­â­â­</p>
<ul>
<li>å§”æ‰˜æœºåˆ¶:ç±»å§”æ‰˜ã€å±æ€§å§”æ‰˜ã€è‡ªå®šä¹‰å§”æ‰˜</li>
<li>åç¨‹(ä¸Š):ç»“æ„åŒ–å¹¶å‘ã€ä½œç”¨åŸŸã€è°ƒåº¦å™¨ã€å¼‚å¸¸å¤„ç†</li>
<li>åç¨‹(ä¸‹):Flowã€StateFlowã€Channelã€èƒŒå‹å¤„ç†</li>
<li>å‡½æ•°å¼ç¼–ç¨‹:é«˜é˜¶å‡½æ•°ã€æ‰©å±•å‡½æ•°ã€ä½œç”¨åŸŸå‡½æ•°</li>
</ul>
<p><strong>ç¬¬ä¸‰é˜¶æ®µ:é«˜çº§åº”ç”¨(5ç¯‡)</strong> â­â­â­â­â­</p>
<ul>
<li>DSLè®¾è®¡:Lambda with Receiverã€ç±»å‹å®‰å…¨Builder</li>
<li>ç¼–è¯‘å™¨æ’ä»¶:KSPã€KAPTã€å­—èŠ‚ç å¢å¼º</li>
<li>Kotlin Multiplatform:è·¨å¹³å°ä»£ç å…±äº«</li>
<li>æ€§èƒ½ä¼˜åŒ–:å†…è”å‡½æ•°ã€å†…å­˜ç®¡ç†ã€å­—èŠ‚ç åˆ†æ</li>
<li>Androidåç¨‹æœ€ä½³å®è·µ:ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ã€é”™è¯¯å¤„ç†</li>
</ul>
<h3 data-id="heading-3">1.2 çŸ¥è¯†å±‚æ¬¡çš„é€’è¿›</h3>
<p>è¿™ä¸ªç³»åˆ—çš„è®¾è®¡éµå¾ª"èºæ—‹å¼ä¸Šå‡"çš„å­¦ä¹ è·¯å¾„:</p>
<pre><code class="hljs">åŸºç¡€è¯­æ³• â†’ é¢å‘å¯¹è±¡ â†’ ç±»å‹ç³»ç»Ÿ â†’ å‡½æ•°å¼ç¼–ç¨‹
   â†“           â†“           â†“            â†“
å®è·µåº”ç”¨ â†’ è®¾è®¡æ¨¡å¼ â†’ æ€§èƒ½ä¼˜åŒ– â†’ æ¶æ„æ€ç»´
</code></pre>
<p><strong>ç¬¬ä¸€å±‚:è¯­æ³•æŒæ¡</strong> - çŸ¥é“Kotlinæœ‰å“ªäº›ç‰¹æ€§</p>
<ul>
<li>å…³é”®è¯:å¯ç©ºç±»å‹ã€Lambdaã€æ‰©å±•å‡½æ•°ã€åç¨‹</li>
</ul>
<p><strong>ç¬¬äºŒå±‚:åŸç†ç†è§£</strong> - ç†è§£ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡</p>
<ul>
<li>å…³é”®è¯:ç©ºå®‰å…¨ã€é›¶å¼€é”€æŠ½è±¡ã€ç»“æ„åŒ–å¹¶å‘</li>
</ul>
<p><strong>ç¬¬ä¸‰å±‚:å®è·µåº”ç”¨</strong> - çŸ¥é“ä½•æ—¶ä½¿ç”¨å“ªä¸ªç‰¹æ€§</p>
<ul>
<li>å…³é”®è¯:æœ€ä½³å®è·µã€è®¾è®¡æ¨¡å¼ã€æ€§èƒ½ä¼˜åŒ–</li>
</ul>
<p><strong>ç¬¬å››å±‚:æ¶æ„æ€ç»´</strong> - å»ºç«‹ç³»ç»ŸåŒ–çš„è®¾è®¡ç†å¿µ</p>
<ul>
<li>å…³é”®è¯:ç®€æ´æ€§ã€å®‰å…¨æ€§ã€äº’æ“ä½œæ€§ã€è¡¨è¾¾åŠ›</li>
</ul>
<h3 data-id="heading-4">1.3 æ ¸å¿ƒçŸ¥è¯†ç‚¹å…³è”å›¾</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0b1c54389d74a368cedcec3ecc7e3e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770989000&amp;x-signature=Zv23TXrLMeiKdN7jDsJ4dl%2BBnP4%3D" alt="18-02-concept-relationships.png" loading="lazy"/></p>
<p>Kotlinçš„å„ä¸ªç‰¹æ€§å¹¶éå­¤ç«‹å­˜åœ¨,è€Œæ˜¯ç›¸äº’å…³è”ã€ç›¸äº’æ”¯æ’‘:</p>
<p><strong>ç©ºå®‰å…¨</strong> â† ç±»å‹ç³»ç»ŸåŸºç¡€</p>
<ul>
<li>å¯ç©ºç±»å‹ <code>String?</code></li>
<li>å®‰å…¨è°ƒç”¨ <code>?.</code></li>
<li>Elvisæ“ä½œç¬¦ <code>?:</code></li>
<li>éç©ºæ–­è¨€ <code>!!</code></li>
</ul>
<p><strong>å‡½æ•°å¼ç¼–ç¨‹</strong> â† ç®€æ´è¡¨è¾¾çš„æ ¸å¿ƒ</p>
<ul>
<li>Lambdaè¡¨è¾¾å¼</li>
<li>é«˜é˜¶å‡½æ•°</li>
<li>æ‰©å±•å‡½æ•°</li>
<li>ä½œç”¨åŸŸå‡½æ•°(let/apply/also/run/with)</li>
</ul>
<p><strong>åç¨‹</strong> â† å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜é›…æ–¹æ¡ˆ</p>
<ul>
<li>æŒ‚èµ·å‡½æ•° <code>suspend</code></li>
<li>ç»“æ„åŒ–å¹¶å‘</li>
<li>Flowå“åº”å¼æ•°æ®æµ</li>
<li>ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥</li>
</ul>
<p><strong>å§”æ‰˜</strong> â† ä»£ç å¤ç”¨çš„é«˜çº§æ‰‹æ®µ</p>
<ul>
<li>ç±»å§”æ‰˜ <code>by</code></li>
<li>å±æ€§å§”æ‰˜(lazy/observable)</li>
<li>é¿å…ç»§æ‰¿çš„çµæ´»æ–¹å¼</li>
</ul>
<p><strong>DSL</strong> â† è¡¨è¾¾åŠ›çš„ç»ˆæä½“ç°</p>
<ul>
<li>Lambda with Receiver</li>
<li>ç±»å‹å®‰å…¨Builder</li>
<li>é¢†åŸŸç‰¹å®šè¯­è¨€æ„å»º</li>
</ul>
<hr/>
<h2 data-id="heading-5">äºŒã€Kotlinè®¾è®¡å“²å­¦:ä¸ºä»€ä¹ˆKotlinè¿™æ ·è®¾è®¡?</h2>
<h3 data-id="heading-6">2.1 æ ¸å¿ƒè®¾è®¡ç†å¿µ</h3>
<p>Kotlinçš„è®¾è®¡éµå¾ªå››å¤§æ ¸å¿ƒç†å¿µ:</p>
<h4 data-id="heading-7">1. ç®€æ´æ€§(Conciseness)</h4>
<p><strong>è®¾è®¡ç›®æ ‡</strong>: å‡å°‘æ ·æ¿ä»£ç ,è®©å¼€å‘è€…ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚</p>
<p><strong>ä½“ç°</strong>:</p>
<ul>
<li>Data Classè‡ªåŠ¨ç”Ÿæˆequals/hashCode/toString/copy</li>
<li>æ‰©å±•å‡½æ•°æ— éœ€ç»§æ‰¿å³å¯æ‰©å±•åŠŸèƒ½</li>
<li>ä½œç”¨åŸŸå‡½æ•°ç®€åŒ–å¸¸è§æ“ä½œæ¨¡å¼</li>
<li>ç±»å‹æ¨æ–­å‡å°‘å†—ä½™ç±»å‹å£°æ˜</li>
</ul>
<p><strong>å¯¹æ¯”</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Java: 30è¡Œæ ·æ¿ä»£ç </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> int age;

    <span class="hljs-keyword">public</span> User(String name, int age) {
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.age = age;
    }

    <span class="hljs-keyword">public</span> String getName() { <span class="hljs-keyword">return</span> name; }
    <span class="hljs-keyword">public</span> int getAge() { <span class="hljs-keyword">return</span> age; }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> boolean equals(Object o) { <span class="hljs-comment">/* 10è¡Œ... */</span> }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> int hashCode() { <span class="hljs-comment">/* 5è¡Œ... */</span> }
}

<span class="hljs-comment">// Kotlin: 1è¡Œ</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>)
</code></pre>
<h4 data-id="heading-8">2. å®‰å…¨æ€§(Safety)</h4>
<p><strong>è®¾è®¡ç›®æ ‡</strong>: åœ¨ç¼–è¯‘æœŸæ¶ˆé™¤å¸¸è§è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<p><strong>ä½“ç°</strong>:</p>
<ul>
<li>ç©ºå®‰å…¨:ç¼–è¯‘å™¨å¼ºåˆ¶å¤„ç†å¯ç©ºç±»å‹</li>
<li>ç±»å‹å®‰å…¨:å¼ºç±»å‹ç³»ç»Ÿé˜²æ­¢ç±»å‹é”™è¯¯</li>
<li>ä¸å¯å˜æ€§ä¼˜å…ˆ:<code>val</code> vs <code>var</code>ã€ä¸å¯å˜é›†åˆ</li>
<li>æ™ºèƒ½è½¬æ¢:è‡ªåŠ¨ç±»å‹è½¬æ¢é¿å…æ‰‹åŠ¨cast</li>
</ul>
<p><strong>å“²å­¦</strong>: "Make impossible states unrepresentable" (è®©éæ³•çŠ¶æ€æ— æ³•è¡¨è¾¾)</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç¼–è¯‘å™¨ä¿è¯ä¸ä¼šæœ‰NPE</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(name: <span class="hljs-type">String</span>?)</span></span> {
    <span class="hljs-comment">// å¿…é¡»æ˜¾å¼å¤„ç†null</span>
    <span class="hljs-keyword">val</span> length = name?.length ?: <span class="hljs-number">0</span>

    <span class="hljs-comment">// æ™ºèƒ½è½¬æ¢åæ— éœ€æ‰‹åŠ¨cast</span>
    <span class="hljs-keyword">if</span> (name != <span class="hljs-literal">null</span>) {
        println(name.uppercase())  <span class="hljs-comment">// nameè‡ªåŠ¨è½¬ä¸ºéç©º</span>
    }
}
</code></pre>
<h4 data-id="heading-9">3. äº’æ“ä½œæ€§(Interoperability)</h4>
<p><strong>è®¾è®¡ç›®æ ‡</strong>: ä¸Javaæ— ç¼é›†æˆ,å¹³æ»‘è¿ç§»ã€‚</p>
<p><strong>ä½“ç°</strong>:</p>
<ul>
<li>100% Javaäº’æ“ä½œ:å¯ä»¥è°ƒç”¨Javaåº“,Javaä¹Ÿå¯ä»¥è°ƒç”¨Kotlin</li>
<li>å­—èŠ‚ç å…¼å®¹:ç”Ÿæˆæ ‡å‡†JVMå­—èŠ‚ç </li>
<li>å¹³å°ç±»å‹:åˆç†å¤„ç†Javaçš„å¯ç©ºæ€§</li>
<li>æ³¨è§£å…¼å®¹:æ”¯æŒJavaæ³¨è§£</li>
</ul>
<p><strong>ç­–ç•¥</strong>: åŠ¡å®ä¸»ä¹‰è€Œéçº¯ç²¹ä¸»ä¹‰</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è°ƒç”¨Javaä»£ç </span>
<span class="hljs-keyword">val</span> list = ArrayList&lt;String&gt;()  <span class="hljs-comment">// Javaç±»</span>
list.add(<span class="hljs-string">"Kotlin"</span>)

<span class="hljs-comment">// Javaè°ƒç”¨Kotlin</span>
<span class="hljs-meta">@JvmStatic</span>  <span class="hljs-comment">// ç”ŸæˆJavaå‹å¥½çš„é™æ€æ–¹æ³•</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">()</span></span>: User = User(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>)
</code></pre>
<h4 data-id="heading-10">4. å·¥å…·å‹å¥½æ€§(Tooling)</h4>
<p><strong>è®¾è®¡ç›®æ ‡</strong>: ä¼˜ç§€çš„IDEæ”¯æŒ,æå‡å¼€å‘ä½“éªŒã€‚</p>
<p><strong>ä½“ç°</strong>:</p>
<ul>
<li>IntelliJ IDEAåŸç”Ÿæ”¯æŒ</li>
<li>æ™ºèƒ½ä»£ç è¡¥å…¨</li>
<li>å¼ºå¤§çš„é‡æ„èƒ½åŠ›</li>
<li>ç¼–è¯‘é€Ÿåº¦ä¼˜åŒ–(K2ç¼–è¯‘å™¨)</li>
</ul>
<p><strong>åŸå› </strong>: JetBrainsè‡ªå·±å¼€å‘Kotlin,å·¥å…·æ”¯æŒæ˜¯ä¸€ç­‰å…¬æ°‘</p>
<h3 data-id="heading-11">2.2 è®¾è®¡æƒè¡¡ä¸å–èˆ</h3>
<p>ä»»ä½•è¯­è¨€è®¾è®¡éƒ½æ˜¯æƒè¡¡çš„è‰ºæœ¯,Kotlinä¹Ÿä¸ä¾‹å¤–:</p>
<h4 data-id="heading-12">æƒè¡¡1:ç®€æ´ vs å¯è¯»æ€§</h4>
<p><strong>é—®é¢˜</strong>: è¿‡äºç®€æ´å¯èƒ½æŸå®³å¯è¯»æ€§</p>
<p><strong>Kotlinçš„é€‰æ‹©</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… ç®€æ´ä½†ä»æ¸…æ™°</span>
<span class="hljs-keyword">val</span> adults = users.filter { it.age &gt;= <span class="hljs-number">18</span> }

<span class="hljs-comment">// âŒ è¿‡åº¦ç®€æ´,ç‰ºç‰²å¯è¯»æ€§</span>
<span class="hljs-keyword">val</span> x = u.f { i.a &gt;= <span class="hljs-number">18</span> }.m { i.n }
</code></pre>
<p><strong>åŸåˆ™</strong>: ç®€æ´æ˜¯ä¸ºäº†æ¸…æ™°,ä¸æ˜¯ä¸ºäº†ç‚«æŠ€</p>
<h4 data-id="heading-13">æƒè¡¡2:å®‰å…¨ vs çµæ´»æ€§</h4>
<p><strong>é—®é¢˜</strong>: ä¸¥æ ¼çš„ç©ºå®‰å…¨å¯èƒ½å¸¦æ¥ç¹ççš„æ£€æŸ¥</p>
<p><strong>Kotlinçš„é€‰æ‹©</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æä¾›é€ƒç”Ÿèˆ±:éç©ºæ–­è¨€!!</span>
<span class="hljs-keyword">val</span> length = name!!.length  <span class="hljs-comment">// æ˜ç¡®è¡¨è¾¾"æˆ‘çŸ¥é“è¿™ä¸ä¸ºnull"</span>

<span class="hljs-comment">// ä½†ä¼šåœ¨è¿è¡Œæ—¶å´©æºƒ,è¿«ä½¿å¼€å‘è€…è°¨æ…ä½¿ç”¨</span>
</code></pre>
<p><strong>åŸåˆ™</strong>: é»˜è®¤å®‰å…¨,ä¿ç•™çµæ´»æ€§,ä½†è¦æ±‚æ˜ç¡®æ„å›¾</p>
<h4 data-id="heading-14">æƒè¡¡3:æ€§èƒ½ vs æŠ½è±¡</h4>
<p><strong>é—®é¢˜</strong>: é«˜é˜¶å‡½æ•°ã€Lambdaä¼šåˆ›å»ºå¯¹è±¡,å½±å“æ€§èƒ½</p>
<p><strong>Kotlinçš„é€‰æ‹©</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æä¾›å†…è”å‡½æ•°é¿å…æ€§èƒ½æŸå¤±</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">measure</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">T</span>)</span></span>: T {
    <span class="hljs-keyword">val</span> start = System.nanoTime()
    <span class="hljs-keyword">val</span> result = block()  <span class="hljs-comment">// å†…è”åæ— å¯¹è±¡åˆ›å»º</span>
    println(<span class="hljs-string">"Time: <span class="hljs-subst">${System.nanoTime() - start}</span>ns"</span>)
    <span class="hljs-keyword">return</span> result
}
</code></pre>
<p><strong>åŸåˆ™</strong>: é›¶å¼€é”€æŠ½è±¡(Zero-cost Abstractions)</p>
<h3 data-id="heading-15">2.3 Kotlinçš„"ä¸‰é‡å¢ƒç•Œ"</h3>
<p>å­¦ä¹ Kotlinå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå¢ƒç•Œ:</p>
<p><strong>ç¬¬ä¸€å¢ƒç•Œ:å·¥å…·äºº</strong> - æŠŠKotlinå½“å·¥å…·ç”¨</p>
<ul>
<li>ç‰¹å¾:èƒ½å†™Kotlinä»£ç ,ä½†æ€ç»´ä»æ˜¯Java</li>
<li>ä»£ç :å……æ»¡<code>?.let {}</code>ã€è¿‡åº¦ä½¿ç”¨<code>!!</code></li>
<li>è¯„ä»·:ä¼šç”¨,ä½†ä¸ä¼˜é›…</li>
</ul>
<p><strong>ç¬¬äºŒå¢ƒç•Œ:å®è·µè€…</strong> - ç†è§£Kotlinçš„è®¾è®¡æ„å›¾</p>
<ul>
<li>ç‰¹å¾:çŸ¥é“ä½•æ—¶ç”¨ä½•ç§ç‰¹æ€§,ä»£ç Kotlinish</li>
<li>ä»£ç :åˆç†ä½¿ç”¨æ‰©å±•å‡½æ•°ã€ä½œç”¨åŸŸå‡½æ•°ã€å§”æ‰˜</li>
<li>è¯„ä»·:ç”¨å¾—å¥½,å†™å¾—ä¼˜é›…</li>
</ul>
<p><strong>ç¬¬ä¸‰å¢ƒç•Œ:æ¶æ„å¸ˆ</strong> - å»ºç«‹ç³»ç»ŸåŒ–çš„è®¾è®¡æ€ç»´</p>
<ul>
<li>ç‰¹å¾:èƒ½è®¾è®¡Kotliné£æ ¼çš„API,ç¼–å†™DSL</li>
<li>ä»£ç :ç±»å‹å®‰å…¨ã€è¡¨è¾¾åŠ›å¼ºã€æ˜“äºæ‰©å±•</li>
<li>è¯„ä»·:ä¸ä»…ä¼šç”¨,è¿˜èƒ½åˆ›é€ </li>
</ul>
<p><strong>ç›®æ ‡</strong>: æœ¬ç³»åˆ—æ–‡ç« åŠ©ä½ ä»ç¬¬ä¸€å¢ƒç•Œè·¨è¶Šåˆ°ç¬¬äºŒå¢ƒç•Œ,å¹¶ä¸ºç¬¬ä¸‰å¢ƒç•Œæ‰“ä¸‹åŸºç¡€ã€‚</p>
<hr/>
<h2 data-id="heading-16">ä¸‰ã€çŸ¥è¯†åº”ç”¨:ä»ç‰¹æ€§åˆ°æ¨¡å¼</h2>
<h3 data-id="heading-17">3.1 å¸¸è§è®¾è®¡æ¨¡å¼çš„Kotlinå®ç°</h3>
<p>Kotlinçš„è¯­è¨€ç‰¹æ€§è®©æŸäº›è®¾è®¡æ¨¡å¼å˜å¾—ç®€å•ç”šè‡³æ¶ˆå¤±:</p>
<h4 data-id="heading-18">1. å•ä¾‹æ¨¡å¼ â†’ Objectå£°æ˜</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Javaéœ€è¦å¤æ‚çš„åŒé‡æ£€æŸ¥é”</span>
<span class="hljs-comment">// Kotlin: ä¸€è¡Œæå®š,çº¿ç¨‹å®‰å…¨</span>
<span class="hljs-keyword">object</span> DatabaseManager {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<h4 data-id="heading-19">2. å»ºé€ è€…æ¨¡å¼ â†’ DSL + Apply</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Javaéœ€è¦Builderç±»</span>
<span class="hljs-comment">// Kotlin: DSL + apply</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpRequest</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">val</span> url: String,
    <span class="hljs-keyword">val</span> method: String,
    <span class="hljs-keyword">val</span> headers: Map&lt;String, String&gt;
) {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> {
        <span class="hljs-keyword">var</span> url: String = <span class="hljs-string">""</span>
        <span class="hljs-keyword">var</span> method: String = <span class="hljs-string">"GET"</span>
        <span class="hljs-keyword">var</span> headers = mutableMapOf&lt;String, String&gt;()

        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span> = HttpRequest(url, method, headers)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buildRequest</span><span class="hljs-params">(<span class="hljs-keyword">init</span>: <span class="hljs-type">HttpRequest</span>.<span class="hljs-type">Builder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: HttpRequest {
    <span class="hljs-keyword">return</span> HttpRequest.Builder().apply(<span class="hljs-keyword">init</span>).build()
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">val</span> request = buildRequest {
    url = <span class="hljs-string">"https://api.example.com"</span>
    method = <span class="hljs-string">"POST"</span>
    headers[<span class="hljs-string">"Content-Type"</span>] = <span class="hljs-string">"application/json"</span>
}
</code></pre>
<h4 data-id="heading-20">3. ç­–ç•¥æ¨¡å¼ â†’ é«˜é˜¶å‡½æ•°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Javaéœ€è¦Strategyæ¥å£ + å¤šä¸ªå®ç°ç±»</span>
<span class="hljs-comment">// Kotlin: é«˜é˜¶å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processData</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Int</span>&gt;, strategy: (<span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span>)</span></span>: List&lt;<span class="hljs-built_in">Int</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span>.map(strategy)
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">val</span> doubled = processData(list) { it * <span class="hljs-number">2</span> }
<span class="hljs-keyword">val</span> squared = processData(list) { it * it }
</code></pre>
<h4 data-id="heading-21">4. è£…é¥°å™¨æ¨¡å¼ â†’ æ‰©å±•å‡½æ•°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Javaéœ€è¦è£…é¥°å™¨ç±»åŒ…è£…</span>
<span class="hljs-comment">// Kotlin: æ‰©å±•å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">toTitleCase</span><span class="hljs-params">()</span></span>: String {
    <span class="hljs-keyword">return</span> split(<span class="hljs-string">" "</span>).joinToString(<span class="hljs-string">" "</span>) { word -&gt;
        word.replaceFirstChar { it.uppercase() }
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">val</span> title = <span class="hljs-string">"hello world"</span>.toTitleCase()  <span class="hljs-comment">// "Hello World"</span>
</code></pre>
<h4 data-id="heading-22">5. è§‚å¯Ÿè€…æ¨¡å¼ â†’ Flow</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Javaéœ€è¦Observeræ¥å£ + Subjectç±»</span>
<span class="hljs-comment">// Kotlin: Flow</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataRepository</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _dataFlow = MutableStateFlow&lt;Data&gt;(Data.Empty)
    <span class="hljs-keyword">val</span> dataFlow: StateFlow&lt;Data&gt; = _dataFlow.asStateFlow()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateData</span><span class="hljs-params">(newData: <span class="hljs-type">Data</span>)</span></span> {
        _dataFlow.value = newData
    }
}

<span class="hljs-comment">// è§‚å¯Ÿ</span>
viewModelScope.launch {
    repository.dataFlow.collect { <span class="hljs-keyword">data</span> -&gt;
        updateUI(<span class="hljs-keyword">data</span>)
    }
}
</code></pre>
<h3 data-id="heading-23">3.2 æ¶æ„æ¨¡å¼çš„Kotlinå®ç°</h3>
<h4 data-id="heading-24">1. MVVMæ¶æ„çš„KotlinåŒ–</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ViewModel</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: UserRepository
) : ViewModel() {

    <span class="hljs-comment">// StateFlowæ›¿ä»£LiveData</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow&lt;UiState&gt;(UiState.Loading)
    <span class="hljs-keyword">val</span> uiState = _uiState.asStateFlow()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
        viewModelScope.launch {
            _uiState.value = UiState.Loading

            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> user = repository.getUser(userId)
                _uiState.value = UiState.Success(user)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _uiState.value = UiState.Error(e.message ?: <span class="hljs-string">"Unknown error"</span>)
            }
        }
    }
}

<span class="hljs-comment">// UIå±‚</span>
lifecycleScope.launch {
    repeatOnLifecycle(Lifecycle.State.STARTED) {
        viewModel.uiState.collect { state -&gt;
            <span class="hljs-keyword">when</span> (state) {
                <span class="hljs-keyword">is</span> UiState.Loading -&gt; showLoading()
                <span class="hljs-keyword">is</span> UiState.Success -&gt; showUser(state.user)
                <span class="hljs-keyword">is</span> UiState.Error -&gt; showError(state.message)
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-25">2. Repositoryæ¨¡å¼çš„ç¦»çº¿ä¼˜å…ˆç­–ç•¥</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> api: ApiService,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dao: UserDao
) {
    <span class="hljs-comment">// å•ä¸€æ•°æ®æº(Single Source of Truth)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Flow&lt;User&gt; = flow {
        <span class="hljs-comment">// 1. ç«‹å³å‘å°„ç¼“å­˜æ•°æ®</span>
        dao.getUserById(userId)?.let { emit(it) }

        <span class="hljs-comment">// 2. ä»ç½‘ç»œè·å–æœ€æ–°æ•°æ®</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> user = api.getUser(userId)
            dao.insertUser(user)
            <span class="hljs-comment">// æ•°æ®åº“æ›´æ–°åFlowè‡ªåŠ¨å‘å°„æ–°å€¼</span>
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            <span class="hljs-comment">// ç½‘ç»œå¤±è´¥,ä½¿ç”¨ç¼“å­˜</span>
        }
    }.flowOn(Dispatchers.IO)
}
</code></pre>
<h3 data-id="heading-26">3.3 å®æˆ˜ç»éªŒæ€»ç»“</h3>
<h4 data-id="heading-27">ç»éªŒ1:ä¼˜å…ˆä½¿ç”¨ä¸å¯å˜æ•°æ®</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ å¯å˜æ•°æ®å¯¼è‡´bug</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserManager</span> {
    <span class="hljs-keyword">var</span> users: MutableList&lt;User&gt; = mutableListOf()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">()</span></span>: List&lt;User&gt; {
        <span class="hljs-keyword">return</span> users  <span class="hljs-comment">// å±é™©!å¤–éƒ¨å¯ä»¥ä¿®æ”¹</span>
    }
}

<span class="hljs-comment">// âœ… ä¸å¯å˜æ•°æ®æ›´å®‰å…¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _users = mutableListOf&lt;User&gt;()
    <span class="hljs-keyword">val</span> users: List&lt;User&gt; <span class="hljs-keyword">get</span>() = _users.toList()  <span class="hljs-comment">// è¿”å›å‰¯æœ¬</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">addUser</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
        _users.add(user)
    }
}
</code></pre>
<h4 data-id="heading-28">ç»éªŒ2:åˆç†ä½¿ç”¨ä½œç”¨åŸŸå‡½æ•°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ è¿‡åº¦ä½¿ç”¨letå¯¼è‡´åµŒå¥—åœ°ç‹±</span>
user?.let {
    it.profile?.let {
        it.avatar?.let {
            loadImage(it.url)
        }
    }
}

<span class="hljs-comment">// âœ… ä½¿ç”¨å®‰å…¨è°ƒç”¨é“¾</span>
user?.profile?.avatar?.url?.let { loadImage(it) }

<span class="hljs-comment">// âœ… ä½¿ç”¨runç®€åŒ–</span>
user?.run {
    profile?.avatar?.url?.let(::loadImage)
}
</code></pre>
<h4 data-id="heading-29">ç»éªŒ3:ç”¨å¯†å°ç±»è¡¨ç¤ºçŠ¶æ€</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ ä½¿ç”¨å¤šä¸ªBooleanè¡¨ç¤ºçŠ¶æ€,å®¹æ˜“å‡ºé”™</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiState</span>(
    <span class="hljs-keyword">val</span> isLoading: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">val</span> isError: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: User? = <span class="hljs-literal">null</span>,
    <span class="hljs-keyword">val</span> errorMessage: String? = <span class="hljs-literal">null</span>
)
<span class="hljs-comment">// å¯èƒ½å‡ºç°éæ³•çŠ¶æ€:isLoading=trueåŒæ—¶isError=true</span>

<span class="hljs-comment">// âœ… ä½¿ç”¨å¯†å°ç±»,ç¼–è¯‘å™¨ä¿è¯çŠ¶æ€åˆæ³•</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiState</span> {
    <span class="hljs-keyword">object</span> Loading : UiState()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>(<span class="hljs-keyword">val</span> user: User) : UiState()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> message: String) : UiState()
}
</code></pre>
<hr/>
<h2 data-id="heading-30">å››ã€å­¦ä¹ è·¯å¾„:å¦‚ä½•æŒç»­ç²¾è¿›</h2>
<h3 data-id="heading-31">4.1 æŠ€èƒ½æˆé•¿è·¯çº¿å›¾</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dab3d1d6504409e9aaa789b2632b2e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770989000&amp;x-signature=2q66MiylC2BrJ40OguAXvOAqahE%3D" alt="18-03-skill-growth-path.png" loading="lazy"/></p>
<p><strong>åˆçº§ (0-3ä¸ªæœˆ)</strong></p>
<ul>
<li>âœ… æŒæ¡åŸºç¡€è¯­æ³•(å˜é‡ã€å‡½æ•°ã€ç±»ã€æ§åˆ¶æµ)</li>
<li>âœ… ç†è§£ç©ºå®‰å…¨æœºåˆ¶</li>
<li>âœ… å­¦ä¼šä½¿ç”¨é›†åˆæ“ä½œç¬¦</li>
<li>âœ… å®Œæˆå°å‹ç»ƒä¹ é¡¹ç›®</li>
</ul>
<p><strong>ä¸­çº§ (3-9ä¸ªæœˆ)</strong></p>
<ul>
<li>âœ… æ·±å…¥ç†è§£åç¨‹å’ŒFlow</li>
<li>âœ… æŒæ¡æ³›å‹å’Œå‹å˜</li>
<li>âœ… ç†Ÿç»ƒä½¿ç”¨å§”æ‰˜å’Œæ‰©å±•å‡½æ•°</li>
<li>âœ… å‚ä¸å®é™…é¡¹ç›®å¼€å‘</li>
</ul>
<p><strong>é«˜çº§ (9-18ä¸ªæœˆ)</strong></p>
<ul>
<li>âœ… è®¾è®¡ç±»å‹å®‰å…¨çš„DSL</li>
<li>âœ… ç¼–å†™ç¼–è¯‘å™¨æ’ä»¶</li>
<li>âœ… æ€§èƒ½åˆ†æä¸ä¼˜åŒ–</li>
<li>âœ… æ¶æ„è®¾è®¡èƒ½åŠ›</li>
</ul>
<p><strong>ä¸“å®¶ (18ä¸ªæœˆ+)</strong></p>
<ul>
<li>âœ… Kotlin Multiplatformå®è·µ</li>
<li>âœ… è´¡çŒ®å¼€æºé¡¹ç›®</li>
<li>âœ… ç¼–å†™æŠ€æœ¯åšå®¢åˆ†äº«ç»éªŒ</li>
<li>âœ… å»ºç«‹ä¸ªäººæŠ€æœ¯å½±å“åŠ›</li>
</ul>
<h3 data-id="heading-32">4.2 å®è·µé¡¹ç›®æ¨è</h3>
<h4 data-id="heading-33">1. å…¥é—¨é¡¹ç›®:å¾…åŠäº‹é¡¹åº”ç”¨</h4>
<p><strong>æŠ€æœ¯ç‚¹</strong>:</p>
<ul>
<li>Data Classå®šä¹‰æ•°æ®æ¨¡å‹</li>
<li>LiveData/StateFlowçŠ¶æ€ç®¡ç†</li>
<li>Roomæ•°æ®åº“CRUDæ“ä½œ</li>
<li>RecyclerViewåˆ—è¡¨å±•ç¤º</li>
</ul>
<p><strong>å­¦ä¹ ç›®æ ‡</strong>: æŒæ¡KotlinåŸºç¡€è¯­æ³•å’ŒAndroidåŸºæœ¬æ¶æ„</p>
<h4 data-id="heading-34">2. è¿›é˜¶é¡¹ç›®:æ–°é—»é˜…è¯»å™¨</h4>
<p><strong>æŠ€æœ¯ç‚¹</strong>:</p>
<ul>
<li>Retrofitç½‘ç»œè¯·æ±‚</li>
<li>åç¨‹å¼‚æ­¥å¤„ç†</li>
<li>Flowæ•°æ®æµ</li>
<li>ç¦»çº¿ä¼˜å…ˆç­–ç•¥(Repositoryæ¨¡å¼)</li>
<li>Paging3åˆ†é¡µåŠ è½½</li>
</ul>
<p><strong>å­¦ä¹ ç›®æ ‡</strong>: æŒæ¡åç¨‹å’Œç½‘ç»œç¼–ç¨‹æœ€ä½³å®è·µ</p>
<h4 data-id="heading-35">3. é«˜çº§é¡¹ç›®:IMå³æ—¶é€šè®¯åº”ç”¨</h4>
<p><strong>æŠ€æœ¯ç‚¹</strong>:</p>
<ul>
<li>WebSocketé•¿è¿æ¥</li>
<li>Channelæ¶ˆæ¯é˜Ÿåˆ—</li>
<li>SharedFlowäº‹ä»¶å¹¿æ’­</li>
<li>è‡ªå®šä¹‰åç¨‹Dispatcher</li>
<li>æ€§èƒ½ä¼˜åŒ–</li>
</ul>
<p><strong>å­¦ä¹ ç›®æ ‡</strong>: æ·±å…¥ç†è§£åç¨‹å’Œå¹¶å‘ç¼–ç¨‹</p>
<h4 data-id="heading-36">4. ä¸“å®¶é¡¹ç›®:è·¨å¹³å°SDKå¼€å‘</h4>
<p><strong>æŠ€æœ¯ç‚¹</strong>:</p>
<ul>
<li>Kotlin Multiplatform</li>
<li>expect/actualæœºåˆ¶</li>
<li>å¹³å°ç‰¹å®šå®ç°</li>
<li>Gradleæ’ä»¶å¼€å‘</li>
<li>APIè®¾è®¡</li>
</ul>
<p><strong>å­¦ä¹ ç›®æ ‡</strong>: æŒæ¡è·¨å¹³å°å¼€å‘å’ŒSDKè®¾è®¡</p>
<h3 data-id="heading-37">4.3 å­¦ä¹ èµ„æºæ¸…å•</h3>
<h4 data-id="heading-38">å®˜æ–¹èµ„æº</h4>
<p><strong>æ–‡æ¡£</strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fdocs%2Fhome.html" target="_blank" title="https://kotlinlang.org/docs/home.html" ref="nofollow noopener noreferrer">Kotlinå®˜æ–¹æ–‡æ¡£</a> - æƒå¨å‚è€ƒ</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.kotlinlang.org%2Fkoans" target="_blank" title="https://play.kotlinlang.org/koans" ref="nofollow noopener noreferrer">Kotlin Koans</a> - äº¤äº’å¼ç»ƒä¹ </li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.kotlinlang.org%2FbyExample" target="_blank" title="https://play.kotlinlang.org/byExample" ref="nofollow noopener noreferrer">Kotlin by Example</a> - ç¤ºä¾‹å­¦ä¹ </li>
</ul>
<h4 data-id="heading-39">ä¹¦ç±æ¨è</h4>
<p><strong>å…¥é—¨</strong>:</p>
<ul>
<li>ã€ŠKotlin in Actionã€‹ - Kotlinè®¾è®¡è€…Dmitry Jemerovç¼–å†™</li>
<li>ã€ŠAtomic Kotlinã€‹ - Bruce Eckelçš„ç°ä»£Kotlinæ•™ç¨‹</li>
</ul>
<p><strong>è¿›é˜¶</strong>:</p>
<ul>
<li>ã€ŠKotlin Coroutines by Tutorialsã€‹ - åç¨‹æ·±åº¦æŒ‡å—</li>
<li>ã€ŠEffective Kotlinã€‹ - Marcin MoskaÅ‚açš„æœ€ä½³å®è·µ</li>
</ul>
<p><strong>é«˜çº§</strong>:</p>
<ul>
<li>ã€ŠKotlin Programming: The Big Nerd Ranch Guideã€‹ - ç»¼åˆæ€§è¿›é˜¶æŒ‡å—</li>
<li>ã€ŠFunctional Kotlinã€‹ - å‡½æ•°å¼ç¼–ç¨‹å®è·µ</li>
</ul>
<h4 data-id="heading-40">ç¤¾åŒºèµ„æº</h4>
<p><strong>åšå®¢</strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.jetbrains.com%2Fkotlin%2F" target="_blank" title="https://blog.jetbrains.com/kotlin/" ref="nofollow noopener noreferrer">Kotlinå®˜æ–¹åšå®¢</a> - æœ€æ–°åŠ¨æ€</li>
</ul>
<p><strong>ç¤¾åŒº</strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.slack.com%2F" target="_blank" title="https://kotlinlang.slack.com/" ref="nofollow noopener noreferrer">Kotlin Slack</a> - å®˜æ–¹Slacké¢‘é“</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kotlincn.net%2F" target="_blank" title="https://www.kotlincn.net/" ref="nofollow noopener noreferrer">Kotlinä¸­æ–‡ç¤¾åŒº</a> - ä¸­æ–‡èµ„æº</li>
</ul>
<h4 data-id="heading-41">å¼€æºé¡¹ç›®</h4>
<p><strong>å­¦ä¹ æºç </strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FKotlin%2Fkotlinx.coroutines" target="_blank" title="https://github.com/Kotlin/kotlinx.coroutines" ref="nofollow noopener noreferrer">kotlinx.coroutines</a> - åç¨‹åº“æºç </li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fktorio%2Fktor" target="_blank" title="https://github.com/ktorio/ktor" ref="nofollow noopener noreferrer">Ktor</a> - Kotlin Webæ¡†æ¶</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJetBrains%2FExposed" target="_blank" title="https://github.com/JetBrains/Exposed" ref="nofollow noopener noreferrer">Exposed</a> - Kotlin ORMæ¡†æ¶</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJetBrains%2Fcompose-multiplatform" target="_blank" title="https://github.com/JetBrains/compose-multiplatform" ref="nofollow noopener noreferrer">Compose Multiplatform</a> - è·¨å¹³å°UI</li>
</ul>
<p><strong>å‚ä¸è´¡çŒ®</strong>:
ä»å°PRå¼€å§‹(æ–‡æ¡£ä¿®æ­£ã€æµ‹è¯•è¡¥å……),é€æ­¥å‚ä¸Featureå¼€å‘</p>
<hr/>
<h2 data-id="heading-42">äº”ã€æœªæ¥å±•æœ›:Kotlinçš„å‘å±•æ–¹å‘</h2>
<h3 data-id="heading-43">5.1 Kotlin 2.0æ—¶ä»£</h3>
<p><strong>K2ç¼–è¯‘å™¨</strong>:</p>
<ul>
<li>ç¼–è¯‘é€Ÿåº¦æå‡2å€</li>
<li>æ›´å¥½çš„IDEæ€§èƒ½</li>
<li>æ–°çš„è¯­è¨€ç‰¹æ€§æ”¯æŒ</li>
</ul>
<p><strong>è¯­è¨€ç‰¹æ€§æ¼”è¿›</strong>:</p>
<ul>
<li>Context Receivers(ä¸Šä¸‹æ–‡æ¥æ”¶è€…)</li>
<li>Value Classesæ”¹è¿›</li>
<li>æ›´å¼ºå¤§çš„æ³›å‹ç³»ç»Ÿ</li>
</ul>
<h3 data-id="heading-44">5.2 Kotlin Multiplatformçš„æˆç†Ÿ</h3>
<p><strong>åº”ç”¨åœºæ™¯æ‰©å±•</strong>:</p>
<ul>
<li>ç§»åŠ¨ç«¯:iOS + Androidä»£ç å…±äº«</li>
<li>Webç«¯:Kotlin/JSã€Kotlin/Wasm</li>
<li>åç«¯:KtoræœåŠ¡ç«¯æ¡†æ¶</li>
<li>æ¡Œé¢ç«¯:Compose Desktop</li>
</ul>
<p><strong>ç”Ÿæ€å®Œå–„</strong>:</p>
<ul>
<li>æ›´å¤šKMPåº“æ”¯æŒ</li>
<li>æ›´å¥½çš„å·¥å…·é“¾</li>
<li>ä¼ä¸šçº§é‡‡ç”¨æ¡ˆä¾‹å¢å¤š</li>
</ul>
<h3 data-id="heading-45">5.3 Composeçš„è·¨å¹³å°é‡å¿ƒ</h3>
<p><strong>Compose Multiplatform</strong>:</p>
<ul>
<li>Androidã€iOSã€Desktopã€Webç»Ÿä¸€UIæ¡†æ¶</li>
<li>å£°æ˜å¼UIç¼–ç¨‹èŒƒå¼</li>
<li>Kotlin DSLæ„å»ºUI</li>
</ul>
<p><strong>æœªæ¥è¶‹åŠ¿</strong>: "ä¸€æ¬¡ç¼–å†™,åˆ°å¤„è¿è¡Œ"çš„ç°ä»£å®ç°</p>
<h3 data-id="heading-46">5.4 Kotlinåœ¨æœåŠ¡ç«¯çš„æœºé‡</h3>
<p><strong>Spring Boot + Kotlin</strong>:</p>
<ul>
<li>æ›´ç®€æ´çš„é…ç½®</li>
<li>åç¨‹æ”¯æŒ</li>
<li>DSLè·¯ç”±å®šä¹‰</li>
</ul>
<p><strong>Ktoræ¡†æ¶</strong>:</p>
<ul>
<li>çº¯Kotlinç¼–å†™</li>
<li>å¼‚æ­¥éé˜»å¡</li>
<li>è½»é‡çº§é«˜æ€§èƒ½</li>
</ul>
<hr/>
<h2 data-id="heading-47">å…­ã€ç³»åˆ—ç»“è¯­:Kotlinä¹‹è·¯,æ°¸æ— æ­¢å¢ƒ</h2>
<h3 data-id="heading-48">6.1 ç³»åˆ—å›é¡¾</h3>
<p>ç»è¿‡18ç¯‡æ–‡ç« ã€è¶…è¿‡17ä¸‡å­—çš„æ·±åº¦è®²è§£,æˆ‘ä»¬ä¸€èµ·å®Œæˆäº†ä»Kotlinå…¥é—¨åˆ°ç²¾é€šçš„å®Œæ•´æ—…ç¨‹ã€‚</p>
<p><strong>è‡´Kotlinåˆå­¦è€…</strong>:</p>
<p>ä¸è¦è¢«Kotlinä¸°å¯Œçš„ç‰¹æ€§å“å€’ã€‚å­¦ä¹ Kotlinæ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹,ä»åŸºç¡€è¯­æ³•å¼€å§‹,ä¸€æ­¥æ­¥æ·±å…¥ã€‚è®°ä½:</p>
<ul>
<li>å…ˆä¼šç”¨,å†ç†è§£,æœ€ååˆ›é€ </li>
<li>å¤šåŠ¨æ‰‹,å°‘ç„¦è™‘</li>
<li>é”™è¯¯æ˜¯æœ€å¥½çš„è€å¸ˆ</li>
</ul>
<p><strong>è‡´æœ‰ç»éªŒçš„Javaå¼€å‘è€…</strong>:</p>
<p>Kotlinä¸ä»…ä»…æ˜¯"æ›´å¥½çš„Java",è€Œæ˜¯ä¸€ç§æ€ç»´æ–¹å¼çš„è½¬å˜ã€‚ä¸è¦æŠŠJavaçš„æ€ç»´å¼ºåŠ åˆ°Kotlinä¸Š:</p>
<ul>
<li>å¿˜æ‰getters/setters,æ‹¥æŠ±å±æ€§</li>
<li>å¿˜æ‰nullæ£€æŸ¥,æ‹¥æŠ±ç©ºå®‰å…¨</li>
<li>å¿˜æ‰å›è°ƒåœ°ç‹±,æ‹¥æŠ±åç¨‹</li>
</ul>
<p><strong>è‡´æƒ³æˆä¸ºKotlinä¸“å®¶çš„å¼€å‘è€…</strong>:</p>
<p>ç²¾é€šKotlinä¸æ˜¯ç»ˆç‚¹,è€Œæ˜¯èµ·ç‚¹ã€‚çœŸæ­£çš„ä¸“å®¶ä¸ä»…ä¼šç”¨Kotlin,æ›´èƒ½:</p>
<ul>
<li>è®¾è®¡ä¼˜é›…çš„API</li>
<li>ç¼–å†™å¯ç»´æŠ¤çš„ä»£ç </li>
<li>åˆ†äº«çŸ¥è¯†å¸®åŠ©ä»–äºº</li>
<li>æ¨åŠ¨æŠ€æœ¯ç¤¾åŒºå‘å±•</li>
</ul>
<p><strong>æœ¬ç³»åˆ—å®Œç»“ã€‚æ„Ÿè°¢é™ªä¼´!</strong> ğŸ‰</p>
<p><em>ä¹Ÿæ¬¢è¿è®¿é—®æˆ‘çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">ä¸ªäººä¸»é¡µ</a>å‘ç°æ›´å¤šå®è—èµ„æº</em></p>
<p><strong>ç³»åˆ—æ–‡ç« ç´¢å¼•</strong>:</p>
<ul>
<li><a href="https://juejin.cn/post/7593541291011883035" target="_blank" title="https://juejin.cn/post/7593541291011883035">01. Kotlinå¿«é€Ÿå…¥é—¨</a></li>
<li><a href="https://juejin.cn/post/7593713738856677414" target="_blank" title="https://juejin.cn/post/7593713738856677414">02. å˜é‡ä¸æ•°æ®ç±»å‹</a></li>
<li><a href="https://juejin.cn/post/7594242987598528539" target="_blank" title="https://juejin.cn/post/7594242987598528539">03. æ§åˆ¶æµä¸å‡½æ•°</a></li>
<li><a href="https://juejin.cn/post/7594669638559727642" target="_blank" title="https://juejin.cn/post/7594669638559727642">04. ç±»ä¸å¯¹è±¡åŸºç¡€</a></li>
<li><a href="https://juejin.cn/post/7595041883145142318" target="_blank" title="https://juejin.cn/post/7595041883145142318">05. é›†åˆæ¡†æ¶</a></li>
<li><a href="https://juejin.cn/post/7595410455222943754" target="_blank" title="https://juejin.cn/post/7595410455222943754">06. é¢å‘å¯¹è±¡è¿›é˜¶</a></li>
<li><a href="https://juejin.cn/post/7595841630675763251" target="_blank" title="https://juejin.cn/post/7595841630675763251">07. ç±»å‹ç³»ç»Ÿæ·±åº¦è§£æ</a></li>
<li><a href="https://juejin.cn/post/7595808703074893850" target="_blank" title="https://juejin.cn/post/7595808703074893850">08. æ³›å‹è¿›é˜¶</a></li>
<li><a href="https://juejin.cn/post/7596906473306275890" target="_blank" title="https://juejin.cn/post/7596906473306275890">09. å§”æ‰˜æœºåˆ¶</a></li>
<li><a href="https://juejin.cn/post/7597266141912465454" target="_blank" title="https://juejin.cn/post/7597266141912465454">10. åç¨‹åŸç†ä¸å®æˆ˜(ä¸Š)</a></li>
<li><a href="https://juejin.cn/post/7597623395907829806" target="_blank" title="https://juejin.cn/post/7597623395907829806">11. åç¨‹åŸç†ä¸å®æˆ˜(ä¸‹)</a></li>
<li><a href="https://juejin.cn/post/7598057199962210355" target="_blank" title="https://juejin.cn/post/7598057199962210355">12. å‡½æ•°å¼ç¼–ç¨‹</a></li>
<li><a href="https://juejin.cn/post/7598374376094302235" target="_blank" title="https://juejin.cn/post/7598374376094302235">13. DSLè®¾è®¡</a></li>
<li><a href="https://juejin.cn/post/7598532592455942171" target="_blank" title="https://juejin.cn/post/7598532592455942171">14. ç¼–è¯‘å™¨æ’ä»¶</a></li>
<li><a href="https://juejin.cn/post/7598801700050812966" target="_blank" title="https://juejin.cn/post/7598801700050812966">15. Kotlinå¤šå¹³å°å¼€å‘</a></li>
<li><a href="https://juejin.cn/post/7599920572839919625" target="_blank" title="https://juejin.cn/post/7599920572839919625">16. æ€§èƒ½ä¼˜åŒ–</a></li>
<li><a href="https://juejin.cn/post/7601159804491022355" target="_blank" title="https://juejin.cn/post/7601159804491022355">17. Androidåç¨‹æœ€ä½³å®è·µ</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlinä¸­çš„JvmMultifileClassæ³¨è§£]]></title>    <link>https://juejin.cn/post/7603444191448727586</link>    <guid>https://juejin.cn/post/7603444191448727586</guid>    <pubDate>2026-02-06T12:13:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603444191448727586" data-draft-id="7603383311531311119" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlinä¸­çš„JvmMultifileClassæ³¨è§£"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-02-06T12:13:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlinä¸­çš„JvmMultifileClassæ³¨è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:13:13.000Z" title="Fri Feb 06 2026 12:13:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>@JvmMultifileClass æ˜¯ Kotlin ä¸­çš„ä¸€ä¸ªæ–‡ä»¶çº§æ³¨è§£ï¼ˆFile-level Annotationï¼‰ï¼Œé€šå¸¸ä¸ @file:JvmName é…åˆä½¿ç”¨ï¼Œå°†å¤šä¸ª Kotlin æ–‡ä»¶çš„é¡¶å±‚å£°æ˜åˆå¹¶åˆ°åŒä¸€ä¸ª JVM ç±»ä¸­ã€‚</p>
<p>å…¶æ ¸å¿ƒä½œç”¨æ˜¯è§£å†³â€œåŒä¸€åŠŸèƒ½æ¨¡å—çš„ä»£ç åˆ†æ•£åœ¨å¤šä¸ª Kotlin æ–‡ä»¶ä¸­æ—¶ï¼Œå¦‚ä½•åœ¨ Java ä¸­ä»¥ç»Ÿä¸€çš„ç±»åè°ƒç”¨â€çš„é—®é¢˜ï¼Œæå‡è·¨è¯­è¨€è°ƒç”¨çš„ä¾¿åˆ©æ€§ã€‚</p>
<h2 data-id="heading-0">èƒŒæ™¯ä¸é—®é¢˜åœºæ™¯</h2>
<p>Kotlin çš„é¡¶å±‚å‡½æ•°ï¼ˆä¸åœ¨ç±»æˆ–å¯¹è±¡ä¸­å®šä¹‰çš„å‡½æ•°ï¼‰é»˜è®¤ä¼šè¢«ç¼–è¯‘åˆ°ä¸€ä¸ªä¸æ–‡ä»¶åå…³è”çš„ JVM ç±»ä¸­ï¼ˆå‘½åè§„åˆ™ï¼šæ–‡ä»¶å + "Kt"ï¼Œä¾‹å¦‚ StringUtils.kt ç”Ÿæˆ StringUtilsKt ç±»ï¼‰ã€‚</p>
<p>è‹¥ä¸€ä¸ªåŠŸèƒ½æ¨¡å—çš„å·¥å…·æ–¹æ³•åˆ†æ•£åœ¨å¤šä¸ª Kotlin æ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ StringUtils.ktã€NumberUtils.ktï¼‰ï¼Œæ¯ä¸ªæ–‡ä»¶ä¼šç”Ÿæˆç‹¬ç«‹çš„ JVM ç±»ï¼ˆå¦‚ StringUtilsKtã€NumberUtilsKtï¼‰ï¼Œå¯¼è‡´ Java è°ƒç”¨æ—¶éœ€è¦åˆ†åˆ«å¼•ç”¨ä¸åŒçš„ç±»ï¼Œä¸å¤Ÿç›´è§‚ã€‚</p>
<p>ç¤ºä¾‹é—®é¢˜ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File1: StringUtils.kt</span>
<span class="hljs-keyword">package</span> com.example.utils
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.isEmpty()

<span class="hljs-comment">// File2: NumberUtils.kt  </span>
<span class="hljs-keyword">package</span> com.example.utils
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isPositive</span><span class="hljs-params">(num: <span class="hljs-type">Int</span>)</span></span> = num &gt; <span class="hljs-number">0</span>

<span class="hljs-comment">// Java è°ƒç”¨æ—¶éœ€åˆ†åˆ«å¼•ç”¨ä¸¤ä¸ªç±»ï¼š</span>
<span class="hljs-comment">// boolean empty = StringUtilsKt.isEmpty("test");</span>
<span class="hljs-comment">// boolean positive = NumberUtilsKt.isPositive(10);</span>
</code></pre>
<h2 data-id="heading-1">@JvmMultifileClass çš„è§£å†³æ–¹æ¡ˆ</h2>
<p>é€šè¿‡ @file:JvmName ä¸ºå¤šä¸ªæ–‡ä»¶æŒ‡å®šç›¸åŒçš„ JVM ç±»åï¼Œå¹¶æ·»åŠ  @file:JvmMultifileClass æ³¨è§£ï¼ŒKotlin ç¼–è¯‘å™¨ä¼šå°†è¿™äº›æ–‡ä»¶çš„é¡¶å±‚å£°æ˜åˆå¹¶åˆ°åŒä¸€ä¸ª JVM ç±»ä¸­ã€‚è¿™æ ·ï¼ŒJava è°ƒç”¨æ—¶åªéœ€é€šè¿‡ä¸€ä¸ªç±»åå³å¯è®¿é—®æ‰€æœ‰åˆ†æ•£çš„é¡¶å±‚å‡½æ•°ã€‚</p>
<p>ä½¿ç”¨æ­¥éª¤ä¸ç¤ºä¾‹</p>
<ol>
<li>ä¸ºç›®æ ‡æ–‡ä»¶æŒ‡å®šç›¸åŒçš„ @file:JvmName</li>
</ol>
<p>åœ¨æ‰€æœ‰éœ€è¦åˆå¹¶çš„ Kotlin æ–‡ä»¶é¡¶éƒ¨ï¼Œä½¿ç”¨ @file:JvmName æ³¨è§£æŒ‡å®šç›¸åŒçš„ JVM ç±»åï¼ˆéœ€åŒ…å«åŒ…åï¼‰ã€‚</p>
<ol start="2">
<li>æ·»åŠ  @file:JvmMultifileClass æ³¨è§£</li>
</ol>
<p>åœ¨æ¯ä¸ªæ–‡ä»¶çš„ @file:JvmName ä¸‹æ–¹æ·»åŠ  @file:JvmMultifileClass æ³¨è§£ï¼Œå‘ŠçŸ¥ç¼–è¯‘å™¨åˆå¹¶è¿™äº›æ–‡ä»¶çš„é¡¶å±‚å£°æ˜ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File1: StringUtils.kt</span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"CommonUtils"</span>)       <span class="hljs-comment">// æŒ‡å®š JVM ç±»åä¸º com.example.utils.CommonUtils</span>
<span class="hljs-meta">@file:JvmMultifileClass</span>           <span class="hljs-comment">// æ ‡è®°ä¸ºéœ€è¦åˆå¹¶çš„æ–‡ä»¶</span>
<span class="hljs-keyword">package</span> com.example.utils          <span class="hljs-comment">// åŒ…åéœ€ä¸€è‡´</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.isEmpty()

<span class="hljs-comment">// File2: NumberUtils.kt  </span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"CommonUtils"</span>)       <span class="hljs-comment">// ä¸ File1 ç›¸åŒçš„ JVM ç±»å</span>
<span class="hljs-meta">@file:JvmMultifileClass</span>           <span class="hljs-comment">// åŒæ ·æ ‡è®°ä¸ºéœ€è¦åˆå¹¶çš„æ–‡ä»¶</span>
<span class="hljs-keyword">package</span> com.example.utils          <span class="hljs-comment">// åŒ…åå¿…é¡»ä¸€è‡´</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isPositive</span><span class="hljs-params">(num: <span class="hljs-type">Int</span>)</span></span> = num &gt; <span class="hljs-number">0</span>
</code></pre>
<ol start="3">
<li>Java è°ƒç”¨æ•ˆæœ</li>
</ol>
<p>ç¼–è¯‘åï¼Œä¸¤ä¸ªæ–‡ä»¶çš„é¡¶å±‚å‡½æ•°ä¼šè¢«åˆå¹¶åˆ° com.example.utils.CommonUtils ç±»ä¸­ã€‚Java è°ƒç”¨æ—¶åªéœ€é€šè¿‡è¯¥ç»Ÿä¸€ç±»åè®¿é—®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java è°ƒç”¨ï¼ˆæ— éœ€åŒºåˆ† StringUtilsKt æˆ– NumberUtilsKtï¼‰</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">empty</span> <span class="hljs-operator">=</span> CommonUtils.isEmpty(<span class="hljs-string">"test"</span>);      <span class="hljs-comment">// æ¥è‡ª StringUtils.kt</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">positive</span> <span class="hljs-operator">=</span> CommonUtils.isPositive(<span class="hljs-number">10</span>);    <span class="hljs-comment">// æ¥è‡ª NumberUtils.kt</span>
</code></pre>
<h2 data-id="heading-2">å…³é”®æ³¨æ„äº‹é¡¹</h2>
<ol>
<li>
<p>åŒ…åå¿…é¡»ä¸€è‡´ï¼šæ‰€æœ‰å‚ä¸åˆå¹¶çš„ Kotlin æ–‡ä»¶å¿…é¡»å±äºåŒä¸€ä¸ªåŒ…ï¼ˆå³ package è¯­å¥ç›¸åŒï¼‰ï¼Œå¦åˆ™æ— æ³•åˆå¹¶ã€‚</p>
</li>
<li>
<p>@file:JvmName çš„åç§°éœ€å…¨å±€å”¯ä¸€ï¼šæŒ‡å®šçš„ JVM ç±»åï¼ˆå¦‚ CommonUtilsï¼‰ä¸èƒ½ä¸åŒä¸€æ¨¡å—ä¸­å…¶ä»–ç±»çš„åç§°å†²çªï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚</p>
</li>
<li>
<p>ä»…åˆå¹¶é¡¶å±‚å£°æ˜ï¼š@JvmMultifileClass ä»…å¯¹é¡¶å±‚å‡½æ•°ã€é¡¶å±‚å±æ€§ç”Ÿæ•ˆï¼Œç±»ã€å¯¹è±¡ã€ä¼´ç”Ÿå¯¹è±¡ç­‰å£°æ˜ä¸ä¼šè¢«åˆå¹¶ã€‚</p>
</li>
<li>
<p>æ³¨è§£é¡ºåºè¦æ±‚ï¼š@file:JvmName å¿…é¡»ä½äº @file:JvmMultifileClass ä¹‹å‰ï¼Œä¸”ä¸¤è€…å‡éœ€æ”¾åœ¨æ–‡ä»¶é¡¶éƒ¨ï¼ˆpackage è¯­å¥ä¹‹å‰ï¼‰ã€‚</p>
</li>
<li>
<p>é¿å…è¿‡åº¦åˆå¹¶ï¼šåˆå¹¶çš„æ–‡ä»¶åº”å…·æœ‰é€»è¾‘å…³è”æ€§ï¼ˆå¦‚åŒä¸€åŠŸèƒ½æ¨¡å—çš„å·¥å…·ç±»ï¼‰ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ JVM ç±»è¿‡äºåºå¤§ï¼Œå½±å“å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚</p>
</li>
</ol>
<h2 data-id="heading-3">å…¸å‹åº”ç”¨åœºæ™¯</h2>
<p>â€¢ å·¥å…·ç±»æ‹†åˆ†ï¼šå°†ä¸€ä¸ªå¤§å‹å·¥å…·ç±»ï¼ˆå¦‚ StringUtilsã€NumberUtilsï¼‰æ‹†åˆ†ä¸ºå¤šä¸ª Kotlin æ–‡ä»¶ï¼Œä½†é€šè¿‡ @JvmMultifileClass åˆå¹¶ä¸ºåŒä¸€ä¸ª JVM ç±»ï¼Œæ–¹ä¾¿ Java è°ƒç”¨ã€‚</p>
<p>â€¢ æ¨¡å—åŒ–å¼€å‘ï¼šå›¢é˜Ÿå¼€å‘ä¸­ï¼Œä¸åŒå¼€å‘è€…è´Ÿè´£åŒä¸€åŠŸèƒ½æ¨¡å—çš„ä¸åŒéƒ¨åˆ†ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚çš„å·¥å…·å‡½æ•°ã€æ•°æ®æ ¡éªŒçš„å·¥å…·å‡½æ•°ï¼‰ï¼Œé€šè¿‡åˆå¹¶æ³¨è§£ä¿æŒå¯¹å¤–æ¥å£çš„ç»Ÿä¸€ã€‚</p>
<h2 data-id="heading-4">æ€»ç»“</h2>
<p>@JvmMultifileClass æ˜¯ Kotlin ä¸ºä¼˜åŒ– JVM å¹³å°äº’æ“ä½œæ€§è®¾è®¡çš„æ³¨è§£ï¼Œé€šè¿‡ä¸ @file:JvmName é…åˆï¼Œå°†å¤šä¸ªæ–‡ä»¶çš„é¡¶å±‚å£°æ˜åˆå¹¶åˆ°åŒä¸€ä¸ª JVM ç±»ä¸­ï¼Œè§£å†³äº†â€œåˆ†æ•£ä»£ç çš„ç»Ÿä¸€è°ƒç”¨â€é—®é¢˜ã€‚åˆç†ä½¿ç”¨å¯æå‡è·¨è¯­è¨€ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼Œå°¤å…¶é€‚ç”¨äºå·¥å…·ç±»æˆ–æ¨¡å—åŒ–å¼€å‘çš„åœºæ™¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ°å¹³çº¿å¾ç¨‹ 6 å·¥å…·é“¾å…¥é—¨æ•™ç¨‹ | å¾ç¨‹ 6B è®¡ç®—å¹³å°éƒ¨ç½²æŒ‡å—]]></title>    <link>https://juejin.cn/post/7603359026711838730</link>    <guid>https://juejin.cn/post/7603359026711838730</guid>    <pubDate>2026-02-06T12:14:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603359026711838730" data-draft-id="7603584155784331314" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ°å¹³çº¿å¾ç¨‹ 6 å·¥å…·é“¾å…¥é—¨æ•™ç¨‹ | å¾ç¨‹ 6B è®¡ç®—å¹³å°éƒ¨ç½²æŒ‡å—"/> <meta itemprop="keywords" content="è‡ªåŠ¨é©¾é©¶,ç®—æ³•"/> <meta itemprop="datePublished" content="2026-02-06T12:14:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åœ°å¹³çº¿å¼€å‘è€…"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032132567"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ°å¹³çº¿å¾ç¨‹ 6 å·¥å…·é“¾å…¥é—¨æ•™ç¨‹ | å¾ç¨‹ 6B è®¡ç®—å¹³å°éƒ¨ç½²æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032132567/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åœ°å¹³çº¿å¼€å‘è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:14:55.000Z" title="Fri Feb 06 2026 12:14:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»26åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.å‰è¨€</h2>
<p>æœ¬æ–‡æ—¨åœ¨æä¾› å¾ç¨‹ 6B è®¡ç®—å¹³å°çš„éƒ¨ç½²æŒ‡å—ï¼Œå°†ä¼šä»ç¡¬ä»¶ã€è½¯ä»¶ä¸¤éƒ¨åˆ†è¿›è¡Œä»‹ç»ï¼Œæœ¬æ–‡æ•´ç†äº†æˆ‘ä»¬æ¨èçš„ä½¿ç”¨æµç¨‹ï¼Œå’Œå¤§å®¶å¯èƒ½ä¼šç”¨åˆ°çš„ä¸€äº›å·¥å…·ç‰¹æ€§ï¼Œä»¥ä¾¿äºæ‚¨æ›´å¥½åœ°ç†è§£å·¥å…·é“¾ã€‚æŸä¸ªå·¥å…·å…·ä½“è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜ï¼Œè¿˜è¯·å‚è€ƒç”¨æˆ·æ‰‹å†Œã€‚</p>
<h2 data-id="heading-1">2.å¾ç¨‹ 6B ç¡¬ä»¶é…ç½®</h2>
<p><img src="http://openwrite.cn/uploads/19742/59443/6e793ae7-b061-4833-8cbd-7baade202e31.png" alt="image.png" loading="lazy"/></p>
<p><img src="http://openwrite.cn/uploads/19742/59443/e3db4baa-bba9-45b6-9dea-96e5bfb80ec3.png" alt="image.png" loading="lazy"/></p>
<p>BPU å†…éƒ¨å™¨ä»¶ï¼š</p>
<p><strong>TAE</strong>ï¼šBPU å†…éƒ¨çš„å¼ é‡åŠ é€Ÿå¼•æ“ï¼Œä¸»è¦ç”¨äº Convã€MatMulã€Linear ç­‰ Gemm ç±»ç®—å­åŠ é€Ÿï¼Œ<strong>å¾ç¨‹ 6B æ–°å¢</strong>â€‹<strong>æµ®ç‚¹</strong>â€‹<strong>è¾“å‡ºæ”¯æŒï¼ˆæ¨¡å‹ä¸­é—´å±‚æ”¯æŒ â€‹</strong>â€‹<strong>fp16</strong>â€‹<strong>â€‹ è¾“å‡ºï¼Œæ¨¡å‹</strong>â€‹<strong>è¾“å‡ºå±‚</strong>â€‹<strong>æ”¯æŒ fp32 è¾“å‡ºï¼‰</strong></p>
<p><strong>AAE</strong>ï¼šPoolingã€Resizerã€Warping ç­‰åä¸“ç”¨å•å…ƒçš„é›†åˆï¼Œå…¶ä¸­ Warping å¯ç”¨äºåŠ é€Ÿ Gridsample ç­‰ç®—å­</p>
<p><strong>DTE</strong>ï¼šBPU å†…éƒ¨çš„æ•°æ®æ’å¸ƒå˜æ¢å¼•æ“ï¼Œæ”¯æŒå„ç§ç»´åº¦çš„é«˜æ•ˆå˜æ¢</p>
<p><strong>VAE</strong>ï¼šBPU å†…éƒ¨çš„ SIMD å‘é‡åŠ é€Ÿå¼•æ“ï¼Œå¯ç”¨äºåŠ é€Ÿ Addã€Mulã€æŸ¥è¡¨ç­‰ Vector è®¡ç®—ï¼Œ<strong>å¾ç¨‹ 6B æ–°å¢æµ®ç‚¹æ”¯æŒ</strong></p>
<p><strong>VPU</strong>ï¼šBPU å†…éƒ¨çš„ SIMT å‘é‡åŠ é€Ÿå•å…ƒï¼Œå¾ç¨‹ 6EM å¯ç”¨äºå®ç° Quantizeã€Dequantize ç­‰ç®—å­ï¼Œ<strong>å¾ç¨‹ 6B æ²¡æœ‰è¯¥ç¡¬ä»¶</strong></p>
<p><strong>SPU</strong>ï¼šBPU å†…éƒ¨çš„ RISC-V æ ‡é‡åŠ é€Ÿå•å…ƒï¼Œå¾ç¨‹ 6EM å¯ç”¨äºå®ç° TopK ç­‰ç®—å­ï¼Œ<strong>å¾ç¨‹ 6B æ²¡æœ‰è¯¥ç¡¬ä»¶ï¼Œä»…æœ‰ APM</strong></p>
<p><strong>APM</strong>ï¼šBPU å†…éƒ¨å¦ä¸€å— RISC-V æ ‡é‡åŠ é€Ÿå•å…ƒï¼Œä¸»è¦ç”¨äº BPU ä»»åŠ¡è°ƒåº¦ç­‰åŠŸèƒ½</p>
<h2 data-id="heading-2">3.å¾ç¨‹ 6 å·¥å…·é“¾ç®€ä»‹</h2>
<h3 data-id="heading-3">3.1 æ¨¡å—æ¶æ„å›¾</h3>
<p><img src="http://openwrite.cn/uploads/19742/59443/84d44aa3-9ca6-4d7b-b21e-73eed5341ee4.png" alt="image.png" loading="lazy"/></p>
<p><strong>PTQ</strong>ï¼šå¾ç¨‹ 6 å·¥å…·é“¾åŸºäº <code>horizon_tc_ui</code> åŒ…å°è£…çš„ <code>hb_compile</code> å‘½ä»¤è¡Œå·¥å…·ï¼Œæä¾› ONNX æ¨¡å‹ PTQ å…¨æµç¨‹è½¬æ¢èƒ½åŠ›ï¼Œå…¶å†…éƒ¨ä¼šå…ˆè°ƒç”¨ <code>hmct</code> åŒ…å®ç°æ¨¡å‹è§£æã€å›¾ä¼˜åŒ–ã€æ ¡å‡†åŠŸèƒ½ï¼Œå†è°ƒç”¨ <code>hbdk4_compiler</code> åŒ…å®ç°æ¨¡å‹çš„å®šç‚¹åŒ–å’Œç¼–è¯‘åŠŸèƒ½ï¼›</p>
<p><strong>QAT</strong>ï¼šå¾ç¨‹ 6 å·¥å…·é“¾åŸºäº <code>horizon_plugin_pytorch</code> åŒ…æä¾›é‡åŒ–æ„ŸçŸ¥è®­ç»ƒèƒ½åŠ›ï¼›</p>
<p><strong>HBDK</strong>ï¼šå¾ç¨‹ 6 å·¥å…·é“¾ç¼–è¯‘å™¨ï¼ŒåŸºäº <code>hbdk4_compiler</code> åŒ…æä¾›æ¨¡å‹å®šç‚¹åŒ–ã€å›¾ä¿®æ”¹ã€æ¨¡å‹ç¼–è¯‘ã€é™æ€ perf ç­‰åŠŸèƒ½ï¼›</p>
<p><strong>é«˜æ•ˆæ¨¡å‹ç®—æ³•åŒ…</strong>ï¼šå¾ç¨‹ 6 å·¥å…·é“¾åŸºäº <code>horizon-torch-samples</code> åŒ…ï¼Œä»¥æºç å¼€æ”¾å½¢å¼æä¾›äº†å¤šåœºæ™¯å‚è€ƒç®—æ³•ï¼Œè¿™äº›æ¨¡å‹åŸºäºå¼€æºæ•°æ®é›†è®­ç»ƒï¼Œæ¨¡å‹ç»“æ„è´´åˆåœ°å¹³çº¿èŠ¯ç‰‡è¿›è¡Œäº†é«˜æ•ˆä¸”ç”¨æˆ·å‹å¥½çš„è®¾è®¡ï¼Œå¹¶åŸºäº QAT é“¾è·¯å®ç°äº†æ¨¡å‹çš„é‡åŒ–è½¬æ¢ï¼›</p>
<p><strong>UCP</strong>ï¼šå¾ç¨‹ 6 å·¥å…·é“¾ç»Ÿä¸€è®¡ç®—å¹³å°ï¼Œé€šè¿‡ä¸€å¥—ç»Ÿä¸€çš„å¼‚æ„ç¼–ç¨‹æ¥å£å®ç°äº†å¯¹ å¾ç¨‹ 6 è®¡ç®—å¹³å°ç›¸å…³è®¡ç®—èµ„æºçš„è°ƒç”¨ï¼Œæä¾›è§†è§‰å¤„ç†ã€æ¨¡å‹æ¨ç†ã€é«˜æ€§èƒ½è®¡ç®—åº“ã€è‡ªå®šä¹‰ç®—å­æ’ä»¶å¼€å‘ç­‰åŠŸèƒ½ï¼›</p>
<p><strong>AI-Benchmark</strong>ï¼šå¾ç¨‹ 6 å·¥å…·é“¾åŸºäºé¢„ç¼–è¯‘å¥½æ¨¡å‹æä¾›çš„åµŒå…¥å¼å·¥ç¨‹ç¤ºä¾‹ï¼Œå¯å®ç°æ¨¡å‹çš„æ€§èƒ½è¯„æµ‹å’Œç²¾åº¦è¯„æµ‹ã€‚</p>
<h3 data-id="heading-4">3.2 ä¸¤å¥—æ¨¡å‹è½¬æ¢é“¾è·¯</h3>
<p><img src="http://openwrite.cn/uploads/19742/59443/3023172f-40fc-4c06-8c03-417e1325aff3.png" alt="image.png" loading="lazy"/></p>
<p>å¾ç¨‹ 6 å·¥å…·é“¾æ”¯æŒ PTQï¼ˆè®­ç»ƒåé‡åŒ–ï¼‰ã€QATï¼ˆé‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼‰ä¸¤å¥—æ¨¡å‹è½¬æ¢é“¾è·¯ï¼Œå…¶ç‰¹æ€§å’Œä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>
<p><strong>PTQ</strong>ï¼šåŸºäº <code>hb_compile</code> å‘½ä»¤è¡Œå·¥å…·è½¬æ¢æ¨¡å‹ï¼Œé…ç½®å¥½ yamlã€æ ¡å‡†æ•°æ®é›†åï¼Œå¯ä¸€æ­¥å®ç°æ¨¡å‹çš„å›¾ä¼˜åŒ–ã€æ ¡å‡†ã€é‡åŒ–ã€ç¼–è¯‘å…¨æµç¨‹ã€‚â€‹<strong>è¯¥é‡åŒ–æ–¹å¼å¿«æ·æ˜“ç”¨ï¼Œä½†ä»…åŸºäºæ•°å­¦ç»Ÿè®¡æ–¹å¼çš„ç¦»çº¿é‡åŒ–ä¸åˆ©äºæ¨¡å‹è¿­ä»£ï¼Œä¸”å¯èƒ½ä¼šè§¦å‘éš¾ä»¥è§£å†³çš„ corner case</strong>â€‹ï¼Œå› æ­¤åœ¨é‡äº§é¡¹ç›®ä¸­é€šå¸¸ç”¨äºæ—©æœŸè¯„æµ‹å’Œç®€å•æ¨¡å‹çš„é‡åŒ–ã€‚</p>
<p><strong>QAT</strong>ï¼šåœ¨ PyTorch å¼€æºæ¡†æ¶ä¸Šï¼ŒåŸºäº <code>plugin</code> æ’ä»¶çš„å½¢å¼æä¾›æ¨¡å‹é‡åŒ–èƒ½åŠ›ï¼Œå¹¶è°ƒç”¨ <code>hbdk</code> ç¼–è¯‘å™¨çš„ API å®ç°æ¨¡å‹çš„å®šç‚¹åŒ–å’Œç¼–è¯‘ã€‚è¯¥é“¾è·¯æ”¯æŒæ¨¡å‹æ ¡å‡†åè¿›ä¸€æ­¥çš„ finetune è®­ç»ƒï¼Œè™½ç„¶ä¸Šæ‰‹éš¾åº¦å’Œè®­ç»ƒæˆæœ¬éƒ½è¾ƒé«˜ï¼Œâ€‹<strong>ä½†ç²¾åº¦ä¸Šé™ä¹Ÿæ›´é«˜ï¼Œæ›´åˆ©äºæ¨¡å‹è¿­ä»£ä¼˜åŒ–</strong>â€‹ï¼Œæ˜¯é‡äº§é¡¹ç›®ä¸­çš„æ›´ä¼˜é€‰æ‹©ã€‚</p>
<h3 data-id="heading-5">3.3 å·¥å…·é“¾æ¨èä½¿ç”¨æµç¨‹</h3>
<p>é‰´äºä¸¤æ¡é‡åŒ–é“¾è·¯çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å»ºè®®çš„å·¥å…·é“¾ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š
<img src="http://openwrite.cn/uploads/19742/59443/a43e1ccb-89fb-4712-8546-e7eece421719.png" alt="image.png" loading="lazy"/></p>
<p><strong>Step1</strong>ï¼šå…ˆå¯¼å‡ºæµ®ç‚¹ ONNX æ¨¡å‹ï¼ˆopset10ï½19ï¼‰ï¼Œå¹¶åŸºäº PTQ é“¾è·¯è¿›è¡Œå¿«é€Ÿçš„æ¨¡å‹ç»“æ„éªŒè¯ï¼Œå…¨ int8 æ€§èƒ½ä¸Šé™éªŒè¯ï¼›è‹¥è¯¥æ€§èƒ½ç¬¦åˆé¢„æœŸï¼Œåˆ™å¯ä»¥ç²¾è°ƒ PTQï¼Œè‹¥æœ€ç»ˆç²¾åº¦/ç²¾åº¦éƒ½å¯åŒæ—¶æ»¡è¶³é¢„æœŸï¼Œåˆ™å¯è¿›è¡Œæ¿ç«¯éƒ¨ç½²ã€‚</p>
<p><strong>Step2</strong>ï¼šå¦‚æœé‡åˆ° PTQ æ— æ³•è§£å†³çš„ç²¾åº¦ corner caseï¼Œåˆ™éœ€è¦è½¬åˆ° QAT é“¾è·¯è¿›è¡Œé‡åŒ–ã€‚ä¾ç„¶å»ºè®®å…ˆè¿›è¡Œæ¨¡å‹ç»“æ„éªŒè¯å’Œå…¨ int8 æ€§èƒ½ä¸Šé™éªŒè¯ï¼›è‹¥è¯¥æ€§èƒ½ç¬¦åˆé¢„æœŸï¼Œåˆ™ä¼˜å…ˆåœ¨å…¨ int16 é…ç½®ä¸‹å°†ç²¾åº¦è®­ç»ƒè‡³ç¬¦åˆé¢„æœŸï¼Œç„¶åå†é™ä½ int16 æ¯”ä¾‹ï¼Œå®ç° int8/int16/fp16 æ··åˆç²¾åº¦ä¸‹çš„æ€§èƒ½/ç²¾åº¦è°ƒä¼˜ï¼Œæœ€åè¿›è¡Œæ¿ç«¯éƒ¨ç½²ã€‚</p>
<p>åœ¨ä»¥ä¸Šæ¨èé“¾è·¯ä¸­ï¼š</p>
<p>PTQ é“¾è·¯çš„æ¨¡å‹ç»“æ„éªŒè¯å’Œæ ‡å‡†é‡åŒ–ï¼Œå¯åœ¨ X86 ç«¯å‚è€ƒæœ¬æ–‡ 4.2 èŠ‚ä½¿ç”¨ <code>hb_compile</code> å‘½ä»¤è¡Œå·¥å…·ï¼›</p>
<p>æ¨¡å‹æ€§èƒ½åˆ†æå’ŒéªŒè¯ï¼Œå¯åœ¨ X86 ç«¯å‚è€ƒæœ¬æ–‡ 6.4 èŠ‚ã€Šé™æ€ perfã€‹ä½¿ç”¨ <code>hbm_perf</code> æ¥å£ç”Ÿæˆ html åˆ†ææ–‡ä»¶ï¼Œå¯åœ¨æ¿ç«¯å‚è€ƒæœ¬æ–‡ 8.2.1 èŠ‚ä½¿ç”¨ <code>hrt_model_exec</code> å·¥å…·ï¼›</p>
<p>æ¨¡å‹æ¨ç†ï¼Œå¯åœ¨ X86 ç«¯å‚è€ƒç”¨æˆ·æ‰‹å†Œã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fptq%2Fptq_tool%2Fhbruntime.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ptq/ptq_tool/hbruntime.html" ref="nofollow noopener noreferrer">è®­ç»ƒåé‡åŒ–-PTQ è½¬æ¢å·¥å…·-HBRuntime æ¨ç†åº“</a>ã€‹ï¼Œå¯åœ¨æ¿ç«¯å‚è€ƒæœ¬æ–‡ç¬¬ 8 ç« ã€Šæ¨¡å‹æ¿ç«¯éƒ¨ç½²ã€‹ä½¿ç”¨ UCP æ¨ç†æ¥å£ï¼›</p>
<p>æ¨¡å‹æ€§èƒ½/ç²¾åº¦è°ƒä¼˜ï¼Œè¯·è§åç»­æ–‡ç« çš„è¯¦ç»†ä»‹ç»ã€‚</p>
<h2 data-id="heading-6">4.PTQ é“¾è·¯</h2>
<h3 data-id="heading-7">4.1 æ¨¡å‹è½¬æ¢æµç¨‹</h3>
<p><img src="http://openwrite.cn/uploads/19742/59443/5f1bc48b-20b3-41de-9440-6431df6e4b6a.png" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">4.2 hb_compile å·¥å…·</h3>
<p><code>hb_compile</code> ä¸º PTQ æ¨¡å‹è½¬æ¢çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒä»¥ä¸‹ 3 ç§ä½¿ç”¨æ–¹å¼ï¼š</p>
<p><img src="http://openwrite.cn/uploads/19742/59443/078b7de3-c703-4452-ad08-f89f8ba17c5f.png" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">4.3 PTQ æ¨¡å‹äº§å‡ºç‰©</h3>



































<table><thead><tr><th><strong>original_float.onnx</strong></th><th>æµ®ç‚¹</th><th>å¯¹ Caffe1.0 æ¨¡å‹è¿›è¡Œè§£æï¼Œè½¬æˆ ONNX</th></tr></thead><tbody><tr><td><strong>optimized_float.onnx</strong></td><td>æµ®ç‚¹</td><td>å›¾ä¼˜åŒ–ï¼Œä¾‹å¦‚ BN èåˆåˆ° Conv</td></tr><tr><td><strong>calibrated.onnx</strong></td><td>ä¼ªé‡åŒ–</td><td>æ’å…¥æ ¡å‡†èŠ‚ç‚¹ï¼Œå¹¶åŸºäºæ ¡å‡†æ•°æ®è®¡ç®—ç»Ÿè®¡åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„é‡åŒ–å‚æ•°</td></tr><tr><td><strong>ptq.onnx</strong></td><td>æŸ¥è¡¨ç®—å­å®šç‚¹ + å…¶ä»–ç®—å­ä¼ªé‡åŒ–</td><td>å°†æŸ¥è¡¨ç®—å­å®šç‚¹åŒ–</td></tr><tr><td><strong>quantized.bc</strong></td><td>å®šç‚¹</td><td>æ•´ä¸ªæ¨¡å‹å®šç‚¹åŒ–ï¼Œå¹¶è½¬æ¢ä¸ºåœ°å¹³çº¿ hbir ä¸­é—´è¡¨è¾¾</td></tr><tr><td><strong>hbm</strong></td><td>æŒ‡ä»¤é›†</td><td>ç»è¿‡ç¼–è¯‘åçš„æœ€ç»ˆéƒ¨ç½²æ¨¡å‹</td></tr></tbody></table>
<h3 data-id="heading-10">4.4 PTQ ç²¾åº¦é…ç½®æ–¹æ³•</h3>
<p>åœ¨ config.yaml ä¸­ï¼Œæ”¯æŒé€šè¿‡ json çš„æ–¹å¼é…ç½® â€‹<strong>å…¨å±€</strong>â€‹ã€â€‹<strong>æŸç±»ç®—å­</strong>â€‹ã€â€‹<strong>æŸä¸ªå­å›¾</strong>â€‹ã€<strong>æŸä¸ªèŠ‚ç‚¹ â€‹</strong>çš„è®¡ç®—ç²¾åº¦ï¼Œå¯æ ¹æ® BPU ç®—å­æ”¯æŒçº¦æŸè¿›è¡Œé…ç½®ã€‚</p>
<pre><code class="hljs language-Plain" lang="Plain"># æ ¡å‡†å‚æ•°ç»„
calibration_parameters:
  quant_config: './quant_config.json'
</code></pre>
<h3 data-id="heading-11">4.5 PTQ ç²¾åº¦è°ƒä¼˜æµç¨‹</h3>
<p>è¯·å‚è€ƒç”¨æˆ·æ‰‹å†Œã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fptq%2Fptq_usage%2Faccuracy_tune.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ptq/ptq_usage/accuracy_tune.html" ref="nofollow noopener noreferrer">è®­ç»ƒåé‡åŒ–-PTQ è½¬æ¢æ­¥éª¤-æ¨¡å‹ç²¾åº¦è°ƒä¼˜</a>ã€‹å’Œã€Šè®­ç»ƒåé‡åŒ–-PTQ è½¬æ¢æ­¥éª¤-ç²¾åº¦è°ƒä¼˜å®æˆ˜ã€‹ç« èŠ‚ã€‚</p>
<h2 data-id="heading-12">5.QAT é“¾è·¯</h2>
<h3 data-id="heading-13">5.1 æ¨¡å‹è½¬æ¢æµç¨‹</h3>
<p><img src="http://openwrite.cn/uploads/19742/59443/eaadb6db-c995-494c-b37a-f3970fac4b90.png" alt="image.png" loading="lazy"/></p>
<p><strong>æµ®ç‚¹æ¨¡å‹æ”¹é€ â€‹</strong>ï¼šåœ¨æ¨¡å‹å‰æ’å…¥ QuantStubã€åœ¨æ¨¡å‹åæ’å…¥ DequantStubï¼Œç”¨äºè¯†åˆ«æ¨¡å‹é¦–å°¾éƒ¨ï¼Œå‰¥ç¦»å‰åå¤„ç†</p>
<p><strong>æ¨¡å‹æ ¡å‡†</strong>ï¼šé€šè¿‡åœ¨æ¨¡å‹ä¸­æ’å…¥ Observer çš„æ–¹å¼ï¼Œåœ¨ forward è¿‡ç¨‹ä¸­ç»Ÿè®¡å„å¤„çš„æ•°æ®åˆ†å¸ƒï¼Œä»¥è®¡ç®—å‡ºé‡åŒ–å‚æ•°</p>
<p>éƒ¨åˆ†æ¨¡å‹ä»…é€šè¿‡ Calibration ä¾¿å¯æ»¡è¶³ç²¾åº¦è¦æ±‚ï¼Œåˆ™æ— éœ€è¿›è¡Œ QATï¼Œå¯ç›´æ¥ç¼–è¯‘æ¨¡å‹ç”¨äºéƒ¨ç½²</p>
<p>å³ä½¿ Calibration æ— æ³•æ»¡è¶³ç²¾åº¦è¦æ±‚ï¼Œä¹Ÿå¯é™ä½åç»­ QAT éš¾åº¦ï¼Œç¼©çŸ­è®­ç»ƒæ—¶é—´ï¼Œæå‡æœ€ç»ˆè®­ç»ƒç²¾åº¦</p>
<p><strong>é‡åŒ–æ„ŸçŸ¥è®­ç»ƒ</strong>ï¼šè¿›ä¸€æ­¥é€šè¿‡è®­ç»ƒçš„æ–¹å¼å¾®è°ƒæ¨¡å‹å‚æ•°ï¼Œå¦‚æœ Calibration ç²¾åº¦è¾ƒå¥½ï¼Œåˆ™æ¨èå›ºå®šæ¿€æ´» scale</p>
<p>JIT-STRIPï¼šä½¿ç”¨ hook å’Œ subclass tensor çš„æ–¹å¼æ„ŸçŸ¥å›¾ç»“æ„ï¼Œåœ¨åŸæœ‰ forward ä¸Šåšç®—å­æ›¿æ¢/ç®—å­èåˆç­‰æ“ä½œï¼Œå¹¶ä¸”ä¼šæ ¹æ®æ¨¡å‹ä¸­ QuantStub å’Œ DequantStub çš„ä½ç½®è¯†åˆ«å¹¶è·³è¿‡å‰åå¤„ç†</p>
<p>ä¼˜ç‚¹ï¼šå…¨è‡ªåŠ¨ï¼Œä»£ç ä¿®æ”¹å°‘ï¼Œå±è”½äº†å¾ˆå¤šç»†èŠ‚é—®é¢˜ï¼Œä¾¿äº debug</p>
<p>ç¼ºç‚¹ï¼šåŠ¨æ€ä»£ç å—ä»éœ€è¦ç‰¹æ®Šå¤„ç†</p>
<h3 data-id="heading-14">5.2 QAT ç²¾åº¦é…ç½®æ–¹æ³•</h3>
<p>è¯·è§ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.horizon.auto%2Fblog%2F13112" target="_blank" title="https://developer.horizon.auto/blog/13112" ref="nofollow noopener noreferrer">ã€åœ°å¹³çº¿ J6 å·¥å…·é“¾å…¥é—¨æ•™ç¨‹ã€‘QAT æ–°ç‰ˆ qconfig é‡åŒ–æ¨¡æ¿ä½¿ç”¨æ•™ç¨‹</a>ã€‚</p>
<h3 data-id="heading-15">5.3 QAT ç²¾åº¦è°ƒä¼˜æµç¨‹</h3>
<p><strong>æ•´ä½“è°ƒä¼˜æµç¨‹ï¼š</strong></p>
<p>å¾ç¨‹ 6B åŒºåˆ«äºå¾ç¨‹ 6E/M æ¥è¯´æµ®ç‚¹ç®—å­ï¼ˆfp16ï¼‰çš„æ”¯æŒèƒ½åŠ›æ›´å¤šï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰ vpuï¼Œå› æ­¤ä¸é«˜ä¼˜æ¨è fp16 è°ƒä¼˜ï¼Œä»å»ºè®®æ²¿ç”¨ã€‚
<img src="http://openwrite.cn/uploads/19742/59443/66fa477b-078d-4b92-85c7-945ab281d6e3.png" alt="image.png" loading="lazy"/></p>
<p><strong>fp16 é…ç½®æ–¹å¼ï¼š</strong></p>
<p>QAT æ–°ç‰ˆ qconfig é‡åŒ–æ¨¡æ¿ä½¿ç”¨æ•™ç¨‹è§ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.horizon.auto%2Fblog%2F13112" target="_blank" title="https://developer.horizon.auto/blog/13112" ref="nofollow noopener noreferrer">developer.horizon.auto/blog/13112</a></p>
<pre><code class="hljs language-Plain" lang="Plain">my_qconfig_setter=QconfigSetter(
    reference_qconfig=get_qconfig(observer=MSEObserver),
    templates=[
        ModuleNameTemplate({ "":qint16,}),
        ModuleNameTemplate({"quant":torch.float16}),
        ...        
        ],
        save_dir="./work_dir",
    )
</code></pre>
<p>éœ€è¦æ³¨æ„ï¼Œç”±äºå¾ç¨‹ 6B æ²¡æœ‰ vpuï¼Œfp16 ç®—å­çš„ä½¿ç”¨å¯èƒ½ä¼šå¼•å…¥ cpu çš„ quantã€dequant ç®—å­ã€‚å»ºè®®å°½é‡å°‘çš„é… FP 16ï¼Œé¿å…æ€§èƒ½æŸå¤±ã€‚</p>
<h2 data-id="heading-16">6.æ¨¡å‹å¯¼å‡º/å®šç‚¹åŒ–/ç¼–è¯‘</h2>
<h3 data-id="heading-17">6.1 PTQ é“¾è·¯</h3>
<p>è¯¥æµç¨‹å°è£…åœ¨ <code>hb_compile</code> ä¸­ï¼Œç›¸å…³å‚æ•°é€šè¿‡ yaml è¿›è¡Œé…ç½®ã€‚è‹¥è‡ªè¡Œè°ƒç”¨ç¼–è¯‘å™¨æ¥å£æ‰§è¡Œï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">import onnx
from hbdk4.compiler.onnx import export
from hbdk4.compiler import convert, save, compile

# ç»è¿‡PTQæ ¡å‡†å¾—åˆ°çš„ä¼ªé‡åŒ–onnxæ¨¡å‹ï¼Œéçº¿æ€§çš„æŸ¥è¡¨ç®—å­å·²å®šç‚¹
ptq_model = onnx.load("xxx_ptq_model.onnx")    

# å¯¼å‡ºæŸ¥è¡¨ç®—å­å®šç‚¹+å…¶ä»–ç®—å­ä¼ªé‡åŒ–çš„hbiræ¨¡å‹
qat_bc = export(ptq_model)
save(qat_bc, "qat.bc")

# å¯¼å‡ºå…¨å®šç‚¹hbiræ¨¡å‹
quantized_bc = convert(qat_bc, "nash-b")
save(quantized_bc, "quantized.bc")

# ç¼–è¯‘ç”Ÿæˆhbmæ¨¡å‹
compile(
    m=quantized_bc, 
    path="model.hbm", 
    opt=2, 
    march="nash-b", 
    progress_bar=True,
    input_no_padding=True,
    output_no_padding=True
)
</code></pre>
<h4 data-id="heading-18">6.1.1 è¾“å…¥/è¾“å‡ºå» padding</h4>
<p>æ¨¡å‹åœ¨ BPU ä¸Šæ¨ç†æ—¶ï¼Œå…¶è¾“å…¥å’Œè¾“å‡ºèŠ‚ç‚¹çš„å†…å­˜å¤§å°å’Œæ•°æ®å­˜æ”¾è§„åˆ™éœ€æ»¡è¶³ç¡¬ä»¶å¯¹é½è¦æ±‚ã€‚</p>
<p><strong>å†…å­˜å¯¹é½</strong>ï¼šç”³è¯·çš„å†…å­˜å¤§å°éœ€æ»¡è¶³æŸä¸ªå­—èŠ‚æ•°çš„æ•´æ•°å€ï¼Œ</p>
<p><strong>è·¨è·å¯¹é½</strong>ï¼šè·¨è·ï¼ˆStrideï¼‰æ˜¯æŒ‡æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­æ—¶ï¼Œæ¯ä¸€è¡Œæ‰€å ç©ºé—´çš„å®é™…å¤§å°ï¼Œå½“å¯¹é½åˆ°æŸä¸ªå­—èŠ‚æ•°çš„æ•´æ•°å€åï¼Œç¡¬ä»¶å³å¯é«˜æ•ˆå¤„ç†ã€‚è¯¥å¯¹é½çš„æ“ä½œåˆå« Paddingï¼Œå®é™…çš„å¯¹é½è§„åˆ™å–å†³äºå…·ä½“çš„è½¯ç¡¬ä»¶ç³»ç»Ÿã€‚å‡è®¾ä¸€ä»½ NHWC ä¸º 1x20x30x1 çš„ int8 æ•°æ®ï¼Œè‹¥ç¡¬ä»¶è¦æ±‚è·¨è· W32 å¯¹é½ï¼Œé‚£ä¹ˆæ¯ä¸€è¡Œ W éƒ½å°† Padding 2 ä¸ªå­—èŠ‚ã€‚</p>
<p>å¾ç¨‹ 6 å·¥å…·é“¾æ”¯æŒåœ¨ <code>compile</code> æ¥å£ä¸­ä¼ å…¥ <code>input_no_padding</code>ã€<code>output_no_padding</code> å‚æ•°æ¥æ§åˆ¶æ˜¯å¦ä½¿ç”¨ BPU è‡ªåŠ¨å®Œæˆ padding å¯¹é½æ“ä½œã€‚å¼€å¯åç”¨æˆ·å³å¯ä¸å…³å¿ƒ BPU è·¨è·å¯¹é½è¦æ±‚ï¼Œæ— éœ€æ‰‹åŠ¨ Paddingï¼Œæ•°æ®å¯è¿ç»­å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è¯¥ç‰¹æ€§å¯ä¼˜åŒ–æ¨¡å‹è¾“å…¥/è¾“å‡ºçš„ IO è´Ÿè½½ï¼Œä½†ä¹Ÿæœ‰å¾®å°æ¦‚ç‡ä¼šå¼•å…¥æ€§èƒ½çš„å°å¹…ä¸‹é™ï¼Œæ‰€ä»¥æ˜¯å¦å¼€å¯è¯¥åŠŸèƒ½è¯·åœ¨æ‚¨çš„æ¨¡å‹ä¸Šå®é™…éªŒè¯ï¼Œå¹¶è¯·åœ¨æ¨¡å‹ç¼–è¯‘å’Œæ¿ç«¯éƒ¨ç½²ç¯èŠ‚ç»Ÿä¸€è·¨è·å¯¹é½çš„å¤„ç†ç­–ç•¥ã€‚</p>
<h3 data-id="heading-19">6.2 QAT é“¾è·¯</h3>
<p>QAT é“¾è·¯çš„æ¨¡å‹å®šç‚¹åŒ–å’Œç¼–è¯‘ç›´æ¥è°ƒç”¨å¦‚ä¸Šçš„ç¼–è¯‘å™¨æ¥å£ï¼Œæ¨¡å‹å¯¼å‡ºé¢å¤–å°è£…äº†ä¸€å±‚ï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">from horizon_plugin_pytorch.quantization.hbdk4 import export

def export(
    model: nn.Module,
    example_inputs: Any,
    name: str = "forward",
    input_names: Optional[Any] = None,    # å»ºè®®åœ¨æ¨¡å‹å¯¼å‡ºæ—¶å°±é…ç½®å¥½è¾“å…¥è¾“å‡ºèŠ‚ç‚¹åç§°
    output_names: Optional[Any] = None,
    input_descs: Optional[Any] = None,
    output_descs: Optional[Any] = None,
    native_pytree: bool = True,
) -&gt; Module
</code></pre>
<h3 data-id="heading-20">6.3 æ¨¡å‹ä¿®æ”¹</h3>
<p>ç¼–è¯‘å™¨æ”¯æŒåœ¨ hbir ä¸Šè¿›è¡Œå¤š batch æ‹†åˆ†ã€æ’å…¥æ•°æ®å‰å¤„ç†ã€ç®—å­åˆ é™¤ã€è°ƒæ•´è¾“å…¥è¾“å‡º layout ç­‰ä¿®æ”¹æ“ä½œï¼Œå…¶ä¸»è¦åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p>
<p><strong>å¤š batch æ‹†åˆ†</strong>ï¼šå…¸å‹åœºæ™¯æ˜¯ BEV æ¨¡å‹åœ¨éƒ¨ç½²æ—¶ï¼Œå¤š V è¾“å…¥æ¥æºäºä¸åŒçš„æ‘„åƒå¤´ï¼Œå…¶æ•°æ®åœ¨å†…å­˜ä¸­ç‹¬ç«‹å­˜å‚¨ï¼Œå› æ­¤æ¨¡å‹å¯å°†å…¶å¤š V è¾“å…¥æ²¿ batch ç»´åº¦åšæ‹†åˆ†ï¼›</p>
<p><strong>æ•°æ®å‰å¤„ç†</strong>ï¼šå¾ç¨‹ 6 å·¥å…·é“¾æ”¯æŒåœ¨æ¨¡å‹å‰ç«¯æ’å…¥ä¸€ä¸ªå‰å¤„ç†èŠ‚ç‚¹ï¼Œä»¥å®ç°é¢œè‰²ç©ºé—´è½¬æ¢ï¼ˆå¦‚ NV12â€”&gt; BGRï¼‰ã€æ•°æ®å½’ä¸€åŒ–ï¼ˆ<code>(data-mean)/std</code>ï¼‰ï¼Œå’Œ Resizer åŠŸèƒ½ï¼ˆä»å¤§å›¾ä¸ŠæŠ å›¾ + Resizeï¼‰ï¼Œå¹¶å¯ç”± BPU è¿›è¡ŒåŠ é€Ÿï¼›</p>
<p><strong>ç®—å­åˆ é™¤</strong>ï¼šå¾ç¨‹ 6 å·¥å…·é“¾æ”¯æŒå°†æ¨¡å‹é¦–å°¾éƒ¨çš„ Quantizeã€Dequantizeã€Castã€Reshapeã€Transpose ç­‰ç®—å­åˆ é™¤ï¼Œä»¥é€‚é…æ›´åŠ çµæ´»çš„éƒ¨ç½²æ–¹æ¡ˆï¼›</p>
<p><strong>è°ƒæ•´è¾“å…¥è¾“å‡º layout</strong>ï¼šæ¨¡å‹é¦–å°¾éƒ¨é™¤äº†æ”¯æŒåˆ é™¤ Reshapeã€Transpose èŠ‚ç‚¹å¤–ï¼Œè¿˜æ”¯æŒæ’å…¥ Transpose èŠ‚ç‚¹ï¼Œç”¨æˆ·å¯çµæ´»è°ƒæ•´å…¶ layout æ’å¸ƒã€‚</p>
<p>ä»¥ä¸‹å‚è€ƒä»£ç å¯¹ä¸€ä¸ªå¤šè¾“å…¥æ¨¡å‹å®ç°äº†å¤š batch è¾“å…¥æ‹†åˆ†ã€å›¾åƒè¾“å…¥çš„è‰²å½©ç©ºé—´è½¬æ¢ã€æ•°æ®å½’ä¸€åŒ–ã€Resizer åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">from hbdk4.compiler import load, convert

qat_bc = load("qat.bc")  
func = qat_bc[0]
batch_input = ["input_name1"]   # éœ€è¦ä½¿ç”¨ç‹¬ç«‹åœ°å€æ–¹å¼éƒ¨ç½²çš„è¾“å…¥èŠ‚ç‚¹åç§°åˆ—è¡¨
resizer_input = ["resize"]      # éƒ¨ç½²æ—¶æ•°æ®æ¥æºäºresizerçš„è¾“å…¥èŠ‚ç‚¹åç§°åˆ—è¡¨
pyramid_input = ["pym"]         # éƒ¨ç½²æ—¶æ•°æ®æ¥æºäºpyramidçš„è¾“å…¥èŠ‚ç‚¹åç§°åˆ—è¡¨

def channge_source(input, source):
    node = input.insert_transpose(permutes=[0, 3, 1, 2])
    node = node.insert_image_preprocess(mode="yuvbt601full2bgr", divisor=1, mean=[128, 128, 128], std=[128, 128, 128])
    if source == "pyramid":
        node.insert_image_convert("nv12")          
    elif source == "resizer":
        node.insert_roi_resize("nv12")

for input in func.inputs[::-1]:
    if input.name in batch_input:
        origin_name = input.name
        split_inputs = input.insert_split(dim=0)
        for split_input in reversed(split_inputs):
            if origin_name in pyramid_input:
                channge_source(split_input, "pyramid")
            elif origin_name in resizer_input:
                channge_source(split_input, "resizer")
</code></pre>
<h3 data-id="heading-21">6.4 é™æ€ perf</h3>
<p>å¯¹äºç¼–è¯‘å¥½çš„ hbmï¼Œç¼–è¯‘å™¨æ”¯æŒåœ¨ X86 ç«¯å¯¹å…¶ BPU éƒ¨åˆ†è¿›è¡Œé™æ€æ€§èƒ½é¢„ä¼°ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ç”Ÿæˆä¸€ä¸ª html æ–‡ä»¶ï¼ŒåŒ…å«æ¨¡å‹é¢„ä¼°æ€§èƒ½ã€å¸¦å®½ã€å†…å­˜å ç”¨ã€BPU å†…éƒ¨å•å¸§æ‰§è¡Œæ—¶åºå›¾ç­‰ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-Plain" lang="Plain">from hbdk4.compiler import hbm_perf
hbm_perf(model="xxx.hbm", output_dir="./")
</code></pre>
<h2 data-id="heading-22">7.æµ®ç‚¹èƒ½åŠ›ä½¿ç”¨</h2>
<h3 data-id="heading-23">7.1 TAE å¼ é‡è¾“å‡ºï¼ŒVAE å‘é‡è®¡ç®—æ”¯æŒæµ®ç‚¹</h3>
<p>å¾ç¨‹ 6B BPU çš„ TAE å¼ é‡è®¡ç®—å•å…ƒæ”¯æŒ FP16/FP32 è¾“å‡ºï¼ŒVAE å‘é‡è®¡ç®—å•å…ƒæ”¯æŒ FP16 è®¡ç®—ã€‚ä½†åœ¨å®é™…éƒ¨ç½²ä¸­ä»éœ€ç»¼åˆè¯„ä¼°åå†ä½¿ç”¨ï¼Œå…·ä½“åŸå› å¦‚ä¸‹ï¼š</p>
<p><strong>ç²¾åº¦</strong>ï¼šFP16 å¹¶éåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼˜äº INT16ï¼Œé€šå¸¸æƒ…å†µä¸‹æ•°å€¼èŒƒå›´å°æ—¶ FP16 æ›´ä¼˜ï¼Œæ•°å€¼èŒƒå›´å¤§æ—¶ INT16 æ›´ä¼˜ï¼Œä½†ä¹Ÿéœ€è¦è€ƒè™‘æ•°å€¼è¾ƒå°æˆ–è¾ƒå¤§éƒ¨åˆ†çš„è¯¯å·®å¯¹æ¨¡å‹è¾“å‡ºçš„å½±å“ç¨‹åº¦ã€‚æ‰€ä»¥é‡åŒ–ç²¾åº¦æ˜¯å¦ä½¿ç”¨ FP16ï¼Œæ›´å»ºè®®åŸºäºç²¾åº¦ Debug çš„åˆ†æç»“æœæ¥ç¡®å®šï¼›</p>
<p><strong>æ€§èƒ½</strong>ï¼šé™¤ Reduce æ€§èƒ½ä¸º INT16 çš„ 1/2 å¤–ï¼Œå…¶ä»–ç®—å­çš„ FP16 æ€§èƒ½å’Œ INT16 æ€§èƒ½æŒå¹³</p>
<p><strong>é¢å¤–å¼€é”€</strong>ï¼šè™½ç„¶ FP16 ç®—å­æœ¬èº«æ— éœ€é‡åŒ–ï¼Œä½†ä¸Šä¸‹æ¸¸ç®—å­å¦‚æœæ¶‰åŠ FP16 &lt;â€”&gt; INT16 çš„æ•°æ®è½¬æ¢ï¼Œåˆ™ä¼šå¼•å…¥é‡åŒ–/åé‡åŒ–ï¼š</p>
<p>è™½ç„¶è¯¥èŠ‚ç‚¹å¯ä»¥ç”± VAE ç¡¬ä»¶ç›´æ¥æ”¯æŒï¼Œä½†ç›¸æ¯”äºå…¨ INT16 ç›´æ¥ä¸²æ¥ä»ä¼šæœ‰é¢å¤–çš„æ€§èƒ½ã€å¸¦å®½å¼€é”€ï¼›</p>
<p>æ–°å¼•å…¥çš„é‡åŒ–æˆ–åé‡åŒ–èŠ‚ç‚¹çš„ Scale éœ€è¦é‡æ–°æ ¡å‡†/QAT è®­ç»ƒå¾—åˆ°ã€‚</p>
<h3 data-id="heading-24">7.2 æ—  VPU åŠ é€Ÿé‡åŒ–/åé‡åŒ–</h3>
<p>ç›¸æ¯”äº å¾ç¨‹ 6EM è®¡ç®—å¹³å°ï¼Œå¾ç¨‹ 6B æ—  VPU ç¡¬ä»¶åŠ é€Ÿæ¨¡å‹é¦–å°¾éƒ¨çš„é‡åŒ–/åé‡åŒ–èŠ‚ç‚¹ï¼Œä½†æ”¯æŒ Gemm ç±»ç®—å­ç›´æ¥ FP32 è¾“å‡ºï¼Œå…¶ä»– INT8/INT16 è¾“å‡ºèŠ‚ç‚¹çš„åé‡åŒ–ï¼Œåˆ™æ›´å»ºè®®ä½¿ç”¨ç¼–è¯‘å™¨æ¥å£å°†å…¶ä» quantized.bc ä¸Šç§»é™¤ï¼Œå¹¶å‚è€ƒè¯¥ç¯‡æ–‡ç« ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.horizon.auto%2Fblog%2F10424" target="_blank" title="https://developer.horizon.auto/blog/10424" ref="nofollow noopener noreferrer">åé‡åŒ–èŠ‚ç‚¹çš„èåˆå®ç°</a>ï¼‰å°†å…¶èåˆè¿›å‰åå¤„ç†ä»£ç ä¸­ï¼Œä»¥å‡å°‘ä¸€æ¬¡æ•°æ®éå†çš„å†—ä½™å¼€é”€ã€‚</p>
<pre><code class="hljs language-Plain" lang="Plain">from hbdk4.compiler import load

quantized_bc = load("quantized.bc")
quantized_bc[0].remove_io_op(op_types=["Quantize", "Dequantize"])
</code></pre>
<h3 data-id="heading-25">7.3 æ—  SPUï¼Œæ ‡é‡è®¡ç®—èƒ½åŠ›æœ‰é™</h3>
<p>ç›¸æ¯”äº å¾ç¨‹ 6 å…¶ä»–è®¡ç®—å¹³å°ï¼Œå¾ç¨‹ 6B çš„æ ‡é‡è®¡ç®—å•å…ƒç®—åŠ›å‡å°‘ï¼Œå› æ­¤ TopK ç­‰æ ‡é‡ç®—å­çš„éƒ¨ç½²æ€§èƒ½éœ€è¦ç»¼åˆè¯„ä¼°åé€‰æ‹©åˆé€‚æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-26">8.æ¨¡å‹æ¿ç«¯éƒ¨ç½²</h2>
<h3 data-id="heading-27">8.1 UCP ç®€ä»‹</h3>
<p>UCPï¼ˆUnify Compute Platformï¼Œç»Ÿä¸€è®¡ç®—å¹³å°ï¼‰å®šä¹‰äº†ä¸€å¥—ç»Ÿä¸€çš„å¼‚æ„ç¼–ç¨‹æ¥å£ï¼Œ å°† SOC ä¸Šçš„åŠŸèƒ½ç¡¬ä»¶æŠ½è±¡å‡ºæ¥å¹¶è¿›è¡Œå°è£…ï¼Œå¯¹å¤–æä¾›åŸºäºåŠŸèƒ½çš„ API è¿›è¡Œè°ƒç”¨ã€‚UCP æä¾›çš„å…·ä½“åŠŸèƒ½åŒ…æ‹¬ï¼šâ€‹<strong>è§†è§‰å¤„ç†</strong>â€‹ï¼ˆVision Processï¼‰ã€â€‹<strong>ç¥ç»ç½‘ç»œæ¨¡å‹æ¨ç†</strong>â€‹ï¼ˆNeural Networkï¼‰ã€â€‹<strong>é«˜æ€§èƒ½è®¡ç®—åº“</strong>â€‹ï¼ˆHigh Performance Libraryï¼‰ã€â€‹<strong>è‡ªå®šä¹‰ç®—å­æ’ä»¶å¼€å‘</strong>â€‹ã€‚</p>
<p><img src="http://openwrite.cn/uploads/19742/59443/723349cb-c241-4612-859f-594123989d06.png" alt="image.png" loading="lazy"/></p>
<p>UCP æ”¯æŒçš„ Backend å¦‚ä¸‹ï¼š
<img src="http://openwrite.cn/uploads/19742/59443/19bd1039-5d83-4358-bde4-dd9d664eb1fc.png" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-28">8.2 å¿«é€Ÿä¸Šæ‰‹</h3>
<p>ä½¿ç”¨ UCP æ¨ç†æ¨¡å‹çš„åŸºæœ¬ä»£ç å‚è€ƒå¦‚ä¸‹ï¼Œè¯¦ç»†ä¿¡æ¯å¯å‚è€ƒç”¨æˆ·æ‰‹å†Œã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fucp%2Fruntime%2Fruntime_dev.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ucp/runtime/runtime_dev.html" ref="nofollow noopener noreferrer">ç»Ÿä¸€è®¡ç®—å¹³å°-æ¨¡å‹æ¨ç†å¼€å‘</a>ã€‹ã€ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fmodel_deployment_guidance%2Fmodel_deployment_guidance_examples%2Frgb_resnet18_deployment_guidance.html" target="_blank" title="https://doc.oe.horizon.auto/guide/model_deployment_guidance/model_deployment_guidance_examples/rgb_resnet18_deployment_guidance.html" ref="nofollow noopener noreferrer">æ¨¡å‹éƒ¨ç½²å®è·µæŒ‡å¯¼-æ¨¡å‹éƒ¨ç½²å®è·µæŒ‡å¯¼å®ä¾‹</a>ã€‹ã€ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oe.horizon.auto%2Fguide%2Fucp%2Fucp_api_reference%2Fucp_api_overview.html" target="_blank" title="https://docs.oe.horizon.auto/guide/ucp/ucp_api_reference/ucp_api_overview.html" ref="nofollow noopener noreferrer">UCP é€šç”¨ API ä»‹ç»</a>ã€‹ç­‰ç›¸å…³ç« èŠ‚ã€‚</p>
<pre><code class="hljs language-Plain" lang="Plain">// 1. åŠ è½½æ¨¡å‹å¹¶è·å–æ¨¡å‹åç§°åˆ—è¡¨ä»¥åŠHandle
{
    hbDNNInitializeFromFiles(&amp;packed_dnn_handle, &amp;modelFileName, 1);
    hbDNNGetModelNameList(&amp;model_name_list, &amp;model_count, packed_dnn_handle);
    hbDNNGetModelHandle(&amp;dnn_handle, packed_dnn_handle, model_name_list[0]);
}

// 2. æ ¹æ®æ¨¡å‹çš„è¾“å…¥è¾“å‡ºä¿¡æ¯å‡†å¤‡å¼ é‡
std::vector&lt;hbDNNTensor&gt; input_tensors;
std::vector&lt;hbDNNTensor&gt; output_tensors;
int input_count = 0;
int output_count = 0;
{
    hbDNNGetInputCount(&amp;input_count, dnn_handle);
    hbDNNGetOutputCount(&amp;output_count, dnn_handle);
    input_tensors.resize(input_count);
    output_tensors.resize(output_count);
    prepare_tensor(input_tensors.data(), output_tensors.data(), dnn_handle);
}

// 3. å‡†å¤‡è¾“å…¥æ•°æ®å¹¶å¡«å…¥å¯¹åº”çš„å¼ é‡ä¸­
{
    read_data_2_tensor(input_data, input_tensors);
    // ç¡®ä¿æ›´æ–°è¾“å…¥åè¿›è¡ŒFlushæ“ä½œä»¥ç¡®ä¿BPUä½¿ç”¨æ­£ç¡®çš„æ•°æ®
    for (int i = 0; i &lt; input_count; i++) {
      hbUCPMemFlush(&amp;input_tensors[i].sysMem, HB_SYS_MEM_CACHE_CLEAN);
    }
}

// 4. åˆ›å»ºä»»åŠ¡å¹¶è¿›è¡Œæ¨ç†
{
    // åˆ›å»ºä»»åŠ¡
    hbDNNInferV2(&amp;task_handle, output_tensors.data(), input_tensors.data(), dnn_handle)
    
    // æäº¤ä»»åŠ¡
    hbUCPSchedParam sched_param;
    HB_UCP_INITIALIZE_SCHED_PARAM(&amp;sched_param);
    sched_param.backend = HB_UCP_BPU_CORE_ANY;
    hbUCPSubmitTask(task_handle, &amp;sched_param);
    
    // ç­‰å¾…ä»»åŠ¡å®Œæˆ
    hbUCPWaitTaskDone(task_handle, 0);
}

// 5. å¤„ç†è¾“å‡ºæ•°æ®
{
    // ç¡®ä¿å¤„ç†è¾“å‡ºå‰è¿›è¡ŒFlushæ“ä½œä»¥ç¡®ä¿è¯»å–çš„ä¸æ˜¯ç¼“å­˜ä¸­çš„è„æ•°æ®
    for (int i = 0; i &lt; output_count; i++) {
      hbUCPMemFlush(&amp;output_tensors[i].sysMem, HB_SYS_MEM_CACHE_INVALIDATE);
    }
    // å¯¹è¾“å‡ºè¿›è¡Œåå¤„ç†æ“ä½œ
}

// 6. é‡Šæ”¾èµ„æº
{
    // é‡Šæ”¾ä»»åŠ¡
    hbUCPReleaseTask(task_handle);
    // é‡Šæ”¾è¾“å…¥å†…å­˜
    for (int i = 0; i &lt; input_count; i++) {
      hbUCPFree(&amp;(input_tensors[i].sysMem));
    }
    // é‡Šæ”¾è¾“å‡ºå†…å­˜
    for (int i = 0; i &lt; output_count; i++) {
      hbUCPFree(&amp;(output_tensors[i].sysMem));
    }
    // é‡Šæ”¾æ¨¡å‹
    hbDNNRelease(packed_dnn_handle);
}
</code></pre>
<h4 data-id="heading-29">8.2.1 hrt_model_exec å·¥å…·</h4>
<p>ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·å¿«é€ŸæŸ¥çœ‹ hbm å’Œ quantized.bc çš„æ¨¡å‹ä¿¡æ¯ã€è¿›è¡Œæ¨¡å‹å•å¸§æ¨ç†å’Œæ€§èƒ½è¯„æµ‹ï¼Œå¾ç¨‹ 6 å·¥å…·é“¾ UCP æä¾›äº† <code>hrt_model_exec</code> å·¥å…·ï¼Œå¹¶æ”¯æŒç¼–è¯‘ X86ã€aarch64ï¼ˆaarch64 ä»…æ”¯æŒ hbm æ¨ç†ï¼‰ä¸¤ä¸ªæ¶æ„ä¸‹çš„å¯æ‰§è¡Œç¨‹åºã€‚</p>
<p>hrt_model_exec çš„ä¸‰ç§ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain"># è®¾ç½®ç¯å¢ƒå˜é‡
# archä»£è¡¨æ¶æ„ç±»å‹ï¼Œaarch64æˆ–x86
arch=aarch64
bin=../$arch/bin/hrt_model_exec
lib=../$arch/lib/
export LD_LIBRARY_PATH=${lib}:${LD_LIBRARY_PATH}

# è·å–æ¨¡å‹ä¿¡æ¯
${bin} model_info --model_file=xxx.hbm

# æ¨¡å‹å•å¸§æ¨ç†
${bin} infer --model_file=xxx.hbm --input_file=xxx.bin

# æ¨¡å‹æ€§èƒ½è¯„æµ‹-Latency(å•çº¿ç¨‹)
${bin} perf --model_file=xxx.hbm --thread_num 1 --frame_count=1000

# æ¨¡å‹æ€§èƒ½è¯„æµ‹-FPS(å¤šçº¿ç¨‹)
${bin} perf --model_file=xxx.hbm --thread_num 8 --frame_count=1000
</code></pre>
<h3 data-id="heading-30">8.3 å›¾åƒè¾“å…¥åŠ¨æ€ shape/stride</h3>
<p>åœ¨ å¾ç¨‹ 6 èŠ¯ç‰‡çš„è§†é¢‘é€šè·¯ä¸Šï¼Œæœ‰ä¸€å—å« Pyramid çš„é‡‘å­—å¡”ç¡¬ä»¶å¤„ç†æ¨¡å—ï¼Œå¯æä¾› Camera è¾“å…¥å›¾åƒçš„ç¼©æ”¾åŠ ROI æŠ å›¾èƒ½åŠ›ï¼Œå…¶è¾“å‡ºä¸º nv12 ç±»å‹çš„å›¾åƒæ•°æ®ï¼Œå¹¶å¯åŸºäºå…±äº«å†…å­˜æœºåˆ¶ç›´æ¥ç»™åˆ° BPU è¿›è¡Œæ¨¡å‹æ¨ç†ã€‚å› æ­¤åœ¨ å¾ç¨‹ 6 å·¥å…·é“¾ä¸­ï¼š</p>
<ol>
<li>Pyramid æ¨¡å‹æŒ‡çš„æ˜¯å…·æœ‰ nv12 å›¾åƒè¾“å…¥çš„æ¨¡å‹ï¼›</li>
<li>Resizer æ¨¡å‹æŒ‡çš„æ˜¯å…·æœ‰ nv12 å›¾åƒè¾“å…¥å’Œ ROI è¾“å…¥çš„æ¨¡å‹ï¼Œç¼–è¯‘å™¨æ”¯æŒé€šè¿‡ JIT åŠ¨æ€æŒ‡ä»¤çš„æ–¹å¼ï¼Œä» nv12 å›¾åƒä¸Šå®Œæˆ ROI æŠ å›¾ + Resize çš„åŠŸèƒ½ã€‚</li>
</ol>
<p>åœ¨ å¾ç¨‹ 6 å·¥å…·é“¾ä¸­ï¼ŒPyramid çš„è¾“å…¥ stride ä¸ºåŠ¨æ€ï¼ŒResizer æ¨¡å‹çš„ stride å’Œ shape éƒ½æ˜¯åŠ¨æ€ã€‚å¦‚ä¸‹ä¸º mobilenetv1 ç¼–è¯‘åçš„æ¨¡å‹ä¿¡æ¯ï¼š
<img src="http://openwrite.cn/uploads/19742/59443/58fced0e-364c-4019-95fd-730d8d9b7896.png" alt="image.png" loading="lazy"/>
hrt_model_exec model_info æ¿ç«¯å¯æ‰§è¡Œç¨‹åºå·¥å…·</p>
<p><img src="http://openwrite.cn/uploads/19742/59443/75071b3d-fa56-4930-a50d-4d99fded8704.png" alt="image.png" loading="lazy"/></p>
<p>å…¶ä¸­ï¼Œ-1 ä¸ºå ä½ç¬¦ï¼Œè¡¨ç¤ºä¸ºåŠ¨æ€ï¼ŒPyramid è¾“å…¥çš„ stride ä¸ºåŠ¨æ€ï¼›Resizer è¾“å…¥çš„ Hã€Wã€stride å‡ä¸ºåŠ¨æ€ã€‚</p>
<ul>
<li>Resizer è¾“å…¥çš„ â€‹<strong>HW åŠ¨æ€</strong>â€‹ï¼Œæ˜¯å› ä¸ºåŸå§‹è¾“å…¥çš„å¤§å°å¯ä»¥æ˜¯ä»»æ„çš„ï¼›</li>
<li>Pyramid/Resizer è¾“å…¥çš„â€‹<strong>â€‹ stride åŠ¨æ€</strong>â€‹ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯æ”¯æŒ â€‹<strong>Crop åŠŸèƒ½</strong>â€‹ï¼Œè¯¦ç»†å†…å®¹å¯å‚è€ƒç”¨æˆ·æ‰‹å†Œã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fucp%2Fruntime%2Fbasic_sample.html%23crop" target="_blank" title="https://doc.oe.horizon.auto/guide/ucp/runtime/basic_sample.html#crop" ref="nofollow noopener noreferrer">ç»Ÿä¸€è®¡ç®—å¹³å°-æ¨¡å‹æ¨ç†å¼€å‘-åŸºç¡€ç¤ºä¾‹åŒ…ä½¿ç”¨è¯´æ˜-advanced_samples-crop</a>ã€‹</li>
</ul>
<h3 data-id="heading-31">8.4 éå›¾åƒ tensor å†…å­˜å¯¹é½</h3>
<p>å¯¹äºéå›¾åƒ tensorï¼Œå¾ç¨‹ 6B è¦æ±‚ 128 å¯¹é½ï¼Œå¾ç¨‹ 6EM è¦æ±‚å†…å­˜ 64 å¯¹é½ï¼Œå¾ç¨‹ 6PH è¦æ±‚ 256 å¯¹é½ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¨¡å‹è¾“å‡ºèŠ‚ç‚¹è™½ç„¶ stride[0] ä¸º 4000ï¼Œä½†éœ€è¦ç”³è¯·çš„ BPU å†…å­˜å¤§å°ï¼ˆaligned byte sizeï¼‰ä¸º 4096ï¼Œå³ä¸º 128 å¯¹é½çš„ç»“æœã€‚</p>
<p>åœ¨æ¨¡å‹å®é™…éƒ¨ç½²ä¸­ï¼Œéå›¾åƒè¾“å…¥/è¾“å‡ºèŠ‚ç‚¹æ‰€éœ€ç”³è¯·çš„å†…å­˜å¤§å°ï¼ˆ aligned byte sizeï¼‰å‡å¯ä»æ¨¡å‹èŠ‚ç‚¹å±æ€§çš„ç»“æ„ä½“ä¸­è¯»å–åˆ°ï¼ˆ<code>hbDNNTensorProperties</code>ï¼‰ï¼Œå› æ­¤æ— éœ€ç‰¹åˆ«å…³æ³¨ã€‚</p>
<h3 data-id="heading-32">8.5 å›¾åƒ tensor è·¨è·å¯¹é½</h3>
<p>å¾ç¨‹ 6EMB å¯¹äº Pyramid/Resizer æ¨¡å‹çš„å›¾åƒè¾“å…¥ï¼Œè¦æ±‚ W32 å¯¹é½ï¼Œå¾ç¨‹ 6PH è¦æ±‚ W64 å¯¹é½ã€‚è‹¥æ‚¨æœ‰ å¾ç¨‹ 6 ä¸åŒæ¶æ„å¹³å°è¿ç§»çš„åœºæ™¯ï¼Œè¯·æ³¨æ„è·¨è·å¯¹é½è¦æ±‚çš„å·®å¼‚ã€‚</p>
<p>éƒ¨ç½²ä»£ç å»ºè®®æ‚¨é¿å… hard codeï¼Œæ¨èåŸºäºæ¨¡å‹èŠ‚ç‚¹å±æ€§ä¸­çš„ validShapeï¼ˆå¼ é‡æœ‰æ•ˆå†…å®¹å°ºå¯¸ï¼‰å’Œ strideï¼ˆå¼ é‡å„ç»´åº¦æ­¥é•¿ï¼‰è¿›è¡Œè§£æå’Œä½¿ç”¨ã€‚</p>
<h4 data-id="heading-33">8.5.1 Pyramid è¾“å…¥</h4>
<p>Pyramid è¾“å…¥ tensor å‡†å¤‡çš„å‚è€ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">hbDNNTensor *input = input_tensor;
for (int i = 0; i &lt; input_count; i++) {
HB_CHECK_SUCCESS(
    hbDNNGetInputTensorProperties(&amp;input[i].properties, dnn_handle, i),
    "hbDNNGetInputTensorProperties failed");
    
    auto dim_len = input[i].properties.validShape.numDimensions;    // è·å–ç»´åº¦ä¿¡æ¯
    for (int32_t dim_i = dim_len - 1; dim_i &gt;= 0; --dim_i) {
      if (input[i].properties.stride[dim_i] == -1) {                // stride=-1å³ä¸ºåŠ¨æ€
        auto cur_stride =                                           // è®¡ç®—å½“å‰ç»´åº¦stride
            input[i].properties.stride[dim_i + 1] *
            input[i].properties.validShape.dimensionSize[dim_i + 1];
        input[i].properties.stride[dim_i] = ALIGN_32(cur_stride);   // 32å¯¹é½
      }
    }

    int input_memSize = input[i].properties.stride[0] *             // è®¡ç®—å†…å­˜å¤§å°
                        input[i].properties.validShape.dimensionSize[0];
    HB_CHECK_SUCCESS(hbUCPMallocCached(&amp;input[i].sysMem[0], input_memSize, 0),
                     "hbUCPMallocCached failed");
    
    const char *input_name;
    HB_CHECK_SUCCESS(hbDNNGetInputName(&amp;input_name, dnn_handle, i),    // è·å–èŠ‚ç‚¹åç§°
                     "hbDNNGetInputName failed");
}
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">ucp_tutorial/dnn/basic_samples/code/00_quick_start/resnet_nv12/src/main.cc
</code></pre>
<p>â€‹<strong>æ³¨æ„</strong>â€‹ï¼š</p>
<p>è§†é¢‘é€šè·¯ä¸Šçš„é‡‘å­—å¡”ç¡¬ä»¶ï¼Œå…¶è¾“å‡ºå±‚æ”¯æŒé…ç½® yã€uv çš„ strideï¼Œä½†ä»…è¦æ±‚ W16 å¯¹é½ï¼Œè‹¥æ•°æ®éœ€è¦å–‚ç»™ BPU æ¨ç†æ¨¡å‹ï¼Œå»ºè®®ç›´æ¥æŒ‰ BPU çš„è·¨è·å¯¹é½è¦æ±‚æ¥é…ç½®ã€‚é‡‘å­—å¡”ç¡¬ä»¶çš„æ›´å¤šä¿¡æ¯è¯·å‚è€ƒç³»ç»Ÿè½¯ä»¶ç”¨æˆ·æ‰‹å†Œã€‚</p>
<h4 data-id="heading-34">8.5.2 Resizer è¾“å…¥</h4>
<p>Resizer è¾“å…¥çš„ Hã€W ä¹Ÿæ˜¯åŠ¨æ€çš„ï¼Œå› æ­¤éœ€è¦è®¾ç½®ä¸ºåŸå›¾å°ºå¯¸ï¼Œå¹¶è®¡ç®—å¥½ W32 å¯¹é½çš„ Strideï¼›ROI ä½œä¸ºæ¨¡å‹è¾“å…¥èŠ‚ç‚¹ï¼Œä¹Ÿéœ€è¦å¯¹å…¶è¿›è¡Œèµ‹å€¼ã€‚ä»¥ä¸‹ä¸ºå‚è€ƒä»£ç ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">#define ALIGN(value, alignment) (((value) + ((alignment)-1)) &amp; ~((alignment)-1))
#define ALIGN_32(value) ALIGN(value, 32)

int prepare_image_tensor(const std::vector&lt;hbUCPSysMem&gt; &amp;image_mem, int input_h,
                         int input_w, hbDNNHandle_t dnn_handle,
                         std::vector&lt;hbDNNTensor&gt; &amp;input_tensor) {
  // å‡†å¤‡Yã€UVè¾“å…¥tensor
  for (int i = 0; i &lt; 2; i++) {
    HB_CHECK_SUCCESS(hbDNNGetInputTensorProperties(&amp;input_tensor[i].properties,
                                                   dnn_handle, i),
                     "hbDNNGetInputTensorProperties failed");
    // auto w_stride = ALIGN_32(input_w);
    // int32_t y_mem_size = input_h * w_stride;
    input_tensor[i].sysMem[0] = image_mem[i];

    // é…ç½®åŸå›¾å¤§å°ï¼ŒNHWC
    input_tensor[i].properties.validShape.dimensionSize[1] = input_h;
    input_tensor[i].properties.validShape.dimensionSize[2] = input_w;
    if (i == 1) {
      // UVè¾“å…¥å¤§å°ä¸ºYçš„1/2
      input_tensor[i].properties.validShape.dimensionSize[1] /= 2;
      input_tensor[i].properties.validShape.dimensionSize[2] /= 2;
    }

    // strideæ»¡è¶³32å¯¹é½
    input_tensor[i].properties.stride[1] =
        ALIGN_32(input_tensor[i].properties.stride[2] *
                 input_tensor[i].properties.validShape.dimensionSize[2]);
    input_tensor[i].properties.stride[0] =
        input_tensor[i].properties.stride[1] *
        input_tensor[i].properties.validShape.dimensionSize[1];
  }
  return 0;
}

// å‡†å¤‡roiè¾“å…¥tensor
int prepare_roi_tensor(const hbUCPSysMem *roi_mem, hbDNNHandle_t dnn_handle,
                       int32_t roi_tensor_id, hbDNNTensor *roi_tensor) {
  HB_CHECK_SUCCESS(hbDNNGetInputTensorProperties(&amp;roi_tensor-&gt;properties,
                                                 dnn_handle, roi_tensor_id),
                   "hbDNNGetInputTensorProperties failed");
  roi_tensor-&gt;sysMem[0] = *roi_mem;
  return 0;
}

int prepare_roi_mem(const std::vector&lt;hbDNNRoi&gt; &amp;rois,
                    std::vector&lt;hbUCPSysMem&gt; &amp;roi_mem) {
  auto roi_size = rois.size();
  roi_mem.resize(roi_size);
  for (auto i = 0; i &lt; roi_size; ++i) {
    int32_t mem_size = 4 * sizeof(int32_t);
    HB_CHECK_SUCCESS(hbUCPMallocCached(&amp;roi_mem[i], mem_size, 0),
                     "hbUCPMallocCached failed");
    int32_t *roi_data = reinterpret_cast&lt;int32_t *&gt;(roi_mem[i].virAddr);
    roi_data[0] = rois[i].left;
    roi_data[1] = rois[i].top;
    roi_data[2] = rois[i].right;
    roi_data[3] = rois[i].bottom;
    hbUCPMemFlush(&amp;roi_mem[i], HB_SYS_MEM_CACHE_CLEAN);
  }
  return 0;
}
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">ucp_tutorial/dnn/basic_samples/code/02_advanced_samples/roi_infer/src/roi_infer.cc
</code></pre>
<h3 data-id="heading-35">8.6 å°æ¨¡å‹æ‰¹é‡å¤„ç†åŠŸèƒ½</h3>
<p>ç”±äº BPU æ˜¯èµ„æºç‹¬å å¼ç¡¬ä»¶ï¼Œæ‰€ä»¥å¯¹äº Latency å¾ˆå°çš„æ¨¡å‹è€Œè¨€ï¼Œå…¶æ¡†æ¶è°ƒåº¦å¼€é”€å æ¯”ä¼šç›¸å¯¹è¾ƒå¤§ã€‚åœ¨ å¾ç¨‹ 6 å¹³å°ï¼ŒUCP æ”¯æŒé€šè¿‡å¤ç”¨ task_handle çš„æ–¹å¼ï¼Œå°†å¤šä¸ªå°æ¨¡å‹ä»»åŠ¡ä¸€æ¬¡æ€§ä¸‹å‘ï¼Œå…¨éƒ¨æ‰§è¡Œå®Œæˆåå†ä¸€æ¬¡æ€§è¿”å›ï¼Œä»è€Œå¯å°† N æ¬¡æ¡†æ¶è°ƒåº¦å¼€é”€åˆå¹¶ä¸º 1 æ¬¡ï¼Œä»¥ä¸‹ä¸ºå‚è€ƒä»£ç ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">// è·å–æ¨¡å‹æŒ‡é’ˆå¹¶å­˜å‚¨
std::vector&lt;hbDNNHandle_t&gt; model_handles;

// å‡†å¤‡å„ä¸ªæ¨¡å‹çš„è¾“å…¥è¾“å‡ºï¼Œå‡†å¤‡è¿‡ç¨‹çœç•¥
std::vector&lt;std::vector&lt;hbDNNTensor&gt;&gt; inputs;
std::vector&lt;std::vector&lt;hbDNNTensor&gt;&gt; outputs;

// åˆ›å»ºä»»åŠ¡å¹¶è¿›è¡Œæ¨ç†
{
    // åˆ›å»ºå¹¶æ·»åŠ ä»»åŠ¡ï¼Œå¤ç”¨task_handle
    hbUCPTaskHandle_t task_handle{nullptr};
    for(size_t task_id{0U}; task_id &lt; inputs.size(); task_id++){
        hbDNNInferV2(&amp;task_handle, outputs[task_id].data(), inputs[task_id].data(), model_handles[i]);
    }
    
    // æäº¤ä»»åŠ¡
    hbUCPSchedParam sche_param;
    HB_UCP_INITIALIZE_SCHED_PARAM(&amp;sche_param);
    sche_param.backend = HB_UCP_BPU_CORE_ANY;
    hbUCPSubmitTask(task_handle, &amp;sche_param);
    
    // ç­‰å¾…ä»»åŠ¡å®Œæˆ
    hbUCPWaitTaskDone(task_handle, 0);
}
</code></pre>
<h3 data-id="heading-36">8.7 ä¼˜å…ˆçº§è°ƒåº¦/æŠ¢å </h3>
<p>UCP æ”¯æŒä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦å’ŒæŠ¢å ï¼Œå¯é€šè¿‡ <code>hbUCPSchedParam</code> ç»“æ„ä½“è¿›è¡Œé…ç½®ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li><code>priority</code> &gt; <code>customId</code> &gt; submit_timeï¼ˆä»»åŠ¡æäº¤æ—¶é—´ï¼‰</li>
<li><code>priority</code> æ”¯æŒ [0ï¼Œ 255]ï¼Œå¯¹äºæ¨¡å‹ä»»åŠ¡è€Œè¨€ï¼š</li>
</ul>
<p>[0ï¼Œ 253] ä¸ºæ™®é€šä¼˜å…ˆçº§ï¼Œä¸å¯æŠ¢å å…¶ä»–ä»»åŠ¡ï¼Œä½†åœ¨æœªæ‰§è¡Œæ—¶æ”¯æŒæŒ‰ä¼˜å…ˆçº§è¿›è¡Œæ’é˜Ÿ</p>
<p>254 ä¸º high æŠ¢å ä»»åŠ¡ï¼Œå¯æ”¯æŒæŠ¢å æ™®é€šä»»åŠ¡</p>
<p>255 ä¸º urgent æŠ¢å ä»»åŠ¡ï¼Œå¯æŠ¢å æ™®é€šä»»åŠ¡å’Œ high æŠ¢å ä»»åŠ¡</p>
<p>å¯è¢«ä¸­æ–­æŠ¢å çš„ä½ä¼˜ä»»åŠ¡ï¼Œéœ€è¦åœ¨æ¨¡å‹ç¼–è¯‘é˜¶æ®µé…ç½® <code>max_time_per_fc</code> å‚æ•°æ‹†åˆ†æ¨¡å‹æŒ‡ä»¤</p>
<ul>
<li>å…¶ä»– backend ä»»åŠ¡ï¼Œpriority æ”¯æŒ [0ï¼Œ 255]ï¼Œä½†ä¸æ”¯æŒæŠ¢å ï¼Œå¯ä»¥è®¤ä¸ºéƒ½æ˜¯æ™®é€šä¼˜å…ˆçº§</li>
</ul>
<h3 data-id="heading-37">8.8 X86 ä»¿çœŸ</h3>
<p>å¾ç¨‹ 6 å·¥å…·é“¾åœ¨ X86 ç«¯æ”¯æŒ hbm æŒ‡ä»¤ä»¿çœŸï¼Œä½†æ•ˆç‡éå¸¸ä½ï¼Œæ‰€ä»¥æ›´æ¨èä½¿ç”¨ quantized.bc æ¨¡å‹è¿›è¡Œæ¨ç†ï¼Œå…¶å®šç‚¹éƒ¨åˆ†å’Œ hbm æ•°å€¼äºŒè¿›åˆ¶ä¸€è‡´ï¼Œæµ®ç‚¹éƒ¨åˆ†å¯èƒ½å­˜åœ¨æ¶æ„æœ¬èº«å·®å¼‚ï¼Œä½†é€šå¸¸å¯¹ç²¾åº¦å½±å“å¯å¿½ç•¥ä¸è®¡ã€‚</p>
<p>å¾ç¨‹ 6B å¹³å° X86 ä»¿çœŸéœ€è¦é…ç½®å¦‚ä¸‹ç¯å¢ƒå˜é‡ï¼Œé»˜è®¤æ¶æ„ä¸º"nash-m"ï¼š</p>
<p>export HB_UCP_SIM_PLATFORM_TYPE=nash-b</p>
<h4 data-id="heading-38">8.8.1 æ¨ç† quantized.bc</h4>
<p><strong>Python æ¨ç†ï¼š</strong></p>
<p>quantized.bc åœ¨ X86 ç«¯çš„æ¨ç†ï¼Œå¯ä»¥ä½¿ç”¨ <code>horizon_tc_ui</code> åŒ…å°è£…çš„ <code>HBRuntime</code> æ¥å£ï¼Œå…·ä½“å¯è§ç”¨æˆ·æ‰‹å†Œã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fptq%2Fptq_tool%2Fhbruntime.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ptq/ptq_tool/hbruntime.html" ref="nofollow noopener noreferrer">è®­ç»ƒåé‡åŒ–-PTQ è½¬æ¢å·¥å…·-HBRuntime æ¨ç†åº“</a>ã€‹ï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">import numpy as np
from horizon_tc_ui.hb_runtime import HBRuntime

sess = HBRuntime("quantized.bc")
input_names = sess.input_names
output_names = sess.output_names

data1 = np.load("input1.npy")
data2 = np.load("input2.npy")
input_feed = {input_names[0]: data1, input_names[1]: data2}

output = sess.run(output_names, input_feed)
</code></pre>
<p>quantized.bc ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨å…¶ func çš„ feed æ¥å£è¿›è¡Œæ¨ç†ï¼Œå…¶è¾“å…¥æ ¼å¼ä¹Ÿä¸º dictï¼Œvalue æ”¯æŒ torch.tensor å’Œ np.array ä¸¤ç§ç±»å‹ï¼Œè¾“å‡ºæ ¼å¼ä¸è¾“å…¥æ ¼å¼ä¿æŒä¸€è‡´ã€‚å‚è€ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">import numpy as np
from hbdk4.compiler import load

hbir = load("quantized.bc")
func = hbir[0]

data1 = np.load("input1.npy")
data2 = np.load("input2.npy") 
input_feed = {inputs[0].name: data1, inputs[1].name: data2}
hbir_outputs = func.feed(input_feed)
</code></pre>
<p><strong>C++ æ¨ç†ï¼š</strong></p>
<p>quantized.bc çš„ C++ æ¨ç†æ¥å£å¤ç”¨ hbm UCP æ¨ç†æ¥å£ï¼Œä»… so åŠ¨æ€åº“éœ€è¦æ›¿æ¢æˆ X86 ç‰ˆæœ¬å³å¯ã€‚ æ‚¨ä¹Ÿå¯ä»¥åœ¨ X86 ç«¯ä½¿ç”¨ <code>hrt_model_exec</code> å·¥å…·å¯¹ quantized.bc è¿›è¡Œæ¨¡å‹ä¿¡æ¯æŸ¥çœ‹å’Œå•å¸§æ¨ç†ã€‚</p>
<h4 data-id="heading-39">8.8.2 æ¨ç† hbm</h4>
<p>ç”±äº X86 ç«¯ hbm æ¨ç†ä¸ºæŒ‡ä»¤ä»¿çœŸï¼Œè¿è¡Œé€Ÿåº¦éå¸¸æ…¢ï¼Œå› æ­¤å·¥å…·é“¾æä¾›äº† <code>hbm_infer</code> å·¥å…·ä»¥ä¾¿ç”¨æˆ·åœ¨æœåŠ¡å™¨ç«¯ç»™ç›´è¿çš„å¼€å‘æ¿ä¸‹å‘æ¨ç†ä»»åŠ¡ã€‚æœ¬æ–‡åªä»‹ç»æœ€ç®€å•çš„å•è¿›ç¨‹ä½¿ç”¨æ–¹å¼ï¼Œå¤šè¿›ç¨‹ã€å¤šé˜¶æ®µæ¨¡å‹è¾“å…¥è¾“å‡ºçš„ä¼ è¾“ä¼˜åŒ–ï¼Œä»¥åŠç»Ÿè®¡æ¨¡å‹æ¨ç†ã€ç½‘ç»œä¼ è¾“è€—æ—¶ç­‰åŠŸèƒ½è¯·å‚è€ƒç”¨æˆ·æ‰‹å†Œã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oe.horizon.auto%2Fguide%2Fucp%2Fruntime%2Ftool_introduction%2Fhbm_infer.html" target="_blank" title="https://docs.oe.horizon.auto/guide/ucp/runtime/tool_introduction/hbm_infer.html" ref="nofollow noopener noreferrer">hbm_infer å·¥å…·ä»‹ç»</a>ã€‹ã€‚</p>
<pre><code class="hljs language-Plain" lang="Plain"># hbmä¹Ÿå¯ä¼ å…¥ä¸€ä¸ªlistï¼Œæ¨ç†æ—¶é€šè¿‡æŒ‡å®šmodel_nameæ¥é€‰æ‹©æ¨ç†å“ªä¸ªæ¨¡å‹ï¼Œæ¨ç†æ‰€ç”¨çš„.soå³å¯åªä¼ è¾“ä¸€æ¬¡
hbm_model = HbmRpcSession(
    host="xx.xx.xx.xx",
    local_hbm_path="xx.hbm", 
)

# æ‰“å°æ¨¡å‹è¾“å…¥è¾“å‡ºä¿¡æ¯
hbm_model.show_input_output_info()

# å‡†å¤‡è¾“å…¥æ•°æ®
input_data = {
    'img': torch.ones((1, 3, 224, 224), dtype=torch.int8)
}

# æ‰§è¡Œæ¨ç†å¹¶è¿”å›ç»“æœ
# è‹¥ä¼ å…¥çš„æ˜¯listï¼Œéœ€è¦æ­£ç¡®æŒ‡å®šmodel_name
# output_data = hbm_model(input_data, model_name=model_name)
output_data = hbm_model(input_data) 

print([output_data[k].shape for k in output_data])

# å…³é—­server
hbm_model.close_server()
</code></pre>
<h2 data-id="heading-40">9.UCP è§†è§‰å¤„ç†/é«˜æ€§èƒ½ç®—å­</h2>
<p>é™¤æ¨¡å‹æ¨ç†å¤–ï¼ŒUCP è¿˜æä¾›äº†è§†è§‰å¤„ç†å’Œé«˜æ€§èƒ½ç®—å­ä¸¤å¤§æ–¹å‘çš„å¤šç§ç®—å­æ¥å£ï¼Œå¯æ”¯æŒè¯¸å¦‚ Remapã€Jpegã€H264/265ã€FFT/IFF ç­‰åŠŸèƒ½ï¼Œè¿™äº›ç®—å­åº•å±‚æ˜¯åŸºäºåœ°å¹³çº¿ SOC ä¸Šä¸åŒç¡¬ä»¶ IP è¿›è¡Œçš„å°è£…ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„è°ƒç”¨æ¥å£ã€‚</p>
<p>æ›´å¤šä¿¡æ¯å¯å‚è€ƒç”¨æˆ·æ‰‹å†Œã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fucp%2Fucp_overview.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ucp/ucp_overview.html" ref="nofollow noopener noreferrer">ç»Ÿä¸€è®¡ç®—å¹³å°</a>ã€‹çš„ç›¸å…³ç« èŠ‚ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ol>
<li>æ¿ç«¯å®é™…éƒ¨ç½²æ—¶ï¼ŒISP åˆ° Pyramid çš„è§†é¢‘é€šè·¯ä¸å»ºè®®ä½¿ç”¨ UCPï¼Œæ— æ³•å®ç°æ•°æ® Onlineï¼Œå»ºè®®ç›´æ¥è°ƒç”¨åº•è½¯æ¥å£è¿›è¡ŒåŠŸèƒ½å®ç°ã€‚</li>
<li>åŸºäº DSP Backend å®ç°çš„ HPL ç®—å­ï¼Œåœ¨ å¾ç¨‹ 6B å¹³å°ä»…ä¼šæä¾› å¾ç¨‹ 6EM ä¸Š Q8 å®ç°çš„æºç ï¼Œå¦‚éœ€åœ¨ å¾ç¨‹ 6B ä¸Šä½¿ç”¨ HPL ç®—å­ï¼Œéœ€è¦æ‚¨è‡ªè¡Œé€‚é… V130 å¹¶ç¼–è¯‘é•œåƒã€‚VP ç®—å­å’Œ SLAM ç­‰ å¾ç¨‹ 6EM ä¸Šå·²æœ‰çš„ Q8 DSP sampleï¼Œå°†åœ¨ å¾ç¨‹ 6B åç»­æ­£å¼ç‰ˆæœ¬ä¸­æä¾› V130 ç‰ˆæœ¬ã€‚</li>
</ol>
<h2 data-id="heading-41">10.UCP è‡ªå®šä¹‰ç®—å­ï¼ˆDSPï¼‰</h2>
<p>ä¸ºäº†ç®€åŒ–ç”¨æˆ·å¼€å‘ï¼ŒUCP å°è£…äº†ä¸€å¥—åŸºäº RPC çš„å¼€å‘æ¡†æ¶ï¼Œæ¥å®ç° CPU å¯¹ DSP çš„åŠŸèƒ½è°ƒç”¨ï¼Œä½†å…·ä½“ DSP ç®—å­å®ç°ä»æ˜¯è°ƒç”¨ Cadence æ¥å£å»åšå¼€å‘ã€‚æ€»ä½“æ¥è¯´å¯åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<p>ä½¿ç”¨ Cadence æä¾›çš„å·¥å…·åŠèµ„æ–™å®Œæˆç®—å­å¼€å‘ï¼›</p>
<pre><code class="hljs language-Plain" lang="Plain">int test_custom_op(void *input, void *output, void *tm) {
  // custom impl
  return 0;
}
</code></pre>
<p>DSP ä¾§é€šè¿‡ UCP æä¾›çš„ API æ³¨å†Œç®—å­ï¼Œç¼–è¯‘å¸¦è‡ªå®šä¹‰ç®—å­çš„é•œåƒï¼›</p>
<pre><code class="hljs language-Plain" lang="Plain">// dspé•œåƒä¸­æ³¨å†Œè‡ªå®šä¹‰ç®—å­
hb_dsp_register_fn(cmd, test_custom_op, latency)
</code></pre>
<p>ARM ä¾§é€šè¿‡ UCP æä¾›çš„ç®—å­è°ƒç”¨æ¥å£ï¼Œå®Œæˆå¼€å‘æ¿ä¸Šçš„éƒ¨ç½²ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-Plain" lang="Plain">// å°†è¾“å…¥è¾“å‡ºçš„hbUCPSysMemæ˜ å°„ä¸ºDSPå¯è®¿é—®çš„å†…å­˜åœ°å€
hbUCPSysMem in;
hbUCPMalloc(&amp;in, in_size, 0)
hbDSPAddrMap(&amp;in, &amp;in)

hbUCPSysMem out;
hbUCPMalloc(&amp;out, out_size, 0)
hbDSPAddrMap(&amp;out, &amp;out)

// åˆ›å»ºå¹¶æäº¤DSPä»»åŠ¡
hbUCPTaskHandle_t taskHandle{nullptr};
hbDSPRpcV2(&amp;taskHandle, &amp;in, &amp;out, cmd)

hbUCPSchedParam ctrl_param;
HB_UCP_INITIALIZE_SCHED_PARAM(&amp;ctrl_param);
ctrl_param.backend = HB_UCP_DSP_CORE_ANY;
hbUCPSubmitTask(task_handle, &amp;ctrl_param);

// ç­‰å¾…ä»»åŠ¡å®Œæˆ
hbUCPWaitTaskDone(task_handle, 0);
</code></pre>
<p>æ›´å¤šä¿¡æ¯å¯è§ç”¨æˆ·æ‰‹å†Œã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fucp%2Fplugin%2Fdsp_develop%2Fdsp_intro.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ucp/plugin/dsp_develop/dsp_intro.html" ref="nofollow noopener noreferrer">ç»Ÿä¸€è®¡ç®—å¹³å°-è‡ªå®šä¹‰ç®—å­-DSP ç®—å­å¼€å‘</a>ã€‹ã€‚</p>
<h2 data-id="heading-42">11.æ€§èƒ½ç›‘æµ‹å·¥å…·</h2>
<p>å¾ç¨‹ 6 å¹³å° BPUã€DSP éƒ½æ˜¯ç‹¬å çš„ç¡¬ä»¶èµ„æºï¼Œä»»åŠ¡ä¸€æ—¦æäº¤å°±ä¼šç‹¬å æ¨ç†ï¼ŒUCP ä¾§ä»…èƒ½é€šè¿‡ <code>hrt_ucp_monitor</code> å·¥å…·å»ç›‘æµ‹å…¶ç¡¬ä»¶å ç”¨ç‡ï¼ˆé‡‡æ ·é¢‘ç‡æ”¯æŒé…ç½® [10ï¼Œ 1000]ï¼Œé»˜è®¤ 500ï¼‰ï¼Œå¹¶ä¸”èƒ½æŸ¥çœ‹åˆ° DDR å†…å­˜å ç”¨æƒ…å†µã€‚</p>
<p><img src="http://openwrite.cn/uploads/19742/59443/5a9ecb7e-7ed0-4d6e-a605-da2b9e42c012.png" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-43">12.QNX å¸¦æ¥çš„åŠŸèƒ½è£å‰ª</h2>
<ol>
<li><strong>UCP Service ï¼ˆä¸­ç»§æ¨¡å¼ï¼‰</strong>ï¼š
UCP æ¡†æ¶æ”¯æŒä¸¤ç§ä¸»è¦å·¥ä½œæ¨¡å¼ï¼šç›´è¿æ¨¡å¼ã€ä¸­ç»§æ¨¡å¼ã€‚ç³»ç»Ÿé»˜è®¤è¿è¡Œåœ¨ç›´è¿æ¨¡å¼ä¸‹ï¼Œåœ¨ä¸­ç»§æ¨¡å¼ä¸‹ï¼ŒUCP å°†æ”¯æŒè·¨è¿›ç¨‹ä»»åŠ¡ä¼˜å…ˆçº§çš„ç»Ÿä¸€è°ƒåº¦ã€‚ä½† QNX ä¸Šè·¨è¿›ç¨‹è°ƒåº¦çš„æ¨¡å‹æ€§èƒ½è¾ƒå·®ï¼Œä¸æ»¡è¶³ä½¿ç”¨éœ€æ±‚ï¼Œæ•…åŠŸèƒ½ç§»é™¤ã€‚</li>
<li><strong>UCP Trace</strong>ï¼š UCP trace é€šè¿‡åœ¨ UCP æ‰§è¡Œçš„å…³é”®è·¯å¾„ä¸ŠåµŒå…¥ trace è®°å½•ï¼Œæä¾›æ·±å…¥åˆ†æ UCP åº”ç”¨ç¨‹åºè°ƒåº¦é€»è¾‘çš„èƒ½åŠ›ã€‚åœ¨å‡ºç°æ€§èƒ½å¼‚å¸¸æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ†æ UCP traceï¼Œå¿«é€Ÿæ‰¾åˆ°å¼‚å¸¸å‘ç”Ÿçš„æ—¶é—´ç‚¹ã€‚ä½† QNX åº•è½¯ä¸æ”¯æŒ Trace åŠŸèƒ½ï¼Œæ•…ç§»é™¤ã€‚</li>
<li><strong>DEB éƒ¨ç½²åŒ…</strong>ï¼š ç”¨äºç®€åŒ–æ¿ç«¯éƒ¨ç½²ï¼Œå¯é€šè¿‡è‡ªåŠ¨å®‰è£…æ‰€éœ€çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œç›¸å…³ä¾èµ–åº“ï¼Œå¿«é€Ÿè®¾ç½®å¹¶è¿è¡Œ UCP ç›¸å…³çš„åº”ç”¨ç¨‹åºï¼Œå…·ä½“åŒ…æ‹¬ï¼š<code>ucp_service</code> å’Œ <code>hrt_ucp_monitor</code>ã€‚ä½†é‰´äº <code>ucp_service</code> ä¸æ”¯æŒï¼Œè¯¥åŠŸèƒ½ä¹Ÿç§»é™¤ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‡Œæ™¨çªè¢­ï¼GPT-5.3-Codexæ‰‹æ’•ä»£ç ï¼ŒOpenAIè®©AIå¼€å§‹é€ AIäº†]]></title>    <link>https://juejin.cn/post/7603567912592244763</link>    <guid>https://juejin.cn/post/7603567912592244763</guid>    <pubDate>2026-02-06T12:18:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912592244763" data-draft-id="7603567912592228379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‡Œæ™¨çªè¢­ï¼GPT-5.3-Codexæ‰‹æ’•ä»£ç ï¼ŒOpenAIè®©AIå¼€å§‹é€ AIäº†"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-06T12:18:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨é£å¦‚é›ª"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‡Œæ™¨çªè¢­ï¼GPT-5.3-Codexæ‰‹æ’•ä»£ç ï¼ŒOpenAIè®©AIå¼€å§‹é€ AIäº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨é£å¦‚é›ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:18:49.000Z" title="Fri Feb 06 2026 12:18:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨è¿™ä¸ª2026å¹´2æœˆçš„å¯’å†·æ¸…æ™¨ï¼Œç§‘æŠ€åœˆçš„å¾ˆå¤šå¼€å‘è€…å¤§æ¦‚åˆæ˜¯è¢«æ‰‹æœºéœ‡é†’çš„ã€‚</p>
<p>å°±åœ¨å‡ ä¸ªå°æ—¶å‰ï¼Œç¡…è°·ä¸Šæ¼”äº†ä¸€åœºç»å…¸çš„â€œç¥ä»™æ‰“æ¶â€ã€‚Anthropicå‰è„šåˆšå‘å¸ƒClaude Opus 4.6ï¼ŒOpenAIåè„šå°±ç”©å‡ºäº†GPT-5.3-Codexã€‚ç›¸å·®ä¸è¿‡å‡ åˆ†é’Ÿï¼Œä½†è¿™ä¸ä»…ä»…æ˜¯å·§åˆï¼Œæ›´æ˜¯ä¸¤æ¡è·¯çº¿çš„æ­£é¢ç¡¬åˆšã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fdfasgfdg.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/dfasgfdg.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64a23f1d5ea94e17ab0ba545b561ebe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770985128&amp;x-signature=wNOaZHJxg%2F6CiXtoHR11MneXyxs%3D" alt="dfasgfdg" loading="lazy"/></a></p>
<p>å¦‚æœä½ è¿˜ä»¥ä¸ºè¿™åªæ˜¯åˆä¸€æ¬¡å¸¸è§„çš„æ¨¡å‹å‡çº§ï¼Œåªæ˜¯å†™ä»£ç ç¨å¾®å¿«ä¸€ç‚¹ï¼Œé‚£ä½ å°±å¤§é”™ç‰¹é”™äº†ã€‚æ ¹æ®ç›®å‰æµå‡ºçš„å„è·¯è¯„æµ‹å’Œåª’ä½“æŠ¥é“ï¼ŒOpenAIè¿™æ¬¡æ²¡æ‰“ç®—å’Œä½ èŠâ€œèŠå¤©æœºå™¨äººâ€ï¼Œä»–ä»¬ç›´æ¥æŠŠâ€œå…¨èƒ½æ™ºèƒ½ä½“â€æ‘†ä¸Šäº†æ¡Œé¢ã€‚</p>
<h3 data-id="heading-0">ä¸åªæ˜¯å†™ä»£ç ï¼Œå®ƒæ˜¯ä½ çš„ç¡…è°·åˆä¼™äºº</h3>
<p>å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨Copilotæˆ–è€…ChatGPTæ—¶ï¼Œå¿ƒé‡Œæ˜¯æœ‰é¢„æœŸçš„ï¼šå®ƒæ˜¯ä¸ªåŠ©æ‰‹ï¼Œæˆ‘å¾—ç›¯ç€å®ƒï¼Œå› ä¸ºè¿™è´§éšæ—¶å¯èƒ½èƒ¡è¨€ä¹±è¯­ã€‚</p>
<p>ä½†GPT-5.3-Codexçš„å®šä½å½»åº•å˜äº†ã€‚å®ƒä¸å†æ»¡è¶³äºå½“ä½ æ•²ä»£ç æ—¶çš„è‡ªåŠ¨è¡¥å…¨å·¥å…·ï¼Œå®ƒæƒ³æ¥ç®¡ä½ çš„æ•´ä¸ªå·¥ä½œæµã€‚</p>
<p>ç°åœ¨çš„å®ƒï¼Œèƒ½ä»å¤´åˆ°å°¾å¹²å®Œä¸€å¥—æ´»ï¼šå†™ä»£ç ã€è‡ªå·±è°ƒè¯•ã€è·‘å•å…ƒæµ‹è¯•ã€å»ç»ˆç«¯ç¯å¢ƒé‡Œé…ç½®æœåŠ¡å™¨ï¼Œç”šè‡³æœ€åè¿˜èƒ½å¸®ä½ æŠŠäº§å“æ–‡æ¡£ï¼ˆPRDï¼‰å’ŒPPTå†™å¥½ã€‚ä»¥å‰æˆ‘ä»¬è¯´AIæ˜¯â€œå‰¯é©¾é©¶â€ï¼Œç°åœ¨çš„æ„Ÿè§‰æ˜¯ï¼Œå®ƒæƒ³åä¸»é©¾é©¶ä½ï¼Œä½ åªè¦åœ¨æ—è¾¹å–å’–å•¡å–Šå£å·å°±è¡Œã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fadgdfg-1024x566.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/adgdfg-1024x566.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6aabe2dd9394ec0b6589bb5ef1ae38f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770985128&amp;x-signature=9uwL013SoX6Guj0tCSaXh%2FDye7c%3D" alt="adgdfg" loading="lazy"/></a></p>
<p>è¿™ç§åº•æ°”æ¥è‡ªå“ªé‡Œï¼Ÿçœ‹çœ‹æ•°æ®å°±çŸ¥é“äº†ã€‚</p>
<p>åœ¨Terminal-Bench 2.0è¿™ä¸ªä¸“é—¨æµ‹è¯•ç»ˆç«¯æ“ä½œå’Œç¯å¢ƒé…ç½®çš„è€ƒåœºä¸Šï¼ŒGPT-5.3-Codexæ‹¿ä¸‹äº†77.3%çš„é«˜åˆ†ã€‚ä½œä¸ºå¯¹æ¯”ï¼Œä¸Šä¸€ä»£è¿˜åœ¨64%å¾˜å¾Šã€‚è¿™æ„å‘³ç€åœ¨é¢å¯¹é‚£äº›è®©äººå¤´ç§ƒçš„é»‘æ¡†å‘½ä»¤è¡Œæ—¶ï¼Œå®ƒçš„è¡¨ç°å·²ç»ä¸ä»…æ˜¯â€œèƒ½ç”¨â€ï¼Œè€Œæ˜¯â€œç²¾é€šâ€ã€‚</p>
<p>æ›´æ€äººè¯›å¿ƒçš„æ˜¯ï¼Œæœ‰æ•°æ®æ˜¾ç¤ºï¼Œåœ¨è¿™ä¸€é¡¹ä¸Šå®ƒæ¯”éš”å£åŒæœŸå‘å¸ƒçš„Claude Opus 4.6é«˜å‡ºäº†å°†è¿‘12ä¸ªç™¾åˆ†ç‚¹ã€‚è™½ç„¶Claudeåœ¨é•¿æ–‡æœ¬æ¨ç†ä¸Šä¾ç„¶å¼ºæ‚ï¼Œä½†åœ¨è¿™ç§è¿˜è¦åŠ¨æ‰‹å¹²è„æ´»ç´¯æ´»çš„å·¥ç¨‹èƒ½åŠ›ä¸Šï¼ŒOpenAIè¿™æ¬¡ç¡®å®ç§€äº†ä¸€æŠŠè‚Œè‚‰ã€‚</p>
<h3 data-id="heading-1">å¿«ï¼Œè€Œä¸”çœ</h3>
<p>å¯¹äºä¼ä¸šä¸»å’Œå¼€å‘è€…æ¥è¯´ï¼Œæ€§èƒ½å¼ºå›ºç„¶å¥½ï¼Œä½†â€œè´µâ€æ˜¯åŸç½ªã€‚</p>
<p>è¿™æ¬¡æ›´æ–°æœ€è®©æˆ‘æ„Ÿåˆ°æ„å¤–çš„ï¼Œä¸æ˜¯å®ƒèƒ½è€ƒå¤šå°‘åˆ†ï¼Œè€Œæ˜¯å®ƒçš„æ•ˆç‡ã€‚æ ¹æ®æµ‹è¯•ï¼ŒGPT-5.3-Codexåœ¨å®ŒæˆåŒç­‰å¤æ‚åº¦çš„ä»»åŠ¡æ—¶ï¼Œæ¶ˆè€—çš„Tokenæ•°é‡ç›´æ¥ç åŠã€‚ä¸æ­¤åŒæ—¶ï¼Œæ¨ç†é€Ÿåº¦æå‡äº†25%ã€‚</p>
<p>è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿæ„å‘³ç€å®ƒçš„åºŸè¯å˜å°‘äº†ï¼Œç›´å‡»ç—›ç‚¹çš„èƒ½åŠ›å˜å¼ºäº†ã€‚ä»¥å‰ä½ å¾—è·ŸAIæ¥å›æ‹‰æ‰¯åå‡ ä¸ªå›åˆæ‰èƒ½ä¿®å¥½çš„Bugï¼Œç°åœ¨å¯èƒ½ä¸‰ä¸¤ä¸‹å°±è§£å†³äº†ã€‚è¿™ä¸ä»…ä»…æ˜¯çœé’±ï¼Œæ›´æ˜¯çœå‘½â€”â€”æ¯•ç«Ÿè°ä¹Ÿä¸æƒ³åœ¨å¤§åŠå¤œé™ªAIç©çŒœè°œæ¸¸æˆã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fagdfgfdgh.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/agdfgfdgh.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d745f35db4541be884def24363679bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770985128&amp;x-signature=1c0QZ4OsHu7gjR4STWnTgAriGPY%3D" alt="agdfgfdgh" loading="lazy"/></a></p>
<p>è¿˜æœ‰ä¸€ä¸ªéå¸¸äººæ€§åŒ–çš„æ”¹è¿›ï¼š<strong>å®æ—¶å¼•å¯¼</strong>ã€‚ä»¥å‰çš„ä»»åŠ¡æ˜¯â€œç¦»æ‰‹ä¸ç®¡â€ï¼Œä½ å‘äº†æŒ‡ä»¤å°±å¾—å¹²ç­‰ç»“æœã€‚ç°åœ¨ä½ å¯ä»¥åƒæŒ‡å¯¼ååœ¨ä½ å·¥ä½æ—çš„å®ä¹ ç”Ÿä¸€æ ·ï¼Œä¸­é—´éšæ—¶æ’å˜´ï¼šâ€œä¸å¯¹ï¼Œè¿™ä¸ªæ–¹å‘é”™äº†ï¼Œæ¢ä¸ªåº“è¯•è¯•ã€‚â€è¿™ç§äº¤äº’æ¨¡å¼çš„æ”¹å˜ï¼Œæ‰æ˜¯çœŸæ­£è®©AIèå…¥å›¢é˜Ÿçš„å…³é”®ã€‚</p>
<p><strong>ç»†æ€ææçš„â€œè‡ªæˆ‘è¿­ä»£â€</strong></p>
<p>æ•´åœºå‘å¸ƒä¼šæœ€è®©æˆ‘èµ·é¸¡çš®ç–™ç˜©çš„ï¼Œå…¶å®æ˜¯OpenAIè½»ææ·¡å†™é€éœ²çš„ä¸€å¥è¯ï¼š</p>
<h3 data-id="heading-2">è¿™æ˜¯é¦–ä¸ªå‚ä¸äº†è‡ªèº«å¼€å‘è¿‡ç¨‹çš„æ¨¡å‹ã€‚</h3>
<p>æ²¡é”™ï¼ŒOpenAIçš„å·¥ç¨‹å¸ˆä»¬åœ¨è®­ç»ƒGPT-5.3-Codexæ—¶ï¼Œå·²ç»åœ¨ä½¿ç”¨å®ƒçš„æ—©æœŸç‰ˆæœ¬æ¥è°ƒè¯•è®­ç»ƒæµç¨‹ã€ç®¡ç†éƒ¨ç½²ç”šè‡³è¯Šæ–­é—®é¢˜äº†ã€‚</p>
<p>è¿™å¬èµ·æ¥å¾ˆåƒç§‘å¹»ç”µå½±çš„å¼€åœºç™½ï¼ŒAIå¼€å§‹é€šè¿‡è‡ªæˆ‘é€’å½’æ¥åŠ é€Ÿè¿›åŒ–ã€‚è™½ç„¶ç›®å‰è¿˜éœ€è¦äººç±»æŠŠæ§æ–¹å‘ï¼Œä½†è¿™å±‚çª—æˆ·çº¸æ…ç ´åï¼ŒæŠ€æœ¯è¿­ä»£çš„é€Ÿåº¦å¯èƒ½ä¼šè¶…å‡ºæˆ‘ä»¬çš„çº¿æ€§è®¤çŸ¥ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Frthfgfg.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/rthfgfg.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebf86829561649b19d34d702cf0a604a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770985128&amp;x-signature=l1e0yYeB%2F4ppf4I3JXTnSDnp5mo%3D" alt="rthfgfg" loading="lazy"/></a></p>
<p>å½“ç„¶ï¼Œèƒ½åŠ›è¶Šå¼ºï¼Œé£é™©è¶Šå¤§ã€‚OpenAIè¿™æ¬¡ä¹Ÿå¾ˆè°¨æ…ï¼Œå› ä¸ºè¿™ä¸œè¥¿çš„ç½‘ç»œæ”»å‡»èƒ½åŠ›ä¹Ÿè¢«è¯„å®šä¸ºâ€œé«˜â€ã€‚æ‰€ä»¥APIæ¥å£æš‚æ—¶æ²¡å¼€ï¼Œç›®å‰åªæœ‰ChatGPTçš„ä»˜è´¹ç”¨æˆ·ï¼ˆPlusã€Teamã€Enterpriseï¼‰å¯ä»¥é€šè¿‡Codexåº”ç”¨ã€å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰æˆ–IDEæ’ä»¶å°é²œã€‚ä¸ºäº†å®‰æŠšå®‰å…¨ç•Œï¼Œä»–ä»¬è¿˜ä¸“é—¨æäº†1000ä¸‡ç¾å…ƒæé˜²å¾¡ç ”ç©¶ã€‚</p>
<h3 data-id="heading-3">å†™åœ¨æœ€å</h3>
<p>çœ‹ç€æ‰‹ä¸­è¿™ä»½æ–°é²œå‡ºç‚‰çš„æŠ¥å‘Šï¼Œæˆ‘çš„æ„Ÿè§‰å¾ˆå¤æ‚ã€‚</p>
<p>ä¸€æ–¹é¢ï¼Œä½œä¸ºå·¥å…·ä½¿ç”¨è€…ï¼ŒGPT-5.3-Codexå¸¦æ¥çš„ç”Ÿäº§åŠ›é‡Šæ”¾æ˜¯è¯±äººçš„ã€‚å®ƒèƒ½å¸®æˆ‘ä»¬æå®šé‚£äº›ç¹ççš„æ–‡æ¡£ã€è®¨åŒçš„ç¯å¢ƒé…ç½®å’Œæ— ç©·æ— å°½çš„å•å…ƒæµ‹è¯•ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasdffgdfg.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asdffgdfg.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fcb3aadcd13456eb61c44223fe99ba7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770985128&amp;x-signature=J3YR3XL549SN0wYvFKShNxM2sAw%3D" alt="asdffgdfg" loading="lazy"/></a></p>
<p>å¦ä¸€æ–¹é¢ï¼Œä½œä¸ºä»ä¸šè€…ï¼Œæˆ‘ä»¬ä¹Ÿæ¸…æ™°åœ°çœ‹åˆ°äº†é—¨æ§›çš„æå‡ã€‚å½“AIå·²ç»èƒ½ç†Ÿç»ƒæ“ä½œæ“ä½œç³»ç»Ÿã€èƒ½è‡ªæˆ‘Debugç”šè‡³èƒ½ä¼˜åŒ–è‡ªå·±çš„æ—¶å€™ï¼Œâ€œå†™ä»£ç â€è¿™é¡¹æŠ€èƒ½æœ¬èº«çš„æŠ¤åŸæ²³ï¼Œæ­£åœ¨è¢«ä»¥å‰æ‰€æœªæœ‰çš„é€Ÿåº¦å¡«å¹³ã€‚</p>
<p>2026å¹´çš„æ˜¥å¤©ï¼Œæ¯”ä»¥å¾€æ¥å¾—æ›´æ—©ä¸€äº›ï¼Œä¹Ÿæ›´çŒ›çƒˆä¸€äº›ã€‚å„ä½ï¼Œå‡†å¤‡å¥½è¿æ¥è¿™ä½æ–°åŒäº‹äº†å—ï¼Ÿ</p>
<p><strong>å¦‚æœä½ ä¹Ÿå¯¹æœ€æ–°çš„AIä¿¡æ¯æ„Ÿå…´è¶£æˆ–è€…æœ‰ç–‘é—® éƒ½å¯ä»¥åŠ å…¥æˆ‘çš„å¤§å®¶åº­ ç¬¬ä¸€æ—¶é—´åˆ†äº«æœ€æ–°AIèµ„è®¯ã€å·¥å…·ã€æ•™ç¨‹ã€æ–‡æ¡£ æ¬¢è¿ä½ çš„åŠ å…¥ï¼ï¼ï¼ğŸ˜‰ğŸ˜‰ğŸ˜‰</strong></p>
<p>å…¬ä¼—å·ï¼šå¢¨é£å¦‚é›ªå°ç«™</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Debian 12 ç¯å¢ƒä¸‹ PostgreSQL 15 éƒ¨ç½²ä¸å®‰å…¨é…ç½®]]></title>    <link>https://juejin.cn/post/7603321550247641138</link>    <guid>https://juejin.cn/post/7603321550247641138</guid>    <pubDate>2026-02-06T12:22:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603321550247641138" data-draft-id="7603321550247624754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Debian 12 ç¯å¢ƒä¸‹ PostgreSQL 15 éƒ¨ç½²ä¸å®‰å…¨é…ç½®"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-06T12:22:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Debian 12 ç¯å¢ƒä¸‹ PostgreSQL 15 éƒ¨ç½²ä¸å®‰å…¨é…ç½®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:22:24.000Z" title="Fri Feb 06 2026 12:22:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>1. ç³»ç»Ÿå®‰è£…</p>
<p>Debian 12 å®˜æ–¹ä»“åº“å·²åŒ…å« PostgreSQL 15ã€‚</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
sudo apt install postgresql postgresql<span class="hljs-operator">-</span>contrib <span class="hljs-operator">-</span>y
</code></pre>
<p>2. é˜²ç«å¢™é…ç½® (UFW)</p>
<p>ç¡®ä¿ç³»ç»Ÿé˜²ç«å¢™æ”¾è¡Œæ•°æ®åº“é»˜è®¤ç«¯å£ <strong>5432</strong>ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">sudo ufw allow 5432/tcp
sudo ufw reload
</code></pre>
<p>3. æ•°æ®åº“æƒé™ç®¡ç†</p>
<p>ç›´æ¥åœ¨ç»ˆç«¯è°ƒç”¨ <code>psql</code> ç®¡ç†å™¨åˆ›å»ºç¯å¢ƒï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä»¥ postgres ç®¡ç†å‘˜èº«ä»½è¿›å…¥</span>
sudo -u postgres psql

<span class="hljs-comment"># --- SQL æ‰§è¡ŒåŒºåŸŸ ---</span>
<span class="hljs-comment"># 1. åˆ›å»ºç”¨æˆ·å¹¶è®¾å¯†ç </span>
CREATE USER myuser WITH PASSWORD 'your_password'<span class="hljs-comment">;</span>

<span class="hljs-comment"># 2. åˆ›å»ºæ•°æ®åº“å¹¶æŒ‡å®šå½’å±</span>
CREATE DATABASE mydatabase OWNER myuser<span class="hljs-comment">;</span>

<span class="hljs-comment"># 3. æˆäºˆæ‰€æœ‰æƒé™</span>
GRANT ALL PRIVILEGES ON DATABASE mydatabase TO myuser<span class="hljs-comment">;</span>

<span class="hljs-comment"># é€€å‡º</span>
\q
</code></pre>
<p>4. å¼€å¯å¤–éƒ¨è¿æ¥ (æ ¸å¿ƒé…ç½®)</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPostgreSQL åªå…è®¸æœ¬æœº <code>127.0.0.1</code> è®¿é—®ã€‚è‹¥è¦è¿œç¨‹è¿æ¥ï¼Œéœ€ä¿®æ”¹ä¸¤ä¸ªé…ç½®æ–‡ä»¶ã€‚</p>
<p>A. ä¿®æ”¹ç›‘å¬åœ°å€</p>
<p>ä½¿ç”¨ GNU Nano ç¼–è¾‘å™¨ ä¿®æ”¹ä¸»é…ç½®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/postgresql/15/main/postgresql.conf
</code></pre>
<p>æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼Œå–æ¶ˆæ³¨é‡Šå¹¶å°† <code>localhost</code> æ”¹ä¸º <code>*</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">listen_addresses</span> = <span class="hljs-string">'*'</span>
</code></pre>
<p>B. ä¿®æ”¹è®¿é—®ç­–ç•¥</p>
<p>ä¿®æ”¹åŸºäºä¸»æœºçš„èº«ä»½éªŒè¯æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/postgresql/15/main/pg_hba.conf
</code></pre>
<p>åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆå…è®¸æ‰€æœ‰ IP ä½¿ç”¨ MD5 å¯†ç è®¤è¯ï¼‰ï¼š</p>
<pre><code class="hljs language-css" lang="css">host    <span class="hljs-attribute">all</span>             <span class="hljs-attribute">all</span>             <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">0</span>               md5
</code></pre>
<p>C. é‡å¯æœåŠ¡</p>
<pre><code class="hljs">sudo systemctl restart postgresql
</code></pre>
<p><strong>å»ºè®®æ­¥éª¤ï¼š</strong> ä½ ç°åœ¨å¯ä»¥ä½¿ç”¨ <strong>Navicat</strong> æˆ– <strong>DBeaver</strong> å°è¯•è¿æ¥ã€‚å¦‚æœè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æ¼æ‰äº† <strong>5432</strong> ç«¯å£çš„æ”¾è¡Œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlinä¸­çš„JvmPackageNameæ³¨è§£]]></title>    <link>https://juejin.cn/post/7603563317040218175</link>    <guid>https://juejin.cn/post/7603563317040218175</guid>    <pubDate>2026-02-06T12:26:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563317040218175" data-draft-id="7603581886149427254" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlinä¸­çš„JvmPackageNameæ³¨è§£"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-02-06T12:26:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlinä¸­çš„JvmPackageNameæ³¨è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:26:08.000Z" title="Fri Feb 06 2026 12:26:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>@JvmPackageName æ˜¯ Kotlin ä¸­çš„ä¸€ä¸ªæ–‡ä»¶çº§æ³¨è§£ï¼ˆFile-level Annotationï¼‰ï¼Œç”¨äºè‡ªå®šä¹‰ Kotlin æ–‡ä»¶ä¸­çš„é¡¶å±‚å£°æ˜ï¼ˆå‡½æ•°ã€å±æ€§ç­‰ï¼‰åœ¨ JVM å¹³å°ä¸Šç”Ÿæˆçš„ç±»æ‰€åœ¨çš„åŒ…åã€‚</p>
<p>å…¶æ ¸å¿ƒä½œç”¨æ˜¯çªç ´ Kotlin æ–‡ä»¶ package è¯­å¥çš„é™åˆ¶ï¼Œè®©åŒä¸€æ–‡ä»¶ä¸­çš„é¡¶å±‚å£°æ˜åœ¨ JVM ä¸­ç”Ÿæˆåˆ°ä¸åŒçš„åŒ…è·¯å¾„ä¸‹ï¼Œä»è€Œæ›´çµæ´»åœ°ç»„ç»‡ä»£ç ç»“æ„æˆ–é€‚é…å·²æœ‰çš„ Java åŒ…ç»“æ„ã€‚</p>
<h2 data-id="heading-0">èƒŒæ™¯ä¸é—®é¢˜åœºæ™¯</h2>
<p>Kotlin çš„é¡¶å±‚å£°æ˜ï¼ˆå¦‚é¡¶å±‚å‡½æ•°ã€å±æ€§ï¼‰åœ¨ç¼–è¯‘ä¸º JVM å­—èŠ‚ç æ—¶ï¼Œé»˜è®¤ä¼šè¢«æ”¾å…¥ä¸€ä¸ªä¸ Kotlin æ–‡ä»¶ package è¯­å¥ä¸€è‡´çš„ç±»ä¸­ï¼ˆç±»åç”± @file:JvmName æˆ–é»˜è®¤è§„åˆ™ æ–‡ä»¶å + "Kt" å†³å®šï¼‰ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File: com/example/utils/StringUtils.kt</span>
<span class="hljs-keyword">package</span> com.example.utils  <span class="hljs-comment">// Kotlin æ–‡ä»¶çš„åŒ…å</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.isEmpty()
</code></pre>
<p>ç¼–è¯‘åï¼Œè¯¥å‡½æ•°çš„ JVM ç±»ä¸º com.example.utils.StringUtilsKtï¼ˆå‡è®¾æœªä½¿ç”¨ @file:JvmNameï¼‰ï¼ŒåŒ…åä¸ Kotlin æ–‡ä»¶çš„ package å®Œå…¨ä¸€è‡´ã€‚</p>
<p>ä½†å®é™…å¼€å‘ä¸­å¯èƒ½éœ€è¦ï¼š</p>
<p>â€¢ è®© Kotlin é¡¶å±‚å£°æ˜ç”Ÿæˆçš„ JVM ç±»æ”¾å…¥ä¸ Kotlin æ–‡ä»¶ package ä¸åŒçš„è·¯å¾„ï¼ˆå¦‚é€‚é…å·²æœ‰çš„ Java åŒ…ç»“æ„ï¼‰ï¼›</p>
<p>â€¢ åŒä¸€ Kotlin æ–‡ä»¶ä¸­çš„ä¸åŒé¡¶å±‚å£°æ˜ç”Ÿæˆåˆ°ä¸åŒçš„ JVM åŒ…ï¼ˆå°½ç®¡è¿™ç§æƒ…å†µè¾ƒå°‘è§ï¼‰ã€‚</p>
<p>æ­¤æ—¶ï¼Œé»˜è®¤çš„åŒ…åè§„åˆ™æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œ@JvmPackageName åº”è¿è€Œç”Ÿã€‚</p>
<h2 data-id="heading-1">æ ¸å¿ƒä½œç”¨</h2>
<p>é€šè¿‡ @JvmPackageName æ³¨è§£ï¼Œå¯ä»¥æ˜¾å¼æŒ‡å®šå½“å‰ Kotlin æ–‡ä»¶ä¸­çš„é¡¶å±‚å£°æ˜åœ¨ JVM ä¸­ç”Ÿæˆçš„ç±»çš„åŒ…åï¼Œè¦†ç›– Kotlin æ–‡ä»¶ package è¯­å¥çš„é»˜è®¤è¡Œä¸ºã€‚</p>
<h2 data-id="heading-2">ä½¿ç”¨æ–¹å¼ä¸ç¤ºä¾‹</h2>
<h3 data-id="heading-3">åŸºæœ¬ç”¨æ³•ï¼šè¦†ç›–æ–‡ä»¶åŒ…å</h3>
<p>åœ¨ Kotlin æ–‡ä»¶é¡¶éƒ¨ä½¿ç”¨ @file:JvmPackageName æ³¨è§£ï¼ŒæŒ‡å®šç›®æ ‡ JVM åŒ…åï¼ˆéœ€åŒ…å«å®Œæ•´åŒ…è·¯å¾„ï¼‰ã€‚è¯¥æ³¨è§£éœ€æ”¾åœ¨ package è¯­å¥ä¹‹å‰ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File: src/kotlin/com/example/utils/StringUtils.kt</span>
<span class="hljs-meta">@file:JvmPackageName</span>(<span class="hljs-string">"com.example.java.utils"</span>)  <span class="hljs-comment">// æŒ‡å®š JVM åŒ…åä¸º com.example.java.utils</span>
<span class="hljs-keyword">package</span> com.example.utils  <span class="hljs-comment">// Kotlin æ–‡ä»¶çš„åŒ…åï¼ˆä»…ä¸º Kotlin ä»£ç çš„ç»„ç»‡ï¼Œä¸å½±å“ JVM åŒ…åï¼‰</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.isEmpty()

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isBlank</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.isBlank()
</code></pre>
<p>ç¼–è¯‘åæ•ˆæœï¼š</p>
<p>Kotlin é¡¶å±‚å‡½æ•° isEmpty å’Œ isBlank ä¼šè¢«ç¼–è¯‘åˆ° JVM ç±» com.example.java.utils.StringUtilsKtï¼ˆç±»åä»ç”±é»˜è®¤è§„åˆ™æˆ– @file:JvmName å†³å®šï¼‰ï¼Œè€Œé com.example.utils.StringUtilsKtã€‚</p>
<p>Java è°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç›´æ¥é€šè¿‡ç›®æ ‡ JVM åŒ…åè®¿é—®ï¼Œæ— éœ€å…³å¿ƒ Kotlin æ–‡ä»¶çš„ package è¯­å¥</span>
<span class="hljs-keyword">import</span> com.example.java.utils.StringUtilsKt;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">empty</span> <span class="hljs-operator">=</span> StringUtilsKt.isEmpty(<span class="hljs-string">"test"</span>);
        <span class="hljs-type">boolean</span> <span class="hljs-variable">blank</span> <span class="hljs-operator">=</span> StringUtilsKt.isBlank(<span class="hljs-string">"  "</span>);
    }
}
</code></pre>
<h3 data-id="heading-4">ä¸ @file:JvmName é…åˆä½¿ç”¨</h3>
<p>@JvmPackageName é€šå¸¸ä¸ @file:JvmName é…åˆä½¿ç”¨ï¼ŒåŒæ—¶è‡ªå®šä¹‰ JVM ç±»çš„åŒ…åå’Œç±»åï¼Œå®Œå…¨æ§åˆ¶é¡¶å±‚å£°æ˜åœ¨ JVM ä¸­çš„å®šä½ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File: src/kotlin/utils/LegacyUtils.kt</span>
<span class="hljs-meta">@file:JvmPackageName</span>(<span class="hljs-string">"com.legacy.api"</span>)       <span class="hljs-comment">// è‡ªå®šä¹‰ JVM åŒ…å</span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"OldStringUtils"</span>)             <span class="hljs-comment">// è‡ªå®šä¹‰ JVM ç±»åï¼ˆæ›¿ä»£é»˜è®¤çš„ LegacyUtilsKtï¼‰</span>
<span class="hljs-keyword">package</span> com.kotlin.<span class="hljs-keyword">internal</span>                  <span class="hljs-comment">// Kotlin æ–‡ä»¶çš„åŒ…åï¼ˆä»…ç”¨äº Kotlin ä»£ç ç»„ç»‡ï¼‰</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">trimAndUpper</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.trim().uppercase()
</code></pre>
<p>ç¼–è¯‘åæ•ˆæœï¼š</p>
<p>å‡½æ•° trimAndUpper å¯¹åº”çš„ JVM ç±»ä¸º com.legacy.api.OldStringUtilsï¼ˆåŒ…åç”± @JvmPackageName æŒ‡å®šï¼Œç±»åç”± @file:JvmName æŒ‡å®šï¼‰ã€‚</p>
<p>Java è°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.legacy.api.OldStringUtils;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> OldStringUtils.trimAndUpper(<span class="hljs-string">"  hello  "</span>); <span class="hljs-comment">// è¾“å‡º "HELLO"</span>
    }
}
</code></pre>
<h2 data-id="heading-5">å…³é”®æ³¨æ„äº‹é¡¹</h2>
<ol>
<li>
<p>æ³¨è§£ä½ç½®é™åˆ¶ï¼š@file:JvmPackageName æ˜¯æ–‡ä»¶çº§æ³¨è§£ï¼Œå¿…é¡»æ”¾åœ¨ Kotlin æ–‡ä»¶çš„æœ€é¡¶éƒ¨ï¼ˆpackage è¯­å¥ä¹‹å‰ï¼‰ï¼Œå¦åˆ™ä¼šç¼–è¯‘æŠ¥é”™ã€‚</p>
</li>
<li>
<p>åŒ…åæ ¼å¼è¦æ±‚ï¼švalue å‚æ•°éœ€ä¼ å…¥å®Œæ•´çš„ JVM åŒ…åï¼ˆå¦‚ "com.example.utils"ï¼‰ï¼Œä¸èƒ½çœç•¥åŒ…è·¯å¾„æˆ–ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚</p>
</li>
<li>
<p>ä¸ package è¯­å¥çš„å…³ç³»ï¼šKotlin æ–‡ä»¶çš„ package è¯­å¥ä»…ç”¨äº Kotlin ä»£ç å†…éƒ¨çš„ç»„ç»‡ï¼ˆå¦‚å¯¼å…¥ã€å¯è§æ€§ï¼‰ï¼Œä¸å½±å“ JVM ç±»çš„åŒ…åï¼›@JvmPackageName æ‰æ˜¯ JVM åŒ…åçš„å†³å®šå› ç´ ã€‚</p>
</li>
<li>
<p>é¿å…åŒ…åå†²çªï¼šè‡ªå®šä¹‰çš„ JVM åŒ…åä¸èƒ½ä¸é¡¹ç›®ä¸­å…¶ä»–ç±»ï¼ˆåŒ…æ‹¬ Java ç±»å’Œ Kotlin ç±»ï¼‰çš„åŒ…åé‡å¤ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç±»åŠ è½½å†²çªã€‚</p>
</li>
<li>
<p>é€‚ç”¨èŒƒå›´ï¼š@JvmPackageName ä»…å¯¹å½“å‰æ–‡ä»¶çš„é¡¶å±‚å‡½æ•°ã€é¡¶å±‚å±æ€§ç”Ÿæ•ˆï¼Œç±»ã€å¯¹è±¡ã€ä¼´ç”Ÿå¯¹è±¡ç­‰å£°æ˜ä»éµå¾ªå…¶è‡ªèº«çš„ package è¯­å¥ï¼ˆæˆ– @JvmPackageName è‹¥åœ¨ç±»ä¸Šæ ‡æ³¨æ—¶çš„è§„åˆ™ï¼Œä¸è¿‡ç±»é€šå¸¸ä¸ä½¿ç”¨æ­¤æ³¨è§£ï¼‰ã€‚</p>
</li>
</ol>
<h2 data-id="heading-6">å…¸å‹åº”ç”¨åœºæ™¯</h2>
<p>â€¢ é€‚é…å·²æœ‰ Java åŒ…ç»“æ„ï¼šå½“éœ€è¦å°† Kotlin ç¼–å†™çš„å·¥å…·å‡½æ•°é›†æˆåˆ°å·²æœ‰çš„ Java é¡¹ç›®ä¸­ï¼Œä¸” Java é¡¹ç›®è¦æ±‚å·¥å…·ç±»å¿…é¡»ä½äºç‰¹å®šåŒ…è·¯å¾„ï¼ˆå¦‚ com.company.common.utilsï¼‰æ—¶ï¼Œå¯ç”¨ @JvmPackageName å¼ºåˆ¶ Kotlin é¡¶å±‚å£°æ˜ç”Ÿæˆåˆ°è¯¥è·¯å¾„ã€‚</p>
<p>â€¢ éš”ç¦» Kotlin ä¸ Java åŒ…ç»“æ„ï¼šKotlin é¡¹ç›®å¸Œæœ›å†…éƒ¨ä»£ç æŒ‰ä¸€ç§åŒ…ç»“æ„ç»„ç»‡ï¼ˆå¦‚ com.kotlin.featureï¼‰ï¼Œä½†å¯¹å¤–æä¾›çš„ JVM æ¥å£éœ€æŒ‰å¦ä¸€ç§ç»“æ„æš´éœ²ï¼ˆå¦‚ com.api.v1ï¼‰ï¼Œæ­¤æ—¶å¯é€šè¿‡ @JvmPackageName è§£è€¦ã€‚</p>
<p>â€¢ é¿å…ç±»åå†²çªï¼šå½“å¤šä¸ª Kotlin æ–‡ä»¶å› æ–‡ä»¶åç›¸ä¼¼å¯¼è‡´é»˜è®¤ç”Ÿæˆçš„ JVM ç±»åå†²çªæ—¶ï¼ˆå¦‚ StringUtils.kt å’Œ StringUtils_Ext.kt å‡ç”Ÿæˆ StringUtilsKt å’Œ StringUtils_ExtKtï¼‰ï¼Œå¯é€šè¿‡ @JvmPackageName å°†å®ƒä»¬åˆ†é…åˆ°ä¸åŒçš„ JVM åŒ…ä¸­ã€‚</p>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p>@JvmPackageName æ˜¯ Kotlin ä¸º JVM å¹³å°æä¾›çš„ç²¾ç»†åŒ–åŒ…åæ§åˆ¶å·¥å…·ï¼Œé€šè¿‡è¦†ç›– Kotlin æ–‡ä»¶ package è¯­å¥çš„é»˜è®¤è¡Œä¸ºï¼Œè®©é¡¶å±‚å£°æ˜åœ¨ JVM ä¸­ç”Ÿæˆåˆ°ä»»æ„æŒ‡å®šçš„åŒ…è·¯å¾„ã€‚å®ƒä¸ @file:JvmName é…åˆä½¿ç”¨æ—¶ï¼Œèƒ½å®Œå…¨è‡ªå®šä¹‰ JVM ç±»çš„å®šä½ï¼ˆåŒ…å+ç±»åï¼‰ï¼Œæ˜¯è·¨è¯­è¨€å¼€å‘ä¸­ä¼˜åŒ–ä»£ç ç»“æ„çš„é‡è¦æ‰‹æ®µã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlinä¸­çš„JvmFieldæ³¨è§£]]></title>    <link>https://juejin.cn/post/7603352117640003593</link>    <guid>https://juejin.cn/post/7603352117640003593</guid>    <pubDate>2026-02-06T12:41:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603352117640003593" data-draft-id="7603376587652546610" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlinä¸­çš„JvmFieldæ³¨è§£"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2026-02-06T12:41:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlinä¸­çš„JvmFieldæ³¨è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:41:47.000Z" title="Fri Feb 06 2026 12:41:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>@JvmField æ˜¯ Kotlin ä¸­çš„ä¸€ä¸ªæ³¨è§£ï¼ˆAnnotationï¼‰ï¼Œç”¨äºå°† Kotlin ç±»ä¸­çš„å±æ€§ï¼ˆPropertyï¼‰ç›´æ¥æš´éœ²ä¸º JVM å¹³å°çš„å­—æ®µï¼ˆFieldï¼‰ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ getter/setter æ–¹æ³•ã€‚</p>
<p>å…¶æ ¸å¿ƒä½œç”¨æ˜¯æ¶ˆé™¤ Kotlin å±æ€§è®¿é—®å™¨ä¸ Java å­—æ®µè®¿é—®ä¹‹é—´çš„å·®å¼‚ï¼Œè®© Kotlin å±æ€§åœ¨ Java ä¸­è°ƒç”¨æ—¶æ›´ç¬¦åˆ Java å¼€å‘è€…çš„ç›´è§‰ï¼ˆç›´æ¥è®¿é—®å­—æ®µè€Œéæ–¹æ³•ï¼‰ã€‚</p>
<h2 data-id="heading-0">èƒŒæ™¯ï¼šKotlin å±æ€§çš„é»˜è®¤ JVM è¡¨ç°</h2>
<p>åœ¨ Kotlin ä¸­ï¼Œå±æ€§ï¼ˆå¦‚ var name: String æˆ– val age: Intï¼‰æœ¬è´¨ä¸Šç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p>
<p>â€¢ å¹•åå­—æ®µï¼ˆBacking Fieldï¼‰ï¼šå­˜å‚¨å±æ€§å€¼çš„å®é™…å­—æ®µï¼ˆä»…åœ¨éœ€è¦æ—¶ç”Ÿæˆï¼‰ã€‚</p>
<p>â€¢ è®¿é—®å™¨ï¼ˆAccessorï¼‰ï¼šgetterï¼ˆè¯»å–å€¼ï¼‰å’Œ setterï¼ˆè®¾ç½®å€¼ï¼Œä»… var æœ‰ï¼‰æ–¹æ³•ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒKotlin å±æ€§åœ¨ JVM ä¸­ä¼šè¢«ç¼–è¯‘ä¸ºï¼š</p>
<p>â€¢ å¯¹äº valï¼ˆåªè¯»å±æ€§ï¼‰ï¼šç”Ÿæˆä¸€ä¸ª getXxx() æ–¹æ³•ï¼ˆå¦‚ getName()ï¼‰ã€‚</p>
<p>â€¢ å¯¹äº varï¼ˆå¯å˜å±æ€§ï¼‰ï¼šç”Ÿæˆ getXxx() å’Œ setXxx() æ–¹æ³•ï¼ˆå¦‚ getName() å’Œ setName()ï¼‰ã€‚</p>
<p>è¿™ç§è®¾è®¡ç¬¦åˆ Kotlin çš„å°è£…åŸåˆ™ï¼Œä½†ä¸ Java ä¸­ç›´æ¥è®¿é—®å­—æ®µçš„ä¹ æƒ¯ï¼ˆå¦‚ obj.nameï¼‰ä¸ä¸€è‡´ã€‚æ­¤æ—¶ï¼Œ@JvmField æ³¨è§£å¯æ”¹å˜è¿™ä¸€é»˜è®¤è¡Œä¸ºã€‚</p>
<h2 data-id="heading-1">@JvmField çš„ä½œç”¨</h2>
<p>@JvmField çš„æ ¸å¿ƒç›®æ ‡æ˜¯è®© Kotlin å±æ€§åœ¨ JVM ä¸­è¡¨ç°ä¸ºä¸€ä¸ªå…¬å…±å­—æ®µï¼ˆPublic Fieldï¼‰ï¼Œè€Œé getter/setter æ–¹æ³•ã€‚å…·ä½“è¡¨ç°ä¸ºï¼š</p>
<p>â€¢ Java ä»£ç å¯ç›´æ¥é€šè¿‡ å¯¹è±¡.å­—æ®µå è®¿é—®å±æ€§å€¼ï¼ˆå¦‚åŒè®¿é—® Java ç±»çš„å…¬å…±å­—æ®µï¼‰ã€‚</p>
<p>â€¢ ä¸å†ç”Ÿæˆé»˜è®¤çš„ getter/setter æ–¹æ³•ï¼ˆé™¤éæ˜¾å¼å®šä¹‰ï¼‰ã€‚</p>
<h2 data-id="heading-2">ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹</h2>
<h3 data-id="heading-3">æ ‡æ³¨åœ¨ç±»çš„å±æ€§ä¸Šï¼ˆéç§æœ‰ã€é constï¼‰</h3>
<p>@JvmField å¯ç”¨äºæ ‡æ³¨ç±»çš„æ™®é€šå±æ€§ï¼ˆval æˆ– varï¼‰ï¼Œä½¿å…¶æš´éœ²ä¸º JVM å­—æ®µã€‚éœ€æ³¨æ„ï¼šå±æ€§å¿…é¡»æ˜¯éç§æœ‰ï¼ˆpublic æˆ–åŒ…çº§å¯è§ï¼‰ä¸”é constï¼ˆconst val æœ¬èº«å·²ç”Ÿæˆé™æ€å­—æ®µï¼Œæ— éœ€ @JvmFieldï¼‰ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-comment">// æ™®é€š var å±æ€§ï¼šé»˜è®¤ç”Ÿæˆ getName()/setName()</span>
    <span class="hljs-meta">@JvmField</span> <span class="hljs-comment">// æš´éœ²ä¸º JVM å­—æ®µï¼ˆæ—  getter/setterï¼‰</span>
    <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">"Unknown"</span>
    
    <span class="hljs-comment">// æ™®é€š val å±æ€§ï¼šé»˜è®¤ç”Ÿæˆ getAge()</span>
    <span class="hljs-meta">@JvmField</span> <span class="hljs-comment">// æš´éœ²ä¸º JVM å­—æ®µï¼ˆæ—  getterï¼‰</span>
    <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span> = <span class="hljs-number">18</span>
}
</code></pre>
<p>Java è°ƒç”¨æ•ˆæœï¼š</p>
<pre><code class="hljs language-java" lang="java">Java ä»£ç å¯ç›´æ¥è®¿é—®å­—æ®µï¼Œæ— éœ€è°ƒç”¨ getter/setterï¼š  
<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
user.name = <span class="hljs-string">"Alice"</span>;  <span class="hljs-comment">// ç›´æ¥èµ‹å€¼ï¼ˆç­‰æ•ˆäº Kotlin çš„ user.setName("Alice")ï¼‰</span>
<span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> user.name;  <span class="hljs-comment">// ç›´æ¥è¯»å–ï¼ˆç­‰æ•ˆäº Kotlin çš„ user.getName()ï¼‰</span>
<span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> user.age;  <span class="hljs-comment">// ç›´æ¥è¯»å–ï¼ˆç­‰æ•ˆäº Kotlin çš„ user.getAge()ï¼‰</span>
</code></pre>
<p>è‹¥ä¸æ·»åŠ  @JvmFieldï¼ŒJava éœ€é€šè¿‡ getter/setter è®¿é—®ï¼š</p>
<pre><code class="hljs language-java" lang="java">user.setName(<span class="hljs-string">"Alice"</span>);  <span class="hljs-comment">// å¿…é¡»è°ƒç”¨ setter</span>
<span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> user.getName();  <span class="hljs-comment">// å¿…é¡»è°ƒç”¨ getter</span>
</code></pre>
<h3 data-id="heading-4">æ ‡æ³¨åœ¨ä¼´ç”Ÿå¯¹è±¡çš„å±æ€§ä¸Š</h3>
<p>ä¼´ç”Ÿå¯¹è±¡ï¼ˆcompanion objectï¼‰ä¸­çš„å±æ€§é»˜è®¤åœ¨ JVM ä¸­å±äºä¼´ç”Ÿå¯¹è±¡çš„ Companion ç±»ï¼ˆå¦‚ User.Companion.getStaticName()ï¼‰ã€‚</p>
<p>ä½¿ç”¨ @JvmField å¯å°†ä¼´ç”Ÿå¯¹è±¡çš„å±æ€§æš´éœ²ä¸ºå®¿ä¸»ç±»çš„é™æ€å­—æ®µï¼ˆå¦‚åŒ Java çš„ static final å­—æ®µï¼‰ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// æ™®é€šä¼´ç”Ÿå±æ€§ï¼šé»˜è®¤ç”Ÿæˆ Config.Companion.getDefaultPort()</span>
        <span class="hljs-meta">@JvmField</span> <span class="hljs-comment">// æš´éœ²ä¸º Config.DEFAULT_PORTï¼ˆé™æ€å­—æ®µï¼‰</span>
        <span class="hljs-keyword">val</span> DEFAULT_PORT: <span class="hljs-built_in">Int</span> = <span class="hljs-number">8080</span>
        
        <span class="hljs-comment">// const val æœ¬èº«å·²ç”Ÿæˆé™æ€å­—æ®µï¼ˆæ— éœ€ @JvmFieldï¼‰</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> VERSION: String = <span class="hljs-string">"1.0"</span>
    }
}
</code></pre>
<p>Java è°ƒç”¨æ•ˆæœï¼š</p>
<pre><code class="hljs language-java" lang="java">Java å¯ç›´æ¥é€šè¿‡å®¿ä¸»ç±»è®¿é—®é™æ€å­—æ®µï¼š  
<span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> Config.DEFAULT_PORT;  <span class="hljs-comment">// ç›´æ¥è®¿é—®ï¼ˆç­‰æ•ˆäº Kotlin çš„ Config.DEFAULT_PORTï¼‰</span>
<span class="hljs-type">String</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> Config.VERSION;  <span class="hljs-comment">// const val æœ¬èº«å·²æ˜¯é™æ€å­—æ®µ</span>
</code></pre>
<p>è‹¥ä¸æ·»åŠ  @JvmFieldï¼ŒJava éœ€é€šè¿‡ä¼´ç”Ÿå¯¹è±¡çš„ Companion ç±»è®¿é—®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> Config.Companion.getDefaultPort();  <span class="hljs-comment">// éœ€é€šè¿‡ Companion</span>
</code></pre>
<h3 data-id="heading-5">æ ‡æ³¨åœ¨é¡¶å±‚å±æ€§ä¸Š</h3>
<p>é¡¶å±‚å±æ€§ï¼ˆä¸åœ¨ä»»ä½•ç±»æˆ–å¯¹è±¡ä¸­å®šä¹‰çš„å±æ€§ï¼‰é»˜è®¤è¢«ç¼–è¯‘åˆ° æ–‡ä»¶å + "Kt" ç±»ä¸­ï¼ˆå¦‚ AppConfig.kt ç”Ÿæˆ AppConfigKt ç±»ï¼‰ï¼Œå¹¶é€šè¿‡ getter/setter è®¿é—®ã€‚ä½¿ç”¨ @JvmField å¯å°†å…¶æš´éœ²ä¸º æ–‡ä»¶å + "Kt" ç±»çš„é™æ€å­—æ®µã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ–‡ä»¶ï¼šAppConfig.kt</span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"AppConfig"</span>) <span class="hljs-comment">// è‡ªå®šä¹‰ JVM ç±»åä¸º AppConfigï¼ˆå¯é€‰ï¼‰</span>

<span class="hljs-comment">// é¡¶å±‚å±æ€§ï¼šé»˜è®¤ç”Ÿæˆ AppConfigKt.getBaseUrl()</span>
<span class="hljs-meta">@JvmField</span> <span class="hljs-comment">// æš´éœ²ä¸º AppConfig.BASE_URLï¼ˆé™æ€å­—æ®µï¼‰</span>
<span class="hljs-keyword">val</span> BASE_URL: String = <span class="hljs-string">"https://api.example.com"</span>
</code></pre>
<p>Java è°ƒç”¨æ•ˆæœï¼š</p>
<pre><code class="hljs language-java" lang="java">Java å¯ç›´æ¥é€šè¿‡è‡ªå®šä¹‰çš„ç±»åè®¿é—®é™æ€å­—æ®µï¼š  
<span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> AppConfig.BASE_URL;  <span class="hljs-comment">// ç›´æ¥è®¿é—®ï¼ˆç­‰æ•ˆäº Kotlin çš„ BASE_URLï¼‰</span>
</code></pre>
<p>è‹¥ä¸æ·»åŠ  @JvmFieldï¼ŒJava éœ€é€šè¿‡ AppConfigKt ç±»çš„ getter è®¿é—®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> AppConfigKt.getBaseUrl();  <span class="hljs-comment">// éœ€é€šè¿‡ Kt ç±»</span>
</code></pre>
<h3 data-id="heading-6">æ ‡æ³¨åœ¨æšä¸¾ç±»çš„å±æ€§ä¸Š</h3>
<p>æšä¸¾å¸¸é‡çš„å±æ€§é»˜è®¤é€šè¿‡ getter è®¿é—®ï¼ˆå¦‚ Color.RED.getHex()ï¼‰ã€‚ä½¿ç”¨ @JvmField å¯å°†å…¶æš´éœ²ä¸ºæšä¸¾å¸¸é‡çš„å­—æ®µï¼Œä¾¿äº Java ç›´æ¥è®¿é—®ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Color</span>(<span class="hljs-keyword">val</span> hex: String) {
    RED(<span class="hljs-string">"#FF0000"</span>),
    GREEN(<span class="hljs-string">"#00FF00"</span>);

    <span class="hljs-comment">// æšä¸¾å¸¸é‡çš„å±æ€§ï¼šé»˜è®¤ç”Ÿæˆ getHex()</span>
    <span class="hljs-meta">@JvmField</span> <span class="hljs-comment">// æš´éœ²ä¸º RED.hexï¼ˆå­—æ®µï¼‰</span>
    <span class="hljs-keyword">val</span> hexCode: String = hex
}
</code></pre>
<p>Java è°ƒç”¨æ•ˆæœï¼š</p>
<pre><code class="hljs language-java" lang="java">Java å¯ç›´æ¥è®¿é—®æšä¸¾å¸¸é‡çš„å­—æ®µï¼š  
<span class="hljs-type">String</span> <span class="hljs-variable">redHex</span> <span class="hljs-operator">=</span> Color.RED.hexCode;  <span class="hljs-comment">// ç›´æ¥è®¿é—®ï¼ˆç­‰æ•ˆäº Kotlin çš„ Color.RED.hexCodeï¼‰</span>
</code></pre>
<p>è‹¥ä¸æ·»åŠ  @JvmFieldï¼ŒJava éœ€é€šè¿‡ getter è®¿é—®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">redHex</span> <span class="hljs-operator">=</span> Color.RED.getHexCode();  <span class="hljs-comment">// éœ€è°ƒç”¨ getter</span>
</code></pre>
<h2 data-id="heading-7">å…³é”®æ³¨æ„äº‹é¡¹</h2>
<ol>
<li>
<p>è®¿é—®æƒé™é™åˆ¶ï¼šè¢« @JvmField æ ‡æ³¨çš„å±æ€§å¿…é¡»æ˜¯éç§æœ‰çš„ï¼ˆpublic æˆ–åŒ…çº§å¯è§ï¼‰ã€‚ç§æœ‰å±æ€§ï¼ˆprivateï¼‰æ— æ³•è¢« Java ç›´æ¥è®¿é—®ï¼Œå³ä½¿æ·»åŠ  @JvmField ä¹Ÿä¼šè¢«å¿½ç•¥ï¼ˆç¼–è¯‘æŠ¥é”™ï¼‰ã€‚</p>
</li>
<li>
<p>ä¸å¯ä¸è‡ªå®šä¹‰è®¿é—®å™¨å…±å­˜ï¼šè‹¥å±æ€§æ˜¾å¼å®šä¹‰äº†è‡ªå®šä¹‰çš„ getter/setterï¼ˆå¦‚ get() = ... æˆ– set(value) { ... }ï¼‰ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ @JvmFieldï¼ˆç¼–è¯‘æŠ¥é”™ï¼‰ã€‚å› ä¸º @JvmField è¦æ±‚å±æ€§ç›´æ¥æš´éœ²ä¸ºå­—æ®µï¼Œè€Œè‡ªå®šä¹‰è®¿é—®å™¨ä¼šè¦†ç›–é»˜è®¤è¡Œä¸ºï¼Œå¯¼è‡´å†²çªã€‚</p>
</li>
<li>
<p>val ä¸ var çš„å·®å¼‚ï¼š</p>
<p>â€¢ valï¼ˆåªè¯»å±æ€§ï¼‰+ @JvmFieldï¼šæš´éœ²ä¸º JVM çš„ final å­—æ®µï¼ˆJava ä¸­ä¸å¯ä¿®æ”¹ï¼‰ã€‚</p>
<p>â€¢ varï¼ˆå¯å˜å±æ€§ï¼‰+ @JvmFieldï¼šæš´éœ²ä¸º JVM çš„é final å­—æ®µï¼ˆJava ä¸­å¯ä¿®æ”¹ï¼‰ã€‚</p>
</li>
<li>
<p>ä¸ const val çš„åŒºåˆ«ï¼šconst val ç”¨äºç¼–è¯‘æœŸå¸¸é‡ï¼ˆå¦‚ const val MAX_SIZE = 100ï¼‰ï¼Œé»˜è®¤ç”Ÿæˆ JVM çš„ public static final å­—æ®µï¼Œæ— éœ€ @JvmFieldã€‚@JvmField ä¸»è¦ç”¨äºè¿è¡Œæ—¶å¸¸é‡æˆ–é const å±æ€§ã€‚</p>
</li>
<li>
<p>çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼šç›´æ¥æš´éœ²ä¸ºå­—æ®µçš„å±æ€§ï¼ˆå°¤å…¶æ˜¯ varï¼‰åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½å­˜åœ¨å¹¶å‘ä¿®æ”¹é£é™©ï¼Œéœ€è‡ªè¡Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼ˆå¦‚åŠ é”æˆ–ä½¿ç”¨åŸå­ç±»ï¼‰ã€‚</p>
</li>
</ol>
<h2 data-id="heading-8">å…¸å‹åº”ç”¨åœºæ™¯</h2>
<p>â€¢ Java äº’æ“ä½œï¼šå½“ Kotlin ç±»éœ€è¦è¢« Java é¢‘ç¹è®¿é—®å±æ€§æ—¶ï¼ˆå¦‚é…ç½®ç±»ã€æ•°æ®æ¨¡å‹ï¼‰ï¼Œä½¿ç”¨ @JvmField å¯ç®€åŒ– Java ä»£ç ï¼ˆé¿å…è°ƒç”¨ getter/setterï¼‰ã€‚</p>
<p>â€¢ æ€§èƒ½ä¼˜åŒ–ï¼šç›´æ¥è®¿é—®å­—æ®µæ¯”è°ƒç”¨æ–¹æ³•æ›´å¿«ï¼ˆå°¤å…¶åœ¨é«˜é¢‘åœºæ™¯ä¸‹ï¼‰ï¼Œé€‚åˆå¯¹æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ï¼ˆå¦‚æ¸¸æˆå¼•æ“ã€å®æ—¶ç³»ç»Ÿï¼‰ã€‚</p>
<p>â€¢ æšä¸¾æˆ–å¸¸é‡ç±»ï¼šæšä¸¾å¸¸é‡çš„å±æ€§æˆ–é…ç½®å¸¸é‡é€šè¿‡ @JvmField æš´éœ²ä¸ºå­—æ®µï¼Œæ›´ç¬¦åˆ Java å¼€å‘è€…çš„ä½¿ç”¨ä¹ æƒ¯ã€‚</p>
<h2 data-id="heading-9">æ€»ç»“</h2>
<p>@JvmField æ˜¯ Kotlin ä¸ JVM å¹³å°äº’æ“ä½œçš„é‡è¦æ³¨è§£ï¼Œé€šè¿‡å°† Kotlin å±æ€§ç›´æ¥æš´éœ²ä¸º JVM å­—æ®µï¼Œæ¶ˆé™¤äº† getter/setter æ–¹æ³•çš„è°ƒç”¨å¼€é”€ï¼Œæå‡äº†è·¨è¯­è¨€ä»£ç çš„å¯è¯»æ€§å’Œæ€§èƒ½ã€‚åˆç†ä½¿ç”¨ @JvmField å¯ä½¿ Kotlin ä»£ç åœ¨ Java ä¸­è°ƒç”¨æ—¶æ›´è‡ªç„¶ã€æ›´é«˜æ•ˆï¼Œä½†éœ€æ³¨æ„å…¶ä½¿ç”¨é™åˆ¶ï¼ˆå¦‚éç§æœ‰ã€æ— è‡ªå®šä¹‰è®¿é—®å™¨ç­‰ï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰“é€  GitHub ä»“åº“æ™ºèƒ½æ¨èç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7603556326816120884</link>    <guid>https://juejin.cn/post/7603556326816120884</guid>    <pubDate>2026-02-06T12:41:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603556326816120884" data-draft-id="7603355275258478632" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰“é€  GitHub ä»“åº“æ™ºèƒ½æ¨èç³»ç»Ÿ"/> <meta itemprop="keywords" content="GitHub,äººå·¥æ™ºèƒ½,å¼€æº"/> <meta itemprop="datePublished" content="2026-02-06T12:41:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Gorse"/> <meta itemprop="url" content="https://juejin.cn/user/2682464100417854"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰“é€  GitHub ä»“åº“æ™ºèƒ½æ¨èç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464100417854/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Gorse
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:41:40.000Z" title="Fri Feb 06 2026 12:41:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸ºäº†æµ‹è¯•å’Œå±•ç¤º <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgorse-io%2Fgorse" target="_blank" title="https://github.com/gorse-io/gorse" ref="nofollow noopener noreferrer">Gorse æ¨èç³»ç»Ÿ</a>çš„åŸºæœ¬åŠŸèƒ½ï¼Œåšä¸»æ‰“é€ äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitrec.gorse.io" target="_blank" title="https://gitrec.gorse.io" ref="nofollow noopener noreferrer">GitRec</a>â€”â€”ä¸“é—¨ä¸º GitHub ä»“åº“è®¾è®¡çš„æ¨èç³»ç»Ÿã€‚è¿™ä¸ªé¡¹ç›®æ—¢å¯ä»¥å±•ç¤º Gorse çš„åŸºæœ¬èƒ½åŠ›ï¼Œä¹Ÿèƒ½å¸®åŠ©å¼€å‘è€…ä»¬åœ¨æµ·é‡çš„å¼€æºé¡¹ç›®ä¸­å‘ç°æœ‰è¶£ä¸”æœ‰ç”¨çš„ä»“åº“ã€‚</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitrec.gorse.io%2F%23%2F" target="_blank" title="https://gitrec.gorse.io/#/" ref="nofollow noopener noreferrer">GitRec</a> å·²ç»è¿è¡Œäº†ä¸‰å¹´ä¹‹ä¹…ï¼Œä½†æ˜¯åœ¨ 2025 å¹´é’ˆå¯¹ Gorse v0.5 è¿›è¡Œäº†å…¨é¢çš„å‡çº§å’Œé‡æ„ï¼Œæœ¬æ–‡ä»‹ç»çš„å†…å®¹å‡åŸºäºæœ€æ–°ç‰ˆæœ¬çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitrec.gorse.io%2F%23%2F" target="_blank" title="https://gitrec.gorse.io/#/" ref="nofollow noopener noreferrer">GitRec</a>ã€‚</p>
</blockquote>
<h2 data-id="heading-0">æ•°æ®æ”¶é›†</h2>
<p>å·§å¦‡éš¾ä¸ºæ— ç±³ä¹‹ç‚Šï¼Œæ„å»ºæ¨èç³»ç»Ÿçš„ç¬¬ä¸€æ­¥æ˜¯æ„é€ å¥½ç‰©å“ã€ç”¨æˆ·ã€åé¦ˆä¸‰ç§æ•°æ®ã€‚</p>
<h3 data-id="heading-1">ç‰©å“ï¼šGitHub ä»“åº“</h3>
<ul>
<li><code>ItemId</code>ï¼šä¸ºäº†æ–¹ä¾¿æ‹¼æ¥URLï¼Œä»“åº“åç§°ä¸­çš„<code>/</code>è¢«æ›¿æ¢ä¸º<code>:</code>å¹¶ç»Ÿä¸€ä¸ºå°å†™ã€‚</li>
<li><code>Categories</code>ï¼šä»“åº“çš„ä¸»è¦ç¼–ç¨‹è¯­è¨€ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ç¼–ç¨‹è¯­è¨€è¿‡æ»¤æ¨èç»“æœã€‚</li>
<li><code>Timestamp</code>ï¼šä»“åº“çš„æœ€åæ›´æ–°æ—¶é—´ã€‚</li>
<li><code>Labels</code>æ˜¯ç”±ä¸¤ä¸ªå­—æ®µç»„æˆçš„JSONï¼š
<ul>
<li><strong>è¯é¢˜</strong>ï¼šç”±ä»“åº“ç®¡ç†å‘˜æ·»åŠ çš„è¯é¢˜æ ‡ç­¾ (Topics)ã€‚</li>
<li><strong>æè¿°çš„æœ¬æ–‡åµŒå…¥å‘é‡</strong>ï¼šGitRec çš„ä¸€å¤§äº®ç‚¹æ˜¯å®ƒåˆ©ç”¨ OpenAI çš„ <code>text-embedding-v3</code> æ¨¡å‹ä¸ºæ¯ä¸ªä»“åº“çš„æè¿°ï¼ˆDescriptionï¼‰ç”Ÿæˆäº† 512 ç»´çš„å‘é‡åµŒå…¥ã€‚å¦‚æœä¸€ä¸ªä»“åº“æ²¡æœ‰æè¿°ï¼Œï¼šGitRec ä¼šä½¿ç”¨ <code>gpt-5-nano</code> å¤§è¯­è¨€æ¨¡å‹é˜…è¯»å…¶ <code>README.md</code> æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªå•å¥æ‘˜è¦ï¼Œç„¶åå†è¿›è¡Œå‘é‡åŒ–ã€‚</li>
</ul>
</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgorse-io%2Fgorse" target="_blank" title="https://github.com/gorse-io/gorse" ref="nofollow noopener noreferrer">Gorse ä»“åº“</a> åœ¨ Gorse ä¸­çš„ç‰©å“è®°å½•ï¼Œ<code>Comment</code> å­—æ®µä½¿ç”¨ä»“åº“æè¿°ä½œä¸ºå¤‡æ³¨æ–¹ä¾¿åå°æŸ¥çœ‹ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"ItemId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gorse-io:gorse"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"IsHidden"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Categories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"go"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-05-24T19:41:09Z"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Labels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"embedding"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">-0.0913363918662071</span><span class="hljs-punctuation">,</span> <span class="hljs-number">-0.0101912319660187</span><span class="hljs-punctuation">,</span> <span class="hljs-number">-0.0689065530896187</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.0137317562475801</span><span class="hljs-punctuation">,</span> ...<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"topics"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"recommender-system"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"collaborative-filtering"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"go"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"knn"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"machine-learning"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Comment"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Gorse open source recommender system engine"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç”±äº GitHub ä¸Šçš„ä»“åº“æ•°é‡åºå¤§ï¼ŒGitRec åªæ”¶é›† stars æ•°é‡è¶…è¿‡ 100 çš„ä»“åº“ä»¥åœ¨æˆæœ¬å’Œè¦†ç›–ç‡ä¹‹é—´å–å¾—å¹³è¡¡ã€‚ä»“åº“ä¸»è¦ç”±ä¸¤ç§æ–¹å¼æ”¶é›†ï¼š</p>
<ol>
<li>æ¯å¤©çˆ¬å– GitHub trending ä¸Šçš„çƒ­é—¨ä»“åº“ã€‚</li>
<li>æ¥å—ç”¨æˆ·åé¦ˆæ—¶ï¼Œé¡ºä¾¿å°†ç”¨æˆ·åé¦ˆæ¶‰åŠçš„ä»“åº“åŠ å…¥åˆ°ç‰©å“åº“ä¸­ã€‚</li>
</ol>
<h3 data-id="heading-2">ç”¨æˆ·ï¼šæ”¾å¼ƒä¸ªäººä¿¡æ¯</h3>
<p>ç»¼åˆè€ƒè™‘ä¹‹ä¸‹ï¼ŒGitRec é€‰æ‹©ä¸æ”¶é›†ç”¨æˆ·é™¤äº†ç”¨æˆ· ID å’Œåé¦ˆä»¥å¤–çš„ä»»ä½•ä¸ªäººä¿¡æ¯ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li>GitHub ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯éå¸¸å¤šæ ·åŒ–ï¼Œé™¤äº†å…¬å¸ã€ä½ç½®ç­‰å°‘é‡ç»“æ„åŒ–æ•°æ®å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥åœ¨ä¸ªäººç®€ä»‹ã€README æ–‡ä»¶ç­‰éç»“æ„åŒ–æ–‡æœ¬ä¸­æä¾›ä¿¡æ¯ã€‚åŒæ—¶ï¼Œä¹Ÿæœ‰éå¸¸å¤šçš„ç”¨æˆ·åªå¡«å†™äº†æå°‘é‡çš„ä¿¡æ¯ç”šè‡³æ²¡æœ‰ï¼Œè¿™ä½¿å¾—åŸºäºä¸ªäººä¿¡æ¯çš„æ¨èå˜å¾—éå¸¸å›°éš¾ã€‚</li>
<li>åœ¨æ³¨é‡éšç§ä¿æŠ¤çš„å½“ä¸‹ï¼Œé€‰æ‹©ä¸æ”¶é›†ä¸ªäººä¿¡æ¯æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</li>
</ol>
<p>Gorse ä¸­ä¸€æ¡ç”¨æˆ·è®°å½•çš„<code>UserId</code>å¯¹åº” GitHub ç”¨æˆ·IDï¼Œè€Œå…¶ä»–å­—æ®µéƒ½ä¸ºç©ºã€‚æ¯å½“æ–°ç”¨æˆ·ç™»å½• GitRecï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºä¸€æ¡ç”¨æˆ·è®°å½•ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"UserId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zhenghaoz"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Labels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Comment"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">åé¦ˆï¼šç‚¹èµå’Œæµè§ˆ</h3>
<p>é€šè¿‡ GitHub çš„ APIï¼Œå®é™…ä¸Šåªèƒ½è·å–åˆ°ç”¨æˆ·å¯¹ä»“åº“çš„ <code>star</code> è¡Œä¸ºï¼Œä½†æ˜¯æ— æ³•è·å–â€œå·²è¯»â€çš„è¡Œä¸ºã€‚å› æ­¤ï¼ŒGitRec æä¾›äº†ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶ï¼Œå¯ä»¥æ”¶é›†ç”¨æˆ·æµè§ˆä»“åº“çš„è®°å½•ã€‚æœ€ç»ˆï¼ŒGitRec ä¸­çš„åé¦ˆå®šä¹‰å¦‚ä¸‹ï¼š</p>
<p><strong>æ­£å‘åé¦ˆ</strong>ï¼š</p>
<ul>
<li><code>star</code>: ç”¨æˆ·åœ¨ GitHub ä¸Šä¸ºä¸€ä¸ªä»“åº“ç‚¹èµã€‚</li>
<li><code>like</code>: ç”¨æˆ·åœ¨ GitRec ç½‘ç«™ä¸Š::likefill::ä¸€ä¸ªä»“åº“ã€‚</li>
<li><code>read&gt;=3</code>: ç”¨æˆ·æŸ¥çœ‹ä¸€ä¸ªä»“åº“è‡³å°‘ 3 æ¬¡ã€‚</li>
</ul>
<p><strong>æµè§ˆåé¦ˆ</strong>ï¼š</p>
<ul>
<li><code>read</code>: ç”¨æˆ·æŸ¥çœ‹ä¸€ä¸ªä»“åº“ã€‚</li>
</ul>
<p><code>read</code>åé¦ˆç”±æµè§ˆå™¨æ’ä»¶æ”¶é›†ï¼Œ<code>like</code>åé¦ˆç”± GitRec ç½‘ç«™æ”¶é›†ï¼Œè€Œ<code>star</code>åé¦ˆé€šè¿‡ GitHub API æ¯å¤©åŒæ­¥ä¸€æ¬¡ã€‚<code>read</code>æ¬¡æ•°åœ¨æ¯æ¬¡ç”¨æˆ·è®¿é—®ä»“åº“æ—¶ç´¯åŠ ï¼Œå½“æ¬¡æ•°è¾¾åˆ° 3 æ¬¡æ—¶ï¼Œç³»ç»Ÿä¼šå°†å…¶è½¬æ¢ä¸ºæ­£å‘åé¦ˆã€‚</p>
<h2 data-id="heading-4">æ¨èæµæ°´çº¿é…ç½®</h2>
<p>GitRec æ¨èæµæ°´çº¿çš„è¯¦ç»†é…ç½®å¯ä»¥åœ¨ä»“åº“çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgorse-io%2Fgitrec%2Fblob%2Fmaster%2Fconfig.toml" target="_blank" title="https://github.com/gorse-io/gitrec/blob/master/config.toml" ref="nofollow noopener noreferrer">config.toml</a>æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œä¸»è¦å†…å®¹ä¸ºï¼š</p>
<ul>
<li>éä¸ªæ€§åŒ–æ¨è<code>most_starred_weekly</code>ï¼šåˆ†æ•°ç”±è‡ªå®šä¹‰å…¬å¼è®¡ç®—ï¼Œæ¨èæœ¬å‘¨æ”¶è—æ•°æœ€å¤šçš„ä»“åº“ã€‚</li>
<li>ç‰©å“åˆ°ç‰©å“æ¨è<code>neighbors</code>ï¼šæ ¹æ®ä»“åº“æè¿°çš„å‘é‡åµŒå…¥æ¨èç›¸ä¼¼çš„é¡¹ç›®ã€‚</li>
<li>ç”¨æˆ·åˆ°ç‰©å“æ¨è<code>neighbors</code>ï¼šæ¨èæ¥è‡ªæ”¶è—ä»“åº“é‡å ç¨‹åº¦è¾ƒé«˜çš„ç”¨æˆ·æ‰€å–œæ¬¢çš„é¡¹ç›®ã€‚</li>
<li>ååŒè¿‡æ»¤æ¨èä¿æŒé»˜è®¤é…ç½®ã€‚</li>
</ul>
<p>æ’åºé˜¶æ®µåˆå¹¶ä¸Šè¿°çš„æ¨èç»“æœå’Œæœ€æ–°ç‰©å“åä½¿ç”¨è®­ç»ƒå¥½çš„å› å­åˆ†è§£æœºè¿›è¡Œæœ€ç»ˆæ’åºã€‚å¦‚æœç”Ÿæˆçš„æ¨èç»“æœä¸è¶³ï¼Œä¼šä¾æ¬¡ä½¿ç”¨ç‰©å“åˆ°ç‰©å“æ¨èå’Œæœ€æ–°ç‰©å“è¿›è¡Œè¡¥å…¨ã€‚ä¸‹å›¾ä¸ºå¯è§†åŒ–æ¨èæµç¨‹ç¼–è¾‘å™¨ä¸­çœ‹åˆ°çš„æ¨èæµç¨‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38fa194db8c543fd98c0e04bf48a15ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR29yc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770986500&amp;x-signature=1aVFqGD32spIpRJ%2Fj261qQ9gaz0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">ç”¨æˆ·ç•Œé¢å’Œäº¤äº’</h2>
<p>GitRec é€šè¿‡ä¸¤ç§æ–¹å¼ä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚</p>
<h3 data-id="heading-6">ç½‘ç«™</h3>
<p>ç½‘ç«™ä»¿ç…§æŠ–éŸ³æä¾›äº†ä¸€ä¸ªæ²‰æµ¸å¼çš„ä»“åº“å‘ç°ä½“éªŒï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b60151aeab004f6586c541bc7d2c5cd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR29yc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770986500&amp;x-signature=bKYHMcE3%2FRMyAw94LoFpXne1xFQ%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>"å‘ç°é¡µï¼ˆExploreï¼‰</strong>ï¼šè¿™æ˜¯ç½‘ç«™çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå…¨å±å±•ç¤ºä»“åº“çš„ <code>README</code> å†…å®¹ã€‚ä½ å¯ä»¥é€‰æ‹©ï¼š
<ul>
<li>ç‚¹å‡»â¤ï¸æŒ‰é’®ï¼Œè¿™ä¸ªè¡Œä¸ºä¼šè¢«è®°å½•ä¸ºä¸€æ¬¡æ­£å‘åé¦ˆã€‚</li>
<li>ç‚¹å‡»â–¶ï¸æŒ‰é’®ï¼Œç³»ç»Ÿä¼šå°†å½“å‰ä»“åº“æ ‡è®°ä¸ºâ€œå·²è¯»â€ï¼Œå¹¶ä¸ºä½ å‘ˆç°ä¸‹ä¸€ä¸ªæ¨èã€‚</li>
<li>é¡µé¢ä¸Šæ–¹å¯ä»¥é€‰æ‹©ç¼–ç¨‹è¯­è¨€è¿‡æ»¤æ¨èç»“æœã€‚</li>
</ul>
</li>
<li><strong>æ”¶è—å¤¹ï¼ˆFavoritesï¼‰</strong>ï¼šè¿™é‡ŒåŒ…å«äº†æ‰€æœ‰ä½ åœ¨ GitHub ä¸Š â­ è¿‡æˆ–åœ¨ GitRec ç½‘ç«™ä¸Š â¤ï¸è¿‡çš„ä»“åº“ã€‚</li>
</ul>
<h3 data-id="heading-7">æµè§ˆå™¨æ’ä»¶</h3>
<p>æµè§ˆå™¨æ’ä»¶å°†æ¨èæ— ç¼é›†æˆåˆ° GitHub é¡µé¢ä¸­ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0af5aad4cbd7412bb8c63148481d452d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR29yc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770986500&amp;x-signature=%2F%2B1Xy1fGm6uOUxcjTkkrKbBWt1M%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>GitHub ä¸»é¡µçš„â€œæ¢ç´¢â€æ¨¡å—</strong>ï¼šåœ¨ GitHub çš„ä¸»é¡µï¼Œæ’ä»¶ä¼šæ³¨å…¥ä¸€ä¸ªâ€œExplore repositoriesâ€æ¨¡å—ï¼Œæä¾›ä¸ªæ€§åŒ–çš„é¡¹ç›®æ¨èã€‚å³ä½¿æ²¡æœ‰ç™»å½• GitRecï¼Œæ’ä»¶ä¹Ÿèƒ½é€šè¿‡æœ€è¿‘ <code>star</code> çš„é¡¹ç›®æä¾›åˆæ­¥çš„ä¸ªæ€§åŒ–æ¨èã€‚</li>
<li><strong>ä»“åº“é¡µé¢çš„â€œç›¸å…³ä»“åº“â€</strong>ï¼šæµè§ˆä»»ä½•ä¸€ä¸ª stars è¶…è¿‡ 100çš„ GitHub ä»“åº“æ—¶ï¼Œæ’ä»¶ä¼šåœ¨é¡µé¢å³ä¾§æ·»åŠ ä¸€ä¸ªâ€œRelated repositoriesâ€æ ç›®ã€‚è¿™é‡Œä¼šå±•ç¤ºä¸å½“å‰ä»“åº“å†…å®¹æœ€ç›¸ä¼¼çš„å‡ ä¸ªé¡¹ç›®ã€‚</li>
<li><strong>æµè§ˆè®°å½•æ”¶é›†</strong>ï¼šæ’ä»¶ä¼šè®°å½•æµè§ˆè¿‡çš„ä»“åº“ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯å‘é€å› GitRec æœåŠ¡å™¨ï¼Œé™¤æ­¤ä¹‹å¤–ä¸ä¼šæ”¶é›†ä»»ä½•å…¶ä»–ä¸ªäººä¿¡æ¯ã€‚</li>
</ul>
<h2 data-id="heading-8">è§„æ¨¡å’Œæˆæœ¬</h2>
<p>åˆ° 2025 å¹´åº•ï¼ŒGitRec çš„æ•°æ®è§„æ¨¡å¦‚ä¸‹ï¼š</p>
<ul>
<li>è¶…è¿‡ 24 ä¸‡ä¸ª GitHub ä»“åº“</li>
<li>è¶…è¿‡ 3000 åæ³¨å†Œç”¨æˆ·</li>
<li>è¶…è¿‡ 30 ä¸‡æ¡ç”¨æˆ·åé¦ˆè®°å½•</li>
</ul>
<p>Gorse æ¨èç³»ç»Ÿä»¥åŠæ•°æ®åº“éƒ¨ç½²åœ¨ä¸€å° 2 æ ¸ CPUã€8GB å†…å­˜çš„äº‘æœåŠ¡å™¨ä¸Šï¼ŒèŠ±è´¹330äººæ°‘å¸/æœˆã€‚</p>
<h2 data-id="heading-9">æ€»ç»“</h2>
<p>GitRec ä¸ä»…ä»…æ˜¯ä¸€ä¸ª GitHub ä»“åº“æ¨èç³»ç»Ÿï¼Œæ›´æ˜¯ Gorse æ¨èç³»ç»Ÿçš„è¯•éªŒåœºã€‚æ¬¢è¿ä½¿ç”¨ GitRec <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitrec.gorse.io" target="_blank" title="https://gitrec.gorse.io" ref="nofollow noopener noreferrer">ç½‘ç«™</a> æˆ–å®‰è£…æµè§ˆå™¨æ’ä»¶ï¼ˆæ”¯æŒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromewebstore.google.com%2Fdetail%2Fgitrec%2Feihokbaeiebdenibjophfipedicippfl" target="_blank" title="https://chromewebstore.google.com/detail/gitrec/eihokbaeiebdenibjophfipedicippfl" ref="nofollow noopener noreferrer">Chrome</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Faddons.mozilla.org%2Fzh-CN%2Ffirefox%2Faddon%2Fgitrec%2F" target="_blank" title="https://addons.mozilla.org/zh-CN/firefox/addon/gitrec/" ref="nofollow noopener noreferrer">Firefox</a>å’Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fmicrosoftedge.microsoft.com%2Faddons%2Fdetail%2Fgitrec%2Fcpcfbfpnagiffgpmfljmcdokmfjffdpa" target="_blank" title="https://microsoftedge.microsoft.com/addons/detail/gitrec/cpcfbfpnagiffgpmfljmcdokmfjffdpa" ref="nofollow noopener noreferrer">Edge</a>ï¼‰ï¼ŒåŠ©åŠ› Gorse æ¨èç³»ç»Ÿçš„æŒç»­å¼€å‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>