<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Spring 才是撑起半Java边天的秘密武器？如果 Spring 撂挑子了，Java估计一年内就会跌下神坛]]></title>    <link>https://juejin.cn/post/7597083949834174470</link>    <guid>https://juejin.cn/post/7597083949834174470</guid>    <pubDate>2026-01-20T06:54:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597083949834174470" data-draft-id="7597168034617098259" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring 才是撑起半Java边天的秘密武器？如果 Spring 撂挑子了，Java估计一年内就会跌下神坛"/> <meta itemprop="keywords" content="Java,Spring"/> <meta itemprop="datePublished" content="2026-01-20T06:54:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="挖土机_008"/> <meta itemprop="url" content="https://juejin.cn/user/4373178080835884"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring 才是撑起半Java边天的秘密武器？如果 Spring 撂挑子了，Java估计一年内就会跌下神坛
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4373178080835884/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    挖土机_008
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T06:54:39.000Z" title="Tue Jan 20 2026 06:54:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    25
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>长期以来，Java 被企业级开发广泛使用，但常被吐槽“繁琐、冗长、启动慢”。在云原生、微服务成为趋势的今天，Go、Python 等语言以轻量、快速吸引了大量开发者。</p>
<p>然而现实是：<strong>Java 能在企业级开发中长期占据主导地位，全靠 Spring</strong>。<br/>
没有 Spring，Java 的生产力和生态优势可能在一年内快速下滑。本文将用硬核代码示例，揭示 Spring 为什么撑起了半边天，以及它对 Java 的决定性作用。</p>
<p>原文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top%2Farchives%2F1768891158556-LFjEiCc3" target="_blank" title="https://zhiliaole.top/archives/1768891158556-LFjEiCc3" ref="nofollow noopener noreferrer">zhiliaole.top/archives/17…</a></p>
<p>更多文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top" target="_blank" title="https://zhiliaole.top" ref="nofollow noopener noreferrer">zhiliaole.top</a></p>
<hr/>
<h2 data-id="heading-0">1. 原生 Java 的繁琐痛点</h2>
<p>原生 Java 操作数据库时的低效，长期让开发者头疼。举一个 JDBC 查询用户的例子：</p>
<pre><code class="hljs language-ini" lang="ini">Connection <span class="hljs-attr">conn</span> = null<span class="hljs-comment">;</span>
PreparedStatement <span class="hljs-attr">stmt</span> = null<span class="hljs-comment">;</span>
ResultSet <span class="hljs-attr">rs</span> = null<span class="hljs-comment">;</span>
try {
    Class.forName("com.mysql.cj.jdbc.Driver")<span class="hljs-comment">;</span>
    <span class="hljs-attr">conn</span> = DriverManager.getConnection(DB_URL, USER, PASS)<span class="hljs-comment">;</span>
    String <span class="hljs-attr">sql</span> = <span class="hljs-string">"SELECT * FROM t_user WHERE id = ?"</span><span class="hljs-comment">; </span>
    <span class="hljs-attr">stmt</span> = conn.prepareStatement(sql)<span class="hljs-comment">;</span>
    stmt.setLong(1, 1001L)<span class="hljs-comment">;</span>
    <span class="hljs-attr">rs</span> = stmt.executeQuery()<span class="hljs-comment">;</span>
    while(rs.next()){
        User <span class="hljs-attr">user</span> = new User()<span class="hljs-comment">;</span>
        user.setId(rs.getLong("id"))<span class="hljs-comment">;</span>
        user.setName(rs.getString("name"))<span class="hljs-comment">;</span>
        // 还有十几个字段要手动映射
    }
} catch (Exception e) {
    e.printStackTrace()<span class="hljs-comment">;</span>
} finally {
    if(rs != null) try { rs.close()<span class="hljs-comment">; } catch(SQLException e) {}</span>
    if(stmt != null) try { stmt.close()<span class="hljs-comment">; } catch(SQLException e) {}</span>
    if(conn != null) try { conn.close()<span class="hljs-comment">; } catch(SQLException e) {}</span>
}
</code></pre>
<p>这只是查询一个用户。若加上事务、连接池、缓存、消息队列，开发者可能要写上百行重复、易错的代码。</p>
<p>而有了 Spring，只需：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-title">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>, <span class="hljs-title">Long</span>&gt; {
    <span class="hljs-comment">// 自动生成 CRUD 方法，无需手写 SQL</span>
}
</code></pre>
<p>Spring <strong>托管繁琐工作</strong>，让开发者专注业务逻辑，效率翻倍。</p>
<hr/>
<h2 data-id="heading-1">2. IoC 与 AOP：企业级开发利器</h2>
<p>Spring 的核心在于 <strong>IoC（控制反转）</strong> 和 <strong>AOP（面向切面编程）</strong> ，解决依赖管理和横切逻辑难题。</p>
<ul>
<li><strong>IoC / DI：自动注入依赖</strong></li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository userRepository;

    <span class="hljs-keyword">public</span> UserService(UserRepository userRepository) {
        <span class="hljs-keyword">this</span>.userRepository = userRepository; <span class="hljs-comment">// Spring 自动注入</span>
    }

    <span class="hljs-keyword">public</span> User getUser(<span class="hljs-built_in">Long</span> id) {
        <span class="hljs-keyword">return</span> userRepository.findById(id).orElse(<span class="hljs-literal">null</span>);
    }
}
</code></pre>
<ul>
<li><strong>AOP：日志、事务、权限等横切逻辑独立处理</strong></li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Aspect</span>
<span class="hljs-variable">@Component</span>
public class LoggingAspect {
    <span class="hljs-variable">@Before</span>(<span class="hljs-string">"execution(* com.example.service.*.*(..))"</span>)
    public void <span class="hljs-built_in">logBefore</span>(JoinPoint joinPoint) {
        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"Executing: "</span> + joinPoint.<span class="hljs-built_in">getSignature</span>());
    }
}
</code></pre>
<p>IoC 管理依赖，AOP 管理横切逻辑，让企业级代码更清晰、更可维护。</p>
<hr/>
<h2 data-id="heading-2">3. 企业级开发常见场景：Spring 自动化托管</h2>
<h3 data-id="heading-3">事务管理</h3>
<p>原生 Java 手动事务：</p>
<pre><code class="hljs language-scss" lang="scss">Connection conn = null;
try {
    conn = DriverManager<span class="hljs-selector-class">.getConnection</span>(DB_URL, USER, PASS);
    conn<span class="hljs-selector-class">.setAutoCommit</span>(false);
    <span class="hljs-comment">// 执行多条 SQL</span>
    conn<span class="hljs-selector-class">.commit</span>();
} <span class="hljs-built_in">catch</span>(SQLException e) {
    <span class="hljs-built_in">if</span>(conn != null) try { conn<span class="hljs-selector-class">.rollback</span>(); } <span class="hljs-built_in">catch</span>(SQLException ex) {}
}
</code></pre>
<p>Spring 自动事务管理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createOrder</span>(<span class="hljs-params">Order order</span>) {
        orderRepository.<span class="hljs-title function_">save</span>(order);
        inventoryService.<span class="hljs-title function_">reduceStock</span>(order.<span class="hljs-title function_">getItems</span>());
    }
}
</code></pre>
<h3 data-id="heading-4">缓存管理</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Cacheable(value = <span class="hljs-string">"users"</span>, key = <span class="hljs-string">"#id"</span>)</span>
<span class="hljs-keyword">public</span> User getUser(<span class="hljs-built_in">Long</span> id) {
    <span class="hljs-keyword">return</span> userRepository.findById(id).orElse(<span class="hljs-literal">null</span>);
}
</code></pre>
<h3 data-id="heading-5">消息队列集成</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@RabbitListener</span>(queues = <span class="hljs-string">"order.queue"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">handleOrderMessage</span>(<span class="hljs-params">Order order</span>) {
    <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Received order: "</span> + order);
}
</code></pre>
<p>Spring 将企业级开发常见场景标准化、自动化、可扩展，极大降低开发成本。</p>
<hr/>
<h2 data-id="heading-6">4. 云原生时代：Spring 保住 Java 的位置</h2>
<p>在 Cloud Native 时代，微服务、容器化、Kubernetes 已成标配。Go 启动快、体积小，Java JVM 厚重，原生支持不足。</p>
<p><strong>Spring Boot + Spring Cloud 是 Java 的救命稻草：</strong></p>
<ul>
<li><strong>配置管理</strong>：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">uri:</span> <span class="hljs-string">http://config-server:8888</span>
</code></pre>
<ul>
<li><strong>服务发现与熔断</strong>：</li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@EnableDiscoveryClient</span>
<span class="hljs-variable">@RestController</span>
public class UserController {
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/hello"</span>)
    public String <span class="hljs-built_in">hello</span>() {
        <span class="hljs-selector-tag">return</span> "<span class="hljs-selector-tag">Hello</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">Service</span>!";
    }
}
</code></pre>
<ul>
<li><strong>原生镜像启动速度</strong>：</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino">./mvnw spring-boot:build-image -Dspring-boot.build-image.imageName=user-service
</code></pre>
<p>没有 Spring 的统一生态，Java 在微服务架构下就像穿着重装盔甲的步兵去追摩托车的特种兵——累死也追不上。</p>
<hr/>
<h2 data-id="heading-7">5. 性能与可扩展性</h2>
<p>Spring 模块化设计，让应用轻量又灵活：</p>
<ul>
<li><strong>轻量容器</strong>：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">AnnotationConfigApplicationContext <span class="hljs-attr">context</span> = 
        new AnnotationConfigApplicationContext(AppConfig.class)<span class="hljs-comment">;</span>
MyService <span class="hljs-attr">service</span> = context.getBean(MyService.class)<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><strong>懒加载</strong>：</li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Service</span>
<span class="hljs-variable">@Lazy</span>
public class HeavyService {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">HeavyService</span>() {
        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"Initialized only when needed"</span>);
    }
}
</code></pre>
<ul>
<li><strong>微服务扩展（Feign 调用）</strong> ：</li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@FeignClient</span>(name = <span class="hljs-string">"order-service"</span>)
public interface OrderClient {
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/orders/{id}"</span>)
    Order <span class="hljs-built_in">getOrder</span>(<span class="hljs-variable">@PathVariable</span> Long id);
}
</code></pre>
<ul>
<li><strong>分布式支持</strong>：RPC、消息队列、缓存、负载均衡无缝集成。</li>
</ul>
<hr/>
<h2 data-id="heading-8">6. 社区与生态：Java 长期护航</h2>
<p>Java 的生命力不仅在语言本身，更在社区与生态：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>Spring 社区活跃、文档完善、持续优化，大量企业级项目依赖 Spring，使 Java 长期占据企业级开发主导地位。</p>
<hr/>
<h2 data-id="heading-9">7. 如果 Spring 撂挑子，Java 会怎样？</h2>
<ul>
<li>开发效率骤降：事务、缓存、消息队列需手动管理</li>
<li>微服务与云原生受阻</li>
<li>生态体系崩塌：开源项目和培训经验失效</li>
</ul>
<p>可以说，<strong>Spring 的命运几乎决定了 Java 的未来</strong>。没有 Spring，Java 可能在一年内跌下神坛。</p>
<hr/>
<h2 data-id="heading-10">8. 总结：Spring，把 Java 撑起半边天</h2>
<p>Java 是骨骼，Spring 是肌肉。它托起繁琐的数据库操作、事务管理、微服务和云原生架构，让企业级开发高效、可维护。</p>
<p>没有 Spring，Java 将失去快速开发能力、云原生适配和生态支撑，甚至可能被新一代语言赶超。<strong>Spring 是 Java 生态赖以生存的护航者。</strong></p>
<p>原文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top%2Farchives%2F1768891158556-LFjEiCc3" target="_blank" title="https://zhiliaole.top/archives/1768891158556-LFjEiCc3" ref="nofollow noopener noreferrer">zhiliaole.top/archives/17…</a></p>
<p>更多文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top" target="_blank" title="https://zhiliaole.top" ref="nofollow noopener noreferrer">zhiliaole.top</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何使用Python Mammoth将DOCX转换为HTML？]]></title>    <link>https://juejin.cn/post/7596990822128025638</link>    <guid>https://juejin.cn/post/7596990822128025638</guid>    <pubDate>2026-01-20T06:57:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596990822128025638" data-draft-id="7596998306380873778" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何使用Python Mammoth将DOCX转换为HTML？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-20T06:57:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端玖耀里"/> <meta itemprop="url" content="https://juejin.cn/user/2647279730957981"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何使用Python Mammoth将DOCX转换为HTML？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2647279730957981/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端玖耀里
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T06:57:24.000Z" title="Tue Jan 20 2026 06:57:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18f705b87e7543dbbd9fa306a1403bd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546W6ICA6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769497079&amp;x-signature=WN6IA3HC3V5aquKN7cI7kC7vvT0%3D" alt="ScreenShot_2026-01-20_143218_075.png" loading="lazy"/></p>
<p>我们在实际的项目开发的过程中，有时候不得不将文件从一种格式转换为另一种格式。</p>
<p>DOCX（由 Microsoft Word 使用）是一种非常常见的文件格式，被很多人使用。有时候，我们希望将 Word 文档转换为 HTML。</p>
<p>这可以通过 Mammoth 包轻松实现。它是一个用于将 DOCX 文件转换为 HTML 的简单、高效、快速的库。在本文中，我们将学习如何在 Python 中使用 Mammoth 将 DOCX 转换为 HTML。</p>
<h2 data-id="heading-0">安装 Mammoth</h2>
<p>首先，在安装之前准备好并激活你的虚拟环境：</p>
<pre><code class="hljs language-bash" lang="bash">python3 -m venv myenv
. myenv/bin/activate
</code></pre>
<p>然后，使用<code>pip</code>安装 Mammoth：</p>
<pre><code class="hljs">pip3 install mammoth
</code></pre>
<p>本教程使用的 Mammoth 版本是 1.4.15。在测试的时候，请确保它是.docx 文件！</p>
<p>以上环境准备好后，现在让我们开始提取文本并将其转换成 HTML。</p>
<h2 data-id="heading-1">提取 DOCX 文件的原始文本</h2>
<p>在转换为 HTML 时保留格式是 Mammoth 的最佳功能之一。这里我们只需要几行代码转换成你需要 DOCX 文件的文本。</p>
<p>使用 extract_raw_text()方法来获取它：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> mammoth

<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_filename, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> docx_file:
    result = mammoth.extract_raw_text(docx_file)
    text = result.value <span class="hljs-comment"># The raw text</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'output.txt'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> text_file:
        text_file.write(text)
</code></pre>
<p>注意，此方法不会返回有效的 HTML 文档。它只返回页面上的文本，因此我们使用.txt 扩展来保存它。如果你确实需要保持布局或格式，你需要提取 HTML 内容。</p>
<h2 data-id="heading-2">将 Docx 转换为 HTML 并自定义样式映射</h2>
<p>默认情况下，Mammoth 将文档转换为 HTML，但它不会提供有效的 HTML 页面。虽然网页浏览器可以显示内容，但它缺少一个<code>&lt;html&gt;</code>标签来封装文档，以及一个<code>&lt;body&gt;</code>标签来包含文档。</p>
<p>假设使用的是带有模板的网络框架。可能会定义一个模板来显示 Word 文档，并将 Mammoth 的输出加载到模板主体内。</p>
<p>Mammoth 不仅在如何使用其输出方面具有灵活性，而且在如何创建输出方面也具有很大的灵活性。特别是在我们想要样式化我们生成的 HTML 时，我们有很多选项。我们通过将每个 DOCX 格式规则匹配到相应的 CSS 规则来映射样式。</p>
<p>要查看你的 DOCX 文件有哪些样式，你有两个选择：</p>
<ol>
<li>使用 MS Word 打开您的 docx 文件，并检查样式工具栏。</li>
<li>通过用解压管理器打开你的 DOCX 文件来研究 XML 文件，然后导航到<code>/word/styles.xml</code>并找到你的样式。</li>
</ol>
<p>第二个选项适用于无法使用 MS Word 或无法解释和显示样式的替代文字处理程序的用户。</p>
<p>Mammoth 已经默认涵盖了某些最常用的样式映射。例如，<code>Heading1</code>在 docx 样式中映射到 HTML 元素的<code>&lt;h1&gt;</code>，<code>bold</code>被映射到 HTML 元素的<code>&lt;strong&gt;</code>，等等。</p>
<p>我们还可以在映射时使用 Mammoth 来自定义文档的样式。例如，如果您想将 DOCX 文件中的所有<code>bold</code>出现次数更改为 HTML 中的斜体，可以这样子实现：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> mammoth

custom_styles = <span class="hljs-string">"b =&gt; i"</span>

<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_filename, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> docx_file:
    result = mammoth.convert_to_html(docx_file, style_map = custom_styles)
    text = result.value
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'output.html'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> html_file:
        html_file.write(text)
</code></pre>
<p>通过 custom_styles 变量，左边的样式来自 DOCX 文件，而右边的是相应的 CSS。</p>
<p>假设我们想完全省略粗体出现的次数，我们可以将映射目标留空：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">custom_styles</span> = <span class="hljs-string">"b =&gt; "</span>
</code></pre>
<p>有时我们转换的文档会有很多样式需要保留。这个时候再这样实现就会变得不切实际，要为每一个我们要映射的样式都创建一个变量。</p>
<p>不过有解法，我们可以使用<code>docstrings</code>一次映射我们想要的任意多个样式：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">custom_styles</span> = <span class="hljs-string">""" b =&gt; del
                    u =&gt; em
                    p[style-name='Heading 1'] =&gt; i"""</span>
</code></pre>
<p>你可能已经注意到，最后的映射与其他的有点不同。在映射样式时，我们可以使用方括号<code>[]</code>并在其中添加条件，这样只有部分元素会以这种方式进行样式设置。</p>
<p>在我们的示例中，<code>p[style-name='Heading 1']</code>选择具有样式名称的段落<code>Heading 1</code>。我们也可以使用<code>p[style-name^='Heading']</code>来选择具有以<code>Heading</code>开头的样式名称的每个段落。</p>
<p>样式映射还允许我们将样式映射到自定义 CSS 类。通过这样做，我们可以随心所欲地修改 HTML 的样式。让我们举一个例子，我们在文档字符串中定义基本的自定义 CSS：</p>
<pre><code class="hljs language-xml" lang="xml">custom_css ="""
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.red</span>{
        <span class="hljs-attribute">color</span>: red;
    }
    <span class="hljs-selector-class">.underline</span>{
        <span class="hljs-attribute">text-decoration</span>: underline;
    }
    <span class="hljs-selector-class">.ul</span><span class="hljs-selector-class">.li</span>{
        <span class="hljs-attribute">list-style-type</span>: circle;
    }
    <span class="hljs-selector-tag">table</span>, <span class="hljs-selector-tag">th</span>, <span class="hljs-selector-tag">td</span> {
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black;
    }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
    """
</code></pre>
<p>现在我们可以更新我们的映射，以引用我们在<code>&lt;style&gt;</code>块中定义的 CSS 类：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">custom_styles</span> = <span class="hljs-string">""" b =&gt; b.red
                    u =&gt; em.red
                    p[style-name='Heading 1'] =&gt; h1.red.underline"""</span>
</code></pre>
<p>并将 CSS 和 HTML 合并在一起：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">edited_html</span> = custom_css + html
</code></pre>
<p>这个时候如果 DOCX 文件包含任何这些元素，就能看到我们设置的样式结果。</p>
<p>通过以上方法我们已经知道如何映射样式，那就让我们使用一个更著名的 CSS 框架（以及相关的 JS）来让我们的 HTML 看起来更好，并练习一个更有可能的现实场景。</p>
<h2 data-id="heading-3">使用 Bootstrap（或其他任何前端框架）映射样式</h2>
<p>就像我们之前处理<code>custom_css</code>一样，我们需要确保 CSS 与 HTML 一起加载。我们需要将 Bootstrap 文件 URI 或 CDN 添加到我们的 HTML 中：</p>
<pre><code class="hljs language-xml" lang="xml">bootstrap_css = '<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"nofollow"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://mybj123.com/links?url=aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9ib290c3RyYXBANS4wLjAtYmV0YTIvZGlzdC9jc3MvYm9vdHN0cmFwLm1pbi5jc3M="</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>&gt;</span>'
bootstrap_js = '<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"</span> <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>'
</code></pre>
<p>这里我稍微调整我们的 custom_styles，以匹配我们的新 CSS 类：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">custom_styles</span> = <span class="hljs-string">""" b =&gt; b.mark
                    u =&gt; u.initialism
                    p[style-name='Heading 1'] =&gt; h1.card
                    table =&gt; table.table.table-hover
                    """</span>
</code></pre>
<p>在第一行，我们将粗体 DOCX 样式映射到具有类的 HTML 元素，该类是 HTML 标签的 Bootstrap 类，用于突出显示文本的一部分。<code>b mark &lt;mark&gt;</code></p>
<p>在第二行，我们为 HTML 元素添加了类，稍微减小了字体大小，并将文本转换为大写。<code>initialism u</code></p>
<p>在第三行，我们选择所有具有样式名称的段落，并将其转换为具有 Bootstrap 类的 HTML 元素，该类为元素设置多个样式属性，例如背景颜色、位置和边框。<code>Heading 1 h1 card</code></p>
<p>在最后一行，我们将 docx 文件中的所有表格转换为 HTML 元素，并使用 Bootstrap 的类来给它一个新的外观，同时我们通过添加 Bootstrap 类使其在悬停时高亮显示。<code>table table table-hover</code></p>
<p>和之前一样，我们使用点符号将多个类映射到同一个 HTML 元素，即使这些样式来自另一个来源。</p>
<p>最后，将 Bootstrap CDNs 添加到我们的 HTML 中：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">edited_html</span> = bootstrap_css + html + bootstrap_js
</code></pre>
<p>现在可以分享我们的 HTML，以下是完整的代码以供参考：</p>
<pre><code class="hljs language-ini" lang="ini">import mammoth

<span class="hljs-attr">input_filename</span> = <span class="hljs-string">"file-sample_100kB.docx"</span>

<span class="hljs-attr">custom_styles</span> = <span class="hljs-string">""" b =&gt; b.mark
                    u =&gt; u.initialism
                    p[style-name='Heading 1'] =&gt; h1.card
                    table =&gt; table.table.table-hover
                    """</span>


<span class="hljs-attr">bootstrap_css</span> = <span class="hljs-string">'&lt;link rel="nofollow" href="https://mybj123.com/links?url=aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9ib290c3RyYXBANS4wLjAtYmV0YTIvZGlzdC9jc3MvYm9vdHN0cmFwLm1pbi5jc3M=" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous"&gt;'</span>
<span class="hljs-attr">bootstrap_js</span> = <span class="hljs-string">'&lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"&gt;&lt;/script&gt;'</span>


with open(input_filename, "rb") as docx_file:
    <span class="hljs-attr">result</span> = mammoth.convert_to_html(docx_file, style_map = custom_styles)
    <span class="hljs-attr">html</span> = result.value 

<span class="hljs-attr">edited_html</span> = bootstrap_css + html + bootstrap_js

<span class="hljs-attr">output_filename</span> = <span class="hljs-string">"output.html"</span>
with open(output_filename, "w") as f: 
    f.writelines(edited_html)
</code></pre>
<p>此外，需要注意的一点是，在实际情况下，你可能不会像我们在这里所做的那样直接将 Bootstrap CSS 添加到 HTML 内容中。相反，你会将 HTML 内容加载或注入到一个特殊的 HTML 页面中，该页面已经包含了必要的 CSS 和 JS 捆绑包。</p>
<p>Mammoth 还允许我们修改我们正在转换的内容。</p>
<h2 data-id="heading-4">处理我们不想分享的图片</h2>
<p>假设我们希望跳过 DOCX 文件中的图像不进行转换。<code>convert_to_html()</code>方法接受一个<code>convert_image</code>参数，这是一个图像处理函数。它返回一个应该转换并添加到 HTML 文档中的图像列表。</p>
<p>当然，如果我们覆盖它并返回一个空列表，它们将从转换后的页面中省略：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">ignore_image</span>(<span class="hljs-params">image</span>):
    <span class="hljs-keyword">return</span> []
</code></pre>
<p>现在，让我们将该函数作为参数传递到<code>convert_to_html()</code>方法中：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_filename, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> docx_file:
    result = mammoth.convert_to_html(docx_file, style_map = custom_styles, convert_image=ignore_image)
    html = result.value
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'output.html'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> html_file:
        html_file.write(text)
</code></pre>
<p>就是这样！ Mammoth 在生成 HTML 文件时将忽略所有图像。</p>
<p>到目前为止，我们一直在用 Python 编程方式使用 Mammoth。Mammoth 也是一个命令行工具，因此我们有了另一个将 DOCX 转换为 HTML 的接口。让我们在下一节中看看它的工作情况。</p>
<h2 data-id="heading-5">使用命令行工具将 DOCX 转换为 HTML</h2>
<p>使用 Mammoth 的 CLI 进行文件转换通常如下所示：</p>
<pre><code class="hljs language-lua" lang="lua">mammoth <span class="hljs-built_in">path</span>/to/input_filename.docx <span class="hljs-built_in">path</span>/to/<span class="hljs-built_in">output</span>.html
</code></pre>
<p>如果你想将图像从 HTML 中分离出来，可以指定一个输出文件夹：</p>
<pre><code class="hljs language-ini" lang="ini">mammoth file-sample_100kB.docx <span class="hljs-attr">--output-dir</span>=imgs
</code></pre>
<p>我们也可以像在 Python 中那样添加自定义样式。首先需要创建一个自定义样式文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">touch</span> my-custom-styles
</code></pre>
<p>然后，我们将在其中添加自定义样式，语法与之前相同：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">b</span> =&gt; <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.red</span>
u =&gt; <span class="hljs-selector-tag">em</span><span class="hljs-selector-class">.red</span>
<span class="hljs-selector-tag">p</span><span class="hljs-selector-attr">[style-name=<span class="hljs-string">'Heading 1'</span>]</span> =&gt; <span class="hljs-selector-tag">h1</span><span class="hljs-selector-class">.red</span><span class="hljs-selector-class">.underline</span>
</code></pre>
<p>现在我们可以生成带有自定义样式的 HTML 文件：</p>
<pre><code class="hljs language-ini" lang="ini">mammoth file-sample_100kB.docx output.html <span class="hljs-attr">--style-map</span>=my-custom-styles
</code></pre>
<p>大功告成！您的文档已按定义的自定义样式进行转换。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmybj123.com%2F28792.html" target="_blank" title="https://mybj123.com/28792.html" ref="nofollow noopener noreferrer">mybj123.com/28792.html</a></p>
<h2 data-id="heading-6">结语</h2>
<p>文件类型转换在处理网页技术时是一种常见需求。将 DOCX 文件转换为易于操作的 HTML 格式，使我们能够根据需要重建数据。使用 Mammoth，我们学会了如何从 docx 中提取文本并将其转换为 HTML。</p>
<p>在转换为 HTML 时，我们可以使用我们创建的 CSS 规则或常见的 UI 框架提供的规则来样式化输出。我们还可以省略不需要在 HTML 中可用的数据。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 混淆从入门到精通：R8 机制、实战配置与避坑指南]]></title>    <link>https://juejin.cn/post/7596991930984988723</link>    <guid>https://juejin.cn/post/7596991930984988723</guid>    <pubDate>2026-01-20T06:55:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596991930984988723" data-draft-id="7596955804261515314" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 混淆从入门到精通：R8 机制、实战配置与避坑指南"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-20T06:55:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wayne214"/> <meta itemprop="url" content="https://juejin.cn/user/2664871914640429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 混淆从入门到精通：R8 机制、实战配置与避坑指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2664871914640429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wayne214
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T06:55:29.000Z" title="Tue Jan 20 2026 06:55:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Android 开发中，<strong>混淆（Obfuscation）</strong> 是应用发布前必不可少的环节。它不仅能缩小 APK 体积，还能增加反编译的难度，保护核心代码逻辑。</p>
<p>本文将从基础概念、配置方法、常用指令到“避坑指南”进行全面整理。</p>
<hr/>
<h2 data-id="heading-0">一、 什么是混淆？</h2>
<p>在 Android ProGuard/R8 体系中，通常包含四个功能：</p>
<ol>
<li><strong>压缩（Shrinking）</strong>：检测并删除未使用的类、字段、方法和属性。</li>
<li><strong>优化（Optimization）</strong>：分析并优化字节码，甚至内联方法。</li>
<li><strong>混淆（Obfuscation）</strong>：将类名、方法名、字段名重命名为无意义的短字符（如 <code>a</code>, <code>b</code>, <code>c</code>）。</li>
<li><strong>预检（Preverification）</strong>：在 Java 平台上对类进行预验证。</li>
</ol>
<hr/>
<h2 data-id="heading-1">二、 开启混淆</h2>
<p>在项目的 <code>build.gradle</code> 文件中，通过 <code>minifyEnabled</code> 属性开启：</p>
<pre><code class="hljs language-gradle" lang="gradle">android {
    buildTypes {
        release {
            // 开启混淆/压缩
            minifyEnabled true
            // 开启资源压缩（删除无用图片、布局等），需配合混淆使用
            shrinkResources true
            // 指定混淆规则文件
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
}

</code></pre>
<hr/>
<h2 data-id="heading-2">三、 核心配置语法</h2>
<p>混淆的核心原则是：<strong>如果不指定“保持（Keep）”，R8 就会默认混淆或删除所有代码。</strong></p>
<h3 data-id="heading-3">1. 常用的 Keep 指令</h3>

























<table><thead><tr><th>指令</th><th>说明</th></tr></thead><tbody><tr><td><code>-keep</code></td><td>保持类和类成员不被混淆或移除</td></tr><tr><td><code>-keepclassmembers</code></td><td>保持成员不被混淆，但类名可以被混淆</td></tr><tr><td><code>-keepclasseswithmembers</code></td><td>如果类包含指定成员，则保持类和成员都不被混淆</td></tr><tr><td><code>-dontwarn</code></td><td>忽略指定库的警告（解决编译时因引用缺失报错的问题）</td></tr></tbody></table>
<h3 data-id="heading-4">2. 通配符</h3>
<ul>
<li><code>*</code>：匹配任意字符，但不包括包分隔符。</li>
<li><code>**</code>：匹配任意字符，包括包分隔符（匹配包及其子包）。</li>
<li><code>&lt;methods&gt;</code>：匹配所有方法。</li>
<li><code>&lt;fields&gt;</code>：匹配所有字段。</li>
</ul>
<hr/>
<h2 data-id="heading-5">四、 哪些内容绝对不能混淆？（重点）</h2>
<p>这是开发中最容易出问题的地方。以下内容通常需要配置 <code>-keep</code>：</p>
<ol>
<li><strong>反射（Reflection）使用的代码</strong>：反射通过字符串寻找类/方法，混淆后名称变了，反射会直接报错。</li>
<li><strong>与 JS 交互的接口</strong>：<code>@JavascriptInterface</code> 修饰的方法。</li>
<li><strong>JNI 调用（Native 方法）</strong>：C/C++ 代码通过包名、类名、方法名寻找 Java 函数。</li>
<li><strong>序列化对象</strong>：实现 <code>Serializable</code> 的类（建议保持特定的 <code>serialVersionUID</code>）。</li>
<li><strong>布局文件引用的自定义 View</strong>：XML 通过类名实例化 View。</li>
<li><strong>四大组件</strong>：在 <code>AndroidManifest.xml</code> 中注册的类（系统默认已处理，通常无需手动配置）。</li>
<li><strong>JSON 映射类（Bean）</strong>：如果使用 Gson/FastJson 转换，字段名必须与 JSON 键一致。</li>
</ol>
<hr/>
<h2 data-id="heading-6">五、 开发中的“坑”与避坑指南</h2>
<h3 data-id="heading-7">1. 混淆后的崩溃日志难以定位</h3>
<p><strong>现象</strong>：Crash 堆栈全是 <code>a.b.c(SourceFile:1)</code>。
<strong>对策</strong>：</p>
<ul>
<li>保留行号信息：在规则中加入 <code>-keepattributes SourceFile,LineNumberTable</code>。</li>
<li><strong>使用 mapping.txt</strong>：每次打包 release 后，<code>build/outputs/mapping/release/</code> 下会生成 <code>mapping.txt</code>。使用 Android Studio 的 "Analyze APK" 工具或 Google 提供的 <code>retrace</code> 脚本还原堆栈。</li>
</ul>
<h3 data-id="heading-8">2. Gson 解析结果全为 null</h3>
<p><strong>现象</strong>：Debug 模式正常，Release 模式下解析后的对象字段全为 null。
<strong>原因</strong>：Bean 类的字段名被混淆，导致与 JSON 键名匹配失败。
<strong>避坑</strong>：</p>
<ul>
<li>给 Bean 类字段添加 <code>@SerializedName("key")</code> 注解。</li>
<li>或者将 Bean 类整体 <code>keep</code> 掉。</li>
</ul>
<h3 data-id="heading-9">3. 枚举类型报错</h3>
<p><strong>现象</strong>：混淆后，<code>Enum.valueOf()</code> 抛出异常。
<strong>对策</strong>：</p>
<pre><code class="hljs language-proguard" lang="proguard">-keepclassmembers enum * {
    public static **[] values();
    public static ** valueOf(java.lang.String);
}

</code></pre>
<h3 data-id="heading-10">4. 依赖库重复定义</h3>
<p><strong>现象</strong>：多个 jar 包包含相同的类，混淆时报错。
<strong>对策</strong>：使用 <code>-dontnote</code> 或 <code>-dontwarn</code> 压制特定包的警告，或者在 <code>configurations</code> 中排除重复依赖。</p>
<h3 data-id="heading-11">5. 资源压缩删除了动态获取的资源</h3>
<p><strong>现象</strong>：使用 <code>getIdentifier()</code> 动态获取资源 ID 时（如 <code>getResources().getIdentifier("icon_" + index, "drawable", getPackageName())</code>），资源被 <code>shrinkResources</code> 删除了。
<strong>对策</strong>：在 <code>res/raw</code> 文件夹下创建 <code>keep.xml</code>：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">resources</span> <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span>
    <span class="hljs-attr">tools:keep</span>=<span class="hljs-string">"@drawable/icon_*, @layout/unused_but_needed"</span> /&gt;</span>

</code></pre>
<h3 data-id="heading-12">6. 桥接的某些js函数在release模式下报错</h3>
<p><strong>现象</strong>：如下代码在 debug 模式下正常， 打包 release 包无法执行，报错如下</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">TypeError</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">JavaScriptInterface</span>.<span class="hljs-property">close</span> is not a <span class="hljs-keyword">function</span>
</code></pre>
<p><strong>对策</strong>：在混淆文件中，添加如下规则</p>
<pre><code class="hljs language-diff" lang="diff"># 保持带有 JavascriptInterface 注解的方法不被混淆
<span class="hljs-deletion">-keepattributes JavascriptInterface</span>
<span class="hljs-deletion">-keepattributes *Annotation*</span>

<span class="hljs-deletion">-keepclassmembers class * {</span>
    @android.webkit.JavascriptInterface &lt;methods&gt;;
}
</code></pre>
<p><strong>为什么会出现这个问题？</strong>：</p>
<p>在 Debug 模式下，代码不进行混淆，方法名保持为 close。 在 Release 模式下，为了减小包体积和安全性，混淆器会将 close(String s) 重命名为类似 a(String b)。由于 JavaScript 端仍然在尝试调用 window.android.close()，自然会提示找不到方法。</p>
<hr/>
<h2 data-id="heading-13">六、 最佳实践建议</h2>
<ul>
<li><strong>模块化混淆</strong>：如果是开发 Library（SDK），请使用 <code>consumerProguardFiles</code>。这样集成你 SDK 的 App 会自动应用这些混淆规则，无需开发者手动复制。</li>
<li><strong>尽早测试</strong>：不要等发布正式版前才开启混淆。建议在 <code>debug</code> 模式下也偶尔开启混淆进行回归测试。</li>
<li><strong>善用三方库规则</strong>：现在的流行库（如 Retrofit, OkHttp, Glide）通常在官网或 README 中提供了成熟的混淆规则，直接复制即可。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/983ed8b6cda44537a043ca71bfca3e53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2F5bmUyMTQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769496929&amp;x-signature=vuoPku2qiQGlNLiVemAPst4TSaM%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学习Three.js--光源Light+轨道控制器OrbitControls]]></title>    <link>https://juejin.cn/post/7597230546239242276</link>    <guid>https://juejin.cn/post/7597230546239242276</guid>    <pubDate>2026-01-20T07:09:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597230546239242276" data-draft-id="7597230546239225892" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学习Three.js--光源Light+轨道控制器OrbitControls"/> <meta itemprop="keywords" content="前端,three.js"/> <meta itemprop="datePublished" content="2026-01-20T07:09:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="造轮子的猪"/> <meta itemprop="url" content="https://juejin.cn/user/497453720940158"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学习Three.js--光源Light+轨道控制器OrbitControls
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/497453720940158/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    造轮子的猪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T07:09:42.000Z" title="Tue Jan 20 2026 07:09:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">学习Three.js--光源Light+轨道控制器OrbitControls</h2>
<h3 data-id="heading-1">前置核心说明</h3>
<p>Three.js 的 3D 世界默认处于<strong>全黑状态</strong>，想要让「受光照影响的材质」显示出真实的光影效果，必须手动添加光源；而轨道控制器（OrbitControls）是 Three.js 官方提供的核心交互插件，能让你通过鼠标/触摸自由操控相机视角，是 3D 场景交互的标配。</p>
<h4 data-id="heading-2">核心规则</h4>
<ol>
<li>
<p><strong>材质与光照的对应关系</strong></p>



































<table><thead><tr><th>材质类型</th><th>是否受光照影响</th><th>核心特点</th></tr></thead><tbody><tr><td>MeshBasicMaterial</td><td>不受</td><td>纯色/纹理显示，无需光源，仅用于调试/简单UI</td></tr><tr><td>MeshLambertMaterial</td><td>受</td><td>漫反射光照，无高光，哑光质感</td></tr><tr><td>MeshPhongMaterial</td><td>受</td><td>高光光照，模拟光泽质感</td></tr><tr><td>MeshStandardMaterial</td><td>受</td><td>PBR物理光照，真实质感（推荐首选）</td></tr><tr><td>MeshPhysicalMaterial</td><td>受</td><td>高级PBR光照，极致写实</td></tr></tbody></table>
</li>
<li>
<p><strong>光源通用规则</strong>：</p>
<ul>
<li>所有光源均继承自 <code>THREE.Light</code>，共用「颜色、强度」核心属性；</li>
<li>光源创建后必须通过 <code>scene.add(光源)</code> 添加到场景才会生效；</li>
<li>除环境光外，其他光源（点/聚光/平行光）需设置 <code>position</code> 或 <code>target</code> 确定光照方向/位置。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">一、Three.js 核心光源详解（参数+用法+效果）</h3>
<h4 data-id="heading-4">1. 环境光 | AmbientLight（打底光，必加）</h4>
<h5 data-id="heading-5">核心概念</h5>
<p><code>AmbientLight</code> 是<strong>全局均匀照明光源</strong>，无方向、无阴影、无衰减，作用是「给场景所有物体打基础亮度」，消除纯黑区域，但不会产生明暗对比和立体感，<strong>必须配合其他光源（如平行光）使用</strong>。</p>
<h5 data-id="heading-6">创建语法 &amp; 完整参数</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 语法：new THREE.AmbientLight(颜色, 光照强度)</span>
<span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.5</span>);
scene.<span class="hljs-title function_">add</span>(ambientLight); <span class="hljs-comment">// 必须添加到场景才生效</span>
</code></pre>























<table><thead><tr><th>参数名</th><th>类型</th><th>默认值</th><th>核心说明</th></tr></thead><tbody><tr><td><code>color</code></td><td>Number/String/THREE.Color</td><td><code>0xffffff</code></td><td>光源颜色（支持16进制/字符串/Color对象）</td></tr><tr><td><code>intensity</code></td><td>Number</td><td><code>1</code></td><td>光照强度（0=无光，1=标准强度，建议0.2~0.8）</td></tr></tbody></table>
<h5 data-id="heading-7">核心特点 &amp; 效果</h5>
<ul>
<li>无位置属性（全局生效），无法设置 <code>position</code>；</li>
<li>效果：所有物体被均匀照亮，无明暗差异，单独使用会让物体像“平面贴纸”，无立体感；</li>
<li>适用场景：作为「打底光」，配合主光源（平行光/聚光灯）使用，避免物体阴影区域纯黑。</li>
</ul>
<h4 data-id="heading-8">2. 平行光 | DirectionalLight（主光源首选）</h4>
<h5 data-id="heading-9">核心概念</h5>
<p><code>DirectionalLight</code> 模拟<strong>太阳光</strong>，光线平行发射，无衰减（距离不影响亮度），有明确的照射方向，能产生自然的明暗对比和阴影，是 3D 场景「主光源」的最优选择。</p>
<h5 data-id="heading-10">创建语法 &amp; 完整参数</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 语法：new THREE.DirectionalLight(颜色, 光照强度)</span>
<span class="hljs-keyword">const</span> dirLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1</span>);
<span class="hljs-comment">// 核心：设置光源位置（决定光照方向），默认在原点(0,0,0)</span>
dirLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// 光源在(5,5,5)，朝向场景原点照射</span>
<span class="hljs-comment">// 可选：设置光照目标（默认朝向原点，可指定物体）</span>
dirLight.<span class="hljs-property">target</span> = cubeMesh; <span class="hljs-comment">// 光照朝向立方体</span>
<span class="hljs-comment">// 可选：开启阴影投射（实现物体阴影效果）</span>
dirLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>;
scene.<span class="hljs-title function_">add</span>(dirLight);
</code></pre>























<table><thead><tr><th>参数名</th><th>类型</th><th>默认值</th><th>核心说明</th></tr></thead><tbody><tr><td><code>color</code></td><td>Number/String/THREE.Color</td><td><code>0xffffff</code></td><td>光源颜色</td></tr><tr><td><code>intensity</code></td><td>Number</td><td><code>1</code></td><td>光照强度（建议0.8~1.2）</td></tr></tbody></table>
<h5 data-id="heading-11">核心属性</h5>






























<table><thead><tr><th>属性名</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>position</code></td><td>光源位置（THREE.Vector3），决定光照方向</td><td><code>dirLight.position.set(5,5,5)</code></td></tr><tr><td><code>target</code></td><td>光照目标点/物体（默认原点）</td><td><code>dirLight.target = mesh</code></td></tr><tr><td><code>castShadow</code></td><td>是否投射阴影（默认false）</td><td><code>dirLight.castShadow = true</code></td></tr><tr><td><code>shadow</code></td><td>阴影配置对象（如阴影分辨率）</td><td><code>dirLight.shadow.mapSize.set(2048,2048)</code></td></tr></tbody></table>
<h5 data-id="heading-12">效果 &amp; 适用场景</h5>
<ul>
<li>效果：光线平行，物体朝向光源的面亮，背向面暗，立体感极强；</li>
<li>适用：场景主光源（模拟太阳光）、户外场景、全局照明。</li>
</ul>
<h4 data-id="heading-13">3. 点光源 | PointLight（模拟灯泡/火把）</h4>
<h5 data-id="heading-14">核心概念</h5>
<p><code>PointLight</code> 模拟<strong>灯泡、蜡烛、火把</strong>，从一个点向「所有方向」发射光线，有衰减（距离越远，光线越暗），能产生真实的距离明暗变化。</p>
<h5 data-id="heading-15">创建语法 &amp; 完整参数</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 语法：new THREE.PointLight(颜色, 强度, 光照距离, 衰减指数)</span>
<span class="hljs-keyword">const</span> pointLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-number">0xffaa00</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>);
<span class="hljs-comment">// 核心：设置光源位置（默认原点）</span>
pointLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
<span class="hljs-comment">// 可选：开启阴影投射</span>
pointLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>;
scene.<span class="hljs-title function_">add</span>(pointLight);
</code></pre>



































<table><thead><tr><th>参数名</th><th>类型</th><th>默认值</th><th>核心说明</th></tr></thead><tbody><tr><td><code>color</code></td><td>Number/String/THREE.Color</td><td><code>0xffffff</code></td><td>光源颜色</td></tr><tr><td><code>intensity</code></td><td>Number</td><td><code>1</code></td><td>光照强度</td></tr><tr><td><code>distance</code></td><td>Number</td><td><code>0</code></td><td>光照最大距离（0=无限远），超过该距离无光照</td></tr><tr><td><code>decay</code></td><td>Number</td><td><code>1</code></td><td>衰减指数（物理正确值为2，值越大衰减越快）</td></tr></tbody></table>
<h5 data-id="heading-16">核心效果</h5>
<ul>
<li>效果：光源中心最亮，向四周逐渐变暗，距离越远越暗；</li>
<li>适用：灯泡、火把、台灯、局部点照明场景。</li>
</ul>
<h4 data-id="heading-17">4. 聚光灯光源 | SpotLight（模拟手电筒/射灯）</h4>
<h5 data-id="heading-18">核心概念</h5>
<p><code>SpotLight</code> 模拟<strong>手电筒、舞台射灯、汽车大灯</strong>，从一个点向「指定方向」发射「锥形光线」，有角度、有衰减，边缘可模糊，阴影效果精准。</p>
<h5 data-id="heading-19">创建语法 &amp; 完整参数</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 语法：new THREE.SpotLight(颜色, 强度, 距离, 锥形角度, 边缘模糊度, 衰减指数)</span>
<span class="hljs-keyword">const</span> spotLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SpotLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">2</span>, <span class="hljs-number">15</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>/<span class="hljs-number">6</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">2</span>);
<span class="hljs-comment">// 核心：设置光源位置+目标点</span>
spotLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 光源在顶部</span>
spotLight.<span class="hljs-property">target</span> = cubeMesh; <span class="hljs-comment">// 照射立方体</span>
<span class="hljs-comment">// 可选：开启阴影</span>
spotLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>;
scene.<span class="hljs-title function_">add</span>(spotLight);
</code></pre>















































<table><thead><tr><th>参数名</th><th>类型</th><th>默认值</th><th>核心说明</th></tr></thead><tbody><tr><td><code>color</code></td><td>Number/String/THREE.Color</td><td><code>0xffffff</code></td><td>光源颜色</td></tr><tr><td><code>intensity</code></td><td>Number</td><td><code>1</code></td><td>光照强度</td></tr><tr><td><code>distance</code></td><td>Number</td><td><code>0</code></td><td>光照最大距离</td></tr><tr><td><code>angle</code></td><td>Number（弧度）</td><td><code>Math.PI/3</code></td><td>锥形光照角度（越小，光束越集中）</td></tr><tr><td><code>penumbra</code></td><td>Number（0~1）</td><td><code>0</code></td><td>光线边缘模糊度（值越大，边缘越柔）</td></tr><tr><td><code>decay</code></td><td>Number</td><td><code>1</code></td><td>衰减指数</td></tr></tbody></table>
<h5 data-id="heading-20">核心效果 &amp; 适用场景</h5>
<ul>
<li>效果：锥形光照区域，中心亮、边缘渐暗，光束范围可控；</li>
<li>适用：手电筒、舞台射灯、汽车大灯、局部精准照明。</li>
</ul>
<hr/>
<h3 data-id="heading-21">二、轨道控制器 OrbitControls（交互核心）</h3>
<h4 data-id="heading-22">2.1 核心说明</h4>
<p>OrbitControls 是 Three.js 官方提供的<strong>相机交互插件</strong>，无需手动编写鼠标/触摸事件，即可实现相机视角的「旋转、缩放、平移」，是 3D 场景交互的标配，支持鼠标和移动端触摸。</p>
<h4 data-id="heading-23">2.2 交互效果（固定规则，无需配置）</h4>





























<table><thead><tr><th>操作方式</th><th>交互效果</th></tr></thead><tbody><tr><td>鼠标左键拖拽</td><td>相机围绕目标点旋转（场景整体旋转）</td></tr><tr><td>鼠标滚轮滚动</td><td>相机靠近/远离目标点（场景缩放）</td></tr><tr><td>鼠标右键拖拽</td><td>相机平移（场景整体平移）</td></tr><tr><td>移动端单指拖拽</td><td>旋转视角</td></tr><tr><td>移动端双指缩放</td><td>场景缩放</td></tr></tbody></table>
<h4 data-id="heading-24">2.3 引入方式（两种场景，全覆盖）</h4>
<h5 data-id="heading-25">方式1：CDN 引入（新手/快速测试，推荐）</h5>
<p>直接在 HTML 中引入，无需安装依赖：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 先引入Three.js核心库，再引入OrbitControls --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
      <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'https://threejsfundamentals.org/threejs/resources/threejs/r132/build/three.module.js'</span>
      <span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrbitControls</span> }  <span class="hljs-keyword">from</span> <span class="hljs-string">"https://threejsfundamentals.org/threejs/resources/threejs/r132/examples/jsm/controls/OrbitControls.js"</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

</code></pre>
<h5 data-id="heading-26">方式2：NPM 引入（工程化项目，Vue/React/Vite）</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装Three.js（已包含OrbitControls）</span>
npm install three --save
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模块化导入</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'three'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrbitControls</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/addons/controls/OrbitControls.js'</span>;
</code></pre>
<h4 data-id="heading-27">2.4 完整使用语法 &amp; 核心参数</h4>
<h5 data-id="heading-28">基础使用（最简版）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 语法：new OrbitControls(要控制的相机, 监听的DOM元素)</span>
<span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);
<span class="hljs-comment">// 核心：开启阻尼效果（视角移动更顺滑，有惯性，体验更佳）</span>
controls.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span>;
<span class="hljs-comment">// 阻尼系数（越小，惯性越强，越顺滑）</span>
controls.<span class="hljs-property">dampingFactor</span> = <span class="hljs-number">0.05</span>;

<span class="hljs-comment">// 动画循环（必须！enableDamping=true时，需实时更新控制器）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
  controls.<span class="hljs-title function_">update</span>(); <span class="hljs-comment">// 关键：更新控制器状态</span>
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
}
<span class="hljs-title function_">animate</span>();
</code></pre>
<h5 data-id="heading-29">核心配置参数（高频使用）</h5>



















































































<table><thead><tr><th>参数名</th><th>类型</th><th>默认值</th><th>核心说明</th></tr></thead><tbody><tr><td><code>enableDamping</code></td><td>Boolean</td><td><code>false</code></td><td>是否开启阻尼（顺滑惯性），推荐设为true</td></tr><tr><td><code>dampingFactor</code></td><td>Number</td><td><code>0.05</code></td><td>阻尼系数（0.01~0.1，越小越顺滑）</td></tr><tr><td><code>enableRotate</code></td><td>Boolean</td><td><code>true</code></td><td>是否允许旋转视角</td></tr><tr><td><code>rotateSpeed</code></td><td>Number</td><td><code>1.0</code></td><td>旋转速度（值越大，旋转越快）</td></tr><tr><td><code>enableZoom</code></td><td>Boolean</td><td><code>true</code></td><td>是否允许缩放视角</td></tr><tr><td><code>zoomSpeed</code></td><td>Number</td><td><code>1.0</code></td><td>缩放速度</td></tr><tr><td><code>enablePan</code></td><td>Boolean</td><td><code>true</code></td><td>是否允许平移视角</td></tr><tr><td><code>panSpeed</code></td><td>Number</td><td><code>1.0</code></td><td>平移速度</td></tr><tr><td><code>minDistance</code></td><td>Number</td><td><code>0</code></td><td>相机最小缩放距离（防止缩太近）</td></tr><tr><td><code>maxDistance</code></td><td>Number</td><td><code>Infinity</code></td><td>相机最大缩放距离（防止缩太远）</td></tr><tr><td><code>minPolarAngle</code></td><td>Number（弧度）</td><td><code>0</code></td><td>垂直旋转最小角度（防止视角翻到场景下方）</td></tr><tr><td><code>maxPolarAngle</code></td><td>Number（弧度）</td><td><code>Math.PI</code></td><td>垂直旋转最大角度</td></tr></tbody></table>
<h5 data-id="heading-30">核心方法</h5>

























<table><thead><tr><th>方法名</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>update()</code></td><td>更新控制器状态（阻尼生效必备）</td><td><code>controls.update()</code></td></tr><tr><td><code>reset()</code></td><td>重置相机视角到初始状态</td><td><code>controls.reset()</code></td></tr><tr><td><code>dispose()</code></td><td>销毁控制器（释放内存）</td><td><code>controls.dispose()</code></td></tr></tbody></table>
<h4 data-id="heading-31">2.5 关键注意事项（避坑必看）</h4>
<ol>
<li><strong>阻尼效果必须加动画循环</strong>：<code>enableDamping = true</code> 时，必须在 <code>requestAnimationFrame</code> 中调用 <code>controls.update()</code>，否则阻尼无效，视角卡顿；</li>
<li><strong>无需监听change事件</strong>：早期教程会监听 <code>controls.addEventListener('change', () =&gt; renderer.render(...))</code>，但动画循环本身会实时渲染，无需额外监听，反而会增加性能开销；</li>
<li><strong>DOM元素绑定</strong>：第二个参数必须传 <code>renderer.domElement</code>（渲染器的canvas画布），否则控制器无法监听鼠标事件；</li>
<li><strong>视角限制</strong>：通过 <code>minDistance/maxDistance</code> 限制缩放范围，避免用户缩放过度导致看不到场景。</li>
</ol>
<hr/>
<h3 data-id="heading-32">三、完整示例代码（光源+OrbitControls 综合使用）</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Three.js 光源+轨道控制器<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"><span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">overflow</span>: hidden; }</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'https://threejsfundamentals.org/threejs/resources/threejs/r132/build/three.module.js'</span>
    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrbitControls</span> }  <span class="hljs-keyword">from</span> <span class="hljs-string">"https://threejsfundamentals.org/threejs/resources/threejs/r132/examples/jsm/controls/OrbitControls.js"</span>

    <span class="hljs-comment">// 1. 创建三大核心</span>
    <span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();
    <span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>/<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);
    <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({ <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// 抗锯齿</span>
    renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
    renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 开启全局阴影支持</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);

    <span class="hljs-comment">// 2. 创建几何体+材质+网格（PBR材质，受光照影响）</span>
    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>({
      <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span>,
      <span class="hljs-attr">roughness</span>: <span class="hljs-number">0.5</span>, <span class="hljs-comment">// 粗糙度</span>
      <span class="hljs-attr">metalness</span>: <span class="hljs-number">0.2</span>  <span class="hljs-comment">// 金属度</span>
    });
    <span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
    cube.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 立方体投射阴影</span>
    cube.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 立方体接收阴影</span>
    scene.<span class="hljs-title function_">add</span>(cube);

    <span class="hljs-comment">// 3. 创建地面（接收阴影）</span>
    <span class="hljs-keyword">const</span> groundGeo = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">const</span> groundMat = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0xcccccc</span> });
    <span class="hljs-keyword">const</span> ground = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(groundGeo, groundMat);
    ground.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = -<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>; <span class="hljs-comment">// 旋转为地面</span>
    ground.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = -<span class="hljs-number">3</span>;
    ground.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 地面接收阴影</span>
    scene.<span class="hljs-title function_">add</span>(ground);

    <span class="hljs-comment">// 4. 添加光源（环境光+平行光+点光源）</span>
    <span class="hljs-comment">// 4.1 环境光（打底）</span>
    <span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.5</span>);
    scene.<span class="hljs-title function_">add</span>(ambientLight);
    <span class="hljs-comment">// 4.2 平行光（主光源，模拟太阳）</span>
    <span class="hljs-keyword">const</span> dirLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1.2</span>);
    dirLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">5</span>);
    dirLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>;
    dirLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">2048</span>, <span class="hljs-number">2048</span>); <span class="hljs-comment">// 提高阴影分辨率</span>
    scene.<span class="hljs-title function_">add</span>(dirLight);
    <span class="hljs-comment">// 4.3 点光源（模拟灯泡）</span>
    <span class="hljs-keyword">const</span> pointLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-number">0xffaa00</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>);
    pointLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
    pointLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>;
    scene.<span class="hljs-title function_">add</span>(pointLight);

    <span class="hljs-comment">// 5. 设置相机位置</span>
    camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">8</span>;

    <span class="hljs-comment">// 6. 创建轨道控制器（核心交互）</span>
    <span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);
    controls.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 阻尼顺滑</span>
    controls.<span class="hljs-property">dampingFactor</span> = <span class="hljs-number">0.05</span>;
    controls.<span class="hljs-property">minDistance</span> = <span class="hljs-number">3</span>; <span class="hljs-comment">// 最小缩放距离</span>
    controls.<span class="hljs-property">maxDistance</span> = <span class="hljs-number">20</span>; <span class="hljs-comment">// 最大缩放距离</span>

    <span class="hljs-comment">// 7. 动画循环</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
      <span class="hljs-title function_">requestAnimationFrame</span>(animate);
      cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> += <span class="hljs-number">0.01</span>; <span class="hljs-comment">// 立方体旋转</span>
      cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += <span class="hljs-number">0.01</span>;
      controls.<span class="hljs-title function_">update</span>(); <span class="hljs-comment">// 更新控制器（阻尼生效）</span>
      renderer.<span class="hljs-title function_">render</span>(scene, camera);
    }
    <span class="hljs-title function_">animate</span>();

    <span class="hljs-comment">// 8. 窗口适配</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> {
      camera.<span class="hljs-property">aspect</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
      camera.<span class="hljs-title function_">updateProjectionMatrix</span>();
      renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-33">示例效果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed989472a1244840ae35dec5b0ee36cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCg6L2u5a2Q55qE54yq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769497902&amp;x-signature=kQFL32H0E4T4KHZI6iOmDnIweI8%3D" alt="2f13475d-0ffd-405c-b6e3-7eb459c6dbd5.png" loading="lazy"/></p>
<ol>
<li>场景中有绿色立方体和灰色地面，立方体缓慢旋转；</li>
<li>平行光模拟太阳光，立方体产生自然阴影；</li>
<li>点光源模拟灯泡，立方体靠近光源的区域更亮；</li>
<li>鼠标操作：左键旋转视角、滚轮缩放、右键平移，视角移动顺滑有惯性；</li>
<li>窗口缩放时，场景自动适配尺寸。</li>
</ol>
<hr/>
<h3 data-id="heading-34">核心总结</h3>
<ol>
<li><strong>光源使用原则</strong>：
<ul>
<li>受光照材质必须加光源，「环境光（打底）+ 主光源（平行光/聚光灯）」是最优组合；</li>
<li>平行光是场景主光源首选，点光源/聚光灯用于局部照明；</li>
<li>开启阴影需同时设置「光源.castShadow + 物体.castShadow/receiveShadow + 渲染器.shadowMap.enabled」。</li>
</ul>
</li>
<li><strong>OrbitControls 核心</strong>：
<ul>
<li>阻尼效果（enableDamping=true）是提升交互体验的关键，必须在动画循环中调用 <code>controls.update()</code>；</li>
<li>通过 <code>min/maxDistance</code> 限制缩放范围，避免视角失控；</li>
<li>无需监听 <code>change</code> 事件，动画循环实时渲染即可。</li>
</ul>
</li>
<li><strong>性能优化</strong>：
<ul>
<li>光源阴影分辨率不宜过高（如2048足够），否则影响性能；</li>
<li>非必要场景关闭阴影，减少计算开销。</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenManus 本地部署指南：从环境搭建到实战运行]]></title>    <link>https://juejin.cn/post/7597024900520853556</link>    <guid>https://juejin.cn/post/7597024900520853556</guid>    <pubDate>2026-01-20T06:58:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597024900520853556" data-draft-id="7596989416761065507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenManus 本地部署指南：从环境搭建到实战运行"/> <meta itemprop="keywords" content="Agent,Python"/> <meta itemprop="datePublished" content="2026-01-20T06:58:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="陈暖秋"/> <meta itemprop="url" content="https://juejin.cn/user/493019579297533"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenManus 本地部署指南：从环境搭建到实战运行
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/493019579297533/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    陈暖秋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T06:58:33.000Z" title="Tue Jan 20 2026 06:58:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>想尝试最新的 AI Agent 助手 OpenManus？本教程带你一步步完成本地部署，包括 Python 多版本管理的全套解决方案。</p>
</blockquote>
<h2 data-id="heading-0">引言</h2>
<p>最近接触到了由 FoundationAgents 开发的智能 Agent 工具——OpenManus。OpenManus 要求 Python 3.12 版本，而我的系统还是原来的 3.10。既要保留原有的开发环境，又要满足新项目的需求，这就需要用到 Python 多版本管理工具：<strong>pyenv</strong>。</p>
<p>下面是我从零开始的完整部署过程，希望能帮助到有类似需求的朋友！😊</p>
<h2 data-id="heading-1">一、为什么用 PyEnv？</h2>
<p>面对多个项目对 Python 版本的不同要求，最优雅的解决方案不是卸载旧版本安装新版本（这样容易破坏现有环境），而是使用 <strong>PyEnv</strong> 这样的版本管理工具。它的优势在于：</p>
<ul>
<li>✅ 所有 Python 版本隔离存储，互不干扰</li>
<li>✅ 可以随时切换全局、局部或临时的 Python 版本</li>
<li>✅ 安全稳定，安装卸载都不影响系统其他程序</li>
<li>✅ 类似 Node.js 的 NVM，用过就离不开系列</li>
</ul>
<hr/>
<h2 data-id="heading-2">二、完整环境搭建步骤</h2>
<h3 data-id="heading-3">📦 第一步：安装编译依赖</h3>
<p>在安装新版本 Python 之前，系统需要准备好必要的编译工具。Ubuntu/Debian 系统执行：</p>
<pre><code class="hljs language-bash" lang="bash">sudo apt update
sudo apt install -y make build-essential libssl-dev zlib1g-dev \
libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm \
libncurses5-dev libncursesw5-dev xz-utils tk-dev libffi-dev \
liblzma-dev python-openssl git
</code></pre>
<h3 data-id="heading-4">⚙️ 第二步：安装 pyenv</h3>
<p>使用官方提供的安装脚本，一行搞定：</p>
<pre><code class="hljs language-bash" lang="bash">curl https://pyenv.run | bash
</code></pre>
<h3 data-id="heading-5">🔧 第三步：配置环境变量</h3>
<p>安装后需要配置 Shell 配置文件，让系统识别 pyenv 命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'export PYENV_ROOT="$HOME/.pyenv"'</span> &gt;&gt; ~/.bashrc
<span class="hljs-built_in">echo</span> <span class="hljs-string">'[[ -d $PYENV_ROOT/bin ]] &amp;&amp; export PATH="$PYENV_ROOT/bin:$PATH"'</span> &gt;&gt; ~/.bashrc
<span class="hljs-built_in">echo</span> <span class="hljs-string">'eval "$(pyenv init -)"'</span> &gt;&gt; ~/.bashrc
<span class="hljs-built_in">source</span> ~/.bashrc
</code></pre>
<p>验证安装成功：</p>
<pre><code class="hljs language-bash" lang="bash">pyenv --version  <span class="hljs-comment"># 如果输出版本号，说明成功啦！</span>
</code></pre>
<h3 data-id="heading-6">🐍 第四步：安装 Python 3.12</h3>
<p>查看可用版本列表：</p>
<pre><code class="hljs language-bash" lang="bash">pyenv install --list | grep 3.12
</code></pre>
<p>安装最新版本（这里以 3.12.6 为例）：</p>
<pre><code class="hljs language-bash" lang="bash">pyenv install 3.12.6
</code></pre>
<p>这个过程可能需要几分钟时间，耐心等待即可 ☕</p>
<h3 data-id="heading-7">🔄 第五步：灵活切换版本</h3>
<p>安装好后，有三种切换方式供你选择：</p>
<h4 data-id="heading-8">1️⃣ 全局切换</h4>
<pre><code class="hljs language-bash" lang="bash">pyenv global 3.12.6
<span class="hljs-comment"># 之后所有终端都默认使用 3.12.6</span>
python --version  <span class="hljs-comment"># 应该显示 Python 3.12.6</span>
</code></pre>
<h4 data-id="heading-9">2️⃣ 局部切换（推荐）⭐</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /path/to/your/project
pyenv <span class="hljs-built_in">local</span> 3.12.6
<span class="hljs-comment"># 只有在这个目录下才使用 3.12.6</span>
<span class="hljs-comment"># 其他目录保持之前的版本设置</span>
</code></pre>
<p>这个方式特别适合在不同项目间无缝切换！</p>
<h4 data-id="heading-10">3️⃣ 临时切换</h4>
<pre><code class="hljs language-bash" lang="bash">pyenv shell 3.12.6
<span class="hljs-comment"># 仅在当前终端窗口生效，关窗口后失效</span>
</code></pre>
<h3 data-id="heading-11">⏪ 进阶：如何切回系统版本？</h3>
<p>想恢复系统原生 Python？只需：</p>
<pre><code class="hljs language-bash" lang="bash">pyenv global system
<span class="hljs-comment"># 或者切换到其他已安装的版本</span>
<span class="hljs-comment"># pyenv global 3.10.0</span>
</code></pre>
<p><strong>PyEnv 把所有版本统一安装在 <code>~/.pyenv/versions</code> 目录下</strong>，这种非常规整的目录结构让管理和维护变得超级轻松。</p>
<hr/>
<h2 data-id="heading-12">三、OpenManus 部署实战</h2>
<p>环境准备好后，接下来就是部署 OpenManus 本身了！</p>
<h3 data-id="heading-13">📋 安装依赖</h3>
<p>进入项目目录后，先局部设置 Python 版本：</p>
<pre><code class="hljs language-bash" lang="bash">pyenv <span class="hljs-built_in">local</span> 3.12.6
uv venv --python 3.12.6
<span class="hljs-built_in">source</span> .venv/bin/activate
uv pip install -r requirements.txt
</code></pre>
<h3 data-id="heading-14">⚙️ 配置 API</h3>
<p>OpenManus 需要配置 LLM API 才能使用。复制配置模板：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cp</span> config/config.example.toml config/config.toml
</code></pre>
<p>编辑 <code>config.toml</code> 文件，修改以下关键内容：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-comment"># 全局 LLM 配置</span>
<span class="hljs-section">[llm]</span>
<span class="hljs-attr">model</span> = <span class="hljs-string">"gpt-4o"</span>
<span class="hljs-attr">base_url</span> = <span class="hljs-string">"https://api.openai.com/v1"</span>
<span class="hljs-attr">api_key</span> = <span class="hljs-string">"sk-你的OpenAI密钥"</span>
<span class="hljs-attr">max_tokens</span> = <span class="hljs-number">8192</span>
<span class="hljs-attr">temperature</span> = <span class="hljs-number">0.7</span> 

<span class="hljs-comment"># 可选：视觉能力的 LLM 配置</span>
<span class="hljs-section">[llm.vision]</span>
<span class="hljs-attr">model</span> = <span class="hljs-string">"gpt-4o"</span>
<span class="hljs-attr">base_url</span> = <span class="hljs-string">"https://api.openai.com/v1"</span>
<span class="hljs-attr">api_key</span> = <span class="hljs-string">"sk-你的OpenAI密钥"</span>
</code></pre>
<h3 data-id="heading-15">🚀 启动运行</h3>
<p><strong>重要提示</strong>：由于公司内网存在网络代理，需要在 <code>main.py</code> 中去掉代理配置：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    os.environ[<span class="hljs-string">"http_proxy"</span>] = <span class="hljs-string">""</span>
    os.environ[<span class="hljs-string">"https_proxy"</span>] = <span class="hljs-string">""</span>
    os.environ[<span class="hljs-string">"HTTP_PROXY"</span>] = <span class="hljs-string">""</span>
    os.environ[<span class="hljs-string">"HTTPS_PROXY"</span>] = <span class="hljs-string">""</span>
    os.environ[<span class="hljs-string">"no_proxy"</span>] = <span class="hljs-string">"*"</span>
    os.environ[<span class="hljs-string">"NO_PROXY"</span>] = <span class="hljs-string">"*"</span>
    asyncio.run(main())
</code></pre>
<p>然后启动服务：</p>
<pre><code class="hljs language-bash" lang="bash">python main.py
</code></pre>
<p>出现 "Enter your prompt:" 说明启动成功了！🎉</p>
<hr/>
<h2 data-id="heading-16">四、实测 Demo</h2>
<p>让我们来测试一下 OpenManus 的能力吧！看我让它解释什么是 Python 装饰器：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Enter your prompt:</span> <span class="hljs-string">帮介绍一下python装饰器</span>
</code></pre>
<p>OpenManus 不仅给出了专业的理论解释，还通过实际的 Python 代码执行演示了装饰器的按种用法：</p>
<ol>
<li>✅ 基础装饰器 - 在函数前后添加日志</li>
<li>✅ 带参数的装饰器 - 如重复执行多次</li>
<li>✅ 保留函数元数据 - 使用 <code>functools.wraps</code></li>
<li>✅ 类方法装饰器 - 为类方法添加调用日志</li>
<li>✅ 错误处理装饰器 - 优雅捕获异常</li>
<li>✅ 缓存装饰器（Memoization）- 提升 Fibonacci 数列性能</li>
<li>✅ 计时器装饰器 - 方便性能分析</li>
<li>✅ 多装饰器组合 - 日志+计时+错误处理一体化</li>
</ol>
<p>整个过程 OpenManus 通过自行书写代码、执行验证、修正错误、逐层完善教学示例，展示了强大的代码理解和教学能力，真心震撼！🤯</p>
<hr/>
<h2 data-id="heading-17">五、总结与心得</h2>
<p>搞定！经历这次部署，我有几点经验分享给大家：</p>
<h3 data-id="heading-18">💡 核心要点</h3>
<ol>
<li><strong>PyEnv 是多版本管理的瑞士军刀</strong>，学会它之后，再也不怕多个项目的版本冲突问题</li>
<li><strong>局部版本切换最适合实际开发</strong>，全局做好基础配置，每个项目用自己的版本</li>
<li>OpenManus 的启动过程很顺畅，如果遇到代理问题，记得检查并取消代理设置</li>
<li><strong>虚拟环境必不可少</strong>，<code>uv venv</code> + <code>pip</code> 都可以，保持项目间的干净隔离</li>
</ol>
<h3 data-id="heading-19">🎯 下一步探索</h3>
<p>部署只是第一步，接下来打算：</p>
<ul>
<li>深入了解 OpenManus 的插件体系</li>
<li>尝试结合自己的日常工作流定制 agent 行为</li>
<li>探索与其他工具（如浏览器自动化）的集成</li>
</ul>
<p><strong>OpenManus 代表了新一代 AI Agent 的可能性方向，非常值得花时间深入研究和实践！</strong></p>
<hr/>
<h2 data-id="heading-20">参考资源</h2>
<ul>
<li>📖 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFoundationAgents%2FOpenManus%2Fblob%2Fmain%2FREADME_zh.md" target="_blank" title="https://github.com/FoundationAgents/OpenManus/blob/main/README_zh.md" ref="nofollow noopener noreferrer">OpenManus 官方文档</a></li>
<li>🛠️ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpyenv%2Fpyenv" target="_blank" title="https://github.com/pyenv/pyenv" ref="nofollow noopener noreferrer">PyEnv 官方仓库</a></li>
<li>🐍 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python.org%2Fdownloads%2F" target="_blank" title="https://www.python.org/downloads/" ref="nofollow noopener noreferrer">Python 官方下载</a></li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[正则表达式：那个你每次用都要Google的"简单"工具]]></title>    <link>https://juejin.cn/post/7596955804261662770</link>    <guid>https://juejin.cn/post/7596955804261662770</guid>    <pubDate>2026-01-20T07:17:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596955804261662770" data-draft-id="7596955804261613618" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="正则表达式：那个你每次用都要Google的&quot;简单&quot;工具"/> <meta itemprop="keywords" content="前端,正则表达式,JavaScript"/> <meta itemprop="datePublished" content="2026-01-20T07:17:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员Agions"/> <meta itemprop="url" content="https://juejin.cn/user/360295545187751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            正则表达式：那个你每次用都要Google的"简单"工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/360295545187751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员Agions
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T07:17:49.000Z" title="Tue Jan 20 2026 07:17:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>摘要</strong>：正则表达式，号称"程序员的瑞士军刀"，实际上是"每次用都要重新学一遍的黑魔法"。<code>/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d).{8,}$/</code> 这串天书，是密码验证还是召唤恶魔的咒语？本文不是正则教程，而是一份"踩坑指南"。每个陷阱都有代码，每个坑都能复现。文末附送《正则表达式速查表》和《为什么不要用正则解析HTML》。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一个"简单"的需求</h2>
<p>产品经理："加个手机号验证，很简单的。"</p>
<p><strong>你心想：小case，写个正则。</strong></p>
<p><strong>5分钟后：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> phoneRegex = <span class="hljs-regexp">/\d{11}/</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(phoneRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"13812345678"</span>)) <span class="hljs-comment">// true ✓</span>
</code></pre>
<p><strong>产品经理："不对，要验证是不是真的手机号。"</strong></p>
<p><strong>10分钟后：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> phoneRegex = <span class="hljs-regexp">/^1[3-9]\d{9}$/</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(phoneRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"13812345678"</span>)) <span class="hljs-comment">// true ✓</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(phoneRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"19912345678"</span>)) <span class="hljs-comment">// true ✓</span>
</code></pre>
<p><strong>产品经理："要支持+86和空格。"</strong></p>
<p><strong>20分钟后：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> phoneRegex = <span class="hljs-regexp">/^(\+86)?1[3-9]\d{9}$/</span>
<span class="hljs-comment">// ❌ 不支持空格</span>
</code></pre>
<p><strong>30分钟后：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> phoneRegex = <span class="hljs-regexp">/^(\+86)?[\s-]?1[3-9]\d{9}$/</span>
<span class="hljs-comment">// ❌ 还是不对</span>
</code></pre>
<p><strong>1小时后，你在 Stack Overflow 上搜索："regex phone number china"</strong></p>
<p><strong>看到 20 种不同的答案，每个都说自己是"最完整的"。</strong></p>
<p><strong>你崩溃了。</strong></p>
<hr/>
<h2 data-id="heading-1">01. 贪婪匹配 vs 非贪婪匹配：正则的"贪吃蛇"</h2>
<h3 data-id="heading-2">场景复现</h3>
<p>你想提取 HTML 标签中的内容：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> html = <span class="hljs-string">"&lt;div&gt;Hello&lt;/div&gt;&lt;div&gt;World&lt;/div&gt;"</span>
<span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/&lt;div&gt;.*&lt;\/div&gt;/</span>
<span class="hljs-keyword">const</span> match = html.<span class="hljs-title function_">match</span>(regex)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match[<span class="hljs-number">0</span>])
</code></pre>
<p><strong>你以为会输出：</strong></p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span>&gt;Hello&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p><strong>实际输出：</strong></p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span>&gt;Hello&lt;/<span class="hljs-selector-tag">div</span>&gt;&lt;<span class="hljs-selector-tag">div</span>&gt;World&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p><strong>WTF？</strong></p>
<h3 data-id="heading-3">为什么？</h3>
<p><code>.*</code> 是<strong>贪婪匹配</strong>（Greedy），会尽可能多地匹配字符。</p>
<p><strong>匹配过程：</strong></p>
<ol>
<li><code>&lt;div&gt;</code> 匹配成功</li>
<li><code>.*</code> 开始匹配，一直吃到字符串末尾</li>
<li><code>&lt;\/div&gt;</code> 匹配失败</li>
<li><code>.*</code> 回退一个字符，再尝试</li>
<li>重复步骤 3-4，直到找到最后一个 <code>&lt;/div&gt;</code></li>
</ol>
<h3 data-id="heading-4">解决方案：非贪婪匹配</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/&lt;div&gt;.*?&lt;\/div&gt;/</span> <span class="hljs-comment">// 加个 ?</span>
<span class="hljs-keyword">const</span> match = html.<span class="hljs-title function_">match</span>(regex)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match[<span class="hljs-number">0</span>]) <span class="hljs-comment">// &lt;div&gt;Hello&lt;/div&gt; ✓</span>
</code></pre>
<p><strong>但是：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> html = <span class="hljs-string">"&lt;div&gt;Hello&lt;/div&gt;&lt;div&gt;World&lt;/div&gt;"</span>
<span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/&lt;div&gt;.*?&lt;\/div&gt;/g</span> <span class="hljs-comment">// 全局匹配</span>
<span class="hljs-keyword">const</span> matches = html.<span class="hljs-title function_">match</span>(regex)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(matches)
<span class="hljs-comment">// ['&lt;div&gt;Hello&lt;/div&gt;', '&lt;div&gt;World&lt;/div&gt;'] ✓</span>
</code></pre>
<h3 data-id="heading-5">贪婪 vs 非贪婪对比</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> text = <span class="hljs-string">"aaa"</span>

<span class="hljs-comment">// 贪婪匹配</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/a+/</span>)[<span class="hljs-number">0</span>]) <span class="hljs-comment">// "aaa"（尽可能多）</span>

<span class="hljs-comment">// 非贪婪匹配</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/a+?/</span>)[<span class="hljs-number">0</span>]) <span class="hljs-comment">// "a"（尽可能少）</span>
</code></pre>
<p><strong>常见的贪婪量词：</strong></p>
<ul>
<li><code>*</code>：0 次或多次（贪婪）</li>
<li><code>+</code>：1 次或多次（贪婪）</li>
<li><code>?</code>：0 次或 1 次（贪婪）</li>
<li><code>{n,m}</code>：n 到 m 次（贪婪）</li>
</ul>
<p><strong>对应的非贪婪量词：</strong></p>
<ul>
<li><code>*?</code>：0 次或多次（非贪婪）</li>
<li><code>+?</code>：1 次或多次（非贪婪）</li>
<li><code>??</code>：0 次或 1 次（非贪婪）</li>
<li><code>{n,m}?</code>：n 到 m 次（非贪婪）</li>
</ul>
<hr/>
<h2 data-id="heading-6">02. 回溯灾难：让你的服务器宕机的正则</h2>
<h3 data-id="heading-7">场景复现</h3>
<p>你写了一个"简单"的正则来验证邮箱：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> emailRegex = <span class="hljs-regexp">/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/</span>

<span class="hljs-comment">// 测试</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(emailRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"test@example.com"</span>)) <span class="hljs-comment">// true ✓</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(emailRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"user@domain.co.uk"</span>)) <span class="hljs-comment">// true ✓</span>
</code></pre>
<p><strong>看起来没问题。</strong></p>
<p><strong>但是：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> maliciousInput = <span class="hljs-string">"a"</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">50</span>) + <span class="hljs-string">"@example.com"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"test"</span>)
emailRegex.<span class="hljs-title function_">test</span>(maliciousInput)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"test"</span>)
<span class="hljs-comment">// test: 15000ms（15秒！）</span>
</code></pre>
<p><strong>你的服务器卡死了。</strong></p>
<h3 data-id="heading-8">为什么？</h3>
<p>这叫<strong>灾难性回溯</strong>（Catastrophic Backtracking）。</p>
<p><strong>问题在于：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">;<span class="hljs-regexp">/^([a-z0-9_\.-]+)@/</span>
<span class="hljs-comment">//        ↑ 这个 + 是贪婪的</span>
</code></pre>
<p><strong>当输入是 <code>aaaaaaa...</code> 时：</strong></p>
<ol>
<li><code>[a-z0-9_\.-]+</code> 匹配所有的 <code>a</code></li>
<li>尝试匹配 <code>@</code>，失败</li>
<li>回退一个 <code>a</code>，再尝试</li>
<li>重复步骤 2-3，指数级增长</li>
</ol>
<p><strong>时间复杂度：O(2^n)</strong></p>
<h3 data-id="heading-9">解决方案</h3>
<p><strong>方案1：使用非贪婪匹配</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> emailRegex = <span class="hljs-regexp">/^([a-z0-9_\.-]+?)@([\da-z\.-]+?)\.([a-z\.]{2,6})$/</span>
</code></pre>
<p><strong>方案2：使用原子组（Atomic Group）</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JavaScript 不支持原子组</span>
<span class="hljs-comment">// 但可以用其他语言（如 PHP、.NET）</span>
<span class="hljs-keyword">const</span> emailRegex = <span class="hljs-regexp">/^(?&gt;([a-z0-9_\.-]+))@/</span>
</code></pre>
<p><strong>方案3：避免嵌套量词</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 危险：嵌套量词</span>
/^(a+)+$/

<span class="hljs-comment">// ✅ 安全：不嵌套</span>
<span class="hljs-regexp">/^a+$/</span>
</code></pre>
<p><strong>方案4：设置超时</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Node.js 没有内置的正则超时</span>
<span class="hljs-comment">// 可以使用第三方库</span>
<span class="hljs-keyword">const</span> safeRegex = <span class="hljs-built_in">require</span>(<span class="hljs-string">"safe-regex"</span>)

<span class="hljs-keyword">if</span> (!<span class="hljs-title function_">safeRegex</span>(<span class="hljs-regexp">/^([a-z0-9_\.-]+)@/</span>)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Unsafe regex!"</span>)
}
</code></pre>
<h3 data-id="heading-10">真实案例</h3>
<p><strong>2019年，Cloudflare 全球宕机：</strong></p>
<p>原因：一个正则表达式导致 CPU 100%</p>
<pre><code class="hljs language-ruby" lang="ruby">(<span class="hljs-string">?:</span>(<span class="hljs-string">?:\"</span>|<span class="hljs-params">'</span>|\]|<span class="hljs-params">\}</span>|\\|<span class="hljs-params">\d</span>|(<span class="hljs-string">?:</span>nan|<span class="hljs-params">infinity</span>|<span class="hljs-literal">true</span>|<span class="hljs-params"><span class="hljs-literal">false</span></span>|null|<span class="hljs-params">undefined</span>|symbol|<span class="hljs-params">math)</span>|\<span class="hljs-string">`|\-|\+)+[)]*;?((?:\s|-|~|!|{}|\|\||\+)*.*(?:.*=.*)))
</span></code></pre>
<p><strong>这个正则有 20+ 个嵌套量词，导致灾难性回溯。</strong></p>
<hr/>
<h2 data-id="heading-11">03. 零宽断言：看不见的"幽灵"</h2>
<h3 data-id="heading-12">什么是零宽断言？</h3>
<p><strong>零宽断言</strong>（Zero-Width Assertion）不匹配任何字符，只匹配位置。</p>
<p><strong>四种零宽断言：</strong></p>
<ol>
<li><code>(?=...)</code>：正向先行断言（Positive Lookahead）</li>
<li><code>(?!...)</code>：负向先行断言（Negative Lookahead）</li>
<li><code>(?&lt;=...)</code>：正向后行断言（Positive Lookbehind）</li>
<li><code>(?&lt;!...)</code>：负向后行断言（Negative Lookbehind）</li>
</ol>
<h3 data-id="heading-13">场景1：密码验证</h3>
<p>**需求：**密码必须包含大写字母、小写字母、数字，至少8位</p>
<p><strong>错误的做法：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 这只检查是否有这些字符，不检查是否都有</span>
<span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/^[A-Za-z0-9]{8,}$/</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(regex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"12345678"</span>)) <span class="hljs-comment">// true（但没有字母）</span>
</code></pre>
<p><strong>正确的做法：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d).{8,}$/</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(regex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"Password1"</span>)) <span class="hljs-comment">// true ✓</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(regex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"password1"</span>)) <span class="hljs-comment">// false（没有大写）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(regex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"PASSWORD1"</span>)) <span class="hljs-comment">// false（没有小写）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(regex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"Password"</span>)) <span class="hljs-comment">// false（没有数字）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(regex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"Pass1"</span>)) <span class="hljs-comment">// false（少于8位）</span>
</code></pre>
<p><strong>解释：</strong></p>
<pre><code class="hljs language-ruby" lang="ruby">^              开始
(<span class="hljs-string">?=</span>.*[A-Z])    必须包含至少一个大写字母（先行断言）
(<span class="hljs-string">?=</span>.*[a-z])    必须包含至少一个小写字母（先行断言）
(<span class="hljs-string">?=</span>.*\d)       必须包含至少一个数字（先行断言）
.{<span class="hljs-number">8</span>,}          至少<span class="hljs-number">8</span>个任意字符
<span class="hljs-variable">$ </span>             结束
</code></pre>
<h3 data-id="heading-14">场景2：提取价格（不包含货币符号）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> text = <span class="hljs-string">"Price: $99.99"</span>

<span class="hljs-comment">// ❌ 包含了 $</span>
<span class="hljs-keyword">const</span> regex1 = <span class="hljs-regexp">/\$\d+\.\d+/</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text.<span class="hljs-title function_">match</span>(regex1)[<span class="hljs-number">0</span>]) <span class="hljs-comment">// "$99.99"</span>

<span class="hljs-comment">// ✅ 不包含 $</span>
<span class="hljs-keyword">const</span> regex2 = <span class="hljs-regexp">/(?&lt;=\$)\d+\.\d+/</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text.<span class="hljs-title function_">match</span>(regex2)[<span class="hljs-number">0</span>]) <span class="hljs-comment">// "99.99"</span>
</code></pre>
<p><strong>解释：</strong></p>
<pre><code class="hljs language-ruby" lang="ruby">(<span class="hljs-string">?&lt;</span>=\<span class="hljs-variable">$)</span>    正向后行断言：前面必须是 <span class="hljs-variable">$，</span>但不捕获 <span class="hljs-variable">$
</span>\d+\.\d+   匹配数字
</code></pre>
<h3 data-id="heading-15">场景3：千位分隔符</h3>
<p>**需求：**给数字加千位分隔符</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> num = <span class="hljs-string">"1234567890"</span>

<span class="hljs-comment">// 使用正向先行断言</span>
<span class="hljs-keyword">const</span> formatted = num.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\B(?=(\d{3})+(?!\d))/g</span>, <span class="hljs-string">","</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(formatted) <span class="hljs-comment">// "1,234,567,890"</span>
</code></pre>
<p><strong>解释：</strong></p>
<pre><code class="hljs language-ruby" lang="ruby">\B                  非单词边界（不在开头）
(<span class="hljs-string">?=</span>(\d{<span class="hljs-number">3</span>})+(<span class="hljs-string">?!\d</span>))  后面是<span class="hljs-number">3</span>的倍数个数字，且后面不再有数字
</code></pre>
<p><strong>测试：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"123"</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\B(?=(\d{3})+(?!\d))/g</span>, <span class="hljs-string">","</span>)) <span class="hljs-comment">// "123"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"1234"</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\B(?=(\d{3})+(?!\d))/g</span>, <span class="hljs-string">","</span>)) <span class="hljs-comment">// "1,234"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"12345"</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\B(?=(\d{3})+(?!\d))/g</span>, <span class="hljs-string">","</span>)) <span class="hljs-comment">// "12,345"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"123456"</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\B(?=(\d{3})+(?!\d))/g</span>, <span class="hljs-string">","</span>)) <span class="hljs-comment">// "123,456"</span>
</code></pre>
<hr/>
<h2 data-id="heading-16">04. 捕获组 vs 非捕获组：括号的秘密</h2>
<h3 data-id="heading-17">捕获组</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> text = <span class="hljs-string">"2026-01-20"</span>
<span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/(\d{4})-(\d{2})-(\d{2})/</span>
<span class="hljs-keyword">const</span> match = text.<span class="hljs-title function_">match</span>(regex)

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match[<span class="hljs-number">0</span>]) <span class="hljs-comment">// "2026-01-20"（完整匹配）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match[<span class="hljs-number">1</span>]) <span class="hljs-comment">// "2026"（第1个捕获组）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match[<span class="hljs-number">2</span>]) <span class="hljs-comment">// "01"（第2个捕获组）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match[<span class="hljs-number">3</span>]) <span class="hljs-comment">// "20"（第3个捕获组）</span>
</code></pre>
<h3 data-id="heading-18">非捕获组</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> text = <span class="hljs-string">"2026-01-20"</span>
<span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/(?:\d{4})-(?:\d{2})-(?:\d{2})/</span>
<span class="hljs-keyword">const</span> match = text.<span class="hljs-title function_">match</span>(regex)

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match[<span class="hljs-number">0</span>]) <span class="hljs-comment">// "2026-01-20"（完整匹配）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match[<span class="hljs-number">1</span>]) <span class="hljs-comment">// undefined（没有捕获组）</span>
</code></pre>
<p><strong>为什么要用非捕获组？</strong></p>
<ol>
<li><strong>性能更好</strong>：不需要保存捕获的内容</li>
<li><strong>避免混淆</strong>：不会影响捕获组的编号</li>
</ol>
<h3 data-id="heading-19">命名捕获组（ES2018）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> text = <span class="hljs-string">"2026-01-20"</span>
<span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})/</span>
<span class="hljs-keyword">const</span> match = text.<span class="hljs-title function_">match</span>(regex)

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match.<span class="hljs-property">groups</span>.<span class="hljs-property">year</span>) <span class="hljs-comment">// "2026"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match.<span class="hljs-property">groups</span>.<span class="hljs-property">month</span>) <span class="hljs-comment">// "01"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(match.<span class="hljs-property">groups</span>.<span class="hljs-property">day</span>) <span class="hljs-comment">// "20"</span>
</code></pre>
<p><strong>在替换中使用：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> text = <span class="hljs-string">"2026-01-20"</span>
<span class="hljs-keyword">const</span> formatted = text.<span class="hljs-title function_">replace</span>(
  <span class="hljs-regexp">/(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})/</span>,
  <span class="hljs-string">"$&lt;month&gt;/$&lt;day&gt;/$&lt;year&gt;"</span>,
)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(formatted) <span class="hljs-comment">// "01/20/2026"</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">05. 常见场景的正则表达式</h2>
<h3 data-id="heading-21">邮箱验证</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 过于简单</span>
/^.+@.+\..+$/

<span class="hljs-comment">// ❌ 过于复杂（RFC 5322 完整版，6000+ 字符）</span>
<span class="hljs-comment">// 不要尝试完全符合 RFC 标准</span>

<span class="hljs-comment">// ✅ 实用版本</span>
<span class="hljs-regexp">/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/</span>

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> emailRegex = <span class="hljs-regexp">/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(emailRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"user@example.com"</span>));     <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(emailRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"user.name@example.com"</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(emailRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"user@example.co.uk"</span>));   <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(emailRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"user@example"</span>));         <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(emailRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"@example.com"</span>));         <span class="hljs-comment">// false</span>
</code></pre>
<h3 data-id="heading-22">手机号验证（中国）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基础版本</span>
/^<span class="hljs-number">1</span>[<span class="hljs-number">3</span>-<span class="hljs-number">9</span>]\d{<span class="hljs-number">9</span>}$/

<span class="hljs-comment">// 支持 +86 和空格</span>
<span class="hljs-regexp">/^(\+86)?[\s-]?1[3-9]\d{9}$/</span>

<span class="hljs-comment">// 更严格的版本（区分运营商）</span>
<span class="hljs-regexp">/^1(3\d|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[0-35-9])\d{8}$/</span>

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> phoneRegex = <span class="hljs-regexp">/^1[3-9]\d{9}$/</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(phoneRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"13812345678"</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(phoneRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"19912345678"</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(phoneRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"12812345678"</span>)); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(phoneRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"138123456"</span>));   <span class="hljs-comment">// false</span>
</code></pre>
<h3 data-id="heading-23">URL 验证</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 简单版本</span>
/^https?:\/\/.+/

<span class="hljs-comment">// 更严格的版本</span>
<span class="hljs-regexp">/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&amp;//=]*)$/</span>

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> urlRegex = <span class="hljs-regexp">/^https?:\/\/.+/</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(urlRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"https://example.com"</span>));       <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(urlRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"http://example.com/path"</span>));   <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(urlRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"ftp://example.com"</span>));         <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(urlRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"example.com"</span>));               <span class="hljs-comment">// false</span>
</code></pre>
<h3 data-id="heading-24">身份证号验证（中国）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 18位身份证号</span>
;<span class="hljs-regexp">/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/</span>

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> idRegex =
  <span class="hljs-regexp">/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(idRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"110101199001011234"</span>)) <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(idRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"110101199013011234"</span>)) <span class="hljs-comment">// false（月份错误）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(idRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"110101199001321234"</span>)) <span class="hljs-comment">// false（日期错误）</span>
</code></pre>
<h3 data-id="heading-25">密码强度验证</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 至少8位，包含大小写字母、数字、特殊字符</span>
;<span class="hljs-regexp">/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&amp;])[A-Za-z\d@$!%*?&amp;]{8,}$/</span>

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> passwordRegex =
  <span class="hljs-regexp">/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&amp;])[A-Za-z\d@$!%*?&amp;]{8,}$/</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(passwordRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"Password1!"</span>)) <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(passwordRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"password1!"</span>)) <span class="hljs-comment">// false（没有大写）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(passwordRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"PASSWORD1!"</span>)) <span class="hljs-comment">// false（没有小写）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(passwordRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"Password!"</span>)) <span class="hljs-comment">// false（没有数字）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(passwordRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"Password1"</span>)) <span class="hljs-comment">// false（没有特殊字符）</span>
</code></pre>
<h3 data-id="heading-26">IP 地址验证</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// IPv4</span>
;<span class="hljs-regexp">/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/</span>

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> ipRegex =
  <span class="hljs-regexp">/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ipRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"192.168.1.1"</span>)) <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ipRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"255.255.255.255"</span>)) <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ipRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"256.1.1.1"</span>)) <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ipRegex.<span class="hljs-title function_">test</span>(<span class="hljs-string">"192.168.1"</span>)) <span class="hljs-comment">// false</span>
</code></pre>
<hr/>
<h2 data-id="heading-27">06. 为什么不要用正则解析 HTML</h2>
<h3 data-id="heading-28">经典问题</h3>
<p><strong>Stack Overflow 上最著名的回答之一：</strong></p>
<blockquote>
<p>**问：**如何用正则表达式解析 HTML？</p>
<p>**答：**你不能。HTML 不是正则语言。</p>
</blockquote>
<p><strong>为什么？</strong></p>
<p>HTML 是<strong>上下文无关文法</strong>（Context-Free Grammar），而正则表达式只能处理<strong>正则文法</strong>（Regular Grammar）。</p>
<h3 data-id="heading-29">尝试用正则解析 HTML</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 尝试提取所有 &lt;a&gt; 标签的 href</span>
<span class="hljs-keyword">const</span> html = <span class="hljs-string">`
  &lt;a href="https://example.com"&gt;Link 1&lt;/a&gt;
  &lt;a href='https://example.org'&gt;Link 2&lt;/a&gt;
  &lt;a href="https://example.net" target="_blank"&gt;Link 3&lt;/a&gt;
  &lt;a href="https://example.com/path?query=value&amp;other=123"&gt;Link 4&lt;/a&gt;
`</span>

<span class="hljs-comment">// ❌ 简单的正则</span>
<span class="hljs-keyword">const</span> regex1 = <span class="hljs-regexp">/&lt;a href="(.+)"&gt;/g</span>
<span class="hljs-keyword">const</span> matches1 = [...html.<span class="hljs-title function_">matchAll</span>(regex1)]
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(matches1.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> m[<span class="hljs-number">1</span>]))
<span class="hljs-comment">// ["https://example.com", "https://example.net" target="_blank"]</span>
<span class="hljs-comment">// ❌ 错误！第二个匹配包含了额外的属性</span>
</code></pre>
<p><strong>问题：</strong></p>
<ol>
<li>属性可以用单引号或双引号</li>
<li>属性之间可以有空格</li>
<li>属性顺序可以变化</li>
<li>标签可以嵌套</li>
<li>标签可以跨行</li>
</ol>
<h3 data-id="heading-30">正确的做法：使用 DOM Parser</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 使用 DOMParser（浏览器）</span>
<span class="hljs-keyword">const</span> parser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMParser</span>()
<span class="hljs-keyword">const</span> doc = parser.<span class="hljs-title function_">parseFromString</span>(html, <span class="hljs-string">"text/html"</span>)
<span class="hljs-keyword">const</span> links = doc.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">"a"</span>)
<span class="hljs-keyword">const</span> hrefs = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(links).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">link</span>) =&gt;</span> link.<span class="hljs-property">href</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hrefs)
<span class="hljs-comment">// ["https://example.com", "https://example.org", "https://example.net", ...]</span>

<span class="hljs-comment">// ✅ 使用 cheerio（Node.js）</span>
<span class="hljs-keyword">const</span> cheerio = <span class="hljs-built_in">require</span>(<span class="hljs-string">"cheerio"</span>)
<span class="hljs-keyword">const</span> $ = cheerio.<span class="hljs-title function_">load</span>(html)
<span class="hljs-keyword">const</span> hrefs = $(<span class="hljs-string">"a"</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">i, el</span>) =&gt;</span> $(el).<span class="hljs-title function_">attr</span>(<span class="hljs-string">"href"</span>))
  .<span class="hljs-title function_">get</span>()
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hrefs)
</code></pre>
<h3 data-id="heading-31">唯一的例外</h3>
<p><strong>如果你只是想做简单的文本替换：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 移除所有 HTML 标签</span>
<span class="hljs-keyword">const</span> text = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;[^&gt;]+&gt;/g</span>, <span class="hljs-string">""</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text)
<span class="hljs-comment">// "Link 1 Link 2 Link 3 Link 4"</span>
</code></pre>
<p><strong>但即使这样也有问题：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> html = <span class="hljs-string">"&lt;div&gt;Price: 5 &lt; 10&lt;/div&gt;"</span>
<span class="hljs-keyword">const</span> text = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;[^&gt;]+&gt;/g</span>, <span class="hljs-string">""</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text)
<span class="hljs-comment">// "Price: 5 "</span>
<span class="hljs-comment">// ❌ 错误！把 "&lt; 10" 当成标签删除了</span>
</code></pre>
<hr/>
<h2 data-id="heading-32">07. 正则表达式的性能优化</h2>
<h3 data-id="heading-33">技巧1：避免回溯</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 慢：会回溯</span>
/^(a+)+b$/

<span class="hljs-comment">// ✅ 快：不会回溯</span>
<span class="hljs-regexp">/^a+b$/</span>
</code></pre>
<h3 data-id="heading-34">技巧2：使用非捕获组</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 慢：创建捕获组</span>
/(\d{<span class="hljs-number">4</span>})-(\d{<span class="hljs-number">2</span>})-(\d{<span class="hljs-number">2</span>})/

<span class="hljs-comment">// ✅ 快：不创建捕获组（如果不需要捕获）</span>
<span class="hljs-regexp">/(?:\d{4})-(?:\d{2})-(?:\d{2})/</span>
</code></pre>
<h3 data-id="heading-35">技巧3：提前锚定</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 慢：会尝试每个位置</span>
/\d{<span class="hljs-number">4</span>}-\d{<span class="hljs-number">2</span>}-\d{<span class="hljs-number">2</span>}/

<span class="hljs-comment">// ✅ 快：只尝试开头</span>
<span class="hljs-regexp">/^\d{4}-\d{2}-\d{2}/</span>
</code></pre>
<h3 data-id="heading-36">技巧4：使用字符类而不是多个选择</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 慢</span>
/(a|b|c|d|e)/

<span class="hljs-comment">// ✅ 快</span>
<span class="hljs-regexp">/[a-e]/</span>
</code></pre>
<h3 data-id="heading-37">技巧5：避免不必要的全局匹配</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 慢：全局匹配</span>
<span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/\d+/g</span>
regex.<span class="hljs-title function_">test</span>(text)

<span class="hljs-comment">// ✅ 快：非全局匹配（如果只需要测试是否存在）</span>
<span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/\d+/</span>
regex.<span class="hljs-title function_">test</span>(text)
</code></pre>
<hr/>
<h2 data-id="heading-38">08. 正则表达式速查表</h2>
<h3 data-id="heading-39">基本语法</h3>
<pre><code class="hljs language-css" lang="css">.       任意字符（除换行符）
\d      数字 <span class="hljs-selector-attr">[0-9]</span>
\D      非数字 <span class="hljs-selector-attr">[^0-9]</span>
\w      单词字符 <span class="hljs-selector-attr">[a-zA-Z0-9_]</span>
\W      非单词字符
\s      空白字符 <span class="hljs-selector-attr">[ \t\n\r\f\v]</span>
\S      非空白字符
^       开始
$       结束
\<span class="hljs-selector-tag">b</span>      单词边界
\<span class="hljs-selector-tag">B</span>      非单词边界
</code></pre>
<h3 data-id="heading-40">量词</h3>
<pre><code class="hljs language-diff" lang="diff">*       0次或多次（贪婪）
<span class="hljs-addition">+       1次或多次（贪婪）</span>
?       0次或1次（贪婪）
{n}     恰好n次
{n,}    至少n次
{n,m}   n到m次
*?      0次或多次（非贪婪）
<span class="hljs-addition">+?      1次或多次（非贪婪）</span>
??      0次或1次（非贪婪）
</code></pre>
<h3 data-id="heading-41">字符类</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[abc]</span>   <span class="hljs-selector-tag">a</span>、<span class="hljs-selector-tag">b</span>或c
<span class="hljs-selector-attr">[^abc]</span>  除了<span class="hljs-selector-tag">a</span>、<span class="hljs-selector-tag">b</span>、c
<span class="hljs-selector-attr">[a-z]</span>   <span class="hljs-selector-tag">a</span>到z
<span class="hljs-selector-attr">[A-Z]</span>   <span class="hljs-selector-tag">A</span>到Z
<span class="hljs-selector-attr">[0-9]</span>   <span class="hljs-number">0</span>到<span class="hljs-number">9</span>
</code></pre>
<h3 data-id="heading-42">分组</h3>
<pre><code class="hljs language-scss" lang="scss">(...)       捕获组
(?:...)     非捕获组
(?&lt;name&gt;...)命名捕获组
</code></pre>
<h3 data-id="heading-43">断言</h3>
<pre><code class="hljs language-ruby" lang="ruby">(<span class="hljs-string">?=</span>...)     正向先行断言
(<span class="hljs-string">?!</span>...)     负向先行断言
(<span class="hljs-string">?&lt;</span>=...)    正向后行断言
(<span class="hljs-string">?&lt;</span>!...)    负向后行断言
</code></pre>
<h3 data-id="heading-44">标志</h3>
<pre><code class="hljs language-css" lang="css">g       全局匹配
<span class="hljs-selector-tag">i</span>       忽略大小写
m       多行模式
s       dotall模式（.匹配换行符）
u       Unicode模式
y       粘性模式
</code></pre>
<hr/>
<h2 data-id="heading-45">写在最后：正则不是银弹</h2>
<p>正则表达式很强大，但不是万能的。</p>
<p><strong>适合用正则的场景：</strong></p>
<ul>
<li>简单的文本匹配和替换</li>
<li>输入验证（邮箱、手机号、密码）</li>
<li>日志分析</li>
<li>简单的文本提取</li>
</ul>
<p><strong>不适合用正则的场景：</strong></p>
<ul>
<li>解析 HTML/XML（用 DOM Parser）</li>
<li>解析 JSON（用 JSON.parse）</li>
<li>复杂的语法分析（用专门的 Parser）</li>
<li>需要上下文的匹配（用状态机）</li>
</ul>
<p><strong>记住这些原则：</strong></p>
<ol>
<li>能用字符串方法就不用正则</li>
<li>能用简单正则就不用复杂正则</li>
<li>能用现成库就不自己写正则</li>
<li>写完正则一定要测试边界情况</li>
<li>复杂正则一定要加注释</li>
</ol>
<p><strong>正则表达式是工具，不是炫技的手段。</strong></p>
<p><strong>代码是写给人看的，不是写给正则引擎看的。</strong></p>
<hr/>
<p><strong>你被哪个正则表达式折磨过？</strong></p>
<p><strong>在评论区分享你的"正则地狱"故事吧！</strong></p>
<p><em>说不定，你的经历能救另一个正在 Google "regex email validation" 的开发者。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025，我确诊了“Vibe Coding”：当AI不再是工具，而是我的“外挂大脑”]]></title>    <link>https://juejin.cn/post/7597083949834387462</link>    <guid>https://juejin.cn/post/7597083949834387462</guid>    <pubDate>2026-01-20T07:22:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597083949834387462" data-draft-id="7597230546239324196" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025，我确诊了“Vibe Coding”：当AI不再是工具，而是我的“外挂大脑”"/> <meta itemprop="keywords" content="Trae,AI编程"/> <meta itemprop="datePublished" content="2026-01-20T07:22:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="装睡鹿先生"/> <meta itemprop="url" content="https://juejin.cn/user/1117561743761582"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025，我确诊了“Vibe Coding”：当AI不再是工具，而是我的“外挂大脑”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117561743761582/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    装睡鹿先生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T07:22:08.000Z" title="Tue Jan 20 2026 07:22:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>以前写代码靠“手速”和“记忆力”，2025年写代码靠的是“直觉”和“审美”。Andrej Karpathy 说的 "Vibe Coding"（氛围编码），我终于在这一年悟透了。</p>
<p>2024年初，我还在为 Cursor 的补全感到惊艳；到了2025年，我的开发模式已经彻底重塑。</p>
<p>作为一个写了多年 Java/Go 的后端老兵，这一年是我职业生涯中焦虑感最少，但产出最高的一年。今天不聊枯燥的架构图，聊聊这该死的、迷人的 Vibe Coding 时刻，以及它如何改变了我这个“大龄程序员”的 2025。</p>
<h2 data-id="heading-0">一、Agent 革命：从“帮我写”到“帮我做”</h2>
<p>2025年最大的体感差异，在于 Agent（智能体） 的成熟。</p>
<p>以前我们用 ChatGPT，是把它当百科全书或片段生成器：“帮我写个正则”、“解释这段报错”。</p>
<p>现在，我把它当实习生，甚至是高级合伙人。</p>
<p>也就是在那一刻，我进入了“Vibe Coding”状态：</p>
<h3 data-id="heading-1">📌 场景还原</h3>
<p>上周我要为一个老旧的遗留系统加一个复杂的报表功能，涉及多表聚合和即时计算。</p>
<p><strong>Old School (2023)</strong> ：打开 MyBatis 文档，回忆 SQL 语法，手写 Mapper，Debug 空指针，这一套下来至少 4 小时，中间还得去 Google 搜两遍报错。</p>
<p><strong>Vibe Coding (2025)</strong> ：我打开 IDE 的 Agent 模式（Composer/Windsurf），直接甩过去一段“伪代码+业务逻辑”的 Prompt。</p>
<p><strong>我的 Prompt：</strong></p>
<pre><code class="hljs language-sql" lang="sql">读取 <span class="hljs-keyword">Order</span> 表和 <span class="hljs-keyword">User</span> 表，按季度统计高净值用户的复购率。注意，高净值的定义是最近一年消费 Top <span class="hljs-number">10</span><span class="hljs-operator">%</span>。请用 Go 语言实现，使用 GORM，考虑到数据量级，不要在内存里做 <span class="hljs-keyword">Join</span>，直接生成优化的 <span class="hljs-keyword">SQL</span>。同时，帮我写好对应的 Unit Test。
</code></pre>
<p>30秒后，代码生成，测试通过。</p>
<p>我没有在写代码，我在Review代码。我从“搬砖工”变成了“工头”。</p>
<p>这种 Vibe（氛围）就是：我不需要记住每一个 API 的细节，我只需要保持对业务逻辑的清晰认知，剩下的脏活累活，Agent 全包了。我的大脑不再被语法糖占据，而是腾出空间去思考架构的优雅和业务的价值。</p>
<h2 data-id="heading-2">二、后端人的“全栈”平权运动</h2>
<p>对于像我这样的后端开发来说，2025年最大的红利是：技术栈的边界消失了。</p>
<p>以前我想做一个独立产品，卡在 CSS 居中、卡在 Webpack 配置、卡在 React 的 useEffect 闭包陷阱里。那种挫败感，足以劝退 90% 的后端。</p>
<p>但今年，我居然一个人上线了两款全栈应用。</p>
<h3 data-id="heading-3">✨ 我的“Vibe”时刻</h3>
<p>我想给女儿做一个“背古诗打怪兽”的网页小游戏。我不懂 Canvas，不懂 Vue3 的最新特性。</p>
<p>但我懂描述。</p>
<p>我像个产品经理一样对着 AI 说：“我要一个像素风的界面，左边是怪兽，右边是血条，背对一句诗，怪兽掉一滴血。”</p>
<p>AI 不仅给了我前端代码，还帮我生成了像素素材（SVG/图片）。</p>
<h3 data-id="heading-4">💡 感悟：</h3>
<p>2025年，全栈不再是一个职位，而是一种能力。 AI 抹平了语言的鸿沟。只要你懂逻辑（Backend Logic），前端、运维（Docker/K8s）、甚至测试，AI 都能帮你补齐。我们正在进入 Product Engineer（产品工程师） 的黄金时代。</p>
<h2 data-id="heading-5">三、生活 Vibe：数字游民的“预演”</h2>
<p>Vibe Coding 的连锁反应，直接溢出到了生活。</p>
<p>效率提升带来的直接结果就是：我准时下班了，甚至在某些远程办公的日子里，我提前“退休”了。</p>
<p>这一年，我开始尝试 Web3 和数字游民的生活方式。不是为了炒币，而是为了探索去中心化技术带来的自由度。</p>
<h3 data-id="heading-6">🌿 生活中的 AI 时刻：</h3>
<ol>
<li><strong>旅行攻略</strong>：我不再去某红书翻千篇一律的网红打卡点。我把我的兴趣（咖啡、黑胶唱片、建筑）喂给 AI，让它基于 Google Maps API 给我规划了一条完全定制化的“东京极客之旅”。</li>
<li><strong>家庭教育</strong>：面对孩子五花八门的“十万个为什么”，我用 AI 生成绘本故事解释“为什么月亮会跟着人走”。我自己甚至用 Suno 生成了一首只有我们一家人听得懂的“起床歌”。</li>
</ol>
<p>技术不再是冰冷的代码，它变成了生活的增味剂。这种松弛感，是以前那个天天担心线上 OOM 的我无法想象的。</p>
<h2 data-id="heading-7">四、2025 年度总结：得与失</h2>
<p>复盘 2025，作为一名开发者，我的底层操作系统发生了更迭。</p>
<h3 data-id="heading-8">❌ 失去的：</h3>
<ul>
<li>对语法的肌肉记忆：坦白说，我现在手写一个复杂的 CompletableFuture 链式调用可能会卡壳。</li>
<li>纯粹的技术傲慢：以前觉得懂底层源码很牛，现在觉得能快速用技术解决问题更牛。</li>
</ul>
<h3 data-id="heading-9">✅ 得到的：</h3>
<ul>
<li>系统性思维（System 2 Thinking）：当编码不再耗时，我花更多时间思考“为什么要做这个功能”而不是“怎么做”。</li>
<li>创造力的爆发：想法到产品的距离，被无限缩短了。</li>
<li>Vibe（松弛感）：也就是标题说的 Vibe Coding。Code with Flow, not with Force.</li>
</ul>
<h2 data-id="heading-10">写在最后</h2>
<p>如果说 2023 是 AI 的元年，2024 是 AI 的应用年，那么 2025 就是我们与 AI 达成“共生”的一年。</p>
<p>不要害怕 AI 会取代程序员。被取代的只是那个“只会写 CRUD、只会百度报错”的程序员。</p>
<p>Vibe Coding 的本质，不是让你不写代码，而是让你更有灵魂地写代码。</p>
<p>2026 即将到来，建议所有掘友们：</p>
<ol>
<li>拥抱 Agent：熟练掌握 1-2 个 AI 编程工具（Cursor/Windsurf/Trae 等）。</li>
<li>练习 Prompt：自然语言就是最新的编程语言（NLP is the new Python）。</li>
<li>保持敏锐：关注业务，关注产品，关注技术如何落地。</li>
</ol>
<p>愿大家在 2025，代码无 Bug，生活有 Vibe！🚀</p>
<p><strong>互动话题：</strong></p>
<p>2025年了，你现在的代码含“AI”量有多少？在评论区测测你的“Vibe”指数！👇</p>
<p>（记得点赞收藏，防止迷路）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数学运算与逻辑判断 - 运算符与条件语句]]></title>    <link>https://juejin.cn/post/7597024900521082932</link>    <guid>https://juejin.cn/post/7597024900521082932</guid>    <pubDate>2026-01-20T07:21:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597024900521082932" data-draft-id="7597199288816435240" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数学运算与逻辑判断 - 运算符与条件语句"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-20T07:21:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户8815838029450"/> <meta itemprop="url" content="https://juejin.cn/user/339129318513335"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数学运算与逻辑判断 - 运算符与条件语句
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/339129318513335/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户8815838029450
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T07:21:26.000Z" title="Tue Jan 20 2026 07:21:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">专栏导航</h2>
<ul>
<li>← 上一篇：<a href="https://juejin.cn/post/7595893785907724322" target="_blank" title="https://juejin.cn/post/7595893785907724322">存放数据的地方 - 数组与集合</a></li>
<li>← 第一篇：<a href="https://juejin.cn/post/7594642978695233599" target="_blank" title="https://juejin.cn/post/7594642978695233599">编程世界初探</a></li>
<li><a href="https://juejin.cn/post/7596989416761131043" target="_blank" title="https://juejin.cn/post/7596989416761131043">专栏目录</a></li>
</ul>
<blockquote>
<p>程序不仅是存储数据，更重要的是对数据进行处理和判断。这一周，我们学习如何进行数学运算和逻辑判断，让你的程序"聪明"起来。</p>
</blockquote>
<h3 data-id="heading-1">算术运算符</h3>
<p>算术运算符用于进行数学计算。</p>
<h4 data-id="heading-2">基本算术运算符</h4>









































<table><thead><tr><th>运算符</th><th>名称</th><th>示例</th><th>结果</th></tr></thead><tbody><tr><td><code>+</code></td><td>加法</td><td><code>5 + 3</code></td><td><code>8</code></td></tr><tr><td><code>-</code></td><td>减法</td><td><code>5 - 3</code></td><td><code>2</code></td></tr><tr><td><code>*</code></td><td>乘法</td><td><code>5 * 3</code></td><td><code>15</code></td></tr><tr><td><code>/</code></td><td>除法</td><td><code>10 / 3</code></td><td><code>3.333...</code></td></tr><tr><td><code>%</code></td><td>取余（模）</td><td><code>10 % 3</code></td><td><code>1</code></td></tr></tbody></table>
<h4 data-id="heading-3">取余运算符（%）</h4>
<p>取余运算符返回除法的余数。</p>
<pre><code class="hljs language-csharp" lang="csharp">Console.WriteLine(<span class="hljs-number">10</span> % <span class="hljs-number">3</span>);   <span class="hljs-comment">// 输出：1  (10 ÷ 3 = 3 余 1)</span>
Console.WriteLine(<span class="hljs-number">10</span> % <span class="hljs-number">2</span>);   <span class="hljs-comment">// 输出：0  (10 是偶数)</span>
Console.WriteLine(<span class="hljs-number">11</span> % <span class="hljs-number">2</span>);   <span class="hljs-comment">// 输出：1  (11 是奇数)</span>
</code></pre>
<p><strong>应用场景：</strong> 判断奇偶数、循环计数等</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 判断一个数是否为偶数</span>
<span class="hljs-built_in">int</span> number = <span class="hljs-number">10</span>;
<span class="hljs-built_in">bool</span> isEven = (number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-4">整数除法与浮点数除法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 整数除法（两个都是整数）</span>
<span class="hljs-built_in">int</span> a = <span class="hljs-number">10</span>;
<span class="hljs-built_in">int</span> b = <span class="hljs-number">3</span>;
Console.WriteLine(a / b);    <span class="hljs-comment">// 输出：3 (整数除法，舍弃小数)</span>

<span class="hljs-comment">// 浮点数除法（至少有一个浮点数）</span>
<span class="hljs-built_in">double</span> c = <span class="hljs-number">10.0</span>;
<span class="hljs-built_in">double</span> d = <span class="hljs-number">3</span>;
Console.WriteLine(c / d);    <span class="hljs-comment">// 输出：3.333...</span>
</code></pre>
<h4 data-id="heading-5">运算符优先级</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 先乘除，后加减</span>
<span class="hljs-built_in">int</span> result1 = <span class="hljs-number">2</span> + <span class="hljs-number">3</span> * <span class="hljs-number">4</span>;   <span class="hljs-comment">// 14 (3*4=12, 12+2=14)</span>

<span class="hljs-comment">// 使用括号改变优先级</span>
<span class="hljs-built_in">int</span> result2 = (<span class="hljs-number">2</span> + <span class="hljs-number">3</span>) * <span class="hljs-number">4</span>;  <span class="hljs-comment">// 20 (2+3=5, 5*4=20)</span>
</code></pre>
<p><strong>优先级（从高到低）：</strong></p>
<ol>
<li><code>()</code> 括号</li>
<li><code>*</code>, <code>/</code>, <code>%</code></li>
<li><code>+</code>, <code>-</code></li>
</ol>
<h3 data-id="heading-6">比较运算符</h3>
<p>比较运算符用于比较两个值，结果为 <code>true</code> 或 <code>false</code>。</p>















































<table><thead><tr><th>运算符</th><th>名称</th><th>示例</th><th>结果</th></tr></thead><tbody><tr><td><code>==</code></td><td>等于</td><td><code>5 == 5</code></td><td><code>true</code></td></tr><tr><td><code>!=</code></td><td>不等于</td><td><code>5 != 3</code></td><td><code>true</code></td></tr><tr><td><code>&lt;</code></td><td>小于</td><td><code>5 &lt; 3</code></td><td><code>false</code></td></tr><tr><td><code>&gt;</code></td><td>大于</td><td><code>5 &gt; 3</code></td><td><code>true</code></td></tr><tr><td><code>&lt;=</code></td><td>小于等于</td><td><code>5 &lt;= 5</code></td><td><code>true</code></td></tr><tr><td><code>&gt;=</code></td><td>大于等于</td><td><code>5 &gt;= 3</code></td><td><code>true</code></td></tr></tbody></table>
<h4 data-id="heading-7">使用示例</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> age = <span class="hljs-number">18</span>;
<span class="hljs-built_in">bool</span> isAdult = age &gt;= <span class="hljs-number">18</span>;      <span class="hljs-comment">// true</span>
<span class="hljs-built_in">bool</span> isChild = age &lt; <span class="hljs-number">12</span>;       <span class="hljs-comment">// false</span>
<span class="hljs-built_in">bool</span> canDrive = age &gt;= <span class="hljs-number">18</span>;     <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-8">注意：区分 <code>=</code> 和 <code>==</code></h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> a = <span class="hljs-number">5</span>;     <span class="hljs-comment">// 赋值运算符，把 5 赋值给 a</span>
<span class="hljs-built_in">bool</span> b = (<span class="hljs-number">5</span> == <span class="hljs-number">5</span>);  <span class="hljs-comment">// 比较运算符，判断 5 是否等于 5，结果 true</span>
</code></pre>
<h3 data-id="heading-9">逻辑运算符</h3>
<p>逻辑运算符用于组合多个条件判断。</p>





























<table><thead><tr><th>运算符</th><th>名称</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>&amp;&amp;</code></td><td>逻辑与（AND）</td><td>两个条件都为 true，结果才为 true</td><td><code>age &gt;= 18 &amp;&amp; hasLicense</code></td></tr><tr><td><code>||</code></td><td>逻辑或（OR）</td><td>两个条件至少一个为 true，结果就为 true</td><td><code>isWeekend || isHoliday</code></td></tr><tr><td><code>!</code></td><td>逻辑非（NOT）</td><td>取反，true 变 false，false 变 true</td><td><code>!isStudent</code></td></tr></tbody></table>
<h4 data-id="heading-10">逻辑与（&amp;&amp;）</h4>
<p>只有当两个条件都为 <code>true</code> 时，结果才为 <code>true</code>。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> age = <span class="hljs-number">25</span>;
<span class="hljs-built_in">bool</span> hasLicense = <span class="hljs-literal">true</span>;

<span class="hljs-built_in">bool</span> canDrive = age &gt;= <span class="hljs-number">18</span> &amp;&amp; hasLicense;  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 如果年龄不够</span>
<span class="hljs-built_in">int</span> age2 = <span class="hljs-number">16</span>;
<span class="hljs-built_in">bool</span> canDrive2 = age2 &gt;= <span class="hljs-number">18</span> &amp;&amp; hasLicense;  <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 如果没有驾照</span>
<span class="hljs-built_in">int</span> age3 = <span class="hljs-number">25</span>;
<span class="hljs-built_in">bool</span> hasLicense3 = <span class="hljs-literal">false</span>;
<span class="hljs-built_in">bool</span> canDrive3 = age3 &gt;= <span class="hljs-number">18</span> &amp;&amp; hasLicense3;  <span class="hljs-comment">// false</span>
</code></pre>
<p><strong>真值表：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-literal">true</span>  &amp;&amp; <span class="hljs-literal">true</span>  = <span class="hljs-literal">true</span>
<span class="hljs-literal">true</span>  &amp;&amp; <span class="hljs-literal">false</span> = <span class="hljs-literal">false</span>
<span class="hljs-literal">false</span> &amp;&amp; <span class="hljs-literal">true</span>  = <span class="hljs-literal">false</span>
<span class="hljs-literal">false</span> &amp;&amp; <span class="hljs-literal">false</span> = <span class="hljs-literal">false</span>
</code></pre>
<h4 data-id="heading-11">逻辑或（||）</h4>
<p>只要有一个条件为 <code>true</code>，结果就为 <code>true</code>。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">bool</span> isWeekend = <span class="hljs-literal">false</span>;
<span class="hljs-built_in">bool</span> isHoliday = <span class="hljs-literal">true</span>;

<span class="hljs-built_in">bool</span> canRest = isWeekend || isHoliday;  <span class="hljs-comment">// true</span>
</code></pre>
<p><strong>真值表：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-literal">true</span>  || <span class="hljs-literal">true</span>  = <span class="hljs-literal">true</span>
<span class="hljs-literal">true</span>  || <span class="hljs-literal">false</span> = <span class="hljs-literal">true</span>
<span class="hljs-literal">false</span> || <span class="hljs-literal">true</span>  = <span class="hljs-literal">true</span>
<span class="hljs-literal">false</span> || <span class="hljs-literal">false</span> = <span class="hljs-literal">false</span>
</code></pre>
<h4 data-id="heading-12">逻辑非（!）</h4>
<p>将 <code>true</code> 变为 <code>false</code>，<code>false</code> 变为 <code>true</code>。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">bool</span> isStudent = <span class="hljs-literal">true</span>;
<span class="hljs-built_in">bool</span> isNotStudent = !isStudent;  <span class="hljs-comment">// false</span>

<span class="hljs-built_in">bool</span> isAdult = <span class="hljs-literal">false</span>;
<span class="hljs-built_in">bool</span> isNotAdult = !isAdult;      <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-13">组合使用</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 年龄在 18 到 30 之间</span>
<span class="hljs-built_in">int</span> age = <span class="hljs-number">25</span>;
<span class="hljs-built_in">bool</span> isYoungAdult = age &gt;= <span class="hljs-number">18</span> &amp;&amp; age &lt;= <span class="hljs-number">30</span>;  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 周末或假期可以休息</span>
<span class="hljs-built_in">bool</span> isWeekend = <span class="hljs-literal">true</span>;
<span class="hljs-built_in">bool</span> isHoliday = <span class="hljs-literal">false</span>;
<span class="hljs-built_in">bool</span> canRest = isWeekend || isHoliday;      <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 不是学生或已经毕业</span>
<span class="hljs-built_in">bool</span> isStudent = <span class="hljs-literal">false</span>;
<span class="hljs-built_in">bool</span> hasGraduated = <span class="hljs-literal">false</span>;
<span class="hljs-built_in">bool</span> isNotStudentOrGraduated = !isStudent || hasGraduated;  <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-14">if 条件语句</h3>
<p>条件语句让程序能够根据不同情况执行不同的代码。</p>
<h4 data-id="heading-15">基本语法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (条件)
{
    <span class="hljs-comment">// 条件为 true 时执行的代码</span>
}
</code></pre>
<h4 data-id="heading-16">示例</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> age = <span class="hljs-number">18</span>;

<span class="hljs-keyword">if</span> (age &gt;= <span class="hljs-number">18</span>)
{
    Console.WriteLine(<span class="hljs-string">"你已经是成年人了！"</span>);
}
</code></pre>
<h4 data-id="heading-17">if-else 语句</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (条件)
{
    <span class="hljs-comment">// 条件为 true 时执行</span>
}
<span class="hljs-keyword">else</span>
{
    <span class="hljs-comment">// 条件为 false 时执行</span>
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> age = <span class="hljs-number">16</span>;

<span class="hljs-keyword">if</span> (age &gt;= <span class="hljs-number">18</span>)
{
    Console.WriteLine(<span class="hljs-string">"成年人"</span>);
}
<span class="hljs-keyword">else</span>
{
    Console.WriteLine(<span class="hljs-string">"未成年人"</span>);
}
</code></pre>
<h4 data-id="heading-18">if-else if-else 语句</h4>
<p>当有多个条件时使用：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> score = <span class="hljs-number">85</span>;

<span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">90</span>)
{
    Console.WriteLine(<span class="hljs-string">"优秀"</span>);
}
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">80</span>)
{
    Console.WriteLine(<span class="hljs-string">"良好"</span>);
}
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">60</span>)
{
    Console.WriteLine(<span class="hljs-string">"及格"</span>);
}
<span class="hljs-keyword">else</span>
{
    Console.WriteLine(<span class="hljs-string">"不及格"</span>);
}

<span class="hljs-comment">// 输出：良好</span>
</code></pre>
<p><strong>执行逻辑：</strong></p>
<ol>
<li>从上到下依次判断条件</li>
<li>遇到第一个 <code>true</code> 的条件，执行对应代码块</li>
<li>执行完后，跳过剩余所有 <code>else if</code></li>
<li>如果所有条件都为 <code>false</code>，执行 <code>else</code> 代码块</li>
</ol>
<h3 data-id="heading-19">三元运算符（?:）</h3>
<p>三元运算符是 <code>if-else</code> 的简写形式，适用于简单条件判断。</p>
<h4 data-id="heading-20">基本语法</h4>
<pre><code class="hljs language-csharp" lang="csharp">条件 ? 值<span class="hljs-number">1</span> : 值<span class="hljs-number">2</span>
</code></pre>
<p>如果条件为 <code>true</code>，返回值1；如果为 <code>false</code>，返回值2。</p>
<h4 data-id="heading-21">示例对比</h4>
<p><strong>使用 if-else：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> age = <span class="hljs-number">20</span>;
<span class="hljs-built_in">string</span> message;

<span class="hljs-keyword">if</span> (age &gt;= <span class="hljs-number">18</span>)
{
    message = <span class="hljs-string">"成年人"</span>;
}
<span class="hljs-keyword">else</span>
{
    message = <span class="hljs-string">"未成年人"</span>;
}
</code></pre>
<p><strong>使用三元运算符：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> age = <span class="hljs-number">20</span>;
<span class="hljs-built_in">string</span> message = age &gt;= <span class="hljs-number">18</span> ? <span class="hljs-string">"成年人"</span> : <span class="hljs-string">"未成年人"</span>;
</code></pre>
<p>一行代码完成相同的逻辑！</p>
<h4 data-id="heading-22">更多示例</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 判断奇偶数</span>
<span class="hljs-built_in">int</span> number = <span class="hljs-number">7</span>;
<span class="hljs-built_in">string</span> type = number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-string">"偶数"</span> : <span class="hljs-string">"奇数"</span>;

<span class="hljs-comment">// 比较大小</span>
<span class="hljs-built_in">int</span> a = <span class="hljs-number">5</span>, b = <span class="hljs-number">10</span>;
<span class="hljs-built_in">int</span> max = a &gt; b ? a : b;  <span class="hljs-comment">// max = 10</span>

<span class="hljs-comment">// 计算绝对值</span>
<span class="hljs-built_in">int</span> x = <span class="hljs-number">-5</span>;
<span class="hljs-built_in">int</span> abs = x &gt;= <span class="hljs-number">0</span> ? x : -x;  <span class="hljs-comment">// abs = 5</span>

<span class="hljs-comment">// 嵌套使用（不推荐，可读性差）</span>
<span class="hljs-built_in">int</span> score = <span class="hljs-number">85</span>;
<span class="hljs-built_in">string</span> grade = score &gt;= <span class="hljs-number">90</span> ? <span class="hljs-string">"优秀"</span> : score &gt;= <span class="hljs-number">80</span> ? <span class="hljs-string">"良好"</span> : <span class="hljs-string">"及格"</span>;
</code></pre>
<h4 data-id="heading-23">何时使用三元运算符</h4>
<p>✅ <strong>适合使用：</strong> 简单的条件赋值</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> status = isLoggedIn ? <span class="hljs-string">"已登录"</span> : <span class="hljs-string">"未登录"</span>;
</code></pre>
<p>❌ <strong>不适合使用：</strong> 复杂逻辑或需要多行代码</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 不要这样写</span>
<span class="hljs-built_in">string</span> result = condition ? VeryLongMethod1() : VeryLongMethod2();
</code></pre>
<h3 data-id="heading-24">实践：成绩等级判断</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">Week3Practice</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">"请输入你的成绩（0-100）："</span>);
            <span class="hljs-built_in">string</span> input = Console.ReadLine();
            <span class="hljs-built_in">int</span> score = <span class="hljs-built_in">int</span>.Parse(input);

            <span class="hljs-comment">// 使用 if-else if-else 判断等级</span>
            <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">90</span> &amp;&amp; score &lt;= <span class="hljs-number">100</span>)
            {
                Console.WriteLine(<span class="hljs-string">"成绩等级：优秀"</span>);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">80</span>)
            {
                Console.WriteLine(<span class="hljs-string">"成绩等级：良好"</span>);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">60</span>)
            {
                Console.WriteLine(<span class="hljs-string">"成绩等级：及格"</span>);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">0</span>)
            {
                Console.WriteLine(<span class="hljs-string">"成绩等级：不及格"</span>);
            }
            <span class="hljs-keyword">else</span>
            {
                Console.WriteLine(<span class="hljs-string">"输入错误！"</span>);
            }

            <span class="hljs-comment">// 使用三元运算符简化判断</span>
            <span class="hljs-built_in">bool</span> isPass = score &gt;= <span class="hljs-number">60</span>;
            <span class="hljs-built_in">string</span> passMessage = isPass ? <span class="hljs-string">"恭喜，你通过了考试！"</span> : <span class="hljs-string">"很遗憾，你未通过考试。"</span>;
            Console.WriteLine(passMessage);
        }
    }
}
</code></pre>
<h4 data-id="heading-25">运行示例</h4>
<pre><code class="hljs">请输入你的成绩（0-100）：
85
成绩等级：良好
恭喜，你通过了考试！
</code></pre>
<h3 data-id="heading-26">实践：简单计算器（使用 if-else）</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">Week3Practice</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">"===== 简单计算器 ====="</span>);

            Console.Write(<span class="hljs-string">"请输入第一个数字："</span>);
            <span class="hljs-built_in">double</span> num1 = <span class="hljs-built_in">double</span>.Parse(Console.ReadLine());

            Console.Write(<span class="hljs-string">"请输入运算符（+、-、*、/）："</span>);
            <span class="hljs-built_in">string</span> op = Console.ReadLine();

            Console.Write(<span class="hljs-string">"请输入第二个数字："</span>);
            <span class="hljs-built_in">double</span> num2 = <span class="hljs-built_in">double</span>.Parse(Console.ReadLine());

            <span class="hljs-built_in">double</span> result = <span class="hljs-number">0</span>;
            <span class="hljs-built_in">bool</span> isValid = <span class="hljs-literal">true</span>;

            <span class="hljs-comment">// 使用 if-else if 判断运算符</span>
            <span class="hljs-keyword">if</span> (op == <span class="hljs-string">"+"</span>)
            {
                result = num1 + num2;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (op == <span class="hljs-string">"-"</span>)
            {
                result = num1 - num2;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (op == <span class="hljs-string">"*"</span>)
            {
                result = num1 * num2;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (op == <span class="hljs-string">"/"</span>)
            {
                <span class="hljs-keyword">if</span> (num2 != <span class="hljs-number">0</span>)  <span class="hljs-comment">// 避免除以零</span>
                {
                    result = num1 / num2;
                }
                <span class="hljs-keyword">else</span>
                {
                    Console.WriteLine(<span class="hljs-string">"错误：除数不能为零！"</span>);
                    isValid = <span class="hljs-literal">false</span>;
                }
            }
            <span class="hljs-keyword">else</span>
            {
                Console.WriteLine(<span class="hljs-string">"错误：不支持的运算符！"</span>);
                isValid = <span class="hljs-literal">false</span>;
            }

            <span class="hljs-keyword">if</span> (isValid)
            {
                Console.WriteLine(<span class="hljs-string">$"结果：<span class="hljs-subst">{num1}</span> <span class="hljs-subst">{op}</span> <span class="hljs-subst">{num2}</span> = <span class="hljs-subst">{result}</span>"</span>);
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-27">运行示例</h4>
<pre><code class="hljs language-ini" lang="ini">===== 简单计算器 =====
请输入第一个数字：10
请输入运算符（+、-、*、/）：*
请输入第二个数字：5
结果：10 * <span class="hljs-attr">5</span> = <span class="hljs-number">50</span>
</code></pre>
<h3 data-id="heading-28">switch 语句</h3>
<p>当需要根据同一个变量进行多重选择时，<code>switch</code> 语句比 <code>if-else if</code> 更清晰简洁。</p>
<h4 data-id="heading-29">基本语法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">switch</span> (表达式)
{
    <span class="hljs-keyword">case</span> 值<span class="hljs-number">1</span>:
        <span class="hljs-comment">// 当表达式等于 值1 时执行</span>
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> 值<span class="hljs-number">2</span>:
        <span class="hljs-comment">// 当表达式等于 值2 时执行</span>
        <span class="hljs-keyword">break</span>;
    <span class="hljs-literal">default</span>:
        <span class="hljs-comment">// 当所有 case 都不匹配时执行</span>
        <span class="hljs-keyword">break</span>;
}
</code></pre>
<h4 data-id="heading-30">示例：判断星期</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> dayOfWeek = <span class="hljs-number">3</span>;  <span class="hljs-comment">// 假设 1=周一, 2=周二, ..., 7=周日</span>

<span class="hljs-keyword">switch</span> (dayOfWeek)
{
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        Console.WriteLine(<span class="hljs-string">"周一"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
        Console.WriteLine(<span class="hljs-string">"周二"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
        Console.WriteLine(<span class="hljs-string">"周三"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
        Console.WriteLine(<span class="hljs-string">"周四"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
        Console.WriteLine(<span class="hljs-string">"周五"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
        Console.WriteLine(<span class="hljs-string">"周六"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:
        Console.WriteLine(<span class="hljs-string">"周日"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-literal">default</span>:
        Console.WriteLine(<span class="hljs-string">"无效的星期"</span>);
        <span class="hljs-keyword">break</span>;
}
</code></pre>
<h4 data-id="heading-31">switch vs if-else if</h4>
<p><strong>使用 if-else if：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> op = <span class="hljs-string">"+"</span>;
<span class="hljs-built_in">double</span> result = <span class="hljs-number">0</span>;

<span class="hljs-keyword">if</span> (op == <span class="hljs-string">"+"</span>)
    result = num1 + num2;
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (op == <span class="hljs-string">"-"</span>)
    result = num1 - num2;
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (op == <span class="hljs-string">"*"</span>)
    result = num1 * num2;
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (op == <span class="hljs-string">"/"</span>)
    result = num1 / num2;
</code></pre>
<p><strong>使用 switch：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> op = <span class="hljs-string">"+"</span>;
<span class="hljs-built_in">double</span> result = <span class="hljs-number">0</span>;

<span class="hljs-keyword">switch</span> (op)
{
    <span class="hljs-keyword">case</span> <span class="hljs-string">"+"</span>:
        result = num1 + num2;
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"-"</span>:
        result = num1 - num2;
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"*"</span>:
        result = num1 * num2;
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"/"</span>:
        result = num1 / num2;
        <span class="hljs-keyword">break</span>;
}
</code></pre>
<h4 data-id="heading-32">when 条件（C# 7.0+）</h4>
<p>可以在 case 中添加额外条件：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> score = <span class="hljs-number">85</span>;

<span class="hljs-keyword">switch</span> (score)
{
    <span class="hljs-keyword">case</span> <span class="hljs-built_in">int</span> s <span class="hljs-keyword">when</span> s &gt;= <span class="hljs-number">90</span>:
        Console.WriteLine(<span class="hljs-string">"优秀"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-built_in">int</span> s <span class="hljs-keyword">when</span> s &gt;= <span class="hljs-number">80</span>:
        Console.WriteLine(<span class="hljs-string">"良好"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-built_in">int</span> s <span class="hljs-keyword">when</span> s &gt;= <span class="hljs-number">60</span>:
        Console.WriteLine(<span class="hljs-string">"及格"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-literal">default</span>:
        Console.WriteLine(<span class="hljs-string">"不及格"</span>);
        <span class="hljs-keyword">break</span>;
}
</code></pre>
<h4 data-id="heading-33">多个 case 共用代码</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> month = <span class="hljs-number">7</span>;

<span class="hljs-keyword">switch</span> (month)
{
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
        Console.WriteLine(<span class="hljs-string">"春季"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
        Console.WriteLine(<span class="hljs-string">"夏季"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:
        Console.WriteLine(<span class="hljs-string">"秋季"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-number">11</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-number">12</span>:
        Console.WriteLine(<span class="hljs-string">"冬季"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-literal">default</span>:
        Console.WriteLine(<span class="hljs-string">"无效的月份"</span>);
        <span class="hljs-keyword">break</span>;
}
</code></pre>
<h4 data-id="heading-34">字符串匹配</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> role = <span class="hljs-string">"admin"</span>;

<span class="hljs-keyword">switch</span> (role)
{
    <span class="hljs-keyword">case</span> <span class="hljs-string">"admin"</span>:
        Console.WriteLine(<span class="hljs-string">"管理员权限"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"user"</span>:
        Console.WriteLine(<span class="hljs-string">"普通用户权限"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"guest"</span>:
        Console.WriteLine(<span class="hljs-string">"访客权限"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-literal">default</span>:
        Console.WriteLine(<span class="hljs-string">"未知角色"</span>);
        <span class="hljs-keyword">break</span>;
}
</code></pre>
<h4 data-id="heading-35">必须使用 break 或 return</h4>
<p>每个 case 必须以 <code>break</code>、<code>return</code>、<code>throw</code> 或 <code>goto</code> 结束，避免代码"穿透"到下一个 case。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> num = <span class="hljs-number">2</span>;

<span class="hljs-keyword">switch</span> (num)
{
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        Console.WriteLine(<span class="hljs-string">"一"</span>);
        <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// 必须有 break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
        Console.WriteLine(<span class="hljs-string">"二"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-comment">// 如果忘记 break，编译器会报错</span>
}
</code></pre>
<h4 data-id="heading-36">返回值的 switch 表达式（C# 8.0+）</h4>
<p><strong>简洁写法（switch 表达式）：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> op = <span class="hljs-string">"+"</span>;
<span class="hljs-built_in">double</span> result = op <span class="hljs-keyword">switch</span>
{
    <span class="hljs-string">"+"</span> =&gt; num1 + num2,
    <span class="hljs-string">"-"</span> =&gt; num1 - num2,
    <span class="hljs-string">"*"</span> =&gt; num1 * num2,
    <span class="hljs-string">"/"</span> =&gt; num1 / num2,
    _ =&gt; <span class="hljs-number">0</span>  <span class="hljs-comment">// _ 表示 default</span>
};
</code></pre>
<p>这比传统 switch 更简洁！</p>
<p><strong>带 when 条件的 switch 表达式：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> score = <span class="hljs-number">85</span>;

<span class="hljs-built_in">string</span> grade = score <span class="hljs-keyword">switch</span>
{
    <span class="hljs-built_in">int</span> s <span class="hljs-keyword">when</span> s &gt;= <span class="hljs-number">90</span> =&gt; <span class="hljs-string">"优秀"</span>,
    <span class="hljs-built_in">int</span> s <span class="hljs-keyword">when</span> s &gt;= <span class="hljs-number">80</span> =&gt; <span class="hljs-string">"良好"</span>,
    <span class="hljs-built_in">int</span> s <span class="hljs-keyword">when</span> s &gt;= <span class="hljs-number">60</span> =&gt; <span class="hljs-string">"及格"</span>,
    _ =&gt; <span class="hljs-string">"不及格"</span>
};
</code></pre>
<h4 data-id="heading-37">何时使用 switch</h4>
<p>✅ <strong>适合使用 switch：</strong></p>
<ul>
<li>根据同一个变量的不同值执行不同操作</li>
<li>case 比较多（超过 3 个）</li>
<li>需要清晰的代码结构</li>
</ul>
<p>❌ <strong>不适合使用 switch：</strong></p>
<ul>
<li>条件涉及多个变量</li>
<li>需要复杂的逻辑判断（如范围判断）</li>
</ul>
<h3 data-id="heading-38">实践：改进的计算器（使用 switch）</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">Week3Practice</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">"===== 简单计算器 ====="</span>);

            Console.Write(<span class="hljs-string">"请输入第一个数字："</span>);
            <span class="hljs-built_in">double</span> num1 = <span class="hljs-built_in">double</span>.Parse(Console.ReadLine());

            Console.Write(<span class="hljs-string">"请输入运算符（+、-、*、/）："</span>);
            <span class="hljs-built_in">string</span> op = Console.ReadLine();

            Console.Write(<span class="hljs-string">"请输入第二个数字："</span>);
            <span class="hljs-built_in">double</span> num2 = <span class="hljs-built_in">double</span>.Parse(Console.ReadLine());

            <span class="hljs-built_in">double</span> result = <span class="hljs-number">0</span>;
            <span class="hljs-built_in">bool</span> isValid = <span class="hljs-literal">true</span>;

            <span class="hljs-comment">// 使用 switch 判断运算符（更清晰）</span>
            <span class="hljs-keyword">switch</span> (op)
            {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"+"</span>:
                    result = num1 + num2;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"-"</span>:
                    result = num1 - num2;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"*"</span>:
                    result = num1 * num2;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"/"</span>:
                    <span class="hljs-keyword">if</span> (num2 != <span class="hljs-number">0</span>)
                    {
                        result = num1 / num2;
                    }
                    <span class="hljs-keyword">else</span>
                    {
                        Console.WriteLine(<span class="hljs-string">"错误：除数不能为零！"</span>);
                        isValid = <span class="hljs-literal">false</span>;
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-literal">default</span>:
                    Console.WriteLine(<span class="hljs-string">"错误：不支持的运算符！"</span>);
                    isValid = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">break</span>;
            }

            <span class="hljs-keyword">if</span> (isValid)
            {
                Console.WriteLine(<span class="hljs-string">$"结果：<span class="hljs-subst">{num1}</span> <span class="hljs-subst">{op}</span> <span class="hljs-subst">{num2}</span> = <span class="hljs-subst">{result}</span>"</span>);
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-39">运行示例</h4>
<pre><code class="hljs language-ini" lang="ini">===== 简单计算器 =====
请输入第一个数字：10
请输入运算符（+、-、*、/）：*
请输入第二个数字：5
结果：10 * <span class="hljs-attr">5</span> = <span class="hljs-number">50</span>
</code></pre>
<h3 data-id="heading-40">实践：月份判断（使用 switch）</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">Week3Practice</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">"===== 月份季节判断 ====="</span>);
            Console.Write(<span class="hljs-string">"请输入月份（1-12）："</span>);
            <span class="hljs-built_in">int</span> month = <span class="hljs-built_in">int</span>.Parse(Console.ReadLine());

            <span class="hljs-built_in">string</span> season = month <span class="hljs-keyword">switch</span>
            {
                <span class="hljs-built_in">int</span> m <span class="hljs-keyword">when</span> m &gt;= <span class="hljs-number">3</span> &amp;&amp; m &lt;= <span class="hljs-number">5</span> =&gt; <span class="hljs-string">"春季"</span>,
                <span class="hljs-built_in">int</span> m <span class="hljs-keyword">when</span> m &gt;= <span class="hljs-number">6</span> &amp;&amp; m &lt;= <span class="hljs-number">8</span> =&gt; <span class="hljs-string">"夏季"</span>,
                <span class="hljs-built_in">int</span> m <span class="hljs-keyword">when</span> m &gt;= <span class="hljs-number">9</span> &amp;&amp; m &lt;= <span class="hljs-number">11</span> =&gt; <span class="hljs-string">"秋季"</span>,
                <span class="hljs-number">12</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> <span class="hljs-number">2</span> =&gt; <span class="hljs-string">"冬季"</span>,  <span class="hljs-comment">// 多值匹配（C# 9.0+）</span>
                _ =&gt; <span class="hljs-string">"无效的月份"</span>
            };

            Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{month}</span>月属于<span class="hljs-subst">{season}</span>"</span>);
        }
    }
}
</code></pre>
<h4 data-id="heading-41">运行示例</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">===== 月份季节判断 =====</span>
请输入月份（1-12）：7
7月属于夏季
</code></pre>
<h3 data-id="heading-42">本章总结</h3>
<ul>
<li>✅ 掌握了算术运算符：<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code></li>
<li>✅ 学会了比较运算符：<code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code></li>
<li>✅ 理解了逻辑运算符：<code>&amp;&amp;</code>, <code>||</code>, <code>!</code></li>
<li>✅ 掌握了 if-else 条件语句</li>
<li>✅ 学会了 switch 语句进行多重选择</li>
<li>✅ 掌握了三元运算符简化代码</li>
<li>✅ 实践了成绩判断和简单计算器</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 年 Vue 生态明星项目]]></title>    <link>https://juejin.cn/post/7596990822128156710</link>    <guid>https://juejin.cn/post/7596990822128156710</guid>    <pubDate>2026-01-20T07:26:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596990822128156710" data-draft-id="7596955804261695538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 年 Vue 生态明星项目"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-20T07:26:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="学什么前端"/> <meta itemprop="url" content="https://juejin.cn/user/3825956194889880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 年 Vue 生态明星项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956194889880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    学什么前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T07:26:02.000Z" title="Tue Jan 20 2026 07:26:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 年是不平凡的一年，从 AI 爆发式增长彻底改变了我们开发应用的方式， 到严重漏洞和安全攻击震撼整个生态系统的严峻挑战，2025年是创新与挑战并存的一年。</p>
<p>而在前端的发展中，Vue 生态在这一年又经历了哪些变化？下面 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Frisingstars.js.org%2F2025%2Fzh%23section-vue" target="_blank" title="https://risingstars.js.org/2025/zh#section-vue" ref="nofollow noopener noreferrer">Best of JS</a></strong> 比较了过去 12 个月在 <strong>GitHub</strong> 上获得的 <strong>Star</strong>，来回顾一下整个 Vue 生态的一个发展。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55de42a4ecca4edc9e75ada6f043662c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=%2F90hqOSwB7H%2FaiOq61QKTxcA5TE%3D" alt="" loading="lazy"/></p>
<p>我们把整个生态 <strong>2025 年</strong>的发展大致划分为以下 3 个方面：</p>
<h2 data-id="heading-0">开发者生产力工具</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsli.dev%2F" target="_blank" title="https://sli.dev/" ref="nofollow noopener noreferrer">Slidev (+9.3k stars)</a></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f672ea4353e4c918c73a3f02e699dad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=SFoYh%2B%2BrbJdyUEdHVlelwrjqYLQ%3D" alt="" loading="lazy"/></p>
<p>开发者的演示幻灯片工具 。</p>
<p>这就好比是用写代码的方式（Markdown）来做 PPT。它支持代码高亮、实时预览等功能，还能直接在 PPT 里运行 Vue 组件。</p>
<p>适用场景：技术分享、代码教学、内部技术评审。</p>
<ol start="5">
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitepress.dev%2F" target="_blank" title="https://vitepress.dev/" ref="nofollow noopener noreferrer">VitePress (+3.2k stars)</a></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69a28edca94946aaab8b73c66c0a7189~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=TmQCojHmfRHyvhNp98nMCZHeJ%2FU%3D" alt="" loading="lazy"/></p>
<p>基于 Vite 和 Vue 的静态站点生成器。</p>
<p>Vue 官方推荐的文档生成工具。它极快、简洁，现在很多 Vue 项目的官方文档就是用它写的。</p>
<p>适用场景：项目文档、简单的博客、个人主页。</p>
<ol start="9">
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPanJiaChen%2Fvue-element-admin" target="_blank" title="https://github.com/PanJiaChen/vue-element-admin" ref="nofollow noopener noreferrer">Vue Element Admin (+1.8k stars)</a></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0fd9ae2185f4345a7a57af4d83a7ed7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=FsaeIO5Xte0LW%2F35%2FCAnl%2FTsgPs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40161c51b556481e8c9b0e36998915df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=uQ6Gj7K%2Bg6wZFj1t6OcA7yQKR5g%3D" alt="" loading="lazy"/></p>
<p>一个神奇的 Vue 后台管理，让人感到不可思议的是，这是一个 <code>Vue2 项目</code>。</p>
<p>非常经典的、元老级的后台管理系统解决方案。虽然现在有了很多新选择，但它依然是很多企业后台系统的参考模板。</p>
<p>适用场景：快速搭建企业级中后台管理系统。</p>
<h2 data-id="heading-1">核心框架</h2>
<ol start="2">
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnuxt.com%2F" target="_blank" title="https://nuxt.com/" ref="nofollow noopener noreferrer">Nuxt (+3.7k stars)</a></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe62a7de140e4fd38d9e3c22e731b2b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=TBAiYF2Q5Uzk%2BtS1YyjC0GuAB%2FY%3D" alt="" loading="lazy"/></p>
<p>渐进式 Web SSR 框架 。</p>
<p>如果说 Vue 是引擎，那 Nuxt 就是一辆造好的整车。它提供了服务器端渲染 (SSR)、自动路由、SEO 优化等全套功能。</p>
<p>适用场景：需要 SEO 的官网、大型复杂的 Web 应用。</p>
<h2 data-id="heading-2">🎨 UI 组件库与设计系统</h2>
<p>UI 组件库的竞争是最激烈的，呈现出 <strong>“传统”</strong> 与 <strong>“新兴”</strong> 两种流派：</p>
<ol start="3">
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvue-bits.dev%2F" target="_blank" title="https://vue-bits.dev/" ref="nofollow noopener noreferrer">Vue Bits (+3.5k stars)</a></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d6b43d2f3684ee4bc25bc80189d8f49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=FXfgurazKjpdRs9mYKazlgekQ%2Fc%3D" alt="" loading="lazy"/></p>
<p>开源的动画与交互组件集合。</p>
<p>和我们早期推荐的 <a href="https://juejin.cn/post/7554572856147984424" target="_blank" title="https://juejin.cn/post/7554572856147984424">inspira-ui</a> 类似，它不是一个传统的通用 UI 库，而更像是一个<strong>特效库</strong>。它专注于提供那些炫酷的、动效丰富的组件，能让网页瞬间变得高大上。</p>
<p>Vue 的特效库又多了一个选择。</p>
<ol start="4">
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.shadcn-vue.com%2F" target="_blank" title="https://www.shadcn-vue.com/" ref="nofollow noopener noreferrer">shadcn-vue (+3.4k stars)</a></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c19031c220fb475dbf7756960d5b8f0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=DZyp%2BZKS2Qwy4PNxnBrNX4SJuss%3D" alt="" loading="lazy"/></p>
<p>shadcn-ui 的 Vue 移植版。</p>
<p>目前的<code>当红炸子鸡</code>。它不是一个让你 npm install 的库，而是让你把代码“复制粘贴”到项目里自己改。这给了开发者极大的控制权，不再受限于组件库原本的样式，对于需要高度定制化的应用是一个非常好的选择。</p>
<ol start="6">
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fprimevue.org%2F" target="_blank" title="https://primevue.org/" ref="nofollow noopener noreferrer">PrimeVue (+2.7k stars)</a></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7693c4bb29e3452792b99af1fe038dad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=0qFky7aMJHQ9x8f8jRjweRyg560%3D" alt="" loading="lazy"/></p>
<p>次世代 Vue UI 组件库。</p>
<p>功能极其丰富的大而全组件库。它的特点是组件多（图表、地图、编辑器都有）且主题系统非常强大，甚至支持无样式模式。</p>
<ol start="7">
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freka-ui.com%2F" target="_blank" title="https://reka-ui.com/" ref="nofollow noopener noreferrer">Radix Vue (+2.1k stars)</a></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0b6b0e53915466098968e956422f034~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=ZDeDPvnhSdn%2FD%2BvRmansurzUcZo%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>★</p>
<p>最新的 V2 版本已经升级为 Reka UI。</p>
</blockquote>
<p>用于构建高质量 UI 的开源组件库。</p>
<p>Headless UI（无头组件） 的代表。它只提供功能（比如下拉菜单的交互逻辑、无障碍访问），不提供任何样式。样式完全由你决定。shadcn-vue 底层就是用的它。</p>
<ol start="8">
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Felement-plus.org%2Fzh-CN%2F" target="_blank" title="https://element-plus.org/zh-CN/" ref="nofollow noopener noreferrer">Element Plus (+2.1k stars)</a></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0b057cc35764bab85074a633f8603b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=CyvC7xeGQDb6JmU9KpX2JCR%2FIwA%3D" alt="" loading="lazy"/></p>
<p>Element 团队制作的 Vue 3 UI 库。</p>
<p>国内开发者的老朋友。它是 Element UI 的 Vue 3 版本，不仅稳定，而且社区资源极其丰富，是很多国内公司的首选。</p>
<ol start="10">
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fui.nuxt.com%2F" target="_blank" title="https://ui.nuxt.com/" ref="nofollow noopener noreferrer">Nuxt UI (+1.8k stars)</a></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc6c210f706941f7a88167298c65d831~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=OA%2BEhGaVuHecqBRfqSxgDID%2BX4U%3D" alt="" loading="lazy"/></p>
<p>基于 Reka UI 和 Tailwind CSS 的 UI 库。</p>
<p>专门为 Nuxt 框架打造的 UI 库，深度集成，开发体验非常丝滑，且默认风格很现代化。</p>
<h2 data-id="heading-3">Vue 官方</h2>
<p>那 Vue 官方 2025 年又做了哪些工作呢？</p>
<h3 data-id="heading-4">Vue3</h3>



































<table><thead><tr><th>时间</th><th>核心工作内容</th><th>关键影响</th></tr></thead><tbody><tr><td>2025年 Q1</td><td>Vapor Mode (蒸汽模式) 核心功能稳定 🧪</td><td>Vue 开始脱离虚拟 DOM。对于极致性能要求的场景，打包体积将减小，速度更快。</td></tr><tr><td>2025年 Q2</td><td>Vite + Rolldown 深度集成 ⚡</td><td>Vite 的底层打包引擎切换为 Rust 编写的 Rolldown。项目的打包速度将迎来数倍甚至十倍的提升。</td></tr><tr><td>2025年 Q3</td><td>Vue 3.6 版本发布 📦</td><td>预计引入更成熟的响应式解构和全新的 useData 加载机制。</td></tr><tr><td>2025年 Q4</td><td>Vapor Mode 兼容性扩展 🔌</td><td>允许开发者在同一个项目中混合使用标准模式和 Vapor Mode，平滑迁移旧组件。</td></tr><tr><td>2026年 初</td><td>Vue 4.0 愿景讨论与实验 🚀</td><td>核心团队将正式评估是否将 Vapor Mode 作为未来主版本（4.0）的默认渲染引擎。</td></tr></tbody></table>
<h3 data-id="heading-5">Pinia</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d98e76a6b494c40aee1e9590c452b16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=B%2FWU0lxfroRGcWuY54n8tcgzo4Y%3D" alt="" loading="lazy"/></p>
<p>pinia 除了例行的更新和维护，还和 vue router 的进行了深度联动，通过 <strong>Data Loader</strong> 的形式，两者的边界开始变得模糊。</p>
<h3 data-id="heading-6">Vue Router</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e48c894b2644fb4a94d738703a498b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=%2BDcz%2BuPKWBoqgoSxnin4Ybs04FE%3D" alt="" loading="lazy"/></p>
<p>vue router 正在从一个单纯的路由管理器转变为应用的数据加载枢纽。</p>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fuvr.esm.is%2F" target="_blank" title="https://uvr.esm.is/" ref="nofollow noopener noreferrer">unplugin-vue-router</a>，能够实现：</p>
<ul>
<li>文件路由：文件结构即路由；</li>
<li>Data Loaders：在路由中进行异步状态管理；</li>
<li>TS 类型路由：自动生成路由类型声明文件；</li>
</ul>
<p>而 vue router 未来的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Frouter%2Freleases%2Ftag%2Fv5.0.0-beta.0" target="_blank" title="https://github.com/vuejs/router/releases/tag/v5.0.0-beta.0" ref="nofollow noopener noreferrer">5.0</a> 版本中将会内置这些功能。</p>
<h2 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fvoidzero.dev%2F" target="_blank" title="https://voidzero.dev/" ref="nofollow noopener noreferrer">VoidZero</a></h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cffe2d04c3e949d7888eb7aab8c6c6fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=aT8y170YxIZoK7Qu5%2BVpwuY7qBY%3D" alt="VoidZero 四骑士" loading="lazy"/></p>
<p>VoidZero 四骑士</p>
<p>VoidZero 在 2025 年达成的三大里程碑成果：</p>
<h3 data-id="heading-8">1. <a href="https://link.juejin.cn?target=https%3A%2F%2Frolldown.rs%2F" target="_blank" title="https://rolldown.rs/" ref="nofollow noopener noreferrer">Rolldown</a> 的全面投产 🏎️</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4de579efe80f42a896ea307039c0de09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=8pw1UJ4S4dQxtsSc5Na%2BE7z6hFo%3D" alt="" loading="lazy"/></p>
<p>Rolldown 是 VoidZero 的核心引擎，使用 Rust 编写的打包工具，旨在兼顾 esbuild 的高性能和 Rollup 的强大功能。</p>
<ul>
<li><code>统一性</code>：在 2025 年之前，我们开发用 esbuild，生产环境用 Rollup，这种不一致常导致“开发没问题，上线就报错”。Rolldown 实现了两者的统一。</li>
<li><code>极致性能</code>：由于底层完全由 Rust 构建，它在处理大型项目时的构建速度比传统的 JavaScript 工具快了数倍。</li>
</ul>
<h3 data-id="heading-9">2. <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vite.dev%2F" target="_blank" title="https://cn.vite.dev/" ref="nofollow noopener noreferrer">Vite7</a> 的原生化转型 ⚡</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3976bcd9e12c41078730c67a427f0f4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=z4tD3orPd2dU88EeEHjwVUBFot4%3D" alt="" loading="lazy"/></p>
<p>2025 年发布的 <code>Vite7</code> 是 VoidZero 生态的首个大规模应用成果。</p>
<ul>
<li><code>核心替换</code>：Vite7 正式将底层打包引擎替换为 Rolldown。</li>
<li><code>插件生态兼容</code>：虽然底层变了，但它几乎完美兼容了现有的 Rollup 插件生态，开发者可以无感迁移，享受到速度的提升。</li>
</ul>
<h3 data-id="heading-10">3. <a href="https://link.juejin.cn?target=https%3A%2F%2Foxc.rs%2F" target="_blank" title="https://oxc.rs/" ref="nofollow noopener noreferrer">Oxc</a> 的集成与性能压榨 🛠️</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e226dd682ab84f6fb30d1ad48512436b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=KUl7ckpWPl8b7HR9iZT3z1ZijM4%3D" alt="" loading="lazy"/></p>
<p>VoidZero 还整合了 Oxc。</p>
<ul>
<li><code>超越 Babel/ESLint</code>：2025 年，Oxc 提供的代码转换和类型检查能力被深度集成到工具链中，取代了过去沉重的 JavaScript 实现。</li>
<li><code>里程碑意义</code>：标志着前端工具链彻底进入了 <strong>“原生化”</strong> 时代，开发者不再需要忍受长时间的冷启动和热更新等待。</li>
</ul>
<h3 data-id="heading-11">4. <a href="https://link.juejin.cn?target=https%3A%2F%2Fvitest.dev%2F" target="_blank" title="https://vitest.dev/" ref="nofollow noopener noreferrer">Vitest</a></h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18e2b7460f9c4b779c3c03872643d395~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499447&amp;x-signature=AAYRKclpwgQe18Mmg%2FxdrsU1QXA%3D" alt="" loading="lazy"/></p>
<p>2025 年 Vitest 最显著的改进来自于将底层打包引擎更换为 Rolldown；同时带来了更高效的监视模式，当你修改一行代码时，相关的测试用例会几乎瞬间触发，反馈循环变得极其短促。</p>
<ul>
<li><code>原生浏览器支持</code>：2025 年的 Vitest 浏览器模式更加成熟，允许测试直接在真实的浏览器内核中运行。这解决了许多 JSDOM 无法模拟的样式和复杂交互（如拖拽）的问题。</li>
<li><code>无缝调试</code>：你可以直接在浏览器开发者工具里调试测试用例，看到的 DOM 结构和交互表现与真实用户完全一致。</li>
<li><code>智能测试覆盖分析</code>：通过 Oxc 提供的快速语法分析，Vitest 能更精准地判断哪些代码分支未被覆盖，并给出更具可读性的修复建议。</li>
<li><code>类型安全测试</code>：原生支持 TypeScript，expect-type 等特性被深度整合。</li>
</ul>
<h2 data-id="heading-12">总结</h2>
<p>2025 年整个 Vue 生态的发展主要集中在 3 个板块：</p>
<h3 data-id="heading-13">1. 开发者工具的崛起 (Developer Tools)</h3>
<p>最引人注目的是榜首项目 <code>Slidev</code>，它以 <code>+9.3k</code> 的增长量遥遥领先。</p>
<p>这表明 Vue 的生态已经不仅仅局限于应用开发本身，而是扩展到了开发者的工作流中。Slidev 作为一个面向开发者的演示文稿工具，它的流行反映了开发者对“代码即一切”（Presentation as Code）的高涨需求。</p>
<h3 data-id="heading-14">2. UI 组件库的新格局：灵活性 vs 完整性</h3>
<p>榜单中有半数以上的项目都与 UI 相关，但方向有所不同：</p>
<p>高度可定制化(Headless): <code>shadcn-vue (#4, +3.4k)</code> 和 <code>Radix Vue (#7, +2.1k)</code>的上榜，说明开发者越来越倾向于拥有样式的完全控制权，而不只是使用开箱即用的 UI 库。</p>
<p>经典与全能: 老牌强者 <code>Element Plus (#8)</code>和 <code>PrimeVue (#6)</code>依然稳健，证明企业级开发对成熟、大而全的组件库需求依然旺盛。</p>
<p>生态深度集成: <code>Nuxt UI (#10)</code>的出现显示了特定框架专属 UI 库的潜力。</p>
<h3 data-id="heading-15">3. 核心框架与内容驱动</h3>
<p><code>Nuxt (#2, +3.7k)</code> 继续作为 Vue 生态的旗舰框架领跑，显示了其在全栈和 SSR 领域的统治力。</p>
<p><code>VitePress (#5, +3.2k)</code>作为静态站点生成器的高排名，强调了文档和内容驱动站点在 Vue 生态中的重要性。</p>
<p><code>Vue Bits (#3, +3.5k)</code> 作为一个开源集合上榜，也反映了社区对高质量资源整理的渴望。</p>
<p>了解了这些项目的定位后，我们可以发现一个趋势：<strong>现在的 Vue 开发者越来越喜欢高定制化（如 shadcn-vue）和开发体验工具（如 Slidev）</strong> 。</p>
<p>那你是更倾向于使用 Element Plus 这种开箱即用的传统组件库，还是想尝试 shadcn-vue 这种高度自由的新模式呢？</p>
<blockquote>
<p>作品推荐</p>
<p><strong>Haotab 新标签页</strong>，一个优雅的新标签页</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromewebstore.google.com%2Fdetail%2Fhaotab-%25E6%2596%25B0%25E6%25A0%2587%25E7%25AD%25BE%25E9%25A1%25B5%2Ffcmpijobelbhgbakdffgjohkddigbiap%3Fauthuser%3D0%26hl%3Dzh-CN" target="_blank" title="https://chromewebstore.google.com/detail/haotab-%E6%96%B0%E6%A0%87%E7%AD%BE%E9%A1%B5/fcmpijobelbhgbakdffgjohkddigbiap?authuser=0&amp;hl=zh-CN" ref="nofollow noopener noreferrer">chrome 商店</a>
| <a href="https://link.juejin.cn?target=https%3A%2F%2Fmicrosoftedge.microsoft.com%2Faddons%2Fdetail%2Fhaotab-%25E6%2596%25B0%25E6%25A0%2587%25E7%25AD%25BE%25E9%25A1%25B5%2Fjakpmjeiokokeiclojbkjfglkfccfljh" target="_blank" title="https://microsoftedge.microsoft.com/addons/detail/haotab-%E6%96%B0%E6%A0%87%E7%AD%BE%E9%A1%B5/jakpmjeiokokeiclojbkjfglkfccfljh" ref="nofollow noopener noreferrer">edge 商店</a>
| <a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.haotab.link%2F" target="_blank" title="https://go.haotab.link/" ref="nofollow noopener noreferrer">在线版</a></p>
<p>静待你的体验❤</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-217 Prometheus 2.53.2 安装与配置实战：Scrape Targets、Exporter、告警链路与常见故障速查]]></title>    <link>https://juejin.cn/post/7597080391879475210</link>    <guid>https://juejin.cn/post/7597080391879475210</guid>    <pubDate>2026-01-20T07:24:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597080391879475210" data-draft-id="7596990822128140326" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-217 Prometheus 2.53.2 安装与配置实战：Scrape Targets、Exporter、告警链路与常见故障速查"/> <meta itemprop="keywords" content="后端,大数据,机器学习"/> <meta itemprop="datePublished" content="2026-01-20T07:24:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-217 Prometheus 2.53.2 安装与配置实战：Scrape Targets、Exporter、告警链路与常见故障速查
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T07:24:47.000Z" title="Tue Jan 20 2026 07:24:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：单机部署 Prometheus 2.53.2，拉取多台主机 node_exporter 指标并验证 Targets 状态</li>
<li>结论：核心是 scrape_configs 目标可达性与 /metrics 暴露一致性；告警与可视化链路需分组件落地</li>
<li>产出：可直接复用的安装/目录规划/配置模板 + Targets 验证路径 + 故障定位与修复清单</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e172747c9434b9ba04ad8c1fae871dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769498686&amp;x-signature=C25ifpfRJflRl2QKtHQnBEv8K0A%3D" alt="大数据-217 Prometheus 2.53.2 安装与配置实战：Scrape Targets、Exporter、告警链路与常见故障速查" loading="lazy"/></p>
<h2 data-id="heading-1">版本矩阵</h2>

































<table><thead><tr><th>项目</th><th>说明</th></tr></thead><tbody><tr><td>已验证</td><td>Prometheus 2.53.2（linux-amd64）采用官方 release tar.gz 解压后直接 ./prometheus 前台启动；适合快速验证与实验环境</td></tr><tr><td>静态发现（static_configs）</td><td>以 targets: ["host:port"] 方式配置；依赖 DNS/网络可达性与端口放通</td></tr><tr><td>node_exporter 端口 9100</td><td>文中 Targets 指向 9100；前提是被监控机已部署并对 Prometheus 放通访问</td></tr><tr><td>Prometheus Web UI /targets</td><td>使用 http://:9090/targets 验证抓取成功/失败与错误原因</td></tr><tr><td>Grafana/其他服务指标抓取</td><td>配置了 h121.wzk.icu:9091；需确保该端口实际暴露 /metrics（Grafana 默认并非 9091）</td></tr><tr><td>Alertmanager（未实配）</td><td>文中仅介绍与片段示例；生产需要单独部署并在 alerting.alertmanagers 配置可达地址</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4544a2b14f744008aaf5b96ba367207~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769498686&amp;x-signature=sWX9TJ%2B3KYLtcD10A%2F2fr4SqDsE%3D" alt="Prometheus 官网" loading="lazy"/></p>
<h2 data-id="heading-2">Prometheus</h2>
<h3 data-id="heading-3">架构设计</h3>
<p>Prometheus 的核心架构采用模块化设计，各组件职责明确且相互协作，构成完整的监控解决方案。以下是详细架构解析：</p>
<ol>
<li>Prometheus Server
作为核心组件，采用多进程架构：</li>
</ol>
<ul>
<li>数据采集：通过定时轮询（scrape）方式从配置的targets获取指标数据</li>
<li>存储引擎：采用自定义的时序数据库TSDB，支持高效压缩存储（采样数据可压缩至1.3 bytes/sample）</li>
<li>查询处理：提供PromQL查询语言，支持即时查询（instant query）和范围查询（range query）
典型配置示例：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'node'</span>
    <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">15s</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">'192.168.1.100:9100'</span>]
</code></pre>
<ol start="2">
<li>Exporter体系
作为指标转换中间件，主要分为：</li>
</ol>
<ul>
<li>系统级：node_exporter（采集CPU/内存/磁盘等200+指标）</li>
<li>服务级：mysql_exporter、redis_exporter</li>
<li>网络探测：blackbox_exporter支持HTTP/ICMP/TCP等协议检查
工作流程：目标系统 → Exporter转换 → Prometheus采集</li>
</ul>
<ol start="3">
<li>Alertmanager
报警管理子系统功能：</li>
</ol>
<ul>
<li>报警分组：将相关报警合并通知</li>
<li>抑制机制：避免级联报警风暴</li>
<li>路由分发：支持多接收器配置
典型路由配置示例：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">routes:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">receiver:</span> <span class="hljs-string">'slack-notifications'</span>
  <span class="hljs-attr">match:</span>
    <span class="hljs-attr">severity:</span> <span class="hljs-string">'critical'</span>
</code></pre>
<ol start="4">
<li>Pushgateway
特殊场景解决方案：</li>
</ol>
<ul>
<li>适用场景：CronJob等短周期任务</li>
<li>工作模式：任务将指标push至网关 → Prometheus定期pull网关</li>
<li>数据生命周期：默认2小时后自动过期</li>
</ul>
<ol start="5">
<li>客户端库
支持多种语言实现自定义指标：</li>
</ol>
<ul>
<li>Go: prometheus/client_golang</li>
<li>Java: io.prometheus/simpleclient</li>
<li>Python: prometheus_client
示例指标定义（Python）：</li>
</ul>
<pre><code class="hljs language-python" lang="python">REQUEST_COUNT = Counter(<span class="hljs-string">'http_requests_total'</span>, <span class="hljs-string">'Total HTTP requests'</span>)
REQUEST_COUNT.inc()
</code></pre>
<p>监控数据流转示意图：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Targets]</span> ←pull─ <span class="hljs-selector-attr">[Prometheus Server]</span> ─alert→ <span class="hljs-selector-attr">[Alertmanager]</span>
    ↑                ↑
   push             pull
    |                |
<span class="hljs-selector-attr">[Pushgateway]</span>    <span class="hljs-selector-attr">[Exporters]</span>
</code></pre>
<p>实际部署建议：</p>
<ul>
<li>生产环境应采用联邦架构，由多个Prometheus实例组成层级</li>
<li>配合Grafana实现可视化仪表盘</li>
<li>重要指标建议设置Recording Rules预计算</li>
</ul>
<h3 data-id="heading-4">官方网站</h3>
<pre><code class="hljs language-shell" lang="shell">https://prometheus.io/download/
</code></pre>
<p>这里用 <code>2.53.2</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ee4d0e17a6b474a85ca604fd29f5d92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769498686&amp;x-signature=%2FFRZ6GrgW0icS03BfrJtu%2F7N5fM%3D" alt="Prometheus 2.53.2 下载" loading="lazy"/></p>
<h3 data-id="heading-5">数据模型</h3>
<p>Prometheus 的数据模型基于键值对存储时间序列数据。它的数据单位是 时间序列，每个时间序列由 唯一的 metric 名称 和一组 标签（labels） 组成。标签使得用户可以灵活地标记和筛选数据，比如 http_requests_total{method="GET", status="200"} 表示获取到的 HTTP 请求总数。</p>
<h3 data-id="heading-6">数据采集方式</h3>
<p>Prometheus 的数据采集采用 Pull 模型，即 Prometheus 定期从指定的目标端点（targets）拉取数据。这种模型对分布式系统尤其适用，因为可以灵活配置并自动发现服务（通过与 Kubernetes 集成），无需每个服务都主动上报数据。</p>
<h3 data-id="heading-7">查询语言（PromQL）</h3>
<p>Prometheus 提供了一种强大的查询语言 PromQL，用于查询和分析存储的数据。PromQL 允许用户对数据进行复杂的运算和聚合，例如：</p>
<ul>
<li>rate(http_requests_total[5m])：计算过去 5 分钟的 HTTP 请求速率。</li>
<li>avg_over_time(cpu_usage[1h])：计算过去 1 小时的 CPU 使用率平均值。 PromQL 支持过滤、聚合、运算符、时间窗口等操作，使得用户可以灵活地分析监控数据。</li>
</ul>
<h3 data-id="heading-8">应用场景</h3>
<ul>
<li>在业务层作用埋点系统：支持多种语言（Go、Python、Ruby 等等），我们可以通过客户端对核心业务进行埋点，如下单流程、添加购物车等等</li>
<li>在应用层作用监控系统：一些主流应用可以通过官方或者第三方的导出器，来对这些应用做核心指标的收集，如 Redis、MySQL</li>
<li>在系统层用作系统监控除了常用软件，Prometheus 也有相关系统层和网络层 exporter，用于监控服务器或者网络</li>
<li>集成其他监控 Prometheus 还可以通过各种 exporter，集成其他的监控系统，收集监控数据，如 AWS CloudWatch、JMX、Pingdom 等等。</li>
</ul>
<p>我们需要完成：</p>
<ul>
<li>在监控服务器上安装 Prometheus</li>
<li>在被监控的环境上安装 export</li>
<li>安装 Grafana</li>
</ul>
<h3 data-id="heading-9">下载配置</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/software
wget https://github.com/prometheus/prometheus/releases/download/v2.53.2/prometheus-2.53.2.linux-amd64.tar.gz
</code></pre>
<p>执行结果如下所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b930af7856924a25a1caee19aa47faba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769498686&amp;x-signature=4s4o6OJQ9nUmtLi5ulBMsl7pjLI%3D" alt="Prometheus 2.53.2 Linux 版本下载" loading="lazy"/></p>
<h3 data-id="heading-10">解压配置</h3>
<pre><code class="hljs language-shell" lang="shell">tar -zxvf prometheus-2.53.2.linux-amd64.tar.gz
mv prometheus-2.53.2.linux-amd64 ../servers/
</code></pre>
<p>执行结果如下所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95ccb27d0e974f4d87bbf45b2af38d93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769498686&amp;x-signature=jWbTJron9ljqG7qLRR62%2FV3tISk%3D" alt="解压 Prometheus" loading="lazy"/></p>
<h3 data-id="heading-11">修改配置</h3>
<p>解压配置，修改配置文件，在项目对应目录下：</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/prometheus-2.53.2.linux-amd64
vim prometheus.yml
</code></pre>
<p>执行的结果如下所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e7aa7d5134a4c0384ee31fb3a05ab4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769498686&amp;x-signature=ZwF9n3iU2SDrS5oG4MUfp2%2ByUSY%3D" alt="修改Prometheus配置文件" loading="lazy"/>
我们需要进行一些配置：</p>
<pre><code class="hljs language-xml" lang="xml"># my global config
global:
  scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
  # scrape_timeout is set to the global default (10s).

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          # - alertmanager:9093

# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
rule_files:
  # - "first_rules.yml"
  # - "second_rules.yml"

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:
  # The job name is added as a label `job=<span class="hljs-tag">&lt;<span class="hljs-name">job_name</span>&gt;</span>` to any timeseries scraped from this config.
  - job_name: "prometheus"

    # metrics_path defaults to '/metrics'
    # scheme defaults to 'http'.

    static_configs:
      - targets: ["localhost:9090"]
      
  - job_name: "h121-wzk-icu"
    static_configs:
      - targets: ["h121.wzk.icu:9100"]

  - job_name: "h122-wzk-icu"
    static_configs:
      - targets: ["h122.wzk.icu:9100"]
      
  - job_name: "h123-wzk-icu"
    static_configs:
      - targets: ["h123.wzk.icu:9100"]
      
  - job_name: "wzk-icu-grafana"
    static_configs:
      - targets: ["h121.wzk.icu:9091"]
</code></pre>
<p>对应的内容如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f95d8f22fce4ac7b08aca403fcc2749~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769498686&amp;x-signature=gtG2cyYRhVtspnJ8SmAFdd7kcmY%3D" alt="修改配置Prometheus文件内容" loading="lazy"/></p>
<h3 data-id="heading-12">启动服务</h3>
<p>配置完成后，只需要运行起来这个软件：</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/prometheus-2.53.2.linux-amd64
./prometheus
</code></pre>
<p>执行结果如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3931d3584ab3477d923103a3957a47cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769498686&amp;x-signature=MwzPKE4H6EUgzYLNsxGL0q2WM08%3D" alt="启动 Prometheus 服务" loading="lazy"/>
我们通过 URL可以看到自带的监控界面：</p>
<pre><code class="hljs language-shell" lang="shell">http://h121.wzk.icu:9090/
</code></pre>
<p>访问结果如下所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e78837220fa415385f4f50fecfe442f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769498686&amp;x-signature=bytvZlI%2BsjcKcUyPybSAQqkYHZI%3D" alt="查看 Prometheus 后台服务" loading="lazy"/>
我们选择 Targets 选项：</p>
<pre><code class="hljs language-shell" lang="shell">http://h121.wzk.icu:9090/targets?search=
</code></pre>
<p>可以看到如下的内容：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5bd32bca68b4f3b9fb391be95621326~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769498686&amp;x-signature=1QpWMmWcEKqkx6CutTYTuMcxFIk%3D" alt="查看 Prometheus 服务" loading="lazy"/></p>
<h3 data-id="heading-13">Alerting 和通知</h3>
<p>Prometheus 可以基于查询结果设定报警规则，比如当 CPU 使用率超过 80% 持续一定时间，就可以触发报警。Prometheus 的 Alertmanager 负责管理和路由报警，支持去重、分组、静默处理等功能，帮助团队更高效地处理报警事件。Alertmanager 可以与多个通知平台集成，如 Slack、邮件、PagerDuty、OpsGenie 等。</p>
<h3 data-id="heading-14">存储机制</h3>
<p>Prometheus 的数据默认会保存在本地磁盘中，使用 TSDB（时间序列数据库） 存储引擎，以时间块的形式进行存储和压缩。为了满足长时间的数据保留和查询需求，Prometheus 也支持通过远程存储（如 Cortex、Thanos）扩展数据的持久化和高可用性。</p>
<h3 data-id="heading-15">服务发现</h3>
<p>Prometheus 提供了多种服务发现机制，能够自动发现新的监控目标。它支持静态配置、DNS 服务发现、文件服务发现以及多种平台的自动发现，比如 Kubernetes、Consul、Amazon EC2、Azure 等，使得 Prometheus 能够动态地发现容器、Pod、VM 等新资源，减少运维人员的手动操作。</p>
<h2 data-id="heading-16">错误速查</h2>



























































<table><thead><tr><th>症状</th><th>根因定位</th><th>修复</th><th/></tr></thead><tbody><tr><td>/targets 显示 DOWN，错误 connection refused</td><td>目标端口未监听 / 服务未启动 / 安全组或防火墙拒绝</td><td>Prometheus 机 <code>curl http://host:9100/metrics</code>；目标机 `ss -lntp</td><td>grep 9100`；启动 exporter；放通入站；确认监听地址非 127.0.0.1</td></tr><tr><td>/targets 显示 context deadline exceeded / timeout</td><td>网络抖动、链路慢、目标 /metrics 生成慢，或 scrape_timeout 太小</td><td>Prometheus 日志 <code>grep scrape</code>；抓包/trace；手动 <code>curl</code> 看响应耗时；对单 job 增加 scrape_timeout；优化 exporter；减少高开销采集项</td><td/></tr><tr><td>抓取返回 404</td><td>目标没有暴露 /metrics 或路径不同</td><td><code>curl -v http://host:port/metrics</code>；在 job 配置 metrics_path；修正端口或组件的 metrics 开关</td><td/></tr><tr><td>Prometheus 启动报错：error loading config file</td><td>YAML 缩进/字段名错误</td><td><code>./prometheus --config.file=prometheus.yml --log.level=debug</code>；修正 YAML；用 <code>promtool check config prometheus.yml</code>（推荐）</td><td/></tr><tr><td>Targets 正常但查询无数据</td><td>时间范围不对 / 时钟漂移 / label 过滤错误</td><td>UI Graph 里查 <code>up</code>；看实例时间同步；校准 NTP；用 <code>up{job="xxx"}</code> 验证；检查 label 过滤条件</td><td/></tr><tr><td>Prometheus 内存飙升/查询变慢</td><td>label 基数过高、抓取目标过多、规则计算重</td><td><code>tsdb status</code>、看 <code>prometheus_tsdb_*</code>、分析标签维度；降低 label 基数；加 recording rules；分片/联邦/Thanos 方案</td><td/></tr><tr><td>磁盘快速增长</td><td>retention 太长或高频采样；WAL/blocks 增长</td><td>观察 data 目录大小；<code>--storage.tsdb.retention.time</code>；调整 retention；降低采样频率；扩容磁盘；远端存储</td><td/></tr><tr><td>采集间歇性失败</td><td>DNS 解析不稳定/目标短暂重启</td><td>Prometheus 日志与错误码分布；对比目标重启记录；固定解析/改用 IP；加重试与健康检查；目标侧稳定化</td><td/></tr></tbody></table>
<h2 data-id="heading-17">其他系列</h2>
<h3 data-id="heading-18">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-132 Java 生态前沿 2025：Spring、Quarkus、GraalVM、CRaC 与云原生落地</strong></p>
<h3 data-id="heading-19">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-218 RocketMQ Java API 实战：同步/异步 Producer 与 Pull/Push Consumer</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 已完结，OSS已完结，GuavaCache已完结，EVCache已完结，RabbitMQ已完结，RocketMQ正在更新... 深入浅出助你打牢基础！</p>
<h3 data-id="heading-20">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开发者必看！TinyPro中后台系统最新Springboot上手指南~]]></title>    <link>https://juejin.cn/post/7597025960946024483</link>    <guid>https://juejin.cn/post/7597025960946024483</guid>    <pubDate>2026-01-20T07:32:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597025960946024483" data-draft-id="7596670644286554112" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开发者必看！TinyPro中后台系统最新Springboot上手指南~"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2026-01-20T07:32:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTiny社区"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开发者必看！TinyPro中后台系统最新Springboot上手指南~
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTiny社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T07:32:59.000Z" title="Tue Jan 20 2026 07:32:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文由TinyPro中后台系统贡献者周泽龙原创。</p>
<p>在长达三个月的开发下，终于TinyPro的Springboot后端版本终于要问世了，在本期内容中我将带大家一步步去搭建整个后端的流程，也将带大家去探索对于最新版本的更改应该如何实现，以及如何使用本项目进行一个二次的开发和探索。
首先我们先要对于TinyPro项目进行一个整体的拉取，去到TinyPro的官方进行拉取，当我们获取到项目以后就可以进行开始今天的项目构建了。</p>
<blockquote>
<p>接下来的流程就是对于前端i项目的搭建以及后端的springboot项目的搭建，最后再去介绍咱们新版本里面的一些特性和组件</p>
</blockquote>
<h2 data-id="heading-0">1.前端部分的搭建</h2>
<p>首先要确保咱们安装了Node.js、NPM、TinyCLI接下来就要正式初始化项目了首先我们进行初始化</p>
<p>(1)在命令行输入tiny init pro对项目进行一个初始化具体的流程可以看我的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1kNkeBKEEt%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1kNkeBKEEt/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">视频介绍</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7d9c92f0a51472eb3bcbbababdb1c4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=PD3cF0Dqgc4qUakaF8Jm5u1eXcI%3D" alt="img_v3_02u4_d0333bf1-9980-431d-be2b-dbfe8a3e66cg.jpg" loading="lazy"/>
(2)接下来就让我们进入到我们的项目里面，tinyvue的前端代码里面我们首先进行一个项目的依赖的下载大家可以使用npm install进行项目依赖的下载。</p>
<p>(3)当我们项目依赖下载完成后就可以进入到一个启动流程了，使用npm start进行一个项目的启动启动后就会开启3031端口这样就可以看见项目的启动界面了!</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83b7c197cfea4aa3b775ae959616d5ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=szFA%2FoAcPMSIHhTVD7FUviIzQPs%3D" alt="img_v3_02u4_000ed57c-e850-4949-9f38-5309dd9e69ag.png" loading="lazy"/></p>
<blockquote>
<p>到目前为止我们的前端项目就算正式启动成功了，接下来让我们一起开始启动后端项目</p>
</blockquote>
<h2 data-id="heading-1">2.后端项目的搭建</h2>
<p>首先我们需要确保自己的本地环境里面有jdk17，maven,mysql,redis以及一个自己喜欢的开发软件可以idea或者vscode</p>
<blockquote>
<p>好了准备工作做好以后接下来就让我们进入后端的开发和后端二次开发的一个介绍并且我也将带着大家去了解springboot里面的一些设计和里面的一些函数的内容接下来开始吧</p>
</blockquote>
<p>项目结构的介绍：
当进入到项目里面的时候我们最直观的可以看见项目的一个整体结构</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/701e11f942be46b98746a11c9e706c43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=cv4SM3zP5ZCdYrtEF%2FAeZCyhr%2Bg%3D" alt="img_v3_02u4_fefceef2-2098-4f7d-8b32-9895a6f1faag.png" loading="lazy"/>
（1）先介绍一下项目的一个配置文件，对于所有的springboot项目上来第一件事就算看配置文件<code>application.properties</code>文件这个文件里面包含了所有项目需要的配置比如：<code>mysql</code>,<code>redis</code>,<code>Springjpa</code>,<code>mybatis-plus</code>(项目里面没有使用，但是基本的配置都配置好了，也就兼容了喜欢使用mybatis-plus的同学）大家可以更具自己的数据库信息和redis进行配置，需要自己填写好数据库的用户名，端口和驱动地址，还有redis的配置信息比如主机地址和端口号</p>
<blockquote>
<p>到这里的同学，那就恭喜大家数据服务的配置我们就是做好了，接下来就是对项目的依赖的下载，这块主要涉及到maven的使用，如果还，没有下载maven的同学记得赶快去下载</p>
</blockquote>
<p>（2）接下来开始项目依赖的初始化过程，在项目启动的时候，我们需要先对项目的依赖包去官方的仓库里面下载(这块给大家一个提醒，如果下载过慢的同学记得去配置一下maven的国内镜像源进行下载和配置),敲入命令
<code>mvn install</code>进行一个项目依赖的下载。</p>
<blockquote>
<p>如果到这里都执行成功，大家就可以正式的启动项目，正式启动项目之前我希望大家可以去查看自己jdk的配置是否是17，因为接下来的必须要使用jdk17了</p>
</blockquote>
<p>（3）进入到<code>TinyProApplication</code>文件里面进行启动项目，在这之前需要确保启动了redis和mysql的服务，并且配置好了密码，然后启动项目以后我们就会看到一个提示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dde58377ecc49d987e66a1f51fe5662~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=wIVliMypuqN4Dq5U6Sr3PEVz%2Bq8%3D" alt="img_v3_02u4_fe85ca7b-734e-404e-87b6-88039cbcd7dg.png" loading="lazy"/>
这里就算证明项目的整体正式启动成功了，接下来就开始监听3000端口了。</p>
<blockquote>
<p>项目启动成功以后就可以开始进行一个交互了，大家就可以进入到刚才启动的前端项目里面准备进行一个交互，账户和密码都是admin，这块是配置里面预先写好的，如果有人需要修改这个用户和角色名称，可以进到 <code>DataInitializer</code>文件里面找到user配置进行修改</p>
</blockquote>
<h2 data-id="heading-2">3.二次开发的讲解</h2>
<p>首选项目里面可以进行二次开发的地方就算，<code>权限管理</code>，<code>拒绝策略</code>，以及<code>用户的登录校验</code>，<code>初始化配置</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3935bc5188a148f48fe92f29e67741c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=LHlQphv2XjgjpKsrewc2y44vvN4%3D" alt="img_v3_02u4_2f360650-8906-4132-92e6-72d89be6f99g.png" loading="lazy"/></p>
<p>（1）首先就是项目的权限管理的问题大家可以看见代码里面首先需要权限校验的接口上面都会有一个</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd33d0cd642940e7be2e4c3bdc20ef2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=lndcFyvqbmleoqlETzIWhTZcDqk%3D" alt="6.png" loading="lazy"/>
<code>@PermissionAnnotation</code>这个注解里面配置的就是当前接口需要用户所拥有的权限，然后这块里面底层的实现细节在aspect这个目录里面，然后里面就是对于apo的一个使用。如果大家需要给某一个接口增加新的权限大家就可以直接在接口的上面进行一个使用然后写入具体要限制的细节
比如可以写：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa3e0ca85c714052a9635d991d66ef60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=yhRC2e6y2dpk2sjZOIFjxNMAhfY%3D" alt="7.png" loading="lazy"/>
这块就是要求用户必须要有menu::query::list这个权限才能进入到这个接口里面进行查询操作如果大家想更进一步了解到权限管理的细节，可以去看aop的使用java里面的切面编程</p>
<p>（2）接下来可以看拒绝的策略，首先对于接口拒绝策略的具体控制在配置文件里面，大家可以看到</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f896e4900904987807a11eba0e56d70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=bq%2FGbSxS63%2FSZXPnAPZvJyPMVVk%3D" alt="8.PNG" loading="lazy"/><br/>
这块就是一个拒绝策略的开关，如果大家想开始拒绝策略就可以直接输入true这个然后就会开启拒绝策略进行项目模式，目前是默认在演示模式里面</p>
<blockquote>
<p>这个里面主要分为一个演示模式和一个项目模式，在项目模式里面大家可以自由的进行控制但是在演示模式里面，有很多的功能都被禁止了，所以大家要是不能使用的话就需要先查看是否是因为在演示模式里面导致的</p>
</blockquote>
<p>（3）接下来就是用户的登录校验，大家首先要明白的一个流程就是用户首先要登录，只有登录成功以后才会将token放到redis里面，然后用户登录的校验就会先去redis里面进行查询，如果查询的到就会通过校验，如果redis里面没有当前用户人的信息就会进行一个拒绝的返回，然后就会跳转到前端的登录界面里面进行一个登录。具体就是拿一个拦截器进行拦截然后对每一个请求都进行校验只有登录过的才能进行项目的操作
（4）项目的初始化整个项目的初始化都在DataInitializer.java这个文件里面，如果后续需要进行一个项目的初始化调整，比如更改初始化的顺序以及在初始化的过程中想再加载一些资源都可以在这个文件里面进行增加</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f49db8e6fe74d9e94461ed3cc647534~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=IuM2%2F3ze4UJSK2eIJyt6LWF5YfY%3D" alt="9.png" loading="lazy"/></p>
<p>在这个run方法里面进行添加，这样项目在启动的时候就会先去加载项目里面的内容然后生成一个data文件夹的，这就标志着项目以及初始化过了，不需要再进行初始化，接下来每次的项目初始化都会先去看项目里面是否有data的目录如果存在就不走初始化的逻辑了</p>
<blockquote>
<p>好了讲解完二次开发以后，接下来就要进入到docker的一个部署流程，在这个之前，大家可以更具的自己的情况去看是去买一个云服务器还是自己搭建一个虚拟机环境，然后进行配置，我在视频里面给搭建演示的就是在自己的虚拟机里面进行一个docker的部署和调用</p>
</blockquote>
<h2 data-id="heading-3">4.docker的部署讲解</h2>
<p>首先要了解在进行docker部署的时候，自己的容器文件里面的内容是否创建好了，以及对应的docker-compose.yml的一个配置</p>
<blockquote>
<p>再检查完这些内容以后就要进入到我们的一个docker的部署流程环节，其实本质上也很简单就是进入到项目的文件夹目录里面，然后直接执行docker compose up -d这个命令以后，等待下载，但是下载的过程里面会有很多的问题比如下载过慢问题</p>
</blockquote>
<p>（1）将项目的文件上传到服务器上面</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94845f611dc2484eb22351ffc7e712d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=rLs6MrTtaM7EITyt7VEhs29kUgI%3D" alt="10.png" loading="lazy"/></p>
<p>然后进入当前目录大家可以看见，项目里面有两个文件一个是Dockerfile另一个是docker-compose.yml着两个文件是我们必须要的文件，进入进去看见</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d53301bf3d444984b13125440ce36336~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=H7LDweVuhN6eDf8mIiSwErSfOQo%3D" alt="11.png" loading="lazy"/></p>
<p>里面就是一些配置比如mysql的地址以及redis的地址，都是对应着我们即将启动的容器名称</p>
<p>（2）接下来就开始正式的启动docker-compose.yml文件，使用命令<code>docker compose up -d</code>启动成功以后就可以进行前端端口的配置映射到线上的docker地址，方便未来的开发<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c69c65c2a994d909ee91e3e4789bf10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769499680&amp;x-signature=kXMzl3AdEIFNLT2JzlBgXDPtrCc%3D" alt="11.png" loading="lazy"/></p>
<p>这个就是启动成功了，大家可以看映射的地址进行修改前端的配置了</p>
<h2 data-id="heading-4">5.本次参加开源之夏的感受和收获</h2>
<p>在参加完这次的开源之夏以后，我最大的感受就是第一次有一个整齐的计划和老师还有别的学校的同学们可以一起开发一个软件，让我还没出社会的时候就已经拥有了独立开发的经验和经历。其次就是老师的辅导和社区的教导让我真的成长了很多，我特别感谢开源之夏和+OpenTiny社区对我的帮助,最后谢谢我的导师（真的很牛），他也很耐心的教我，特别感谢名字的话就不说了，不然以后有人烦他去了</p>
<blockquote>
<p>谢谢大家我真的很珍惜这次机会，谢谢开源之夏，谢谢OpenTiny社区，谢谢导师，那我的这次开源之旅就结束，但是我相信只是暂时，我以后还会继续投身到开源里面，也希望可以帮助更多的人</p>
</blockquote>
<h2 data-id="heading-5">关于OpenTiny</h2>
<p>欢迎加入 OpenTiny 开源社区。添加微信小助手：opentiny-official 一起参与交流前端技术～</p>
<p>OpenTiny 官网：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design" target="_blank" title="https://opentiny.design" ref="nofollow noopener noreferrer">opentiny.design</a></strong><br/>
OpenTiny 代码仓库：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny" target="_blank" title="https://github.com/opentiny" ref="nofollow noopener noreferrer">github.com/opentiny</a></strong><br/>
TinyPro 源码：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-pro" target="_blank" title="https://github.com/opentiny/tiny-pro" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a></strong><br/>
欢迎进入代码仓库 Star🌟TinyEngine、TinyVue、TinyNG、TinyCLI、TinyEditor~
如果你也想要共建，可以进入代码仓库，找到 good first issue标签，一起参与开源贡献~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从送外卖看Android Clean架构：为什么老板不需要知道外卖员开什么车？]]></title>    <link>https://juejin.cn/post/7596187471774138377</link>    <guid>https://juejin.cn/post/7596187471774138377</guid>    <pubDate>2026-01-19T00:04:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596187471774138377" data-draft-id="7582922476222660623" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 从送外卖看Android Clean架构：为什么老板不需要知道外卖员开什么车？"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-19T00:04:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="潜龙勿用之化骨龙"/> <meta itemprop="url" content="https://juejin.cn/user/2313028195058471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             从送外卖看Android Clean架构：为什么老板不需要知道外卖员开什么车？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028195058471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    潜龙勿用之化骨龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:04:05.000Z" title="Mon Jan 19 2026 00:04:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象你经营一家外卖公司，公司里有三种角色：</p>
<ol>
<li><strong>老板</strong>（你）：制定送餐规则，关心利润</li>
<li><strong>餐厅经理</strong>：准备食物，保证质量</li>
<li><strong>外卖员</strong>：把食物送到客户手中</li>
</ol>
<p>现在，如果你是老板，你需要知道每个外卖员是<strong>骑电动车、自行车还是开车</strong>吗？需要知道他们用什么导航<strong>高德还是百度</strong>吗？</p>
<p><strong>不需要！</strong> 你只关心：</p>
<ul>
<li>食物准时送到（30分钟内）</li>
<li>客户满意（不洒不漏）</li>
<li>公司赚钱（成本控制）</li>
</ul>
<p>这就是Clean架构的核心思想！让我们用这个外卖公司的例子，彻底理解Android开发中的关注点分离和依赖规则。</p>
<h2 data-id="heading-0">一、外卖公司的混乱：没有Clean架构</h2>
<h3 data-id="heading-1">❌ 混乱的外卖公司（糟糕的代码结构）</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3640e327ed44fed960f91a2705142d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=XWC6lCCu09IOS3f27q6LD4wGC7Q%3D" alt="image.png" loading="lazy"/>
<strong>问题分析</strong>：这个外卖员干了厨师、打包员、导航员、司机、收银员、文员的所有工作！</p>
<h3 data-id="heading-2">❌ 如果公司要扩张...</h3>
<ul>
<li>想换导航软件？要重新培训所有外卖员</li>
<li>想增加新菜品？外卖员要学新菜</li>
<li>想换支付方式？外卖员要重新学习</li>
<li>外卖员离职了？所有知识都带走了</li>
</ul>
<h2 data-id="heading-3">二、专业的外卖公司：Clean架构实现</h2>
<h3 data-id="heading-4">✅ 清晰的分工（关注点分离）</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7110ae5c5d95479cbe67a8cd32360f4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=3e1bfdOFs3LlPzK1MVR1MMyYkZE%3D" alt="mermaid_20251215_7b952f.png" loading="lazy"/></p>
<h3 data-id="heading-5">2.1 领域层：老板制定规则（不关心具体实现）</h3>
<p>domain/model/Delivery.kt - 核心业务模型</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80705802052942149ff9f3120b4d4a55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=GnDygqEu15Oj167xg%2B9erIjNMEU%3D" alt="image.png" loading="lazy"/></p>
<p>domain/repository/DeliveryRepository.kt - 老板定义的接口</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97429bb3b6d14707b3eacec507335a1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=BTB4S2B3OAfvwRx3uK6wi5WHdmE%3D" alt="image.png" loading="lazy"/></p>
<p>domain/usecase/AssignDeliveryUseCase.kt - 老板的业务逻辑</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46c3a094897546d09cf3026480a79dc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=OgR9xnkE52qQgDmQx6w3o0Cws%2FI%3D" alt="image.png" loading="lazy"/>
}</p>
<p><strong>老板（领域层）的特点</strong>：</p>
<ul>
<li>不知道外卖员开什么车（不关心具体实现）</li>
<li>不知道餐厅用什么灶具（不关心数据源）</li>
<li>只关心业务规则和利润</li>
</ul>
<h3 data-id="heading-6">2.2 数据层：餐厅准备食物（具体实现）</h3>
<p>data/repository/DeliveryRepositoryImpl.kt - 餐厅经理的实现</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c8001fcb8e841d9b88a7a80eebc0c42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=L6hBu9c%2BuTmjY8Rr14F09gQ%2Bvc8%3D" alt="image.png" loading="lazy"/></p>
<p><strong>餐厅（数据层）的特点</strong>：</p>
<ul>
<li>实现老板要求的菜品标准</li>
<li>可以使用各种厨房设备（Retrofit）</li>
<li>负责把原材料（网络数据）加工成标准菜品（领域实体）</li>
</ul>
<h3 data-id="heading-7">2.3 表示层：外卖员送餐（UI展示）</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eee320a355184cc499853de3803a4ce8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=QYHLY7jcdZKLVgj2yyY41118xCw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c787c61188ec4c5f9fbdcce2b38e73f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=dxjp5gRWa9D0LTISnWQgpFH%2FFYw%3D" alt="image.png" loading="lazy"/></p>
<p><strong>外卖员（表示层）的特点</strong>：</p>
<ul>
<li>可以是电动车、自行车、汽车（不同UI实现）</li>
<li>可以使用不同导航软件（不同地图SDK）</li>
<li>负责把食物（数据）展示给客户（用户）</li>
<li>与客户交互（用户输入）</li>
</ul>
<h2 data-id="heading-8">三、依赖规则：为什么老板不需要知道外卖员开什么车？</h2>
<h3 data-id="heading-9">3.1 依赖关系图</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef0dc9c691614101b33c686414772686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=y7D%2B3huF0hpPm2XbbTd13KnAzZQ%3D" alt="mermaid_20251215_682d14.png" loading="lazy"/></p>
<h3 data-id="heading-10">3.2 关键规则：依赖只能指向老板（领域层）</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59491e0523884905a32d77b399151698~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=A9ZZGMiF8HoTVN3zmSU56hsrgjY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ff08593ff57486f9aab2f5de82c08e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=39j4hNRuq6ouUzgrlAsyFzQ6QDI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69ccd9562ebe4988b631c4dd77e890eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=E%2FI1aZSza7xq77kQbg4GPHGFLUI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-11">3.3 依赖注入：公司的HR部门</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f17159a7bd34758ab95994e9141f8c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=7sIfBDFF04%2BL%2BMHwJRoIS5ewSEI%3D" alt="image.png" loading="lazy"/></p>
<p>老板只需要告诉HR需要什么人，HR负责招聘</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc3e05bfc8884710bda4ebaf39dac736~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=4PRcOZaZqL0TNByTpaxhJcZoaN4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-12">4.1 如何开始重构现有项目？</h3>
<p><strong>第一步：识别"超级外卖员"类</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ba03852fdbb40ffbb54652821073f7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=GngjP8IuFcYrz%2FC1kR2t4hgquxw%3D" alt="image.png" loading="lazy"/></p>
<p><strong>第二步：提取"老板规则"（领域层）</strong> 当然我不建议usecase 抛出异常,应该包装起来。这里只是举例。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5fe9ae247be447da0634ea4322e0351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=fAHCowM%2Bd%2Bkp7a7BUgQCjqBQb8Y%3D" alt="image.png" loading="lazy"/></p>
<p><strong>第三步：创建"餐厅厨房"（数据层</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf82fcce0fdf4695b7c93658eaae2ce8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=juqfOqdpirPzCt1YNl8XOFWScaE%3D" alt="image.png" loading="lazy"/></p>
<p><strong>第四步：改造"外卖员"（表示层）</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aceed0ee3e944f998b0607393f305bd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=88sCn8gGBGhtzP8zE9RORkw8P5Y%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-13">5.2 常见问题解答</h3>
<p><strong>Q：小型项目也需要这样分层吗？</strong>
A：就像小外卖店开始可能只有一个人（老板兼厨师兼外卖员），但当业务增长时，一定要提前规划分工。可以从简单三层开始。</p>
<p><strong>Q：UseCase会不会太多？</strong>
A：就像老板的规则文档，重要的规则才需要写成UseCase。简单的CRUD操作可以直接在Repository处理。</p>
<p><strong>Q：测试真的变容易了吗？</strong>
A：你可以单独测试：</p>
<ul>
<li>老板的规则（UseCase测试）→ 验证业务逻辑</li>
<li>餐厅的菜品（Repository测试）→ 验证数据处理</li>
<li>外卖员的服务（UI测试）→ 验证用户交互</li>
</ul>
<p><strong>Q：学习成本高吗？</strong>
A：就像培训外卖员需要时间，但一旦掌握，效率倍增。从一个小功能开始尝试。</p>
<h3 data-id="heading-14">5.3 外卖架构的终极好处</h3>
<ol>
<li><strong>可维护性</strong>：老板换规则，不用重新培训外卖员</li>
<li><strong>可测试性</strong>：可以单独测试老板的决策逻辑</li>
<li><strong>可扩展性</strong>：增加新城市、新交通工具都很容易</li>
<li><strong>团队协作</strong>：可以并行开发（有人设计规则，有人开发UI，有人对接API）</li>
<li><strong>技术升级</strong>：换导航、换地图、换支付，都不影响核心业务</li>
</ol>
<h2 data-id="heading-15">六、总结：像经营外卖公司一样写Android代码</h2>
<p>记住这个简单的原则：</p>
<p><strong>你的代码应该像一个专业的外卖公司：</strong></p>
<ul>
<li>
<p><strong>老板（领域层）</strong>：制定规则，关心业务，不关心具体实现</p>
</li>
<li>
<p><strong>餐厅（数据层）</strong>：准备标准菜品，可以用各种厨具</p>
</li>
<li>
<p><strong>外卖员（表示层）</strong>：专业配送，良好服务，灵活应变</p>
</li>
</ul>
<p><strong>依赖规则就是</strong>：外卖员听老板的，餐厅按老板的标准做菜，但老板不需要知道外卖员开什么车，也不需要知道餐厅用什么牌子的灶具。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 3.0新特性：ProblemDetail让错误响应不再头疼]]></title>    <link>https://juejin.cn/post/7596698363933261874</link>    <guid>https://juejin.cn/post/7596698363933261874</guid>    <pubDate>2026-01-19T01:04:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596698363933261874" data-draft-id="7596698363933229106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 3.0新特性：ProblemDetail让错误响应不再头疼"/> <meta itemprop="keywords" content="后端,Java,程序员"/> <meta itemprop="datePublished" content="2026-01-19T01:04:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SimonKing"/> <meta itemprop="url" content="https://juejin.cn/user/4001878056904584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 3.0新特性：ProblemDetail让错误响应不再头疼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4001878056904584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SimonKing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T01:04:05.000Z" title="Mon Jan 19 2026 01:04:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>关注我的公众号：【编程朝花夕拾】，可获取首发内容。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/964a52a8cca04e98a0f11066c138586f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=OZlaRgb20mm9rgLlZA5t48LPNAg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">01 引言</h2>
<p>之前写过一篇关于统一相应的参数处理的文章，有路过的朋友指出错误信息为什么还要统一处理。技术储备浅薄的我一脸懵逼，经过交流才知道，大佬使用了<code>ProblemDetail</code>处理异常，于是专门学习了一下，记录下来分享给大家。</p>
<h2 data-id="heading-1">02 简介</h2>
<p><code>org.springframework.http.ProblemDetail</code></p>
<p><code>ProblemDetail</code> 是 <code>Spring Boot 3.0</code>（Spring Framework 6.0）引入的类，用于标准化 <code>HTTP API</code> 错误响应格式，符合 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc7807" target="_blank" title="https://tools.ietf.org/html/rfc7807" ref="nofollow noopener noreferrer">RFC 7807</a> 标准。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b105c926af0740ea82ac5f9a8e7326cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=2hWDOWAzpb9BVkHjkjADJAoEJ0c%3D" alt="" loading="lazy"/></p>
<p>官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-boot%2F3.5%2Freference%2Fweb%2Fservlet.html%23web.servlet.spring-mvc.error-handling" target="_blank" title="https://docs.spring.io/spring-boot/3.5/reference/web/servlet.html#web.servlet.spring-mvc.error-handling" ref="nofollow noopener noreferrer">docs.spring.io/spring-boot…</a></p>
<h3 data-id="heading-2">2.1 属性</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/139e7ee8fb4a461eb0c4251257effe67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=Ob3mmqNiFHE9GRcVdfKWAsMwbLQ%3D" alt="" loading="lazy"/></p>
<p><code>private URI type</code>： 错误类型标识（URI格式）</p>
<p><code>private String title</code>：简短错误描述</p>
<p><code>private int status</code>：HTTP状态码</p>
<p><code>private String detail</code>：详细错误描述</p>
<p><code>private URI instance</code>：具体错误实例标识</p>
<p><code>private Map&lt;String, Object&gt; properties</code>：扩展属性</p>
<h3 data-id="heading-3">2.2 异常返回一览</h3>
<p><code>SpringBoot 3.0</code>之前的报错：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1093f4f8bd464a8780d6835ecb90915d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=F5ey7cEVtkT%2BmSZr2J63RtJ1yBY%3D" alt="" loading="lazy"/></p>
<p><code>SpringBoot 3.0</code>之后的报错：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f9b3815cd00468ebf197cf2f2b56812~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=DRR9tai5htzXVbCVupb4XFlLS44%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">03 使用</h2>
<p><code>ProblemDetail</code>的使用是有讲究的，不了解其中的道道，可能触发不了<code>ProblemDetail</code>的异常包装。</p>
<h3 data-id="heading-5">3.1 启动开关</h3>
<p><code>SpringBoot</code>框架针对<code>ProblemDetail</code>的启用做了开关，默认关闭。</p>
<p>通过配置生效：</p>
<pre><code class="hljs language-properties" lang="properties">spring.mvc.problemdetails.enabled=true
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/314e3b787d12464cb8533b0518fa88f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=RLREzGZgRqLNQSNEkAppapGwask%3D" alt="" loading="lazy"/></p>
<p>配置类：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4db194cd492400fb7d09462123017b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=S%2FRQ1PbhtOTERHlT3LPy1huM81U%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">3.2 测试方法</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/divide")</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">divide</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
    <span class="hljs-keyword">return</span> a / b; 
}
</code></pre>
<p>如果 b=0，会触发 <code>ArithmeticException</code>。但是这个异常并没有触发<code>ProblemDetail</code>异常的封装。</p>
<p>测试请求：<code>http://127.0.0.1:8080/divide?a=10&amp;b=0</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb87c2e2785948c9bd4378388912a534~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=PJh74GdpX1qdM%2FNtCPxZ%2BNy9u%2B4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">3.3 原因追溯</h3>
<p>没有成功，难道是因为配置没有生效。我们从官网找一点蛛丝马迹。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92bb5b5041f2461387f9421d4b7873b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=9JnMVG%2B36ZOICLh7zSrVVzv9l6E%3D" alt="" loading="lazy"/></p>
<p>大致意思是：要想启用RFC响应，可以扩展<code>ResponseEntityExceptionHandler</code>并声明<code>@ControllerAdvice</code>。处理器通过<code>@ExceptionHandler</code>采集异常，也可以添加其他异常并映射到<code>ProblemDetail</code></p>
<p>所以我们看看<code>ResponseEntityExceptionHandler</code>的子类有没有类似的实现：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dba9807ac7340d4abb5fb5bfe33bab2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=OQVb7XiJrt6pM6ICcRi1hEUjK%2Fc%3D" alt="" loading="lazy"/></p>
<p>通过查看，我们可以发现<code>ProblemDetailsExceptionHandler</code>子类，似乎是处理<code>ProblemDetail</code>的关键。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebeb6681d3f94816844c9fbe9273a8c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=larGrxZeDrqcQMdBvRcIGAEqlNY%3D" alt="" loading="lazy"/></p>
<p><code>@ControllerAdvice</code>注解我们再熟悉不过了，用于参数绑定、异常处理等。而<code>ResponseEntityExceptionHandler</code>默认处理的异常：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc5b4a415e724d07b514a786197569ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=C1qJcRlehSBfWmvDDwH%2FZuO1kwQ%3D" alt="" loading="lazy"/></p>
<p>显然没有<code>ArithmeticException</code>异常，自然不会被处理。</p>
<p>那我们只需要使用<code>ResponseEntityExceptionHandler</code>中的异常即可。</p>
<h3 data-id="heading-8">3.4 重新测试</h3>
<p>测试方法中接收的字段类型为int，我们只需要传入非int类型的数据，就会触发<code>MethodArgumentTypeMismatchException</code>异常。而<code>MethodArgumentTypeMismatchException</code>继承<code>TypeMismatchException</code>异常。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/914f07fc4b4045419172467d08c4fecd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=Ji6IiN7knJoDpsCjJ5dJICFmogs%3D" alt="" loading="lazy"/></p>
<p>测试地址：<code>http://127.0.0.1:8080/divide?a=10&amp;b=a</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee9fb4a7049e49698c596d7a72a6414e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=%2FvUrTvZnMkyiW3X6s1KiWuQ4H7o%3D" alt="" loading="lazy"/></p>
<p>结果已经触发<code>ProblemDetail</code>的信息了。</p>
<h2 data-id="heading-9">04 问题</h2>
<p><code>ProblemDetail</code>异常包装触发了，但是并不是所有的异常都可以兜得住。即便是<code>ResponseEntityExceptionHandler</code>中的异常也有没有包装的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b803444a4f04c72b692aa46f2ff5a2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=K3VAZ8glSxpDT8I17pMg35GudGg%3D" alt="" loading="lazy"/></p>
<p>小编这里不太理解为什么会从中间分开，上半部分异常不会触发<code>ProblemDetail</code>异常包装，而下半部分会触发。</p>
<p>所以我们在需要处理全局异常的时候，还需要我们自己去处理所有的异常，包括自定义异常已达到统一参数。</p>
<h2 data-id="heading-10">05 触发源码</h2>
<p><code>ProblemDetailsExceptionHandler</code>的包位于<code>org.springframework.boot.autoconfigure.web.servlet</code>下，又是如何通过配置启动的呢？</p>
<p>当然还是自动配置的类：<code>WebMvcAutoConfiguration</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9e7411b907443bf87fcc0bab46a6ef9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389445&amp;x-signature=joz4DIxoUp7wgl0ehZe9TYdn6S4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">06 小结</h2>
<p>我们可以自己通过<code>ProblemDetail</code>封装异常信息，然后统一异常参数，全局统一处理异常，以达到全局统一的目的。可能里面还有小编理解不到位的地方，有问题评论区指出来，小编加以修正。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[敢不敢挑战用Cocos3.8复刻曾经很火的割绳子游戏？]]></title>    <link>https://juejin.cn/post/7596384019002081306</link>    <guid>https://juejin.cn/post/7596384019002081306</guid>    <pubDate>2026-01-19T03:30:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596384019002081306" data-draft-id="7596339303862386739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="敢不敢挑战用Cocos3.8复刻曾经很火的割绳子游戏？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-19T03:30:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            敢不敢挑战用Cocos3.8复刻曾经很火的割绳子游戏？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T03:30:03.000Z" title="Mon Jan 19 2026 03:30:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f7975ec955944b7b11222efa66e73fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=uB%2FjQa%2F9Z5e3Bp0zkwCKa79Z7%2B8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，我是亿元程序员，最近有小伙伴私信笔者：</p>
<blockquote>
<p><strong>亿哥</strong>，不知道你有没有玩过上面那款<code>16</code>年前火遍全网的割绳子游戏。</p>
<p><strong>我最近</strong>在做游戏时，需要做类似这个游戏里面的绳子效果，不知道怎么实现！</p>
<p><strong>你最近</strong>不是在更新热门小游戏实战合集吗！</p>
<p><strong>敢不敢挑战用Cocos3.8复刻一个？</strong></p>
</blockquote>
<p><strong>好家伙</strong>，这款游戏笔者最熟悉不过了，那时候苹果<code>4</code>才刚出来没多久，这样的触屏物理游戏可以算得上人手一个。</p>
<p><strong>关于</strong>割绳子的物理效果，我记得之前参与论坛投稿活动时，参考某个砍树游戏出过一期：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62bfc91e91d444ca81fe6d2de794ad3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=hgR8B9XofrLjKT9LX46EZkM6hGo%3D" alt="" loading="lazy"/></p>
<p><strong>翻了一下</strong>，看到了一些扎心的评论：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8aa09af49424234b141426f457d2699~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=E7571XsqMEkM2O%2FGyFofyTzYDLo%3D" alt="你这是棍子吧" loading="lazy"/></p>
<p><strong>言归正传</strong>，本期带大家一起来看看，如何在<code>Cocos</code>游戏开发中，如何实现不像棍子的绳子效果，并且实战做一个曾经很火的割绳子游戏。</p>
<p><strong>本文源工程可在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">回顾一下</h2>
<p><strong>想要</strong>在<code>Cocos</code>游戏开发中，实现一条带有物理效果的绳子，可以使用我们系统自带的距离关节<code>Distance Joint</code>。</p>
<p><strong>距离关节</strong>会将关节两端的刚体约束在一个最大范围内。超出该范围时，刚体的运动会互相影响。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c91d00de6b0413daf590e861d52404e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=rGpYo5WDXtePCfKXgD2gbu9%2B3%2BE%3D" alt="来源于Cocos官方文档" loading="lazy"/></p>
<p><strong>既然如此</strong>，为什么之前做的绳子像棍子？</p>
<h2 data-id="heading-2">关节太少</h2>
<p><strong>因为</strong>之前做的<code>demo</code>，钩子和物品之间，仅仅使用了一个距离关节，所以很难模拟出来绳子柔软的效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b1940355a534825be4d4caaaa025215~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=xRh49gxPZg7k3tn%2Fh4PKqodtbfg%3D" alt="" loading="lazy"/></p>
<p><strong>那么</strong>不像棍子的绳子怎么做？</p>
<h2 data-id="heading-3">增加足够多的关节</h2>
<p><strong>首先</strong>制作一节<code>5*20</code>的绳子，属性组件如下:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d10abbf149124ebda24182a1c2369d25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=7WzdZJn8jdVbO2oXILh%2F58X4P3g%3D" alt="" loading="lazy"/></p>
<p><strong>理论上</strong>只要添加足够多的关节，就会越来越接近柔软的绳子效果，因此我们可以通过代码去控制生成足够多的关节，一节连一节。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ae934897f0b49a2bf8c9714995d1376~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=y7AE1oNDpTUwbo%2Fh8tN%2Fz5I3Y9M%3D" alt="" loading="lazy"/></p>
<p><strong>效果</strong>如下，不过绳子看起来并不是连续的，关节因为重力效果，会被拉开一段距离。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a8e4d5b6f40420ba1999352aac01aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=fch7OL3SKA8h1hm%2F3pMFiFJJRm0%3D" alt="" loading="lazy"/></p>
<p><strong>这个问题怎么解决？</strong></p>
<h2 data-id="heading-4">画线辅助</h2>
<p><strong>为了</strong>解决受重力效果导致的绳结断开的问题，我们可以通过<code>Graphics</code>组件逐点进行画线，代码如下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/469786f0559e42c7a10ec6908289cdcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=odzYvSSthAixG1JuZEisGeVaC9g%3D" alt="" loading="lazy"/></p>
<p><strong>效果</strong>如下，但是看起来还是有点问题，绳子连接处不太和谐，不像一根绳子，反而像哼哼哈嘿的双截棍：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7771eab1156f4979a7c7da28c6f41398~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=h0QbL3QnhqosG0W8MDG0tRZMa20%3D" alt="" loading="lazy"/></p>
<p><strong>因此</strong>我们需要把绳子画得更加平滑一点。</p>
<h2 data-id="heading-5">平滑曲线</h2>
<p><strong>想要</strong>让曲线更加平滑，通常可以采用二次贝塞尔曲线连接相邻点，首先我们先要把所有的点位收集起来：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5564e310d865478eae3248564f7a82e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=uEHYxrR6t08vN1X5uWVSKC9pGCM%3D" alt="" loading="lazy"/></p>
<p><strong>核心</strong>的绘制方法<code>quadraticCurveTo</code>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3281a3c860d840dc98ee20bfbfc8ea84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=25ZGgSna4p4Fb%2FMkDgKEhiqmJQI%3D" alt="" loading="lazy"/></p>
<p><strong>这样</strong>看起来就合理一点了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acedaf326af44f7f876ee3e6fa9a98f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=a7AEY7rCBkvgJRX3eUV%2F%2BRXsrns%3D" alt="" loading="lazy"/></p>
<p><strong>通过</strong>上述流程，我们就能成功实现一根不像棍子的绳子了。</p>
<p><strong>接下来我们完成割绳子游戏的剩余部分。</strong></p>
<h2 data-id="heading-6">割绳子游戏实战</h2>
<p><strong>有了</strong>上面的绳子基础，我们想要实现一个完整的割绳子游戏就易如反掌了。</p>
<p><strong>1. 割绳子</strong></p>
<p><strong>既然</strong>是割绳子游戏，割当然是也是重要的一环，割绳子最主要判断手指移动的轨迹与实际上哪一段关节相交。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03baedd840194377ae5e958eb3bb6cc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=gMS41LaGR%2BIKXRfxYCENFbOsY%2FQ%3D" alt="" loading="lazy"/></p>
<p><strong>判断</strong>相交的核心方法如下:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55aee08f91ac47ddb5361e44a9c631f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=y4Qtqvw9Apo56CFcIJG9ER5gv1o%3D" alt="" loading="lazy"/></p>
<p><strong>2. 切割效果</strong></p>
<p><strong>为了</strong>增加游戏效果，我们可以在屏幕上画线时，增加一段拖尾效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4977a9cb463e4c4c93907c6c9ef12836~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=mBPB4qoMEYAOvmTmJAhG9B08IzE%3D" alt="" loading="lazy"/></p>
<p><strong>效果如下:</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/026b832865c4408a93ea62ea6300dcaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=XWYBYpI6GF8BVcVUMRUKPIxIfsE%3D" alt="" loading="lazy"/></p>
<p><strong>3. 其他游戏元素</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ce746683e874cc584fd686e1eab0dee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=zGqle4NhhSkVsPRKbWsRlR9YRBQ%3D" alt="" loading="lazy"/></p>
<p><strong>除去</strong>绳子相关的部分，剩下就是割绳子游戏的其他元素，包括：</p>
<ul>
<li>
<p><strong>钩子</strong>: 主要起到固定绳子的作用，需要添加刚体组件，<code>Type</code>设置为<code>Static</code>。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7afea069b52b47a39c6e5c0bfc226116~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=GqfY9EQFLRGwy2jp8%2Fz%2B6ErZmcc%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>甜甜圈</strong>: 需要添加碰撞组件、管理脚本以及刚体组件，需要开启<code>Enabled Contact Listener</code>，在对应的管理脚本进行处理碰撞事件。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/719e9c6a42f448d5a24045c1782e6118~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=diPPdpUwiSgZNBLdkkd%2F%2B5fD8uc%3D" alt="" loading="lazy"/>
如下碰撞到星星和目标点时进行处理。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/815486f0bd5c4872947216ebd5b55e56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=8S6Y1nUDXZf%2F0Jm6uk%2FPK3DzbDE%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>星星</strong>: 添加碰撞组件和管理脚本，增加一些简单的动画。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da2e6a58dee9400b901544dcc8785f2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=q%2FWOOp%2F5D1RiQfwCBuneiTEUeKA%3D" alt="" loading="lazy"/>
旋转和碰撞放大效果。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19b5efd668ea428db4c0685767482fc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=mZN6w5zQzKTSKN3X4x%2FSVL4wBc4%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>目标点</strong>: 目标点和上面差不多，主要是用来判断是否到达目标点，以及添加一些到达动画。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86cc9e32b8db47809acf8875f8128303~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=bHbw%2BE24kay9cOZ4RqoBn%2BZcBdE%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>其他</strong>: 随着游戏关卡地不断增加，会有越来越多的其他游戏元素，笔者只实现了以上基础的部分，感兴趣的小伙伴们可以自行扩展。</p>
</li>
</ul>
<p><strong>4. 效果演示</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1aa4e21f62348bab55a9836e52e5f42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769398203&amp;x-signature=eXojTn8R3J26cI3bntvMTDRDhjE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-7">结语</h2>
<p><strong>割绳子游戏</strong>真的是回忆杀，勾起笔者的无限回忆，等我退休了，一定要完完整整复刻一个，一边复刻一边玩。</p>
<p><strong>小伙伴们</strong>，你们玩过这款游戏吗？那时候的你们进入游戏行业了吗？</p>
<p>本文<strong>实战完整源码</strong>已集成到<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a>，内含体验链接。</p>
<hr/>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐文章：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXLCknL3fJDubec2GW6KLFA" target="_blank" title="https://mp.weixin.qq.com/s/XLCknL3fJDubec2GW6KLFA" ref="nofollow noopener noreferrer">Cocos游戏如何接入安卓穿山甲广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3_VrSld4KnDKY_7hxjSoKg" target="_blank" title="https://mp.weixin.qq.com/s/3_VrSld4KnDKY_7hxjSoKg" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Lj24VHJ-pL8z82hHqQLiA" target="_blank" title="https://mp.weixin.qq.com/s/0Lj24VHJ-pL8z82hHqQLiA" ref="nofollow noopener noreferrer">Cocos游戏如何快速接入抖音小游戏广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ7DusUJA2v1IFZDFtBsueg" target="_blank" title="https://mp.weixin.qq.com/s/Z7DusUJA2v1IFZDFtBsueg" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现割绳子游戏效果</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3BzzFBzeVAO-a6LPTeFTrA" target="_blank" title="https://mp.weixin.qq.com/s/3BzzFBzeVAO-a6LPTeFTrA" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现动态切割模型？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZIph332u_r24OTY4r6_jow" target="_blank" title="https://mp.weixin.qq.com/s/ZIph332u_r24OTY4r6_jow" ref="nofollow noopener noreferrer">Cocos游戏开发中的贴花效果</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter-实现瀑布流布局及下拉刷新上拉加载更多]]></title>    <link>https://juejin.cn/post/7596478936386764842</link>    <guid>https://juejin.cn/post/7596478936386764842</guid>    <pubDate>2026-01-19T00:47:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596478936386764842" data-draft-id="7596166721627783214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter-实现瀑布流布局及下拉刷新上拉加载更多"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2026-01-19T00:47:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter-实现瀑布流布局及下拉刷新上拉加载更多
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:47:51.000Z" title="Mon Jan 19 2026 00:47:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>在 Flutter 应用开发中，瀑布流布局常用于展示图片、商品列表等需要以不规则但整齐排列的内容。同时，下拉刷新和上拉加载更多功能，能够极大提升用户体验，让用户方便地获取最新和更多的数据。</p>
<h2 data-id="heading-0">1. 前置条件</h2>
<ol>
<li>
<p>Flutter 环境已搭建（要求 Flutter 3.0+、Dart 2.17+）</p>
</li>
<li>
<p>本地图片资源已放入 <code>assets/images</code> 目录，并在 <code>pubspec.yaml</code> 中配置</p>
</li>
<li>
<p>已安装依赖插件并执行 <code>flutter pub get</code></p>
</li>
</ol>
<h2 data-id="heading-1">2. 结构分析</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3fb3fa88858454c847241e8398618d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP5aSa5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388471&amp;x-signature=1b%2BajzGhngXmLLWlGGPXnQnboT8%3D" alt="6210b7bafa9244369d7ce1aa5ca874be.gif" loading="lazy"/></p>
<h3 data-id="heading-2">2.1 安装依赖插件</h3>
<p>在项目的 <code>pubspec.yaml</code> 文件中添加以下依赖：</p>
<pre><code class="hljs language-YAML" lang="YAML">
<span class="hljs-comment"># 瀑布流布局：https://pub.dev/packages/waterfall_flow</span>
<span class="hljs-attr">waterfall_flow:</span> <span class="hljs-string">^3.0.3</span>
<span class="hljs-comment"># 上拉加载更多+下拉刷新：https://pub.dev/packages/pull_to_refresh</span>
<span class="hljs-attr">pull_to_refresh:</span> <span class="hljs-string">^2.0.0</span>
</code></pre>
<p>注意：<code>waterfall_flow: ^3.0.3</code> 需适配 Flutter 3.0+，<code>pull_to_refresh: ^2.0.0</code> 需 Dart 2.17+</p>
<p>添加依赖后执行命令安装：</p>
<pre><code class="hljs language-Bash" lang="Bash">
flutter pub get
</code></pre>
<h3 data-id="heading-3">2.2 配置本地图片资源</h3>
<p>在 <code>pubspec.yaml</code> 中配置图片资源路径，确保 Flutter 能识别本地图片：</p>
<pre><code class="hljs language-YAML" lang="YAML">
<span class="hljs-attr">flutter:</span>
  <span class="hljs-attr">uses-material-design:</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment"># 配置图片资源目录</span>
  <span class="hljs-attr">assets:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/</span>
</code></pre>
<h3 data-id="heading-4">2.3 引入必要的库</h3>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-keyword">import</span> <span class="hljs-string">'dart:async'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:pull_to_refresh/pull_to_refresh.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:waterfall_flow/waterfall_flow.dart'</span>;
</code></pre>
<ul>
<li>
<p><code>dart:async</code>：提供异步操作能力，用于处理刷新和加载更多的延迟模拟。</p>
</li>
<li>
<p><code>package:flutter/material.dart</code>：Flutter 核心 UI 库，提供 Scaffold、Container 等基础组件。</p>
</li>
<li>
<p><code>package:pull_to_refresh/pull_to_refresh.dart</code>：实现下拉刷新和上拉加载更多的核心库。</p>
</li>
<li>
<p><code>package:waterfall_flow/waterfall_flow.dart</code>：用于快速构建瀑布流布局的第三方库。</p>
</li>
</ul>
<h3 data-id="heading-5">2.4 定义图片枚举及扩展</h3>
<p>为了规范图片资源管理，我们定义图片枚举，并通过扩展方法获取图片路径：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-comment">/// <span class="markdown">本地图片枚举</span></span>
<span class="hljs-keyword">enum</span> ImageEnum {
  banner1,
  banner2,
  banner3,
  model1,
  model2,
  model3,
  model4,
}

<span class="hljs-comment">/// <span class="markdown">为枚举扩展获取图片路径的方法</span></span>
<span class="hljs-keyword">extension</span> ImageEnumExtension <span class="hljs-keyword">on</span> ImageEnum {
  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> path {
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>) {
      <span class="hljs-keyword">case</span> ImageEnum.banner1:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner1.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.banner2:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner2.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.banner3:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner3.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model1:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model1.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model2:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model2.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model3:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model3.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model4:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model4.png'</span>;
    }
  }
}
</code></pre>
<h3 data-id="heading-6">2.5 定义 ImageWaterfallFlow 组件</h3>
<p>定义有状态组件，用于管理瀑布流布局的状态和 UI 渲染：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageWaterfallFlow</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> ImageWaterfallFlow({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;ImageWaterfallFlow&gt; createState() =&gt; ImageWaterfallFlowState();
}
</code></pre>
<p>有状态组件可以根据用户操作或数据变化动态更新 UI，<code>createState</code> 方法返回状态管理类 <code>ImageWaterfallFlowState</code>。</p>
<h3 data-id="heading-7">2.6 ImageWaterfallFlowState 类的详细解析</h3>
<p>该类是组件的核心，负责管理数据、控制器和业务逻辑：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageWaterfallFlowState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ImageWaterfallFlow</span>&gt; </span>{
  <span class="hljs-comment">/// <span class="markdown">字体样式</span></span>
  <span class="hljs-keyword">final</span> TextStyle myTxtStyle = <span class="hljs-keyword">const</span> TextStyle(
      color: Colors.white, fontSize: <span class="hljs-number">24</span>, fontWeight: FontWeight.w800);

  <span class="hljs-comment">/// <span class="markdown">模拟数据（初始数据）- 增加泛型提升类型安全</span></span>
  <span class="hljs-built_in">List</span>&lt;ImageEnum&gt; imageList = [
    ImageEnum.banner1,
    ImageEnum.banner2,
    ImageEnum.banner3,
    ImageEnum.model1,
    ImageEnum.model2,
    ImageEnum.model3,
    ImageEnum.model4,
    ImageEnum.banner1,
    ImageEnum.banner2,
    ImageEnum.banner3,
    ImageEnum.model1,
    ImageEnum.model2,
    ImageEnum.model3,
    ImageEnum.model4
  ];

  <span class="hljs-comment">/// <span class="markdown">模拟数据（加载更多使用）</span></span>
  <span class="hljs-built_in">List</span>&lt;ImageEnum&gt; moreList = [ImageEnum.banner1, ImageEnum.banner2, ImageEnum.banner3];

  <span class="hljs-comment">/// <span class="markdown">上拉下拉控制器</span></span>
  <span class="hljs-keyword">final</span> RefreshController myRefreshController = RefreshController();
</code></pre>
<ul>
<li>
<p><code>myTxtStyle</code>：定义图片上显示序号的字体样式。</p>
</li>
<li>
<p><code>imageList</code>：存储瀑布流初始展示的图片数据，使用泛型 <code>List&lt;ImageEnum&gt;</code> 保证类型安全。</p>
</li>
<li>
<p><code>moreList</code>：存储加载更多时需要追加的数据。</p>
</li>
<li>
<p><code>myRefreshController</code>：来自 <code>pull_to_refresh</code> 库，用于控制刷新和加载的状态。</p>
</li>
</ul>
<h3 data-id="heading-8">2.7 刷新和加载更多的方法</h3>
<p>实现下拉刷新和上拉加载更多的业务逻辑，补充边界条件处理：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-comment">/// <span class="markdown">刷新</span></span>
<span class="hljs-keyword">void</span> onRefresh() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">1000</span>));
  <span class="hljs-comment">// 模拟刷新：恢复初始数据</span>
  setState(() {
    imageList = [
      ImageEnum.banner1,
      ImageEnum.banner2,
      ImageEnum.banner3,
      ImageEnum.model1,
      ImageEnum.model2,
      ImageEnum.model3,
      ImageEnum.model4,
      ImageEnum.banner1,
      ImageEnum.banner2,
      ImageEnum.banner3,
      ImageEnum.model1,
      ImageEnum.model2,
      ImageEnum.model3,
      ImageEnum.model4
    ];
  });
  myRefreshController.refreshCompleted();
  myRefreshController.resetNoData(); <span class="hljs-comment">// 重置无更多数据状态</span>
}

<span class="hljs-comment">/// <span class="markdown">加载更多</span></span>
<span class="hljs-keyword">void</span> onLoadMore() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">1000</span>));
  <span class="hljs-comment">// 模拟：数据超过30条时标记无更多数据</span>
  <span class="hljs-keyword">if</span> (imageList.length &gt;= <span class="hljs-number">30</span>) {
    myRefreshController.loadNoData();
  } <span class="hljs-keyword">else</span> {
    imageList.addAll(moreList);
    <span class="hljs-keyword">if</span> (mounted) {
      setState(() {});
    }
    myRefreshController.loadComplete();
  }
}
</code></pre>
<ul>
<li>
<p><code>onRefresh</code>：下拉刷新时触发，模拟 1 秒延迟后恢复初始数据，并重置加载状态。</p>
</li>
<li>
<p><code>onLoadMore</code>：上拉加载时触发，模拟 1 秒延迟后追加数据；当数据量超过 30 条时，标记为“无更多数据”。</p>
</li>
<li>
<p><code>mounted</code> 判断：防止组件销毁后调用 <code>setState</code> 导致异常。</p>
</li>
</ul>
<h3 data-id="heading-9">2.8 资源释放</h3>
<p>重写 <code>dispose</code> 方法，释放控制器资源，避免内存泄漏：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-meta">@override</span>
<span class="hljs-keyword">void</span> dispose() {
  myRefreshController.dispose(); <span class="hljs-comment">// 释放刷新控制器</span>
  <span class="hljs-keyword">super</span>.dispose();
}
</code></pre>
<h3 data-id="heading-10">2.9 构建 UI 的方法</h3>
<p>构建组件的基础布局结构：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-comment">/// <span class="markdown">布局</span></span>
<span class="hljs-meta">@override</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> Scaffold(
      backgroundColor: Colors.black,
      body: SafeArea(
          child: SizedBox(
              width: MediaQuery.of(context).size.width,
              height: MediaQuery.of(context).size.height,
              child: listWidget())));
}
</code></pre>
<ul>
<li>
<p><code>Scaffold</code>：作为页面的根布局，设置背景色为黑色。</p>
</li>
<li>
<p><code>SafeArea</code>：避免内容被刘海屏、状态栏等遮挡。</p>
</li>
<li>
<p><code>SizedBox</code>：设置与屏幕同宽同高的容器，承载瀑布流列表。</p>
</li>
</ul>
<h3 data-id="heading-11">2.10 构建瀑布流列表的方法</h3>
<p>整合刷新组件和瀑布流布局，实现核心 UI 效果：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-comment">/// <span class="markdown">列表</span></span>
Widget listWidget() {
  <span class="hljs-keyword">return</span> SmartRefresher(
    enablePullDown: <span class="hljs-keyword">true</span>,
    enablePullUp: <span class="hljs-keyword">true</span>,
    header: <span class="hljs-keyword">const</span> ClassicHeader(),
    footer: <span class="hljs-keyword">const</span> ClassicFooter(),
    controller: myRefreshController,
    onRefresh: onRefresh,
    onLoading: onLoadMore,
    child: WaterfallFlow.builder(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">10</span>), <span class="hljs-comment">// 增加内边距，避免内容贴边</span>
      physics: <span class="hljs-keyword">const</span> BouncingScrollPhysics(),
      gridDelegate: SliverWaterfallFlowDelegateWithFixedCrossAxisCount(
        crossAxisCount: <span class="hljs-number">2</span>,
        crossAxisSpacing: <span class="hljs-number">20</span>,
        mainAxisSpacing: <span class="hljs-number">20</span>,
        viewportBuilder: (<span class="hljs-built_in">int</span> index1, <span class="hljs-built_in">int</span> index2) {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'变化：<span class="hljs-subst">$index1</span>-<span class="hljs-subst">$index2</span>'</span>);
        },
        <span class="hljs-comment">// 修正最后一个子项的判断逻辑（索引从0开始）</span>
        lastChildLayoutTypeBuilder: (index) =&gt; index == imageList.length - <span class="hljs-number">1</span>
            ? LastChildLayoutType.fullCrossAxisExtent
            : LastChildLayoutType.none,
      ),
      itemCount: imageList.length,
      itemBuilder: (BuildContext context, <span class="hljs-built_in">int</span> index) {
        <span class="hljs-keyword">return</span> Container(
          color: Colors.white,
          height: (index + <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-number">100</span> : <span class="hljs-number">200</span>,
          child: Container(
              alignment: Alignment.center,
              decoration: BoxDecoration(
                  color: Colors.blue.shade300,
                  image: DecorationImage(
                    image: AssetImage(imageList[index].path), <span class="hljs-comment">// 调用扩展方法获取图片路径</span>
                    fit: BoxFit.cover,
                  )),
              child: Text(<span class="hljs-string">'第<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>张'</span>, style: myTxtStyle)),
        );
      },
    ),
  );
}
</code></pre>
<ul>
<li>
<p><code>SmartRefresher</code>：<code>pull_to_refresh</code> 库的核心组件，配置上下拉开关、头部底部样式和回调方法。</p>
</li>
<li>
<p><code>WaterfallFlow.builder</code>：瀑布流布局的构建器，通过懒加载方式渲染子项：</p>
<ul>
<li>
<p><code>padding</code>：增加内边距，优化视觉效果。</p>
</li>
<li>
<p><code>crossAxisCount: 2</code>：设置瀑布流为 2 列布局。</p>
</li>
<li>
<p><code>crossAxisSpacing</code>/<code>mainAxisSpacing</code>：设置子项之间的水平和垂直间距。</p>
</li>
<li>
<p><code>lastChildLayoutTypeBuilder</code>：修正索引判断逻辑，让最后一个子项占满整行宽度。</p>
</li>
<li>
<p><code>itemBuilder</code>：构建每个瀑布流子项，通过 <code>AssetImage(imageList[index].path)</code> 获取图片路径，设置不同高度实现瀑布流效果。</p>
</li>
</ul>
</li>
</ul>
<h2 data-id="heading-12">3. 核心库 API &amp; 属性说明</h2>
<h3 data-id="heading-13">3.1 waterfall_flow 核心 API/属性</h3>
<h4 data-id="heading-14">3.1.1 WaterfallFlow 核心组件</h4>





















































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>padding</code></td><td><code>EdgeInsetsGeometry</code></td><td>瀑布流整体内边距</td><td><code>EdgeInsets.zero</code></td></tr><tr><td><code>physics</code></td><td><code>ScrollPhysics</code></td><td>滚动物理效果</td><td><code>AlwaysScrollableScrollPhysics()</code></td></tr><tr><td><code>shrinkWrap</code></td><td><code>bool</code></td><td>是否根据子项高度自适应</td><td><code>false</code></td></tr><tr><td><code>gridDelegate</code></td><td><code>SliverWaterfallFlowDelegate</code></td><td>瀑布流布局代理（核心）</td><td>无（必传）</td></tr><tr><td><code>children</code></td><td><code>List&lt;Widget&gt;</code></td><td>子组件列表（非懒加载）</td><td><code>[]</code></td></tr><tr><td><code>itemCount</code></td><td><code>int</code></td><td>子项数量（builder 模式）</td><td>无（builder 模式必传）</td></tr><tr><td><code>itemBuilder</code></td><td><code>IndexedWidgetBuilder</code></td><td>子项构建器（懒加载）</td><td>无（builder 模式必传）</td></tr></tbody></table>
<h4 data-id="heading-15">3.1.2 SliverWaterfallFlowDelegateWithFixedCrossAxisCount（常用布局代理）</h4>















































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>crossAxisCount</code></td><td><code>int</code></td><td>列数（核心）</td><td>无（必传）</td></tr><tr><td><code>crossAxisSpacing</code></td><td><code>double</code></td><td>列之间的间距</td><td><code>0.0</code></td></tr><tr><td><code>mainAxisSpacing</code></td><td><code>double</code></td><td>行之间的间距</td><td><code>0.0</code></td></tr><tr><td><code>lastChildLayoutTypeBuilder</code></td><td><code>LastChildLayoutTypeBuilder</code></td><td>最后一个子项布局类型</td><td><code>null</code></td></tr><tr><td><code>viewportBuilder</code></td><td><code>ViewportBuilder</code></td><td>视口内子项变化回调</td><td><code>null</code></td></tr><tr><td><code>collectGarbage</code></td><td><code>CollectGarbage</code></td><td>回收不可见子项时的回调</td><td><code>null</code></td></tr></tbody></table>
<h4 data-id="heading-16">3.1.3 LastChildLayoutType（最后一个子项布局类型）</h4>





















<table><thead><tr><th>枚举值</th><th>说明</th></tr></thead><tbody><tr><td><code>LastChildLayoutType.none</code></td><td>无特殊布局（默认）</td></tr><tr><td><code>LastChildLayoutType.fullCrossAxisExtent</code></td><td>占满整行宽度</td></tr><tr><td><code>LastChildLayoutType.footnote</code></td><td>脚注样式（小尺寸）</td></tr></tbody></table>
<h3 data-id="heading-17">3.2 pull_to_refresh 核心 API/属性</h3>
<h4 data-id="heading-18">3.2.1 SmartRefresher（核心组件）</h4>













































































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>enablePullDown</code></td><td><code>bool</code></td><td>是否启用下拉刷新</td><td><code>true</code></td></tr><tr><td><code>enablePullUp</code></td><td><code>bool</code></td><td>是否启用上拉加载</td><td><code>false</code></td></tr><tr><td><code>header</code></td><td><code>RefreshHeader</code></td><td>下拉刷新头部样式</td><td><code>ClassicHeader()</code></td></tr><tr><td><code>footer</code></td><td><code>LoadFooter</code></td><td>上拉加载底部样式</td><td><code>ClassicFooter()</code></td></tr><tr><td><code>controller</code></td><td><code>RefreshController</code></td><td>刷新/加载控制器（核心）</td><td>无（必传）</td></tr><tr><td><code>onRefresh</code></td><td><code>VoidCallback?</code></td><td>下拉刷新回调</td><td><code>null</code></td></tr><tr><td><code>onLoading</code></td><td><code>VoidCallback?</code></td><td>上拉加载回调</td><td><code>null</code></td></tr><tr><td><code>child</code></td><td><code>Widget</code></td><td>包裹的子组件（如列表/瀑布流）</td><td>无（必传）</td></tr><tr><td><code>scrollDirection</code></td><td><code>Axis</code></td><td>滚动方向</td><td><code>Axis.vertical</code></td></tr><tr><td><code>physics</code></td><td><code>ScrollPhysics</code></td><td>滚动物理效果</td><td><code>ClampingScrollPhysics()</code></td></tr><tr><td><code>enableTwoLevel</code></td><td><code>bool</code></td><td>是否启用二级刷新（如下拉展开更多）</td><td><code>false</code></td></tr></tbody></table>
<h4 data-id="heading-19">3.2.2 RefreshController（核心控制器）</h4>









































<table><thead><tr><th>方法名</th><th>说明</th></tr></thead><tbody><tr><td><code>refreshCompleted()</code></td><td>标记下拉刷新完成</td></tr><tr><td><code>refreshFailed()</code></td><td>标记下拉刷新失败</td></tr><tr><td><code>loadComplete()</code></td><td>标记上拉加载完成</td></tr><tr><td><code>loadNoData()</code></td><td>标记无更多数据</td></tr><tr><td><code>resetNoData()</code></td><td>重置无更多数据状态</td></tr><tr><td><code>dispose()</code></td><td>释放控制器资源（必写，避免内存泄漏）</td></tr><tr><td><code>requestRefresh()</code></td><td>主动触发下拉刷新</td></tr><tr><td><code>requestLoading()</code></td><td>主动触发上拉加载</td></tr></tbody></table>
<h4 data-id="heading-20">3.2.3 ClassicHeader/ClassicFooter（经典样式）</h4>



























































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>height</code></td><td><code>double</code></td><td>头部/底部高度</td><td><code>60.0</code></td></tr><tr><td><code>idleText</code></td><td><code>String</code></td><td>闲置状态文本</td><td>下拉刷新/上拉加载</td></tr><tr><td><code>refreshingText</code></td><td><code>String</code></td><td>刷新中/加载中文本</td><td>刷新中/加载中</td></tr><tr><td><code>completeText</code></td><td><code>String</code></td><td>完成状态文本</td><td>刷新完成/加载完成</td></tr><tr><td><code>failedText</code></td><td><code>String</code></td><td>失败状态文本</td><td>刷新失败/加载失败</td></tr><tr><td><code>noDataText</code></td><td><code>String</code></td><td>无更多数据文本</td><td>暂无更多数据</td></tr><tr><td><code>textStyle</code></td><td><code>TextStyle</code></td><td>文本样式</td><td>灰色 14 号字</td></tr><tr><td><code>iconSize</code></td><td><code>double</code></td><td>图标大小</td><td><code>20.0</code></td></tr></tbody></table>
<h2 data-id="heading-21">4. 完整代码</h2>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-keyword">import</span> <span class="hljs-string">'dart:async'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:pull_to_refresh/pull_to_refresh.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:waterfall_flow/waterfall_flow.dart'</span>;

<span class="hljs-comment">/// <span class="markdown">本地图片枚举</span></span>
<span class="hljs-keyword">enum</span> ImageEnum {
  banner1,
  banner2,
  banner3,
  model1,
  model2,
  model3,
  model4,
}

<span class="hljs-comment">/// <span class="markdown">为枚举扩展获取图片路径的方法</span></span>
<span class="hljs-keyword">extension</span> ImageEnumExtension <span class="hljs-keyword">on</span> ImageEnum {
  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> path {
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>) {
      <span class="hljs-keyword">case</span> ImageEnum.banner1:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner1.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.banner2:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner2.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.banner3:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner3.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model1:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model1.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model2:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model2.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model3:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model3.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model4:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model4.png'</span>;
    }
  }
}

<span class="hljs-comment">/// <span class="markdown">瀑布流组件</span></span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageWaterfallFlow</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> ImageWaterfallFlow({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;ImageWaterfallFlow&gt; createState() =&gt; ImageWaterfallFlowState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageWaterfallFlowState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ImageWaterfallFlow</span>&gt; </span>{
  <span class="hljs-comment">/// <span class="markdown">字体样式</span></span>
  <span class="hljs-keyword">final</span> TextStyle myTxtStyle = <span class="hljs-keyword">const</span> TextStyle(
      color: Colors.white, fontSize: <span class="hljs-number">24</span>, fontWeight: FontWeight.w800);

  <span class="hljs-comment">/// <span class="markdown">模拟数据（初始数据）- 增加泛型提升类型安全</span></span>
  <span class="hljs-built_in">List</span>&lt;ImageEnum&gt; imageList = [
    ImageEnum.banner1,
    ImageEnum.banner2,
    ImageEnum.banner3,
    ImageEnum.model1,
    ImageEnum.model2,
    ImageEnum.model3,
    ImageEnum.model4,
    ImageEnum.banner1,
    ImageEnum.banner2,
    ImageEnum.banner3,
    ImageEnum.model1,
    ImageEnum.model2,
    ImageEnum.model3,
    ImageEnum.model4
  ];

  <span class="hljs-comment">/// <span class="markdown">模拟数据（加载更多使用）</span></span>
  <span class="hljs-built_in">List</span>&lt;ImageEnum&gt; moreList = [ImageEnum.banner1, ImageEnum.banner2, ImageEnum.banner3];

  <span class="hljs-comment">/// <span class="markdown">上拉下拉控制器</span></span>
  <span class="hljs-keyword">final</span> RefreshController myRefreshController = RefreshController();

  <span class="hljs-comment">/// <span class="markdown">刷新</span></span>
  <span class="hljs-keyword">void</span> onRefresh() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">1000</span>));
    <span class="hljs-comment">// 模拟刷新：恢复初始数据</span>
    setState(() {
      imageList = [
        ImageEnum.banner1,
        ImageEnum.banner2,
        ImageEnum.banner3,
        ImageEnum.model1,
        ImageEnum.model2,
        ImageEnum.model3,
        ImageEnum.model4,
        ImageEnum.banner1,
        ImageEnum.banner2,
        ImageEnum.banner3,
        ImageEnum.model1,
        ImageEnum.model2,
        ImageEnum.model3,
        ImageEnum.model4
      ];
    });
    myRefreshController.refreshCompleted();
    myRefreshController.resetNoData(); <span class="hljs-comment">// 重置无更多数据状态</span>
  }

  <span class="hljs-comment">/// <span class="markdown">加载更多</span></span>
  <span class="hljs-keyword">void</span> onLoadMore() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">1000</span>));
    <span class="hljs-comment">// 模拟：数据超过30条时标记无更多数据</span>
    <span class="hljs-keyword">if</span> (imageList.length &gt;= <span class="hljs-number">30</span>) {
      myRefreshController.loadNoData();
    } <span class="hljs-keyword">else</span> {
      imageList.addAll(moreList);
      <span class="hljs-keyword">if</span> (mounted) {
        setState(() {});
      }
      myRefreshController.loadComplete();
    }
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    myRefreshController.dispose(); <span class="hljs-comment">// 释放控制器资源</span>
    <span class="hljs-keyword">super</span>.dispose();
  }

  <span class="hljs-comment">/// <span class="markdown">布局</span></span>
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
        backgroundColor: Colors.black,
        body: SafeArea(
            child: SizedBox(
                width: MediaQuery.of(context).size.width,
                height: MediaQuery.of(context).size.height,
                child: listWidget())));
  }

  <span class="hljs-comment">/// <span class="markdown">列表</span></span>
  Widget listWidget() {
    <span class="hljs-keyword">return</span> SmartRefresher(
      enablePullDown: <span class="hljs-keyword">true</span>,
      enablePullUp: <span class="hljs-keyword">true</span>,
      header: <span class="hljs-keyword">const</span> ClassicHeader(),
      footer: <span class="hljs-keyword">const</span> ClassicFooter(),
      controller: myRefreshController,
      onRefresh: onRefresh,
      onLoading: onLoadMore,
      child: WaterfallFlow.builder(
        padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">10</span>),
        physics: <span class="hljs-keyword">const</span> BouncingScrollPhysics(),
        gridDelegate: SliverWaterfallFlowDelegateWithFixedCrossAxisCount(
          crossAxisCount: <span class="hljs-number">2</span>,
          crossAxisSpacing: <span class="hljs-number">20</span>,
          mainAxisSpacing: <span class="hljs-number">20</span>,
          viewportBuilder: (<span class="hljs-built_in">int</span> index1, <span class="hljs-built_in">int</span> index2) {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'变化：<span class="hljs-subst">$index1</span>-<span class="hljs-subst">$index2</span>'</span>);
          },
          <span class="hljs-comment">// 修正最后一个子项的判断逻辑</span>
          lastChildLayoutTypeBuilder: (index) =&gt; index == imageList.length - <span class="hljs-number">1</span>
              ? LastChildLayoutType.fullCrossAxisExtent
              : LastChildLayoutType.none,
        ),
        itemCount: imageList.length,
        itemBuilder: (BuildContext context, <span class="hljs-built_in">int</span> index) {
          <span class="hljs-keyword">return</span> Container(
            color: Colors.white,
            height: (index + <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-number">100</span> : <span class="hljs-number">200</span>,
            child: Container(
                alignment: Alignment.center,
                decoration: BoxDecoration(
                    color: Colors.blue.shade300,
                    image: DecorationImage(
                      image: AssetImage(imageList[index].path),
                      fit: BoxFit.cover,
                    )),
                child: Text(<span class="hljs-string">'第<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>张'</span>, style: myTxtStyle)),
          );
        },
      ),
    );
  }
}
</code></pre>
<h2 data-id="heading-22">5. 常见问题 &amp; 解决方案</h2>
<ol>
<li>
<p><strong>图片不显示</strong></p>
<ul>
<li>
<p>检查 <code>pubspec.yaml</code> 中 <code>assets</code> 配置路径是否与实际图片存放路径一致。</p>
</li>
<li>
<p>执行 <code>flutter clean</code> 清理缓存后，重新运行项目。</p>
</li>
<li>
<p>确认枚举扩展方法 <code>path</code> 返回的路径正确。</p>
</li>
</ul>
</li>
<li>
<p><strong>加载更多无响应</strong></p>
<ul>
<li>
<p>确认 <code>SmartRefresher</code> 的 <code>enablePullUp</code> 属性设置为 <code>true</code>。</p>
</li>
<li>
<p>检查 <code>RefreshController</code> 是否正确关联到 <code>SmartRefresher</code>。</p>
</li>
<li>
<p>确保 <code>onLoading</code> 回调方法已正确绑定。</p>
</li>
</ul>
</li>
<li>
<p><strong>瀑布流布局错乱</strong></p>
<ul>
<li>
<p>避免子项高度差异过大，可根据实际需求调整高度规则。</p>
</li>
<li>
<p>检查 <code>crossAxisCount</code>、<code>crossAxisSpacing</code> 等参数配置是否冲突。</p>
</li>
<li>
<p>确认 <code>lastChildLayoutTypeBuilder</code> 的索引判断逻辑正确。</p>
</li>
</ul>
</li>
<li>
<p><strong>内存泄漏</strong></p>
<ul>
<li>
<p>务必在 <code>dispose</code> 方法中调用 <code>myRefreshController.dispose()</code> 释放控制器。</p>
</li>
<li>
<p>避免在异步操作中未判断 <code>mounted</code> 就调用 <code>setState</code>。</p>
</li>
</ul>
</li>
</ol>
<h2 data-id="heading-23">6. 总结</h2>
<p>通过 <code>waterfall_flow</code> 和 <code>pull_to_refresh</code> 两个第三方库，我们快速实现了 Flutter 瀑布流布局，并集成了下拉刷新和上拉加载更多功能。</p>
<p>该方案可直接应用于图片列表、商品展示等常见业务场景，也可根据实际需求扩展子项点击、图片懒加载、自定义刷新样式等功能。</p>
<p>希望这篇文章能帮助你理解并在自己的 Flutter 项目中运用类似的功能。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7583910637958807571" target="_blank" title="https://juejin.cn/post/7583910637958807571">flutter使用package_info_plus库获取应用信息的教程</a></li>
<li><a href="https://juejin.cn/post/7588680081327259690" target="_blank" title="https://juejin.cn/post/7588680081327259690">Flutter下拉刷新上拉加载侧拉刷新插件：easy_refresh全面使用指南</a></li>
<li><a href="https://juejin.cn/post/7583226204036513833" target="_blank" title="https://juejin.cn/post/7583226204036513833">flutter-使用EventBus实现组件间数据通信</a></li>
<li><a href="https://juejin.cn/post/7582808491582619684" target="_blank" title="https://juejin.cn/post/7582808491582619684">Flutter输入框TextField的属性与实战用法全面解析+示例</a></li>
<li><a href="https://juejin.cn/post/7581693431740448831" target="_blank" title="https://juejin.cn/post/7581693431740448831">Flutter自定义日历table_calendar完全指南+案例</a></li>
<li><a href="https://juejin.cn/post/7580389111921786943" target="_blank" title="https://juejin.cn/post/7580389111921786943">flutter-屏幕自适应插件flutter_screenutil教程全指南</a></li>
<li><a href="https://juejin.cn/post/7579101504289882166" target="_blank" title="https://juejin.cn/post/7579101504289882166">flutter-使用url_launcher打开链接/应用/短信/邮件和评分跳转等</a></li>
<li><a href="https://juejin.cn/post/7570923924365230143" target="_blank" title="https://juejin.cn/post/7570923924365230143">flutter图片选择库multi_image_picker_plus和image_picker的对比和使用解析</a></li>
<li><a href="https://juejin.cn/post/7568136081302978623" target="_blank" title="https://juejin.cn/post/7568136081302978623">解锁flutter弹窗新姿势：dialog-flutter_smart_dialog插件解读+案例</a></li>
<li><a href="https://juejin.cn/post/7559089440901545999" target="_blank" title="https://juejin.cn/post/7559089440901545999">flutter-切换状态显示不同组件10种实现方案全解析</a></li>
<li><a href="https://juejin.cn/post/7555079970491318308" target="_blank" title="https://juejin.cn/post/7555079970491318308">flutter-详解控制组件显示的两种方式Offstage与Visibility</a></li>
<li><a href="https://juejin.cn/post/7535358416182788122" target="_blank" title="https://juejin.cn/post/7535358416182788122">flutter-使用AnimatedDefaultTextStyle实现文本动画</a></li>
<li><a href="https://juejin.cn/post/7537339432291434496" target="_blank" title="https://juejin.cn/post/7537339432291434496">flutter-使用SafeArea组件处理各机型的安全距离</a></li>
<li><a href="https://juejin.cn/spost/7537593417099149321" target="_blank" title="https://juejin.cn/spost/7537593417099149321">flutter-实现渐变色边框背景以及渐变色文字</a></li>
<li><a href="https://juejin.cn/post/7543474419240370185" target="_blank" title="https://juejin.cn/post/7543474419240370185">flutter-使用confetti制作炫酷纸屑爆炸粒子动画</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[现代 CSS 颜色使用指南进阶篇]]></title>    <link>https://juejin.cn/post/7596306552220958735</link>    <guid>https://juejin.cn/post/7596306552220958735</guid>    <pubDate>2026-01-19T07:10:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596306552220958735" data-draft-id="7596670644285784064" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 现代 CSS 颜色使用指南进阶篇"/> <meta itemprop="keywords" content="前端,JavaScript,CSS"/> <meta itemprop="datePublished" content="2026-01-19T07:10:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冴羽"/> <meta itemprop="url" content="https://juejin.cn/user/712139234359182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             现代 CSS 颜色使用指南进阶篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139234359182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冴羽
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T07:10:12.000Z" title="Mon Jan 19 2026 07:10:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在上篇文章，我们学会了现代 CSS 颜色的基础用法。</p>
<p>本篇我们进入更高级的领域：<strong>如何像设计师一样操纵颜色</strong>。</p>
<p>CSS 现在能做的事情，甚至比设计软件还要强大！</p>
<h2 data-id="heading-0">1. 操纵颜色</h2>
<h3 data-id="heading-1">1.1. 基础回顾</h3>
<p>先复习一下上篇文章的内容：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--primary</span>: <span class="hljs-number">#ff0000</span>;
}

<span class="hljs-selector-class">.primary-bg-50-opacity</span> {
  <span class="hljs-comment">/* h s l 不是字母，是变量！ */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--primary) h s l / <span class="hljs-number">0.5</span>);
}
</code></pre>
<p><strong>注意：</strong> <code>h s l</code> 这三个字母其实是变量，分别存储了色相（hue）、饱和度（saturation）、亮度（lightness）的值。</p>
<p>我们可以替换这些变量，比如给绿色（#00ff00）加点蓝：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 基础绿色没有蓝色成分 */</span>
<span class="hljs-selector-class">.green-with-a-touch-of-blue</span> {
  <span class="hljs-comment">/* 在蓝色通道加 25 */</span>
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgb</span>(from <span class="hljs-number">#00ff00</span> r g <span class="hljs-built_in">calc</span>(b + <span class="hljs-number">25</span>));
}
</code></pre>
<p>这就像调色板，在基础的绿色中，添加点“蓝色颜料”。</p>
<h3 data-id="heading-2">1.2. 实用技巧</h3>
<p>掌握了基础用法，我们就可以讲些实际开发中会用到的场景了。</p>
<ol>
<li><strong>创建互补色（色轮对面的颜色）：</strong></li>
</ol>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--color-primary</span>: <span class="hljs-number">#2563eb</span>; <span class="hljs-comment">/* 蓝色 */</span>

  <span class="hljs-comment">/* 色相加 180 度，跳到对面 */</span>
  <span class="hljs-attr">--color-secondary</span>: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--color-primary) <span class="hljs-built_in">calc</span>(h + <span class="hljs-number">180</span>) s l);
}
</code></pre>
<ol start="2">
<li><strong>创建三色组合：</strong></li>
</ol>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--color-primary</span>: <span class="hljs-number">#2563eb</span>;

  <span class="hljs-comment">/* 色轮上均匀分布 120 度 */</span>
  <span class="hljs-attr">--color-secondary</span>: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--color-primary) <span class="hljs-built_in">calc</span>(h + <span class="hljs-number">120</span>) s l);
  <span class="hljs-attr">--color-tertiary</span>: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--color-primary) <span class="hljs-built_in">calc</span>(h - <span class="hljs-number">120</span>) s l);
}
</code></pre>
<p>就像时钟：12 点是主色，4 点和 8 点是配色，完美对称！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpiccalil.li%2Fblog%2Fa-pragmatic-guide-to-modern-css-colours-part-two%2F" target="_blank" title="https://piccalil.li/blog/a-pragmatic-guide-to-modern-css-colours-part-two/" ref="nofollow noopener noreferrer">使用效果如下：</a></p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff8b2aadb85249bbafc58360e55dd620~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769411412&amp;x-signature=a4ATVCGmQ%2FHzwtqS8yeIpIAyXZE%3D" alt="" loading="lazy"/></p>
<ol start="3">
<li><strong>相对调整</strong></li>
</ol>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--color-primary-base</span>: <span class="hljs-number">#2563eb</span>;

  <span class="hljs-comment">/* 比基础色亮 25% */</span>
  <span class="hljs-attr">--color-primary-lighter</span>: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--color-primary-base) h s <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">25</span>));

  <span class="hljs-comment">/* 比基础色暗 25% */</span>
  <span class="hljs-attr">--color-primary-darker</span>: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--color-primary-base) h s <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">25</span>));
}
</code></pre>
<p>使用这种方法，不管基础色是多亮，都会相对地变亮或变暗。</p>
<p>这就像调空调，“比现在低 5 度”比“设定到 20 度”更灵活。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcodepen.io%2Fkevinpowell%2Fpen%2FvELwYoO" target="_blank" title="https://codepen.io/kevinpowell/pen/vELwYoO" ref="nofollow noopener noreferrer">使用效果如下：</a></p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2d60ceeb60b41ce98260708c4340110~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769411412&amp;x-signature=u6vyTg5Z6%2B7tw3ZHuUQmyVxNWlg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">2. 暗黑模式的层次感</h2>
<p>现在我们能相对调整颜色了，可是究竟有什么用呢？</p>
<p>让我给你举个具体的使用场景。</p>
<p>在浅色主题中，我们可以根据阴影来区分层次：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a120b83ce4a442b3a441d74c12f43f98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769411412&amp;x-signature=lbN3fdpYOov58Ay4A8GbB6pz1Tg%3D" alt="" loading="lazy"/></p>
<p>但在深色背景下，阴影的效果并不明显。</p>
<p>因此在深色主题中，我们希望每个层次的颜色略微变浅。</p>
<p>借助上篇讲过的 <code>light-dark()</code>和相对颜色调整，我们便可以实现：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--surface-base-light</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">240</span> <span class="hljs-number">67%</span> <span class="hljs-number">97%</span>);
  <span class="hljs-attr">--surface-base-dark</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">252</span> <span class="hljs-number">21%</span> <span class="hljs-number">9%</span>);
}

<span class="hljs-comment">/* 第一层：基础层 */</span>
<span class="hljs-selector-class">.surface-1</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">light-dark</span>(<span class="hljs-built_in">var</span>(--surface-base-light), <span class="hljs-built_in">var</span>(--surface-base-dark));
}

<span class="hljs-comment">/* 第二层：稍微亮一点 */</span>
<span class="hljs-selector-class">.surface-2</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">light-dark</span>(<span class="hljs-built_in">var</span>(--surface-base-light), <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--surface-base-dark) h s <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">4</span>)));
}

<span class="hljs-comment">/* 第三层：再亮一点 */</span>
<span class="hljs-selector-class">.surface-3</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">light-dark</span>(<span class="hljs-built_in">var</span>(--surface-base-light), <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--surface-base-dark) h s <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">8</span>)));
}
</code></pre>
<p>想象一下深海：越接近水面，光线越充足。暗色模式的层次就是这个原理。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcodepen.io%2Fkevinpowell%2Fpen%2FVYeOKQj" target="_blank" title="https://codepen.io/kevinpowell/pen/VYeOKQj" ref="nofollow noopener noreferrer">使用效果如下：</a></p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54572c580a63475c9215c9237d0100a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769411412&amp;x-signature=YR7jxlmdk0XZlGpzJQb%2BKbx737g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. 完整配色方案</h2>
<p>设计师创建配色方案时，不只是简单地调整亮度，还会<strong>同时微调色相和饱和度</strong>，比如</p>
<ul>
<li><strong>变亮时</strong>：饱和度增加，色相向冷色调偏移</li>
<li><strong>变暗时</strong>：饱和度降低</li>
</ul>
<p>这便可以通过 CSS 来实现：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--primary-base</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">221</span> <span class="hljs-number">83%</span> <span class="hljs-number">50%</span>);

  <span class="hljs-comment">/* 400: 亮度60%，色相-3度，饱和度+5% */</span>
  <span class="hljs-attr">--primary-400</span>: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--primary-base) <span class="hljs-built_in">calc</span>(h - <span class="hljs-number">3</span>) <span class="hljs-built_in">calc</span>(s + <span class="hljs-number">5</span>) <span class="hljs-number">60%</span>);

  <span class="hljs-comment">/* 300: 亮度70%，色相-6度，饱和度+10% */</span>
  <span class="hljs-attr">--primary-300</span>: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--primary-base) <span class="hljs-built_in">calc</span>(h - <span class="hljs-number">6</span>) <span class="hljs-built_in">calc</span>(s + <span class="hljs-number">10</span>) <span class="hljs-number">70%</span>);

  <span class="hljs-comment">/* 以此类推... */</span>
}
</code></pre>
<p><strong>为什么要这么麻烦呢？</strong></p>
<p>因为只调亮度会让浅色看起来“失去活力”。</p>
<p>就像拍照：自动模式能拍，但手动调整曝光、对比度、色温会更漂亮。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcodepen.io%2Fkevinpowell%2Fpen%2FJoYaoGW%2F5407077415578757498bf930eb55f8d4" target="_blank" title="https://codepen.io/kevinpowell/pen/JoYaoGW/5407077415578757498bf930eb55f8d4" ref="nofollow noopener noreferrer">为了让你更直观地看到变化</a>：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a4e860772914fe4b15db0cf627ca5a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769411412&amp;x-signature=j5wqj1%2B11lvTneziSWKgj3T1auI%3D" alt="" loading="lazy"/></p>
<p>第一排是都调整的版本，第二排是未调整色相和饱和度的版本。</p>
<p>最明显的区别在于 100、200 和 300 这几个色块，当仅调整亮度值时，颜色看起来失去了一些鲜艳度。</p>
<h2 data-id="heading-5">4. OKLCH 更科学的配色方式</h2>
<h3 data-id="heading-6">4.1. 问题：HSL</h3>
<p>HSL 虽然很棒，但在使用时，你会发现一些问题，让我们看个例子：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.green-bg</span> {
  <span class="hljs-comment">/* 饱和度 100%，亮度 50% */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">100</span> <span class="hljs-number">100%</span> <span class="hljs-number">50%</span>);
  <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.blue-bg</span> {
  <span class="hljs-comment">/* 同样饱和度 100%，亮度 50% */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">220</span> <span class="hljs-number">100%</span> <span class="hljs-number">50%</span>);
  <span class="hljs-attribute">color</span>: white;
}
</code></pre>
<p>你会发现，色和蓝色的饱和度、亮度虽然完全一样，但视觉效果完全不同：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83b3a1cdba7242129861d8a29be20a82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769411412&amp;x-signature=8BM%2FHivqy68ivNAzzEYOzEQPmv4%3D" alt="" loading="lazy"/></p>
<p>明显蓝色背景上的文字清晰易读，对比度超过 5，而绿色背景上的文字却很难看清，对比度仅略高于 1。</p>
<p>之所以会这样，是因为 HSL 的“亮度”不符合人眼感知。</p>
<p>人眼对绿色比蓝色更敏感，所以同样的“50%亮度”，绿色看起来更亮。</p>
<h3 data-id="heading-7">4.2. 解决：OKLCH</h3>
<p>而这就是 oklch() 的优势。</p>
<p>OKLCH 是基于<strong>感知亮度</strong>设计的：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.consistent-green</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.54</span> <span class="hljs-number">0.23</span> <span class="hljs-number">261</span>);
}

<span class="hljs-selector-class">.consistent-blue</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.54</span> <span class="hljs-number">0.23</span> <span class="hljs-number">146</span>);
}
</code></pre>
<p>使用效果如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc1768a9da944df8a03c36ddfc04f091~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769411412&amp;x-signature=v1DcZ59EfWNip%2BGRjlo1qS6Q0tM%3D" alt="" loading="lazy"/></p>
<p>现在不管什么颜色，亮度值相同，人眼看起来的亮度就相同！</p>
<h3 data-id="heading-8">4.3. 讲解：OKLCH 的三个参数</h3>
<p>在 LCH 颜色模型中：</p>
<p>第一个值是亮度（Lightness），取值范围为 0 到 1。它的计算方式与 HSL 略有不同，因为它基于感知亮度，但概念相同，即 0 是黑色，1 是白色。</p>
<p>第二个值是色度（Chroma），类似于饱和度，0 是灰色，越大越鲜艳，但最大值不固定，取决于亮度和色相（这是 OKLCH 最麻烦的地方）</p>
<p>第三个值是色相（Hue），和 HSL 一样是色轮，0 到 360 度，区别是 0 度是洋红色（HSL 里 0 度是红色）</p>
<p>OKLCH 的尴尬之处就在于色度（Chroma）的最大值会变：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 某些色相+亮度组合，0.4 已经是极限 */</span>
<span class="hljs-selector-class">.max-chroma-1</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.6</span> <span class="hljs-number">0.4</span> <span class="hljs-number">120</span>);
}

<span class="hljs-comment">/* 但另一些组合，0.4 可能太高或太低 */</span>
<span class="hljs-selector-class">.max-chroma-2</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.8</span> <span class="hljs-number">0.4</span> <span class="hljs-number">200</span>); <span class="hljs-comment">/* 可能超出范围 */</span>
}
</code></pre>
<p>就像不同口味的饮料，有的最浓是“3 勺糖”，有的最浓是“5 勺糖”，没有统一标准。</p>
<h3 data-id="heading-9">4.4. 实用技巧：结合相对颜色</h3>
<p>虽然直接写 OKLCH 值很麻烦，但我们可以用 HSL 定义基础色，然后用 OKLCH 保持一致性：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.toast</span> {
  <span class="hljs-attr">--base-color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">225</span>, <span class="hljs-number">87%</span>, <span class="hljs-number">56%</span>); <span class="hljs-comment">/* 用熟悉的 HSL 定义 */</span>
}

<span class="hljs-selector-attr">[data-toast=<span class="hljs-string">"info"</span>]</span> {
  <span class="hljs-comment">/* 只改变色相，保持亮度和色度 */</span>
  <span class="hljs-attr">--toast-color</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--base-color) l c <span class="hljs-number">275</span>);
}

<span class="hljs-selector-attr">[data-toast=<span class="hljs-string">"warning"</span>]</span> {
  <span class="hljs-attr">--toast-color</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--base-color) l c <span class="hljs-number">80</span>);
}

<span class="hljs-selector-attr">[data-toast=<span class="hljs-string">"error"</span>]</span> {
  <span class="hljs-attr">--toast-color</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--base-color) l c <span class="hljs-number">35</span>);
}
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcodepen.io%2Fkevinpowell%2Fpen%2FwBMbozY" target="_blank" title="https://codepen.io/kevinpowell/pen/wBMbozY" ref="nofollow noopener noreferrer">使用效果如下：</a></p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/996f7e9f14cd4fefb52678870dc2b789~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769411412&amp;x-signature=rL6mPu15DNkoJHiPM6gBGWmJV0s%3D" alt="" loading="lazy"/></p>
<p>这样做的好处在于：不同颜色的提示框，边框对比度、整体饱和度感觉都很一致。</p>
<h2 data-id="heading-10">5. 混合颜色</h2>
<p>有的时候，我们可能需要混合两种颜色：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.purple</span> {
  <span class="hljs-comment">/* 红色和蓝色各占 50% */</span>
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">color-mix</span>(in srgb, red, blue);
}
</code></pre>
<p>就像调颜料：红色颜料加蓝色颜料，得到紫色。</p>
<p>目前必须定义一个颜色空间，所以必须写 <code>in srgb</code> 或 <code>in oklab</code> 等，未来会默认用 <code>oklab</code>。</p>
<p>不同颜色空间混出来的结果不一样：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6eb4b367d9e4bd1876cafed079e94a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769411412&amp;x-signature=jEWW1FW6JJiivUVr9WXSzBVIdBc%3D" alt="" loading="lazy"/></p>
<p>一般推荐：</p>
<ol>
<li>先试 <code>oklab</code></li>
<li>再试 <code>oklch</code></li>
<li>不满意就换其他的</li>
</ol>
<h3 data-id="heading-11">5.1. 控制混合比例</h3>
<p>默认情况下，使用该功能时 <code>color-mix()</code>，每种颜色将使用 50% 的强度。</p>
<p>当然，我们也可以控制特定颜色的具体强度。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 90% 红色 + 10% 蓝色 */</span>
<span class="hljs-selector-class">.red-with-a-touch-of-blue</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">color-mix</span>(in oklab, red <span class="hljs-number">90%</span>, blue);
}

<span class="hljs-comment">/* 或者反过来写 */</span>
<span class="hljs-selector-class">.or-like-this</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">color-mix</span>(in oklab, red, blue <span class="hljs-number">10%</span>);
}
</code></pre>
<h3 data-id="heading-12">5.2. 创建半透明色</h3>
<p>有两种方法可以获得透明的值：</p>
<p><strong>方法一：让总量小于 100%</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 60% + 20% = 80%，所以透明度是 80% */</span>
<span class="hljs-selector-class">.semi-opaque</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">color-mix</span>(in oklab, red <span class="hljs-number">60%</span>, blue <span class="hljs-number">20%</span>);
}
</code></pre>
<p><strong>方法二：混入 transparent</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 30% 的不透明红色 */</span>
<span class="hljs-selector-class">.thirty-percent-opacity-red</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">color-mix</span>(in oklch, red <span class="hljs-number">30%</span>, transparent);
}
</code></pre>
<p>不过如果只是想降低透明度，还是用相对颜色更直接：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.better-way</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgb</span>(from red r g b / <span class="hljs-number">0.3</span>);
}
</code></pre>
<h3 data-id="heading-13">5.3. 小技巧：分段渐变</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 不用手动算中间的每个颜色，color-mix 帮你搞定 */</span>
<span class="hljs-selector-class">.banded-gradient</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to right, red, <span class="hljs-built_in">color-mix</span>(in oklch, red <span class="hljs-number">75%</span>, blue), <span class="hljs-built_in">color-mix</span>(in oklch, red <span class="hljs-number">50%</span>, blue), <span class="hljs-built_in">color-mix</span>(in oklch, red <span class="hljs-number">25%</span>, blue), blue);
}
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcodepen.io%2Fkevinpowell%2Fpen%2FVYeOvYE" target="_blank" title="https://codepen.io/kevinpowell/pen/VYeOvYE" ref="nofollow noopener noreferrer">使用效果如下：</a></p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be12f4321f67495f8ef276f7a7fb0876~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769411412&amp;x-signature=hc6rvG3cx7Ao9b4BdhthJvqUDyU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">6. 未来更简单</h2>
<p>重复写这些代码很烦？</p>
<p>CSS 自定义函数快来了：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 定义函数 */</span>
<span class="hljs-keyword">@function</span> --lower-opacity(--color, --opacity) {
  result: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--color) l c h / <span class="hljs-built_in">var</span>(--opacity));
}

<span class="hljs-comment">/* 使用函数 */</span>
<span class="hljs-selector-class">.lower-opacity-primary</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">--lower-opacity</span>(<span class="hljs-built_in">var</span>(--primary), <span class="hljs-number">0.5</span>);
}
</code></pre>
<p>或者定义整套色阶函数：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@function</span> --shade-<span class="hljs-number">100</span>(--color) returns &lt;<span class="hljs-attribute">color</span>&gt; {
  result: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--color) <span class="hljs-built_in">calc</span>(h - <span class="hljs-number">12</span>) <span class="hljs-built_in">calc</span>(s + <span class="hljs-number">15</span>) <span class="hljs-number">95%</span>);
}

<span class="hljs-keyword">@function</span> --shade-<span class="hljs-number">200</span>(--color) returns &lt;<span class="hljs-attribute">color</span>&gt; {
  result: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--color) <span class="hljs-built_in">calc</span>(h - <span class="hljs-number">10</span>) <span class="hljs-built_in">calc</span>(s + <span class="hljs-number">12</span>) <span class="hljs-number">85%</span>);
}
<span class="hljs-comment">/* 以此类推... */</span>

<span class="hljs-selector-class">.call-to-action</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">--shade-200</span>(<span class="hljs-built_in">var</span>(--accent));
}

<span class="hljs-selector-class">.hero</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">--shade-800</span>(<span class="hljs-built_in">var</span>(--primary));
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">--shade-100</span>(<span class="hljs-built_in">var</span>(--primary));
}
</code></pre>
<p>一次定义，到处使用，完美！</p>
<h2 data-id="heading-15">7. 总结</h2>
<p>最后总结下本篇文章的重点：</p>
<ol>
<li><strong>用 calc() 操纵颜色</strong> - 数学生成配色方案</li>
<li><strong>OKLCH</strong> - 基于人眼感知的颜色系统，不同色相亮度一致</li>
<li><strong>color-mix()</strong> - 像调颜料一样混合颜色</li>
</ol>
<p>在实际使用时：</p>
<ul>
<li><strong>简单需求</strong>：相对颜色 + HSL</li>
<li><strong>需要视觉一致性</strong>：OKLCH</li>
<li><strong>需要混合颜色</strong>：color-mix()</li>
<li><strong>暗黑模式层次</strong>：light-dark() + 相对颜色</li>
</ul>
<p>本篇整理自<a href="https://link.juejin.cn?target=https%3A%2F%2Fpiccalil.li%2Fblog%2Fa-pragmatic-guide-to-modern-css-colours-part-two%2F" target="_blank" title="https://piccalil.li/blog/a-pragmatic-guide-to-modern-css-colours-part-two/" ref="nofollow noopener noreferrer">《A pragmatic guide to modern CSS colours - part two》</a>，希望能帮助到你。</p>
<p>我是冴羽，10 年笔耕不辍，专注前端领域，更新了 10+ 系列、300+ 篇原创技术文章，翻译过 Svelte、Solid.js、TypeScript 文档，著有小册《Next.js 开发指南》、《Svelte 开发指南》、《Astro 实战指南》。</p>
<p>欢迎围观我的“<a href="https://link.juejin.cn?target=https%3A%2F%2Fyayujs.com%2F" target="_blank" title="https://yayujs.com/" ref="nofollow noopener noreferrer">网页版朋友圈</a>”，关注我的公众号：<strong>冴羽（或搜索 yayujs）</strong>，每天分享前端知识、AI 干货。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙ArkUI组件封装实战：3招告别重复代码]]></title>    <link>https://juejin.cn/post/7596488155303493651</link>    <guid>https://juejin.cn/post/7596488155303493651</guid>    <pubDate>2026-01-19T03:43:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596488155303493651" data-draft-id="7596342523968045065" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙ArkUI组件封装实战：3招告别重复代码"/> <meta itemprop="keywords" content="HarmonyOS,前端,前端工程化"/> <meta itemprop="datePublished" content="2026-01-19T03:43:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="纯爱掌门人"/> <meta itemprop="url" content="https://juejin.cn/user/2849548342403454"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙ArkUI组件封装实战：3招告别重复代码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2849548342403454/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    纯爱掌门人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T03:43:38.000Z" title="Mon Jan 19 2026 03:43:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    73
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><p>做鸿蒙ArkUI开发的兄弟姐妹们，是不是总被重复代码折磨？登录页的确认按钮、购物页的结算按钮，样式一模一样还要写两遍；图片加文字的布局，换个页面又得重新拼一遍——改样式时逐个文件找，维护起来头都大了！其实只要学会组件封装，把重复代码“打包”起来，下次直接拿过来用，效率直接翻倍，还方便团队协作。今天就手把手教你三种核心封装方式，新手也能轻松拿捏！</p>
<h2 data-id="heading-0">一、先搞懂：组件封装到底好在哪？</h2>
<p>简单说，封装就是把相同或相似的UI样式、布局、逻辑“装起来”，核心好处就三个：</p>
<ol>
<li>少写重复代码：写一次能用N次，不用复制粘贴</li>
<li>维护超方便：要改样式/逻辑，只改封装组件，所有用到的地方自动同步</li>
<li>团队不吵架：统一组件风格，不用纠结“你写的按钮和我不一样”</li>
</ol>
<p>鸿蒙里最常用的封装场景就三种：只复用样式、复用样式+布局+逻辑、批量管理多个组件，咱们一个个说清楚。</p>
<h2 data-id="heading-1">二、第一种：组件公共样式封装（只复用样式）</h2>
<h3 data-id="heading-2">适用场景</h3>
<p>如果只是多个组件要共用一套样式，比如所有确认按钮都是胶囊形、一样的大小和颜色，就用这种方式。比如登录页的“登录”按钮和购物页的“结算”按钮，功能不同但样式一致，直接封装样式就行。</p>
<h3 data-id="heading-3">核心思路</h3>
<p>用系统提供的<code>AttributeModifier</code>接口，把公共样式写在一个类里，之后哪个组件要用，直接套用这个类就行。</p>
<h3 data-id="heading-4">手把手操作</h3>
<h4 data-id="heading-5">第一步：封装公共样式类</h4>
<p>先创建一个类，实现<code>AttributeModifier</code>接口，把按钮的默认态、按压态样式都写进去：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 封装按钮的公共样式</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyButtonModifier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">ButtonAttribute</span>&gt; {
  <span class="hljs-comment">// 默认是普通按钮，后续可修改</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">buttonType</span>: <span class="hljs-title class_">ButtonType</span> = <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Normal</span>;

  <span class="hljs-comment">// 设置按钮类型（比如胶囊形、普通形）</span>
  <span class="hljs-title function_">type</span>(<span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>): <span class="hljs-title class_">MyButtonModifier</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonType</span> = <span class="hljs-keyword">type</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// 按钮默认状态的样式</span>
  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">ButtonAttribute</span>): <span class="hljs-built_in">void</span> {
    instance.<span class="hljs-title function_">type</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonType</span>); <span class="hljs-comment">// 按钮类型</span>
    instance.<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>); <span class="hljs-comment">// 宽度</span>
    instance.<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>); <span class="hljs-comment">// 高度</span>
    instance.<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>); <span class="hljs-comment">// 字体大小</span>
    instance.<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#0A59F7'</span>); <span class="hljs-comment">// 字体颜色</span>
    instance.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0D000000'</span>); <span class="hljs-comment">// 背景色</span>
  }

  <span class="hljs-comment">// 按钮按压状态的样式</span>
  <span class="hljs-title function_">applyPressedAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">ButtonAttribute</span>): <span class="hljs-built_in">void</span> {
    instance.<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#0A59F7'</span>);
    instance.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#26000000'</span>); <span class="hljs-comment">// 按压时背景色加深</span>
  }
}
</code></pre>
<h4 data-id="heading-6">第二步：使用封装好的样式</h4>
<p>在需要的页面里，创建样式实例，通过<code>attributeModifier()</code>方法应用到按钮上：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">AttributeStylePage</span> {
  <span class="hljs-comment">// 创建样式实例，设置为胶囊形按钮</span>
  modifier = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyButtonModifier</span>().<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>);

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">NavDestination</span>() {
      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-comment">// 直接套用封装好的样式</span>
        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'确认按钮'</span>)
          .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>)
      }
      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: $r(<span class="hljs-string">'app.float.margin_top'</span>) })
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    }
    .<span class="hljs-title function_">title</span>(<span class="hljs-title function_">getResourceString</span>($r(<span class="hljs-string">'app.string.common_style_extract'</span>), <span class="hljs-variable language_">this</span>))
  }
}
</code></pre>
<h3 data-id="heading-7">小提醒</h3>
<ol>
<li>这种样式只能用在系统组件上（比如Button、Image），自定义组件暂时不支持</li>
<li>样式类可以跨文件导出，整个项目都能复用，还能灵活改参数（比如改按钮类型、颜色）</li>
</ol>
<h2 data-id="heading-8">三、第二种：自定义组件封装（样式+布局+逻辑一起复用）</h2>
<h3 data-id="heading-9">适用场景</h3>
<p>如果不仅要复用样式，连布局和逻辑都要复用，比如商品卡片（图片+名称+价格固定布局）、个人信息项（图标+文字+箭头），就适合封装成自定义组件。而且还能让使用方灵活修改部分属性，比如图片大小、文字内容。</p>
<h3 data-id="heading-10">核心思路</h3>
<p>用<code>@Component</code>装饰器把组件“打包”，不变的部分（比如图片和文字的排列方式）写在内部，可变的部分（比如图片地址、大小）用参数暴露出去，让使用方按需配置。</p>
<h3 data-id="heading-11">手把手操作</h3>
<p>咱们以“图片+文字”的组合组件为例：</p>
<h4 data-id="heading-12">第一步：先封装子组件的样式（可选）</h4>
<p>分别给Image和Text组件写样式类，方便后续修改：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 图片组件的样式封装</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomImageModifier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">ImageAttribute</span>&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">imageWidth</span>: <span class="hljs-title class_">Length</span> = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">imageHeight</span>: <span class="hljs-title class_">Length</span> = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 初始化图片大小</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">width: Length, height: Length</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageWidth</span> = width;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageHeight</span> = height;
  }

  <span class="hljs-comment">// 提供修改宽高的方法</span>
  <span class="hljs-title function_">width</span>(<span class="hljs-params">width: Length</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageWidth</span> = width;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">height</span>(<span class="hljs-params">height: Length</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageHeight</span> = height;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// 应用图片样式</span>
  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">ImageAttribute</span>): <span class="hljs-built_in">void</span> {
    instance.<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imageWidth</span>);
    instance.<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imageHeight</span>);
    instance.<span class="hljs-title function_">borderRadius</span>($r(<span class="hljs-string">'app.float.border_radius'</span>)); <span class="hljs-comment">// 圆角</span>
  }
}

<span class="hljs-comment">// 文字组件的样式封装</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomTextModifier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">TextAttribute</span>&gt; {
  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">TextAttribute</span>): <span class="hljs-built_in">void</span> {
    instance.<span class="hljs-title function_">fontSize</span>($r(<span class="hljs-string">'app.float.font_size_l'</span>)); <span class="hljs-comment">// 字体大小</span>
  }
}
</code></pre>
<h4 data-id="heading-13">第二步：封装自定义组件</h4>
<p>把图片和文字的布局、点击事件都封装进去，暴露可变参数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">CustomImageText</span> {
  <span class="hljs-comment">// 图片样式（默认100x100）</span>
  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">imageAttribute</span>: <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">ImageAttribute</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomImageModifier</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
  <span class="hljs-comment">// 文字样式（默认样式）</span>
  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">textAttribute</span>: <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">TextAttribute</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomTextModifier</span>();
  <span class="hljs-comment">// 图片资源（必须由使用方传入）</span>
  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">imageSrc</span>: <span class="hljs-title class_">PixelMap</span> | <span class="hljs-title class_">ResourceStr</span> | <span class="hljs-title class_">DrawableDescriptor</span>;
  <span class="hljs-comment">// 文字内容（必须由使用方传入）</span>
  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">// 点击事件（可选，使用方按需传入）</span>
  onClickEvent?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 固定布局：图片和文字纵向排列</span>
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">12</span> }) {
      <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imageSrc</span>)
        .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imageAttribute</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>)
        .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textAttribute</span>)
    }
    <span class="hljs-comment">// 点击事件触发</span>
    .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onClickEvent</span> !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onClickEvent</span>();
      }
    })
  }
}
</code></pre>
<h4 data-id="heading-14">第三步：使用自定义组件</h4>
<p>按需传入图片资源、文字、样式和点击事件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">CommonComponent</span> {
  <span class="hljs-comment">// 自定义图片大小为330x330</span>
  <span class="hljs-attr">imageAttribute</span>: <span class="hljs-title class_">CustomImageModifier</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomImageModifier</span>(<span class="hljs-number">330</span>, <span class="hljs-number">330</span>);

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">NavDestination</span>() {
      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">CustomImageText</span>({
          <span class="hljs-attr">imageAttribute</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageAttribute</span>, <span class="hljs-comment">// 传入自定义图片大小</span>
          <span class="hljs-attr">imageSrc</span>: $r(<span class="hljs-string">'app.media.image'</span>), <span class="hljs-comment">// 图片资源</span>
          <span class="hljs-attr">text</span>: <span class="hljs-string">'Scenery'</span>, <span class="hljs-comment">// 文字内容</span>
          <span class="hljs-attr">onClickEvent</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">// 点击组件显示提示</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Clicked'</span> })
          }
        })
      }
      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: $r(<span class="hljs-string">'app.float.margin_top'</span>) })
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    }
    .<span class="hljs-title function_">title</span>(<span class="hljs-title function_">getResourceString</span>($r(<span class="hljs-string">'app.string.common'</span>), <span class="hljs-variable language_">this</span>))
  }
}
</code></pre>
<h2 data-id="heading-15">四、第三种：组件工厂类封装（批量管理多个组件）</h2>
<h3 data-id="heading-16">适用场景</h3>
<p>如果项目里有很多零散组件（比如单选框、复选框、输入框），想统一管理，让业务团队通过组件名直接获取使用，就用这种方式。比如传入“Radio”拿单选框，传入“Checkbox”拿复选框，不用逐个导入。</p>
<h3 data-id="heading-17">核心思路</h3>
<p>用<code>@Builder</code>装饰器定义组件模板，再用<code>wrapBuilder</code>函数包装，存入一个Map（键是组件名，值是组件对象），最后导出这个“组件工厂”，使用方按名字取就行。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24876b8b43c14e3ca0fc597fbe98d558~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qv54ix5o6M6Zeo5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769489938&amp;x-signature=KrQ%2BeglUmj1kXK3yHbAGmJLUQvA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-18">手把手操作</h3>
<h4 data-id="heading-19">第一步：定义组件模板</h4>
<p>用<code>@Builder</code>写全局的组件模板（比如单选框、复选框）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 单选框组件模板</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myRadio</span>(<span class="hljs-params"/>) {
  <span class="hljs-title class_">Text</span>($r(<span class="hljs-string">'app.string.radio'</span>))
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'sys.color.mask_secondary'</span>))
  <span class="hljs-comment">// 男选项</span>
  <span class="hljs-title class_">Row</span>() {
    <span class="hljs-title class_">Radio</span>({ <span class="hljs-attr">value</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">'radioGroup'</span> })
      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: $r(<span class="hljs-string">'app.float.margin_right'</span>) })
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'man'</span>)
  }
  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
  <span class="hljs-comment">// 女选项</span>
  <span class="hljs-title class_">Row</span>() {
    <span class="hljs-title class_">Radio</span>({ <span class="hljs-attr">value</span>: <span class="hljs-string">'0'</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">'radioGroup'</span> })
      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: $r(<span class="hljs-string">'app.float.margin_right'</span>) })
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'woman'</span>)
  }
  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
}

<span class="hljs-comment">// 复选框组件模板</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myCheckBox</span>(<span class="hljs-params"/>) {
  <span class="hljs-title class_">Text</span>($r(<span class="hljs-string">'app.string.checkbox'</span>))
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'sys.color.mask_secondary'</span>))
  <span class="hljs-comment">// 全选</span>
  <span class="hljs-title class_">Row</span>() {
    <span class="hljs-title class_">CheckboxGroup</span>({ <span class="hljs-attr">group</span>: <span class="hljs-string">'checkboxGroup'</span> })
      .<span class="hljs-title function_">checkboxShape</span>(<span class="hljs-title class_">CheckBoxShape</span>.<span class="hljs-property">ROUNDED_SQUARE</span>)
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'all'</span>)
      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: $r(<span class="hljs-string">'app.float.margin_right'</span>) })
  }
  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
  <span class="hljs-comment">// 选项1</span>
  <span class="hljs-title class_">Row</span>() {
    <span class="hljs-title class_">Checkbox</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">'checkboxGroup'</span> })
      .<span class="hljs-title function_">shape</span>(<span class="hljs-title class_">CheckBoxShape</span>.<span class="hljs-property">ROUNDED_SQUARE</span>)
      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: $r(<span class="hljs-string">'app.float.margin_right'</span>) })
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'text1'</span>)
  }
  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
  <span class="hljs-comment">// 选项2</span>
  <span class="hljs-title class_">Row</span>() {
    <span class="hljs-title class_">Checkbox</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'0'</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">'checkboxGroup'</span> })
      .<span class="hljs-title function_">shape</span>(<span class="hljs-title class_">CheckBoxShape</span>.<span class="hljs-property">ROUNDED_SQUARE</span>)
      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: $r(<span class="hljs-string">'app.float.margin_right'</span>) })
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'text2'</span>)
  }
  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
}
</code></pre>
<h4 data-id="heading-20">第二步：创建组件工厂</h4>
<p>把组件模板包装后存入Map，再导出工厂：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义组件工厂Map，键是组件名，值是组件对象</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">factoryMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-comment">// 把组件存入工厂（用wrapBuilder包装@Builder方法）</span>
factoryMap.<span class="hljs-title function_">set</span>(<span class="hljs-string">'Radio'</span>, <span class="hljs-title function_">wrapBuilder</span>(myRadio));
factoryMap.<span class="hljs-title function_">set</span>(<span class="hljs-string">'Checkbox'</span>, <span class="hljs-title function_">wrapBuilder</span>(myCheckBox));

<span class="hljs-comment">// 导出工厂，供外部使用</span>
<span class="hljs-keyword">export</span> { factoryMap };
</code></pre>
<h4 data-id="heading-21">第三步：使用工厂里的组件</h4>
<p>导入工厂，按组件名获取并渲染：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 导入组件工厂（路径要按实际项目调整）</span>
<span class="hljs-keyword">import</span> { factoryMap } <span class="hljs-keyword">from</span> <span class="hljs-string">'../view/FactoryMap'</span>;

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ComponentFactory</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">NavDestination</span>() {
      <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">12</span> }) {
        <span class="hljs-comment">// 按名字获取单选框组件并渲染</span>
        (factoryMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">'Radio'</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">WrappedBuilder</span>&lt;[]&gt;).<span class="hljs-title function_">builder</span>();
        <span class="hljs-comment">// 按名字获取复选框组件并渲染</span>
        (factoryMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">'Checkbox'</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">WrappedBuilder</span>&lt;[]&gt;).<span class="hljs-title function_">builder</span>();
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">padding</span>($r(<span class="hljs-string">'app.float.padding'</span>))
    }
    .<span class="hljs-title function_">title</span>(<span class="hljs-title function_">getResourceString</span>($r(<span class="hljs-string">'app.string.factory'</span>), <span class="hljs-variable language_">this</span>))
  }
}
</code></pre>
<h3 data-id="heading-22">小提醒</h3>
<ol>
<li>只有全局的<code>@Builder</code>方法才能用<code>wrapBuilder</code>包装</li>
<li>从工厂拿的组件，只能在<code>struct</code>的<code>build</code>方法里使用</li>
</ol>
<h2 data-id="heading-23">五、封装后常见问题：直接抄作业就行！</h2>
<h3 data-id="heading-24">1. 怎么调用子组件里的方法？</h3>
<p>三种实用方法，按需选：</p>
<h4 data-id="heading-25">方法一：用Controller类（推荐）</h4>
<p>定义一个控制器，子组件把方法“交”给控制器，父组件通过控制器调用：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义控制器</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Controller</span> {
  action = <span class="hljs-function">() =&gt;</span> {}; <span class="hljs-comment">// 用来存子组件的方法</span>
}

<span class="hljs-comment">// 子组件</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">ChildComponent</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">bgColor</span>: <span class="hljs-title class_">ResourceColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;
  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">Controller</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;

  <span class="hljs-comment">// 子组件的方法：切换背景色</span>
  <span class="hljs-keyword">private</span> switchColor = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> === <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span> ? <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;
  }

  <span class="hljs-comment">// 组件初始化时，把方法赋值给控制器</span>
  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-property">action</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">switchColor</span>;
    }
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Child Component'</span>)
    }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span>).<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)
  }
}

<span class="hljs-comment">// 父组件</span>
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-keyword">private</span> childRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Controller</span>(); <span class="hljs-comment">// 创建控制器实例</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 把控制器传给子组件</span>
      <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRef</span> })
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'切换子组件颜色'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRef</span>.<span class="hljs-title function_">action</span>(); <span class="hljs-comment">// 调用子组件方法</span>
        })
        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">16</span> })
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)
  }
}
</code></pre>
<h4 data-id="heading-26">方法二：用@Watch监听</h4>
<p>父组件改状态变量，子组件监听变量变化，触发方法：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 子组件</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">ChildComponent</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">bgColor</span>: <span class="hljs-title class_">ResourceColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;
  <span class="hljs-comment">// 监听checkFlag变量变化</span>
  <span class="hljs-meta">@Link</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'switchColor'</span>) <span class="hljs-attr">checkFlag</span>: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-comment">// 变量变化时触发的方法</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">switchColor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">checkFlag</span> ? <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Child Component'</span>)
    }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span>).<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)
  }
}

<span class="hljs-comment">// 父组件</span>
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">childCheckFlag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">checkFlag</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">childCheckFlag</span> })
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'切换颜色'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">childCheckFlag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">childCheckFlag</span>; <span class="hljs-comment">// 改变量</span>
        })
        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">16</span> })
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)
  }
}
</code></pre>
<h4 data-id="heading-27">方法三：用Emitter事件通信</h4>
<p>子组件监听事件，父组件发送事件，触发子组件方法：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 子组件</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">ChildComponent</span> {
  <span class="hljs-comment">// 定义事件ID</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-variable constant_">EVENT_ID_SWITCH_COLOR</span> = <span class="hljs-string">'SWITCH_COLOR'</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">bgColor</span>: <span class="hljs-title class_">ResourceColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;

  <span class="hljs-keyword">private</span> switchColor = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> === <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span> ? <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;
  }

  <span class="hljs-comment">// 组件初始化时监听事件</span>
  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {
    emitter.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">ChildComponent</span>.<span class="hljs-property">EVENT_ID_SWITCH_COLOR</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">switchColor</span>);
  }

  <span class="hljs-comment">// 组件销毁时取消监听</span>
  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {
    emitter.<span class="hljs-title function_">off</span>(<span class="hljs-title class_">ChildComponent</span>.<span class="hljs-property">EVENT_ID_SWITCH_COLOR</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">switchColor</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Child Component'</span>)
    }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span>).<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)
  }
}

<span class="hljs-comment">// 父组件</span>
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">ChildComponent</span>()
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'切换颜色'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-title class_">ChildComponent</span>.<span class="hljs-property">EVENT_ID_SWITCH_COLOR</span>); <span class="hljs-comment">// 发送事件</span>
        })
        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">16</span> })
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)
  }
}
</code></pre>
<h3 data-id="heading-28">2. 怎么调用父组件里的方法？</h3>
<p>超简单！子组件留个回调参数，父组件把自己的方法传进去：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 子组件</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">ChildComponent</span> {
  call = <span class="hljs-function">() =&gt;</span> {}; <span class="hljs-comment">// 回调参数，用来存父组件的方法</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'调用父组件方法'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">call</span>(); <span class="hljs-comment">// 触发父组件方法</span>
        })
    }
  }
}

<span class="hljs-comment">// 父组件</span>
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-comment">// 父组件的方法</span>
  <span class="hljs-title function_">parentAction</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Parent Action'</span> });
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;
      hilog.<span class="hljs-title function_">warn</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`showToast failed, code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);
    }
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 把父组件方法传给子组件</span>
      <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">call</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentAction</span> })
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)
  }
}
</code></pre>
<h3 data-id="heading-29">3. 怎么实现“插槽”（可变UI部分）？</h3>
<p>用<code>@BuilderParam</code>！子组件留个位置，父组件按需传入UI内容：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 子组件</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">ChildComponent</span> {
  <span class="hljs-comment">// 默认空UI</span>
  <span class="hljs-meta">@Builder</span>
  <span class="hljs-title function_">customBuilder</span>(<span class="hljs-params"/>) {}

  <span class="hljs-comment">// 暴露给父组件的UI参数</span>
  <span class="hljs-meta">@BuilderParam</span> <span class="hljs-attr">customBuilderParam</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">customBuilder</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'子组件固定内容'</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">customBuilderParam</span>(); <span class="hljs-comment">// 父组件传入的可变UI</span>
    }
  }
}

<span class="hljs-comment">// 父组件</span>
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-comment">// 父组件定义的可变UI</span>
  <span class="hljs-meta">@Builder</span>
  <span class="hljs-title function_">componentBuilder</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`父组件传入的UI`</span>)
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 传入可变UI</span>
      <span class="hljs-title class_">ChildComponent</span>() {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">componentBuilder</span>();
      }
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)
  }
}
</code></pre>
<h3 data-id="heading-30">4. 怎么传递组件数组，实现循环渲染？</h3>
<p>先把组件包装成全局<code>@Builder</code>，再用<code>wrapBuilder</code>封装成数组，最后用<code>ForEach</code>循环：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 定义全局组件模板</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">itemBuilder</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-title class_">Text</span>(text)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
    .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)
}

<span class="hljs-comment">// 2. 封装成组件数组</span>
<span class="hljs-keyword">const</span> componentArray = [
  <span class="hljs-title function_">wrapBuilder</span>(itemBuilder, <span class="hljs-string">'项目1'</span>),
  <span class="hljs-title function_">wrapBuilder</span>(itemBuilder, <span class="hljs-string">'项目2'</span>),
  <span class="hljs-title function_">wrapBuilder</span>(itemBuilder, <span class="hljs-string">'项目3'</span>)
];

<span class="hljs-comment">// 3. 循环渲染</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ForEachComponent</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">ForEach</span>(componentArray, <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
        item.<span class="hljs-title function_">builder</span>(); <span class="hljs-comment">// 渲染每个组件</span>
      })
    }
  }
}
</code></pre>
<h2 data-id="heading-31">总结</h2>
<p>组件封装的核心就是“提取重复，暴露可变”：</p>
<ul>
<li>只复用样式：用<code>AttributeModifier</code></li>
<li>复用样式+布局+逻辑：用<code>@Component</code>写自定义组件</li>
<li>批量管理组件：用组件工厂（Map+wrapBuilder）</li>
</ul>
<p>掌握这三招，再也不用写重复代码，项目维护起来也省心。遇到调用方法、插槽这些问题，直接抄上面的作业就行～ 赶紧把你项目里的重复组件封装起来试试吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[还在无脑 .map().filter()？实测改用 Iterator Helpers 后，内存占用降低了 99%]]></title>    <link>https://juejin.cn/post/7596926832912498751</link>    <guid>https://juejin.cn/post/7596926832912498751</guid>    <pubDate>2026-01-19T11:53:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596926832912498751" data-draft-id="7596865421612302390" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="还在无脑 .map().filter()？实测改用 Iterator Helpers 后，内存占用降低了 99%"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-19T11:53:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            还在无脑 .map().filter()？实测改用 Iterator Helpers 后，内存占用降低了 99%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T11:53:53.000Z" title="Mon Jan 19 2026 11:53:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    231
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">别再把所有东西都转成数组了：Iterator Helpers 性能实测</h2>
<p>今天看到一篇文章，标题很直接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fallthingssmitty.com%2F2026%2F01%2F12%2Fstop-turning-everything-into-arrays-and-do-less-work-instead%2F" target="_blank" title="https://allthingssmitty.com/2026/01/12/stop-turning-everything-into-arrays-and-do-less-work-instead/" ref="nofollow noopener noreferrer">Stop turning everything into arrays</a>。作者的观点是，JavaScript 里我们习惯了用 <code>.map().filter().slice()</code> 这种链式调用，看着很优雅，但其实每一步都在创建新数组，做了很多不必要的工作。</p>
<p>我一开始也半信半疑，毕竟这种写法用了这么多年，真的有那么大问题吗？于是我写了个测试脚本，跑了几组对比实验，结果还挺出乎意料的。</p>
<h3 data-id="heading-1">问题在哪</h3>
<p>先说传统数组方法的问题。假设你有个常见场景：从一个大列表里筛选出符合条件的数据，做点转换，然后只取前 10 条显示。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> visibleItems = items
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
  .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);
</code></pre>
<p>这代码看着没毛病，但实际执行时：</p>
<ol>
<li><code>filter</code> 遍历整个数组，创建一个新数组</li>
<li><code>map</code> 再遍历一遍，又创建一个新数组</li>
<li><code>slice</code> 最后从结果里取前 10 条，又创建一个新数组</li>
</ol>
<p>如果 <code>items</code> 有 10 万条数据，你可能只需要 10 条，但前面两步已经把 10 万条全处理完了。这就是"急切求值"（eager evaluation）的问题——不管你最后用不用，先把活全干了再说。</p>
<h3 data-id="heading-2">Iterator Helpers 是什么</h3>
<p>Iterator Helpers 是 JavaScript 新加的特性，提供了一套"惰性求值"（lazy evaluation）的方法。关键区别是：</p>
<ul>
<li><strong>传统数组方法</strong>：每一步都立即执行，创建中间数组</li>
<li><strong>Iterator Helpers</strong>：只描述要做什么，真正需要数据时才执行</li>
</ul>
<p>用法上也很直观：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> visibleItems = items
  .<span class="hljs-title function_">values</span>()              <span class="hljs-comment">// 转成 iterator</span>
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
  .<span class="hljs-title function_">take</span>(<span class="hljs-number">10</span>)              <span class="hljs-comment">// 只取 10 条</span>
  .<span class="hljs-title function_">toArray</span>();            <span class="hljs-comment">// 最后转回数组</span>
</code></pre>
<p>核心差异在于：</p>
<ol>
<li><code>items.values()</code> 返回的是 iterator，不是数组</li>
<li>每一步只是在"描述"操作，不会立即执行</li>
<li><code>take(10)</code> 告诉它只需要 10 条，处理到 10 条就停</li>
<li><code>toArray()</code> 才真正触发执行，而且只处理需要的数据</li>
</ol>
<h3 data-id="heading-3">实测对比</h3>
<p>我写了个测试脚本，从<strong>时间</strong>和<strong>空间</strong>两个维度进行对比测试。每组场景的时间测试重复 10 次取平均值，内存测试使用 Node.js 的 <code>process.memoryUsage()</code> API 测量堆内存增长。</p>
<h4 data-id="heading-4">场景 1：过滤 + 转换 + 取前 10 项</h4>
<p><strong>数据规模</strong>：100,000 条</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统数组方法</span>
dataset
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
  .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);

<span class="hljs-comment">// Iterator Helpers</span>
dataset
  .<span class="hljs-title function_">values</span>()
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
  .<span class="hljs-title function_">take</span>(<span class="hljs-number">10</span>)
  .<span class="hljs-title function_">toArray</span>();
</code></pre>
<p><strong>结果</strong>：</p>























<table><thead><tr><th>维度</th><th>传统数组方法</th><th>Iterator Helpers</th><th>性能提升</th></tr></thead><tbody><tr><td>时间</td><td>1.545ms</td><td>0.019ms</td><td><strong>98.77%</strong></td></tr><tr><td>内存</td><td>3.38 MB</td><td>0.01 MB</td><td><strong>99.75%</strong></td></tr></tbody></table>
<p>这个结果很夸张，Iterator Helpers 在时间上快了 80 多倍，内存使用更是只有传统方法的 0.3%。原因很简单：传统方法处理了所有 10 万条数据并创建了 2 个中间数组（filter 和 map 各一个），而 Iterator Helpers 找到 10 条就停了，完全不创建中间数组。</p>
<h4 data-id="heading-5">场景 2：嵌套数据扁平化</h4>
<p><strong>数据规模</strong>：10,000 个父项，每个包含 10 个子项（共 100,000 条子数据）</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统数组方法</span>
dataset
  .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">parent</span> =&gt;</span> parent.<span class="hljs-property">children</span>)
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> child.<span class="hljs-property">value</span> &gt; <span class="hljs-number">50</span>)
  .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>);

<span class="hljs-comment">// Iterator Helpers</span>
dataset
  .<span class="hljs-title function_">values</span>()
  .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">parent</span> =&gt;</span> parent.<span class="hljs-property">children</span>)
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> child.<span class="hljs-property">value</span> &gt; <span class="hljs-number">50</span>)
  .<span class="hljs-title function_">take</span>(<span class="hljs-number">20</span>)
  .<span class="hljs-title function_">toArray</span>();
</code></pre>
<p><strong>结果</strong>：</p>























<table><thead><tr><th>维度</th><th>传统数组方法</th><th>Iterator Helpers</th><th>性能提升</th></tr></thead><tbody><tr><td>时间</td><td>3.716ms</td><td>0.018ms</td><td><strong>99.53%</strong></td></tr><tr><td>内存</td><td>4.03 MB</td><td>0.01 MB</td><td><strong>99.73%</strong></td></tr></tbody></table>
<p><code>flatMap</code> 这种场景更明显，因为传统方法要先把所有嵌套数据（10 万条子数据）展平成一个大数组，再过滤，再切片，创建了 2 个中间数组。Iterator Helpers 直接在展平的过程中就能提前终止，内存使用几乎可以忽略不计。</p>
<h4 data-id="heading-6">场景 3：查找第一个匹配项（公平对决）</h4>
<p><strong>数据规模</strong>：1,000,000 条</p>
<p>这个场景需要特别说明。原来的测试用 <code>filter(...)[0]</code> 作为对照组，这是不公平的——<strong>实际开发中，大家都会直接用 <code>Array.find()</code></strong>，没人会傻到先 <code>filter</code> 遍历完整个数组再取第一个。</p>
<p>所以这里改成真正的公平对决：<code>Array.find()</code> vs <code>Iterator.find()</code>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Array.find()（原生数组方法）</span>
dataset.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === targetId);

<span class="hljs-comment">// Iterator.find()</span>
dataset.<span class="hljs-title function_">values</span>().<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === targetId);
</code></pre>
<p>我在不同位置测试了查找性能（头部、中部、尾部）：</p>
<p><strong>结果</strong>：</p>





























<table><thead><tr><th>目标位置</th><th>Array.find()</th><th>Iterator.find()</th><th>差异</th></tr></thead><tbody><tr><td>头部（第 100 个）</td><td>0.008ms</td><td>0.006ms</td><td>Iterator 快 22%</td></tr><tr><td>中部（第 500,000 个）</td><td>4.733ms</td><td>7.974ms</td><td><strong>Iterator 慢 68%</strong> ⚠️</td></tr><tr><td>尾部（第 999,900 个）</td><td>10.779ms</td><td>14.071ms</td><td><strong>Iterator 慢 31%</strong> ⚠️</td></tr></tbody></table>
<p><strong>关键发现</strong>：</p>
<ol>
<li><strong><code>Array.find()</code> 本身就是惰性的</strong>——它找到第一个匹配项就会停止，不需要 Iterator Helpers 来"拯救"</li>
<li><strong>Iterator 有额外开销</strong>：每次迭代需要创建 iterator 对象、调用 <code>.next()</code> 方法，这些开销在大规模遍历时会累积</li>
<li><strong>头部查找时 Iterator 略快</strong>：可能是因为数据量小，V8 的优化策略不同</li>
</ol>
<p><strong>MDN 文档验证</strong>：</p>
<p>根据 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Ffind" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find" ref="nofollow noopener noreferrer">MDN 官方文档</a>，<code>Array.find()</code> 确实具有<strong>短路求值（short-circuit）</strong> 的特性：</p>
<blockquote>
<p><code>find()</code> does not process the remaining elements of the array after the callbackFn returns a truthy value.</p>
</blockquote>
<p>也就是说，<code>Array.find()</code> 和 <code>Iterator.find()</code> 在"找到即停"这一点上是<strong>完全一样</strong>的。两者的区别仅在于：</p>
<ul>
<li><strong>Iterator.find()</strong> 需要先通过 <code>.values()</code> 将数组转换成迭代器，这会引入额外开销</li>
<li>对于<strong>链式调用</strong>（如 <code>filter().map().find()</code>），Iterator Helpers 可以避免创建中间数组，这时才有优势</li>
</ul>
<p><strong>结论</strong>：对于纯粹的"查找第一个"场景，直接用 <code>Array.find()</code> 就好，不要画蛇添足用 Iterator Helpers。</p>
<h4 data-id="heading-7">场景 4：复杂链式调用</h4>
<p><strong>数据规模</strong>：50,000 条</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统数组方法</span>
dataset
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ ...item, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">doubled</span> &gt; <span class="hljs-number">500</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">final</span>: item.<span class="hljs-property">doubled</span> + <span class="hljs-number">100</span> }))
  .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">15</span>);

<span class="hljs-comment">// Iterator Helpers</span>
dataset
  .<span class="hljs-title function_">values</span>()
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ ...item, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">doubled</span> &gt; <span class="hljs-number">500</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">final</span>: item.<span class="hljs-property">doubled</span> + <span class="hljs-number">100</span> }))
  .<span class="hljs-title function_">take</span>(<span class="hljs-number">15</span>)
  .<span class="hljs-title function_">toArray</span>();
</code></pre>
<p><strong>结果</strong>：</p>























<table><thead><tr><th>维度</th><th>传统数组方法</th><th>Iterator Helpers</th><th>性能提升</th></tr></thead><tbody><tr><td>时间</td><td>1.421ms</td><td>0.028ms</td><td><strong>98.02%</strong></td></tr><tr><td>内存</td><td>5.33 MB</td><td>0.01 MB</td><td><strong>99.75%</strong></td></tr></tbody></table>
<p>链式调用越多，传统方法创建的中间数组就越多。这个场景有 4 次操作（filter → map → filter → map），传统方法创建了 4 个中间数组，总共占用 5.33 MB 内存；而 Iterator Helpers 一个中间数组都没创建，内存使用几乎为零。</p>
<h3 data-id="heading-8">什么时候用 Iterator Helpers</h3>
<p>根据测试结果，我总结了几个适合用 Iterator Helpers 的场景：</p>
<h4 data-id="heading-9">1. 只需要前 N 项</h4>
<p>这是最明显的优势场景。无限滚动、分页加载、虚拟列表这些场景都适合。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 虚拟列表只渲染可见的 20 条</span>
<span class="hljs-keyword">const</span> visibleRows = allRows
  .<span class="hljs-title function_">values</span>()
  .<span class="hljs-title function_">filter</span>(isInViewport)
  .<span class="hljs-title function_">take</span>(<span class="hljs-number">20</span>)
  .<span class="hljs-title function_">toArray</span>();
</code></pre>
<h4 data-id="heading-10">2. 流式数据处理</h4>
<p>处理 API 分页、SSE 流、WebSocket 消息这些场景，Iterator Helpers 配合 async iterator 很好用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>* <span class="hljs-title function_">fetchPages</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> page = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/items?page=<span class="hljs-subst">${page++}</span>`</span>);
    <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">ok</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">yield</span>* <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
  }
}

<span class="hljs-comment">// 只拉取需要的数据，不会一次性加载所有分页</span>
<span class="hljs-keyword">const</span> firstTen = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchPages</span>()
  .<span class="hljs-title function_">filter</span>(isValid)
  .<span class="hljs-title function_">take</span>(<span class="hljs-number">10</span>)
  .<span class="hljs-title function_">toArray</span>();
</code></pre>
<h4 data-id="heading-11">3. 复杂的数据管道</h4>
<p>如果你的数据处理链路很长，有多次 <code>filter</code>、<code>map</code>、<code>flatMap</code>，用 Iterator Helpers 能避免创建一堆中间数组。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> result = data
  .<span class="hljs-title function_">values</span>()
  .<span class="hljs-title function_">filter</span>(step1)
  .<span class="hljs-title function_">map</span>(step2)
  .<span class="hljs-title function_">flatMap</span>(step3)
  .<span class="hljs-title function_">filter</span>(step4)
  .<span class="hljs-title function_">take</span>(<span class="hljs-number">100</span>)
  .<span class="hljs-title function_">toArray</span>();
</code></pre>
<h3 data-id="heading-12">什么时候不用</h3>
<p>Iterator Helpers 也不是万能的，这几种情况还是老老实实用数组：</p>
<h4 data-id="heading-13">1. 需要随机访问</h4>
<p>Iterator 是单向的，不能 <code>items[5]</code> 这样直接取某一项。如果你需要随机访问，还是得用数组。</p>
<h4 data-id="heading-14">2. 数据量很小</h4>
<p>如果就几十条数据，用 Iterator Helpers 反而增加了复杂度，传统数组方法更简单直接。</p>
<h4 data-id="heading-15">3. 需要多次遍历</h4>
<p>Iterator 只能遍历一次，如果你需要对同一份数据做多次不同的处理，还是先 <code>toArray()</code> 转成数组再说。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> iter = data.<span class="hljs-title function_">values</span>().<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x &gt; <span class="hljs-number">10</span>);

<span class="hljs-comment">// ❌ 第二次遍历会返回空，因为 iterator 已经消费完了</span>
<span class="hljs-keyword">const</span> first = iter.<span class="hljs-title function_">take</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">toArray</span>();
<span class="hljs-keyword">const</span> second = iter.<span class="hljs-title function_">take</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">toArray</span>(); <span class="hljs-comment">// []</span>

<span class="hljs-comment">// ✅ 先转数组，再多次使用</span>
<span class="hljs-keyword">const</span> filtered = data.<span class="hljs-title function_">values</span>().<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x &gt; <span class="hljs-number">10</span>).<span class="hljs-title function_">toArray</span>();
<span class="hljs-keyword">const</span> first = filtered.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>);
<span class="hljs-keyword">const</span> second = filtered.<span class="hljs-title function_">slice</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>);
</code></pre>
<h3 data-id="heading-16">兼容性</h3>
<p>Iterator Helpers 在现代浏览器和 Node.js 22+ 都已经支持了。如果你的项目还要兼容老版本，可以用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzloirock%2Fcore-js" target="_blank" title="https://github.com/zloirock/core-js" ref="nofollow noopener noreferrer">core-js</a> 这类 polyfill。</p>
<p>可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcaniuse.com%2Fiterator-helpers" target="_blank" title="https://caniuse.com/iterator-helpers" ref="nofollow noopener noreferrer">Can I Use</a> 查看详细的兼容性数据。</p>
<h3 data-id="heading-17">一些坑</h3>
<h4 data-id="heading-18">1. Iterator 不是数组</h4>
<p>这是最容易踩的坑。Iterator 没有 <code>length</code>、<code>[index]</code> 这些属性，也不能直接 <code>console.log</code> 看内容。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> iter = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">values</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(iter.<span class="hljs-property">length</span>);  <span class="hljs-comment">// undefined</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(iter[<span class="hljs-number">0</span>]);      <span class="hljs-comment">// undefined</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(iter);         <span class="hljs-comment">// Object [Array Iterator] {}</span>

<span class="hljs-comment">// 要看内容，得先转数组</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([...iter]);    <span class="hljs-comment">// [1, 2, 3]</span>
</code></pre>
<h4 data-id="heading-19">2. <code>reduce</code> 不是惰性的</h4>
<p>大部分 Iterator Helpers 都是惰性的，但 <code>reduce</code> 是个例外，它必须遍历所有数据才能得出结果。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// reduce 会立即消费整个 iterator</span>
<span class="hljs-keyword">const</span> sum = data.<span class="hljs-title function_">values</span>().<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, x</span>) =&gt;</span> acc + x, <span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-20">3. 调试不方便</h4>
<p>因为是惰性求值，你不能在中间步骤打断点看数据。如果要调试，可以在关键步骤插入 <code>toArray()</code> 转成数组再看。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> result = data
  .<span class="hljs-title function_">values</span>()
  .<span class="hljs-title function_">filter</span>(step1)
  .<span class="hljs-title function_">toArray</span>()  <span class="hljs-comment">// 调试用，看看 filter 后的结果</span>
  .<span class="hljs-title function_">values</span>()
  .<span class="hljs-title function_">map</span>(step2)
  .<span class="hljs-title function_">take</span>(<span class="hljs-number">10</span>)
  .<span class="hljs-title function_">toArray</span>();
</code></pre>
<h3 data-id="heading-21">总结</h3>
<p>Iterator Helpers 不是要替代数组，而是给了我们另一个选择。核心思路就一句话：<strong>如果你不需要整个数组，就别创建它</strong>。</p>
<p>从实测结果看：</p>
<ul>
<li><strong>filter/map + take(N) 链式调用</strong>：时间和空间开销都能降低 90%+，这是 Iterator Helpers 的杀手级场景</li>
<li><strong>单纯的 find 查找</strong>：<code>Array.find()</code> 本身就是惰性的，用 <code>Iterator.find()</code> 反而更慢（慢 30%-70%）</li>
<li>数据规模越大，Iterator Helpers 在链式调用场景的优势越明显</li>
<li><strong>内存优势尤其突出</strong>：传统方法创建的中间数组会占用大量内存，而 Iterator Helpers 几乎不占用额外内存</li>
</ul>
<p>我个人的使用建议是：</p>
<ol>
<li><strong>默认还是用数组方法</strong>，简单直接，不容易出错</li>
<li><strong>filter/map + slice 组合</strong>：如果你只需要前 N 项，这是 Iterator Helpers 大显身手的场景</li>
<li><strong>单纯的 find/findIndex</strong>：直接用 <code>Array.find()</code> / <code>Array.findIndex()</code>，不要用 Iterator</li>
<li><strong>写数据管道时</strong>，如果链路很长，用 Iterator Helpers 能让代码更清晰，也能避免不必要的内存分配</li>
<li><strong>内存敏感场景</strong>，比如处理大数据集、移动端应用等，Iterator Helpers 能显著降低内存压力</li>
</ol>
<h3 data-id="heading-22">完整测试代码</h3>
<p>下面是完整的性能测试代码，包含<strong>时间</strong>和<strong>空间</strong>两个维度的测试。你可以复制到本地跑一下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * Iterator Helpers vs Array Methods 性能对比测试
 * 
 * 测试维度：
 * 1. 时间开销（执行时间）
 * 2. 空间开销（内存使用）
 * 
 * 测试场景：
 * 1. 大数据集过滤 + 转换 + 取前 N 项
 * 2. 嵌套数据扁平化
 * 3. 查找第一个匹配项
 * 4. 复杂链式调用
 */</span>

<span class="hljs-comment">// ============ 工具函数 ============</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateLargeDataset</span>(<span class="hljs-params">size</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: size }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
    <span class="hljs-attr">id</span>: i,
    <span class="hljs-attr">value</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1000</span>,
    <span class="hljs-attr">category</span>: [<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'D'</span>][i % <span class="hljs-number">4</span>],
    <span class="hljs-attr">active</span>: i % <span class="hljs-number">3</span> === <span class="hljs-number">0</span>
  }));
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">benchmark</span>(<span class="hljs-params">name, fn, iterations = <span class="hljs-number">1</span></span>) {
  <span class="hljs-keyword">const</span> times = [];
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
    <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-title function_">fn</span>();
    <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
    times.<span class="hljs-title function_">push</span>(end - start);
  }
  
  <span class="hljs-keyword">const</span> avg = times.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / times.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> min = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...times);
  <span class="hljs-keyword">const</span> max = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...times);
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n<span class="hljs-subst">${name}</span>:`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  平均: <span class="hljs-subst">${avg.toFixed(<span class="hljs-number">3</span>)}</span>ms`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  最小: <span class="hljs-subst">${min.toFixed(<span class="hljs-number">3</span>)}</span>ms`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  最大: <span class="hljs-subst">${max.toFixed(<span class="hljs-number">3</span>)}</span>ms`</span>);
  
  <span class="hljs-keyword">return</span> avg;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">memoryBenchmark</span>(<span class="hljs-params">name, fn</span>) {
  <span class="hljs-comment">// 强制垃圾回收（需要 Node.js 启动时加 --expose-gc 参数）</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">global</span>.<span class="hljs-property">gc</span>) {
    <span class="hljs-variable language_">global</span>.<span class="hljs-title function_">gc</span>();
  }
  
  <span class="hljs-keyword">const</span> memBefore = process.<span class="hljs-title function_">memoryUsage</span>();
  <span class="hljs-title function_">fn</span>();
  <span class="hljs-keyword">const</span> memAfter = process.<span class="hljs-title function_">memoryUsage</span>();
  
  <span class="hljs-keyword">const</span> heapUsedDiff = (memAfter.<span class="hljs-property">heapUsed</span> - memBefore.<span class="hljs-property">heapUsed</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>;
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  内存增长: <span class="hljs-subst">${heapUsedDiff.toFixed(<span class="hljs-number">2</span>)}</span> MB`</span>);
  
  <span class="hljs-keyword">return</span> heapUsedDiff;
}

<span class="hljs-comment">// ============ 测试场景 1: 过滤 + 转换 + 取前 N 项 ============</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试场景 1: 大数据集过滤 + 转换 + 取前 10 项'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'数据规模: 100,000 条'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

<span class="hljs-keyword">const</span> dataset1 = <span class="hljs-title function_">generateLargeDataset</span>(<span class="hljs-number">100000</span>);

<span class="hljs-comment">// 传统数组方法 - 时间</span>
<span class="hljs-keyword">const</span> arrayMethodTime1 = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'传统数组方法 (filter + map + slice) - 时间'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset1
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
    .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);
  
  <span class="hljs-keyword">return</span> result;
}, <span class="hljs-number">10</span>);

<span class="hljs-comment">// 传统数组方法 - 内存</span>
<span class="hljs-keyword">const</span> arrayMethodMem1 = <span class="hljs-title function_">memoryBenchmark</span>(<span class="hljs-string">'传统数组方法 (filter + map + slice) - 内存'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset1
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
    .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);
  
  <span class="hljs-keyword">return</span> result;
});

<span class="hljs-comment">// Iterator Helpers - 时间</span>
<span class="hljs-keyword">const</span> iteratorHelpersTime1 = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'Iterator Helpers (filter + map + take) - 时间'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset1
    .<span class="hljs-title function_">values</span>()
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
    .<span class="hljs-title function_">take</span>(<span class="hljs-number">10</span>)
    .<span class="hljs-title function_">toArray</span>();
  
  <span class="hljs-keyword">return</span> result;
}, <span class="hljs-number">10</span>);

<span class="hljs-comment">// Iterator Helpers - 内存</span>
<span class="hljs-keyword">const</span> iteratorHelpersMem1 = <span class="hljs-title function_">memoryBenchmark</span>(<span class="hljs-string">'Iterator Helpers (filter + map + take) - 内存'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset1
    .<span class="hljs-title function_">values</span>()
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
    .<span class="hljs-title function_">take</span>(<span class="hljs-number">10</span>)
    .<span class="hljs-title function_">toArray</span>();
  
  <span class="hljs-keyword">return</span> result;
});

<span class="hljs-keyword">const</span> timeImprovement1 = ((arrayMethodTime1 - iteratorHelpersTime1) / arrayMethodTime1 * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
<span class="hljs-keyword">const</span> memImprovement1 = ((arrayMethodMem1 - iteratorHelpersMem1) / arrayMethodMem1 * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n性能提升: 时间 <span class="hljs-subst">${timeImprovement1}</span>%, 内存 <span class="hljs-subst">${memImprovement1}</span>%`</span>);

<span class="hljs-comment">// ============ 测试场景 2: 嵌套数据扁平化 ============</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试场景 2: 嵌套数据扁平化 + 过滤 + 取前 20 项'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'数据规模: 10,000 个父项，每个包含 10 个子项'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

<span class="hljs-keyword">const</span> dataset2 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
  <span class="hljs-attr">id</span>: i,
  <span class="hljs-attr">children</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10</span> }, <span class="hljs-function">(<span class="hljs-params">_, j</span>) =&gt;</span> ({
    <span class="hljs-attr">childId</span>: <span class="hljs-string">`<span class="hljs-subst">${i}</span>-<span class="hljs-subst">${j}</span>`</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>
  }))
}));

<span class="hljs-comment">// 传统数组方法 - 时间</span>
<span class="hljs-keyword">const</span> arrayMethodTime2 = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'传统数组方法 (flatMap + filter + slice) - 时间'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset2
    .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">parent</span> =&gt;</span> parent.<span class="hljs-property">children</span>)
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> child.<span class="hljs-property">value</span> &gt; <span class="hljs-number">50</span>)
    .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>);
  
  <span class="hljs-keyword">return</span> result;
}, <span class="hljs-number">10</span>);

<span class="hljs-comment">// 传统数组方法 - 内存</span>
<span class="hljs-keyword">const</span> arrayMethodMem2 = <span class="hljs-title function_">memoryBenchmark</span>(<span class="hljs-string">'传统数组方法 (flatMap + filter + slice) - 内存'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset2
    .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">parent</span> =&gt;</span> parent.<span class="hljs-property">children</span>)
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> child.<span class="hljs-property">value</span> &gt; <span class="hljs-number">50</span>)
    .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>);
  
  <span class="hljs-keyword">return</span> result;
});

<span class="hljs-comment">// Iterator Helpers - 时间</span>
<span class="hljs-keyword">const</span> iteratorHelpersTime2 = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'Iterator Helpers (flatMap + filter + take) - 时间'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset2
    .<span class="hljs-title function_">values</span>()
    .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">parent</span> =&gt;</span> parent.<span class="hljs-property">children</span>)
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> child.<span class="hljs-property">value</span> &gt; <span class="hljs-number">50</span>)
    .<span class="hljs-title function_">take</span>(<span class="hljs-number">20</span>)
    .<span class="hljs-title function_">toArray</span>();
  
  <span class="hljs-keyword">return</span> result;
}, <span class="hljs-number">10</span>);

<span class="hljs-comment">// Iterator Helpers - 内存</span>
<span class="hljs-keyword">const</span> iteratorHelpersMem2 = <span class="hljs-title function_">memoryBenchmark</span>(<span class="hljs-string">'Iterator Helpers (flatMap + filter + take) - 内存'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset2
    .<span class="hljs-title function_">values</span>()
    .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">parent</span> =&gt;</span> parent.<span class="hljs-property">children</span>)
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> child.<span class="hljs-property">value</span> &gt; <span class="hljs-number">50</span>)
    .<span class="hljs-title function_">take</span>(<span class="hljs-number">20</span>)
    .<span class="hljs-title function_">toArray</span>();
  
  <span class="hljs-keyword">return</span> result;
});

<span class="hljs-keyword">const</span> timeImprovement2 = ((arrayMethodTime2 - iteratorHelpersTime2) / arrayMethodTime2 * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
<span class="hljs-keyword">const</span> memImprovement2 = ((arrayMethodMem2 - iteratorHelpersMem2) / arrayMethodMem2 * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n性能提升: 时间 <span class="hljs-subst">${timeImprovement2}</span>%, 内存 <span class="hljs-subst">${memImprovement2}</span>%`</span>);

<span class="hljs-comment">// ============ 测试场景 3: 查找第一个匹配项（公平对决） ============</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试场景 3: 查找第一个匹配项（公平对决：Array.find vs Iterator.find）'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'数据规模: 1,000,000 条'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

<span class="hljs-keyword">const</span> dataset3 = <span class="hljs-title function_">generateLargeDataset</span>(<span class="hljs-number">1000000</span>);

<span class="hljs-comment">// 3a: 目标在头部</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n--- 3a: 目标在头部（第 100 个）---'</span>);
<span class="hljs-keyword">const</span> targetHead = <span class="hljs-number">100</span>;

<span class="hljs-keyword">const</span> arrayFindHead = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'Array.find() - 头部'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> dataset3.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === targetHead);
}, <span class="hljs-number">20</span>);

<span class="hljs-keyword">const</span> iteratorFindHead = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'Iterator.find() - 头部'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> dataset3.<span class="hljs-title function_">values</span>().<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === targetHead);
}, <span class="hljs-number">20</span>);

<span class="hljs-keyword">const</span> diffHead = ((iteratorFindHead - arrayFindHead) / arrayFindHead * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`差异: <span class="hljs-subst">${diffHead}</span>% <span class="hljs-subst">${diffHead &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'(Iterator 更慢)'</span> : <span class="hljs-string">'(Iterator 更快)'</span>}</span>`</span>);

<span class="hljs-comment">// 3b: 目标在中部</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n--- 3b: 目标在中部（第 500,000 个）---'</span>);
<span class="hljs-keyword">const</span> targetMiddle = <span class="hljs-number">500000</span>;

<span class="hljs-keyword">const</span> arrayFindMiddle = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'Array.find() - 中部'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> dataset3.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === targetMiddle);
}, <span class="hljs-number">20</span>);

<span class="hljs-keyword">const</span> iteratorFindMiddle = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'Iterator.find() - 中部'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> dataset3.<span class="hljs-title function_">values</span>().<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === targetMiddle);
}, <span class="hljs-number">20</span>);

<span class="hljs-keyword">const</span> diffMiddle = ((iteratorFindMiddle - arrayFindMiddle) / arrayFindMiddle * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`差异: <span class="hljs-subst">${diffMiddle}</span>% <span class="hljs-subst">${diffMiddle &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'(Iterator 更慢)'</span> : <span class="hljs-string">'(Iterator 更快)'</span>}</span>`</span>);

<span class="hljs-comment">// 3c: 目标在尾部</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n--- 3c: 目标在尾部（第 999,900 个）---'</span>);
<span class="hljs-keyword">const</span> targetTail = <span class="hljs-number">999900</span>;

<span class="hljs-keyword">const</span> arrayFindTail = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'Array.find() - 尾部'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> dataset3.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === targetTail);
}, <span class="hljs-number">20</span>);

<span class="hljs-keyword">const</span> iteratorFindTail = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'Iterator.find() - 尾部'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> dataset3.<span class="hljs-title function_">values</span>().<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === targetTail);
}, <span class="hljs-number">20</span>);

<span class="hljs-keyword">const</span> diffTail = ((iteratorFindTail - arrayFindTail) / arrayFindTail * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`差异: <span class="hljs-subst">${diffTail}</span>% <span class="hljs-subst">${diffTail &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'(Iterator 更慢)'</span> : <span class="hljs-string">'(Iterator 更快)'</span>}</span>`</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n结论：Array.find() 本身就是惰性的，Iterator.find() 在大多数情况下更慢'</span>);

<span class="hljs-comment">// ============ 测试场景 4: 多次链式调用 ============</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试场景 4: 复杂链式调用（filter + map + filter + map + take）'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'数据规模: 50,000 条'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

<span class="hljs-keyword">const</span> dataset4 = <span class="hljs-title function_">generateLargeDataset</span>(<span class="hljs-number">50000</span>);

<span class="hljs-comment">// 传统数组方法 - 时间</span>
<span class="hljs-keyword">const</span> arrayMethodTime4 = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'传统数组方法 (多次链式调用) - 时间'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset4
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ ...item, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">doubled</span> &gt; <span class="hljs-number">500</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">final</span>: item.<span class="hljs-property">doubled</span> + <span class="hljs-number">100</span> }))
    .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">15</span>);
  
  <span class="hljs-keyword">return</span> result;
}, <span class="hljs-number">10</span>);

<span class="hljs-comment">// 传统数组方法 - 内存</span>
<span class="hljs-keyword">const</span> arrayMethodMem4 = <span class="hljs-title function_">memoryBenchmark</span>(<span class="hljs-string">'传统数组方法 (多次链式调用) - 内存'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset4
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ ...item, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">doubled</span> &gt; <span class="hljs-number">500</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">final</span>: item.<span class="hljs-property">doubled</span> + <span class="hljs-number">100</span> }))
    .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">15</span>);
  
  <span class="hljs-keyword">return</span> result;
});

<span class="hljs-comment">// Iterator Helpers - 时间</span>
<span class="hljs-keyword">const</span> iteratorHelpersTime4 = <span class="hljs-title function_">benchmark</span>(<span class="hljs-string">'Iterator Helpers (多次链式调用) - 时间'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset4
    .<span class="hljs-title function_">values</span>()
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ ...item, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">doubled</span> &gt; <span class="hljs-number">500</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">final</span>: item.<span class="hljs-property">doubled</span> + <span class="hljs-number">100</span> }))
    .<span class="hljs-title function_">take</span>(<span class="hljs-number">15</span>)
    .<span class="hljs-title function_">toArray</span>();
  
  <span class="hljs-keyword">return</span> result;
}, <span class="hljs-number">10</span>);

<span class="hljs-comment">// Iterator Helpers - 内存</span>
<span class="hljs-keyword">const</span> iteratorHelpersMem4 = <span class="hljs-title function_">memoryBenchmark</span>(<span class="hljs-string">'Iterator Helpers (多次链式调用) - 内存'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> result = dataset4
    .<span class="hljs-title function_">values</span>()
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ ...item, <span class="hljs-attr">doubled</span>: item.<span class="hljs-property">value</span> * <span class="hljs-number">2</span> }))
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">doubled</span> &gt; <span class="hljs-number">500</span>)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, <span class="hljs-attr">final</span>: item.<span class="hljs-property">doubled</span> + <span class="hljs-number">100</span> }))
    .<span class="hljs-title function_">take</span>(<span class="hljs-number">15</span>)
    .<span class="hljs-title function_">toArray</span>();
  
  <span class="hljs-keyword">return</span> result;
});

<span class="hljs-keyword">const</span> timeImprovement4 = ((arrayMethodTime4 - iteratorHelpersTime4) / arrayMethodTime4 * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
<span class="hljs-keyword">const</span> memImprovement4 = ((arrayMethodMem4 - iteratorHelpersMem4) / arrayMethodMem4 * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n性能提升: 时间 <span class="hljs-subst">${timeImprovement4}</span>%, 内存 <span class="hljs-subst">${memImprovement4}</span>%`</span>);

<span class="hljs-comment">// ============ 总结 ============</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'总结'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`
场景 1 (过滤+转换+取前N项):
  时间提升: <span class="hljs-subst">${timeImprovement1}</span>%
  内存提升: <span class="hljs-subst">${memImprovement1}</span>%
  ✅ Iterator Helpers 完胜

场景 2 (嵌套数据扁平化):
  时间提升: <span class="hljs-subst">${timeImprovement2}</span>%
  内存提升: <span class="hljs-subst">${memImprovement2}</span>%
  ✅ Iterator Helpers 完胜

场景 3 (公平对决 Array.find vs Iterator.find):
  头部: Iterator <span class="hljs-subst">${diffHead &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'慢'</span> : <span class="hljs-string">'快'</span>}</span> <span class="hljs-subst">${<span class="hljs-built_in">Math</span>.abs(diffHead)}</span>%
  中部: Iterator <span class="hljs-subst">${diffMiddle &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'慢'</span> : <span class="hljs-string">'快'</span>}</span> <span class="hljs-subst">${<span class="hljs-built_in">Math</span>.abs(diffMiddle)}</span>%
  尾部: Iterator <span class="hljs-subst">${diffTail &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'慢'</span> : <span class="hljs-string">'快'</span>}</span> <span class="hljs-subst">${<span class="hljs-built_in">Math</span>.abs(diffTail)}</span>%
  ⚠️ Array.find() 本身就是惰性的，Iterator.find() 没有优势

场景 4 (复杂链式调用):
  时间提升: <span class="hljs-subst">${timeImprovement4}</span>%
  内存提升: <span class="hljs-subst">${memImprovement4}</span>%
  ✅ Iterator Helpers 完胜

核心结论:
- Iterator Helpers 的优势场景是 filter/map + take(N) 的链式调用
- 对于纯粹的 find，Array.find() 更快
- 不要为了用 Iterator 而用 Iterator，要根据具体场景选择
`</span>);
</code></pre>
<h3 data-id="heading-23">实际运行输出</h3>
<p>在我的环境（Node.js 22+）下，使用 <code>node --expose-gc iterator-helpers-benchmark.js</code> 运行上面的代码，得到以下结果：</p>
<pre><code class="hljs language-matlab" lang="matlab">============================================================
测试场景 <span class="hljs-number">1</span>: 大数据集过滤 + 转换 + 取前 <span class="hljs-number">10</span> 项
数据规模: <span class="hljs-number">100</span>,<span class="hljs-number">000</span> 条
============================================================

传统数组方法 (filter + map + slice) - 时间:
  平均: <span class="hljs-number">1.545</span>ms
  最小: <span class="hljs-number">0.920</span>ms
  最大: <span class="hljs-number">2.993</span>ms
  内存增长: <span class="hljs-number">3.38</span> MB

Iterator Helpers (filter + map + take) - 时间:
  平均: <span class="hljs-number">0.019</span>ms
  最小: <span class="hljs-number">0.003</span>ms
  最大: <span class="hljs-number">0.126</span>ms
  内存增长: <span class="hljs-number">0.01</span> MB

性能提升: 时间 <span class="hljs-number">98.77</span><span class="hljs-comment">%, 内存 99.75%</span>

============================================================
测试场景 <span class="hljs-number">2</span>: 嵌套数据扁平化 + 过滤 + 取前 <span class="hljs-number">20</span> 项
数据规模: <span class="hljs-number">10</span>,<span class="hljs-number">000</span> 个父项，每个包含 <span class="hljs-number">10</span> 个子项
============================================================

传统数组方法 (flatMap + filter + slice) - 时间:
  平均: <span class="hljs-number">3.716</span>ms
  最小: <span class="hljs-number">2.263</span>ms
  最大: <span class="hljs-number">8.936</span>ms
  内存增长: <span class="hljs-number">4.03</span> MB

Iterator Helpers (flatMap + filter + take) - 时间:
  平均: <span class="hljs-number">0.018</span>ms
  最小: <span class="hljs-number">0.004</span>ms
  最大: <span class="hljs-number">0.120</span>ms
  内存增长: <span class="hljs-number">0.01</span> MB

性能提升: 时间 <span class="hljs-number">99.53</span><span class="hljs-comment">%, 内存 99.73%</span>

============================================================
测试场景 <span class="hljs-number">3</span>: 查找第一个匹配项（公平对决：Array.<span class="hljs-built_in">find</span> vs Iterator.<span class="hljs-built_in">find</span>）
数据规模: <span class="hljs-number">1</span>,<span class="hljs-number">000</span>,<span class="hljs-number">000</span> 条
============================================================

--- <span class="hljs-number">3</span>a: 目标在头部（第 <span class="hljs-number">100</span> 个）---

Array.<span class="hljs-built_in">find</span>() - 头部:
  平均: <span class="hljs-number">0.008</span>ms
  最小: <span class="hljs-number">0.001</span>ms
  最大: <span class="hljs-number">0.116</span>ms

Iterator.<span class="hljs-built_in">find</span>() - 头部:
  平均: <span class="hljs-number">0.006</span>ms
  最小: <span class="hljs-number">0.002</span>ms
  最大: <span class="hljs-number">0.076</span>ms
差异: <span class="hljs-number">-22.22</span><span class="hljs-comment">% (Iterator 更快)</span>

--- <span class="hljs-number">3</span>b: 目标在中部（第 <span class="hljs-number">500</span>,<span class="hljs-number">000</span> 个）---

Array.<span class="hljs-built_in">find</span>() - 中部:
  平均: <span class="hljs-number">4.733</span>ms
  最小: <span class="hljs-number">3.506</span>ms
  最大: <span class="hljs-number">10.036</span>ms

Iterator.<span class="hljs-built_in">find</span>() - 中部:
  平均: <span class="hljs-number">7.974</span>ms
  最小: <span class="hljs-number">6.573</span>ms
  最大: <span class="hljs-number">12.761</span>ms
差异: <span class="hljs-number">68.48</span><span class="hljs-comment">% (Iterator 更慢)</span>

--- <span class="hljs-number">3</span>c: 目标在尾部（第 <span class="hljs-number">999</span>,<span class="hljs-number">900</span> 个）---

Array.<span class="hljs-built_in">find</span>() - 尾部:
  平均: <span class="hljs-number">10.779</span>ms
  最小: <span class="hljs-number">7.056</span>ms
  最大: <span class="hljs-number">41.051</span>ms

Iterator.<span class="hljs-built_in">find</span>() - 尾部:
  平均: <span class="hljs-number">14.071</span>ms
  最小: <span class="hljs-number">12.336</span>ms
  最大: <span class="hljs-number">17.287</span>ms
差异: <span class="hljs-number">30.55</span><span class="hljs-comment">% (Iterator 更慢)</span>

结论：Array.<span class="hljs-built_in">find</span>() 本身就是惰性的，Iterator.<span class="hljs-built_in">find</span>() 在大多数情况下更慢

============================================================
测试场景 <span class="hljs-number">4</span>: 复杂链式调用（filter + map + filter + map + take）
数据规模: <span class="hljs-number">50</span>,<span class="hljs-number">000</span> 条
============================================================

传统数组方法 (多次链式调用) - 时间:
  平均: <span class="hljs-number">1.693</span>ms
  最小: <span class="hljs-number">1.062</span>ms
  最大: <span class="hljs-number">4.038</span>ms
  内存增长: <span class="hljs-number">5.32</span> MB

Iterator Helpers (多次链式调用) - 时间:
  平均: <span class="hljs-number">0.019</span>ms
  最小: <span class="hljs-number">0.003</span>ms
  最大: <span class="hljs-number">0.143</span>ms
  内存增长: <span class="hljs-number">0.02</span> MB

性能提升: 时间 <span class="hljs-number">98.87</span><span class="hljs-comment">%, 内存 99.64%</span>

============================================================
总结
============================================================

场景 <span class="hljs-number">1</span> (过滤+转换+取前N项):
  时间提升: <span class="hljs-number">99.55</span><span class="hljs-comment">%</span>
  内存提升: <span class="hljs-number">99.75</span><span class="hljs-comment">%</span>
  ✅ Iterator Helpers 完胜

场景 <span class="hljs-number">2</span> (嵌套数据扁平化):
  时间提升: <span class="hljs-number">99.61</span><span class="hljs-comment">%</span>
  内存提升: <span class="hljs-number">99.69</span><span class="hljs-comment">%</span>
  ✅ Iterator Helpers 完胜

场景 <span class="hljs-number">3</span> (公平对决 Array.<span class="hljs-built_in">find</span> vs Iterator.<span class="hljs-built_in">find</span>):
  头部: Iterator 快 <span class="hljs-number">22.22</span><span class="hljs-comment">%</span>
  中部: Iterator 慢 <span class="hljs-number">68.48</span><span class="hljs-comment">%</span>
  尾部: Iterator 慢 <span class="hljs-number">30.55</span><span class="hljs-comment">%</span>
  ⚠️ Array.<span class="hljs-built_in">find</span>() 本身就是惰性的，Iterator.<span class="hljs-built_in">find</span>() 没有优势

场景 <span class="hljs-number">4</span> (复杂链式调用):
  时间提升: <span class="hljs-number">98.87</span><span class="hljs-comment">%</span>
  内存提升: <span class="hljs-number">99.64</span><span class="hljs-comment">%</span>
  ✅ Iterator Helpers 完胜

核心结论:
- Iterator Helpers 的优势场景是 filter/map + take(N) 的链式调用
- 对于纯粹的 <span class="hljs-built_in">find</span>，Array.<span class="hljs-built_in">find</span>() 更快（因为它本身就是惰性的）
- 不要为了用 Iterator 而用 Iterator，要根据具体场景选择
</code></pre>
<p>从输出可以看到：</p>
<p><strong>场景 1-2、4（filter/map + take 链式调用）</strong>：</p>
<ul>
<li>时间提升：98%+</li>
<li>内存提升：99%+</li>
<li>Iterator Helpers 在时间和空间上都有压倒性优势</li>
</ul>
<p><strong>场景 3（Array.find vs Iterator.find 公平对决）</strong>：</p>
<ul>
<li><strong>头部查找</strong>：Iterator 略快 22%（可能是 V8 优化策略不同）</li>
<li><strong>中部查找</strong>：Iterator 慢 68%</li>
<li><strong>尾部查找</strong>：Iterator 慢 31%</li>
<li><strong>结论</strong>：<code>Array.find()</code> 本身就是惰性的，不需要 Iterator Helpers 来"拯救"</li>
</ul>
<p><strong>关键发现</strong>：</p>
<ol>
<li><strong>内存优势极其明显</strong>：在链式调用场景下，Iterator Helpers 的内存使用只有传统方法的 0.3%</li>
<li><strong>中间数组是大头</strong>：场景 4 创建了 4 个中间数组，占用 5.32 MB；Iterator Helpers 几乎为零</li>
<li><strong>不是所有场景都适用</strong>：单纯的 <code>find</code> 场景，直接用 <code>Array.find()</code> 更好</li>
</ol>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>qwen/gemini/claude - cli 原理学习网站</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcoding-cli-guide" target="_blank" title="https://github.com/tt-a1i/coding-cli-guide" ref="nofollow noopener noreferrer">coding-cli-guide</a>（<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt-a1i.github.io%2Fcoding-cli-guide%2F%3Ftab%3Dstart-here" target="_blank" title="https://tt-a1i.github.io/coding-cli-guide/?tab=start-here" ref="nofollow noopener noreferrer">学习网站</a>）- 学习 qwen-cli 时整理的笔记，40+ 交互式动画演示 AI CLI 内部机制</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08e50020ab1f45428cd22e53af91a555~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479039&amp;x-signature=mLeMahTfJtVbg%2BqASvqt0jD2yrY%3D" alt="coding-cli-guide" loading="lazy"/></p>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul>
<p><strong>VS Code 插件</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fvscode-ai-commit" target="_blank" title="https://github.com/tt-a1i/vscode-ai-commit" ref="nofollow noopener noreferrer">vscode-ai-commit</a> - 一键生成 commit message，支持 Conventional Commits，兼容任何 OpenAI 格式接口</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TINYINT(1) 类型的字段，明明数据存的是 2，为什么查出来是 true]]></title>    <link>https://juejin.cn/post/7596187471774220297</link>    <guid>https://juejin.cn/post/7596187471774220297</guid>    <pubDate>2026-01-19T00:52:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596187471774220297" data-draft-id="7596092713080160292" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TINYINT(1) 类型的字段，明明数据存的是 2，为什么查出来是 true"/> <meta itemprop="keywords" content="Java,后端"/> <meta itemprop="datePublished" content="2026-01-19T00:52:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="青石路"/> <meta itemprop="url" content="https://juejin.cn/user/1999357021005580"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TINYINT(1) 类型的字段，明明数据存的是 2，为什么查出来是 true
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1999357021005580/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    青石路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:52:58.000Z" title="Mon Jan 19 2026 00:52:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    50
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">开心一刻</h2>
<p>大学期间，跟初恋谈了一段刻骨铭心的恋情，因为某些原因，大学毕业后分手了。<br/>
如今大学毕业已经10年，听说她很早就出国了，而我，很早就成的哥了。<br/>
昨天，初恋坐上了我的的车，我一眼就认出了她，她亦如当初模样，而我却满脸沧桑。<br/>
我不敢打招呼，默默的听着她打电话，讲述着国外的种种。<br/>
快到目的地的时候，她放下了电话说：我已经把我这10年的经历都说给你听了，你连句你好都不说吗<br/>
我知道电话那头没有任何人，她是故意说给我听的，我哽咽着颤抖的说到：你好<br/>
她深情的看着我，问道：我们还回得去吗<br/>
我疑惑的望向她，说到：回去？回去可以啊，但得加钱......</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b623cc4f4d84f06a933e9f6a4b78e51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=QDn%2FNDFzanzGJB7jmUEx2reWp5Q%3D" loading="lazy"/></div>
<h2 data-id="heading-1">TINYINT</h2>
<p>关于 <code>TINYINT</code>，我相信大家都知道它，是数据库的一种数据类型，说的详细点，它是数据库的一种数字类型，再详细点，它是数据库的一种整数类型；需要注意的是，它并非 SQL 标准整数类型</p>
<blockquote>
<p>SQL标准整数类型：INTEGER<code>(or</code>INT<code>) and </code>SMALLINT</p>
</blockquote>
<p>而是某些数据库的拓展整数类型，所以并非所有的关系型数据库都支持 TINYINT，支持的数据库类型包括 <code>MySQL</code>、<code>MariaDB</code>、<code>SQL Server</code>；我们基于 <code>MySQL</code> 来看看 TINYINT</p>
<p>MySQL 官方对<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F8.0%2Fen%2Finteger-types.html" target="_blank" title="https://dev.mysql.com/doc/refman/8.0/en/integer-types.html" ref="nofollow noopener noreferrer">整数类型</a>有如下介绍</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7954ef6c82c34d06ae98f0a59164fe8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=q9i8Z2QQRplZO6aryTOy%2FlOjkXE%3D" alt="整数类型" loading="lazy"/></div>
<p>除了 <code>TINYINT</code>，MySQL 还拓展出了 <code>MEDIUMINT</code> 和 <code>BIGINT</code>，这些都不是 SQL 标准整数类型，在做不同库数据迁移的时候需要考虑这些点</p>
<blockquote>
<p>标准 SQL，便于迁移；做表设计的时候，尽量用 SQL 标准数据类型</p>
</blockquote>
<p>TINYINT 存储空间占 <strong>1</strong> 字节，有符号的值范围是 -128 到 127，无符号的值范围是 0 到 255</p>
<p>TINYINT 的基本介绍已经完成，下面开始实操环节，开始之前我先问你们一个问题</p>
<blockquote>
<p>在实际项目中，你们一般用 TINYINT 存什么 ？</p>
</blockquote>
<p>是不是用来存枚举值？例如这样</p>
<pre><code class="hljs language-sql" lang="sql">`exec_status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'执行-状态，0：等待中，1：执行中，2：成功，3：失败，4：终止'</span>
</code></pre>
<p>甚至在枚举值少的时候，会使用 <code>TINYINT(1)</code>，对不对？重点来了</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e5348d482b9469ba64914a1c843bfe6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=EeGdoKagbHqJnHAwcGIzTb46u0s%3D" alt="640 (8)" loading="lazy"/></div>
<p>TINYINT(1) 中的 <code>1</code> 表示什么？很多小伙伴会理所当然的回答道：<strong>数值范围</strong>，TINYINT(1) 表示的是数值范围是 -9 到 9，或者 0 ~ 9</p>
<p>对不对呢？我们验证下就知道了。基于 MySQL 8.0.31，我们创建表</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tbl_qsl_job` (
  `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'主键'</span>,
  `exec_status` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'执行-状态，0：等待中，1：执行中，2：成功，3：失败，4：终止'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB;
</code></pre>
<p>插入一条记录</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tbl_qsl_job(id, exec_status) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-number">12</span>);
</code></pre>
<p>结果会怎么样，超出范围报错？</p>
<p>实际是插入成功</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d652228759de4797a72222631883d3f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=cjYW02rJt7QiAqQu%2FQPdp1jGI2U%3D" alt="tinyint1_插入12成功" loading="lazy"/></div>
<p>道心是不是碎了一地？</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/026b9f61ec744a0e91584559c5464fb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=4epTKB71cKeeyXpb7DZ9CivnXXg%3D" alt="掀桌子" loading="lazy"/></div>
<p>给你们 10 秒钟，收拾下破碎的道心；收拾好了之后我们一起看看官方说明：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fnumeric-type-attributes.html" target="_blank" title="https://dev.mysql.com/doc/refman/5.7/en/numeric-type-attributes.html" ref="nofollow noopener noreferrer">Numeric Type Attributes</a></p>
<blockquote>
<p>MySQL supports an extension for optionally specifying the display width of integer data types in parentheses following the base keyword for the type. For example, <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Finteger-types.html" target="_blank" title="https://dev.mysql.com/doc/refman/5.7/en/integer-types.html" ref="nofollow noopener noreferrer"><code>INT(4)</code></a> specifies an <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Finteger-types.html" target="_blank" title="https://dev.mysql.com/doc/refman/5.7/en/integer-types.html" ref="nofollow noopener noreferrer"><code>INT</code></a> with a display width of four digits. This optional display width may be used by applications to display integer values having a width less than the width specified for the column by left-padding them with spaces. (That is, this width is present in the metadata returned with result sets. Whether it is used is up to the application.)</p>
<p>The display width does <em>not</em> constrain the range of values that can be stored in the column. Nor does it prevent values wider than the column display width from being displayed correctly. For example, a column specified as <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Finteger-types.html" target="_blank" title="https://dev.mysql.com/doc/refman/5.7/en/integer-types.html" ref="nofollow noopener noreferrer"><code>SMALLINT(3)</code></a> has the usual <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Finteger-types.html" target="_blank" title="https://dev.mysql.com/doc/refman/5.7/en/integer-types.html" ref="nofollow noopener noreferrer"><code>SMALLINT</code></a> range of <code>-32768</code> to <code>32767</code>, and values outside the range permitted by three digits are displayed in full using more than three digits.</p>
</blockquote>
<p>相信你们都能看懂，INT(n) 中的 n 表示的是显示宽度，INT(4) 表示的是显示宽度为四位数的 INT。应用程序可以采用左填充空格的方式来填充宽度不够列指定宽度的整数值（也就是说，此宽度会作为结果集的元数据返回，是否使用取决于应用程序）</p>
<p>显示宽度不会限制列存储的数值范围，也不会截断比列显示宽度更宽的值。例如，SMALLINT(3) 类型的列的存数范围与 SMALLINT 一样，也是 -32768 到 32767，超出三位数的值会完整显示</p>
<p>关于整数类型显示宽度，我们可以进行如下总结</p>
<blockquote>
<p>类型后面的 n，是显示宽度，表示显示时最少占 n 个字符宽度，既不会限制列存储的数值范围，也不会截断比列显示宽度更宽的值，</p>
<p>显示宽度会作为结果集的元数据返回，是否使用取决于应用程序（这个伏笔，后面会呼应，值得我们留意）</p>
</blockquote>
<h2 data-id="heading-2">2 变 true</h2>
<p>我们把 tbl_qsl_job 中 id = 1 的记录的状态改成 2（因为没有枚举值 12）</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> tbl_qsl_job <span class="hljs-keyword">SET</span> exec_status <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p>基于 <code>SpringBoot 2.7.18</code>、<code>spring-jdbc 5.3.31 </code>、<code>HikariCP 4.0.3</code>、<code>mysql-connector-java 8.0.25 </code> 构建查询</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.qsl;

<span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;
<span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span class="hljs-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;
<span class="hljs-keyword">import</span> org.springframework.jdbc.support.rowset.SqlRowSet;
<span class="hljs-keyword">import</span> org.springframework.jdbc.support.rowset.SqlRowSetMetaData;

<span class="hljs-keyword">import</span> javax.annotation.Resource;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span> youzb
 */</span>
<span class="hljs-meta">@SpringBootTest(classes = Application.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QslJobTest</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getByJdbcTemplate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">SqlRowSet</span> <span class="hljs-variable">sqlRowSet</span> <span class="hljs-operator">=</span> jdbcTemplate.queryForRowSet(<span class="hljs-string">"SELECT * FROM tbl_qsl_job WHERE id = 1"</span>);
        <span class="hljs-type">SqlRowSetMetaData</span> <span class="hljs-variable">metaData</span> <span class="hljs-operator">=</span> sqlRowSet.getMetaData();
        <span class="hljs-keyword">while</span> (sqlRowSet.next()) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= metaData.getColumnCount(); i++) {
                System.out.print(sqlRowSet.getObject(i) + <span class="hljs-string">" "</span>);
            }
            System.out.println();
        }
    }
}
</code></pre>
<p>你们觉得执行结果是怎样的，是不是 <code>1 2</code> 呢</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/946a8759e5fc4be6a56131afd931d3f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=g9ovozhLhofoiRERGd8fdTI7IRE%3D" alt="2变true" loading="lazy"/></div>
<p>可以看到，结果并不是 <code>1 2</code>，而是 <code>1 true</code>，是不是有点懵？</p>
<blockquote>
<p>明明数据存的是 2，为什么查出来结果是 true？</p>
</blockquote>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70cd22fda54948c89c700fe93addacbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=%2BFKK4Kx1xzTdyL2gq%2F%2BZo7ZogiY%3D" alt="懵" width="200px" loading="lazy"/></div>
<p>首先我们可以确定的是，数据库存储的值是没问题的，因为通过 <code>navicat</code> 查到的结果是 2（也说明 navicat 没有对这个值做特殊转换）</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b373c48e9e5d477993a6a98078bfd186~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=CbsDu47h8Ptwj5m59ajtojQAq%2B4%3D" alt="数据库中值是2" loading="lazy"/></div>
<p>回到我们的程序，数据库中的 2 到程序控制台的 true，经过了那些环节，我们是不是能整理出来？</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f92629d4a794f4b8f328c7d40019476~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=kye7YENjIQLBfUIDTHW5ts%2BIZ4I%3D" alt="数据流转" loading="lazy"/></div>
<p>数据库我们已经确定没问题了，至于是 <code>mysql-connector-java 8.0.25</code>、<code>HikariCP 4.0.3</code>、<code>spring-jdbc 5.3.31</code> 谁做了特殊处理，需要我们进一步排查了；最直接的方式就是 <code>Debug</code> 嘛，断点我已经替你们打好</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a86e8c1ae47d487bb0281e08ee6dcbb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=N%2BMS44D%2FuBYEsNObyRTDSM1%2FjSo%3D" alt="断点debug" loading="lazy"/></div>
<p>此时到了 MySQL JDBC 驱动里面，我们来看一下 <code>this.results</code> 的信息，有几个点值得我们重点关注下</p>
<ol>
<li>
<p>连接元信息</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42179fa302f141a68d4b2483ea0ac2f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=GI%2Bj5JawiVgAWI5bQEB0JnQlXkg%3D" alt="连接元信息" loading="lazy"/></div>
<p>我们配置的连接 url 是</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/fnj_test?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span>
</code></pre>
<p>并未设置 <code>tinyint1isBit</code> 值，所以其值 true 是 <code>mysql-connector-java 8.0.25</code> 给的默认值</p>
</li>
<li>
<p>列元信息</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78e230e1eedc4820b837b2f42f976798~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=ZWbYE2IzhO4DIyOsqHM1fqCjpEg%3D" alt="列元信息" loading="lazy"/></div>
<p>可以看到，字段 exec_status 的 length = 1，这个 length 表示什么呢，因为列 exec_status 的类型是整数类型，所以这个 length 是不是就是 <code>显示宽度</code> ？不然还能代表什么？</p>
<p>最重要的来了，<code>mysqlType</code> 的 <code>name</code> 是 <code>BIT</code></p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f47f3d55e3cb49db976b36f255c884ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=T9uqKlLsIJkcoPQczZydUPsayuo%3D" alt="mysqltype_bit" loading="lazy"/></div>
<p>也就是说，mysql-connector-java 8.0.25 把 TINYINT(1) 解析成了 MysqlType.BIT，对应的 JAVA 类型就是 <code>Boolean</code></p>
</li>
</ol>
<p>既然 exec_status 的 JAVA 类型被解析成了 Boolean，其值 2 也就被解析成 true 了，所以标题的答案是不是就清楚了</p>
<blockquote>
<p>mysql-connector-java 8.0.25 默认情况下，把 TINYINT(1) 解析成 JAVA 的 Boolean</p>
</blockquote>
<p>问题又来了，mysql-connector-java 8.0.25 对 TINYINT 的解析逻辑是怎样的呢？我们跟下源码就知道了</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe5505a036f14cb5b0dd03e4b41e26e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=20OiEo0WmYoazZUEVVxtNzlKLq4%3D" alt="mysqlType赋值逻辑" loading="lazy"/></div>
<p>我们先定位到 <code>com.mysql.cj.protocol.a.ColumnDefinitionReader</code> 的 180 行，然后往上找到 <code>mysqlType</code> 赋值的地方（ColumnDefinitionReade 134 行）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MysqlType</span> <span class="hljs-variable">mysqlType</span> <span class="hljs-operator">=</span> NativeProtocol.findMysqlType(<span class="hljs-built_in">this</span>.protocol.getPropertySet(), colType, colFlag, colLength, tableName, originalTableName,
                collationIndex, encoding);
</code></pre>
<p>跟进 NativeProtocol.findMysqlType，我们能看到这样一段代码</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cb7a5a55af446ed838c0ca17642f3ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=As6BklKhZjKOE92eYlxsnhdVRZ4%3D" alt="tinyint赋值逻辑" loading="lazy"/></div>
<p>第一个 if，我们分几部分解析下</p>
<ol>
<li>
<p>isUnsigned</p>
<p>表示是否无符号，建表的时候，exec_status 并未明确指定 <code>UNSIGNED</code>，所以是有符号的，那么 isUnsigned 值是 false，取反则是 true</p>
</li>
<li>
<p>length</p>
<p>表字段的显示宽度，也就是 TINYINT(1) 中的 1，所以 length == 1 的结果是 true</p>
</li>
<li>
<p>tinyInt1isBit</p>
<p>mysql-connector-java 8.0.25 的 <code>PropertyDefinitions</code> 会静态初始化很多属性默认值，其中就包括 tinyInt1isBit</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/706dc20a707e48a3ad5cf1bd835f2dc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=DwCNVumm7SWfOudK9%2BiYHRxfvfk%3D" alt="tinyInt1isBit默认值" loading="lazy"/></div>
<p>tinyInt1isBit 的默认值是 true</p>
<p>如果我们在数据库连接 url 中增加 <code>tinyInt1isBit=false</code></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/fnj_test?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC&amp;tinyInt1isBit=false</span>
</code></pre>
<p>那么配置值会覆盖默认值</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a6fa1f5a3ca43f6ad822597a48f5987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=jsTIbffCe%2B8%2FCT2Hnwi1moGg2%2FM%3D" alt="tinyInt1isBit值覆盖" loading="lazy"/></div>
<pre><code class="hljs language-java" lang="java">setValueInternal(extractedValue, exceptionInterceptor);
<span class="hljs-built_in">this</span>.initialValue = <span class="hljs-built_in">this</span>.value;
</code></pre>
<p>这两行会分别将 <code>value</code> 和 <code>initialValue</code> 设置成 <code>false</code></p>
<p>回到 url 未配置 tinyInt1isBit 的情况，tinyInt1isBit 的值是默认值 true</p>
</li>
<li>
<p>内嵌 if 的 transformedBitIsBoolean</p>
<p>在分析 tinyInt1isBit 默认值的时候，也红框框住过 transformedBitIsBoolean 的默认值，是 false；没注意的小伙伴，可以往上翻一翻</p>
</li>
</ol>
<p>所以 NativeProtocol.findMysqlType 的返回值是 <code>MysqlType.BIT</code>。如果 length &gt; 1，那么返回的则是 <code>MysqlType.TINYINT_UNSIGNED</code> 或 <code>MysqlType.TINYINT</code></p>
<p>自此，来龙去脉是不是清楚呢？</p>
<h2 data-id="heading-3">问题处理</h2>
<p>既然已经找到问题原因，那么处理方式也就清晰了，有如下几种</p>
<ol>
<li>
<p>url 中配置 tinyInt1isBit=false</p>
<p>这个会全局生效，有些需要将 TINYINT(1) 映射成 Boolean 的情况，会出问题</p>
<p>老项目不推荐增加该配置，除非确定整个项目中没有 TINYINT(1) 映射成 Boolean 的情况</p>
<p>新项目的话，可以增加该配置</p>
</li>
<li>
<p>字段类型调整成无符号</p>
<p>增加 <code>UNSIGNED</code> 修饰，例如</p>
<pre><code class="hljs language-sql" lang="sql">`exec_status` tinyint(<span class="hljs-number">1</span>) unsigned <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'执行-状态，0：等待中，1：执行中，2：成功，3：失败，4：终止'</span>,
</code></pre>
<p>但有个前提，枚举值不能出现负数</p>
</li>
<li>
<p>调大字段类型显示宽度</p>
<p>直接使用 TINYINT(4) 或 TINYINT</p>
</li>
</ol>
<h2 data-id="heading-4">举一反三</h2>
<p>既然是 mysql-connector-java 8.0.25 做了默认值的处理，那么 MyBatis-Plus 查的结果是不是也是将 2 处理成 true 呢？我们试一下就知道了，引入 MyBatis-Plus 3.5.7，测试代码很简单</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@TableName("tbl_qsl_job")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QslJob</span> {

    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> Integer execStatus;

    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Integer id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getExecStatus</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> execStatus;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setExecStatus</span><span class="hljs-params">(Integer execStatus)</span> {
        <span class="hljs-built_in">this</span>.execStatus = execStatus;
    }
}

	<span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> QslJobDao qslJobDao;
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMybatisPlus</span><span class="hljs-params">()</span> {
        <span class="hljs-type">QslJob</span> <span class="hljs-variable">qslJob</span> <span class="hljs-operator">=</span> qslJobDao.selectById(<span class="hljs-number">1</span>);
        System.out.println(qslJob.getId() + <span class="hljs-string">" "</span> + qslJob.getExecStatus());
    }
</code></pre>
<p>你们觉得执行结果是怎样的，报错？输出 1 true？还是输出 1 2？执行下就知道了</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2af4871715734a13a836d862c57ce248~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=9c210YipDkrI7Qchi8Yv9ABPQuw%3D" alt="tinyint(1)_mybatis-plus" loading="lazy"/></div>
<p>查询结果正常！</p>
<p>按前面的分析，mysql-connector-java 8.0.25 返回 exec_status 的值是 true，Boolean 强转 Integer 会报错，即使不报错，结果也应该是 1（0 = false，1 = true）嘛，怎么会是 2 呢？</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/729d178a304744fea5fadfc5a276d02b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=cvgpEEJIR7iylo21dzswhLGTIKg%3D" alt="好难 不该学编程的" loading="lazy"/></div>
<p>Debug 下你们就明白了</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6629435ca50b43d5836c5c62eb2e42a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=0Y%2B6qMxeRt2X%2BlF%2FBuDpkaoepIk%3D" alt="mybatis_getInt" loading="lazy"/></div>
<p>Mybatis 需要将 mysql-connector-java 8.0.25 查到的 ResultSet 映射成 QslJob，就需要用到类型处理器；QslJob 实体的 execStatus 是 Integer 类型的，那肯定用 IntegerTypeHandler 进行处理嘛，自然而然就用到 <code>rs.getInt</code> ，查到的结果自然就是 2 了。</p>
<p>我们再回过头去看 <code>SqlRowSet</code>，如果我们用 sqlRowSet.getInt 替换 sqlRowSet.getObject，是不是就行了？</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getByJdbcTemplate</span><span class="hljs-params">()</span> {
    <span class="hljs-type">SqlRowSet</span> <span class="hljs-variable">sqlRowSet</span> <span class="hljs-operator">=</span> jdbcTemplate.queryForRowSet(<span class="hljs-string">"SELECT * FROM tbl_qsl_job WHERE id = 1"</span>);
    <span class="hljs-type">SqlRowSetMetaData</span> <span class="hljs-variable">metaData</span> <span class="hljs-operator">=</span> sqlRowSet.getMetaData();
    <span class="hljs-keyword">while</span> (sqlRowSet.next()) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= metaData.getColumnCount(); i++) {
            System.out.print(sqlRowSet.getInt(i) + <span class="hljs-string">" "</span>);
        }
        System.out.println();
    }
}
</code></pre>
<p>运行下，我们会发现报错了</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a9d4eaad5a6416ea89ae9355bc0084b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=dxSdeAY1aZmFWgCop53BS%2BW%2BBEo%3D" alt="getInt报" loading="lazy"/></div>
<p>这又是为什么？</p>
<p>原因在 JdbcTemplate 的数据提取</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fb16964702240f2897f01f5cd114d50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=sTjdZ871MuLbS84H4DP%2BVAlNjfY%3D" alt="extractData" loading="lazy"/></div>
<p>我们对 rs 进行一下 Evaluate，结果如下</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e558d0b785cd43289f037d0761f0f85e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=oXSaEEFkz0Pq4w1WJOLGC2cmhVk%3D" alt="rs_evaluate" loading="lazy"/></div>
<p>此时 rs.getInt 能正常获取到 2，这说明什么？</p>
<blockquote>
<p>mysql-connector-java 8.0.25 虽然把 TINYINT(1) 映射成了 JAVA 的 Boolean，但其查到的 ResultSet 中的数据仍是与数据库中数据一致的原始数据</p>
<p>HikariCP 4.0.3 也并未对原始数据做转换处理</p>
</blockquote>
<p>我们继续跟进 rse.extractData(rs)，跟进两层会来到关键点</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d32fbbb5cec040128fac0d0839d4eeb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=ZcBeNsJdzVxqqJ7269KEEu6JsPQ%3D" alt="cachedRowSet" loading="lazy"/></div>
<p>rowSet.populate(rs) 会把 ResultSet rs 中的数据填充到 CachedRowSetImpl 的 <code>rvh</code> 中</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abe57a4fd36e41b9b0a9f1aef44420e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=HRCUOcMlXhIdLEx%2FGXkiNLIsQVc%3D" alt="rhv" loading="lazy"/></div>
<p>我们接着跟进 sqlRowSet.getInt(i)，答案即将揭晓</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9ebac53972743d488dffac760c88a7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=aoS1hPdXWHcI%2Bq1BYgHfntVVoC0%3D" alt="getInt_error" loading="lazy"/></div>
<p>红框框住是不是就会抛异常了？我们继续跟进 this.getCurrentRow，会看到我们刚刚讲到的 <code>rvh</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> BaseRow <span class="hljs-title function_">getCurrentRow</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> (BaseRow)(<span class="hljs-built_in">this</span>.onInsertRow ? <span class="hljs-built_in">this</span>.insertRow : (BaseRow)((BaseRow)<span class="hljs-built_in">this</span>.rvh.get(<span class="hljs-built_in">this</span>.cursorPos - <span class="hljs-number">1</span>)));
}
</code></pre>
<p>是不是就呼应上了？这里有两个呼应</p>
<ol>
<li>
<p>显示宽度</p>
<p>前面已经讲到，显示宽度会作为结果集的元数据返回，是否使用取决于应用程序</p>
<p>spring-jdbc 的 SqlRowSetResultSetExtractor#createSqlRowSet 方法用到了 CachedRowSetImpl#populate，在进行数据填充的过程中，会调用</p>
 <div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5e48ef4c7e6428691ca4490e2c2cc2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=I6jf5uuT4GFjRs9SPathozPPOsg%3D" alt="调用myql驱动的getObject" loading="lazy"/></div>
<p>mysql-connector-java 8.0.25 的 ResultSetImpl#getObject(int) 方法</p>
 <div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed750438659f419cb72eaa354ce67b1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769476761&amp;x-signature=yJzBLUi5se4t1cN6jVIY4iuESec%3D" alt="BIT处理" loading="lazy"/></div>
<p>是不是相当于用到了显示宽度？</p>
</li>
<li>
<p>rvh</p>
<p>CachedRowSetImpl#populate 方法，将数据填充到了 Vector rvh 中</p><p/>
<p>而我们写的代码 sqlRowSet.getInt(i) 是从这个 rvh 中获取的</p>


<p>所以，归根结底是 <strong>spring-jdbc 将 ResultSet 处理成 CachedRowSetImpl 的机制，我们没有遵循，才会出现 2 变 true 这种意料之外的结果</strong></p>
<p>SQL Server 的 tinyint 会不会有类似问题呢？我可以肯定的告诉你们，目前不会有，因为 SQL Server 的 tinyint 没有显示宽度一说，就是固定的 <code>tinyint</code>，不支持 <code>tinyint(n)</code>，至于未来是否支持，未来再说嘛</p>
<h2 data-id="heading-5">总结</h2>
<ol>
<li>
<p>MySQL 整数类型后面的 n 是显示宽度，表示显示时最少占 n 个字符宽度，既不会限制列存储的数值范围，也不会截断比列显示宽度更宽的值</p>
</li>
<li>
<p>MySQL 会把显示宽度作为结果集的元数据返回，所以 mysql-connector-java 8.0.25 能获取到</p>
</li>
<li>
<p>mysql-connector-java 8.0.25 虽然有显示宽度，也提供了间接用到显示宽度的getObject方法，但其 ResultSet 中的数据与数据库中的数据是一致的</p>
<p>至于上层应用如何使用 mysql-connector-java 8.0.25 中的元数据，由上层应用决定；spring-jdbc 就是上层应用之一、MyBatis 也是</p>
</li>
<li>
<p>spring-jdbc 的 JdbcTemplate.queryForRowSet 会间接使用显示宽度，而 Mybatis 不会，MyBatis 有类型处理器</p>
</li>
<li>
<p>如何避免标题中的问题，文中的 <strong>问题处理</strong> 章节已经说明，推荐第三种方式</p>
<blockquote>
<p>不使用 TINYINT(1)，直接使用 TINYINT(4) 或 TINYINT</p>
</blockquote>
</li>
</ol></li></ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[像 ChatGPT 一样丝滑：Spring Boot 如何实现大模型流式（Streaming）响应？]]></title>    <link>https://juejin.cn/post/7596488155302314003</link>    <guid>https://juejin.cn/post/7596488155302314003</guid>    <pubDate>2026-01-18T23:56:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596488155302314003" data-draft-id="7596221097865248774" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="像 ChatGPT 一样丝滑：Spring Boot 如何实现大模型流式（Streaming）响应？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-18T23:56:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            像 ChatGPT 一样丝滑：Spring Boot 如何实现大模型流式（Streaming）响应？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T23:56:54.000Z" title="Sun Jan 18 2026 23:56:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    41
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、为什么需要流式响应？</h2>
<p>同样的 HTTP 请求，为什么像 ChatGPT 这类模型的回答能像打字机一样逐字输出，而我们平时写的接口却要等全部处理完才返回？</p>
<p>问题的核心在于 <strong>响应模式</strong>：</p>





















<table><thead><tr><th>传统模式</th><th>流式模式</th></tr></thead><tbody><tr><td>服务器处理完成 → 一次性返回</td><td>生成一部分 → 立即推送</td></tr><tr><td>客户端等待总时长 = 服务器处理时间</td><td>客户端首字等待时间通常很短</td></tr><tr><td>适合快速查询</td><td>适合耗时生成</td></tr></tbody></table>
<p>对于大模型这种 <strong>生成式 AI</strong>，一个响应可能需要几秒甚至几十秒。如果用传统模式，用户体验就是：</p>
<pre><code class="hljs language-scss" lang="scss">提问 → (<span class="hljs-number">10</span>秒空白) → 答案全部出现
</code></pre>
<p>而流式响应的体验是：</p>
<pre><code class="hljs language-arduino" lang="arduino">提问 → <span class="hljs-number">0.1</span>秒后 → <span class="hljs-string">"我"</span> → <span class="hljs-string">"认"</span> → <span class="hljs-string">"为"</span> → ... → 逐字呈现
</code></pre>
<p>实现这种效果有多种技术方案，本文将介绍基于 Spring Boot WebFlux + SSE 的实现方式。</p>
<h2 data-id="heading-1">二、核心技术选型</h2>
<p>实现流式响应主要有以下几种方案：</p>





























<table><thead><tr><th>方案</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>SSE</strong></td><td>单向推送、HTTP协议、实现简单</td><td>不支持双向通信</td><td>服务端主动推送</td></tr><tr><td><strong>WebSocket</strong></td><td>双向通信、实时性强</td><td>实现复杂、需要额外协议</td><td>聊天、游戏</td></tr><tr><td><strong>长轮询</strong></td><td>兼容性好</td><td>资源消耗大</td><td>低频数据更新</td></tr></tbody></table>
<p><strong>本文选择 SSE 方案</strong>，原因如下：</p>
<ul>
<li>Spring Boot 原生支持 <code>ResponseEntity&lt;Flux&lt;String&gt;&gt;</code></li>
<li>基于标准 HTTP，无需额外协议协商</li>
<li>代码简洁，易于理解和维护</li>
</ul>
<h2 data-id="heading-2">三、项目依赖配置</h2>
<h4 data-id="heading-3">3.1 Maven 依赖</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0
         https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springboot-chat-stream<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Spring Boot WebFlux：响应式编程支持 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Lombok：简化代码 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">3.2 关键依赖说明</h4>
<p><strong>spring-boot-starter-webflux</strong>：提供响应式 Web 支持，核心是 Reactor 的 <code>Flux</code> 类型</p>
<p><strong>Reactor</strong>：响应式编程库，<code>Flux&lt;T&gt;</code> 表示 0-N 个元素的异步序列</p>
<h2 data-id="heading-5">四、核心代码实现</h2>
<h4 data-id="heading-6">4.1 Controller 层：流式响应入口</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.chat.controller;

<span class="hljs-keyword">import</span> com.example.chat.service.StreamChatService;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.http.MediaType;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/chat")</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-meta">@CrossOrigin(origins = "*")</span> <span class="hljs-comment">// 开发环境允许跨域</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamChatController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StreamChatService chatService;

    <span class="hljs-comment">/**
     * 流式聊天接口
     * <span class="hljs-doctag">@param</span> prompt 用户输入的问题
     * <span class="hljs-doctag">@return</span> 流式响应，text/event-stream 格式
     */</span>
    <span class="hljs-meta">@GetMapping(value = "/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Flux&lt;String&gt;&gt; <span class="hljs-title function_">streamChat</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String prompt)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.ok()
                .header(<span class="hljs-string">"Cache-Control"</span>, <span class="hljs-string">"no-cache"</span>)
                .header(<span class="hljs-string">"Connection"</span>, <span class="hljs-string">"keep-alive"</span>)
                .body(chatService.streamResponse(prompt));
    }
}
</code></pre>
<p><strong>关键点解析：</strong></p>
<ol>
<li><code>produces = MediaType.TEXT_EVENT_STREAM_VALUE</code>：声明返回 SSE 格式</li>
<li><code>Flux&lt;String&gt;</code>：响应式流，可以发送多个数据块</li>
<li><code>Cache-Control: no-cache</code>：禁用缓存，确保实时推送</li>
</ol>
<h4 data-id="heading-7">4.2 Service 层：模拟大模型流式生成</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.chat.service;

<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-keyword">import</span> java.time.Duration;

<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamChatService</span> {

    <span class="hljs-comment">/**
     * 模拟大模型流式生成响应
     * <span class="hljs-doctag">@param</span> prompt 用户问题
     * <span class="hljs-doctag">@return</span> 按字符/词汇流式输出的响应
     */</span>
    <span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">streamResponse</span><span class="hljs-params">(String prompt)</span> {
        log.info(<span class="hljs-string">"收到用户提问: {}"</span>, prompt);

        <span class="hljs-comment">// 模拟大模型生成的回复内容</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> mockLLMResponse(prompt);

        <span class="hljs-comment">// 将响应拆分为字符流，每 50ms 发送一个字符</span>
        <span class="hljs-keyword">return</span> Flux.fromArray(response.split(<span class="hljs-string">""</span>))
                .delayElements(Duration.ofMillis(<span class="hljs-number">50</span>))
                .doOnNext(chunk -&gt; log.debug(<span class="hljs-string">"发送数据块: {}"</span>, chunk))
                .doOnComplete(() -&gt; log.info(<span class="hljs-string">"流式响应完成"</span>))
                .doOnError(e -&gt; log.error(<span class="hljs-string">"流式响应异常"</span>, e));
    }

    <span class="hljs-comment">/**
     * 模拟大模型生成内容（实际项目可接入 OpenAI/通义千问等）
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">mockLLMResponse</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"""
                【Spring Boot 流式响应】
                您的问题是：%s

                这是一个模拟大模型流式输出的示例。
                在实际应用中，你可以：
                1. 接入 OpenAI API 使用 GPT-4
                2. 接入阿里云通义千问 API
                3. 接入本地部署的大模型

                流式响应的核心是：
                - 使用 Spring WebFlux 的 Flux
                - 返回 text/event-stream 格式
                - 前端使用 EventSource 或 fetch 接收

                这样就能实现像 ChatGPT 一样的丝滑体验！
                """</span>.formatted(prompt);
    }
}
</code></pre>
<p><strong>核心逻辑：</strong></p>
<ol>
<li><code>Flux.fromArray(response.split(""))</code>：将字符串拆分为字符数组转为流</li>
<li><code>.delayElements(Duration.ofMillis(50))</code>：每个字符延迟 50ms 发送</li>
<li><code>.doOnNext()/.doOnComplete()/.doOnError()</code>：生命周期钩子，用于日志记录</li>
</ol>
<h4 data-id="heading-8">4.3 接入真实大模型 API（扩展）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 接入 OpenAI Streaming API 的示例（伪代码）</span>
<span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">streamOpenAI</span><span class="hljs-params">(String prompt)</span> {
    <span class="hljs-type">WebClient</span> <span class="hljs-variable">webClient</span> <span class="hljs-operator">=</span> WebClient.builder()
            .baseUrl(<span class="hljs-string">"https://api.openai.com/v1"</span>)
            .defaultHeader(HttpHeaders.AUTHORIZATION, <span class="hljs-string">"Bearer YOUR_API_KEY"</span>)
            .build();

    <span class="hljs-keyword">return</span> webClient.post()
            .uri(<span class="hljs-string">"/chat/completions"</span>)
            .bodyValue(Map.of(
                <span class="hljs-string">"model"</span>, <span class="hljs-string">"gpt-4"</span>,
                <span class="hljs-string">"messages"</span>, List.of(Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)),
                <span class="hljs-string">"stream"</span>, <span class="hljs-literal">true</span>
            ))
            .retrieve()
            .bodyToFlux(String.class)
            .map(<span class="hljs-built_in">this</span>::extractContentFromSSE); <span class="hljs-comment">// 解析 SSE 格式提取 content</span>
}
</code></pre>
<h4 data-id="heading-9">4.4 启动类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.chat;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatStreamApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SpringApplication.run(ChatStreamApplication.class, args);
    }
}
</code></pre>
<h4 data-id="heading-10">4.5 配置文件</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">chat-stream-demo</span>

<span class="hljs-comment"># 日志配置</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">com.example.chat:</span> <span class="hljs-string">DEBUG</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">五、前端对接示例</h2>
<h4 data-id="heading-12">5.1 使用 EventSource 接收流</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Spring Boot 流式响应示例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: Arial; <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-id">#output</span> { <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100px</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>; }
        <span class="hljs-selector-tag">input</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">70%</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>; }
        <span class="hljs-selector-tag">button</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>; <span class="hljs-attribute">cursor</span>: pointer; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Spring Boot 流式聊天<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入问题..."</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"sendQuestion()"</span>&gt;</span>发送<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"output"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendQuestion</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> prompt = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'prompt'</span>).<span class="hljs-property">value</span>;
            <span class="hljs-keyword">const</span> output = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'output'</span>);
            output.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'等待响应...'</span>;

            <span class="hljs-comment">// 使用 EventSource 接收 SSE 流</span>
            <span class="hljs-keyword">const</span> eventSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(
                <span class="hljs-string">`/api/chat/stream?prompt=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(prompt)}</span>`</span>
            );

            eventSource.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
                output.<span class="hljs-property">innerHTML</span> += event.<span class="hljs-property">data</span>;
            };

            eventSource.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> {
                eventSource.<span class="hljs-title function_">close</span>();
                output.<span class="hljs-property">innerHTML</span> += <span class="hljs-string">'&lt;br&gt;&lt;br&gt;[连接关闭]'</span>;
            };

            <span class="hljs-comment">// 30秒后自动关闭（演示用）</span>
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> eventSource.<span class="hljs-title function_">close</span>(), <span class="hljs-number">30000</span>);
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">5.2 使用 Fetch API（推荐）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">streamChat</span>(<span class="hljs-params">prompt</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/chat/stream?prompt=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(prompt)}</span>`</span>);
    <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();

    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
        <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">const</span> chunk = decoder.<span class="hljs-title function_">decode</span>(value);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'收到数据:'</span>, chunk);
        <span class="hljs-comment">// 更新 UI</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-14">六、运行效果</h2>
<p>启动项目后，访问 <code>http://localhost:8080</code>（需添加静态页面支持），输入问题，你会看到：</p>
<pre><code class="hljs language-erlang" lang="erlang">【Spring Boot 流式响应】
您的问题是：如何学习 Spring Boot？

这是一个模拟大模型流式输出的示例。
...
</code></pre>
<p>文字像打字机一样逐字出现，体验丝滑！</p>
<h2 data-id="heading-15">七、总结</h2>
<p>本文介绍了如何使用 Spring Boot WebFlux 实现 SSE 流式响应。核心是通过 <code>Flux&lt;String&gt;</code> + <code>TEXT_EVENT_STREAM_VALUE</code> 将数据分块推送，配合前端 <code>EventSource</code> 实现逐字显示效果。相比传统一次性返回，流式响应能显著降低用户等待感知，特别适合大模型对话等耗时生成场景。</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/yuboon</span><span class="hljs-regexp">/java-examples/tree</span><span class="hljs-regexp">/master/springboot</span>-chat-stream
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【LeetCode 刷题系列 | 第 1 篇】前端老司机拆解接雨水问题，从暴力到最优解💦]]></title>    <link>https://juejin.cn/post/7596241980870017058</link>    <guid>https://juejin.cn/post/7596241980870017058</guid>    <pubDate>2026-01-19T01:56:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596241980870017058" data-draft-id="7564307224267538447" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【LeetCode 刷题系列 | 第 1 篇】前端老司机拆解接雨水问题，从暴力到最优解💦"/> <meta itemprop="keywords" content="前端,面试,算法"/> <meta itemprop="datePublished" content="2026-01-19T01:56:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秋天的一阵风"/> <meta itemprop="url" content="https://juejin.cn/user/3588413946594925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【LeetCode 刷题系列 | 第 1 篇】前端老司机拆解接雨水问题，从暴力到最优解💦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3588413946594925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秋天的一阵风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T01:56:42.000Z" title="Mon Jan 19 2026 01:56:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🌧️ 前言</h2>
<p><strong/></p><p align="center"><strong>Hello~大家好。我是秋天的一阵风</strong></p><p/>
<p>欢迎来到我的 LeetCode 刷题系列专栏～ 作为一名深耕前端多年的老司机，我深知算法能力对前端工程师的重要性 —— 它不仅能帮我们在面试中脱颖而出，更能提升日常业务代码的逻辑严谨性和性能优化能力。</p>
<p>今天咱们要攻克的是 <strong>LeetCode 中的经典 hard 题「接雨水」</strong>，这道题堪称 “面试高频钉子户”，考察的核心是对数组遍历和边界判断的理解。</p>
<p>很多同学一开始会被它唬住，但只要咱们从基础思路慢慢拆解，再逐步优化，就能轻松拿捏！话不多说，咱们直奔主题～</p>
<h2 data-id="heading-1">一、LeetCode 接雨水题目详情</h2>
<h3 data-id="heading-2">1. 题目描述</h3>
<p>给定 n 个非负整数表示每个宽度为 1 的柱子的高度图，计算按此排列的柱子，下雨之后能接多少雨水。</p>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ftrapping-rain-water%2F" target="_blank" title="https://leetcode.cn/problems/trapping-rain-water/" ref="nofollow noopener noreferrer">42.</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ftrapping-rain-water%2F" target="_blank" title="https://leetcode.cn/problems/trapping-rain-water/" ref="nofollow noopener noreferrer"> 接雨水</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ftrapping-rain-water%2F" target="_blank" title="https://leetcode.cn/problems/trapping-rain-water/" ref="nofollow noopener noreferrer"> - 力扣（</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ftrapping-rain-water%2F" target="_blank" title="https://leetcode.cn/problems/trapping-rain-water/" ref="nofollow noopener noreferrer">LeetC</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ftrapping-rain-water%2F" target="_blank" title="https://leetcode.cn/problems/trapping-rain-water/" ref="nofollow noopener noreferrer">ode）</a></p>
<h3 data-id="heading-3">2. 示例演示</h3>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ec78c89e89d4b6a9b77daf1efa37754~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL5aSp55qE5LiA6Zi16aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769393009&amp;x-signature=a8gDnkLeie50qq56hbVDkhq96lc%3D" alt="image.png" width="100%" loading="lazy"/>
<ul>
<li>输入：height = [0,1,0,2,1,0,1,3,2,1,2,1]</li>
</ul>

<ul>
<li>输出：6</li>
</ul>

<ul>
<li>解释：如题目中的高度图所示，下雨后能接住 6 单位的雨水。</li>
</ul>

<ul>
<li>输入：height = [4,2,0,3,2,5]</li>
</ul>

<ul>
<li>输出：9</li>
</ul>
<h3 data-id="heading-4">3. 难度级别</h3>
<p>🔴 困难：这道题之所以被归为困难，是因为它需要突破常规的遍历思维，从 “局部最优” 推导 “全局最优”。但只要掌握了核心逻辑，它其实是一道 “纸老虎” 题～</p>
<h2 data-id="heading-5">二、解题思路大剖析</h2>
<h3 data-id="heading-6">1. 暴力解法：直捣黄龙的基础思路</h3>
<p>暴力解法的核心逻辑很朴素：<strong>逐个计算每个柱子能接的雨水量，最后求和</strong>。而一个柱子能接多少水，完全取决于它左右两侧的 “最高屏障”—— 也就是左右两侧最高柱子中较矮的那一个，<strong>用这个较矮值减去当前柱子的高度，就是该位置能接的水量</strong>（若结果为负，则接 0 水）。</p>
<h4 data-id="heading-7">核心步骤拆解：</h4>
<ol>
<li>遍历数组中的每一个柱子（索引从 0 到 n-1）；</li>
</ol>

<ol start="2">
<li>对当前柱子 i，向左遍历所有柱子，找到左侧的最高高度<code>leftMax</code>；</li>
</ol>

<ol start="3">
<li>对当前柱子 i，向右遍历所有柱子，找到右侧的最高高度 <code>rightMax</code>；</li>
</ol>

<ol start="4">
<li>计算当前柱子的接水量：<code>Math.max(0, Math.min(leftMax, rightMax) - height[i])；</code></li>
</ol>

<ol start="5">
<li>累加所有柱子的接水量，得到总水量。</li>
</ol>
<h4 data-id="heading-8">分步拆解演示（以输入 [0,1,0,2,1,0,1,3,2,1,2,1] 为例）：</h4>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ec78c89e89d4b6a9b77daf1efa37754~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL5aSp55qE5LiA6Zi16aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769393009&amp;x-signature=a8gDnkLeie50qq56hbVDkhq96lc%3D" alt="image.png" width="100%" loading="lazy"/>
<p>咱们逐个扒开每个位置的接水逻辑，从索引 0 开始：</p>
<ul>
<li><strong>索引 0</strong>：左侧没有柱子，leftMax=0；右侧最高柱子高度是 3。min(0,3)=0，接水量 0-0=0；</li>
</ul>

<ul>
<li><strong>索引 1</strong>：左侧最高是 0，右侧最高是 3。min(0,3)=0，接水量 0-1=-1，取 0；</li>
</ul>

<ul>
<li><strong>索引 2</strong>：左侧遍历 [0,1]，最高是 1；右侧遍历 [2,1,0,1,3,2,1,2,1]，最高是 3。min(1,3)=1，接水量 1-0=1；</li>
</ul>

<ul>
<li><strong>索引 3</strong>：左侧最高是 1，右侧最高是 3。min(1,3)=1，接水量 1-2=-1，取 0；</li>
</ul>

<ul>
<li><strong>索引 4</strong>：左侧最高是 2，右侧最高是 3。min(2,3)=2，接水量 2-1=1；</li>
</ul>

<ul>
<li><strong>索引 5</strong>：左侧最高是 2，右侧最高是 3。min(2,3)=2，接水量 2-0=2；</li>
</ul>

<ul>
<li><strong>索引 6</strong>：左侧最高是 2，右侧最高是 3。min(2,3)=2，接水量 2-1=1；</li>
</ul>

<ul>
<li><strong>索引 7</strong>：左侧最高是 2，右侧最高是 2。min(2,2)=2，接水量 2-2=0;</li>
</ul>

<ul>
<li><strong>索引 8</strong>：左侧最高是 3，右侧最高是 2。min(3,2)=2，接水量 2-2=0；</li>
</ul>

<ul>
<li><strong>索引 9</strong>：左侧最高是 3，右侧最高是 2。min(3,2)=2，接水量 2-1=1；</li>
</ul>

<ul>
<li><strong>索引 10</strong>：左侧最高是 3，右侧最高是 1。min(3,1)=1，接水量 1-2=-1，取 0；</li>
</ul>

<ul>
<li><strong>索引 11</strong>：右侧没有柱子，接水量 0；</li>
</ul>
<p>把这些有效接水量相加：<code>1+1+2+1+1=6</code>，和示例输出一致！</p>
<h4 data-id="heading-9">JavaScript 代码实现（暴力解法）：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[]</span>} <span class="hljs-variable">height</span>
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>}
 */</span>
<span class="hljs-keyword">var</span> trap = <span class="hljs-keyword">function</span>(<span class="hljs-params">height</span>) {
    <span class="hljs-keyword">const</span> n = height.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>; <span class="hljs-comment">// 总接水量</span>
    <span class="hljs-comment">// 遍历每个柱子（除了首尾也可以，但不影响结果，代码更简洁）</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
        <span class="hljs-keyword">let</span> leftMax = <span class="hljs-number">0</span>; <span class="hljs-comment">// 左侧最高柱子高度</span>
        <span class="hljs-keyword">let</span> rightMax = <span class="hljs-number">0</span>; <span class="hljs-comment">// 右侧最高柱子高度</span>
        <span class="hljs-comment">// 向左遍历，找左侧最高</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i; j &gt;= <span class="hljs-number">0</span>; j--) {
            leftMax = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(leftMax, height[j]);
        }
        <span class="hljs-comment">// 向右遍历，找右侧最高</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i; j &lt; n; j++) {
            rightMax = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(rightMax, height[j]);
        }
        <span class="hljs-comment">// 计算当前柱子的接水量，累加到总水量</span>
        total += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(leftMax, rightMax) - height[i];
    }
    <span class="hljs-keyword">return</span> total;
};
<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">trap</span>([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>])); <span class="hljs-comment">// 输出6</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">trap</span>([<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>])); <span class="hljs-comment">// 输出9</span>
</code></pre>
<h4 data-id="heading-10">暴力解法的优缺点：</h4>
<ul>
<li>优点：思路简单直观，容易理解，适合作为入门思路；</li>
</ul>

<ul>
<li>缺点：时间复杂度极高，为 O (n²)（每个柱子都要左右遍历一次），当 n 较大时（比如 10^4）会直接超时，不适合实际面试场景。</li>
</ul>
<h3 data-id="heading-11">2. 双指针解法：空间优化的最优思路</h3>
<p>暴力解法的问题在于 “重复遍历”，双指针的核心是<strong>利用左右两侧的最大值关系，在一次遍历中完成计算</strong>，把时间复杂度降到 O (n)，空间复杂度优化到 O (1)。</p>
<h4 data-id="heading-12">核心原理：</h4>
<ul>
<li>定义左右指针 left（初始 0）和 right（初始 n-1）；</li>
</ul>

<ul>
<li>定义 leftMax（左侧已遍历的最高高度）和 rightMax（右侧已遍历的最高高度）；</li>
</ul>

<ul>
<li>当 height[left] &lt;= height[right] 时，左侧的最大值 leftMax 决定了当前 left 位置的接水量（因为右侧有更高的柱子兜底）；</li>
</ul>

<ul>
<li>反之，右侧的最大值 rightMax 决定当前 right 位置的接水量；</li>
</ul>

<ul>
<li><strong>遍历过程中不断更新 leftMax、rightMax 和总水量，直到指针相遇。</strong></li>
</ul>
<h4 data-id="heading-13">JavaScript 代码实现（双指针解法）：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[]</span>} <span class="hljs-variable">height</span>
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>}
 */</span>
<span class="hljs-keyword">var</span> trap = <span class="hljs-keyword">function</span>(<span class="hljs-params">height</span>) {
    <span class="hljs-keyword">const</span> n = height.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 少于3个柱子无法接水</span>
    <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>, right = n - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">let</span> leftMax = <span class="hljs-number">0</span>, rightMax = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (left &lt; right) {
        <span class="hljs-comment">// 左侧柱子更矮，以leftMax为基准</span>
        <span class="hljs-keyword">if</span> (height[left] &lt;= height[right]) {
            <span class="hljs-keyword">if</span> (height[left] &gt;= leftMax) {
                leftMax = height[left]; <span class="hljs-comment">// 更新左侧最高</span>
            } <span class="hljs-keyword">else</span> {
                total += leftMax - height[left]; <span class="hljs-comment">// 计算当前位置接水量</span>
            }
            left++; <span class="hljs-comment">// 左指针右移</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 右侧柱子更矮，以rightMax为基准</span>
            <span class="hljs-keyword">if</span> (height[right] &gt;= rightMax) {
                rightMax = height[right]; <span class="hljs-comment">// 更新右侧最高</span>
            } <span class="hljs-keyword">else</span> {
                total += rightMax - height[right]; <span class="hljs-comment">// 计算当前位置接水量</span>
            }
            right--; <span class="hljs-comment">// 右指针左移</span>
        }
    }
    <span class="hljs-keyword">return</span> total;
};
<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">trap</span>([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>])); <span class="hljs-comment">// 输出6</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">trap</span>([<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>])); <span class="hljs-comment">// 输出9</span>
</code></pre>
<h2 data-id="heading-14">三、复杂度分析</h2>
<h3 data-id="heading-15">1. 时间复杂度</h3>
<ul>
<li>暴力解法：O (n²)，双层循环导致重复遍历；</li>
</ul>

<ul>
<li>双指针解法：O (n)，一次遍历完成所有计算；</li>
</ul>
<h3 data-id="heading-16">2. 空间复杂度</h3>
<ul>
<li>暴力解法：O (1)，仅使用常数级额外空间；</li>
</ul>

<ul>
<li>双指针解法：O (1)，同样仅使用常数级额外空间；</li>
</ul>
<h2 data-id="heading-17">总结</h2>
<p>好啦，今天的接雨水问题就讲到这里！相信大家已经对这道题的各种解法了如指掌。如果你有更优的思路，或者在刷题过程中遇到了疑问，欢迎在评论区留言讨论～</p>
<p>下一篇专栏，咱们将攻克另一道前端面试高频题，猜猜是什么？关注我，刷题不迷路！咱们下期再见～ 👋</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python数据处理提速50%！5个Pandas黑科技你用过几个？]]></title>    <link>https://juejin.cn/post/7596260777662791695</link>    <guid>https://juejin.cn/post/7596260777662791695</guid>    <pubDate>2026-01-19T04:18:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596260777662791695" data-draft-id="7596507469883637775" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python数据处理提速50%！5个Pandas黑科技你用过几个？"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-19T04:18:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python数据处理提速50%！5个Pandas黑科技你用过几个？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T04:18:14.000Z" title="Mon Jan 19 2026 04:18:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Python数据处理提速50%！5个Pandas黑科技你用过几个？</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>在数据科学和数据分析领域，Pandas无疑是Python生态中最受欢迎的数据处理库之一。然而，随着数据量的增长，许多开发者发现Pandas的性能逐渐成为瓶颈。据统计，80%的数据分析时间都花在了数据清洗和预处理上。如何优化Pandas操作，实现数据处理效率的显著提升？本文将揭示5个经过验证的Pandas高级技巧，这些技术在实际项目中可将数据处理速度提升高达50%，甚至更多。</p>
<h2 data-id="heading-2">1. 向量化操作替代循环</h2>
<h3 data-id="heading-3">问题背景</h3>
<p>新手最常见的性能陷阱是使用Python原生循环（如<code>for</code>循环）来处理DataFrame中的数据。由于Pandas是基于NumPy构建的，每次循环都会产生额外的类型检查和函数调用开销。</p>
<h3 data-id="heading-4">解决方案</h3>
<p>利用NumPy的向量化操作：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 低效方式</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(df)):
    df.loc[i, <span class="hljs-string">'new_col'</span>] = df.loc[i, <span class="hljs-string">'col1'</span>] * df.loc[i, <span class="hljs-string">'col2'</span>]

<span class="hljs-comment"># 高效方式（提速100倍以上）</span>
df[<span class="hljs-string">'new_col'</span>] = df[<span class="hljs-string">'col1'</span>] * df[<span class="hljs-string">'col2'</span>]
</code></pre>
<h3 data-id="heading-5">进阶技巧</h3>
<p>对于复杂逻辑，可以使用<code>np.where()</code>或<code>np.select()</code>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

conditions = [df[<span class="hljs-string">'score'</span>] &gt;= <span class="hljs-number">90</span>, df[<span class="hljs-string">'score'</span>] &gt;= <span class="hljs-number">80</span>]
choices = [<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>]
df[<span class="hljs-string">'grade'</span>] = np.select(conditions, choices, default=<span class="hljs-string">'C'</span>)
</code></pre>
<h2 data-id="heading-6">2. eval()与query()的高效查询</h2>
<h3 data-id="heading-7">性能原理</h3>
<p><code>pd.eval()</code>和<code>DataFrame.query()</code>使用Numexpr引擎在底层进行优化，可以避免中间变量的创建，特别适用于大型数据集。</p>
<h3 data-id="heading-8">实测对比</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 传统方式（内存占用高）</span>
mask = (df[<span class="hljs-string">'col1'</span>] &gt; <span class="hljs-number">0.5</span>) &amp; (df[<span class="hljs-string">'col2'</span>].isin([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]))
result = df[mask]

<span class="hljs-comment"># eval优化（内存减少40%）</span>
result = df.<span class="hljs-built_in">eval</span>(<span class="hljs-string">"col1 &gt; 0.5 and col2 in [1,2,3]"</span>)

<span class="hljs-comment"># query语法更简洁</span>
result = df.query(<span class="hljs-string">"col1 &gt; 0.5 and col2 in [1,2,3]"</span>)
</code></pre>
<h3 data-id="heading-9">适用场景</h3>
<ul>
<li>DataFrame列数 &gt;50时优势明显</li>
<li>复杂布尔运算条件超过3个时</li>
</ul>
<h2 data-id="heading-10">3. category类型的智能应用</h2>
<h3 data-id="heading-11">内存优化原理</h3>
<p>对于低基数（low-cardinality）列（如性别、国家代码等），将object类型转换为category类型可节省多达95%的内存。</p>
<h3 data-id="heading-12">实际操作示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 查看当前内存使用情况</span>
df.info(memory_usage=<span class="hljs-string">'deep'</span>)

<span class="hljs-comment"># 转换category类型</span>
cat_cols = [<span class="hljs-string">'gender'</span>, <span class="hljs-string">'country_code'</span>, <span class="hljs-string">'product_type'</span>]
df[cat_cols] = df[cat_cols].astype(<span class="hljs-string">'category'</span>)

<span class="hljs-comment"># groupby操作加速30%-70%</span>
df.groupby(<span class="hljs-string">'product_type'</span>).mean()
</code></pre>
<h3 data-id="heading-13">Pro Tip：</h3>
<p>设置有序分类可进一步提升排序性能：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pandas.api.types <span class="hljs-keyword">import</span> CategoricalDtype

cat_type = CategoricalDtype(
    categories=[<span class="hljs-string">'low'</span>, <span class="hljs-string">'medium'</span>, <span class="hljs-string">'high'</span>],
    ordered=<span class="hljs-literal">True</span>)
df[<span class="hljs-string">'priority'</span>] = df[<span class="hljs-string">'priority'</span>].astype(cat_type)
</code></pre>
<h2 data-id="heading-14">4. merge vs join vs concat的选择艺术</h2>
<p>不同合并操作的性能差异可达10倍：</p>

























<table><thead><tr><th>Operation</th><th>Best For</th><th>Time Complexity</th></tr></thead><tbody><tr><td>merge</td><td>SQL风格连接</td><td>O(n log n)</td></tr><tr><td>join</td><td>index对齐</td><td>O(1)</td></tr><tr><td>concat</td><td>简单堆叠</td><td>O(n)</td></tr></tbody></table>
<h3 data-id="heading-15">merge优化技巧：</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Bad - how参数默认值可能触发笛卡尔积计算速度慢100倍 </span>
pd.merge(left_df, right_df)

<span class="hljs-comment"># Good - </span>
pd.merge(left_df, right_df,
         on=<span class="hljs-string">'key'</span>,
         validate=<span class="hljs-string">'one_to_one'</span>) <span class="hljs-comment">#添加约束检查防止意外笛卡尔积</span>
    
<span class="hljs-comment"># Better - sort=False提速25%</span>
pd.merge(left_df.sort_values(<span class="hljs-string">'key'</span>), 
         right_df.sort_values(<span class="hljs-string">'key'</span>),
         on=<span class="hljs-string">'key'</span>,
         sort=<span class="hljs-literal">False</span>)
</code></pre>
<h2 data-id="heading-16">Numba加速数值计算</h2>
<p>对于无法向量化的复杂计算，Numba可以带来惊人的加速效果：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> jit

<span class="hljs-meta">@jit(<span class="hljs-params">nopython=<span class="hljs-literal">True</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">complex_calculation</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-comment"># Some complex logic that can't be vectorized...</span>
    <span class="hljs-keyword">return</span> result
    
df[<span class="hljs-string">'result'</span>] = complex_calculation(df[<span class="hljs-string">'a'</span>].values, df[<span class="hljs-string">'b'</span>].values)
</code></pre>
<p>测试案例：蒙特卡洛模拟速度提升200倍！</p>
<h2 data-id="heading-17">Chunk Processing处理超大数据集</h2>
<p>当数据量超过内存容量时：</p>
<pre><code class="hljs language-python" lang="python">chunk_size = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e6</span>) <span class="hljs-comment"># ~100MB chunks适合大多数机器内存配置 </span>
results = []

<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> pd.read_csv(<span class="hljs-string">'huge_file.csv.gz'</span>,
                         chunksize=chunk_size,
                         dtype=optimized_dtypes):
    processed_chunk = process(chunk)
    results.append(processed_chunk)

final_result = pd.concat(results)    
</code></pre>
<p>最佳实践：</p>
<ul>
<li><code>dtype</code>参数预先指定可以减少50%+的内存使用；</li>
<li><code>parse_dates</code>参数只解析真正需要的日期列；</li>
<li><code>usecols</code>参数只加载必要列；</li>
</ul>
<h2 data-id="heading-18">Dask并行处理终极方案</h2>
<p>当单机处理达到极限时：Dask提供了类Pandas API但支持分布式计算：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> dask.dataframe <span class="hljs-keyword">as</span> dd

ddf = dd.read_csv(<span class="hljs-string">'s3://bucket/*.csv'</span>,
                  blocksize=<span class="hljs-string">"256MB"</span>) 

result_ddf = ddf.groupby(<span class="hljs-string">'user_id'</span>).agg({
    <span class="hljs-string">'value'</span>: [<span class="hljs-string">'sum'</span>,<span class="hljs-string">'mean'</span>,<span class="hljs-string">'std'</span>]
}).compute(num_workers=<span class="hljs-number">8</span>) <span class="hljs-comment">#自动并行化计算！</span>
</code></pre>
<p>关键优势：
✔️延迟计算构建执行图<br/>
✔️自动任务调度<br/>
✔️内存溢出时自动写入磁盘</p>
<h2 data-id="heading-19">Pandas性能监控工具链推荐</h2>
<p>专业开发者必备工具包：</p>
<pre><code class="hljs language-css" lang="css">pip install line_profiler memory_profiler snakeviz pyinstrument psutil scipy matplotlib seaborn tabulate tqdm pandarallel swifter modin dask<span class="hljs-selector-attr">[complete]</span>
</code></pre>
<p>常用组合：</p>
<pre><code class="hljs language-css" lang="css">kernprof -l script<span class="hljs-selector-class">.py</span> &amp;&amp; python -m line_profiler script<span class="hljs-selector-class">.py</span><span class="hljs-selector-class">.lprof</span>  
mprof run <span class="hljs-attr">--include-children</span> script<span class="hljs-selector-class">.py</span> &amp;&amp; mprof plot  
snakeviz profiling_results<span class="hljs-selector-class">.prof</span>  
pyinstrument -r <span class="hljs-selector-tag">html</span> script<span class="hljs-selector-class">.py</span>  
</code></pre>
<h2 data-id="heading-20">DataFrame设计模式最佳实践总结表格</h2>



































<table><thead><tr><th>Pattern</th><th>Use When...</th><th>Speed Gain</th></tr></thead><tbody><tr><td>Column-wise ops</td><td>Uniform calculations across rows</td><td>+100x</td></tr><tr><td>eval/query</td><td>Complex boolean filtering</td><td>+5-20x</td></tr><tr><td>Category dtype</td><td>Low cardinality strings</td><td>+10x mem</td></tr><tr><td>Merge hints</td><td>Large table joins</td><td>+10x</td></tr><tr><td>Numba</td><td>Custom numeric functions</td><td>+100x+</td></tr></tbody></table>
<p>记住黄金法则：<strong>先profile再优化</strong>！不同场景下最优策略可能完全不同。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 对象字面量与代理模式：从入门到面向接口编程]]></title>    <link>https://juejin.cn/post/7597083949833764870</link>    <guid>https://juejin.cn/post/7597083949833764870</guid>    <pubDate>2026-01-20T05:49:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597083949833764870" data-draft-id="7596990822127419430" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 对象字面量与代理模式：从入门到面向接口编程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-20T05:49:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户411924458439"/> <meta itemprop="url" content="https://juejin.cn/user/221443581553930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 对象字面量与代理模式：从入门到面向接口编程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/221443581553930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户411924458439
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:49:09.000Z" title="Tue Jan 20 2026 05:49:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在当今 Web 开发的浪潮中，JavaScript 早已不再是“玩具语言”，而是构建现代交互式应用的核心力量。它灵活、动态、富有表现力，尤其以其 <strong>对象字面量（Object Literal）</strong>  语法和强大的 <strong>面向对象能力</strong> 脱颖而出。本文将带你深入理解 JavaScript 中的对象本质、数据类型基础，并通过一个生动的“送花”场景，揭示 <strong>代理模式（Proxy Pattern）</strong>  如何借助“接口思维”让代码更灵活、更可维护。</p>
<hr/>
<h2 data-id="heading-0">一、JavaScript：无需类定义的动态对象世界</h2>
<p>与 Java、C++ 等静态语言不同，JavaScript 在早期甚至没有 <code>class</code> 关键字（ES6 才引入）。但这并不妨碍它实现强大的面向对象编程——因为它天生支持 <strong>对象字面量</strong>。</p>
<h3 data-id="heading-1">什么是对象字面量？</h3>
<p>对象字面量是一种用 <code>{}</code> 直接创建对象的简洁语法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> person = {
<span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>, 
<span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
<span class="hljs-title function_">sayHello</span>(<span class="hljs-params"/>) { 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`你好，我是 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>); 
    } 
};
</code></pre>
<p>无需先定义“类”，无需编译，一行代码即可拥有一个具备属性（<code>name</code>, <code>age</code>）和方法（<code>sayHello</code>）的完整对象。这种即时性、灵活性，正是 JavaScript 表现力的核心。</p>
<p>同样，数组也通过字面量 <code>[]</code> 创建：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> hobbies = [<span class="hljs-string">"读书"</span>, <span class="hljs-string">"编程"</span>, <span class="hljs-string">"旅行"</span>];
</code></pre>
<p>这种“所见即所得”的语法，极大降低了开发门槛，也让原型式编程成为可能。</p>
<hr/>
<h2 data-id="heading-2">二、JavaScript 的基本数据类型：万物皆可对象？</h2>
<p>JavaScript 的数据类型分为两大类：<strong>原始类型（Primitive）</strong>  和 <strong>引用类型（Reference）</strong> 。</p>
<ul>
<li>
<p><strong>原始类型</strong>（不可变）：</p>
<ul>
<li><code>string</code>（字符串）：<code>"hello"</code></li>
<li><code>number</code>（数值）：<code>42</code>, <code>3.14</code>（JS 的 number 不适合高精度数值计算）</li>
<li><code>boolean</code>（布尔值）：<code>true</code>, <code>false</code></li>
<li><code>null</code>（空值）：表示“有意 absence of any object value”</li>
<li><code>undefined</code>（未定义）：变量声明但未赋值时的默认值</li>
</ul>
</li>
<li>
<p><strong>引用类型</strong>（可变，存储在堆内存）：</p>
<ul>
<li><code>object</code>（对象）：包括普通对象、数组、函数、日期等</li>
<li><code>function</code> 本质上也是对象！</li>
</ul>
</li>
</ul>
<blockquote>
<p>⚠️ 注意：<code>typeof null</code> 返回 <code>"object"</code> 是 JavaScript 的历史 bug，但至今未修复。</p>
</blockquote>
<p>对象作为引用类型，可以动态添加/删除属性，这为行为扩展提供了无限可能。</p>
<hr/>
<h2 data-id="heading-3">三、面向对象：从简单属性到复杂关系</h2>
<p>在 JavaScript 中，<strong>对象由属性（数据）和方法（行为）构成</strong>。这是面向对象的基本单元。</p>
<h3 data-id="heading-4">简单面向对象示例：</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> dog = {
<span class="hljs-attr">name</span>: <span class="hljs-string">"旺财"</span>, 
<span class="hljs-title function_">bark</span>(<span class="hljs-params"/>) { 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"汪汪！"</span>);
} 
};
dog.<span class="hljs-title function_">bark</span>(); <span class="hljs-comment">// 汪汪！</span>
</code></pre>
<h3 data-id="heading-5">复杂面向对象：模拟人际关系</h3>
<p>现实世界充满复杂交互。比如“送花”这一行为，在程序中如何建模？</p>
<p>假设：</p>
<ul>
<li>小王（<code>xw</code>）想给小美（<code>xm</code>）送花。</li>
<li>但小美性格高冷，直接送可能被拒。</li>
</ul>
<p>这时，我们需要一个“中间人”——小红（<code>xh</code>），她可以代为接收并判断是否转交。</p>
<p>这正是 <strong>代理模式（Proxy Pattern）</strong>  的典型应用场景。</p>
<hr/>
<h2 data-id="heading-6">四、代理模式：面向接口编程的优雅实践</h2>
<h3 data-id="heading-7">什么是代理模式？</h3>
<p>代理模式的核心思想是：<strong>为其他对象提供一种代理以控制对这个对象的访问</strong>。它常用于权限控制、延迟加载、日志记录等场景。</p>
<p>在 JavaScript 中，由于其动态特性，我们不需要显式定义“接口”，但可以通过 <strong>约定方法名</strong> 来实现“隐式接口”。</p>
<h3 data-id="heading-8">场景重构：送花代理</h3>
<h4 data-id="heading-9">第一步：定义“收花接口”</h4>
<p>虽然 JS 没有 <code>interface</code> 关键字，但我们约定：<strong>任何能收花的对象，必须有一个 <code>receiveFlower</code> 方法</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 小美：目标对象</span>
<span class="hljs-keyword">const</span> xm = { <span class="hljs-attr">name</span>: <span class="hljs-string">"小美"</span>, <span class="hljs-attr">mood</span>: <span class="hljs-string">"bad"</span>, <span class="hljs-comment">// 心情不好 </span>
<span class="hljs-title function_">receiveFlower</span>(<span class="hljs-params">flower</span>) { 
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mood</span> === <span class="hljs-string">"good"</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>开心地收下了<span class="hljs-subst">${flower}</span>！`</span>);
    } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>心情不好，拒绝了<span class="hljs-subst">${flower}</span>。`</span>); 
    }
  }
}; 
<span class="hljs-comment">// 小红：代理对象 </span>
<span class="hljs-keyword">const</span> xh = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"小红"</span>, 
    <span class="hljs-attr">target</span>: xm, <span class="hljs-comment">// 代理的真实对象 </span>
    <span class="hljs-title function_">receiveFlower</span>(<span class="hljs-params">flower</span>) { 
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>作为代理，先检查一下情况...`</span>); 
        <span class="hljs-comment">// 代理可以添加额外逻辑：比如先改善小美心情 </span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">target</span>.<span class="hljs-property">mood</span> = <span class="hljs-string">"good"</span>; <span class="hljs-comment">// 假设小红成功安慰了小美 </span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">target</span>.<span class="hljs-title function_">receiveFlower</span>(flower); <span class="hljs-comment">// 再转交 </span>
      }
    };
</code></pre>
<h4 data-id="heading-10">第二步：小王送花</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> xw = { 
    <span class="hljs-attr">name</span>: <span class="hljs-string">"小王"</span>,
    <span class="hljs-title function_">sendFlower</span>(<span class="hljs-params">receiver, flower</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>送给<span class="hljs-subst">${receiver.name}</span>一束<span class="hljs-subst">${flower}</span>。`</span>); 
        receiver.<span class="hljs-title function_">receiveFlower</span>(flower); <span class="hljs-comment">// 调用接收者的收花方法 </span>
      }
    }; 
<span class="hljs-comment">// 直接送花给小美 → 可能被拒</span>
xw.<span class="hljs-title function_">sendFlower</span>(xm, <span class="hljs-string">"玫瑰"</span>);
<span class="hljs-comment">// 输出：小美心情不好，拒绝了玫瑰。 </span>

<span class="hljs-comment">// 通过代理小红送花 → 成功！</span>
xw.<span class="hljs-title function_">sendFlower</span>(xh, <span class="hljs-string">"百合"</span>);
<span class="hljs-comment">// 输出： </span>
<span class="hljs-comment">// 小王送给小红一束百合。 </span>
<span class="hljs-comment">// 小红作为代理，先检查一下情况... </span>
<span class="hljs-comment">// 小美开心地收下了百合！</span>
</code></pre>
<h3 data-id="heading-11">关键点：面向“接口”而非“实现”</h3>
<ul>
<li>小王（<code>xw</code>）<strong>不关心</strong>接收者是 <code>xm</code> 还是 <code>xh</code>。</li>
<li>他只依赖一个“契约”：<strong>对方有 <code>receiveFlower</code> 方法</strong>。</li>
<li>只要满足这个“接口”，任何对象都可以作为接收者。</li>
</ul>
<p>这就是 <strong>面向接口编程</strong> 的精髓：<strong>解耦调用者与被调用者，提升代码灵活性和可扩展性</strong>。</p>
<p>未来如果新增“小李”作为代理，只要他也实现 <code>receiveFlower</code>，小王的代码无需任何修改！</p>
<hr/>
<h2 data-id="heading-12">五、JavaScript 中的 Proxy API：原生代理能力</h2>
<p>除了手动编写代理对象，ES6 还提供了原生的 <code>Proxy</code> 构造函数，用于拦截和自定义对象操作：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> xm = { 
    <span class="hljs-attr">mood</span>: <span class="hljs-string">"bad"</span>,
    <span class="hljs-title function_">receiveFlower</span>(<span class="hljs-params">flower</span>) { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`收下<span class="hljs-subst">${flower}</span>`</span>); 
  }
};
<span class="hljs-keyword">const</span> xhProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(xm, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop</span>) { 
    <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">"receiveFlower"</span>) { 
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">flower</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"小红代理：先调整心情..."</span>); 
    target.<span class="hljs-property">mood</span> = <span class="hljs-string">"good"</span>;
    target[prop](flower);
    };
  } 
  <span class="hljs-keyword">return</span> target[prop];
  }
});
xw.<span class="hljs-title function_">sendFlower</span>(xhProxy, <span class="hljs-string">"郁金香"</span>); 
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 小王送给[object Object]一束郁金香。 </span>
<span class="hljs-comment">// 小红代理：先调整心情... </span>
<span class="hljs-comment">// 收下郁金香</span>
</code></pre>
<p>虽然 <code>Proxy</code> 更强大（可拦截 <code>get</code>, <code>set</code>, <code>apply</code> 等），但在简单场景下，<strong>对象字面量 + 方法约定</strong> 已足够清晰高效。</p>
<hr/>
<h2 data-id="heading-13">六、总结：JS 工程师的思维升级</h2>
<p>JavaScript 的魅力在于其 <strong>简洁性与表现力的统一</strong>：</p>
<ul>
<li>用 <code>{}</code> 轻松创建对象，无需繁琐类定义；</li>
<li>用原始类型与对象模型描述世界；</li>
<li>通过“隐式接口”实现灵活的面向对象设计；</li>
<li>借助代理模式，优雅处理复杂交互逻辑。</li>
</ul>
<p>作为新时代的开发者，我们不仅要会写代码，更要学会 <strong>用对象思维建模现实问题</strong>，用 <strong>接口契约解耦系统模块</strong>。而 JavaScript 的对象字面量，正是这一切的起点。</p>
<blockquote>
<p>正如那句名言：“<strong>Program to an interface, not an implementation.</strong> ”<br/>
在 JavaScript 中，接口不必显式声明，只需一个共同的方法名，便足以支撑起灵活、健壮的系统架构。</p>
</blockquote>
<p>从今天起，试着用对象字面量构建你的第一个“送花系统”吧——你会发现，编程，也可以很浪漫。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Galaxy比数平台功能介绍及实现原理｜得物技术]]></title>    <link>https://juejin.cn/post/7597083949833928710</link>    <guid>https://juejin.cn/post/7597083949833928710</guid>    <pubDate>2026-01-20T06:17:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597083949833928710" data-draft-id="7596962772145356815" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Galaxy比数平台功能介绍及实现原理｜得物技术"/> <meta itemprop="keywords" content="大数据"/> <meta itemprop="datePublished" content="2026-01-20T06:17:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="得物技术"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Galaxy比数平台功能介绍及实现原理｜得物技术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    得物技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T06:17:08.000Z" title="Tue Jan 20 2026 06:17:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、背景</h2>
<p>得物经过10年发展，计算任务已超10万+，数据已经超200+PB，为了降低成本，计算引擎和存储资源需要从云平台迁移到得物自建平台，计算引擎从云平台Spark迁移到自建Apache Spark集群、存储从ODPS迁移到OSS。</p>
<p>在迁移时，最关键的一点是需要保证迁移前后数据的一致性，同时为了更加高效地完成迁移工作（目前计算任务已超10万+，手动比数已是不可能），因此比数平台便应运而生。</p>
<h2 data-id="heading-1">二、数据比对关键挑战与目标</h2>
<h3 data-id="heading-2">关键挑战一：如何更快地完成全文数据比对</h3>
<p><strong>现状痛点：</strong></p>
<p>在前期迁移过程中，迁移同学需要手动join两张表来识别不一致数据，然后逐条、逐字段进行人工比对验证。这种方式在任务量较少时尚可应付，但当任务规模达到成千上万级别时，就无法实现并发快速分析。</p>
<p><strong>核心问题：</strong></p>
<ul>
<li>效率瓶颈：每天需要完成数千任务的比对，累计待迁移任务达10万+，涉及表数十万张。</li>
<li>扩展性不足：传统人工比对方式无法满足大规模并发处理需求。</li>
</ul>
<h3 data-id="heading-3">关键挑战二：如何精准定位异常数据</h3>
<p><strong>现状痛点：</strong></p>
<p>迁移同学在识别出不一致数据后，需要通过肉眼观察来定位具体问题，经常导致视觉疲劳和分析效率低下。</p>
<p><strong>核心问题：</strong></p>
<ul>
<li>分析困难：在比对不通过的情况下，比对人员需要人工分析失败原因。</li>
<li>复杂度高：面对数据量庞大、加工逻辑复杂的场景，特别是在处理大JSON数据时，肉眼根本无法有效分辨差异。</li>
<li>耗时严重：单次比对不通过场景的平均分析时间高达1.67小时/任务。</li>
</ul>
<h3 data-id="heading-4">比数核心目标</h3>
<p>基于以上挑战，数据比对系统需要实现以下核心目标：</p>
<ul>
<li>高并发处理能力：支持每天数千任务的快速比对，能够处理10万+待迁移任务和数十万张表的规模。</li>
<li>自动化比对机制：实现全自动化的数据比对流程，减少人工干预，提升比对效率。</li>
<li>智能差异定位：提供精准的差异定位能力，能够快速识别并高亮显示不一致的字段和数据。</li>
<li>可视化分析界面：构建友好的可视化分析平台，支持大JSON数据的结构化展示和差异高亮。</li>
<li>性能优化：将用户单次比对分析时间从小时级大幅缩短至分钟级别。</li>
<li>可扩展架构：设计可水平扩展的系统架构，能够随着业务增长灵活扩容。</li>
</ul>
<h2 data-id="heading-5">三、解决方案实现原理</h2>
<h3 data-id="heading-6">快速完成全文数据比对方法</h3>
<p><strong>比数方法调研</strong></p>
<p>待比对两表数据大小：300GB，计算资源：1000c</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ab7f4b85a76402cadb9d9b692aff2a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=LVX1Y6vhnRcW4tk8AHSxuRUULlw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4837101ae1a406b96ce9fb95e548487~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=s6edlU4%2Bdxp%2BvXIbVE%2FPBCibLdk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>经过调研分析比数平台采用第二种和第三种相结合的方式进行比数。</p>
<p><strong>先Union再分组数据一致性校验原理</strong></p>
<p>假如我们有如下a和b两表张需要进行数据比对</p>
<p>表a：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/186d08e493ea4efe82856cdbaa41bf13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=ppgJj3Yn9%2FpxI4r7dqU6vC6gbiI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>表b：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d69b9c1fc1904764b29d6f96304bbff8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=iwNUsObBCc3NpDlx7ePRL6porOs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>表行数比较：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-title">count</span>(<span class="hljs-params"><span class="hljs-number">1</span></span>) <span class="hljs-keyword">from</span> a</span> ;
</code></pre>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-title">count</span>(<span class="hljs-params"><span class="hljs-number">1</span></span>) <span class="hljs-keyword">from</span> b</span> ;
</code></pre>
<p>针对上面的查询结果，如果数量不一致则退出比对，待修复后重新比数；数量一致则继续字段值比较。</p>
<p><strong>字段值比较：</strong></p>
<p>第一步：union a 和 b</p>
<pre><code class="hljs language-javascript" lang="javascript">select <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> _t1_count, <span class="hljs-number">0</span> <span class="hljs-keyword">as</span> _t2_count, <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`age`</span>, <span class="hljs-string">`score`</span>
<span class="hljs-keyword">from</span> a
union all
select <span class="hljs-number">0</span> <span class="hljs-keyword">as</span> _t1_count, <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> _t2_count, <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`age`</span>, <span class="hljs-string">`score`</span>
<span class="hljs-keyword">from</span> b
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08d2fbde55ed44e1b125872ceead1798~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=bSne3rKYSuK0yGWAWlJv1q23w%2BY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>第二步：sum(_t1_count)，sum(_t2_count) 后分组</p>
<pre><code class="hljs language-javascript" lang="javascript">select <span class="hljs-title function_">sum</span>(_t1_count) <span class="hljs-keyword">as</span> sum_t1_count, <span class="hljs-title function_">sum</span>(_t2_count) <span class="hljs-keyword">as</span> sum_t2_count, <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`age`</span>, <span class="hljs-string">`score`</span>
<span class="hljs-keyword">from</span> (
select <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> _t1_count, <span class="hljs-number">0</span> <span class="hljs-keyword">as</span> _t2_count, <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`age`</span>, <span class="hljs-string">`score`</span>
<span class="hljs-keyword">from</span> a
union all
select <span class="hljs-number">0</span> <span class="hljs-keyword">as</span> _t1_count, <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> _t2_count, <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`age`</span>, <span class="hljs-string">`score`</span>
<span class="hljs-keyword">from</span> b
) <span class="hljs-keyword">as</span> union_table
group by <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`age`</span>, <span class="hljs-string">`score`</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f6723139f6f48bfbf61c35f72ffcd0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=%2FGc9N7JukWBR9eqalDFe5b94Gfw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>第三步：把不一致数据写入新的表中(即上面表中sum_t1_count和sum_t2_count不相等的数据)</p>
<pre><code class="hljs language-javascript" lang="javascript">drop table <span class="hljs-keyword">if</span> exists a_b_diff_20240908;
create table a_b_diff_20240908 <span class="hljs-keyword">as</span> select * <span class="hljs-keyword">from</span> (
select <span class="hljs-title function_">sum</span>(_t1_count) <span class="hljs-keyword">as</span> sum_t1_count, <span class="hljs-title function_">sum</span>(_t2_count) <span class="hljs-keyword">as</span> sum_t2_count, <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`age`</span>, <span class="hljs-string">`score`</span>
<span class="hljs-keyword">from</span> (
select <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> _t1_count, <span class="hljs-number">0</span> <span class="hljs-keyword">as</span> _t2_count, <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`age`</span>, <span class="hljs-string">`score`</span>
<span class="hljs-keyword">from</span> a
union all
select <span class="hljs-number">0</span> <span class="hljs-keyword">as</span> _t1_count, <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> _t2_count, <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`age`</span>, <span class="hljs-string">`score`</span>
<span class="hljs-keyword">from</span> b
) <span class="hljs-keyword">as</span> union_table
group by <span class="hljs-string">`id`</span>, <span class="hljs-string">`name`</span>, <span class="hljs-string">`age`</span>, <span class="hljs-string">`score`</span>
having <span class="hljs-title function_">sum</span>(_t1_count) &lt;&gt; <span class="hljs-title function_">sum</span>(_t2_count)
) <span class="hljs-keyword">as</span> tmp
</code></pre>
<p>如果a_b_diff_20240908没有数据则两张表没有差异，比数通过，如有差异如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbb29da004d0457f8300a7fa6cc42c72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=j1fmuIbtemIRNe9y5Nnk5IQijx4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>第四步：读取不一致记录表，根据主键（比如id）找出不一致字段并写到结果表中。</p>
<p>第五步：针对不一致字段的数据进行根因分析，如 json 、数组顺序问题、浮点数精度问题等，给出不一致具体原因。</p>
<p><strong>哈希值聚合实现高效一致性校验</strong></p>
<p>针对上面union后sum 再 group by 方式 在数据量大的时候还是非常耗资源和时间的，考虑到比数任务毕竟有70%都是一致的，所以我们可以先采用哈希值聚合比较两表的的值是否一致，使用这种高效的方法先把两表数据一致的任务过滤掉，剩下的再采用上面方法继续比较，因为还要找出是哪个字段哪里不一致。原理如下：</p>
<pre><code class="hljs language-scss" lang="scss">SELECT count (*),<span class="hljs-built_in">SUM</span>(xxhash64(cloum1)^<span class="hljs-built_in">xxhash64</span>(cloum2)^...) FROM tableA 
EXCEPT 
SELECT <span class="hljs-built_in">count</span>(*),<span class="hljs-built_in">SUM</span>(xxhash64(cloum1)^<span class="hljs-built_in">xxhash64</span>(cloum2)^...) FROM tableB
</code></pre>
<p>如果有记录为空说明数据一致，不为空说明数据不一致需要采用上面提到union 分组的方法去找出具体字段哪里不一样。</p>
<p>通过哈希值聚合，单个任务比数时间从500s降低到160s，节省大约70%的时间。</p>
<p>找到两张表不一致数据后需要对两张的数据进行分析确定不一致的点在哪里？这里就需要知道表的主键，根据主键逐个比对两张表的其他字段，因此系统会先进行主键的自动探查，以及无主键的兜底处理。</p>
<h3 data-id="heading-7">精准定位异常数据实现方法</h3>
<p><strong>自动探查主键：实现原理如下</strong></p>
<p>刚开始我们采用的前5个字段找主键的方式，如下：</p>
<pre><code class="hljs language-sql" lang="sql">针对表a的前<span class="hljs-number">5</span>个字段 循环比对
<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> id) <span class="hljs-keyword">from</span> a 与 <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">from</span> a 比较 ，如相等主键为id ，不相等继续往下执行
<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> id,name) <span class="hljs-keyword">from</span> a 与 <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">from</span> a比较，如相等主键为id,name ，不相等继续往下执行
<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> id,name,age) <span class="hljs-keyword">from</span> a 与 <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">from</span> a比较，如相等主键为id,name,age ，不相等继续往下执行，直到循环结束
</code></pre>
<p>采用上面的方法不一致任务中大约有49.6%任务自动探查主键失败：因此需重点提升主键识别能力。</p>
<p>针对以上主键探查成功率低的问题，后续进行了一些迭代，优化后的主键探查流程如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25de1d35ecd9418799133d350c66238f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=Wjo6Kt0tO3xPN7AfPoPRzpqHXII%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>一、先采用sum(hash)高效计算方式进行探查：</strong></p>
<p>1.先算出两张表每个字段的sum(hash)值  。</p>
<pre><code class="hljs language-python" lang="python">select <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">hash</span>(<span class="hljs-built_in">id</span>)),<span class="hljs-built_in">sum</span>(<span class="hljs-built_in">hash</span>(name)),<span class="hljs-built_in">sum</span>(<span class="hljs-built_in">hash</span>(age)),<span class="hljs-built_in">sum</span>(<span class="hljs-built_in">hash</span>(score)) <span class="hljs-keyword">from</span> a 
union <span class="hljs-built_in">all</span> 
select <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">hash</span>(<span class="hljs-built_in">id</span>)),<span class="hljs-built_in">sum</span>(<span class="hljs-built_in">hash</span>(name)),<span class="hljs-built_in">sum</span>(<span class="hljs-built_in">hash</span>(age)),<span class="hljs-built_in">sum</span>(<span class="hljs-built_in">hash</span>(score)) <span class="hljs-keyword">from</span> b;
</code></pre>
<p>2.找出值相等的所有字段，本案例中为 id, name。</p>
<p>3.对id，name 可能是主键进一步确认，先进行行数校验，如 select count(distinct id,name) from a 的值等于select count(1) from a 则进一步校验，否则进入到第二种探查主键方式。</p>
<p>4.唯一性验证，如果值为0则表示探查主键成功，否则进入到第二种探查主键方式。</p>
<pre><code class="hljs language-sql" lang="sql">slect <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> ((<span class="hljs-keyword">select</span> id,name <span class="hljs-keyword">from</span> a ) expect (<span class="hljs-keyword">select</span> id,name <span class="hljs-keyword">from</span> b))
</code></pre>
<p><strong>二、传统distinct方式探查：</strong></p>
<p>针对表a的前N（所有字段数/2或者前N、后N等）个字段 循环比对：</p>
<p>1.select count(distinct id) from a与select count(1) from a比较 ，如相等主键为id ，不相等继续往下执行。</p>
<p>2.select count(distinct id,name) from a 与 select count(1) from a比较，如相等主键为id,name ，不相等继续往下执行。</p>
<p>3.select count(distinct id,name,age) from a 与 select count(1) from a比较，如相等主键为id,name,age ，不相等继续往下执行，直到循环结束。</p>
<p><strong>三、全字段排序模拟:</strong></p>
<p>如果上面两种方式还是没有找到主键则把不一致记录表进行全字段排序然后对第一条和第二条记录挨个字段进行分析，找出不一致内容，示例如下：</p>
<pre><code class="hljs language-sql" lang="sql">slect <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> a_b_diff_20240908 <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id,name,age,score <span class="hljs-keyword">asc</span> limit <span class="hljs-number">10</span>;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ef9f06f43484d919849196643d03729~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=93VYsc%2F3m8FGe%2F%2BFZ4xlzVDTTwM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>通过以上结果表可以得出两表的age字段不一致 ，score不一致（但按key排序后一致）。</p>
<p>如果以上自动化分析还是找不到不一致字段内容，可以人工确认表的主键后到平台手动指定主键字段，然后点击后续分析即可按指定主键去找字段不一致内容。</p>
<p>通过多次迭代优化找主键策略，找主键成功率从最初的50.4%提升到75%，加上全字段order by排序后最前两条数据进行分析，相当于可以把找主键的成功率提升到90%以上。</p>
<p><strong>根因分析：实现原理如下</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ffcd921dc69410094ec2ad734d3d602~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=kmEILGcn3E9X17tys3Y5%2FUB5IZ4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>当数据不一致时，平台会根据主键找出两个表哪些字段数据不一致并进行分析，具体如下：</p>
<ul>
<li><strong>精准定位：</strong> 明确指出哪条记录、哪个字段存在差异，并展示具体的源数据和目标数据值。</li>
<li><strong>智能根因分析：</strong> 内置了多种差异模式识别规则，能够自动分析并提示不一致的可能原因，例如：</li>
<li>精度问题：如浮点数计算1.0000000001与1.0的差异。</li>
<li>JSON序列化差异：如{"a":1, "b":2}与{"b":2, "a":1}，在语义一致的情况下，因键值对顺序不同而被标记为差异。同时系统会提示排序后一致。</li>
<li>空值处理差异：如NULL值与空字符串""的差异判定。</li>
<li>日期时区转换问题：时间戳在不同时区下表示不同。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26c3c92ec4094f0eb0dc64b0c3a3daaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=PQ4B4wonmvnK84sqnaWxqZlsgM8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db0212b45a6146c198ea412952b6c8ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=doO%2B5Vt8WX%2FyAR4AE3z8DGP3Kqk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>比对结果统计：</strong> 提供总数据量、一致数据量、不一致数据量及不一致率百分比，为项目决策提供清晰的量化依据。</li>
<li>比数人员根据平台分析的差异原因，决定是否手动标记通过或进行任务修复。</li>
<li>效果展示：</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/566d75faee4a4dcc8c8e637eadd32d6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=Qup%2FMQqwspWtDPW4WNLQ2poZzcw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-8">四、比数平台功能介绍</h2>
<h3 data-id="heading-9">数据比对基本流程</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c09f97130ba45678aec2b50638b2aee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=9hhTVjtN0R7usRnpaw%2BwbwtCvkI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-10">任务生成：三种比对模式</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbb2b1b4aa2c49ea8e0b6a80477808bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=YRfferO3wRHg%2FjEP7FpFuLC70CE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>两表比对：</strong> 最直接的比对方式。用户只需指定源表与目标表，平台即可启动全量数据比对。它适用于临时比对的场景。</li>
<li><strong>任务节点比对：</strong> 一个任务可能输出多个表，逐一配置这些表的比对任务繁琐且易遗漏，任务节点比对模式完美解决了这一问题。用户只需提供任务节点ID，平台便会自动解析该节点对应的SQL代码，提取出所有输出表，并自动生成比对任务，极大地提升任务迁移比对效率。</li>
<li><strong>SQL查询比对：</strong> 业务在进行SDK迁移只关心某些查询在迁移后数据是否一样，因此需要对用户提交的所有查询SQL进行比对，平台会分别在ODPS和Spark引擎上执行该查询，将结果集导出到两张临时表，再生成比对任务。</li>
</ul>
<h3 data-id="heading-11">前置校验：提前发现问题</h3>
<p>在启动耗时的全量比对之前，需要对任务进行前置校验，确保比对是在表结构一致、集群环境正常的情况下进行，否则一旦启动比数会占用大量计算资源，最后结果还是比数不通过，会影响比数平台整体的运行效率。因此比数平台一般会针对如下问题进行前置拦截。</p>
<ul>
<li><strong>元数据一致性校验：</strong> 比对双方的字段名、字段类型、字段顺序、字段个数是否一致。</li>
<li><strong>函数缺失校验：</strong> 针对Spark引擎，校验SQL中使用的函数是否存在、是否能被正确识别，避免因函数不支持而导致的比对失败。</li>
<li><strong>语法问题校验：</strong> 分析SQL语句的语法结构，确保其在目标引擎中能够被顺利解析，避免使用了某些特定写法会导致数据出现不一致情况，提前发现语法层面问题，并对任务进行改写。</li>
</ul>
<p><strong>更多校验点如下：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40910e32074f4c28b70c5226fe902490~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=cl7EeqzAo8AMMIzBZASeWeuzhSI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30dbeda7f2a446b99d9ee8fc0d9c6c6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=6g%2BNoCOop3TpZbTpS0mtpBEIKl4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a120da92c35046a1aee83c9da7f81915~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=jC9MNlPrk1%2FlYM1LW1%2FVh%2BDyB1I%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>通过增加以上前置校验拦截，比数任务数从每天3000+<strong>下降到1500+，</strong> 减少<strong>50%</strong> 的无效比数，其中UDF缺失最多，有效拦截任务1238，缺少函数<strong>87个</strong>（帮比数同学快速定位，一次性解决函数缺失问题，避免多次找引擎同学陆陆续续添加，节省双方时间成本）。</p>
<h3 data-id="heading-12">破解比数瓶颈：资源分配与任务调度优化</h3>
<p>由于比数平台刚上线的时候只有计算迁移团队在使用，后面随着更多的团队开始使用，性能遇到了如下瓶颈：</p>
<p><strong>1.资源不足问题：</strong> 不同业务（计算迁移、存储迁移、SDK迁移）的任务相互影响，基本比数任务与根因分析任务相互抢占资源。</p>
<p><strong>2.任务编排不合理：</strong> 没有优先级导致大任务阻塞整体比数进程。</p>
<p><strong>3.引擎参数设置不合理：</strong> 并行度不够、数据分块大小等高级参数。</p>
<p>针对以上问题比数平台进行了如下优化：</p>
<ul>
<li>按不同业务拆分成多个队列来运行，保证各个业务之间的比数任务可以同时进行，不会相互影响。</li>
<li>根因分析使用单独的队列，与数据比对任务的队列分开，避免相互抢占资源发生“死锁”。</li>
<li>相同业务内部按批次分时段、分优先级运行，保障重要任务优先进行比对。</li>
<li>针对Spark引擎默认调优了公共参数、并支持用户自主设置其他高级参数。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df0b85bd8ac74968b0b75b0d7ee4b9dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769494627&amp;x-signature=35%2FJ9DEW8CBXqiho9N9hYZA0Mtw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>通过以上优化达到到了如下效果：</p>
<ul>
<li>比数任务从每天22点完成提前至<strong>18点</strong>前，同时支持比数同学自主控制高优任务优先执行，方便比数同学及时处理不一致任务。</li>
<li>通过优化资源队列使用方式，使系统找不到主键辅助用户自主找主键接口响应时间<strong>从58.5秒降到 26.2秒。</strong></li>
</ul>
<h2 data-id="heading-13">五、比数平台收益分享</h2>
<p>平台持续安全运行500+天，每日可完成2000+任务比对，有效比数128万+次，0误判。</p>
<ul>
<li>助力计算迁移团队节省45+人日/月，完成数据分析、离线数仓空间任务的比对、交割。</li>
<li>助力存储迁移团队完成20%+存储数据的迁移。</li>
<li>助力引擎团队完成800+批次任务的回归验证，确保每一次引擎发布的安全及高效。</li>
<li>助力SDK迁移团队完成80%+应用的迁移。</li>
</ul>
<h2 data-id="heading-14">六、未来演进方向</h2>
<p>接下来，平台计划在以下方面持续改进：</p>
<p><strong>智能分析引擎：</strong> 针对Json复杂嵌套类型的字段接入大模型进行数据根因分析，找出不一致内容。</p>
<p><strong>比对策略优化：</strong> 针对大表自动切分进行比对，降低比数过程出现因数据量大导致异常，进一步提升比对效率。</p>
<p><strong>通用方案沉淀：</strong> 将典型的比对场景和解决方案能用化，应用到更多场景及团队中去。</p>
<h2 data-id="heading-15">七、结语</h2>
<p>比数平台是得物在迁移过程中，为了应对海量任务、大数据量、字段内容复杂多样、异常数据难定位等挑战，确保业务迁移后数据准确而专门提供的解决方案，未来它不单纯是一个服务计算迁移、存储迁移、SDK迁移、Spark版本升级等需要的数据比对工具，而是演进为数据平台中不可或缺的基础设施。</p>
<h3 data-id="heading-16">往期回顾</h3>
<p>1.得物App智能巡检技术的探索与实践</p>
<p>2.深度实践：得物算法域全景可观测性从 0 到 1 的演进之路 </p>
<p>3.前端平台大仓应用稳定性治理之路｜得物技术</p>
<p>4.RocketMQ高性能揭秘：承载万亿级流量的架构奥秘｜得物技术</p>
<p>5.PAG在得物社区S级活动的落地</p>
<h3 data-id="heading-17">文 /Galaxy平台</h3>
<p>关注得物技术，每周更新技术干货</p>
<p>要是觉得文章对你有帮助的话，欢迎评论转发点赞～</p>
<p>未经得物技术许可严禁转载，否则依法追究法律责任。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[每天一例：公司里一个被忽视但能改进的流程【需求】]]></title>    <link>https://juejin.cn/post/7596993862534430720</link>    <guid>https://juejin.cn/post/7596993862534430720</guid>    <pubDate>2026-01-20T06:23:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596993862534430720" data-draft-id="7596989416760868899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="每天一例：公司里一个被忽视但能改进的流程【需求】"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-20T06:23:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狗头大军之江苏分军"/> <meta itemprop="url" content="https://juejin.cn/user/2955079655907879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            每天一例：公司里一个被忽视但能改进的流程【需求】
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2955079655907879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狗头大军之江苏分军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T06:23:19.000Z" title="Tue Jan 20 2026 06:23:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<h2 data-id="heading-0">每天一例｜需求评审里，我们只讨论“做什么”，却很少讨论“不做的代价”</h2>
</blockquote>
<h3 data-id="heading-1"/>
<hr/>
<h3 data-id="heading-2">连载说明｜每天一例</h3>
<p>在技术团队中，很多问题并非源于个人能力，而是流程的默认设定不够清晰。它们不严重到触发事故，也不足以推动制度调整，却在日常工作中持续消耗时间与精力。</p>
<p>这个连载计划每天记录，或者回忆一个在公司内部真实存在、但常被忽视的小流程问题，重点不在复盘责任，而在拆解具体改法。每一篇只讨论一个场景，描述问题如何出现、改动前的实际阻力、以及一次小规模调整带来的变化。</p>
<p>不涉及宏观管理理念，不讨论理想状态，只关注普通技术团队可直接复用的实践。<br/>
如果某个问题在你的团队反复出现，且只能靠经验或个人兜底解决，那么它很可能值得被写下来。</p>
<h2 data-id="heading-3">开始</h2>
<p>那段时间，我们公司正处在一个不上不下的阶段。</p>
<p><strong>启原系统</strong>做的是企业级 SaaS，业务稳定，但增长开始放缓。产品侧希望通过更细致的功能打磨提升用户黏性，技术团队则在一边偿还历史债务，一边支撑新需求，所有人都在“还能再撑一撑”的状态里往前走。</p>
<p>也是在这样的背景下，那次需求评审被提了出来。</p>
<p>需求本身并不复杂，是一个针对老客户的配置增强功能。产品文档写得很完整，背景、目标、使用场景一应俱全，从逻辑上几乎挑不出毛病。评审会上，技术评估的结论也很一致：实现难度中等，不涉及底层改造，不会影响现有架构，排进当前版本问题不大。</p>
<p>整个过程顺得有点反常。<br/>
没有争论，没有反对意见，甚至连“需要再想想”的停顿都没有。</p>
<p>作为技术负责人，我当时只做了一件事：确认了人力分配，重新调整了迭代优先级，然后点头通过。</p>
<p>事情就是从那一刻开始悄悄埋下伏笔的。</p>
<p>接下来的两个迭代周期，团队节奏明显被拉紧。原本计划中的一次模块重构被拆散推进，一些技术优化被标注为“下个版本再说”，测试同事开始在不同需求之间来回切换。没有人抱怨，但所有人都在默默加速。</p>
<p>功能如期上线，没有事故。</p>
<p>上线后的数据并不好看，也谈不上失败。功能被少量用户使用，反馈偏中性，既没有明显拉升指标，也没有引发负面影响。业务侧很快把注意力转向了下一个方向，这个需求在系统里安静地躺了下来。</p>
<p>直到版本复盘时，我重新翻了一遍需求评审记录。</p>
<p>那一刻我才意识到一个问题：<br/>
<strong>我们在评审时，从头到尾都假设了一件事——这个需求“必须现在做”。</strong></p>
<p>但事实上，没有任何人明确说明过：<br/>
如果这个版本不做，会发生什么？</p>
<p>不会影响合同履约，不会造成客户流失，也不会阻断关键路径。最多只是“体验不够完善”，而这种“不够完善”，其实已经存在了一年多。</p>
<p>我们讨论了“做什么”“怎么做”“多久能做完”，却从未讨论过“不做”的后果。需求一旦被提出来，就自动获得了正当性，仿佛不推进，反而需要解释。</p>
<p>这是一种非常隐蔽的流程盲点。</p>
<p>在技术视角里， <strong>“不做”从来不是一个被正式讨论的选项</strong>。它既不在评审模板里，也不在会议习惯中。结果就是，所有需求都在争夺“现在做”的位置，而真正稀缺的判断，却被流程默默跳过了。</p>
<p>后来我做了一次小范围的复盘，把这次经历写进了内部技术周报。</p>
<p>没有反思个人，也没有指责产品，只是提出了一个很具体的改动建议：<br/>
在所有需求评审材料中，增加一个固定问题——<br/>
<strong>如果本版本不做这个需求，会产生什么具体影响？</strong></p>
<p>不要求给出精确数字，也不强制量化商业损失。<br/>
只要求把后果说清楚。</p>
<p>这个问题第一次被抛出来时，会议明显慢了一拍。有的需求，在这个问题面前显得更紧急；也有的需求，开始自然地被放到“可以等等”的位置。</p>
<p>流程没有变复杂，但决策开始变得更有重量。</p>
<p>后来我才慢慢意识到，这并不是在否定需求，而是在尊重团队的代价。<br/>
当“不做”的影响被说清楚，“现在做”才真正成为一个经过思考的选择，而不是流程推着走的结果。</p>
<p>那次需求评审并没有错。<br/>
它只是提醒了我一件事：<br/>
<strong>技术管理真正难的，从来不是把事情做成，而是决定什么值得被现在做。</strong></p>
<p>如果你愿意，下一篇我可以直接换成 <strong>一线技术骨干视角</strong>，讲“明明看出问题，却还是把需求做完了”的那种真实困境。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Scala中的迭代器]]></title>    <link>https://juejin.cn/post/7578803751609139250</link>    <guid>https://juejin.cn/post/7578803751609139250</guid>    <pubDate>2025-12-02T03:18:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578803751609139250" data-draft-id="7578803491821633563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Scala中的迭代器"/> <meta itemprop="keywords" content="Scala"/> <meta itemprop="datePublished" content="2025-12-02T03:18:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Kim_Jong_un"/> <meta itemprop="url" content="https://juejin.cn/user/2552429938489691"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Scala中的迭代器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2552429938489691/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Kim_Jong_un
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T03:18:04.000Z" title="Tue Dec 02 2025 03:18:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Scala 中的迭代器（Iterator）</h2>
<h3 data-id="heading-1">一、基本概念</h3>
<p>迭代器是用于访问集合元素的工具，提供了一种顺序访问元素的方式，而不暴露底层集合的内部结构。</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorBasics</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 创建迭代器</span>
    <span class="hljs-keyword">val</span> list = <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
    <span class="hljs-keyword">val</span> iterator = list.iterator
    
    println(<span class="hljs-string">"迭代器基本操作:"</span>)
    <span class="hljs-comment">// 1. hasNext - 检查是否有下一个元素</span>
    println(<span class="hljs-string">s"hasNext: <span class="hljs-subst">${iterator.hasNext}</span>"</span>)
    
    <span class="hljs-comment">// 2. next - 获取下一个元素</span>
    <span class="hljs-keyword">if</span> (iterator.hasNext) {
      println(<span class="hljs-string">s"第一个元素: <span class="hljs-subst">${iterator.next()}</span>"</span>)
      println(<span class="hljs-string">s"第二个元素: <span class="hljs-subst">${iterator.next()}</span>"</span>)
    }
    
    <span class="hljs-comment">// 3. 遍历剩余元素</span>
    println(<span class="hljs-string">"剩余元素:"</span>)
    <span class="hljs-keyword">while</span> (iterator.hasNext) {
      println(iterator.next())
    }
    
    <span class="hljs-comment">// 4. 迭代器只能使用一次</span>
    println(<span class="hljs-string">s"\n迭代器已耗尽，hasNext: <span class="hljs-subst">${iterator.hasNext}</span>"</span>)
    <span class="hljs-comment">// println(iterator.next())  // 会抛出异常</span>
  }
}
</code></pre>
<h3 data-id="heading-2">二、迭代器的主要特性</h3>
<h4 data-id="heading-3">1. <strong>一次性（一次性遍历）</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorOneTime</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> nums = <span class="hljs-type">Vector</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>)
    <span class="hljs-keyword">val</span> iter = nums.iterator
    
    println(<span class="hljs-string">"第一次遍历:"</span>)
    <span class="hljs-keyword">while</span> (iter.hasNext) {
      println(iter.next())
    }
    
    println(<span class="hljs-string">"\n第二次遍历（迭代器已空）:"</span>)
    <span class="hljs-comment">// 迭代器已耗尽，不会输出任何内容</span>
    <span class="hljs-keyword">while</span> (iter.hasNext) {
      println(iter.next())  <span class="hljs-comment">// 不会执行</span>
    }
    println(<span class="hljs-string">"hasNext: "</span> + iter.hasNext)  <span class="hljs-comment">// false</span>
  }
}
</code></pre>
<h4 data-id="heading-4">2. <strong>惰性求值（Lazy Evaluation）</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorLazy</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 创建一个大范围的迭代器（不会立即创建所有元素）</span>
    <span class="hljs-keyword">val</span> bigIter = (<span class="hljs-number">1</span> to <span class="hljs-number">1000000</span>).iterator
    
    <span class="hljs-comment">// 只处理前10个元素</span>
    println(<span class="hljs-string">"处理前10个元素:"</span>)
    bigIter.take(<span class="hljs-number">10</span>).foreach(println)
    
    <span class="hljs-comment">// 元素按需生成，节省内存</span>
    <span class="hljs-keyword">val</span> infiniteIter = <span class="hljs-type">Iterator</span>.continually(<span class="hljs-number">1</span>)
    println(<span class="hljs-string">"\n无限迭代器（取前5个）:"</span>)
    infiniteIter.take(<span class="hljs-number">5</span>).foreach(println)
  }
}
</code></pre>
<h4 data-id="heading-5">3. <strong>不存储状态</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorState</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> data = <span class="hljs-type">Array</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
    <span class="hljs-keyword">val</span> iter1 = data.iterator
    <span class="hljs-keyword">val</span> iter2 = data.iterator
    
    println(<span class="hljs-string">"两个独立的迭代器:"</span>)
    println(<span class="hljs-string">"迭代器1: "</span> + iter1.next())  <span class="hljs-comment">// 1</span>
    println(<span class="hljs-string">"迭代器2: "</span> + iter2.next())  <span class="hljs-comment">// 1（独立状态）</span>
    println(<span class="hljs-string">"迭代器1: "</span> + iter1.next())  <span class="hljs-comment">// 2</span>
    println(<span class="hljs-string">"迭代器2: "</span> + iter2.next())  <span class="hljs-comment">// 2</span>
  }
}
</code></pre>
<h3 data-id="heading-6">三、常用操作方法</h3>
<h4 data-id="heading-7">1. <strong>遍历方法</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorTraversal</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> iter = <span class="hljs-type">List</span>(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>, <span class="hljs-string">"E"</span>).iterator
    
    println(<span class="hljs-string">"方法1: while循环"</span>)
    <span class="hljs-keyword">while</span> (iter.hasNext) {
      println(iter.next())
    }
    
    <span class="hljs-comment">// 重新创建迭代器</span>
    <span class="hljs-keyword">val</span> iter2 = <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).iterator
    
    println(<span class="hljs-string">"\n方法2: foreach方法"</span>)
    iter2.foreach(println)
    
    println(<span class="hljs-string">"\n方法3: for循环"</span>)
    <span class="hljs-keyword">val</span> iter3 = <span class="hljs-type">List</span>(<span class="hljs-string">"Apple"</span>, <span class="hljs-string">"Banana"</span>, <span class="hljs-string">"Cherry"</span>).iterator
    <span class="hljs-keyword">for</span> (item &lt;- iter3) {
      println(item)
    }
  }
}
</code></pre>
<h4 data-id="heading-8">2. <strong>转换操作</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorTransformations</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> numbers = (<span class="hljs-number">1</span> to <span class="hljs-number">10</span>).iterator
    
    <span class="hljs-comment">// map - 转换每个元素</span>
    println(<span class="hljs-string">"Map（每个元素乘以2）:"</span>)
    <span class="hljs-keyword">val</span> doubled = numbers.map(_ * <span class="hljs-number">2</span>)
    println(doubled.toList)  <span class="hljs-comment">// 转换为List显示</span>
    
    <span class="hljs-comment">// filter - 过滤元素</span>
    println(<span class="hljs-string">"\nFilter（保留偶数）:"</span>)
    <span class="hljs-keyword">val</span> evens = (<span class="hljs-number">1</span> to <span class="hljs-number">10</span>).iterator.filter(_ % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)
    println(evens.toList)
    
    <span class="hljs-comment">// flatMap - 扁平化映射</span>
    println(<span class="hljs-string">"\nFlatMap:"</span>)
    <span class="hljs-keyword">val</span> words = <span class="hljs-type">List</span>(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>).iterator
    <span class="hljs-keyword">val</span> chars = words.flatMap(_.toCharArray)
    println(chars.toList)
  }
}
</code></pre>
<h4 data-id="heading-9">3. <strong>查找和判断操作</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorSearch</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> data = <span class="hljs-type">List</span>(<span class="hljs-number">15</span>, <span class="hljs-number">20</span>, <span class="hljs-number">25</span>, <span class="hljs-number">30</span>, <span class="hljs-number">35</span>).iterator
    
    <span class="hljs-comment">// find - 查找第一个满足条件的元素</span>
    <span class="hljs-keyword">val</span> found = data.find(_ &gt; <span class="hljs-number">25</span>)
    println(<span class="hljs-string">s"第一个大于25的元素: <span class="hljs-subst">$found</span>"</span>)  <span class="hljs-comment">// Some(30)</span>
    
    <span class="hljs-comment">// exists - 是否存在满足条件的元素</span>
    <span class="hljs-keyword">val</span> iter2 = <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>).iterator
    <span class="hljs-keyword">val</span> hasEven = iter2.exists(_ % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)
    println(<span class="hljs-string">s"是否存在偶数: <span class="hljs-subst">$hasEven</span>"</span>)  <span class="hljs-comment">// false</span>
    
    <span class="hljs-comment">// forall - 所有元素都满足条件</span>
    <span class="hljs-keyword">val</span> iter3 = <span class="hljs-type">List</span>(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>).iterator
    <span class="hljs-keyword">val</span> allEven = iter3.forall(_ % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)
    println(<span class="hljs-string">s"是否都是偶数: <span class="hljs-subst">$allEven</span>"</span>)  <span class="hljs-comment">// true</span>
  }
}
</code></pre>
<h4 data-id="heading-10">4. <strong>聚合操作</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorAggregation</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> numbers = (<span class="hljs-number">1</span> to <span class="hljs-number">5</span>).iterator
    
    <span class="hljs-comment">// foldLeft - 从左开始聚合</span>
    <span class="hljs-keyword">val</span> sum = numbers.foldLeft(<span class="hljs-number">0</span>)(_ + _)
    println(<span class="hljs-string">s"Sum: <span class="hljs-subst">$sum</span>"</span>)  <span class="hljs-comment">// 15</span>
    
    <span class="hljs-comment">// reduce - 缩减操作</span>
    <span class="hljs-keyword">val</span> iter2 = <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).iterator
    <span class="hljs-keyword">val</span> product = iter2.reduce(_ * _)
    println(<span class="hljs-string">s"Product: <span class="hljs-subst">$product</span>"</span>)  <span class="hljs-comment">// 120</span>
    
    <span class="hljs-comment">// count - 计数</span>
    <span class="hljs-keyword">val</span> iter3 = <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>).iterator
    <span class="hljs-keyword">val</span> countEven = iter3.count(_ % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)
    println(<span class="hljs-string">s"偶数个数: <span class="hljs-subst">$countEven</span>"</span>)  <span class="hljs-comment">// 4</span>
  }
}
</code></pre>
<h4 data-id="heading-11">5. <strong>分组和切片操作</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorGrouping</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> data = (<span class="hljs-number">1</span> to <span class="hljs-number">20</span>).iterator
    
    <span class="hljs-comment">// take - 取前n个元素</span>
    println(<span class="hljs-string">"前5个元素:"</span>)
    println(data.take(<span class="hljs-number">5</span>).toList)
    
    <span class="hljs-comment">// drop - 跳过前n个元素</span>
    println(<span class="hljs-string">"\n跳过前3个后的元素:"</span>)
    <span class="hljs-keyword">val</span> iter2 = (<span class="hljs-number">1</span> to <span class="hljs-number">10</span>).iterator
    println(iter2.drop(<span class="hljs-number">3</span>).toList)
    
    <span class="hljs-comment">// slice - 获取子序列</span>
    println(<span class="hljs-string">"\n第3到第7个元素:"</span>)
    <span class="hljs-keyword">val</span> iter3 = (<span class="hljs-number">1</span> to <span class="hljs-number">10</span>).iterator
    println(iter3.slice(<span class="hljs-number">2</span>, <span class="hljs-number">7</span>).toList)  <span class="hljs-comment">// 索引从0开始</span>
    
    <span class="hljs-comment">// grouped - 分组</span>
    println(<span class="hljs-string">"\n每3个一组:"</span>)
    <span class="hljs-keyword">val</span> iter4 = (<span class="hljs-number">1</span> to <span class="hljs-number">10</span>).iterator
    <span class="hljs-keyword">val</span> groups = iter4.grouped(<span class="hljs-number">3</span>)
    groups.foreach(group =&gt; println(group.toList))
  }
}
</code></pre>
<h3 data-id="heading-12">四、创建迭代器的多种方式</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorCreation</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 1. 从集合创建</span>
    println(<span class="hljs-string">"1. 从集合创建:"</span>)
    <span class="hljs-keyword">val</span> fromList = <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).iterator
    <span class="hljs-keyword">val</span> fromArray = <span class="hljs-type">Array</span>(<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"c"</span>).iterator
    <span class="hljs-keyword">val</span> fromSet = <span class="hljs-type">Set</span>(<span class="hljs-number">1.1</span>, <span class="hljs-number">2.2</span>, <span class="hljs-number">3.3</span>).iterator
    
    <span class="hljs-comment">// 2. 使用Iterator对象的方法</span>
    println(<span class="hljs-string">"\n2. Iterator对象方法:"</span>)
    
    <span class="hljs-comment">// range迭代器</span>
    <span class="hljs-keyword">val</span> rangeIter = <span class="hljs-type">Iterator</span>.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>)  <span class="hljs-comment">// 1,3,5,7,9</span>
    println(<span class="hljs-string">s"Range: <span class="hljs-subst">${rangeIter.toList}</span>"</span>)
    
    <span class="hljs-comment">// 无限迭代器</span>
    <span class="hljs-keyword">val</span> ones = <span class="hljs-type">Iterator</span>.continually(<span class="hljs-number">1</span>)
    println(<span class="hljs-string">s"无限1（前5个）: <span class="hljs-subst">${ones.take(5).toList}</span>"</span>)
    
    <span class="hljs-keyword">val</span> increment = <span class="hljs-type">Iterator</span>.from(<span class="hljs-number">5</span>)  <span class="hljs-comment">// 5,6,7,8,...</span>
    println(<span class="hljs-string">s"从5开始（前5个）: <span class="hljs-subst">${increment.take(5).toList}</span>"</span>)
    
    <span class="hljs-comment">// 3. 迭代多个迭代器</span>
    println(<span class="hljs-string">"\n3. 迭代多个迭代器:"</span>)
    
    <span class="hljs-comment">// concat - 连接迭代器</span>
    <span class="hljs-keyword">val</span> concatIter = <span class="hljs-type">Iterator</span>.concat(
      <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>).iterator,
      <span class="hljs-type">List</span>(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>).iterator,
      <span class="hljs-type">List</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>).iterator
    )
    println(<span class="hljs-string">s"连接: <span class="hljs-subst">${concatIter.toList}</span>"</span>)
    
    <span class="hljs-comment">// zip - 配对</span>
    <span class="hljs-keyword">val</span> letters = <span class="hljs-type">List</span>(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>).iterator
    <span class="hljs-keyword">val</span> numbers = <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).iterator
    <span class="hljs-keyword">val</span> zipped = letters.zip(numbers)
    println(<span class="hljs-string">s"Zip: <span class="hljs-subst">${zipped.toList}</span>"</span>)
    
    <span class="hljs-comment">// 4. 自定义迭代器</span>
    println(<span class="hljs-string">"\n4. 自定义迭代器:"</span>)
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FibonacciIterator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Iterator</span>[<span class="hljs-type">Int</span>] </span>{
      <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> prev = <span class="hljs-number">0</span>
      <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> current = <span class="hljs-number">1</span>
      
      <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hasNext</span></span>: <span class="hljs-type">Boolean</span> = <span class="hljs-literal">true</span>  <span class="hljs-comment">// 无限序列</span>
      
      <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">next</span></span>(): <span class="hljs-type">Int</span> = {
        <span class="hljs-keyword">val</span> result = prev
        prev = current
        current = result + current
        result
      }
    }
    
    <span class="hljs-keyword">val</span> fib = <span class="hljs-keyword">new</span> <span class="hljs-type">FibonacciIterator</span>
    println(<span class="hljs-string">s"斐波那契数列（前10个）: <span class="hljs-subst">${fib.take(10).toList}</span>"</span>)
  }
}
</code></pre>
<h3 data-id="heading-13">五、实际应用场景</h3>
<h4 data-id="heading-14">1. <strong>处理大文件</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> scala.io.<span class="hljs-type">Source</span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">LargeFileProcessor</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 使用迭代器逐行处理大文件</span>
    <span class="hljs-keyword">val</span> source = <span class="hljs-type">Source</span>.fromFile(<span class="hljs-string">"data/large_file.txt"</span>)
    <span class="hljs-keyword">val</span> lines = source.getLines()  <span class="hljs-comment">// 返回迭代器</span>
    
    println(<span class="hljs-string">"处理大文件（取前5行）:"</span>)
    lines.take(<span class="hljs-number">5</span>).foreach(line =&gt; {
      <span class="hljs-comment">// 处理每一行，不会一次性加载到内存</span>
      println(<span class="hljs-string">s"处理行: <span class="hljs-subst">${line.take(50)}</span>..."</span>)
    })
    
    source.close()
  }
}
</code></pre>
<h4 data-id="heading-15">2. <strong>流式数据处理</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">StreamProcessing</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 模拟流式数据源</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dataStream</span></span>: <span class="hljs-type">Iterator</span>[<span class="hljs-type">Int</span>] = {
      <span class="hljs-comment">// 在实际应用中可能来自网络、传感器等</span>
      <span class="hljs-type">Iterator</span>.from(<span class="hljs-number">1</span>).map { n =&gt;
        <span class="hljs-type">Thread</span>.sleep(<span class="hljs-number">100</span>)  <span class="hljs-comment">// 模拟延迟</span>
        n * <span class="hljs-number">10</span>
      }
    }
    
    println(<span class="hljs-string">"流式数据处理:"</span>)
    <span class="hljs-keyword">val</span> processed = dataStream
      .filter(_ % <span class="hljs-number">20</span> == <span class="hljs-number">0</span>)  <span class="hljs-comment">// 过滤</span>
      .map(_ / <span class="hljs-number">2</span>)           <span class="hljs-comment">// 转换</span>
      .take(<span class="hljs-number">5</span>)              <span class="hljs-comment">// 限制数量</span>
    
    processed.foreach(item =&gt; println(<span class="hljs-string">s"处理结果: <span class="hljs-subst">$item</span>"</span>))
  }
}
</code></pre>
<h4 data-id="heading-16">3. <strong>分页处理</strong></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Pagination</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 模拟数据库查询结果</span>
    <span class="hljs-keyword">val</span> allData = (<span class="hljs-number">1</span> to <span class="hljs-number">100</span>).iterator
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getPage</span></span>(page: <span class="hljs-type">Int</span>, pageSize: <span class="hljs-type">Int</span>): <span class="hljs-type">List</span>[<span class="hljs-type">Int</span>] = {
      <span class="hljs-keyword">val</span> start = (page - <span class="hljs-number">1</span>) * pageSize
      allData.slice(start, start + pageSize).toList
    }
    
    println(<span class="hljs-string">"第1页（每页10条）:"</span>)
    println(getPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
    
    println(<span class="hljs-string">"\n第2页（每页10条）:"</span>)
    println(getPage(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>))
  }
}
</code></pre>
<h3 data-id="heading-17">六、注意事项和最佳实践</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IteratorBestPractices</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 1. 不要重复使用已耗尽的迭代器</span>
    <span class="hljs-keyword">val</span> iter = <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).iterator
    iter.foreach(println)  <span class="hljs-comment">// 消耗迭代器</span>
    
    <span class="hljs-comment">// val sum = iter.sum  // 错误！迭代器已空</span>
    
    <span class="hljs-comment">// 正确做法：重新创建</span>
    <span class="hljs-keyword">val</span> newIter = <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).iterator
    println(<span class="hljs-string">s"重新创建的迭代器求和: <span class="hljs-subst">${newIter.sum}</span>"</span>)
    
    <span class="hljs-comment">// 2. 避免在遍历过程中修改底层集合</span>
    <span class="hljs-keyword">val</span> list = scala.collection.mutable.<span class="hljs-type">ListBuffer</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    <span class="hljs-keyword">val</span> badIter = list.iterator
    
    <span class="hljs-comment">// 遍历时修改集合可能导致不确定行为</span>
    <span class="hljs-comment">// list += 4  // 危险操作！</span>
    
    <span class="hljs-comment">// 3. 对于需要多次遍历的情况，使用集合而不是迭代器</span>
    <span class="hljs-keyword">val</span> data = <span class="hljs-type">List</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
    
    <span class="hljs-comment">// 需要多次访问时</span>
    println(<span class="hljs-string">s"第一次访问: <span class="hljs-subst">${data.sum}</span>"</span>)
    println(<span class="hljs-string">s"第二次访问: <span class="hljs-subst">${data.product}</span>"</span>)
    
    <span class="hljs-comment">// 4. 使用视图（View）进行惰性链式操作</span>
    <span class="hljs-keyword">val</span> result = (<span class="hljs-number">1</span> to <span class="hljs-number">1000000</span>).view
      .filter(_ % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)
      .map(_ * <span class="hljs-number">2</span>)
      .take(<span class="hljs-number">10</span>)
      .toList
    
    println(<span class="hljs-string">s"使用视图处理: <span class="hljs-subst">$result</span>"</span>)
  }
}
</code></pre>
<h3 data-id="heading-18">总结</h3>
<p><strong>迭代器的优点：</strong></p>
<ul>
<li>惰性求值，节省内存</li>
<li>适合处理大量或无限数据</li>
<li>提供丰富的操作链</li>
<li>不存储数据，只提供访问方式</li>
</ul>
<p><strong>迭代器的缺点：</strong></p>
<ul>
<li>只能遍历一次</li>
<li>不能随机访问</li>
<li>某些操作可能效率较低</li>
</ul>
<p><strong>选择建议：</strong></p>
<ul>
<li>处理大文件或流数据 → 使用迭代器</li>
<li>需要多次访问数据 → 使用集合</li>
<li>需要惰性处理链 → 使用视图或迭代器</li>
<li>需要随机访问 → 使用数组或索引序列</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我和TRAE的这一年：2025年从初识到羁绊的AI编程梦幻之旅]]></title>    <link>https://juejin.cn/post/7591465142451486772</link>    <guid>https://juejin.cn/post/7591465142451486772</guid>    <pubDate>2026-01-05T05:43:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591465142451486772" data-draft-id="7591330139083784207" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我和TRAE的这一年：2025年从初识到羁绊的AI编程梦幻之旅"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-05T05:43:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="熊猫钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1303344484202867"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我和TRAE的这一年：2025年从初识到羁绊的AI编程梦幻之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1303344484202867/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    熊猫钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T05:43:52.000Z" title="Mon Jan 05 2026 05:43:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    170
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">我和TRAE的这一年：2025年从初识到羁绊的AI编程梦幻之旅</h2>
<p>2025年我初识TRAE，也是这一年刚刚加入掘金社区，认识了很多热心的小伙伴，有你们相伴的感觉真好。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9145f6881a9432b927a3460a07eee26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=5oQh3%2FWNg8O39uwOiaAKN7nmhkQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>今年的年终总结应该是特别的，这一年TRAE带给我的收获满满。</p>
<p>回首2025年，我不仅用TRAE编写了大量的代码，开发出了好几款应用，同时也用它撰写报告和制作分析图表，它总是能一次又一次带给我震撼和惊喜。</p>
<p>我相信，TRAE使我相信，AI的时代真的到来了！</p>
<h3 data-id="heading-1">一、TRAE ：开发与创作同行</h3>
<p>我初次使用TRAE是在VS Code IDE中安装Trae插件。开发了一款简单实用的Excel合并工具。</p>
<p>这是我第一次用TRAE，使用VibeCoding的感觉太奇妙了!~</p>
<p>因为我在日常办公和数据处理中，经常会需要对Excel文件资料进行合并，汇总分散在不同文件中的数据，这是一个常见但繁琐的任务，耗时耗力，传统的手动操作不仅效率低下，而且容易出错。专门写代码也需要花费不小的功夫去开发和调试，显得有些鸡肋，因此，我想利用AI工具快速开发一个Excel多文件多表合并工具。</p>
<p>我只是简单在Trae的聊天框中输入：
"请帮我在当前工程下完成一个Excel多文件多表合并工具。该工具支持Windows系统，无需安装，打开即可使用。"
Trae立即响应，建议使用Python的pandas库来处理Excel文件，并自动创建了一个新的Python脚本。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8881e20e18fc49a08253f16a52541884~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=vVgmoV6myD86RjRnQFIAjFWk31A%3D" alt="在这里插入图片描述" loading="lazy"/>
Trae Builder模式初体验，我觉得它能够理解自然语言描述的项目需求，并自动生成可运行的代码框架，而且速度特别快，只用了十来分钟就完成了可用的程序功能。</p>
<p>感谢掘金社区这么一个平台的存在。</p>
<p>我把我的经历和感悟都写出了博客进行分享。</p>
<p>5月19日，我首次发布了两篇文章，心情忐忑又激动。
《对话即编程：如何用 Trae 的 @智能体 5 分钟修复一个复杂 Bug？》《从编程助手到AI工程师：Trae插件Builder模式实战Excel合并工具开发》</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a93df564f4a422e8062f8b5675de077~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=iy1hYfId%2BDpn8LMaRSR4BEYg9zs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>以及之后创作了《 超快速开发！手把手教你基于Trae IDE 04.22构建智能磁盘清理工具——AI原生开发范式实践 》等文章，很快就都被推荐到掘金社区的首页。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35ef31d1109040b08ede7f9c30706a12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=Tf7xor76T%2FGgDI5SZXsK5znCnNQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>随后，更是获得了社区的多篇征文奖励，使我备受鼓舞。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ae41ea9c2804c4f8cb595cc4f4ebdd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=vBVLF5fIOPO59wANckiwNEbFwkM%3D" alt="w6.jpg" loading="lazy"/></p>
<p>社区的分享讨论，使我更加有信心利用先进的AI编程工具解决代码难题，提升工作效率。同时增加了与志同道合的小伙伴们的交流，社区的朋友们总是热情地解答我的问题，给予了我大量无私的帮助。</p>
<p>这一年我给TRAE.ai的公众号写了几篇文章，被授予了“年度创作之星”。这项珍贵的荣誉，给我的2025年画上了一个完美的句号。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09896cdba7884bb3a3b881bf693ddcce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=bb6OA2RV8kajUPGflU9E%2B4Agu9c%3D" alt="w4.jpg" loading="lazy"/></p>
<h3 data-id="heading-2">二、TRAE 年度报告：MVP书写感动！</h3>
<p>看到年度报告的那一刻，我有些惊讶。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f094ce9ae77241508c07ba3556459b92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=WFTW3HbIOiNeHpJyWGnFMHQL%2BnQ%3D" alt="w3.png" loading="lazy"/></p>
<p>创世神。全场MVP。超越99%用户的代码量。这些词组合在一起，我觉得对于我有些不可思议。</p>
<p>我真的只是一个新人，没想到这一年来，自己已经走过了这么远的路。</p>
<p>但屏幕上那个数字——172,106行代码，又实实在在地摆在那里。十倍于FC版《超级玛丽》的代码量，原来真的是TRAE伴随我一路风霜，它帮我一行一行敲出来的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59b48e9b9e754dc78c1456787bef820c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=cGltpM35q1Llr8Lyjzq1bF3xkQc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>2026年1月4日，我写下这篇总结的最终版。距离我第一次使用TRAE，已经过去了220天。这220天里，TRAE不仅是我的开发工具，更像是我的伙伴，见证了我的成长与蜕变。</p>
<h3 data-id="heading-3">三、与TRAE朝夕相伴的日夜</h3>
<p>在这220天里，我见证了TRAE SOLO功能的多次更新：</p>
<ul>
<li><strong>AI代码补全增强</strong>：从简单的代码片段补全，到支持完整函数、类的生成，甚至能够理解项目上下文</li>
<li><strong>多语言支持优化</strong>：最初只支持Python、JavaScript等主流语言，现在已经支持Go、Java、Rust等多种语言</li>
<li><strong>调试能力提升</strong>：从只能生成代码，到能够协助调试、分析错误日志、提供修复方案</li>
<li><strong>项目管理功能</strong>：新增了项目模板、版本控制、协作功能，让SOLO开发也能享受团队级别的管理体验</li>
</ul>
<p>每次更新都让我感受到TRAE团队的用心，他们真正理解开发者的需求，并且快速响应。这种持续进化的能力，是TRAE最吸引我的地方之一。</p>
<p>90天的年度活跃天数，说多不多，说少也不少。但那些深夜里敲代码的时光，那些被bug折磨到抓狂的时刻，那些终于跑通程序时的兴奋，都真实地发生着。</p>
<p>6月2日那天，我写了12435行代码。现在回想起来，那天应该是在做"智能会议纪要助手"的第一个版本。为了实现实时转录功能，我和TRAE反复调试，从深夜10点一直到凌晨3点。当第一个完整的会议纪要生成出来时，我兴奋得像个孩子，立刻给朋友发了截图分享。</p>
<p>8月3日凌晨1点04分，我还沉迷在TRAE的世界里。那天是在修复项目中的一个bug。我和TRAE一起分析日志、调试代码，终于找到了问题所在：对话历史管理模块的缓存机制有问题。当我修复这个bug，夜色已深，我在疲倦中入睡，心情却异常安稳踏实。</p>
<p>10月26日那天，我在IDE里待了384分钟。那天是在优化"智能会议纪要助手"的性能，原来的模型处理长会议时会卡顿。我和TRAE一起尝试了多种优化方案，最终采用了分段处理和增量生成的方式，让系统能够流畅处理长达4小时的会议。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a444e077d34432783b75a05496b618f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=1ugs9f1lcArjxpyiPh3S5E8zV24%3D" alt="w4.png" loading="lazy"/></p>
<p>回想这一年，我的技能结构发生了巨大的变化。年初时，我还在为代码自动补全工具的小幅提升感到欣喜；到年中的TRAE黑客松，我已经能够利用AI平台在短时间内构建完整的应用；而到了年末，AI已经从单纯的辅助工具变成了我的"开发伙伴"。</p>
<p>黑客松之后，我开始认真思考如何将Demo转化为可用的产品。在开发项目的过程中，我经历了思维方式的深刻转变。</p>
<p>传统软件开发追求的是确定性和可控性——相同输入必须产生相同输出，每一步操作都应当可预测。而AI开发则建立在概率性基础上——相同的输入可能产生略有不同的输出，我们需要接受这种不确定性，并学会如何控制和优化它。</p>
<p>刚开始，这种不确定性让我很不适应。我习惯了精确控制每一行代码的执行结果，现在却要接受AI输出的"随机性"。但慢慢地，我发现这种不确定性其实是AI的魅力所在。它能够产生意想不到的创意，提供多样化的解决方案，让产品变得更加灵活和智能。</p>
<p>我学会了如何设计"容错"的系统，如何通过提示词工程引导AI输出期望的结果，如何建立质量评估机制来筛选AI生成的内容。这些经验成为了我2025年技术成长中最宝贵的财富。</p>
<p>更有趣的是，我发现独立开发者在AI应用方面表现最为积极。这主要得益于AI工具降低了技术门槛，使个人开发者也能实现原本需要团队才能完成的功能。这种趋势正在重塑整个软件开发生态，为更多创新提供了可能。</p>
<h3 data-id="heading-4">四、TRAE SOLO Hackathon线下活动：头脑风暴展示TRAE SOLO的魅力</h3>
<p>真正让我对TRAE产生质的认知的，是那场武汉场的TRAE SOLO黑客松。现在回想起来，TRAE SOLO功能的设计理念，其实早已预示了Vibe Coding的未来。</p>
<p>11月16日是一个值得纪念的周末，我有幸受邀参加了武汉场的TRAE SOLO Hackathon线下活动。当天上午的老师们的分享非常有趣，下午是我们battle的主场，武汉场的TRAE用户同伴也都很nice!</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d7e627048f3401cb85e39f42d66ecd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=Z3MPKocdW4j8vEgMX5WP%2F8py9gs%3D" alt="image.png" loading="lazy"/></p>
<p>值得一提的是，中午的盒饭和餐点真的很好吃！
晒一下我当天的伙食。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e05cb4cb1ba14b6188958e8b761389b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=2fbBvbTsEzrJlnNZd3eWyJaB1go%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>在黑客松中，我仅用了半天3个小时就开发出了一个基本完整的应用：</p>
<p><strong>TRAE SOLO环游世界游戏轻应用</strong>：包含景点打卡系统、道具收集机制、道具交易系统、AI智能向导、成就系统等丰富功能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/889668422e95419f803c04e4cdbee09a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=%2FPDv2jGt81Ic5yhjDbvdv5dJEvk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b643070db7704433acedd1e01b5685d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=7iIt0KnM8K3pt1j1ZHvPUIni8ZM%3D" alt="2.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5d71ba9c6474c4ebe72d51cb780306d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=K9KGIb6LdkTaWLqcAxUe%2F%2FUGjeY%3D" alt="3.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07842f276cc546929d7207ae2f24f3b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=4DJPLDqt0cbyqV8%2BytGUFzW4%2Bcs%3D" alt="image.png" loading="lazy"/></p>
<p>"环游世界"是一个与我以往开发办公应用实用工具为主相反的完全不同的尝试。</p>
<p>我想做一个游戏，让玩家通过对话的方式，在虚拟世界中旅行、探索、学习。这个想法听起来很简单，但实现起来需要复杂的对话系统、状态管理、内容生成。在传统开发模式下，这几乎是一个独立开发者无法完成的任务。</p>
<p>但TRAE SOLO改变了这一切。我能够快速集成智能对话系统，让NPC有自己的个性和记忆；能够轻松生成多样化的场景描述，从巴黎的埃菲尔铁塔到亚马逊的热带雨林；能够实现个性化的游戏体验，根据玩家的选择调整剧情走向。最让我感动的是，有玩家反馈说："这个游戏让我在屏幕前就感受到了世界的广阔"。</p>
<p>这个应用让我获得了二等奖的殊荣。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e3a440dc5d94a6597c8a4f4daa3d04d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769479682&amp;x-signature=KWnjRJj0OMy9QDLHoWZmEebsiDI%3D" alt="w5.jpg" loading="lazy"/></p>
<p>TRAE SOLO真正吸引我的地方，是它"一人即团队"的设计理念。在传统开发中，一个完整的项目需要前端、后端、测试等多个角色配合，而TRAE SOLO让我一个人就能完成整个开发流程。</p>
<p>最让我惊喜的是，TRAE SOLO不仅提供了强大的开发能力，还内置了<strong>轻应用发布</strong>功能，让我能够快速将作品分享给其他用户。这种"开发-发布-反馈"的闭环体验，极大地提升了我的开发热情。</p>
<h3 data-id="heading-5">写在最后：未来的展望</h3>
<p>创世神这个称号，听起来很厉害，但我知道，真正的"创世"不是写了多少代码，而是这些代码最终变成了什么。"智能会议纪要助手"帮助了很多人提高工作效率，"环游世界"游戏给玩家带来了快乐和启发，这些才是真正有价值的东西。</p>
<p>在这一年里，TRAE见证了我的技术成长。</p>
<p>新的一年就要来了，我对未来充满期待。我会继续写代码，继续学习，继续创造。我相信，在TRAE的陪伴下，我会创造出更多有价值的产品，结识更多有趣的人，经历更多精彩的故事。</p>
<p>就像TRAE说的，我们的冒险已经启程。220天只是开始，后面的路还很长。</p>
<p>——熊猫钓鱼，2026年1月5日</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🏆2025 AI/Vibe Coding 对我的影响 | 年终征文]]></title>    <link>https://juejin.cn/post/7587675443442450472</link>    <guid>https://juejin.cn/post/7587675443442450472</guid>    <pubDate>2025-12-26T03:04:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7587675443442450472" data-draft-id="7586836874016751626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🏆2025 AI/Vibe Coding 对我的影响 | 年终征文"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-12-26T03:04:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金酱"/> <meta itemprop="url" content="https://juejin.cn/user/1556564194374926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🏆2025 AI/Vibe Coding 对我的影响 | 年终征文
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/7255271989291450420/posts" data-v-d326b38e=""><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b3e5e62bb3a4eff89269d51825c4a1f~tplv-k3u1fbpfcp-watermark.image?" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/7255271989291450420/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="掘金运营团队" class="title" data-v-d326b38e="">掘金运营团队</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-12-26T03:04:16.000Z" title="Fri Dec 26 2025 03:04:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-12-26
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                10,825
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                阅读6分钟
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        关注
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              ❤首席客服君 @掘金
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d4ef939034d4f9e8f6f5798c339e98d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=YIR%2FBntEM6%2Fz8aMqHqeMjMjLpiw%3D" alt="img_v3_02t9_51022880-c5f3-4f3c-8892-b6f6ca1ba8eg.png" loading="lazy"/></p>
<p>当岁末的钟声临近，我们又站在了一年的重点回望。2025年，对你而言，是怎样的轮廓呢？</p>
<p>它或许是由一行行被AI重构的代码勾勒，是某个深夜与新技术“顿悟时刻”的灵光一现，也可能是生活中因为智能体工具而悄然改变的工作状态。</p>
<p>从智能体（Agent）的横空出世到多模态技术的经验突破，技术愈加深入地流淌尽我们的工作和生活日常，塑造着属于每个人的独特“Vibe”。</p>
<p>今天，稀土掘金正式发起这场专属社区的<strong>年终“围炉夜话”</strong> ，我们不谈宏大的行业预言，不设苛刻的评审框架。我们只想邀请您，记录下属于你的数字年轮。</p>
<h2 data-id="heading-0">✨主题 ：2025 AI/Vibe Coding对我的影响</h2>
<p>本次征文不再是一场竞赛，而是一次社区的年终“围炉夜话”。我们鼓励所有成员停下脚步，回望2025年技术与个人生活交织的痕迹。无论是代码世界的深刻变革，还是AI工具带来的细微习惯改变，每一次记录，都是我们共同的“数字年轮”。</p>
<h2 data-id="heading-1">⁉️如何参与</h2>
<p>发布文章时选择带话题 <strong><a href="https://juejin.cn/theme/detail/7586482726807535666?contentType=1" target="_blank" title="https://juejin.cn/theme/detail/7586482726807535666?contentType=1">#2025 AI/Vibe Coding 对我的影响#</a></strong> 就可以被统计到哦💁🏻</p>
<p align="left"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a9b3efe1391432e9d11a481dc69d654~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=Fi6kv83xpLQ7C18nrb42zLk60X0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">🗒️赛道说明</h3>
<p><code>参与者可以任选其一进行投稿，也可同时参与，不限制投稿文章数。</code></p>
<h4 data-id="heading-3">赛道一：2025，我的“Vibe Coding”时刻</h4>
<blockquote>
<p><strong>主题解读</strong></p>
<p>聚焦技术<strong>对“我”的个体影响</strong>。可以是一个AI工具、一个开源项目、一次技术决策、一种行业趋势，也可以是技术带来的某种生活方式。</p>
<p><strong>内容方向建议</strong></p>
<ul>
<li><em>Agent革命</em></li>
</ul>
<p>ChatGPT/Gemini如何改变我的开发效率，大模型如何让我的代码如鱼得水？（技术冲破对工作模式/效率带来的影响，任意模型/技术皆可）</p>
<ul>
<li><em>生活Vibe</em></li>
</ul>
<p>Web3、数字游民等概念开启的新生活尝试，分享自己用AI生成旅行攻略、创作音乐、辅导孩子学习的故事等；</p>
<ul>
<li><em>年度总结</em></li>
</ul>
<p>以个人视角，复盘你在某个技术领域（前端、后端、AI、运维等）或者生活上这一年的得失与观察。</p>
</blockquote>
<h4 data-id="heading-4">赛道二：「我和TRAE的这一年」</h4>
<blockquote>
<p><strong>主题解读</strong></p>
<p>一个针对TRAE的专属回忆录，记录掘金社区TRAE深度用户与其共同成长的故事。</p>
<p><strong>内容方向建议</strong></p>
<ul>
<li><em>成长见证</em></li>
</ul>
<p>记录自己使用TRAE完成的第一篇文章、第一个获赞、第一次参与开源项目、第一次开发的游戏等；</p>
<ul>
<li><em>连接故事</em></li>
</ul>
<p>通过社区所结识到的志同道合的TRAE友、参与的线下/线上活动、与TRAE官方运营互动的有趣瞬间；</p>
<ul>
<li><em>产品共建</em></li>
</ul>
<p>对TRAE功能提出的建议被采纳，或使用各个模式提升学习效率的真实体验瞬间。</p>
</blockquote>
<p><em>❗参加<strong>赛道二</strong> 的文章除话题 <a href="https://juejin.cn/theme/detail/7586482726807535666?contentType=1" target="_blank" title="https://juejin.cn/theme/detail/7586482726807535666?contentType=1">#2025 AI/Vibe对我的影响</a> 外，<strong>必须加上<a href="https://juejin.cn/tag/Trae" target="_blank" title="https://juejin.cn/tag/Trae">#TRAE</a>标签</strong>。</em></p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dca9a88a7ebd4c19ae7aa71c7101ef44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=bkJOuLGrW%2Fn%2Fkfs6iQGvBxAbMO4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">☝️征文要求</h3>
<p>本次征文活动需要符合主题，对于文章类型以及活动参与方式，我们有以下几点小要求。</p>
<ol>
<li>
<p>文章须为<strong>原创文章</strong>，内容符合<a href="https://juejin.cn/book/6844733795329900551/section/6844733795380232199" target="_blank" title="https://juejin.cn/book/6844733795329900551/section/6844733795380232199">掘金社区的内容标准和规范</a>。</p>
</li>
<li>
<p>本次征文<strong>不限制文章题材</strong>，可以是你对行业的总结和见解，也可以是你对行业未来发展的预测，本次活动不接受下面几种文章：</p>
<ol>
<li>资源聚合类文章，例如 Awesome-List；</li>
<li>翻译类文章和利用AI生产文章；</li>
<li>与本次主题无关的文章；</li>
<li>学习笔记/知识点汇总类文章；</li>
<li>有失中立性、公正性的内容，比如由公司或者公司的代理机构（如公关公司）所撰写，单纯希望宣传自己的商业产品或者公司的内容；</li>
<li>内容与活动主题不符、非原创内容，有洗稿、营销软文、广告、抄袭嫌疑的文章。</li>
</ol>
</li>
<li>
<p>刷赞、刷量等有作弊行为的文章，直接取消比赛资格，不参与评选；</p>
</li>
<li>
<p>AI代写文章、AI聊天记录等不计入活动（AI检测超过<strong>70%</strong> 取消文章获奖资格）；</p>
</li>
<li>
<p>活动文章需要选择话题：<a href="https://juejin.cn/theme/detail/7586482726807535666?contentType=1" target="_blank" title="https://juejin.cn/theme/detail/7586482726807535666?contentType=1">juejin.cn/theme/detai…</a></p>
</li>
<li>
<p>获奖作品，著作权归作者所有，掘金拥有使用权；</p>
</li>
</ol>
<h3 data-id="heading-6">🥇奖项设置</h3>
<blockquote>
<p><em>文章将根据<strong>专家评审得分</strong>（占比70%）和<strong>文章热度</strong>（占比30%）得分加权计算。<strong>未获得官方推荐</strong>的文章不参与奖项评选。</em></p>
</blockquote>





























































<table><thead><tr><th>奖项名称</th><th>奖项设置</th><th>获奖人数</th><th>奖品名称</th><th>奖品图</th></tr></thead><tbody><tr><td><strong>主赛道</strong></td><td>优秀文章奖（前10篇）</td><td>10名</td><td>小熊（Bear）电烧烤炉 多功能料理锅电烤炉 DKL-D12A1</td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfe1f14ebbba4ef4b00c4f1c9f804a58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=44uqC3XJAvdL15px7U5l%2BeMy9mw%3D" alt="image.png" loading="lazy"/></td></tr><tr><td/><td>掘金达人奖（11-40篇）</td><td>30名</td><td>稀土掘金 Yoyo抱枕新版-450g</td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0994f46b5f64a0983edcae0dcaf582b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=i1SoWR7zaMEYhNGcWcdN7UFsMWU%3D" alt="" loading="lazy"/></td></tr><tr><td/><td>阳光普照奖（41-100篇）</td><td>60名</td><td>稀土掘金 x ByteMall 联名盲盒</td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a503e8c6651439081513b9eebf0e548~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=Yk6EwKX26nNTWOjUYIQhOGol7Y8%3D" alt="" loading="lazy"/></td></tr><tr><td><strong>TRAE特别赛道鼓励奖（叠加）</strong></td><td>TOP1-10</td><td>10名</td><td>价值200元 TRAE连帽卫衣+抱枕</td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3df35e973e984ffabc678b056123c053~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=3%2BLq%2FVH6fClH3y4JCi2q0fIjBlc%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9cdcce418454a83810d84be38fcfc78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=9%2FLgenqSscjvgmgu9wBJU31jKZo%3D" alt="" loading="lazy"/></td></tr><tr><td/><td>TOP11-30</td><td>20名</td><td>价值100元 TRAE圆领卫衣</td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cea27183efa24e44b251b24b35ba9434~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=a3eBQcNpfBrsT5ZmNz8sQaj0joY%3D" alt="" loading="lazy"/></td></tr><tr><td/><td>TOP31-50</td><td>20名</td><td>价值50元 TRAE单肩包</td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/148795305e4248a684ba2a4c95709a06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=V4Blcvr4XifsG1C8gxKTzU%2FMt9w%3D" alt="" loading="lazy"/></td></tr><tr><td/><td>TOP51-100</td><td>50名</td><td>TRAE小鼠标垫</td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23f8a2ea09714ea1ac2d9b8a41ce3248~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769401938&amp;x-signature=%2B82uWlqHWsdWG7LXkMihwgONo0I%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<h2 data-id="heading-7">🤵征文对象</h2>
<p>掘金社区全体掘友</p>
<h2 data-id="heading-8">⏰活动时间</h2>
<p>2025年12月26日——2026年1月25日23:59</p>
<h2 data-id="heading-9">👀 活动Q&amp;A</h2>
<p><strong>Q1：投稿数量有限制吗？</strong></p>
<p>A：没有。</p>
<p><strong>Q2：一篇文章可以同时参与多个社区活动吗？</strong></p>
<p>A：不行。一篇文章只能参与一个社区活动，可以写多篇文章参与不同的活动。</p>
<p><strong>Q3: 本次活动中写了多篇文章，可以多次获奖吗？</strong></p>
<p>A：参加特别赛道的文章，同时参与主赛道激励文章排名，中奖奖品兼得。但是，主赛道奖项一个用户只能获得一次，多篇文章上榜时选取最高名次获奖。</p>
<p><strong>Q4：如何算是成功参与了活动？</strong></p>
<p>A：活动期间，在掘金平台发布2025 AI/Vibe 对我的影响年终技术征文，选择带话题  <strong><a href="https://juejin.cn/theme/detail/7586482726807535666?contentType=1" target="_blank" title="https://juejin.cn/theme/detail/7586482726807535666?contentType=1">#2025 AI/Vibe Coding 对我的影响#</a></strong>  ，即可成功参与活动。注意话题≠标签！</p>
<h3 data-id="heading-10">💡注意事项</h3>
<p>2026年1月25日活动结束后，约10-15个工作日通过<strong>系统消息</strong>的形式公示获奖情况，预计填写问卷后的20个工作日内完成奖品发放。</p>
<p>技术浪潮奔涌向前，但属于个体的记忆同样珍贵。让我们用文字，为这不平凡的一年按下存档键。</p>
<p><strong>来掘金，写下你的2025。你的故事，我们都在听。</strong></p>
<blockquote>
<p>注：最终解释权归<em><strong>稀土掘金技术社区</strong></em> 官方所有</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 基础用法与核心意义：让 JavaScript 更 “靠谱”]]></title>    <link>https://juejin.cn/post/7597083949834076166</link>    <guid>https://juejin.cn/post/7597083949834076166</guid>    <pubDate>2026-01-20T06:37:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597083949834076166" data-draft-id="7597230546238750756" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 基础用法与核心意义：让 JavaScript 更 “靠谱”"/> <meta itemprop="keywords" content="JavaScript,TypeScript"/> <meta itemprop="datePublished" content="2026-01-20T06:37:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冻梨政哥"/> <meta itemprop="url" content="https://juejin.cn/user/2373184444182659"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 基础用法与核心意义：让 JavaScript 更 “靠谱”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2373184444182659/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冻梨政哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T06:37:45.000Z" title="Tue Jan 20 2026 06:37:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TypeScript 基础用法与核心意义：让 JavaScript 更 “靠谱”</h2>
<p>JavaScript 作为前端开发的核心语言，凭借弱类型、动态性的特点，拥有上手快、灵活度高的优势，成为初学者和小型项目的首选。但在大型项目开发中，弱类型带来的 “隐性问题” 却让开发者头疼不已 —— 变量类型随意变更、函数参数类型不匹配、代码逻辑二义性等问题，往往要到运行阶段才暴露，极大增加了调试成本和代码维护难度。</p>
<p>TypeScript（简称 TS）作为 JavaScript 的超集，由微软开发并维护，核心目标是为 JavaScript 添加<strong>静态类型系统</strong>，从 “运行时找错” 转向 “编译期纠错”，既能兼容所有 JavaScript 语法，又能通过类型约束提升代码的健壮性和可读性。下面结合实际代码，详解 TS 的基础用法与核心意义。</p>
<h3 data-id="heading-1">一、TS 的核心意义：解决 JavaScript 弱类型的痛点</h3>
<h4 data-id="heading-2">1. 杜绝类型二义性，避免逻辑错误</h4>
<p>JavaScript 的弱类型特性导致相同语法可能有完全不同的行为，比如加法运算会因参数类型不同变成拼接：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1.js - JS弱类型导致的二义性 </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a,b</span>) { 
    <span class="hljs-keyword">return</span> a + b; <span class="hljs-comment">// 若a是数字、b是字符串，结果是拼接而非加法 </span>
} 
<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">add</span>(<span class="hljs-number">10</span>,<span class="hljs-string">"5"</span>); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// 输出"105"，而非预期的15</span>
</code></pre>
<p>而 TS 通过<strong>类型注解</strong>限定参数和返回值类型，编译阶段就会拦截错误：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 2.ts - TS强类型约束</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addTs</span>(<span class="hljs-params">a:<span class="hljs-built_in">number</span>, b:<span class="hljs-built_in">number</span></span>):<span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-keyword">const</span> result3 = <span class="hljs-title function_">addTs</span>(<span class="hljs-number">10</span>,<span class="hljs-string">'5'</span>); <span class="hljs-comment">// 编译报错：类型"string"的参数不能赋给类型"number"的参数</span>
</code></pre>
<p>只需在函数参数后加<code>:类型</code>，返回值前加<code>:类型</code>，就能明确约束类型，从源头杜绝此类错误。</p>
<h4 data-id="heading-3">2. 提前暴露错误，降低调试成本</h4>
<p>JavaScript 是动态语言，类型错误只有运行时才会发现；而 TS 的静态类型检查在编写代码（编译）阶段就提示错误。比如 JS 中变量可以随意变更类型：</p>
<pre><code class="hljs language-ini" lang="ini">// 4.js - JS变量类型无约束
var <span class="hljs-attr">a</span> = <span class="hljs-number">1</span><span class="hljs-comment">; </span>
<span class="hljs-attr">a</span> = <span class="hljs-string">"11"</span><span class="hljs-comment">; // 数字类型变量被赋值为字符串，无任何提示</span>
</code></pre>
<p>TS 中若给变量指定类型后，强行赋值其他类型会直接报错：</p>
<pre><code class="hljs language-ini" lang="ini">// 4.ts - TS类型约束 
let a:<span class="hljs-attr">number</span> = <span class="hljs-number">1</span><span class="hljs-comment">; </span>
<span class="hljs-attr">a</span> = <span class="hljs-string">"11"</span><span class="hljs-comment">; // 编译报错：不能将类型"string"分配给类型"number"</span>
</code></pre>
<p>这种 “提前纠错” 的特性，能让开发者在编码阶段就发现问题，而非等到测试或生产环境才暴露。</p>
<h4 data-id="heading-4">3. 提升代码可读性与可维护性</h4>
<p>大型项目中，开发者往往需要阅读他人代码。TS 的类型注解相当于 “自带文档”，无需运行代码就能明确变量、函数的用途和类型。比如 TS 的函数定义：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 3.ts - TS函数类型注解 </span>
<span class="hljs-function">function <span class="hljs-title">getArea</span><span class="hljs-params">(width:number, height:number)</span>:number{</span> 
    let area:number = width*height; 
    <span class="hljs-keyword">return</span> area; 
 }
</code></pre>
<p>一眼就能看出<code>getArea</code>接收两个数字类型参数，返回数字类型结果；而对应的 JS 代码：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 3.js - JS函数无类型提示 </span>
<span class="hljs-function">function <span class="hljs-title">getArea</span><span class="hljs-params">(width, height)</span> </span>{ 
    var area = width * height; 
    <span class="hljs-keyword">return</span> area; 
 }
</code></pre>
<p>若不看函数内部逻辑，无法确定参数和返回值的类型，维护成本显著增加。</p>
<h3 data-id="heading-5">二、TS 的基础用法：从核心语法开始</h3>
<p>TS 的核心是 “类型约束”，以下是最常用的基础语法，结合代码逐一说明：</p>
<h4 data-id="heading-6">1. 基本类型注解</h4>
<p>TS 支持 JavaScript 的所有原始类型，并为其提供明确的类型注解，语法为<code>变量名: 类型 = 值</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 4.ts - 基本类型注解 </span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>; <span class="hljs-comment">// 数字类型 </span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>:<span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>; <span class="hljs-comment">// 字符串类型 </span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">c</span>:<span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 布尔类型 </span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">d</span>:<span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// null类型 </span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>:<span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// undefined类型</span>
</code></pre>
<p>这是 TS 最基础的用法，通过类型注解固定变量类型，避免随意变更。</p>
<h4 data-id="heading-7">2. 数组与元组</h4>
<ul>
<li>数组：指定数组内元素的统一类型，有两种写法：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">arr</span>:<span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>]; <span class="hljs-comment">// 数字数组：只能存放数字 </span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">arr2</span>:<span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>]; <span class="hljs-comment">// 泛型写法：字符串数组</span>
</code></pre>
<ul>
<li>元组：固定长度和位置的数组，每个位置类型可不同：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">user</span>:[<span class="hljs-built_in">number</span>,<span class="hljs-built_in">string</span>] = [<span class="hljs-number">1</span>,<span class="hljs-string">'Tom'</span>]; <span class="hljs-comment">// 第一个元素是数字，第二个是字符串</span>
</code></pre>
<h4 data-id="heading-8">3. 枚举类型（enum）</h4>
<p>枚举用于定义一组命名常量，提升代码可读性，比如状态码：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 4.ts - 枚举类型 </span>
<span class="hljs-built_in">enum</span> Status { 
    Pending, <span class="hljs-comment">// 默认值0 </span>
    Success, <span class="hljs-comment">// 默认值1 </span>
    Failed, <span class="hljs-comment">// 默认值2 } </span>
<span class="hljs-keyword">let</span> s:Status = Status.Pending; <span class="hljs-comment">// 赋值枚举值 </span>
s = Status.Success; <span class="hljs-comment">// 变更为成功状态</span>
</code></pre>
<p>相比直接使用数字<code>0/1/2</code>，枚举让状态含义更清晰。</p>
<h4 data-id="heading-9">4. any 与 unknown：灵活兼容与安全约束</h4>
<p>TS 支持 “放松类型约束” 的场景，核心是<code>any</code>和<code>unknown</code>：</p>
<ul>
<li><code>any</code>：“救命稻草”，放弃所有类型约束，变量可赋值任意类型，兼容原生 JS 代码：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">let aa:<span class="hljs-attr">any</span> = <span class="hljs-number">1</span><span class="hljs-comment">; </span>
<span class="hljs-attr">aa</span> = <span class="hljs-string">"11"</span><span class="hljs-comment">; // 允许赋值字符串 </span>
<span class="hljs-attr">aa</span> = {}<span class="hljs-comment">; // 允许赋值对象</span>
</code></pre>
<ul>
<li><code>unknown</code>：更安全的 “任意类型”，可接收任意值，但直接调用方法 / 属性会报错，需先做类型检测：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">let bb:<span class="hljs-attr">unknown</span> = <span class="hljs-number">1</span><span class="hljs-comment">; </span>
<span class="hljs-attr">bb</span> = <span class="hljs-string">'b'</span><span class="hljs-comment">; // 允许赋值字符串 </span>
bb.hello()<span class="hljs-comment">; // 报错：未知类型不能直接调用方法</span>
</code></pre>
<h4 data-id="heading-10">5. 接口（interface）与类型别名（type）：约束对象结构</h4>
<p>TS 通过<code>interface</code>或<code>type</code>约定对象的属性和类型，是大型项目的核心用法：</p>
<h5 data-id="heading-11">（1）接口（interface）：约定对象结构，支持可选属性、只读属性</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 4.ts - 接口约束 </span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> { 
    <span class="hljs-attr">name</span>:<span class="hljs-built_in">string</span>; <span class="hljs-comment">// 必选字符串属性 </span>
    <span class="hljs-attr">age</span>:<span class="hljs-built_in">number</span>; <span class="hljs-comment">// 必选数字属性 </span>
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>:<span class="hljs-built_in">number</span>; <span class="hljs-comment">// 只读属性，不可修改 </span>
    hobby?:<span class="hljs-built_in">string</span>; <span class="hljs-comment">// 可选属性，可省略 </span>
 } 
<span class="hljs-keyword">const</span> <span class="hljs-attr">u</span>:<span class="hljs-title class_">User</span> = { 
    <span class="hljs-attr">id</span>:<span class="hljs-number">1</span>, 
    <span class="hljs-attr">name</span>:<span class="hljs-string">'李四'</span>, 
    <span class="hljs-attr">age</span>:<span class="hljs-number">11</span>, 
    <span class="hljs-comment">// hobby可选，可省略 </span>
    }; 
u.<span class="hljs-property">name</span> = <span class="hljs-string">'瓦弟'</span>; <span class="hljs-comment">// 允许修改普通属性 </span>
u.<span class="hljs-property">id</span> = <span class="hljs-number">1111</span>; <span class="hljs-comment">// 报错：只读属性不能修改</span>
</code></pre>
<h5 data-id="heading-12">（2）类型别名（type）：自定义类型，支持联合类型、对象类型等</h5>
<pre><code class="hljs language-ini" lang="ini">// 4.ts - 类型别名 
type <span class="hljs-attr">ID</span> = string | number<span class="hljs-comment">; // 联合类型：ID可以是字符串或数字 </span>
let num:<span class="hljs-attr">ID</span> = <span class="hljs-number">111</span><span class="hljs-comment">; // 允许赋值数字 </span>
type <span class="hljs-attr">UserType</span> = { 
    name: string<span class="hljs-comment">; </span>
    age: number<span class="hljs-comment">; </span>
    hobby?:string<span class="hljs-comment">; </span>
 }<span class="hljs-comment">; </span>
const f:<span class="hljs-attr">UserType</span> = { 
    name:'牢大', 
    age:111 
    // hobby可选，省略不报错 }<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-13">三、总结：TS 为何成为大型项目的首选？</h3>
<p>TS 并非替代 JavaScript，而是在其基础上补充了静态类型系统，核心价值体现在：</p>
<ol>
<li><strong>提前纠错</strong>：编译期发现类型错误，降低运行时 bug 概率；</li>
<li><strong>提升可读性</strong>：类型注解充当 “自文档”，让代码逻辑更清晰；</li>
<li><strong>增强可维护性</strong>：类型约束减少 “隐式类型错误”，适配团队协作和大型项目迭代；</li>
<li><strong>兼容 JS 生态</strong>：完全兼容 JavaScript 语法，可渐进式接入，无需重构现有代码。</li>
</ol>
<p>对于初学者，TS 的类型约束可能增加一点学习成本，但这份成本能换来代码质量的显著提升 —— 正如示例中所示，TS 能杜绝 90% 因类型问题导致的错误，这也是如今 React、Vue 等主流框架均推荐使用 TS 的核心原因。从 “写得快” 到 “写得稳”，TS 让 JavaScript 从灵活的 “脚本语言”，真正适配企业级大型项目的开发需求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 官方纪录片观后：核心原理解析与来龙去脉]]></title>    <link>https://juejin.cn/post/7597080391879147530</link>    <guid>https://juejin.cn/post/7597080391879147530</guid>    <pubDate>2026-01-20T06:39:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597080391879147530" data-draft-id="7597080391879081994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 官方纪录片观后：核心原理解析与来龙去脉"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-20T06:39:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小朝快跑"/> <meta itemprop="url" content="https://juejin.cn/user/571401778248791"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 官方纪录片观后：核心原理解析与来龙去脉
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/571401778248791/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小朝快跑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T06:39:20.000Z" title="Tue Jan 20 2026 06:39:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><h2 data-id="heading-0">你真的理解 React 的运作方式吗？</h2>
<p>这段时间在回顾自己过去几年的 React 项目时，我发现一个有点尴尬但很真实的情况：
我能熟练写 Hooks、拆组件、做性能优化，但如果有人让我用几分钟解释清楚——<strong>React 内部到底是怎么运作的</strong>，我往往说不太清楚。</p>
<p>我意识到，自己更多是在“使用 React”，而不是对它的实现原理形成了稳定的直觉。</p>
<p>带着这个问题，我重新完整看了一遍 React 官方纪录片
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D8pDqJVdNa44" target="_blank" title="https://www.youtube.com/watch?v=8pDqJVdNa44" ref="nofollow noopener noreferrer">React.js: The Documentary</a>。
本文正是基于这次回看后的整理与思考，尝试从实现与演进的角度，把 React 那些零散的概念重新串起来。</p>
<hr/>
<h2 data-id="heading-1">1. 混乱的源头：React 诞生前的“状态噩梦”</h2>
<p>想象一下，你正在管理一家巨型餐厅。这家餐厅有数百名厨师（<code>Model</code>），数百名传菜员（<code>Controller</code>），以及成千上万的食客（<code>View</code>）。起初，一切运转良好。但随着规模扩大，情况开始失控：</p>
<ul>
<li><strong>双向的数据流 MVC 模式</strong>：传菜员不仅把菜从后厨端给客人，客人还能直接把菜退回给任意一位厨师，甚至自己跑进后厨修改菜单。</li>
<li><strong>不可预测的连锁反应</strong>：A 桌客人退了一道菜，这个动作莫名其妙地导致 B 桌的菜单被修改，C 桌的账单出现了错误。当 Bug 出现时，你根本无法追溯是哪个环节出了问题。</li>
</ul>
<p>这就是 React 诞生前，以 <code>MVC 架构</code>和<code>数据双向绑定</code>为主流的前端世界面临的“状态噩梦”。正如纪录片中提到的，Facebook 的广告系统和聊天系统就是这样复杂的“餐厅”。</p>
<p>随着应用规模的指数级增长，数据流向变得错综复杂、无法预测，这成为了 Bug 的温床，让开发者的大脑不堪重负，难以维护和理解代码。这，就是 Jordan Walke 和 Facebook 团队面临的根本问题。</p>
<p>面对这种混乱，React 提出了一个在当时看来极其疯狂，却又无比优雅的方案。</p>
<h2 data-id="heading-2">2. Jordan Walke 的“疯狂想法”：推倒一切，重新来过</h2>
<h3 data-id="heading-3">2.1 阐述核心思想</h3>
<p>面对 Jordan Walke 所说的前端开发中最难的<code>更新（Updates）</code>问题——即手动找到特定的 DOM 节点并小心翼翼地修改它，他提出了一个革命性的建议：<mark>“忘掉数据绑定，状态一变就把整个界面推倒重来。（blow away the entire UI and re-render all of it）”。</mark></p>
<p>这背后是一种深刻的<strong>函数式思想</strong>：<code>UI = f(state)</code>。</p>
<p>这意味着，<mark>用户界面（<code>UI</code>）永远只是当前状态（<code>State</code>）的一个纯粹的可视化映射。</mark><mark>开发者不再需要关心“如何从旧状态变到新状态”，只需关心“在某个特定状态下，UI 应该长什么样”。</mark></p>
<h3 data-id="heading-4">2.2 解释其颠覆性</h3>
<p>这种思想的颠覆性，可以用“修补旧衣服”和“直接换新衣服”来对比：</p>
<ul>
<li><strong>传统命令式（修补旧衣服）</strong>：当衣服破了个洞，你需要精确地找到破损的位置，选择合适的布料和针线，小心翼翼地进行修补。这个过程繁琐、易错，且每次修补都可能引入新的问题。这就是<strong>手动操作 <code>DOM</code></strong>。</li>
<li><strong>React 声明式（直接换新衣服）</strong>：你根本不关心衣服哪里破了。你只保留一个关于“理想衣服”的设计图（你的组件代码）。只要身材数据（<code>State</code>）有任何变化，你就直接根据最新的设计图，生成一件全新的、完美的衣服来替换旧的。</li>
</ul>
<p>这种模式将开发者的关注点从繁琐、易错的 DOM 操作中解放出来，<mark>只需专注于管理状态本身</mark>，极大地降低了构建复杂应用的认知负荷。</p>
<p>然而，“推倒一切重新渲染”听起来会导致严重的性能问题。React 是如何让这个想法在现实中变得高效可行的呢？</p>
<h2 data-id="heading-5">3. 化腐朽为神奇：React 的三大核心引擎</h2>
<p>React 并非真的在浏览器中“推倒一切”，而是通过三大核心引擎，将这个“疯狂想法”变得无比高效。</p>
<h3 data-id="heading-6">3.1 Virtual DOM：聪明的“质检员”</h3>
<p><code>Virtual DOM</code> (虚拟 DOM) 是 React 的性能基石。它让“重新渲染一切”的狂野想法在性能上变得可行。</p>
<ol>
<li><strong>建筑草图对比</strong>：React 并不直接操作昂贵的真实 <code>DOM</code>（真实的建筑）。而是在内存中维护两份轻量级的 UI “草图”（<code>Virtual DOM</code>）：<strong>更新前的</strong>与<strong>根据新状态生成的</strong>。</li>
<li><strong>找出差异</strong>：当状态变化时，它会对比新旧两份“草图”，通过高效的 <code>diff</code> 算法，快速找出真正变化的差异点。</li>
<li><strong>精准施工</strong>：最后，它只把真正发生变化的“砖瓦”（<code>DOM</code> 节点）更新到真实的建筑（<code>DOM</code>）上，从而实现<strong>最小化更新</strong>。</li>
</ol>
<p>纪录片中一个极具说服力的故事来自 React 早期贡献者 Christopher Chedeau。在加入 Facebook 前，他曾为《魔兽世界》开发过一个公会搜索工具，并花费了数月时间，手动极致优化了一个包含 20,000 个条目的列表搜索功能。后来，当他尝试用 React 重写这个工具时，只用了半小时就实现了功能，并且性能与之前手动优化的代码处于同一数量级。</p>
<p>这正是 React 让 <code>UI = f(state)</code> 这一<strong>声明式模型</strong>在现实世界中变得足够高效的秘诀。</p>
<h3 data-id="heading-7">3.2 JSX：一场关于“关注点分离”的哲学革命</h3>
<p>JSX 在诞生之初曾遭遇毁灭性的抨击，因为它挑战了当时前端开发的“黄金法则”。</p>
<ol>
<li><strong>历史争议</strong>：在 2013 年的 JSConf 上，当 React 团队展示在 JavaScript 文件中编写类似 <code>HTML</code> 的 <code>JSX</code> 语法时，社区的反应是“这帮 Facebook 的工程师疯了”。当时的黄金法则是<strong>关注点分离</strong>，即 <code>HTML</code>、<code>CSS</code> 和 <code>JS</code> 必须分属不同文件目录，将它们混在一起被视为开历史的倒车。</li>
<li><strong>揭示深层逻辑</strong>：Jordan Walke 认为，<mark>真正的“关注点分离”不应是按技术（文件类型）分离，而应是按功能（组件）分离。</mark></li>
</ol>
<ul>
<li><strong>逻辑高度耦合</strong>：以一个“新闻流”组件为例，其 HTML 结构、CSS 样式和点击交互逻辑是紧密耦合、共同服务于一个单一功能的。</li>
<li><strong>原子化思维</strong>：将这些<strong>高度内聚</strong>的代码放在同一个目录（一个组件）中，反而使得这个功能单元更加独立、易于测试和复用。这才是更高级的、符合“原子化（Atomic）”思维的关注点分离。</li>
</ul>
<ol start="3">
<li>
<p><strong>关键案例：Netflix 的“30 天生死竞赛”</strong></p>
<p>当时，Netflix 需要重构其网站，在传统的 <code>Backbone.js</code> 和新潮的 React 之间犹豫不决。他们组织了一场为期 30 天的竞赛，让两组团队分别使用两种技术构建原型。结果，React 团队大获全胜，不仅开发速度更快，而且在处理复杂 UI 时表现出更高的性能和稳定性。这次工业界的有力背书，直接将 React 从“实验室怪胎”推向了“行业标准”的宝座。</p>
</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Greeting</span>(<span class="hljs-params">{ name }: { name: <span class="hljs-built_in">string</span> }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, {name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
}
</code></pre>
<h3 data-id="heading-8">3.3 Fiber：丝滑调度的“时间管理大师”</h3>
<p><mark>即便有了 <code>Virtual DOM</code>，当组件树变得极其庞大时，计算新旧“草图”差异的过程本身也可能耗时过长，阻塞浏览器主线程，导致界面卡顿。</mark></p>
<p><code>Fiber</code> 架构正是为了让 <code>UI = f(state)</code> 哲学在 Facebook 规模的超大型应用中也能完美运行的最终答案，因为在这种规模下，即使是 <code>Virtual DOM</code> 的 <code>Diff</code> 过程本身也可能成为<strong>性能瓶颈</strong>。为此，React 16 引入了全新的 <code>Fiber</code> 架构作为底层重写，并最终在 React 18 中通过并发模式（<code>Concurrent Mode</code>）将其全部能力开放给开发者。</p>
<ol>
<li><strong>动机</strong>：<mark>旧的同步递归渲染机制就像一个“铁人厨师”，一旦开始做一桌满汉全席（<strong><em>渲染超大组件树</em></strong>），就必须做完所有菜才能停下来，<strong><em>期间无法响应顾客的任何新需求（如用户点击），导致界面“假死”。</em></strong></mark></li>
<li><strong>核心机制</strong>：
<ul>
<li><strong>任务拆解</strong>：<code>Fiber</code> 将渲染这道“大餐”拆解成许多可中断的“工作单元”（切菜、下锅、装盘）。<mark>每完成一个小单元，React 都会停下来，把控制权交还给浏览器，询问是否有更高优先级的任务（如用户输入）需要处理。</mark></li>
<li><strong>链表结构</strong>：为了实现<mark>可中断性</mark>，Fiber 放弃了传统的、一旦开始就无法停止的递归树遍历，改用链表结构。每个 Fiber 节点都有 <code>child</code>（子节点）、<code>sibling</code>（兄弟节点）、<code>return</code>（父节点）三个指针。这就像一套“书签”，让 React 可以随时暂停工作，并在稍后精准地回到暂停的位置继续。</li>
<li><strong>双缓冲技术</strong>：为了<mark>避免更新过程中的界面闪烁</mark>，Fiber 在内存中构建一棵“在建树（<code>work-in-progress tree</code>）”。<mark>所有计算和变更都在这棵不可见的树上进行。只有当整棵树完全准备就绪后，React 才会通过一个极快的指针切换操作，让它瞬间渲染在页面上，替换掉旧树。</mark></li>
</ul>
</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">FiberNode</span> = {
  <span class="hljs-attr">child</span>: <span class="hljs-title class_">FiberNode</span> | <span class="hljs-literal">null</span>
  <span class="hljs-attr">sibling</span>: <span class="hljs-title class_">FiberNode</span> | <span class="hljs-literal">null</span>
  <span class="hljs-attr">return</span>: <span class="hljs-title class_">FiberNode</span> | <span class="hljs-literal">null</span>
}
</code></pre>
<p>当 UI 的渲染引擎变得无比强大后，如何为它提供清晰、可预测的“燃料”（数据），就成了新的核心议题。</p>
<h2 data-id="heading-9">4. 驯服数据流：从 Flux 到现代状态管理方案</h2>
<p>当渲染问题被完美解决后，下一个挑战就是确保 <code>UI = f(state)</code> 中的 <code>state</code> 本身是<strong>可预测</strong>和<strong>易于管理</strong>的。这催生了 <code>Flux</code> 架构。</p>
<h3 data-id="heading-10">4.1 Flux 架构：为数据流动建立“交通规则”</h3>
<ol>
<li><strong>定义</strong>：Flux 并非一个库或框架，而是由 Facebook 工程师陈静（Jing Chen）提出的一套架构思想——为应用数据流设计的<strong>交通规则</strong>。</li>
<li><strong>核心原则</strong>：这套架构诞生于 Facebook 臭名昭著的、充满 Bug 的消息系统所带来的混乱之中：一个未读消息数的微小变化就可能引发一连串不可预测的 Bug。<mark>Flux 强制规定了单向数据流，所有数据的变化必须严格遵循 <code>Action → Store → View</code> 的单向循环。</mark></li>
</ol>
<blockquote>
<p><strong><code>Action</code> (动作)</strong>：视图层发出的消息，描述发生了什么。</p>
<p><strong><code>Store</code> (存储)</strong>：应用状态和逻辑的中心，接收 Action 并更新自身状态。</p>
<p><strong><code>View</code> (视图)</strong>：根据 Store 中的新状态重新渲染。</p>
</blockquote>
<p>这种严格的单向循环，确保了任何状态变化都是可追溯、可预测的，彻底解决了数据乱流的问题。</p>
<h3 data-id="heading-11">4.2 Redux 的诞生：一场“演示驱动开发”的意外</h3>
<p><code>Redux</code> 的诞生充满戏剧性。当时，开发者 Dan Abramov 深受 Bret Victor 关于“时间旅行调试”的前瞻性演示的启发，希望在一场技术演讲中实现一个类似的酷炫功能——<strong>可以像拖动视频进度条一样回溯和重放应用的状态变化</strong>。为了这个目标，他将 Flux 的思想进行了简化和函数化，创造出了一个概念验证原型。</p>
<p>这个无心插柳的“演示驱动开发”产物，因其极致的可预测性和强大的调试能力，意外地成为了后来数年间统治前端状态管理的标准。</p>
<h3 data-id="heading-12">4.3 回到工程现场：我到底该把状态放在哪里？</h3>
<p>如果只看 <code>Flux</code> 和 <code>Redux</code> 的演进历史，状态管理似乎是一条非常清晰的演化路线。
但真正进入工程实践后，我才意识到：<strong>状态管理并不是一个一开始就能选对的决策</strong>。</p>
<p>在我自己的 React / umi 项目中，很长一段时间里，我其实处在一种并不完全确定的状态里：</p>
<ul>
<li>一开始会使用 <code>useContext + Provider</code>，解决最直接的状态共享问题</li>
<li>在 umi 项目中，自然会想到使用 <code>useModel</code></li>
<li>当状态开始被多个模块频繁依赖，又会开始考虑引入 <code>zustand</code></li>
</ul>
<p>但随之而来的，是一连串并不容易回答的问题：</p>
<blockquote>
<p>什么时候 <code>useModel</code> 就已经足够？</p>
<p>什么时候引入 <code>zustand</code> 是合理的复杂度，而不是过度设计？</p>
<p><code>useContext</code> 到底适合做全局状态，还是只适合小范围共享？</p>
</blockquote>
<p>这些困惑，并不是因为工具本身复杂，而是因为它们都在解决“状态共享”这个问题，但切入点并不相同。</p>
<hr/>
<h3 data-id="heading-13">4.4 从工程直觉出发，重新理解现代状态管理工具</h3>
<p>从工程直觉出发，他们并非简单的替代关系，而是针对<strong>传输成本</strong>、<strong>开发效率</strong>与<strong>性能精度</strong>三个维度的不同取舍。</p>
<h4 data-id="heading-14"><code>Context</code>（基础：送餐电梯）</h4>
<ul>
<li><strong>类比</strong>：电梯。它只负责把“菜”（数据）从顶层厨房传到负二层，避免服务员每层跑（即避开 Props 逐层传递）。</li>
<li><strong>重渲染原理</strong>：它是<strong>全量广播</strong>。一旦电梯里的菜变了，所有正在等这部电梯的客人（消费者组件）都会被强制检查并重新渲染，即便他们只想喝水而电梯里换的是牛排。</li>
<li><strong>工程建议</strong>：仅用于低频更新、全站通用的静态数据（如主题、语言、用户信息）。</li>
</ul>
<h4 data-id="heading-15"><code>useContext</code> + <code>useReducer</code>（升级：规范化厨房）</h4>
<ul>
<li><strong>类比</strong>：电梯 + 严格的菜谱。<code>useReducer</code> 确保了做菜逻辑（状态变更）是可预测的单向流（<code>Action -&gt; Reducer</code>）。</li>
<li><strong>重渲染原理</strong>：<strong>依然是全量广播</strong>。虽然更新逻辑变严谨了，但分发渠道还是那部“电梯”，<mark>数据一变，所有消费者依然会集体重渲染</mark>。</li>
<li><strong>工程建议</strong>：适合中小型项目，需要一定的状态变更规范，但组件树规模还没到产生性能瓶颈的程度。</li>
</ul>
<h4 data-id="heading-16"><code>useModel</code>（Umi）：自动化胶囊舱</h4>
<ul>
<li><strong>类比</strong>：自动化封装的独立电梯。它本质是 <code>Context</code> 的自动化封装，让你写 <code>Hook</code> 的手感就像在写全局 <code>Model</code>。</li>
<li><strong>重渲染原理</strong>：与 <code>Context</code> 一致。只要 <code>Model</code> 里的状态变了，所有调了该 <code>useModel</code> 的组件都会一起动。</li>
<li><strong>工程建议</strong>：追求极致开发效率的企业级中后台项目，在 Umi 生态下可以快速实现逻辑共享。</li>
</ul>
<h4 data-id="heading-17"><code>Zustand</code>：精准自动售货机</h4>
<ul>
<li><strong>类比</strong>：特种部队。它虽然也遵循单向数据流，但不再依赖电梯。</li>
<li><strong>重渲染原理</strong>：精准订阅（<code>Selector</code>）。组件像是在售货机上点单，只有当它订阅的那个“特定零食”（数据切片）变了，它才会重新渲染。即便有 20,000 个节点，它也能把影响范围锁定在最小单元。</li>
<li><strong>工程建议</strong>：大多数现代 React 项目的首选，特别是当业务复杂、需要高性能局部更新时。</li>
</ul>
<p>核心总结表：</p>








































<table><thead><tr><th>工具</th><th>工程角色</th><th>渲染精度</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td><code>Context</code></td><td>传输工具</td><td>广播式（低）</td><td>零成本、原生支持</td><td>易引发全量重渲染</td></tr><tr><td><code>useContext</code> + <code>useReducer</code></td><td>逻辑规范</td><td>广播式（低）</td><td>逻辑可预测</td><td>模板代码多、性能难调优</td></tr><tr><td><code>useModel</code></td><td>逻辑共享</td><td>广播式（中）</td><td>开发体验（DX）极佳</td><td>绑定框架、底层性能受限</td></tr><tr><td><code>Zustand</code></td><td>性能引擎</td><td>精准订阅（高）</td><td>高性能、无模板代码</td><td>需引入第三方库</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">4.5 Redux 在今天的角色：高上限，但有成本</h3>
<p>至于 <code>Redux</code>，我反而越来越把它视为一种<strong>能力上限很高，但组织成本同样明确存在</strong>的方案。</p>
<p>在真正需要严格数据流约束、完整调试链路（例如时间旅行、复杂中间件）的大型应用中，Redux 依然非常可靠；
但在很多业务型项目里，我更倾向于先使用更轻量的方案，把复杂度留给未来真正需要的时候。</p>
<hr/>
<p>回过头来看，React 生态中的这些状态管理方案，本质上都是在回答同一个问题：
<strong>如何让 <code>UI = f(state)</code> 中的 <code>state</code>，同样保持可预测、可推理。</strong></p>
<p>理解它们的差异，并不只是为了“选对工具”，而是为了在工程复杂度不断上升之前，提前意识到哪些问题是迟早会出现的。</p>
<h2 data-id="heading-19">5. 纪录片带给我们的启示：前端开发的最佳实践</h2>
<ul>
<li><strong>拥抱“原子化”思想</strong>：React 通过 <code>JSX</code> 重新定义了关注点分离，其核心是<mark>将 UI 拆分为独立的、可测试的、可复用的组件</mark>。这种思想鼓励我们构建高内聚、低耦合的功能单元，是现代前端工程化的基石。</li>
<li><strong>坚持单向数据流</strong>：从 <code>Flux</code> 到 <code>Redux</code> 再到 <code>Zustand</code>，状态管理库的形式在变，但其<mark>内核——单向数据流原则</mark>，始终是保证大型应用状态可预测、行为可控的黄金法则。</li>
<li><strong>价值驱动创新</strong>：Redux 的诞生故事告诉我们，最好的工具往往不是为了追求技术而技术，而是为了解决一个真实、具体且有价值的问题（如提升调试体验）而创造的。真正的创新源于对实际痛点的深刻洞察。</li>
</ul>
<h2 data-id="heading-20">6. 结语与延伸阅读</h2>
<p>React 的成功绝非偶然。它是一系列深刻洞察、大胆创新、社区共建以及关键时刻（如 Netflix 的选择）共同作用的结果。它从一个解决 Facebook 内部复杂 UI 问题的“疯狂想法”，演变成了一个庞大而繁荣的生态系统。</p>
<p>理解 React 演进背后的“为什么”，不仅仅是了解一段技术历史。它能帮助我们建立起对前端架构的宏观认知，让我们在面对未来层出不穷的新技术时，能够拨开表象，抓住本质，从而做出更明智、更长远的技术选型和架构设计。</p>
<h3 data-id="heading-21">延伸阅读</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fresults%3Fsearch_query%3DReact.js%253A%2BThe%2BDocumentary" target="_blank" title="https://www.youtube.com/results?search_query=React.js%3A+The+Documentary" ref="nofollow noopener noreferrer">React.js: The Documentary（YouTube）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fresults%3Fsearch_query%3DDan%2BAbramov%2BLive%2BReact%2BHot%2BReloading%2Bwith%2BTime%2BTravel%2BReact%2BEurope%2B2015" target="_blank" title="https://www.youtube.com/results?search_query=Dan+Abramov+Live+React+Hot+Reloading+with+Time+Travel+React+Europe+2015" ref="nofollow noopener noreferrer">Dan Abramov - Live React: Hot Reloading with Time Travel（React Europe 2015）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2F" target="_blank" title="https://react.dev/" ref="nofollow noopener noreferrer">React 官方文档：Reconciliation（协调）等核心概念</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot之@Transactional注解实践]]></title>    <link>https://juejin.cn/post/7596991930984857651</link>    <guid>https://juejin.cn/post/7596991930984857651</guid>    <pubDate>2026-01-20T06:42:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596991930984857651" data-draft-id="7596990822127927334" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot之@Transactional注解实践"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-20T06:42:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇小汤圆"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot之@Transactional注解实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇小汤圆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T06:42:05.000Z" title="Tue Jan 20 2026 06:42:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Spring Boot大行其道的时代，开发者可以通过@Transactional注解来方便的操作事务</p>
<h2 data-id="heading-0"><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D167037274%26content_type%3DArticle%26match_order%3D1%26q%3D%25E9%259A%2594%25E7%25A6%25BB%25E7%25BA%25A7%25E5%2588%25AB%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=167037274&amp;content_type=Article&amp;match_order=1&amp;q=%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB&amp;zhida_source=entity" ref="nofollow noopener noreferrer">隔离级别</a></strong></h2>
<p>@Transactional注解的isolation属性，可用来设置隔离级别。默认值为Isolation.DEFAULT。该属性可选值有：</p>
<ul>
<li><strong>Isolation.DEFAULT</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D167037274%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%2595%25B0%25E6%258D%25AE%25E6%25BA%2590%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=167037274&amp;content_type=Article&amp;match_order=1&amp;q=%E6%95%B0%E6%8D%AE%E6%BA%90&amp;zhida_source=entity" ref="nofollow noopener noreferrer">数据源</a>默认隔离级别</li>
<li><strong>Isolation.READ_UNCOMMITTED</strong>：未提交读</li>
<li><strong>Isolation.READ_COMMITTED</strong>：已提交读</li>
<li><strong>Isolation.REPEATABLE_READ</strong>：可重复读</li>
<li><strong>Isolation.SERIALIZABLE</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D167037274%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25B8%25B2%25E8%25A1%258C%25E5%258C%2596%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=167037274&amp;content_type=Article&amp;match_order=1&amp;q=%E4%B8%B2%E8%A1%8C%E5%8C%96&amp;zhida_source=entity" ref="nofollow noopener noreferrer">串行化</a></li>
</ul>
<h2 data-id="heading-1"><strong>回滚条件</strong></h2>
<p>@Transactional注解默认只会对RuntimeException、Error及其子类进行回滚。如果期望对检查异常进行回滚，可通过rollbackFor、rollbackForClassName属性添加新的回滚条件</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 方式1: 支持对所有异常类型进行回滚</span>
<span class="hljs-variable">@Transactional</span>(rollbackFor = Exception.class)
<span class="hljs-comment">// 方式2：支持对所有异常类型进行回滚</span>
<span class="hljs-variable">@Transactional</span>(rollbackForClassName = {<span class="hljs-string">"Exception"</span>})
</code></pre>
<p>类似地，还可以排除某些异常，使之不发生回滚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 方式1: 抛出ArithmeticException异常不进行回滚</span>
<span class="hljs-variable">@Transactional</span>(noRollbackForClassName = {<span class="hljs-string">"ArithmeticException"</span>} )
<span class="hljs-comment">// 方式2: 抛出ArithmeticException异常不进行回滚</span>
<span class="hljs-variable">@Transactional</span>(noRollbackFor = {ArithmeticException.class} )
</code></pre>
<p>上述四种回滚条件的属性对指定异常的子类也是生效的</p>
<h2 data-id="heading-2"><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D167037274%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%258F%25AA%25E8%25AF%25BB%25E4%25BA%258B%25E5%258A%25A1%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=167037274&amp;content_type=Article&amp;match_order=1&amp;q=%E5%8F%AA%E8%AF%BB%E4%BA%8B%E5%8A%A1&amp;zhida_source=entity" ref="nofollow noopener noreferrer">只读事务</a></strong></h2>
<p>@Transactional注解的readOnly属性默认为false，如需只读事务可将其配置为true。在只读事务中不允许执行读之外操作，否则事务将会回滚</p>
<h2 data-id="heading-3"><strong>事务传播行为</strong></h2>
<p>@Transactional注解的propagation属性可用来设置事务传播行为，默认值为<strong>Propagation.REQUIRED</strong>。其用来表示当一个事务传播行为修饰的方法(即methodB)被另一个方法(即methodA)调用时，事务如何进行传播</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceA</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodA</span>(<span class="hljs-params"/>) {
        ...
        serviceB.<span class="hljs-title function_">methodB</span>();
        ...
    }

}
...
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceB</span> {

    <span class="hljs-comment">// 通过propagation属性指定methodB方法的事务传播行为</span>
    <span class="hljs-meta">@Transactional</span>(propagation = ...)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodB</span>(<span class="hljs-params"/>) {
        ...
    }

}
</code></pre>
<h2 data-id="heading-4"><strong>Propagation.REQUIRED</strong></h2>
<p>支持当前事务；如果当前没有事务，则新建一个事务。如下图所示。这也是日常开发中最常使用的配置。在Case 1的场景下，无论methodA方法还是methodB方法出现异常，均会进行回滚，因为它们是在同一个事务中</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a44c2ce70df4aeea65f8793bad1d0ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769496125&amp;x-signature=EFT8z5u5kmPOTGFWbMpinGNm4M8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5"><strong>Propagation.REQUIRES_NEW</strong></h2>
<p>新建事务；如果当前存在事务，则把当前事务挂起。如下图所示。以Case 1为例进行分析，由于methodA、methodB方法使用的是两个不同的事务，故当methodB方法提交后，即使methodA方法失败回滚了，也不会导致methodB方法出现回滚。当methodB方法失败回滚后，如果methodA未捕获methodB所抛出的异常，导致methodA继续抛出该异常则methodA方法也会被回滚；如果methodA方法捕获methodB所抛出的异常，则methodA所在的事务还是有可能提交成功的</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f71b11f1d54d469286533ad01a126658~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769496125&amp;x-signature=NrpmzZnxjd6SjRGLCFwpl2AAHEg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6"><strong>Propagation.SUPPORTS</strong></h2>
<p>支持当前事务；否则将非事务方式执行。如下图所示</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/965d90479ac649e8b0440e6f49be8c52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769496125&amp;x-signature=JGvf7XgX8Pog31s7E%2BC8cXgNZ5Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7"><strong>Propagation.MANDATORY</strong></h2>
<p>支持当前事务；否则将抛出IllegalTransactionStateException异常，此时不仅methodB方法无法得到执行，也会打断methodA方法的执行流程，除非在methodA方法中捕获处理该异常。如下图所示</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95b11835159d4b8f8b0eb6171c9bff00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769496125&amp;x-signature=hrPKaohX2yxwauSTaBMMZf2Cm9M%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8"><strong>Propagation.NOT_SUPPORTED</strong></h2>
<p>不支持当前事务，而是始终以非事务的方式执行。如下图所示</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ded69d300434710a45aa830c511f1cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769496125&amp;x-signature=KgXcRStRtz2uU6WLj1OHvlJu66o%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9"><strong>Propagation.NEVER</strong></h2>
<p>以非事务方式执行；如果当前存在事务，则抛出IllegalTransactionStateException异常，此时不仅methodB方法无法得到执行，还会打断methodA方法的执行流程，甚至导致methodA方法发生回滚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e95f7fc8611f4893af51de62130888ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769496125&amp;x-signature=%2FxLgnhjRucFG7e4fPjfOoBtilwQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10"><strong>Propagation.NESTED</strong></h2>
<p>如果当前存在事务，则对于该传播行为修饰的方法会依然使用当前事务，这样一旦methodA方法进行回滚，则methodB方法也会进行回滚。但由于该传播行为是通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D167037274%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%25E4%25BA%258B%25E5%258A%25A1%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=167037274&amp;content_type=Article&amp;match_order=1&amp;q=%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1&amp;zhida_source=entity" ref="nofollow noopener noreferrer">数据库事务</a>的保存点进行实现的，那么一旦methodB方法抛出异常发生回滚。如果methodA方法捕获了methodB方法所抛出的异常，则methodA就不会因此而回滚；而methodA方法如果继续向上抛出异常则其也会被回滚；如果当前没有事务，则新建一个事务。如下图所示</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26237c97500f488197c02c9de4c6e474~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769496125&amp;x-signature=S%2FQ4iAOWoemVLr07nJ88TsQVvCo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11"><strong>Note</strong></h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D167037274%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25BA%258B%25E5%258A%25A1%25E6%25B3%25A8%25E8%25A7%25A3%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=167037274&amp;content_type=Article&amp;match_order=1&amp;q=%E4%BA%8B%E5%8A%A1%E6%B3%A8%E8%A7%A3&amp;zhida_source=entity" ref="nofollow noopener noreferrer">事务注解</a>只会对public方法生效</strong></li>
</ol>
<p>当@Transactional事务注解添加在类上，表示其将作用于该类中的所有public方法</p>
<ol>
<li><strong>通过类内部调用<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D167037274%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25BA%258B%25E5%258A%25A1%25E6%2596%25B9%25E6%25B3%2595%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=167037274&amp;content_type=Article&amp;match_order=1&amp;q=%E4%BA%8B%E5%8A%A1%E6%96%B9%E6%B3%95&amp;zhida_source=entity" ref="nofollow noopener noreferrer">事务方法</a>，事务无法生效</strong></li>
</ol>
<p>例如下面代码所示，在A类内部通过一个普通方法methodA调用事务方法methodB，那么methodB的事务会生效么？</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodA</span>(<span class="hljs-params"/>) {
        ...
        <span class="hljs-title function_">methodB</span>();
        ...
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodB</span>(<span class="hljs-params"/>) {
        ...
    }

}
</code></pre>
<p>答案是<strong>否</strong>，原因很简单。这里我们将Spring AOP后的动态代理类ProxyA用<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D167037274%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25BC%25AA%25E4%25BB%25A3%25E7%25A0%2581%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=167037274&amp;content_type=Article&amp;match_order=1&amp;q=%E4%BC%AA%E4%BB%A3%E7%A0%81&amp;zhida_source=entity" ref="nofollow noopener noreferrer">伪代码</a>的形式给出，如下所示。可以看到，虽然动态代理类ProxyA中的methodB方法被加入了事务切面。但事实上调用ProxyA的methodA方法后，会直接进入目标类A中，即执行a.methodA()方法，然后直接调用A类中的methodB方法。换言之，methodB方法没有通过代理类ProxyA进行调用，自然其事务注解不会生效</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProxyA</span> {

    <span class="hljs-keyword">private</span> A a = <span class="hljs-keyword">new</span> A();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">methodA</span>()</span> {
        <span class="hljs-comment">// 执行目标方法</span>
        a.methodA();
    }


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">methodB</span>()</span> {
        <span class="hljs-comment">// 前置增强</span>
        ...
        <span class="hljs-comment">// 执行目标方法</span>
        a.methodB();
        <span class="hljs-comment">// 后置增强</span>
        ...
    }

}
</code></pre>
<p>即使在A类的methodA上也添加@Transactional事务注解，methodB方法由于没走代理类ProxyA，故methodB方法依然还是使用methodA方法的事务。即使将methodB方法的传播行为设置为Propagation.REQUIRES_NEW，也不会重新开启一个新的事务。因为methodB方法连@Transactional注解都无法生效，设置传播行为更是无任何意义</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你真的知道npm是什么吗？]]></title>    <link>https://juejin.cn/post/7596962772145258511</link>    <guid>https://juejin.cn/post/7596962772145258511</guid>    <pubDate>2026-01-20T05:20:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596962772145258511" data-draft-id="7596989416760655907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你真的知道npm是什么吗？"/> <meta itemprop="keywords" content="前端,Node.js"/> <meta itemprop="datePublished" content="2026-01-20T05:20:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不想秃头的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/2754702534251820"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你真的知道npm是什么吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2754702534251820/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不想秃头的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:20:37.000Z" title="Tue Jan 20 2026 05:20:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为前端开发者，<code>npm</code> (Node Package Manager) 是我们日常开发中绕不开的工具 —— 从初始化项目、安装依赖，到发布自己的包，它贯穿了前端工程化的全流程。但很多开发者只停留在 <code>npm install</code> 的层面，对其核心原理和高级用法知之甚少。这篇文章将从基础到进阶，全方位拆解 npm，让你真正吃透这个工具。</p>
<h2 data-id="heading-0">一、npm 是什么？</h2>
<p><code>npm</code> 是 Node.js 的官方包管理工具，核心作用有三个：</p>
<ol>
<li><strong>包管理</strong>：安装、卸载、更新第三方依赖包（如 Vue、React、axios 等）；</li>
<li><strong>项目管理</strong>：通过 <code>package.json</code> 管理项目的元信息（名称、版本、脚本、依赖等）；</li>
<li><strong>脚本运行</strong>：执行自定义的命令脚本（如 <code>npm run dev</code>、<code>npm run build</code>）。</li>
</ol>
<blockquote>
<p>补充：npm 随 Node.js 一起安装，安装 Node.js 后即可使用（验证：终端输入 <code>npm -v</code> 查看版本）。</p>
</blockquote>
<h2 data-id="heading-1">二、npm 核心基础操作</h2>
<h3 data-id="heading-2">2.1 初始化项目（npm init）</h3>
<p>创建 <code>package.json</code>（项目核心配置文件）是使用 npm 的第一步：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 交互式初始化（手动输入项目信息）</span>
npm init

<span class="hljs-comment"># 快速初始化（所有选项默认，推荐日常使用）</span>
npm init -y
</code></pre>
<p>执行后会生成 <code>package.json</code> 文件，核心字段说明：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-project"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 项目名称（小写、无空格）</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// 版本号（遵循语义化版本规范）</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>    <span class="hljs-comment">// 项目描述</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"index.js"</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// 入口文件</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// 自定义脚本</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// 生产环境依赖</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span> <span class="hljs-comment">// 开发环境依赖</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">2.2 安装依赖（npm install）</h3>
<p>这是最常用的命令，核心用法分三类：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 安装单个包（生产环境，写入 dependencies）</span>
npm install axios
<span class="hljs-comment"># 简写：npm i axios</span>

<span class="hljs-comment"># 2. 安装到开发环境（写入 devDependencies）</span>
npm install webpack --save-dev
<span class="hljs-comment"># 简写：npm i webpack -D</span>

<span class="hljs-comment"># 3. 安装指定版本</span>
npm install vue@3.4.0

<span class="hljs-comment"># 4. 安装全局包（如脚手架、工具类）</span>
npm install @vue/cli -g

<span class="hljs-comment"># 5. 安装 package.json 中所有依赖</span>
npm install
</code></pre>
<h3 data-id="heading-4">2.3 卸载 / 更新依赖</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 卸载依赖</span>
npm uninstall axios
<span class="hljs-comment"># 简写：npm un axios</span>

<span class="hljs-comment"># 更新依赖</span>
npm update axios

<span class="hljs-comment"># 查看可更新的依赖</span>
npm outdated
</code></pre>
<h3 data-id="heading-5">2.4 运行自定义脚本（npm run）</h3>
<p>在 <code>package.json</code> 的 <code>scripts</code> 字段中定义脚本，通过 <code>npm run &lt;脚本名&gt;</code> 执行：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"jest"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash">npm run dev   <span class="hljs-comment"># 启动开发服务</span>
npm run build <span class="hljs-comment"># 打包构建</span>
npm run <span class="hljs-built_in">test</span>  <span class="hljs-comment"># 执行测试</span>
</code></pre>
<blockquote>
<p>小技巧：<code>start</code>、<code>test</code> 等内置脚本可省略 <code>run</code>，直接 <code>npm start</code>、<code>npm test</code>。</p>
</blockquote>
<h2 data-id="heading-6">三、npm 核心概念解析</h2>
<h3 data-id="heading-7">3.1 依赖类型：dependencies vs devDependencies</h3>




















<table><thead><tr><th>类型</th><th>用途</th><th>示例</th></tr></thead><tbody><tr><td>dependencies</td><td>生产环境依赖（项目运行必需）</td><td>axios、vue、react</td></tr><tr><td>devDependencies</td><td>开发环境依赖（仅开发 / 构建时使用）</td><td>webpack、vite、eslint</td></tr></tbody></table>
<p><strong>核心区别</strong>：执行 <code>npm install --production</code> 时，只会安装 <code>dependencies</code> 中的依赖（生产环境部署常用）。</p>
<h3 data-id="heading-8">3.2 package-lock.json 的作用</h3>
<p>很多开发者会疑惑：为什么安装依赖后会生成 <code>package-lock.json</code>？</p>
<ul>
<li><strong>锁定版本</strong>：记录每个依赖的精确版本、下载地址、依赖树，确保不同环境安装的依赖版本完全一致；</li>
<li><strong>加速安装</strong>：后续安装时无需重新解析依赖树，直接从 <code>package-lock.json</code> 读取，速度更快；</li>
<li><strong>注意</strong>：<code>package-lock.json</code> 需提交到 Git 仓库，不要手动修改！</li>
</ul>
<h3 data-id="heading-9">3.3 语义化版本（SemVer）</h3>
<p>npm 依赖版本遵循「语义化版本规范」，格式为：<code>主版本.次版本.补丁版本</code>（如 <code>3.4.2</code>）：</p>
<ul>
<li><strong>主版本（MAJOR）</strong> ：不兼容的 API 变更（如 2.0.0 → 3.0.0）；</li>
<li><strong>次版本（MINOR）</strong> ：兼容的功能新增（如 3.3.0 → 3.4.0）；</li>
<li><strong>补丁版本（PATCH）</strong> ：兼容的 bug 修复（如 3.4.1 → 3.4.2）。</li>
</ul>
<p>版本号前的符号含义（package.json 中常见）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.4.0"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 允许次版本和补丁更新（3.4.0 → 3.9.9）</span>
    <span class="hljs-attr">"axios"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~1.6.0"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 仅允许补丁更新（1.6.0 → 1.6.9）</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"*"</span> <span class="hljs-comment">// 任意版本</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-10">四、npm 高级用法</h2>
<h3 data-id="heading-11">4.1 查看包信息</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看包的详细信息（版本、依赖、文档地址等）</span>
npm info axios

<span class="hljs-comment"># 查看当前项目已安装的依赖</span>
npm list
<span class="hljs-comment"># 只看顶层依赖（更清晰）</span>
npm list --depth=0

<span class="hljs-comment"># 查看全局安装的包</span>
npm list -g --depth=0
</code></pre>
<h3 data-id="heading-12">4.2 发布自己的 npm 包</h3>
<p>如果你想分享自己的工具包到 npm 仓库，步骤如下：</p>
<ol>
<li>
<p><strong>注册 npm 账号</strong>：官网 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2F" target="_blank" title="https://www.npmjs.com/" ref="nofollow noopener noreferrer">npmjs.com</a> 注册，或终端执行 <code>npm adduser</code>；</p>
</li>
<li>
<p><strong>初始化包</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> my-utils &amp;&amp; <span class="hljs-built_in">cd</span> my-utils
npm init -y
</code></pre>
</li>
<li>
<p><strong>编写代码</strong>：创建核心文件（如 <code>index.js</code>）；</p>
</li>
<li>
<p><strong>发布包</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">npm login <span class="hljs-comment"># 登录账号（需输入用户名、密码、邮箱）</span>
npm publish <span class="hljs-comment"># 发布（首次发布需确保包名未被占用）</span>
</code></pre>
</li>
</ol>
<blockquote>
<p>注意：发布前需检查 <code>.npmignore</code> 文件（排除不需要发布的文件，如 node_modules、测试文件）。</p>
</blockquote>
<h3 data-id="heading-13">4.3 更换 npm 镜像源</h3>
<p>默认 npm 源在国外，下载速度慢，可切换到国内镜像（如淘宝源）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 临时切换（单次生效）</span>
npm install axios --registry=https://registry.npmmirror.com

<span class="hljs-comment"># 永久切换</span>
npm config <span class="hljs-built_in">set</span> registry https://registry.npmmirror.com

<span class="hljs-comment"># 查看当前源</span>
npm config get registry

<span class="hljs-comment"># 切回官方源</span>
npm config <span class="hljs-built_in">set</span> registry https://registry.npmjs.org/
</code></pre>
<blockquote>
<p>推荐工具：<code>nrm</code>（npm 源管理工具），可快速切换多个源：</p>
<p>bash</p>
<p>运行</p>
<pre><code class="hljs language-bash" lang="bash">npm install nrm -g
nrm use taobao <span class="hljs-comment"># 切换到淘宝源</span>
nrm <span class="hljs-built_in">ls</span> <span class="hljs-comment"># 查看所有可用源</span>
</code></pre>
</blockquote>
<h3 data-id="heading-14">4.4 清理缓存</h3>
<p>如果安装依赖时出现异常，可清理 npm 缓存：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看缓存路径</span>
npm config get cache

<span class="hljs-comment"># 清理缓存</span>
npm cache clean --force
</code></pre>
<h2 data-id="heading-15">五、常见问题与解决方案</h2>
<h3 data-id="heading-16">问题 1：安装依赖时报错 <code>EACCES: permission denied</code></h3>
<p>原因：权限不足（全局安装时常见）。解决方案：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方案1：使用 sudo（不推荐）</span>
sudo npm install -g @vue/cli

<span class="hljs-comment"># 方案2：修改 npm 全局目录权限（推荐）</span>
<span class="hljs-built_in">mkdir</span> ~/.npm-global
npm config <span class="hljs-built_in">set</span> prefix <span class="hljs-string">'~/.npm-global'</span>
<span class="hljs-comment"># 然后将 ~/.npm-global/bin 添加到系统环境变量</span>
</code></pre>
<h3 data-id="heading-17">问题 2：依赖安装成功但项目运行报错</h3>
<p>原因：依赖版本不兼容，或 <code>package-lock.json</code> 锁定的版本有问题。解决方案：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除 node_modules 和 package-lock.json</span>
<span class="hljs-built_in">rm</span> -rf node_modules package-lock.json

<span class="hljs-comment"># 重新安装</span>
npm install
</code></pre>
<h3 data-id="heading-18">问题 3：全局安装的包无法执行</h3>
<p>原因：全局包的安装路径未加入系统环境变量。解决方案：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 查看全局包路径</span>
npm config get prefix

<span class="hljs-comment"># 将该路径下的 bin 目录添加到系统环境变量（如 ~/.npm-global/bin）</span>
</code></pre>
<h2 data-id="heading-19">总结</h2>
<ol>
<li><code>npm</code> 是 Node.js 标配的包管理工具，核心用于依赖管理和脚本运行，<code>package.json</code> 是项目的核心配置文件；</li>
<li>掌握 <code>npm init</code>/<code>npm install</code>/<code>npm run</code> 等基础命令是前端开发的必备技能，区分 <code>dependencies</code> 和 <code>devDependencies</code> 能规范项目依赖；</li>
<li><code>package-lock.json</code> 用于锁定依赖版本，保证多环境一致性，高级用法（换源、发布包、清理缓存）能解决日常开发中的大部分问题。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Lodash 源码解读与原理分析 - 数组那些事儿]]></title>    <link>https://juejin.cn/post/7597056049690411046</link>    <guid>https://juejin.cn/post/7597056049690411046</guid>    <pubDate>2026-01-20T05:26:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597056049690411046" data-draft-id="7596241980870262818" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Lodash 源码解读与原理分析 - 数组那些事儿"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-20T05:26:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Anita_Sun"/> <meta itemprop="url" content="https://juejin.cn/user/1811635884786839"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Lodash 源码解读与原理分析 - 数组那些事儿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1811635884786839/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Anita_Sun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:26:18.000Z" title="Tue Jan 20 2026 05:26:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Lodash 作为前端开发的核心工具库，其数组函数之所以能兼顾高性能与高鲁棒性，并非简单封装原生 API，而是从<strong>算法选型、内存管理、执行效率、边界兼容</strong>四个维度进行系统性优化。本文先拆解贯穿所有数组函数的通用优化策略，再逐一分析核心函数的实现细节，完整揭示 Lodash 高性能的底层逻辑。</p>
<h2 data-id="heading-0">一、Lodash 数组函数的通用性能优化策略</h2>
<p>Lodash 所有数组函数都遵循一套统一的优化范式，这些范式是其高性能的核心基石，具体包含 8 个核心方向：</p>
<h3 data-id="heading-1">1. 边界检查与早期返回：避免无效计算</h3>
<p><strong>核心逻辑</strong>：函数执行初期就对空值、无效输入、边界场景做判断，直接返回结果，避免进入核心逻辑的无效遍历 / 计算。<strong>实现方式</strong>：</p>
<ul>
<li>
<p>优先校验 <code>array</code> 是否为 <code>null/undefined</code>，安全获取数组长度（<code>var length = array == null ? 0 : array.length</code>）；</p>
</li>
<li>
<p>对空数组、无效参数（如 <code>size &lt; 1</code>、<code>depth &lt; 0</code>）直接返回空数组 / 原数组，不执行后续逻辑；</p>
</li>
<li>
<p>对非数组 / 类数组输入，直接返回空数组或原值，避免属性访问报错。</p>
<p><strong>价值</strong>：减少无效的循环、函数调用、内存分配，提升函数冷启动速度，同时增强鲁棒性。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 通用边界检查模板</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">baseFunction</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-comment">// 安全获取长度：处理null/undefined</span>
  <span class="hljs-keyword">var</span> length = array == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : array.<span class="hljs-property">length</span>;
  <span class="hljs-comment">// 早期返回：空数组直接返回结果</span>
  <span class="hljs-keyword">if</span> (!length) {
    <span class="hljs-keyword">return</span> [];
  }
  <span class="hljs-comment">// 核心逻辑（省略）</span>
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-2">2. 内存预分配：避免动态扩容的性能损耗</h3>
<p><strong>核心逻辑</strong>：对可预知长度的结果数组，提前分配内存空间，替代 <code>push</code> 动态扩容的方式。</p>
<p><strong>实现方式</strong>：</p>
<ul>
<li>通过计算目标长度（如分块数 <code>nativeCeil(length / size)</code>、切片长度 <code>end - start</code>）创建固定长度数组；</li>
<li>用索引赋值替代 <code>push</code>，避免数组长度翻倍扩容的内存重分配；</li>
<li>仅在长度不可预知时（如过滤类函数）使用 <code>push</code>，但仍通过双指针优化填充效率。</li>
</ul>
<p><strong>价值</strong>：减少 JavaScript 引擎的内存重分配和垃圾回收（GC）压力，大数组场景下性能提升 20%-30%。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// chunk 中的内存预分配</span>
<span class="hljs-keyword">var</span> result = <span class="hljs-title class_">Array</span>(<span class="hljs-title function_">nativeCeil</span>(length / size)); <span class="hljs-comment">// 预分配分块结果数组</span>
<span class="hljs-comment">// baseSlice 中的内存预分配</span>
<span class="hljs-keyword">var</span> result = <span class="hljs-title class_">Array</span>(length); <span class="hljs-comment">// 预分配切片结果数组</span>
</code></pre>
<h3 data-id="heading-3">3. 算法分层选型：按数据规模选择最优算法</h3>
<p><strong>核心逻辑</strong>：根据数组长度、有序性、数据类型选择不同算法，平衡「初始化开销」和「遍历效率」。</p>
<p><strong>实现方式</strong>：</p>
<ul>
<li>有序数组：使用二分查找（时间复杂度 O (log n)）替代线性查找（O (n)），如 <code>sortedIndex</code>；</li>
<li>大数组（≥200）：使用 Set/SetCache 缓存（查找 O (1)）替代数组查找（O (n)），如 <code>uniq</code>；</li>
<li>小数组（&lt;200）：使用普通数组查找，避免 Set 初始化的额外开销；</li>
<li>多数组操作（如交集、差集）：基于最短数组遍历，减少迭代次数。</li>
</ul>
<p><strong>价值</strong>：不同数据规模下都能达到最优执行效率，大数组场景性能提升 5-50 倍。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// uniq 中的分层策略</span>
<span class="hljs-keyword">if</span> (length &gt;= <span class="hljs-variable constant_">LARGE_ARRAY_SIZE</span>) { <span class="hljs-comment">// LARGE_ARRAY_SIZE = 200</span>
  <span class="hljs-keyword">var</span> set = iteratee ? <span class="hljs-literal">null</span> : <span class="hljs-title function_">createSet</span>(array); <span class="hljs-comment">// 大数组用Set</span>
  <span class="hljs-keyword">if</span> (set) <span class="hljs-keyword">return</span> <span class="hljs-title function_">setToArray</span>(set);
} <span class="hljs-keyword">else</span> {
  seen = iteratee ? [] : result; <span class="hljs-comment">// 小数组用普通数组</span>
}
</code></pre>
<h3 data-id="heading-4">4. 位运算优化：替代算术运算提升执行速度</h3>
<p><strong>核心逻辑</strong>：用位运算替代 <code>Math.floor</code>、正负判断、整数转换等算术运算，利用 CPU 直接执行的特性提升效率。<strong>实现方式</strong>：</p>
<ul>
<li>计算中间索引：<code>var mid = (low + high) &gt;&gt;&gt; 1</code>（替代 <code>Math.floor((low+high)/2)</code>）；</li>
<li>确保正整数：<code>start &gt;&gt;&gt;= 0</code>（替代 <code>Math.max(start, 0)</code>）；</li>
<li>计算长度：<code>length = (end - start) &gt;&gt;&gt; 0</code>（避免负数，替代 <code>Math.max(end - start, 0)</code>）。</li>
</ul>
<p><strong>价值</strong>：位运算比算术运算快 10%-20%，且能避免浮点运算、整数溢出问题。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// sortedIndex 中的位运算优化</span>
<span class="hljs-keyword">var</span> mid = (low + high) &gt;&gt;&gt; <span class="hljs-number">1</span>; <span class="hljs-comment">// 无浮点、无溢出的中间索引计算</span>
</code></pre>
<h3 data-id="heading-5">5. 循环优化：最小化迭代器开销</h3>
<p><strong>核心逻辑</strong>：通过 <code>while</code> 循环 + 双指针替代 <code>for</code> 循环，减少迭代过程中的变量声明、属性访问、冗余计算。</p>
<p><strong>实现方式</strong>：</p>
<ul>
<li>优先使用 <code>while</code> 循环：缓存数组长度（仅计算 1 次），避免每次迭代访问 <code>array.length</code>；</li>
<li>前置自增（<code>++index</code>）：替代后置自增（<code>index++</code>），减少临时变量存储；</li>
<li>双指针遍历：用两个指针分别遍历原数组（<code>index</code>）和填充结果数组（<code>resIndex</code>），减少长度计算；</li>
<li>短路循环：通过 <code>continue outer</code> 跳过无效迭代，减少比较次数。</li>
</ul>
<p><strong>价值</strong>：循环开销降低 10%-30%，高频遍历场景效果显著。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// compact 中的 while 循环 + 双指针</span>
<span class="hljs-keyword">var</span> index = -<span class="hljs-number">1</span>, resIndex = <span class="hljs-number">0</span>;
<span class="hljs-keyword">while</span> (++index &lt; length) { <span class="hljs-comment">// 前置自增，仅比较变量</span>
  <span class="hljs-keyword">var</span> value = array[index];
  <span class="hljs-keyword">if</span> (value) {
    result[resIndex++] = value; <span class="hljs-comment">// 双指针填充</span>
  }
}
</code></pre>
<h3 data-id="heading-6">6. 缓存机制：将 O (n) 查找降为 O (1)</h3>
<p><strong>核心逻辑</strong>：对频繁查找的场景，用缓存结构存储已遍历值，避免重复遍历比较。</p>
<p><strong>实现方式</strong>：</p>
<ul>
<li>大数组场景：使用 <code>SetCache</code>（Lodash 封装的 Set 兼容版）缓存已遍历值，查找时间复杂度 O (1)；</li>
<li>小数组场景：复用结果数组作为缓存，减少额外内存分配；</li>
<li>多数组操作：缓存第一个数组的所有值，后续数组仅做查找对比。</li>
</ul>
<p><strong>价值</strong>：查找效率提升一个数量级，大数组去重 / 交集场景性能提升数倍。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// baseUniq 中的缓存机制</span>
seen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetCache</span>; <span class="hljs-comment">// O(1) 查找缓存</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-title function_">includes</span>(seen, computed, comparator)) { <span class="hljs-comment">// 缓存查找</span>
  seen.<span class="hljs-title function_">push</span>(computed);
  result.<span class="hljs-title function_">push</span>(value);
}
</code></pre>
<h3 data-id="heading-7">7. 原生方法复用：利用引擎底层优化</h3>
<p><strong>核心逻辑</strong>：对浏览器已高度优化的原生方法，直接封装复用，避免手写逻辑的性能损耗。</p>
<p><strong>实现方式</strong>：</p>
<ul>
<li>复用 <code>Array.prototype.push</code>/<code>reverse</code>/<code>slice</code> 等原生方法，如 <code>nativeReverse.call(array)</code>；</li>
<li>封装原生方法为内部函数（如 <code>arrayPush</code> 封装 <code>push</code>），统一兼容处理；</li>
<li>仅在原生方法有缺陷时（如 <code>indexOf</code> 不支持 NaN）手写替代逻辑。</li>
</ul>
<p><strong>价值</strong>：原生方法由浏览器引擎用 C++ 实现，执行效率远高于手写 JavaScript 逻辑。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// reverse 中的原生方法复用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-keyword">return</span> array == <span class="hljs-literal">null</span> ? array : nativeReverse.<span class="hljs-title function_">call</span>(array);
}
</code></pre>
<h3 data-id="heading-8">8. 迭代器归一化：兼顾易用性与性能</h3>
<p><strong>核心逻辑</strong>：将函数、对象、字符串等多种迭代器格式统一为标准函数，避免多次类型判断。</p>
<p><strong>实现方式</strong>：</p>
<ul>
<li>通过 <code>getIteratee</code> 将 <code>predicate</code> 转换为标准迭代函数（支持 <code>_.filter(array, {active: true})</code> 等易用写法）；</li>
<li>迭代器仅初始化一次，复用在整个循环中，避免每次迭代都做类型判断；</li>
<li>统一迭代器参数（<code>value, index, array</code>），保证逻辑一致性。</li>
</ul>
<p><strong>价值</strong>：在不损失性能的前提下，提升 API 易用性，减少用户手写转换逻辑。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// remove 中的迭代器归一化</span>
predicate = <span class="hljs-title function_">getIteratee</span>(predicate, <span class="hljs-number">3</span>); <span class="hljs-comment">// 统一为标准函数</span>
<span class="hljs-keyword">while</span> (++index &lt; length) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">predicate</span>(value, index, array)) { <span class="hljs-comment">// 复用迭代器</span>
    <span class="hljs-comment">// 逻辑处理</span>
  }
}
</code></pre>
<h2 data-id="heading-9">二、Lodash 核心数组函数的实现与优化细节</h2>
<p>基于上述通用策略，Lodash 为不同场景的数组函数设计了针对性的优化方案，以下是核心函数的完整实现与解析：</p>
<h3 data-id="heading-10">1. 基础操作函数：易用性与效率的平衡</h3>
<h4 data-id="heading-11"><code>_.chunk</code>：数组分块的内存优化典范</h4>
<p><strong>功能</strong>：将数组分割为指定大小的二维数组，空数组 / 无效参数返回空数组。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">chunk</span>(<span class="hljs-params">array, size, guard</span>) {
  <span class="hljs-comment">// 1. 边界兼容：处理参数异常（防误传、未传size）</span>
  <span class="hljs-keyword">if</span> ((guard ? <span class="hljs-title function_">isIterateeCall</span>(array, size, guard) : size === <span class="hljs-literal">undefined</span>)) {
    size = <span class="hljs-number">1</span>; <span class="hljs-comment">// 默认分块大小为1</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 转为整数并确保最小值为0（避免负数分块）</span>
    size = <span class="hljs-title function_">nativeMax</span>(<span class="hljs-title function_">toInteger</span>(size), <span class="hljs-number">0</span>);
  }

  <span class="hljs-comment">// 2. 安全获取长度 + 早期返回：空数组/无效size直接返回</span>
  <span class="hljs-keyword">var</span> length = array == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : array.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (!length || size &lt; <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> [];
  }

  <span class="hljs-comment">// 3. 内存预分配：计算分块数并创建固定长度数组</span>
  <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>,
      resIndex = <span class="hljs-number">0</span>,
      result = <span class="hljs-title class_">Array</span>(<span class="hljs-title function_">nativeCeil</span>(length / size)); <span class="hljs-comment">// 向上取整确定分块数</span>

  <span class="hljs-comment">// 4. 循环优化：while循环 + 指针更新，减少迭代开销</span>
  <span class="hljs-keyword">while</span> (index &lt; length) {
    <span class="hljs-comment">// 复用baseSlice切片，同时更新索引（index += size）</span>
    result[resIndex++] = <span class="hljs-title function_">baseSlice</span>(array, index, (index += size));
  }
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>分块数预计算：通过 <code>nativeCeil(length / size)</code> 精准预分配结果数组长度；</li>
<li>索引联动更新：<code>index += size</code> 一次操作完成指针移动，避免重复计算；</li>
<li>底层逻辑复用：基于 <code>baseSlice</code> 实现切片，避免重复造轮子。</li>
</ul>
<h4 data-id="heading-12"><code>_.compact</code>：假值过滤的极致简洁</h4>
<p><strong>功能</strong>：移除数组中的假值（false、null、0、""、undefined、NaN），返回新数组。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">compact</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-comment">// 1. 安全初始化：处理null/undefined，缓存长度</span>
  <span class="hljs-keyword">var</span> index = -<span class="hljs-number">1</span>,
      length = array == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : array.<span class="hljs-property">length</span>,
      resIndex = <span class="hljs-number">0</span>,
      result = [];

  <span class="hljs-comment">// 2. 循环优化：while + 双指针，减少属性访问</span>
  <span class="hljs-keyword">while</span> (++index &lt; length) {
    <span class="hljs-keyword">var</span> value = array[index];
    <span class="hljs-comment">// 3. 快速判空：直接判断值，比Boolean(value)更高效</span>
    <span class="hljs-keyword">if</span> (value) {
      result[resIndex++] = value; <span class="hljs-comment">// 双指针填充，避免push扩容</span>
    }
  }
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>快速假值判断：<code>if (value)</code> 直接校验，省去 <code>Boolean()</code> 函数调用开销；</li>
<li>双指针填充：<code>resIndex</code> 独立控制结果数组索引，避免 <code>result.length</code> 访问。</li>
</ul>
<h4 data-id="heading-13"><code>_.concat</code>：多参数拼接的灵活实现</h4>
<p><strong>功能</strong>：拼接多个数组 / 值，返回新数组，支持类数组、单值输入。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">concat</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. 早期返回：无参数直接返回空数组</span>
  <span class="hljs-keyword">var</span> length = <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (!length) {
    <span class="hljs-keyword">return</span> [];
  }

  <span class="hljs-comment">// 2. 参数预处理：批量处理arguments，避免多次类数组操作</span>
  <span class="hljs-keyword">var</span> args = <span class="hljs-title class_">Array</span>(length - <span class="hljs-number">1</span>),
      array = <span class="hljs-variable language_">arguments</span>[<span class="hljs-number">0</span>],
      index = length;

  <span class="hljs-comment">// 反向遍历：高效将arguments转为数组</span>
  <span class="hljs-keyword">while</span> (index--) {
    args[index - <span class="hljs-number">1</span>] = <span class="hljs-variable language_">arguments</span>[index];
  }

  <span class="hljs-comment">// 3. 核心逻辑：原生复用 + 扁平化控制</span>
  <span class="hljs-comment">// - isArray判断：数组拷贝，非数组转为数组</span>
  <span class="hljs-comment">// - baseFlatten：仅扁平化1层，平衡灵活性与性能</span>
  <span class="hljs-comment">// - arrayPush：封装原生push，利用引擎优化</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">arrayPush</span>(
    <span class="hljs-title function_">isArray</span>(array) ? <span class="hljs-title function_">copyArray</span>(array) : [array],
    <span class="hljs-title function_">baseFlatten</span>(args, <span class="hljs-number">1</span>)
  );
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>反向遍历参数：<code>while (index--)</code> 高效处理 <code>arguments</code>，避免 <code>Array.from</code> 开销；</li>
<li>扁平化控制：仅扁平化 1 层，避免过度遍历，同时兼容多参数输入。</li>
</ul>
<h3 data-id="heading-14">2. 查找与索引函数：算法层面的性能突破</h3>
<h4 data-id="heading-15"><code>_.findIndex</code>：条件查找的精准控制</h4>
<p><strong>功能</strong>：查找第一个满足条件的元素索引，支持起始位置，无匹配返回 -1。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">findIndex</span>(<span class="hljs-params">array, predicate, fromIndex</span>) {
  <span class="hljs-comment">// 1. 安全获取长度 + 早期返回：空数组直接返回-1</span>
  <span class="hljs-keyword">var</span> length = array == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : array.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (!length) {
    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// 2. 起始索引校准：处理负数、非数字索引</span>
  <span class="hljs-keyword">var</span> index = fromIndex == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : <span class="hljs-title function_">toInteger</span>(fromIndex);
  <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// 负数索引转为合法正索引，最小为0</span>
    index = <span class="hljs-title function_">nativeMax</span>(length + index, <span class="hljs-number">0</span>);
  }

  <span class="hljs-comment">// 3. 迭代器归一化 + 底层复用：</span>
  <span class="hljs-comment">// - getIteratee：统一迭代器格式（函数/对象/字符串）</span>
  <span class="hljs-comment">// - baseFindIndex：封装核心查找，支持正序/倒序复用</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">baseFindIndex</span>(array, <span class="hljs-title function_">getIteratee</span>(predicate, <span class="hljs-number">3</span>), index);
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>起始位置校准：自动处理负数索引，无需用户手动转换；</li>
<li>底层逻辑抽象：<code>baseFindIndex</code> 同时支撑 <code>findIndex</code>/<code>findLastIndex</code>，避免重复代码。</li>
</ul>
<h4 data-id="heading-16"><code>_.sortedIndex</code>：有序数组的二分查找</h4>
<p><strong>功能</strong>：在有序数组中查找值的插入位置，保证数组有序性，仅支持数字 / 可比较类型。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 对外简化接口</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sortedIndex</span>(<span class="hljs-params">array, value</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">baseSortedIndex</span>(array, value);
}

<span class="hljs-comment">// 底层核心实现</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">baseSortedIndex</span>(<span class="hljs-params">array, value, retHighest</span>) {
  <span class="hljs-comment">// 1. 初始化二分边界：处理null/undefined</span>
  <span class="hljs-keyword">var</span> low = <span class="hljs-number">0</span>,
      high = array == <span class="hljs-literal">null</span> ? low : array.<span class="hljs-property">length</span>;

  <span class="hljs-comment">// 2. 数字类型特化：跳过无效值，提升效率</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'number'</span> &amp;&amp; value === value &amp;&amp; high &lt;= <span class="hljs-variable constant_">HALF_MAX_ARRAY_LENGTH</span>) {
    <span class="hljs-comment">// 3. 二分查找核心：位运算优化 + 短路判断</span>
    <span class="hljs-keyword">while</span> (low &lt; high) {
      <span class="hljs-comment">// 位运算计算中间索引：无浮点、无溢出</span>
      <span class="hljs-keyword">var</span> mid = (low + high) &gt;&gt;&gt; <span class="hljs-number">1</span>,
          computed = array[mid];

      <span class="hljs-comment">// 短路判断：跳过Symbol/null，快速比较</span>
      <span class="hljs-keyword">if</span> (computed !== <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-title function_">isSymbol</span>(computed) &amp;&amp;
          (retHighest ? (computed &lt;= value) : (computed &lt; value))) {
        low = mid + <span class="hljs-number">1</span>; <span class="hljs-comment">// 目标在右半部分</span>
      } <span class="hljs-keyword">else</span> {
        high = mid; <span class="hljs-comment">// 目标在左半部分</span>
      }
    }
    <span class="hljs-keyword">return</span> high;
  }

  <span class="hljs-comment">// 非数字/超大数组：通用实现兜底</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">baseSortedIndexBy</span>(array, value, identity, retHighest);
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>二分查找选型：时间复杂度 O (log n)，大数组比线性查找快 5-10 倍；</li>
<li>数字特化处理：跳过 Symbol/null 等无效值，减少判断开销；</li>
<li>长度限制：<code>HALF_MAX_ARRAY_LENGTH</code> 避免超大数组的性能问题。</li>
</ul>
<h4 data-id="heading-17"><code>_.indexOf</code>：值查找的兼容性优化</h4>
<p><strong>功能</strong>：查找值的第一个索引，支持起始位置，兼容 NaN 查找。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">indexOf</span>(<span class="hljs-params">array, value, fromIndex</span>) {
  <span class="hljs-comment">// 1. 安全获取长度 + 早期返回：空数组直接返回-1</span>
  <span class="hljs-keyword">var</span> length = array == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : array.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (!length) {
    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// 2. 起始索引校准：处理负数、非数字</span>
  <span class="hljs-keyword">var</span> index = fromIndex == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : <span class="hljs-title function_">toInteger</span>(fromIndex);
  <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>) {
    index = <span class="hljs-title function_">nativeMax</span>(length + index, <span class="hljs-number">0</span>);
  }

  <span class="hljs-comment">// 3. 底层复用：兼容NaN（原生indexOf不支持）</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">baseIndexOf</span>(array, value, index);
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>NaN 兼容：<code>baseIndexOf</code> 专门处理 NaN 查找，弥补原生 API 缺陷；</li>
<li>索引校准：自动处理负数起始位置，提升易用性。</li>
</ul>
<h3 data-id="heading-18">3. 修改与操作函数：原地 / 非原地的平衡</h3>
<h4 data-id="heading-19"><code>_.pullAll</code>（支撑 <code>_.pull</code>）：原地移除指定值</h4>
<p><strong>功能</strong>：从原数组中移除指定值，直接修改原数组，返回修改后的数组。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">pullAll</span>(<span class="hljs-params">array, values</span>) {
  <span class="hljs-comment">// 1. 早期返回：空数组/空值列表直接返回原数组</span>
  <span class="hljs-keyword">if</span> (!(array &amp;&amp; array.<span class="hljs-property">length</span> &amp;&amp; values &amp;&amp; values.<span class="hljs-property">length</span>)) {
    <span class="hljs-keyword">return</span> array;
  }

  <span class="hljs-comment">// 2. 批量处理：调用底层逻辑，避免多次遍历</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">basePullAll</span>(array, values);
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>原地修改：直接操作原数组，减少新数组创建的内存开销；</li>
<li>批量处理：一次性移除多个值，避免多次遍历数组。</li>
</ul>
<h4 data-id="heading-20"><code>_.remove</code>：条件移除的高效实现</h4>
<p><strong>功能</strong>：移除满足条件的元素，返回被移除的数组，原数组被修改。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">remove</span>(<span class="hljs-params">array, predicate</span>) {
  <span class="hljs-comment">// 1. 初始化 + 早期返回：空数组返回空结果</span>
  <span class="hljs-keyword">var</span> result = [];
  <span class="hljs-keyword">if</span> (!(array &amp;&amp; array.<span class="hljs-property">length</span>)) {
    <span class="hljs-keyword">return</span> result;
  }

  <span class="hljs-comment">// 2. 缓存长度 + 迭代器归一化</span>
  <span class="hljs-keyword">var</span> index = -<span class="hljs-number">1</span>,
      indexes = [],
      length = array.<span class="hljs-property">length</span>;
  predicate = <span class="hljs-title function_">getIteratee</span>(predicate, <span class="hljs-number">3</span>);

  <span class="hljs-comment">// 3. 双数组记录：先收集索引/值，避免边遍历边删除的索引错乱</span>
  <span class="hljs-keyword">while</span> (++index &lt; length) {
    <span class="hljs-keyword">var</span> value = array[index];
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">predicate</span>(value, index, array)) {
      result.<span class="hljs-title function_">push</span>(value); <span class="hljs-comment">// 收集被移除值</span>
      indexes.<span class="hljs-title function_">push</span>(index); <span class="hljs-comment">// 收集被移除索引</span>
    }
  }

  <span class="hljs-comment">// 4. 批量移除：一次性处理所有索引，减少数组重排次数</span>
  <span class="hljs-title function_">basePullAt</span>(array, indexes);
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>双数组记录：先收集后移除，避免边遍历边删除导致的元素漏判；</li>
<li>批量移除：<code>basePullAt</code> 一次性处理索引，减少数组元素移动的开销。</li>
</ul>
<h4 data-id="heading-21"><code>_.reverse</code>：原生能力的安全封装</h4>
<p><strong>功能</strong>：反转数组，直接修改原数组，兼容 <code>null/undefined</code> 输入。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-comment">// 1. 安全兼容：null/undefined直接返回，避免报错</span>
  <span class="hljs-comment">// 2. 原生复用：调用浏览器优化的reverse方法</span>
  <span class="hljs-keyword">return</span> array == <span class="hljs-literal">null</span> ? array : nativeReverse.<span class="hljs-title function_">call</span>(array);
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>原生方法复用：直接调用 <code>Array.prototype.reverse</code>，利用引擎 C++ 实现的高性能；</li>
<li>无额外开销：仅做安全判断，无多余计算。</li>
</ul>
<h3 data-id="heading-22">4. 集合操作函数：数据结构驱动的性能提升</h3>
<h4 data-id="heading-23"><code>_.uniq</code>：数组去重的分层优化</h4>
<p><strong>功能</strong>：数组去重，返回新数组，兼容 NaN、0/-0 等特殊值。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 对外简化接口</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">uniq</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-comment">// 早期返回：空数组/非数组直接返回空数组</span>
  <span class="hljs-keyword">return</span> (array &amp;&amp; array.<span class="hljs-property">length</span>) ? <span class="hljs-title function_">baseUniq</span>(array) : [];
}

<span class="hljs-comment">// 底层核心去重</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">baseUniq</span>(<span class="hljs-params">array, iteratee, comparator</span>) {
  <span class="hljs-comment">// 1. 初始化变量：缓存长度，默认查找函数</span>
  <span class="hljs-keyword">var</span> index = -<span class="hljs-number">1</span>,
      includes = arrayIncludes,
      length = array.<span class="hljs-property">length</span>,
      isCommon = <span class="hljs-literal">true</span>,
      result = [],
      seen = result;

  <span class="hljs-comment">// 2. 比较器处理：自定义比较器切换查找逻辑</span>
  <span class="hljs-keyword">if</span> (comparator) {
    isCommon = <span class="hljs-literal">false</span>;
    includes = arrayIncludesWith;
  }
  <span class="hljs-comment">// 3. 分层策略：大数组用Set，小数组用普通数组</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (length &gt;= <span class="hljs-variable constant_">LARGE_ARRAY_SIZE</span>) { <span class="hljs-comment">// LARGE_ARRAY_SIZE = 200</span>
    <span class="hljs-comment">// 无迭代器时直接用Set（最快）</span>
    <span class="hljs-keyword">var</span> set = iteratee ? <span class="hljs-literal">null</span> : <span class="hljs-title function_">createSet</span>(array);
    <span class="hljs-keyword">if</span> (set) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">setToArray</span>(set);
    }
    isCommon = <span class="hljs-literal">false</span>;
    includes = cacheHas;
    seen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetCache</span>; <span class="hljs-comment">// O(1) 查找缓存</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 小数组：复用结果数组作为缓存</span>
    seen = iteratee ? [] : result;
  }

  <span class="hljs-comment">// 4. 核心遍历：短路逻辑 + 特殊值处理</span>
  <span class="hljs-attr">outer</span>:
  <span class="hljs-keyword">while</span> (++index &lt; length) {
    <span class="hljs-keyword">var</span> value = array[index],
        computed = iteratee ? <span class="hljs-title function_">iteratee</span>(value) : value;

    <span class="hljs-comment">// 特殊值处理：0和-0视为相同</span>
    value = (comparator || value !== <span class="hljs-number">0</span>) ? value : <span class="hljs-number">0</span>;

    <span class="hljs-comment">// 普通场景：反向遍历缓存，减少比较次数</span>
    <span class="hljs-keyword">if</span> (isCommon &amp;&amp; computed === computed) {
      <span class="hljs-keyword">var</span> seenIndex = seen.<span class="hljs-property">length</span>;
      <span class="hljs-keyword">while</span> (seenIndex--) {
        <span class="hljs-keyword">if</span> (seen[seenIndex] === computed) {
          <span class="hljs-keyword">continue</span> outer; <span class="hljs-comment">// 短路：跳过重复值</span>
        }
      }
      <span class="hljs-keyword">if</span> (iteratee) {
        seen.<span class="hljs-title function_">push</span>(computed);
      }
      result.<span class="hljs-title function_">push</span>(value);
    }
    <span class="hljs-comment">// 非普通场景/NaN：缓存查找</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">includes</span>(seen, computed, comparator)) {
      <span class="hljs-keyword">if</span> (seen !== result) {
        seen.<span class="hljs-title function_">push</span>(computed);
      }
      result.<span class="hljs-title function_">push</span>(value);
    }
  }
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>分层去重：200 为阈值，平衡 Set 初始化开销和查找效率；</li>
<li>特殊值兼容：处理 NaN、0/-0，弥补原生 Set 的部分缺陷；</li>
<li>反向遍历缓存：减少缓存比较次数，提升小数组去重效率。</li>
</ul>
<h4 data-id="heading-24"><code>_.intersection</code>：多数组交集的缓存优化</h4>
<p><strong>功能</strong>：计算多个数组的交集，返回新数组，仅保留所有数组都包含的元素。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> intersection = <span class="hljs-title function_">baseRest</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">arrays</span>) {
  <span class="hljs-comment">// 1. 参数归一化：转为数组/类数组，过滤无效输入</span>
  <span class="hljs-keyword">var</span> mapped = <span class="hljs-title function_">arrayMap</span>(arrays, castArrayLikeObject);
  
  <span class="hljs-comment">// 2. 早期返回：无有效输入返回空数组</span>
  <span class="hljs-keyword">return</span> (mapped.<span class="hljs-property">length</span> &amp;&amp; mapped[<span class="hljs-number">0</span>] === arrays[<span class="hljs-number">0</span>])
    ? <span class="hljs-title function_">baseIntersection</span>(mapped)
    : [];
});
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>最短数组优先：基于最短数组遍历，减少迭代次数；</li>
<li>缓存复用：对大数组创建 SetCache，查找效率从 O (n) 降为 O (1)；</li>
<li>参数归一化：统一处理类数组，提升兼容性。</li>
</ul>
<h4 data-id="heading-25"><code>_.xor</code>：对称差集的高效计算</h4>
<p><strong>功能</strong>：计算多个数组的对称差集，返回仅出现在一个数组中的元素。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> xor = <span class="hljs-title function_">baseRest</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">arrays</span>) {
  <span class="hljs-comment">// 1. 过滤无效输入：仅保留数组/类数组</span>
  <span class="hljs-comment">// 2. 底层复用：基于baseDifference实现，避免重复逻辑</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">baseXor</span>(<span class="hljs-title function_">arrayFilter</span>(arrays, isArrayLikeObject));
});
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>差集复用：基于 <code>baseDifference</code> 实现核心逻辑，减少代码冗余；</li>
<li>批量计算：一次性处理所有输入，减少中间数组创建。</li>
</ul>
<h3 data-id="heading-26">5. 其他高频函数：细节处的性能打磨</h3>
<h4 data-id="heading-27"><code>_.head</code>/<code>_.last</code>：首尾元素的直接访问</h4>
<p><strong>功能</strong>：快速获取数组第一个 / 最后一个元素，兼容空数组、非数组输入。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 获取第一个元素</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">head</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-comment">// 直接访问：无函数调用开销，空数组返回undefined</span>
  <span class="hljs-keyword">return</span> (array &amp;&amp; array.<span class="hljs-property">length</span>) ? array[<span class="hljs-number">0</span>] : <span class="hljs-literal">undefined</span>;
}

<span class="hljs-comment">// 获取最后一个元素</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">last</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-comment">// 安全获取长度：处理null/undefined</span>
  <span class="hljs-keyword">var</span> length = array == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : array.<span class="hljs-property">length</span>;
  <span class="hljs-comment">// 直接访问：避免slice(-1)[0]的额外开销</span>
  <span class="hljs-keyword">return</span> length ? array[length - <span class="hljs-number">1</span>] : <span class="hljs-literal">undefined</span>;
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>直接索引访问：比 <code>array.slice(0,1)[0]</code> 快数倍，无额外内存分配；</li>
<li>无冗余计算：仅做必要的长度判断，无循环 / 函数调用。</li>
</ul>
<h4 data-id="heading-28"><code>_.flatten</code>/<code>_.flattenDepth</code>：数组扁平化的深度控制</h4>
<p><strong>功能</strong>：将嵌套数组扁平化为一维（<code>flatten</code>）或指定深度（<code>flattenDepth</code>），返回新数组。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 扁平化1层（默认）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">flatten</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-keyword">var</span> length = array == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : array.<span class="hljs-property">length</span>;
  <span class="hljs-comment">// 早期返回：空数组直接返回，否则调用底层逻辑（深度1）</span>
  <span class="hljs-keyword">return</span> length ? <span class="hljs-title function_">baseFlatten</span>(array, <span class="hljs-number">1</span>) : [];
}

<span class="hljs-comment">// 支持指定深度</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">flattenDepth</span>(<span class="hljs-params">array, depth</span>) {
  <span class="hljs-keyword">var</span> length = array == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : array.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (!length) {
    <span class="hljs-keyword">return</span> [];
  }
  <span class="hljs-comment">// 深度校准：未传depth默认1，转为整数确保合法</span>
  depth = depth === <span class="hljs-literal">undefined</span> ? <span class="hljs-number">1</span> : <span class="hljs-title function_">toInteger</span>(depth);
  <span class="hljs-comment">// 底层复用：迭代实现，避免递归栈溢出</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">baseFlatten</span>(array, depth);
}
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>深度控制：避免过度扁平化，减少无效遍历；</li>
<li>迭代代替递归：<code>baseFlatten</code> 用迭代实现，避免深层嵌套导致的栈溢出；</li>
<li>类型校验：仅扁平化数组 / 类数组，跳过普通对象。</li>
</ul>
<h4 data-id="heading-29"><code>_.without</code>：排除指定值的差集实现</h4>
<p><strong>功能</strong>：创建排除指定值的新数组，原数组不变，支持多值排除。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> without = <span class="hljs-title function_">baseRest</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">array, values</span>) {
  <span class="hljs-comment">// 1. 类型校验：仅处理数组/类数组，否则返回空数组</span>
  <span class="hljs-comment">// 2. 底层复用：基于baseDifference实现差集计算</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">isArrayLikeObject</span>(array)
    ? <span class="hljs-title function_">baseDifference</span>(array, values)
    : [];
});
</code></pre>
<p><strong>专属优化点</strong>：</p>
<ul>
<li>差集复用：直接使用 <code>baseDifference</code> 核心逻辑，避免重复代码；</li>
<li>可变参数：通过 <code>baseRest</code> 支持多值输入，提升易用性；</li>
<li>非破坏性：返回新数组，不修改原数组，兼顾不可变需求。</li>
</ul>
<h2 data-id="heading-30">三、核心总结</h2>
<p>Lodash 数组函数的高性能，是「通用优化策略 + 场景化定制」的双重结果，核心关键点可总结为：</p>
<ol>
<li><strong>性能分层设计</strong>：根据数组大小、有序性选择算法（二分 / Set / 线性），避免「一刀切」的低效；</li>
<li><strong>内存效率优先</strong>：预分配内存、原地修改、缓存复用，减少 GC 压力和内存重分配；</li>
<li><strong>细节极致打磨</strong>：位运算、while 循环、快速判空等小优化，叠加后产生显著效果；</li>
<li><strong>兼容与性能平衡</strong>：在鲁棒性（兼容 null/NaN/ 负数索引）和性能之间找到最优解，不牺牲易用性。</li>
</ol>
<p>这些优化思路不仅适用于数组操作，更是前端高性能编程的通用准则 —— 掌握这些逻辑，既能更高效地使用 Lodash，也能在手写代码时写出兼具性能与鲁棒性的逻辑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零打造专业级前端 SDK (三)：健壮性与离线存储]]></title>    <link>https://juejin.cn/post/7596990822127534118</link>    <guid>https://juejin.cn/post/7596990822127534118</guid>    <pubDate>2026-01-20T05:32:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596990822127534118" data-draft-id="7597083743555616811" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零打造专业级前端 SDK (三)：健壮性与离线存储"/> <meta itemprop="keywords" content="前端,架构"/> <meta itemprop="datePublished" content="2026-01-20T05:32:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一个有故事的男同学"/> <meta itemprop="url" content="https://juejin.cn/user/3984285867966951"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零打造专业级前端 SDK (三)：健壮性与离线存储
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3984285867966951/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一个有故事的男同学
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:32:52.000Z" title="Tue Jan 20 2026 05:32:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body ::selection{color:#fff;background-color:#ed7373}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:.6em;margin-top:1.5em;padding-bottom:4px;color:#ed7373}.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px}.markdown-body h4{font-size:16px}.markdown-body h5,.markdown-body h6{font-size:14px}.markdown-body p{line-height:inherit;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border-top:1px solid #dfe1e6;margin:33px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:rgba(239,198,221,.2666666667);color:#7b164f;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==") 10px 10px no-repeat;background-size:40px;background-color:#fdf8f8}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#fdf8f8}.markdown-body a{position:relative;text-decoration:underline;text-decoration-color:#ffd4d4;color:#ed7373;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAD1lJREFUeF7tnV122zgShQHJG5gT9/OkV2J7JR3voI/U707eI5/eQeyVRFlJa56nc2YDFjkHEulWHP3g5xZYAK5eku6QYOFWfSwUAJLW8EcFqMBJBSy1oQJU4LQCBITRQQXOKEBAGB5UgIAwBqhAnALMIHG68axGFCAgjTia3YxTgIDE6cazGlGAgDTiaHYzTgECEqcbz2pEAQLSiKPZzTgFCEicbjyrEQUISCOOZjfjFCAgcbrxrEYUICCNOJrdjFOAgMTpxrMaUYCANOJodjNOAQISpxvPakQBAtKIo9nNOAUISJxuPKsRBQhII45GdfN/v//+/l9//rlBtae9HQKi3UOZ7ft7sfhgjfm3sfa9u3RvzHtrjPv77r8PfpvemB0o1v3Z95tuNvt29fKyqQkgApI5ADVebgeFtTfGmA8I+3pj1rbv17Ouey4dFgKCiIgC2/i+WDwYax0QbzMDtDcjLC67/PL58xraeIbGCEgGkTVd4vty+QWVKUL75WCZb7f3JWUVAhLq5UKPHzLGRyXmP822208lgEJAlESMlBlDfeGyhsafelAIiMawAdjkpmO38/kXa8wtoDnRJvq+v79+fHwSvUhk4wQkUjjNp/33jz9uZ33/VbONP9nW9x/fPT5+0mYzAdHmkUR7lNUaob1RN+QiIKEuVHz838vl1xKGVOck1DbTRUAUB7yvaSXVG5592sy22zsNs1wExNNjWg+rEI5XqWfb7a9TQ0JAtEa+h101wzF0f/JMQkA8AlHjIQ3AMco+KSQERGP0X7CpITj2Skw4BUxACgOkOThG/0wECQEpCJBm4Rh81Fl7l3tHMAEpBJCJ4Hjq+/7bvOt229THGSVny8vV1W6b/Kzrbnprb088VAVXN/fMFgGBuxDfYE443L4oB0TM9OqwxcVtjJR7xiTzUIuA4OMZ2mI2OICBN+wgfpACJWcWISDQcMY2lgMOt7XjerW6w1q+b03sqUUgzJf6TUAuKTTRv+eAI8f0qdSwK1cWISATAXDusjngyDkj5PrTzedu+z2uNsmURQiIMkBqg2OUVwKSHFmEgCgCpFY4xCDJkEUIiBJAaodjlBlZuEtOMIz2EhAFgLQCxxtIIG9YkR5mEZCJAWkNjldIlsu/EEW79AsfCMiEgLQKx8EaCSKLPL1bre6l3EhApJS90G7LcKCziOQwi4BMAAjh+GGlPTmLSK7pEJDMgBCOfwRHvb9Lsg4hIBkBIRw/i/0dUawLrocQkEyAEI7jQoPeNi9WqBOQDIAQjtMig16uTUAyxLHIJQjHeVkRdYjkijoziAgW+0YJx2VxEYAYYzbvVqtfL18t/AgCEq6Z1xmEw0um3U2km8/dqnrS791qJRLLIo0m9bSCkwmHvxNBgDCD+Es+7ZGEI0x/DrHC9Cr6aMIR7j7ELBaL9HDds59BOOIkB33wh9O8cfLnOYtwxOsM+egPV9LjHSB9JuFIU/j7ctmntSD7cmvOYiV6B3IHPGOD5E7VxK4nnw4q0A03Kya7QqYBwpGmK6j+MFJrIK53zCCRPgZtsjt59Zozh+s0aP3DNSW2BkJAIuFATE2eu3TtcLi+w24wggU6AYkABDVuPnXpFuAAZg8jrReHWAGQIB177LLSzg7oqtih4Dcsig6vmEECw0CyKG8BDic3VEPh4RUBCQAENePSaubY1R2LxYOxNvklDa8aEpCACBY+FLKgdcTGZjLHYvHBWuu+PoX6iQ+vmEE8XQW/8w3XJRyeDjhymOTi4OHlWKRf8JFUYU444uGQXvsgIAG+kcgesXAM6y83/fAhGtv36242+5b708i+8kmtF+XKHhxiTZA9YuDwCLSn2Xb7KebLtL7BHnqch82hTY7HZ6k9xotxiHXGTejsEQXHcvnVGnPrEU2b2XZ7pwESQTjEFwbf6kxAzgGCeOvf2H7ElGQMoDmHH8ekk4RD8snBU2FAQE4oAy7Og594S7p+BIweGeriIZJw5CzMWaRfdDV0UStqzByTPX7oVt9/nHXdc64hV41wsEjPMLyKqTucWZAtGZkyiTAc2esOZpBMs1cpY2bIW89dP4UhkYZj6pqKNcgRWFBb2lO+fAQDxBiTYse5e4k0HMaY4NrNY/QcdAgBOSJX8vjf3biNWV+vVndB3jg4GPZA0b5N+BSwNByp+sXqzmleD+UQgMTWHqN5AgEIg0TAtrdemTxzjAYxgxzLIMul23X6wYOlU4dEzVy9bQw5zNq1DahHpOGYuuZgBvGI+uQZJEAgOjOHWsjB+t7DbK9DUgIQkVnPGZmadb0ECDyIGeR4Bkl6mRnS0WhIYsf2LcLhQoOACACCfk8T+Dnu4BetJa3qe9yxkTcUj8sFHUJAjgPiPugSO6yB1B9vzUJCEppFBLPHprP2Xut2fWaQE/eSxOJYBJDR1ETbXnscUosk12THdVYPBwE5AUhiQIgCAswk3tO+As/ji2oUNIa6cDCHWOBp3tDhS4wzUZD4ZhEkIDn0idH01DkEBAyIaw5dpB9zHqgu8FqQgw3rEncXIAPft60qAXF32JRt3qnBJ7X36a1TUwPX926O2Pbiey3fwM11XBWADGsFv5n9o6m72SfnkJ2Iff98/fj4FCJo6mpxrmnLVJCdJj4wp+pRKhxVFOmeBXXwSw2S7s6glXQfqJPs3N0/+nufG0jCdbyGcT59neKYYjNIxKfPvGdtnCM8wTvpM587M8LhgOGPVwDHTAz4wofQQaqNIgGJgGOvX8CdPXVYEXKtFOcm2+k5zHI2hmx7yTXMTNHO59ziAEne9uAJCeChqaCM5eOsY8cA7PSqQw6vPWSt13rvjV1PnbXPmlfHQ7QuChBEMIQUjAnj7uCMFeI09GxW7N1+54+uuxkmRf4z77p1yuxhigZS5xYDCAKOUUTfdQrELFGOoVZqvRQLiFRQamq3CECQcPhObY5OSs4iATNFsYGRamMNxXSsdpfOUw8IGg4nSMgdE5JFhCEhIJfCPP7fVQOCmKE5Ik3wRrnUABxtkLpTJ9vnOXERH2blnqkWECE4ot42gsoiodnLN6wAmwm91kJ87anpOJWAABa/Tvso8m6ZfJf+xyLo9G/ytPduCqr/+O7x8VNNgY3qizpAROEwJnh4NQodskh20TnAgITUaEB7Lva9sANUAZI6XXlB++Q7N3KohdqKgrApZNKisPhONlcNIMJwBM1cnVMVEZDIWgShGwrW5GhU2IAKQBBOPqct+g4JqUcAwxpI/ZHpAS+Fse9l0qSARG869Ora/iA0HK7NmJ2tP5kMAASUzaLrsgA3FHvopICUljkOvZwKCQJcRCYL2ZtWbJQnGD4ZICXDMeo93MHdO3yD36Hlux/slG8hs1ec4r2IziSAgIYGJzuHuDtfVG44IGr6FzG8An1gNKdWvppqOi47ILA73wkVp3B4ICTJY37gDSbZFk3BLGFLVkBQsy6nhJgCjtEWn5oEMd6HagjIZBJBqanNbIBAHXtEwSnhODRn2EP2MPy/sTaBPWWHrN20aKYJiLe2ZANEcguJVkenvp/rrbOQcEz13XHNMByzLQsgktlDKxzoQADWHXvTOLzyclEWQMB3vteOtQKHxNZ/bi/x4kP+AzpS2YNw+Dn46FHMHt7iiWcQiexBOLz9e+xATu0GyCcKiMSaB+EI8O6xQ5k9ggQUBQSxV+iwN4QjyLfMHslyCX7EE157NHLnkyjIxziRemkEIA7VNiGWQcDTkk28VEAUjgI/XqOBGjFAgMV5E0WlJBxcFIxHTQQQ5PCqhbpDGo7ZdntX2ztz40M+7EwRQICzV9VnD2E4RJ6oDAuxso8WAQRVf9S+2isNB4vydDhlAFku+3TT4t9hBbi2eBPScBhjmpjYkHaUXkAqntaVhgPx3Il04JXSPhwQVIFe6/CKcJSCxt5OrYBUWZwTjrLgEAEEMYNV4xCBcJQHhwggoECoqsAEaXIywmq8oWjBCT7EgkzxVlSgEw4toR5nBwGJ083rLMLhJZPqg/CALJdfjDHubYPxvwoyCOGId7+mM+GAgAKj6BoEpAFrDgWkqASk5KKTcCiIaqAJcEBanuYlHMDIVNIUHJBWV9IJh5KIBpsBB8TZB/gssSlpJyrhAEelouakAPkr5psZb3QpolAnHIqiWcAUEUBQj9tq37BIOAQiUlmTMoAsFh+stW49JO2neD2EcKS5tpSzRQBBzGSNAmrMIoSjlPBOt1MEkKFQR9Qh6t5CTjjSg66kFiQBSd9yMiqpZKhFOEoKbYytYoAgh1muq1MPtQgHJuBKa0UMEOgwa6/qZqr3OxGO0sIaZ68sIIvFg7H2I87c/JBAnm85I0DJ+86AflXblCggAlkkayZBreec8j7hUMvFq2HygOCzyM54ya0obj/Zdj7/Yo25lXIh4ZBSFtuuOCBCWWQPiTHr+XZ7j3zvrHS9Mdp9vVrdYV3J1iQUyAOIUBY5EORptt1+SgFlAMN933z8trmE3juoCYeItCKNZgFEMoscquKCz/b9etZ1zz6wDFDcmP1QShQMZg6R+BVvNBsgw7qIWzwUD8RBtU1vzMb93Q5/DkH63u5tyGXH63CQmUM8nuEXyAbILovID7XgAiEa5LAKoeI0bWQFpEVICMc0gY26anZActUjKIFS2iEcKerpOHcSQIbn1r/mrgNySk44cqotd61JAHHdqRkSwiEXsLlbngwQ19EJZrbE9SUc4hJnvcCkgFQHiZLnVrJGUOUXmxyQUV/pjYHSfmzhc9XSGmpsXw0gBU8Bbzpr73/5/Hmt0cG0KU0BVYAcQOLeDp91pTtGRtYbMaqVdY46QMa6xPb9g+R282Q3sd5IlrCEBlQCMgqndJariDc+lhB8JdioGpDXAn7/IjrxregXHJa8pb6EgKCNPypQBCATg0IwGqamKEB+GHp13U1v7a3Q1vWnvu+/XT8+PjUcG+z6/lGJ8n+uVhmK+nHmK2QGzD0zsnZAzLtu7fOgVfmKsQe+ClQByLHOur1eL1dXO1Bs170C089mm6uXl92DVITBN0zaPa5aQNp1KXuOVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFTg//8JNVC78ovQAAAAAElFTkSuQmCC");background-size:100%}.markdown-body a:active,.markdown-body a:hover{opacity:.66}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #ed7373;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#ed7373}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#fdf2f2}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #ed7373;background-color:#fdf2f2}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ed7373}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{appearance:none;-webkit-appearance:none;-moz-appearance:none;outline:none;width:16px;height:16px;border-radius:2px;background-color:transparent;box-shadow:inset 0 0 0 1px rgba(28,31,35,.3490196078);vertical-align:middle;margin:0;transform:translateY(-2px)}.markdown-body input[type=checkbox]:checked{background-color:#ed7373;background-image:url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGFyaWEtaGlkZGVuPSJ0cnVlIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3LjQxMSA3LjMwOGExLjUgMS41IDAgMDEuMjggMi4xMDNsLTYuNSA4LjVhMS41IDEuNSAwIDAxLTIuMzc1LjAxbC0zLjUtNC41YTEuNSAxLjUgMCAxMTIuMzY4LTEuODQybDIuMzA2IDIuOTY1IDUuMzE4LTYuOTU1YTEuNSAxLjUgMCAwMTIuMTAzLS4yOHoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=");box-shadow:inset 0 0 0 1px #ed7373}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">从零打造专业级前端 SDK (三)：健壮性与离线存储</h2>
<p><strong>前言</strong>：在<a href="https://juejin.cn/post/7583983152324411418" target="_blank" title="https://juejin.cn/post/7583983152324411418">上一篇</a>中，我们实现了多种网络发送策略，让 SDK 能够把数据发出去。但真实的网络环境是不可靠的——弱网、断网、高频触发都是常态。今天，我们要给 SDK 穿上一层"防弹衣"，打造一个<strong>永不丢单</strong>的健壮系统。</p>
<h3 data-id="heading-1">1. 痛点：脆弱的直接发送</h3>
<p>如果我们只是简单地调用 <code>fetch</code>，会遇到两个致命问题：</p>
<ol>
<li><strong>流量风暴</strong>：用户快速滑动列表，瞬间产生几十个请求，服务器压力山大。</li>
<li><strong>数据丢失</strong>：用户在地下停车场点击"支付"，因无网络导致请求失败，关键转化数据丢失。</li>
</ol>
<p>为了解决这些问题，我们需要引入两个核心机制：<strong>消息队列 (Queue)</strong> 和 <strong>离线存储 (Store)</strong> 。</p>
<h3 data-id="heading-2">2. 消息队列：削峰填谷</h3>
<p>我们不能来一个发一个，而是要"攒一攒"再发。这叫<strong>批处理 (Batching)</strong> 。</p>
<h4 data-id="heading-3">2.1 智能调度器 (Scheduler)</h4>
<p>我们创建一个 <code>Scheduler</code> 类来管理队列。它支持两种优先级：</p>
<ul>
<li><strong>immediate (高)</strong> ：支付、关键点击 -&gt; 立即发送。</li>
<li><strong>batch (低)</strong> ：曝光、滚动 -&gt; 攒够 10 条或 3 秒后发送。</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// src/core/Scheduler.ts</span>
export <span class="hljs-keyword">class</span> <span class="hljs-title class_">Scheduler</span> {
  <span class="hljs-keyword">private</span> queue: TrackerEvent[] = [];
  <span class="hljs-keyword">private</span> timer: number | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  addEvent(event: TrackerEvent, priority: <span class="hljs-string">'immediate'</span> | <span class="hljs-string">'batch'</span> = <span class="hljs-string">'batch'</span>) {
    <span class="hljs-keyword">this</span>.queue.push(event);

    <span class="hljs-comment">// 1. 高优先级：立即发送 (队列里所有数据)</span>
    <span class="hljs-keyword">if</span> (priority === <span class="hljs-string">'immediate'</span>) {
      <span class="hljs-keyword">this</span>.flush();
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 2. 低优先级：启动定时器 (3秒兜底)</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.timer) {
      <span class="hljs-keyword">this</span>.timer = window.setTimeout(() =&gt; <span class="hljs-keyword">this</span>.flush(), <span class="hljs-number">3000</span>);
    }

    <span class="hljs-comment">// 3. 队列满了：立即发送 (10条阈值)</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.queue.length &gt;= <span class="hljs-number">10</span>) {
      <span class="hljs-keyword">this</span>.flush();
    }
  }
}
</code></pre>
<h3 data-id="heading-4">3. 离线存储：IndexedDB 兜底</h3>
<p>当 <code>flush()</code> 发送失败时，数据不能丢，必须存起来。</p>
<h4 data-id="heading-5">3.1 为什么选 IndexedDB？</h4>


























<table><thead><tr><th>方案</th><th>容量</th><th>性能</th><th>结构化</th><th>结论</th></tr></thead><tbody><tr><td>localStorage</td><td>5MB</td><td>同步(卡顿)</td><td>仅字符串</td><td>❌ 仅适合玩具</td></tr><tr><td><strong>IndexedDB</strong></td><td><strong>&gt;250MB</strong></td><td><strong>异步</strong></td><td><strong>支持对象</strong></td><td>✅ 生产级首选</td></tr></tbody></table>
<h4 data-id="heading-6">3.2 仓库实现 (Store)</h4>
<p>我们封装一个轻量级的 <code>Store</code> 类，屏蔽 IndexedDB 的复杂 API。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/Store.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Store</span> {
  <span class="hljs-comment">// 发送失败时调用：存入数据库</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">save</span>(<span class="hljs-params">events: TrackerEvent[]</span>) {
    <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDB</span>();
    <span class="hljs-keyword">const</span> tx = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">'events'</span>, <span class="hljs-string">'readwrite'</span>);
    events.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> tx.<span class="hljs-property">store</span>.<span class="hljs-title function_">add</span>(e));
  }

  <span class="hljs-comment">// 网络恢复时调用：取出所有数据</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAll</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ...读取逻辑</span>
  }
}
</code></pre>
<h3 data-id="heading-7">4. 闭环：自动重试机制</h3>
<p>最精彩的部分来了。我们在 <code>Scheduler</code> 中监听浏览器的 <code>online</code> 事件，实现<strong>全自动恢复</strong>。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/Scheduler.ts</span>
<span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 监听网络恢复</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'online'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🌐 网络已恢复，正在重发积压数据...'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">retryFailedEvents</span>();
  });
}

<span class="hljs-keyword">async</span> <span class="hljs-title function_">retryFailedEvents</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. 从 Store 取出所有积压数据</span>
  <span class="hljs-keyword">const</span> events = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span>.<span class="hljs-title function_">getAll</span>();
  <span class="hljs-keyword">if</span> (events.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 2. 尝试重发</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">sender</span>.<span class="hljs-title function_">send</span>(events);
    <span class="hljs-comment">// 3. 发送成功，清空 Store</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span>.<span class="hljs-title function_">clear</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'✅ 重发成功！'</span>);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-comment">// 4. 依然失败？没事，数据还在 Store 里，下次再试</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'❌ 重发失败，等待下一次机会'</span>);
  }
}
</code></pre>
<h3 data-id="heading-8">5. 总结</h3>
<p>通过本篇的改造，我们的 SDK 进化了：</p>
<ul>
<li><strong>性能</strong>：请求数减少 90%（批处理）。</li>
<li><strong>可靠</strong>：弱网/断网环境下数据不丢失（离线存储）。</li>
</ul>
<p>现在，我们的 SDK 已经具备了商业级产品的核心素质。</p>
<p><strong>下一篇</strong>，我们将探讨如何让 SDK 走出浏览器，适配 <strong>Node.js</strong>、<strong>小程序</strong> 等多种运行时环境，实现真正的<strong>跨平台架构</strong>。</p>
<hr/>
<p><em>本文代码已开源，欢迎 Star</em> <em>⭐</em> <em>️</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端向架构突围系列 - 工程化（五）：企业级脚手架的设计与落地]]></title>    <link>https://juejin.cn/post/7596890557547298862</link>    <guid>https://juejin.cn/post/7596890557547298862</guid>    <pubDate>2026-01-20T05:37:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596890557547298862" data-draft-id="7596983314806833202" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端向架构突围系列 - 工程化（五）：企业级脚手架的设计与落地"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-20T05:37:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王壮壮"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端向架构突围系列 - 工程化（五）：企业级脚手架的设计与落地
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王壮壮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:37:58.000Z" title="Tue Jan 20 2026 05:37:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>写在前面</strong></p>
<p>很多团队都有一个“规范文档”，它通常静静地躺在 Wiki 的角落里，只有新员工入职的第一天会被打开，然后迅速被遗忘。</p>
<p><strong>依靠文档约束人性的规范，注定是失败的。</strong></p>
<p>在架构师的眼里，规范不应该是一个文档，而应该是一个<strong>产品</strong>——一个通过脚手架（CLI）和预设包（Presets）交付给开发者的“黑盒子”。开发者不需要知道 ESLint 的 <code>ecmaVersion</code> 是多少，也不需要纠结 Prettier 的 <code>semi</code> 是 true 还是 false，他们只需要打开盒子，直接开始工作。</p>
<p>本篇我们将探讨如何从“配置工程师”进化为“规范制定者”，通过工程化手段把标准“装进盒子里”，让错误根本无法发生。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fae9659af3e8490783668bfdb1fc1b5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492278&amp;x-signature=Pgk9MJ3vH3Bie8muCE6%2Fj3II9ws%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">一、 熵增定律：为什么 Copy-Paste 是万恶之源？</h2>
<p>在没有脚手架体系的团队，新项目的建立通常源于一句：“你去把那个老项目的配置拷贝一份过来。”</p>
<p>这种“细胞分裂”式的工程创建方式，导致了严重的 <strong>配置熵增</strong>：</p>
<ol>
<li><strong>版本分裂：</strong> 项目 A 用的是 ESLint v7，项目 B 拷贝过去后升级到了 v8，项目 C 又拷贝了 A... 最终团队维护着 5 个版本的 Lint 规则。</li>
<li><strong>规则漂移：</strong> 张三觉得 <code>no-console</code> 很烦，在项目 B 里关掉了；李四觉得分号很丑，在项目 C 里去掉了。半年后，这两个项目的代码风格就像出自两个物种。</li>
<li><strong>基建升级灾难：</strong> 当架构师决定“我们需要在所有项目里引入 Commitlint”时，他发现他需要修改 100 个仓库的 <code>package.json</code>。这不仅是体力活，更是巨大的风险。</li>
</ol>
<p><strong>架构原则一：不要让开发者直接维护配置文件。配置文件应当作为依赖包被引入。</strong></p>
<hr/>
<h2 data-id="heading-1">二、 核心策略：Configuration as Dependency</h2>
<p>要解决上述问题，必须把配置从“项目内的文件”变成“npm 包”。</p>
<h3 data-id="heading-2">2.1 也就是 Shared Config</h3>
<p>在 Monorepo 或 npm 私有库中，我们需要维护一套核心的规范包：</p>
<ul>
<li><code>@company/eslint-config-react</code></li>
<li><code>@company/prettier-config</code></li>
<li><code>@company/tsconfig</code></li>
</ul>
<p>在业务项目中，<code>.eslintrc.js</code> 应该只有一行代码：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">module.exports</span> = {
  extends: <span class="hljs-section">['@company/eslint-config-react']</span>
}<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-3">2.2 拥抱 ESLint Flat Config (Config System 的革命)</h3>
<p>2024 年以后的架构设计，必须正视 <strong>ESLint Flat Config (eslint.config.js)</strong> 的存在。 旧的 <code>.eslintrc</code> 级联系统极其复杂，导致 <code>extends</code> 覆盖逻辑经常失效。Flat Config 将配置视为一个<strong>扁平的对象数组</strong>，使得配置的组合、覆盖和共享变得符合直觉（就像合并数组一样简单）。</p>
<p><strong>架构师的职责</strong>，就是提前踩平 Flat Config 的坑，把它封装成一个开箱即用的 Plugin，屏蔽掉底层复杂的 Plugin 加载逻辑。</p>
<hr/>
<h2 data-id="heading-4">三、 门神：Husky 与 Git Hooks 的强制执行</h2>
<p>有了规范包，怎么保证开发者一定会遵守？靠自觉是不够的，必须有**“暴力”拦截**。</p>
<h3 data-id="heading-5">3.1 提交时的最后一道防线</h3>
<p>利用 <code>husky</code> + <code>lint-staged</code>，我们实现了“增量检查”。 不要试图在 commit 时检查全量代码，那会让 <code>git commit</code> 慢得像 <code>npm install</code>。只检查<strong>暂存区（Staged）</strong> 的文件，是工程体验和代码质量的最佳平衡点。</p>
<h3 data-id="heading-6">3.2 Commit Message 的标准化</h3>
<p>为什么提交信息也需要规范？ 如果你想做自动化发版（Automated Release）、自动生成 Changelog，那么 Commit Message 就必须符合 <strong>Conventional Commits</strong> 规范。</p>
<ul>
<li><code>feat: add login</code> -&gt; 触发 Minor 版本更新</li>
<li><code>fix: bug in style</code> -&gt; 触发 Patch 版本更新</li>
</ul>
<p>通过 <code>commitlint</code> 拦截乱写的提交信息，是通往自动化运维（DevOps）的必经之路。</p>
<hr/>
<h2 data-id="heading-7">四、 交付载体：脚手架（CLI）的架构设计</h2>
<p>当规范包和 Lint 工具都准备好了，我们需要一个载体把它们送达给开发者。这就是 <strong>CLI（Command Line Interface）</strong> 。</p>
<h3 data-id="heading-8">4.1 现代脚手架的技术选型</h3>
<p>别再用 Yeoman 了，也别只会 <code>git clone</code>。现代脚手架（如 <code>create-vite</code>, <code>create-next-app</code>）的架构已经非常成熟：</p>
<ul>
<li><strong>交互层：</strong> <code>prompts</code> (比 Inquirer 更轻量)</li>
<li><strong>参数解析：</strong> <code>cac</code> (比 Commander 更现代)</li>
<li><strong>模板引擎：</strong> 实际上，现代趋势是 <strong>去模板引擎化</strong>。直接拷贝预设好的文件夹结构（Template），然后修改个别文件（package.json name）。这种方式比 EJS 渲染更直观，维护成本更低。</li>
</ul>
<h3 data-id="heading-9">4.2 Preset 模式 vs Generator 模式</h3>
<ul>
<li><strong>Generator 模式（重逻辑）：</strong> 询问你“要不要 Router？”“要不要 Pinia？”，然后通过代码动态生成文件。维护成本高，容易出错。</li>
<li><strong>Preset 模式（重模板）：</strong> 维护几个标准的模板仓库（Template Repo），CLI 的作用仅仅是下载对应模板。 <strong>推荐架构：</strong> 对于企业内部，<strong>Preset 模式</strong> 更优。架构组维护 <code>template-react-admin</code>、<code>template-h5-activity</code> 等标准模板库，CLI 负责拉取和初始化。这实现了“模板与工具解耦”。</li>
</ul>
<hr/>
<h2 data-id="heading-10">五、 落地与治理：从技术到政治</h2>
<p>写出一个 CLI 很容易，让几百号人愿意用很难。这就是架构的<strong>政治属性</strong>。</p>
<h3 data-id="heading-11">5.1 存量治理的艺术</h3>
<p>对于老项目，不要试图“一刀切”地加上最严格的 ESLint 规则。那会导致满屏红线，开发者的第一反应就是 <code>/* eslint-disable */</code> 或者直接卸载插件。</p>
<p><strong>策略：</strong> 提供 <code>lint-fix</code> 脚本，并引入 <strong>"Warning First"</strong> 策略。先将新规则设为 Warning，给团队 1-2 个迭代的缓冲期，再逐步收紧为 Error。</p>
<h3 data-id="heading-12">5.2 零配置（Zero-Config）的幻觉</h3>
<p>大家都在吹捧“零配置”，但企业级架构 <strong>不能零配置</strong>。 你需要暴露必要的扩展点（Hooks）。比如，脚手架生成的 Webpack 配置，必须允许业务项目通过 <code>chainWebpack</code> 或 <code>mergeConfig</code> 进行覆盖。 <strong>架构师的智慧在于：提供完美的默认值，但保留修改的权利。</strong></p>
<hr/>
<h2 data-id="heading-13">结语：标准化的终极形态</h2>
<p>一个优秀的前端工程体系，应该让开发者感觉不到“规范”的存在。 当你 <code>git commit</code> 时，格式自动被格式化了；当你 <code>git push</code> 时，代码质量自动被检查了；当你初始化项目时，最佳实践已经自动就位了。</p>
<p>把标准装进盒子里，把自由还给开发者。</p>
<blockquote>
<p><strong>Next Step:</strong> 单个项目的规范治理虽然复杂，但还在可控范围内。如果我们将视角拉高，面对包含几十个子项目的 <strong>Monorepo（大仓）</strong> ，这些规范该如何复用？构建流程又该如何编排？ 下一节，我们将迎来工程化的“大结局”—— <strong>《第六篇：宏观——大仓时代：Monorepo 架构的工程实践与工具链选择》</strong> 。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Moshi 处理 Null 值并使用默认值的开脑洞解决方案]]></title>    <link>https://juejin.cn/post/7597083743555977259</link>    <guid>https://juejin.cn/post/7597083743555977259</guid>    <pubDate>2026-01-20T05:44:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597083743555977259" data-draft-id="7596966040922161158" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Moshi 处理 Null 值并使用默认值的开脑洞解决方案"/> <meta itemprop="keywords" content="APP,Android,Kotlin"/> <meta itemprop="datePublished" content="2026-01-20T05:44:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="limuyang2"/> <meta itemprop="url" content="https://juejin.cn/user/4283353029684126"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Moshi 处理 Null 值并使用默认值的开脑洞解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4283353029684126/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    limuyang2
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:44:23.000Z" title="Tue Jan 20 2026 05:44:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">先看问题</h2>
<p>对于<code>Json</code>中的<code>Null</code>值，常规处理的方式给对象加一个<code>?</code>号。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"str"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"i"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"5"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>(
    <span class="hljs-keyword">val</span> str: String? = <span class="hljs-string">"abc"</span>, <span class="hljs-comment">// 必须加问号，否则会崩溃</span>
    <span class="hljs-keyword">val</span> i: <span class="hljs-built_in">Int</span> = <span class="hljs-number">1</span>,
)
</code></pre>
<p>这样就会有个问题，<code>str</code>会被赋值为<code>null</code>。</p>
<p>但是我们期望<code>null</code>值的时候，使用<code>abc</code>这个默认值，做不到。除非后台不返回这个<code>str</code>这个字段，就会使用默认值。</p>
<h2 data-id="heading-1">激烈讨论过程</h2>
<p>对于<code>null</code>这个问题的理解，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsquare%2Fmoshi%2Fissues%2F843" target="_blank" title="https://github.com/square/moshi/issues/843" ref="nofollow noopener noreferrer">Moshi Github</a>上有着非常激烈的讨论。</p>
<p>总结下来就是：官方认为，后台返回 <code>null</code>，是业务的一种形式，代表这个业务不存在。我们应该在团队合作中，约定一个规范的<code>Json</code>格式行为，而不是无脑区兜底<code>null</code>值。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">官方最终的解释：
It has one answer <span class="hljs-keyword">in</span> Moshi and <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> Moshi<span class="hljs-string">'s opinion :).  
答案只有一个，那就是 Moshi 的看法:)。
</span></code></pre>
<p>好好好，<code>Moshi</code>团队你有你的看法。但是……但是，理想是很美好，我也想规范，但是现实不允许，先不说后台大哥好不好说话，就说历史API接口，没人敢动、也没人想动。</p>
<h2 data-id="heading-2">解决方案</h2>
<p>在<code>Github</code>的讨论中，不乏各种各样的解决方案，比如<code>JakeWharton</code>大神给出的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsquare%2Fmoshi%2Fissues%2F1809" target="_blank" title="https://github.com/square/moshi/issues/1809" ref="nofollow noopener noreferrer">自定义注解解决方案</a></p>
<p>这用起来很难，我不可能每个字段都去加吧。。。。。</p>
<p>在最后的回复，我看到了一个大开脑洞的方案，太巧妙了。</p>
<p><strong>自定义<code>JsonReader</code>，当读取到 <code>null</code> 的字段，直接忽略掉，欺骗上面的人，说这个字段不存在，上面的人就会用默认数值构造函数</strong>。太鸡贼了。无需用什么自定义注解，无痛切入现在的项目。</p>
<h4 data-id="heading-3">首先自定义 <code>DefaultIfNullFactory</code></h4>
<p>用于向<code>moshi</code>注册解析器，常规步骤，不多解析。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultIfNullFactory</span> : <span class="hljs-type">JsonAdapter.Factory</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(
        type: <span class="hljs-type">Type</span>,
        annotations: <span class="hljs-type">MutableSet</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Annotation</span>&gt;,
        moshi: <span class="hljs-type">Moshi</span>
    )</span></span>: JsonAdapter&lt;*&gt;? {
        <span class="hljs-keyword">if</span> (annotations.isNotEmpty()) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

        <span class="hljs-comment">// 基础数据类型忽略，moshi自己处理，就是直接是 基础数据类型的json：例如“1”，“true”</span>
        <span class="hljs-keyword">if</span> (type === String::<span class="hljs-keyword">class</span>.java) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Boolean</span>::<span class="hljs-keyword">class</span>.javaPrimitiveType) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Byte</span>::<span class="hljs-keyword">class</span>.javaPrimitiveType) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Char</span>::<span class="hljs-keyword">class</span>.javaPrimitiveType) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Double</span>::<span class="hljs-keyword">class</span>.javaPrimitiveType) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Float</span>::<span class="hljs-keyword">class</span>.javaPrimitiveType) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Int</span>::<span class="hljs-keyword">class</span>.javaPrimitiveType) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Long</span>::<span class="hljs-keyword">class</span>.javaPrimitiveType) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Short</span>::<span class="hljs-keyword">class</span>.javaPrimitiveType) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Boolean</span>::<span class="hljs-keyword">class</span>.java) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Byte</span>::<span class="hljs-keyword">class</span>.java) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Char</span>::<span class="hljs-keyword">class</span>.java) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Double</span>::<span class="hljs-keyword">class</span>.java) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Float</span>::<span class="hljs-keyword">class</span>.java) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Int</span>::<span class="hljs-keyword">class</span>.java) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Long</span>::<span class="hljs-keyword">class</span>.java) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Short</span>::<span class="hljs-keyword">class</span>.java) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

        <span class="hljs-keyword">val</span> delegate = moshi.nextAdapter&lt;Any&gt;(<span class="hljs-keyword">this</span>, type, annotations)

        <span class="hljs-comment">// 对象类型的走我们自己的，例如打括号包起来的："{}"</span>
        <span class="hljs-keyword">return</span> SkipNullsAdapter(delegate)
    }
}
</code></pre>
<p><code>SkipNullsAdapter</code> 也没啥说的</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SkipNullsAdapter</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> delegate: JsonAdapter&lt;Any&gt;
) : JsonAdapter&lt;Any&gt;() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fromJson</span><span class="hljs-params">(reader: <span class="hljs-type">JsonReader</span>)</span></span>: Any? {
        <span class="hljs-comment">// 如果是对象结构，才包装 reader 跳过 null</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (reader.peek() == JsonReader.Token.BEGIN_OBJECT) {
            <span class="hljs-comment">// 使用自己的 reader</span>
            delegate.fromJson(JsonReaderSkipNullValuesWrapper(reader))
        } <span class="hljs-keyword">else</span> {
            delegate.fromJson(reader)
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toJson</span><span class="hljs-params">(writer: <span class="hljs-type">JsonWriter</span>, value: <span class="hljs-type">Any</span>?)</span></span> {
        delegate.toJson(writer, value)
    }
}
</code></pre>
<h4 data-id="heading-4">欺骗的艺术来了</h4>
<p>自己新建一个这个<code>com.squareup.moshi</code>包名（路径名）下，因为<code>JsonReader</code> 不允许外部继承。我们需要假装自己是它包里的类。</p>
<p>然后自定义一个<code>JsonReaderSkipNullValuesWrapper</code>。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonReaderSkipNullValuesWrapper</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> wrapped: JsonReader
) : JsonReader() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> ignoreSkipName = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> ignoreSkipValue = <span class="hljs-literal">false</span>

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">close</span><span class="hljs-params">()</span></span> {
        wrapped.close()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">beginArray</span><span class="hljs-params">()</span></span> {
        wrapped.beginArray()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">endArray</span><span class="hljs-params">()</span></span> {
        wrapped.endArray()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">beginObject</span><span class="hljs-params">()</span></span> {
        wrapped.beginObject()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">endObject</span><span class="hljs-params">()</span></span> {
        wrapped.endObject()
        ignoreSkipName = <span class="hljs-literal">false</span>
        ignoreSkipValue = <span class="hljs-literal">false</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hasNext</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> wrapped.hasNext()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">peek</span><span class="hljs-params">()</span></span>: Token {
        <span class="hljs-keyword">return</span> wrapped.peek()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nextName</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">return</span> wrapped.nextName()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectName</span><span class="hljs-params">(options: <span class="hljs-type">Options</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">val</span> index = wrapped.selectName(options)
        <span class="hljs-comment">// 这里进行欺骗，返回-1表示没有这个字段</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span> &amp;&amp; wrapped.peek() == Token.NULL) {
            wrapped.skipValue()
            ignoreSkipName = <span class="hljs-literal">true</span>
            ignoreSkipValue = <span class="hljs-literal">true</span>
            -<span class="hljs-number">1</span>
        } <span class="hljs-keyword">else</span> {
            index
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">skipName</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> (ignoreSkipName) {
            ignoreSkipName = <span class="hljs-literal">false</span>
            <span class="hljs-keyword">return</span>
        }
        wrapped.skipName()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nextString</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">return</span> wrapped.nextString()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectString</span><span class="hljs-params">(options: <span class="hljs-type">Options</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> wrapped.selectString(options)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nextBoolean</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> wrapped.nextBoolean()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any?&gt;</span> <span class="hljs-title">nextNull</span><span class="hljs-params">()</span></span>: T? {
        <span class="hljs-keyword">return</span> wrapped.nextNull()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nextDouble</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Double</span> {
        <span class="hljs-keyword">return</span> wrapped.nextDouble()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nextLong</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-keyword">return</span> wrapped.nextLong()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nextInt</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> wrapped.nextInt()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nextSource</span><span class="hljs-params">()</span></span>: BufferedSource {
        <span class="hljs-keyword">return</span> wrapped.nextSource()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">skipValue</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> (ignoreSkipValue) {
            ignoreSkipValue = <span class="hljs-literal">false</span>
            <span class="hljs-keyword">return</span>
        }
        wrapped.skipValue()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">peekJson</span><span class="hljs-params">()</span></span>: JsonReader {
        <span class="hljs-keyword">return</span> wrapped.peekJson()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">promoteNameToValue</span><span class="hljs-params">()</span></span> {
        wrapped.promoteNameToValue()
    }
}
</code></pre>
<h4 data-id="heading-5">使用</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> moshi = Moshi.Builder()
    .add(DefaultIfNullFactory()) <span class="hljs-comment">// 注册进来</span>
    .build()
</code></pre>
<h4 data-id="heading-6">结果验证</h4>
<p>Json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"list"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"str"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"i"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"5"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>data class</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>(
    <span class="hljs-keyword">val</span> list: List&lt;<span class="hljs-built_in">Int</span>&gt;? = <span class="hljs-literal">null</span>, <span class="hljs-comment">// 如果想保持为null，就加上 ? 问号</span>

    <span class="hljs-keyword">val</span> str: String = <span class="hljs-string">"abc"</span>, <span class="hljs-comment">// 不想要 null，就不要加问号</span>

    <span class="hljs-keyword">val</span> i: <span class="hljs-built_in">Int</span> = <span class="hljs-number">1</span>,
)
</code></pre>
<p>输出</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Test(list=<span class="hljs-literal">null</span>, str=abc, i=<span class="hljs-number">5</span>)
</code></pre>
<p>解释下（AI生成的，我改了改。但是我觉得解释的足够清楚了）</p>
<h3 data-id="heading-7">工作原理</h3>
<p>这个类最核心的魔法发生在 <code>selectName()</code> 方法中：</p>
<ul>
<li>
<ol>
<li>它首先调用被包装的 <code>JsonReader</code> 的 <code>selectName()</code> 方法来查找下一个字段。</li>
</ol>
</li>
<li>
<ol start="2">
<li>如果找到了一个匹配的字段 (<code>index &gt;= 0</code>)，它会立刻用 <code>peek()</code> 方法查看该字段的值。</li>
</ol>
</li>
<li>
<ol start="3">
<li><strong>如果值是 <code>Token.NULL</code></strong>:</li>
</ol>
<ul>
<li>a. 它会立即调用 <code>skipValue()</code> 来消耗掉这个 <code>null</code> 值。</li>
<li>b. 然后它设置内部的 <code>ignoreSkipName</code> 和 <code>ignoreSkipValue</code> 标志位为 <code>true</code>。</li>
<li>c. 最后，它向调用者（KSP Adapter）<strong>谎称</strong>没有找到这个字段，返回 <code>-1</code>。</li>
</ul>
</li>
<li>
<ol start="4">
<li>KSP生成的Adapter收到<code>-1</code>后，会认为这是一个未知字段，并进入其 <code>case -1</code> 分支，该分支会尝试调用 <code>skipName()</code> 和 <code>skipValue()</code>，并使用属性的默认值。</li>
</ol>
</li>
<li>
<ol start="5">
<li>我们重写的 <code>skipName()</code> 和 <code>skipValue()</code> 方法会检查对应的 <code>ignore...</code> 标志位。如果为<code>true</code>，它们会消耗掉这个标志位并直接返回，从而“屏蔽”了KSP Adapter多余的跳过操作，避免了在错误的流位置上操作而导致的异常。</li>
</ol>
</li>
</ul>
<h3 data-id="heading-8">结果</h3>
<p>通过上述流程，值为<code>null</code>的字段被巧妙地从解析流中移除。这使得Moshi的后续处理逻辑会认为该字段在JSON中“缺失”。</p>
<p>Kotlin 的 data class 中对应的非空属性 必须 要提供默认值（例如 <code>val name: String = ""</code>），Moshi会使用这个默认值。如果没有默认值会导致异常。</p>
<h3 data-id="heading-9">状态管理</h3>
<ul>
<li><code>ignoreSkipName</code> 和 <code>ignoreSkipValue</code> 是处理这种“欺骗”行为所必需的状态，它们确保了在 <code>selectName</code> 手动跳过一个键值对后，能够正确地拦截并忽略掉Adapter后续的、多余的 <code>skip</code> 调用。</li>
<li>在 <code>endObject()</code> 方法中，这些状态被强制重置。这是一个防御性措施，确保在一个对象解析作用域结束时，所有临时状态都被清理干净，防止状态泄露并污染到外层对象的解析。</li>
</ul>
<h2 data-id="heading-10">Bingo</h2>
<p>巧妙的思路</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不只是图片：深入理解 GIS 栅格数据本质与 GDAL 读写实战]]></title>    <link>https://juejin.cn/post/7597009443084664847</link>    <guid>https://juejin.cn/post/7597009443084664847</guid>    <pubDate>2026-01-20T05:43:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597009443084664847" data-draft-id="7596993862534250496" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不只是图片：深入理解 GIS 栅格数据本质与 GDAL 读写实战"/> <meta itemprop="keywords" content="GIS"/> <meta itemprop="datePublished" content="2026-01-20T05:43:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="charlee44"/> <meta itemprop="url" content="https://juejin.cn/user/1117549770846872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不只是图片：深入理解 GIS 栅格数据本质与 GDAL 读写实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117549770846872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    charlee44
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:43:30.000Z" title="Tue Jan 20 2026 05:43:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>GIS 栅格数据只是一张普通图片吗？其实它可以是高程、降雨量、土地类型，甚至是二维空间信号。本文节选自新书<a href="https://link.juejin.cn?target=https%3A%2F%2Fitem.jd.com%2F14603137.html" target="_blank" title="https://item.jd.com/14603137.html" ref="nofollow noopener noreferrer">《GIS基础原理与技术实践》</a>第5章，带你穿透表象，掌握栅格数据的本质与 GDAL 开发核心技能。</p>
</blockquote>
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/2bf65f3153b943e4a60f5c4aabfbb020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1768974156&amp;x-orig-sign=RjeBNUMjDGjCHkUBCMD4gwx1TSg%3D" alt="GIS基础原理与技术实践" loading="lazy"/></p>
<h2 data-id="heading-0">第5章 地理空间数据之栅格</h2>
<h3 data-id="heading-1">导言</h3>
<p>在上一章节中，我们对地理空间数据进行了初步的介绍，并详细的论述了其表现形式之一的矢量数据。而在本章中，我们会详细论述地理空间数据的另外一种表现形式，也就是栅格数据。矢量和栅格是GIS地理空间数据最基础的两种数据类型，是一定需要理解和掌握的。</p>
<h3 data-id="heading-2">5.1 栅格数据的深入认识</h3>
<p>通过第4.1节中的介绍，我们对栅格数据有了一个初步的认识：栅格是地理空间连续实体的表达。接下来在本节中，我们会进一步探索栅格的技术细节，加深对栅格数据的理解。</p>
<h4 data-id="heading-3">5.1.1 离散还是连续</h4>
<p>记得笔者有一次跟同事争论，图像数据（也就是栅格数据）到底是离散的还是连续的？当时笔者还是个GIS菜鸟，认为图像是离散的。从前面介绍的知识来说，很显然栅格是地理的连续表达。与矢量只能知道具体的要素的坐标不同，我们可以很容易获取每一个栅格单元具体的地理坐标，体现了数据的连续性。然而，当我们把一张图像放大，我们很容易会看到一个个具体的栅格单元，如下图5.1所示：</p>
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/66df1775a12f4ec083c19658bbeee4c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1768974156&amp;x-orig-sign=iNDunJFXMWUUT1xa0iKpQBk83R8%3D" alt="图5.1 放大后的栅格单元" loading="lazy"/></p>
<p>这些栅格单元中突变的颜色表明，栅格数据并不是我们想象的那样单纯的具有连续性。栅格数据对地理空间的表达总是会受制于采样频率，最直观的体现就是分辨率。如同现实中显示器一样，分辨率越高意味着像素的数目越多，显示效果就越精细。但是无论多精细，其实都是由离散的栅格单元在二维平面上连续铺盖成的格网组成的。如此说来，笔者在菜鸟时期认为栅格数据是离散的，可以说还是具有一定的正确性的，尽管是误打误撞。离散还是连续，并不是绝对的，关键还在于是如何看待和认知：</p>
<ul>
<li>在宏观意义上，栅格数据毫无疑问是连续的，这是区别与矢量数据的根本特性。只要是在栅格数据的范围之内，就可以获取任意位置的地理对象值。</li>
<li>在微观意义上，栅格数据也可以认为是离散的。受制于数据表达的载体，总会在一个无法细分的尺度上，用一个离散的栅格单元来代表一定连续范围内的地理对象值。</li>
</ul>
<p>栅格数据关于离散还是连续的讨论，我们在后面还会涉及到。</p>
<h4 data-id="heading-4">5.1.2 栅格的表现形式</h4>
<p>我们在4.1节中介绍过，栅格数据的一种具体表现形式就是我们经常见到的图片（有时称为图像，或者影像）。但是认为图片就是栅格，这种理解并不全面，栅格数据的内涵要丰富得多。</p>
<p>我们最常见的图片是24位真彩色图片，因为每个像素都由红绿蓝（RGB）3种颜色值混合而成，而每个波段的颜色值都由而一个8位整型表示。这样，真彩色图片能表示的颜色就有 256 X 256 X 256 = 16777216 种不同颜色，这恰好大于人类能识别1000万种颜色的限制。另外，出于数据叠加显示等目的，还会将第4个波段设置成透明度。其实透明度并不是一个颜色值，其是当前颜色值与背景颜色值的混合。</p>
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/686ca87b725242ce9dabea21ae821523~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1768974156&amp;x-orig-sign=y%2BULYpFurEznnpUhZgWBHbWJsoo%3D" alt="图5.2 国家天地图上的真彩色数字影像图" loading="lazy"/></p>
<p>在遥感领域，很多传感器并不是只能接受红绿蓝这三种可见光的波段，一些不可见的波段也可以接收到（比如红外波段），这主要取决于传感器的波长分辨率。因此，第4个波段也不一定就是透明度，而是其光谱的反射值或者辐射值。甚至于可以存在4个以上的波段。光谱的反射值也不一定就是8位整型，用于遥感探测的传感器要敏感的多，因此每个波段的光谱反射值是16位、32位甚至64位数值都是有可能的。</p>
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/61bdc944b0b949b8adbd7d574f974dca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1768974156&amp;x-orig-sign=bEY%2BtNYyF3oggwySehck0uDFRcM%3D" alt="图5.3 遥感影像中的不可见光波段" loading="lazy"/></p>
<p>栅格数据中格网单元的取值可以是可见光的颜色，也可以是遥感获取的具体探测值。那么，存放其他类型的数据是可以的吗?当然也是可以的，比如我们可以在栅格数据中储存高程值，就可以表达地形，成为栅格形式的DEM（Digital Elevation Model，数字高程模型）数据。这一点我们会在后续的地形章节中专门论述它。</p>
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/5faaa1d52b7a404baadfa17030be3c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1768974156&amp;x-orig-sign=Zm7weBUTcHs4oZTH1SLuvd5le2w%3D" alt="图5.4 SRTM（Shuttle Radar Topography Mission，航天飞机雷达地形测量）地形数据晕渲图" loading="lazy"/></p>
<p>既然栅格单元可以存放高程，那么存放一些诸如表达降雨量，污染浓度这样的测量值，或者土地类型这样的分类值也是可以的——此类数据就是与业务紧密关联的专题栅格数据，具有很大的实用价值，可以在其基础之上进行专题分析，例如利用降雨量专题数据进行淹没分析。当然，专题栅格数据如果需要进行可视化的话，就需要进行转换。</p>
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/66788c88dd274e7ab005745cdda5f8ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1768974156&amp;x-orig-sign=Noeti6Ueyotbh8828U0ECYwZqB0%3D" alt="图5.5 国家天地图上的人口密度专题图" loading="lazy"/></p>
<p>栅格数据（图像）还可以看成是信号。在常规的认知中，我们通常认为信号是随时间t变化的一种东西，比如电磁波或者声波。实际上，栅格数据（图像）可以认为是一个沿着空间分布、随着X空间轴和Y空间轴变化的二维信号。有这一点认知非常重要，因为很多栅格数据处理的算法都需要借助于信号的理论，比如我们后续会介绍的滤波。</p>
<p>最后，在数学中可以认为栅格数据就是一个很大的矩阵，可以进行复杂的矩阵运算。很多运算数据都可以转换成矩阵，从而被转换成图片格式来保存，这也与我们认知的常规图片不同。</p>
<h4 data-id="heading-5">5.1.3 正射还是透视</h4>
<p>以GIS中最常用的地图来说，我们至少有这样一个认识：地图上每一段相同距离所代表的实际距离都相等。如果不具备这样的特性，地图就不可能辅助我们进行导航等空间位置上的决策。在GIS中，大部分栅格数据就是这种具备相同比例尺的光学影像数据，它好像是很多道平行的光线同时反射到摄像机成像生成的，所以通常被称为数字正射影像图（DOM，Digital Orthophoto Map）。</p>
<p>但是在现实中，理想的正射成像模型几乎不存在，大多数摄像机都是透视成像模型，其生成的图像最大的特点就是近大远小，并且投影的光线会聚于一点。这也是真实的人眼成像的特点。其实，数字正射影像图就是通过透视成像模型的图片做几何纠正生成的，这一点在GIS的关联学科《摄影测量学》中有详细的介绍。如下图5.6所示为正射成像模型和透视成像模型示意图：</p>
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/3cde9d566ada4f4c96c337bee200ced3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1768974156&amp;x-orig-sign=%2BlsjJEVy108ohq5kIu1tEqSQemE%3D" alt="图5.6 正射成像模型和透视成像模型" loading="lazy"/></p>
<p>正射还是透视只是图像的生成的两种不同的方式，并不会影响图像或者栅格数据本身的性质。在GIS中的栅格数据大多数指的是数字正射影像图，能够使用专业的GIS方法进行处理，这是常规的基于透视成像模型的图片所不具备的。</p>
<h3 data-id="heading-6">5.2 栅格数据开发基础</h3>
<h4 data-id="heading-7">5.2.1 栅格数据读取</h4>
<p>与矢量数据一样，可以使用第三方开源库GDAL来实现栅格数据的基础开发。GDAL提供了市面上绝大多数常见栅格数据的支持，并将其抽象成一个数据集对象。读取栅格数据的示例如下例5.1所示：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 例5.1 使用GDAL读取栅格数据</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;gdal_priv.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">GDALAllRegister</span>();

  string srcFile = <span class="hljs-built_in">getenv</span>(<span class="hljs-string">"GISBasic"</span>);
  srcFile = srcFile + <span class="hljs-string">"/../Data/Raster/berry_ali_2011127_crop_geo.tif"</span>;

  GDALDataset* img = (GDALDataset*)<span class="hljs-built_in">GDALOpen</span>(srcFile.<span class="hljs-built_in">c_str</span>(), GA_ReadOnly);
  <span class="hljs-keyword">if</span> (!img) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  }

  <span class="hljs-type">int</span> imgWidth = img-&gt;<span class="hljs-built_in">GetRasterXSize</span>();   <span class="hljs-comment">//图像宽度</span>
  <span class="hljs-type">int</span> imgHeight = img-&gt;<span class="hljs-built_in">GetRasterYSize</span>();  <span class="hljs-comment">//图像高度</span>
  <span class="hljs-type">int</span> bandNum = img-&gt;<span class="hljs-built_in">GetRasterCount</span>();    <span class="hljs-comment">//波段数</span>
  <span class="hljs-type">int</span> depth = <span class="hljs-built_in">GDALGetDataTypeSize</span>(img-&gt;<span class="hljs-built_in">GetRasterBand</span>(<span class="hljs-number">1</span>)-&gt;<span class="hljs-built_in">GetRasterDataType</span>()) / <span class="hljs-number">8</span>;  <span class="hljs-comment">//图像深度</span>

  cout &lt;&lt; <span class="hljs-string">"宽度："</span> &lt;&lt; imgWidth &lt;&lt; <span class="hljs-string">'\n'</span>;
  cout &lt;&lt; <span class="hljs-string">"高度："</span> &lt;&lt; imgHeight &lt;&lt; <span class="hljs-string">'\n'</span>;
  cout &lt;&lt; <span class="hljs-string">"波段数："</span> &lt;&lt; bandNum &lt;&lt; <span class="hljs-string">'\n'</span>;
  cout &lt;&lt; <span class="hljs-string">"深度："</span> &lt;&lt; depth &lt;&lt; <span class="hljs-string">'\n'</span>;

  <span class="hljs-built_in">GDALClose</span>(img);
  img = <span class="hljs-literal">nullptr</span>;
}
</code></pre>
<p>在这个示例中，从栅格数据文件中创建了一个数据集对象，并且获取了影像的宽度、高度和波段数（通道数）和深度。深度有点难以理解，指的是栅格存储数据类型的字节数。常规的影像数据都采用8位无符号整型进行存储，因此深度都为1。
本例运行结果如下：</p>
<pre><code class="hljs language-bash" lang="bash">宽度：4000
高度：7200
波段数：4
深度：1
</code></pre>
<h4 data-id="heading-8">5.2.2 栅格数据创建</h4>
<p>另一方面，也可以根据一个数据集对象创建栅格数据文件，也就是栅格数据的写出操作。与第4.4.2节中创建矢量的步骤类似，同样通过GDAL的数据驱动GDALDriver，传入数据类型的名称来创建对应格式的栅格文件，如下例5.2所示，创建了一个tif格式的栅格数据：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 例5.2 使用GDAL创建栅格数据</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;gdal_priv.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">GDALAllRegister</span>();  <span class="hljs-comment">//注册格式</span>

  string dstFile = <span class="hljs-built_in">getenv</span>(<span class="hljs-string">"GISBasic"</span>);
  dstFile = dstFile + <span class="hljs-string">"/../Data/Raster/dst.tif"</span>;

  GDALDriver* pDriver =
      <span class="hljs-built_in">GetGDALDriverManager</span>()-&gt;<span class="hljs-built_in">GetDriverByName</span>(<span class="hljs-string">"GTiff"</span>);  <span class="hljs-comment">//图像驱动</span>
  <span class="hljs-type">char</span>** ppszOptions = <span class="hljs-literal">NULL</span>;
  ppszOptions =
      <span class="hljs-built_in">CSLSetNameValue</span>(ppszOptions, <span class="hljs-string">"BIGTIFF"</span>, <span class="hljs-string">"IF_NEEDED"</span>);  <span class="hljs-comment">//配置图像信息</span>

  <span class="hljs-type">int</span> imgWidth = <span class="hljs-number">256</span>;
  <span class="hljs-type">int</span> imgHeight = <span class="hljs-number">256</span>;
  <span class="hljs-type">int</span> bandNum = <span class="hljs-number">3</span>;
  GDALDataset* dst = pDriver-&gt;<span class="hljs-built_in">Create</span>(dstFile.<span class="hljs-built_in">c_str</span>(), imgWidth, imgHeight,
                                     bandNum, GDT_Byte, ppszOptions);
  <span class="hljs-keyword">if</span> (!dst) {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Can't Write Image!"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  }

  <span class="hljs-built_in">GDALClose</span>(dst); 
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>上例中我们创建了一个宽256，高256，波段数3，byte类型（8位，深度1）的栅格数据文件：</p>
<pre><code class="hljs language-cpp" lang="cpp">GDALDriver* pDriver =
      <span class="hljs-built_in">GetGDALDriverManager</span>()-&gt;<span class="hljs-built_in">GetDriverByName</span>(<span class="hljs-string">"GTiff"</span>);  <span class="hljs-comment">//图像驱动</span>
  <span class="hljs-comment">//...</span>
  GDALDataset* dst = pDriver-&gt;<span class="hljs-built_in">Create</span>(dstFile.<span class="hljs-built_in">c_str</span>(), imgWidth, imgHeight,
                                     bandNum, GDT_Byte, ppszOptions);
</code></pre>
<p>数据类型的名称“GTIFF”是GDAL定义的驱动名，表示创建的数据集对象是一个tif格式的栅格数据文件。一些常用栅格数据格式在GDAL中数据驱动如下表5.1所示：</p>


































<table><thead><tr><th>名称</th><th>全称</th></tr></thead><tbody><tr><td>JPEG</td><td>JPEG JFIF File Format</td></tr><tr><td>PNG</td><td>Portable Network Graphics</td></tr><tr><td>BMP</td><td>Microsoft Windows Device Independent Bitmap</td></tr><tr><td>GTiff</td><td>GeoTIFF File Format</td></tr><tr><td>HFA</td><td>Erdas Imagine .img</td></tr><tr><td>ENVI</td><td>ENVI .hdr Labelled Raster</td></tr></tbody></table>
<p>其中，JPEG、PNG和BMP就是我们经常见到的图像数据格式；GTiff（GeoTIFF）、HFA（Erdas Imagine .img）和ENVI（ENVI .hdr Labelled Raster）则是专业的GIS栅格数据。前者通用性更强，能被常规的图片软件所识别；而后者专业性更高，一些栅格数据的特性常规图像数据无法支持（例如存在数据量大小限制），因此只能使用专业GIS栅格数据，一般情况仅被GIS相关的软件支持。</p>
<p>另一点值得注意的是，在创建特定数据集对象时，可以根据特定格式的需求进行配置：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">char</span>** ppszOptions = <span class="hljs-literal">NULL</span>;
  ppszOptions =
      <span class="hljs-built_in">CSLSetNameValue</span>(ppszOptions, <span class="hljs-string">"BIGTIFF"</span>, <span class="hljs-string">"IF_NEEDED"</span>);  <span class="hljs-comment">//配置图像信息</span>
  <span class="hljs-comment">//...</span>
  GDALDataset* dst = pDriver-&gt;<span class="hljs-built_in">Create</span>(dstFile.<span class="hljs-built_in">c_str</span>(), imgWidth, imgHeight,
                                     bandNum, GDT_Byte, ppszOptions);
</code></pre>
<p>这里配置参数的意思是，在需要的时候使用“BIGTIFF”格式而不是“TIFF”，以避免当栅格数据文件的大小超过4G的时候会创建失败。</p>
<p>最后，在创建数据集完成之后，不要忘了关闭数据集：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">GDALClose</span>(dst);
</code></pre>
<p>此时创建的数据集文件就是一张黑色的栅格图片（因为关闭后默认填充0像素值），如下图5.7所示：</p>
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/3e0cfa70419a44479c4a90a01144a6b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1768974156&amp;x-orig-sign=E7fN5YXx2DcfOM1dfNxHJhtF6%2B0%3D" alt="图5.7 创建的栅格数据集文件" loading="lazy"/></p>
<hr/>
<p>本文节选自作者新书《GIS基础原理与技术实践》第5章。书中系统讲解 GIS 核心理论与多语言实战，适合开发者与高校师生。</p>
<p>📚 <strong>配套资源开源</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffafa1899%2FGISBasic" target="_blank" title="https://github.com/fafa1899/GISBasic" ref="nofollow noopener noreferrer">GitHub</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Fcharlee44%2FGISBasic" target="_blank" title="https://gitcode.com/charlee44/GISBasic" ref="nofollow noopener noreferrer">GitCode</a></p>
<p>🛒 <strong>支持正版</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fitem.jd.com%2F14603137.html" target="_blank" title="https://item.jd.com/14603137.html" ref="nofollow noopener noreferrer">京东</a>｜<a href="https://link.juejin.cn?target=https%3A%2F%2Fproduct.dangdang.com%2F29988568.html" target="_blank" title="https://product.dangdang.com/29988568.html" ref="nofollow noopener noreferrer">当当</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用瑞士风格哈希表实现更快的 ES|QL 统计]]></title>    <link>https://juejin.cn/post/7597058281435578422</link>    <guid>https://juejin.cn/post/7597058281435578422</guid>    <pubDate>2026-01-20T05:36:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597058281435578422" data-draft-id="7597058281435562038" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用瑞士风格哈希表实现更快的 ES|QL 统计"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2026-01-20T05:36:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用瑞士风格哈希表实现更快的 ES|QL 统计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:36:47.000Z" title="Tue Jan 20 2026 05:36:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：来自 Elastic <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fchris-hegarty" title="https://www.elastic.co/search-labs/author/chris-hegarty" target="_blank" ref="nofollow noopener noreferrer">Chris Hegarty</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fmatthew-alp" title="https://www.elastic.co/search-labs/author/matthew-alp" target="_blank" ref="nofollow noopener noreferrer">Matthew Alp</a> 及 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fnik-everet" title="https://www.elastic.co/search-labs/author/nik-everet" target="_blank" ref="nofollow noopener noreferrer">Nik Everet</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47135a0cbada4492945bae87c6e48bb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492207&amp;x-signature=GmMkIkhcYw5h2wbGxmRtoIBnt6M%3D" alt="" loading="lazy"/></p>
<p>瑞士风格启发的哈希和 SIMD 友好的设计如何在 Elasticsearch Query Language ( ES|QL ) 中提供稳定且可衡量的性能提升。</p>
<p>动手使用 Elasticsearch：深入我们的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch-labs%3Ftab%3Dreadme-ov-file" title="https://github.com/elastic/elasticsearch-labs?tab=readme-ov-file" target="_blank" ref="nofollow noopener noreferrer">示例 notebooks</a>，开始<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud%2Fcloud-trial-overview" title="https://www.elastic.co/cloud/cloud-trial-overview" target="_blank" ref="nofollow noopener noreferrer">免费 cloud trial</a>，或现在在你的<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">本地机器</a>上试用 Elastic。</p>
<hr/>
<p>我们最近将 Elasticsearch 的哈希表实现的关键部分替换为瑞士风格设计，并在均匀、高基数的工作负载上观察到构建和迭代时间提高了 2–3 倍。结果是更低的延迟、更高的吞吐量，以及 Elasticsearch Query Language ( <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fquery-filter%2Flanguages%2Fesql" title="https://www.elastic.co/docs/explore-analyze/query-filter/languages/esql" target="_blank" ref="nofollow noopener noreferrer">ES|QL</a> ) 统计和分析操作更可预测的性能。</p>
<h2 data-id="heading-0">为什么这很重要</h2>
<p>大多数典型的分析工作流最终归结为对数据进行分组。无论是计算每个 host 的平均字节数、统计每个用户的事件，还是跨维度聚合指标，核心操作都是相同的 —— 将 keys 映射到组并更新运行中的 aggregates。</p>
<p>在小规模下，几乎任何合理的哈希表都能正常工作。在大规模下（数亿文档和数百万个不同组），细节开始重要。负载因子、探测策略、内存布局和缓存行为可能决定性能是线性的还是满是缓存未命中的墙。</p>
<p>Elasticsearch 多年来一直支持这些工作负载，但我们始终在寻找现代化核心算法的机会。因此，我们评估了一种受瑞士表启发的新方法，并将其应用于 ES|QL 计算统计的方式。</p>
<h2 data-id="heading-1">瑞士表到底是什么？</h2>
<p>瑞士表是一类现代哈希表，由 Google 的 SwissTable 推广，后来被 Abseil 和其他库采用。</p>
<p>传统哈希表在追踪指针或加载 keys 时花费大量时间，结果却发现不匹配。瑞士表的定义特征是能够使用一个小型驻缓存数组结构来拒绝大多数探测，该结构与 keys 和 values 分开存储，称为 control bytes，从而显著减少内存流量。</p>
<p>每个控制 byte 表示一个 slot，在我们的例子中编码两件事：该 slot 是否为空，以及从 hash 派生的短 fingerprint。这些控制 bytes 在内存中连续排列，通常以 16 个为一组，非常适合<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSingle_instruction%2C_multiple_data" title="https://en.wikipedia.org/wiki/Single_instruction,_multiple_data" target="_blank" ref="nofollow noopener noreferrer">单指令多数据</a> (SIMD) 处理。</p>
<p>瑞士表不是一次探测一个 slot，而是使用向量指令扫描整个 control-byte 块。在一次操作中，CPU 将进入的 key 的 fingerprint 与 16 个 slots 比较，并过滤掉空条目。只有少数通过此快速路径的候选项需要加载和比较实际 keys。</p>
<p>这种设计用少量额外的元数据换取更好的缓存局部性和更少的随机加载。随着表的增长和探测链的延长，这些特性变得越来越有价值。</p>
<h2 data-id="heading-2">SIMD是核心</h2>
<p>真正的主角是 SIMD。</p>
<p>控制 bytes 不仅紧凑，而且专门设计为可以使用向量指令处理。一次 SIMD 比较可以同时检查 16 个 fingerprints，将原本的循环变成少量的宽操作。例如：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d0aea68632e4f7fbeeac3ae3a0fc6c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492207&amp;x-signature=C5iZLHj0XVIoSIuvHzaLJUciE%2FE%3D" alt="" loading="lazy"/></p>
<p>在实践中，这意味着：</p>
<ul>
<li>更少的分支</li>
<li>更短的探测链</li>
<li>更少从 key 和 value 内存的加载</li>
<li>CPU 执行单元的利用率大幅提高</li>
</ul>
<p>大多数查找从未超过控制-byte 扫描阶段。当查找超过时，剩余工作集中且可预测。这正是现代 CPU 擅长处理的工作负载类型。</p>
<h2 data-id="heading-3">SIMD底层原理</h2>
<p>对于喜欢深入了解底层的读者，以下是将新 key 插入表时发生的情况。我们使用 Panama Vector API 和 128 位向量，因此可以并行处理 16 个控制 bytes。</p>
<p>下面的代码片段显示了在带 AVX-512 的 Intel Rocket Lake 上生成的代码。虽然指令反映了该环境，但设计并不依赖于 AVX-512。在其他平台上使用等效指令（例如 AVX2、SSE 或 NEON）也会生成相同的高层向量操作。</p>
<pre><code class="hljs language-ini" lang="ini">`

1.  <span class="hljs-comment">; Load 16 control bytes from the control block</span>
2.  vmovdqu xmm0, XMMWORD PTR <span class="hljs-section">[r9+r10*1+0x10]</span>

4.  <span class="hljs-comment">; Broadcast the 7-bit fingerprint of the new key across the vector</span>
5.  vpbroadcastb xmm1, r11d

7.  <span class="hljs-comment">; Compare all 16 control bytes to the new fingerprint</span>
8.  vpcmpeqb k7, xmm0, xmm1
9.  kmovq rbx, k7

11.  <span class="hljs-comment">; Check if any matches were found</span>
12.  test rbx, rbx
13.  jne &lt;handle_match&gt;

`AI写代码!<span class="hljs-section">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>每条指令在插入过程中都有明确作用：</p>
<ul>
<li>vmovdqu：将 16 个连续的控制 bytes 加载到 128 位 xmm0 寄存器中</li>
<li>vpbroadcastb：将新 key 的 7 位 fingerprint 在 xmm1 寄存器的所有通道中复制</li>
<li>vpcmpeqb：将每个控制 byte 与广播的 fingerprint 比较，生成潜在匹配的掩码</li>
<li>kmovq + test：将掩码移动到通用寄存器，并快速检查是否存在匹配</li>
</ul>
<p>最后，使用更宽的寄存器和相应指令在我们的基准测试中未显示出明显的性能提升。</p>
<h2 data-id="heading-4">ES|QL中的集成</h2>
<p>在 Elasticsearch 中采用瑞士风格哈希并不是直接替换。ES|QL 对内存计算、安全性以及与其他计算引擎的集成有严格要求。</p>
<p>我们将新的哈希表与 Elasticsearch 的内存管理紧密集成，包括页面回收器和 circuit breaker 计数，确保分配保持可见且受限。Elasticsearch 的聚合数据密集存储，并按 group ID 索引，使内存布局紧凑、迭代快速，同时通过允许随机访问实现某些性能优化。</p>
<p>对于可变长度的字节 keys，我们将完整 hash 与 group ID 一起缓存。这避免了在探测过程中重新计算昂贵的 hash 码，并通过将相关元数据靠近存放来提高缓存局部性。在 rehash 过程中，我们可以依赖缓存的 hash 和控制 bytes，而无需检查值本身，从而保持调整大小成本低。</p>
<p>我们实现中的一个重要简化是条目从不删除。这消除了 tombstones（标记以前占用的 slots）的需求，使空 slot 保持真正空闲，进一步改善探测行为并保持控制-byte 扫描高效。</p>
<p>结果是一个自然适应 Elasticsearch 执行模型的设计，同时保留了瑞士表吸引人的性能特性。</p>
<h2 data-id="heading-5">性能如何？</h2>
<p>在小基数下，瑞士表的性能大致与现有实现相当。这是预期的：当表较小时，缓存效应影响较小，几乎没有需要优化的探测。</p>
<p>随着基数增加，情况会迅速变化。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a46e11f040f1404fb6d9f683a9cb9a5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492207&amp;x-signature=BvJxcOO0Udk6bjDMI%2FX9X21jFLY%3D" alt="" loading="lazy"/></p>
<p>上方的热图显示了不同 key 大小（8、32、64 和 128 bytes）在基数从 1,000 到 10,000,000 组下的时间提升因子。随着基数增加，提升因子稳步上升，在均匀分布下可达到 2–3 倍。</p>
<p>这一趋势正是设计所预测的。传统哈希表中基数越高，探测链越长，而瑞士风格探测则继续在 SIMD 友好的控制-byte 块中解决大多数查找。</p>
<h2 data-id="heading-6">缓存行为说明一切</h2>
<p>为了更好理解速度提升，我们在 Linux perf 下运行相同的 JMH <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch%2Fpull%2F139343%2Ffiles%23diff-d0e0cc91a7495bf36b2d44eacce95f5185d01879e5f6c38089ac7a89aad17da7" title="https://github.com/elastic/elasticsearch/pull/139343/files#diff-d0e0cc91a7495bf36b2d44eacce95f5185d01879e5f6c38089ac7a89aad17da7" target="_blank" ref="nofollow noopener noreferrer">基准测试</a>，并捕获缓存和 TLB 统计数据。</p>
<p>与原实现相比，瑞士版本总体缓存引用减少约 60%。最后一级缓存（LLC）加载下降超过 4 倍，LLC 加载未命中下降超过 6 倍。由于 LLC 未命中通常直接转化为主内存访问，仅这一减少就解释了端到端性能提升的大部分。</p>
<p>靠近 CPU 层面，我们看到 L1 数据缓存未命中减少，数据 TLB 未命中几乎减少 6 倍，显示出更紧密的空间局部性和更可预测的内存访问模式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5be1f742b284fc7a4aaf489263fe372~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492207&amp;x-signature=YYzCMoYJvLBF1aVa1kHd2tnM6SI%3D" alt="" loading="lazy"/></p>
<p>这就是 SIMD 友好控制 bytes 的实际收益。大多数探测通过扫描紧凑、驻缓存的结构即可解决，而无需反复从分散的内存位置加载 keys 和 values。访问的内存越少，未命中越少，未命中越少，查询就越快。</p>
<h2 data-id="heading-7">总结</h2>
<p>通过采用瑞士风格哈希表设计，并充分利用 SIMD 友好探测，我们在高基数 ES|QL 统计工作负载上实现了 2–3 倍的加速，同时性能更加稳定且可预测。</p>
<p>这项工作强调了现代 CPU 感知数据结构如何释放可观的性能增益，即使是针对哈希表等已被广泛研究的问题。这里还有更多探索空间，例如额外的基本类型特化，以及在其他高基数路径（如 joins）中的应用，这些都只是持续现代化 Elasticsearch 内部的更广泛努力的一部分。</p>
<p>如果你对细节感兴趣或想跟踪这项工作，可以查看 Github 上的这个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch%2Fpull%2F139343" title="https://github.com/elastic/elasticsearch/pull/139343" target="_blank" ref="nofollow noopener noreferrer">pull request</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch%2Fissues%2F138799" title="https://github.com/elastic/elasticsearch/issues/138799" target="_blank" ref="nofollow noopener noreferrer">meta issue</a>。</p>
<p>祝哈希愉快！</p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Fesql-swiss-hash-stats" title="https://www.elastic.co/search-labs/blog/esql-swiss-hash-stats" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labs…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript函数指南]]></title>    <link>https://juejin.cn/post/7596991930984628275</link>    <guid>https://juejin.cn/post/7596991930984628275</guid>    <pubDate>2026-01-20T05:38:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596991930984628275" data-draft-id="7596998306380595250" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript函数指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-20T05:38:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wuhen_n"/> <meta itemprop="url" content="https://juejin.cn/user/4149996261738233"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript函数指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4149996261738233/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wuhen_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:38:52.000Z" title="Tue Jan 20 2026 05:38:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 TypeScript 中，函数不再是简单的代码块，而是具有精确类型约束的可组合单元。本文将深入讲解 TypeScript 函数，掌握从基础声明到多态模式的完整知识体系。</p>
</blockquote>
<h2 data-id="heading-0">函数声明与调用</h2>
<h3 data-id="heading-1">函数声明</h3>
<p>在之前的文章中，我们介绍过 <code>函数（Function）</code> 也是 TypeScript 中的数据类型的一种，在 TypeScript 中，函数是这样的：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
	<span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<blockquote>
<p>注：上述代码只是为了完整的函数声明展示，实际开发中，我们只会显式声明函数的参数（上述例子中的 a 和 b）；而返回类型是不用显式声明的，毕竟 TypeScript 能自己推导的事，没必要人为再操作一次。</p>
</blockquote>
<p>在 TypeScript 中，支持以下五种函数声明方式。</p>
<h4 data-id="heading-2">普通具名函数</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) {
	<span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<h4 data-id="heading-3">函数表达式</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> greet = <span class="hljs-keyword">function</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">${name}</span>!`</span>;
};
</code></pre>
<h4 data-id="heading-4">箭头函数</h4>
<ul>
<li>简单的箭头函数语法：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> greet = (<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">${name}</span>!`</span>;
};
</code></pre>
<ul>
<li>箭头函数的简写形式：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">greet</span> = (<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) =&gt; <span class="hljs-string">`Hello, <span class="hljs-subst">${name}</span>!`</span>;
</code></pre>
<h4 data-id="heading-5">类方法声明</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
    <span class="hljs-comment">// 实例方法</span>
    <span class="hljs-title function_">add</span>(<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-keyword">return</span> x + y;
    }
    
    <span class="hljs-comment">// 静态方法</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-keyword">return</span> x * y;
    }
    
    <span class="hljs-comment">// 可选方法</span>
    optionalMethod?(<span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>;
}
</code></pre>
<h4 data-id="heading-6">构造函数声明</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> name: <span class="hljs-built_in">string</span>,
        <span class="hljs-keyword">public</span> age: <span class="hljs-built_in">number</span>,
        <span class="hljs-keyword">private</span> id?: <span class="hljs-built_in">string</span>
    </span>) {}
}

<span class="hljs-comment">// 构造签名类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserConstructor</span> = <span class="hljs-keyword">new</span> (<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>) =&gt; <span class="hljs-title class_">User</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">Ctor: UserConstructor, name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>): <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>(name, age);
}
</code></pre>
<h2 data-id="heading-7">函数重载</h2>
<p>在本节开始之前，先看一条定理：</p>
<pre><code class="hljs language-bash" lang="bash">不能基于 TypeScript 来重载一个函数。
</code></pre>
<p>这句话到底是什么意思呢？我们来看一个简单的示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a:<span class="hljs-built_in">number</span>, b:<span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a:<span class="hljs-built_in">string</span>, b:<span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<p>上述示例代码会报错：<code>函数实现重复</code> ，即我们不能通过类似Java、C++ 等语言形式，通过参数类型不同来实现函数重载。那么，在 TypeScript 中，我们应该如何操作呢？</p>
<ul>
<li>为一个函数提供多个声明，但只有一个实现：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">string</span>, b: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>, b: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a === <span class="hljs-string">"number"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> b === <span class="hljs-string">"number"</span>) {
    <span class="hljs-keyword">return</span> a + b; <span class="hljs-comment">// 数字相加</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a === <span class="hljs-string">"string"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> b === <span class="hljs-string">"string"</span>) {
    <span class="hljs-keyword">return</span> a + b; <span class="hljs-comment">// 字符串拼接</span>
  }
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"参数必须同时为number或string"</span>);
}
</code></pre>
<p>上述代码中，前两个 add 函数的声明，只提供类型信息，当 TypeScript 生成 JavaScript 时，它们会自动移除，只留下实现。</p>
<blockquote>
<p>上述代码只是一个简单的重载示例，本身是存在缺陷的，上述情况下，我们应优先选择条件类型，而不是重载声明。</p>
</blockquote>
<h2 data-id="heading-8">多态函数与泛型</h2>
<h3 data-id="heading-9">什么是多态</h3>
<p><strong>多态</strong> 顾名思义，意味着"多种形态"。在 TypeScript 中，多态主要通过泛型实现，它允许我们编写可以处理多种类型的代码，同时保持类型安全。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 非多态版本：为每种类型写一个函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">identityString</span>(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">identityNumber</span>(<span class="hljs-params">value: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">identityBoolean</span>(<span class="hljs-params">value: <span class="hljs-built_in">boolean</span></span>): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-comment">// 多态版本：一个函数处理所有类型</span>
<span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">value</span>: T): T {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-comment">// 可以处理任意类型</span>
<span class="hljs-title function_">identity</span>(<span class="hljs-string">"hello"</span>);   <span class="hljs-comment">// string</span>
<span class="hljs-title function_">identity</span>(<span class="hljs-number">42</span>);        <span class="hljs-comment">// number</span>
<span class="hljs-title function_">identity</span>(<span class="hljs-literal">true</span>);      <span class="hljs-comment">// boolean</span>
<span class="hljs-title function_">identity</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// number[]</span>
</code></pre>
<h3 data-id="heading-10">什么是泛型</h3>
<p><strong>泛型</strong> 是类型系统中的类型参数，它允许我们在定义函数、接口、类时声明类型变量，在使用时再指定具体类型。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 泛型就像函数的参数，但是针对类型</span>
<span class="hljs-comment">// 普通函数参数：在调用时传递值</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> x + y;
}

<span class="hljs-comment">// 泛型函数：在调用时传递类型</span>
<span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">value</span>: T): T {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-comment">// T 是类型参数，就像 value 是值参数</span>
</code></pre>
<h3 data-id="heading-11">何时使用泛型？</h3>
<h4 data-id="heading-12">当需要保持输入输出类型一致时</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 示例1：身份函数</span>
<span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">value</span>: T): T {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-comment">// 示例2：数组包装</span>
<span class="hljs-keyword">function</span> wrapInArray&lt;T&gt;(<span class="hljs-attr">value</span>: T): T[] {
    <span class="hljs-keyword">return</span> [value];
}

<span class="hljs-comment">// 示例3：交换函数</span>
<span class="hljs-keyword">function</span> swap&lt;T, U&gt;(<span class="hljs-attr">pair</span>: [T, U]): [U, T] {
    <span class="hljs-keyword">return</span> [pair[<span class="hljs-number">1</span>], pair[<span class="hljs-number">0</span>]];
}

<span class="hljs-keyword">const</span> swapped = <span class="hljs-title function_">swap</span>([<span class="hljs-number">1</span>, <span class="hljs-string">"hello"</span>]); <span class="hljs-comment">// ["hello", 1]</span>
</code></pre>
<h4 data-id="heading-13">当函数逻辑与具体类型无关时</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 处理数组的函数，不关心数组元素的类型</span>
<span class="hljs-keyword">function</span> getLast&lt;T&gt;(<span class="hljs-attr">array</span>: T[]): T | <span class="hljs-literal">undefined</span> {
    <span class="hljs-keyword">return</span> array[array.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
}

<span class="hljs-comment">// 映射函数，转换逻辑由调用者提供</span>
<span class="hljs-keyword">function</span> mapArray&lt;T, U&gt;(
    <span class="hljs-attr">array</span>: T[],
    <span class="hljs-attr">mapper</span>: <span class="hljs-function">(<span class="hljs-params">item: T, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> U
): U[] {
    <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">map</span>(mapper);
}

<span class="hljs-comment">// 过滤函数</span>
<span class="hljs-keyword">function</span> filterArray&lt;T&gt;(
    <span class="hljs-attr">array</span>: T[],
    <span class="hljs-attr">predicate</span>: <span class="hljs-function">(<span class="hljs-params">item: T</span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
): T[] {
    <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">filter</span>(predicate);
}
</code></pre>
<h4 data-id="heading-14">当需要类型约束时</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 约束类型参数必须具有特定属性</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasLength</span> {
    <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">function</span> logLength&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HasLength</span>&gt;(<span class="hljs-attr">item</span>: T): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Length: <span class="hljs-subst">${item.length}</span>`</span>);
}

<span class="hljs-title function_">logLength</span>(<span class="hljs-string">"hello"</span>);      <span class="hljs-comment">// ✅ string有length属性</span>
<span class="hljs-title function_">logLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);    <span class="hljs-comment">// ✅ 数组有length属性</span>
<span class="hljs-title function_">logLength</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5</span> }); <span class="hljs-comment">// ✅ 对象有length属性</span>
<span class="hljs-comment">// logLength(42);        // ❌ number没有length属性</span>
</code></pre>
<h3 data-id="heading-15">泛型声明的位置与时机</h3>
<h4 data-id="heading-16">在函数中声明泛型</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 单个泛型参数</span>
<span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">value</span>: T): T {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-comment">// 多个泛型参数</span>
<span class="hljs-keyword">function</span> pair&lt;T, U&gt;(<span class="hljs-attr">first</span>: T, <span class="hljs-attr">second</span>: U): [T, U] {
    <span class="hljs-keyword">return</span> [first, second];
}

<span class="hljs-comment">// 带约束的泛型</span>
<span class="hljs-keyword">function</span> getProperty&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">obj</span>: T, <span class="hljs-attr">key</span>: K): T[K] {
    <span class="hljs-keyword">return</span> obj[key];
}

<span class="hljs-comment">// 默认类型参数（TypeScript 2.3+）</span>
<span class="hljs-keyword">function</span> createArray&lt;T = <span class="hljs-built_in">string</span>&gt;(<span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">value</span>: T): T[] {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>(length).<span class="hljs-title function_">fill</span>(value);
}
</code></pre>
<h4 data-id="heading-17">在接口中声明泛型</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 泛型接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Container</span>&lt;T&gt; {
    <span class="hljs-attr">value</span>: T;
    <span class="hljs-title function_">getValue</span>(): T;
    <span class="hljs-title function_">setValue</span>(<span class="hljs-attr">value</span>: T): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 实现泛型接口</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberContainer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Container</span>&lt;<span class="hljs-built_in">number</span>&gt; {
    <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
    
    <span class="hljs-title function_">getValue</span>(): <span class="hljs-built_in">number</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;
    }
    
    <span class="hljs-title function_">setValue</span>(<span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
    }
}

<span class="hljs-comment">// 泛型接口作为函数参数</span>
<span class="hljs-keyword">function</span> processContainer&lt;T&gt;(<span class="hljs-attr">container</span>: <span class="hljs-title class_">Container</span>&lt;T&gt;): T {
    <span class="hljs-keyword">return</span> container.<span class="hljs-title function_">getValue</span>();
}
</code></pre>
<h4 data-id="heading-18">在类型别名中声明泛型</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 泛型类型别名</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Nullable</span>&lt;T&gt; = T | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyRecord</span>&lt;K <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>, V&gt; = { <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> K]: V };
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Callback</span>&lt;T&gt; = <span class="hljs-function">(<span class="hljs-params">value: T</span>) =&gt;</span> <span class="hljs-built_in">void</span>;

<span class="hljs-comment">// 使用泛型类型别名</span>
<span class="hljs-keyword">function</span> processValue&lt;T&gt;(<span class="hljs-attr">value</span>: T, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">Callback</span>&lt;T&gt;): <span class="hljs-built_in">void</span> {
    <span class="hljs-title function_">callback</span>(value);
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">names</span>: <span class="hljs-title class_">Nullable</span>&lt;<span class="hljs-built_in">string</span>&gt; = <span class="hljs-string">"Alice"</span> || <span class="hljs-literal">null</span>;
</code></pre>
<h4 data-id="heading-19">在类中声明泛型</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 泛型类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Repository</span>&lt;T <span class="hljs-keyword">extends</span> { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> }&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">items</span>: T[] = [];
    
    <span class="hljs-title function_">add</span>(<span class="hljs-attr">item</span>: T): <span class="hljs-built_in">void</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">push</span>(item);
    }
    
    <span class="hljs-title function_">findById</span>(<span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>): T | <span class="hljs-literal">undefined</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === id);
    }
    
    <span class="hljs-title function_">getAll</span>(): T[] {
        <span class="hljs-keyword">return</span> [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>];
    }
}

<span class="hljs-comment">// 使用泛型类</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">const</span> userRepo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Repository</span>&lt;<span class="hljs-title class_">User</span>&gt;();
userRepo.<span class="hljs-title function_">add</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">"alice@example.com"</span> });
<span class="hljs-keyword">const</span> user = userRepo.<span class="hljs-title function_">findById</span>(<span class="hljs-number">1</span>);
</code></pre>
<h3 data-id="heading-20">泛型类型推导</h3>
<p>TypeScript 具有强大的类型推导能力，大多数情况下我们不需要显式指定泛型类型。</p>
<h4 data-id="heading-21">自动类型推导</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TypeScript会自动推导泛型类型</span>
<span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">value</span>: T): T {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-comment">// 编译器推断T为string</span>
<span class="hljs-keyword">const</span> result1 = <span class="hljs-title function_">identity</span>(<span class="hljs-string">"hello"</span>);

<span class="hljs-comment">// 编译器推断T为number</span>
<span class="hljs-keyword">const</span> result2 = <span class="hljs-title function_">identity</span>(<span class="hljs-number">42</span>);

<span class="hljs-comment">// 编译器推断T为boolean</span>
<span class="hljs-keyword">const</span> result3 = <span class="hljs-title function_">identity</span>(<span class="hljs-literal">true</span>);

<span class="hljs-comment">// 编译器推断T为number[]</span>
<span class="hljs-keyword">const</span> result4 = <span class="hljs-title function_">identity</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
</code></pre>
<h4 data-id="heading-22">部分类型推导</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 多个泛型参数时，可以部分推导</span>
<span class="hljs-keyword">function</span> mapArray&lt;T, U&gt;(
    <span class="hljs-attr">array</span>: T[],
    <span class="hljs-attr">mapper</span>: <span class="hljs-function">(<span class="hljs-params">item: T</span>) =&gt;</span> U
): U[] {
    <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">map</span>(mapper);
}

<span class="hljs-comment">// 自动推导T为number，U为string</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> strings = <span class="hljs-title function_">mapArray</span>(numbers, <span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n.<span class="hljs-title function_">toString</span>());
<span class="hljs-comment">// strings类型为string[]</span>
</code></pre>
<h4 data-id="heading-23">推导失败的情况</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 情况1：空数组无法推导元素类型</span>
<span class="hljs-keyword">function</span> firstElement&lt;T&gt;(<span class="hljs-attr">arr</span>: T[]): T | <span class="hljs-literal">undefined</span> {
    <span class="hljs-keyword">return</span> arr[<span class="hljs-number">0</span>];
}

<span class="hljs-keyword">const</span> empty = <span class="hljs-title function_">firstElement</span>([]); <span class="hljs-comment">// T被推导为unknown</span>
<span class="hljs-comment">// 解决方法：显式指定类型</span>
<span class="hljs-keyword">const</span> empty2 = firstElement&lt;<span class="hljs-built_in">number</span>&gt;([]); <span class="hljs-comment">// T为number</span>

<span class="hljs-comment">// 情况2：泛型约束太宽</span>
<span class="hljs-keyword">function</span> process&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>&gt;(<span class="hljs-attr">value</span>: T): T {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">process</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// T被推导为"hello"而不是string</span>
<span class="hljs-comment">// 解决方法：使用类型断言</span>
<span class="hljs-keyword">const</span> result2 = process&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// T为string</span>
</code></pre>
<h3 data-id="heading-24">泛型约束</h3>
<h4 data-id="heading-25">基础约束</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 约束T必须是某种类型</span>
<span class="hljs-keyword">function</span> logLength&lt;T <span class="hljs-keyword">extends</span> { <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-attr">item</span>: T): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item.<span class="hljs-property">length</span>);
}

<span class="hljs-title function_">logLength</span>(<span class="hljs-string">"hello"</span>);      <span class="hljs-comment">// ✅</span>
<span class="hljs-title function_">logLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);    <span class="hljs-comment">// ✅</span>
<span class="hljs-title function_">logLength</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5</span> }); <span class="hljs-comment">// ✅</span>
<span class="hljs-comment">// logLength(42);        // ❌</span>

<span class="hljs-comment">// 约束多个类型参数之间的关系</span>
<span class="hljs-keyword">function</span> getProperty&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">obj</span>: T, <span class="hljs-attr">key</span>: K): T[K] {
    <span class="hljs-keyword">return</span> obj[key];
}

<span class="hljs-keyword">const</span> user = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> };
<span class="hljs-title function_">getProperty</span>(user, <span class="hljs-string">"name"</span>); <span class="hljs-comment">// ✅</span>
<span class="hljs-comment">// getProperty(user, "email"); // ❌</span>
</code></pre>
<h4 data-id="heading-26">使用类型参数约束</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 一个类型参数约束另一个</span>
<span class="hljs-keyword">function</span> assign&lt;T <span class="hljs-keyword">extends</span> U, U&gt;(<span class="hljs-attr">target</span>: T, <span class="hljs-attr">source</span>: U): T {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(target, source);
}

<span class="hljs-keyword">const</span> target = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> };
<span class="hljs-keyword">const</span> source = { <span class="hljs-attr">b</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">c</span>: <span class="hljs-number">4</span> };
<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">assign</span>(target, source); <span class="hljs-comment">// { a: 1, b: 3, c: 4 }</span>

<span class="hljs-comment">// 约束类型参数为构造器</span>
<span class="hljs-keyword">function</span> createInstance&lt;T&gt;(
    <span class="hljs-title class_">Constructor</span>: <span class="hljs-keyword">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; T,
    ...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]
): T {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Constructor</span>(...args);
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> name: <span class="hljs-built_in">string</span></span>) {}
}

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">createInstance</span>(<span class="hljs-title class_">User</span>, <span class="hljs-string">"Alice"</span>); <span class="hljs-comment">// User实例</span>
</code></pre>
<h2 data-id="heading-27">结语</h2>
<p>本文详细介绍了TypeScript中的函数使用指南，包括函数声明与调用、函数重载、多态函数与泛型的概念，对于文章中错误的地方或者有任何问题，欢迎在评论区留言讨论！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 项目中使用 @antfu/eslint-config 完整指南]]></title>    <link>https://juejin.cn/post/7597056049690574886</link>    <guid>https://juejin.cn/post/7597056049690574886</guid>    <pubDate>2026-01-20T05:46:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597056049690574886" data-draft-id="7597056049690525734" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 项目中使用 @antfu/eslint-config 完整指南"/> <meta itemprop="keywords" content="Vue.js,ESLint"/> <meta itemprop="datePublished" content="2026-01-20T05:46:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="实习生小黄"/> <meta itemprop="url" content="https://juejin.cn/user/3246201392868637"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 项目中使用 @antfu/eslint-config 完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3246201392868637/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    实习生小黄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:46:18.000Z" title="Tue Jan 20 2026 05:46:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在现代前端开发中，代码质量和一致性是项目成功的关键因素。ESLint 作为 JavaScript/TypeScript 代码检查工具，能够帮助开发者发现潜在问题、统一代码风格。<code>@antfu/eslint-config</code> 是由 Anthony Fu 维护的一套开箱即用的 ESLint 配置，特别针对 Vue 3、TypeScript 和现代 JavaScript 项目进行了优化。</p>
<p>本文档基于实际项目经验，详细介绍了如何在 Vue3 + TypeScript + Vite 项目中正确配置和使用 <code>@antfu/eslint-config</code>，并记录了常见问题的解决方案。</p>
<h2 data-id="heading-1">目的</h2>
<p>本文档旨在帮助开发者：</p>
<ul>
<li>快速在 Vue3 项目中集成 <code>@antfu/eslint-config</code></li>
<li>理解配置选项的含义和作用</li>
<li>解决常见的解析错误和配置问题</li>
<li>掌握最佳实践和注意事项</li>
</ul>
<h2 data-id="heading-2">配置</h2>
<h3 data-id="heading-3">1. 安装依赖</h3>
<p>首先，确保你的项目已经安装了必要的依赖：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D @antfu/eslint-config eslint
</code></pre>
<p>或者使用 npm/yarn：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -D @antfu/eslint-config eslint
<span class="hljs-comment"># 或</span>
yarn add -D @antfu/eslint-config eslint
</code></pre>
<h3 data-id="heading-4">2. 创建配置文件</h3>
<p>在项目根目录创建 <code>eslint.config.mjs</code> 文件（注意：必须使用 <code>.mjs</code> 扩展名，因为 ESLint 9.x 使用扁平配置格式，且需要 ES 模块语法）。</p>
<p><strong>重要提示</strong>：即使 <code>package.json</code> 中设置了 <code>"type": "module"</code>，ESLint 仍需要明确的 <code>.mjs</code> 扩展名来正确解析 ES 模块语法。</p>
<h3 data-id="heading-5">3. 基础配置示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// eslint.config.mjs</span>
<span class="hljs-keyword">import</span> antfu <span class="hljs-keyword">from</span> <span class="hljs-string">'@antfu/eslint-config'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">antfu</span>({
  <span class="hljs-attr">vue</span>: <span class="hljs-literal">true</span>,        <span class="hljs-comment">// 启用 Vue 3 支持</span>
  <span class="hljs-attr">typescript</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用 TypeScript 支持（重要！）</span>
  
  <span class="hljs-attr">rules</span>: {
    <span class="hljs-comment">// 自定义规则配置</span>
    xxx
  },
})
</code></pre>
<h3 data-id="heading-6">4. 配置选项说明</h3>
<h4 data-id="heading-7">核心选项</h4>
<ul>
<li><strong><code>vue: true</code></strong>：启用 Vue 3 文件支持，自动配置 Vue 相关的 ESLint 规则</li>
<li><strong><code>typescript: true</code></strong>：启用 TypeScript 支持，这是处理 TypeScript 语法的关键配置</li>
</ul>
<h3 data-id="heading-8">5. package.json 脚本配置</h3>
<p>在 <code>package.json</code> 中添加 lint 脚本：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint ."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint:fix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint . --fix"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-9">遇到的问题</h2>
<h3 data-id="heading-10">问题 1：配置文件解析错误</h3>
<p><strong>错误信息</strong>：</p>
<pre><code class="hljs language-go" lang="go">Parsing <span class="hljs-type">error</span>: Unexpected token
</code></pre>
<p><strong>问题描述</strong>：</p>
<ul>
<li>使用 <code>.js</code> 扩展名创建配置文件时，ESLint 无法正确解析 ES 模块语法（<code>import/export</code>）</li>
<li>即使 <code>package.json</code> 中设置了 <code>"type": "module"</code>，某些工具仍需要明确的 <code>.mjs</code> 扩展名</li>
</ul>
<p><strong>解决方案</strong>：
将配置文件重命名为 <code>eslint.config.mjs</code>，确保使用 <code>.mjs</code> 扩展名。</p>
<h3 data-id="heading-11">问题 2：TypeScript 嵌套泛型解析错误</h3>
<p><strong>错误信息</strong>：</p>
<pre><code class="hljs language-go" lang="go">Parsing <span class="hljs-type">error</span>: Unexpected token &gt;&gt;
</code></pre>
<p><strong>问题代码示例</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> allUsersMap = ref&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-title class_">UserInfo</span>&gt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>());
</code></pre>
<p><strong>问题描述</strong>：</p>
<ul>
<li>当配置中只启用了 <code>vue: true</code> 而没有启用 <code>typescript: true</code> 时</li>
<li>ESLint 无法正确解析嵌套泛型语法（如 <code>ref&lt;Map&lt;number, UserInfo&gt;&gt;</code>）</li>
<li><code>&gt;&gt;</code> 被误解析为 JavaScript 的右移运算符，而不是泛型闭合符号</li>
</ul>
<p><strong>根本原因</strong>：</p>
<ul>
<li>没有显式启用 TypeScript 支持时，TypeScript 解析器可能无法正确处理复杂的泛型语法</li>
<li>这与 GitHub Issue #578 中描述的问题类似：当文件被添加到 <code>ignoresTypeAware</code> 时，会回退到普通 JavaScript 解析器，无法理解 TypeScript 语法</li>
</ul>
<h2 data-id="heading-12">解决方案</h2>
<h3 data-id="heading-13">解决方案 1：配置文件扩展名问题</h3>
<p><strong>步骤</strong>：</p>
<ol>
<li>删除 <code>eslint.config.js</code>（如果存在）</li>
<li>创建 <code>eslint.config.mjs</code> 文件</li>
<li>使用 ES 模块语法编写配置</li>
</ol>
<p><strong>完整示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// eslint.config.mjs</span>
<span class="hljs-keyword">import</span> antfu <span class="hljs-keyword">from</span> <span class="hljs-string">'@antfu/eslint-config'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">antfu</span>({
  <span class="hljs-attr">vue</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">typescript</span>: <span class="hljs-literal">true</span>,
})
</code></pre>
<h3 data-id="heading-14">解决方案 2：TypeScript 解析错误</h3>
<p><strong>关键步骤</strong>：在配置中显式启用 TypeScript 支持</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// eslint.config.mjs</span>
<span class="hljs-keyword">import</span> antfu <span class="hljs-keyword">from</span> <span class="hljs-string">'@antfu/eslint-config'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">antfu</span>({
  <span class="hljs-attr">vue</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">typescript</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// ⚠️ 必须显式启用！</span>
  
  <span class="hljs-attr">rules</span>: {
    <span class="hljs-comment">// 自定义规则</span>
  },
})
</code></pre>
<p><strong>为什么需要显式启用？</strong></p>
<ol>
<li><strong>默认行为不确定</strong>：虽然 <code>@antfu/eslint-config</code> 可能在某些情况下自动检测 TypeScript，但在处理复杂语法（如嵌套泛型）时可能失效</li>
<li><strong>Vue 文件特殊性</strong>：Vue 单文件组件（<code>.vue</code>）中的 <code>&lt;script setup&gt;</code> 使用 TypeScript 时，需要明确的配置来启用 TypeScript 解析器</li>
<li><strong>避免解析器回退</strong>：显式配置确保文件不会被错误地使用 JavaScript 解析器处理</li>
</ol>
<h3 data-id="heading-15">解决方案 3：完整的推荐配置</h3>
<p>基于实际项目经验，推荐以下配置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// eslint.config.mjs</span>
<span class="hljs-keyword">import</span> antfu <span class="hljs-keyword">from</span> <span class="hljs-string">'@antfu/eslint-config'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">antfu</span>({
  <span class="hljs-comment">// 核心功能</span>
  <span class="hljs-attr">vue</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">typescript</span>: <span class="hljs-literal">true</span>,
  
  <span class="hljs-comment">// 自定义规则</span>
  <span class="hljs-attr">rules</span>: {
  },
})
</code></pre>
<h2 data-id="heading-16">总结</h2>
<h3 data-id="heading-17">关键要点</h3>
<ol>
<li>
<p><strong>文件扩展名很重要</strong>：必须使用 <code>eslint.config.mjs</code> 而不是 <code>.js</code>，确保 ESLint 能正确解析 ES 模块语法</p>
</li>
<li>
<p><strong>显式启用 TypeScript</strong>：即使项目使用 TypeScript，也要在配置中显式设置 <code>typescript: true</code>，特别是处理复杂泛型语法时</p>
</li>
<li>
<p><strong>理解解析器机制</strong>：当 TypeScript 解析器未正确启用时，文件可能回退到 JavaScript 解析器，导致无法理解 TypeScript 语法</p>
</li>
<li>
<p><strong>遵循最佳实践</strong>：</p>
<ul>
<li>始终同时启用 <code>vue: true</code> 和 <code>typescript: true</code></li>
<li>根据项目需求自定义规则</li>
<li>定期更新 <code>@antfu/eslint-config</code> 到最新版本</li>
</ul>
</li>
</ol>
<h3 data-id="heading-18">常见错误对照表</h3>

























<table><thead><tr><th>错误信息</th><th>可能原因</th><th>解决方案</th></tr></thead><tbody><tr><td><code>Parsing error: Unexpected token</code></td><td>配置文件扩展名错误</td><td>使用 <code>.mjs</code> 扩展名</td></tr><tr><td><code>Parsing error: Unexpected token &gt;&gt;</code></td><td>未启用 TypeScript 支持</td><td>添加 <code>typescript: true</code></td></tr><tr><td><code>Parsing error: Unexpected token :</code></td><td>文件被添加到 <code>ignoresTypeAware</code></td><td>移除相关配置或显式添加到 <code>filesTypeAware</code></td></tr></tbody></table>
<h3 data-id="heading-19">参考资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fantfu%2Feslint-config" target="_blank" title="https://github.com/antfu/eslint-config" ref="nofollow noopener noreferrer">@antfu/eslint-config</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Feslint.org%2Fdocs%2Flatest%2Fuse%2Fconfigure%2Fconfiguration-files-new" target="_blank" title="https://eslint.org/docs/latest/use/configure/configuration-files-new" ref="nofollow noopener noreferrer">ESLint 扁平配置文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fantfu%2Feslint-config%2Fissues%2F578" target="_blank" title="https://github.com/antfu/eslint-config/issues/578" ref="nofollow noopener noreferrer">GitHub Issue #578</a> - TypeScript 解析相关问题</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一站式了解Spring AI Alibaba的Memory机制]]></title>    <link>https://juejin.cn/post/7596990822127566886</link>    <guid>https://juejin.cn/post/7596990822127566886</guid>    <pubDate>2026-01-20T05:47:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596990822127566886" data-draft-id="7596990822127026214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一站式了解Spring AI Alibaba的Memory机制"/> <meta itemprop="keywords" content="后端,人工智能,架构"/> <meta itemprop="datePublished" content="2026-01-20T05:47:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="想用offer打牌"/> <meta itemprop="url" content="https://juejin.cn/user/578781641968972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一站式了解Spring AI Alibaba的Memory机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578781641968972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    想用offer打牌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:47:57.000Z" title="Tue Jan 20 2026 05:47:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>我相信大家在平时一定使用过网页对话chatbot，国产的有deepseek、Qwen等，国外的有ChatGPT、Gemini、Grok等。在我们使用的期间，我们会发现这些chatbot会记住我们这次对话的上下文，甚至之前的对话的某些信息，如果你们对为什么LLM能记住我们的信息感兴趣，那么接着往下看吧！</p>
<h2 data-id="heading-1">错误纠正</h2>
<p>很多人不了解大模型或者不了解大模型应用开发的，就常常认为大模型底层就是会有记忆机制的，即内置Memory。这种想法是错误的，大模型底层并没有记忆机制，而是stateless(无状态)。</p>
<p>1.基础大模型（如 Qwen）的行为(LLM)</p>
<ul>
<li>默认情况下，大语言模型（包括 Qwen 系列）是<strong>无状态的</strong>：每次请求都是独立的，模型不会自动记住你之前的对话内容。</li>
<li>如果你在一次对话中发送多轮消息（例如通过 API 的 <code>messages</code> 字段传入历史），那是由<strong>调用方</strong>（即你的应用）负责维护对话历史，而不是模型自己存储。</li>
</ul>
<p>2.Memory 机制是应用层的功能</p>
<ul>
<li>“Memory”通常是指在构建智能体（Agent）或对话系统时，为了实现上下文记忆、长期记忆、用户偏好记录等功能而<strong>额外引入的模块</strong>。</li>
<li>例如，在 LangChain、LlamaIndex 或阿里云百炼平台中，开发者可以配置短期记忆（如最近几轮对话）或长期记忆（如向量数据库存储的历史信息），并在每次生成回复前将相关记忆注入 prompt。</li>
<li>这种 Memory 管理是由<strong>应用框架或开发者代码</strong>实现的，不是模型原生能力。</li>
</ul>
<h2 data-id="heading-2">Memory</h2>
<p>那么像chatbot这些大模型应用，是如何维持记忆呢？那么维护记忆万一超过了模型能承受的上下文，怎么办？</p>
<p>要了解这些问题，我们首先得搞懂，<strong>什么是Memory</strong>。</p>
<p>Memory分为短期记忆和长期记忆，接下来我们分别说说，尽量简单易懂。</p>
<h3 data-id="heading-3">短期Memory</h3>
<p>短期记忆（Short-term Memory）</p>
<ul>
<li>
<p><strong>定义</strong>：指在<strong>单次对话会话（session）中</strong>保留的上下文信息。</p>
</li>
<li>
<p><strong>典型实现</strong>：将用户与系统单次会话中的最近几轮的对话历史（prompt + response）作为上下文，一起输入给大模型。</p>
</li>
<li>
<p>特点：</p>
<ul>
<li>仅在当前会话有效；</li>
<li>会话结束后通常被丢弃（除非主动保存）；</li>
<li>受限于模型的上下文长度（如 Qwen-Max 支持 32768 tokens）；</li>
<li>是实现多轮对话连贯性的基础。</li>
</ul>
</li>
<li>
<p>例子：</p>
<blockquote>
<p>用户：我叫小明。 助手：你好，小明！ 用户：我今年多大？ → 助手能回答，是因为“我叫小明”这句还在短期记忆（即对话历史）中</p>
</blockquote>
</li>
</ul>
<p>短期记忆一般大模型应用都会自动开启的，但是每个应用对短期记忆的策略都会不一样，所以体验上也不一样。</p>
<h3 data-id="heading-4">长期Memory</h3>
<p>长期记忆（Long-term Memory）</p>
<ul>
<li>
<p><strong>定义</strong>：跨越<strong>多个会话</strong>、持久化存储的用户信息或交互历史。</p>
</li>
<li>
<p>典型实现：</p>
<ul>
<li>将关键信息（如用户偏好、身份、历史任务）提取后存入数据库或向量库；</li>
<li>下次对话时通过检索（Retrieval）机制召回相关内容，并注入到 prompt 中。</li>
</ul>
</li>
<li>
<p>特点：</p>
<ul>
<li>需要显式设计（如使用向量数据库 + embedding 检索）；</li>
<li>不是所有系统都默认开启；</li>
<li>涉及隐私和数据安全，通常需用户授权；</li>
<li>属于高级功能，常见于智能体（Agent）或个性化助手。</li>
</ul>
</li>
<li>
<p>例子：</p>
<blockquote>
<p>上周用户说：“我喜欢喝美式咖啡。” 一周后再次对话，系统说：“今天还想来一杯美式吗？” → 这说明系统通过长期记忆记住了偏好。</p>
</blockquote>
</li>
</ul>
<p>以Gemini为例子，你可以在这里添加想让Gemini记住你的相关信息，或者在某次对话中直接prompt让其记住也是可以的。这样就是长期Memory，每次Gemini都会在某些情景下触发相关的长期记忆，策略不同，输出也会不同</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb3439edfb8d46f1a93120640aff551c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492876&amp;x-signature=2IM1STkkuLy7QVhx6EVKAuLUWiM%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">SAA的Memory机制</h2>
<p>ok，现在回归正题，来讲讲SAA的Memory机制，如果还有想有更深的了解的兄弟可以先去看看这两篇文章，再回来应该能更好的理解</p>
<p>1.Spring AI vs Spring AI Alibaba</p>
<p><a href="https://juejin.cn/post/7596181746062508059" target="_blank" title="https://juejin.cn/post/7596181746062508059">juejin.cn/post/759618…</a></p>
<p>2.逃出结构化思维：从向量，向量数据库到RAG</p>
<p><a href="https://juejin.cn/post/7587074669818134554" target="_blank" title="https://juejin.cn/post/7587074669818134554">juejin.cn/post/758707…</a></p>
<p>SAA本质上是一个AI应用开发框架，可以开发agent，multi-agent和工作流等等，那么必然需要使用底层LLM，然而我们前面已经说过了LLM实际上是无状态的，那么LLM应用的相关记忆必定是由我们上层应用来开发和管理的。</p>
<p>即如果你使用的是 <strong>Qwen 的 API（如 dashscope）</strong> ，你需要自己维护对话历史并作为输入传入。</p>
<h3 data-id="heading-6">SAA的Memory机制的架构</h3>
<p>下面是SAA实现两种Memory的架构图,其中左下角的箭头(指向ModelHook)应该放置到中间的，画错了就将就看吧</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18a0e499cf7e49fea80e248203b7e7f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492876&amp;x-signature=8R8dwVnosD%2BXP9YQwGV3Pq6f%2FQE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">维护短期记忆</h3>
<h4 data-id="heading-8">如何添加短期记忆</h4>
<p>在 Spring AI Alibaba 中，要向 Agent 添加短期记忆（会话级持久化），你需要在创建 Agent 时指定 <code>checkpointer</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.cloud.ai.graph.checkpoint.savers.RedisSaver;
<span class="hljs-keyword">import</span> org.redisson.api.RedissonClient;

<span class="hljs-comment">// 配置 Redis checkpointer</span>
<span class="hljs-type">RedisSaver</span> <span class="hljs-variable">redisSaver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisSaver</span>(redissonClient);

<span class="hljs-type">ReactAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> ReactAgent.builder()
    .name(<span class="hljs-string">"my_agent"</span>)
    .model(chatModel)
    .tools(getUserInfoTool)
    .saver(redisSaver)
    .build();
    
<span class="hljs-comment">// 使用 thread_id 维护对话上下文  </span>
<span class="hljs-type">RunnableConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> RunnableConfig.builder()  
    .threadId(<span class="hljs-string">"1"</span>) <span class="hljs-comment">// threadId 指定会话 ID  </span>
    .build();  
  
agent.call(<span class="hljs-string">"你好！我叫 Bob。"</span>, config);
</code></pre>
<h4 data-id="heading-9">扩展短期记忆</h4>
<p>我们还可以修改和管理记忆。
默认情况下，Agent 使用状态通过 <code>messages</code> 键管理短期记忆，特别是对话历史。</p>
<p>你可以通过在工具或 Hook 中访问和修改状态来扩展记忆功能</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.cloud.ai.graph.agent.hook.ModelHook;
<span class="hljs-keyword">import</span> com.alibaba.cloud.ai.graph.agent.hook.HookPosition;
<span class="hljs-keyword">import</span> com.alibaba.cloud.ai.graph.OverAllState;
<span class="hljs-keyword">import</span> com.alibaba.cloud.ai.graph.RunnableConfig;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.messages.Message;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.Optional;
<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-comment">// 在 Hook 中访问和修改状态</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomMemoryHook</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ModelHook</span> {

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"custom_memory"</span>;
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> HookPosition[] getHookPositions() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HookPosition</span>[]{HookPosition.BEFORE_MODEL};
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> CompletableFuture&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">beforeModel</span><span class="hljs-params">(OverAllState state, RunnableConfig config)</span> {
    <span class="hljs-comment">// 访问消息历史</span>
    Optional&lt;Object&gt; messagesOpt = state.value(<span class="hljs-string">"messages"</span>);
    <span class="hljs-keyword">if</span> (messagesOpt.isPresent()) {
        List&lt;Message&gt; messages = (List&lt;Message&gt;) messagesOpt.get();
    <span class="hljs-comment">// 处理消息...</span>
}

    <span class="hljs-comment">// 添加自定义状态</span>
    <span class="hljs-keyword">return</span> CompletableFuture.completedFuture(Map.of(
        <span class="hljs-string">"user_id"</span>, <span class="hljs-string">"user_123"</span>,
        <span class="hljs-string">"preferences"</span>, Map.of(<span class="hljs-string">"theme"</span>, <span class="hljs-string">"dark"</span>)
    ));
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> CompletableFuture&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">afterModel</span><span class="hljs-params">(OverAllState state, RunnableConfig config)</span> {
    <span class="hljs-keyword">return</span> CompletableFuture.completedFuture(Map.of());
    }
}
</code></pre>
<h4 data-id="heading-10">管理短期记忆</h4>
<p>一个会话中，如果用户一直对话，整个会话的上下文就会越来越长，最后就会超过该大模型所能承受的上下文限制。</p>
<p>保留所有对话历史是实现短期记忆最常见的形式。但较长的对话对历史可能会导致大模型 LLM 上下文窗口超限，导致上下文丢失或报错。</p>
<p>即使你在使用的大模型上下文长度足够大，大多数模型在处理较长上下文时的表现仍然很差。因为很多模型会被过时或偏离主题的内容"分散注意力"。同时，过长的上下文，还会带来响应时间变长、Token 成本增加等问题。</p>
<p>在 Spring AI ALibaba 中，ReactAgent 使用 messages 记录和传递上下文，其中包括指令（SystemMessage）和输入（UserMessage）。在 ReactAgent 中，消息（Message）在用户输入和模型响应之间交替，导致消息列表随着时间的推移变得越来越长。由于上下文窗口有限，许多应用程序可以从使用技术来移除或"忘记"过时信息中受益，即 “上下文工程”。</p>
<p>作为后端，我们通常采取以下几种策略来模拟“记忆”：</p>
<ul>
<li><strong>Sliding Window（滑动窗口）：</strong> 只保留最近的 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span> 轮对话，丢弃最早的记录。</li>
<li><strong>Summary Memory（摘要记忆）：</strong> 当对话过长时，调用大模型对之前的对话做一个简短总结，后续只带上这个 <code>Summary</code>。</li>
<li><strong>Vector Database（向量数据库/RAG）：</strong> 将历史对话存入向量库（如 Milvus, Pinecone）。当用户提问时，通过语义搜索检索出最相关的历史片段（Top-K），塞进 Context 传给模型。</li>
</ul>
<h3 data-id="heading-11">维护长期记忆</h3>
<h4 data-id="heading-12">长期记忆的检索过程</h4>
<p>对于后端开发人员来说，长期记忆的检索过程其实就是一个标准的 <strong>“语义检索 + RAG (Retrieval-Augmented Generation)”</strong> 工作流。</p>
<p>你可以把它类比为：<strong>全文搜索（Elasticsearch）的升级版</strong>。不同于关键词匹配，<strong>它是基于“意思”来匹配</strong>。</p>
<hr/>
<p>整个过程可以分为 <strong>“存入”</strong> 和 <strong>“检索”</strong> 两个阶段：</p>
<h5 data-id="heading-13">1. 存入阶段（写入/索引）</h5>
<p>当一段对话结束或产生新的知识时：</p>
<ol>
<li><strong>切片 (Chunking)</strong> ：将长文本切分成合适的大小（例如 512 tokens）。</li>
<li><strong>向量化 (Embedding)</strong> ：调用 Embedding 模型（如 OpenAI 的 <code>text-embedding-3-small</code>）将文本转为高维向量（如 1536 维的浮点数数组）。</li>
<li><strong>入库</strong>：将向量和原始文本、Metadata（如 <code>user_id</code>, <code>timestamp</code>）存入向量数据库（Redis Vector Search, Milvus, 或 Pinecone）。</li>
</ol>
<h5 data-id="heading-14">2. 检索阶段（读取/召回）</h5>
<p>当用户提出一个新问题，系统需要“回想起”以前的事情：</p>
<ul>
<li>
<p>Step A: 问题向量化</p>
<p>将用户的提问（Query）同样通过 Embedding 模型转为一个向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mrow><mi>q</mi><mi>u</mi><mi>e</mi><mi>r</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">V_{query}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ery</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>。</p>
</li>
<li>
<p>Step B: 向量空间搜索 (ANN Search)</p>
<p>在数据库中寻找与 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mrow><mi>q</mi><mi>u</mi><mi>e</mi><mi>r</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">V_{query}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ery</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> 距离最近（相似度最高）的 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span></span> 个向量。通常使用余弦相似度 (Cosine Similarity) 计算：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>similarity</mtext><mo>=</mo><mfrac><mrow><mi>A</mi><mo>⋅</mo><mi>B</mi></mrow><mrow><mi mathvariant="normal">∥</mi><mi>A</mi><mi mathvariant="normal">∥</mi><mi mathvariant="normal">∥</mi><mi>B</mi><mi mathvariant="normal">∥</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{similarity} = \frac{A \cdot B}{\|A\| \|B\|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">similarity</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.3923em;vertical-align:-0.52em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∥</span><span class="mord mathnormal mtight">A</span><span class="mord mtight">∥∥</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mtight">∥</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mbin mtight">⋅</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
</li>
<li>
<p>Step C: 召回与过滤</p>
<p>数据库返回最匹配的原始文本片段。作为后端，你通常会在这里根据 user_id 做 Metadata Filter，确保 A 用户的提问不会检索到 B 用户的记忆。</p>
</li>
<li>
<p>Step D: 上下文注入 (Context Injection)</p>
<p>将检索出来的“记忆片段”拼接到当前的 Prompt 中。</p>
</li>
</ul>
<h4 data-id="heading-15">SAA的长期记忆存储</h4>
<p>Spring AI Alibaba 将长期记忆以 JSON 文档的形式存储在 Store 中。</p>
<p>每个记忆都在自定义的 <code>namespace</code>（类似于文件夹）下组织，并使用唯一的 <code>key</code>（类似于文件名）。命名空间通常包含用户或组织 ID 或其他标签，以便更容易地组织信息。</p>
<p>这种结构支持记忆的层次化组织。通过内容过滤器支持跨命名空间搜索。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.cloud.ai.graph.store.stores.MemoryStore;
<span class="hljs-keyword">import</span> com.alibaba.cloud.ai.graph.store.StoreItem;

<span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-comment">// MemoryStore 将数据保存到内存字典中。在生产环境中请使用基于数据库的存储实现</span>
<span class="hljs-type">MemoryStore</span> <span class="hljs-variable">store</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MemoryStore</span>();

<span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> <span class="hljs-string">"my-user"</span>;
<span class="hljs-type">String</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> <span class="hljs-string">"chitchat"</span>;
List&lt;String&gt; namespace = List.of(userId, applicationContext);

<span class="hljs-comment">// 保存记忆</span>
Map&lt;String, Object&gt; memoryData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
memoryData.put(<span class="hljs-string">"rules"</span>, List.of(
    <span class="hljs-string">"用户喜欢简短直接的语言"</span>,
    <span class="hljs-string">"用户只说中文和Java"</span>
));
memoryData.put(<span class="hljs-string">"my-key"</span>, <span class="hljs-string">"my-value"</span>);

<span class="hljs-type">StoreItem</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> StoreItem.of(namespace, <span class="hljs-string">"a-memory"</span>, memoryData);
store.putItem(item);

<span class="hljs-comment">// 通过ID获取记忆</span>
Optional&lt;StoreItem&gt; retrievedItem = store.getItem(namespace, <span class="hljs-string">"a-memory"</span>);

<span class="hljs-comment">// 在此命名空间内搜索记忆，通过内容等价性过滤，按向量相似度排序</span>
List&lt;StoreItem&gt; items = store.searchItems(
    namespace,
    Map.of(<span class="hljs-string">"my-key"</span>, <span class="hljs-string">"my-value"</span>)
);
</code></pre>
<h4 data-id="heading-16">SAA的长期记忆管理</h4>
<p>SAA还可以进行对长期记忆的管理，我们可以使用 ModelHook 在模型调用前后自动加载和保存长期记忆。</p>
<p>同时，我们也可以在tool里面进行读取和写入长期记忆。</p>
<p>长期记忆的写入和召回等核心流程就如上面说到的一样，这里由于篇幅就不详细赘述。</p>
<h2 data-id="heading-17">总结</h2>
<p>本文讨论了Memory的概念，两种不同记忆机制的区别以及SAA如何处理不同记忆。</p>
<p>但是大模型应用开发Memory是门学问，也不可能一文能讲清楚所有场景该怎么做，比如短期记忆和长期记忆混合该怎么使用，那就等着读者去探索了。</p>
<p>如果你感觉这篇入门文章给你带来了不错的体感，那就给我点赞+收藏+关注吧❤️</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS人机交互新范式：当ToB系统开始“思考”，我们该设计什么样的界面？]]></title>    <link>https://juejin.cn/post/7597083743555960875</link>    <guid>https://juejin.cn/post/7597083743555960875</guid>    <pubDate>2026-01-20T05:39:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597083743555960875" data-draft-id="7597083949833207814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS人机交互新范式：当ToB系统开始“思考”，我们该设计什么样的界面？"/> <meta itemprop="keywords" content="HarmonyOS,Agent"/> <meta itemprop="datePublished" content="2026-01-20T05:39:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="木斯佳"/> <meta itemprop="url" content="https://juejin.cn/user/783265144769623"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS人机交互新范式：当ToB系统开始“思考”，我们该设计什么样的界面？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/783265144769623/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    木斯佳
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:39:26.000Z" title="Tue Jan 20 2026 05:39:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>软件不再是你找功能，而是功能主动理解你。这不是AI的革命，这是交互设计本应有的样子。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60672891fa094018a6d3c91a5708b74d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyo5pav5L2z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492365&amp;x-signature=wRCbrnPV9qvX8HBcNUSGpZApQcw%3D" alt="image.png" loading="lazy"/></p>
<p>上周在医院门诊大厅，我看到一个特别的“白大褂”——医疗数字人“灵童”。它眨着大眼睛，耐心地为患者家属解答各种问题。家属只需自然地说出需求，灵童就能理解意图，快速给出科室指引、专家排班信息，甚至能调出相关的健康知识卡片。</p>
<p>这不是科幻电影，这是青岛市妇女儿童医院真实的智慧服务场景，由泽瑞集团提供全链路私有化部署的医疗数字人解决方案。</p>
<p>看着家属们自然地与灵童对话，我突然意识到：这才应该是企业软件的交互方式——不是用户去适应复杂的菜单结构，而是系统主动理解用户意图，提供恰到好处的服务。</p>
<h2 data-id="heading-0">不是AI要改变什么，而是我们本就该这样工作</h2>
<p>最近团队在落地几个Agent项目，和产品、设计、后端一起开会时，大家问得最多的问题是：“Agent到底能做什么不一样的事情？”</p>
<p>我的回答是：它不做“不一样”的事情，而是让事情“以对的方式”发生。
让我用医疗场景举个例子。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4a7064a68e84837af8311218f62a758~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyo5pav5L2z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492365&amp;x-signature=pgdBA2rDkxKytQXzjuGmSVD61Is%3D" alt="在这里插入图片描述" loading="lazy"/>
<strong>传统的医院系统逻辑</strong>：家属要知道“去哪里”——导诊台；要记住“怎么问”——科室名称要准确；要明白“流程”——先登记还是先挂号。</p>
<p><strong>数字人的逻辑</strong>：家属只需要说“孩子咳嗽三天了，应该看哪个科”。
系统自己会判断：这需要分析症状关键词→匹配对应专科→查看专家排班→提供就诊建议。整个过程在自然对话中完成，用户不需要记住复杂的科室分类，不需要提前学习系统用法，只需要说出需求。</p>
<p>这不就是我们一直想要的“智能化”吗？</p>
<h2 data-id="heading-1">界面不是消失了，而是变得更“聪明”</h2>
<p>有人担心：Agent会不会让精心设计的页面变得无用？
恰恰相反。好的Agent不是替代界面，而是让界面“活”起来。
第一版的智能柜成功上线让我们备受鼓舞，我们快速迭代了小程序侧进行了上线。在方案预研中，我发现<strong>鸿蒙生态</strong>天然的适配<strong>RICH 设计范式</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b2d167806ab47fd8a3870f9a72fc133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyo5pav5L2z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492365&amp;x-signature=bQ3YrbzaMjo9rVBAoWCaqvxIIss%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>鸿蒙的<strong>多窗口交互</strong>，折叠屏展开态、平板等大屏幕设备，具有多任务并行和效率型任务处理的先天优势。
系统提供了悬浮窗、分屏、画中画三种多窗口交互，为用户在大屏幕设备上的多任务并行、便捷的临时任务处理提供更佳的使用体验。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27e8bd9dcf3f45c486dcae11ae7c91d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyo5pav5L2z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492365&amp;x-signature=qU3LNx%2FntGK0SmzRig26jbXu%2Bd4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>想象一下这种体验：</p>
<ol>
<li>家属询问：“半夜小孩发烧到39.5度，需要马上看急诊吗？”</li>
<li>系统理解：这是急症咨询场景，需要调用发热处理流程、急诊等待时间、医生建议</li>
<li>界面响应：左侧显示发热处理指引卡片，中间展示当前急诊等候人数，右侧提供线上咨询快速入口</li>
<li>家属可以：查看详细指引，预约急诊时段。</li>
</ol>
<p>界面元素依然存在，但它们的<strong>出现时机、组合方式、信息呈现</strong>都根据用户的<strong>紧急程度</strong>和<strong>具体需求</strong>动态决定。</p>
<p>这就是“混合渲染”——不是全盘推倒重来，而是让静态的页面框架，搭载动态的医疗<strong>服务卡片</strong>和<strong>交互</strong>组件。</p>
<h2 data-id="heading-2">鸿蒙开发者的新角色：从“页面建造者”到“交互架构师”</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e43e56e36c24eb98a117d86221b190f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyo5pav5L2z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492365&amp;x-signature=YpqlQbgE8I0cgKCUOFL9Cxg%2F0Vc%3D" alt="图例来自蚂蚁开源项目" loading="lazy"/>
（图例来自蚂蚁开源项目）</p>
<p>这种变化对鸿蒙开发者意味着什么？
在借鉴吸收了RICH 设计范式后，昨天的我还需要纠结这个按钮的border-radius是6px还是8px，今天的我需要思考的是：<strong>这个组件如何向AI描述自己？</strong></p>
<p>在鸿蒙生态中，我们的组件开发范式正在经历深刻的变革。这种变化不仅仅是API设计的不同，更是组件从"被动渲染"到"主动服务"的思维转变。</p>
<h4 data-id="heading-3">传统鸿蒙组件开发</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ArkTS中传统的日期选择器组件</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">DatePickerComponent</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">selectedDate</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'2024-01-01'</span>
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">DatePicker</span>({
      <span class="hljs-attr">start</span>: <span class="hljs-string">'2020-01-01'</span>,
      <span class="hljs-attr">end</span>: <span class="hljs-string">'2030-12-31'</span>,
      <span class="hljs-attr">selected</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>
    })
    .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: DatePickerResult</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span> = <span class="hljs-string">`<span class="hljs-subst">${value.year}</span>-<span class="hljs-subst">${value.month}</span>-<span class="hljs-subst">${value.day}</span>`</span>
      <span class="hljs-comment">// 这里需要手动触发所有关联组件的更新</span>
      <span class="hljs-title function_">postUpdateEvent</span>(<span class="hljs-string">'dateChanged'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>)
    })
  }
}
</code></pre>
<h4 data-id="heading-4">使用RICH 设计模式开发鸿蒙组件</h4>
<ol>
<li>语义自描述</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-meta">@SmartComponent</span>({
  <span class="hljs-attr">semantic</span>: <span class="hljs-string">"用药提醒时间设置器"</span>,
  <span class="hljs-attr">medicalContext</span>: {
    <span class="hljs-attr">supports</span>: [<span class="hljs-string">'medication_schedule'</span>, <span class="hljs-string">'dosage_timing'</span>],
    <span class="hljs-attr">constraints</span>: [<span class="hljs-string">'must_align_with_meal'</span>, <span class="hljs-string">'no_overlapping_meds'</span>]
  }
})
</code></pre>
<ol start="2">
<li>自动能力发现</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// 组件自动声明其能力</span>
<span class="hljs-meta">@Capability</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'medical_timeline_integration'</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">'可自动集成到患者病程时间轴'</span>,
  <span class="hljs-attr">api</span>: <span class="hljs-title class_">MedicalTimelineAPI</span>
})
</code></pre>
<ol start="3">
<li>上下文感知</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ContextAwareComponent</span> {
  <span class="hljs-meta">@Prop</span>
  <span class="hljs-meta">@MedicalContext</span>({
    <span class="hljs-attr">patientAge</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">currentDiagnosis</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">medicationList</span>: <span class="hljs-literal">true</span>
  })
  <span class="hljs-attr">medicalContext</span>: <span class="hljs-title class_">MedicalContextData</span>
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 根据患者年龄自动调整界面</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">medicalContext</span>.<span class="hljs-property">patientAge</span> &lt; <span class="hljs-number">12</span>) {
      <span class="hljs-comment">// 儿童友好的界面</span>
      <span class="hljs-title class_">ChildFriendlyDatePicker</span>()
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 成人标准界面</span>
      <span class="hljs-title class_">StandardDatePicker</span>()
    }
  }
}
</code></pre>
<ol start="4">
<li>工作流自动化</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-meta">@WorkflowIntegration</span>({
  <span class="hljs-attr">trigger</span>: <span class="hljs-string">'appointment_scheduled'</span>,
  <span class="hljs-attr">actions</span>: [
    <span class="hljs-string">'update_doctor_calendar'</span>,
    <span class="hljs-string">'generate_patient_reminder'</span>,
    <span class="hljs-string">'prepare_medical_records'</span>
  ]
})
</code></pre>
<p>我们的工作重心，正在从**“如何把页面画好”<strong>，转向</strong>“如何让系统理解每个组件的用途”**。</p>
<h2 data-id="heading-5">设计模式演进：新的问题需要新的解决方案（鸿蒙6新特性应用）</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffc1496c604c4ace9b3ed747f5eb51a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyo5pav5L2z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492365&amp;x-signature=9J6iPShGGch9bajDDZw5oVzFSBU%3D" alt="image.png" loading="lazy"/></p>
<p>在真实的医疗Agent项目中，我们遇到了很多传统B端设计没遇到过的问题。</p>
<h4 data-id="heading-6">问题一：AI“过度自信”怎么办？</h4>
<p>家属说“肚子疼”，AI直接建议“立即手术”——显然会造成恐慌。</p>
<p>我们的方案：医疗场景的分级响应机制。</p>
<ul>
<li>高危症状（胸痛、意识丧失）立即转人工+警报</li>
<li>中危症状（高烧、持续呕吐）提供紧急处理建议+医生连接</li>
<li>低危症状（轻微咳嗽、皮疹）给予家庭护理指导</li>
</ul>
<h4 data-id="heading-7">问题二：用户描述模糊怎么办？</h4>
<p>“我不舒服”——这太宽泛了。</p>
<p>我们的方案：结构化问诊引导。</p>
<ul>
<li>第一步：症状分类（疼痛类、发热类、消化类等）</li>
<li>第二步：细节追问（“哪个部位疼？持续多久了？”）</li>
<li>第三步：提供可视化部位选择器（点击身体图标记疼痛点）</li>
</ul>
<blockquote>
<p>附加价值配合鸿蒙6跨设备感知协同：不只是数据，更是“情境”</p>
</blockquote>
<pre><code class="hljs language-csharp" lang="csharp">  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title">fuseDeviceData</span>()</span> {
    <span class="hljs-comment">// 智能融合来自不同设备的数据</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// 从手表获取：心率、血氧、体温趋势</span>
      vitalSigns: <span class="hljs-keyword">this</span>.multiDeviceHealthData.watch?.vitalSigns,
      
      <span class="hljs-comment">// 从手环获取：活动量、睡眠质量</span>
      activity: <span class="hljs-keyword">this</span>.multiDeviceHealthData.band?.dailyActivity,
      
      <span class="hljs-comment">// 从环境设备获取：室内温度、湿度</span>
      environment: <span class="hljs-keyword">this</span>.multiDeviceHealthData.thermometer?.roomCondition,
      
      <span class="hljs-comment">// 鸿蒙6特性：意图感知</span>
      <span class="hljs-comment">// 自动识别用户是在做饭时、运动后还是睡眠中不适</span>
      situationalIntent: <span class="hljs-keyword">await</span> IntentsKit.recognizeSituationalIntent()
    }
  }
</code></pre>
<h4 data-id="heading-8">问题三：医疗建议需要个性化怎么办？</h4>
<p>同样的症状，儿童和老人的处理方式完全不同。</p>
<p>我们的方案：上下文感知+个性化适配。</p>
<ul>
<li>自动识别患者年龄段</li>
<li>结合过往病史（如有权限）</li>
<li>提供差异化的处理建议</li>
<li>明确标注“建议仅供参考，请及时就医”</li>
</ul>
<blockquote>
<p>Intent Kit 意图识别分发+小艺对话，让问题更精准，“肚子疼”变得立体</p>
</blockquote>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">CrossDeviceSymptomAnalysis</span> {
  <span class="hljs-comment">// 鸿蒙6：跨设备传感器智能融合</span>
  <span class="hljs-meta">@CrossDeviceSensorContext</span>({
    <span class="hljs-comment">// 同时感知手机、手表、环境设备</span>
    <span class="hljs-attr">devices</span>: [<span class="hljs-string">'huawei_watch'</span>, <span class="hljs-string">'harmony_band'</span>, <span class="hljs-string">'smart_thermometer'</span>],
    <span class="hljs-comment">// 智能聚合策略：医疗优先</span>
    <span class="hljs-attr">fusionPolicy</span>: <span class="hljs-string">'medical_emergency'</span>,
    <span class="hljs-comment">// 实时同步，延迟&lt;100ms</span>
    <span class="hljs-attr">syncMode</span>: <span class="hljs-string">'realtime'</span>
  })
  <span class="hljs-attr">multiDeviceHealthData</span>: <span class="hljs-title class_">HealthData</span>
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onSymptomReported</span>(<span class="hljs-params">symptom: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-comment">// 1. 融合多设备数据进行精准评估</span>
    <span class="hljs-keyword">const</span> context = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fuseDeviceData</span>()
    
    <span class="hljs-comment">// 2. 通过Intent Kit分发给最合适的处理节点</span>
    <span class="hljs-keyword">const</span> intentResult = <span class="hljs-keyword">await</span> <span class="hljs-title class_">IntentsKit</span>.<span class="hljs-title function_">dispatch</span>({
      <span class="hljs-attr">intent</span>: <span class="hljs-string">'medical_triage'</span>,
      <span class="hljs-attr">params</span>: {
        <span class="hljs-attr">symptom</span>: symptom,
        <span class="hljs-attr">context</span>: context,
        <span class="hljs-comment">// 附加设备感知数据</span>
        <span class="hljs-attr">crossDeviceData</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">multiDeviceHealthData</span>
      },
      <span class="hljs-comment">// 分发策略：基于紧急程度</span>
      <span class="hljs-attr">strategy</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateEmergencyStrategy</span>(context)
    })
    
    <span class="hljs-keyword">return</span> intentResult
  }
}
</code></pre>
<h2 data-id="heading-9">那些不会变的东西：GUI为什么依然重要</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39126ec34e954797a99bd44019aaf5d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyo5pav5L2z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492365&amp;x-signature=zBrNZxC132WHhnJJgvLmoywaan8%3D" alt="image.png" loading="lazy"/></p>
<p>在大家都热衷讨论自然语言交互时，我想泼一点冷水：GUI不会死，也死不了。
原因很简单：有些交互，用图形就是比用语言高效。</p>
<p>试想一下：</p>
<ul>
<li>在设计工具里微调一个元素的间距：拖拽对齐线 vs “把这个元素向左移动2像素，不对，是1.8像素”</li>
<li>在表格里筛选数据：点击表头下拉 vs “筛选出状态为进行中、优先级为高、创建时间在最近一周的任务”</li>
<li>在地图上规划路径：拖动路径点 vs “把第三个途经点调整到经度X纬度Y的位置”</li>
</ul>
<p>GUI的优势在于：所见即所得，直接操作，实时反馈。
而Agent的价值在于：处理那些需要思考、推理、跨域协作的复杂任务。</p>
<p>两者的关系不是替代，而是互补。</p>
<h2 data-id="heading-10">所以，未来的B端界面要如何设计？</h2>
<p>在人工智能领域，意图通常被定义为用户希望达成的目标，如查询天气情况、办理银行业务、预约服务等。这些意图并不总是直接表达出来，而是隐含在用户的言行之中。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7d9855597ae4cbd895fc40a08132120~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyo5pav5L2z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492365&amp;x-signature=8A%2Fiyt49nm3pu%2F7%2FGfYpJwQaYgU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>我脑海中浮现的画面是这样的：
一个干净的工作台：没有密密麻麻的菜单，只有几个核心数据看板。
一个随时待命的助手：角落里的对话入口，你可以打字，也可以语音。
一组灵活的能力组件：不是固定的页面，而是可以根据任务动态组合的卡片、图表、表单。</p>
<p>当你需要完成一个任务时：</p>
<ol>
<li>向助手描述你的目标</li>
<li>系统理解意图，组装合适的组件</li>
<li>你在生成的界面上微调、确认</li>
<li>系统记住你的偏好，下次做得更好
这听起来像是科幻，但其实技术已经基本就位。缺的不是能力，而是我们作为设计者和开发者的想象力。</li>
</ol>
<h2 data-id="heading-11">写在最后</h2>
<p>最近在推动Agent项目落地时，我最常说的一句话是：“别只想着技术能做什么，多想想用户应该怎么工作。”</p>
<p>Agent不是炫技的工具，它应该是缩短想法与结果之间距离的桥梁。</p>
<p>作为前端，我们正站在一个奇妙的转折点上。过去我们关心像素、关心动画、关心性能，这些依然重要。但现在，我们更需要关心：</p>
<ul>
<li>如何让组件变得“可被理解”？</li>
<li>如何设计“人机协作”的交互流程？</li>
<li>如何平衡“自动决策”和“人工控制”？
这不是AI的胜利，这是交互设计理念的回归——让技术适应人，而不是让人适应技术。</li>
</ul>
<p>也许很快，我们就能告别那个需要记住“点击这里、跳转那里、配置这个”的时代。取而代之的，是一个你说“我需要…”，系统回答“好的，已经准备好了”的时代。</p>
<p>那一天到来时，今天的我们，正在为它铺路。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[掌握核心方法论，打造高质量业务仪表板]]></title>    <link>https://juejin.cn/post/7597009443084697615</link>    <guid>https://juejin.cn/post/7597009443084697615</guid>    <pubDate>2026-01-20T05:47:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597009443084697615" data-draft-id="7596962344046051368" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="掌握核心方法论，打造高质量业务仪表板"/> <meta itemprop="keywords" content="数据可视化,数据分析"/> <meta itemprop="datePublished" content="2026-01-20T05:47:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="可观测性用观测云"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            掌握核心方法论，打造高质量业务仪表板
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    可观测性用观测云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:47:48.000Z" title="Tue Jan 20 2026 05:47:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在数字化运维与业务监控的实践中，仪表板（Dashboard）与汽车的仪表盘同等重要，它不仅是数据可视化的载体，更是团队快速定位问题、洞察数据趋势的核心工具。观测云在平台中内置了大量通用组件、云服务的仪表板模板。但如果你希望从零开始构建个性化的仪表板，又或者对自己绘制的仪表板不够满意，那么这篇文章将教授你几个小技巧，帮助你有效提升仪表板的质量。</p>
<h2 data-id="heading-1">观测云简介</h2>
<p>观测云是一个统一实时监测平台，它提供全面的系统可观测性解决方案，帮助用户快速实现对云平台、云原生、应用及业务的监控需求。观测云的核心功能包括：基础设施监测，日志采集和分析，用户访问监测（RUM），应用性能监测（APM），服务可用性监测（拨测），安全监测，智能监控等等。这款产品能够帮助工程师全面了解端到端的用户体验追踪，了解应用服务的每一次调用，以及全面监控云时代的基础设施。此外，观测云还具备快速发现系统安全风险的能力，为数字化时代提供安全保障。更多信息可以访问观测云官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.guance.com%2F" target="_blank" title="https://www.guance.com/" ref="nofollow noopener noreferrer">www.guance.com</a></p>
<h2 data-id="heading-2">基础仪表板的绘制</h2>
<p>让我们进入到观测云，创建一个属于您自己的仪表板。首先，你需要找到仪表板的入口「场景」-「仪表板」，点击「新建仪表板」-「新建空白仪表板」。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/333759108314492781504b30b087a7e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=3Z6UX6zpaZrvGxxHjraDyPovW2Y%3D" alt="" loading="lazy"/></p>
<p>其次，可以从侧滑窗口中选择适合展示数据的图表类型，拖拽到左边的空白画布中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e465e05ce9f54854851e9dca5edfb8a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=6HGYT346IzEFuSSfCbAK8MYEHoQ%3D" alt="" loading="lazy"/></p>
<p>以常用的「时序图」为例，拖动到画布中即可打开「新建图表」弹窗，此时通过数据筛选控件来选择需要展示的指标。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a21b52c47adb4e11879bc8e3a0378e1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=wr7a%2BtFEmgDoMppQYxLWWIgyOwo%3D" alt="" loading="lazy"/></p>
<p>如图所示，我们已经展示了一条指标曲线，它代表的含义为：指标集为 cpu，指标名为 usage_total，按照 host 进行分组并统计 Avg 平均值，只显示 host=DESKTOP-F9E75IG 的值（过滤条件），点击右下角的保存即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a2b2e619b3d493b80fb47635311938a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=uS7E3PUhbfXV3fODmjJtYpFBdQ0%3D" alt="" loading="lazy"/></p>
<p>此时你已经完成了第一张图表的制作，通过一张张图表的叠加，你很快能得到一个完整的仪表板，不过它看上去有些简陋，我们需要更多技巧对仪表板的美观程度和易读性进行优化。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2eb025dff914578aa348519416a733b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=5HHVeRsAVq65SkQp0JGVRjqqEdI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">仪表板的优化</h2>
<h3 data-id="heading-4">新增标题和描述</h3>
<p>恰当的标题能让用户第一时间知道图表展示的指标及其含义，而图表的描述能够起到有效补充说明。我个人的习惯是将图表名设置为指标的英文名，然后在「描述」中补充该指标的中文含义。如下所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e1643f12d1a48e5a1c80064d2acd07c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=bUsHBdkRvpPgyqOrnRUIjG7I0Us%3D" alt="" loading="lazy"/></p>
<p>保存生效的效果如下，图表左上角将展示标题，而鼠标 hover 到帮助按钮上则会悬浮显示描述。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5450112709c24704a8d0549cf2598f0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=8iF25S3ZKVcRD7MU2ouy8f17oPc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">数据单位</h3>
<p>一部分指标在采集到观测云后没有单位，因此在绘制仪表板时需要注意补充单位。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f57d23f8106409f922c4698966cc308~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=FVBTeD5tXUZIXKLCrQG5ageY0rw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">别名</h3>
<p>图表的曲线会显示对象的名称，并且对象名称会随着分组条件的增多而变得复杂。例如下图，由于添加了 namespace，pod_name 等多个分组条件，对象名称显得很长，很不直观。好在我们可以通过配置「别名」来简化对象名称的显示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b26a5c176fef4807994a71d4f9a3fd78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=E9zW9d%2BzBkZ44eQeVCCLpcG53PY%3D" alt="" loading="lazy"/></p>
<p>在图表配置的「别名」处，我们选择对应的指标序列，并用 {{}} 将分组条件包起来作为变量，例如下图中的分组条件 pod_name 就写为 {{pod_name}} ，效果如下所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ac47208e167414384a0d4f0bfe706c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=lHIH81E4jN4PdtJVmuo8HSKubGA%3D" alt="" loading="lazy"/></p>
<p>我们也支持用多个变量作为别名，写法为 {{分组条件1}}-{{分组条件2}} ，例如 {{namespace}}--{{pod_name}} ，效果如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a8d36ae462c4b109ce3e18880a854d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=lNO8iRNQNrh7oCrDX9O7jlnN0e8%3D" alt="" loading="lazy"/></p>
<p>现在，曲线上显示的对象名称已经比原始的名称简洁、清晰了很多。</p>
<h3 data-id="heading-7">图例</h3>
<p>图表默认没有带上图例，除非将鼠标 hover 上去，否则无法看到什么颜色的曲线代表哪一个对象，如下图的左侧所示。而「图例」则可以将对象的名称和统计值显示到图表中，如下图的右侧所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e24fbebf7004b0690b0a44431439f75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=pfwJaWJCEBLOJV5rvCyCsmOaWqI%3D" alt="" loading="lazy"/></p>
<p>添加图例的方式如下，可选择将图例放置在图表的底部或者右侧，并显示单个或者统计值，将 Avg、Max、Last 一起显示出来是个不错的选择。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/194005883ea24e1bb80d69b557cb8bdf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=PFI6B8b1r3h6ZqvXBT%2Bg76gE6nc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">分组</h3>
<p>当仪表板中需要展示很多张图表时，使用「分组」来将不同含义的图表分门别类地归类就十分有必要了，这会让仪表板的显示更具有条理，用户能通过分组快速找到自己关注的图表，如下图所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d34343b951b4f009a4f292523bea172~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=Y92o59KNIg2%2BQyYSbMqANvAeeTg%3D" alt="" loading="lazy"/></p>
<p>给仪表板添加分组时，只需要在侧滑菜单中找到「分组」这个图表类型，拖动到左侧画布即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48e594d566ad4e18948682a6e3db20f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=OTGnYR6w5xPLmjNETtknbwgjFiQ%3D" alt="" loading="lazy"/></p>
<p>取一个有意义的分组名称，选择一个与众不同的颜色，保存即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/088f87d5ce8d40ce830909a43886ce2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=oofi9Hx0EZvdBL%2FtUCThOSGC0RY%3D" alt="" loading="lazy"/></p>
<p>下图即为新创建的分组，后续添加的图表即可拖动到该分组下。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20f0d13389614f5a99a3855ff7606645~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=DTJaKXPMwL4S%2Fc9EUHVovfN1rAk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">锁定时间</h3>
<p>如果你希望每次进入到仪表板，都查看到固定时间区间（例如最近1天）的数据，应该如何实现呢？</p>
<p>我们很容易注意到仪表板的时间控件，可以在这里固定整个仪表板的时间。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffa6c2d835334037854d86a1c3304ca6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=4CMQ%2FXzce%2FoY8wVb5kkrEv2Gf4g%3D" alt="" loading="lazy"/></p>
<p>如果需要将单个图表的时间进行固定，而其他图表的时间则跟随仪表板的时间控件，也很好实现。我们进入单个图表的编辑窗口，打开「高级配置」，将时间锁定为指定区间即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07fa1057949d41cf8a73762c734568a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=I0ysME8tOEOhy2vcm72BA1njiqI%3D" alt="" loading="lazy"/></p>
<p>配置完成后，这个图表的右上角会出现你锁定的时间区间，该时间不受仪表板整体的时间区间控制，如下图所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5bbbaacdfc548488732afc90da229f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=ivIHeaUaR1y9qVgWmJfMmyPOOXo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">视图变量</h3>
<p>视图变量允许用户通过下拉菜单来选择特定对象的监控数据，从而根据自身需求动态筛选和分析数据。如下图所示，该仪表板包括了 Cluster、Namespace 和 Node 三个视图变量，用户可以进行自由筛选。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d4aa45b10d24c20b1e3edfbb19be8ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=en%2BwcDHIQ6AoxsxE8yMxnxNvxYY%3D" alt="" loading="lazy"/></p>
<p>我们首先添加一个简单的视图变量，需求是通过选择 host_ip 来过滤单台主机的数据。在仪表板中点击「添加视图变量」。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51ce9c1998ce48ab8b737a27e3bc2e18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=xt5vh0WB0VmBUFuSMe1us2QUavA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26c451a1950e4ffc9f7231657a36f19c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=MuZZ0wvXNQ42fFkOEcKZtaSCOmg%3D" alt="" loading="lazy"/></p>
<p>host_ip 是 cpu 相关指标数据的一个标签，因此我们从指标类型- CPU指标集里面选择 host_ip 作为视图变量的来源，然后将「变量名」和「显示名」都与之保持一致，保存窗口即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe7a7d7399f643689e2574427ace0e76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=PG%2BWMQKOjzgJrUUBGfuJgxCJ984%3D" alt="" loading="lazy"/></p>
<p>此时返回仪表板，就会看到刚才添加的 host_ip 视图变量，从下拉菜单中可以筛选主机 IP。如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d89c3eede6749ad8e62b235b9246cb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=9QLCCB3HxMwmUpIfPCRIZnLI1E4%3D" alt="" loading="lazy"/></p>
<p>你可能会发现筛选结果之后，对下方的图表没有任何作用，因为我们还需要在图表中的过滤条件配置变量，使仪表板的额视图变量与图表的过滤条件进行联动。再次进入图表编辑界面，添加一个过滤条件，字段选择为 host_ip，值选择「视图变量」，如下图所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32ad9f728a484df1a190f83891124235~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=u9jBN9aTbI2OAaCHQB58p5CVJkc%3D" alt="" loading="lazy"/></p>
<p>返回仪表板，这时仪表板的视图变量 host_ip 就可以与图表中的监控对象 host_ip 进行联动了。我们可以通过下拉菜单来筛选不同的主机，从而观察不同主机的监控指标。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d90efe78305463a9fdc62582cdea9e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=JNN8g6qeLTBfhGDQJeO%2FVak2qjU%3D" alt="" loading="lazy"/></p>
<p>如果是有多个视图变量，且视图变量之间有依赖关系，例如我们针对 Pod 的监控是首先选择 namespace，再选 Pod，那我们又应该如何配置呢？这就要用到「级联」的写法，让我们来再来回顾一下刚才本章开头的那张图片。选择 Cluster 后，Namespace 的值随 Cluster 的取值而联动，Node 的值又随 Namespace 的取值而联动。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a6753aec12b41f1b5e8ed14b8822c2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=mQJ8K96GjuDZM8f0zZ2gR1AsfdM%3D" alt="" loading="lazy"/></p>
<p>我们研究一下这组视图变量的写法，不难发现规律是在 show_tag_value 函数的后面跟随了一个 {key=value} 的过滤条件，其固定写法为 {key='#{value}'} ，key 和 value 都取自上一级的变量名，表示该变量随上一级变量的值而联动。如下图所示，当用户在界面上选择了 cluster_name_k8s 的值后，该值就会传入 namespace 作为过滤条件，从而实现变量联动。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54b8397ef9b94924be46b7db52f41ccd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=myFRqvQBdnurRS13DvGL1GK8x2A%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90a5fd34ead44e6e844333dae5274dcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769492868&amp;x-signature=LfWOXyZqqrUNKsPgGZZiAtBB710%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">小结</h2>
<p>通过上面的几个小技巧，相信你已经跃跃欲试将自己的仪表板更上一层楼了。在得到令自己满意的仪表板后，你可以选择将仪表板开放给团队、配置为定时报告、投放到大屏幕、关联到日志或链路查看器中，又或者在接收到告警时一键查看这张仪表板。我们非常期待你通过仪表板来向你的团队/客户呈现数据的价值。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年度稀土掘金影响力榜单如约而至！]]></title>    <link>https://juejin.cn/post/7589823928413241370</link>    <guid>https://juejin.cn/post/7589823928413241370</guid>    <pubDate>2025-12-31T07:57:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589823928413241370" data-draft-id="7589578614583132186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年度稀土掘金影响力榜单如约而至！"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-12-31T07:57:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金酱"/> <meta itemprop="url" content="https://juejin.cn/user/1556564194374926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年度稀土掘金影响力榜单如约而至！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1556564194374926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T07:57:38.000Z" title="Wed Dec 31 2025 07:57:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3,871
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">稀土掘金社区2025年度影响力榜单正式公布</h2>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d84e196bd63448db7cedc4f98be0bc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768983079&amp;x-signature=tci%2B%2BO58Guui6sHmsaiPJZ7GrEU%3D" alt="1303-734主视觉 (1) (3).jpg" width="100%" loading="lazy"/>
<p>时光向前，2025年即将落下句点。回首这一程，幸而有伴 —— 每一次深夜的打磨，每一段真诚的分享，每一回评论区里的倾力相助，都为技术探索的漫漫长路，点亮了一盏盏暖灯。</p>
<p>感谢这一年里，将实操经验凝注于代码、把深度思考落笔成文字的创作者。是每一个具体的 “你”，让稀土掘金始终活力满满。</p>
<p>今天，我们以这份榜单，记录那些值得被看见的光芒。它们来自团队扎实的沉淀，来自创作者持久的热情，也来自那些真正帮助过许多人的走心好文。</p>
<p><strong>榜单地址</strong>：<a href="https://aicoding.juejin.cn/pens/7589935553110835252" target="_blank" title="https://aicoding.juejin.cn/pens/7589935553110835252">aicoding.juejin.cn/pens/758993…</a></p>
<h2 data-id="heading-1">2025年度优秀创作者 | The Best 10 Creative Writers of 2025</h2>
<blockquote>
<p>他们是社区里的“解惑人”，把复杂讲得简单，把枯燥变得生动。他们的文字，曾陪伴无数掘友走出技术探索的迷茫时刻。</p>
</blockquote>

















































<table><thead><tr><th>站内昵称</th><th>个人主页</th></tr></thead><tbody><tr><td>Moment</td><td><a href="https://juejin.cn/user/3782764966460398" target="_blank" title="https://juejin.cn/user/3782764966460398">juejin.cn/user/378276…</a></td></tr><tr><td>ConardLi</td><td><a href="https://juejin.cn/user/3949101466785709" target="_blank" title="https://juejin.cn/user/3949101466785709">juejin.cn/user/394910…</a></td></tr><tr><td>何贤</td><td><a href="https://juejin.cn/user/277499952247869" target="_blank" title="https://juejin.cn/user/277499952247869">juejin.cn/user/277499…</a></td></tr><tr><td>洛卡卡了</td><td><a href="https://juejin.cn/user/888839672963544" target="_blank" title="https://juejin.cn/user/888839672963544">juejin.cn/user/888839…</a></td></tr><tr><td>why技术</td><td><a href="https://juejin.cn/user/3702810893364350" target="_blank" title="https://juejin.cn/user/3702810893364350">juejin.cn/user/370281…</a></td></tr><tr><td>恋猫de小郭</td><td><a href="https://juejin.cn/user/817692379985752" target="_blank" title="https://juejin.cn/user/817692379985752">juejin.cn/user/817692…</a></td></tr><tr><td>苏三说技术</td><td><a href="https://juejin.cn/user/465848661970824" target="_blank" title="https://juejin.cn/user/465848661970824">juejin.cn/user/465848…</a></td></tr><tr><td>coder_pig</td><td><a href="https://juejin.cn/user/4142615541321928" target="_blank" title="https://juejin.cn/user/4142615541321928">juejin.cn/user/414261…</a></td></tr><tr><td>张风捷特烈</td><td><a href="https://juejin.cn/user/149189281194766" target="_blank" title="https://juejin.cn/user/149189281194766">juejin.cn/user/149189…</a></td></tr><tr><td>德莱厄斯</td><td><a href="https://juejin.cn/user/3919115686512942" target="_blank" title="https://juejin.cn/user/3919115686512942">juejin.cn/user/391911…</a></td></tr></tbody></table>
<h2 data-id="heading-2">2025年度影响力团队 -The Most Influential Teams of 2025</h2>
<blockquote>
<p>他们以团队的力量，把一线实践沉淀成可复用的经验，如一张张清晰的技术地图，帮助不少同行找到了方向。</p>
</blockquote>

















































<table><thead><tr><th>团队名称</th><th>团队主页</th></tr></thead><tbody><tr><td>DevUI团队</td><td><a href="https://juejin.cn/user/712139267650141" target="_blank" title="https://juejin.cn/user/712139267650141">juejin.cn/user/712139…</a></td></tr><tr><td>vivo互联网技术</td><td><a href="https://juejin.cn/user/993614243303053" target="_blank" title="https://juejin.cn/user/993614243303053">juejin.cn/user/993614…</a></td></tr><tr><td>得物技术</td><td><a href="https://juejin.cn/user/2392954206960247" target="_blank" title="https://juejin.cn/user/2392954206960247">juejin.cn/user/239295…</a></td></tr><tr><td>古茗前端团队</td><td><a href="https://juejin.cn/user/3233040624266695" target="_blank" title="https://juejin.cn/user/3233040624266695">juejin.cn/user/323304…</a></td></tr><tr><td>货拉拉技术</td><td><a href="https://juejin.cn/user/1768489241815070" target="_blank" title="https://juejin.cn/user/1768489241815070">juejin.cn/user/176848…</a></td></tr><tr><td>京东零售技术</td><td><a href="https://juejin.cn/user/4233576972293643" target="_blank" title="https://juejin.cn/user/4233576972293643">juejin.cn/user/423357…</a></td></tr><tr><td>奇舞精选</td><td><a href="https://juejin.cn/user/4388906147515367" target="_blank" title="https://juejin.cn/user/4388906147515367">juejin.cn/user/438890…</a></td></tr><tr><td>37手游后端团队</td><td><a href="https://juejin.cn/user/1548527766871239" target="_blank" title="https://juejin.cn/user/1548527766871239">juejin.cn/user/154852…</a></td></tr><tr><td>哔哩哔哩技术</td><td><a href="https://juejin.cn/user/3030701626893405" target="_blank" title="https://juejin.cn/user/3030701626893405">juejin.cn/user/303070…</a></td></tr><tr><td>转转技术团队</td><td><a href="https://juejin.cn/user/606586148237431" target="_blank" title="https://juejin.cn/user/606586148237431">juejin.cn/user/606586…</a></td></tr></tbody></table>
<h2 data-id="heading-3">2025年度爆款好文 | High hits articles in 2025</h2>
<blockquote>
<p>这20篇文章，是从海量分享中脱颖而出的“年度之选”。它们或视角新颖、或剖析深入、或实战性强，在各自领域内获得了认可，成了许多掘友收藏或推荐的那一篇。</p>
</blockquote>



























































































































































<table><thead><tr><th>文章标题</th><th>文章链接</th><th>所属作者</th><th/></tr></thead><tbody><tr><td/><td><strong>前端</strong></td><td/><td/></tr><tr><td>《40岁老前端2025年上半年都学了什么？》</td><td><a href="https://juejin.cn/post/7524548909530005540" target="_blank" title="https://juejin.cn/post/7524548909530005540">juejin.cn/post/752454…</a></td><td>张鑫旭</td><td/></tr><tr><td>《前端仔如何在公司搭建 AI Review 系统》</td><td><a href="https://juejin.cn/post/7532596434031149106" target="_blank" title="https://juejin.cn/post/7532596434031149106">juejin.cn/post/753259…</a></td><td>唐某人丶</td><td/></tr><tr><td>《因为写了一个前端脚手架，这个月的KPI 打满了！！！》</td><td><a href="https://juejin.cn/post/7457936514791292938" target="_blank" title="https://juejin.cn/post/7457936514791292938">juejin.cn/post/745793…</a></td><td>赵小川</td><td/></tr><tr><td>《因网速太慢我把20M+的字体压缩到了几KB》</td><td><a href="https://juejin.cn/post/7490337281866317836" target="_blank" title="https://juejin.cn/post/7490337281866317836">juejin.cn/post/749033…</a></td><td>古茗前端团队</td><td/></tr><tr><td>《历经4个月，基于 Tiptap 和 NestJs 打造一款 AI 驱动的智能文档协作平台 🚀🚀🚀》</td><td><a href="https://juejin.cn/post/7553165143376134195" target="_blank" title="https://juejin.cn/post/7553165143376134195">juejin.cn/post/755316…</a></td><td>Moment</td><td/></tr><tr><td/><td><strong>后端</strong></td><td/><td/></tr><tr><td>《MCP 很火，来看看我们直接给后台管理系统上一个 MCP？》</td><td><a href="https://juejin.cn/post/7481491253499969575" target="_blank" title="https://juejin.cn/post/7481491253499969575">juejin.cn/post/748149…</a></td><td>Hamm</td><td/></tr><tr><td>《还在用WebSocket实现即时通讯？试试MQTT吧，真香！》</td><td><a href="https://juejin.cn/post/7539351775044862003" target="_blank" title="https://juejin.cn/post/7539351775044862003">juejin.cn/post/753935…</a></td><td>MacroZheng</td><td/></tr><tr><td>《我做了套小红书一键发布系统，运营小姐姐说她不想离开我了》</td><td><a href="https://juejin.cn/post/7552489208804491316" target="_blank" title="https://juejin.cn/post/7552489208804491316">juejin.cn/post/755248…</a></td><td>洛卡卡了</td><td/></tr><tr><td>《Java 实现责任链模式 + 策略模式：优雅处理多级请求的方式》</td><td><a href="https://juejin.cn/post/7457366224823124003" target="_blank" title="https://juejin.cn/post/7457366224823124003">juejin.cn/post/745736…</a></td><td>后端出路在何方</td><td/></tr><tr><td>《CompletableFuture还能这么玩》</td><td><a href="https://juejin.cn/post/7455561985378598951" target="_blank" title="https://juejin.cn/post/7455561985378598951">juejin.cn/post/745556…</a></td><td>一只叫煤球的猫</td><td/></tr><tr><td/><td><strong>移动端</strong></td><td/><td/></tr><tr><td>《2025 跨平台框架更新和发布对比，这是你没看过的全新版本》</td><td><a href="https://juejin.cn/post/7505578411492474915" target="_blank" title="https://juejin.cn/post/7505578411492474915">juejin.cn/post/750557…</a></td><td>恋猫de小郭</td><td/></tr><tr><td>《月下载 40 万次的框架是怎么练成的？》</td><td><a href="https://juejin.cn/post/7547408384585629711" target="_blank" title="https://juejin.cn/post/7547408384585629711">juejin.cn/post/754740…</a></td><td>Android轮子哥</td><td/></tr><tr><td>《[targetSDK升级为35] 恶心的EdgeToEdge适配 (v7)》</td><td><a href="https://juejin.cn/post/7497170890083762213" target="_blank" title="https://juejin.cn/post/7497170890083762213">juejin.cn/post/749717…</a></td><td>snwrking</td><td/></tr><tr><td>《gson很好，但我劝你在Kotlin上使用kotlinx.serialization》</td><td><a href="https://juejin.cn/post/7459298439811219496" target="_blank" title="https://juejin.cn/post/7459298439811219496">juejin.cn/post/745929…</a></td><td>沈剑心</td><td/></tr><tr><td>《开箱即食Flutter通用脚手架》</td><td><a href="https://juejin.cn/post/7482789772362317864" target="_blank" title="https://juejin.cn/post/7482789772362317864">juejin.cn/post/748278…</a></td><td>SunshineBrother</td><td/></tr><tr><td/><td><strong>人工智能</strong></td><td/><td/></tr><tr><td>《一天 AI 搓出痛风伴侣 H5 程序，前后端+部署通吃，还接入了大模型接口（万字总结）》</td><td><a href="https://juejin.cn/post/7517496354244067339" target="_blank" title="https://juejin.cn/post/7517496354244067339">juejin.cn/post/751749…</a></td><td>志辉AI编程</td><td/></tr><tr><td>《AI 应用开发入门：前端也可以学习 AI》</td><td><a href="https://juejin.cn/post/7517197769247391756" target="_blank" title="https://juejin.cn/post/7517197769247391756">juejin.cn/post/751719…</a></td><td>唐某人丶</td><td/></tr><tr><td>《如何把你的 DeePseek-R1 微调为某个领域的专家？》</td><td><a href="https://juejin.cn/post/7473309339294695460" target="_blank" title="https://juejin.cn/post/7473309339294695460">juejin.cn/post/747330…</a></td><td>ConardLi</td><td/></tr><tr><td>《3天，1人，从0到付费产品：AI时代个人开发者的生存指南》</td><td><a href="https://juejin.cn/post/7577653509862654002" target="_blank" title="https://juejin.cn/post/7577653509862654002">juejin.cn/post/757765…</a></td><td>HiStewie</td><td/></tr><tr><td>《全网最细，一文带你弄懂 MCP 的核心原理！》</td><td><a href="https://juejin.cn/post/7493455615244959794" target="_blank" title="https://juejin.cn/post/7493455615244959794">juejin.cn/post/749345…</a></td><td>ConardLi</td><td/></tr></tbody></table>
<h2 data-id="heading-4">好的社区，是人与人相互照亮</h2>
<p>这份榜单，与其说是评选，不如说是一次郑重的致谢。谢谢所有分享者，也谢谢每一位静静学习、默默点赞、热心评论的掘友。</p>
<p>技术之路，日常而长远。2026年，愿你继续在这里写下自己的章节，发出自己的光。我们相信，每一个人的微小光芒，终将汇聚成行业的星辰。</p>
<p>*注：以上排名不分先后，随机排序。本榜单依据<strong>2025年1月1日至12月21日</strong>期间的数据综合评定，涵盖文章质量、互动热度、创作者影响力、分类分布及评审团意见等多维度，最终解释权归稀土掘金所有。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Meta ShapeR ：基于随机拍摄视频的 3D 物体生成，未来的 XR 和机器人基建支持]]></title>    <link>https://juejin.cn/post/7597083949833797638</link>    <guid>https://juejin.cn/post/7597083949833797638</guid>    <pubDate>2026-01-20T05:54:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7597083949833797638" data-draft-id="7597168034616672275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Meta ShapeR ：基于随机拍摄视频的 3D 物体生成，未来的 XR 和机器人基建支持"/> <meta itemprop="keywords" content="前端,Android,AI编程"/> <meta itemprop="datePublished" content="2026-01-20T05:54:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Meta ShapeR ：基于随机拍摄视频的 3D 物体生成，未来的 XR 和机器人基建支持
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-20T05:54:37.000Z" title="Tue Jan 20 2026 05:54:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近日 Meta 突然开源了它的 ShapeR 项目，ShapeR 可以利用基于对象多模态数据的 Rectified Flow Transformer，将普通图像序列转换为完整的度量场景重建，说人话就是：</p>
<blockquote>
<p><strong>从随手拍的视频/多张照片里，把真实物体恢复成可用 3D 模型（Mesh）</strong></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bf8a838b0144e5cb01212204e0b7fcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769493277&amp;x-signature=YWca4hlM0a3iISD5%2F4znADH1yfY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c77a685673244eb8a3204ebd16bfb06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769493277&amp;x-signature=8kPoF0npRJmznj65h4m4saegDsQ%3D" alt="" loading="lazy"/></p>
<p>简单来说就是，你可以拿着手机绕着一个物体拍一圈（图片序列 / 视频帧序列），ShapeR 会结合：</p>
<ul>
<li>SLAM 得到的稀疏点云 + 相机位姿</li>
<li>物体检测/实例分割得到的对象实例</li>
<li>VLM 生成的文本 caption（描述物体），把这些多模态条件喂给生成模型，最后得到<strong>物体的 metric 3D mesh（带真实尺度）</strong></li>
</ul>
<p>看到这么多名词是不是有点懵？这些概念性的东西我们需要简单聊聊：</p>
<h4 data-id="heading-0">SLAM</h4>
<p>这个是 ShapeR 的地基核心，<strong>SLAM (Simultaneous Localization and Mapping) 其实就是用算法解决摄像头在陌生化环境的定位和建图</strong>，实现定位的时候建图，建图的时候定位的支持，简单来说就是：</p>
<ul>
<li>摄像头采集数据</li>
<li>通过画面比对计算移动距离</li>
<li>通过算法来修正误差</li>
<li>通过回环检测来解决漂移和消除误差</li>
</ul>
<p>用人话来说就是：<strong>用 SLAM 可以得到 “摄影师的足迹”和“物体的骨架”</strong> ，具体来自：</p>
<ul>
<li><strong>相机位姿</strong>：相当于记录了你拿着手机绕着物体走动时，每一步具体站在哪里，手机镜头朝向哪里（比如：向左走了 1 米，镜头向下倾斜 30 度）<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07e11b19046145d08d65f222dbe03f26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769493277&amp;x-signature=i0fvm9RdxnTLJf%2B6xatDJBEzD4A%3D" alt="" loading="lazy"/></li>
<li><strong>稀疏点云</strong>：相当于你在物体上撒了一把荧光粉，SLAM 并不试图重建整个物体表面，它只抓取最明显的特征点（比如桌角、杯子的把手尖），看起来稀稀拉拉像个幽灵，<strong>但它锁定了物体的真实尺寸和空间位置</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd9100dafc1b41ae80c88949d430c2f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769493277&amp;x-signature=kUOZqIoj32CQffKPcJbDtWT6wvc%3D" alt="" loading="lazy"/></li>
</ul>
<p>SLAM 之所以能做到这一点，核心依赖于<strong>几何学的三角测量和概率学的误差优化</strong>，简单来说：</p>
<ul>
<li>
<p>当你拿着手机移动时（比如向右移动了 10 厘米），SLAM 会对比前后两帧画面：</p>
<ul>
<li><strong>A点（比如桌上的杯子）</strong> 在画面里移动了 100 个像素 -&gt; 推算：<strong>它离我很近</strong></li>
<li><strong>B点（窗外的树）</strong> 在画面里只移动了 2 个像素 -&gt; 推算：<strong>它离我很远</strong></li>
</ul>
<p>通过这种<strong>视差</strong>，配合手机摄像头移动的距离（IMU 传感器提供），算法就能画出一个个三角形，通过几何公式算出每个特征点在三维空间中的精确坐标，这在室内导航 BLE 测距离也会有类似的三角测量用法</p>
</li>
<li>
<p>SLAM 并不是真的知道自己移动了多少米，它最聪明的地方在于不追求一步到位，而是不断“猜”和“改”，通过假设和推算不断去修正误差</p>
</li>
<li>
<p>最后有个回环检测，比如误差越来越大，但是当你绕了一圈回到原点时，摄像头拍到了之前的场景，比对之后会发，这个画面和之前 5 分钟的画面重合，那么它会把过去 5 分钟积累的所有位置偏差强制拉回</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1da6cb9389054a41a99c4f697cfcd92e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769493277&amp;x-signature=gCdLba23K51c9fDQlw8IHBX4GQo%3D" alt="" loading="lazy"/></p>
<p>这就是 SLAM 的简单概念，实际上这也是移动开发里的 ARCore 和 ARkit 的基础概念之一，同时对于机器人、无人机或者 XR ，SLAM 也是非常重要的基础，如果用人话来说就是，<strong>SLAM 是把硬件数据（IMU 的加速度、摄像头的像素变化）转化为了几何约束</strong>：</p>
<ul>
<li><strong>眼睛（Camera）</strong> ：提供角度信息（我知道杯子在那个方向）</li>
<li><strong>前庭（IMU）</strong> ：提供尺度信息（我感觉我向前冲了 1 米）</li>
<li><strong>大脑（Algorithm）</strong> ：通过几何公式把角度和尺度结合，算出距离，再通过记忆（回环检测）修正走过的路</li>
</ul>
<h4 data-id="heading-1">物体检测 / 实例分割</h4>
<p><strong>物体检测 / 实例分割（Object Detection / Instance Segmentation）简单说就是 “自动抠图”和“聚光灯”</strong> ：</p>
<ul>
<li>你拍的是整个房间，但你只想重建桌上的那个茶壶</li>
<li>这就需要一个算法，能自动在乱糟糟的背景里把茶壶给“圈出来”（画个框），甚至精确到把茶壶的每一个像素都涂上颜色，把背景剔除掉，这就是把茶壶从环境里“抠”出来</li>
</ul>
<p>具体到实现上就是：</p>
<ul>
<li><strong>物体检测 (Detection)</strong> ：输出一个 Bounding Box（边界框），告诉系统物体大概在哪（比如 <code>[x1, y1, x2, y2]</code>）</li>
<li><strong>实例分割 (Instance Segmentation)</strong> ：输出一个 Binary Mask（二值掩码），在这个掩码图里，属于茶壶的像素是 1，背景是 0</li>
</ul>
<p>ShapeR 是 Object-Centric（以物体为中心）的，它需要这些 Mask 来告诉生成模型：“只准重建这个茶壶，不要把后面的墙壁和下面的桌子也算进去了”</p>
<h4 data-id="heading-2">VML</h4>
<p>最后是 VLM (Visual Language Model generated Captions) 生成的文本 Caption，通俗理解来说就是“给 AI 的命题作文”：</p>
<ul>
<li>虽然有了照片，但生成模型有时候比较“笨”，它可能看不清照片里的细节（比如模糊了，或者被挡住了）</li>
<li>这时，就需要一个专门懂图片的 AI（VLM，类似 GPT-4V），让它看一眼照片，然后写一段话：“这是一个红色的复古木质椅子，椅背有雕花，坐垫是天鹅绒材质。”</li>
</ul>
<p>也就是针对图形增加一点文本表述，提供更准确的语义，照片提供了“几何外观”，文本提供了“概念理解”，防止照片里因为反光或遮挡导致细节丢失时，模型可以根据这段文本描述，利用其训练库里关于“复古木质椅子”的知识，合理地“脑补”出看不清的细节。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef9a57854e7b4713a225406133b8f56c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769493277&amp;x-signature=k29TVlcFmssyyZzp4AHwGSmr8Bc%3D" alt="" loading="lazy"/></p>
<p>所以 ShapeR 基本概念就是通过这三者完成建模：</p>
<ul>
<li>SLAM 提供骨架和尺子：“雕像必须这么高，膝盖必须在这里，不能乱动。”（保证准确度）</li>
<li>实例分割提供一个轮廓剪影：“只能在这个范围内雕刻，别把旁边的花瓶也雕进去了。”（保证独立性）</li>
<li>VLM Caption 提供附录：“这可是个由桃花心木做的 18 世纪风格椅子，纹理要细腻。”（保证细节和合理性）</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4df52317da414eafa5533f00b8dd09ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769493277&amp;x-signature=DmJqqGWt6tF4zyIm4gUuzF58WrU%3D" alt="" loading="lazy"/></p>
<p>那么从前面的概念也可以看出来，ShapeR 的特点是：<strong>它不是直接重建一个整体 NeRF / TSDF 场景块，而是先检测场景中的多个对象 ，然后对每个对象单独重建 mesh ，最后再组装成场景</strong> 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3eb8da197bd041e0a2acefe3b59e59ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769493277&amp;x-signature=2hq4its6ZBU5Ch%2Fb9L92EI7N6bo%3D" alt="" loading="lazy"/></p>
<p>所以在 ShapeR 里，你可以：</p>
<ul>
<li>单独拿出某个物体（比如椅子/桌子）</li>
</ul>

<ul>
<li>替换/移动/重新摆放</li>
</ul>

<ul>
<li>导出到 DCC/引擎里编辑（Blender/Unity/Unreal）</li>
</ul>
<blockquote>
<p>换个概念简单理解，以前你只能得到一个 PNG，现在你可以得到一个 PSD</p>
</blockquote>
<p>那你可能会说，它有什么作用？实际上它的作用还挺丰富，比如：</p>
<ul>
<li>AR 场景理解 / 虚拟摆放</li>
<li>机器人避障、navigation</li>
<li>具身 AI 的数据集构建（真实物体 mesh + 尺度）</li>
</ul>
<p>ShapeR 可以把“现实物体”的视频快速转成结构化的 3D 资产（mesh 级别），当然，事实上 ShapeR 不是“直接吃视频就出 3D”，它吃的是 <strong>预处理后的 per-object 数据包（pkl）</strong> ，里面包含：</p>
<ul>
<li>物体的稀疏 metric point cloud（来自 SLAM / SfM）</li>
<li>带位姿的多视图图像（posed images）</li>
<li>物体的 caption 文本描述</li>
<li>物体的 2D/3D 实例信息（用于从场景里拆出物体）</li>
</ul>
<p><strong>所以 ShapeR 的核心难点确实不在模型推理本身，而在于数据准备</strong> ，目前 ShapeR 的代码库明确指出，它的前提是假设数据已经通过 <strong>Aria MPS (Machine Perception Services)</strong> 流水线处理过。</p>
<p>所以不得不说，官方宣传的“随手拍”很美好，但是实际上并不是想象中那么简单，在他们提供的场景下：</p>
<ul>
<li><strong>录制设备</strong>：Meta 内部的 <strong>Project Aria 眼镜</strong>（智能眼镜）</li>
<li><strong>数据准备</strong>：使用 【Aria MPS 服务】+ 【3D 实例检测】 + 【VLM caption】将眼镜录制的数据转换为上述的 <code>.pkl</code> 格式</li>
</ul>
<blockquote>
<p>这里的 Aria MPS 是闭源的服务，MPS 内部使用的 SLAM（定位与地图构建）、3D 重建、手部追踪等核心算法，暂时只面向 Project Aria Research Kit（ARK）研究合作伙伴开放。</p>
</blockquote>
<p>目前官方已经发布 <strong>ShapeR Evaluation Dataset</strong>，里面每个样本就是推理要用的 <code>.pkl</code>（包含点云、multi-view 图像、相机参数/位姿、caption、GT mesh 等），如果只是想测试，可以下载他们的 evaluation dataset（HuggingFace 上的 <code>facebook/ShapeR-Evaluation</code>，项目页也有 Data 链接），直接跑推理：</p>
<pre><code class="hljs language-css" lang="css">python infer_shape<span class="hljs-selector-class">.py</span> <span class="hljs-attr">--input_pkl</span> &lt;sample<span class="hljs-selector-class">.pkl</span>&gt; <span class="hljs-attr">--config</span> balance <span class="hljs-attr">--output_dir</span> output
</code></pre>
<p><strong>所以，如果你不是合作伙伴，没有 Project Aria 眼镜，那么你只能用它已有的数据集玩玩</strong>，从项目看，大概率这会是一个服务收费的项目。</p>
<p>那我们有没有机会自己玩一下呢？也是有的，ShapeR 特意提供了一个 <code>explore_data.ipynb</code> 来解释这个 pkl 的结构：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0f0024353d7447ca63afbb8c3be2d9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769493277&amp;x-signature=ZrDPeRznBJSsxNDyivrZWrLmQA0%3D" alt="" loading="lazy"/></p>
<p>只是自己做数据这个过程就相当麻烦了，你需要的路径就会复杂很多，并且也不确定是否可以走的通，我们需要使用 ARKit/ARCore 采集数据（录 RGB 帧 + 时间戳 + IMU + 相机内参，最好还有 VIO/轨迹），比如用 iPhone 的 Stray Scanner 数据采集的 App，它能记录 <strong>video + depth（ LiDAR）+ ARKit 的 VIO（里程计/位姿）</strong> 。</p>
<blockquote>
<p>当然，Stray Scanner 导出的数据格式不能直接支持 ShapeR 要求的输入格式（单一结构化 <code>.pkl</code>），所以需要转为它支持的格式，这个目前需要自己参考项目数据结构去变更，工作量巨大。</p>
</blockquote>
<p>另外，官方也提供了一个叫 <code>MapAnything </code>的“通用、前馈式 metric 3D 重建模型”，可以从输入图像（ShapeR 甚至可以从<strong>单目图像</strong>生成度量三维形状，而无需重新训练）直接回归<strong>带度量尺度的几何和相机信息</strong>，所以也可以作为 ShapeR “替代 MPS 的 metric points 生成器” 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfe2d68bed2c4401a2e758daeaca33c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769493277&amp;x-signature=Bw4EumOYd0pGci5bjt21MMvEPdQ%3D" alt="" loading="lazy"/></p>
<p>所以，一般来说，我们只能期待后续有更完善的转换工具，或者社区第三方的工具支持，这才是真的可以做到随手建模，甚至实时运算的效果，但是这个路线，不管对于智能眼镜，XR 场景还是机器人的导航能力，都是一个非常不错的尝试方向。</p>
<p>最后总结一下，<strong>ShapeR 的核心就是即使数据不全不干净，也可以脑补出完整模型，并且具备精准的尺寸和独立的模型与坐标</strong>。</p>
<p>ShapeR 不是为了替代 Gaussian Splatting 做场景漫游的，它的目标是：当你戴着 AR 眼镜（或拿着手机）扫过房间时，它能把你看到的每一个具体的物体（杯子、椅子、键盘）瞬间变成一个个独立的、有真实尺寸的、完整的 3D 模型，哪怕你只是匆匆扫了一眼。</p>
<p><strong>这就是为什么 Meta 如此重视它，因为这是大概率通往下一代空间计算理解物理世界的关键技术</strong>。</p>
<h2 data-id="heading-3">参考链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebookresearch%2FShapeR" target="_blank" title="https://github.com/facebookresearch/ShapeR" ref="nofollow noopener noreferrer">github.com/facebookres…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零实现企业级 UUID 生成器：兼容性、降级策略与 RFC 4122 标准实践]]></title>    <link>https://juejin.cn/post/7596342523968028681</link>    <guid>https://juejin.cn/post/7596342523968028681</guid>    <pubDate>2026-01-19T03:38:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596342523968028681" data-draft-id="7596698363933966386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零实现企业级 UUID 生成器：兼容性、降级策略与 RFC 4122 标准实践"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-19T03:38:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="细雨_吟啸且徐行"/> <meta itemprop="url" content="https://juejin.cn/user/3529879274664043"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零实现企业级 UUID 生成器：兼容性、降级策略与 RFC 4122 标准实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3529879274664043/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    细雨_吟啸且徐行
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T03:38:46.000Z" title="Mon Jan 19 2026 03:38:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从零实现生产级 UUID 生成器：兼容性、降级策略与 RFC 4122 标准实践</h2>
<blockquote>
<p>在现代前端开发中，UUID 生成看似简单，但要实现一个<strong>生产级、高兼容性、符合标准</strong>的 UUID 生成器却并不容易。本文将深入解析一个企业级 UUID 生成器的实现，探讨其三层降级策略、兼容性处理和 RFC 4122 标准实现。</p>
</blockquote>
<h3 data-id="heading-1">📋 目录</h3>
<ul>
<li><a href="#%E5%89%8D%E8%A8%80" title="#%E5%89%8D%E8%A8%80">前言：为什么需要自己实现 UUID 生成器？</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0" title="#%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0">核心实现：三层降级策略</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82" title="#%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82">技术细节深度解析</a></li>
<li><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7%E5%A4%84%E7%90%86" title="#%E5%85%BC%E5%AE%B9%E6%80%A7%E5%A4%84%E7%90%86">兼容性处理的艺术</a></li>
<li><a href="#rfc-4122-%E6%A0%87%E5%87%86" title="#rfc-4122-%E6%A0%87%E5%87%86">RFC 4122 v4 标准实现</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" title="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">性能优化与最佳实践</a></li>
<li><a href="#%E6%80%BB%E7%BB%93" title="#%E6%80%BB%E7%BB%93">总结与思考</a></li>
</ul>
<hr/>
<h3 data-id="heading-2">前言：为什么需要自己实现 UUID 生成器？</h3>
<p>在现代浏览器中，我们可以直接使用 <code>crypto.randomUUID()</code> 来生成 UUID。但现实情况是：</p>
<ul>
<li><strong>兼容性问题</strong>：<code>crypto.randomUUID()</code> 需要 Chrome 92+、Safari 15.4+，大量旧版浏览器不支持</li>
<li><strong>企业级需求</strong>：需要支持 IE11、旧版移动浏览器等场景</li>
<li><strong>标准合规</strong>：生成的 UUID 必须符合 RFC 4122 v4 标准</li>
<li><strong>可靠性要求</strong>：即使在高并发、异常环境下也要能正常工作</li>
</ul>
<p>因此，我们需要一个<strong>具备完善降级策略</strong>的 UUID 生成器。</p>
<hr/>
<h3 data-id="heading-3">核心实现：三层降级策略</h3>
<p>我们的 UUID 生成器采用了<strong>三层降级策略</strong>，确保在任何环境下都能正常工作：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> generateUUID = (<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 辅助函数：字节转十六进制（兼容 padStart）</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">hex</span>(<span class="hljs-params">buffer, start, end</span>) {
    <span class="hljs-keyword">let</span> str = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = start; i &lt; end; i++) {
      <span class="hljs-keyword">const</span> byte = buffer[i];
      <span class="hljs-keyword">const</span> hexStr = byte.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>);
      <span class="hljs-comment">// 兼容旧浏览器，不使用 padStart</span>
      str += hexStr.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> ? <span class="hljs-string">'0'</span> + hexStr : hexStr;
    }
    <span class="hljs-keyword">return</span> str;
  }

  <span class="hljs-comment">// 兜底方案：基于时间戳和随机数生成 UUID 格式字符串</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">fallbackUUID</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> random1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0x100000000</span>);
    <span class="hljs-keyword">const</span> random2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0x100000000</span>);
    <span class="hljs-keyword">const</span> random3 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0x100000000</span>);
    <span class="hljs-keyword">const</span> random4 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0x100000000</span>);
    
    <span class="hljs-comment">// 格式：xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx (总共36个字符)</span>
    <span class="hljs-comment">// 标准UUID格式：8-4-4-4-12</span>
    <span class="hljs-keyword">return</span> (
      (<span class="hljs-string">'00000000'</span> + (timestamp &amp; <span class="hljs-number">0xffffffff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">8</span>) +  <span class="hljs-comment">// 8字符</span>
      <span class="hljs-string">'-'</span> +
      (<span class="hljs-string">'0000'</span> + ((timestamp &gt;&gt; <span class="hljs-number">32</span>) &amp; <span class="hljs-number">0xffff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">4</span>) +  <span class="hljs-comment">// 4字符</span>
      <span class="hljs-string">'-4'</span> +
      (<span class="hljs-string">'000'</span> + (random1 &amp; <span class="hljs-number">0xfff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">3</span>) +              <span class="hljs-comment">// 3字符，加上'4'共4字符</span>
      <span class="hljs-string">'-'</span> +
      (<span class="hljs-string">'8'</span> + (random2 &amp; <span class="hljs-number">0x3fff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">4</span>) +                <span class="hljs-comment">// 4字符</span>
      <span class="hljs-string">'-'</span> +
      (<span class="hljs-string">'00000000'</span> + (random3 &amp; <span class="hljs-number">0xffffffff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">8</span>) +     <span class="hljs-comment">// 8字符</span>
      (<span class="hljs-string">'0000'</span> + (random4 &amp; <span class="hljs-number">0xffff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">4</span>)               <span class="hljs-comment">// 4字符，共12字符</span>
    );
  }

  <span class="hljs-comment">// 优先使用原生实现</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> crypto !== <span class="hljs-string">'undefined'</span> &amp;&amp; crypto.<span class="hljs-property">randomUUID</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">randomUUID</span>();
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// 如果 crypto.randomUUID 抛出异常，降级到备用方案</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">fallbackUUID</span>();
      }
    };
  }

  <span class="hljs-comment">// 降级方案：基于 RFC 4122 v4 的强化实现</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 初始化高质量随机数生成器</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">getRandomValues</span> = (<span class="hljs-params">buffer</span>) =&gt; {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> crypto !== <span class="hljs-string">'undefined'</span> &amp;&amp; crypto.<span class="hljs-property">getRandomValues</span>) {
            <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">getRandomValues</span>(buffer);
          }
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-comment">// crypto.getRandomValues 可能抛出异常，继续降级</span>
        }
        
        <span class="hljs-comment">// 终极降级：混合时间戳的 Math.random</span>
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
          <span class="hljs-comment">// 安全获取 performance.now()，如果不存在则使用 0</span>
          <span class="hljs-keyword">const</span> perfNow = (<span class="hljs-keyword">typeof</span> performance !== <span class="hljs-string">'undefined'</span> &amp;&amp; performance.<span class="hljs-property">now</span>) 
            ? performance.<span class="hljs-title function_">now</span>() 
            : <span class="hljs-number">0</span>;
          
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; buffer.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-comment">// 混合时间戳熵增强随机性</span>
            <span class="hljs-keyword">const</span> timeEntropy = (now + perfNow) % <span class="hljs-number">1e9</span> / <span class="hljs-number">1e9</span>;
            buffer[i] = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0x100000000</span> + timeEntropy) % <span class="hljs-number">256</span> | <span class="hljs-number">0</span>;
          }
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-comment">// 如果时间戳方法也失败，使用纯 Math.random</span>
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; buffer.<span class="hljs-property">length</span>; i++) {
            buffer[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">256</span>);
          }
        }
        <span class="hljs-keyword">return</span> buffer;
      };

      <span class="hljs-comment">// 检查 Uint8Array 支持</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Uint8Array</span> === <span class="hljs-string">'undefined'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">fallbackUUID</span>();
      }

      <span class="hljs-comment">// 生成 16 字节随机数据 (128位)</span>
      <span class="hljs-keyword">const</span> rnds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">16</span>);
      <span class="hljs-title function_">getRandomValues</span>(rnds);
      
      <span class="hljs-comment">// 应用 RFC 4122 v4 规则 (设置版本和变体)</span>
      rnds[<span class="hljs-number">6</span>] = (rnds[<span class="hljs-number">6</span>] &amp; <span class="hljs-number">0x0f</span>) | <span class="hljs-number">0x40</span>; <span class="hljs-comment">// 版本 4</span>
      rnds[<span class="hljs-number">8</span>] = (rnds[<span class="hljs-number">8</span>] &amp; <span class="hljs-number">0x3f</span>) | <span class="hljs-number">0x80</span>; <span class="hljs-comment">// 变体 10</span>

      <span class="hljs-comment">// 转换为 UUID 格式字符串</span>
      <span class="hljs-keyword">return</span> (
        <span class="hljs-title function_">hex</span>(rnds, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>) + <span class="hljs-string">'-'</span> +
        <span class="hljs-title function_">hex</span>(rnds, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>) + <span class="hljs-string">'-'</span> +
        <span class="hljs-title function_">hex</span>(rnds, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>) + <span class="hljs-string">'-'</span> +
        <span class="hljs-title function_">hex</span>(rnds, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>) + <span class="hljs-string">'-'</span> +
        <span class="hljs-title function_">hex</span>(rnds, <span class="hljs-number">10</span>, <span class="hljs-number">16</span>)
      );
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-comment">// 所有方法都失败时，返回兜底 UUID</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">fallbackUUID</span>();
    }
  };
})();
</code></pre>
<h4 data-id="heading-4">降级策略流程图</h4>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────┐
│   crypto<span class="hljs-selector-class">.randomUUID</span>()    │ ← 第一层：现代浏览器（Chrome <span class="hljs-number">92</span>+, Safari <span class="hljs-number">15.4</span>+）
└───────────┬─────────────┘
            │ 失败/不支持
            ▼
┌─────────────────────────┐
│ crypto<span class="hljs-selector-class">.getRandomValues</span>() │ ← 第二层：中等浏览器（IE11+, 大部分现代浏览器）
│   + RFC <span class="hljs-number">4122</span> v4 实现     │
└───────────┬─────────────┘
            │ 失败/不支持
            ▼
┌─────────────────────────┐
│ Math<span class="hljs-selector-class">.random</span>() + 时间戳   │ ← 第三层：兜底方案（任何环境都能工作）
│   + 性能增强             │
└─────────────────────────┘
</code></pre>
<hr/>
<h3 data-id="heading-5">技术细节深度解析</h3>
<h4 data-id="heading-6">1. IIFE 模式：运行时环境检测优化</h4>
<p>使用 <strong>IIFE（立即执行函数表达式）</strong> 模式，在模块加载时只检测一次运行环境，而不是每次调用都检测：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> generateUUID = (<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 这里的代码只在模块加载时执行一次</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> crypto !== <span class="hljs-string">'undefined'</span> &amp;&amp; crypto.<span class="hljs-property">randomUUID</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> crypto.<span class="hljs-title function_">randomUUID</span>(); <span class="hljs-comment">// 返回优化后的函数</span>
  }
  <span class="hljs-comment">// ...</span>
})();
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>✅ 避免重复的环境检测</li>
<li>✅ 运行时性能最优</li>
<li>✅ 代码更清晰</li>
</ul>
<h4 data-id="heading-7">2. 兼容性处理：手动实现十六进制转换</h4>
<p>现代浏览器可以使用 <code>padStart()</code> 来补零，但为了兼容旧浏览器，我们手动实现：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hex</span>(<span class="hljs-params">buffer, start, end</span>) {
  <span class="hljs-keyword">let</span> str = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = start; i &lt; end; i++) {
    <span class="hljs-keyword">const</span> byte = buffer[i];
    <span class="hljs-keyword">const</span> hexStr = byte.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>);
    <span class="hljs-comment">// 兼容旧浏览器，不使用 padStart</span>
    str += hexStr.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> ? <span class="hljs-string">'0'</span> + hexStr : hexStr;
  }
  <span class="hljs-keyword">return</span> str;
}
</code></pre>
<p><strong>为什么这样做？</strong></p>
<ul>
<li><code>padStart()</code> 需要 ES2017 支持（IE11 不支持）</li>
<li>手动实现兼容性更好，代码量也很少</li>
</ul>
<h4 data-id="heading-8">3. RFC 4122 v4 标准实现</h4>
<p>UUID v4 要求：</p>
<ul>
<li><strong>版本位</strong>：第 13 个字符必须是 <code>4</code></li>
<li><strong>变体位</strong>：第 17 个字符必须是 <code>8</code>、<code>9</code>、<code>a</code> 或 <code>b</code></li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 生成 16 字节随机数据 (128位)</span>
<span class="hljs-keyword">const</span> rnds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">16</span>);
<span class="hljs-title function_">getRandomValues</span>(rnds);

<span class="hljs-comment">// 应用 RFC 4122 v4 规则</span>
rnds[<span class="hljs-number">6</span>] = (rnds[<span class="hljs-number">6</span>] &amp; <span class="hljs-number">0x0f</span>) | <span class="hljs-number">0x40</span>; <span class="hljs-comment">// 版本 4：设置第 7 字节的高 4 位为 0100</span>
rnds[<span class="hljs-number">8</span>] = (rnds[<span class="hljs-number">8</span>] &amp; <span class="hljs-number">0x3f</span>) | <span class="hljs-number">0x80</span>; <span class="hljs-comment">// 变体 10：设置第 9 字节的高 2 位为 10</span>

<span class="hljs-comment">// 转换为 UUID 格式字符串：xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx</span>
<span class="hljs-keyword">return</span> (
  <span class="hljs-title function_">hex</span>(rnds, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>) + <span class="hljs-string">'-'</span> +   <span class="hljs-comment">// 8 字符</span>
  <span class="hljs-title function_">hex</span>(rnds, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>) + <span class="hljs-string">'-'</span> +   <span class="hljs-comment">// 4 字符</span>
  <span class="hljs-title function_">hex</span>(rnds, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>) + <span class="hljs-string">'-'</span> +   <span class="hljs-comment">// 4 字符（包含版本位 4）</span>
  <span class="hljs-title function_">hex</span>(rnds, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>) + <span class="hljs-string">'-'</span> +  <span class="hljs-comment">// 4 字符（包含变体位）</span>
  <span class="hljs-title function_">hex</span>(rnds, <span class="hljs-number">10</span>, <span class="hljs-number">16</span>)         <span class="hljs-comment">// 12 字符</span>
);
</code></pre>
<p><strong>位运算解析</strong>：</p>
<ul>
<li><code>rnds[6] &amp; 0x0f</code>：保留低 4 位</li>
<li><code>| 0x40</code>：设置高 4 位为 <code>0100</code>（版本 4）</li>
<li><code>rnds[8] &amp; 0x3f</code>：保留低 6 位</li>
<li><code>| 0x80</code>：设置高 2 位为 <code>10</code>（变体标识）</li>
</ul>
<hr/>
<h3 data-id="heading-9">兼容性处理的艺术</h3>
<h4 data-id="heading-10">1. 渐进式降级：从最佳到兜底</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getRandomValues</span> = (<span class="hljs-params">buffer</span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 优先：使用 Web Crypto API</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> crypto !== <span class="hljs-string">'undefined'</span> &amp;&amp; crypto.<span class="hljs-property">getRandomValues</span>) {
      <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">getRandomValues</span>(buffer);
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// crypto.getRandomValues 可能抛出异常，继续降级</span>
  }
  
  <span class="hljs-comment">// 降级：混合时间戳增强随机性</span>
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> perfNow = (<span class="hljs-keyword">typeof</span> performance !== <span class="hljs-string">'undefined'</span> &amp;&amp; performance.<span class="hljs-property">now</span>) 
      ? performance.<span class="hljs-title function_">now</span>() 
      : <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; buffer.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// 混合时间戳熵增强随机性</span>
      <span class="hljs-keyword">const</span> timeEntropy = (now + perfNow) % <span class="hljs-number">1e9</span> / <span class="hljs-number">1e9</span>;
      buffer[i] = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0x100000000</span> + timeEntropy) % <span class="hljs-number">256</span> | <span class="hljs-number">0</span>;
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// 终极降级：纯 Math.random</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; buffer.<span class="hljs-property">length</span>; i++) {
      buffer[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">256</span>);
    }
  }
  <span class="hljs-keyword">return</span> buffer;
};
</code></pre>
<h4 data-id="heading-11">2. 兜底方案：基于时间戳的 UUID</h4>
<p>当所有现代 API 都不可用时，使用时间戳 + 随机数生成 UUID 格式字符串：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fallbackUUID</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">const</span> random1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0x100000000</span>);
  <span class="hljs-keyword">const</span> random2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0x100000000</span>);
  <span class="hljs-keyword">const</span> random3 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0x100000000</span>);
  <span class="hljs-keyword">const</span> random4 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0x100000000</span>);
  
  <span class="hljs-comment">// 格式：xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx</span>
  <span class="hljs-keyword">return</span> (
    (<span class="hljs-string">'00000000'</span> + (timestamp &amp; <span class="hljs-number">0xffffffff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">8</span>) +
    <span class="hljs-string">'-'</span> +
    (<span class="hljs-string">'0000'</span> + ((timestamp &gt;&gt; <span class="hljs-number">32</span>) &amp; <span class="hljs-number">0xffff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">4</span>) +
    <span class="hljs-string">'-4'</span> + <span class="hljs-comment">// 版本位</span>
    (<span class="hljs-string">'000'</span> + (random1 &amp; <span class="hljs-number">0xfff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">3</span>) +
    <span class="hljs-string">'-'</span> +
    (<span class="hljs-string">'8'</span> + (random2 &amp; <span class="hljs-number">0x3fff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">4</span>) + <span class="hljs-comment">// 变体位</span>
    <span class="hljs-string">'-'</span> +
    (<span class="hljs-string">'00000000'</span> + (random3 &amp; <span class="hljs-number">0xffffffff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">8</span>) +
    (<span class="hljs-string">'0000'</span> + (random4 &amp; <span class="hljs-number">0xffff</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">4</span>)
  );
}
</code></pre>
<p><strong>注意</strong>：虽然这个方案在极端环境下也能工作，但随机性不如 <code>crypto.getRandomValues()</code>，不建议在生产环境长期使用。</p>
<hr/>
<h3 data-id="heading-12">RFC 4122 v4 标准实现</h3>
<h4 data-id="heading-13">UUID 格式说明</h4>
<p>标准 UUID v4 格式：<code>xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx</code></p>
<ul>
<li><strong>x</strong>：十六进制数字（0-9, a-f）</li>
<li><strong>4</strong>：版本号（固定）</li>
<li><strong>y</strong>：变体标识（8, 9, a, b 之一）</li>
</ul>
<h4 data-id="heading-14">版本位和变体位的设置</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 字节数组索引对应关系：</span>
<span class="hljs-comment">// [0-3]   [4-5]   [6-7]   [8-9]   [10-15]</span>
<span class="hljs-comment">//  8位     4位     4位     4位      12位</span>

rnds[<span class="hljs-number">6</span>] = (rnds[<span class="hljs-number">6</span>] &amp; <span class="hljs-number">0x0f</span>) | <span class="hljs-number">0x40</span>; 
<span class="hljs-comment">// 第 7 字节：保留低 4 位，设置高 4 位为 0100（版本 4）</span>

rnds[<span class="hljs-number">8</span>] = (rnds[<span class="hljs-number">8</span>] &amp; <span class="hljs-number">0x3f</span>) | <span class="hljs-number">0x80</span>; 
<span class="hljs-comment">// 第 9 字节：保留低 6 位，设置高 2 位为 10（变体标识）</span>
</code></pre>
<p><strong>为什么是 <code>0x40</code> 和 <code>0x80</code>？</strong></p>
<ul>
<li><code>0x40</code> = <code>0100 0000</code>（二进制），设置版本位为 4</li>
<li><code>0x80</code> = <code>1000 0000</code>（二进制），设置变体位为 10</li>
</ul>
<hr/>
<h3 data-id="heading-15">性能优化与最佳实践</h3>
<h4 data-id="heading-16">1. 避免重复检测</h4>
<p>使用 IIFE 模式，在模块加载时检测一次环境，运行时直接调用优化后的函数：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 不好的做法：每次调用都检测</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateUUID</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (crypto.<span class="hljs-property">randomUUID</span>) {
    <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">randomUUID</span>();
  }
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// ✅ 好的做法：只检测一次</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> generateUUID = (<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (crypto.<span class="hljs-property">randomUUID</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> crypto.<span class="hljs-title function_">randomUUID</span>(); <span class="hljs-comment">// 返回优化后的函数</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">/* 降级实现 */</span> };
})();
</code></pre>
<h4 data-id="heading-17">2. 错误处理策略</h4>
<p>多层 try-catch 确保即使某个 API 抛出异常，也能降级到下一层：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">randomUUID</span>();
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fallbackUUID</span>(); <span class="hljs-comment">// 降级</span>
}
</code></pre>
<h4 data-id="heading-18">3. 类型检查优化</h4>
<p>使用 <code>typeof</code> 检查而不是直接访问，避免在旧环境中抛出 <code>ReferenceError</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 安全的方式</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> crypto !== <span class="hljs-string">'undefined'</span> &amp;&amp; crypto.<span class="hljs-property">randomUUID</span>) {
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// ❌ 不安全的方式（旧浏览器可能报错）</span>
<span class="hljs-keyword">if</span> (crypto.<span class="hljs-property">randomUUID</span>) {
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-19">总结与思考</h3>
<h4 data-id="heading-20">核心亮点</h4>
<ol>
<li><strong>三层降级策略</strong>：从现代 API 到兜底方案，确保任何环境都能工作</li>
<li><strong>标准合规</strong>：完全符合 RFC 4122 v4 标准</li>
<li><strong>兼容性优先</strong>：不使用现代 API（如 <code>padStart</code>），手动实现兼容性更好的版本</li>
<li><strong>性能优化</strong>：使用 IIFE 模式，避免重复检测</li>
<li><strong>错误处理</strong>：完善的异常捕获机制</li>
</ol>
<h4 data-id="heading-21">适用场景</h4>
<ul>
<li>✅ 需要支持旧版浏览器的企业级项目</li>
<li>✅ 对 UUID 标准有严格要求的生产环境</li>
<li>✅ 需要高可靠性的分布式系统</li>
<li>✅ 前端 SDK 或工具库开发</li>
</ul>
<h4 data-id="heading-22">进一步优化建议</h4>
<ol>
<li><strong>添加单元测试</strong>：确保各种环境下的正确性</li>
<li><strong>性能基准测试</strong>：对比不同实现的性能</li>
<li><strong>添加 TypeScript 类型定义</strong>：提升开发体验</li>
<li><strong>考虑使用 Web Workers</strong>：在高频调用场景下避免阻塞主线程</li>
</ol>
<h4 data-id="heading-23">写在最后</h4>
<p>实现一个<strong>看似简单</strong>的功能，往往需要考虑到：</p>
<ul>
<li>🔍 <strong>兼容性</strong>：支持各种浏览器环境</li>
<li>🛡️ <strong>可靠性</strong>：完善的错误处理和降级策略</li>
<li>📏 <strong>标准性</strong>：符合行业标准规范</li>
<li>⚡ <strong>性能</strong>：避免不必要的开销</li>
</ul>
<p>这就是<strong>工程化思维</strong>的体现：不仅要实现功能，更要实现<strong>高质量、可维护、可扩展</strong>的代码。</p>
<hr/>
<h3 data-id="heading-24">参考资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc4122" target="_blank" title="https://tools.ietf.org/html/rfc4122" ref="nofollow noopener noreferrer">RFC 4122 - UUID 标准规范</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FCrypto%2FrandomUUID" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/Crypto/randomUUID" ref="nofollow noopener noreferrer">MDN - crypto.randomUUID()</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FCrypto%2FgetRandomValues" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/Crypto/getRandomValues" ref="nofollow noopener noreferrer">MDN - crypto.getRandomValues()</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcaniuse.com%2Fmdn-api_crypto_randomuuid" target="_blank" title="https://caniuse.com/mdn-api_crypto_randomuuid" ref="nofollow noopener noreferrer">Can I Use - crypto.randomUUID</a></li>
</ul>
<hr/>
<p><strong>如果这篇文章对你有帮助，欢迎点赞、收藏、转发！</strong> 🚀</p>
<p><strong>关注我，获取更多前端技术深度解析！</strong> 💡</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[图文]手把手教你Antigravity反代，全程不用敲代码，小白也能看懂的保姆教程]]></title>    <link>https://juejin.cn/post/7596768867231760403</link>    <guid>https://juejin.cn/post/7596768867231760403</guid>    <pubDate>2026-01-19T05:43:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596768867231760403" data-draft-id="7596768867231727635" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[图文]手把手教你Antigravity反代，全程不用敲代码，小白也能看懂的保姆教程"/> <meta itemprop="keywords" content="程序员,人工智能"/> <meta itemprop="datePublished" content="2026-01-19T05:43:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="洪哥等风来"/> <meta itemprop="url" content="https://juejin.cn/user/3562073402390749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [图文]手把手教你Antigravity反代，全程不用敲代码，小白也能看懂的保姆教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3562073402390749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    洪哥等风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T05:43:41.000Z" title="Mon Jan 19 2026 05:43:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>视频版配套教程可以跳转：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1vvitBfEKv" target="_blank" title="https://www.bilibili.com/video/BV1vvitBfEKv" ref="nofollow noopener noreferrer">《手把手教你Antigravity反代，全程不用敲代码，小白也能看懂的保姆教程》</a></p>
<h2 data-id="heading-0">一、安装/升级 反代工具CLIProxyAPI</h2>
<h4 data-id="heading-1">Windows</h4>
<p>直接下载最新的文件，解压后就能使用，如果有更新，也是从这个链接中查找就行。</p>
<p>比如写文章时的最新版为：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frouter-for-me%2FCLIProxyAPI%2Freleases%2Fdownload%2Fv6.6.84%2FCLIProxyAPI_6.6.84_windows_amd64.zip" target="_blank" title="https://github.com/router-for-me/CLIProxyAPI/releases/download/v6.6.84/CLIProxyAPI_6.6.84_windows_amd64.zip" ref="nofollow noopener noreferrer">CLIProxyAPI_6.6.84_windows_amd64.zip</a></p>
<pre><code class="hljs language-bash" lang="bash">https://github.com/router-for-me/CLIProxyAPI/releases
</code></pre>
<p>本教程中我解压到了<code>D:\Tools\CLIProxyAPI_6.6.84_windows_amd64</code> 目录下，你可以解压到自己需要的目录，路径要全英文的，并且不能有空格。</p>
<h4 data-id="heading-2">Ubuntu/Linux</h4>
<p>使用一键脚本安装或升级，都用这个命令就行</p>
<pre><code class="hljs language-ruby" lang="ruby">curl -fsSL <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/raw.githubusercontent.com/brokechubb</span><span class="hljs-regexp">/cliproxyapi-installer/refs</span><span class="hljs-regexp">/heads/master</span><span class="hljs-regexp">/cliproxyapi-installer | bash
</span></code></pre>
<h4 data-id="heading-3">MacOS</h4>
<p>使用brew安装命令</p>
<pre><code class="hljs">brew install cliproxyapi
</code></pre>
<p>后续升级命令</p>
<pre><code class="hljs">brew upgrade cliproxyapi
</code></pre>
<h2 data-id="heading-4">二、修改配置文件，启用后台管理</h2>
<h4 data-id="heading-5">Windows</h4>
<p>安装目录下把<code>config.example.yaml</code>复制一份，复制的改名为<code>config.yaml</code>，然后修改里面的内容。</p>
<h4 data-id="heading-6">Ubuntu/Linux</h4>
<p>家(Home)目录下找<code>cliproxyapi/config.yaml</code>，即<code>~/cliproxyapi/config.yaml</code>，然后修改里面的内容。</p>
<h4 data-id="heading-7">MacOS</h4>
<p><code>/opt/homebrew/etc</code>目录下找<code>cliproxyapi.conf</code>，即绝对路径为：<code>/opt/homebrew/etc/cliproxyapi.conf</code>，然后修改里面的内容。</p>
<h4 data-id="heading-8">修改文件如下内容(登录密码最好改成你自己的，我这里设置的是my-password)</h4>
<pre><code class="hljs language-vbnet" lang="vbnet">allow-remote: <span class="hljs-literal">true</span>
secret-<span class="hljs-keyword">key</span>: <span class="hljs-string">"my-password"</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/171f47b3de934915afe0f80d0ea5c1af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769406221&amp;x-signature=DGOsCTQfNAuK1We7%2FphReonJsdk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-9">三、 启动CLIProxyAPI， 并登录网页后台查看：</h2>
<h4 data-id="heading-10">Windows</h4>
<p>进入到刚才解压后的目录下直接exe执行就可以了，比如我刚才安装到了<code>D:\Tools\CLIProxyAPI_6.6.84_windows_amd64</code> 下。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6352f72f4d794adf8a72680cd87f254a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769406221&amp;x-signature=PhJUBfn%2B%2FAaNS2e0%2FFQzNp0QxKc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-11">Ubuntu/Linux</h4>
<p>进入到<code>~/cliproxyapi/</code>目录后，启动。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ~/cliproxyapi/
./cli-proxy-api 
</code></pre>
<h4 data-id="heading-12">MacOS</h4>
<p>不需要进入任何目录，直接启动即可。</p>
<pre><code class="hljs">brew services restart cliproxyapi
</code></pre>
<h4 data-id="heading-13">登录网页后台</h4>
<p>注意地址，本机的直接访问右边这个地址就行，首次登录密码是刚才设置的 my-password ：<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8317%2Fmanagement.html" target="_blank" title="http://localhost:8317/management.html" ref="nofollow noopener noreferrer">http://localhost:8317/management.html</a>
服务器的话要填服务器的地址或域名，比如你部署到了服务器的ip是<code>1.2.3.4</code>，则访问：<code>http://1.2.3.4:8317/management.html</code>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2368c977d9ec48cfad976acb8ac36745~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769406221&amp;x-signature=YMFqu1rwLrS%2BjFv%2BhjXItqrKCvo%3D" alt="在这里插入图片描述" loading="lazy"/>
登录后台成功后，可以看到仪表盘。建议把使用统计打开，这样后面用模型我能能看到用了多少的Tokens。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cbbd7aa6769415786f449309109f0fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769406221&amp;x-signature=HXFvhPNOaQ6Dco4zeUpaeg9W%2BDQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-14">四、从网页登录Antigravity，成功后拷贝网址:</h2>
<p>按照图示登录Antigravity，并等待自动认证成功，认证成功后登录网页会自动关闭。
如果登录界面没有自动关闭(如图)，需要你手动把登录成功的网址复制粘贴回来，然后手动点击<code>提交回调URL</code>。
如果还登录不上，可以尝试重启机器，然后别的软件先别开，这时打开反代服务 + 开启TUN魔法 + 挂到美国IP，再登录下试试。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a17cb14eb97a43f5934f29b6b5bbfeee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769406221&amp;x-signature=uBv7cl1CLA6jzehTJES5SuOS2qY%3D" alt="在这里插入图片描述" loading="lazy"/>
你还可以登录Gemini CLI ，这样就有更多的Gemini额度了。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c214da7e5757472fac911141e01037d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769406221&amp;x-signature=zVra4LgibS%2FCj66JF69fQL10Qm4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>登录认证成功后，后台就能看到认证信息了。我这里即反代了Antigravity，也反代了Gemini CLI, 如图：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74532cfa2b6944ef97e05a2c48537d0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769406221&amp;x-signature=OBPVBkXlbW%2BjKx0bl8%2Fmf6Lm9WY%3D" alt="在这里插入图片描述" loading="lazy"/>
反代出来的模型，可以在<code>中心信息</code>中查看到。后面使用模型时，需要来这里复制模型名，不能随便写模型名。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/000fe28e26a942408f0a328fdee3978b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769406221&amp;x-signature=Uo%2Fq60k10bt2KrzpV35Z9PfPR4A%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-15">五、Claude Code中使用</h2>
<h4 data-id="heading-16">从网页后台获取api key，配置claude</h4>
<p>注意<code>your-api-key-1</code>要配置成网页后台中的真正的api key，我这里演示的是默认的。
模型的名称也要从网页后台拷贝，不要自己手写。
base url 填写为 <code>"http://localhost:8317"</code>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90e6d33b083946459e7c6f517664bce7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSq5ZOl562J6aOO5p2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769406221&amp;x-signature=KWK2W1L0l%2BH3QG8beNCAY%2FmuiOo%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json">
<span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"ANTHROPIC_BASE_URL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:8317"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ANTHROPIC_AUTH_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-api-key-1"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ANTHROPIC_DEFAULT_OPUS_MODEL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-claude-opus-4-5-thinking"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ANTHROPIC_DEFAULT_SONNET_MODEL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-claude-sonnet-4-5-thinking"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ANTHROPIC_DEFAULT_HAIKU_MODEL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-claude-sonnet-4-5"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ANTHROPIC_MODEL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-claude-opus-4-5-thinking"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ANTHROPIC_SMALL_FAST_MODEL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-claude-sonnet-4-5-thinking"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<h2 data-id="heading-17">六、其它OpenAI兼容接口中使用</h2>
<p>注意！base url 要改为： <code>http://localhost:8317/v1</code>
api key 和模型名和刚才一样，从网页后台复制就行了。
vscode中可以通过<code>oai</code>插件(<code>OAI Compatible Provider for Copilot</code>)来添加到copilot中。</p>
<h2 data-id="heading-18">Q&amp;A</h2>
<h3 data-id="heading-19">Q1：有没有被封号的风险？</h3>
<p>我在各个社区中还没看到有被封的(仅针对个人用户)。不过仍不建议用自己的大号搞，因为确实逆向了有风险，建议用小号搞吧。</p>
<h3 data-id="heading-20">Q2：需要Google AI会员吗?</h3>
<p>免费版的每周都有额度，但是额度很少，可以先试一下，把流程跑通了。付费会员或教育优惠会员，都是每5小时刷新额度，自己用一般是足够的，并且Gemin Pro\Gemini Flash\Claude这三组额度是独立的。
然后可以考虑某鱼上买个成品号，关键字:<code>geminipro一年</code>，20左右(不知道最近涨价没)。</p>
<h3 data-id="heading-21">Q3：我高强度使用，5小时额度不够怎么办啊？</h3>
<p>最快速的是把谷歌的Gemini CLI工具也反代了，这个工具中只有Gemini系列的模型，并且额度和Antigravity中的不互通，是独立的。</p>
<p>其次有个被社区称为<code>升天</code>的方法：其实就是家庭组，Pro账号可以邀请最多5个人进入家庭(算上自己共6人)。家庭里每个账号的Antigravity和Gemini CLI的额度是独立的，所以可以创建几个小号，来组建家庭后把小号也反代了。</p>
<p>最后，还是那句话，不建议用自己的主号这么搞，最好拿某鱼买的号来搞。</p>
<h3 data-id="heading-22">Q4：API KEY(API 密钥)是怎么生成的，从哪里拿？</h3>
<p>API KEY在我们安装时，配置文件中会默认携带2个，你可以从网页上直接编辑-复制后使用。也可以在网页上把这两个KEY修改掉，或者自己新建后使用。</p>
<h3 data-id="heading-23">Q5：OAI插件是什么？</h3>
<p>OAI插件是搭配vscode copilot使用的，因为官方的copilot不支持自定义的模型和地址，所以需要这个插件来实现。</p>
<h3 data-id="heading-24">Q6：OAI安装后没有右下角的 Ready显示怎么办？</h3>
<p>首次安装后可以按 <code>Ctrl</code> + <code>Shift</code> + <code>P</code>，然后输入<code>oai</code>关键字，点击<code>Open Configuration UI</code>进入。</p>
<h3 data-id="heading-25">Q7：OAI配置好了地址和模型，从copilot中访问失败怎么办？</h3>
<p>大概率是地址配置错误，记得OpenAI格式的请求都需要加上<code>/v1</code>后缀，比如<code>http://10.126.12.162:8317/v1</code>。</p>
<h3 data-id="heading-26">Q8: Windows上第二天就不能用了，访问不到模型了？</h3>
<p>可能是关机了，或CLIProxyAPI被关掉了，然后反代的登录信息就失效了，下次开机或启动后，还需要重新登陆以下。
如果是在服务器上部署的，并且一直执行，是不会失效的，因为CLIProxyAPI会周期性的去刷新下登录信息，保持一直登陆的状态。</p>
<h3 data-id="heading-27">Q9: 能用Nano Banana Pro画图吗？</h3>
<p>可以的，接入自己的画图工具就行了。有限额，但具体多少我不太清楚了。
比如群友有使用CherryStudio的：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cherry-ai.com%2Fdownload" target="_blank" title="https://www.cherry-ai.com/download" ref="nofollow noopener noreferrer">www.cherry-ai.com/download</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Huobao Drama 开源短剧生成平台：从剧本到视频]]></title>    <link>https://juejin.cn/post/7596790037097201727</link>    <guid>https://juejin.cn/post/7596790037097201727</guid>    <pubDate>2026-01-19T03:32:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596790037097201727" data-draft-id="7596639774266834986" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Huobao Drama 开源短剧生成平台：从剧本到视频"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-19T03:32:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ahubbub"/> <meta itemprop="url" content="https://juejin.cn/user/2999123451061160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Huobao Drama 开源短剧生成平台：从剧本到视频
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2999123451061160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ahubbub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T03:32:03.000Z" title="Mon Jan 19 2026 03:32:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Huobao Drama 开源短剧生成平台：从剧本到视频</h2>
<h2 data-id="heading-1">Huobao Drama</h2>
<p>一句话简介：一个基于 Go + Vue3 的全栈 AI 短剧自动化生产平台，覆盖“剧本解析 → 角色/分镜生成 → 视频合成”的一站式流程。</p>
<p>适用场景（可选）：</p>
<ul>
<li>想快速验证“短剧生成工作流”的产品/技术原型（偏全链路演示）</li>
<li>需要一个可自建的 AI 素材/分镜/视频任务管理后台（本地存储 + SQLite）</li>
<li>自己有模型/聚合 API（OpenAI 兼容/火山/本地 Ollama 等），希望接到可用的 Web 界面里跑通</li>
</ul>
<h2 data-id="heading-2">二、开源协议</h2>
<ul>
<li>CC BY-NC-SA 4.0（署名-非商业性使用-相同方式共享），以仓库 <code>LICENSE</code> 为准</li>
<li>备注：该协议限制商业用途；如需商业使用，README/许可证中给了作者联系方式（以仓库信息为准）</li>
</ul>
<h2 data-id="heading-3">三、界面展示</h2>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img4@main/2026/01/19/1768792890091-d6d4508e-d9cc-456c-88ff-87c5792660c3.png" alt="主界面" loading="lazy"/></p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img2@main/2026/01/19/1768792987694-530000b6-2996-4819-a4f4-990f9a8b0b27.png" alt="项目界面" loading="lazy"/></p>
<h2 data-id="heading-4">四、功能概述</h2>
<h3 data-id="heading-5">1）角色管理</h3>
<ul>
<li>是什么：对短剧角色形象进行生成与管理</li>
<li>怎么做：
<ul>
<li>支持 AI 生成角色形象</li>
<li>支持批量生成</li>
<li>支持角色图片上传与管理</li>
</ul>
</li>
<li>注意事项（可选）：
<ul>
<li>图片生成依赖外部 AI 服务（默认 Provider 在配置中可选，但具体 Key 一般在 Web 界面配置；以仓库文档为准）</li>
<li>生成图片的存储默认走本地存储目录（见 <code>configs/config.yaml</code> 的 <code>storage</code>）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">2）分镜制作（脚本/镜头/图片）</h3>
<ul>
<li>是什么：从剧本/描述拆解出分镜，并为分镜生成图片</li>
<li>怎么做：
<ul>
<li>自动生成分镜脚本</li>
<li>场景描述与镜头设计</li>
<li>分镜图片生成（文生图）</li>
<li>帧类型选择：首帧/关键帧/尾帧/分镜板</li>
</ul>
</li>
<li>注意事项（可选）：
<ul>
<li>仍然依赖外部文生图服务；如果你用的是本地模型，需确认接口是否 OpenAI 兼容，并保证容器/宿主机网络可达（见 <code>DOCKER_HOST_ACCESS.md</code>）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">3）视频生成（图生视频 + 合成剪辑）</h3>
<ul>
<li>是什么：把分镜图转成分镜视频，并进行合成/转场</li>
<li>怎么做：
<ul>
<li>图生视频自动生成</li>
<li>视频合成与剪辑</li>
<li>转场效果</li>
</ul>
</li>
<li>外部依赖必须说明：
<ul>
<li>FFmpeg：项目明确要求 <code>FFmpeg 4.0+</code>，用于视频处理（本地跑需要自己安装；Docker 镜像里已安装 <code>ffmpeg</code>，见 <code>Dockerfile</code>）</li>
<li>视频生成模型/服务：配置中的 <code>ai.default_video_provider</code> 默认为 <code>doubao</code>（火山相关能力），具体调用方式与 Key 配置以仓库实现/界面为准</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">4）资源管理与任务追踪</h3>
<ul>
<li>是什么：统一管理生成的素材，并跟踪任务进度</li>
<li>怎么做：
<ul>
<li>素材库统一管理</li>
<li>本地存储支持</li>
<li>资源导入导出</li>
<li>任务进度追踪</li>
</ul>
</li>
<li>注意事项（可选）：
<ul>
<li>数据库存储默认使用 SQLite（见 <code>configs/config.example.yaml</code>）</li>
<li>静态资源访问基于 <code>storage.base_url</code> 拼接（默认 <code>http://localhost:5678/static</code>），反代/换域名时要一起调整</li>
</ul>
</li>
</ul>
<h2 data-id="heading-9">五、技术选型</h2>
<ul>
<li>后端：<code>Go 1.23+ · Gin · GORM · SQLite(含 modernc.org/sqlite) · Zap · Viper</code></li>
<li>前端：<code>Vue 3.4+ · TypeScript · Vite 5 · Element Plus · TailwindCSS · Pinia · Vue Router · vue-i18n · Axios</code></li>
<li>数据：<code>SQLite</code>（默认），配置里也出现 <code>gorm.io/driver/mysql</code> 依赖（是否启用 MySQL 以代码/文档为准）</li>
<li>可观测/日志：<code>Zap</code>（仓库依赖显示）</li>
<li>容器化：<code>Docker 多阶段构建（Node 20 + Go 1.23-alpine + alpine runtime） · docker-compose</code></li>
<li>媒体处理：<code>FFmpeg</code>（必需）</li>
</ul>
<h2 data-id="heading-10">六、如何使用</h2>
<blockquote>
<p>运行前准备（所有方式通用）</p>
</blockquote>
<ul>
<li>如果你本机手动运行（非 Docker）：先安装 <code>ffmpeg</code>，并确保 <code>ffmpeg -version</code> 可用</li>
<li>AI 能力需要配置供应商与 Key：配置文件里仅指定默认 provider，具体 API Key 通常在 Web 界面里配置（以实际界面/仓库文档为准）</li>
<li>默认端口：
<ul>
<li>后端/API：<code>5678</code></li>
<li>前端开发服务器：<code>3012</code>（仅开发模式，见 <code>web/vite.config.ts</code>）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11">方式一：Docker</h3>
<p>仓库 README 给了两种 Docker 跑法：Docker Hub 直接跑，或本地构建后跑。这里按 README 原样整理可复制命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 直接运行（Docker Hub）</span>
docker run -d \
  --name huobao-drama \
  -p 5678:5678 \
  -v $(<span class="hljs-built_in">pwd</span>)/data:/app/data \
  --restart unless-stopped \
  huobao/huobao-drama:latest
</code></pre>
<ul>
<li>数据目录与挂载路径：
<ul>
<li>宿主机：<code>$(pwd)/data</code></li>
<li>容器内：<code>/app/data</code>（SQLite DB + storage 都在这下面，具体以运行后生成内容为准）</li>
</ul>
</li>
<li>访问：
<ul>
<li><code>http://localhost:5678</code></li>
</ul>
</li>
<li>重要说明（Linux）：
<ul>
<li>如果容器内要访问宿主机的 Ollama/本地模型，需加：<code>--add-host=host.docker.internal:host-gateway</code>（详见 <code>DOCKER_HOST_ACCESS.md</code>）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-12">方式二：Docker Compose（推荐）</h3>
<p>项目自带 <code>docker-compose.yml</code>（包含 healthcheck、命名卷、extra_hosts），最省事：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动</span>
docker-compose up -d

<span class="hljs-comment"># 看日志</span>
docker-compose logs -f

<span class="hljs-comment"># 停止</span>
docker-compose down
</code></pre>
<ul>
<li>默认端口：<code>5678:5678</code></li>
<li>数据持久化：使用命名卷 <code>huobao-data:/app/data</code>（见 <code>docker-compose.yml</code>）</li>
<li>自定义配置文件：
<ul>
<li>compose 里预留了挂载（默认注释掉）：<code>./configs/config.yaml:/app/configs/config.yaml:ro</code></li>
<li>你需要先准备 <code>configs/config.yaml</code>（可从示例复制）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">方式三：手动构建（前端/后端）</h3>
<h4 data-id="heading-14">1）拉代码 + 准备配置</h4>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/chatfire-AI/huobao-drama.git
<span class="hljs-built_in">cd</span> huobao-drama

<span class="hljs-built_in">cp</span> configs/config.example.yaml configs/config.yaml
</code></pre>
<p><code>configs/config.yaml</code> 关键项（示例来自仓库，敏感信息不在这里）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">5678</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">"0.0.0.0"</span>
  <span class="hljs-attr">cors_origins:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">"http://localhost:3012"</span>

<span class="hljs-attr">database:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">"sqlite"</span>
  <span class="hljs-attr">path:</span> <span class="hljs-string">"./data/drama_generator.db"</span>

<span class="hljs-attr">storage:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">"local"</span>
  <span class="hljs-attr">local_path:</span> <span class="hljs-string">"./data/storage"</span>
  <span class="hljs-attr">base_url:</span> <span class="hljs-string">"http://localhost:5678/static"</span>

<span class="hljs-attr">ai:</span>
  <span class="hljs-attr">default_text_provider:</span> <span class="hljs-string">"openai"</span>
  <span class="hljs-attr">default_image_provider:</span> <span class="hljs-string">"openai"</span>
  <span class="hljs-attr">default_video_provider:</span> <span class="hljs-string">"doubao"</span>
</code></pre>
<h4 data-id="heading-15">2）开发模式（前后端分离，热更新）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 终端 1：后端</span>
go mod download
go run main.go
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 终端 2：前端</span>
<span class="hljs-built_in">cd</span> web
npm install
npm run dev
</code></pre>
<ul>
<li>前端：<code>http://localhost:3012</code></li>
<li>后端：<code>http://localhost:5678</code></li>
<li>代理规则：前端会把 <code>/api</code> 转发到 <code>http://localhost:5678</code>（见 <code>web/vite.config.ts</code>）</li>
</ul>
<h4 data-id="heading-16">3）单服务模式（后端同时提供前端静态文件）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> web
npm install
npm run build
<span class="hljs-built_in">cd</span> ..

go run main.go
</code></pre>
<ul>
<li>访问：<code>http://localhost:5678</code></li>
</ul>
<h2 data-id="heading-17">七、二次开发注意事项</h2>
<ul>
<li>环境依赖版本（从仓库文件推断）：
<ul>
<li>Go：<code>1.23+</code>（见 <code>go.mod</code>）</li>
<li>Node.js：README 写 <code>18+</code>；<code>Dockerfile</code> 使用 <code>node:20-alpine</code>（本地用 18/20 通常都可，最终以你依赖安装结果为准）</li>
<li>FFmpeg：<code>4.0+</code>（必需）</li>
</ul>
</li>
<li>本地开发启动方式：
<ul>
<li>后端：<code>go run main.go</code></li>
<li>前端：<code>npm run dev</code>（默认 <code>3012</code>），并代理 <code>/api -&gt; 5678</code></li>
</ul>
</li>
<li>常见问题
<ul>
<li>SQLite 只读/写权限：生产机用 systemd 部署时，确保运行用户对 <code>data/</code> 目录与 DB 文件都有写权限；否则可能出现 <code>attempt to write a readonly database</code>（README 给了排查与修复命令）</li>
<li>Docker 访问宿主机模型：统一用 <code>http://host.docker.internal:&lt;port&gt;/v1</code>，Linux 下需要 <code>host-gateway</code> 映射（见 <code>DOCKER_HOST_ACCESS.md</code> 与 <code>docker-compose.yml</code> 的 <code>extra_hosts</code>）</li>
<li>跨域/前端连不上后端：检查 <code>configs/config.yaml</code> 的 <code>server.cors_origins</code> 是否包含你的前端地址；开发模式代理在 <code>web/vite.config.ts</code></li>
</ul>
</li>
</ul>
<h2 data-id="heading-18">八、目录结构与主要文件</h2>
<pre><code class="hljs language-text" lang="text">huobao-drama/
├── main.go                    # 后端入口
├── go.mod                     # Go 依赖与版本（Go 1.23）
├── Dockerfile                 # 多阶段构建（前端 build + 后端 build + runtime 含 ffmpeg）
├── docker-compose.yml         # Compose 一键启动（含 healthcheck/volume/extra_hosts）
├── configs/
│   └── config.example.yaml    # 配置示例（复制为 config.yaml 使用）
├── api/                       # API 层（Gin HTTP，按 README 的分层说明）
├── application/               # 应用服务层（业务编排）
├── domain/                    # 领域层（模型/领域逻辑）
├── infrastructure/            # 基础设施层（DB/外部服务等）
├── migrations/                # 迁移相关（README 说明首次启动会自动建表）
├── pkg/                       # 通用包/工具代码
└── web/                       # 前端（Vue3 + Vite）
    ├── package.json           # 前端依赖与脚本
    └── vite.config.ts         # dev server(3012) + /api 代理到 5678
</code></pre>
<h2 data-id="heading-19">九、源码地址</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchatfire-AI%2Fhuobao-drama" target="_blank" title="https://github.com/chatfire-AI/huobao-drama" ref="nofollow noopener noreferrer">github.com/chatfire-AI…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 又迎大坑修改？iOS 26 键盘变化可能带来大量底层改动]]></title>    <link>https://juejin.cn/post/7596245612558319625</link>    <guid>https://juejin.cn/post/7596245612558319625</guid>    <pubDate>2026-01-18T23:21:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596245612558319625" data-draft-id="7596181746083217458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 又迎大坑修改？iOS 26 键盘变化可能带来大量底层改动"/> <meta itemprop="keywords" content="Flutter,Android,前端"/> <meta itemprop="datePublished" content="2026-01-18T23:21:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 又迎大坑修改？iOS 26 键盘变化可能带来大量底层改动
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T23:21:16.000Z" title="Sun Jan 18 2026 23:21:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>又是一个小问题可能带来的大改动，感觉官方在评估的时候，有点过分细节了。</p>
<p>这个问题来自去年底的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F179482" target="_blank" title="https://github.com/flutter/flutter/issues/179482" ref="nofollow noopener noreferrer">#179482</a> issue ，Flutter 在 iOS 26 上，某些场景会因为出现半透明键盘，而页面底下本来应该被键盘遮挡的 Widget，由于默认没有被绘制，从而出现键盘背景颜色 UI 异常：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/960cf9e2a42f407dac6a4eb5aafe6af4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=tRkOay%2Fo%2BALX8RVRE3sgp2I%2F%2FXM%3D" alt="" loading="lazy"/></p>
<p>虽然问题看起来是一个圆角问题，但是实际上这是 <strong>iOS 26 系统键盘增加了“半透明”后带来的问题，Flutter 在键盘后面那一层在某些场景下没有正确渲染内容</strong>，导致键盘半透明区域透出来的不是底下 BottomSheet 的真实内容，而是一整块黑色区域。</p>
<blockquote>
<p>issue 提到问题，问题最明显的场景主要出现在 iOS 26 的 <code>showModalBottomSheet()</code> 下。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69a144886c414be3b6e47305a8eb2acd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=D13kmUfKTbIaHLDDcKlqxIe5nXY%3D" alt="" loading="lazy"/></p>
<p>为什么会这样？首先就是你的 App 目前是否使用了最新 Xcode 26 ，以及在 <code>Info.plist</code> 里有没有使用 <code>UIDesignRequiresCompatibility = YES</code> 让 App <strong>继续使用旧的系统设计风格</strong> ：</p>









<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d228c8699cf84bb7a40ff83d84e7d548~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=qA5pgOEtDcAkTEiihO8DTVksfMs%3D" alt="8b13916c1c0c6339201a1a9f3e797b2e" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77ea0a6de3c74a58a4eebc509e328332~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=BLnidBWTHY2VKPJ3kDfQnTPmRJ4%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55ea18421a364e35b2dfb93338160e34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=rrzTcCREi89B%2F%2FLdsGeVaGADK90%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56450582bb204f08887af218bc556a2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=dZkfJVjFgJuQ8cPCDJ9lDt9rnAU%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>通过上面前两张图我们可以看到，iOS 26 正常情况下，系统键盘其实是会出现半透明效果并且具备圆角，虽然透明效果不是特别明显，但是对比后两张图里，可以看到微信和淘宝还是保留着原本的 iOS 18 的直角效果。</p>
<blockquote>
<p>如果还是保留原本风格，其实并不会遇到这个问题。</p>
</blockquote>
<p><strong>所以这个 issue 首先是需要在 Xcode 26 下，并且没有关闭 Liquid Glass 适配的情况下才会遇到</strong>，当然，就算是 iOS 26 场景，一般情况下也不会有什么大问题，比如下图直接在界面内使用一个 <code>TextField</code> ，其实并不会有明显问题：</p>







<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dc21612af4240d792024f59e73534fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=ZczUpzI2%2F4yzJxo7DkHRXWaRdLw%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ebc5e2b57044e39b7a5c0358a303dbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=aT7%2Fhqerqj%2FB%2BOCOg%2BfZbNhCiWM%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>问题还是主要出现在类似 <code>showModalBottomSheet</code> 的场景，特别是在背景色透明的时候，虽然我们设置了 <code>backgroundColor: Colors.transparent</code> ，<strong>但是在 Flutter 里，某些时候 UI 并不会“在键盘背后继续画”</strong> ，因为在 iOS 26 之前，Flutter（以及很多跨平台框架）都默认：</p>
<blockquote>
<p><strong>系统键盘 = 完全不透明的遮挡物</strong>，所以 Flutter 的 pipeline 会认为键盘区域背后不需要特殊关注。</p>
</blockquote>







<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18616ed0571f43e7bbc53eac69fde608~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=RSAJeipogB69tt4c2w2XPajWu8c%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0cf32020255458f9b4da867f2d3ea05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=P1LvlwLkchu2HRQk3wpGKNPbTA0%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>实际上类似同样的问题，在 RN 里也是存在，甚至对于 CMP 来说也是存在不一样的问题，所以对于 CMP 来说，才会有 <a href="https://juejin.cn/post/7594863660280496147" target="_blank" title="https://juejin.cn/post/7594863660280496147">1.10 Interop views 新特性 Overlay </a>，用于支持 UIKit 的半透明/blur 可以采样到 Skia 的内容的实验性 API ：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be381af627b044068bca9e81d400132d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=YwDwvtgqLyR2YtSryfsbcVnjHS8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9faa62b4480d4184bf03025906f70b1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=w7sBOdkCPbhguDnuslJt8UcB72A%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3131730714474d318e3b6c550948efac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=dKBLX9k4AepYwBhEf%2BPUrJam3MY%3D" alt="" loading="lazy"/></p>
<p><strong>所以这个问题实际上的本质不是圆角</strong>，比如我把 <code>showModalBottomSheet</code> 背景改成红色，此时你可以看到键盘是可以采集到背景色的，甚至我把 <code>Container</code> 也改成红色，你也看不出来异常：</p>







<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e1f833111e2401cab0380dd3f811a70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=6wRGZG8BkYY%2FZZ%2BOF5ljf%2BLdBvg%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d460ae0c2bb841579d3917c03855cce4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=bNYm2ONTVFM2Zait%2F5P2P14v2o4%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p><strong>所以问题更多出现在透明色上</strong>，随着 <code>showModalBottomSheet</code> 弹出并带有透明色的时候，由于 Flutter 认为被键盘这挡住的下层 Widget 并不需要绘制，所以导致系统键盘采集不到对应的像素点，从而出现了一开始的黑色背景。</p>
<p>所以其实这个 Bug 如果想临时解决，只需要在 <code>Info.plist</code> 里配置 <code>UIDesignRequiresCompatibility = YES</code> 就可以了，只是此时 App UI 会是 iOS 18 的风格：</p>







<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f4baaf1f0c4451da02bf7dbb4b5a8d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=YgKhzcxCFx8gvExY5AN9MhXse08%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d23e4a28d914858ba80b485a8f84345~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=2jBsVD1XGRDa5aMtDaeaxGKF2qM%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>如果再对比抖音和 Github App ，就可以看到 iOS 26 新键盘风格对于整体应用的风格影响还是挺大的，所以不少 App 目前会选择通过关闭适配拖延时间。</p>







<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8960ebb99a104882930870eb0fcf45a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=7AA5kH6iN%2FlkIojKaU4Zy5EpJAE%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97a572ed7869455495d4bf665f42a773~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=VzEuqPTXpH9eXu7qZH88fSR1zG8%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>那为什么会说，这个 Bug 会导致整个底层生态的重构？<strong>因为 iOS 26 改变了“系统键盘会完全遮挡 App 内容”这一长期不变的底层假设</strong>，而 Flutter 的渲染 / 布局 / Insets / 事件系统，几乎全都建立在旧假设之上，这套逻辑几乎渗透在：</p>
<ul>
<li><code>RenderObject</code> 的 <code>layout</code></li>
<li><code>Scaffold</code> / <code>BottomSheet</code> / <code>Navigator</code></li>
<li><code>MediaQuery</code></li>
<li><code>TextInputPlugin</code></li>
<li>Engine 中的 view hierarchy</li>
<li>···</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62cbb41513d24b9dabf73ec4acd1f25f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=K6pyjNg8LraIRnLVWOWzzrxIQyM%3D" alt="" loading="lazy"/></p>
<p>也就是如果想完全适配这个新场景（多层嵌套下还提供键盘场景的透明支持），一旦需要完全支持“键盘下内容需要绘制”，就要系统性重构多个核心层，例如</p>
<p>：</p>
<h4 data-id="heading-0">Framework 层（Dart）</h4>
<ul>
<li>
<p><code>MediaQuery.viewInsets</code></p>
<ul>
<li>现在代表“不可见区域”</li>
<li>未来要不要拆成多个：<code>coveredInsets</code> 、<code>obscuredInsets</code> 、<code>visualInsets</code></li>
</ul>
</li>
<li>
<p>Scaffold / BottomSheet</p>
<ul>
<li>是否仍然自动 resize？</li>
<li>还是只做布局、不做裁剪？</li>
</ul>
</li>
<li>
<p>Clip 行为</p>
<ul>
<li>现在大量 widget 默认不 clip</li>
</ul>
</li>
</ul>
<h4 data-id="heading-1">Engine 层（iOS embedder）</h4>
<ul>
<li>
<p>FlutterView / UIView hierarchy</p>
</li>
<li>
<p>CALayer 合成顺序</p>
</li>
<li>
<p>系统 keyboard window vs Flutter window</p>
</li>
<li>
<p>是否需要：</p>
<ul>
<li>在被遮挡区域继续 raster</li>
<li>或改变 backing store 策略</li>
</ul>
</li>
</ul>
<h4 data-id="heading-2">输入系统 &amp; Hit Test</h4>
<ul>
<li>
<p>键盘下的 widget：</p>
<ul>
<li>画出来了</li>
<li>但不能响应触摸</li>
</ul>
</li>
<li>
<p>Flutter 目前的 hit-test 假设：</p>
<ul>
<li>“看得见 = 可点”</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">插件 &amp; 三方生态</h4>
<ul>
<li>
<p>各种：</p>
<ul>
<li>bottom sheet 插件</li>
<li>keyboard avoiding 插件</li>
<li>聊天 UI</li>
</ul>
</li>
<li>
<p>各种涉及“手搓” viewInsets 的场景</p>
</li>
</ul>
<p><strong>所以这个“语义场景”如果发生比变化，那么涉及的将是大量底层改动，甚至一些性能指标都会需要调整，从长远来看，这还会是一个 iOS 平台特有的差异化适配场景，并且引入大量 bread change</strong>。</p>
<h2 data-id="heading-4">最后</h2>
<p>最后总结下，<strong>正常大家使用输入框输入文本内容不会有什么问题</strong>，甚至如果你用 Dialog 场景也不会有什么问题，甚至你看下方最后一张图片，在 dialog 下的键盘依然可以正常透视工作：</p>








<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fef0d4e649f4c47b6f6468f3459bb65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=hosWMv7q%2Bh11e2iDmmU0s29C3Pw%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84aa4bb724704c11a5d1ae4d0d3e756d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=F8HbVJ2rHQcJ2szaECmfdca3qFk%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1541015615bd4d74a0422ce80d396b00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=tYfeB7HDMenshvpeLNRL6sd82f4%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>所以问题主要还是存在于 <code>BottomSheet</code> 这种场景，因为 <code>BottomSheet</code> 默认行为是认为底部对齐，高度有限，所以对于 <code>BottomSheet</code> 会认为底部高度区域在键盘下不渲染，所以导致最后采集不到像素出现黑色。</p>
<p><strong>针对问题其实可以选择配置 <code>UIDesignRequiresCompatibility = YES</code> 来解决，或者替换为 Dialog 来绕过场景</strong>，但是如果要等官方修复这个场景，可能会需要等待评估是否真的有必要大规模底层改动。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0500f298cdf24bb19b88afb7dc876a1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=tTi4RnJsW0Np0X5mNPeIlRXt5Y8%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>从我的角度看，这完全没必要，毕竟真这么修改，带来的就是生态的大量 break change。</p>
</blockquote>
<h2 data-id="heading-5">参考链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F179482" target="_blank" title="https://github.com/flutter/flutter/issues/179482" ref="nofollow noopener noreferrer">github.com/flutter/flu…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>