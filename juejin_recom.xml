<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Vue3 å¦‚ä½•å®ç°å›¾ç‰‡æ‡’åŠ è½½ï¼Ÿå…¶å®ä¸€ä¸ª Intersection Observer å°±æå®šäº†]]></title>    <link>https://juejin.cn/post/7577737385954639882</link>    <guid>https://juejin.cn/post/7577737385954639882</guid>    <pubDate>2025-11-30T05:31:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577737385954639882" data-draft-id="7570239631846981666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 å¦‚ä½•å®ç°å›¾ç‰‡æ‡’åŠ è½½ï¼Ÿå…¶å®ä¸€ä¸ª Intersection Observer å°±æå®šäº†"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2025-11-30T05:31:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åˆ˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 å¦‚ä½•å®ç°å›¾ç‰‡æ‡’åŠ è½½ï¼Ÿå…¶å®ä¸€ä¸ª Intersection Observer å°±æå®šäº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åˆ˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T05:31:34.000Z" title="Sun Nov 30 2025 05:31:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œåœ¨å½“ä»Šå›¾ç‰‡å¯†é›†çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œä¼˜åŒ–å›¾ç‰‡åŠ è½½å·²æˆä¸ºå‰ç«¯å¼€å‘çš„é‡è¦ä»»åŠ¡ã€‚ä»Šå¤©æˆ‘ä»¬åˆ†äº«ä¸€ä¸‹æ€ä¹ˆä½¿ç”¨ Vue3 å®ç°å›¾ç‰‡çš„æ‡’åŠ è½½åŠŸèƒ½ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯å›¾ç‰‡æ‡’åŠ è½½ï¼Ÿ</strong></p>
<p>å‡å¦‚ä½ æ‰“å¼€ä¸€ä¸ªæœ‰å¤§é‡å›¾ç‰‡çš„é¡µé¢ï¼Œå¦‚æœæ‰€æœ‰å›¾ç‰‡åŒæ—¶åŠ è½½ï¼Œä¼šå¯¼è‡´é¡µé¢å¡é¡¿ã€æµé‡æµªè´¹ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›éœ€è¦æ»šåŠ¨æ‰èƒ½çœ‹åˆ°çš„å›¾ç‰‡ã€‚</p>
<p>æ‡’åŠ è½½æŠ€æœ¯å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ¡ˆï¼Œ<strong>åªæœ‰å½“å›¾ç‰‡è¿›å…¥æˆ–å³å°†è¿›å…¥å¯è§†åŒºåŸŸçš„æ—¶å€™ï¼Œæ‰åŠ è½½å®ƒä»¬</strong>ã€‚</p>
<p>æ•ˆæœé¢„è§ˆï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b34c807c446746928322e16c38034944~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765085493&amp;x-signature=FrFPZhp%2BO%2FkwA8tZmh7oUp7ChEA%3D" alt="6vue3å›¾ç‰‡æ‡’åŠ è½½3.gif" loading="lazy"/></p>
<p><strong>å®Œæ•´ç¤ºä¾‹ä»£ç å¯åœ¨æ–‡æœ«è·å–</strong></p>
<h2 data-id="heading-0">å®ç°åŸç†</h2>
<p>æˆ‘ä»¬çš„Vue3æ‡’åŠ è½½å®ç°åŸºäºä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯ï¼š</p>
<h3 data-id="heading-1">1. Intersection Observer API</h3>
<p>è¿™æ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„å¼ºå¤§APIï¼Œå¯ä»¥<strong>é«˜æ•ˆç›‘å¬å…ƒç´ æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸ</strong>ï¼Œè€Œæ— éœ€é¢‘ç¹è®¡ç®—å…ƒç´ ä½ç½®ï¼Œæ€§èƒ½è¿œä¼˜äºä¼ ç»Ÿçš„æ»šåŠ¨ç›‘å¬æ–¹å¼ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºè§‚å¯Ÿå™¨</span>
observer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> {
  entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) { <span class="hljs-comment">// å…ƒç´ è¿›å…¥å¯è§†åŒºåŸŸ</span>
      <span class="hljs-title function_">loadImage</span>();
      observer.<span class="hljs-property">value</span>.<span class="hljs-title function_">unobserve</span>(entry.<span class="hljs-property">target</span>); <span class="hljs-comment">// åŠ è½½ååœæ­¢è§‚å¯Ÿ</span>
    }
  });
}, {
  <span class="hljs-attr">rootMargin</span>: <span class="hljs-string">'50px 0px'</span>, <span class="hljs-comment">// æå‰50pxå¼€å§‹åŠ è½½</span>
  <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.1</span> <span class="hljs-comment">// å…ƒç´ 10%å¯è§æ—¶è§¦å‘</span>
});
</code></pre>
<h3 data-id="heading-2">2. ç»„ä»¶åŒ–è®¾è®¡</h3>
<p>æˆ‘ä»¬å°†æ‡’åŠ è½½åŠŸèƒ½å°è£…ä¸ºç‹¬ç«‹çš„ <code>LazyImage</code> ç»„ä»¶ï¼Œæé«˜ä»£ç å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<h2 data-id="heading-3">ä»£ç å®ç°è¯¦è§£</h2>
<h3 data-id="heading-4">ç»„ä»¶æ¨¡æ¿ç»“æ„</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lazy-image-container"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
    <span class="hljs-attr">v-if</span>=<span class="hljs-string">"isLoaded &amp;&amp; !hasError"</span>
    <span class="hljs-attr">:src</span>=<span class="hljs-string">"actualSrc"</span>
    <span class="hljs-attr">:alt</span>=<span class="hljs-string">"alt"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"lazy-image"</span>
    <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ opacity: imageOpacity }"</span>
    @<span class="hljs-attr">load</span>=<span class="hljs-string">"onLoad"</span>
    @<span class="hljs-attr">error</span>=<span class="hljs-string">"onError"</span>
  /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"hasError"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-placeholder"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error-message"</span>&gt;</span>å›¾ç‰‡åŠ è½½å¤±è´¥<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"retryLoad"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 10px;"</span>&gt;</span>é‡è¯•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-placeholder"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>ç»„ä»¶åŒ…å«ä¸‰ç§çŠ¶æ€ï¼š</p>
<ul>
<li><strong>åŠ è½½ä¸­</strong>ï¼šæ˜¾ç¤ºæ—‹è½¬åŠ è½½åŠ¨ç”»</li>
<li><strong>åŠ è½½å®Œæˆ</strong>ï¼šæ˜¾ç¤ºå®é™…å›¾ç‰‡ï¼Œå¸¦æœ‰æ·¡å…¥æ•ˆæœ</li>
<li><strong>åŠ è½½å¤±è´¥</strong>ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å’Œé‡è¯•æŒ‰é’®</li>
</ul>
<h3 data-id="heading-5">æ ¸å¿ƒé€»è¾‘å®ç°</h3>
<h4 data-id="heading-6">çŠ¶æ€ç®¡ç†</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">setup</span>(<span class="hljs-params">props, { emit }</span>) {
  <span class="hljs-keyword">const</span> isLoaded = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);    <span class="hljs-comment">// æ˜¯å¦å·²åŠ è½½</span>
  <span class="hljs-keyword">const</span> hasError = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);    <span class="hljs-comment">// æ˜¯å¦åŠ è½½å¤±è´¥</span>
  <span class="hljs-keyword">const</span> imageOpacity = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);    <span class="hljs-comment">// å›¾ç‰‡é€æ˜åº¦ï¼ˆç”¨äºæ·¡å…¥æ•ˆæœï¼‰</span>
  <span class="hljs-keyword">const</span> observer = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);     <span class="hljs-comment">// Intersection Observerå®ä¾‹</span>
  <span class="hljs-keyword">const</span> container = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);    <span class="hljs-comment">// å®¹å™¨DOMå¼•ç”¨</span>
  <span class="hljs-keyword">const</span> actualSrc = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);      <span class="hljs-comment">// å®é™…å›¾ç‰‡åœ°å€</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>ä½¿ç”¨Vue3çš„Composition APIï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ¸…æ™°åœ°ç»„ç»‡ä»£ç é€»è¾‘ã€‚</p>
<h4 data-id="heading-7">å›¾ç‰‡åŠ è½½æ§åˆ¶</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">loadImage</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">slowLoad</span>) {
    <span class="hljs-comment">// æ¨¡æ‹Ÿæ…¢é€Ÿç½‘ç»œ - å»¶è¿Ÿ2ç§’åŠ è½½</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      actualSrc.<span class="hljs-property">value</span> = props.<span class="hljs-property">src</span>;
      isLoaded.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
    }, <span class="hljs-number">2000</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// æ­£å¸¸åŠ è½½</span>
    actualSrc.<span class="hljs-property">value</span> = props.<span class="hljs-property">src</span>;
    isLoaded.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  }
};
</code></pre>
<p>è¿™ä¸ªå‡½æ•°æ ¹æ®<code>slowLoad</code>å±æ€§å†³å®šæ˜¯å¦æ¨¡æ‹Ÿæ…¢é€Ÿç½‘ç»œï¼Œä¾¿äºæµ‹è¯•ä¸åŒç½‘ç»œæ¡ä»¶ä¸‹çš„è¡¨ç°ã€‚</p>
<h4 data-id="heading-8">ç”Ÿå‘½å‘¨æœŸç®¡ç†</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// åˆ›å»ºå¹¶å¯åŠ¨Intersection Observer</span>
  observer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> {
    <span class="hljs-comment">// è§‚å¯Ÿé€»è¾‘...</span>
  });
  
  <span class="hljs-keyword">if</span> (container.<span class="hljs-property">value</span>) {
    observer.<span class="hljs-property">value</span>.<span class="hljs-title function_">observe</span>(container.<span class="hljs-property">value</span>);
  }
});

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ç»„ä»¶å¸è½½æ—¶æ¸…ç†è§‚å¯Ÿå™¨</span>
  <span class="hljs-keyword">if</span> (observer.<span class="hljs-property">value</span>) {
    observer.<span class="hljs-property">value</span>.<span class="hljs-title function_">disconnect</span>();
  }
});
</code></pre>
<p>ç¡®ä¿åœ¨ç»„ä»¶é”€æ¯æ—¶æ­£ç¡®æ¸…ç†èµ„æºï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
<h3 data-id="heading-9">é”™è¯¯å¤„ç†ä¸é‡è¯•æœºåˆ¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onError</span> = (<span class="hljs-params"/>) =&gt; {
  hasError.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'error'</span>); <span class="hljs-comment">// å‘çˆ¶ç»„ä»¶å‘é€é”™è¯¯äº‹ä»¶</span>
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">retryLoad</span> = (<span class="hljs-params"/>) =&gt; {
  hasError.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  isLoaded.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-comment">// é‡æ–°è§¦å‘è§‚å¯Ÿ</span>
  <span class="hljs-keyword">if</span> (observer.<span class="hljs-property">value</span> &amp;&amp; container.<span class="hljs-property">value</span>) {
    observer.<span class="hljs-property">value</span>.<span class="hljs-title function_">observe</span>(container.<span class="hljs-property">value</span>);
  }
};
</code></pre>
<p>è‰¯å¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶å¯ä»¥æå‡ç”¨æˆ·ä½“éªŒï¼Œè®©ç”¨æˆ·åœ¨å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æœ‰æœºä¼šé‡è¯•ã€‚</p>
<h2 data-id="heading-10">åº”ç”¨è¯¥ç»„ä»¶</h2>
<h3 data-id="heading-11">åœ¨ä¸»ç»„ä»¶ä¸­ä½¿ç”¨æ‡’åŠ è½½</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"gallery"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
    <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(image, index) in images"</span> 
    <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span> 
    <span class="hljs-attr">class</span>=<span class="hljs-string">"image-card"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lazy-image</span>
      <span class="hljs-attr">:src</span>=<span class="hljs-string">"image.url"</span>
      <span class="hljs-attr">:alt</span>=<span class="hljs-string">"image.title"</span>
      <span class="hljs-attr">:slow-load</span>=<span class="hljs-string">"networkSlow"</span>
      @<span class="hljs-attr">loaded</span>=<span class="hljs-string">"onImageLoaded"</span>
      @<span class="hljs-attr">error</span>=<span class="hljs-string">"onImageError"</span>
    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">lazy-image</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-info"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-title"</span>&gt;</span>{{ image.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-description"</span>&gt;</span>{{ image.description }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-12">åŠŸèƒ½æ§åˆ¶ä¸ç»Ÿè®¡</h3>
<p>æˆ‘ä»¬çš„ä¸»ç»„ä»¶æä¾›äº†å®ç”¨çš„æ§åˆ¶åŠŸèƒ½ï¼š</p>
<ul>
<li><strong>æ·»åŠ æ›´å¤šå›¾ç‰‡</strong>ï¼šåŠ¨æ€åŠ è½½æ›´å¤šå›¾ç‰‡</li>
<li><strong>é‡ç½®å›¾ç‰‡</strong>ï¼šæ¢å¤åˆå§‹çŠ¶æ€</li>
<li><strong>æ¨¡æ‹Ÿç½‘ç»œé€Ÿåº¦</strong>ï¼šåˆ‡æ¢æ­£å¸¸/æ…¢é€Ÿç½‘ç»œæ¨¡å¼</li>
<li><strong>åŠ è½½ç»Ÿè®¡</strong>ï¼šå®æ—¶æ˜¾ç¤ºå·²åŠ è½½å’Œå¤±è´¥çš„å›¾ç‰‡æ•°é‡</li>
</ul>
<h2 data-id="heading-13">è¿›ä¸€æ­¥ä¼˜åŒ–</h2>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿˜å¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¼˜åŒ–ï¼š</p>
<ol>
<li><strong>å›¾ç‰‡å‹ç¼©ä¸æ ¼å¼é€‰æ‹©</strong>ï¼šä½¿ç”¨WebPç­‰ç°ä»£æ ¼å¼ï¼Œå‡å°æ–‡ä»¶ä½“ç§¯</li>
<li><strong>æ¸è¿›å¼åŠ è½½</strong>ï¼šå…ˆåŠ è½½ä½è´¨é‡é¢„è§ˆå›¾ï¼Œå†åŠ è½½é«˜æ¸…å›¾</li>
<li><strong>é¢„åŠ è½½å…³é”®å›¾ç‰‡</strong>ï¼šå¯¹é¦–å±å†…çš„å…³é”®å›¾ç‰‡ä¸ä½¿ç”¨æ‡’åŠ è½½</li>
<li><strong>ä½¿ç”¨CDNåŠ é€Ÿ</strong>ï¼šé€šè¿‡å†…å®¹åˆ†å‘ç½‘ç»œæé«˜å›¾ç‰‡åŠ è½½é€Ÿåº¦</li>
</ol>
<p><strong>Githubç¤ºä¾‹ä»£ç </strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1344160559-lch%2Fdh-vue3-component%2Fblob%2Fmain%2FLazyImages%2Findex.html" target="_blank" title="https://github.com/1344160559-lch/dh-vue3-component/blob/main/LazyImages/index.html" ref="nofollow noopener noreferrer">github.com/1344160559-â€¦</a></p>
<h2 data-id="heading-14">æ€»ç»“</h2>
<p>Vue3å›¾ç‰‡æ‡’åŠ è½½æ˜¯ä¸€ä¸ªç®€å•ä½†æå…¶å®ç”¨çš„ä¼˜åŒ–æŠ€æœ¯ã€‚é€šè¿‡<code>Intersection Observer API</code>å’ŒVue3çš„å“åº”å¼ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä»¥å°‘é‡ä»£ç å®ç°é«˜æ•ˆçš„æ‡’åŠ è½½åŠŸèƒ½ï¼Œæ˜¾è‘—æå‡é¡µé¢æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p>è¿™ä¸ªå®ç°ä¸ä»…é€‚ç”¨äºå›¾ç‰‡å±•ç¤ºç±»ç½‘ç«™ï¼Œä¹Ÿå¯ä»¥åº”ç”¨äºä»»ä½•éœ€è¦ä¼˜åŒ–èµ„æºåŠ è½½çš„Vue3é¡¹ç›®ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ ç†è§£å’Œå®ç°è¿™ä¸€é‡è¦å‰ç«¯ä¼˜åŒ–æŠ€æœ¯ï¼</p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜åˆ˜å¤§åï¼Œä¸“æ³¨åˆ†äº«å‰åç«¯å¼€å‘çš„å®æˆ˜ç¬”è®°ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote>
<h4 data-id="heading-15">ğŸ“Œå¾€æœŸç²¾å½©</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fmaq_p_m5vd7KS-xyXt5rcA" target="_blank" title="https://mp.weixin.qq.com/s/maq_p_m5vd7KS-xyXt5rcA" ref="nofollow noopener noreferrer">ã€ŠSpringBoot+MySQL+Vueå®ç°æ–‡ä»¶å…±äº«ç³»ç»Ÿã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FP7SMincYFKERZbNKAFtzGQ" target="_blank" title="https://mp.weixin.qq.com/s/P7SMincYFKERZbNKAFtzGQ" ref="nofollow noopener noreferrer">ã€Šè¿™20æ¡SQLä¼˜åŒ–æ–¹æ¡ˆï¼Œè®©ä½ çš„æ•°æ®åº“æŸ¥è¯¢é€Ÿåº¦æå‡10å€ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FgQK9L1TxKL50FUVMcgh6JQ" target="_blank" title="https://mp.weixin.qq.com/s/gQK9L1TxKL50FUVMcgh6JQ" ref="nofollow noopener noreferrer">ã€ŠSpringBoot åŠ¨æ€èœå•æƒé™ç³»ç»Ÿè®¾è®¡çš„ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPQ_w7CDVoIZPn-CVH2DKJg" target="_blank" title="https://mp.weixin.qq.com/s/PQ_w7CDVoIZPn-CVH2DKJg" ref="nofollow noopener noreferrer">ã€ŠVue3å’ŒVue2çš„æ ¸å¿ƒåŒºåˆ«ï¼Ÿå¾ˆå¤šå¼€å‘è€…éƒ½æ²¡å®Œå…¨ææ‡‚çš„10ä¸ªç»†èŠ‚ã€‹</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI å¦‚ä½•å†å·¥ç¨‹åŒ–é¡¹ç›®ä¸­ææ•ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7577905525997453353</link>    <guid>https://juejin.cn/post/7577905525997453353</guid>    <pubDate>2025-11-30T05:50:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577905525997453353" data-draft-id="7577905525997125673" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI å¦‚ä½•å†å·¥ç¨‹åŒ–é¡¹ç›®ä¸­ææ•ˆï¼Ÿ"/> <meta itemprop="keywords" content="AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-11-30T05:50:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°å…µå¼ å¥"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032405229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI å¦‚ä½•å†å·¥ç¨‹åŒ–é¡¹ç›®ä¸­ææ•ˆï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032405229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°å…µå¼ å¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T05:50:38.000Z" title="Sun Nov 30 2025 05:50:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨åˆšå¼€å§‹ç”¨ cursor ç­‰å·¥å…·æ—¶ï¼Œåªæ˜¯ç”¨ AI å¸®å¿™ç”Ÿäº§ä»£ç ï¼Œä»£ç çš„é€»è¾‘ã€ä¸šåŠ¡æµç¨‹éƒ½åœ¨äººçš„è„‘å­é‡Œé¢ï¼Œè¿™å¯¼è‡´ AI åªèƒ½åœ¨å±€é™çš„èŒƒå›´å†…å¸®ä¸€å°éƒ¨åˆ†å¿™ï¼Œæ•ˆç‡å¾ˆä½ã€‚è€Œä¸”è¿˜ç»å¸¸å¸®é”™å¿™ï¼Œæ¯”å¦‚æ”¹é”™äº†ã€ä»£ç é£æ ¼ä¸ä¸€è‡´ç­‰ç­‰ã€‚</p>
<p>è¿™æ˜¯æœ€åŸºç¡€çš„ AI ç”¨æ³•ï¼Œåªç”¨ AI å†™ä»£ç ï¼Œäºæ˜¯æˆ‘æƒ³æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è®© AI æ›´å¤§ç¨‹åº¦çš„æ¥ç®¡é¡¹ç›®ï¼Œæˆ‘æŠŠå®ƒåˆ†ä¸ºä¸‰éƒ¨åˆ†ã€‚</p>
<h2 data-id="heading-0">ä»£ç é£æ ¼ Prompt</h2>
<p>ç”¨äºçº¦æŸ AI coding çš„è§„èŒƒï¼Œè¿™ä¸€éƒ¨åˆ†å°±å¯ä»¥åˆ†å‡ºå¾ˆå¤šåˆ†æ”¯ï¼Œæ¯”å¦‚æŒ‰ç…§æ–‡ä»¶å¤¹çš„ã€æŒ‰ç…§æ–‡ä»¶åç¼€ã€ä¸šåŠ¡æ¨¡å—ç­‰ç­‰ï¼Œå¯ä»¥ç»“åˆ cursor è‡ªå¸¦çš„ .mdc è§„èŒƒæ–‡ä»¶ä¸€èµ·ç”¨ã€‚</p>
<p>è¿™é‡Œä¸å’Œä¸šåŠ¡ç›¸å…³ï¼Œåªå’Œç¼–ç è§„èŒƒç›¸å…³ï¼Œè¦éµå¾ª Prompt ç¼–å†™çš„å¸¸è§æ–¹æ³•ï¼Œæ¯”å¦‚ç»™æ¡ˆä¾‹ã€æŒ‡ä»¤ä¼˜äºé™åˆ¶ç­‰ã€‚</p>
<p>Prompt ç¼–å†™çš„æŠ€å·§ï¼Œæˆ‘å‡†å¤‡è¿‡ä¸¤å¤©å†™ä¸€ç¯‡æ–‡ç« æ€»ç»“ä¸‹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å…³æ³¨æˆ‘ã€‚</p>
<h2 data-id="heading-1">æ—¥å¿—è®°å½•æ–‡ä»¶</h2>
<p>è¿™é‡Œè®°å½•æ¯ä¸€æ¬¡ä»£ç æ”¹åŠ¨ï¼Œæ¯ä¸ªæ–‡ä»¶å¤§è‡´åŒ…å«å˜åŠ¨åŸå› ã€æ”¹åŠ¨æ–¹æ¡ˆã€å˜åŠ¨ç»“æœã€æµ‹è¯•ç»“æœç­‰ç­‰ï¼Œè¿™äº›æ–‡ä»¶ä¸º AI æä¾›æ•´ä½“é¡¹ç›®çš„ä¸Šä¸‹æ–‡ï¼ŒæŠŠæ¯ä¸€æ¬¡ä¸šåŠ¡åœºæ™¯è®°å½•ä¸‹æ¥ã€‚è¿™æ · AI å°±èƒ½ç†è§£æ•´ä¸ªé¡¹ç›®ï¼Œæ…¢æ…¢çš„ä»æ¯æ¬¡è¿­ä»£ä¸­å­¦ä¹ ï¼Œä¸å†çŠ¯é‡å¤çš„é”™è¯¯ã€‚</p>
<p>AI ç¼–å†™ä»£ç ä¼šé‡å¤çš„çŠ¯æŸäº›ç‰¹å®šçš„é”™è¯¯ï¼ŒåŸå› æ˜¯æˆ‘ä»¬ç»™çš„ä¸Šä¸‹æ–‡ä¸å¤Ÿï¼Œä½†æˆ‘ä»¬ä¹Ÿä¸å¯èƒ½æ¯æ¬¡ç¼–å†™ä»£ç çš„æ—¶å€™éƒ½æŠŠé¡¹ç›®ä» 0 å¼€å§‹è®²ä¸€éè®© AI ç†è§£æ•´ä¸ªé¡¹ç›®æƒ…å†µï¼Œæ‰€ä»¥è¿™ä¸€å¥—æ–‡ä»¶å°±æ˜¯æŠŠé¡¹ç›®çš„è¿­ä»£è¿‡ç¨‹æ–‡æ¡£åŒ–ï¼ŒåŠ è½½åˆ° AI çš„ä¸Šä¸‹æ–‡ä¸­ã€‚</p>
<p>ç”Ÿæˆæ—¥å¿—æ–‡ä»¶æœ¬èº«ä¹Ÿéœ€è¦ä¸€ä¸ª Promptï¼Œè®©ç”Ÿäº§çš„æ–‡æ¡£è§„èŒƒåŒ–ã€‚</p>
<h2 data-id="heading-2">åˆ†æ­¥éª¤æ‰§è¡Œ</h2>
<p>æ­¤åå†™ä»£ç ä¹‹å‰ï¼Œå…ˆå°†éœ€æ±‚çš„ä¿¡æ¯ç»™ AIï¼Œä½¿ç”¨åé€€ä¸€æ­¥çš„æ–¹æ³•åŠ è½½æ—¥è®°è®°å½•æ–‡ä»¶åˆ°ä¸Šä¸‹æ–‡ï¼Œç”¨å¯¹è¯å®Œå–„æ­¤æ¬¡éœ€æ±‚ï¼Œå†ç”Ÿæˆæ–°çš„æ—¥å¿—è®°å½•æ–‡ä»¶çš„å‰åŠéƒ¨åˆ†å’Œç¼–å†™ä»£ç çš„å¤§çº²æ–‡ä»¶ã€‚</p>
<p>æ—¥å¿—è®°å½•æ–‡ä»¶ä¿æŒåªæ–°å¢ã€‚</p>
<p>ç„¶åå†å¼€å¯ä¸€ä¸ªæ–°çš„å¯¹è¯ï¼Œç”¨åé€€ä¸€æ­¥çš„æ–¹æ³•åŠ è½½ä»£ç è§„èŒƒåˆ°ä¸Šä¸‹æ–‡ï¼Œæ ¹æ®ç¼–å†™ä»£ç çš„å¤§çº²æ–‡ä»¶å¼€å§‹æ‰§è¡Œä»£ç ã€‚</p>
<p>æ‰§è¡Œå®Œæˆåæµ‹è¯•ï¼Œå†æŠŠæœ€ç»ˆçš„ç»“æœå®Œå–„åˆ°æ—¥å¿—è®°å½•æ–‡ä»¶ã€‚</p>
<p>è¿™æ ·æ¯ä¸ªéœ€æ±‚åˆ°æµç¨‹éƒ½æ˜¯è§„èŒƒåŒ–å’Œæ–‡æ¡£åŒ–çš„ï¼ŒAI ä¼šåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è¶Šç”¨è¶Šèªæ˜ã€‚</p>
<p>å½“ç„¶è¿™æ ·ä¹Ÿæœ‰ä¸ªé—®é¢˜ï¼Œç›®å‰æˆ‘å‘ç°çš„å°±æ˜¯æ–‡æ¡£å¤ªå¤šäº†ï¼Œæœ‰æ—¶å€™ä¼šä¸æŒ‰ç…§è§„èŒƒæ‰§è¡Œï¼Œæˆ‘åœ¨è€ƒè™‘ç”¨ RAG + MCP çš„æ–¹å¼ï¼Œä¸€ä¸ªé¡¹ç›®ä¸€ä¸ªæ•°æ®åº“ï¼ŒæŠŠæ•´ä¸ªæµç¨‹å®Œå–„æˆ flowã€‚</p>
<p>è¿™é‡Œé¢ä¼šå¤§é‡ç”¨åˆ° Prompt ç¼–å†™çš„æŠ€å·§ï¼Œæˆ‘å‡†å¤‡ä¸‹ä¸€éæ–‡ç« è¯¦ç»†ç½—åˆ—å‡ºæ¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[STM32CubeIDEæ‰‹åŠ¨ç§»æ¤FreeRTOS-åŠ¨æ€åˆ›å»ºä»»åŠ¡å’Œåˆ é™¤]]></title>    <link>https://juejin.cn/post/7577689171222642738</link>    <guid>https://juejin.cn/post/7577689171222642738</guid>    <pubDate>2025-11-29T15:16:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577689171222642738" data-draft-id="7577691061033107502" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="STM32CubeIDEæ‰‹åŠ¨ç§»æ¤FreeRTOS-åŠ¨æ€åˆ›å»ºä»»åŠ¡å’Œåˆ é™¤"/> <meta itemprop="keywords" content="åµŒå…¥å¼"/> <meta itemprop="datePublished" content="2025-11-29T15:16:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åµŒå…¥å¼å¤§å¤´"/> <meta itemprop="url" content="https://juejin.cn/user/124713977526552"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            STM32CubeIDEæ‰‹åŠ¨ç§»æ¤FreeRTOS-åŠ¨æ€åˆ›å»ºä»»åŠ¡å’Œåˆ é™¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/124713977526552/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åµŒå…¥å¼å¤§å¤´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T15:16:24.000Z" title="Sat Nov 29 2025 15:16:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å¼•è¨€</h2>
<p>æˆ‘åœ¨å­¦ä¹ è¿™ä¸ªéƒ¨åˆ†çš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œä½†å¥½åœ¨æœé›†äº†å¾ˆå¤šèµ„æ–™åå¾—ä»¥è§£å†³ï¼Œäºæ˜¯æ‰“ç®—åœ¨è¿™é‡Œæ¼”ç¤ºè¿™ä¸ªé¡¹ç›®çš„å…¨è¿‡ç¨‹ï¼Œå³å½“åšå¤ä¹ çš„èµ„æ–™ï¼Œä¹Ÿå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©åˆ°ä¸€äº›äººï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€æ•´ï¼</p>
<h2 data-id="heading-1">äºŒã€é¡¹ç›®ç®€ä»‹</h2>
<p>åˆ›å»ºä»¥ä¸‹ä¸‰ä¸ªä»»åŠ¡ï¼š</p>
<ul>
<li>ä»»åŠ¡1ï¼šLED1æ¯500msç¿»è½¬ä¸€æ¬¡</li>
<li>ä»»åŠ¡2ï¼šLED2æ¯500msç¿»è½¬ä¸€æ¬¡</li>
<li>ä»»åŠ¡3ï¼šå½“æŒ‰ä¸‹KEY1çš„æ—¶å€™åˆ é™¤ä»»åŠ¡1</li>
</ul>
<h2 data-id="heading-2">ä¸‰ã€æ­¥éª¤</h2>
<h3 data-id="heading-3">1. å®ç°åŸºæœ¬çš„å·¥ç¨‹é…ç½®</h3>
<h4 data-id="heading-4">a. å¼•è„šé…ç½®ï¼š</h4>
<p>PA0ä¸ºçº¢è‰²LEDï¼ŒPA1ä¸ºç»¿è‰²LEDï¼ŒPA5ä¸ºæŒ‰é”®1ï¼ŒPA9å’ŒPA10ç”¨ä½œä¸²å£å‘é€</p>
<ul>
<li>è®¾ç½®<code>PA0</code>ä¸º<code>GPIO_Output</code>,æ·»åŠ æ ‡ç­¾<code>LED_RED</code></li>
<li>è®¾ç½®<code>PA1</code>ä¸º<code>GPIO_Output</code>,æ·»åŠ æ ‡ç­¾<code>LED_Green</code></li>
<li>è®¾ç½®<code>PA5</code>ä¸º<code>GPIO_Intput</code>,æ·»åŠ æ ‡ç­¾<code>KEY1</code></li>
<li>è®¾ç½®<code>PA9</code>ä¸º<code>USART1_TX</code>,<code>PA10</code>ä¸º<code>USART1_RX</code></li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2888591f6b6343bca5a4621169c24415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=UYbZASbajgHxej3pTJXs4w%2BZToo%3D" alt="image.png" width="60%" loading="lazy"/>
<p>å› ä¸ºæˆ‘çš„æŒ‰é”®å¦ä¸€ç«¯è¿æ¥çš„æ˜¯æ­£æï¼Œæ‰€ä»¥æˆ‘çš„PA5è®¾ç½®ä¸ºäº†ä¸‹æ‹‰è¾“å…¥ï¼Œè®©PA5é»˜è®¤ä¸ºä½ç”µå¹³ï¼Œå½“æŒ‰é”®æŒ‰ä¸‹æ—¶ï¼ŒPA5ä¼šè¡¨ç°ä¸ºé«˜ç”µå¹³ï¼š</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0013ea3f4b414e9db17b17011083b41c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=ZoiO8MeDr1LTUcSwn15JM5TNQ68%3D" alt="image.png" width="50%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9faecef1e7d4e9d8e4f1224b1919f41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=Sb0TZC9c67V2xEMCORZhXeM7Yt4%3D" alt="image.png" width="30%" loading="lazy"/>
<blockquote>
<p><strong>å›¾ç‰‡æ¥è‡ªBç«™è§†é¢‘UP:keysking</strong></p>
</blockquote>
<h4 data-id="heading-5">b. ç³»ç»Ÿé…ç½®ï¼š</h4>
<ul>
<li>å°†<code>RCC</code>çš„æ—¶é’Ÿæ¥æºè®¾ç½®ä¸º<code>HSE</code>ï¼Œè°ƒæ•´ç³»ç»Ÿæ—¶é’Ÿä¸º<code>72MHZ</code>ï¼š</li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1eb364f2ed7b418babdcbd1e7ca24bff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=pAY5aIzPZxWr8iW%2BC1Flz9fhsN4%3D" alt="image.png" width="70%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdfebc1306224f38ac94382f15d1c413~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=ePRhF3888%2BhNvQmsjEnMkqVje0o%3D" alt="image.png" width="80%" loading="lazy"/>
<ul>
<li>è®¾ç½®<code>SYS</code>çš„<code>Debug</code>ä¸º<code>Serial Wire</code>ï¼Œ<code>Timebase Source</code>ä¸º<code>TIM4</code>
å‰è€…æ˜¯ä¸ºäº†èƒ½æŠŠä»£ç ä¸‹è½½è¿›å•ç‰‡æœºï¼Œåè€…æ˜¯å› ä¸º<code>HAL</code>æœ¬èº«å’Œ<code>FreeRTOS</code>éƒ½é»˜è®¤ä¾èµ–<code>SysTick</code>ï¼Œå¯èƒ½å‡ºç°å¡æ­»çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸ºäº†ä¿é™©èµ·è§ï¼Œå¯ä»¥è€ƒè™‘åœ¨<code>SYS</code>é€‰æ‹©<code>HAL</code>æ—¶é’Ÿæºçš„æ—¶å€™æ¢æˆå…¶ä»–çš„ï¼Œæ¯”å¦‚<code>TIM4</code></li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22c30a39ac904b18a30e0028179d8c6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=uWibn3xGhXYd42ybQXPSzwfH3FM%3D" alt="image.png" width="70%" loading="lazy"/>
<ul>
<li>è®¾ç½®<code>Time base: TIM4 global interrupt</code>å’Œ<code>System tick timer</code>çš„ä¼˜å…ˆçº§éƒ½ä¸º1</li>
<li>æ‰“å¼€USART1çš„ä¸­æ–­ï¼Œä¼˜å…ˆçº§è®¾ç½®ä¸º0</li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d771b263dfa44af8c9e64563ba9b6b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=WF03n83D67hk5AoJBgldRCrYZIM%3D" alt="image.png" width="70%" loading="lazy"/>
<ul>
<li>è®¾ç½®USARTä¸ºå¼‚æ­¥æ¨¡å¼ï¼š</li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa000a9ac9c4aad9acbde152943ed99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=8T9FjdW6%2F5pevo%2B4UFiJsaW4DT0%3D" alt="image.png" width="70%" loading="lazy"/>
<ul>
<li>æ‰“å¼€<code>Project Manager</code>ä¸­çš„<code>Code Generator</code>ï¼Œå‹¾é€‰æ¯ä¸ªå¤–è®¾ç”Ÿæˆä¸€å¯¹â€œ.c/.hæ–‡ä»¶â€åˆå§‹åŒ–</li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ee884df7733460db044732067630ca0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=8V1wCXpcpOOu8En3wlCOQHF5wIY%3D" alt="image.png" width="100%" loading="lazy"/>
<blockquote>
<p><strong>è‡³æ­¤ï¼Œé¡¹ç›®åŸºæœ¬é…ç½®å®Œæˆï¼ŒCtrl+Sç”Ÿæˆä»£ç ï¼Œè¿›å…¥ä»£ç ç¼–è¾‘é¡µé¢</strong></p>
</blockquote>
<ul>
<li>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºHardwareæ–‡ä»¶å¤¹ï¼Œæ–°å»ºKey.hå’ŒKey.hæ–‡ä»¶</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __KEY_H</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> __KEY_H</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"main.h"</span></span>

<span class="hljs-type">uint8_t</span> <span class="hljs-title function_">Key_Is_Press</span><span class="hljs-params">()</span>;

<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"Key.h"</span></span>

<span class="hljs-type">uint8_t</span> <span class="hljs-title function_">Key_Is_Press</span><span class="hljs-params">()</span>
{
    <span class="hljs-type">uint8_t</span> Key_Is_Press = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">if</span>(HAL_GPIO_ReadPin(KEY1_GPIO_Port, KEY1_Pin) == GPIO_PIN_SET)
    {
        HAL_Delay(<span class="hljs-number">10</span>);
        <span class="hljs-keyword">if</span>(HAL_GPIO_ReadPin(KEY1_GPIO_Port, KEY1_Pin) == GPIO_PIN_SET)
        {
            Key_Is_Press = <span class="hljs-number">1</span>;
        }
}
    <span class="hljs-keyword">return</span> Key_Is_Press;
}
</code></pre>
<h3 data-id="heading-6">2. <code>printf</code>å‡½æ•°é‡å®šå‘</h3>
<blockquote>
<p>å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« </p>
</blockquote>
<h3 data-id="heading-7">3. å¼€å§‹ç§»æ¤</h3>
<h4 data-id="heading-8">1. æ–‡ä»¶ç§»æ¤</h4>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºFreeRTOSæ–‡ä»¶å¤¹ï¼Œå¤åˆ¶æºç /Source/includeæ–‡ä»¶å¤¹åˆ°FreeRTOSæ–‡ä»¶å¤¹ä¸‹ï¼ŒFreeRTOSæ–‡ä»¶å¤¹ä¸‹æ–°å»ºsourceæ–‡ä»¶å¤¹å’Œportableæ–‡ä»¶å¤¹ï¼Œå¤åˆ¶æºç Sourceæ–‡ä»¶å¤¹ä¸‹çš„7ä¸ª.cæ–‡ä»¶åˆ°FreeRTOS/sourceæ–‡ä»¶å¤¹ï¼ŒæŠŠæºç /portable/MemMangæ–‡ä»¶å¤¹å¤åˆ¶åˆ°FreeRTOS/portableæ–‡ä»¶å¤¹ï¼Œåªä¿ç•™heap_4.cæ–‡ä»¶ï¼ŒæŠŠæºç /Source/portable/GCCæ–‡ä»¶å¤¹å¤åˆ¶åˆ°FreeRTOS/portableæ–‡ä»¶å¤¹ï¼Œåªä¿ç•™ARM_CM3æ–‡ä»¶å¤¹ï¼ŒæŠŠæºç /Demo/CORTEX_STM32F103_Primer_GCCä¸‹çš„FreeRTOSConfig.hæ–‡ä»¶å¤åˆ¶åˆ°é¡¹ç›®/Core/Incæ–‡ä»¶å¤¹ä¸‹</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99a57766046b45b99ee7eb511ad0b2b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=5Ash%2Fp2ACRUSlCPGTY8qeY0WZZM%3D" alt="image.png" width="70%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9157166764ad4336af0797aa8bad9455~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=czmlOD%2F8WgUz0o20BkKKOZxTYz0%3D" alt="image.png" width="70%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6744dc8bc4974fb0b870c81306f68108~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=xi%2FD6IwAM2AkMyICnZ2eIh%2FEJjA%3D" alt="image.png" width="50%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c3462ce226b4f33b97ebf91424f1b3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=cHqxBMC2sTRwJhG6Az%2BCk1gztrA%3D" alt="image.png" width="70%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1dd5fd65c9e42da98f7c83c4f70f687~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=P8HZGDKbBABbIyNG6LE0yN8BDUA%3D" alt="image.png" width="70%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4af207e2a8ea48cf8084478f48274feb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=ASDvCLbmxP3ZTzbcgAiQRIpUlTc%3D" alt="image.png" width="70%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a055e45960c044b2b71931ed82062ce4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=2UadRcr7kZDdDLHLxDFqUxS4U4Y%3D" alt="image.png" width="70%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9430b9b2143a4c4584edd626b7fef26a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=tT9%2FTG%2BPcNdrGHwny25j0Lb8VME%3D" alt="image.png" width="70%" loading="lazy"/>
<h4 data-id="heading-9">2. å·¥ç¨‹é…ç½®</h4>
<ul>
<li>æŠŠHardwareæ–‡ä»¶å¤¹å’ŒFreeRTOSæ–‡ä»¶å¤¹åŠ å…¥é¡¹ç›®ç¼–è¯‘èŒƒå›´
å³é”®é¡¹ç›®åå­—ï¼Œç‚¹å‡»Propertiesï¼Œè¿›å…¥å¦‚ä¸‹é¡µé¢ï¼š</li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7e7036aa87b40cca23994ddb25f2bb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=fulgC59oWklKcInJqn6UVgVRiRc%3D" alt="image.png" width="100%" loading="lazy"/>
<ul>
<li>æŠŠincludeæ–‡ä»¶å¤¹å’ŒARM_CM3æ–‡ä»¶å¤¹å’ŒHardwareæ–‡ä»¶å¤¹æ·»åŠ åˆ°Include directoriesç›®å½•</li>
<li>æŠŠFreeRTOSæ–‡ä»¶å¤¹å’ŒHardwareæ–‡ä»¶å¤¹æ·»åŠ åˆ°Source Location</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1c29078ad574c1599842d56606f1fd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=iQmLRlfF7VDSEETcYqnNEo3qEOw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae5db1d82cd14653bc99bc8370b3701e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034184&amp;x-signature=bIpRvq1rWYJWm2otJ90TLigKohg%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">3. ç³»ç»Ÿé…ç½®æ–‡ä»¶ä¿®æ”¹</h4>
<ul>
<li>FreeRTOSConfig.hä¸­æ·»åŠ å¦‚ä¸‹3ä¸ªé…ç½®ï¼š</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> xPortPendSVHandler Â PendSV_Handler</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> vPortSVCHandler Â  Â  SVC_Handler</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> INCLUDE_xTaskGetSchedulerState Â  1</span>
</code></pre>
<p>æŠŠ<code>#define configUSE_TICK_HOOK 1</code>ä¿®æ”¹ä¸º<code>0</code></p>
<ul>
<li>ä¿®æ”¹stm32f1xx_it.cæ–‡ä»¶</li>
</ul>
<p>å¼•å…¥å¤´æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span>
<span class="hljs-comment">/* USER CODE BEGIN Includes */</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"FreeRTOS.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"task.h"</span></span>
<span class="hljs-comment">/* USER CODE END Includes */</span>
</code></pre>
<p>æ³¨é‡Šæ‰2ä¸ªå‡½æ•°ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// void SVC_Handler(void)</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// void PendSV_Handler(void)</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">// }</span>
</code></pre>
<p>æ·»åŠ SysTickæ—¶é’Ÿä¸­æ–­æœåŠ¡å‡½æ•°:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span>
<span class="hljs-comment">/* USER CODE BEGIN PV */</span>
<span class="hljs-keyword">extern</span> <span class="hljs-type">void</span> <span class="hljs-title function_">xPortSysTickHandler</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;
<span class="hljs-comment">/* USER CODE END PV */</span>

<span class="hljs-type">void</span> <span class="hljs-title function_">SysTick_Handler</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
Â  Â  <span class="hljs-comment">/* USER CODE BEGIN SysTick_IRQn 0 */</span>
    <span class="hljs-comment">/* USER CODE END SysTick_IRQn 0 */</span>
Â  Â  <span class="hljs-comment">/* USER CODE BEGIN SysTick_IRQn 1 */</span>
Â  Â  <span class="hljs-keyword">if</span> (xTaskGetSchedulerState() != taskSCHEDULER_NOT_STARTED)
Â  Â  {
Â  Â  Â  Â  xPortSysTickHandler();
Â  Â  }
Â  Â  <span class="hljs-comment">/* USER CODE END SysTick_IRQn 1 */</span>
}
</code></pre>
<h4 data-id="heading-11">4. åŠ¨æ€åˆ›å»ºä»»åŠ¡</h4>
<ul>
<li>FreeRTOSConfig.hæ–‡ä»¶æ–°åŠ <code>#define configSUPPORT_DYNAMIC_ALLOCATION</code></li>
<li>åœ¨Core/Incä¸‹æ–°å»ºFreeRTOS_demo.h,åœ¨Core/srcä¸‹æ–°å»ºFreeRTOS_demo.c</li>
<li>FreeRTOS_demo.cä»£ç ï¼š</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"FreeRTOS_demo.h"</span></span>

<span class="hljs-comment">/* å¯åŠ¨ä»»åŠ¡å‡½æ•° */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> START_TASK_PRIORITY 1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> START_TASK_STACK_DEPTH 128</span>
TaskHandle_t start_task_handler;
<span class="hljs-type">void</span> <span class="hljs-title function_">Start_Task</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span>;

<span class="hljs-comment">/* Task1 ä»»åŠ¡ é…ç½® */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK1_PRIORITY 2</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK1_STACK_DEPTH 128</span>
TaskHandle_t task1_handler;
<span class="hljs-type">void</span> <span class="hljs-title function_">Task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span>;

<span class="hljs-comment">/* Task2 ä»»åŠ¡ é…ç½® */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK2_PRIORITY 3</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK2_STACK_DEPTH 128</span>
TaskHandle_t task2_handler;
<span class="hljs-type">void</span> <span class="hljs-title function_">Task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span>;

<span class="hljs-comment">/* Task3 ä»»åŠ¡ é…ç½® */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK3_PRIORITY 4</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK3_STACK_DEPTH 128</span>
TaskHandle_t task3_handler;
<span class="hljs-type">void</span> <span class="hljs-title function_">Task3</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span>;

<span class="hljs-comment">/**
 * @description: FreeRTOSå…¥å£å‡½æ•°ï¼šåˆ›å»ºä»»åŠ¡å‡½æ•°å¹¶å¼€å§‹è°ƒåº¦
 * @return {*}
 */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">FreeRTOS_Start</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    xTaskCreate((TaskFunction_t)Start_Task,
                (<span class="hljs-type">char</span> *)<span class="hljs-string">"Start_Task"</span>,
                (configSTACK_DEPTH_TYPE)START_TASK_STACK_DEPTH,
                (<span class="hljs-type">void</span> *)<span class="hljs-literal">NULL</span>,
                (UBaseType_t)START_TASK_PRIORITY,
                (TaskHandle_t *)&amp;start_task_handler);
    vTaskStartScheduler();
}

<span class="hljs-type">void</span> <span class="hljs-title function_">Start_Task</span><span class="hljs-params">( <span class="hljs-type">void</span> * pvParameters )</span>
{
    taskENTER_CRITICAL();               <span class="hljs-comment">/* è¿›å…¥ä¸´ç•ŒåŒº */</span>
    xTaskCreate((TaskFunction_t         )   Task1,
                (<span class="hljs-type">char</span> *                 )   <span class="hljs-string">"Task1"</span>,
                (configSTACK_DEPTH_TYPE )   TASK1_STACK_DEPTH,
                (<span class="hljs-type">void</span> *                 )   <span class="hljs-literal">NULL</span>,
                (UBaseType_t            )   TASK1_PRIORITY,
                (TaskHandle_t *         )   &amp;task1_handler );

    xTaskCreate((TaskFunction_t         )   Task2,
                (<span class="hljs-type">char</span> *                 )   <span class="hljs-string">"Task2"</span>,
                (configSTACK_DEPTH_TYPE )   TASK2_STACK_DEPTH,
                (<span class="hljs-type">void</span> *                 )   <span class="hljs-literal">NULL</span>,
                (UBaseType_t            )   TASK2_PRIORITY,
                (TaskHandle_t *         )   &amp;task2_handler );

    xTaskCreate((TaskFunction_t         )   Task3,
                (<span class="hljs-type">char</span> *                 )   <span class="hljs-string">"Task2"</span>,
                (configSTACK_DEPTH_TYPE )   TASK3_STACK_DEPTH,
                (<span class="hljs-type">void</span> *                 )   <span class="hljs-literal">NULL</span>,
                (UBaseType_t            )   TASK3_PRIORITY,
                (TaskHandle_t *         )   &amp;task3_handler );
    vTaskDelete(<span class="hljs-literal">NULL</span>);
    taskEXIT_CRITICAL();                <span class="hljs-comment">/* é€€å‡ºä¸´ç•ŒåŒº */</span>
}

<span class="hljs-comment">/**
 * @description: LED1æ¯500msç¿»è½¬ä¸€æ¬¡
 * @param {void *} pvParameters
 * @return {*}
 */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">Task1</span><span class="hljs-params">(<span class="hljs-type">void</span> * pvParameters)</span>
{
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)
    {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"task1è¿è¡Œ....\r\n"</span>);
        HAL_GPIO_TogglePin(LED_RED_GPIO_Port, LED_RED_Pin);
        vTaskDelay(<span class="hljs-number">500</span>);
    }
}


<span class="hljs-comment">/**
 * @description: LED2æ¯500msç¿»è½¬ä¸€æ¬¡
 * @param {void *} pvParameters
 * @return {*}
 */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">Task2</span><span class="hljs-params">(<span class="hljs-type">void</span> * pvParameters)</span>
{
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)
    {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"task2è¿è¡Œ....\r\n"</span>);
        HAL_GPIO_TogglePin(LED_Green_GPIO_Port, LED_Green_Pin);
        vTaskDelay(<span class="hljs-number">500</span>);
    }
}


<span class="hljs-comment">/**
 * @description:
 * @param {void *} pvParameters
 * @return {*}
 */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">Task3</span><span class="hljs-params">(<span class="hljs-type">void</span> * pvParameters)</span>
{
	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)
	{
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"task3è¿è¡Œ...\r\n"</span>);
		<span class="hljs-keyword">if</span>(Key_Is_Press())
		{
			<span class="hljs-keyword">if</span>(task1_handler != <span class="hljs-literal">NULL</span>)
			{
				<span class="hljs-built_in">printf</span>(<span class="hljs-string">"åˆ é™¤task1ä»»åŠ¡...\r\n"</span>);
				vTaskDelete(task1_handler);
				task1_handler = <span class="hljs-literal">NULL</span>;
			}
		}
		vTaskDelay(<span class="hljs-number">500</span>);
	}
}

</code></pre>
<ul>
<li>FreeRTOS_demo.hä»£ç ï¼š</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __FREERTOS_DEMO_H</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> __FREERTOS_DEMO_H</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"FreeRTOS.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"task.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"main.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"Key.h"</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">FreeRTOS_Start</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;

<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

</code></pre>
<ul>
<li>main.cæ–‡ä»¶å¯¹åº”ä½ç½®åŠ å…¥ï¼š</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* USER CODE BEGIN Includes */</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"FreeRTOS_demo.h"</span></span>
<span class="hljs-comment">/* USER CODE END Includes */</span>

<span class="hljs-comment">/* USER CODE BEGIN 2 */</span>
FreeRTOS_Start();
<span class="hljs-comment">/* USER CODE END 2 */</span>
</code></pre>
<p><strong>è‡³æ­¤ï¼Œæ‰€æœ‰å·¥ä½œå®Œæˆï¼Œç¼–è¯‘å¹¶ä¸‹è½½ä»£ç å³å¯</strong></p>
<h2 data-id="heading-12">å››ã€æ€»ç»“</h2>
<p>æ‰å¼€å§‹å†™æ–‡ç« ï¼Œæ„Ÿè§‰æ–‡ç« å†™å¾—æœ‰ç‚¹ä¹±ï¼Œæœ‰ä»»ä½•æ„è§æˆ–è€…é—®é¢˜éƒ½å¯ä»¥ç§ä¿¡æˆ‘ï¼Œæˆ‘ä¹Ÿåˆšå¼€å§‹å­¦è¿™ä¸ªï¼Œå¤§å®¶å¯ä»¥ä¸€èµ·äº¤æµï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©åˆ°å¤§å®¶ï¼Œæ„Ÿè°¢ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jenkins + Kubernetes å¤šæ¨¡å—å¾®æœåŠ¡ä¸€é”®æµæ°´çº¿ï¼šä» Maven æ‰“åŒ…åˆ°æ»šåŠ¨å‘å¸ƒå®Œæ•´è„šæœ¬]]></title>    <link>https://juejin.cn/post/7577722399375376426</link>    <guid>https://juejin.cn/post/7577722399375376426</guid>    <pubDate>2025-11-29T16:14:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577722399375376426" data-draft-id="7577722399375048746" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jenkins + Kubernetes å¤šæ¨¡å—å¾®æœåŠ¡ä¸€é”®æµæ°´çº¿ï¼šä» Maven æ‰“åŒ…åˆ°æ»šåŠ¨å‘å¸ƒå®Œæ•´è„šæœ¬"/> <meta itemprop="keywords" content="Jenkins,Kubernetes"/> <meta itemprop="datePublished" content="2025-11-29T16:14:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èµ·é£äº†___"/> <meta itemprop="url" content="https://juejin.cn/user/3298190615395896"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jenkins + Kubernetes å¤šæ¨¡å—å¾®æœåŠ¡ä¸€é”®æµæ°´çº¿ï¼šä» Maven æ‰“åŒ…åˆ°æ»šåŠ¨å‘å¸ƒå®Œæ•´è„šæœ¬
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3298190615395896/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èµ·é£äº†___
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T16:14:09.000Z" title="Sat Nov 29 2025 16:14:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ–‡ç« ç®€ä»‹</h2>
<ul>
<li>ä¸Šæ¬¡å†™è¿‡ä¸€ç¯‡ä½¿ç”¨ Jenkins åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šéƒ¨ç½² docker é•œåƒçš„é€šç”¨è„šæœ¬ï¼Œè¿™æ¬¡è¿™ä»½è„šæœ¬æ˜¯åŸºäºä¸Šæ¬¡é‚£ä»½è„šæœ¬ä¿®æ”¹è€Œæ¥ï¼Œç”¨äº Kubernetes éƒ¨ç½²é•œåƒä½¿ç”¨ã€‚</li>
<li>Kubernetes éƒ¨ç½²ç›¸å…³ä¿¡æ¯å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPmae_-DmMGkyA89s6I6xqA" target="_blank" title="https://mp.weixin.qq.com/s/Pmae_-DmMGkyA89s6I6xqA" ref="nofollow noopener noreferrer">Kubernetes ç”Ÿäº§å…¥é—¨ï¼šDeployment ä¸ Service é…ç½®å®æˆ˜</a></li>
<li>æœ¬æ–‡ä»‹ç»çš„éƒ¨ç½²è„šæœ¬é€‚ç”¨äºå•å·¥ç¨‹ä¸‹å¤š module çš„å¾®æœåŠ¡ï¼Œå•å·¥ç¨‹æœåŠ¡éœ€è¦é˜…è¯»è„šæœ¬è‡ªè¡Œå¾®è°ƒã€‚ä¸è¿‡æˆ‘å»ºè®®ä½¿ç”¨æœ¬æ–‡è„šæœ¬çš„æ¯ä¸€ä½æœ‹å‹éƒ½èƒ½å¤Ÿé˜…è¯»æ‰€æœ‰çš„ä»£ç ï¼Œç¡®å®šæ˜¯å¦ç¬¦åˆè‡ªå·±çš„éœ€æ±‚ã€‚</li>
</ul>
<h2 data-id="heading-1">è„šæœ¬å˜é‡</h2>
<ul>
<li>å®šä¹‰ã€è®¾ç½®å˜é‡ä¸»è¦æ˜¯ä¸ºäº†å½¢æˆä¸€ä¸ª<strong>é€šç”¨å‹è„šæœ¬</strong>ï¼Œéƒ¨ç½²å¤šä¸ªæœåŠ¡å°¤å…¶å¾®æœåŠ¡æ—¶ï¼Œç¼–å†™å¥½ä¸€ä¸ªæµæ°´çº¿è„šæœ¬ï¼Œå…¶ä»–æµæ°´çº¿å¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼Œå¤åˆ¶ååªéœ€ä¿®æ”¹æ­¤å¤„å˜é‡å³å¯ã€‚</li>
<li>æ­¤å¤„æœ‰éƒ¨åˆ†å˜é‡åµŒå¥—ä½¿ç”¨ MODULE_NAMEã€MODULE_PATH å˜é‡å¤ç”¨ç›¸åŒå‚æ•°ï¼Œä½¿ç”¨æœ¬æ–‡è„šæœ¬çš„æœ‹å‹ä¸€å®šè¦è§‚å¯Ÿæ­¤å¤„çš„å˜é‡æ˜¯å¦ä¸ä½ ä»¬å·¥ç¨‹ä¸€è‡´ã€‚</li>
<li>å…·ä½“å‚æ•°ä¿¡æ¯ä»£ç ä¸­å·²æœ‰æ³¨é‡Šï¼Œä¸è¿‡å¤šèµ˜è¿°</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">environment {
    // æ¨¡å—ä¿¡æ¯
    <span class="hljs-attr">MODULE_NAME</span> = <span class="hljs-string">"xxx-service"</span> // æ¨¡å—åç§°
    <span class="hljs-attr">MODULE_PATH</span> = <span class="hljs-string">"./${MODULE_NAME}"</span> // æ¨¡å—è·¯å¾„ï¼Œé€‚ç”¨äºå¾®æœåŠ¡å¤š module
    // Git ä»“åº“é…ç½®
    <span class="hljs-attr">GIT_URL</span> = <span class="hljs-string">'git@git.xxx.com:xxx.git'</span> // æ›¿æ¢ä¸ºä½ çš„ä»£ç ä»“åº“
    <span class="hljs-attr">GIT_KEY_ACR_CRED</span> = <span class="hljs-string">'git-ssh-key'</span>
    <span class="hljs-attr">BRANCH</span> = <span class="hljs-string">'master'</span>
    // Docker é•œåƒç›¸å…³é…ç½®
    <span class="hljs-attr">DOCKER_IMAGE_REGISTRY</span> = <span class="hljs-string">'registry.xxx.aliyuncs.com'</span>  // æ›¿æ¢ä¸ºä½ çš„é•œåƒä»“åº“
    <span class="hljs-attr">DOCKER_IMAGE_ACR_CRED</span> = <span class="hljs-string">'docker-cred'</span>
    <span class="hljs-attr">IMAGE_PRE_NAME</span> = <span class="hljs-string">'xxxx'</span>  // é•œåƒåç§°å‰ç¼€
    <span class="hljs-attr">IMAGE_NAME</span> = <span class="hljs-string">"${MODULE_NAME}"</span>  // é•œåƒåç§°
    <span class="hljs-attr">DOCKERFILE</span> = <span class="hljs-string">"${MODULE_PATH}/Dockerfile"</span> // ç”¨æ¥æ„å»ºé•œåƒçš„ dockerfile æ–‡ä»¶
    // Kubernetes ç›¸å…³é…ç½®
    <span class="hljs-attr">KUBERNETES_CONFIG</span> = <span class="hljs-string">"kubernetes-config"</span> // Kubernetes é…ç½®æ–‡ä»¶å‡­è¯
    <span class="hljs-attr">RESOURCE_NAME</span> = <span class="hljs-string">"${MODULE_NAME}"</span> // èµ„æºç±»å‹åç§°ï¼Œè¿™é‡Œä¸º deployment åç§°
    <span class="hljs-attr">CONTAINER_NAME</span> = <span class="hljs-string">"${MODULE_NAME}"</span> // å®¹å™¨åç§°
}
</code></pre>
<h2 data-id="heading-2">å·¥å…·è®¾ç½®</h2>
<p>è¿™é‡Œè®¾ç½®æ„å»ºä»£ç çš„ Maven å·¥å…·</p>
<pre><code class="hljs language-groovy" lang="groovy">tools {
    // Install the Maven version configured as "M3" and add it to the path.
    maven "Maven3"
}
</code></pre>
<h2 data-id="heading-3">æ‹‰å–ä»£ç </h2>
<p>æ‹‰å–ä»“åº“ä¸­çš„ä»£ç </p>
<ul>
<li>git branch: BRANCHï¼šæŒ‡å®šæ‹‰å–çš„åˆ†æ”¯</li>
<li>url: GIT_URLï¼Œè®¾ç½®ä»£ç ä»“åº“åœ°å€</li>
<li>credentialsIdï¼šä»“åº“è®¿é—®å‡­æ®</li>
</ul>
<pre><code class="hljs language-groovy" lang="groovy">stage('Checkout') {
    steps {
        git branch: BRANCH, 
        url: GIT_URL,
        credentialsId: GIT_KEY_ACR_CRED
    }
}
</code></pre>
<h2 data-id="heading-4">æ‰“åŒ…</h2>
<p>ç”±äºæ˜¯å¤š module å¤šå¾®æœåŠ¡é¡¹ç›®ï¼Œæ­¤å¤„ä½¿ç”¨ mvn æŒ‡å®šæ¨¡å—æ‰“åŒ…å‘½ä»¤ï¼Œé˜²æ­¢æ„å»ºä¸ç›¸å…³æ¨¡å—,ä¸”æŒ‡å®šä¸º pro é…ç½®</p>
<pre><code class="hljs language-groovy" lang="groovy">stage('Package') {
    steps {
        // æ‰§è¡Œ Maven æ‰“åŒ…å‘½ä»¤ï¼Œåªæ‰“åŒ…æŒ‡å®šæ¨¡å—
        sh "mvn -pl ${MODULE_PATH} -am -B clean package -Ppro -Dfile.encoding=UTF-8 -DskipTests=true"
    }
}
</code></pre>
<h2 data-id="heading-5">æ„å»ºã€æ¨é€ Docker é•œåƒï¼Œåˆ é™¤æœ¬åœ°é•œåƒ</h2>
<ul>
<li>æ­¤å¤„ä½¿ç”¨å½“å‰æ—¶é—´ä¸ºé•œåƒè®¾ç½® tag</li>
<li>é•œåƒåç§°æ ¼å¼ï¼š&lt;é•œåƒä»“åº“åœ°å€&gt;/&lt;é•œåƒåç§°å‰ç¼€&gt;/&lt;åº”ç”¨åç§°&gt;:&lt;å½“å‰æ—¶é—´&gt;</li>
<li>sh "docker build -t ${fullImageNameWithTimestamp} ."
<ul>
<li>ä½¿ç”¨ docker æ„å»ºé•œåƒ</li>
</ul>
</li>
<li>withCredentials ä½¿ç”¨å‡­æ®ç™»é™†ã€æ¨é€é•œåƒ
<ul>
<li>ç™»é™†ä»“åº“ï¼š sh "docker login --username $REG_USER -p $REG_PASS $DOCKER_IMAGE_REGISTRY"</li>
<li>æ¨é€é•œåƒï¼šsh "docker push ${fullImageNameWithTimestamp}"</li>
<li>åˆ é™¤æœ¬åœ°é•œåƒï¼šsh "docker rmi ${fullImageNameWithTimestamp}"</li>
<li>å°†é•œåƒåç§°ä¿å­˜åˆ°ç¯å¢ƒå˜é‡ï¼Œä¾›åç»­æ­¥éª¤ä½¿ç”¨ï¼šenv.BUILT_IMAGE = fullImageNameWithTimestamp</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-groovy" lang="groovy">stage('Build Docker Image') {
    steps {
        script {
    
            // ç”Ÿæˆæ—¶é—´æˆ³
            def timestamp = new Date().format('yyyyMMddHHmm', TimeZone.getTimeZone('Asia/Shanghai'))
            def imageTag = "${IMAGE_NAME}:${timestamp}"
            def fullImageNameWithTimestamp = "${DOCKER_IMAGE_REGISTRY}/${IMAGE_PRE_NAME}/${imageTag}"
    
            // ä½¿ç”¨ Docker æ„å»ºé•œåƒ
            echo "Building Docker image: ${fullImageNameWithTimestamp}"
            sh "docker build -t ${fullImageNameWithTimestamp} -f ${DOCKERFILE} ${MODULE_PATH}"
    
            withCredentials([usernamePassword(credentialsId: DOCKER_IMAGE_ACR_CRED, usernameVariable: 'REG_USER', passwordVariable: 'REG_PASS')]) {
                // ç™»å½•åˆ°é•œåƒä»“åº“
                echo "Login Docker..."
                sh "docker login --username $REG_USER -p $REG_PASS ${DOCKER_IMAGE_REGISTRY}"
                // æ¨é€é•œåƒ
                echo "Push Docker Image ${fullImageNameWithTimestamp}"
                sh "docker push ${fullImageNameWithTimestamp}"
                // æ¨é€å®Œæˆåï¼Œåˆ é™¤æœ¬åœ°é•œåƒ
                echo "Remove Docker Imag ${fullImageNameWithTimestamp}"
                sh "docker rmi ${fullImageNameWithTimestamp}"
            }
            
            // è¾“å‡ºæ„å»ºä¿¡æ¯
            echo "Successfully built and pushed image: ${fullImageNameWithTimestamp}"
            
            // å°†é•œåƒåç§°ä¿å­˜åˆ°ç¯å¢ƒå˜é‡ï¼Œä¾›åç»­æ­¥éª¤ä½¿ç”¨
            env.BUILT_IMAGE = fullImageNameWithTimestamp
        }
    }
}
</code></pre>
<h2 data-id="heading-6">éƒ¨ç½²åˆ°è¿œç¨‹ Kubernetes é›†ç¾¤</h2>
<ul>
<li>withCredentialsï¼šä½¿ç”¨å‡­æ®è¿æ¥ Kubernetes é›†ç¾¤</li>
<li>è®¾ç½®é›†ç¾¤è¿æ¥é…ç½®ï¼šsh "export KUBECONFIG=$KUBECONFIG"</li>
<li>è®¾ç½®é›†ç¾¤å¯¹åº” Deployment ä¸­çš„é•œåƒä¿¡æ¯ï¼šsh "kubectl set image deployment/<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>E</mi><mi>S</mi><mi>O</mi><mi>U</mi><mi>R</mi><mi>C</mi><msub><mi>E</mi><mi>N</mi></msub><mi>A</mi><mi>M</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">{RESOURCE_NAME} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">RESO</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.07153em;">RC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">ME</span></span></span></span></span></span>{CONTAINER_NAME}=${BUILT_IMAGE}"</li>
<li>å¤‡æ³¨ï¼šKubernetes é›†ç¾¤ä¸­ Deployment é…ç½®å†…é•œåƒä¿¡æ¯ä¿®æ”¹åï¼Œé›†ç¾¤ä¼šè‡ªè¡Œæ‹‰èµ·æ–°çš„ Podï¼Œå…³é—­æ—§çš„ Podã€‚</li>
</ul>
<pre><code class="hljs language-groovy" lang="groovy">stage('Deploy to Remote Kubernetes') {
    steps {
        script {
            withCredentials([file(credentialsId: KUBERNETES_CONFIG, variable: 'KUBECONFIG')]) {
                // è®¾ç½®KUBECONFIGç¯å¢ƒå˜é‡
                sh "export KUBECONFIG=$KUBECONFIG" 
                // æ›´æ–°Deploymentä¸­çš„é•œåƒä¿¡æ¯
                // kubectl set image &lt;èµ„æºç±»å‹&gt;/&lt;èµ„æºåç§°&gt; &lt;å®¹å™¨åç§°&gt;=&lt;æ–°é•œåƒ&gt;:&lt;æ ‡ç­¾&gt;
                sh "kubectl set image deployment/${RESOURCE_NAME} ${CONTAINER_NAME}=${BUILT_IMAGE}" 
            } 
        }
    }
}
</code></pre>
<h2 data-id="heading-7">é™„æºç </h2>
<pre><code class="hljs language-groovy" lang="groovy">pipeline {
    agent any

    environment {
        // æ¨¡å—ä¿¡æ¯
        MODULE_NAME = "xxx-servcie" // æ¨¡å—åç§°
        MODULE_PATH = "./${MODULE_NAME}" // æ¨¡å—è·¯å¾„ï¼Œé€‚ç”¨äºå¾®æœåŠ¡å¤š module
        // Git ä»“åº“é…ç½®
        GIT_URL = 'git@git.xxx.com:xxx.git' // æ›¿æ¢ä¸ºä½ çš„ä»£ç ä»“åº“
        GIT_KEY_ACR_CRED = 'git-ssh-key'
        BRANCH = 'master'
        // Docker é•œåƒç›¸å…³é…ç½®
        DOCKER_IMAGE_REGISTRY = 'registry.xxx.aliyuncs.com'  // æ›¿æ¢ä¸ºä½ çš„é•œåƒä»“åº“
        DOCKER_IMAGE_ACR_CRED = 'docker-cred'
        IMAGE_PRE_NAME = 'xxxx'  // é•œåƒåç§°å‰ç¼€
        IMAGE_NAME = "${MODULE_NAME}"  // é•œåƒåç§°
        DOCKERFILE = "${MODULE_PATH}/Dockerfile" // ç”¨æ¥æ„å»ºé•œåƒçš„ dockerfile æ–‡ä»¶
        // Kubernetes ç›¸å…³é…ç½®
        KUBERNETES_CONFIG = "kubernetes-config" // Kubernetes é…ç½®æ–‡ä»¶å‡­è¯
        RESOURCE_NAME = "${MODULE_NAME}" // èµ„æºç±»å‹åç§°ï¼Œè¿™é‡Œä¸º deployment åç§°
        CONTAINER_NAME = "${MODULE_NAME}" // å®¹å™¨åç§°
    }

    tools {
        // Install the Maven version configured as "M3" and add it to the path.
        maven "Maven3"
    }

    stages {

        stage('Checkout') {
            steps {
                git branch: BRANCH, 
                url: GIT_URL,
                credentialsId: GIT_KEY_ACR_CRED
            }
        }

        stage('Package') {
            steps {
                // æ‰§è¡Œ Maven æ‰“åŒ…å‘½ä»¤ï¼Œåªæ‰“åŒ…æŒ‡å®šæ¨¡å—
                sh "mvn -pl ${MODULE_PATH} -am -B clean package -Ppro -Dfile.encoding=UTF-8 -DskipTests=true"
            }
        }

        stage('Build Docker Image') {
            steps {
                script {

                    // ç”Ÿæˆæ—¶é—´æˆ³
                    def timestamp = new Date().format('yyyyMMddHHmm', TimeZone.getTimeZone('Asia/Shanghai'))
                    def imageTag = "${IMAGE_NAME}:${timestamp}"
                    def fullImageNameWithTimestamp = "${DOCKER_IMAGE_REGISTRY}/${IMAGE_PRE_NAME}/${imageTag}"

                    // ä½¿ç”¨ Docker æ„å»ºé•œåƒ
                    echo "Building Docker image: ${fullImageNameWithTimestamp}"
                    sh "docker build -t ${fullImageNameWithTimestamp} -f ${DOCKERFILE} ${MODULE_PATH}"

                    withCredentials([usernamePassword(credentialsId: DOCKER_IMAGE_ACR_CRED, usernameVariable: 'REG_USER', passwordVariable: 'REG_PASS')]) {
                        // ç™»å½•åˆ°é•œåƒä»“åº“
                        echo "Login Docker..."
                        sh "docker login --username $REG_USER -p $REG_PASS ${DOCKER_IMAGE_REGISTRY}"
                        // æ¨é€é•œåƒ
                        echo "Push Docker Image ${fullImageNameWithTimestamp}"
                        sh "docker push ${fullImageNameWithTimestamp}"
                        // æ¨é€å®Œæˆåï¼Œåˆ é™¤æœ¬åœ°é•œåƒ
                        echo "Remove Docker Imag ${fullImageNameWithTimestamp}"
                        sh "docker rmi ${fullImageNameWithTimestamp}"
                    }
                    
                    // è¾“å‡ºæ„å»ºä¿¡æ¯
                    echo "Successfully built and pushed image: ${fullImageNameWithTimestamp}"
                    
                    // å°†é•œåƒåç§°ä¿å­˜åˆ°ç¯å¢ƒå˜é‡ï¼Œä¾›åç»­æ­¥éª¤ä½¿ç”¨
                    env.BUILT_IMAGE = fullImageNameWithTimestamp
                }
            }
        }


        stage('Deploy to Remote Kubernetes') {
            steps {
                script {
                    withCredentials([file(credentialsId: KUBERNETES_CONFIG, variable: 'KUBECONFIG')]) {
                        // è®¾ç½®KUBECONFIGç¯å¢ƒå˜é‡
                        sh "export KUBECONFIG=$KUBECONFIG" 
                        // æ›´æ–°Deploymentä¸­çš„é•œåƒ
                        // kubectl set image &lt;èµ„æºç±»å‹&gt;/&lt;èµ„æºåç§°&gt; &lt;å®¹å™¨åç§°&gt;=&lt;æ–°é•œåƒ&gt;:&lt;æ ‡ç­¾&gt;
                        sh "kubectl set image deployment/${RESOURCE_NAME} ${CONTAINER_NAME}=${BUILT_IMAGE}" 
                    } 
                }
            }
        }


    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¸ƒå¼äº‹åŠ¡è¯¦è§£ï¼šä»ç†è®ºåˆ°å®è·µï¼ˆRocketMQ + Seataï¼‰]]></title>    <link>https://juejin.cn/post/7577675494068027418</link>    <guid>https://juejin.cn/post/7577675494068027418</guid>    <pubDate>2025-11-29T16:16:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577675494068027418" data-draft-id="7577431644069462067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¸ƒå¼äº‹åŠ¡è¯¦è§£ï¼šä»ç†è®ºåˆ°å®è·µï¼ˆRocketMQ + Seataï¼‰"/> <meta itemprop="keywords" content="RocketMQ,Java"/> <meta itemprop="datePublished" content="2025-11-29T16:16:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¸ƒå¼äº‹åŠ¡è¯¦è§£ï¼šä»ç†è®ºåˆ°å®è·µï¼ˆRocketMQ + Seataï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T16:16:21.000Z" title="Sat Nov 29 2025 16:16:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åˆ†å¸ƒå¼äº‹åŠ¡è¯¦è§£ï¼šä»ç†è®ºåˆ°å®è·µï¼ˆRocketMQ + Seataï¼‰</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨å¾®æœåŠ¡æ¶æ„æ—¥ç›Šæ™®åŠçš„ä»Šå¤©ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æˆä¸ºäº†æ¯ä¸ªåç«¯å¼€å‘è€…å¿…é¡»é¢å¯¹çš„æŒ‘æˆ˜ã€‚æœ¬æ–‡å°†ä»ç†è®ºåˆ°å®è·µï¼Œæ·±å…¥æ¢è®¨åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶ç»“åˆ RocketMQ å’Œ Seata æ¡†æ¶ç»™å‡ºå…·ä½“çš„ä»£ç ç¤ºä¾‹ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</h3>
<h4 data-id="heading-3">1.1 å•ä½“æ¶æ„ vs å¾®æœåŠ¡æ¶æ„</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------+          +------------------+</span>
|    å•ä½“åº”ç”¨       |          |    å¾®æœåŠ¡æ¶æ„     |
+<span class="hljs-comment">------------------+          +------------------+</span>
|                  |          |                  |
|  +<span class="hljs-comment">------------+  |          |  +-----------+   |</span>
|  |   è®¢å•     |  |          |  | è®¢å•æœåŠ¡  |   |
|  +<span class="hljs-comment">------------+  |          |  +-----------+   |</span>
|        |         |          |       |          |
|  +<span class="hljs-comment">------------+  |          |  +-----------+   |</span>
|  |   åº“å­˜     |  |          |  | åº“å­˜æœåŠ¡  |   |
|  +<span class="hljs-comment">------------+  |          |  +-----------+   |</span>
|        |         |          |       |          |
|  +<span class="hljs-comment">------------+  |          |  +-----------+   |</span>
|  |   è´¦æˆ·     |  |          |  | è´¦æˆ·æœåŠ¡  |   |
|  +<span class="hljs-comment">------------+  |          |  +-----------+   |</span>
|        |         |          |       |          |
|  +<span class="hljs-comment">------------+  |          |  +-----------+   |</span>
|  |  å•ä¸€æ•°æ®åº“ |  |          |  | å„è‡ªæ•°æ®åº“ |   |
|  +<span class="hljs-comment">------------+  |          |  +-----------+   |</span>
+<span class="hljs-comment">------------------+          +------------------+</span>
     æœ¬åœ°äº‹åŠ¡                     åˆ†å¸ƒå¼äº‹åŠ¡
</code></pre>
<h4 data-id="heading-4">1.2 å…¸å‹ä¸šåŠ¡åœºæ™¯</h4>
<p>ä»¥ç”µå•†ä¸‹å•ä¸ºä¾‹ï¼Œä¸€ä¸ªå®Œæ•´çš„ä¸‹å•æµç¨‹æ¶‰åŠï¼š</p>
<pre><code class="hljs language-diff" lang="diff">ç”¨æˆ·ä¸‹å•æµç¨‹ï¼š
<span class="hljs-addition">+--------+    +--------+    +--------+    +--------+</span>
|  åˆ›å»º  | -&gt; |  æ‰£å‡  | -&gt; |  æ‰£å‡  | -&gt; |  å‘é€  |
|  è®¢å•  |    |  åº“å­˜  |    |  ä½™é¢  |    |  é€šçŸ¥  |
<span class="hljs-addition">+--------+    +--------+    +--------+    +--------+</span>
    |             |             |             |
    v             v             v             v
<span class="hljs-addition">+--------+    +--------+    +--------+    +--------+</span>
| è®¢å•DB |    | åº“å­˜DB |    | è´¦æˆ·DB |    | æ¶ˆæ¯é˜Ÿåˆ—|
<span class="hljs-addition">+--------+    +--------+    +--------+    +--------+</span>
</code></pre>
<p><strong>é—®é¢˜æ¥äº†ï¼š</strong> å¦‚æœæ‰£å‡ä½™é¢å¤±è´¥ï¼Œä½†è®¢å•å·²åˆ›å»ºã€åº“å­˜å·²æ‰£å‡ï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</p>
<h4 data-id="heading-5">1.3 åˆ†å¸ƒå¼äº‹åŠ¡çš„æ ¸å¿ƒæŒ‘æˆ˜</h4>
<ol>
<li><strong>ç½‘ç»œä¸å¯é </strong>ï¼šæœåŠ¡é—´è°ƒç”¨å¯èƒ½è¶…æ—¶ã€å¤±è´¥</li>
<li><strong>æœåŠ¡ä¸å¯ç”¨</strong>ï¼šæŸä¸ªæœåŠ¡å¯èƒ½å®•æœº</li>
<li><strong>æ•°æ®ä¸ä¸€è‡´</strong>ï¼šéƒ¨åˆ†æ“ä½œæˆåŠŸï¼Œéƒ¨åˆ†å¤±è´¥</li>
<li><strong>å¹¶å‘é—®é¢˜</strong>ï¼šå¤šä¸ªäº‹åŠ¡åŒæ—¶æ“ä½œåŒä¸€èµ„æº</li>
</ol>
<hr/>
<h3 data-id="heading-6">äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡ç†è®ºåŸºç¡€</h3>
<h4 data-id="heading-7">2.1 CAP ç†è®º</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">                    C (Consistency)
                   ä¸€è‡´æ€§
                    /\
                   /  \
                  /    \
                 /      \
                /   CAP  \
               /    å®šç†   \
              /____________\
             /              \
   A (Availability)    P (Partition Tolerance)
      å¯ç”¨æ€§                 åˆ†åŒºå®¹é”™æ€§
</span>
CAPå®šç†ï¼šä¸‰è€…åªèƒ½åŒæ—¶æ»¡è¶³ä¸¤ä¸ª
<span class="hljs-bullet">-</span> CAï¼šæ”¾å¼ƒåˆ†åŒºå®¹é”™ï¼ˆå•æœºç³»ç»Ÿï¼‰
<span class="hljs-bullet">-</span> CPï¼šæ”¾å¼ƒå¯ç”¨æ€§ï¼ˆå¼ºä¸€è‡´æ€§ç³»ç»Ÿï¼‰
<span class="hljs-bullet">-</span> APï¼šæ”¾å¼ƒä¸€è‡´æ€§ï¼ˆé«˜å¯ç”¨ç³»ç»Ÿï¼‰
</code></pre>
<h4 data-id="heading-8">2.2 BASE ç†è®º</h4>
<ul>
<li><strong>Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰</strong>ï¼šå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§</li>
<li><strong>Soft Stateï¼ˆè½¯çŠ¶æ€ï¼‰</strong>ï¼šå…è®¸å­˜åœ¨ä¸­é—´çŠ¶æ€</li>
<li><strong>Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</strong>ï¼šç»è¿‡ä¸€æ®µæ—¶é—´åè¾¾åˆ°ä¸€è‡´</li>
</ul>
<h4 data-id="heading-9">2.3 å¸¸è§ä¸€è‡´æ€§æ¨¡å‹å¯¹æ¯”</h4>

























<table><thead><tr><th>æ¨¡å‹</th><th>æè¿°</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å¼ºä¸€è‡´æ€§</td><td>å†™å…¥åç«‹å³å¯è¯»</td><td>é‡‘èäº¤æ˜“</td></tr><tr><td>å¼±ä¸€è‡´æ€§</td><td>ä¸ä¿è¯ä½•æ—¶èƒ½è¯»åˆ°</td><td>æ—¥å¿—è®°å½•</td></tr><tr><td>æœ€ç»ˆä¸€è‡´æ€§</td><td>ä¸€æ®µæ—¶é—´åä¸€è‡´</td><td>ç”µå•†è®¢å•</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-10">ä¸‰ã€åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-11">3.1 æ–¹æ¡ˆå¯¹æ¯”</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------+----------+----------+----------+----------+</span>
|      æ–¹æ¡ˆ        | ä¸€è‡´æ€§   | æ€§èƒ½     | å¤æ‚åº¦   | é€‚ç”¨åœºæ™¯ |
<span class="hljs-addition">+------------------+----------+----------+----------+----------+</span>
| 2PC/3PC          | å¼º       | ä½       | ä¸­       | æ•°æ®åº“   |
| TCC              | å¼º       | ä¸­       | é«˜       | èµ„é‡‘ç±»   |
| æœ¬åœ°æ¶ˆæ¯è¡¨       | æœ€ç»ˆ     | é«˜       | ä¸­       | é€šç”¨     |
| äº‹åŠ¡æ¶ˆæ¯         | æœ€ç»ˆ     | é«˜       | ä½       | é€šç”¨     |
| Saga             | æœ€ç»ˆ     | é«˜       | ä¸­       | é•¿äº‹åŠ¡   |
| Seata AT         | å¼º       | ä¸­       | ä½       | é€šç”¨     |
<span class="hljs-addition">+------------------+----------+----------+----------+----------+</span>
</code></pre>
<h4 data-id="heading-12">3.2 ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰</h4>
<pre><code class="hljs language-sql" lang="sql">      åè°ƒè€…                    å‚ä¸è€…A                  å‚ä¸è€…B
        <span class="hljs-operator">|</span>                         <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span>     <span class="hljs-number">1.</span> <span class="hljs-keyword">Prepare</span>è¯·æ±‚      <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span><span class="hljs-comment">------------------------&gt;|                        |</span>
        <span class="hljs-operator">|</span>                         <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span>     <span class="hljs-number">1.</span> <span class="hljs-keyword">Prepare</span>è¯·æ±‚      <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span><span class="hljs-comment">-------------------------------------------------&gt;|</span>
        <span class="hljs-operator">|</span>                         <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span>     <span class="hljs-number">2.</span> å‡†å¤‡å°±ç»ª<span class="hljs-operator">/</span>å¤±è´¥    <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span><span class="hljs-operator">&lt;</span><span class="hljs-comment">------------------------|                        |</span>
        <span class="hljs-operator">|</span>                         <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span>     <span class="hljs-number">2.</span> å‡†å¤‡å°±ç»ª<span class="hljs-operator">/</span>å¤±è´¥    <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span><span class="hljs-operator">&lt;</span><span class="hljs-comment">-------------------------------------------------|</span>
        <span class="hljs-operator">|</span>                         <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span>     <span class="hljs-number">3.</span> <span class="hljs-keyword">Commit</span><span class="hljs-operator">/</span><span class="hljs-keyword">Rollback</span>  <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span><span class="hljs-comment">------------------------&gt;|                        |</span>
        <span class="hljs-operator">|</span>                         <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span>     <span class="hljs-number">3.</span> <span class="hljs-keyword">Commit</span><span class="hljs-operator">/</span><span class="hljs-keyword">Rollback</span>  <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
        <span class="hljs-operator">|</span><span class="hljs-comment">-------------------------------------------------&gt;|</span>
        <span class="hljs-operator">|</span>                         <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span>
</code></pre>
<p><strong>ç¼ºç‚¹</strong>ï¼šåŒæ­¥é˜»å¡ã€å•ç‚¹æ•…éšœã€æ•°æ®ä¸ä¸€è‡´é£é™©</p>
<h4 data-id="heading-13">3.3 TCCï¼ˆTry-Confirm-Cancelï¼‰</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">----------------------------------------------------------+</span>
|                        TCC æ¨¡å¼                           |
+<span class="hljs-comment">----------------------------------------------------------+</span>
|                                                          |
|   Tryé˜¶æ®µ          Confirmé˜¶æ®µ        Cancelé˜¶æ®µ          |
|   (èµ„æºé¢„ç•™)       (ç¡®è®¤æäº¤)         (å›æ»šé‡Šæ”¾)           |
|                                                          |
|   +<span class="hljs-comment">----------+     +----------+      +----------+        |</span>
|   | å†»ç»“åº“å­˜ |     | æ‰£å‡åº“å­˜ |      | è§£å†»åº“å­˜ |        |
|   +<span class="hljs-comment">----------+     +----------+      +----------+        |</span>
|        |                |                 |              |
|   +<span class="hljs-comment">----------+     +----------+      +----------+        |</span>
|   | å†»ç»“ä½™é¢ |     | æ‰£å‡ä½™é¢ |      | è§£å†»ä½™é¢ |        |
|   +<span class="hljs-comment">----------+     +----------+      +----------+        |</span>
|                                                          |
+<span class="hljs-comment">----------------------------------------------------------+</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">å››ã€Seata åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶</h3>
<h4 data-id="heading-15">4.1 Seata æ¶æ„</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                         Seata æ¶æ„                                |
+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                                                                   |
|                      +<span class="hljs-comment">---------------+                            |</span>
|                      |  TC (Server)  |                            |
|                      | äº‹åŠ¡åè°ƒè€…    |                            |
|                      +<span class="hljs-comment">---------------+                            |</span>
|                       /             \                             |
|                      /               \                            |
|            +<span class="hljs-comment">--------+                 +--------+                  |</span>
|            |   TM   |                 |   RM   |                  |
|            | äº‹åŠ¡   |                 | èµ„æº   |                  |
|            | ç®¡ç†å™¨ |                 | ç®¡ç†å™¨ |                  |
|            +<span class="hljs-comment">--------+                 +--------+                  |</span>
|                |                           |                      |
|           +<span class="hljs-comment">---------+                 +---------+                 |</span>
|           | ä¸šåŠ¡æœåŠ¡ |                 | æ•°æ®åº“  |                 |
|           +<span class="hljs-comment">---------+                 +---------+                 |</span>
|                                                                   |
+<span class="hljs-comment">------------------------------------------------------------------+</span>

TC (Transaction Coordinator): äº‹åŠ¡åè°ƒè€…ï¼Œç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çŠ¶æ€
TM (Transaction Manager): äº‹åŠ¡ç®¡ç†å™¨ï¼Œå®šä¹‰å…¨å±€äº‹åŠ¡èŒƒå›´
RM (Resource Manager): èµ„æºç®¡ç†å™¨ï¼Œç®¡ç†åˆ†æ”¯äº‹åŠ¡èµ„æº
</code></pre>
<h4 data-id="heading-16">4.2 Seata å››ç§æ¨¡å¼</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+--------+--------+--------+--------+</span>
|   AT   |  TCC   |  Saga  |   XA   |
<span class="hljs-addition">+--------+--------+--------+--------+</span>
| è‡ªåŠ¨   | æ‰‹åŠ¨   | é•¿äº‹åŠ¡ | å¼ºä¸€è‡´ |
| è¡¥å¿   | è¡¥å¿   | è¡¥å¿   | ä¸¤é˜¶æ®µ |
| ç®€å•   | å¤æ‚   | ä¸­ç­‰   | ç®€å•   |
| æœ€å¸¸ç”¨ | èµ„é‡‘ç±» | å¤æ‚æµç¨‹| æ•°æ®åº“ |
<span class="hljs-addition">+--------+--------+--------+--------+</span>
</code></pre>
<h4 data-id="heading-17">4.3 Seata AT æ¨¡å¼å®æˆ˜</h4>
<h5 data-id="heading-18">4.3.1 é¡¹ç›®ç»“æ„</h5>
<pre><code class="hljs language-bash" lang="bash">seata-demo/
â”œâ”€â”€ order-service/          <span class="hljs-comment"># è®¢å•æœåŠ¡</span>
â”œâ”€â”€ storage-service/        <span class="hljs-comment"># åº“å­˜æœåŠ¡</span>
â”œâ”€â”€ account-service/        <span class="hljs-comment"># è´¦æˆ·æœåŠ¡</span>
â””â”€â”€ business-service/       <span class="hljs-comment"># ä¸šåŠ¡å…¥å£æœåŠ¡</span>
</code></pre>
<h5 data-id="heading-19">4.3.2 Maven ä¾èµ–</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- pom.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Seata --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.seata<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Seata ä¸ Spring Cloud Alibaba é›†æˆ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2022.0.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MyBatis Plus --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.33<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h5 data-id="heading-20">4.3.3 é…ç½®æ–‡ä»¶</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">business-service</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/seata_order?useUnicode=true&amp;characterEncoding=utf8</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>

<span class="hljs-comment"># Seata é…ç½®</span>
<span class="hljs-attr">seata:</span>
  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">application-id:</span> <span class="hljs-string">${spring.application.name}</span>
  <span class="hljs-attr">tx-service-group:</span> <span class="hljs-string">my_tx_group</span>
  <span class="hljs-attr">service:</span>
    <span class="hljs-attr">vgroup-mapping:</span>
      <span class="hljs-attr">my_tx_group:</span> <span class="hljs-string">default</span>
  <span class="hljs-attr">registry:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">nacos</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span>
      <span class="hljs-attr">namespace:</span> <span class="hljs-string">""</span>
      <span class="hljs-attr">group:</span> <span class="hljs-string">SEATA_GROUP</span>
  <span class="hljs-attr">config:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">nacos</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span>
      <span class="hljs-attr">namespace:</span> <span class="hljs-string">""</span>
      <span class="hljs-attr">group:</span> <span class="hljs-string">SEATA_GROUP</span>
</code></pre>
<h5 data-id="heading-21">4.3.4 æ•°æ®åº“è¡¨ç»“æ„</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è®¢å•æ•°æ®åº“</span>
<span class="hljs-keyword">CREATE</span> DATABASE seata_order;
USE seata_order;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_order` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
    `user_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç”¨æˆ·ID'</span>,
    `product_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å•†å“ID'</span>,
    `count` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ•°é‡'</span>,
    `money` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">11</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'é‡‘é¢'</span>,
    `status` <span class="hljs-type">INT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è®¢å•çŠ¶æ€ï¼š0åˆ›å»ºä¸­ï¼Œ1å·²å®Œæˆ'</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;

<span class="hljs-comment">-- Seata AT æ¨¡å¼éœ€è¦çš„ undo_log è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `undo_log` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
    `branch_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    `xid` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    `context` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    `rollback_info` LONGBLOB <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    `log_status` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    `log_created` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    `log_modified` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    <span class="hljs-keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;

<span class="hljs-comment">-- åº“å­˜æ•°æ®åº“</span>
<span class="hljs-keyword">CREATE</span> DATABASE seata_storage;
USE seata_storage;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_storage` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
    `product_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å•†å“ID'</span>,
    `total` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ€»åº“å­˜'</span>,
    `used` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å·²ç”¨åº“å­˜'</span>,
    `residue` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‰©ä½™åº“å­˜'</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_storage <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>);

<span class="hljs-comment">-- è´¦æˆ·æ•°æ®åº“</span>
<span class="hljs-keyword">CREATE</span> DATABASE seata_account;
USE seata_account;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_account` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
    `user_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç”¨æˆ·ID'</span>,
    `total` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ€»é¢åº¦'</span>,
    `used` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å·²ç”¨é¢åº¦'</span>,
    `residue` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‰©ä½™é¢åº¦'</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_account <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>);
</code></pre>
<h5 data-id="heading-22">4.3.5 æ ¸å¿ƒä»£ç å®ç°</h5>
<p><strong>è®¢å•å®ä½“ç±»</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("t_order")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> Long productId;
    <span class="hljs-keyword">private</span> Integer count;
    <span class="hljs-keyword">private</span> BigDecimal money;
    <span class="hljs-keyword">private</span> Integer status;
}
</code></pre>
<p><strong>è®¢å•æœåŠ¡æ¥å£</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">/**
     * åˆ›å»ºè®¢å•
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, Long productId, Integer count, BigDecimal money)</span>;
}
</code></pre>
<p><strong>è®¢å•æœåŠ¡å®ç°</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StorageClient storageClient;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AccountClient accountClient;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, Long productId, Integer count, BigDecimal money)</span> {
        log.info(<span class="hljs-string">"========== å¼€å§‹åˆ›å»ºè®¢å• =========="</span>);

        <span class="hljs-comment">// 1. åˆ›å»ºè®¢å•</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        order.setUserId(userId);
        order.setProductId(productId);
        order.setCount(count);
        order.setMoney(money);
        order.setStatus(<span class="hljs-number">0</span>);
        orderMapper.insert(order);

        <span class="hljs-comment">// 2. æ‰£å‡åº“å­˜</span>
        log.info(<span class="hljs-string">"========== è®¢å•æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡ï¼Œæ‰£å‡åº“å­˜ =========="</span>);
        storageClient.decrease(productId, count);

        <span class="hljs-comment">// 3. æ‰£å‡è´¦æˆ·ä½™é¢</span>
        log.info(<span class="hljs-string">"========== è®¢å•æœåŠ¡è°ƒç”¨è´¦æˆ·æœåŠ¡ï¼Œæ‰£å‡ä½™é¢ =========="</span>);
        accountClient.decrease(userId, money);

        <span class="hljs-comment">// 4. ä¿®æ”¹è®¢å•çŠ¶æ€</span>
        log.info(<span class="hljs-string">"========== ä¿®æ”¹è®¢å•çŠ¶æ€ =========="</span>);
        order.setStatus(<span class="hljs-number">1</span>);
        orderMapper.updateById(order);

        log.info(<span class="hljs-string">"========== è®¢å•åˆ›å»ºå®Œæˆ =========="</span>);
    }
}
</code></pre>
<p><strong>åº“å­˜æœåŠ¡ Feign å®¢æˆ·ç«¯</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FeignClient(value = "storage-service")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">StorageClient</span> {

    <span class="hljs-meta">@PostMapping("/storage/decrease")</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrease</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("productId")</span> Long productId,
                  <span class="hljs-meta">@RequestParam("count")</span> Integer count)</span>;
}
</code></pre>
<p><strong>è´¦æˆ·æœåŠ¡ Feign å®¢æˆ·ç«¯</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FeignClient(value = "account-service")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AccountClient</span> {

    <span class="hljs-meta">@PostMapping("/account/decrease")</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrease</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("userId")</span> Long userId,
                  <span class="hljs-meta">@RequestParam("money")</span> BigDecimal money)</span>;
}
</code></pre>
<p><strong>åº“å­˜æœåŠ¡å®ç°</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StorageServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">StorageService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StorageMapper storageMapper;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrease</span><span class="hljs-params">(Long productId, Integer count)</span> {
        log.info(<span class="hljs-string">"========== æ‰£å‡åº“å­˜å¼€å§‹ =========="</span>);
        storageMapper.decrease(productId, count);
        log.info(<span class="hljs-string">"========== æ‰£å‡åº“å­˜ç»“æŸ =========="</span>);
    }
}
</code></pre>
<p><strong>è´¦æˆ·æœåŠ¡å®ç°</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccountServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AccountService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AccountMapper accountMapper;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrease</span><span class="hljs-params">(Long userId, BigDecimal money)</span> {
        log.info(<span class="hljs-string">"========== æ‰£å‡è´¦æˆ·ä½™é¢å¼€å§‹ =========="</span>);

        <span class="hljs-comment">// æ¨¡æ‹Ÿè¶…æ—¶å¼‚å¸¸ï¼Œæµ‹è¯•åˆ†å¸ƒå¼äº‹åŠ¡å›æ»š</span>
        <span class="hljs-comment">// try {</span>
        <span class="hljs-comment">//     TimeUnit.SECONDS.sleep(20);</span>
        <span class="hljs-comment">// } catch (InterruptedException e) {</span>
        <span class="hljs-comment">//     e.printStackTrace();</span>
        <span class="hljs-comment">// }</span>

        accountMapper.decrease(userId, money);
        log.info(<span class="hljs-string">"========== æ‰£å‡è´¦æˆ·ä½™é¢ç»“æŸ =========="</span>);
    }
}
</code></pre>
<p><strong>ä¸šåŠ¡å…¥å£ - ä½¿ç”¨ @GlobalTransactional å¼€å¯å…¨å±€äº‹åŠ¡</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/business")</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;

    <span class="hljs-comment">/**
     * ä¸‹å•æ¥å£
     * <span class="hljs-doctag">@GlobalTransactional</span> å¼€å¯ Seata å…¨å±€äº‹åŠ¡
     */</span>
    <span class="hljs-meta">@PostMapping("/purchase")</span>
    <span class="hljs-meta">@GlobalTransactional(name = "purchase-order", rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">purchase</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Long userId,
                           <span class="hljs-meta">@RequestParam</span> Long productId,
                           <span class="hljs-meta">@RequestParam</span> Integer count,
                           <span class="hljs-meta">@RequestParam</span> BigDecimal money)</span> {
        log.info(<span class="hljs-string">"========== å¼€å§‹å…¨å±€äº‹åŠ¡ï¼ŒXID: {} =========="</span>, RootContext.getXID());

        orderService.createOrder(userId, productId, count, money);

        <span class="hljs-keyword">return</span> <span class="hljs-string">"ä¸‹å•æˆåŠŸ"</span>;
    }
}
</code></pre>
<h4 data-id="heading-23">4.4 Seata TCC æ¨¡å¼å®æˆ˜</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * TCC æ¥å£å®šä¹‰
 */</span>
<span class="hljs-meta">@LocalTCC</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AccountTccService</span> {

    <span class="hljs-comment">/**
     * Try: å†»ç»“é‡‘é¢
     */</span>
    <span class="hljs-meta">@TwoPhaseBusinessAction(name = "accountTcc", commitMethod = "confirm", rollbackMethod = "cancel")</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryFreeze</span><span class="hljs-params">(<span class="hljs-meta">@BusinessActionContextParameter(paramName = "userId")</span> Long userId,
                      <span class="hljs-meta">@BusinessActionContextParameter(paramName = "money")</span> BigDecimal money)</span>;

    <span class="hljs-comment">/**
     * Confirm: ç¡®è®¤æ‰£æ¬¾
     */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(BusinessActionContext context)</span>;

    <span class="hljs-comment">/**
     * Cancel: è§£å†»é‡‘é¢
     */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(BusinessActionContext context)</span>;
}

<span class="hljs-comment">/**
 * TCC å®ç°
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccountTccServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AccountTccService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AccountMapper accountMapper;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryFreeze</span><span class="hljs-params">(Long userId, BigDecimal money)</span> {
        log.info(<span class="hljs-string">"========== Try: å†»ç»“é‡‘é¢ userId={}, money={} =========="</span>, userId, money);

        <span class="hljs-comment">// æ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectByUserId(userId);
        <span class="hljs-keyword">if</span> (account.getResidue().compareTo(money) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ä½™é¢ä¸è¶³"</span>);
        }

        <span class="hljs-comment">// å†»ç»“é‡‘é¢ï¼šresidue -= money, frozen += money</span>
        accountMapper.freeze(userId, money);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(BusinessActionContext context)</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> Long.valueOf(context.getActionContext(<span class="hljs-string">"userId"</span>).toString());
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">money</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(context.getActionContext(<span class="hljs-string">"money"</span>).toString());

        log.info(<span class="hljs-string">"========== Confirm: ç¡®è®¤æ‰£æ¬¾ userId={}, money={} =========="</span>, userId, money);

        <span class="hljs-comment">// ç¡®è®¤æ‰£æ¬¾ï¼šfrozen -= money, used += money</span>
        accountMapper.confirmDecrease(userId, money);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(BusinessActionContext context)</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> Long.valueOf(context.getActionContext(<span class="hljs-string">"userId"</span>).toString());
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">money</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(context.getActionContext(<span class="hljs-string">"money"</span>).toString());

        log.info(<span class="hljs-string">"========== Cancel: è§£å†»é‡‘é¢ userId={}, money={} =========="</span>, userId, money);

        <span class="hljs-comment">// è§£å†»é‡‘é¢ï¼šfrozen -= money, residue += money</span>
        accountMapper.cancelFreeze(userId, money);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-24">äº”ã€RocketMQ äº‹åŠ¡æ¶ˆæ¯</h3>
<h4 data-id="heading-25">5.1 äº‹åŠ¡æ¶ˆæ¯åŸç†</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------------------------+</span>
<span class="hljs-operator">|</span>                     RocketMQ äº‹åŠ¡æ¶ˆæ¯æµç¨‹                               <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------------------------+</span>
<span class="hljs-operator">|</span>                                                                        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>   ç”Ÿäº§è€…                         Broker                    æ¶ˆè´¹è€…       <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>                              <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>  <span class="hljs-number">1.</span> å‘é€Halfæ¶ˆæ¯             <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span><span class="hljs-comment">-----------------------------&gt;|                          |        |</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>                              <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>  <span class="hljs-number">2.</span> è¿”å›å‘é€ç»“æœ             <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span><span class="hljs-operator">&lt;</span><span class="hljs-comment">-----------------------------|                          |        |</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>                              <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>  <span class="hljs-number">3.</span> æ‰§è¡Œæœ¬åœ°äº‹åŠ¡             <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span><span class="hljs-comment">----+                         |                          |        |</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>    <span class="hljs-operator">|</span>                         <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span><span class="hljs-operator">&lt;</span><span class="hljs-comment">---+                         |                          |        |</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>                              <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>  <span class="hljs-number">4.</span> æäº¤<span class="hljs-operator">/</span>å›æ»šäº‹åŠ¡çŠ¶æ€        <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span><span class="hljs-comment">-----------------------------&gt;|                          |        |</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>                              <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>                              <span class="hljs-operator">|</span>  <span class="hljs-number">5.</span> æŠ•é€’æ¶ˆæ¯(<span class="hljs-keyword">Commit</span>)     <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>                              <span class="hljs-operator">|</span><span class="hljs-comment">-------------------------&gt;|        |</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>                              <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>  å›æŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€(è¶…æ—¶æœªç¡®è®¤)  <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span><span class="hljs-operator">&lt;</span><span class="hljs-comment">-----------------------------|                          |        |</span>
<span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>                              <span class="hljs-operator">|</span>                          <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------------------------+</span>
</code></pre>
<h4 data-id="heading-26">5.2 äº‹åŠ¡æ¶ˆæ¯çŠ¶æ€</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">+</span><span class="hljs-comment">------------------+------------------+------------------+</span>
<span class="hljs-operator">|</span>    <span class="hljs-keyword">COMMIT</span>        <span class="hljs-operator">|</span>    <span class="hljs-keyword">ROLLBACK</span>      <span class="hljs-operator">|</span>    UNKNOW        <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">------------------+------------------+------------------+</span>
<span class="hljs-operator">|</span>  æäº¤æ¶ˆæ¯        <span class="hljs-operator">|</span>  å›æ»šæ¶ˆæ¯        <span class="hljs-operator">|</span>  æœªçŸ¥çŠ¶æ€        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  æ¶ˆè´¹è€…å¯è§      <span class="hljs-operator">|</span>  æ¶ˆæ¯è¢«åˆ é™¤      <span class="hljs-operator">|</span>  è§¦å‘å›æŸ¥        <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">------------------+------------------+------------------+</span>
</code></pre>
<h4 data-id="heading-27">5.3 Maven ä¾èµ–</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.rocketmq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rocketmq-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-28">5.4 é…ç½®æ–‡ä»¶</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">rocketmq:</span>
  <span class="hljs-attr">name-server:</span> <span class="hljs-string">localhost:9876</span>
  <span class="hljs-attr">producer:</span>
    <span class="hljs-attr">group:</span> <span class="hljs-string">tx-producer-group</span>
    <span class="hljs-attr">send-message-timeout:</span> <span class="hljs-number">3000</span>
</code></pre>
<h4 data-id="heading-29">5.5 äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionProducerService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RocketMQTemplate rocketMQTemplate;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;

    <span class="hljs-comment">/**
     * å‘é€äº‹åŠ¡æ¶ˆæ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendTransactionMessage</span><span class="hljs-params">(OrderDTO orderDTO)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">transactionId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();

        Message&lt;OrderDTO&gt; message = MessageBuilder
                .withPayload(orderDTO)
                .setHeader(<span class="hljs-string">"transactionId"</span>, transactionId)
                .build();

        <span class="hljs-comment">// å‘é€äº‹åŠ¡æ¶ˆæ¯</span>
        <span class="hljs-type">TransactionSendResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> rocketMQTemplate.sendMessageInTransaction(
                <span class="hljs-string">"order-topic:create"</span>,  <span class="hljs-comment">// topic:tag</span>
                message,
                orderDTO  <span class="hljs-comment">// arg å‚æ•°ï¼Œä¼ é€’ç»™æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå™¨</span>
        );

        log.info(<span class="hljs-string">"äº‹åŠ¡æ¶ˆæ¯å‘é€ç»“æœ: {}, transactionId: {}"</span>,
                result.getLocalTransactionState(), transactionId);
    }
}
</code></pre>
<h4 data-id="heading-30">5.6 äº‹åŠ¡ç›‘å¬å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RocketMQTransactionListener</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTransactionListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQLocalTransactionListener</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TransactionLogMapper transactionLogMapper;

    <span class="hljs-comment">/**
     * æ‰§è¡Œæœ¬åœ°äº‹åŠ¡
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> RocketMQLocalTransactionState <span class="hljs-title function_">executeLocalTransaction</span><span class="hljs-params">(Message msg, Object arg)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">transactionId</span> <span class="hljs-operator">=</span> (String) msg.getHeaders().get(<span class="hljs-string">"transactionId"</span>);
        <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">orderDTO</span> <span class="hljs-operator">=</span> (OrderDTO) arg;

        log.info(<span class="hljs-string">"========== æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ŒtransactionId: {} =========="</span>, transactionId);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. åˆ›å»ºè®¢å•</span>
            <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
            order.setUserId(orderDTO.getUserId());
            order.setProductId(orderDTO.getProductId());
            order.setCount(orderDTO.getCount());
            order.setMoney(orderDTO.getMoney());
            order.setStatus(<span class="hljs-number">0</span>);
            orderMapper.insert(order);

            <span class="hljs-comment">// 2. è®°å½•äº‹åŠ¡æ—¥å¿—ï¼ˆç”¨äºå›æŸ¥ï¼‰</span>
            <span class="hljs-type">TransactionLog</span> <span class="hljs-variable">txLog</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionLog</span>();
            txLog.setTransactionId(transactionId);
            txLog.setOrderId(order.getId());
            txLog.setStatus(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 1: å·²æäº¤</span>
            transactionLogMapper.insert(txLog);

            log.info(<span class="hljs-string">"æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œæäº¤æ¶ˆæ¯"</span>);
            <span class="hljs-keyword">return</span> RocketMQLocalTransactionState.COMMIT;

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œå›æ»šæ¶ˆæ¯"</span>, e);
            <span class="hljs-keyword">return</span> RocketMQLocalTransactionState.ROLLBACK;
        }
    }

    <span class="hljs-comment">/**
     * å›æŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> RocketMQLocalTransactionState <span class="hljs-title function_">checkLocalTransaction</span><span class="hljs-params">(Message msg)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">transactionId</span> <span class="hljs-operator">=</span> (String) msg.getHeaders().get(<span class="hljs-string">"transactionId"</span>);

        log.info(<span class="hljs-string">"========== å›æŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€ï¼ŒtransactionId: {} =========="</span>, transactionId);

        <span class="hljs-comment">// æŸ¥è¯¢äº‹åŠ¡æ—¥å¿—</span>
        <span class="hljs-type">TransactionLog</span> <span class="hljs-variable">txLog</span> <span class="hljs-operator">=</span> transactionLogMapper.selectByTransactionId(transactionId);

        <span class="hljs-keyword">if</span> (txLog != <span class="hljs-literal">null</span> &amp;&amp; txLog.getStatus() == <span class="hljs-number">1</span>) {
            log.info(<span class="hljs-string">"æœ¬åœ°äº‹åŠ¡å·²æäº¤"</span>);
            <span class="hljs-keyword">return</span> RocketMQLocalTransactionState.COMMIT;
        }

        log.info(<span class="hljs-string">"æœ¬åœ°äº‹åŠ¡æœªæäº¤ï¼Œå›æ»šæ¶ˆæ¯"</span>);
        <span class="hljs-keyword">return</span> RocketMQLocalTransactionState.ROLLBACK;
    }
}
</code></pre>
<h4 data-id="heading-31">5.7 äº‹åŠ¡æ¶ˆæ¯æ¶ˆè´¹è€…</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RocketMQMessageListener(
        topic = "order-topic",
        selectorExpression = "create",
        consumerGroup = "order-consumer-group"
)</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTransactionConsumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQListener</span>&lt;OrderDTO&gt; {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StorageService storageService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AccountService accountService;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(OrderDTO orderDTO)</span> {
        log.info(<span class="hljs-string">"========== æ”¶åˆ°è®¢å•æ¶ˆæ¯: {} =========="</span>, orderDTO);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ‰£å‡åº“å­˜</span>
            storageService.decrease(orderDTO.getProductId(), orderDTO.getCount());

            <span class="hljs-comment">// æ‰£å‡è´¦æˆ·ä½™é¢</span>
            accountService.decrease(orderDTO.getUserId(), orderDTO.getMoney());

            log.info(<span class="hljs-string">"è®¢å•å¤„ç†å®Œæˆ"</span>);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"è®¢å•å¤„ç†å¤±è´¥"</span>, e);
            <span class="hljs-comment">// æ¶ˆè´¹å¤±è´¥ä¼šè‡ªåŠ¨é‡è¯•</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è®¢å•å¤„ç†å¤±è´¥"</span>, e);
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-32">å…­ã€æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆ</h3>
<h4 data-id="heading-33">6.1 æ¶æ„å›¾</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                      æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆ                                |
+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                                                                   |
|   æœåŠ¡A                                      æœåŠ¡B                 |
|   +<span class="hljs-comment">------------------+                      +------------------+  |</span>
|   |    ä¸šåŠ¡æ“ä½œ      |                      |    ä¸šåŠ¡æ“ä½œ      |  |
|   +<span class="hljs-comment">--------+---------+                      +--------+---------+  |</span>
|            |                                         ^            |
|            v                                         |            |
|   +<span class="hljs-comment">------------------+                      +------------------+  |</span>
|   |   æœ¬åœ°æ¶ˆæ¯è¡¨     |                      |   æ¶ˆæ¯æ¶ˆè´¹       |  |
|   +<span class="hljs-comment">--------+---------+                      +--------+---------+  |</span>
|            |                                         ^            |
|            |         æ¶ˆæ¯é˜Ÿåˆ—                        |            |
|            |    +<span class="hljs-comment">-----------------+                  |            |</span>
|            +<span class="hljs-comment">---&gt;|     MQ          |------------------+            |</span>
|                 +<span class="hljs-comment">-----------------+                               |</span>
|                         ^                                         |
|                         |                                         |
|                 +<span class="hljs-comment">-----------------+                               |</span>
|                 |   å®šæ—¶ä»»åŠ¡      |                               |
|                 |  (æ‰«ææœªå‘é€)   |                               |
|                 +<span class="hljs-comment">-----------------+                               |</span>
|                                                                   |
+<span class="hljs-comment">------------------------------------------------------------------+</span>
</code></pre>
<h4 data-id="heading-34">6.2 æ¶ˆæ¯è¡¨ç»“æ„</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `local_message` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
    `message_id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¶ˆæ¯ID'</span>,
    `message_body` TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¶ˆæ¯å†…å®¹'</span>,
    `message_topic` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¶ˆæ¯ä¸»é¢˜'</span>,
    `message_tag` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¶ˆæ¯æ ‡ç­¾'</span>,
    `status` TINYINT(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'çŠ¶æ€: 0-å¾…å‘é€, 1-å·²å‘é€, 2-å·²ç¡®è®¤'</span>,
    `retry_count` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'é‡è¯•æ¬¡æ•°'</span>,
    `create_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_message_id` (`message_id`),
    KEY `idx_status` (`status`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;
</code></pre>
<h4 data-id="heading-35">6.3 æ ¸å¿ƒä»£ç å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalMessageService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LocalMessageMapper messageMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RocketMQTemplate rocketMQTemplate;

    <span class="hljs-comment">/**
     * ä¿å­˜æœ¬åœ°æ¶ˆæ¯ï¼ˆä¸ä¸šåŠ¡æ“ä½œåœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveMessage</span><span class="hljs-params">(String topic, String tag, Object payload)</span> {
        <span class="hljs-type">LocalMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalMessage</span>();
        message.setMessageId(UUID.randomUUID().toString());
        message.setMessageTopic(topic);
        message.setMessageTag(tag);
        message.setMessageBody(JSON.toJSONString(payload));
        message.setStatus(<span class="hljs-number">0</span>);
        message.setRetryCount(<span class="hljs-number">0</span>);

        messageMapper.insert(message);
    }

    <span class="hljs-comment">/**
     * å‘é€æ¶ˆæ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(LocalMessage message)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">destination</span> <span class="hljs-operator">=</span> message.getMessageTag() != <span class="hljs-literal">null</span>
                    ? message.getMessageTopic() + <span class="hljs-string">":"</span> + message.getMessageTag()
                    : message.getMessageTopic();

            rocketMQTemplate.syncSend(destination, message.getMessageBody());

            <span class="hljs-comment">// æ›´æ–°çŠ¶æ€ä¸ºå·²å‘é€</span>
            message.setStatus(<span class="hljs-number">1</span>);
            messageMapper.updateById(message);

            log.info(<span class="hljs-string">"æ¶ˆæ¯å‘é€æˆåŠŸ: {}"</span>, message.getMessageId());

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆæ¯å‘é€å¤±è´¥: {}"</span>, message.getMessageId(), e);

            <span class="hljs-comment">// å¢åŠ é‡è¯•æ¬¡æ•°</span>
            message.setRetryCount(message.getRetryCount() + <span class="hljs-number">1</span>);
            messageMapper.updateById(message);
        }
    }

    <span class="hljs-comment">/**
     * ç¡®è®¤æ¶ˆæ¯ï¼ˆæ¶ˆè´¹æˆåŠŸåè°ƒç”¨ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">confirmMessage</span><span class="hljs-params">(String messageId)</span> {
        <span class="hljs-type">LocalMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> messageMapper.selectByMessageId(messageId);
        <span class="hljs-keyword">if</span> (message != <span class="hljs-literal">null</span>) {
            message.setStatus(<span class="hljs-number">2</span>);
            messageMapper.updateById(message);
        }
    }
}
</code></pre>
<h4 data-id="heading-36">6.4 å®šæ—¶ä»»åŠ¡æ‰«æå‘é€</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageSendTask</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LocalMessageMapper messageMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LocalMessageService messageService;

    <span class="hljs-comment">/**
     * æ¯éš”10ç§’æ‰«æä¸€æ¬¡å¾…å‘é€æ¶ˆæ¯
     */</span>
    <span class="hljs-meta">@Scheduled(fixedRate = 10000)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scanAndSendMessage</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æŸ¥è¯¢å¾…å‘é€çš„æ¶ˆæ¯ï¼ˆstatus=0 ä¸”é‡è¯•æ¬¡æ•°å°äº5ï¼‰</span>
        List&lt;LocalMessage&gt; messages = messageMapper.selectPendingMessages(<span class="hljs-number">5</span>);

        <span class="hljs-keyword">for</span> (LocalMessage message : messages) {
            log.info(<span class="hljs-string">"æ‰«æåˆ°å¾…å‘é€æ¶ˆæ¯: {}"</span>, message.getMessageId());
            messageService.sendMessage(message);
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-37">ä¸ƒã€æœ€ä½³å®è·µä¸é€‰å‹å»ºè®®</h3>
<h4 data-id="heading-38">7.1 æ–¹æ¡ˆé€‰å‹å†³ç­–æ ‘</h4>
<pre><code class="hljs language-lua" lang="lua">                        å¼€å§‹é€‰å‹
                           |
                           v
                    +<span class="hljs-comment">-------------+</span>
                    | æ˜¯å¦éœ€è¦    |
                    | å¼ºä¸€è‡´æ€§?   |
                    +<span class="hljs-comment">------+------+</span>
                           |
              +<span class="hljs-comment">------------+------------+</span>
              |                         |
              v                         v
             æ˜¯                        å¦
              |                         |
              v                         v
      +<span class="hljs-comment">-------+-------+         +-------+-------+</span>
      | ä¸šåŠ¡èƒ½å¦      |         | è€ƒè™‘æœ€ç»ˆ      |
      | æ¥å—æ€§èƒ½æŸè€—? |         | ä¸€è‡´æ€§æ–¹æ¡ˆ    |
      +<span class="hljs-comment">-------+-------+         +-------+-------+</span>
              |                         |
      +<span class="hljs-comment">-------+-------+         +-------+-------+</span>
      |               |         |               |
      v               v         v               v
     æ˜¯              å¦      äº‹åŠ¡æ¶ˆæ¯      æœ¬åœ°æ¶ˆæ¯è¡¨
      |               |         |               |
      v               v         v               v
  Seata AT        Seata TCC   RocketMQ      å¯é æ€§è¦æ±‚é«˜
</code></pre>
<h4 data-id="heading-39">7.2 å„æ–¹æ¡ˆé€‚ç”¨åœºæ™¯</h4>



































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>é€‚ç”¨åœºæ™¯</th><th>å…¸å‹æ¡ˆä¾‹</th></tr></thead><tbody><tr><td>Seata AT</td><td>å¸¸è§„ä¸šåŠ¡ã€å¯¹ä¸€è‡´æ€§è¦æ±‚é«˜</td><td>è®¢å•åˆ›å»ºã€åº“å­˜æ‰£å‡</td></tr><tr><td>Seata TCC</td><td>èµ„é‡‘ç±»ä¸šåŠ¡ã€éœ€è¦ç²¾ç¡®æ§åˆ¶</td><td>è½¬è´¦ã€æ”¯ä»˜</td></tr><tr><td>RocketMQäº‹åŠ¡æ¶ˆæ¯</td><td>å¼‚æ­¥å¤„ç†ã€æœ€ç»ˆä¸€è‡´æ€§</td><td>è®¢å•é€šçŸ¥ã€ç§¯åˆ†å‘æ”¾</td></tr><tr><td>æœ¬åœ°æ¶ˆæ¯è¡¨</td><td>å¯é æ€§è¦æ±‚é«˜ã€ä¸ä¾èµ–MQ</td><td>è·¨ç³»ç»Ÿæ•°æ®åŒæ­¥</td></tr><tr><td>Saga</td><td>é•¿äº‹åŠ¡ã€å¤æ‚ä¸šåŠ¡æµç¨‹</td><td>æœºç¥¨+é…’åº—+ç§Ÿè½¦é¢„è®¢</td></tr></tbody></table>
<h4 data-id="heading-40">7.3 ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹</h4>
<pre><code class="hljs language-css" lang="css">+------------------------------------------------------------------+
|                    ç”Ÿäº§ç¯å¢ƒ Checklist                             |
+------------------------------------------------------------------+
|                                                                   |
|  <span class="hljs-selector-attr">[ ]</span> TC Server é«˜å¯ç”¨éƒ¨ç½²ï¼ˆè‡³å°‘<span class="hljs-number">3</span>èŠ‚ç‚¹ï¼‰                             |
|  <span class="hljs-selector-attr">[ ]</span> é…ç½®åˆç†çš„äº‹åŠ¡è¶…æ—¶æ—¶é—´                                        |
|  <span class="hljs-selector-attr">[ ]</span> ç›‘æ§å…¨å±€äº‹åŠ¡çŠ¶æ€                                              |
|  <span class="hljs-selector-attr">[ ]</span> å¤„ç†æ‚¬æŒ‚äº‹åŠ¡                                                  |
|  <span class="hljs-selector-attr">[ ]</span> å¹‚ç­‰æ€§è®¾è®¡                                                   |
|  <span class="hljs-selector-attr">[ ]</span> å¼‚å¸¸é‡è¯•æœºåˆ¶                                                 |
|  <span class="hljs-selector-attr">[ ]</span> åˆ†å¸ƒå¼é”é˜²å¹¶å‘                                               |
|  <span class="hljs-selector-attr">[ ]</span> æ—¥å¿—è®°å½•å®Œæ•´                                                 |
|                                                                   |
+------------------------------------------------------------------+
</code></pre>
<h4 data-id="heading-41">7.4 å¹‚ç­‰æ€§è®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdempotentOrderService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">IDEMPOTENT_KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order:idempotent:"</span>;

    <span class="hljs-comment">/**
     * å¹‚ç­‰æ€§åˆ›å»ºè®¢å•
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrderIdempotent</span><span class="hljs-params">(String requestId, OrderDTO orderDTO)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> IDEMPOTENT_KEY_PREFIX + requestId;

        <span class="hljs-comment">// 1. æ£€æŸ¥æ˜¯å¦å·²å¤„ç†</span>
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">setResult</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
                .setIfAbsent(key, <span class="hljs-string">"processing"</span>, Duration.ofMinutes(<span class="hljs-number">30</span>));

        <span class="hljs-keyword">if</span> (Boolean.FALSE.equals(setResult)) {
            <span class="hljs-comment">// å·²å­˜åœ¨ï¼ŒæŸ¥è¯¢å·²æœ‰è®¢å•è¿”å›</span>
            log.info(<span class="hljs-string">"é‡å¤è¯·æ±‚ï¼ŒrequestId: {}"</span>, requestId);
            <span class="hljs-type">Order</span> <span class="hljs-variable">existOrder</span> <span class="hljs-operator">=</span> orderMapper.selectByRequestId(requestId);
            <span class="hljs-keyword">if</span> (existOrder != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> existOrder;
            }
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è®¢å•å¤„ç†ä¸­ï¼Œè¯·ç¨åæŸ¥è¯¢"</span>);
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. åˆ›å»ºè®¢å•</span>
            <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
            order.setRequestId(requestId);
            order.setUserId(orderDTO.getUserId());
            order.setProductId(orderDTO.getProductId());
            order.setCount(orderDTO.getCount());
            order.setMoney(orderDTO.getMoney());
            order.setStatus(<span class="hljs-number">0</span>);
            orderMapper.insert(order);

            <span class="hljs-comment">// 3. æ›´æ–° Redis çŠ¶æ€</span>
            redisTemplate.opsForValue().set(key, <span class="hljs-string">"completed"</span>, Duration.ofHours(<span class="hljs-number">24</span>));

            <span class="hljs-keyword">return</span> order;

        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// å¤±è´¥åˆ™åˆ é™¤ keyï¼Œå…è®¸é‡è¯•</span>
            redisTemplate.delete(key);
            <span class="hljs-keyword">throw</span> e;
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-42">å…«ã€æ€»ç»“</h3>
<p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„æ ¸å¿ƒéš¾é¢˜ï¼Œæ²¡æœ‰é“¶å¼¹æ–¹æ¡ˆã€‚é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆéœ€è¦æƒè¡¡ï¼š</p>
<ol>
<li><strong>ä¸€è‡´æ€§è¦æ±‚</strong>ï¼šå¼ºä¸€è‡´æ€§é€‰ Seataï¼Œæœ€ç»ˆä¸€è‡´æ€§é€‰äº‹åŠ¡æ¶ˆæ¯</li>
<li><strong>æ€§èƒ½è¦æ±‚</strong>ï¼šé«˜æ€§èƒ½é€‰å¼‚æ­¥æ–¹æ¡ˆï¼Œä½å»¶è¿Ÿé€‰ AT æ¨¡å¼</li>
<li><strong>ä¸šåŠ¡å¤æ‚åº¦</strong>ï¼šç®€å•ä¸šåŠ¡ç”¨ ATï¼Œå¤æ‚ä¸šåŠ¡ç”¨ TCC æˆ– Saga</li>
<li><strong>è¿ç»´æˆæœ¬</strong>ï¼šæœ¬åœ°æ¶ˆæ¯è¡¨æœ€ç®€å•ï¼ŒSeata éœ€è¦ç»´æŠ¤ TC</li>
</ol>
<p>æ ¸å¿ƒåŸåˆ™ï¼š</p>
<ul>
<li><strong>èƒ½ä¸ç”¨åˆ†å¸ƒå¼äº‹åŠ¡å°±ä¸ç”¨</strong>ï¼šåˆç†æ‹†åˆ†æœåŠ¡è¾¹ç•Œ</li>
<li><strong>ä¼˜å…ˆè€ƒè™‘æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šå¤§å¤šæ•°ä¸šåŠ¡å¯ä»¥æ¥å—</li>
<li><strong>åšå¥½å¹‚ç­‰è®¾è®¡</strong>ï¼šåˆ†å¸ƒå¼ç¯å¢ƒå¿…å¤‡</li>
<li><strong>å®Œå–„ç›‘æ§å‘Šè­¦</strong>ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†å¼‚å¸¸äº‹åŠ¡</li>
</ul>
<p>å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ åœ¨å®é™…é¡¹ç›®ä¸­æ›´å¥½åœ°åº”å¯¹åˆ†å¸ƒå¼äº‹åŠ¡æŒ‘æˆ˜ï¼</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[redisçš„qpsä»100é£™å‡åˆ°10000çš„å…¨æµç¨‹è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7577715145122037814</link>    <guid>https://juejin.cn/post/7577715145122037814</guid>    <pubDate>2025-11-29T21:22:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577715145122037814" data-draft-id="7577704980855504950" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="redisçš„qpsä»100é£™å‡åˆ°10000çš„å…¨æµç¨‹è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-29T21:22:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éšé£é£˜çš„äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/361110952753560"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            redisçš„qpsä»100é£™å‡åˆ°10000çš„å…¨æµç¨‹è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/361110952753560/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éšé£é£˜çš„äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T21:22:44.000Z" title="Sat Nov 29 2025 21:22:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis QPS ä» 100 é£™å‡è‡³ 10000 å±äºå…¸å‹çš„æµé‡çªå¢åœºæ™¯ï¼Œæ ¸å¿ƒæ’æŸ¥é€»è¾‘æ˜¯<strong>å…ˆåŒºåˆ† â€œåˆæ³•æµé‡å¢é•¿â€ è¿˜æ˜¯ â€œå¼‚å¸¸ / ä½æ•ˆè¯·æ±‚å¯¼è‡´â€ï¼Œå†é’ˆå¯¹æ€§æ­¢è¡€ + æ ¹å› ä¿®å¤</strong>ï¼Œå…¨ç¨‹éœ€ç»“åˆ Redis ç›‘æ§ã€æ—¥å¿—å’Œå‘½ä»¤åˆ†æï¼Œä»¥ä¸‹æ˜¯å…¨æµç¨‹æ’æŸ¥ä¸è§£å†³æ–¹æ¡ˆï¼š</p>
<h3 data-id="heading-0">ä¸€ã€ç´§æ€¥æ­¢è¡€ï¼šé¿å… Redis å®•æœºï¼ˆ0-5 åˆ†é’Ÿï¼‰</h3>
<p>Redis å•å®ä¾‹ QPS æé™çº¦ 10 ä¸‡ - 15 ä¸‡ï¼Œä½†çªå¢åˆ° 1 ä¸‡å¯èƒ½å¯¼è‡´ CPU / å†…å­˜ / ç½‘ç»œæ‰“æ»¡ï¼Œå…ˆå¿«é€Ÿæ§é£é™©ï¼š</p>
<ol>
<li>
<p><strong>ä¸´æ—¶é™æµ / é™çº§</strong></p>
<ul>
<li>è‹¥ Redis æ¥å…¥äº†ç½‘å…³ / ä»£ç†ï¼ˆå¦‚ Nginxã€Kongã€Redis Cluster Proxyï¼‰ï¼Œç«‹å³é…ç½® Redis QPS é™æµé˜ˆå€¼ï¼ˆå¦‚è®¾ä¸º 12000ï¼Œç•™ç¼“å†²ï¼‰ï¼Œè¶…å‡ºè¯·æ±‚è¿”å› â€œæœåŠ¡ç¹å¿™â€ æˆ–èµ°é™çº§é€»è¾‘ï¼ˆå¦‚è¿”å›æœ¬åœ°ç¼“å­˜ï¼‰ã€‚</li>
<li>å¯¹éæ ¸å¿ƒä¸šåŠ¡çš„ Redis è¯·æ±‚ï¼ˆå¦‚ç»Ÿè®¡ã€æ—¥å¿—ä¸ŠæŠ¥ï¼‰ç›´æ¥é™çº§ï¼Œæš‚åœè°ƒç”¨ï¼Œä¼˜å…ˆä¿éšœæ ¸å¿ƒæµç¨‹ï¼ˆå¦‚ä¸‹å•ã€æ”¯ä»˜ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ‰©å®¹ç¼“è§£å‹åŠ›</strong></p>
<ul>
<li>è‹¥ä¸ºå•æœº Redisï¼Œå¿«é€Ÿåˆ‡æ¢è‡³ Redis Cluster å¹¶æ–°å¢èŠ‚ç‚¹ï¼ˆå¦‚ä» 3 èŠ‚ç‚¹æ‰©è‡³ 6 èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‘Šæµé‡ï¼›è‹¥å·²ä¸ºé›†ç¾¤ï¼Œå°†çƒ­ç‚¹æ§½ä½è¿ç§»è‡³ç©ºé—²èŠ‚ç‚¹ã€‚</li>
<li>æ£€æŸ¥ Redis æ‰€åœ¨æœåŠ¡å™¨çš„èµ„æºï¼ˆCPUã€å†…å­˜ã€ç½‘å¡ï¼‰ï¼Œè‹¥ CPU&gt;90%/ ç½‘å¡å¸¦å®½æ‰“æ»¡ï¼Œä¸´æ—¶æ‰©å®¹æœåŠ¡å™¨é…ç½®ï¼ˆå¦‚ CPU æ ¸æ•°ç¿»å€ã€å¸¦å®½å‡çº§ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¦ç”¨å±é™©å‘½ä»¤</strong></p>
<ul>
<li>ä¸´æ—¶ç¦ç”¨é«˜å¼€é”€å‘½ä»¤ï¼ˆå¦‚<code>KEYS *</code>ã€<code>FLUSHDB</code>ã€<code>HGETALL</code>ã€<code>SMEMBERS</code>ï¼‰ï¼Œé¿å…é›ªä¸ŠåŠ éœœï¼ˆå¯é€šè¿‡<code>redis.conf</code>æˆ–<code>CONFIG SET disable-commands "KEYS,FLUSHDB"</code>é…ç½®ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-1">äºŒã€å®šä½æ ¹å› ï¼šæ˜ç¡® QPS é£™å‡çš„æ ¸å¿ƒåŸå› ï¼ˆ5-30 åˆ†é’Ÿï¼‰</h3>
<p>é€šè¿‡ Redis è‡ªå¸¦å·¥å…· + ç›‘æ§å¹³å°ï¼Œä» â€œè¯·æ±‚æ¥æºã€å‘½ä»¤ç±»å‹ã€ä¸šåŠ¡åœºæ™¯â€ ä¸‰ç»´åº¦åˆ†æï¼š</p>
<h4 data-id="heading-2">æ­¥éª¤ 1ï¼šåŸºç¡€ç›‘æ§åˆ†æï¼ˆå…ˆçœ‹å®è§‚æŒ‡æ ‡ï¼‰</h4>
<p>é€šè¿‡<code>redis-cli info stats</code>/ ç›‘æ§å¹³å°ï¼ˆå¦‚ Prometheus+Grafanaã€Redis Insightã€é˜¿é‡Œäº‘ Redis æ§åˆ¶å°ï¼‰æŸ¥çœ‹æ ¸å¿ƒæŒ‡æ ‡ï¼š</p>



































<table><thead><tr><th>æ ¸å¿ƒæŒ‡æ ‡</th><th>å¼‚å¸¸è¡¨ç°</th><th>æŒ‡å‘é—®é¢˜</th></tr></thead><tbody><tr><td><code>instantaneous_ops_per_sec</code></td><td>ç¨³å®š 100â†’çªå¢ 10000</td><td>æµé‡çœŸå®å¢é•¿ / ä½æ•ˆè¯·æ±‚å åŠ </td></tr><tr><td><code>used_cpu_sys</code>/<code>used_cpu_user</code></td><td>CPU&gt;80%</td><td>è®¡ç®—å¯†é›†å‹å‘½ä»¤ï¼ˆå¦‚æ’åºã€èšåˆï¼‰æˆ–é«˜é¢‘å°å‘½ä»¤ï¼ˆå¦‚ INCRï¼‰</td></tr><tr><td><code>used_memory</code>/<code>used_memory_rss</code></td><td>å†…å­˜çªå¢</td><td>å¤§ value å†™å…¥ã€ç¼“å­˜è¿‡æœŸç­–ç•¥å¤±æ•ˆ</td></tr><tr><td><code>network_input_bytes</code>/<code>network_output_bytes</code></td><td>ç½‘å¡æ‰“æ»¡</td><td>å¤§æµé‡è¯·æ±‚ï¼ˆå¦‚ HGETALLã€å¤§å­—ç¬¦ä¸² GETï¼‰</td></tr><tr><td><code>keyspace_hits</code>/<code>keyspace_misses</code></td><td>ç¼“å­˜å‘½ä¸­ç‡éª¤é™ï¼ˆ&lt;80%ï¼‰</td><td>ç¼“å­˜ç©¿é€ / ç¼“å­˜å¤±æ•ˆï¼Œå¯¼è‡´å¤§é‡æ— æ•ˆè¯·æ±‚</td></tr></tbody></table>
<h4 data-id="heading-3">æ­¥éª¤ 2ï¼šåˆ†æè¯·æ±‚æ¥æºï¼ˆæ‰¾æµé‡å…¥å£ï¼‰</h4>
<ol>
<li>
<p><strong>å®šä½è°ƒç”¨æ–¹ IP / æœåŠ¡</strong>ï¼š</p>
<ul>
<li>æŸ¥çœ‹ Redis æ…¢æ—¥å¿— / è®¿é—®æ—¥å¿—ï¼ˆéœ€æå‰å¼€å¯<code>slowlog</code>ï¼‰ï¼Œæ‰§è¡Œ<code>slowlog get 100</code>ï¼Œç­›é€‰è¯·æ±‚æ¥æº IPï¼›</li>
<li>è‹¥æ¥å…¥äº†é“¾è·¯è¿½è¸ªï¼ˆå¦‚ SkyWalkingã€Pinpointï¼‰ï¼Œç›´æ¥æŸ¥çœ‹è°ƒç”¨ Redis çš„æœåŠ¡åˆ—è¡¨ï¼Œç¡®è®¤æ˜¯å¦æŸæœåŠ¡ / IP çš„è°ƒç”¨é‡çªå¢ï¼ˆå¦‚æŸæ–°ä¸Šçº¿åŠŸèƒ½ã€å®šæ—¶ä»»åŠ¡ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>åˆ¤æ–­æµé‡åˆæ³•æ€§</strong>ï¼š</p>
<ul>
<li>è‹¥å• IP è°ƒç”¨é‡å æ¯” &gt; 50%ï¼Œå¤§æ¦‚ç‡æ˜¯çˆ¬è™«ã€æ¶æ„æ”»å‡»æˆ–å®¢æˆ·ç«¯ BUGï¼ˆå¦‚æ— é™é‡è¯•ã€å¾ªç¯è¯·æ±‚ï¼‰ï¼Œç›´æ¥åœ¨é˜²ç«å¢™ / Redis ç«¯æ‹‰é»‘è¯¥ IPï¼›</li>
<li>è‹¥è°ƒç”¨æ–¹ä¸ºå†…éƒ¨æœåŠ¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ä»£ç  BUGï¼ˆå¦‚é‡è¯•é€»è¾‘å¼‚å¸¸ã€å¾ªç¯æŸ¥è¯¢ Redisï¼‰ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-4">æ­¥éª¤ 3ï¼šåˆ†æå‘½ä»¤ç±»å‹ï¼ˆæ‰¾ä½æ•ˆ / é«˜é¢‘å‘½ä»¤ï¼‰</h4>
<p>æ‰§è¡Œ<code>redis-cli --stat</code>ï¼ˆå®æ—¶ç»Ÿè®¡å‘½ä»¤æ‰§è¡Œæ¬¡æ•°ï¼‰æˆ–<code>info commandstats</code>ï¼ˆæŒ‰å‘½ä»¤ç»Ÿè®¡ï¼‰ï¼Œé‡ç‚¹å…³æ³¨ï¼š</p>
<ol>
<li>
<p><strong>é«˜é¢‘å°å‘½ä»¤</strong>ï¼š</p>
<ul>
<li>å¦‚<code>INCR</code>/<code>DECR</code>/<code>HSET</code>/<code>GET</code>/<code>SET</code>å æ¯” &gt; 90%ï¼Œä¸” QPS=10000ï¼Œå¯èƒ½æ˜¯æ­£å¸¸ä¸šåŠ¡å¢é•¿ï¼ˆå¦‚ç§’æ€ã€è®¡æ•°åœºæ™¯ï¼‰ï¼Œæˆ–å®¢æˆ·ç«¯æ— ç¼“å­˜ç›´æ¥è°ƒç”¨ Redisï¼›</li>
</ul>
</li>
<li>
<p><strong>é«˜å¼€é”€å‘½ä»¤</strong>ï¼š</p>
<ul>
<li>è‹¥<code>SORT</code>/<code>ZUNIONSTORE</code>/<code>HGETALL</code>/<code>SMEMBERS</code>/<code>KEYS</code>å æ¯”é«˜ï¼Œå“ªæ€•å•æ¬¡è°ƒç”¨ï¼Œä¹Ÿä¼šå› è€—æ—¶ä¹…å¯¼è‡´ QPS â€œè¢«åŠ¨å‡é«˜â€ï¼ˆè¯·æ±‚å †ç§¯ï¼‰ï¼›</li>
<li>è‹¥<code>MGET</code>/<code>MSET</code>è°ƒç”¨å°‘ï¼Œä½†å•æ¡å‘½ä»¤æºå¸¦ä¸Šåƒä¸ª keyï¼Œç­‰ä»·äºæ”¾å¤§äº† QPSï¼ˆå¦‚ 1 æ¬¡ MGET å¸¦ 1000 ä¸ª key=1000 æ¬¡ GETï¼‰ï¼›</li>
</ul>
</li>
<li>
<p><strong>æ— æ•ˆè¯·æ±‚</strong>ï¼š</p>
<ul>
<li>ç¼“å­˜ç©¿é€ï¼š<code>GET</code>ä¸å­˜åœ¨çš„ key å æ¯”é«˜ï¼ˆ<code>keyspace_misses</code>é«˜ï¼‰ï¼Œå¯¼è‡´ Redis ç©ºæŸ¥ï¼ŒQPS è™šé«˜ï¼›</li>
<li>ç¼“å­˜é›ªå´©ï¼šå¤§é‡ key åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚ç›´æ¥æ‰“ Redisï¼ŒQPS çªå¢ï¼›</li>
<li>ç¼“å­˜å‡»ç©¿ï¼šå•ä¸ªçƒ­ç‚¹ key è¿‡æœŸï¼Œå¤§é‡è¯·æ±‚åŒæ—¶è®¿é—®è¯¥ keyï¼Œç¬é—´æ‹‰é«˜ QPSã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">ä¸‰ã€åˆ†åœºæ™¯è§£å†³æ–¹æ¡ˆï¼ˆ30 åˆ†é’Ÿåï¼‰</h3>
<p>æ ¹æ®æ ¹å› é’ˆå¯¹æ€§ä¿®å¤ï¼Œä» â€œä¸´æ—¶ç¼“è§£â€ åˆ° â€œé•¿æœŸä¼˜åŒ–â€ï¼š</p>













































<table><thead><tr><th>é£™å‡ç±»å‹</th><th>ä¸´æ—¶è§£å†³æ–¹æ¡ˆ</th><th>é•¿æœŸä¼˜åŒ–æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>æ­£å¸¸ä¸šåŠ¡å¢é•¿ï¼ˆå¦‚ç§’æ€ï¼‰</td><td>1. æ‰©å®¹ Redis Cluster èŠ‚ç‚¹æ•°ï¼›2. çƒ­ç‚¹ key åˆ†ç‰‡ï¼ˆå¦‚å°† count:123 æ‹†ä¸º count:123:1~10ï¼‰ï¼›3. å¢åŠ æœ¬åœ°ç¼“å­˜ï¼ˆå¦‚ Guavaï¼‰åˆ†æ‹…æµé‡</td><td>1. é…ç½® Redis å¼¹æ€§ä¼¸ç¼©ï¼ˆQPS è¶… 8000 è‡ªåŠ¨æ‰©å®¹ï¼‰ï¼›2. å¯¹è®¡æ•°ç±»åœºæ™¯ä½¿ç”¨ Redis HyperLogLog / è®¡æ•°å™¨ç»„ä»¶ï¼›3. å‹æµ‹éªŒè¯ Redis æé™ QPSï¼ˆå¦‚æ¨¡æ‹Ÿ 2 ä¸‡ QPSï¼‰</td></tr><tr><td>é«˜é¢‘ä½æ•ˆå‘½ä»¤ï¼ˆå¦‚ HGETALLã€KEYSï¼‰</td><td>1. ä¸´æ—¶æ›¿æ¢ä¸ºä½å¼€é”€å‘½ä»¤ï¼ˆå¦‚ HGETALLâ†’HSCAN åˆ†æ‰¹è·å–ï¼ŒKEYSâ†’SCANï¼‰ï¼›2. é™åˆ¶å¤§ keyï¼ˆ&gt;100KBï¼‰çš„è¯»å†™</td><td>1. è§„èŒƒ Redis å‘½ä»¤ä½¿ç”¨æ‰‹å†Œï¼Œç¦ç”¨é«˜å¼€é”€å‘½ä»¤ï¼›2. æ‹†åˆ†å¤§ keyï¼ˆå¦‚å¤§ Hash æ‹†ä¸ºå¤šä¸ªå° Hashï¼‰ï¼›3. å¯¹èšåˆç±»æŸ¥è¯¢ï¼ˆå¦‚æ’åºï¼‰è¿ç§»è‡³ç¦»çº¿è®¡ç®—ï¼ˆå¦‚ Sparkï¼‰</td></tr><tr><td>ç¼“å­˜ç©¿é€</td><td>1. ä¸´æ—¶é…ç½®ç©ºå€¼ç¼“å­˜ï¼ˆå¦‚å¯¹ä¸å­˜åœ¨çš„ key è®¾ç½®è¿‡æœŸæ—¶é—´ 1 åˆ†é’Ÿï¼‰ï¼›2. å¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆªæ— æ•ˆ key</td><td>1. æ¥å…¥å…¨å±€å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆå¦‚ RedisBloom æ¨¡å—ï¼‰ï¼›2. ä¸šåŠ¡å±‚æ ¡éªŒè¯·æ±‚å‚æ•°ï¼Œè¿‡æ»¤æ— æ•ˆ key</td></tr><tr><td>ç¼“å­˜é›ªå´©</td><td>1. ä¸´æ—¶å»¶é•¿è¿‡æœŸ key çš„ TTLï¼›2. å¯¹è¿‡æœŸæ—¶é—´æ·»åŠ éšæœºå€¼ï¼ˆå¦‚ TTL=30 åˆ†é’Ÿ Â±5 åˆ†é’Ÿï¼‰</td><td>1. æ ¸å¿ƒ key è®¾ç½®æ°¸ä¸è¿‡æœŸï¼Œé€šè¿‡åå°å¼‚æ­¥æ›´æ–°ï¼›2. åˆ†çº§ç¼“å­˜ï¼ˆæœ¬åœ°ç¼“å­˜ + Redisï¼‰ï¼›3. è¿‡æœŸæ—¶é—´é”™å¼€ï¼ˆæŒ‰ä¸šåŠ¡ç»´åº¦åˆ†æ‰¹è¿‡æœŸï¼‰</td></tr><tr><td>ç¼“å­˜å‡»ç©¿</td><td>1. ä¸´æ—¶å¯¹çƒ­ç‚¹ key åŠ äº’æ–¥é”ï¼ˆå¦‚ SETNXï¼‰ï¼Œåªå…è®¸ 1 ä¸ªè¯·æ±‚æ›´æ–°ç¼“å­˜ï¼Œå…¶ä½™ç­‰å¾…ï¼›2. çƒ­ç‚¹ key è®¾ä¸ºæ°¸ä¸è¿‡æœŸ</td><td>1. æ¥å…¥ Redis çƒ­ç‚¹ key æ¢æµ‹å·¥å…·ï¼ˆå¦‚ Redis Cluster çš„ hot-key-detectï¼‰ï¼›2. çƒ­ç‚¹ key é¢„åŠ è½½ + æœ¬åœ°ç¼“å­˜ï¼›3. ä½¿ç”¨ Redisson åˆ†å¸ƒå¼é”ä¼˜åŒ–ç¼“å­˜æ›´æ–°é€»è¾‘</td></tr><tr><td>æ¶æ„æ”»å‡» / å®¢æˆ·ç«¯ BUG</td><td>1. æ‹‰é»‘å¼‚å¸¸ IP / æœåŠ¡ï¼›2. é™åˆ¶å•å®¢æˆ·ç«¯è¿æ¥æ•°ï¼ˆCONFIG SET maxclients 1000ï¼‰ï¼›3. é€šçŸ¥è°ƒç”¨æ–¹ä¿®å¤é‡è¯•é€»è¾‘</td><td>1. Redis æ¥å…¥ WAFï¼Œæ‹¦æˆªé«˜é¢‘å¼‚å¸¸è¯·æ±‚ï¼›2. å®¢æˆ·ç«¯æ·»åŠ è¯·æ±‚é™æµï¼ˆå¦‚æ¯ç§’è°ƒç”¨ Redis ä¸è¶…è¿‡ 100 æ¬¡ï¼‰ï¼›3. å®Œå–„å®¢æˆ·ç«¯é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š 3 æ¬¡ï¼Œé—´éš” 100msï¼‰</td></tr><tr><td>å¤§æµé‡è¯·æ±‚ï¼ˆç½‘å¡æ‰“æ»¡ï¼‰</td><td>1. ä¸´æ—¶å‹ç¼© Redis ä¼ è¾“æ•°æ®ï¼ˆå¦‚ä½¿ç”¨ Protocol Buffer ä»£æ›¿ JSONï¼‰ï¼›2. é™åˆ¶å•æ¡è¯·æ±‚çš„ value å¤§å°ï¼ˆ&lt;10KBï¼‰</td><td>1. å¼€å¯ Redis å‹ç¼©ï¼ˆCONFIG SET rdbcompression yesï¼‰ï¼›2. å¤§æ–‡ä»¶ / å¤§æ•°æ®è¿ç§»è‡³å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ OSSï¼‰ï¼ŒRedis ä»…å­˜ç´¢å¼•</td></tr></tbody></table>
<h3 data-id="heading-6">å››ã€å¤ç›˜ä¸é•¿æ•ˆé˜²æŠ¤ï¼ˆé—®é¢˜è§£å†³å 1-2 å¤©ï¼‰</h3>
<ol>
<li>
<p><strong>å®Œå–„ç›‘æ§å‘Šè­¦</strong>ï¼š</p>
<ul>
<li>æ–°å¢å‘Šè­¦è§„åˆ™ï¼šQPS 5 åˆ†é’Ÿå†…å¢é•¿è¶… 200%ã€CPU&gt;80%ã€ç¼“å­˜å‘½ä¸­ç‡ &lt; 90%ã€å¤§ key æ•°é‡çªå¢ï¼›</li>
<li>ç›‘æ§ç»´åº¦ï¼šQPSã€CPUã€å†…å­˜ã€ç½‘å¡ã€ç¼“å­˜å‘½ä¸­ç‡ã€æ…¢å‘½ä»¤æ•°ã€å¤§ key æ•°é‡ã€‚</li>
</ul>
</li>
<li>
<p><strong>è§„èŒƒ Redis ä½¿ç”¨</strong>ï¼š</p>
<ul>
<li>åˆ¶å®š Redis å¼€å‘è§„èŒƒï¼šç¦ç”¨é«˜å¼€é”€å‘½ä»¤ã€é™åˆ¶ key/value å¤§å°ã€å¼ºåˆ¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ ¸å¿ƒ key é™¤å¤–ï¼‰ï¼›</li>
<li>ä¸Šçº¿å‰å®¡æ ¸ï¼šæ‰€æœ‰ Redis è°ƒç”¨éœ€ç»è¿‡ä»£ç è¯„å®¡ï¼Œé¿å…ä½æ•ˆ / é«˜é¢‘è¯·æ±‚ã€‚</li>
</ul>
</li>
<li>
<p><strong>åº”æ€¥æ¼”ç»ƒ</strong>ï¼š</p>
<ul>
<li>æ¨¡æ‹Ÿ Redis QPS çªå¢åˆ° 1 ä¸‡ã€2 ä¸‡çš„åœºæ™¯ï¼ŒéªŒè¯é™æµã€æ‰©å®¹ã€é™çº§æ–¹æ¡ˆçš„æœ‰æ•ˆæ€§ï¼›</li>
<li>æ•´ç† Redis åº”æ€¥æ’æŸ¥æ‰‹å†Œï¼Œæ˜ç¡®è´£ä»»äººã€å·¥å…·ï¼ˆå¦‚ slowlogã€info å‘½ä»¤ï¼‰å’Œæ­¥éª¤ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-7">å…³é”®å·¥å…·é€ŸæŸ¥</h3>





























<table><thead><tr><th>æ’æŸ¥ç›®æ ‡</th><th>æ ¸å¿ƒå‘½ä»¤ / å·¥å…·</th></tr></thead><tbody><tr><td>å®æ—¶ QPS / å‘½ä»¤ç»Ÿè®¡</td><td><code>redis-cli --stat</code>ã€<code>info commandstats</code></td></tr><tr><td>æ…¢è¯·æ±‚åˆ†æ</td><td><code>slowlog get 100</code>ã€<code>slowlog len</code></td></tr><tr><td>å¤§ key æ£€æµ‹</td><td><code>redis-cli --bigkeys</code>ã€Redis Insight</td></tr><tr><td>æµé‡æ¥æº</td><td>Redis è®¿é—®æ—¥å¿—ã€é“¾è·¯è¿½è¸ªå¹³å°ï¼ˆSkyWalkingï¼‰</td></tr><tr><td>èµ„æºç›‘æ§</td><td><code>top</code>ï¼ˆCPU / å†…å­˜ï¼‰ã€<code>iftop</code>ï¼ˆç½‘å¡ï¼‰ã€Prometheus+Grafana</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è´¢åŠ¡å¯¹è´¦ç³»ç»Ÿè®¾è®¡ä¸å®ç°]]></title>    <link>https://juejin.cn/post/7577718777481527334</link>    <guid>https://juejin.cn/post/7577718777481527334</guid>    <pubDate>2025-11-29T16:18:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577718777481527334" data-draft-id="7577599299598827571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è´¢åŠ¡å¯¹è´¦ç³»ç»Ÿè®¾è®¡ä¸å®ç°"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-29T16:18:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è´¢åŠ¡å¯¹è´¦ç³»ç»Ÿè®¾è®¡ä¸å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T16:18:20.000Z" title="Sat Nov 29 2025 16:18:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»24åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è´¢åŠ¡å¯¹è´¦ç³»ç»Ÿè®¾è®¡ä¸å®ç°ï¼šæ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è¡Œæµæ°´å…¨æ¸ é“å¯¹è´¦</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨ç”µå•†ã€é‡‘èç­‰ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯¹è´¦ç³»ç»Ÿæ˜¯ä¿éšœèµ„é‡‘å®‰å…¨çš„æ ¸å¿ƒç¯èŠ‚ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•è®¾è®¡å’Œå®ç°ä¸€å¥—æ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è¡Œç­‰å¤šæ¸ é“çš„è´¢åŠ¡å¯¹è´¦ç³»ç»Ÿï¼Œæ¶µç›–ç³»ç»Ÿæ¶æ„ã€æ ¸å¿ƒç®—æ³•ã€ä»£ç å®ç°ç­‰å†…å®¹ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€å¯¹è´¦ç³»ç»Ÿæ¦‚è¿°</h3>
<h4 data-id="heading-3">1.1 ä»€ä¹ˆæ˜¯å¯¹è´¦</h4>
<p>å¯¹è´¦æ˜¯æŒ‡å°†ä¼ä¸šå†…éƒ¨çš„äº¤æ˜“è®°å½•ä¸å¤–éƒ¨æ¸ é“ï¼ˆæ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è¡Œç­‰ï¼‰çš„æµæ°´è®°å½•è¿›è¡Œæ ¸å¯¹ï¼Œç¡®ä¿åŒæ–¹æ•°æ®ä¸€è‡´çš„è¿‡ç¨‹ã€‚</p>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                        å¯¹è´¦æ ¸å¿ƒæµç¨‹                                |
+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                                                                   |
|   å†…éƒ¨ç³»ç»Ÿ                                       å¤–éƒ¨æ¸ é“          |
|   +<span class="hljs-comment">------------------+                    +------------------+    |</span>
|   |   äº¤æ˜“è®¢å•è¡¨     |                    |   æ”¯ä»˜å®è´¦å•     |    |
|   |   æ”¯ä»˜æµæ°´è¡¨     |      å¯¹è´¦æ ¸å¿ƒ      |   å¾®ä¿¡è´¦å•       |    |
|   |   é€€æ¬¾è®°å½•è¡¨     |  &lt;<span class="hljs-comment">--------------&gt; |   é“¶è¡Œæµæ°´       |    |</span>
|   +<span class="hljs-comment">------------------+                    |   è‡ªå®šä¹‰æµæ°´     |    |</span>
|                                           +<span class="hljs-comment">------------------+    |</span>
|                             |                                     |
|                             v                                     |
|                    +<span class="hljs-comment">------------------+                           |</span>
|                    |    å¯¹è´¦ç»“æœ      |                           |
|                    +<span class="hljs-comment">------------------+                           |</span>
|                    | - å¯¹è´¦æˆåŠŸ       |                           |
|                    | - æœ¬åœ°æœ‰æ¸ é“æ—    |                           |
|                    | - æ¸ é“æœ‰æœ¬åœ°æ—    |                           |
|                    | - é‡‘é¢ä¸ä¸€è‡´     |                           |
|                    +<span class="hljs-comment">------------------+                           |</span>
|                                                                   |
+<span class="hljs-comment">------------------------------------------------------------------+</span>
</code></pre>
<h4 data-id="heading-4">1.2 å¯¹è´¦çš„ç›®çš„</h4>
<ol>
<li><strong>èµ„é‡‘å®‰å…¨</strong>ï¼šåŠæ—¶å‘ç°å¼‚å¸¸äº¤æ˜“ï¼Œé˜²æ­¢èµ„é‡‘æŸå¤±</li>
<li><strong>è´¦åŠ¡å‡†ç¡®</strong>ï¼šç¡®ä¿è´¢åŠ¡æŠ¥è¡¨æ•°æ®å‡†ç¡®</li>
<li><strong>å·®é”™å¤„ç†</strong>ï¼šå¿«é€Ÿå®šä½å’Œå¤„ç†å¯¹è´¦å·®å¼‚</li>
<li><strong>é£é™©æ§åˆ¶</strong>ï¼šå‘ç°æ½œåœ¨çš„æ¬ºè¯ˆå’Œé£é™©</li>
</ol>
<h4 data-id="heading-5">1.3 å¯¹è´¦å·®å¼‚ç±»å‹</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                        å¯¹è´¦å·®å¼‚åˆ†ç±»                                |
+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                                                                   |
|   +<span class="hljs-comment">--------------------+------------------------------------+     |</span>
|   |     å·®å¼‚ç±»å‹       |              æè¿°                  |     |
|   +<span class="hljs-comment">--------------------+------------------------------------+     |</span>
|   |   æœ¬åœ°å¤šï¼ˆé•¿æ¬¾ï¼‰   |  æœ¬åœ°æœ‰è®°å½•ï¼Œæ¸ é“æ— è®°å½•             |     |
|   +<span class="hljs-comment">--------------------+------------------------------------+     |</span>
|   |   æ¸ é“å¤šï¼ˆçŸ­æ¬¾ï¼‰   |  æ¸ é“æœ‰è®°å½•ï¼Œæœ¬åœ°æ— è®°å½•             |     |
|   +<span class="hljs-comment">--------------------+------------------------------------+     |</span>
|   |   é‡‘é¢ä¸ä¸€è‡´       |  åŒæ–¹éƒ½æœ‰è®°å½•ï¼Œä½†é‡‘é¢ä¸åŒ           |     |
|   +<span class="hljs-comment">--------------------+------------------------------------+     |</span>
|   |   çŠ¶æ€ä¸ä¸€è‡´       |  åŒæ–¹é‡‘é¢ç›¸åŒï¼Œä½†äº¤æ˜“çŠ¶æ€ä¸åŒ       |     |
|   +<span class="hljs-comment">--------------------+------------------------------------+     |</span>
|   |   æ—¶é—´å·®å¼‚         |  äº¤æ˜“æ—¶é—´è·¨å¤©å¯¼è‡´çš„å·®å¼‚             |     |
|   +<span class="hljs-comment">--------------------+------------------------------------+     |</span>
|                                                                   |
+<span class="hljs-comment">------------------------------------------------------------------+</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">äºŒã€ç³»ç»Ÿæ¶æ„è®¾è®¡</h3>
<h4 data-id="heading-7">2.1 æ•´ä½“æ¶æ„</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------------------------------------------------------------+</span>
|                          å¯¹è´¦ç³»ç»Ÿæ•´ä½“æ¶æ„                                |
+<span class="hljs-comment">------------------------------------------------------------------------+</span>
|                                                                         |
|   +<span class="hljs-comment">-------------------+    +-------------------+    +------------------+ |</span>
|   |    å®šæ—¶ä»»åŠ¡       |    |    æ‰‹åŠ¨è§¦å‘       |    |    æ–‡ä»¶ä¸Šä¼       | |
|   +<span class="hljs-comment">--------+----------+    +--------+----------+    +--------+---------+ |</span>
|            |                        |                        |          |
|            +<span class="hljs-comment">------------------------+------------------------+          |</span>
|                                     |                                   |
|                                     v                                   |
|   +<span class="hljs-comment">---------------------------------------------------------------------+</span>
|   |                          å¯¹è´¦è°ƒåº¦ä¸­å¿ƒ                                |
|   +<span class="hljs-comment">---------------------------------------------------------------------+</span>
|                                     |                                   |
|            +<span class="hljs-comment">------------------------+------------------------+          |</span>
|            |                        |                        |          |
|            v                        v                        v          |
|   +<span class="hljs-comment">----------------+       +----------------+       +----------------+  |</span>
|   | æ”¯ä»˜å®å¯¹è´¦æ¨¡å— |       | å¾®ä¿¡å¯¹è´¦æ¨¡å—   |       | é“¶è¡Œå¯¹è´¦æ¨¡å—   |  |
|   +<span class="hljs-comment">----------------+       +----------------+       +----------------+  |</span>
|            |                        |                        |          |
|            +<span class="hljs-comment">------------------------+------------------------+          |</span>
|                                     |                                   |
|                                     v                                   |
|   +<span class="hljs-comment">---------------------------------------------------------------------+</span>
|   |                          å¯¹è´¦å¼•æ“æ ¸å¿ƒ                                |
|   |  +<span class="hljs-comment">-------------+  +-------------+  +-------------+  +-------------+ |</span>
|   |  | æ–‡ä»¶è§£æå™¨  |  | æ•°æ®æ¸…æ´—    |  | åŒ¹é…ç®—æ³•    |  | å·®å¼‚å¤„ç†    | |
|   |  +<span class="hljs-comment">-------------+  +-------------+  +-------------+  +-------------+ |</span>
|   +<span class="hljs-comment">---------------------------------------------------------------------+</span>
|                                     |                                   |
|                                     v                                   |
|   +<span class="hljs-comment">---------------------------------------------------------------------+</span>
|   |                          æ•°æ®å­˜å‚¨å±‚                                  |
|   |  +<span class="hljs-comment">-------------+  +-------------+  +-------------+  +-------------+ |</span>
|   |  | å¯¹è´¦ä»»åŠ¡è¡¨  |  | æ¸ é“æµæ°´è¡¨  |  | å¯¹è´¦ç»“æœè¡¨  |  | å·®å¼‚è®°å½•è¡¨  | |
|   |  +<span class="hljs-comment">-------------+  +-------------+  +-------------+  +-------------+ |</span>
|   +<span class="hljs-comment">---------------------------------------------------------------------+</span>
|                                     |                                   |
|                                     v                                   |
|   +<span class="hljs-comment">---------------------------------------------------------------------+</span>
|   |                          ç›‘æ§å‘Šè­¦å±‚                                  |
|   |  +<span class="hljs-comment">------------------+  +------------------+  +-------------------+  |</span>
|   |  | å¯¹è´¦è¿›åº¦ç›‘æ§     |  | å·®å¼‚ç‡å‘Šè­¦       |  | å¼‚å¸¸é€šçŸ¥          |  |
|   |  +<span class="hljs-comment">------------------+  +------------------+  +-------------------+  |</span>
|   +<span class="hljs-comment">---------------------------------------------------------------------+</span>
|                                                                         |
+<span class="hljs-comment">------------------------------------------------------------------------+</span>
</code></pre>
<h4 data-id="heading-8">2.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------------------------------------------------------+</span>
|                        æ ¸å¿ƒæ¨¡å—èŒè´£                                |
<span class="hljs-addition">+------------------------------------------------------------------+</span>
|                                                                   |
|   å¯¹è´¦è°ƒåº¦ä¸­å¿ƒï¼š                                                   |
|   - ç®¡ç†å¯¹è´¦ä»»åŠ¡çš„åˆ›å»ºã€è°ƒåº¦ã€æ‰§è¡Œ                                 |
|   - æ”¯æŒå®šæ—¶å¯¹è´¦å’Œæ‰‹åŠ¨è§¦å‘                                        |
|   - ä»»åŠ¡çŠ¶æ€ç®¡ç†å’Œå¤±è´¥é‡è¯•                                        |
|                                                                   |
|   æ–‡ä»¶è§£æå™¨ï¼š                                                     |
|   - æ”¯æŒ CSVã€Excelã€TXT ç­‰æ ¼å¼                                   |
|   - é€‚é…ä¸åŒæ¸ é“çš„è´¦å•æ ¼å¼                                        |
|   - å¤§æ–‡ä»¶åˆ†ç‰‡è§£æ                                                |
|                                                                   |
|   åŒ¹é…ç®—æ³•ï¼š                                                       |
|   - å•å­—æ®µåŒ¹é…ï¼ˆè®¢å•å·ï¼‰                                          |
|   - å¤šå­—æ®µè”åˆåŒ¹é…                                                |
|   - æ¨¡ç³ŠåŒ¹é…å’Œå®¹å·®åŒ¹é…                                            |
|                                                                   |
|   å·®å¼‚å¤„ç†ï¼š                                                       |
|   - å·®å¼‚åˆ†ç±»å’Œæ ‡è®°                                                |
|   - è‡ªåŠ¨å¤„ç†è§„åˆ™                                                  |
|   - äººå·¥å®¡æ ¸æµç¨‹                                                  |
|                                                                   |
<span class="hljs-addition">+------------------------------------------------------------------+</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">ä¸‰ã€æ•°æ®åº“è®¾è®¡</h3>
<h4 data-id="heading-10">3.1 æ ¸å¿ƒè¡¨ç»“æ„</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. å¯¹è´¦ä»»åŠ¡è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `recon_task` (
    `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'ä¸»é”®ID'</span>,
    `task_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä»»åŠ¡ç¼–å·'</span>,
    `channel_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¸ é“ç±»å‹ï¼šALIPAY/WECHAT/BANK/CUSTOM'</span>,
    `recon_date` <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å¯¹è´¦æ—¥æœŸ'</span>,
    `status` TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'çŠ¶æ€ï¼š0-å¾…å¤„ç†,1-å¤„ç†ä¸­,2-å·²å®Œæˆ,3-å¤±è´¥'</span>,
    `total_count` <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æ€»è®°å½•æ•°'</span>,
    `success_count` <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å¯¹è´¦æˆåŠŸæ•°'</span>,
    `fail_count` <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å¯¹è´¦å¤±è´¥æ•°'</span>,
    `diff_count` <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å·®å¼‚æ•°'</span>,
    `file_path` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) COMMENT <span class="hljs-string">'è´¦å•æ–‡ä»¶è·¯å¾„'</span>,
    `error_msg` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">1000</span>) COMMENT <span class="hljs-string">'é”™è¯¯ä¿¡æ¯'</span>,
    `start_time` DATETIME COMMENT <span class="hljs-string">'å¼€å§‹æ—¶é—´'</span>,
    `end_time` DATETIME COMMENT <span class="hljs-string">'ç»“æŸæ—¶é—´'</span>,
    `create_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_task_no` (`task_no`),
    KEY `idx_channel_date` (`channel_type`, `recon_date`),
    KEY `idx_status` (`status`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'å¯¹è´¦ä»»åŠ¡è¡¨'</span>;

<span class="hljs-comment">-- 2. æ¸ é“æµæ°´è¡¨ï¼ˆæ”¯ä»˜å®ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `channel_bill_alipay` (
    `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    `task_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä»»åŠ¡ID'</span>,
    `trade_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ”¯ä»˜å®äº¤æ˜“å·'</span>,
    `out_trade_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) COMMENT <span class="hljs-string">'å•†æˆ·è®¢å•å·'</span>,
    `trade_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'äº¤æ˜“ç±»å‹'</span>,
    `trade_status` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'äº¤æ˜“çŠ¶æ€'</span>,
    `amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'äº¤æ˜“é‡‘é¢'</span>,
    `fee` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æ‰‹ç»­è´¹'</span>,
    `trade_time` DATETIME COMMENT <span class="hljs-string">'äº¤æ˜“æ—¶é—´'</span>,
    `subject` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) COMMENT <span class="hljs-string">'å•†å“åç§°'</span>,
    `recon_status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å¯¹è´¦çŠ¶æ€ï¼š0-å¾…å¯¹è´¦,1-å·²å¯¹è´¦,2-å·®å¼‚'</span>,
    `create_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    KEY `idx_task_id` (`task_id`),
    KEY `idx_trade_no` (`trade_no`),
    KEY `idx_out_trade_no` (`out_trade_no`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'æ”¯ä»˜å®è´¦å•æµæ°´'</span>;

<span class="hljs-comment">-- 3. æ¸ é“æµæ°´è¡¨ï¼ˆå¾®ä¿¡ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `channel_bill_wechat` (
    `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    `task_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä»»åŠ¡ID'</span>,
    `transaction_id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å¾®ä¿¡æ”¯ä»˜è®¢å•å·'</span>,
    `out_trade_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) COMMENT <span class="hljs-string">'å•†æˆ·è®¢å•å·'</span>,
    `trade_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'äº¤æ˜“ç±»å‹'</span>,
    `trade_state` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'äº¤æ˜“çŠ¶æ€'</span>,
    `amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'äº¤æ˜“é‡‘é¢'</span>,
    `fee` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æ‰‹ç»­è´¹'</span>,
    `trade_time` DATETIME COMMENT <span class="hljs-string">'äº¤æ˜“æ—¶é—´'</span>,
    `body` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) COMMENT <span class="hljs-string">'å•†å“æè¿°'</span>,
    `recon_status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å¯¹è´¦çŠ¶æ€'</span>,
    `create_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    KEY `idx_task_id` (`task_id`),
    KEY `idx_transaction_id` (`transaction_id`),
    KEY `idx_out_trade_no` (`out_trade_no`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'å¾®ä¿¡è´¦å•æµæ°´'</span>;

<span class="hljs-comment">-- 4. æ¸ é“æµæ°´è¡¨ï¼ˆé“¶è¡Œï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `channel_bill_bank` (
    `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    `task_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä»»åŠ¡ID'</span>,
    `bank_serial_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'é“¶è¡Œæµæ°´å·'</span>,
    `merchant_order_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) COMMENT <span class="hljs-string">'å•†æˆ·è®¢å•å·'</span>,
    `trans_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'äº¤æ˜“ç±»å‹ï¼šDEBIT/CREDIT'</span>,
    `trans_status` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'äº¤æ˜“çŠ¶æ€'</span>,
    `amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'äº¤æ˜“é‡‘é¢'</span>,
    `fee` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æ‰‹ç»­è´¹'</span>,
    `trans_time` DATETIME COMMENT <span class="hljs-string">'äº¤æ˜“æ—¶é—´'</span>,
    `remark` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) COMMENT <span class="hljs-string">'å¤‡æ³¨'</span>,
    `account_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) COMMENT <span class="hljs-string">'è´¦æˆ·å·'</span>,
    `account_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) COMMENT <span class="hljs-string">'è´¦æˆ·å'</span>,
    `recon_status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å¯¹è´¦çŠ¶æ€'</span>,
    `create_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    KEY `idx_task_id` (`task_id`),
    KEY `idx_bank_serial_no` (`bank_serial_no`),
    KEY `idx_merchant_order_no` (`merchant_order_no`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'é“¶è¡Œè´¦å•æµæ°´'</span>;

<span class="hljs-comment">-- 5. è‡ªå®šä¹‰æ¸ é“æµæ°´è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `channel_bill_custom` (
    `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    `task_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä»»åŠ¡ID'</span>,
    `channel_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¸ é“ç¼–ç '</span>,
    `channel_trade_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¸ é“äº¤æ˜“å·'</span>,
    `merchant_order_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) COMMENT <span class="hljs-string">'å•†æˆ·è®¢å•å·'</span>,
    `trade_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'äº¤æ˜“ç±»å‹'</span>,
    `trade_status` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'äº¤æ˜“çŠ¶æ€'</span>,
    `amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'äº¤æ˜“é‡‘é¢'</span>,
    `fee` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æ‰‹ç»­è´¹'</span>,
    `trade_time` DATETIME COMMENT <span class="hljs-string">'äº¤æ˜“æ—¶é—´'</span>,
    `ext_data` JSON COMMENT <span class="hljs-string">'æ‰©å±•æ•°æ®'</span>,
    `recon_status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å¯¹è´¦çŠ¶æ€'</span>,
    `create_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    KEY `idx_task_id` (`task_id`),
    KEY `idx_channel_trade_no` (`channel_code`, `channel_trade_no`),
    KEY `idx_merchant_order_no` (`merchant_order_no`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'è‡ªå®šä¹‰æ¸ é“æµæ°´'</span>;

<span class="hljs-comment">-- 6. æœ¬åœ°æ”¯ä»˜æµæ°´è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `local_payment_record` (
    `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    `order_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å•†æˆ·è®¢å•å·'</span>,
    `channel_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ”¯ä»˜æ¸ é“'</span>,
    `channel_trade_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) COMMENT <span class="hljs-string">'æ¸ é“äº¤æ˜“å·'</span>,
    `pay_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'æ”¯ä»˜ç±»å‹'</span>,
    `pay_status` TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ”¯ä»˜çŠ¶æ€ï¼š0-å¾…æ”¯ä»˜,1-æ”¯ä»˜æˆåŠŸ,2-æ”¯ä»˜å¤±è´¥,3-å·²é€€æ¬¾'</span>,
    `amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ”¯ä»˜é‡‘é¢'</span>,
    `fee` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æ‰‹ç»­è´¹'</span>,
    `pay_time` DATETIME COMMENT <span class="hljs-string">'æ”¯ä»˜æ—¶é—´'</span>,
    `user_id` <span class="hljs-type">BIGINT</span> COMMENT <span class="hljs-string">'ç”¨æˆ·ID'</span>,
    `product_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) COMMENT <span class="hljs-string">'å•†å“åç§°'</span>,
    `recon_status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å¯¹è´¦çŠ¶æ€ï¼š0-å¾…å¯¹è´¦,1-å·²å¯¹è´¦,2-å·®å¼‚'</span>,
    `recon_time` DATETIME COMMENT <span class="hljs-string">'å¯¹è´¦æ—¶é—´'</span>,
    `create_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_order_no` (`order_no`),
    KEY `idx_channel_trade_no` (`channel_type`, `channel_trade_no`),
    KEY `idx_pay_time` (`pay_time`),
    KEY `idx_recon_status` (`recon_status`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'æœ¬åœ°æ”¯ä»˜æµæ°´è¡¨'</span>;

<span class="hljs-comment">-- 7. å¯¹è´¦ç»“æœè¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `recon_result` (
    `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    `task_id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä»»åŠ¡ID'</span>,
    `order_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) COMMENT <span class="hljs-string">'å•†æˆ·è®¢å•å·'</span>,
    `channel_trade_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) COMMENT <span class="hljs-string">'æ¸ é“äº¤æ˜“å·'</span>,
    `result_type` TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç»“æœç±»å‹ï¼š1-åŒ¹é…æˆåŠŸ,2-æœ¬åœ°å¤š,3-æ¸ é“å¤š,4-é‡‘é¢ä¸ä¸€è‡´,5-çŠ¶æ€ä¸ä¸€è‡´'</span>,
    `local_amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) COMMENT <span class="hljs-string">'æœ¬åœ°é‡‘é¢'</span>,
    `channel_amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) COMMENT <span class="hljs-string">'æ¸ é“é‡‘é¢'</span>,
    `diff_amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>) COMMENT <span class="hljs-string">'å·®å¼‚é‡‘é¢'</span>,
    `local_status` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'æœ¬åœ°çŠ¶æ€'</span>,
    `channel_status` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'æ¸ é“çŠ¶æ€'</span>,
    `handle_status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å¤„ç†çŠ¶æ€ï¼š0-å¾…å¤„ç†,1-å·²å¤„ç†,2-å¿½ç•¥'</span>,
    `handle_remark` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) COMMENT <span class="hljs-string">'å¤„ç†å¤‡æ³¨'</span>,
    `handler` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) COMMENT <span class="hljs-string">'å¤„ç†äºº'</span>,
    `handle_time` DATETIME COMMENT <span class="hljs-string">'å¤„ç†æ—¶é—´'</span>,
    `create_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    KEY `idx_task_id` (`task_id`),
    KEY `idx_order_no` (`order_no`),
    KEY `idx_result_type` (`result_type`),
    KEY `idx_handle_status` (`handle_status`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'å¯¹è´¦ç»“æœè¡¨'</span>;

<span class="hljs-comment">-- 8. æ¸ é“é…ç½®è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `recon_channel_config` (
    `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    `channel_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¸ é“ç¼–ç '</span>,
    `channel_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¸ é“åç§°'</span>,
    `file_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'æ–‡ä»¶ç±»å‹ï¼šCSV/EXCEL/TXT'</span>,
    `file_encoding` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'UTF-8'</span> COMMENT <span class="hljs-string">'æ–‡ä»¶ç¼–ç '</span>,
    `field_mapping` JSON COMMENT <span class="hljs-string">'å­—æ®µæ˜ å°„é…ç½®'</span>,
    `parser_class` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) COMMENT <span class="hljs-string">'è§£æå™¨ç±»å'</span>,
    `status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'çŠ¶æ€ï¼š0-ç¦ç”¨,1-å¯ç”¨'</span>,
    `create_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_channel_code` (`channel_code`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'æ¸ é“é…ç½®è¡¨'</span>;
</code></pre>
<h4 data-id="heading-11">3.2 E-R å…³ç³»å›¾</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                          E-R å…³ç³»å›¾                               |
+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                                                                   |
|   +<span class="hljs-comment">-------------+       1:N       +-------------------+           |</span>
|   | recon_task  |<span class="hljs-comment">----------------&gt;| channel_bill_xxx |           |</span>
|   +<span class="hljs-comment">-------------+                 +-------------------+           |</span>
|         |                                                         |
|         | <span class="hljs-number">1</span>:N                                                     |
|         v                                                         |
|   +<span class="hljs-comment">-------------+                 +---------------------+         |</span>
|   | recon_result|&lt;<span class="hljs-comment">---------------&gt;| local_payment_record|         |</span>
|   +<span class="hljs-comment">-------------+      å…³è”       +---------------------+         |</span>
|                                                                   |
|   +<span class="hljs-comment">---------------------+                                         |</span>
|   | recon_channel_config|  æ¸ é“é…ç½®ï¼ˆç‹¬ç«‹ï¼‰                        |
|   +<span class="hljs-comment">---------------------+                                         |</span>
|                                                                   |
+<span class="hljs-comment">------------------------------------------------------------------+</span>
</code></pre>
<hr/>
<h3 data-id="heading-12">å››ã€æ ¸å¿ƒä»£ç å®ç°</h3>
<h4 data-id="heading-13">4.1 åŸºç¡€å®ä½“ç±»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ¸ é“ç±»å‹æšä¸¾
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ChannelType</span> {
    ALIPAY(<span class="hljs-string">"ALIPAY"</span>, <span class="hljs-string">"æ”¯ä»˜å®"</span>),
    WECHAT(<span class="hljs-string">"WECHAT"</span>, <span class="hljs-string">"å¾®ä¿¡æ”¯ä»˜"</span>),
    BANK(<span class="hljs-string">"BANK"</span>, <span class="hljs-string">"é“¶è¡Œ"</span>),
    CUSTOM(<span class="hljs-string">"CUSTOM"</span>, <span class="hljs-string">"è‡ªå®šä¹‰æ¸ é“"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

    ChannelType(String code, String desc) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.desc = desc;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> code; }
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> desc; }
}

<span class="hljs-comment">/**
 * å¯¹è´¦ç»“æœç±»å‹æšä¸¾
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ReconResultType</span> {
    MATCHED(<span class="hljs-number">1</span>, <span class="hljs-string">"åŒ¹é…æˆåŠŸ"</span>),
    LOCAL_MORE(<span class="hljs-number">2</span>, <span class="hljs-string">"æœ¬åœ°å¤šï¼ˆé•¿æ¬¾ï¼‰"</span>),
    CHANNEL_MORE(<span class="hljs-number">3</span>, <span class="hljs-string">"æ¸ é“å¤šï¼ˆçŸ­æ¬¾ï¼‰"</span>),
    AMOUNT_MISMATCH(<span class="hljs-number">4</span>, <span class="hljs-string">"é‡‘é¢ä¸ä¸€è‡´"</span>),
    STATUS_MISMATCH(<span class="hljs-number">5</span>, <span class="hljs-string">"çŠ¶æ€ä¸ä¸€è‡´"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

    ReconResultType(<span class="hljs-type">int</span> code, String desc) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.desc = desc;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> code; }
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> desc; }
}

<span class="hljs-comment">/**
 * å¯¹è´¦ä»»åŠ¡çŠ¶æ€æšä¸¾
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">TaskStatus</span> {
    PENDING(<span class="hljs-number">0</span>, <span class="hljs-string">"å¾…å¤„ç†"</span>),
    PROCESSING(<span class="hljs-number">1</span>, <span class="hljs-string">"å¤„ç†ä¸­"</span>),
    COMPLETED(<span class="hljs-number">2</span>, <span class="hljs-string">"å·²å®Œæˆ"</span>),
    FAILED(<span class="hljs-number">3</span>, <span class="hljs-string">"å¤±è´¥"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

    TaskStatus(<span class="hljs-type">int</span> code, String desc) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.desc = desc;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> code; }
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> desc; }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯¹è´¦ä»»åŠ¡å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("recon_task")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReconTask</span> {
    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String taskNo;
    <span class="hljs-keyword">private</span> String channelType;
    <span class="hljs-keyword">private</span> LocalDate reconDate;
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-keyword">private</span> Integer totalCount;
    <span class="hljs-keyword">private</span> Integer successCount;
    <span class="hljs-keyword">private</span> Integer failCount;
    <span class="hljs-keyword">private</span> Integer diffCount;
    <span class="hljs-keyword">private</span> String filePath;
    <span class="hljs-keyword">private</span> String errorMsg;
    <span class="hljs-keyword">private</span> LocalDateTime startTime;
    <span class="hljs-keyword">private</span> LocalDateTime endTime;
    <span class="hljs-keyword">private</span> LocalDateTime createTime;
    <span class="hljs-keyword">private</span> LocalDateTime updateTime;
}

<span class="hljs-comment">/**
 * ç»Ÿä¸€æ¸ é“è´¦å•æ•°æ®æ¨¡å‹
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChannelBillDTO</span> {
    <span class="hljs-keyword">private</span> String channelTradeNo;      <span class="hljs-comment">// æ¸ é“äº¤æ˜“å·</span>
    <span class="hljs-keyword">private</span> String merchantOrderNo;     <span class="hljs-comment">// å•†æˆ·è®¢å•å·</span>
    <span class="hljs-keyword">private</span> String tradeType;           <span class="hljs-comment">// äº¤æ˜“ç±»å‹</span>
    <span class="hljs-keyword">private</span> String tradeStatus;         <span class="hljs-comment">// äº¤æ˜“çŠ¶æ€</span>
    <span class="hljs-keyword">private</span> BigDecimal amount;          <span class="hljs-comment">// äº¤æ˜“é‡‘é¢</span>
    <span class="hljs-keyword">private</span> BigDecimal fee;             <span class="hljs-comment">// æ‰‹ç»­è´¹</span>
    <span class="hljs-keyword">private</span> LocalDateTime tradeTime;    <span class="hljs-comment">// äº¤æ˜“æ—¶é—´</span>
    <span class="hljs-keyword">private</span> String remark;              <span class="hljs-comment">// å¤‡æ³¨</span>
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; extData;<span class="hljs-comment">// æ‰©å±•æ•°æ®</span>
}

<span class="hljs-comment">/**
 * æœ¬åœ°æ”¯ä»˜è®°å½•å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("local_payment_record")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalPaymentRecord</span> {
    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String orderNo;
    <span class="hljs-keyword">private</span> String channelType;
    <span class="hljs-keyword">private</span> String channelTradeNo;
    <span class="hljs-keyword">private</span> String payType;
    <span class="hljs-keyword">private</span> Integer payStatus;
    <span class="hljs-keyword">private</span> BigDecimal amount;
    <span class="hljs-keyword">private</span> BigDecimal fee;
    <span class="hljs-keyword">private</span> LocalDateTime payTime;
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> String productName;
    <span class="hljs-keyword">private</span> Integer reconStatus;
    <span class="hljs-keyword">private</span> LocalDateTime reconTime;
    <span class="hljs-keyword">private</span> LocalDateTime createTime;
    <span class="hljs-keyword">private</span> LocalDateTime updateTime;
}

<span class="hljs-comment">/**
 * å¯¹è´¦ç»“æœå®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("recon_result")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReconResult</span> {
    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> Long taskId;
    <span class="hljs-keyword">private</span> String orderNo;
    <span class="hljs-keyword">private</span> String channelTradeNo;
    <span class="hljs-keyword">private</span> Integer resultType;
    <span class="hljs-keyword">private</span> BigDecimal localAmount;
    <span class="hljs-keyword">private</span> BigDecimal channelAmount;
    <span class="hljs-keyword">private</span> BigDecimal diffAmount;
    <span class="hljs-keyword">private</span> String localStatus;
    <span class="hljs-keyword">private</span> String channelStatus;
    <span class="hljs-keyword">private</span> Integer handleStatus;
    <span class="hljs-keyword">private</span> String handleRemark;
    <span class="hljs-keyword">private</span> String handler;
    <span class="hljs-keyword">private</span> LocalDateTime handleTime;
    <span class="hljs-keyword">private</span> LocalDateTime createTime;
}
</code></pre>
<h4 data-id="heading-14">4.2 æ–‡ä»¶è§£æå™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è´¦å•è§£æå™¨æ¥å£
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BillParser</span> {

    <span class="hljs-comment">/**
     * è·å–æ”¯æŒçš„æ¸ é“ç±»å‹
     */</span>
    ChannelType <span class="hljs-title function_">getChannelType</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * è§£æè´¦å•æ–‡ä»¶
     */</span>
    List&lt;ChannelBillDTO&gt; <span class="hljs-title function_">parse</span><span class="hljs-params">(InputStream inputStream, String fileName)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * æ˜¯å¦æ”¯æŒè¯¥æ–‡ä»¶
     */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(String fileName)</span>;
}

<span class="hljs-comment">/**
 * æ”¯ä»˜å®è´¦å•è§£æå™¨
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlipayBillParser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BillParser</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ChannelType <span class="hljs-title function_">getChannelType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ChannelType.ALIPAY;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(String fileName)</span> {
        <span class="hljs-keyword">return</span> fileName != <span class="hljs-literal">null</span> &amp;&amp; fileName.contains(<span class="hljs-string">"alipay"</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;ChannelBillDTO&gt; <span class="hljs-title function_">parse</span><span class="hljs-params">(InputStream inputStream, String fileName)</span> <span class="hljs-keyword">throws</span> Exception {
        List&lt;ChannelBillDTO&gt; billList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// æ”¯ä»˜å®è´¦å•é€šå¸¸æ˜¯ CSV æ ¼å¼ï¼ŒGBK ç¼–ç </span>
        <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream, <span class="hljs-string">"GBK"</span>))) {

            String line;
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isDataSection</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-type">int</span> <span class="hljs-variable">lineNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

            <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) {
                lineNum++;

                <span class="hljs-comment">// è·³è¿‡è´¦å•å¤´éƒ¨ä¿¡æ¯ï¼ˆæ”¯ä»˜å®è´¦å•å‰å‡ è¡Œæ˜¯æ±‡æ€»ä¿¡æ¯ï¼‰</span>
                <span class="hljs-keyword">if</span> (line.startsWith(<span class="hljs-string">"æ”¯ä»˜å®äº¤æ˜“å·"</span>)) {
                    isDataSection = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">continue</span>;
                }

                <span class="hljs-comment">// è·³è¿‡æ±‡æ€»è¡Œ</span>
                <span class="hljs-keyword">if</span> (line.startsWith(<span class="hljs-string">"#"</span>) || line.trim().isEmpty()) {
                    <span class="hljs-keyword">continue</span>;
                }

                <span class="hljs-keyword">if</span> (!isDataSection) {
                    <span class="hljs-keyword">continue</span>;
                }

                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">ChannelBillDTO</span> <span class="hljs-variable">bill</span> <span class="hljs-operator">=</span> parseLine(line);
                    <span class="hljs-keyword">if</span> (bill != <span class="hljs-literal">null</span>) {
                        billList.add(bill);
                    }
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    log.warn(<span class="hljs-string">"è§£ææ”¯ä»˜å®è´¦å•ç¬¬{}è¡Œå¤±è´¥: {}"</span>, lineNum, e.getMessage());
                }
            }
        }

        log.info(<span class="hljs-string">"æ”¯ä»˜å®è´¦å•è§£æå®Œæˆï¼Œå…±{}æ¡è®°å½•"</span>, billList.size());
        <span class="hljs-keyword">return</span> billList;
    }

    <span class="hljs-keyword">private</span> ChannelBillDTO <span class="hljs-title function_">parseLine</span><span class="hljs-params">(String line)</span> {
        <span class="hljs-comment">// æ”¯ä»˜å®è´¦å•å­—æ®µï¼šæ”¯ä»˜å®äº¤æ˜“å·,å•†æˆ·è®¢å•å·,äº¤æ˜“ç±»å‹,äº¤æ˜“çŠ¶æ€,é‡‘é¢,æ‰‹ç»­è´¹,äº¤æ˜“æ—¶é—´...</span>
        String[] fields = line.split(<span class="hljs-string">","</span>);
        <span class="hljs-keyword">if</span> (fields.length &lt; <span class="hljs-number">7</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-type">ChannelBillDTO</span> <span class="hljs-variable">bill</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelBillDTO</span>();
        bill.setChannelTradeNo(fields[<span class="hljs-number">0</span>].trim());
        bill.setMerchantOrderNo(fields[<span class="hljs-number">1</span>].trim());
        bill.setTradeType(fields[<span class="hljs-number">2</span>].trim());
        bill.setTradeStatus(fields[<span class="hljs-number">3</span>].trim());
        bill.setAmount(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(fields[<span class="hljs-number">4</span>].trim()));
        bill.setFee(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(fields[<span class="hljs-number">5</span>].trim()));

        <span class="hljs-comment">// è§£ææ—¶é—´</span>
        <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        bill.setTradeTime(LocalDateTime.parse(fields[<span class="hljs-number">6</span>].trim(), formatter));

        <span class="hljs-keyword">return</span> bill;
    }
}

<span class="hljs-comment">/**
 * å¾®ä¿¡è´¦å•è§£æå™¨
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WechatBillParser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BillParser</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ChannelType <span class="hljs-title function_">getChannelType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ChannelType.WECHAT;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(String fileName)</span> {
        <span class="hljs-keyword">return</span> fileName != <span class="hljs-literal">null</span> &amp;&amp; fileName.contains(<span class="hljs-string">"wechat"</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;ChannelBillDTO&gt; <span class="hljs-title function_">parse</span><span class="hljs-params">(InputStream inputStream, String fileName)</span> <span class="hljs-keyword">throws</span> Exception {
        List&lt;ChannelBillDTO&gt; billList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// å¾®ä¿¡è´¦å•æ˜¯ CSV æ ¼å¼ï¼ŒUTF-8 ç¼–ç </span>
        <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream, StandardCharsets.UTF_8))) {

            String line;
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isDataSection</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-type">int</span> <span class="hljs-variable">lineNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

            <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) {
                lineNum++;

                <span class="hljs-comment">// å¾®ä¿¡è´¦å•ä»¥"äº¤æ˜“æ—¶é—´"å¼€å¤´çš„æ˜¯è¡¨å¤´</span>
                <span class="hljs-keyword">if</span> (line.startsWith(<span class="hljs-string">"äº¤æ˜“æ—¶é—´"</span>)) {
                    isDataSection = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">continue</span>;
                }

                <span class="hljs-comment">// è·³è¿‡æ±‡æ€»éƒ¨åˆ†</span>
                <span class="hljs-keyword">if</span> (line.startsWith(<span class="hljs-string">"æ€»äº¤æ˜“å•æ•°"</span>) || line.trim().isEmpty()) {
                    isDataSection = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">continue</span>;
                }

                <span class="hljs-keyword">if</span> (!isDataSection) {
                    <span class="hljs-keyword">continue</span>;
                }

                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">ChannelBillDTO</span> <span class="hljs-variable">bill</span> <span class="hljs-operator">=</span> parseLine(line);
                    <span class="hljs-keyword">if</span> (bill != <span class="hljs-literal">null</span>) {
                        billList.add(bill);
                    }
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    log.warn(<span class="hljs-string">"è§£æå¾®ä¿¡è´¦å•ç¬¬{}è¡Œå¤±è´¥: {}"</span>, lineNum, e.getMessage());
                }
            }
        }

        log.info(<span class="hljs-string">"å¾®ä¿¡è´¦å•è§£æå®Œæˆï¼Œå…±{}æ¡è®°å½•"</span>, billList.size());
        <span class="hljs-keyword">return</span> billList;
    }

    <span class="hljs-keyword">private</span> ChannelBillDTO <span class="hljs-title function_">parseLine</span><span class="hljs-params">(String line)</span> {
        <span class="hljs-comment">// å¾®ä¿¡è´¦å•å­—æ®µï¼šäº¤æ˜“æ—¶é—´,å…¬ä¼—è´¦å·ID,å•†æˆ·å·,å­å•†æˆ·å·,è®¾å¤‡å·,å¾®ä¿¡è®¢å•å·,å•†æˆ·è®¢å•å·,ç”¨æˆ·æ ‡è¯†,äº¤æ˜“ç±»å‹,äº¤æ˜“çŠ¶æ€,ä»˜æ¬¾é“¶è¡Œ,è´§å¸ç§ç±»,æ€»é‡‘é¢,ä¼ä¸šçº¢åŒ…é‡‘é¢,å¾®ä¿¡é€€æ¬¾å•å·,å•†æˆ·é€€æ¬¾å•å·,é€€æ¬¾é‡‘é¢,ä¼ä¸šçº¢åŒ…é€€æ¬¾é‡‘é¢,é€€æ¬¾ç±»å‹,é€€æ¬¾çŠ¶æ€,å•†å“åç§°,å•†æˆ·æ•°æ®åŒ…,æ‰‹ç»­è´¹,è´¹ç‡</span>
        String[] fields = line.split(<span class="hljs-string">","</span>);
        <span class="hljs-keyword">if</span> (fields.length &lt; <span class="hljs-number">15</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-type">ChannelBillDTO</span> <span class="hljs-variable">bill</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelBillDTO</span>();

        <span class="hljs-comment">// å»é™¤åå¼•å·ï¼ˆå¾®ä¿¡è´¦å•ä¸­æ•°å­—å­—æ®µå¸¦åå¼•å·ï¼‰</span>
        bill.setChannelTradeNo(cleanField(fields[<span class="hljs-number">5</span>]));
        bill.setMerchantOrderNo(cleanField(fields[<span class="hljs-number">6</span>]));
        bill.setTradeType(cleanField(fields[<span class="hljs-number">8</span>]));
        bill.setTradeStatus(cleanField(fields[<span class="hljs-number">9</span>]));

        <span class="hljs-comment">// é‡‘é¢å­—æ®µéœ€è¦å»é™¤ Â¥ ç¬¦å·</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">amountStr</span> <span class="hljs-operator">=</span> cleanField(fields[<span class="hljs-number">12</span>]).replace(<span class="hljs-string">"Â¥"</span>, <span class="hljs-string">""</span>);
        bill.setAmount(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(amountStr));

        <span class="hljs-comment">// æ‰‹ç»­è´¹</span>
        <span class="hljs-keyword">if</span> (fields.length &gt; <span class="hljs-number">22</span>) {
            <span class="hljs-type">String</span> <span class="hljs-variable">feeStr</span> <span class="hljs-operator">=</span> cleanField(fields[<span class="hljs-number">22</span>]).replace(<span class="hljs-string">"Â¥"</span>, <span class="hljs-string">""</span>);
            bill.setFee(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(feeStr));
        }

        <span class="hljs-comment">// è§£ææ—¶é—´</span>
        <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        bill.setTradeTime(LocalDateTime.parse(cleanField(fields[<span class="hljs-number">0</span>]), formatter));

        <span class="hljs-keyword">return</span> bill;
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">cleanField</span><span class="hljs-params">(String field)</span> {
        <span class="hljs-keyword">return</span> field.replace(<span class="hljs-string">"`"</span>, <span class="hljs-string">""</span>).trim();
    }
}

<span class="hljs-comment">/**
 * é“¶è¡Œè´¦å•è§£æå™¨ï¼ˆExcel æ ¼å¼ï¼‰
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BankBillParser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BillParser</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ChannelType <span class="hljs-title function_">getChannelType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ChannelType.BANK;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(String fileName)</span> {
        <span class="hljs-keyword">return</span> fileName != <span class="hljs-literal">null</span> &amp;&amp;
                (fileName.endsWith(<span class="hljs-string">".xlsx"</span>) || fileName.endsWith(<span class="hljs-string">".xls"</span>));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;ChannelBillDTO&gt; <span class="hljs-title function_">parse</span><span class="hljs-params">(InputStream inputStream, String fileName)</span> <span class="hljs-keyword">throws</span> Exception {
        List&lt;ChannelBillDTO&gt; billList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// ä½¿ç”¨ EasyExcel è§£æ</span>
        EasyExcel.read(inputStream, BankBillExcelDTO.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReadListener</span>&lt;BankBillExcelDTO&gt;() {

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invoke</span><span class="hljs-params">(BankBillExcelDTO data, AnalysisContext context)</span> {
                <span class="hljs-type">ChannelBillDTO</span> <span class="hljs-variable">bill</span> <span class="hljs-operator">=</span> convertToChannelBill(data);
                <span class="hljs-keyword">if</span> (bill != <span class="hljs-literal">null</span>) {
                    billList.add(bill);
                }
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAfterAllAnalysed</span><span class="hljs-params">(AnalysisContext context)</span> {
                log.info(<span class="hljs-string">"é“¶è¡Œè´¦å•è§£æå®Œæˆï¼Œå…±{}æ¡è®°å½•"</span>, billList.size());
            }
        }).sheet().doRead();

        <span class="hljs-keyword">return</span> billList;
    }

    <span class="hljs-keyword">private</span> ChannelBillDTO <span class="hljs-title function_">convertToChannelBill</span><span class="hljs-params">(BankBillExcelDTO excelDTO)</span> {
        <span class="hljs-type">ChannelBillDTO</span> <span class="hljs-variable">bill</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelBillDTO</span>();
        bill.setChannelTradeNo(excelDTO.getBankSerialNo());
        bill.setMerchantOrderNo(excelDTO.getMerchantOrderNo());
        bill.setTradeType(excelDTO.getTransType());
        bill.setTradeStatus(excelDTO.getTransStatus());
        bill.setAmount(excelDTO.getAmount());
        bill.setFee(excelDTO.getFee());
        bill.setTradeTime(excelDTO.getTransTime());
        bill.setRemark(excelDTO.getRemark());
        <span class="hljs-keyword">return</span> bill;
    }

    <span class="hljs-comment">/**
     * é“¶è¡Œè´¦å• Excel DTO
     */</span>
    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BankBillExcelDTO</span> {
        <span class="hljs-meta">@ExcelProperty("æµæ°´å·")</span>
        <span class="hljs-keyword">private</span> String bankSerialNo;

        <span class="hljs-meta">@ExcelProperty("å•†æˆ·è®¢å•å·")</span>
        <span class="hljs-keyword">private</span> String merchantOrderNo;

        <span class="hljs-meta">@ExcelProperty("äº¤æ˜“ç±»å‹")</span>
        <span class="hljs-keyword">private</span> String transType;

        <span class="hljs-meta">@ExcelProperty("äº¤æ˜“çŠ¶æ€")</span>
        <span class="hljs-keyword">private</span> String transStatus;

        <span class="hljs-meta">@ExcelProperty("äº¤æ˜“é‡‘é¢")</span>
        <span class="hljs-keyword">private</span> BigDecimal amount;

        <span class="hljs-meta">@ExcelProperty("æ‰‹ç»­è´¹")</span>
        <span class="hljs-keyword">private</span> BigDecimal fee;

        <span class="hljs-meta">@ExcelProperty("äº¤æ˜“æ—¶é—´")</span>
        <span class="hljs-keyword">private</span> LocalDateTime transTime;

        <span class="hljs-meta">@ExcelProperty("å¤‡æ³¨")</span>
        <span class="hljs-keyword">private</span> String remark;
    }
}

<span class="hljs-comment">/**
 * è‡ªå®šä¹‰æ¸ é“è§£æå™¨å·¥å‚
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomBillParserFactory</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconChannelConfigMapper channelConfigMapper;

    <span class="hljs-comment">/**
     * æ ¹æ®æ¸ é“é…ç½®åŠ¨æ€è§£æè´¦å•
     */</span>
    <span class="hljs-keyword">public</span> List&lt;ChannelBillDTO&gt; <span class="hljs-title function_">parse</span><span class="hljs-params">(String channelCode, InputStream inputStream)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">ReconChannelConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> channelConfigMapper.selectByChannelCode(channelCode);
        <span class="hljs-keyword">if</span> (config == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æ¸ é“é…ç½®ä¸å­˜åœ¨: "</span> + channelCode);
        }

        <span class="hljs-comment">// è§£æå­—æ®µæ˜ å°„é…ç½®</span>
        Map&lt;String, String&gt; fieldMapping = JSON.parseObject(
                config.getFieldMapping(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;Map&lt;String, String&gt;&gt;() {});

        List&lt;ChannelBillDTO&gt; billList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// æ ¹æ®æ–‡ä»¶ç±»å‹è§£æ</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"CSV"</span>.equalsIgnoreCase(config.getFileType())) {
            billList = parseCsv(inputStream, config.getFileEncoding(), fieldMapping);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"EXCEL"</span>.equalsIgnoreCase(config.getFileType())) {
            billList = parseExcel(inputStream, fieldMapping);
        }

        <span class="hljs-keyword">return</span> billList;
    }

    <span class="hljs-keyword">private</span> List&lt;ChannelBillDTO&gt; <span class="hljs-title function_">parseCsv</span><span class="hljs-params">(InputStream inputStream, String encoding,
                                           Map&lt;String, String&gt; fieldMapping)</span> <span class="hljs-keyword">throws</span> Exception {
        List&lt;ChannelBillDTO&gt; billList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream, encoding))) {

            <span class="hljs-comment">// è¯»å–è¡¨å¤´</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">headerLine</span> <span class="hljs-operator">=</span> reader.readLine();
            String[] headers = headerLine.split(<span class="hljs-string">","</span>);

            <span class="hljs-comment">// æ„å»ºåˆ—ç´¢å¼•æ˜ å°„</span>
            Map&lt;String, Integer&gt; columnIndex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; headers.length; i++) {
                columnIndex.put(headers[i].trim(), i);
            }

            String line;
            <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">if</span> (line.trim().isEmpty()) <span class="hljs-keyword">continue</span>;

                String[] fields = line.split(<span class="hljs-string">","</span>);
                <span class="hljs-type">ChannelBillDTO</span> <span class="hljs-variable">bill</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelBillDTO</span>();

                <span class="hljs-comment">// æ ¹æ®å­—æ®µæ˜ å°„é…ç½®å¡«å……æ•°æ®</span>
                <span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; entry : fieldMapping.entrySet()) {
                    <span class="hljs-type">String</span> <span class="hljs-variable">targetField</span> <span class="hljs-operator">=</span> entry.getKey();  <span class="hljs-comment">// ChannelBillDTO å­—æ®µå</span>
                    <span class="hljs-type">String</span> <span class="hljs-variable">sourceColumn</span> <span class="hljs-operator">=</span> entry.getValue(); <span class="hljs-comment">// æºæ–‡ä»¶åˆ—å</span>

                    <span class="hljs-type">Integer</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> columnIndex.get(sourceColumn);
                    <span class="hljs-keyword">if</span> (idx != <span class="hljs-literal">null</span> &amp;&amp; idx &lt; fields.length) {
                        setFieldValue(bill, targetField, fields[idx].trim());
                    }
                }

                billList.add(bill);
            }
        }

        <span class="hljs-keyword">return</span> billList;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(ChannelBillDTO bill, String fieldName, String value)</span> {
        <span class="hljs-keyword">switch</span> (fieldName) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"channelTradeNo"</span>:
                bill.setChannelTradeNo(value);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"merchantOrderNo"</span>:
                bill.setMerchantOrderNo(value);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"tradeType"</span>:
                bill.setTradeType(value);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"tradeStatus"</span>:
                bill.setTradeStatus(value);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"amount"</span>:
                bill.setAmount(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(value));
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"fee"</span>:
                bill.setFee(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(value));
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"tradeTime"</span>:
                bill.setTradeTime(LocalDateTime.parse(value,
                        DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>)));
                <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-keyword">private</span> List&lt;ChannelBillDTO&gt; <span class="hljs-title function_">parseExcel</span><span class="hljs-params">(InputStream inputStream,
                                             Map&lt;String, String&gt; fieldMapping)</span> {
        <span class="hljs-comment">// Excel è§£æé€»è¾‘ï¼Œç±»ä¼¼ CSV</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    }
}
</code></pre>
<h4 data-id="heading-15">4.3 å¯¹è´¦å¼•æ“æ ¸å¿ƒ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯¹è´¦å¼•æ“æ¥å£
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ReconEngine</span> {

    <span class="hljs-comment">/**
     * æ‰§è¡Œå¯¹è´¦
     */</span>
    ReconResult <span class="hljs-title function_">reconcile</span><span class="hljs-params">(ChannelBillDTO channelBill, LocalPaymentRecord localRecord)</span>;

    <span class="hljs-comment">/**
     * æ‰¹é‡å¯¹è´¦
     */</span>
    List&lt;ReconResult&gt; <span class="hljs-title function_">batchReconcile</span><span class="hljs-params">(List&lt;ChannelBillDTO&gt; channelBills,
                                      List&lt;LocalPaymentRecord&gt; localRecords)</span>;
}

<span class="hljs-comment">/**
 * å¯¹è´¦å¼•æ“å®ç°
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultReconEngine</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ReconEngine</span> {

    <span class="hljs-comment">// é‡‘é¢å®¹å·®ï¼ˆåˆ†ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">AMOUNT_TOLERANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.01"</span>);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ReconResult <span class="hljs-title function_">reconcile</span><span class="hljs-params">(ChannelBillDTO channelBill, LocalPaymentRecord localRecord)</span> {
        <span class="hljs-type">ReconResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReconResult</span>();
        result.setChannelTradeNo(channelBill.getChannelTradeNo());
        result.setChannelAmount(channelBill.getAmount());
        result.setChannelStatus(channelBill.getTradeStatus());

        <span class="hljs-keyword">if</span> (localRecord != <span class="hljs-literal">null</span>) {
            result.setOrderNo(localRecord.getOrderNo());
            result.setLocalAmount(localRecord.getAmount());
            result.setLocalStatus(String.valueOf(localRecord.getPayStatus()));

            <span class="hljs-comment">// æ¯”å¯¹é‡‘é¢</span>
            <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">diff</span> <span class="hljs-operator">=</span> channelBill.getAmount()
                    .subtract(localRecord.getAmount()).abs();

            <span class="hljs-keyword">if</span> (diff.compareTo(AMOUNT_TOLERANCE) &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// é‡‘é¢ä¸ä¸€è‡´</span>
                result.setResultType(ReconResultType.AMOUNT_MISMATCH.getCode());
                result.setDiffAmount(diff);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!isStatusMatched(channelBill.getTradeStatus(),
                    localRecord.getPayStatus())) {
                <span class="hljs-comment">// çŠ¶æ€ä¸ä¸€è‡´</span>
                result.setResultType(ReconResultType.STATUS_MISMATCH.getCode());
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// åŒ¹é…æˆåŠŸ</span>
                result.setResultType(ReconResultType.MATCHED.getCode());
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// æ¸ é“æœ‰ï¼Œæœ¬åœ°æ— ï¼ˆçŸ­æ¬¾ï¼‰</span>
            result.setResultType(ReconResultType.CHANNEL_MORE.getCode());
        }

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;ReconResult&gt; <span class="hljs-title function_">batchReconcile</span><span class="hljs-params">(List&lt;ChannelBillDTO&gt; channelBills,
                                             List&lt;LocalPaymentRecord&gt; localRecords)</span> {
        List&lt;ReconResult&gt; results = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// æ„å»ºæœ¬åœ°è®°å½•ç´¢å¼•ï¼ˆæŒ‰å•†æˆ·è®¢å•å·ï¼‰</span>
        Map&lt;String, LocalPaymentRecord&gt; localRecordMap = localRecords.stream()
                .collect(Collectors.toMap(
                        LocalPaymentRecord::getOrderNo,
                        r -&gt; r,
                        (r1, r2) -&gt; r1
                ));

        <span class="hljs-comment">// æ„å»ºæ¸ é“è®°å½•ç´¢å¼•</span>
        Map&lt;String, ChannelBillDTO&gt; channelBillMap = channelBills.stream()
                .collect(Collectors.toMap(
                        ChannelBillDTO::getMerchantOrderNo,
                        b -&gt; b,
                        (b1, b2) -&gt; b1
                ));

        Set&lt;String&gt; matchedOrderNos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

        <span class="hljs-comment">// éå†æ¸ é“è´¦å•è¿›è¡ŒåŒ¹é…</span>
        <span class="hljs-keyword">for</span> (ChannelBillDTO channelBill : channelBills) {
            <span class="hljs-type">String</span> <span class="hljs-variable">orderNo</span> <span class="hljs-operator">=</span> channelBill.getMerchantOrderNo();
            <span class="hljs-type">LocalPaymentRecord</span> <span class="hljs-variable">localRecord</span> <span class="hljs-operator">=</span> localRecordMap.get(orderNo);

            <span class="hljs-type">ReconResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> reconcile(channelBill, localRecord);
            results.add(result);

            <span class="hljs-keyword">if</span> (localRecord != <span class="hljs-literal">null</span>) {
                matchedOrderNos.add(orderNo);
            }
        }

        <span class="hljs-comment">// æ£€æŸ¥æœ¬åœ°å¤šçš„è®°å½•ï¼ˆé•¿æ¬¾ï¼‰</span>
        <span class="hljs-keyword">for</span> (LocalPaymentRecord localRecord : localRecords) {
            <span class="hljs-keyword">if</span> (!matchedOrderNos.contains(localRecord.getOrderNo())) {
                <span class="hljs-type">ReconResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReconResult</span>();
                result.setOrderNo(localRecord.getOrderNo());
                result.setLocalAmount(localRecord.getAmount());
                result.setLocalStatus(String.valueOf(localRecord.getPayStatus()));
                result.setResultType(ReconResultType.LOCAL_MORE.getCode());
                results.add(result);
            }
        }

        <span class="hljs-keyword">return</span> results;
    }

    <span class="hljs-comment">/**
     * çŠ¶æ€åŒ¹é…åˆ¤æ–­
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isStatusMatched</span><span class="hljs-params">(String channelStatus, Integer localStatus)</span> {
        <span class="hljs-comment">// æ¸ é“çŠ¶æ€æ˜ å°„åˆ°æœ¬åœ°çŠ¶æ€</span>
        <span class="hljs-comment">// æ”¯ä»˜å®ï¼šTRADE_SUCCESS -&gt; 1</span>
        <span class="hljs-comment">// å¾®ä¿¡ï¼šSUCCESS -&gt; 1</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"TRADE_SUCCESS"</span>.equals(channelStatus) || <span class="hljs-string">"SUCCESS"</span>.equals(channelStatus)) {
            <span class="hljs-keyword">return</span> localStatus == <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ”¯ä»˜æˆåŠŸ</span>
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"TRADE_CLOSED"</span>.equals(channelStatus) || <span class="hljs-string">"CLOSED"</span>.equals(channelStatus)) {
            <span class="hljs-keyword">return</span> localStatus == <span class="hljs-number">2</span>;  <span class="hljs-comment">// æ”¯ä»˜å¤±è´¥/å…³é—­</span>
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"REFUND"</span>.equals(channelStatus)) {
            <span class="hljs-keyword">return</span> localStatus == <span class="hljs-number">3</span>;  <span class="hljs-comment">// å·²é€€æ¬¾</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<h4 data-id="heading-16">4.4 å¯¹è´¦æœåŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯¹è´¦ä»»åŠ¡æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReconTaskService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconTaskMapper taskMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconResultMapper resultMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LocalPaymentRecordMapper localRecordMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> List&lt;BillParser&gt; billParsers;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DefaultReconEngine reconEngine;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ChannelBillService channelBillService;

    <span class="hljs-comment">/**
     * åˆ›å»ºå¯¹è´¦ä»»åŠ¡
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> ReconTask <span class="hljs-title function_">createTask</span><span class="hljs-params">(String channelType, LocalDate reconDate, String filePath)</span> {
        <span class="hljs-type">ReconTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReconTask</span>();
        task.setTaskNo(generateTaskNo());
        task.setChannelType(channelType);
        task.setReconDate(reconDate);
        task.setFilePath(filePath);
        task.setStatus(TaskStatus.PENDING.getCode());

        taskMapper.insert(task);
        <span class="hljs-keyword">return</span> task;
    }

    <span class="hljs-comment">/**
     * æ‰§è¡Œå¯¹è´¦ä»»åŠ¡
     */</span>
    <span class="hljs-meta">@Async</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeTask</span><span class="hljs-params">(Long taskId)</span> {
        <span class="hljs-type">ReconTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskMapper.selectById(taskId);
        <span class="hljs-keyword">if</span> (task == <span class="hljs-literal">null</span>) {
            log.error(<span class="hljs-string">"å¯¹è´¦ä»»åŠ¡ä¸å­˜åœ¨: {}"</span>, taskId);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ›´æ–°ä»»åŠ¡çŠ¶æ€</span>
            task.setStatus(TaskStatus.PROCESSING.getCode());
            task.setStartTime(LocalDateTime.now());
            taskMapper.updateById(task);

            <span class="hljs-comment">// 1. è§£ææ¸ é“è´¦å•</span>
            List&lt;ChannelBillDTO&gt; channelBills = parseBillFile(task);
            task.setTotalCount(channelBills.size());

            <span class="hljs-comment">// 2. ä¿å­˜æ¸ é“è´¦å•</span>
            channelBillService.saveBatch(task.getId(), task.getChannelType(), channelBills);

            <span class="hljs-comment">// 3. æŸ¥è¯¢æœ¬åœ°æ”¯ä»˜è®°å½•</span>
            List&lt;LocalPaymentRecord&gt; localRecords = queryLocalRecords(
                    task.getChannelType(), task.getReconDate());

            <span class="hljs-comment">// 4. æ‰§è¡Œå¯¹è´¦</span>
            List&lt;ReconResult&gt; results = reconEngine.batchReconcile(channelBills, localRecords);

            <span class="hljs-comment">// 5. ä¿å­˜å¯¹è´¦ç»“æœ</span>
            saveReconResults(task.getId(), results);

            <span class="hljs-comment">// 6. æ›´æ–°ä»»åŠ¡ç»Ÿè®¡</span>
            updateTaskStatistics(task, results);

            task.setStatus(TaskStatus.COMPLETED.getCode());
            task.setEndTime(LocalDateTime.now());

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"å¯¹è´¦ä»»åŠ¡æ‰§è¡Œå¤±è´¥: {}"</span>, taskId, e);
            task.setStatus(TaskStatus.FAILED.getCode());
            task.setErrorMsg(e.getMessage());
            task.setEndTime(LocalDateTime.now());
        }

        taskMapper.updateById(task);
    }

    <span class="hljs-comment">/**
     * è§£æè´¦å•æ–‡ä»¶
     */</span>
    <span class="hljs-keyword">private</span> List&lt;ChannelBillDTO&gt; <span class="hljs-title function_">parseBillFile</span><span class="hljs-params">(ReconTask task)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// è·å–æ–‡ä»¶è¾“å…¥æµ</span>
        <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> getFileInputStream(task.getFilePath());

        <span class="hljs-comment">// æŸ¥æ‰¾åŒ¹é…çš„è§£æå™¨</span>
        <span class="hljs-type">BillParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> billParsers.stream()
                .filter(p -&gt; p.getChannelType().getCode().equals(task.getChannelType()))
                .findFirst()
                .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ä¸æ”¯æŒçš„æ¸ é“ç±»å‹: "</span> + task.getChannelType()));

        <span class="hljs-keyword">return</span> parser.parse(inputStream, task.getFilePath());
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢æœ¬åœ°æ”¯ä»˜è®°å½•
     */</span>
    <span class="hljs-keyword">private</span> List&lt;LocalPaymentRecord&gt; <span class="hljs-title function_">queryLocalRecords</span><span class="hljs-params">(String channelType, LocalDate reconDate)</span> {
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> reconDate.atStartOfDay();
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> reconDate.plusDays(<span class="hljs-number">1</span>).atStartOfDay();

        <span class="hljs-keyword">return</span> localRecordMapper.selectByChannelAndTime(channelType, startTime, endTime);
    }

    <span class="hljs-comment">/**
     * ä¿å­˜å¯¹è´¦ç»“æœ
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveReconResults</span><span class="hljs-params">(Long taskId, List&lt;ReconResult&gt; results)</span> {
        <span class="hljs-comment">// æ‰¹é‡æ’å…¥</span>
        List&lt;List&lt;ReconResult&gt;&gt; batches = Lists.partition(results, <span class="hljs-number">500</span>);
        <span class="hljs-keyword">for</span> (List&lt;ReconResult&gt; batch : batches) {
            batch.forEach(r -&gt; r.setTaskId(taskId));
            resultMapper.insertBatch(batch);
        }
    }

    <span class="hljs-comment">/**
     * æ›´æ–°ä»»åŠ¡ç»Ÿè®¡
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateTaskStatistics</span><span class="hljs-params">(ReconTask task, List&lt;ReconResult&gt; results)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">successCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">diffCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> (ReconResult result : results) {
            <span class="hljs-keyword">if</span> (result.getResultType() == ReconResultType.MATCHED.getCode()) {
                successCount++;
            } <span class="hljs-keyword">else</span> {
                diffCount++;
            }
        }

        task.setSuccessCount(successCount);
        task.setDiffCount(diffCount);
        task.setFailCount(<span class="hljs-number">0</span>);
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateTaskNo</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"RECON"</span> + System.currentTimeMillis() +
                String.format(<span class="hljs-string">"%04d"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(<span class="hljs-number">10000</span>));
    }

    <span class="hljs-keyword">private</span> InputStream <span class="hljs-title function_">getFileInputStream</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// æ”¯æŒæœ¬åœ°æ–‡ä»¶å’Œ OSS æ–‡ä»¶</span>
        <span class="hljs-keyword">if</span> (filePath.startsWith(<span class="hljs-string">"http"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(filePath).openStream();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filePath);
    }
}
</code></pre>
<h4 data-id="heading-17">4.5 å®šæ—¶å¯¹è´¦ä»»åŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯¹è´¦å®šæ—¶ä»»åŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReconScheduleTask</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconTaskService taskService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BillDownloadService billDownloadService;

    <span class="hljs-comment">/**
     * æ¯å¤©å‡Œæ™¨ 1 ç‚¹æ‰§è¡Œå‰ä¸€å¤©çš„å¯¹è´¦
     */</span>
    <span class="hljs-meta">@Scheduled(cron = "0 0 1 * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dailyReconciliation</span><span class="hljs-params">()</span> {
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">reconDate</span> <span class="hljs-operator">=</span> LocalDate.now().minusDays(<span class="hljs-number">1</span>);
        log.info(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œ {} çš„å¯¹è´¦ä»»åŠ¡"</span>, reconDate);

        <span class="hljs-comment">// æ”¯ä»˜å®å¯¹è´¦</span>
        executeChannelRecon(ChannelType.ALIPAY, reconDate);

        <span class="hljs-comment">// å¾®ä¿¡å¯¹è´¦</span>
        executeChannelRecon(ChannelType.WECHAT, reconDate);

        <span class="hljs-comment">// é“¶è¡Œå¯¹è´¦</span>
        executeChannelRecon(ChannelType.BANK, reconDate);

        log.info(<span class="hljs-string">"{} çš„å¯¹è´¦ä»»åŠ¡åˆ›å»ºå®Œæˆ"</span>, reconDate);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeChannelRecon</span><span class="hljs-params">(ChannelType channelType, LocalDate reconDate)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. ä¸‹è½½è´¦å•æ–‡ä»¶</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> billDownloadService.downloadBill(channelType, reconDate);

            <span class="hljs-comment">// 2. åˆ›å»ºå¯¹è´¦ä»»åŠ¡</span>
            <span class="hljs-type">ReconTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTask(
                    channelType.getCode(), reconDate, filePath);

            <span class="hljs-comment">// 3. å¼‚æ­¥æ‰§è¡Œå¯¹è´¦</span>
            taskService.executeTask(task.getId());

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"{}æ¸ é“å¯¹è´¦ä»»åŠ¡åˆ›å»ºå¤±è´¥: {}"</span>, channelType.getDesc(), e.getMessage(), e);
        }
    }
}

<span class="hljs-comment">/**
 * è´¦å•ä¸‹è½½æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BillDownloadService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AlipayClient alipayClient;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> WxPayService wxPayService;

    <span class="hljs-comment">/**
     * ä¸‹è½½æ¸ é“è´¦å•
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">downloadBill</span><span class="hljs-params">(ChannelType channelType, LocalDate billDate)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">switch</span> (channelType) {
            <span class="hljs-keyword">case</span> ALIPAY:
                <span class="hljs-keyword">return</span> downloadAlipayBill(billDate);
            <span class="hljs-keyword">case</span> WECHAT:
                <span class="hljs-keyword">return</span> downloadWechatBill(billDate);
            <span class="hljs-keyword">case</span> BANK:
                <span class="hljs-keyword">return</span> downloadBankBill(billDate);
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ä¸æ”¯æŒçš„æ¸ é“ç±»å‹: "</span> + channelType);
        }
    }

    <span class="hljs-comment">/**
     * ä¸‹è½½æ”¯ä»˜å®è´¦å•
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">downloadAlipayBill</span><span class="hljs-params">(LocalDate billDate)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">AlipayDataDataserviceBillDownloadurlQueryRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlipayDataDataserviceBillDownloadurlQueryRequest</span>();

        Map&lt;String, String&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        params.put(<span class="hljs-string">"bill_type"</span>, <span class="hljs-string">"trade"</span>);
        params.put(<span class="hljs-string">"bill_date"</span>, billDate.format(DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd"</span>)));
        request.setBizContent(JSON.toJSONString(params));

        <span class="hljs-type">AlipayDataDataserviceBillDownloadurlQueryResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span>
                alipayClient.execute(request);

        <span class="hljs-keyword">if</span> (response.isSuccess()) {
            <span class="hljs-type">String</span> <span class="hljs-variable">downloadUrl</span> <span class="hljs-operator">=</span> response.getBillDownloadUrl();
            <span class="hljs-keyword">return</span> downloadAndSaveFile(downloadUrl, <span class="hljs-string">"alipay"</span>, billDate);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–æ”¯ä»˜å®è´¦å•ä¸‹è½½åœ°å€å¤±è´¥: "</span> + response.getMsg());
        }
    }

    <span class="hljs-comment">/**
     * ä¸‹è½½å¾®ä¿¡è´¦å•
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">downloadWechatBill</span><span class="hljs-params">(LocalDate billDate)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">WxPayDownloadBillRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WxPayDownloadBillRequest</span>();
        request.setBillDate(billDate.format(DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyyMMdd"</span>)));
        request.setBillType(<span class="hljs-string">"ALL"</span>);

        <span class="hljs-type">WxPayDownloadBillResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> wxPayService.downloadBill(request);

        <span class="hljs-comment">// ä¿å­˜è´¦å•å†…å®¹åˆ°æ–‡ä»¶</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"wechat_bill_%s.csv"</span>,
                billDate.format(DateTimeFormatter.BASIC_ISO_DATE));
        <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/data/bills/"</span> + fileName;

        Files.write(Paths.get(filePath), result.getBillContent().getBytes(StandardCharsets.UTF_8));

        <span class="hljs-keyword">return</span> filePath;
    }

    <span class="hljs-comment">/**
     * ä¸‹è½½é“¶è¡Œè´¦å•ï¼ˆé€šå¸¸æ˜¯ SFTP æ–¹å¼ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">downloadBankBill</span><span class="hljs-params">(LocalDate billDate)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// é“¶è¡Œè´¦å•é€šå¸¸é€šè¿‡ SFTP è·å–</span>
        <span class="hljs-comment">// è¿™é‡Œç®€åŒ–å¤„ç†</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"bank_bill_%s.xlsx"</span>,
                billDate.format(DateTimeFormatter.BASIC_ISO_DATE));
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/data/bills/"</span> + fileName;
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">downloadAndSaveFile</span><span class="hljs-params">(String url, String prefix, LocalDate billDate)</span>
            <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"%s_bill_%s.csv"</span>,
                prefix, billDate.format(DateTimeFormatter.BASIC_ISO_DATE));
        <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/data/bills/"</span> + fileName;

        <span class="hljs-comment">// ä¸‹è½½æ–‡ä»¶</span>
        <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url).openStream()) {
            Files.copy(in, Paths.get(filePath), StandardCopyOption.REPLACE_EXISTING);
        }

        <span class="hljs-keyword">return</span> filePath;
    }
}
</code></pre>
<h4 data-id="heading-18">4.6 å·®å¼‚å¤„ç†æœåŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å·®å¼‚å¤„ç†æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiffHandleService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconResultMapper resultMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LocalPaymentRecordMapper localRecordMapper;

    <span class="hljs-comment">/**
     * æŸ¥è¯¢å¾…å¤„ç†å·®å¼‚
     */</span>
    <span class="hljs-keyword">public</span> List&lt;ReconResult&gt; <span class="hljs-title function_">queryPendingDiffs</span><span class="hljs-params">(Long taskId)</span> {
        <span class="hljs-keyword">return</span> resultMapper.selectByTaskAndStatus(taskId, <span class="hljs-number">0</span>);
    }

    <span class="hljs-comment">/**
     * å¤„ç†å·®å¼‚ï¼šæ ‡è®°ä¸ºå·²å¤„ç†
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleDiff</span><span class="hljs-params">(Long resultId, String handleRemark, String handler)</span> {
        <span class="hljs-type">ReconResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> resultMapper.selectById(resultId);
        <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å¯¹è´¦ç»“æœä¸å­˜åœ¨"</span>);
        }

        result.setHandleStatus(<span class="hljs-number">1</span>);  <span class="hljs-comment">// å·²å¤„ç†</span>
        result.setHandleRemark(handleRemark);
        result.setHandler(handler);
        result.setHandleTime(LocalDateTime.now());

        resultMapper.updateById(result);

        <span class="hljs-comment">// æ›´æ–°æœ¬åœ°è®°å½•çš„å¯¹è´¦çŠ¶æ€</span>
        <span class="hljs-keyword">if</span> (result.getOrderNo() != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">LocalPaymentRecord</span> <span class="hljs-variable">localRecord</span> <span class="hljs-operator">=</span> localRecordMapper.selectByOrderNo(result.getOrderNo());
            <span class="hljs-keyword">if</span> (localRecord != <span class="hljs-literal">null</span>) {
                localRecord.setReconStatus(<span class="hljs-number">1</span>);  <span class="hljs-comment">// å·²å¯¹è´¦</span>
                localRecord.setReconTime(LocalDateTime.now());
                localRecordMapper.updateById(localRecord);
            }
        }
    }

    <span class="hljs-comment">/**
     * å¿½ç•¥å·®å¼‚
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ignoreDiff</span><span class="hljs-params">(Long resultId, String reason, String handler)</span> {
        <span class="hljs-type">ReconResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> resultMapper.selectById(resultId);
        <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å¯¹è´¦ç»“æœä¸å­˜åœ¨"</span>);
        }

        result.setHandleStatus(<span class="hljs-number">2</span>);  <span class="hljs-comment">// å¿½ç•¥</span>
        result.setHandleRemark(<span class="hljs-string">"å¿½ç•¥åŸå› : "</span> + reason);
        result.setHandler(handler);
        result.setHandleTime(LocalDateTime.now());

        resultMapper.updateById(result);
    }

    <span class="hljs-comment">/**
     * æ‰¹é‡å¤„ç†çŸ­æ¬¾ï¼ˆæ¸ é“æœ‰æœ¬åœ°æ— ï¼‰
     * è‡ªåŠ¨åˆ›å»ºæœ¬åœ°è¡¥å•è®°å½•
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchHandleChannelMore</span><span class="hljs-params">(List&lt;Long&gt; resultIds, String handler)</span> {
        <span class="hljs-keyword">for</span> (Long resultId : resultIds) {
            <span class="hljs-type">ReconResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> resultMapper.selectById(resultId);
            <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span> || result.getResultType() != ReconResultType.CHANNEL_MORE.getCode()) {
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-comment">// åˆ›å»ºè¡¥å•è®°å½•</span>
            <span class="hljs-type">LocalPaymentRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalPaymentRecord</span>();
            record.setOrderNo(result.getChannelTradeNo());  <span class="hljs-comment">// ä½¿ç”¨æ¸ é“äº¤æ˜“å·ä½œä¸ºè®¢å•å·</span>
            record.setChannelTradeNo(result.getChannelTradeNo());
            record.setAmount(result.getChannelAmount());
            record.setPayStatus(<span class="hljs-number">1</span>);  <span class="hljs-comment">// æ”¯ä»˜æˆåŠŸ</span>
            record.setReconStatus(<span class="hljs-number">1</span>);  <span class="hljs-comment">// å·²å¯¹è´¦</span>
            record.setReconTime(LocalDateTime.now());

            localRecordMapper.insert(record);

            <span class="hljs-comment">// æ›´æ–°å·®å¼‚å¤„ç†çŠ¶æ€</span>
            result.setHandleStatus(<span class="hljs-number">1</span>);
            result.setHandleRemark(<span class="hljs-string">"è‡ªåŠ¨è¡¥å•å¤„ç†"</span>);
            result.setHandler(handler);
            result.setHandleTime(LocalDateTime.now());
            resultMapper.updateById(result);

            log.info(<span class="hljs-string">"çŸ­æ¬¾è‡ªåŠ¨è¡¥å•: channelTradeNo={}"</span>, result.getChannelTradeNo());
        }
    }

    <span class="hljs-comment">/**
     * è‡ªåŠ¨å¤„ç†è§„åˆ™
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">autoHandleDiffs</span><span class="hljs-params">(Long taskId)</span> {
        List&lt;ReconResult&gt; diffs = queryPendingDiffs(taskId);

        <span class="hljs-keyword">for</span> (ReconResult diff : diffs) {
            <span class="hljs-comment">// è§„åˆ™1ï¼šé‡‘é¢å·®å¼‚å°äº1åˆ†ï¼Œè‡ªåŠ¨å¿½ç•¥</span>
            <span class="hljs-keyword">if</span> (diff.getResultType() == ReconResultType.AMOUNT_MISMATCH.getCode()) {
                <span class="hljs-keyword">if</span> (diff.getDiffAmount() != <span class="hljs-literal">null</span> &amp;&amp;
                        diff.getDiffAmount().compareTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.01"</span>)) &lt;= <span class="hljs-number">0</span>) {
                    ignoreDiff(diff.getId(), <span class="hljs-string">"é‡‘é¢å·®å¼‚å°äº1åˆ†ï¼Œç³»ç»Ÿè‡ªåŠ¨å¿½ç•¥"</span>, <span class="hljs-string">"SYSTEM"</span>);
                }
            }

            <span class="hljs-comment">// è§„åˆ™2ï¼šæ—¶é—´è·¨å¤©å·®å¼‚ï¼Œè‡ªåŠ¨å¿½ç•¥ï¼ˆéœ€è¦é¢å¤–é€»è¾‘åˆ¤æ–­ï¼‰</span>
            <span class="hljs-comment">// ...</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-19">4.7 å¯¹è´¦æŠ¥å‘Šç”Ÿæˆ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯¹è´¦æŠ¥å‘ŠæœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReconReportService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconTaskMapper taskMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconResultMapper resultMapper;

    <span class="hljs-comment">/**
     * ç”Ÿæˆå¯¹è´¦æŠ¥å‘Š
     */</span>
    <span class="hljs-keyword">public</span> ReconReport <span class="hljs-title function_">generateReport</span><span class="hljs-params">(Long taskId)</span> {
        <span class="hljs-type">ReconTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskMapper.selectById(taskId);
        <span class="hljs-keyword">if</span> (task == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å¯¹è´¦ä»»åŠ¡ä¸å­˜åœ¨"</span>);
        }

        <span class="hljs-type">ReconReport</span> <span class="hljs-variable">report</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReconReport</span>();
        report.setTaskNo(task.getTaskNo());
        report.setChannelType(task.getChannelType());
        report.setReconDate(task.getReconDate());

        <span class="hljs-comment">// ç»Ÿè®¡æ•°æ®</span>
        report.setTotalCount(task.getTotalCount());
        report.setSuccessCount(task.getSuccessCount());
        report.setDiffCount(task.getDiffCount());

        <span class="hljs-comment">// è®¡ç®—å¯¹è´¦ç‡</span>
        <span class="hljs-keyword">if</span> (task.getTotalCount() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-type">double</span> <span class="hljs-variable">successRate</span> <span class="hljs-operator">=</span> (<span class="hljs-type">double</span>) task.getSuccessCount() / task.getTotalCount() * <span class="hljs-number">100</span>;
            report.setSuccessRate(String.format(<span class="hljs-string">"%.2f%%"</span>, successRate));
        }

        <span class="hljs-comment">// å·®å¼‚åˆ†ç±»ç»Ÿè®¡</span>
        Map&lt;Integer, Long&gt; diffTypeCount = resultMapper.countByResultType(taskId);
        report.setLocalMoreCount(diffTypeCount.getOrDefault(ReconResultType.LOCAL_MORE.getCode(), <span class="hljs-number">0L</span>));
        report.setChannelMoreCount(diffTypeCount.getOrDefault(ReconResultType.CHANNEL_MORE.getCode(), <span class="hljs-number">0L</span>));
        report.setAmountMismatchCount(diffTypeCount.getOrDefault(ReconResultType.AMOUNT_MISMATCH.getCode(), <span class="hljs-number">0L</span>));
        report.setStatusMismatchCount(diffTypeCount.getOrDefault(ReconResultType.STATUS_MISMATCH.getCode(), <span class="hljs-number">0L</span>));

        <span class="hljs-comment">// å·®å¼‚é‡‘é¢ç»Ÿè®¡</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalDiffAmount</span> <span class="hljs-operator">=</span> resultMapper.sumDiffAmount(taskId);
        report.setTotalDiffAmount(totalDiffAmount);

        <span class="hljs-comment">// ç”Ÿæˆæ—¶é—´</span>
        report.setGenerateTime(LocalDateTime.now());

        <span class="hljs-keyword">return</span> report;
    }

    <span class="hljs-comment">/**
     * å¯¼å‡ºå¯¹è´¦æŠ¥å‘Š Excel
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exportReportExcel</span><span class="hljs-params">(Long taskId, OutputStream outputStream)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">ReconReport</span> <span class="hljs-variable">report</span> <span class="hljs-operator">=</span> generateReport(taskId);
        List&lt;ReconResult&gt; diffs = resultMapper.selectDiffsByTaskId(taskId);

        <span class="hljs-comment">// ä½¿ç”¨ EasyExcel å¯¼å‡º</span>
        <span class="hljs-type">ExcelWriter</span> <span class="hljs-variable">excelWriter</span> <span class="hljs-operator">=</span> EasyExcel.write(outputStream).build();

        <span class="hljs-comment">// Sheet1: æŠ¥å‘Šæ‘˜è¦</span>
        <span class="hljs-type">WriteSheet</span> <span class="hljs-variable">summarySheet</span> <span class="hljs-operator">=</span> EasyExcel.writerSheet(<span class="hljs-number">0</span>, <span class="hljs-string">"å¯¹è´¦æ‘˜è¦"</span>)
                .head(ReportSummary.class).build();
        excelWriter.write(Collections.singletonList(convertToSummary(report)), summarySheet);

        <span class="hljs-comment">// Sheet2: å·®å¼‚æ˜ç»†</span>
        <span class="hljs-type">WriteSheet</span> <span class="hljs-variable">diffSheet</span> <span class="hljs-operator">=</span> EasyExcel.writerSheet(<span class="hljs-number">1</span>, <span class="hljs-string">"å·®å¼‚æ˜ç»†"</span>)
                .head(DiffDetail.class).build();
        excelWriter.write(convertToDiffDetails(diffs), diffSheet);

        excelWriter.finish();
    }

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReconReport</span> {
        <span class="hljs-keyword">private</span> String taskNo;
        <span class="hljs-keyword">private</span> String channelType;
        <span class="hljs-keyword">private</span> LocalDate reconDate;
        <span class="hljs-keyword">private</span> Integer totalCount;
        <span class="hljs-keyword">private</span> Integer successCount;
        <span class="hljs-keyword">private</span> Integer diffCount;
        <span class="hljs-keyword">private</span> String successRate;
        <span class="hljs-keyword">private</span> Long localMoreCount;
        <span class="hljs-keyword">private</span> Long channelMoreCount;
        <span class="hljs-keyword">private</span> Long amountMismatchCount;
        <span class="hljs-keyword">private</span> Long statusMismatchCount;
        <span class="hljs-keyword">private</span> BigDecimal totalDiffAmount;
        <span class="hljs-keyword">private</span> LocalDateTime generateTime;
    }

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReportSummary</span> {
        <span class="hljs-meta">@ExcelProperty("ä»»åŠ¡ç¼–å·")</span>
        <span class="hljs-keyword">private</span> String taskNo;

        <span class="hljs-meta">@ExcelProperty("æ¸ é“ç±»å‹")</span>
        <span class="hljs-keyword">private</span> String channelType;

        <span class="hljs-meta">@ExcelProperty("å¯¹è´¦æ—¥æœŸ")</span>
        <span class="hljs-keyword">private</span> String reconDate;

        <span class="hljs-meta">@ExcelProperty("æ€»è®°å½•æ•°")</span>
        <span class="hljs-keyword">private</span> Integer totalCount;

        <span class="hljs-meta">@ExcelProperty("æˆåŠŸæ•°")</span>
        <span class="hljs-keyword">private</span> Integer successCount;

        <span class="hljs-meta">@ExcelProperty("å·®å¼‚æ•°")</span>
        <span class="hljs-keyword">private</span> Integer diffCount;

        <span class="hljs-meta">@ExcelProperty("å¯¹è´¦æˆåŠŸç‡")</span>
        <span class="hljs-keyword">private</span> String successRate;
    }

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiffDetail</span> {
        <span class="hljs-meta">@ExcelProperty("å•†æˆ·è®¢å•å·")</span>
        <span class="hljs-keyword">private</span> String orderNo;

        <span class="hljs-meta">@ExcelProperty("æ¸ é“äº¤æ˜“å·")</span>
        <span class="hljs-keyword">private</span> String channelTradeNo;

        <span class="hljs-meta">@ExcelProperty("å·®å¼‚ç±»å‹")</span>
        <span class="hljs-keyword">private</span> String resultType;

        <span class="hljs-meta">@ExcelProperty("æœ¬åœ°é‡‘é¢")</span>
        <span class="hljs-keyword">private</span> BigDecimal localAmount;

        <span class="hljs-meta">@ExcelProperty("æ¸ é“é‡‘é¢")</span>
        <span class="hljs-keyword">private</span> BigDecimal channelAmount;

        <span class="hljs-meta">@ExcelProperty("å·®å¼‚é‡‘é¢")</span>
        <span class="hljs-keyword">private</span> BigDecimal diffAmount;

        <span class="hljs-meta">@ExcelProperty("å¤„ç†çŠ¶æ€")</span>
        <span class="hljs-keyword">private</span> String handleStatus;
    }

    <span class="hljs-keyword">private</span> ReportSummary <span class="hljs-title function_">convertToSummary</span><span class="hljs-params">(ReconReport report)</span> {
        <span class="hljs-type">ReportSummary</span> <span class="hljs-variable">summary</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReportSummary</span>();
        summary.setTaskNo(report.getTaskNo());
        summary.setChannelType(report.getChannelType());
        summary.setReconDate(report.getReconDate().toString());
        summary.setTotalCount(report.getTotalCount());
        summary.setSuccessCount(report.getSuccessCount());
        summary.setDiffCount(report.getDiffCount());
        summary.setSuccessRate(report.getSuccessRate());
        <span class="hljs-keyword">return</span> summary;
    }

    <span class="hljs-keyword">private</span> List&lt;DiffDetail&gt; <span class="hljs-title function_">convertToDiffDetails</span><span class="hljs-params">(List&lt;ReconResult&gt; diffs)</span> {
        <span class="hljs-keyword">return</span> diffs.stream().map(d -&gt; {
            <span class="hljs-type">DiffDetail</span> <span class="hljs-variable">detail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiffDetail</span>();
            detail.setOrderNo(d.getOrderNo());
            detail.setChannelTradeNo(d.getChannelTradeNo());
            detail.setResultType(ReconResultType.values()[d.getResultType() - <span class="hljs-number">1</span>].getDesc());
            detail.setLocalAmount(d.getLocalAmount());
            detail.setChannelAmount(d.getChannelAmount());
            detail.setDiffAmount(d.getDiffAmount());
            detail.setHandleStatus(d.getHandleStatus() == <span class="hljs-number">0</span> ? <span class="hljs-string">"å¾…å¤„ç†"</span> :
                    d.getHandleStatus() == <span class="hljs-number">1</span> ? <span class="hljs-string">"å·²å¤„ç†"</span> : <span class="hljs-string">"å·²å¿½ç•¥"</span>);
            <span class="hljs-keyword">return</span> detail;
        }).collect(Collectors.toList());
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-20">äº”ã€è‡ªå®šä¹‰æ¸ é“å¯¼å…¥</h3>
<h4 data-id="heading-21">5.1 è‡ªå®šä¹‰æ¸ é“é…ç½®</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ¸ é“é…ç½®å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("recon_channel_config")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReconChannelConfig</span> {
    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String channelCode;
    <span class="hljs-keyword">private</span> String channelName;
    <span class="hljs-keyword">private</span> String fileType;
    <span class="hljs-keyword">private</span> String fileEncoding;
    <span class="hljs-keyword">private</span> String fieldMapping;  <span class="hljs-comment">// JSON æ ¼å¼</span>
    <span class="hljs-keyword">private</span> String parserClass;
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-keyword">private</span> LocalDateTime createTime;
    <span class="hljs-keyword">private</span> LocalDateTime updateTime;
}

<span class="hljs-comment">/**
 * æ¸ é“é…ç½®æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChannelConfigService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconChannelConfigMapper configMapper;

    <span class="hljs-comment">/**
     * åˆ›å»ºè‡ªå®šä¹‰æ¸ é“é…ç½®
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createChannelConfig</span><span class="hljs-params">(ChannelConfigDTO dto)</span> {
        <span class="hljs-comment">// éªŒè¯å­—æ®µæ˜ å°„</span>
        validateFieldMapping(dto.getFieldMapping());

        <span class="hljs-type">ReconChannelConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReconChannelConfig</span>();
        config.setChannelCode(dto.getChannelCode());
        config.setChannelName(dto.getChannelName());
        config.setFileType(dto.getFileType());
        config.setFileEncoding(dto.getFileEncoding());
        config.setFieldMapping(JSON.toJSONString(dto.getFieldMapping()));
        config.setStatus(<span class="hljs-number">1</span>);

        configMapper.insert(config);
    }

    <span class="hljs-comment">/**
     * éªŒè¯å­—æ®µæ˜ å°„é…ç½®
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateFieldMapping</span><span class="hljs-params">(Map&lt;String, String&gt; fieldMapping)</span> {
        <span class="hljs-comment">// å¿…é¡»åŒ…å«çš„å­—æ®µ</span>
        List&lt;String&gt; requiredFields = Arrays.asList(
                <span class="hljs-string">"channelTradeNo"</span>, <span class="hljs-string">"merchantOrderNo"</span>, <span class="hljs-string">"amount"</span>, <span class="hljs-string">"tradeStatus"</span>
        );

        <span class="hljs-keyword">for</span> (String field : requiredFields) {
            <span class="hljs-keyword">if</span> (!fieldMapping.containsKey(field)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ç¼ºå°‘å¿…è¦å­—æ®µæ˜ å°„: "</span> + field);
            }
        }
    }

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChannelConfigDTO</span> {
        <span class="hljs-keyword">private</span> String channelCode;
        <span class="hljs-keyword">private</span> String channelName;
        <span class="hljs-keyword">private</span> String fileType;  <span class="hljs-comment">// CSV / EXCEL</span>
        <span class="hljs-keyword">private</span> String fileEncoding;
        <span class="hljs-keyword">private</span> Map&lt;String, String&gt; fieldMapping;
    }
}
</code></pre>
<h4 data-id="heading-22">5.2 æ–‡ä»¶ä¸Šä¼ ä¸å¯¼å…¥</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ–‡ä»¶ä¸Šä¼ æ§åˆ¶å™¨
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/recon")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReconController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconTaskService taskService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CustomBillParserFactory parserFactory;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ChannelBillService channelBillService;

    <span class="hljs-comment">/**
     * ä¸Šä¼ è‡ªå®šä¹‰æ¸ é“è´¦å•
     */</span>
    <span class="hljs-meta">@PostMapping("/upload/custom")</span>
    <span class="hljs-keyword">public</span> Result&lt;?&gt; uploadCustomBill(
            <span class="hljs-meta">@RequestParam("file")</span> MultipartFile file,
            <span class="hljs-meta">@RequestParam("channelCode")</span> String channelCode,
            <span class="hljs-meta">@RequestParam("reconDate")</span> <span class="hljs-meta">@DateTimeFormat(pattern = "yyyy-MM-dd")</span> LocalDate reconDate) {

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. ä¿å­˜æ–‡ä»¶</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> saveUploadFile(file);

            <span class="hljs-comment">// 2. åˆ›å»ºå¯¹è´¦ä»»åŠ¡</span>
            <span class="hljs-type">ReconTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTask(<span class="hljs-string">"CUSTOM"</span>, reconDate, filePath);

            <span class="hljs-comment">// 3. è§£æè´¦å•</span>
            List&lt;ChannelBillDTO&gt; bills = parserFactory.parse(channelCode, file.getInputStream());

            <span class="hljs-comment">// 4. ä¿å­˜è´¦å•æ•°æ®</span>
            channelBillService.saveCustomBills(task.getId(), channelCode, bills);

            <span class="hljs-comment">// 5. å¼‚æ­¥æ‰§è¡Œå¯¹è´¦</span>
            taskService.executeTask(task.getId());

            <span class="hljs-keyword">return</span> Result.success(task.getTaskNo());

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ä¸Šä¼ è‡ªå®šä¹‰æ¸ é“è´¦å•å¤±è´¥"</span>, e);
            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"ä¸Šä¼ å¤±è´¥: "</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">/**
     * ä¸Šä¼ æ”¯ä»˜å®/å¾®ä¿¡è´¦å•
     */</span>
    <span class="hljs-meta">@PostMapping("/upload/{channelType}")</span>
    <span class="hljs-keyword">public</span> Result&lt;?&gt; uploadBill(
            <span class="hljs-meta">@PathVariable</span> String channelType,
            <span class="hljs-meta">@RequestParam("file")</span> MultipartFile file,
            <span class="hljs-meta">@RequestParam("reconDate")</span> <span class="hljs-meta">@DateTimeFormat(pattern = "yyyy-MM-dd")</span> LocalDate reconDate) {

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä¿å­˜æ–‡ä»¶</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> saveUploadFile(file);

            <span class="hljs-comment">// åˆ›å»ºå¹¶æ‰§è¡Œå¯¹è´¦ä»»åŠ¡</span>
            <span class="hljs-type">ReconTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTask(channelType.toUpperCase(), reconDate, filePath);
            taskService.executeTask(task.getId());

            <span class="hljs-keyword">return</span> Result.success(task.getTaskNo());

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ä¸Šä¼ è´¦å•å¤±è´¥"</span>, e);
            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"ä¸Šä¼ å¤±è´¥: "</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢å¯¹è´¦ä»»åŠ¡çŠ¶æ€
     */</span>
    <span class="hljs-meta">@GetMapping("/task/{taskNo}")</span>
    <span class="hljs-keyword">public</span> Result&lt;ReconTask&gt; <span class="hljs-title function_">getTaskStatus</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String taskNo)</span> {
        <span class="hljs-type">ReconTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.getByTaskNo(taskNo);
        <span class="hljs-keyword">return</span> Result.success(task);
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢å¯¹è´¦å·®å¼‚åˆ—è¡¨
     */</span>
    <span class="hljs-meta">@GetMapping("/diff/list")</span>
    <span class="hljs-keyword">public</span> Result&lt;PageInfo&lt;ReconResult&gt;&gt; <span class="hljs-title function_">getDiffList</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam</span> Long taskId,
            <span class="hljs-meta">@RequestParam(defaultValue = "1")</span> <span class="hljs-type">int</span> pageNum,
            <span class="hljs-meta">@RequestParam(defaultValue = "20")</span> <span class="hljs-type">int</span> pageSize)</span> {

        PageHelper.startPage(pageNum, pageSize);
        List&lt;ReconResult&gt; diffs = taskService.getDiffList(taskId);

        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInfo</span>&lt;&gt;(diffs));
    }

    <span class="hljs-comment">/**
     * å¯¼å‡ºå¯¹è´¦æŠ¥å‘Š
     */</span>
    <span class="hljs-meta">@GetMapping("/report/export")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exportReport</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Long taskId, HttpServletResponse response)</span>
            <span class="hljs-keyword">throws</span> Exception {

        response.setContentType(<span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>);
        response.setHeader(<span class="hljs-string">"Content-Disposition"</span>,
                <span class="hljs-string">"attachment;filename=recon_report_"</span> + taskId + <span class="hljs-string">".xlsx"</span>);

        taskService.exportReport(taskId, response.getOutputStream());
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">saveUploadFile</span><span class="hljs-params">(MultipartFile file)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> file.getOriginalFilename();
        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> System.currentTimeMillis() + <span class="hljs-string">"_"</span> + originalFilename;
        <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/data/bills/upload/"</span> + fileName;

        <span class="hljs-type">File</span> <span class="hljs-variable">destFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath);
        <span class="hljs-keyword">if</span> (!destFile.getParentFile().exists()) {
            destFile.getParentFile().mkdirs();
        }

        file.transferTo(destFile);
        <span class="hljs-keyword">return</span> filePath;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-23">å…­ã€ç›‘æ§å‘Šè­¦</h3>
<h4 data-id="heading-24">6.1 å¯¹è´¦ç›‘æ§æŒ‡æ ‡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯¹è´¦ç›‘æ§æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReconMonitorService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconTaskMapper taskMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReconResultMapper resultMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AlertService alertService;

    <span class="hljs-comment">/**
     * ç›‘æ§å¯¹è´¦ä»»åŠ¡æ‰§è¡Œæƒ…å†µ
     */</span>
    <span class="hljs-meta">@Scheduled(cron = "0 0/30 * * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorTaskExecution</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ£€æŸ¥è¶…æ—¶ä»»åŠ¡ï¼ˆå¤„ç†ä¸­è¶…è¿‡1å°æ—¶ï¼‰</span>
        List&lt;ReconTask&gt; timeoutTasks = taskMapper.selectTimeoutTasks(
                TaskStatus.PROCESSING.getCode(), <span class="hljs-number">60</span>);

        <span class="hljs-keyword">for</span> (ReconTask task : timeoutTasks) {
            log.warn(<span class="hljs-string">"å¯¹è´¦ä»»åŠ¡æ‰§è¡Œè¶…æ—¶: taskNo={}"</span>, task.getTaskNo());
            alertService.sendAlert(AlertLevel.WARNING,
                    <span class="hljs-string">"å¯¹è´¦ä»»åŠ¡æ‰§è¡Œè¶…æ—¶"</span>, <span class="hljs-string">"ä»»åŠ¡ç¼–å·: "</span> + task.getTaskNo());
        }

        <span class="hljs-comment">// æ£€æŸ¥å¤±è´¥ä»»åŠ¡</span>
        List&lt;ReconTask&gt; failedTasks = taskMapper.selectTodayFailedTasks();
        <span class="hljs-keyword">if</span> (!failedTasks.isEmpty()) {
            log.error(<span class="hljs-string">"ä»Šæ—¥å­˜åœ¨å¤±è´¥çš„å¯¹è´¦ä»»åŠ¡: {}"</span>, failedTasks.size());
            alertService.sendAlert(AlertLevel.ERROR,
                    <span class="hljs-string">"å¯¹è´¦ä»»åŠ¡æ‰§è¡Œå¤±è´¥"</span>, <span class="hljs-string">"å¤±è´¥ä»»åŠ¡æ•°: "</span> + failedTasks.size());
        }
    }

    <span class="hljs-comment">/**
     * ç›‘æ§å·®å¼‚ç‡
     */</span>
    <span class="hljs-meta">@Scheduled(cron = "0 0 9 * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorDiffRate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">yesterday</span> <span class="hljs-operator">=</span> LocalDate.now().minusDays(<span class="hljs-number">1</span>);

        List&lt;ReconTask&gt; tasks = taskMapper.selectByReconDate(yesterday);

        <span class="hljs-keyword">for</span> (ReconTask task : tasks) {
            <span class="hljs-keyword">if</span> (task.getTotalCount() == <span class="hljs-literal">null</span> || task.getTotalCount() == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-comment">// è®¡ç®—å·®å¼‚ç‡</span>
            <span class="hljs-type">double</span> <span class="hljs-variable">diffRate</span> <span class="hljs-operator">=</span> (<span class="hljs-type">double</span>) task.getDiffCount() / task.getTotalCount() * <span class="hljs-number">100</span>;

            <span class="hljs-comment">// å·®å¼‚ç‡è¶…è¿‡é˜ˆå€¼å‘Šè­¦</span>
            <span class="hljs-keyword">if</span> (diffRate &gt; <span class="hljs-number">1.0</span>) {  <span class="hljs-comment">// å·®å¼‚ç‡è¶…è¿‡1%</span>
                log.warn(<span class="hljs-string">"å¯¹è´¦å·®å¼‚ç‡å¼‚å¸¸: channel={}, date={}, diffRate={}%"</span>,
                        task.getChannelType(), task.getReconDate(), diffRate);

                alertService.sendAlert(AlertLevel.WARNING,
                        <span class="hljs-string">"å¯¹è´¦å·®å¼‚ç‡å¼‚å¸¸"</span>,
                        String.format(<span class="hljs-string">"æ¸ é“: %s, æ—¥æœŸ: %s, å·®å¼‚ç‡: %.2f%%"</span>,
                                task.getChannelType(), task.getReconDate(), diffRate));
            }
        }
    }

    <span class="hljs-comment">/**
     * è·å–å¯¹è´¦çœ‹æ¿æ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> DashboardData <span class="hljs-title function_">getDashboardData</span><span class="hljs-params">(LocalDate startDate, LocalDate endDate)</span> {
        <span class="hljs-type">DashboardData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DashboardData</span>();

        <span class="hljs-comment">// ä»»åŠ¡ç»Ÿè®¡</span>
        data.setTotalTasks(taskMapper.countByDateRange(startDate, endDate));
        data.setSuccessTasks(taskMapper.countByStatusAndDateRange(
                TaskStatus.COMPLETED.getCode(), startDate, endDate));
        data.setFailedTasks(taskMapper.countByStatusAndDateRange(
                TaskStatus.FAILED.getCode(), startDate, endDate));

        <span class="hljs-comment">// å·®å¼‚ç»Ÿè®¡</span>
        data.setTotalDiffs(resultMapper.countDiffsByDateRange(startDate, endDate));
        data.setHandledDiffs(resultMapper.countHandledDiffsByDateRange(startDate, endDate));
        data.setPendingDiffs(data.getTotalDiffs() - data.getHandledDiffs());

        <span class="hljs-comment">// å·®å¼‚é‡‘é¢</span>
        data.setTotalDiffAmount(resultMapper.sumDiffAmountByDateRange(startDate, endDate));

        <span class="hljs-comment">// æ¸ é“ç»Ÿè®¡</span>
        data.setChannelStats(taskMapper.groupByChannel(startDate, endDate));

        <span class="hljs-comment">// è¶‹åŠ¿æ•°æ®</span>
        data.setTrendData(taskMapper.getDailyTrend(startDate, endDate));

        <span class="hljs-keyword">return</span> data;
    }

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DashboardData</span> {
        <span class="hljs-keyword">private</span> Long totalTasks;
        <span class="hljs-keyword">private</span> Long successTasks;
        <span class="hljs-keyword">private</span> Long failedTasks;
        <span class="hljs-keyword">private</span> Long totalDiffs;
        <span class="hljs-keyword">private</span> Long handledDiffs;
        <span class="hljs-keyword">private</span> Long pendingDiffs;
        <span class="hljs-keyword">private</span> BigDecimal totalDiffAmount;
        <span class="hljs-keyword">private</span> List&lt;ChannelStat&gt; channelStats;
        <span class="hljs-keyword">private</span> List&lt;TrendData&gt; trendData;
    }

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChannelStat</span> {
        <span class="hljs-keyword">private</span> String channelType;
        <span class="hljs-keyword">private</span> Long taskCount;
        <span class="hljs-keyword">private</span> Long diffCount;
        <span class="hljs-keyword">private</span> Double diffRate;
    }

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TrendData</span> {
        <span class="hljs-keyword">private</span> LocalDate date;
        <span class="hljs-keyword">private</span> Long totalCount;
        <span class="hljs-keyword">private</span> Long successCount;
        <span class="hljs-keyword">private</span> Long diffCount;
    }
}
</code></pre>
<h4 data-id="heading-25">6.2 å‘Šè­¦æœåŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å‘Šè­¦çº§åˆ«
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">AlertLevel</span> {
    INFO, WARNING, ERROR, CRITICAL
}

<span class="hljs-comment">/**
 * å‘Šè­¦æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlertService</span> {

    <span class="hljs-meta">@Value("${alert.dingtalk.webhook}")</span>
    <span class="hljs-keyword">private</span> String dingTalkWebhook;

    <span class="hljs-meta">@Value("${alert.email.to}")</span>
    <span class="hljs-keyword">private</span> String emailTo;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RestTemplate restTemplate;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JavaMailSender mailSender;

    <span class="hljs-comment">/**
     * å‘é€å‘Šè­¦
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendAlert</span><span class="hljs-params">(AlertLevel level, String title, String content)</span> {
        log.info(<span class="hljs-string">"å‘é€å‘Šè­¦: level={}, title={}"</span>, level, title);

        <span class="hljs-comment">// æ ¹æ®å‘Šè­¦çº§åˆ«é€‰æ‹©é€šçŸ¥æ–¹å¼</span>
        <span class="hljs-keyword">switch</span> (level) {
            <span class="hljs-keyword">case</span> INFO:
                <span class="hljs-comment">// ä»…è®°å½•æ—¥å¿—</span>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> WARNING:
                sendDingTalkAlert(title, content);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> ERROR:
            <span class="hljs-keyword">case</span> CRITICAL:
                sendDingTalkAlert(title, content);
                sendEmailAlert(title, content);
                <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-comment">/**
     * å‘é€é’‰é’‰å‘Šè­¦
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendDingTalkAlert</span><span class="hljs-params">(String title, String content)</span> {
        <span class="hljs-keyword">try</span> {
            Map&lt;String, Object&gt; message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            message.put(<span class="hljs-string">"msgtype"</span>, <span class="hljs-string">"markdown"</span>);

            Map&lt;String, String&gt; markdown = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            markdown.put(<span class="hljs-string">"title"</span>, title);
            markdown.put(<span class="hljs-string">"text"</span>, String.format(<span class="hljs-string">"### %s\n\n%s\n\n&gt; æ—¶é—´: %s"</span>,
                    title, content, LocalDateTime.now().format(
                            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>))));

            message.put(<span class="hljs-string">"markdown"</span>, markdown);

            restTemplate.postForObject(dingTalkWebhook, message, String.class);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"å‘é€é’‰é’‰å‘Šè­¦å¤±è´¥"</span>, e);
        }
    }

    <span class="hljs-comment">/**
     * å‘é€é‚®ä»¶å‘Šè­¦
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendEmailAlert</span><span class="hljs-params">(String title, String content)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">SimpleMailMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMailMessage</span>();
            message.setTo(emailTo.split(<span class="hljs-string">","</span>));
            message.setSubject(<span class="hljs-string">"[å¯¹è´¦ç³»ç»Ÿå‘Šè­¦] "</span> + title);
            message.setText(content + <span class="hljs-string">"\n\næ—¶é—´: "</span> + LocalDateTime.now());

            mailSender.send(message);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"å‘é€é‚®ä»¶å‘Šè­¦å¤±è´¥"</span>, e);
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-26">ä¸ƒã€ç³»ç»Ÿä¼˜åŒ–</h3>
<h4 data-id="heading-27">7.1 å¤§æ–‡ä»¶å¤„ç†ä¼˜åŒ–</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * åˆ†ç‰‡è§£æå¤§æ–‡ä»¶
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LargeFileBillParser</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BATCH_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ChannelBillService channelBillService;

    <span class="hljs-comment">/**
     * æµå¼è§£æå¤§æ–‡ä»¶
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseAndSave</span><span class="hljs-params">(Long taskId, String channelType,
                              InputStream inputStream)</span> <span class="hljs-keyword">throws</span> Exception {

        <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream, StandardCharsets.UTF_8))) {

            String line;
            List&lt;ChannelBillDTO&gt; batch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(BATCH_SIZE);
            <span class="hljs-type">int</span> <span class="hljs-variable">totalCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

            <span class="hljs-comment">// è·³è¿‡è¡¨å¤´</span>
            reader.readLine();

            <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">if</span> (line.trim().isEmpty()) <span class="hljs-keyword">continue</span>;

                <span class="hljs-type">ChannelBillDTO</span> <span class="hljs-variable">bill</span> <span class="hljs-operator">=</span> parseLine(line);
                <span class="hljs-keyword">if</span> (bill != <span class="hljs-literal">null</span>) {
                    batch.add(bill);
                    totalCount++;
                }

                <span class="hljs-comment">// æ‰¹é‡ä¿å­˜</span>
                <span class="hljs-keyword">if</span> (batch.size() &gt;= BATCH_SIZE) {
                    channelBillService.saveBatch(taskId, channelType, batch);
                    log.info(<span class="hljs-string">"å·²å¤„ç† {} æ¡è®°å½•"</span>, totalCount);
                    batch.clear();
                }
            }

            <span class="hljs-comment">// ä¿å­˜å‰©ä½™æ•°æ®</span>
            <span class="hljs-keyword">if</span> (!batch.isEmpty()) {
                channelBillService.saveBatch(taskId, channelType, batch);
            }

            log.info(<span class="hljs-string">"æ–‡ä»¶è§£æå®Œæˆï¼Œå…± {} æ¡è®°å½•"</span>, totalCount);
        }
    }

    <span class="hljs-keyword">private</span> ChannelBillDTO <span class="hljs-title function_">parseLine</span><span class="hljs-params">(String line)</span> {
        <span class="hljs-comment">// è§£æé€»è¾‘</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h4 data-id="heading-28">7.2 å¹¶è¡Œå¯¹è´¦ä¼˜åŒ–</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¹¶è¡Œå¯¹è´¦å¼•æ“
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParallelReconEngine</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DefaultReconEngine reconEngine;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(
            Runtime.getRuntime().availableProcessors());

    <span class="hljs-comment">/**
     * å¹¶è¡Œæ‰¹é‡å¯¹è´¦
     */</span>
    <span class="hljs-keyword">public</span> List&lt;ReconResult&gt; <span class="hljs-title function_">parallelReconcile</span><span class="hljs-params">(List&lt;ChannelBillDTO&gt; channelBills,
                                                 List&lt;LocalPaymentRecord&gt; localRecords)</span> {

        <span class="hljs-comment">// æ„å»ºæœ¬åœ°è®°å½•ç´¢å¼•</span>
        Map&lt;String, LocalPaymentRecord&gt; localRecordMap = localRecords.stream()
                .collect(Collectors.toMap(
                        LocalPaymentRecord::getOrderNo,
                        r -&gt; r,
                        (r1, r2) -&gt; r1
                ));

        <span class="hljs-comment">// åˆ†ç‰‡å¹¶è¡Œå¤„ç†</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">partitionSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;
        List&lt;List&lt;ChannelBillDTO&gt;&gt; partitions = Lists.partition(channelBills, partitionSize);

        List&lt;CompletableFuture&lt;List&lt;ReconResult&gt;&gt;&gt; futures = partitions.stream()
                .map(partition -&gt; CompletableFuture.supplyAsync(() -&gt;
                        processPartition(partition, localRecordMap), executor))
                .collect(Collectors.toList());

        <span class="hljs-comment">// åˆå¹¶ç»“æœ</span>
        <span class="hljs-keyword">return</span> futures.stream()
                .map(CompletableFuture::join)
                .flatMap(List::stream)
                .collect(Collectors.toList());
    }

    <span class="hljs-keyword">private</span> List&lt;ReconResult&gt; <span class="hljs-title function_">processPartition</span><span class="hljs-params">(List&lt;ChannelBillDTO&gt; partition,
                                                 Map&lt;String, LocalPaymentRecord&gt; localRecordMap)</span> {
        List&lt;ReconResult&gt; results = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">for</span> (ChannelBillDTO channelBill : partition) {
            <span class="hljs-type">LocalPaymentRecord</span> <span class="hljs-variable">localRecord</span> <span class="hljs-operator">=</span> localRecordMap.get(channelBill.getMerchantOrderNo());
            <span class="hljs-type">ReconResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> reconEngine.reconcile(channelBill, localRecord);
            results.add(result);
        }

        <span class="hljs-keyword">return</span> results;
    }
}
</code></pre>
<h4 data-id="heading-29">7.3 ç¼“å­˜ä¼˜åŒ–</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯¹è´¦ç¼“å­˜æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReconCacheService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TASK_KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"recon:task:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">RESULT_KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"recon:result:"</span>;

    <span class="hljs-comment">/**
     * ç¼“å­˜ä»»åŠ¡ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cacheTask</span><span class="hljs-params">(ReconTask task)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> TASK_KEY_PREFIX + task.getTaskNo();
        redisTemplate.opsForValue().set(key, task, Duration.ofHours(<span class="hljs-number">24</span>));
    }

    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜çš„ä»»åŠ¡
     */</span>
    <span class="hljs-keyword">public</span> ReconTask <span class="hljs-title function_">getTaskFromCache</span><span class="hljs-params">(String taskNo)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> TASK_KEY_PREFIX + taskNo;
        <span class="hljs-keyword">return</span> (ReconTask) redisTemplate.opsForValue().get(key);
    }

    <span class="hljs-comment">/**
     * ç¼“å­˜å¯¹è´¦è¿›åº¦
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateProgress</span><span class="hljs-params">(String taskNo, <span class="hljs-type">int</span> processedCount, <span class="hljs-type">int</span> totalCount)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> TASK_KEY_PREFIX + taskNo + <span class="hljs-string">":progress"</span>;
        Map&lt;String, Integer&gt; progress = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        progress.put(<span class="hljs-string">"processed"</span>, processedCount);
        progress.put(<span class="hljs-string">"total"</span>, totalCount);
        redisTemplate.opsForValue().set(key, progress, Duration.ofHours(<span class="hljs-number">2</span>));
    }

    <span class="hljs-comment">/**
     * è·å–å¯¹è´¦è¿›åº¦
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Integer&gt; <span class="hljs-title function_">getProgress</span><span class="hljs-params">(String taskNo)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> TASK_KEY_PREFIX + taskNo + <span class="hljs-string">":progress"</span>;
        <span class="hljs-keyword">return</span> (Map&lt;String, Integer&gt;) redisTemplate.opsForValue().get(key);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-30">å…«ã€æœ€ä½³å®è·µä¸æ€»ç»“</h3>
<h4 data-id="heading-31">8.1 å¯¹è´¦ç³»ç»Ÿè®¾è®¡è¦ç‚¹</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------------------------------------------------------+</span>
|                    å¯¹è´¦ç³»ç»Ÿè®¾è®¡è¦ç‚¹                                |
<span class="hljs-addition">+------------------------------------------------------------------+</span>
|                                                                   |
|   1. å¯æ‰©å±•æ€§                                                      |
|   - æ”¯æŒå¤šæ¸ é“æ¥å…¥                                                 |
|   - è§£æå™¨æ’ä»¶åŒ–                                                  |
|   - å­—æ®µæ˜ å°„å¯é…ç½®                                                 |
|                                                                   |
|   2. å¯é æ€§                                                        |
|   - ä»»åŠ¡å¤±è´¥é‡è¯•                                                  |
|   - æ–­ç‚¹ç»­ä¼                                                       |
|   - æ•°æ®æ ¡éªŒ                                                      |
|                                                                   |
|   3. æ€§èƒ½                                                         |
|   - å¤§æ–‡ä»¶åˆ†ç‰‡å¤„ç†                                                 |
|   - æ‰¹é‡æ•°æ®åº“æ“ä½œ                                                 |
|   - å¹¶è¡Œå¯¹è´¦                                                      |
|                                                                   |
|   4. å¯è§‚æµ‹æ€§                                                      |
|   - ä»»åŠ¡çŠ¶æ€ç›‘æ§                                                  |
|   - å·®å¼‚ç‡å‘Šè­¦                                                    |
|   - å¯¹è´¦æŠ¥å‘Š                                                      |
|                                                                   |
<span class="hljs-addition">+------------------------------------------------------------------+</span>
</code></pre>
<h4 data-id="heading-32">8.2 å¸¸è§é—®é¢˜å¤„ç†</h4>



































<table><thead><tr><th>é—®é¢˜ç±»å‹</th><th>åŸå› åˆ†æ</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>æ—¶é—´å·®å¼‚</td><td>è·¨å¤©äº¤æ˜“ã€æ—¶åŒºé—®é¢˜</td><td>æ‰©å¤§æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼Œç»Ÿä¸€æ—¶åŒº</td></tr><tr><td>é‡‘é¢å·®å¼‚</td><td>æ‰‹ç»­è´¹è®¡ç®—æ–¹å¼ä¸åŒ</td><td>æ˜ç¡®é‡‘é¢å£å¾„ï¼Œåˆ†å¼€æ¯”å¯¹</td></tr><tr><td>è®¢å•å·ä¸åŒ¹é…</td><td>æ ¼å¼ä¸ä¸€è‡´ã€å‰ç¼€å·®å¼‚</td><td>æ ‡å‡†åŒ–è®¢å•å·æ ¼å¼</td></tr><tr><td>é‡å¤å¯¹è´¦</td><td>åŒä¸€ç¬”äº¤æ˜“å¤šæ¬¡å‡ºç°</td><td>å»é‡å¤„ç†ï¼Œå¹‚ç­‰è®¾è®¡</td></tr><tr><td>è´¦å•å»¶è¿Ÿ</td><td>æ¸ é“è´¦å•ç”Ÿæˆå»¶è¿Ÿ</td><td>å»¶åå¯¹è´¦æ—¶é—´ï¼Œå¢åŠ å®¹é”™</td></tr></tbody></table>
<h4 data-id="heading-33">8.3 è¿ç»´å»ºè®®</h4>
<ol>
<li><strong>å¯¹è´¦æ—¶é—´é€‰æ‹©</strong>ï¼šå»ºè®®å‡Œæ™¨æ‰§è¡Œï¼Œé¿å…å½±å“ä¸šåŠ¡</li>
<li><strong>è´¦å•ä¿ç•™ç­–ç•¥</strong>ï¼šè‡³å°‘ä¿ç•™ 3 ä¸ªæœˆï¼Œä¾¿äºè¿½æº¯</li>
<li><strong>å·®å¼‚å¤„ç† SLA</strong>ï¼šåˆ¶å®šå·®å¼‚å¤„ç†æ—¶æ•ˆè¦æ±‚</li>
<li><strong>å®šæœŸå·¡æ£€</strong>ï¼šæ¯å‘¨æ£€æŸ¥å¯¹è´¦ä»»åŠ¡æ‰§è¡Œæƒ…å†µ</li>
<li><strong>å®¹ç¾å¤‡ä»½</strong>ï¼šå¯¹è´¦æ•°æ®å®šæœŸå¤‡ä»½</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[javaé™¤äº†AtomicIntegerï¼Œè¿˜æœ‰å“ªäº›å¸¸ç”¨çš„åŸå­ç±»ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7577722399375933482</link>    <guid>https://juejin.cn/post/7577722399375933482</guid>    <pubDate>2025-11-30T00:19:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577722399375933482" data-draft-id="7577715145121300534" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="javaé™¤äº†AtomicIntegerï¼Œè¿˜æœ‰å“ªäº›å¸¸ç”¨çš„åŸå­ç±»ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-30T00:19:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·34584828505"/> <meta itemprop="url" content="https://juejin.cn/user/3710177917545754"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            javaé™¤äº†AtomicIntegerï¼Œè¿˜æœ‰å“ªäº›å¸¸ç”¨çš„åŸå­ç±»ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3710177917545754/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·34584828505
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T00:19:37.000Z" title="Sun Nov 30 2025 00:19:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨Â <code>java.util.concurrent.atomic</code>Â åŒ…ä¸­ï¼Œé™¤äº†æœ€å¸¸ç”¨çš„Â <code>AtomicInteger</code>ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—é’ˆå¯¹ä¸åŒåœºæ™¯è®¾è®¡çš„åŸå­ç±»ï¼Œæ¶µç›–Â <strong>åŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ã€å­—æ®µæ›´æ–°ã€å¤åˆæ“ä½œ</strong>Â ç­‰ï¼Œæ ¸å¿ƒå‡åŸºäºÂ <code>CAS + volatile</code>Â å®ç°æ— é”åŸå­æ€§ã€‚ä»¥ä¸‹æ˜¯Â <strong>å¸¸ç”¨åŸå­ç±»åˆ†ç±»è¯¦è§£</strong>ï¼Œé™„åŠŸèƒ½ã€åœºæ™¯å’Œç¤ºä¾‹ä»£ç ï¼š</p>
<h3 data-id="heading-0">ä¸€ã€åŸºæœ¬ç±»å‹åŸå­ç±»ï¼ˆæ›¿ä»£åŸºæœ¬ç±»å‹çš„åŸå­æ“ä½œï¼‰</h3>
<p>ä¸Â <code>AtomicInteger</code>Â åŸç†ä¸€è‡´ï¼Œé’ˆå¯¹Â <code>long</code>ã€<code>boolean</code>Â ç­‰åŸºæœ¬ç±»å‹ï¼Œæä¾›åŸå­å¢å‡ã€èµ‹å€¼ç­‰æ“ä½œï¼Œé¿å…éåŸå­æ“ä½œï¼ˆå¦‚Â <code>long++</code>ï¼‰çš„å¹¶å‘é—®é¢˜ã€‚</p>





























<table><thead><tr><th>åŸå­ç±»</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>é€‚ç”¨åœºæ™¯</th><th>å…³é”®æ–¹æ³•</th></tr></thead><tbody><tr><td><code>AtomicLong</code></td><td>é•¿æ•´å‹çš„åŸå­å¢å‡ã€ç´¯åŠ ã€èµ‹å€¼</td><td>å¤§æ•°å€¼è®¡æ•°å™¨ï¼ˆå¦‚æ¥å£è°ƒç”¨é‡ã€æµé‡ç»Ÿè®¡ï¼‰</td><td><code>incrementAndGet()</code>ã€<code>addAndGet(long delta)</code>ã€<code>set(long)</code></td></tr><tr><td><code>AtomicBoolean</code></td><td>å¸ƒå°”å€¼çš„åŸå­åˆ‡æ¢ï¼ˆtrue/falseï¼‰</td><td>çŠ¶æ€æ ‡è®°ï¼ˆå¦‚ â€œæ˜¯å¦åˆå§‹åŒ–å®Œæˆâ€â€œæ˜¯å¦åœæ­¢â€ï¼‰</td><td><code>compareAndSet(boolean expect, boolean update)</code>ã€<code>set(boolean)</code></td></tr><tr><td><code>AtomicByte</code>/<code>AtomicShort</code>/<code>AtomicChar</code></td><td>å­—èŠ‚ã€çŸ­æ•´å‹ã€å­—ç¬¦çš„åŸå­æ“ä½œ</td><td>å°èŒƒå›´æ•°å€¼åŸå­æ›´æ–°ï¼ˆå¦‚çŠ¶æ€ç ã€å­—ç¬¦æ ‡è¯†ï¼‰</td><td><code>incrementAndGet()</code>ã€<code>getAndSet(byte newValue)</code></td></tr></tbody></table>
<h4 data-id="heading-1">ç¤ºä¾‹ï¼š<code>AtomicLong</code>Â ç»Ÿè®¡æ¥å£è°ƒç”¨é‡</h4>
<p>java</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicLong;

<span class="hljs-comment">// æ¥å£è°ƒç”¨é‡ç»Ÿè®¡ï¼ˆé«˜å¹¶å‘ä¸‹åŸå­è®¡æ•°ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiCounter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> <span class="hljs-variable">callCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>(<span class="hljs-number">0</span>);

    <span class="hljs-comment">// åŸå­è‡ªå¢ï¼šæ¯æ¬¡è°ƒç”¨æ¥å£æ—¶æ‰§è¡Œ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">incrementCallCount</span><span class="hljs-params">()</span> {
        callCount.incrementAndGet(); <span class="hljs-comment">// ç­‰ä»·äº callCount++ï¼ˆåŸå­æ“ä½œï¼‰</span>
    }

    <span class="hljs-comment">// åŸå­ç´¯åŠ ï¼šæ‰¹é‡ç»Ÿè®¡æ—¶ä½¿ç”¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCallCount</span><span class="hljs-params">(<span class="hljs-type">long</span> batch)</span> {
        callCount.addAndGet(batch); <span class="hljs-comment">// ç­‰ä»·äº callCount += batchï¼ˆåŸå­æ“ä½œï¼‰</span>
    }

    <span class="hljs-comment">// è·å–å½“å‰è°ƒç”¨é‡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getCallCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> callCount.get();
    }
}
</code></pre>
<h4 data-id="heading-2">æ³¨æ„äº‹é¡¹ï¼š</h4>
<ul>
<li><code>AtomicBoolean</code>Â æ— Â <code>incrementAndGet()</code>Â æ–¹æ³•ï¼Œéœ€é€šè¿‡Â <code>compareAndSet</code>Â å®ç°çŠ¶æ€åˆ‡æ¢ï¼ˆå¦‚Â <code>while (!atomicBoolean.compareAndSet(false, true)) {}</code>ï¼‰ã€‚</li>
<li>åŸºæœ¬ç±»å‹åŸå­ç±»å‡ä¸æ”¯æŒÂ <code>null</code>Â å€¼ï¼Œåˆå§‹å€¼é»˜è®¤æ˜¯ 0ï¼ˆæ•°å€¼ç±»å‹ï¼‰ã€<code>false</code>ï¼ˆ<code>AtomicBoolean</code>ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-3">äºŒã€å¼•ç”¨ç±»å‹åŸå­ç±»ï¼ˆåŸå­æ›´æ–°å¯¹è±¡å¼•ç”¨ï¼‰</h3>
<p>é’ˆå¯¹Â <strong>å¯¹è±¡å¼•ç”¨</strong>Â çš„åŸå­æ“ä½œï¼Œè§£å†³ â€œåŸå­æ›¿æ¢å¯¹è±¡â€â€œé¿å…å¼•ç”¨ä¿®æ”¹å†²çªâ€ ç­‰é—®é¢˜ï¼Œæ”¯æŒæ³›å‹ï¼Œçµæ´»é€‚é…å„ç±»å¯¹è±¡ã€‚</p>





























<table><thead><tr><th>åŸå­ç±»</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>é€‚ç”¨åœºæ™¯</th><th>æ ¸å¿ƒè§£å†³é—®é¢˜</th></tr></thead><tbody><tr><td><code>AtomicReference&lt;V&gt;</code></td><td>å¼•ç”¨ç±»å‹çš„åŸå­èµ‹å€¼ã€æ¯”è¾ƒæ›¿æ¢</td><td>åŸå­æ›´æ–°å¯¹è±¡å®ä¾‹ï¼ˆå¦‚å•ä¾‹å¯¹è±¡ã€é…ç½®å¯¹è±¡ï¼‰</td><td>é¿å…å¤šçº¿ç¨‹åŒæ—¶ä¿®æ”¹å¼•ç”¨å¯¼è‡´çš„å¯¹è±¡ä¸ä¸€è‡´</td></tr><tr><td><code>AtomicStampedReference&lt;V&gt;</code></td><td>å¸¦ç‰ˆæœ¬å·çš„å¼•ç”¨åŸå­ç±»ï¼ˆç‰ˆæœ¬æˆ³ + å¼•ç”¨ï¼‰</td><td>é¿å… CAS ä¸­çš„ ABA é—®é¢˜ï¼ˆå¦‚é“¾è¡¨æ“ä½œã€ç¼“å­˜æ›´æ–°ï¼‰</td><td>è§£å†³ â€œå€¼è¢«ä¿®æ”¹ååˆæ”¹å›åŸå€¼â€ å¯¼è‡´çš„è¯¯åˆ¤</td></tr><tr><td><code>AtomicMarkableReference&lt;V&gt;</code></td><td>å¸¦æ ‡è®°ä½çš„å¼•ç”¨åŸå­ç±»ï¼ˆå¸ƒå°”æ ‡è®° + å¼•ç”¨ï¼‰</td><td>åªéœ€åˆ¤æ–­å¼•ç”¨æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼ˆæ— éœ€ç‰ˆæœ¬å·ï¼‰</td><td>ç®€åŒ–ç‰ˆ ABA é—®é¢˜ï¼ˆä»…éœ€ â€œæ˜¯å¦ä¿®æ”¹â€ æ ‡è®°ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-4">1.Â <code>AtomicReference</code>Â ç¤ºä¾‹ï¼šåŸå­æ›´æ–°é…ç½®å¯¹è±¡</h4>
<p>java</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicReference;

<span class="hljs-comment">// åŸå­æ›´æ–°é…ç½®å¯¹è±¡ï¼ˆé¿å…å¤šçº¿ç¨‹ä¿®æ”¹é…ç½®æ—¶å‡ºç°éƒ¨åˆ†æ›´æ–°ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AtomicConfig</span> {
    <span class="hljs-comment">// é…ç½®å¯¹è±¡ï¼ˆä¸å¯å˜ç±»ï¼Œä¿®æ”¹æ—¶ç›´æ¥æ›¿æ¢æ•´ä¸ªå¯¹è±¡ï¼‰</span>
    <span class="hljs-type">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> url;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> timeout;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Config</span><span class="hljs-params">(<span class="hljs-type">String</span> url, <span class="hljs-type">int</span> timeout)</span> </span>{
            <span class="hljs-keyword">this</span>.url = url;
            <span class="hljs-keyword">this</span>.timeout = timeout;
        }

        <span class="hljs-comment">// getter æ–¹æ³•ï¼ˆæ—  setterï¼Œä¿è¯ä¸å¯å˜ï¼‰</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getUrl</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> url; }
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title">getTimeout</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> timeout; }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicReference&lt;Config&gt; configRef = <span class="hljs-keyword">new</span> AtomicReference&lt;&gt;(
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Config</span>(<span class="hljs-string">"http://default.com"</span>, <span class="hljs-number">5000</span>) <span class="hljs-comment">// åˆå§‹é…ç½®</span>
    );

    <span class="hljs-comment">// åŸå­æ›´æ–°é…ç½®ï¼ˆæ›¿æ¢æ•´ä¸ª Config å¯¹è±¡ï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">updateConfig</span><span class="hljs-params">(<span class="hljs-type">String</span> newUrl, <span class="hljs-type">int</span> newTimeout)</span> </span>{
        configRef.<span class="hljs-built_in">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Config</span>(newUrl, newTimeout)); <span class="hljs-comment">// åŸå­èµ‹å€¼</span>
    }

    <span class="hljs-comment">// æ¯”è¾ƒå¹¶æ›¿æ¢é…ç½®ï¼ˆä»…å½“å½“å‰é…ç½®æ˜¯é¢„æœŸå€¼æ—¶æ‰æ›´æ–°ï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">compareAndUpdateConfig</span><span class="hljs-params">(Config expect, Config update)</span> </span>{
        <span class="hljs-keyword">return</span> configRef.<span class="hljs-built_in">compareAndSet</span>(expect, update);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Config <span class="hljs-title">getConfig</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> configRef.<span class="hljs-built_in">get</span>();
    }
}
</code></pre>
<h4 data-id="heading-5">2.Â <code>AtomicStampedReference</code>Â ç¤ºä¾‹ï¼šè§£å†³ ABA é—®é¢˜</h4>
<p>java</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-csharp" lang="csharp">import java.util.concurrent.atomic.AtomicStampedReference;

<span class="hljs-comment">// ç”¨ AtomicStampedReference é¿å… ABA é—®é¢˜</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ABAExample</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// åˆå§‹å€¼ï¼š"A"ï¼Œç‰ˆæœ¬æˆ³ï¼š0</span>
        AtomicStampedReference&lt;String&gt; stampedRef = <span class="hljs-keyword">new</span> AtomicStampedReference&lt;&gt;(<span class="hljs-string">"A"</span>, <span class="hljs-number">0</span>);

        <span class="hljs-comment">// çº¿ç¨‹1ï¼šå°è¯•å°† "A" æ”¹ä¸º "C"ï¼ˆé¢„æœŸç‰ˆæœ¬ 0ï¼‰</span>
        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-built_in">int</span> stamp = stampedRef.getStamp(); <span class="hljs-comment">// è·å–å½“å‰ç‰ˆæœ¬æˆ³ï¼š0</span>
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"çº¿ç¨‹1ï¼šå½“å‰å€¼="</span> + stampedRef.getReference() + <span class="hljs-string">", ç‰ˆæœ¬="</span> + stamp);

            <span class="hljs-comment">// æ¨¡æ‹Ÿå»¶è¿Ÿï¼ˆè®©çº¿ç¨‹2å…ˆæ‰§è¡Œ ABA æ“ä½œï¼‰</span>
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}

            <span class="hljs-comment">// æ¯”è¾ƒå¹¶æ›¿æ¢ï¼šé¢„æœŸå€¼ "A"ï¼Œé¢„æœŸç‰ˆæœ¬ 0ï¼Œæ›´æ–°å€¼ "C"ï¼Œæ–°ç‰ˆæœ¬ 1</span>
            boolean success = stampedRef.compareAndSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"C"</span>, stamp, stamp + <span class="hljs-number">1</span>);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"çº¿ç¨‹1ï¼šæ›´æ–°æ˜¯å¦æˆåŠŸï¼Ÿ"</span> + success); <span class="hljs-comment">// è¾“å‡º falseï¼ˆç‰ˆæœ¬å·²å˜ï¼‰</span>
        }).start();

        <span class="hljs-comment">// çº¿ç¨‹2ï¼šæ‰§è¡Œ ABA æ“ä½œï¼ˆA â†’ B â†’ Aï¼‰</span>
        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-built_in">int</span> stamp = stampedRef.getStamp(); <span class="hljs-comment">// ç‰ˆæœ¬ 0</span>
            <span class="hljs-comment">// 1. A â†’ Bï¼ˆç‰ˆæœ¬ 0 â†’ 1ï¼‰</span>
            stampedRef.compareAndSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, stamp, stamp + <span class="hljs-number">1</span>);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"çº¿ç¨‹2ï¼šA â†’ Bï¼Œæ–°ç‰ˆæœ¬="</span> + stampedRef.getStamp());

            <span class="hljs-comment">// 2. B â†’ Aï¼ˆç‰ˆæœ¬ 1 â†’ 2ï¼‰</span>
            stamp = stampedRef.getStamp();
            stampedRef.compareAndSet(<span class="hljs-string">"B"</span>, <span class="hljs-string">"A"</span>, stamp, stamp + <span class="hljs-number">1</span>);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"çº¿ç¨‹2ï¼šB â†’ Aï¼Œæ–°ç‰ˆæœ¬="</span> + stampedRef.getStamp());
        }).start();
    }
}
</code></pre>
<ul>
<li>ç»“æœï¼šçº¿ç¨‹ 1 å»¶è¿Ÿåå°è¯•æ›´æ–°æ—¶ï¼Œç‰ˆæœ¬æˆ³å·²ä» 0 å˜ä¸º 2ï¼Œ<code>compareAndSet</code>Â å¤±è´¥ï¼Œé¿å…äº† ABA æ¼æ´ã€‚</li>
</ul>
<h4 data-id="heading-6">æ³¨æ„äº‹é¡¹ï¼š</h4>
<ul>
<li><code>AtomicStampedReference</code>Â çš„ç‰ˆæœ¬æˆ³æ˜¯Â <code>int</code>Â ç±»å‹ï¼ˆå¯å¾ªç¯ï¼Œä½†éœ€é¿å…é¢‘ç¹æº¢å‡ºï¼‰ï¼Œ<code>AtomicMarkableReference</code>Â çš„æ ‡è®°ä½æ˜¯Â <code>boolean</code>ï¼ˆä»…éœ€åˆ¤æ–­ â€œæ˜¯å¦ä¿®æ”¹â€ï¼‰ã€‚</li>
<li>å¼•ç”¨ç±»å‹åŸå­ç±»æ›´æ–°çš„æ˜¯ â€œå¼•ç”¨æœ¬èº«â€ï¼Œè€Œéå¯¹è±¡å†…éƒ¨çš„å­—æ®µï¼ˆè‹¥éœ€æ›´æ–°å¯¹è±¡å­—æ®µï¼Œç”¨å­—æ®µæ›´æ–°å™¨åŸå­ç±»ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7">ä¸‰ã€å­—æ®µæ›´æ–°å™¨åŸå­ç±»ï¼ˆåŸå­æ›´æ–°å¯¹è±¡å­—æ®µï¼‰</h3>
<p>æ— éœ€ä¿®æ”¹åŸæœ‰ç±»çš„ä»£ç ï¼ˆæ— éœ€è®©å­—æ®µæˆä¸ºÂ <code>volatile</code>Â æˆ–åŸå­ç±»ï¼‰ï¼Œé€šè¿‡Â <strong>åå°„æœºåˆ¶</strong>Â åŸå­æ›´æ–°å¯¹è±¡çš„å®ä¾‹å­—æ®µæˆ–é™æ€å­—æ®µï¼Œé€‚ç”¨äº â€œæ— æ³•ä¿®æ”¹åŸæœ‰ç±»â€ çš„åœºæ™¯ï¼ˆå¦‚ç¬¬ä¸‰æ–¹åº“ç±»ï¼‰ã€‚</p>





























<table><thead><tr><th>åŸå­ç±»</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>é€‚ç”¨åœºæ™¯</th><th>å…³é”®é™åˆ¶</th></tr></thead><tbody><tr><td><code>AtomicIntegerFieldUpdater</code></td><td>åŸå­æ›´æ–°å¯¹è±¡çš„Â <code>int</code>Â ç±»å‹å­—æ®µ</td><td>ç¬¬ä¸‰æ–¹ç±»çš„Â <code>int</code>Â å­—æ®µåŸå­å¢å‡</td><td>å­—æ®µå¿…é¡»æ˜¯Â <code>volatile</code>ï¼ˆå¦åˆ™æŠ¥é”™ï¼‰ã€é final</td></tr><tr><td><code>AtomicLongFieldUpdater</code></td><td>åŸå­æ›´æ–°å¯¹è±¡çš„Â <code>long</code>Â ç±»å‹å­—æ®µ</td><td>ç¬¬ä¸‰æ–¹ç±»çš„Â <code>long</code>Â å­—æ®µåŸå­ç´¯åŠ </td><td>åŒä¸Š</td></tr><tr><td><code>AtomicReferenceFieldUpdater&lt;V, T&gt;</code></td><td>åŸå­æ›´æ–°å¯¹è±¡çš„å¼•ç”¨ç±»å‹å­—æ®µ</td><td>ç¬¬ä¸‰æ–¹ç±»çš„å¼•ç”¨å­—æ®µåŸå­æ›¿æ¢</td><td>å­—æ®µå¿…é¡»æ˜¯Â <code>volatile</code>ã€é finalã€é private</td></tr></tbody></table>
<h4 data-id="heading-8">ç¤ºä¾‹ï¼š<code>AtomicIntegerFieldUpdater</code>Â æ›´æ–°ç¬¬ä¸‰æ–¹ç±»å­—æ®µ</h4>
<p>java</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-csharp" lang="csharp">import java.util.concurrent.atomic.AtomicIntegerFieldUpdater;

<span class="hljs-comment">// ç¬¬ä¸‰æ–¹ç±»ï¼ˆæ— æ³•ä¿®æ”¹æºç ï¼Œå­—æ®µæ˜¯ volatile intï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">ThirdPartyClass</span> {
    <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">int</span> count; <span class="hljs-comment">// å¿…é¡»æ˜¯ volatileï¼ˆå¦åˆ™æ›´æ–°å™¨æ— æ³•å·¥ä½œï¼‰</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThirdPartyClass</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> count</span>)</span> {
        <span class="hljs-keyword">this</span>.count = count;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getCount</span>()</span> {
        <span class="hljs-keyword">return</span> count;
    }
}

<span class="hljs-comment">// ç”¨å­—æ®µæ›´æ–°å™¨åŸå­æ“ä½œç¬¬ä¸‰æ–¹ç±»çš„ count å­—æ®µ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FieldUpdaterExample</span> {
    <span class="hljs-comment">// 1. åˆ›å»ºå­—æ®µæ›´æ–°å™¨ï¼šæŒ‡å®šç›®æ ‡ç±»ã€å­—æ®µå</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final AtomicIntegerFieldUpdater&lt;ThirdPartyClass&gt; COUNT_UPDATER =
        AtomicIntegerFieldUpdater.newUpdater(ThirdPartyClass.<span class="hljs-keyword">class</span>, <span class="hljs-string">"count"</span>);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        ThirdPartyClass obj = <span class="hljs-keyword">new</span> ThirdPartyClass(<span class="hljs-number">10</span>);

        <span class="hljs-comment">// 2. åŸå­è‡ªå¢ï¼ˆcount = 10 â†’ 11ï¼‰</span>
        COUNT_UPDATER.incrementAndGet(obj);
        System.<span class="hljs-keyword">out</span>.println(obj.getCount()); <span class="hljs-comment">// è¾“å‡º 11</span>

        <span class="hljs-comment">// 3. åŸå­ç´¯åŠ ï¼ˆcount = 11 â†’ 14ï¼‰</span>
        COUNT_UPDATER.addAndGet(obj, <span class="hljs-number">3</span>);
        System.<span class="hljs-keyword">out</span>.println(obj.getCount()); <span class="hljs-comment">// è¾“å‡º 14</span>

        <span class="hljs-comment">// 4. æ¯”è¾ƒå¹¶æ›¿æ¢ï¼ˆé¢„æœŸ 14 â†’ æ›´æ–°ä¸º 20ï¼‰</span>
        boolean success = COUNT_UPDATER.compareAndSet(obj, <span class="hljs-number">14</span>, <span class="hljs-number">20</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ›¿æ¢æ˜¯å¦æˆåŠŸï¼Ÿ"</span> + success); <span class="hljs-comment">// è¾“å‡º true</span>
        System.<span class="hljs-keyword">out</span>.println(obj.getCount()); <span class="hljs-comment">// è¾“å‡º 20</span>
    }
}
</code></pre>
<h4 data-id="heading-9">æ³¨æ„äº‹é¡¹ï¼š</h4>
<ul>
<li>ç›®æ ‡å­—æ®µå¿…é¡»æ˜¯Â <code>volatile</code>ï¼ˆä¿è¯å¯è§æ€§ï¼Œå¦åˆ™ JVM ä¼šæŠ›å‡ºÂ <code>IllegalArgumentException</code>ï¼‰ã€‚</li>
<li>å­—æ®µä¸èƒ½æ˜¯Â <code>final</code>ï¼ˆfinal å­—æ®µä¸å¯ä¿®æ”¹ï¼Œæ›´æ–°å™¨æ— æ³•æ“ä½œï¼‰ã€‚</li>
<li>å­—æ®µè®¿é—®æƒé™ï¼šè‹¥å­—æ®µæ˜¯Â <code>private</code>ï¼Œæ›´æ–°å™¨æ— æ³•é€šè¿‡åå°„è®¿é—®ï¼ˆéœ€å­—æ®µæ˜¯Â <code>public</code>ã€<code>protected</code>Â æˆ–åŒä¸€åŒ…ä¸‹çš„é»˜è®¤è®¿é—®æƒé™ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-10">å››ã€æ•°ç»„ç±»å‹åŸå­ç±»ï¼ˆåŸå­æ›´æ–°æ•°ç»„å…ƒç´ ï¼‰</h3>
<p>é’ˆå¯¹æ•°ç»„å…ƒç´ çš„åŸå­æ“ä½œï¼Œæ”¯æŒÂ <code>int</code>ã€<code>long</code>ã€<code>reference</code>Â ç±»å‹æ•°ç»„ï¼Œé¿å…å¤šçº¿ç¨‹ä¿®æ”¹æ•°ç»„å…ƒç´ æ—¶çš„å¹¶å‘å†²çªã€‚</p>





























<table><thead><tr><th>åŸå­ç±»</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>é€‚ç”¨åœºæ™¯</th><th>å…³é”®æ–¹æ³•</th></tr></thead><tbody><tr><td><code>AtomicIntegerArray</code></td><td>åŸå­æ›´æ–°Â <code>int[]</code>Â æ•°ç»„çš„å…ƒç´ </td><td>åŸå­è®¡æ•°å™¨æ•°ç»„ã€åˆ†å¸ƒå¼ ID ç”Ÿæˆå™¨æ•°ç»„</td><td><code>getAndIncrement(int index)</code>ã€<code>compareAndSet(int index, int expect, int update)</code></td></tr><tr><td><code>AtomicLongArray</code></td><td>åŸå­æ›´æ–°Â <code>long[]</code>Â æ•°ç»„çš„å…ƒç´ </td><td>å¤§æ•°æ®é‡ç»Ÿè®¡æ•°ç»„ï¼ˆå¦‚åˆ†æ¡¶è®¡æ•°ï¼‰</td><td>åŒä¸Šï¼ˆå‚æ•°ä¸º long ç±»å‹ï¼‰</td></tr><tr><td><code>AtomicReferenceArray&lt;V&gt;</code></td><td>åŸå­æ›´æ–°å¼•ç”¨ç±»å‹æ•°ç»„çš„å…ƒç´ </td><td>åŸå­æ›´æ–°å¯¹è±¡æ•°ç»„ï¼ˆå¦‚ç¼“å­˜æ•°ç»„ï¼‰</td><td><code>set(int index, V newValue)</code>ã€<code>compareAndSet(...)</code></td></tr></tbody></table>
<h4 data-id="heading-11">ç¤ºä¾‹ï¼š<code>AtomicIntegerArray</code>Â åˆ†æ¡¶åŸå­è®¡æ•°</h4>
<p>java</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicIntegerArray;

<span class="hljs-comment">// åˆ†æ¡¶åŸå­è®¡æ•°å™¨ï¼ˆå°†ç»Ÿè®¡å¯¹è±¡æŒ‰å“ˆå¸Œåˆ†æ¡¶ï¼Œæå‡å¹¶å‘æ€§èƒ½ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AtomicArrayCounter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicIntegerArray bucketCounts;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> bucketSize; <span class="hljs-comment">// åˆ†æ¡¶æ•°é‡</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AtomicArrayCounter</span><span class="hljs-params">(<span class="hljs-type">int</span> bucketSize)</span> {
        <span class="hljs-built_in">this</span>.bucketSize = bucketSize;
        <span class="hljs-built_in">this</span>.bucketCounts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicIntegerArray</span>(bucketSize); <span class="hljs-comment">// åˆå§‹å€¼å…¨ä¸º 0</span>
    }

    <span class="hljs-comment">// æ ¹æ® key çš„å“ˆå¸Œå€¼é€‰æ‹©åˆ†æ¡¶ï¼ŒåŸå­è‡ªå¢</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">bucketIndex</span> <span class="hljs-operator">=</span> Math.abs(key.hashCode()) % bucketSize;
        bucketCounts.getAndIncrement(bucketIndex); <span class="hljs-comment">// åŸå­è‡ªå¢å¯¹åº”æ¡¶çš„è®¡æ•°</span>
    }

    <span class="hljs-comment">// ç»Ÿè®¡æ‰€æœ‰æ¡¶çš„æ€»è®¡æ•°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getTotalCount</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; bucketSize; i++) {
            total += bucketCounts.get(i);
        }
        <span class="hljs-keyword">return</span> total;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">AtomicArrayCounter</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicArrayCounter</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// 10ä¸ªåˆ†æ¡¶</span>

        <span class="hljs-comment">// å¤šçº¿ç¨‹å¹¶å‘è®¡æ•°</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; counter.increment(<span class="hljs-string">"key-"</span> + Math.random())).start();
        }

        <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæˆ</span>
        <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}

        System.out.println(<span class="hljs-string">"æ€»è®¡æ•°ï¼š"</span> + counter.getTotalCount()); <span class="hljs-comment">// è¾“å‡ºçº¦ 1000ï¼ˆåŸå­æ€§ä¿è¯å‡†ç¡®ï¼‰</span>
    }
}
</code></pre>
<h4 data-id="heading-12">æ³¨æ„äº‹é¡¹ï¼š</h4>
<ul>
<li>æ•°ç»„é•¿åº¦å›ºå®šï¼ˆåˆ›å»ºåæ— æ³•æ‰©å®¹ï¼‰ï¼Œéœ€æå‰è§„åˆ’åˆ†æ¡¶æ•°é‡ï¼ˆå¦‚æ ¹æ®å¹¶å‘é‡è®¾ç½®åˆç†æ¡¶æ•°ï¼Œå‡å°‘å†²çªï¼‰ã€‚</li>
<li>æ•°ç»„å…ƒç´ çš„åŸå­æ“ä½œä»…é’ˆå¯¹ â€œå•ä¸ªç´¢å¼•â€ï¼Œå¤šä¸ªç´¢å¼•çš„æ“ä½œä¸ä¿è¯åŸå­æ€§ï¼ˆå¦‚åŒæ—¶ä¿®æ”¹ç´¢å¼• 0 å’Œ 1ï¼Œéœ€é¢å¤–åŒæ­¥ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-13">äº”ã€å¤åˆæ“ä½œåŸå­ç±»ï¼ˆJDK 8+ æ–°å¢ï¼Œæ”¯æŒå¤æ‚åŸå­é€»è¾‘ï¼‰</h3>
<p>JDK 8 å¼•å…¥çš„Â <code>DoubleAccumulator</code>ã€<code>LongAccumulator</code>Â ç­‰ï¼Œæ”¯æŒÂ <strong>è‡ªå®šä¹‰å¤åˆåŸå­æ“ä½œ</strong>ï¼ˆå¦‚ç´¯åŠ ã€æœ€å¤§å€¼è®¡ç®—ã€è‡ªå®šä¹‰å‡½æ•°ï¼‰ï¼Œæ€§èƒ½æ¯”Â <code>AtomicLong</code>Â æ›´ä¼˜ï¼ˆé«˜å¹¶å‘ä¸‹åˆ†æ•£ç«äº‰ï¼‰ã€‚</p>



































<table><thead><tr><th>åŸå­ç±»</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>é€‚ç”¨åœºæ™¯</th><th>æ ¸å¿ƒä¼˜åŠ¿</th></tr></thead><tbody><tr><td><code>LongAccumulator</code></td><td>åŸºäºå‡½æ•°çš„é•¿æ•´å‹åŸå­ç´¯åŠ  / å¤åˆæ“ä½œ</td><td>å¤æ‚ç»Ÿè®¡ï¼ˆå¦‚æœ€å¤§å€¼ã€æœ€å°å€¼ã€è‡ªå®šä¹‰èšåˆï¼‰</td><td>æ”¯æŒè‡ªå®šä¹‰Â <code>LongBinaryOperator</code>ï¼Œé«˜å¹¶å‘ä¸‹æ€§èƒ½æ›´ä¼˜</td></tr><tr><td><code>DoubleAccumulator</code></td><td>åŸºäºå‡½æ•°çš„åŒç²¾åº¦æµ®ç‚¹å‹åŸå­å¤åˆæ“ä½œ</td><td>æµ®ç‚¹å‹æ•°æ®ç»Ÿè®¡ï¼ˆå¦‚å¹³å‡å“åº”æ—¶é—´ï¼‰</td><td>åŒä¸Šï¼ˆæ”¯æŒÂ <code>DoubleBinaryOperator</code>ï¼‰</td></tr><tr><td><code>LongAdder</code></td><td>é•¿æ•´å‹åŸå­ç´¯åŠ ï¼ˆ<code>AtomicLong</code>Â çš„é«˜æ€§èƒ½æ›¿ä»£ï¼‰</td><td>é«˜å¹¶å‘è®¡æ•°å™¨ï¼ˆå¦‚ QPS ç»Ÿè®¡ï¼‰</td><td>å†…éƒ¨åˆ†æ¡¶å­˜å‚¨ï¼Œå‡å°‘ CAS å†²çªï¼Œé«˜å¹¶å‘ä¸‹æ€§èƒ½è¿œè¶…Â <code>AtomicLong</code></td></tr><tr><td><code>DoubleAdder</code></td><td>åŒç²¾åº¦æµ®ç‚¹å‹åŸå­ç´¯åŠ </td><td>æµ®ç‚¹å‹è®¡æ•°å™¨ï¼ˆå¦‚æµé‡ç»Ÿè®¡ï¼‰</td><td>åŒä¸Š</td></tr></tbody></table>
<h4 data-id="heading-14">ç¤ºä¾‹ï¼š<code>LongAdder</code>Â é«˜å¹¶å‘è®¡æ•°å™¨ï¼ˆæ›¿ä»£Â <code>AtomicLong</code>ï¼‰</h4>
<p>java</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.LongAdder;

<span class="hljs-comment">// é«˜å¹¶å‘è®¡æ•°å™¨ï¼šLongAdder æ€§èƒ½ä¼˜äº AtomicLongï¼ˆåˆ†æ¡¶å‡å°‘å†²çªï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HighConcurrencyCounter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">LongAdder</span> <span class="hljs-variable">adder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongAdder</span>();

    <span class="hljs-comment">// åŸå­è‡ªå¢ï¼ˆå†…éƒ¨åˆ†æ¡¶ï¼Œé«˜å¹¶å‘ä¸‹å†²çªæ›´å°‘ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        adder.increment();
    }

    <span class="hljs-comment">// åŸå­ç´¯åŠ </span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">long</span> delta)</span> {
        adder.add(delta);
    }

    <span class="hljs-comment">// è·å–æ€»æ•°ï¼ˆåˆå¹¶æ‰€æœ‰åˆ†æ¡¶çš„è®¡æ•°ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> adder.sum();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">HighConcurrencyCounter</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighConcurrencyCounter</span>();

        <span class="hljs-comment">// 1000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è‡ªå¢ 1000 æ¬¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) {
                    counter.increment();
                }
            }).start();
        }

        Thread.sleep(<span class="hljs-number">2000</span>);
        System.out.println(<span class="hljs-string">"æ€»è®¡æ•°ï¼š"</span> + counter.getCount()); <span class="hljs-comment">// è¾“å‡º 1000000ï¼ˆå‡†ç¡®ï¼‰</span>
    }
}
</code></pre>
<h4 data-id="heading-15">ç¤ºä¾‹ï¼š<code>LongAccumulator</code>Â è®¡ç®—æœ€å¤§å€¼</h4>
<p>java</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.LongAccumulator;

<span class="hljs-comment">// ç”¨ LongAccumulator åŸå­è®¡ç®—æœ€å¤§å€¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MaxValueCalculator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è‡ªå®šä¹‰å‡½æ•°ï¼šå–ä¸¤ä¸ªæ•°çš„æœ€å¤§å€¼ï¼ˆLongBinaryOperatorï¼‰</span>
        <span class="hljs-type">LongAccumulator</span> <span class="hljs-variable">maxAccumulator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongAccumulator</span>(
            (x, y) -&gt; Math.max(x, y), <span class="hljs-comment">// ç´¯åŠ å™¨å‡½æ•°</span>
            Long.MIN_VALUE <span class="hljs-comment">// åˆå§‹å€¼</span>
        );

        <span class="hljs-comment">// å¤šçº¿ç¨‹å¹¶å‘æ›´æ–°æœ€å¤§å€¼</span>
        <span class="hljs-type">long</span>[] values = {<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>, <span class="hljs-number">30</span>, <span class="hljs-number">15</span>};
        <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> val : values) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; maxAccumulator.accumulate(val)).start();
        }

        <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæˆ</span>
        <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}

        System.out.println(<span class="hljs-string">"æœ€å¤§å€¼ï¼š"</span> + maxAccumulator.get()); <span class="hljs-comment">// è¾“å‡º 30</span>
    }
}
</code></pre>
<h4 data-id="heading-16">æ³¨æ„äº‹é¡¹ï¼š</h4>
<ul>
<li><code>LongAdder</code>/<code>DoubleAdder</code>Â çš„Â <code>sum()</code>Â æ–¹æ³•æ˜¯ â€œæœ€ç»ˆä¸€è‡´æ€§â€ï¼ˆåˆå¹¶åˆ†æ¡¶æ—¶å¯èƒ½æœ‰çŸ­æš‚ä¸ä¸€è‡´ï¼‰ï¼Œé€‚åˆ â€œæœ€ç»ˆç»Ÿè®¡â€ åœºæ™¯ï¼ˆå¦‚ QPS ç»Ÿè®¡ï¼‰ï¼Œä¸é€‚åˆ â€œå®æ—¶ç²¾ç¡®è¯»å–â€ï¼ˆå¦‚äº‹åŠ¡è®¡æ•°ï¼‰ã€‚</li>
<li>å¤åˆæ“ä½œåŸå­ç±»ä»…æ”¯æŒ â€œç´¯åŠ  / èšåˆâ€ ç±»é€»è¾‘ï¼Œå¤æ‚å¤åˆæ“ä½œï¼ˆå¦‚ â€œå…ˆåˆ¤æ–­å†æ›´æ–°â€ï¼‰ä»éœ€ç»“åˆé”æˆ–å…¶ä»–å·¥å…·ã€‚</li>
</ul>
<h3 data-id="heading-17">å…­ã€å¸¸ç”¨åŸå­ç±»é€‰æ‹©æ€»ç»“</h3>













































<table><thead><tr><th>åœºæ™¯ç±»å‹</th><th>æ¨èåŸå­ç±»</th><th>æ›¿ä»£æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>å•å˜é‡Â <code>int</code>/<code>long</code>Â è®¡æ•°</td><td><code>AtomicInteger</code>/<code>AtomicLong</code></td><td>é«˜å¹¶å‘ç”¨Â <code>LongAdder</code>/<code>DoubleAdder</code></td></tr><tr><td>å¸ƒå°”çŠ¶æ€æ ‡è®°</td><td><code>AtomicBoolean</code></td><td><code>AtomicReference&lt;Boolean&gt;</code></td></tr><tr><td>åŸå­æ›´æ–°å¯¹è±¡å¼•ç”¨</td><td><code>AtomicReference</code></td><td>éœ€é¿å… ABA ç”¨Â <code>AtomicStampedReference</code></td></tr><tr><td>ç¬¬ä¸‰æ–¹ç±»å­—æ®µåŸå­æ›´æ–°</td><td><code>AtomicIntegerFieldUpdater</code>Â ç­‰</td><td>æ— æ³•ä¿®æ”¹å­—æ®µæ—¶çš„å”¯ä¸€é€‰æ‹©</td></tr><tr><td>æ•°ç»„å…ƒç´ åŸå­æ“ä½œ</td><td><code>AtomicIntegerArray</code>Â ç­‰</td><td>æ‰‹åŠ¨åŠ é”ï¼ˆæ€§èƒ½å·®ï¼‰</td></tr><tr><td>å¤æ‚èšåˆæ“ä½œï¼ˆæœ€å¤§å€¼ / è‡ªå®šä¹‰ï¼‰</td><td><code>LongAccumulator</code>/<code>DoubleAccumulator</code></td><td>é” + æ™®é€šå˜é‡ï¼ˆä»£ç ç¹çï¼‰</td></tr><tr><td>é«˜å¹¶å‘è®¡æ•°å™¨ï¼ˆQPS / æµé‡ï¼‰</td><td><code>LongAdder</code></td><td><code>AtomicLong</code>ï¼ˆä½å¹¶å‘å¯ç”¨ï¼‰</td></tr></tbody></table>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼š</p>
<ol>
<li>ç®€å•è®¡æ•° / çŠ¶æ€åˆ‡æ¢ï¼šä¼˜å…ˆç”¨Â <code>AtomicInteger</code>/<code>AtomicBoolean</code>ï¼ˆAPI ç®€æ´ï¼Œæ— å­¦ä¹ æˆæœ¬ï¼‰ã€‚</li>
<li>é«˜å¹¶å‘è®¡æ•°ï¼šç”¨Â <code>LongAdder</code>ï¼ˆåˆ†æ¡¶å‡å°‘å†²çªï¼Œæ€§èƒ½æœ€ä¼˜ï¼‰ã€‚</li>
<li>å¼•ç”¨åŸå­æ›¿æ¢ï¼šç”¨Â <code>AtomicReference</code>ï¼ˆæ™®é€šåœºæ™¯ï¼‰æˆ–Â <code>AtomicStampedReference</code>ï¼ˆABA é—®é¢˜ï¼‰ã€‚</li>
<li>ç¬¬ä¸‰æ–¹ç±»å­—æ®µæ›´æ–°ï¼šç”¨å­—æ®µæ›´æ–°å™¨åŸå­ç±»ï¼ˆæ— éœ€ä¿®æ”¹æºç ï¼‰ã€‚</li>
<li>å¤æ‚èšåˆé€»è¾‘ï¼šç”¨Â <code>LongAccumulator</code>/<code>DoubleAccumulator</code>ï¼ˆè‡ªå®šä¹‰å‡½æ•°ï¼Œçµæ´»é«˜æ•ˆï¼‰ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬29ç¯‡ï¼š99% çš„é‡åŒ–æ–°æ‰‹æ­»åœ¨æŒ‚å•ä¸Šï¼šFreqtrade éšè—æŠ€èƒ½æ­ç§˜]]></title>    <link>https://juejin.cn/post/7577797563853094948</link>    <guid>https://juejin.cn/post/7577797563853094948</guid>    <pubDate>2025-11-30T00:23:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577797563853094948" data-draft-id="7577722399375900714" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬29ç¯‡ï¼š99% çš„é‡åŒ–æ–°æ‰‹æ­»åœ¨æŒ‚å•ä¸Šï¼šFreqtrade éšè—æŠ€èƒ½æ­ç§˜"/> <meta itemprop="keywords" content="Python,åç«¯,GitHub"/> <meta itemprop="datePublished" content="2025-11-30T00:23:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¼ªå¤§å”"/> <meta itemprop="url" content="https://juejin.cn/user/3702810894146151"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬29ç¯‡ï¼š99% çš„é‡åŒ–æ–°æ‰‹æ­»åœ¨æŒ‚å•ä¸Šï¼šFreqtrade éšè—æŠ€èƒ½æ­ç§˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810894146151/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¼ªå¤§å”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T00:23:19.000Z" title="Sun Nov 30 2025 00:23:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬29ç¯‡ï¼š99% çš„é‡åŒ–æ–°æ‰‹æ­»åœ¨æŒ‚å•ä¸Šï¼šFreqtrade éšè—æŠ€èƒ½æ­ç§˜</h2>
<p>Freqtrade åœ¨æŒ‚å•æ¨¡å‹ä¸­æä¾›äº†ä¸¤ä¸ªå…³é”®åŠŸèƒ½ï¼š</p>
<ul>
<li><code>adjust_entry_price</code>ï¼šä»…åœ¨æ–°å»ºè®¢å•ï¼ˆé¦–æ¬¡ä¹°å…¥ï¼‰æ—¶ï¼Œç”¨äºä¿®æ”¹æŒ‚å•ä»·æ ¼ã€‚</li>
<li><code>adjust_order_price</code>ï¼šç”¨äºæ§åˆ¶ <strong>æ‰€æœ‰æŒ‚å•</strong> çš„ä»·æ ¼ï¼ŒåŒ…æ‹¬å‡ºåœºã€åŠ ä»“ã€å‡ä»“</li>
</ul>
<p>åˆç†ä½¿ç”¨è¿™äº›æ§åˆ¶ç‚¹ï¼Œå¯ä»¥æœ€å¤§åŒ–é™ä½æ»‘ç‚¹ï¼Œæ§åˆ¶åˆ†æ®µè¿›åœºï¼Œè¿›è€Œæå‡ç­–ç•¥ç»´åº¦å’Œå¼ºåº¦ã€‚</p>
<h3 data-id="heading-1">ğŸš€ æƒ³å­¦é‡åŒ–äº¤æ˜“ï¼Ÿ</h3>
<p>ğŸ‘‰ <strong>ç‚¹å‡»è®¿é—®ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fitrade.icu%2F" target="_blank" title="https://itrade.icu/" ref="nofollow noopener noreferrer">itrade.icu</a></strong>
è¿™é‡Œæœ‰ <strong>Freqtrade åŸºç¡€æ•™ç¨‹</strong>ã€<strong>ç­–ç•¥æºç </strong>ã€<strong>æŒ‡æ ‡è§£æ</strong> ç­‰ä¸°å¯Œå†…å®¹ï¼ŒåŠ©ä½ è½»æ¾æŒæ¡é‡åŒ–äº¤æ˜“æŠ€å·§ï¼</p>
<blockquote>
<p>æŒ‚å•ç»†èŠ‚å†³å®šèƒœè´Ÿï¼šFreqtrade è‡ªå®šä¹‰ä»·æ ¼ç­–ç•¥å®Œå…¨æŒ‡å—</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">ğŸ¯å‡½æ•°ä½œç”¨æ¦‚è§ˆ</h3>




















<table><thead><tr><th>å‡½æ•°å</th><th>ä½œç”¨æè¿°</th><th>ä½¿ç”¨æ—¶æœº</th></tr></thead><tbody><tr><td><code>adjust_entry_price</code></td><td>ä¿®æ”¹é¦–æ¬¡å»ºä»“æ—¶æŒ‚å•ä»·æ ¼ï¼ˆåªè°ƒç”¨ä¸€æ¬¡ï¼‰</td><td>âœ… <strong>é¦–æ¬¡ä¹°å…¥</strong></td></tr><tr><td><code>adjust_order_price</code></td><td>å¯¹æ‰€æœ‰è®¢å•ï¼ˆä¹°å…¥ã€å–å‡ºï¼‰ç»Ÿä¸€è°ƒæ•´ä»·æ ¼</td><td>âœ… <strong>æ¯æ¬¡ä¸‹å•éƒ½è°ƒç”¨</strong></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-3">ğŸ§  adjust_entry_price - é¦–æ¬¡å»ºä»“ä¸“ç”¨</h3>
<p>è¯¥å‡½æ•°<strong>åªåœ¨ç­–ç•¥é¦–æ¬¡ç”Ÿæˆäº¤æ˜“ä¿¡å·å¹¶å‡†å¤‡ä¸‹å•å»ºä»“æ—¶è¢«è°ƒç”¨ä¸€æ¬¡</strong>ï¼Œä½ å¯ä»¥åœ¨è¿™é‡ŒåŠ¨æ€è°ƒæ•´æŒ‚å•ä»·æ ¼ï¼Œä¾‹å¦‚æ§åˆ¶æ»‘ç‚¹ã€ä¸‹æµ®ä¹°å…¥ä»·ç­‰ã€‚</p>
<h4 data-id="heading-4">âœ… ä½¿ç”¨åœºæ™¯</h4>
<ul>
<li>æƒ³è®©é¦–æ¬¡ä¹°å…¥ä»·æ ¼æ›´â€œè°¨æ…â€ï¼Œä¾‹å¦‚ï¼š
<ul>
<li>å‘ä¸‹å‹ä¸€ç‚¹ç‚¹å†æŒ‚å•ï¼ˆé˜²æ­¢è¿½æ¶¨ï¼‰</li>
<li>åŸºäºç›˜å£ä»·åšå¾®è°ƒ</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">ğŸ§ª ç¤ºä¾‹ä»£ç </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">adjust_entry_price</span>(<span class="hljs-params">self, pair: <span class="hljs-built_in">str</span>, order_type: <span class="hljs-built_in">str</span>, current_rate: <span class="hljs-built_in">float</span>, proposed_rate: <span class="hljs-built_in">float</span>, **kwargs</span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-comment"># å¾€ä¸‹è°ƒæ•´ 0.5% æŒ‚å•ä»·æ ¼</span>
    adjusted_price = proposed_rate * <span class="hljs-number">0.995</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[adjust_entry_price] åŸå§‹æŒ‚å•ä»·: <span class="hljs-subst">{proposed_rate}</span>ï¼Œè°ƒæ•´å: <span class="hljs-subst">{adjusted_price}</span>"</span>)
    <span class="hljs-keyword">return</span> adjusted_price
</code></pre>
<h4 data-id="heading-6">âš ï¸ æ³¨æ„</h4>
<ul>
<li><strong>åªåœ¨é¦–æ¬¡å»ºä»“æ—¶è§¦å‘</strong>ï¼Œä¸é€‚ç”¨äºåŠ ä»“/å‡ä»“</li>
<li>è¿”å›çš„æ˜¯ä½ å¸Œæœ›æŒ‚å‡ºçš„ä»·æ ¼</li>
</ul>
<hr/>
<h3 data-id="heading-7">ğŸ›  adjust_order_price - å…¨å±€æŒ‚å•ä»·æ ¼é’©å­</h3>
<p>è¿™æ˜¯ä¸€ä¸ªæ›´å¼ºå¤§çš„æŒ‚å•æ§åˆ¶å‡½æ•°ï¼Œ<strong>æ— è®ºæ˜¯ä¹°å…¥è¿˜æ˜¯å–å‡ºï¼Œéƒ½ä¼šç»è¿‡å®ƒ</strong>ã€‚</p>
<h4 data-id="heading-8">âœ… ä½¿ç”¨åœºæ™¯</h4>
<ul>
<li>æ‰€æœ‰æŒ‚å•ç»Ÿä¸€åŠ /å‡ä»·æ ¼ï¼Œä¾‹å¦‚ï¼š
<ul>
<li>æ‰€æœ‰ä¹°å…¥æŒ‚ä½ä¸€ç‚¹ï¼ˆæ»‘ç‚¹ä¿æŠ¤ï¼‰</li>
<li>æ‰€æœ‰å–å‡ºæŒ‚é«˜ä¸€ç‚¹ï¼ˆå¥—åˆ©ç©ºé—´ï¼‰</li>
</ul>
</li>
<li>å–å‡ºæ—¶æ ¹æ®å½“å‰ç›˜å£ä»·åŠ¨æ€æŒ‚å•</li>
</ul>
<h4 data-id="heading-9">ğŸ§ª ç¤ºä¾‹ä»£ç </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">adjust_order_price</span>(<span class="hljs-params">self, pair: <span class="hljs-built_in">str</span>, is_buy: <span class="hljs-built_in">bool</span>, current_price: <span class="hljs-built_in">float</span>, proposed_price: <span class="hljs-built_in">float</span>, **kwargs</span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-keyword">if</span> is_buy:
        <span class="hljs-comment"># ä¹°å…¥æ—¶å¾€ä¸‹å‹0.3%</span>
        <span class="hljs-keyword">return</span> proposed_price * <span class="hljs-number">0.997</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># å–å‡ºæ—¶å¾€ä¸ŠæŠ¬0.3%</span>
        <span class="hljs-keyword">return</span> proposed_price * <span class="hljs-number">1.003</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">ğŸ” ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«ä¸è”ç³»</h3>






























<table><thead><tr><th>æ¯”è¾ƒé¡¹</th><th><code>adjust_entry_price</code></th><th><code>adjust_order_price</code></th></tr></thead><tbody><tr><td>è¢«è°ƒç”¨æ—¶æœº</td><td>ä»…é¦–æ¬¡å»ºä»“ä¹°å…¥</td><td>æ‰€æœ‰è®¢å•ï¼ˆåŒ…æ‹¬ä¹°å…¥å’Œå–å‡ºï¼‰</td></tr><tr><td>å¯æ§åˆ¶æ–¹å‘</td><td>ä»…é™ä¹°å…¥</td><td>ä¹°å…¥ + å–å‡º</td></tr><tr><td>æ§åˆ¶èŒƒå›´</td><td>å»ºä»“ä»·</td><td>å…¨éƒ¨è®¢å•ä»·æ ¼</td></tr><tr><td>æ¨èç»„åˆä½¿ç”¨æ–¹å¼</td><td>âœ” é¦–æ¬¡å»ºä»“æ—¶ï¼šç”¨ <code>adjust_entry_price</code> æ§åˆ¶æ›´ç»†è‡´çš„å…¥åœºä»·æ ¼</td><td>âœ” æ‰€æœ‰è®¢å•ï¼šç”¨ <code>adjust_order_price</code> åšç»Ÿä¸€ä»·æ ¼æ§åˆ¶</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-11">ğŸ“Œ è¡¥å……è¯´æ˜ï¼šä½ å¯èƒ½ä»¥ä¸ºèƒ½ç”¨ï¼Œå®é™…ä¸èƒ½çš„åœ°æ–¹</h3>

























<table><thead><tr><th>åœºæ™¯</th><th>æ˜¯å¦ä¼šè°ƒç”¨ <code>adjust_entry_price</code>ï¼Ÿ</th><th>æ¨èåšæ³•</th></tr></thead><tbody><tr><td>ç¬¬ä¸€æ¬¡ä¹°å…¥å»ºä»“</td><td>âœ… ä¼šè°ƒç”¨</td><td>ç”¨æ¥è°ƒæ•´åˆå§‹æŒ‚å•ä»·</td></tr><tr><td>åŠ ä»“ï¼ˆå·²æœ‰ä»“ä½å†ä¹°ï¼‰</td><td>âŒ ä¸ä¼šè°ƒç”¨</td><td>ä½¿ç”¨ <code>adjust_trade_position</code></td></tr><tr><td>å–å‡ºæ­¢ç›ˆ/æ­¢æŸ</td><td>âŒ ä¸ä¼šè°ƒç”¨</td><td>ä½¿ç”¨ <code>custom_exit_price</code> æˆ– <code>adjust_order_price</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-12">âœ… æœ€ä½³å®è·µå»ºè®®</h3>
<ul>
<li><strong>ç”¨ <code>adjust_entry_price</code> æ§åˆ¶é¦–æ¬¡å»ºä»“æŒ‚å•ä»·</strong></li>
<li><strong>ç”¨ <code>adjust_order_price</code> æ§åˆ¶æ‰€æœ‰è®¢å•æ»‘ç‚¹ä¿æŠ¤</strong></li>
<li><strong>ç»“åˆ <code>custom_exit_price</code> ç²¾å‡†æ§åˆ¶å–å‡ºä»·æ ¼</strong></li>
<li><strong>ä¸è¦è¯•å›¾åœ¨ <code>adjust_entry_price</code> ä¸­å®ç°åŠ ä»“é€»è¾‘ï¼ŒFreqtrade ä¸ä¼šå†è°ƒç”¨å®ƒ</strong></li>
</ul>
<h4 data-id="heading-13">ğŸ“˜ æœ€ç®€åŠ¨é‡ç­–ç•¥æ¡ˆä¾‹ï¼ˆé€‚åˆå…¥é—¨ï¼‰</h4>
<p>è¿™æ˜¯ä¸€ä¸ª<strong>åŸºäºä»·æ ¼åŠ¨é‡çš„å…¥é—¨ç­–ç•¥</strong>ï¼Œç­–ç•¥æ ¸å¿ƒé€»è¾‘ï¼š</p>
<blockquote>
<p>ğŸ“ˆ å½“å‰Kçº¿çš„æ”¶ç›˜ä»·é«˜äºå‰ä¸€æ ¹Kçº¿ â†’ ç”Ÿæˆä¹°å…¥ä¿¡å·<br/>
ğŸ“‰ å½“å‰Kçº¿çš„æ”¶ç›˜ä»·ä½äºå‰ä¸€æ ¹Kçº¿ â†’ ç”Ÿæˆå–å‡ºä¿¡å·</p>
</blockquote>
<p>åŒæ—¶ç»“åˆäº† Freqtrade æä¾›çš„è®¢å•ä»·æ ¼æ§åˆ¶åŠŸèƒ½ï¼š</p>
<ul>
<li><code>adjust_entry_price</code>ï¼šé¦–æ¬¡å»ºä»“æ—¶æŒ‚å•ä»·ä¸‹è°ƒ 0.5%</li>
<li><code>adjust_order_price</code>ï¼šç»Ÿä¸€æ»‘ç‚¹æ§åˆ¶ï¼ˆä¹°å…¥ -0.3%ï¼Œå–å‡º +0.3%ï¼‰</li>
<li><code>custom_exit_price</code>ï¼šå–å‡ºæŒ‚æ¯”å½“å‰ä»·æ ¼é«˜ 0.2%</li>
</ul>
<hr/>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> freqtrade.strategy.interface <span class="hljs-keyword">import</span> IStrategy
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> pandas <span class="hljs-keyword">import</span> DataFrame

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleStrategy</span>(<span class="hljs-title class_ inherited__">IStrategy</span>):
    <span class="hljs-string">"""
    ç¤ºä¾‹ç­–ç•¥ï¼šåŸºäºæ”¶ç›˜ä»·æ˜¯å¦ä¸Šæ¶¨æ¥å†³å®šæ˜¯å¦ä¹°å…¥ã€‚
    """</span>
    timeframe = <span class="hljs-string">'5m'</span>

    order_types = {
        <span class="hljs-string">'entry'</span>: <span class="hljs-string">'limit'</span>,
        <span class="hljs-string">'exit'</span>: <span class="hljs-string">'limit'</span>,
        <span class="hljs-string">'stoploss'</span>: <span class="hljs-string">'market'</span>,
    }

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">populate_indicators</span>(<span class="hljs-params">self, dataframe: DataFrame, metadata: <span class="hljs-built_in">dict</span></span>) -&gt; DataFrame:
        <span class="hljs-comment"># æ²¡æœ‰ä½¿ç”¨é¢å¤–æŒ‡æ ‡</span>
        <span class="hljs-keyword">return</span> dataframe

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">populate_entry_trend</span>(<span class="hljs-params">self, dataframe: DataFrame, metadata: <span class="hljs-built_in">dict</span></span>) -&gt; DataFrame:
        <span class="hljs-string">"""
        å½“å½“å‰Kçº¿æ”¶ç›˜ä»·é«˜äºä¸Šä¸€æ ¹Kçº¿ â†’ ç”Ÿæˆä¹°å…¥ä¿¡å·
        """</span>
        dataframe[<span class="hljs-string">'enter_long'</span>] = dataframe[<span class="hljs-string">'close'</span>] &gt; dataframe[<span class="hljs-string">'close'</span>].shift(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">return</span> dataframe

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">populate_exit_trend</span>(<span class="hljs-params">self, dataframe: DataFrame, metadata: <span class="hljs-built_in">dict</span></span>) -&gt; DataFrame:
        <span class="hljs-string">"""
        å½“å½“å‰Kçº¿æ”¶ç›˜ä»·ä½äºä¸Šä¸€æ ¹Kçº¿ â†’ ç”Ÿæˆå–å‡ºä¿¡å·
        """</span>
        dataframe[<span class="hljs-string">'exit_long'</span>] = dataframe[<span class="hljs-string">'close'</span>] &lt; dataframe[<span class="hljs-string">'close'</span>].shift(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">return</span> dataframe

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">adjust_entry_price</span>(<span class="hljs-params">self, pair: <span class="hljs-built_in">str</span>, order_type: <span class="hljs-built_in">str</span>, current_rate: <span class="hljs-built_in">float</span>,proposed_rate: <span class="hljs-built_in">float</span>, **kwargs</span>) -&gt; <span class="hljs-built_in">float</span>:
        <span class="hljs-string">"""
        é¦–æ¬¡å»ºä»“æ—¶ï¼ŒæŒ‚å•ä»·æ ¼ä¸‹è°ƒ 0.5%
        """</span>
        <span class="hljs-keyword">return</span> proposed_rate * <span class="hljs-number">0.995</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">adjust_order_price</span>(<span class="hljs-params">self, pair: <span class="hljs-built_in">str</span>, is_buy: <span class="hljs-built_in">bool</span>, current_price: <span class="hljs-built_in">float</span>,proposed_price: <span class="hljs-built_in">float</span>, **kwargs</span>) -&gt; <span class="hljs-built_in">float</span>:
        <span class="hljs-string">"""
        æ‰€æœ‰è®¢å•ç»Ÿä¸€æ»‘ç‚¹ä¿æŠ¤ï¼šä¹°å…¥ -0.3%ï¼Œå–å‡º +0.3%
        """</span>
        <span class="hljs-keyword">return</span> proposed_price * (<span class="hljs-number">0.997</span> <span class="hljs-keyword">if</span> is_buy <span class="hljs-keyword">else</span> <span class="hljs-number">1.003</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_exit_price</span>(<span class="hljs-params">self, pair: <span class="hljs-built_in">str</span>, trade, current_time, current_rate, **kwargs</span>) -&gt; <span class="hljs-built_in">float</span>:
        <span class="hljs-string">"""
        å–å‡ºæŒ‚å•ä»·æ ¼æ¯”å½“å‰ä»·æ ¼é«˜ 0.2%
        """</span>
        <span class="hljs-keyword">return</span> current_rate * <span class="hljs-number">1.002</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">ğŸ§¾ æ€»ç»“</h3>
<ul>
<li><code>adjust_entry_price</code> å’Œ <code>adjust_order_price</code> æ˜¯ Freqtrade åœ¨é™ä»·æŒ‚å•æœºåˆ¶ä¸­æœ€å…³é”®çš„ä¸¤ä¸ªæ§åˆ¶é’©å­ï¼š
<ul>
<li><code>adjust_entry_price</code>ï¼šåªä¼šåœ¨é¦–æ¬¡å»ºä»“æ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œç”¨äºç²¾ç»†æ§åˆ¶ç¬¬ä¸€æ¬¡ä¹°å…¥æŒ‚å•ä»·ã€‚</li>
</ul>
</li>
</ul>
<ul>
<li><code>adjust_order_price</code>ï¼šæ¯æ¬¡ä¸‹å•éƒ½ä¼šè°ƒç”¨ï¼Œé€‚ç”¨äºä¹°å…¥ã€å–å‡ºã€åŠ ä»“ã€å‡ä»“ã€æ­¢ç›ˆã€æ­¢æŸç­‰æ‰€æœ‰è®¢å•ã€‚</li>
</ul>
<ul>
<li>é€šè¿‡åˆç†ç»„åˆä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä½ å¯ä»¥ï¼š
<ul>
<li>é¿å…åœ¨é«˜ä½è¿½å•ã€æœ‰æ•ˆé˜²æ­¢æ»‘ç‚¹ï¼›</li>
<li>åŠ¨æ€æŒ‚å•ã€è®©ç­–ç•¥æ›´æ™ºèƒ½ï¼›</li>
<li>ç²¾å‡†æ§åˆ¶å–å‡ºä»·ï¼Œæå‡åˆ©æ¶¦ç©ºé—´ã€‚</li>
</ul>
</li>
<li>ğŸ“Œ å®æˆ˜å»ºè®®ï¼š
<ul>
<li>æƒ³æ§åˆ¶é¦–æ¬¡å…¥åœºæ›´ç¨³å¥ï¼šä½¿ç”¨ <code>adjust_entry_price</code></li>
<li>æƒ³æ§åˆ¶æ‰€æœ‰è®¢å•æ»‘ç‚¹ï¼šä½¿ç”¨ adjust_order_price</li>
<li>æƒ³æ§åˆ¶å–å‡ºæ—¶çš„ç›®æ ‡ä»·æ ¼ï¼šå†é…åˆ <code>custom_exit_price</code> æ›´å®Œç¾</li>
<li>å½“ä½ èƒ½ç†Ÿç»ƒè¿ç”¨è¿™ä¸‰è€…ç»„åˆï¼Œä¸€ä¸ªä¸“ä¸šçº§çš„æŒ‚å•ç­–ç•¥å°±å·²å…·å¤‡é›å½¢ã€‚</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†çæŠ˜è…¾ LangChain äº†ï¼šä» 0 åˆ° 1 æ­å»º RAG çŸ¥è¯†åº“çš„æ¶æ„å†³ç­–å®å½•]]></title>    <link>https://juejin.cn/post/7577737385954590730</link>    <guid>https://juejin.cn/post/7577737385954590730</guid>    <pubDate>2025-11-30T04:51:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577737385954590730" data-draft-id="7577971299742531622" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†çæŠ˜è…¾ LangChain äº†ï¼šä» 0 åˆ° 1 æ­å»º RAG çŸ¥è¯†åº“çš„æ¶æ„å†³ç­–å®å½•"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-30T04:51:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç§æ•™"/> <meta itemprop="url" content="https://juejin.cn/user/3394924618197325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†çæŠ˜è…¾ LangChain äº†ï¼šä» 0 åˆ° 1 æ­å»º RAG çŸ¥è¯†åº“çš„æ¶æ„å†³ç­–å®å½•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394924618197325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç§æ•™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T04:51:39.000Z" title="Sun Nov 30 2025 04:51:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>å‰è¨€</strong>ï¼šæœ€è¿‘åœ¨å¸®ä¸€å®¶åšåŒ»ç–—å™¨æ¢°çš„å®¢æˆ·è½åœ°ä¼ä¸šçº§çŸ¥è¯†åº“ï¼ˆRAGï¼‰ã€‚é¡¹ç›®åˆæœŸï¼Œå›¢é˜Ÿé™·å…¥äº†ä¸¥é‡çš„â€œå·¥å…·å´‡æ‹œâ€â€”â€”ä¸Šæ¥å°±æƒ³ç”¨ LangChain + Pinecone + OpenAI çš„å…¨å®¶æ¡¶ã€‚
ç»“æœå‘¢ï¼Ÿå¼€å‘ä¸¤å‘¨ï¼ŒDemo å¾ˆé…·ç‚«ï¼Œä¸€ä¸Šå®æˆ˜ï¼ˆç§æœ‰åŒ–éƒ¨ç½²ã€æ•°æ®åˆè§„ã€æˆæœ¬æ§åˆ¶ï¼‰ç›´æ¥å´©ç›˜ã€‚
è¿™ç¯‡æ–‡ç« ä¸èŠé‚£äº›è™šå¤´å·´è„‘çš„æ¦‚å¿µï¼Œåªå¤ç›˜æˆ‘ä»¬æ˜¯å¦‚ä½•åœ¨ <strong>TRAE SOLO</strong> çš„è¾…åŠ©ä¸‹ï¼Œé‡æ–°è¿›è¡Œæ¶æ„é€‰å‹ï¼Œå¹¶æœ€ç»ˆç”¨æå…¶ç²¾ç®€çš„ä»£ç è½åœ°ä¸€å¥—é«˜å¯ç”¨ RAG ç³»ç»Ÿçš„ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆä½ çš„ RAG ç³»ç»Ÿæ€»æ˜¯â€œå¬ä¸æ‡‚äººè¯â€ï¼Ÿ</h2>
<p>åšè¿‡çŸ¥è¯†åº“çš„åŒå­¦åº”è¯¥éƒ½æœ‰è¿‡è¿™ç§ç»æœ›æ—¶åˆ»ï¼š
ç”¨æˆ·é—®ï¼šâ€œæˆ‘ä»¬å…¬å¸å»å¹´çš„å·®æ—…æŠ¥é”€æ ‡å‡†æ˜¯å¤šå°‘ï¼Ÿâ€
ä½ çš„ RAG æœºå™¨äººè‡ªä¿¡åœ°å›ç­”ï¼šâ€œæ ¹æ®ç»´åŸºç™¾ç§‘ï¼Œå·®æ—…è´¹æ˜¯æŒ‡...â€ æˆ–è€…å¹²è„†ä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“ã€‚</p>
<p>è¿™ä¸æ˜¯å› ä¸ºæ¨¡å‹ç¬¨ï¼Œè€Œæ˜¯<strong>æ¶æ„é€‰å‹å‡ºäº†å¤§é—®é¢˜</strong>ã€‚</p>
<p>ä¼ ç»Ÿçš„ RAG å¼€å‘æµé€šå¸¸æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>å†™ä¸€å † Python è„šæœ¬åˆ‡åˆ†æ–‡æ¡£ï¼ˆChunkingï¼‰ã€‚</li>
<li>è°ƒ OpenAI API è·‘ Embeddingã€‚</li>
<li>å­˜å…¥å‘é‡æ•°æ®åº“ã€‚</li>
<li>ç”¨ LangChain æ‹¼å‡‘æ£€ç´¢é“¾ã€‚</li>
</ol>
<p>è¿™ä¸ªæµç¨‹æœ€å¤§çš„ç—›ç‚¹åœ¨äº<strong>å‰²è£‚</strong>ã€‚ä½ å†™ä»£ç çš„æ—¶å€™ä¸çŸ¥é“æ–‡æ¡£åˆ‡åˆ†å¾—å¯¹ä¸å¯¹ï¼Œè°ƒä¼˜ Prompt çš„æ—¶å€™ä¸çŸ¥é“æ£€ç´¢å¬å›ç‡æ˜¯å¤šå°‘ã€‚æ•´ä¸ªè¿‡ç¨‹åƒæ˜¯åœ¨ç›²äººæ‘¸è±¡ã€‚</p>
<p>è€Œåœ¨è¿™æ¬¡é‡æ„ä¸­ï¼Œæˆ‘ä»¬å°è¯•å¼•å…¥äº† <strong>TRAE SOLO</strong> è¿™ç§ AI åŸç”Ÿ IDEï¼Œå®ƒç»™æˆ‘ä»¬çš„æ¶æ„å†³ç­–å¸¦æ¥äº†å…¨æ–°çš„è§†è§’ï¼š<strong>å¯è§†åŒ–è°ƒè¯•ä¸ä¸Šä¸‹æ–‡æ„ŸçŸ¥</strong>ã€‚</p>
<h2 data-id="heading-1">æ ¸å¿ƒæ€è·¯ï¼šè®© IDE æˆä¸ºä½ çš„â€œæ¶æ„å‚è°‹â€</h2>
<p>RAG çš„æœ¬è´¨å…¶å®å°±ä¸‰æ­¥ï¼š<strong>åˆ‡åˆ†ï¼ˆIndexingï¼‰ -&gt; æ£€ç´¢ï¼ˆRetrievalï¼‰ -&gt; ç”Ÿæˆï¼ˆGenerationï¼‰</strong>ã€‚</p>
<p>ä½†åœ¨ä¼ä¸šçº§è½åœ°ä¸­ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯å‘ï¼š</p>
<ul>
<li><strong>åˆ‡åˆ†</strong>ï¼šæŒ‰å­—ç¬¦åˆ‡ï¼ŸæŒ‰è¯­ä¹‰åˆ‡ï¼Ÿè¿˜æ˜¯æŒ‰ Markdown ç»“æ„åˆ‡ï¼Ÿ</li>
<li><strong>æ£€ç´¢</strong>ï¼šå•çº¯çš„å‘é‡ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰å¤Ÿå—ï¼Ÿè¦ä¸è¦åŠ å…³é”®è¯æ··åˆæ£€ç´¢ï¼ˆHybrid Searchï¼‰ï¼Ÿ</li>
<li><strong>ç”Ÿæˆ</strong>ï¼šPrompt æ€ä¹ˆå†™æ‰èƒ½é˜²æ­¢æ¨¡å‹äº§ç”Ÿå¹»è§‰ï¼Ÿ</li>
</ul>
<p>ä¸å…¶æˆ‘ä»¬æ‹è„‘è¢‹å†³ç­–ï¼Œä¸å¦‚è®©å·¥å…·å¸®æˆ‘ä»¬åšå®éªŒã€‚æˆ‘ä»¬åˆ©ç”¨ TRAE SOLO çš„ <code>SOLO Coder</code> æ¨¡å¼ï¼Œå¿«é€Ÿç”Ÿæˆäº†ä¸åŒæŠ€æœ¯æ–¹æ¡ˆçš„å¯¹æ¯”åŸå‹ï¼Œå¹¶é€šè¿‡ <code>DiffView</code> ç›´è§‚åœ°çœ‹åˆ°ä¸åŒåˆ‡åˆ†ç­–ç•¥å¯¹æ£€ç´¢ç»“æœçš„å½±å“ã€‚</p>
<p>è¿™ç§â€œæµ‹è¯•é©±åŠ¨æ¶æ„â€ï¼ˆTDAï¼‰çš„æ¨¡å¼ï¼Œè®©æˆ‘ä»¬åœ¨ä»£ç è¿˜æ²¡å†™å‡ è¡Œçš„æ—¶å€™ï¼Œå°±æ’é™¤äº† 80% çš„é”™è¯¯è·¯å¾„ã€‚</p>
<h2 data-id="heading-2">å®æˆ˜æ¼”ç¤ºï¼šæ‰‹æ’¸ä¸€ä¸ªæç®€ RAG å†…æ ¸</h2>
<p>ä¸ºäº†å±•ç¤ºæ ¸å¿ƒé€»è¾‘ï¼Œæˆ‘ä»¬æŠ›å¼ƒç¬¨é‡çš„æ¡†æ¶ï¼Œç”¨çº¯ Python + ChromaDB + DeepSeek API å®ç°ä¸€ä¸ªè½»é‡çº§ RAGã€‚</p>
<h3 data-id="heading-3">1. ç¯å¢ƒä¾èµ–</h3>
<pre><code class="hljs language-bash" lang="bash">pip install chromadb openai jieba
</code></pre>
<h3 data-id="heading-4">2. æ™ºèƒ½æ–‡æ¡£åˆ‡åˆ†å™¨</h3>
<p>ä¸è¦è¿·ä¿¡ LangChain çš„ <code>CharacterTextSplitter</code>ã€‚å¯¹äºä¸­æ–‡ä¼ä¸šæ–‡æ¡£ï¼ŒåŸºäº<strong>ç»“æ„åŒ–</strong>çš„åˆ‡åˆ†æ‰æ˜¯ç‹é“ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> re

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MarkdownSplitter</span>:
    <span class="hljs-string">"""
    é’ˆå¯¹ä¼ä¸š Wiki/æ–‡æ¡£ ä¼˜åŒ–çš„ Markdown åˆ‡åˆ†å™¨
    ä¿ç•™æ ‡é¢˜å±‚çº§ï¼Œé˜²æ­¢ä¸Šä¸‹æ–‡ä¸¢å¤±
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, chunk_size=<span class="hljs-number">500</span></span>):
        self.chunk_size = chunk_size

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">split_text</span>(<span class="hljs-params">self, text</span>):
        <span class="hljs-comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… Markdown æ ‡é¢˜ (##, ###)</span>
        headers = re.split(<span class="hljs-string">r'(^#+ .+$)'</span>, text, flags=re.MULTILINE)
        chunks = []
        current_chunk = <span class="hljs-string">""</span>
        
        <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> headers:
            <span class="hljs-comment"># å¦‚æœåŠ ä¸Šè¿™ä¸€æ®µè¶…è¿‡äº† chunk_sizeï¼Œå°±å…ˆåˆ‡ä¸€åˆ€</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_chunk) + <span class="hljs-built_in">len</span>(part) &gt; self.chunk_size:
                <span class="hljs-keyword">if</span> current_chunk:
                    chunks.append(current_chunk.strip())
                current_chunk = part
            <span class="hljs-keyword">else</span>:
                current_chunk += <span class="hljs-string">"\n"</span> + part
                
        <span class="hljs-keyword">if</span> current_chunk:
            chunks.append(current_chunk.strip())
            
        <span class="hljs-keyword">return</span> chunks

<span class="hljs-comment"># æ¨¡æ‹Ÿä¸€æ®µä¼ä¸šæ–‡æ¡£</span>
doc_content = <span class="hljs-string">"""
# å·®æ—…æŠ¥é”€åˆ¶åº¦
## 1. é€‚ç”¨èŒƒå›´
æœ¬åˆ¶åº¦é€‚ç”¨äºå…¨èŒå‘˜å·¥...
## 2. æŠ¥é”€æ ‡å‡†
ä¸€çº¿åŸå¸‚æ¯æ—¥è¡¥è´´ 300 å…ƒï¼ŒäºŒçº¿åŸå¸‚ 200 å…ƒã€‚
"""</span>

splitter = MarkdownSplitter()
chunks = splitter.split_text(doc_content)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… æˆåŠŸåˆ‡åˆ†ä¸º <span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunks)}</span> ä¸ªç‰‡æ®µ"</span>)
<span class="hljs-comment"># æ­¤æ—¶ TRAE SOLO çš„å˜é‡æŸ¥çœ‹å™¨èƒ½è®©ä½ æ¸…æ™°çœ‹åˆ°æ¯ä¸ª chunk çš„å†…å®¹ï¼Œé¿å…åˆ‡æ–­å…³é”®è¯­ä¹‰</span>
</code></pre>
<h3 data-id="heading-5">3. å‘é‡æ£€ç´¢ä¸ç”Ÿæˆ</h3>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <code>chromadb</code> ä½œä¸ºè½»é‡çº§å‘é‡åº“ï¼Œå®ƒæ— éœ€ Docker å³å¯è¿è¡Œï¼Œéå¸¸é€‚åˆä¸­å°å‹é¡¹ç›®ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> chromadb
<span class="hljs-keyword">from</span> chromadb.utils <span class="hljs-keyword">import</span> embedding_functions

<span class="hljs-comment"># åˆå§‹åŒ–æœ¬åœ°å‘é‡åº“</span>
client = chromadb.PersistentClient(path=<span class="hljs-string">"./knowledge_db"</span>)
<span class="hljs-comment"># ä½¿ç”¨å¼€æºçš„ sentence-transformers æ¨¡å‹ï¼Œå…è´¹ä¸”æ•ˆæœä¸é”™</span>
emb_fn = embedding_functions.SentenceTransformerEmbeddingFunction(
    model_name=<span class="hljs-string">"paraphrase-multilingual-MiniLM-L12-v2"</span>
)

collection = client.get_or_create_collection(
    name=<span class="hljs-string">"policy_docs"</span>,
    embedding_function=emb_fn
)

<span class="hljs-comment"># 1. å†™å…¥æ•°æ®</span>
ids = [<span class="hljs-string">f"doc_<span class="hljs-subst">{i}</span>"</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(chunks))]
collection.add(documents=chunks, ids=ids)

<span class="hljs-comment"># 2. æ£€ç´¢é€»è¾‘</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">query_knowledge_base</span>(<span class="hljs-params">question</span>):
    results = collection.query(
        query_texts=[question],
        n_results=<span class="hljs-number">2</span> <span class="hljs-comment"># åªå–æœ€ç›¸å…³çš„ 2 æ¡</span>
    )
    <span class="hljs-keyword">return</span> results[<span class="hljs-string">'documents'</span>][<span class="hljs-number">0</span>]

<span class="hljs-comment"># 3. ç”Ÿæˆå›ç­” (ä¼ªä»£ç ï¼Œå¯¹æ¥ DeepSeek/OpenAI)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_answer</span>(<span class="hljs-params">question, context</span>):
    prompt = <span class="hljs-string">f"""
    ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä¼ä¸šåŠ©æ‰‹ã€‚è¯·åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ã€‚
    å¦‚æœä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ç­”æ¡ˆï¼Œè¯·ç›´æ¥è¯´â€œæˆ‘ä¸çŸ¥é“â€ã€‚
    
    ä¸Šä¸‹æ–‡ï¼š
    <span class="hljs-subst">{context}</span>
    
    é—®é¢˜ï¼š<span class="hljs-subst">{question}</span>
    """</span>
    <span class="hljs-comment"># return call_llm_api(prompt) </span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ„å»ºçš„ Prompt:"</span>, prompt)

<span class="hljs-comment"># --- æµ‹è¯• ---</span>
q = <span class="hljs-string">"å»ä¸Šæµ·å‡ºå·®æ¯å¤©è¡¥å¤šå°‘é’±ï¼Ÿ"</span>
retrieved_docs = query_knowledge_base(q)
generate_answer(q, retrieved_docs)
</code></pre>
<h2 data-id="heading-6">é¿å‘æŒ‡å—ï¼šæ¶æ„å¸ˆçš„è¡€æ³ªç»éªŒ</h2>
<p>ä»£ç è·‘é€šå¾ˆç®€å•ï¼Œä½†è¦ä¸Šç”Ÿäº§ç¯å¢ƒï¼Œè¿™ä¸‰ä¸ªå‘ä½ å¿…é¡»å¾—å¡«ï¼š</p>
<h3 data-id="heading-7">1. è„æ•°æ®æ¯”çƒ‚æ¨¡å‹æ›´å¯æ€•</h3>
<p>å¾ˆå¤šå¼€å‘è€…æŠŠç²¾åŠ›èŠ±åœ¨å¾®è°ƒæ¨¡å‹ä¸Šï¼Œå´å¿½ç•¥äº†<strong>æºæ•°æ®çš„æ¸…æ´—</strong>ã€‚
æˆ‘ä»¬åœ¨ TRAE SOLO ä¸­å¯¹æ¯”å‘ç°ï¼ŒPDF è§£æå‡ºæ¥çš„ä¹±ç ã€é¡µçœ‰é¡µè„šçš„å¹²æ‰°å­—ç¬¦ï¼Œä¼šè®©æ£€ç´¢å‡†ç¡®ç‡ä¸‹é™ 30% ä»¥ä¸Šã€‚
<strong>å»ºè®®</strong>ï¼šåœ¨ Embedding ä¹‹å‰ï¼ŒåŠ¡å¿…å¢åŠ ä¸€ä¸ª ETLï¼ˆExtract, Transform, Loadï¼‰ç¯èŠ‚ï¼Œä¸“é—¨å¤„ç†æ¢è¡Œç¬¦ã€å»é™¤æ— æ„ä¹‰çš„ç‰¹æ®Šç¬¦å·ã€‚</p>
<h3 data-id="heading-8">2. è­¦æƒ•â€œä¸Šä¸‹æ–‡çª—å£çˆ†ç‚¸â€</h3>
<p>ç°åœ¨çš„æ¨¡å‹æ”¯æŒ 128k ç”šè‡³ 1M çš„ Contextï¼Œå¾ˆå¤šäººå°±æ‡’äº†ï¼Œç›´æ¥æŠŠæ£€ç´¢åˆ°çš„ 100 ä¸ªç‰‡æ®µå…¨å¡è¿›å»ã€‚
è¿™ä¸ä»…è´¹é’±ï¼Œè¿˜ä¼šå¯¼è‡´â€œè¿·å¤±ä¸­é—´â€ï¼ˆLost in the Middleï¼‰ç°è±¡â€”â€”æ¨¡å‹è®°ä½äº†å¼€å¤´å’Œç»“å°¾ï¼Œå´å¿˜äº†ä¸­é—´çš„å…³é”®ä¿¡æ¯ã€‚
<strong>å»ºè®®</strong>ï¼šä¸¥æ ¼æ§åˆ¶ <code>n_results</code>ï¼Œå¹¶å¼•å…¥ Re-rankï¼ˆé‡æ’åºï¼‰æ¨¡å‹ã€‚å…ˆç²—æ’æ£€ç´¢ 50 æ¡ï¼Œå†ç”¨ç²¾æ’æ¨¡å‹é€‰å‡ºæœ€ç›¸å…³çš„ 5 æ¡ç»™ LLMã€‚</p>
<h3 data-id="heading-9">3. ç§æœ‰åŒ–éƒ¨ç½²çš„ç®—åŠ›é™·é˜±</h3>
<p>å®¢æˆ·è¯´è¦ç§æœ‰åŒ–ï¼Œä½ æ¨äº† Llama-3-70Bï¼Œç»“æœå®¢æˆ·æœåŠ¡å™¨åªæœ‰ä¸€å¼  T4 å¡ã€‚
<strong>æ¶æ„å†³ç­–</strong>ï¼šåœ¨ TRAE SOLO çš„è¾…åŠ©ä¸‹ï¼Œæˆ‘ä»¬å¿«é€Ÿæµ‹è¯•äº† Qwen-7B-Int4 é‡åŒ–ç‰ˆæœ¬ï¼Œå‘ç°å¯¹äº RAG è¿™ç§ä¾èµ–ä¸Šä¸‹æ–‡çš„ä»»åŠ¡ï¼Œ7B æ¨¡å‹é…åˆé«˜è´¨é‡çš„çŸ¥è¯†åº“ï¼Œæ•ˆæœå®Œå…¨ä¸è¾“ 70Bï¼Œä½†æˆæœ¬é™ä½äº† 90%ã€‚</p>
<h2 data-id="heading-10">ç»“è¯­</h2>
<p>æ­å»º RAG çŸ¥è¯†åº“ï¼Œä»æ¥å°±ä¸æ˜¯ä¸€ä¸ªçº¯ä»£ç é—®é¢˜ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>æ•°æ®æ²»ç†ä¸æ¶æ„æƒè¡¡</strong>çš„è‰ºæœ¯ã€‚</p>
<p>TRAE SOLO åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸å†ä»…ä»…æ˜¯ä¸€ä¸ªä»£ç ç¼–è¾‘å™¨ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ª<strong>èƒ½å¤Ÿç†è§£ä»£ç è¯­ä¹‰çš„æ¶æ„åŠ©æ‰‹</strong>ã€‚å®ƒå¸®æˆ‘ä»¬å¿«é€ŸéªŒè¯æƒ³æ³•ã€å¯¹æ¯”æ–¹æ¡ˆã€æ’æŸ¥éšæ‚£ï¼Œè®©æˆ‘ä»¬èƒ½æŠŠæ›´å¤šç²¾åŠ›æ”¾åœ¨ä¸šåŠ¡é€»è¾‘æœ¬èº«ï¼Œè€Œä¸æ˜¯è¢«ç¹ççš„é…ç½®å’Œ API æŠ¥é”™é€šè¿‡ã€‚</p>
<p><strong>ä¸è¦åšå·¥å…·çš„å¥´éš¶ï¼Œè¦åšæ¶æ„çš„ä¸»äººã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openGaussåœ¨AIæ—¶ä»£çš„å‘é‡æ•°æ®åº“åº”ç”¨å®è·µä¸æŠ€æœ¯æ¼”è¿›æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7577704980855930934</link>    <guid>https://juejin.cn/post/7577704980855930934</guid>    <pubDate>2025-11-30T02:17:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577704980855930934" data-draft-id="7577958825341599763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openGaussåœ¨AIæ—¶ä»£çš„å‘é‡æ•°æ®åº“åº”ç”¨å®è·µä¸æŠ€æœ¯æ¼”è¿›æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-30T02:17:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¾®å­¦AI"/> <meta itemprop="url" content="https://juejin.cn/user/4258884716870988"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openGaussåœ¨AIæ—¶ä»£çš„å‘é‡æ•°æ®åº“åº”ç”¨å®è·µä¸æŠ€æœ¯æ¼”è¿›æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4258884716870988/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¾®å­¦AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T02:17:10.000Z" title="Sun Nov 30 2025 02:17:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ‘˜è¦</h2>
<p>æœ¬æ–‡ä»¥openGausså¼€æºæ•°æ®åº“6.0 LTSåŠ7.0ç‰ˆæœ¬ä¸ºç ”ç©¶ç„¦ç‚¹ï¼Œç³»ç»Ÿå‰–æå…¶åœ¨AIåŸç”Ÿæ¶æ„ã€å‘é‡æ£€ç´¢å¼•æ“ä¸è‡ªæ²»è¿ç»´ä½“ç³»çš„æŠ€æœ¯çªç ´ã€‚é€šè¿‡æ„å»ºåŸºäºDataVecæ’ä»¶çš„RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰å®æˆ˜æ¡ˆä¾‹ï¼Œç»“åˆTPC-Hå‘é‡æ‰©å±•æµ‹è¯•ä¸æ™ºèƒ½åˆ¶é€ æ—¶åºæ•°æ®åˆ†æåœºæ™¯ï¼Œé¦–æ¬¡å®Œæ•´å‘ˆç°ä»SQLè¯­æ³•å±‚åˆ°æ‰§è¡Œå¼•æ“çš„å‘é‡æ“ä½œå…¨é“¾è·¯å®ç°ã€‚ç ”ç©¶æ­ç¤ºäº†openGaussé€šè¿‡"AI4DBè‡ªæ²»ä¼˜åŒ–+DB4AIå†…å»ºæ¨ç†"åŒå¼•æ“æ¶æ„ï¼Œåœ¨æ··åˆè´Ÿè½½åœºæ™¯ä¸‹å®ç°QPSæå‡37%ã€å¬å›ç‡ä¿æŒåœ¨95%ä»¥ä¸Šçš„æŠ€æœ¯è·¯å¾„ï¼Œä¸ºè‡ªä¸»ç ”å‘æ•°æ®åº“åœ¨ç”Ÿæˆå¼AIæ—¶ä»£çš„æ¼”è¿›æä¾›èŒƒå¼å‚è€ƒã€‚</p>
<hr/>
<h2 data-id="heading-1">1. æŠ€æœ¯æ¼”è¿›ï¼šä»å…³ç³»å‹åˆ°AI-Nativeçš„å…­æ¬¡èŒƒå¼è·ƒè¿</h2>
<h3 data-id="heading-2">1.1 ç‰ˆæœ¬è¿­ä»£çŸ©é˜µä¸æ ¸å¿ƒçªç ´</h3>
<p>openGaussè‡ª2020å¹´å¼€æºä»¥æ¥ï¼Œå·²å®Œæˆä»ä¼ ç»ŸHTAPæ•°æ®åº“åˆ°AI-Nativeæ™ºèƒ½æ•°æ®åº•åº§çš„è´¨å˜ã€‚å…³é”®ç‰ˆæœ¬çš„æŠ€æœ¯æ¼”è¿›å‘ˆç°æ˜æ˜¾çš„"ä¸‰é˜¶æ®µ"ç‰¹å¾ï¼š</p>



































<table><thead><tr><th>ç‰ˆæœ¬</th><th>å‘å¸ƒæ—¶é—´</th><th>æ ¸å¿ƒç‰¹æ€§</th><th>æ€§èƒ½æå‡æŒ‡æ ‡</th></tr></thead><tbody><tr><td><strong>2.0.0</strong></td><td>2021-03-30</td><td>MOTå†…å­˜å¼•æ“ï¼ˆBetaï¼‰ã€NUMA-Awareå†…æ ¸</td><td>TPMCä»150ä¸‡â†’350ä¸‡ï¼Œæå‡133%</td></tr><tr><td><strong>5.0.0</strong></td><td>2023-03-31</td><td>ç®—å­çº§ä¼˜åŒ–ã€è‡ªæ²»è¿ç»´DBMindå¢å¼º</td><td>TPC-H 100Gåœºæ™¯ç«¯åˆ°ç«¯æ€§èƒ½+37%</td></tr><tr><td><strong>6.0.0</strong></td><td>2024-03-01</td><td>DataVecå‘é‡æ’ä»¶ã€oGEngineåŸä½æ›´æ–°å¼•æ“</td><td>TPCCæ€§èƒ½æå‡20%ï¼ŒSM4ç®—æ³•æ€§èƒ½+5%</td></tr><tr><td><strong>7.0.0</strong></td><td>2024-09-30</td><td>HNSW/IVFFLATæ··åˆç´¢å¼•ã€SQL/PGåŒè¯­æ³•å…¼å®¹</td><td>å‘é‡å¬å›ç‡95%åœºæ™¯QPSæå‡3.2å€</td></tr></tbody></table>
<h3 data-id="heading-3">1.2 6.0ç‰ˆæœ¬å‘é‡æ¶æ„é©æ–°</h3>
<p>openGauss 6.0.0å¼•å…¥çš„**DataVecå‘é‡æ•°æ®åº“æ’ä»¶**å®ç°äº†ä¸‰å¤§æŠ€æœ¯çªç ´ï¼š1.</p>
<ol>
<li>
<p><strong>åŸç”Ÿå‘é‡ç±»å‹ç³»ç»Ÿ</strong>ï¼šæ”¯æŒ<code>VECTOR(n)</code>å®šé•¿å‘é‡å­˜å‚¨ï¼Œå†…å»ºL2/ä½™å¼¦/å†…ç§¯è·ç¦»åº¦é‡</p>
</li>
<li>
<p><strong>æ··åˆç´¢å¼•å¼•æ“</strong>ï¼šåŒæ—¶æ”¯æŒç²¾ç¡®æ£€ç´¢ï¼ˆFlatï¼‰ä¸è¿‘ä¼¼æ£€ç´¢ï¼ˆHNSWã€IVF-FLATï¼‰</p>
</li>
</ol>

<ol start="3">
<li><strong>ACIDäº‹åŠ¡ä¿éšœ</strong>ï¼šå‘é‡æ•°æ®ä¸æ™®é€šå…³ç³»æ•°æ®åœ¨åŒä¸€äº‹åŠ¡ä¸­å®ç°å¼ºä¸€è‡´æ€§</li>
</ol>
<p>è¯¥æ¶æ„é¦–æ¬¡åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­è§£å†³äº†"å‘é‡æ£€ç´¢ç²¾åº¦"ä¸"äº‹åŠ¡éš”ç¦»çº§åˆ«"çš„å›ºæœ‰çŸ›ç›¾ï¼Œé€šè¿‡MVCCæœºåˆ¶ä¸ºå‘é‡ç‰ˆæœ¬æä¾›å¿«ç…§éš”ç¦»ã€‚</p>
<hr/>
<h2 data-id="heading-4">2. æ ¸å¿ƒæŠ€æœ¯è§£ç ï¼šAI4DBä¸DB4AIåŒè½®é©±åŠ¨</h2>
<h3 data-id="heading-5">2.1 AI4DBè‡ªæ²»è¿ç»´ä½“ç³»</h3>
<p>åŸºäºDBMindæ¡†æ¶çš„è‡ªæ²»èƒ½åŠ›åœ¨5.0ç‰ˆæœ¬åå½¢æˆå®Œæ•´é—­ç¯ï¼š</p>
<ul>
<li>
<p><strong>æŸ¥è¯¢ä¼˜åŒ–å™¨æ¤å…¥</strong>ï¼šå­¦ä¹ æˆæœ¬ä¼°ç®—å™¨ï¼ˆLearned Cost Estimatorï¼‰æ›¿ä»£ä¼ ç»ŸCBOï¼Œè®¡åˆ’æšä¸¾æ•ˆç‡æå‡16å€</p>
</li>
<li>
<p><strong>æ…¢SQLè¯Šæ–­</strong>ï¼šLSTMè‡ªç¼–ç å™¨å®æ—¶æ£€æµ‹æ‰§è¡Œè®¡åˆ’å¼‚å¸¸ï¼Œè¯Šæ–­å‡†ç¡®ç‡92.3%</p>
</li>
<li>
<p><strong>å‚æ•°è°ƒä¼˜</strong>ï¼šX-Tunerè§£å†³NP-hardé—®é¢˜ï¼Œè°ƒä¼˜åæ€§èƒ½æå‡15-40%</p>
</li>
</ul>
<p><strong>DBMindè‡ªæ²»æ¶æ„</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3106e924c93c42e5aa1423d4a37626d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=PGwozEe9S6xt6T3yQURnWmrNb2o%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">2.2 DB4AIå†…å»ºæ¨ç†å¼•æ“</h3>
<p>openGauss 6.0é€šè¿‡<code>CREATE MODEL</code>è¯­æ³•å®ç°"åº“å†…è®­ç»ƒ-æ¨ç†"ä¸€ä½“åŒ–ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åœ¨æ•°æ®åº“å†…ç›´æ¥è®­ç»ƒæ•…éšœé¢„æµ‹æ¨¡å‹</span>
<span class="hljs-keyword">CREATE</span> MODEL device_fault_predict 
<span class="hljs-keyword">USING</span> xgboost 
FEATURES temperature, vibration, pressure 
TARGET fault_type 
<span class="hljs-keyword">FROM</span> equipment_monitor 
<span class="hljs-keyword">WITH</span> (max_depth<span class="hljs-operator">=</span><span class="hljs-number">6</span>, n_estimators<span class="hljs-operator">=</span><span class="hljs-number">100</span>);

<span class="hljs-comment">-- å®æ—¶æ¨ç†</span>
<span class="hljs-keyword">SELECT</span> device_id, PREDICT <span class="hljs-keyword">BY</span> device_fault_predict(temperature, vibration, pressure) 
<span class="hljs-keyword">FROM</span> sensor_stream;
</code></pre>
<p>è¯¥ç‰¹æ€§å°†æ•°æ®ç§»åŠ¨æˆæœ¬é™ä½99%ï¼Œæ¨ç†å»¶è¿Ÿä»æ¯«ç§’çº§é™è‡³å¾®ç§’çº§ã€‚</p>
<hr/>
<h2 data-id="heading-7">3. å‘é‡æ•°æ®åº“å®æ“ï¼šä»SQLåˆ°ç´¢å¼•çš„å…¨é“¾è·¯å®ç°</h2>
<h3 data-id="heading-8">3.1 ç¯å¢ƒå‡†å¤‡ä¸æ’ä»¶åŠ è½½</h3>
<p><strong>æ­¥éª¤1ï¼šå®‰è£…openGauss 6.0.0å¹¶å¯ç”¨DataVec</strong></p>
<p>ä¸‹è½½6.0.0 LTSç‰ˆæœ¬</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5220e4cc3d5419c89ef4b0f74007444~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=or24pWnYhFBC2UCXHxzvk%2Fes3PE%3D" alt="" loading="lazy"/></p>
<p>è§£å‹å¹¶åˆå§‹åŒ–</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7237c51a8d24210be855d7aac594d1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=ExoQeCDYnS66ICbPjGinX4t9oNc%3D" alt="" loading="lazy"/></p>
<p>åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21062054281c4f3da47cc07cf55f1822~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=2DAhXybnEyyCChwj6Tgy37%2Bm23s%3D" alt="" loading="lazy"/></p>
<p>æ‰§è¡Œå®‰è£…è„šæœ¬ï¼ˆä»¥æœ€å°åŒ–é…ç½®ä¸ºä¾‹ï¼‰</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/177b22080c694ad2abbd5969301041c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=0czW9IE9B1QfLrtcA2qKLKdMlfY%3D" alt="" loading="lazy"/></p>
<p><strong>å®‰è£…åˆå§‹åŒ–æˆåŠŸ</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcb779442a484feba73b76f3adbd408d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=IklJW2VabnkGWZZGk7%2BsrJsBui4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">3.2 åˆ›å»ºå‘é‡è¡¨ä¸æ•°æ®æ’å…¥</h3>
<p><strong>æ­¥éª¤2ï¼šè¿æ¥æ•°æ®åº“å¹¶åˆ›å»ºæµ‹è¯•è¡¨</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿æ¥æ•°æ®åº“</span>
gsql -d postgres -U opengauss -W Enmo@123 -p 5432

<span class="hljs-comment"># å¯ç”¨DataVecæ’ä»¶</span>
 postgres=<span class="hljs-comment"># CREATE EXTENSION datavec;</span>
CREATE EXTENSION
</code></pre>
<p><strong>æ­¥éª¤3ï¼šåˆ›å»ºçŸ¥è¯†åº“å‘é‡è¡¨</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºæ”¯æŒæ··åˆæ£€ç´¢çš„æ–‡æ¡£è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> knowledge_base (
    doc_id SERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
    title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    content TEXT,
    doc_type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),  <span class="hljs-comment">-- ç”¨äºè¿‡æ»¤çš„ä¸šåŠ¡å±æ€§</span>
    create_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    embedding VECTOR(<span class="hljs-number">768</span>)  <span class="hljs-comment">-- ä½¿ç”¨768ç»´å‘é‡</span>
);

<span class="hljs-comment">-- æŸ¥çœ‹è¡¨ç»“æ„ç¡®è®¤å‘é‡åˆ—</span>
\d knowledge_base
</code></pre>
<p>æŸ¥çœ‹è¡¨ç»“æ„ç¡®è®¤å‘é‡åˆ—ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e0c4359dcbc44368a4331ec1f1bf4ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=Fsga%2B3JAp2E3yXzFFedJDaWPAGM%3D" alt="" loading="lazy"/></p>
<p><strong>æ­¥éª¤4ï¼šæ‰¹é‡æ’å…¥å‘é‡æ•°æ®</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä½¿ç”¨Pythonç”ŸæˆåµŒå…¥å¹¶æ‰¹é‡æ’å…¥</span>
<span class="hljs-comment"># å®‰è£…é©±åŠ¨: pip install psycopg2-binary langchain-openai</span>

<span class="hljs-keyword">import</span> psycopg2
<span class="hljs-keyword">from</span> langchain.embeddings <span class="hljs-keyword">import</span> OpenAIEmbeddings

<span class="hljs-comment"># åˆå§‹åŒ–åµŒå…¥æ¨¡å‹</span>
embeddings = OpenAIEmbeddings(model=<span class="hljs-string">"text-embedding-ada-002"</span>)

<span class="hljs-comment"># ç¤ºä¾‹æ–‡æ¡£</span>
docs = [
    {<span class="hljs-string">"title"</span>: <span class="hljs-string">"openGausså®‰è£…æŒ‡å—"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"è¯¦ç»†å®‰è£…æ­¥éª¤..."</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"tech_doc"</span>},
    {<span class="hljs-string">"title"</span>: <span class="hljs-string">"å‘é‡ç´¢å¼•åŸç†"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"HNSWç®—æ³•è¯¦è§£..."</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"algorithm"</span>},
    <span class="hljs-comment"># ... æ›´å¤šæ–‡æ¡£</span>
]

<span class="hljs-comment"># è¿æ¥æ•°æ®åº“å¹¶æ’å…¥</span>
conn = psycopg2.connect(database=<span class="hljs-string">"postgres"</span>, user=<span class="hljs-string">"opengauss"</span>, password=<span class="hljs-string">"Enmo@123"</span>, host=<span class="hljs-string">"localhost"</span>, port=<span class="hljs-string">"5432"</span>)
cur = conn.cursor()

<span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> docs:
    <span class="hljs-comment"># ç”Ÿæˆå‘é‡</span>
    vector = embeddings.embed_query(doc[<span class="hljs-string">"content"</span>])
    
    <span class="hljs-comment"># æ’å…¥æ•°æ®</span>
    cur.execute(
        <span class="hljs-string">"INSERT INTO knowledge_base (title, content, doc_type, embedding) VALUES (%s, %s, %s, %s)"</span>,
        (doc[<span class="hljs-string">"title"</span>], doc[<span class="hljs-string">"content"</span>], doc[<span class="hljs-string">"type"</span>], vector)
    )

conn.commit()
cur.close()

<span class="hljs-comment"># éªŒè¯æ’å…¥</span>
SELECT COUNT(*) FROM knowledge_base;
</code></pre>
<p><strong>ç»ˆç«¯è¾“å‡ºï¼š</strong></p>
<p>count</p>
<p>10500</p>
<p>(1 row)</p>
<h3 data-id="heading-10">3.3 æ„å»ºæ··åˆå‘é‡ç´¢å¼•</h3>
<p><strong>æ­¥éª¤5ï¼šåˆ›å»ºHNSWç´¢å¼•åŠ é€Ÿæ£€ç´¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºHNSWç´¢å¼•ï¼ˆé€‚åˆé«˜å¬å›ç‡åœºæ™¯ï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_kb_hnsw 
<span class="hljs-keyword">ON</span> knowledge_base 
<span class="hljs-keyword">USING</span> vectors (embedding) 
<span class="hljs-keyword">WITH</span> (index_type <span class="hljs-operator">=</span> <span class="hljs-string">'hnsw'</span>, m <span class="hljs-operator">=</span> <span class="hljs-number">16</span>, ef_construction <span class="hljs-operator">=</span> <span class="hljs-number">200</span>);

<span class="hljs-comment">-- åˆ›å»ºIVF-FLATç´¢å¼•ï¼ˆé€‚åˆå¤§è§„æ¨¡æ•°æ®ï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_kb_ivf 
<span class="hljs-keyword">ON</span> knowledge_base 
<span class="hljs-keyword">USING</span> vectors (embedding) 
<span class="hljs-keyword">WITH</span> (index_type <span class="hljs-operator">=</span> <span class="hljs-string">'ivfflat'</span>, nlists <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>);

<span class="hljs-comment">-- æŸ¥çœ‹ç´¢å¼•çŠ¶æ€</span>
<span class="hljs-keyword">SELECT</span> indexname, indexdef <span class="hljs-keyword">FROM</span> pg_indexes <span class="hljs-keyword">WHERE</span> tablename <span class="hljs-operator">=</span> <span class="hljs-string">'knowledge_base'</span>;
</code></pre>
<p><strong>ç»ˆç«¯è¾“å‡ºï¼š</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d58a275ba8842ddbbe862aec9f99f5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=%2FQYvSuk1iZlddooisrVURyZz6xg%3D" alt="" loading="lazy"/></p>
<p><strong>ç´¢å¼•åˆ›å»ºè¿‡ç¨‹ä¸è€—æ—¶æˆªå›¾</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe551a54830c4c72acf7a897c0541fb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=3dXF%2Bxr8UeFGoHvIF3v%2FHrOSyC8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">3.4 æ··åˆç›¸ä¼¼æ€§æœç´¢</h3>
<p><strong>æ­¥éª¤6ï¼šæ‰§è¡Œå¸¦å…ƒæ•°æ®è¿‡æ»¤çš„å‘é‡æŸ¥è¯¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åœºæ™¯ï¼šæŸ¥æ‰¾ä¸"æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–"æœ€ç›¸å…³çš„æŠ€æœ¯æ–‡æ¡£</span>
<span class="hljs-comment">-- ç¬¬ä¸€æ­¥ï¼šç”ŸæˆæŸ¥è¯¢å‘é‡ï¼ˆå‡è®¾å·²é€šè¿‡æ¨¡å‹è·å¾—ï¼‰</span>
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@query</span>_vec <span class="hljs-operator">=</span> <span class="hljs-string">'[0.12, -0.45, 0.78, ..., 0.33]'</span>;  <span class="hljs-comment">-- 768ç»´</span>

<span class="hljs-comment">-- ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œç›¸ä¼¼åº¦æ£€ç´¢ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰</span>
<span class="hljs-keyword">SELECT</span> 
    doc_id,
    title,
    doc_type,
    <span class="hljs-number">1</span> <span class="hljs-operator">-</span> (embedding <span class="hljs-operator">&lt;=&gt;</span> <span class="hljs-variable">@query</span>_vec::vector) <span class="hljs-keyword">AS</span> similarity,
    create_time
<span class="hljs-keyword">FROM</span> knowledge_base
<span class="hljs-keyword">WHERE</span> doc_type <span class="hljs-operator">=</span> <span class="hljs-string">'tech_doc'</span>  <span class="hljs-comment">-- ä¸šåŠ¡å±æ€§è¿‡æ»¤</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> embedding <span class="hljs-operator">&lt;=&gt;</span> <span class="hljs-variable">@query</span>_vec::vector
LIMIT <span class="hljs-number">10</span>;

<span class="hljs-comment">-- ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</span>
EXPLAIN (ANALYZE, BUFFERS) 
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> knowledge_base <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> embedding <span class="hljs-operator">&lt;=&gt;</span> <span class="hljs-variable">@query</span>_vec::vector LIMIT <span class="hljs-number">5</span>;
</code></pre>
<p><strong>ç»ˆç«¯è¾“å‡ºï¼š</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d79f126648043f193c12d6a4bca1b01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=rNs4T1g6JQkHn6bZ1qxQbi8NNyo%3D" alt="" loading="lazy"/></p>
<p><strong>æ‰§è¡Œè®¡åˆ’åˆ†æè¾“å‡ºï¼š</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edf5016bf38c47978560e576fe51207d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=YiiV135XYvjs1b4saToPVo0RvbM%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-12">4. æ€§èƒ½åŸºå‡†æµ‹è¯•ä¸åˆ†æ</h2>
<h3 data-id="heading-13">4.1 æµ‹è¯•ç¯å¢ƒé…ç½®</h3>
<p>åŸºäºåä¸ºäº‘ECSå®ä¾‹ï¼Œè§„æ ¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><strong>CPU</strong>:  Kunpeng 920 @ 2.6GHz, 32 cores</p>
</li>
<li>
<p><strong>å†…å­˜</strong>: 128GB DDR4</p>
</li>
<li>
<p><strong>å­˜å‚¨</strong>: 3TB NVMe SSD</p>
</li>
<li>
<p><strong>OS</strong>: openEuler 22.03 LTS</p>
</li>
<li>
<p><strong>æ•°æ®é›†</strong>: GIST-1Mï¼ˆ960ç»´å‘é‡ï¼‰+ 10ä¸‡æ¡ç»“æ„åŒ–å…ƒæ•°æ®</p>
</li>
</ul>
<h3 data-id="heading-14">4.2 å‘é‡æ£€ç´¢æ€§èƒ½å¯¹æ¯”</h3>
<p><strong>è¡¨ï¼šä¸åŒç´¢å¼•ç±»å‹æ€§èƒ½åŸºå‡†</strong></p>













































<table><thead><tr><th>ç´¢å¼•ç±»å‹</th><th>æ„å»ºæ—¶é—´</th><th>å†…å­˜å ç”¨</th><th>P99å»¶è¿Ÿ</th><th>QPS@95%Recall</th><th>å¬å›ç‡</th></tr></thead><tbody><tr><td>Flat (æš´åŠ›æ£€ç´¢)</td><td>-</td><td>3.6GB</td><td>850ms</td><td>1.2</td><td>100%</td></tr><tr><td>IVF-FLAT (nlist=1000)</td><td>45s</td><td>4.1GB</td><td>45ms</td><td>22.3</td><td>94.8%</td></tr><tr><td><strong>HNSW (m=16, ef=200)</strong></td><td><strong>234s</strong></td><td><strong>5.8GB</strong></td><td><strong>12ms</strong></td><td><strong>83.7</strong></td><td><strong>95.2%</strong></td></tr><tr><td>HNSW (m=32, ef=400)</td><td>478s</td><td>8.2GB</td><td>8ms</td><td>125.4</td><td>96.1%</td></tr></tbody></table>
<h3 data-id="heading-15">4.3 AIå·¥ä½œè´Ÿè½½ç«¯åˆ°ç«¯æµ‹è¯•</h3>
<p>åœ¨RAGåœºæ™¯ä¸‹ï¼Œå®Œæ•´é“¾è·¯ï¼ˆæŸ¥è¯¢å‘é‡åŒ–+å‘é‡æ£€ç´¢+LLMç”Ÿæˆï¼‰æ€§èƒ½ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨benchmarkå·¥å…·æµ‹è¯•</span>
./vector_rag_benchmark --queries 1000 --concurrency 32 --model gpt-3.5-turbo
</code></pre>
<p>æµ‹è¯•ç»“æœæ‘˜è¦</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3a26c004dc44e1fba40a3acca837b0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=VyIBD4Qfq8UIFeh4JLPonlxpIqs%3D" alt="" loading="lazy"/></p>
<p>å…³é”®å‘ç°ï¼š<strong>å‘é‡æ£€ç´¢å æ¯”ä»…5.3%</strong>ï¼Œè¯æ˜openGausså‘é‡å¼•æ“ä¸ä¼šæˆä¸ºRAGç³»ç»Ÿç“¶é¢ˆã€‚ç›¸æ¯”å¤–ç½®å‘é‡æ•°æ®åº“ï¼ˆå¦‚Milvusï¼‰+PostgreSQLæ–¹æ¡ˆï¼Œç«¯åˆ°ç«¯å»¶è¿Ÿé™ä½22%ï¼Œäº‹åŠ¡ä¸€è‡´æ€§ä¿éšœæå‡æ˜¾è‘—[^329]ã€‚</p>
<hr/>
<h2 data-id="heading-16">5. ç”Ÿæ€æ•´åˆï¼šä¸LangChain/Difyçš„æ·±åº¦èåˆ</h2>
<h3 data-id="heading-17">5.1 LangChainé›†æˆæ–¹æ¡ˆ</h3>
<p>openGaussé€šè¿‡<code>langchain-opengauss</code>åŒ…æä¾›æ ‡å‡†VectorStoreæ¥å£[^61][^65]ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.vectorstores <span class="hljs-keyword">import</span> OpenGauss
<span class="hljs-keyword">from</span> langchain.embeddings <span class="hljs-keyword">import</span> HuggingFaceEmbeddings

<span class="hljs-comment"># åˆå§‹åŒ–è¿æ¥</span>
vector_store = OpenGauss(
    connection_string=<span class="hljs-string">"postgresql://opengauss:Enmo@123@localhost:5432/postgres"</span>,
    embedding_function=HuggingFaceEmbeddings(),
    collection_name=<span class="hljs-string">"enterprise_kb"</span>,
    vector_dimension=<span class="hljs-number">768</span>
)

<span class="hljs-comment"># æ·»åŠ æ–‡æ¡£ï¼ˆè‡ªåŠ¨å®Œæˆå‘é‡åŒ–ä¸äº‹åŠ¡å†™å…¥ï¼‰</span>
vector_store.add_texts(
    texts=[<span class="hljs-string">"openGaussæ”¯æŒå‘é‡æ£€ç´¢"</span>, <span class="hljs-string">"DataVecæ’ä»¶æå‡AIæ•ˆç‡"</span>],
    metadatas=[{<span class="hljs-string">"source"</span>: <span class="hljs-string">"tech_doc"</span>}, {<span class="hljs-string">"source"</span>: <span class="hljs-string">"blog"</span>}],
    batch_size=<span class="hljs-number">1000</span>
)

<span class="hljs-comment"># å¸¦è¿‡æ»¤çš„ç›¸ä¼¼åº¦æŸ¥è¯¢</span>
results = vector_store.similarity_search_with_score(
    query=<span class="hljs-string">"å¦‚ä½•ä¼˜åŒ–å‘é‡ç´¢å¼•"</span>,
    k=<span class="hljs-number">5</span>,
    <span class="hljs-built_in">filter</span>={<span class="hljs-string">"source"</span>: <span class="hljs-string">"tech_doc"</span>},
    distance_threshold=<span class="hljs-number">0.75</span>
)
</code></pre>
<h3 data-id="heading-18">5.2 DifyçŸ¥è¯†åº“å¯¹æ¥</h3>
<p>åœ¨Difyå¹³å°é…ç½®openGaussä½œä¸ºå‘é‡å­˜å‚¨åç«¯ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.override.yml</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">VECTOR_STORE:</span> <span class="hljs-string">opengauss</span>
      <span class="hljs-attr">OPENGAUSS_HOST:</span> <span class="hljs-string">db.opengauss.local</span>
      <span class="hljs-attr">OPENGAUSS_PORT:</span> <span class="hljs-number">5432</span>
      <span class="hljs-attr">OPENGAUSS_USER:</span> <span class="hljs-string">opengauss</span>
      <span class="hljs-attr">OPENGAUSS_PASSWORD:</span> <span class="hljs-string">${DB_PASSWORD}</span>
      <span class="hljs-attr">OPENGAUSS_DATABASE:</span> <span class="hljs-string">dify_kb</span>
</code></pre>
<p>æ­¤æ–¹æ¡ˆå®ç°ä¼ä¸šçº§æƒé™ç®¡æ§ä¸å®¡è®¡ï¼Œæ»¡è¶³é‡‘èçº§åˆè§„è¦æ±‚ã€‚</p>
<hr/>
<h2 data-id="heading-19">6. ç”¨æˆ·æ¡ˆä¾‹ç ”ç©¶ï¼šæ™ºèƒ½åˆ¶é€ æ•…éšœè¯Šæ–­</h2>
<h3 data-id="heading-20">6.1 é—®é¢˜èƒŒæ™¯</h3>
<p>æŸå…‰ä¼åˆ¶é€ ä¼ä¸šé¢ä¸´è®¾å¤‡æ•…éšœå®šä½è€—æ—¶é•¿çš„ç—›ç‚¹ï¼šå†å²å·¥å•10ä¸‡+ï¼Œæ•…éšœæè¿°å¤šä¸ºéç»“æ„åŒ–æ–‡æœ¬ï¼Œä¼ ç»Ÿå…³é”®è¯æ£€ç´¢å‡†ç¡®ç‡ä½ï¼ˆ&lt;60%ï¼‰ï¼Œå¹³å‡å®šä½æ—¶é—´4.2å°æ—¶ã€‚</p>
<h3 data-id="heading-21">6.2 ç³»ç»Ÿæ¶æ„</h3>
<p><strong>æ•…éšœè¯Šæ–­RAGæ¶æ„</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7616e170f7f4042b7aff8d13f979050~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u5a2mQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765073830&amp;x-signature=h9VxFEM7QOmlcyna2fBM04v41ds%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-22">6.3 æ•°æ®è§„æ¨¡ä¸æ€§èƒ½</h3>
<ul>
<li>
<p><strong>ç»“æ„åŒ–æ•°æ®</strong>ï¼šè®¾å¤‡ä¼ æ„Ÿå™¨æ•°æ®5.2äº¿æ¡ï¼Œæ—¶åºè¡¨åˆ†åŒº1200+</p>
</li>
<li>
<p><strong>å‘é‡æ•°æ®</strong>ï¼šå·¥å•æ–‡æœ¬embedding 10.5ä¸‡æ¡ï¼Œ768ç»´</p>
</li>
<li>
<p><strong>æŸ¥è¯¢è´Ÿè½½</strong>ï¼šå³°å€¼QPS 350ï¼ŒP99å»¶è¿Ÿ&lt;50ms</p>
</li>
<li>
<p><strong>æ€§èƒ½ç»“æœ</strong>ï¼š</p>
<ul>
<li>
<p>æ•…éšœå®šä½æ—¶é—´ï¼š4.2å°æ—¶ â†’ 18åˆ†é’Ÿï¼ˆæå‡93%ï¼‰</p>
</li>
<li>
<p>æ£€ç´¢å‡†ç¡®ç‡ï¼š58% â†’ 91.7%</p>
</li>
<li>
<p>çŸ¥è¯†åº“æ›´æ–°å»¶è¿Ÿï¼šä»T+1åˆ°å‡†å®æ—¶</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-23">6.4 å…³é”®æŠ€æœ¯å®ç°</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºæ—¶åºæ•°æ®ä¸å‘é‡å…³è”è§†å›¾</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> fault_diagnosis_view <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> 
    d.device_id,
    d.fault_time,
    d.sensor_data,
    k.doc_id <span class="hljs-keyword">AS</span> similar_case_id,
    k.title <span class="hljs-keyword">AS</span> case_title,
    <span class="hljs-number">1</span> <span class="hljs-operator">-</span> (k.embedding <span class="hljs-operator">&lt;=&gt;</span> d.fault_desc_vector) <span class="hljs-keyword">AS</span> similarity
<span class="hljs-keyword">FROM</span> device_fault d
<span class="hljs-keyword">CROSS</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">LATERAL</span> (
    <span class="hljs-keyword">SELECT</span> doc_id, title, embedding
    <span class="hljs-keyword">FROM</span> knowledge_base
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> embedding <span class="hljs-operator">&lt;=&gt;</span> d.fault_desc_vector
    LIMIT <span class="hljs-number">5</span>
) k
<span class="hljs-keyword">WHERE</span> d.fault_time <span class="hljs-operator">&gt;</span> NOW() <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'24 hours'</span>;
</code></pre>
<hr/>
<h2 data-id="heading-24">7. ç»“è®º</h2>
<p>openGaussé€šè¿‡6.0ç‰ˆæœ¬DataVecæ’ä»¶ä¸7.0ç‰ˆæœ¬å‘é‡å¼•æ“çš„æ·±åº¦ä¼˜åŒ–ï¼ŒæˆåŠŸæ„å»ºäº†**å…¨æ ˆAI-Nativeæ•°æ®åº“èƒ½åŠ›**ã€‚å®æµ‹è¡¨æ˜ï¼Œåœ¨RAGã€æ™ºèƒ½åˆ¶é€ ç­‰åœºæ™¯ä¸­ï¼Œå…¶æ··åˆæ£€ç´¢æ€§èƒ½è¾¾åˆ°ä¸“ç”¨å‘é‡æ•°æ®åº“æ°´å¹³ï¼ŒåŒæ—¶æä¾› unparalleled çš„äº‹åŠ¡ä¸€è‡´æ€§ä¸ä¼ä¸šçº§ç‰¹æ€§ã€‚è‡ªä¸»ç ”å‘æ•°æ®åº“æ­£ä»"è¿½èµ¶è€…"è½¬å˜ä¸º"å®šä¹‰è€…"ï¼Œåœ¨ç”Ÿæˆå¼AIæ—¶ä»£å¼€è¾Ÿå‡ºä¸€æ¡èåˆåˆ›æ–°ä¹‹è·¯ã€‚</p>
<h3 data-id="heading-25">7.1 å…³é”®ä»·å€¼æ€»ç»“</h3>



































<table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿæ–¹æ¡ˆ</th><th>openGaussæ–¹æ¡ˆ</th><th>æå‡</th></tr></thead><tbody><tr><td><strong>æ•°æ®ä¸€è‡´æ€§</strong></td><td>æœ€ç»ˆä¸€è‡´æ€§</td><td>å¿«ç…§éš”ç¦»çº§åˆ«</td><td>100%</td></tr><tr><td><strong>è¿ç»´å¤æ‚åº¦</strong></td><td>å¤šç³»ç»ŸååŒ</td><td>å•ä¸€æ•°æ®åº“è‡ªæ²»</td><td>-70%</td></tr><tr><td><strong>ç«¯åˆ°ç«¯å»¶è¿Ÿ</strong></td><td>1200ms</td><td>847ms</td><td>-29%</td></tr><tr><td><strong>TCOæˆæœ¬</strong></td><td>é«˜ï¼ˆå¤š licenseï¼‰</td><td>ä½ï¼ˆç»Ÿä¸€å¹³å°ï¼‰</td><td>-45%</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ŠJavaæ³›å‹ï¼šç»™ä½ çš„ä»£ç è£…ä¸Šâ€œå¿«é€’åˆ†æ‹£ç³»ç»Ÿâ€ï¼Œå†ä¹Ÿä¸ä¼šæ‹†å‡ºä¸€åŒé‹ï¼ã€‹]]></title>    <link>https://juejin.cn/post/7577690150093193256</link>    <guid>https://juejin.cn/post/7577690150093193256</guid>    <pubDate>2025-11-30T02:56:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577690150093193256" data-draft-id="7577713754563149876" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ŠJavaæ³›å‹ï¼šç»™ä½ çš„ä»£ç è£…ä¸Šâ€œå¿«é€’åˆ†æ‹£ç³»ç»Ÿâ€ï¼Œå†ä¹Ÿä¸ä¼šæ‹†å‡ºä¸€åŒé‹ï¼ã€‹"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-30T02:56:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="oouy"/> <meta itemprop="url" content="https://juejin.cn/user/402859440221980"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ŠJavaæ³›å‹ï¼šç»™ä½ çš„ä»£ç è£…ä¸Šâ€œå¿«é€’åˆ†æ‹£ç³»ç»Ÿâ€ï¼Œå†ä¹Ÿä¸ä¼šæ‹†å‡ºä¸€åŒé‹ï¼ã€‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/402859440221980/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    oouy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T02:56:04.000Z" title="Sun Nov 30 2025 02:56:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Javaæ³›å‹ï¼šè®©ä»£ç å‘Šåˆ«â€œæ··ä¹±å¿«é€’ç«™â€çš„ç¥å™¨ ğŸ“¦âœ¨</h2>
<blockquote>
<p><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š<br/>
æ³›å‹ = ç»™ä½ çš„é›†åˆè´´ä¸Šâ€œåªè£…é›¶é£Ÿâ€çš„å¿«é€’æ ‡ç­¾ï¼Œå†ä¹Ÿä¸æ€•æ‹†å‡ºä¸€åŒé‹ï¼</p>
</blockquote>
<p>å¦‚æœä½ æ›¾åœ¨ Java ä»£ç é‡Œé­é‡è¿‡ <code>ClassCastException</code>ï¼Œé‚£æ„Ÿè§‰å°±åƒâ€”â€”<br/>
ä½ æ»¡æ€€æœŸå¾…åœ°æ‰“å¼€ä¸€ä¸ªæ ‡æ³¨ <strong>â€œè–¯ç‰‡â€</strong> çš„å¿«é€’ç®±ï¼Œç»“æœæå‡ºä¸€åŒ <strong>è¿åŠ¨é‹</strong> ğŸ‘Ÿã€‚<br/>
ä¸ä»…åƒä¸ä¸Šï¼Œè¿˜å¯èƒ½è¢«é‹å¸¦ç»Šå€’ ğŸ˜­ã€‚</p>
<p>åˆ«æ…Œï¼ä»Šå¤©æˆ‘ä»¬å°±ç”¨ <strong>â€œå¿«é€’åˆ†æ‹£â€</strong> çš„æ€è·¯ï¼ŒæŠŠ Java æ³›å‹è®²å¾—æ˜æ˜ç™½ç™½ã€‚<br/>
è®©ä½ çš„ä»£ç ä» <strong>é‡è›®å¿«é€’å †</strong> å˜æˆ <strong>é¡ºä¸°çº§åˆ†æ‹£ä¸­å¿ƒ</strong> âœˆï¸ğŸ“¦ï¼</p>
<hr/>
<h3 data-id="heading-1">ğŸš« ä¸€ã€æ²¡æœ‰æ³›å‹çš„â€œé‡è›®æ—¶ä»£â€ï¼šå¿«é€’ä¹±è£…ä¹±å‘</h3>
<p>åœ¨ JDK 5 ä¹‹å‰ï¼ŒJava é›†åˆå°±åƒä¸ª <strong>æ²¡äººç®¡çš„ä¸‰ä¸ç®¡å¿«é€’ç«™</strong>ï¼š<br/>
ä¸ç®¡æ˜¯æ–‡ä»¶ã€è¡£æœã€è¿˜æ˜¯æ‰‹æœºï¼Œç»Ÿç»Ÿå¡è¿›åŒä¸€ä¸ªæ ‡ç€ <strong><code>Object</code></strong> çš„å¤§ç®±å­ã€‚</p>
<h4 data-id="heading-2">ğŸ’¥ ç¦»è°±ä»£ç ç°åœºè¿˜åŸï¼š</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// â€œå•¥éƒ½èƒ½è£…â€çš„ä¸‡èƒ½å¿«é€’ç®±</span>
<span class="hljs-type">ArrayList</span> <span class="hljs-variable">packageBox</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();
packageBox.add(<span class="hljs-string">"è–¯ç‰‡"</span>);      <span class="hljs-comment">// é›¶é£Ÿ</span>
packageBox.add(<span class="hljs-number">99</span>);          <span class="hljs-comment">// ä»·æ ¼æ ‡ç­¾ï¼Ÿ</span>
packageBox.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>()); <span class="hljs-comment">// æ‰‹æœºï¼Ÿè°æ”¾çš„ï¼</span>

<span class="hljs-comment">// æ‹†ç®±æ—¶åˆ»ï¼šä»¥ä¸ºå…¨æ˜¯é›¶é£Ÿ...</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; packageBox.size(); i++) {
    <span class="hljs-type">String</span> <span class="hljs-variable">snack</span> <span class="hljs-operator">=</span> (String) packageBox.get(i); <span class="hljs-comment">// BOOM! ClassCastException!</span>
    System.out.println(<span class="hljs-string">"æ‹†åˆ°é›¶é£Ÿï¼š"</span> + snack);
}
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>ç¼–è¯‘æ—¶å²æœˆé™å¥½ï¼Œè¿è¡Œæ—¶å½“åœºçˆ†ç‚¸</strong> â€”â€” è¿™å°±æ˜¯æ²¡æœ‰æ³›å‹çš„ç—›ï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">âœ… äºŒã€æ³›å‹ç™»åœºï¼šç»™å¿«é€’ç®±è´´â€œä¸“å±æ ‡ç­¾â€</h3>
<p>æ³›å‹çš„å‡ºç°ï¼Œç›¸å½“äºç»™æ¯ä¸ªé›†åˆè´´ä¸Š <strong>ç²¾å‡†åˆ†ç±»æ ‡ç­¾</strong>ï¼š</p>
<blockquote>
<p>â€œæ­¤ç®±ä»…é™ <code>String</code>ï¼ˆé›¶é£Ÿï¼‰ï¼â€<br/>
â€œæ­¤ç®±ä»…é™ <code>Integer</code>ï¼ˆä»·æ ¼ï¼‰ï¼â€</p>
</blockquote>
<p><strong>æ”¾é”™ï¼Ÿç¼–è¯‘å™¨ç›´æ¥æ‹’æ”¶ï¼</strong></p>
<h4 data-id="heading-4">ğŸŒŸ æ”¹é€ åä»£ç ï¼ˆæ¸…çˆ½å¦‚æ–°ï¼‰ï¼š</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// è´´æ ‡ç­¾ï¼šé›¶é£Ÿä¸“å±ç®± ğŸ«</span>
ArrayList&lt;String&gt; snackBox = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
snackBox.<span class="hljs-keyword">add</span>(<span class="hljs-string">"è–¯ç‰‡"</span>);
snackBox.<span class="hljs-keyword">add</span>(<span class="hljs-string">"å·§å…‹åŠ›"</span>);
<span class="hljs-comment">// snackBox.add(99);        // âŒ ç¼–è¯‘æŠ¥é”™ï¼æ•°å­—ä¸æ˜¯é›¶é£Ÿï¼</span>
<span class="hljs-comment">// snackBox.add(new Phone()); // âŒ æ‰‹æœºè¯·èµ°ç”µå­äº§å“é€šé“ï¼</span>

<span class="hljs-keyword">for</span> (String snack : snackBox) {
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ‹†åˆ°é›¶é£Ÿï¼š"</span> + snack); <span class="hljs-comment">// å®‰å…¨ï¼èˆ’å¿ƒï¼æ— å¼ºè½¬ï¼</span>
}
</code></pre>
<blockquote>
<p>âœ… <strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šæŠŠ <strong>è¿è¡Œæ—¶çš„æƒŠå“</strong>ï¼Œå˜æˆ <strong>ç¼–è¯‘æ—¶çš„æé†’</strong>ï¼ŒBug æ­»åœ¨æ‘‡ç¯®é‡Œï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">ğŸ§© ä¸‰ã€æ³›å‹çš„â€œä¸‰å¤§åˆ†èº«â€ï¼šç±»ã€æ¥å£ã€æ–¹æ³•</h3>
<p>æ³›å‹ä¸æ˜¯å•ä¸€å·¥å…·ï¼Œè€Œæ˜¯ä¸€å¥— <strong>æ™ºèƒ½å¿«é€’åˆ†æ‹£ç³»ç»Ÿ</strong>ï¼š</p>

























<table><thead><tr><th>è§’è‰²</th><th>æ¯”å–»</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>æ³›å‹ç±»</strong></td><td>ä¸‡èƒ½æ”¶çº³ç›’</td><td>è£…ä»€ä¹ˆç”±ä½ å®š</td></tr><tr><td><strong>æ³›å‹æ¥å£</strong></td><td>é…é€è§„åˆ™</td><td>è§„å®šâ€œé€ä»€ä¹ˆç±»å‹â€</td></tr><tr><td><strong>æ³›å‹æ–¹æ³•</strong></td><td>å…¨èƒ½å¿«é€’å‘˜</td><td>å•ç‚¹å¤„ç†å¤šç±»å‹</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-6">1ï¸âƒ£ æ³›å‹ç±»ï¼šç»™ç±»è£…ä¸ªâ€œç±»å‹è°ƒèŠ‚æ—‹é’®â€ ğŸ›ï¸</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StorageBox</span>&lt;<span class="hljs-title">T</span>&gt; {
    <span class="hljs-keyword">private</span> T item;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StorageBox</span>(<span class="hljs-params">T item</span>)</span> { <span class="hljs-keyword">this</span>.item = item; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">getItem</span>()</span> { <span class="hljs-keyword">return</span> item; }
}
</code></pre>
<blockquote>
<p><code>T</code> å°±åƒæ”¶éŸ³æœºçš„è°ƒé¢‘æ—‹é’®â€”â€”æ‹§åˆ°å“ªï¼Œå°±æ”¶å“ªç§ä¿¡å·ï¼</p>
</blockquote>
<h5 data-id="heading-7">ä½¿ç”¨ç¤ºä¾‹ï¼š</h5>
<pre><code class="hljs language-ini" lang="ini">StorageBox&lt;String&gt; <span class="hljs-attr">notebookBox</span> = new StorageBox&lt;&gt;(<span class="hljs-string">"ç¬”è®°æœ¬"</span>)<span class="hljs-comment">;</span>
StorageBox&lt;Integer&gt; <span class="hljs-attr">jewelryBox</span> = new StorageBox&lt;&gt;(<span class="hljs-number">599</span>)<span class="hljs-comment">;</span>
StorageBox&lt;Cat&gt; <span class="hljs-attr">catBox</span> = new StorageBox&lt;&gt;(new Cat(<span class="hljs-string">"ç…¤çƒ"</span>))<span class="hljs-comment">;</span>

// ç›´æ¥å–ï¼Œæ— éœ€å¼ºè½¬ï¼ç±»å‹å®‰å…¨æ‹‰æ»¡ âœ…
</code></pre>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼šä¸èƒ½ç”¨ <code>int</code>ã€<code>double</code> ç­‰åŸºæœ¬ç±»å‹ï¼è¦ç”¨ <code>Integer</code>ã€<code>Double</code> åŒ…è£…ç±»â€”â€”<br/>
å°±åƒç¡¬å¸å¾—å…ˆè£…è¿›ä¿¡å°æ‰èƒ½å¯„ï¼ˆåŒ…è£…ç±» = ç¡¬å¸è¢‹ï¼‰ğŸ’°</p>
</blockquote>
<hr/>
<h4 data-id="heading-8">2ï¸âƒ£ æ³›å‹æ¥å£ï¼šåˆ¶å®šâ€œé€šç”¨é…é€è§„åˆ™â€ ğŸ“œ</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">MessageSender</span>&lt;<span class="hljs-title">T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">send</span>(<span class="hljs-params">T message</span>)</span>;
}
</code></pre>
<h5 data-id="heading-9">ä¸¤ç§å®ç°æ–¹å¼ï¼š</h5>
<ul>
<li>
<p><strong>å›ºå®šç±»å‹æ´¾</strong>ï¼ˆåªå‘æ–‡å­—ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextSender</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessageSender</span>&lt;<span class="hljs-title class_">String</span>&gt; {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">send</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> msg</span>) { <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"å‘æ–‡å­—ï¼š"</span> + msg); }
}
</code></pre>
</li>
<li>
<p><strong>çµæ´»æ¥å•æ´¾</strong>ï¼ˆå•¥éƒ½å‘ï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AnySender</span>&lt;<span class="hljs-title">T</span>&gt; implements <span class="hljs-title">MessageSender</span>&lt;<span class="hljs-title">T</span>&gt;</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">send</span>(<span class="hljs-params">T msg</span>)</span> { System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å‘ä»»æ„æ¶ˆæ¯ï¼š"</span> + msg); }
}

<span class="hljs-comment">// å®¢æˆ·è¦å‘å›¾ç‰‡ï¼Ÿ</span>
<span class="hljs-keyword">new</span> AnySender&lt;Image&gt;().send(<span class="hljs-keyword">new</span> Image(<span class="hljs-string">"é£æ™¯ç…§"</span>));
</code></pre>
</li>
</ul>
<hr/>
<h4 data-id="heading-10">3ï¸âƒ£ æ³›å‹æ–¹æ³•ï¼šå¼€ä¸ªâ€œå¿«é€Ÿé€šé“â€ ğŸš€</h4>
<p>ä¸éœ€è¦æ•´ä¸ªç±»æ³›å‹ï¼Ÿé‚£å°±åªç»™æ–¹æ³•åŠ ï¼</p>
<pre><code class="hljs language-ini" lang="ini">public class ArrayHelper {
    public static &lt;T&gt; void swap(T<span class="hljs-section">[]</span> arr, int i, int j) {
        T <span class="hljs-attr">temp</span> = arr[i]<span class="hljs-comment">;</span>
        arr<span class="hljs-section">[i]</span> = arr<span class="hljs-section">[j]</span><span class="hljs-comment">;</span>
        arr<span class="hljs-section">[j]</span> = temp<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h5 data-id="heading-11">ä¸‡ç‰©çš†å¯ swapï¼š</h5>
<pre><code class="hljs language-ini" lang="ini">String<span class="hljs-section">[]</span> <span class="hljs-attr">fruits</span> = {<span class="hljs-string">"è‹¹æœ"</span>, <span class="hljs-string">"é¦™è•‰"</span>}<span class="hljs-comment">;</span>
ArrayHelper.swap(fruits, 0, 1)<span class="hljs-comment">; // âœ…</span>

Integer<span class="hljs-section">[]</span> <span class="hljs-attr">nums</span> = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}<span class="hljs-comment">;</span>
ArrayHelper.swap(nums, 0, 2)<span class="hljs-comment">;   // âœ…</span>

Cat<span class="hljs-section">[]</span> <span class="hljs-attr">cats</span> = {new Cat(<span class="hljs-string">"ç…¤çƒ"</span>), new Cat(<span class="hljs-string">"æ©˜çŒ«"</span>)}<span class="hljs-comment">;</span>
ArrayHelper.swap(cats, 0, 1)<span class="hljs-comment">;   // âœ…</span>
</code></pre>
<blockquote>
<p>ğŸ” ç¼–è¯‘å™¨è‡ªåŠ¨â€œçŒœç±»å‹â€ï¼Œä½ è¿ <code>&lt;String&gt;</code> éƒ½ä¸ç”¨å†™ï¼æ™ºèƒ½å¦‚ Siri ğŸ—£ï¸</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">ğŸ•µï¸ å››ã€æ³›å‹çš„â€œéšè—æŠ€èƒ½â€ï¼šé€šé…ç¬¦ &amp; ç±»å‹æ“¦é™¤</h3>
<h4 data-id="heading-13">1. é€šé…ç¬¦ <code>?</code>ï¼šæ¨¡ç³Šæœç´¢ï¼Œä½†æœ‰è¾¹ç•Œï¼</h4>

























<table><thead><tr><th>å†™æ³•</th><th>å«ä¹‰</th><th>åœºæ™¯</th></tr></thead><tbody><tr><td><code>List&lt;?&gt;</code></td><td>ä»»æ„ç±»å‹</td><td>æ‰“å°ä»»æ„é›†åˆ</td></tr><tr><td><code>List&lt;? extends Animal&gt;</code></td><td>Animal æˆ–å­ç±»</td><td>å® ç‰©åŒ»é™¢åªçœ‹â€œåŠ¨ç‰©â€</td></tr><tr><td><code>List&lt;? super Cat&gt;</code></td><td>Cat æˆ–çˆ¶ç±»</td><td>æ¥æ”¶çŒ«åŠä»¥ä¸Šç±»å‹</td></tr></tbody></table>
<h5 data-id="heading-14">ğŸ¾ å® ç‰©åŒ»é™¢å®æˆ˜ï¼š</h5>
<pre><code class="hljs language-scss" lang="scss">public static void <span class="hljs-built_in">treatCats</span>(List&lt;? extends Cat&gt; cats) {
    for (Cat c : cats) c<span class="hljs-selector-class">.treat</span>(); <span class="hljs-comment">// æ³¢æ–¯çŒ«ã€ç‹¸èŠ±çŒ«éƒ½è¡Œï¼</span>
}

List&lt;PersianCat&gt; persians = Arrays<span class="hljs-selector-class">.asList</span>(new PersianCat());
<span class="hljs-built_in">treatCats</span>(persians); <span class="hljs-comment">// âœ…</span>

<span class="hljs-comment">// treatCats(dogList); // âŒ æ³°è¿ªç‹—è¿›ä¸äº†çŒ«è¯Šå®¤ï¼</span>
</code></pre>
<hr/>
<h4 data-id="heading-15">2. ç±»å‹æ“¦é™¤ï¼šç¼–è¯‘æ—¶æˆ´é¢å…·ï¼Œè¿è¡Œæ—¶æ‘˜æ‰ ğŸ˜·</h4>
<p>Java æ³›å‹æ˜¯ <strong>â€œä¼ªæ³›å‹â€</strong> â€”â€” ç¼–è¯‘åæ‰€æœ‰ <code>&lt;T&gt;</code> éƒ½ä¼šè¢«æ“¦æˆ <code>Object</code>ï¼</p>
<pre><code class="hljs language-ini" lang="ini">ArrayList&lt;String&gt; <span class="hljs-attr">strList</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
ArrayList&lt;Integer&gt; <span class="hljs-attr">intList</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>

System.out.println(strList.getClass() == intList.getClass())<span class="hljs-comment">; // true!</span>
</code></pre>
<blockquote>
<p>ğŸ’¡ èƒŒååŸç†ï¼šç¼–è¯‘å™¨å·å·å¸®ä½ åŠ äº† <code>(String)</code> å¼ºè½¬ï¼<br/>
ä½ çœ‹åˆ°çš„æ˜¯å®‰å…¨ï¼ŒèƒŒåæ˜¯ <strong>è‡ªåŠ¨ cast</strong> åœ¨æ‰›é›· âš¡</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">âš ï¸ äº”ã€æ³›å‹â€œé¿å‘æŒ‡å—â€ï¼šè¿™äº›é›·åƒä¸‡åˆ«è¸©ï¼</h3>

























<table><thead><tr><th>å‘ç‚¹</th><th>æ­£ç¡®åšæ³•</th></tr></thead><tbody><tr><td>âŒ <code>ArrayList&lt;int&gt;</code></td><td>âœ… <code>ArrayList&lt;Integer&gt;</code></td></tr><tr><td>âŒ é™æ€æ–¹æ³•ç”¨ç±»çš„ <code>T</code></td><td>âœ… é™æ€æ–¹æ³•è‡ªå·±å®šä¹‰ <code>&lt;E&gt;</code></td></tr><tr><td>âŒ <code>new T[10]</code></td><td>âœ… ç”¨ <code>List&lt;T&gt;</code> ä»£æ›¿æ•°ç»„</td></tr><tr><td>âŒ æ³›å‹ç±»ç»§æ‰¿ <code>Exception</code></td><td>âŒ ä¸æ”¯æŒï¼åˆ«è¯•ï¼</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-17">ğŸ¯ æ€»ç»“ï¼šæ³›å‹åˆ°åº•å¥½åœ¨å“ªï¼Ÿ</h3>
<blockquote>
<p><strong>ç¼–è¯‘æ—¶é˜²é”™ï¼Œè¿è¡Œæ—¶çœå¿ƒï¼Œä»£ç è¿˜èƒ½å¤ç”¨ï¼</strong></p>
</blockquote>
<p>æ–°æ‰‹è®°ä½è¿™ä¸‰ç‚¹å°±å¤Ÿäº†ï¼š</p>
<ol>
<li><strong>æ³›å‹ = ç±»å‹å‚æ•°åŒ–</strong> â†’ ç»™æ•°æ®è´´åˆ†ç±»æ ‡ç­¾ï¼›</li>
<li><strong>ä¸‰ç§å½¢æ€</strong>ï¼šç±»ã€æ¥å£ã€æ–¹æ³•ï¼ŒæŒ‰éœ€é€‰ç”¨ï¼›</li>
<li><strong>é€šé…ç¬¦å®šèŒƒå›´ï¼Œç±»å‹æ“¦é™¤æ˜¯ç¼–è¯‘ç§˜å¯†</strong>ã€‚</li>
</ol>
<hr/>
<p>ä¸‹æ¬¡å†™é›†åˆï¼Œåˆ«å†è£¸å¥” <code>ArrayList</code> äº†ï¼<br/>
<strong>åŠ ä¸Šæ³›å‹ï¼Œå°±åƒç»™å¿«é€’è´´å¥½æ ‡ç­¾</strong> â€”â€”<br/>
ä»æ­¤å¯„å¾—å®‰å¿ƒï¼Œæ”¶å¾—å¼€å¿ƒï¼Œä»£ç ä¼˜é›…å¦‚è¯— âœ¨</p>
<hr/>
<blockquote>
<p>ğŸ“Œ <strong>æ ‡ç­¾å»ºè®®</strong>ï¼ˆå‘å¸ƒæ—¶æ·»åŠ ï¼‰ï¼š<br/>
<code>#Java</code> <code>#æ³›å‹</code> <code>#ç¼–ç¨‹æŠ€å·§</code> <code>#ä»£ç è§„èŒƒ</code> <code>#æ–°æ‰‹å‹å¥½</code> <code>#å¹²è´§åˆ†äº«</code></p>
</blockquote>
<hr/>
<h3 data-id="heading-18">ğŸ–¼ï¸ é…å›¾æè¿°æ–‡æ¡ˆ</h3>
<h4 data-id="heading-19">å›¾1ï¼šã€æ··ä¹±å¿«é€’ç«™ vs æ™ºèƒ½åˆ†æ‹£ä¸­å¿ƒã€‘</h4>
<blockquote>
<p><strong>ç”»é¢æè¿°</strong>ï¼š<br/>
å·¦ä¾§ï¼šä¸€ä¸ªç ´æ—§ä»“åº“ï¼Œåœ°ä¸Šå †æ»¡æœªåˆ†ç±»çš„åŒ…è£¹ï¼Œæœ‰äººä»æ ‡ç€â€œé›¶é£Ÿâ€çš„ç®±å­æå‡ºé‹å­ã€é”®ç›˜ã€ç›†æ ½ï¼Œä¸€è„¸å´©æºƒã€‚<br/>
å³ä¾§ï¼šç°ä»£åŒ–åˆ†æ‹£ä¸­å¿ƒï¼Œä¼ é€å¸¦ä¸Šæ¯ä¸ªç®±å­è´´æœ‰æ¸…æ™°æ ‡ç­¾ï¼ˆ<code>&lt;String&gt;</code>ã€<code>&lt;Integer&gt;</code>ã€<code>&lt;Cat&gt;</code>ï¼‰ï¼Œæœºå™¨äººç²¾å‡†æŠ•é€’ã€‚<br/>
æ ‡è¯­ï¼šâ€œæ²¡æœ‰æ³›å‹ vs æœ‰æ³›å‹â€</p>
</blockquote>
<h4 data-id="heading-20">å›¾2ï¼šã€æ³›å‹ä¸‰å¤§åˆ†èº«è§’è‰²æ¼«ç”»ã€‘</h4>
<blockquote>
<p><strong>ç”»é¢æè¿°</strong>ï¼š</p>
<ul>
<li><strong>æ³›å‹ç±»</strong>ï¼šä¸€ä¸ªå¯å˜è‰²çš„æ”¶çº³ç›’ï¼Œæ ‡ç­¾å†™ç€ <code>&lt;T&gt;</code>ï¼Œé‡Œé¢åˆ†åˆ«è£…æ–‡å…·ã€é¦–é¥°ã€å°çŒ«ã€‚</li>
<li><strong>æ³›å‹æ¥å£</strong>ï¼šä¸€ä½ç©¿åˆ¶æœçš„å¿«é€’ä¸»ç®¡ï¼Œæ‰‹æŒè§„åˆ™ç‰Œï¼šâ€œMessageSenderï¼šå®¢æˆ·å®šç±»å‹ï¼Œæˆ‘æ¥é€ï¼â€</li>
<li><strong>æ³›å‹æ–¹æ³•</strong>ï¼šä¸€ä¸ªèƒŒç€å¤šä¸ªåŒ…è£¹çš„å¿«é€’å‘˜ï¼ŒåŒ…è£¹ä¸Šå†™ç€ <code>&lt;String&gt;</code>ã€<code>&lt;Integer&gt;</code>ï¼Œä»–ç¬‘ç€è¯´ï¼šâ€œæˆ‘å•¥éƒ½èƒ½é€ï¼â€</li>
</ul>
</blockquote>
<h4 data-id="heading-21">å›¾3ï¼šã€é€šé…ç¬¦å® ç‰©åŒ»é™¢æµç¨‹å›¾ã€‘</h4>
<blockquote>
<p><strong>ç”»é¢æè¿°</strong>ï¼š<br/>
ä¸€å®¶å® ç‰©åŒ»é™¢ï¼Œä¸‰ä¸ªè¯Šå®¤é—¨å£æŒ‚ç‰Œï¼š</p>
<ul>
<li>â€œğŸ± çŒ«ç§‘è¯Šå®¤ï¼ˆ<code>? extends Cat</code>ï¼‰â€ â†’ æ³¢æ–¯çŒ«ã€ç‹¸èŠ±çŒ«è¿›å…¥</li>
<li>â€œğŸ¶ çŠ¬ç§‘è¯Šå®¤ï¼ˆ<code>? extends Dog</code>ï¼‰â€ â†’ æ³°è¿ªã€å“ˆå£«å¥‡è¿›å…¥</li>
<li>â€œğŸ¾ ç»¼åˆè¯Šå®¤ï¼ˆ<code>? extends Animal</code>ï¼‰â€ â†’ æ‰€æœ‰åŠ¨ç‰©è¿›å…¥<br/>
ä¸€åªæ³°è¿ªè¯•å›¾è¿›çŒ«è¯Šå®¤ï¼Œè¢«ä¿å®‰æ‹¦ä¸‹ï¼šâ€œâŒ ä¸ç¬¦åˆç±»å‹è¾¹ç•Œï¼â€</li>
</ul>
</blockquote>
<hr/>
<p><strong>ä½œè€…</strong>ï¼šä¸€ä½ä¸æƒ³å†æ‹†å‡ºé‹å­çš„ Java å¼€å‘<br/>
<strong>å–œæ¬¢ï¼Ÿç‚¹èµ+æ”¶è—+å…³æ³¨ï¼Œä¸‹æœŸå¸¦ä½ ç©è½¬ Java Stream æµæ°´çº¿ï¼</strong> ğŸ’§</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€åŸºç¡€æ•°æ®ç¯‡ã€‘æ•°æ®æ ¼å¼åŒ–å¦†å¸ˆï¼šFormatteræ¨¡å¼]]></title>    <link>https://juejin.cn/post/7577691061033861166</link>    <guid>https://juejin.cn/post/7577691061033861166</guid>    <pubDate>2025-11-30T03:08:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577691061033861166" data-draft-id="7577971299742433318" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€åŸºç¡€æ•°æ®ç¯‡ã€‘æ•°æ®æ ¼å¼åŒ–å¦†å¸ˆï¼šFormatteræ¨¡å¼"/> <meta itemprop="keywords" content="åç«¯,è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2025-11-30T03:08:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç™½è¡£é¸½å­"/> <meta itemprop="url" content="https://juejin.cn/user/3072451409619223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€åŸºç¡€æ•°æ®ç¯‡ã€‘æ•°æ®æ ¼å¼åŒ–å¦†å¸ˆï¼šFormatteræ¨¡å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3072451409619223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç™½è¡£é¸½å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T03:08:07.000Z" title="Sun Nov 30 2025 03:08:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. å‰è¨€</h2>
<p>åœ¨è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œæ•°æ®å§‹ç»ˆå­˜åœ¨ä¸¤ç§å½¢æ€ï¼š<strong>å†…éƒ¨å­˜å‚¨å½¢æ€</strong>ä¸<strong>å¤–éƒ¨å±•ç¤ºå½¢æ€</strong>ã€‚</p>
<p>è¯•æƒ³ä¸€ä¸‹è¿™äº›åœºæ™¯ï¼š</p>
<ul>
<li>æ•°æ®åº“ä¸­å­˜å‚¨çš„æ—¶é—´æˆ³Â <code>1640995200000</code>ï¼Œåœ¨ç”¨æˆ·ç•Œé¢ä¸Šéœ€è¦æ˜¾ç¤ºä¸ºÂ <code>"2024å¹´1æœˆ1æ—¥"</code>ã€‚</li>
<li>å†…éƒ¨è®¡ç®—çš„é‡‘é¢Â <code>19.9</code>ï¼ˆæµ®ç‚¹æ•°ï¼‰ï¼Œåœ¨å‘ç¥¨ä¸Šéœ€è¦æ ¼å¼åŒ–ä¸ºÂ <code>"ï¿¥19.90"</code>ã€‚</li>
<li>ç”¨äºé€»è¾‘åˆ¤æ–­çš„æšä¸¾å€¼Â <code>UserStatus.ACTIVE</code>ï¼Œåœ¨æ—¥å¿—ä¸­éœ€è¦è¾“å‡ºä¸ºæ¸…æ™°çš„Â <code>"æ´»è·ƒç”¨æˆ·"</code></li>
</ul>
<p>å¦‚æœå°†è¿™äº›æ ¼å¼åŒ–é€»è¾‘æ•£è½ã€ç¡¬ç¼–ç åœ¨ä¸šåŠ¡ä»£ç çš„å„ä¸ªè§’è½ï¼Œä¼šå¯¼è‡´ä¸€ç³»åˆ—é—®é¢˜ï¼šä»£ç é‡å¤ã€éš¾ä»¥ç»´æŠ¤ã€æœ¬åœ°åŒ–æ”¯æŒå›°éš¾ï¼Œå¹¶ä¸”ç ´åäº†å•ä¸€èŒè´£åŸåˆ™â€”â€”ä¸šåŠ¡é€»è¾‘ç±»ä¸è¯¥å…³å¿ƒæ•°æ®è¯¥å¦‚ä½•æ˜¾ç¤ºã€‚</p>
<p><strong>Formatterï¼ˆæ ¼å¼åŒ–å™¨ï¼‰æ¨¡å¼</strong>æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜è€Œç”Ÿçš„ã€‚å®ƒæ‰®æ¼”ç€ä¸€ä½ä¸“ä¸šçš„â€œåŒ–å¦†å¸ˆâ€ï¼Œå°†æ•°æ®çš„â€œç´ é¢œâ€ï¼ˆå†…éƒ¨æ ¼å¼ï¼‰æ ¹æ®åœºæ™¯éœ€æ±‚ï¼Œä¼˜é›…åœ°è½¬æ¢ä¸ºå¾—ä½“çš„â€œå¦†å®¹â€ï¼ˆå¤–éƒ¨æ ¼å¼ï¼‰ï¼Œä»è€Œå®ç°æ•°æ®è¡¨ç°ä¸ä¸šåŠ¡é€»è¾‘çš„å½»åº•è§£è€¦ã€‚</p>
<h2 data-id="heading-1">2. å®šä¹‰</h2>
<p><strong>Formatter æ¨¡å¼</strong>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒæ—¨åœ¨å°†å¯¹è±¡çš„æ•°æ®è½¬æ¢ä¸ºå…¶é€‚åˆäººç±»é˜…è¯»æˆ–ç‰¹å®šåè®®ä¼ è¾“çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œå¹¶å°†å­—ç¬¦ä¸²è§£æå›å¯¹è±¡ã€‚è¯¥æ¨¡å¼çš„æ ¸å¿ƒæ˜¯å°†æ ¼å¼åŒ–ä¸è§£æçš„é€»è¾‘å°è£…åœ¨ä¸“ç”¨çš„å¯¹è±¡ä¸­ã€‚</p>
<p>è¯¥æ¨¡å¼é€šå¸¸æ¶‰åŠä¸¤ä¸ªæ ¸å¿ƒæ“ä½œï¼š</p>
<ol>
<li><strong>æ ¼å¼åŒ–ï¼š</strong>Â å°†å¯¹è±¡Â <code>T</code>Â è½¬æ¢ä¸ºå­—ç¬¦ä¸²Â <code>String</code>ã€‚</li>
<li><strong>è§£æï¼š</strong>Â å°†å­—ç¬¦ä¸²Â <code>String</code>Â è¿˜åŸä¸ºå¯¹è±¡Â <code>T</code>ã€‚</li>
</ol>
<pre><code class="hljs language-text" lang="text">æ ¸å¿ƒæ€æƒ³ï¼šÂ Formatter æ¨¡å¼çš„ç²¾é«“åœ¨äºåˆ†ç¦»å…³æ³¨ç‚¹ã€‚å®ƒæ‰¿è®¤â€œæ•°æ®æ˜¯ä»€ä¹ˆâ€å’Œâ€œæ•°æ®å¦‚ä½•å±•ç¤ºâ€æ˜¯ä¸¤ä¸ªæˆªç„¶ä¸åŒçš„é—®é¢˜ã€‚é€šè¿‡å¼•å…¥ä¸€ä¸ªä¸“é—¨çš„æ ¼å¼åŒ–å™¨è§’è‰²ï¼š
1. é¢†åŸŸå¯¹è±¡å¯ä»¥ä¿æŒçº¯å‡€ï¼Œåªå…³æ³¨è‡ªèº«çš„ä¸šåŠ¡å±æ€§å’Œè¡Œä¸ºã€‚
2. æ ¼å¼åŒ–é€»è¾‘è¢«é›†ä¸­ç®¡ç†å’Œå¤ç”¨ï¼Œæ˜“äºç»Ÿä¸€ä¿®æ”¹å’Œæ‰©å±•ã€‚
3. å®¢æˆ·ç«¯ä»£ç æ— éœ€å…³å¿ƒæ ¼å¼åŒ–çš„ç»†èŠ‚ï¼Œåªéœ€å§”æ‰˜ç»™åˆé€‚çš„æ ¼å¼åŒ–å™¨å³å¯ã€‚
</code></pre>
<h2 data-id="heading-2">3. åº”ç”¨</h2>
<p>Formatter æ¨¡å¼çš„åº”ç”¨åœºæ™¯æ— å¤„ä¸åœ¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ä¸ç”¨æˆ·äº¤äº’æˆ–è¿›è¡Œç³»ç»Ÿé—´é€šä¿¡çš„åœ°æ–¹ã€‚</p>
<h3 data-id="heading-3">3.1 åœºæ™¯ä¸€ï¼šæ—¥æœŸæ—¶é—´æ ¼å¼åŒ–</h3>
<p>è¿™æ˜¯æœ€ç»å…¸çš„åº”ç”¨ã€‚æ ¹æ®ç”¨æˆ·æ‰€åœ¨çš„åœ°åŒºæ˜¾ç¤ºä¸åŒæ ¼å¼çš„æ—¥æœŸã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å†…éƒ¨ç»Ÿä¸€ä½¿ç”¨ java.time å¯¹è±¡</span>
<span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();

<span class="hljs-comment">// åº”ç”¨ä¸åŒçš„â€œåŒ–å¦†å¸ˆâ€</span>
<span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">chinaFormatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyyå¹´MMæœˆddæ—¥ HH:mm:ss"</span>, Locale.CHINA);
<span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">usFormatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"MM/dd/yyyy hh:mm a"</span>, Locale.US);

<span class="hljs-type">String</span> <span class="hljs-variable">dateForChina</span> <span class="hljs-operator">=</span> now.format(chinaFormatter); <span class="hljs-comment">// "2024å¹´01æœˆ01æ—¥ 14:30:00"</span>
<span class="hljs-type">String</span> <span class="hljs-variable">dateForUS</span> <span class="hljs-operator">=</span> now.format(usFormatter);       <span class="hljs-comment">// "01/01/2024 02:30 PM"</span>
</code></pre>
<h3 data-id="heading-4">3.2 åœºæ™¯äºŒï¼šæ•°å­—ä¸è´§å¸æ ¼å¼åŒ–</h3>
<p>è‡ªåŠ¨å¤„ç†åƒåˆ†ä½ã€å°æ•°ä½æ•°å’Œè´§å¸ç¬¦å·ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">double</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-number">12345.6789</span>;

<span class="hljs-type">NumberFormat</span> <span class="hljs-variable">numberFormat</span> <span class="hljs-operator">=</span> NumberFormat.getNumberInstance(Locale.GERMANY);
<span class="hljs-type">String</span> <span class="hljs-variable">formattedNumber</span> <span class="hljs-operator">=</span> numberFormat.format(price); <span class="hljs-comment">// "12.345,679" - å¾·å›½ä½¿ç”¨ç‚¹ä½œä¸ºåƒåˆ†ä½ï¼Œé€—å·ä½œä¸ºå°æ•°ç‚¹</span>

<span class="hljs-type">NumberFormat</span> <span class="hljs-variable">currencyFormat</span> <span class="hljs-operator">=</span> NumberFormat.getCurrencyInstance(Locale.CHINA);
<span class="hljs-type">String</span> <span class="hljs-variable">formattedCurrency</span> <span class="hljs-operator">=</span> currencyFormat.format(price); <span class="hljs-comment">// "ï¿¥12,345.68" - è‡ªåŠ¨å››èˆäº”å…¥åˆ°ä¸¤ä½å°æ•°å¹¶æ·»åŠ è´§å¸ç¬¦å·</span>
</code></pre>
<h3 data-id="heading-5">3.3 åœºæ™¯ä¸‰ï¼šè‡ªå®šä¹‰å¯¹è±¡æ ¼å¼åŒ–</h3>
<p>ä¸ºé¢†åŸŸå¯¹è±¡å®šä¹‰ä¸“ç”¨çš„æ ¼å¼åŒ–å™¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> BigDecimal price;
    <span class="hljs-comment">// ... getters</span>
}

<span class="hljs-comment">// è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductFormatter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Formatter</span>&lt;Product&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">print</span><span class="hljs-params">(Product product, Locale locale)</span> {
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s - %s"</span>, 
            product.getName(), 
            NumberFormat.getCurrencyInstance(locale).format(product.getPrice()));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">parse</span><span class="hljs-params">(String text, Locale locale)</span> <span class="hljs-keyword">throws</span> ParseException {
        <span class="hljs-comment">// å®ç°ä»å­—ç¬¦ä¸²è§£æå›Productå¯¹è±¡çš„é€»è¾‘</span>
        <span class="hljs-comment">// ... </span>
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-string">"ç¬”è®°æœ¬ç”µè„‘"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"5999.99"</span>));
<span class="hljs-type">ProductFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductFormatter</span>();
<span class="hljs-type">String</span> <span class="hljs-variable">displayText</span> <span class="hljs-operator">=</span> formatter.print(product, Locale.CHINA); <span class="hljs-comment">// "ç¬”è®°æœ¬ç”µè„‘ - ï¿¥5,999.99"</span>
</code></pre>
<h2 data-id="heading-6">4. å¼€æºä»£ç è§£æ</h2>
<p>Formatter æ¨¡å¼åœ¨ä¼—å¤šå¼€æºæ¡†æ¶ä¸­æœ‰ç€è‡³å…³é‡è¦ä¸”ä¼˜é›…çš„å®ç°ã€‚</p>
<h3 data-id="heading-7">4.1 <code>DateTimeFormatter</code>ï¼šæ—¶é—´æ ¼å¼åŒ–æ ‡å‡†å®ç°</h3>
<p>Java 8 å¼•å…¥çš„æ—¥æœŸæ—¶é—´ API æ˜¯ Formatter æ¨¡å¼çš„å…¸èŒƒï¼Œ<code>DateTimeFormatter</code>Â çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡ï¼Œå®ƒé€šè¿‡ç»„åˆæ¨¡å¼å°†æ ¼å¼åŒ–çš„æ­¥éª¤åˆ†è§£ä¸ºä¸åŒçš„èŒè´£å•å…ƒã€‚</p>
<hr/>
<p><code>DateTimeFormatter</code>Â çš„æ ¸å¿ƒçŠ¶æ€ç”±ä»¥ä¸‹å‡ ä¸ªÂ <code>final</code>Â å˜é‡å®šä¹‰ï¼Œç¡®ä¿äº†å…¶ä¸å¯å˜æ€§å’Œçº¿ç¨‹å®‰å…¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeFormatter</span> {
	<span class="hljs-comment">// 1. æ ¼å¼/è§£æå¼•æ“ï¼šæ‰¿è½½äº†æ¨¡å¼å­—ç¬¦ä¸²ç¼–è¯‘åçš„æŒ‡ä»¤é›†ï¼Œæ˜¯æ‰§è¡Œæ ¼å¼åŒ–å’Œè§£ææ“ä½œçš„æ ¸å¿ƒã€‚</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CompositePrinterParser printerParser;
	
	<span class="hljs-comment">// 2. åœ°åŸŸä¿¡æ¯ï¼šæ§åˆ¶æ–‡æœ¬ï¼ˆå¦‚æœˆä»½ã€æ˜ŸæœŸï¼‰çš„æ˜¾ç¤ºè¯­è¨€å’Œåœ°åŒºç›¸å…³çš„è®¡ç®—è§„åˆ™ï¼ˆå¦‚ä¸€å‘¨çš„ç¬¬ä¸€å¤©ï¼‰ã€‚</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Locale locale;
	
	<span class="hljs-comment">// 3. æ•°å­—æ ·å¼ï¼šæ§åˆ¶æ•°å­—ç›¸å…³ç¬¦å·ï¼Œå¦‚å°æ•°ç‚¹ã€æ­£è´Ÿå·ç­‰ã€‚</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DecimalStyle decimalStyle;
	
	<span class="hljs-comment">// 4. è§£æé£æ ¼ï¼šå†³å®šè§£ææ—¶çš„ä¸¥æ ¼ç¨‹åº¦ï¼Œå¦‚STRICTï¼ˆä¸¥æ ¼ï¼‰ã€SMARTï¼ˆæ™ºèƒ½è°ƒæ•´ï¼‰ã€LENIENTï¼ˆå®½æ¾è®¡ç®—ï¼‰ã€‚</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ResolverStyle resolverStyle;
	
	<span class="hljs-comment">// 5. éœ€è§£æå­—æ®µé›†ï¼šç”¨äºä¼˜åŒ–æ€§èƒ½ï¼ŒæŒ‡å®šéœ€è¦è§£æå’ŒéªŒè¯çš„å­—æ®µé›†åˆï¼›ä¸ºnullæ—¶è¡¨ç¤ºå¤„ç†æ‰€æœ‰å­—æ®µã€‚</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;TemporalField&gt; resolverFields;
	
	<span class="hljs-comment">// 6. å¹´è¡¨ï¼ˆå†æ³•ï¼‰ï¼šå®šä¹‰æ—¥æœŸèƒŒåçš„æ—¥å†ç³»ç»Ÿï¼Œå¦‚ISOã€ThaiBuddhistç­‰ï¼›ä¸ºnullæ—¶ä½¿ç”¨é»˜è®¤ISOå†æ³•ã€‚</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Chronology chrono;
	
	<span class="hljs-comment">// 7. é»˜è®¤æ—¶åŒºï¼šå½“è¢«æ ¼å¼åŒ–çš„å¯¹è±¡ä¸å«æ—¶åŒºä¿¡æ¯æ—¶ï¼Œä½¿ç”¨æ­¤æ—¶åŒºè¿›è¡Œè¡¥å……ï¼›ä¸ºnullåˆ™è¡¨ç¤ºä¸è¦†ç›–ã€‚</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ZoneId zone;
}
</code></pre>
<hr/>
<p><strong>ç¬¬ä¸€æ­¥ï¼šå…¥å£æ–¹æ³•Â <code>format(TemporalAccessor temporal)</code></strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**  
 * Formats a date-time object using this formatter. 
 * This formats the date-time to a String using the rules of the formatter. 
 * <span class="hljs-doctag">@param</span> temporal  the temporal object to format, not null  
 * <span class="hljs-doctag">@return</span> the formatted string, not null 
 * <span class="hljs-doctag">@throws</span> DateTimeException if an error occurs during formatting  
 */</span><span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(TemporalAccessor temporal)</span> {  
    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-number">32</span>);  
    formatTo(temporal, buf);  
    <span class="hljs-keyword">return</span> buf.toString();  
}
</code></pre>
<ul>
<li><strong>ç›®çš„</strong>ï¼šæä¾›æœ€ç®€æ´çš„APIï¼Œæ¥å—ä¸€ä¸ªæ—¥æœŸæ—¶é—´å¯¹è±¡ï¼Œè¿”å›æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ã€‚</li>
<li><strong>åŠ¨ä½œ</strong>ï¼šåˆ›å»ºä¸€ä¸ªÂ <code>StringBuilder</code>Â ä½œä¸ºç»“æœå®¹å™¨ï¼Œç„¶åè°ƒç”¨é‡è½½çš„Â <code>formatTo</code>Â æ–¹æ³•ã€‚</li>
</ul>
<hr/>
<p><strong>ç¬¬äºŒæ­¥ï¼šå‡†å¤‡ä¸Šä¸‹æ–‡Â <code>formatTo(TemporalAccessor temporal, Appendable appendable)</code></strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**  
 * Formats a date-time object to an {<span class="hljs-doctag">@code</span> Appendable} using this formatter. 
 * This outputs the formatted date-time to the specified destination. 
 * {<span class="hljs-doctag">@link</span> Appendable} is a general purpose interface that is implemented by all  
 * key character output classes including {<span class="hljs-doctag">@code</span> StringBuffer}, {<span class="hljs-doctag">@code</span> StringBuilder}, 
 * {<span class="hljs-doctag">@code</span> PrintStream} and {<span class="hljs-doctag">@code</span> Writer}. 
 * Although {<span class="hljs-doctag">@code</span> Appendable} methods throw an {<span class="hljs-doctag">@code</span> IOException}, this method does not. 
 * Instead, any {<span class="hljs-doctag">@code</span> IOException} is wrapped in a runtime exception. 
 * <span class="hljs-doctag">@param</span> temporal  the temporal object to format, not null  
 * <span class="hljs-doctag">@param</span> appendable  the appendable to format to, not null  
 * <span class="hljs-doctag">@throws</span> DateTimeException if an error occurs during formatting  
 */</span>
 <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">formatTo</span><span class="hljs-params">(TemporalAccessor temporal, Appendable appendable)</span> {  
    Objects.requireNonNull(temporal, <span class="hljs-string">"temporal"</span>);  
    Objects.requireNonNull(appendable, <span class="hljs-string">"appendable"</span>);  
    <span class="hljs-keyword">try</span> {  
        <span class="hljs-type">DateTimePrintContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTimePrintContext</span>(temporal, <span class="hljs-built_in">this</span>);  
        <span class="hljs-keyword">if</span> (appendable <span class="hljs-keyword">instanceof</span> StringBuilder) {  
            printerParser.format(context, (StringBuilder) appendable);  
        } <span class="hljs-keyword">else</span> {  
            <span class="hljs-comment">// buffer output to avoid writing to appendable in case of error  </span>
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-number">32</span>);  
            printerParser.format(context, buf);  
            appendable.append(buf);  
        }  
    } <span class="hljs-keyword">catch</span> (IOException ex) {  
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTimeException</span>(ex.getMessage(), ex);  
    }  
}
</code></pre>
<ul>
<li><strong>ç›®çš„</strong>ï¼šåˆå§‹åŒ–æ ¼å¼åŒ–æ“ä½œæ‰€éœ€çš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚</li>
<li><strong>åŠ¨ä½œ</strong>ï¼šåˆ›å»ºÂ <code>DateTimePrintContext</code>Â å¯¹è±¡
<ul>
<li>è¦æ ¼å¼åŒ–çš„ç›®æ ‡å¯¹è±¡ (<code>temporal</code>)</li>
<li>å½“å‰æ ¼å¼åŒ–å™¨ (<code>this</code>) çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚Â <code>locale</code>,Â <code>decimalStyle</code>Â ç­‰ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šå¼•æ“æ‰§è¡ŒÂ <code>printerParser.format(context, appendable)</code></strong></p>
<p>è¿™é‡Œçš„Â <code>printerParser</code>Â æ˜¯Â <code>CompositePrinterParser</code>Â çš„ä¸€ä¸ªå®ä¾‹ã€‚</p>
<p><strong><code>CompositePrinterParser</code>Â æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompositePrinterParser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DateTimePrinterParser</span> {  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DateTimePrinterParser[] printerParsers;  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> optional;
}
</code></pre>
<p>å½“ä½¿ç”¨Â <code>DateTimeFormatter.ofPattern("yyyy-MM-dd")</code>Â æ—¶ï¼Œè¿™ä¸ªæ¨¡å¼å­—ç¬¦ä¸²ä¼šè¢«è§£æå¹¶ç¼–è¯‘æˆä¸‰ä¸ªå­å¤„ç†å™¨ï¼ˆ<code>PrinterParser</code>ï¼‰ï¼š</p>
<ol>
<li>ä¸€ä¸ªç”¨äºå¤„ç†4ä½å¹´ä»½çš„Â <code>NumberPrinterParser</code></li>
<li>ä¸€ä¸ªç”¨äºè¾“å‡ºå­—é¢é‡Â <code>'-'</code>Â çš„Â <code>StringLiteralPrinterParser</code></li>
<li>ä¸€ä¸ªç”¨äºå¤„ç†2ä½æœˆä»½çš„Â <code>NumberPrinterParser</code>Â ... ä»¥æ­¤ç±»æ¨ã€‚</li>
</ol>
<p><strong><code>format</code>Â æ–¹æ³•åœ¨ç»„åˆå¤„ç†å™¨å†…éƒ¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">format</span><span class="hljs-params">(DateTimePrintContext context, StringBuilder buf)</span> {  
    <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> buf.length();  
    <span class="hljs-keyword">if</span> (optional) {  
        context.startOptional();  
    }  
    <span class="hljs-keyword">try</span> {  
        <span class="hljs-keyword">for</span> (DateTimePrinterParser pp : printerParsers) {  
            <span class="hljs-keyword">if</span> (pp.format(context, buf) == <span class="hljs-literal">false</span>) {  
                buf.setLength(length);  <span class="hljs-comment">// reset buffer  </span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  
            }  
        }  
    } <span class="hljs-keyword">finally</span> {  
        <span class="hljs-keyword">if</span> (optional) {  
            context.endOptional();  
        }  
    }  
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  
}
</code></pre>
<ul>
<li><strong>ç›®çš„</strong>ï¼šæŒ‰é¡ºåºæ‰§è¡Œç»„åˆå¤„ç†å™¨ï¼ˆ<code>CompositePrinterParser</code>ï¼‰ä¸­çš„æ‰€æœ‰å­å¤„ç†å™¨ï¼ˆ<code>printerParsers</code>ï¼‰ï¼Œå¹¶ç¡®ä¿åœ¨é‡åˆ°å¤±è´¥æ—¶ï¼Œå¦‚æœè¯¥ç»„åˆæ˜¯ä¸€ä¸ªå¯é€‰èŠ‚ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°å›æ»šçŠ¶æ€ï¼Œé¿å…è¾“å‡ºéƒ¨åˆ†ç»“æœã€‚</li>
<li><strong>è¡¥å……</strong>ï¼šå¦‚æœè¿™ä¸ªÂ <code>CompositePrinterParser</code>Â è¢«æ ‡è®°ä¸ºÂ <code>optional</code>ï¼ˆä¾‹å¦‚ï¼Œç”±Â <code>DateTimeFormatterBuilder.optionalStart()</code>Â åˆ›å»ºï¼‰ï¼Œåˆ™é€šçŸ¥æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼ˆ<code>DateTimePrintContext</code>ï¼‰å¼€å§‹ä¸€ä¸ªå¯é€‰èŠ‚ã€‚åœ¨â€œå¯é€‰èŠ‚â€å†…ï¼Œ<code>pp.format(context, buf)</code>è¿™æ®µä»£ç å½“ä»Â <code>TemporalAccessor</code>Â æŸ¥è¯¢å­—æ®µå€¼æ—¶ï¼Œå¦‚æœè¯¥å­—æ®µä¸å­˜åœ¨ï¼Œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªâ€œå¤±è´¥â€çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä¸ºåç»­çš„å›æ»šåˆ¤æ–­æä¾›äº†ä¾æ®ã€‚</li>
</ul>
<hr/>
<p><strong>ç¬¬å››æ­¥ï¼šç»“åˆä»£ç ç¤ºä¾‹å›é¡¾ä¸Šé¢çš„æµç¨‹</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. åˆ›å»ºä¸€ä¸ªåŒ…å«å¯é€‰èŠ‚çš„æ ¼å¼åŒ–å™¨</span>
<span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM['XX']"</span>);
<span class="hljs-comment">// 2. æ ¼å¼åŒ–ä¸€ä¸ªLocalDateï¼ˆæ²¡æœ‰"XX"éœ€è¦çš„æ•°æ®ï¼‰</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> formatter.format(LocalDate.of(<span class="hljs-number">2024</span>, <span class="hljs-number">5</span>, <span class="hljs-number">24</span>));
System.out.println(result); <span class="hljs-comment">// è¾“å‡º: 2024-05</span>
</code></pre>
<ol>
<li>åˆå§‹åŒ–Â <code>printerParsers</code>Â åˆ—è¡¨Â æ¨¡å¼Â <code>"yyyy-MM['XX']"</code>Â è¢«ç¼–è¯‘æˆå¦‚ä¸‹ç»“æ„ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java">printerParsers = [
    NumberPrinterParser(YEAR),    <span class="hljs-comment">// å¤„ç† yyyy</span>
    StringLiteralPrinterParser(<span class="hljs-string">"-"</span>), <span class="hljs-comment">// å¤„ç† -</span>
    NumberPrinterParser(MONTH),   <span class="hljs-comment">// å¤„ç† MM</span>
    CompositePrinterParser([      <span class="hljs-comment">// å¤„ç† ['XX']ï¼Œæ ‡è®°ä¸º optional=true</span>
        StringLiteralPrinterParser(<span class="hljs-string">"XX"</span>)
    ], optional=<span class="hljs-literal">true</span>)
]
</code></pre>
<ol start="2">
<li>æ ¼å¼åŒ–æ‰§è¡Œè¿‡ç¨‹
<ul>
<li>å‰ä¸‰ä¸ªå¤„ç†å™¨æ­£å¸¸æ‰§è¡Œï¼Œ<code>buf</code>Â å˜ä¸ºÂ <code>"2024-05"</code>ã€‚</li>
<li>æ‰§è¡Œå¯é€‰èŠ‚Â <code>['XX']</code>ï¼š
<ul>
<li>è®°å½•èµ·ç‚¹ï¼š<code>length = 8</code>ï¼ˆ"2024-05"çš„é•¿åº¦ï¼‰</li>
<li>æ‰§è¡Œå­å¤„ç†å™¨Â <code>StringLiteralPrinterParser("XX")</code>ï¼š
<ul>
<li>ç›´æ¥å‘Â <code>buf</code>Â è¿½åŠ Â <code>"XX"</code>ï¼Œ<code>buf</code>Â å˜ä¸ºÂ <code>"2024-05XX"</code></li>
<li>è¿”å›Â <code>true</code></li>
</ul>
</li>
</ul>
</li>
<li>å¾ªç¯ç»“æŸï¼Œè¿”å›Â <code>true</code></li>
</ul>
</li>
<li>æœ€ç»ˆç»“æœï¼š<code>"2024-05XX"</code></li>
</ol>
<h3 data-id="heading-8">4.2 <code>PatternLayout</code>ï¼š æ—¥å¿—ç³»ç»Ÿä¸­çš„Formatter</h3>
<p>åœ¨ä¸»æµæ—¥å¿—æ¡†æ¶ï¼ˆå¦‚ Logbackã€Log4j 2ï¼‰ä¸­ï¼Œè´Ÿè´£æ ¼å¼åŒ–çš„ç»„ä»¶ä¸å«Â <code>Formatter</code>ï¼Œè€Œå«Â <code>Layout</code>Â æˆ–Â <code>Formatter</code>ï¼Œå®ƒçš„èŒè´£å°±æ˜¯å°†ä¸€ä¸ªæ—¥å¿—äº‹ä»¶ï¼ˆLog Eventï¼‰è½¬æ¢æˆä¸€æ¡å…·ä½“çš„æ—¥å¿—å­—ç¬¦ä¸²ã€‚</p>
<hr/>
<p><strong>ç¬¬ä¸€æ­¥ï¼šSLF4Jä½¿ç”¨æ–¹å¼</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å…¸å‹çš„SLF4Jä½¿ç”¨æ–¹å¼</span>
logger.info(<span class="hljs-string">"è®¢å•{}åˆ›å»ºæˆåŠŸï¼Œé‡‘é¢ï¼š{}"</span>, orderId, amount);
</code></pre>
<p><code>logger.info(String format, Object arg1, Object arg2)</code>Â -&gt; å®é™…è°ƒç”¨çš„æ˜¯åº•å±‚å®ç°ï¼ˆå¦‚ Logbackï¼‰çš„Â <code>Logger</code>Â å®ç°ç±»ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼ŒSLF4J çš„é—¨é¢å±‚ä¼šå…ˆè¿›è¡Œä¸€ä¸ªå…³é”®é¢„å¤„ç†ï¼š<strong>æ¶ˆæ¯æ ¼å¼åŒ–</strong>ã€‚</p>
<hr/>
<p><strong>ç¬¬äºŒæ­¥ï¼šSLF4J çš„å‚æ•°åŒ–æ¶ˆæ¯æ ¼å¼åŒ–</strong></p>
<p>SLF4J ä¸ä¼šç›´æ¥å°†åŸå§‹æ¶ˆæ¯å’Œå‚æ•°ä¼ é€’ç»™åº•å±‚å®ç°ã€‚å®ƒé¦–å…ˆä½¿ç”¨Â <code>org.slf4j.helpers.MessageFormatter</code>Â æ¥å°†æ¨¡æ¿å’Œå‚æ•°åˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åœ¨ Logback çš„ Logger å®ç°ä¸­ï¼ˆå¦‚ ch.qos.logback.classic.Loggerï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">info</span><span class="hljs-params">(String format, Object arg1, Object arg2)</span> {
    <span class="hljs-keyword">if</span> (!isInfoEnabled()) <span class="hljs-keyword">return</span>;
    <span class="hljs-comment">// å…³é”®è°ƒç”¨ï¼šæ ¼å¼åŒ–æ¶ˆæ¯</span>
    <span class="hljs-type">FormattingTuple</span> <span class="hljs-variable">ft</span> <span class="hljs-operator">=</span> MessageFormatter.arrayFormat(format, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{arg1, arg2});
    <span class="hljs-comment">// ç„¶åè°ƒç”¨è¿‡æ»¤ã€è¿½åŠ ç­‰æ ¸å¿ƒé€»è¾‘</span>
    filterAndLog_0_Or3Plus(<span class="hljs-literal">null</span>, Level.INFO, <span class="hljs-literal">null</span>, ft.getMessage(), ft.getThrowable());
}
</code></pre>
<p>Â <code>MessageFormatter.arrayFormat</code>ï¼šè¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒæ˜¯å¾ªç¯å¤„ç†æ¯ä¸ªÂ <code>{}</code>Â å ä½ç¬¦ï¼Œå¹¶å°†å¯¹åº”çš„å‚æ•°å€¼â€œæ ¼å¼åŒ–â€æˆå­—ç¬¦ä¸²åæ›¿æ¢è¿›å»ã€‚è¿™é‡Œçš„â€œæ ¼å¼åŒ–â€éå¸¸æœ´ç´ ï¼šå¯¹äºéç©ºå‚æ•°ï¼Œç›´æ¥è°ƒç”¨å…¶Â <code>toString()</code>Â æ–¹æ³•ã€‚<code>orderId</code>Â å’ŒÂ <code>amount</code>Â çš„Â <code>toString()</code>Â æ–¹æ³•è¢«è°ƒç”¨ï¼Œç»“æœè¢«æ‹¼æ¥åˆ°å­—ç¬¦ä¸²ä¸­ã€‚</p>
<pre><code class="hljs language-java" lang="java">Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> FormattingTuple <span class="hljs-title function_">arrayFormat</span><span class="hljs-params">(String messagePattern, Object[] argArray)</span> {  
    <span class="hljs-type">Throwable</span> <span class="hljs-variable">throwableCandidate</span> <span class="hljs-operator">=</span> getThrowableCandidate(argArray);  
    Object[] args = argArray;  
    <span class="hljs-keyword">if</span> (throwableCandidate != <span class="hljs-literal">null</span>) {  
        args = trimmedCopy(argArray);  
    }  
  
    <span class="hljs-keyword">return</span> arrayFormat(messagePattern, args, throwableCandidate);  
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> FormattingTuple <span class="hljs-title function_">arrayFormat</span><span class="hljs-params">(String messagePattern, Object[] argArray, Throwable throwable)</span> {  
    <span class="hljs-keyword">if</span> (messagePattern == <span class="hljs-literal">null</span>) {  
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormattingTuple</span>((String)<span class="hljs-literal">null</span>, argArray, throwable);  
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (argArray == <span class="hljs-literal">null</span>) {  
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormattingTuple</span>(messagePattern);  
    } <span class="hljs-keyword">else</span> {  
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sbuf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(messagePattern.length() + <span class="hljs-number">50</span>);  
  
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">L</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; L &lt; argArray.length; ++L) {  
            <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> messagePattern.indexOf(<span class="hljs-string">"{}"</span>, i);  
            <span class="hljs-keyword">if</span> (j == -<span class="hljs-number">1</span>) {  
                <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) {  
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormattingTuple</span>(messagePattern, argArray, throwable);  
                }  
  
                sbuf.append(messagePattern, i, messagePattern.length());  
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormattingTuple</span>(sbuf.toString(), argArray, throwable);  
            }  
  
            <span class="hljs-keyword">if</span> (isEscapedDelimeter(messagePattern, j)) {  
                <span class="hljs-keyword">if</span> (!isDoubleEscaped(messagePattern, j)) {  
                    --L;  
                    sbuf.append(messagePattern, i, j - <span class="hljs-number">1</span>);  
                    sbuf.append(<span class="hljs-string">'{'</span>);  
                    i = j + <span class="hljs-number">1</span>;  
                } <span class="hljs-keyword">else</span> {  
                    sbuf.append(messagePattern, i, j - <span class="hljs-number">1</span>);  
                    deeplyAppendParameter(sbuf, argArray[L], <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>());  
                    i = j + <span class="hljs-number">2</span>;  
                }  
            } <span class="hljs-keyword">else</span> {  
                sbuf.append(messagePattern, i, j);  
                deeplyAppendParameter(sbuf, argArray[L], <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>());  
                i = j + <span class="hljs-number">2</span>;  
            }  
        }  
  
        sbuf.append(messagePattern, i, messagePattern.length());  
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormattingTuple</span>(sbuf.toString(), argArray, throwable);  
    }  
}
</code></pre>
<hr/>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šæ„å»ºæ—¥å¿—äº‹ä»¶ (<code>ILoggingEvent</code>) å¹¶äº¤ç”± Logback çš„Â <code>Layout</code></strong></p>
<p>ç¬¬äºŒæ­¥ç»“æŸæ—¶ï¼Œæˆ‘ä»¬åœåœ¨äº† Logback çš„Â <code>Logger</code>Â å®ç°ç±»ä¸­çš„Â <code>filterAndLog_0_Or3Plus</code>Â æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å®ƒæœ¬è´¨ä¸Šæ˜¯æ—¥å¿—è®°å½•çš„æ ¸å¿ƒè·¯ç”±æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åœ¨ ch.qos.logback.classic.Logger ä¸­</span>
<span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªå¤„ç†æ—¥å¿—äº‹ä»¶çš„æ ¸å¿ƒæ–¹æ³•</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">filterAndLog_0_Or3Plus</span><span class="hljs-params">(String localFQCN, Level level, Marker marker, String msg, Object[] params, Throwable t)</span> {

    <span class="hljs-comment">// æ£€æŸ¥è¿‡æ»¤å™¨é“¾ï¼Œå¦‚æœè¢«æ‹’ç»åˆ™ç›´æ¥è¿”å›</span>
    <span class="hljs-type">FilterReply</span> <span class="hljs-variable">decision</span> <span class="hljs-operator">=</span> loggerContext.getTurboFilterChainDecision_0_3OrMore(marker, <span class="hljs-built_in">this</span>, level, msg, params, t);
    <span class="hljs-keyword">if</span> (decision == FilterReply.DENY) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// æœ€å…³é”®çš„ä¸€è¡Œï¼šæ„å»ºæ—¥å¿—äº‹ä»¶ (ILoggingEvent)</span>
    <span class="hljs-type">LoggingEvent</span> <span class="hljs-variable">loggingEvent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingEvent</span>(localFQCN, <span class="hljs-built_in">this</span>, level, msg, t, params);

    <span class="hljs-comment">// ç»§ç»­åç»­çš„æ—¥å¿—è®°å½•æµç¨‹</span>
    <span class="hljs-keyword">if</span> (decision != FilterReply.NEUTRAL) {
        <span class="hljs-comment">// å¦‚æœè¿‡æ»¤å™¨æ˜ç¡®æ¥å—ï¼Œåˆ™ç›´æ¥è®°å½•ï¼Œè·³è¿‡çº§åˆ«æ£€æŸ¥</span>
        log(<span class="hljs-literal">null</span>, localFQCN, level, marker, msg, params, t);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å¦åˆ™ï¼Œè¿›è¡Œå¸¸è§„çš„çº§åˆ«æ£€æŸ¥åè®°å½•</span>
        <span class="hljs-keyword">if</span> (isEnabledFor(level, marker)) {
            log(loggingEvent, localFQCN, level, marker, msg, params, t);
        }
    }
}
</code></pre>
<p>åœ¨æ„å»ºÂ <code>LoggingEvent</code>Â æ—¶ï¼Œå®ƒå­˜å‚¨çš„æ˜¯<strong>åŸå§‹çš„ã€æœªæ ¼å¼åŒ–çš„æ¶ˆæ¯æ¨¡æ¿</strong>Â (<code>message</code>) å’Œ<strong>å‚æ•°æ•°ç»„</strong>Â (<code>argArray</code>)ï¼Œè€Œä¸æ˜¯ç¬¬äºŒæ­¥ä¸­Â <code>MessageFormatter</code>Â ç”Ÿæˆçš„é‚£ä¸ªå®Œæ•´å­—ç¬¦ä¸²ã€‚åœ¨Â <code>LoggingEvent</code>Â ç±»ä¸­ï¼Œæœ‰ä¸€ä¸ªÂ <code>getFormattedMessage()</code>Â æ–¹æ³•ï¼Œå¯ä»¥å®ç°å»¶è¿Ÿè®¡ç®—è·å–æ¶ˆæ¯çš„é€»è¾‘ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åœ¨ ch.qos.logback.classic.LoggingEvent ä¸­</span>
<span class="hljs-keyword">public</span> <span class="hljs-title function_">LoggingEvent</span><span class="hljs-params">(String fqcn, Logger logger, Level level, String message, Throwable throwable, Object[] argArray)</span> {
    <span class="hljs-built_in">this</span>.fqcn = fqcn;
    <span class="hljs-built_in">this</span>.logger = logger;
    <span class="hljs-built_in">this</span>.level = level;
    <span class="hljs-built_in">this</span>.message = message;   <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œå­˜çš„æ˜¯åŸå§‹æ¶ˆæ¯æ¨¡æ¿ "è®¢å•{}åˆ›å»ºæˆåŠŸï¼Œé‡‘é¢ï¼š{}"</span>
    <span class="hljs-built_in">this</span>.throwable = throwable;
    <span class="hljs-built_in">this</span>.argArray = argArray; <span class="hljs-comment">// ä»¥åŠå‚æ•°æ•°ç»„ [orderId, amount]</span>
    <span class="hljs-built_in">this</span>.timeStamp = System.currentTimeMillis(); <span class="hljs-comment">// è®°å½•æ—¶é—´æˆ³</span>
    <span class="hljs-built_in">this</span>.threadName = Thread.currentThread().getName(); <span class="hljs-comment">// è®°å½•çº¿ç¨‹å</span>
    <span class="hljs-comment">// ... å…¶ä»–åˆå§‹åŒ–</span>
}
</code></pre>
<hr/>
<p><strong>ç¬¬å››æ­¥ï¼š<code>Layout</code>Â çš„æ ¼å¼åŒ– (<code>PatternLayout.doLayout</code>)</strong></p>
<p><code>Layout</code>ï¼ˆé€šå¸¸æ˜¯Â <code>PatternLayout</code>ï¼‰çš„èŒè´£æ˜¯å°†æ•´ä¸ªÂ <code>ILoggingEvent</code>Â å¯¹è±¡æ ¼å¼æˆä¸€æ•´è¡Œæœ‰ç‰¹å®šæ ¼å¼çš„æ—¥å¿—å­—ç¬¦ä¸²ã€‚å‡è®¾é…ç½®çš„æ¨¡å¼æ˜¯ï¼š<code>%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger - %msg%n</code></p>
<p><strong><code>PatternLayout</code>Â çš„å·¥ä½œæµç¨‹ï¼š</strong></p>
<ol>
<li><strong>è§£ææ¨¡å¼å­—ç¬¦ä¸²</strong>ï¼šå°†Â <code>%d</code>ã€<code>%thread</code>ã€<code>%msg</code>Â ç­‰è½¬æ¢ç¬¦è§£æå‡ºæ¥ã€‚</li>
<li><strong>æ„å»ºè½¬æ¢å™¨é“¾</strong>ï¼šä¸ºæ¯ä¸ªè½¬æ¢ç¬¦åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Â <code>Converter</code>Â å¯¹è±¡ï¼Œå¹¶é“¾æ¥èµ·æ¥ã€‚</li>
<li><strong>éå†è½¬æ¢å™¨é“¾</strong>ï¼šä¾æ¬¡è°ƒç”¨æ¯ä¸ªÂ <code>Converter</code>Â çš„Â <code>write</code>Â æ–¹æ³•ã€‚</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PatternLayout</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractStringLayout</span> {  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_CONVERSION_PATTERN</span> <span class="hljs-operator">=</span> <span class="hljs-string">"%m%n"</span>;  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TTCC_CONVERSION_PATTERN</span> <span class="hljs-operator">=</span> <span class="hljs-string">"%r [%t] %p %c %notEmpty{%x }- %m%n"</span>;  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SIMPLE_CONVERSION_PATTERN</span> <span class="hljs-operator">=</span> <span class="hljs-string">"%d [%t] %p %c - %m%n"</span>;  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Converter"</span>;  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String conversionPattern;  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PatternSelector patternSelector;  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AbstractStringLayout.Serializer eventSerializer;
    
    <span class="hljs-comment">//...</span>
}
</code></pre>
<p><strong>PatternLayoutBase çš„æ ¸å¿ƒæ–¹æ³•å¦‚ä¸‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> String <span class="hljs-title function_">writeLoopOnConverters</span><span class="hljs-params">(E event)</span> {
    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">strBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-number">128</span>);
    Converter&lt;E&gt; c = headConverter;
    <span class="hljs-keyword">while</span> (c != <span class="hljs-literal">null</span>) {
        c.write(strBuilder, event); <span class="hljs-comment">// å§”æ‰˜ç»™æ¯ä¸ªè½¬æ¢å™¨</span>
        c = c.getNext();
    }
    <span class="hljs-keyword">return</span> strBuilder.toString();
}
</code></pre>
<p><strong>ä»¥Â <code>%msg</code>Â å¯¹åº”çš„Â <code>MessageConverter</code>Â ä¸ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageConverter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Converter</span>&lt;ILoggingEvent&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(StringBuilder buf, ILoggingEvent event)</span> {
        <span class="hljs-comment">// ç›´æ¥è¿½åŠ åœ¨ç¬¬ä¸€æ­¥ä¸­ç”± MessageFormatter ç”Ÿæˆå¥½çš„æ¶ˆæ¯å­—ç¬¦ä¸²</span>
        buf.append(event.getFormattedMessage());
    }
}
</code></pre>
<p><strong>ä»¥Â <code>%d</code>Â å¯¹åº”çš„Â <code>DateConverter</code>Â ä¸ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateConverter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Converter</span>&lt;ILoggingEvent&gt; {
    <span class="hljs-keyword">private</span> DateTimeFormatter dtf; <span class="hljs-comment">// å†…éƒ¨ä½¿ç”¨ java.time.format.DateTimeFormatter</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(StringBuilder buf, ILoggingEvent event)</span> {
        <span class="hljs-keyword">if</span> (dtf == <span class="hljs-literal">null</span>) {
            dtf = DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        }
        <span class="hljs-type">String</span> <span class="hljs-variable">dateStr</span> <span class="hljs-operator">=</span> dtf.format(<span class="hljs-comment">/* ä»eventä¸­è·å–æ—¶é—´æˆ³å¹¶è½¬æ¢ */</span>);
        buf.append(dateStr);
    }
}
</code></pre>
<p>æœ€ç»ˆï¼Œæ‰€æœ‰è¿™äº›Â <code>Converter</code>Â çš„è¾“å‡ºè¢«æ‹¼æ¥èµ·æ¥ï¼Œå½¢æˆæœ€ç»ˆæ—¥å¿—è¡Œï¼šÂ <code>2024-05-24 14:30:00 [http-nio-8080-exec-1] INFO c.example.OrderService - è®¢å•12345åˆ›å»ºæˆåŠŸï¼Œé‡‘é¢ï¼š99.99</code></p>
<h2 data-id="heading-9">5. æ€»ç»“</h2>
<p>Formatter æ¨¡å¼çš„æœ¬è´¨è¿œä¸æ­¢æ˜¯ç®€å•çš„å­—ç¬¦ä¸²æ‹¼æ¥æˆ–ç±»å‹è½¬æ¢ã€‚å…¶æ ¸å¿ƒè®¾è®¡æ€æƒ³æ˜¯ï¼šåœ¨æ•°æ®çš„å†…éƒ¨è¡¨ç¤ºä¸å¤–éƒ¨è¡¨ç¤ºä¹‹é—´å»ºç«‹ä¸€ä¸ªåŒå‘çš„â€œè½¬æ¢å±‚â€ï¼Œä»è€Œå°†æ ¼å¼åŒ–å’Œè§£æçš„å¤æ‚é€»è¾‘å°è£…èµ·æ¥ï¼Œå®ç°å¯¹æ•°æ®è¡¨ç°å½¢å¼çš„ç®¡ç†ã€æ§åˆ¶å’Œæ‰©å±•ã€‚</p>
<p>å®ƒæ·±åˆ»ä½“ç°äº†ä»¥ä¸‹å‡ ä¸ªç»å…¸è®¾è®¡æ¨¡å¼çš„æ€æƒ³ï¼š</p>
<ol>
<li><strong>ç­–ç•¥æ¨¡å¼ï¼š</strong> <code>Formatter</code> æ¥å£å®šä¹‰äº†ä¸€ä¸ªå¯äº’æ¢çš„ç®—æ³•å®¶æ—ã€‚é’ˆå¯¹åŒä¸€ç±»å‹ï¼ˆå¦‚ <code>Date</code>ï¼‰ï¼Œå¯ä»¥æœ‰å¤šç§æ ¼å¼åŒ–ç­–ç•¥ï¼ˆå¦‚ <code>ISO</code> æ ¼å¼ã€ä¸­æ–‡æ ¼å¼ã€è‡ªå®šä¹‰æ ¼å¼ï¼‰ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡ï¼ˆå¦‚æ³¨è§£ã€åŒºåŸŸè®¾ç½®ï¼‰è½»æ¾åœ°åˆ‡æ¢ä¸åŒçš„ç­–ç•¥ï¼Œè€Œæ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ã€‚</li>
<li><strong>è£…é¥°å™¨æ¨¡å¼ï¼š</strong> å¯ä»¥å°†åŸå§‹çš„å¯¹è±¡åˆ°å­—ç¬¦ä¸²çš„è½¬æ¢ï¼ˆå¦‚ <code>toString()</code>ï¼‰è§†ä½œåŸºç¡€åŠŸèƒ½ã€‚è€Œ <code>Formatter</code> åœ¨å…¶ä¹‹ä¸Šâ€œè£…é¥°â€äº†æ›´å¼ºå¤§çš„èƒ½åŠ›ï¼Œå¦‚<strong>æœ¬åœ°åŒ–æ”¯æŒ</strong>ã€<strong>æ¨¡å¼åŒ–è¾“å‡º</strong>å’Œ<strong>å¼‚å¸¸å¤„ç†</strong>ï¼Œä»è€Œæä¾›äº†æ›´ä¸°å¯Œã€æ›´å¥å£®çš„è½¬æ¢è¡Œä¸ºï¼ŒåŒæ—¶ä¿æŒäº†å®¢æˆ·ç«¯è°ƒç”¨æ¥å£çš„ç®€æ´æ€§ã€‚</li>
<li><strong>å·¥å‚æ¨¡å¼ï¼š</strong> åœ¨æ³¨è§£é©±åŠ¨çš„åœºæ™¯ä¸‹ï¼ˆå¦‚ <code>@DateTimeFormat</code>ï¼‰ï¼Œ<code>AnnotationFormatterFactory</code> æ‰®æ¼”äº†<strong>æŠ½è±¡å·¥å‚</strong>çš„è§’è‰²ã€‚å®ƒæ ¹æ®å­—æ®µä¸Šçš„å…ƒæ•°æ®ï¼ˆæ³¨è§£ï¼‰åŠ¨æ€åœ°åˆ›å»ºå’Œé…ç½®å…·ä½“çš„ <code>Formatter</code> å®ä¾‹ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºé€»è¾‘ä¸ä½¿ç”¨é€»è¾‘å½»åº•è§£è€¦ï¼Œå®ç°äº†é«˜åº¦çš„çµæ´»æ€§ã€‚</li>
</ol>
<p><strong>æ ¸å¿ƒä»·å€¼ï¼š</strong> å°†â€œæ•°æ®è¡¨ç¤ºè½¬æ¢â€è¿™ä¸€å¸¸è§éœ€æ±‚ï¼Œä»ä¸€ä¸ªå®¹æ˜“å‡ºé”™ã€æ•£å¸ƒå„å¤„çš„è¿‡ç¨‹å¼ä»£ç ï¼Œæå‡ä¸ºä¸€ä¸ªå¯å¤ç”¨ã€å¯é…ç½®ã€å¯æµ‹è¯•çš„æ¶æ„æ€§ç»„ä»¶ã€‚</p>
<hr/>
<p><strong>æ€è€ƒä¸æ¢è®¨</strong></p>
<ol>
<li>
<p><strong>æ ¼å¼åŒ–çš„è¾¹ç•Œåœ¨å“ªé‡Œï¼š</strong> Formatter åº”è¯¥åªè´Ÿè´£â€œè¡¨ç°å±‚â€çš„æ ¼å¼ï¼ˆå¦‚æ—¥æœŸæ˜¾ç¤ºä¸º <code>yyyy-MM-dd</code>ï¼‰ï¼Œè¿˜æ˜¯å¯ä»¥åŒ…å«â€œä¸šåŠ¡é€»è¾‘â€çš„è½¬æ¢ï¼ˆå¦‚å°†è®¢å•çŠ¶æ€æšä¸¾ <code>PAID</code> æ˜¾ç¤ºä¸ºâ€œå·²æ”¯ä»˜â€ï¼‰ï¼Ÿ</p>
</li>
<li>
<p><strong>æ€§èƒ½ä¸èµ„æºçš„æƒè¡¡ï¼š</strong> åƒ <code>DateTimeFormatter</code> è¿™æ ·çš„çº¿ç¨‹å®‰å…¨ã€ä¸å¯å˜å¯¹è±¡ï¼Œåˆ›å»ºæˆæœ¬è¾ƒé«˜ï¼Œå› æ­¤éœ€è¦å¤ç”¨ã€‚åœ¨ Web ç­‰é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä½ æ˜¯å¦‚ä½•ç®¡ç†å’Œç¼“å­˜ Formatter å®ä¾‹çš„ï¼Ÿ</p>
</li>
</ol>
<hr/>
<p><strong>ä¸‹ä¸€ç¯‡é¢„å‘Šï¼š</strong> åœ¨ä¸‹ä¸€ç¯‡æ–‡ç«  ã€Šã€åŸºç¡€æ•°æ®ç¯‡ã€‘æ•°æ®ç­‰ä»·è£åˆ¤ï¼šCompareræ¨¡å¼ã€‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ <code>equals</code>ã€<code>hashCode</code> ä¸ <code>Comparator</code> å¦‚ä½•ååŒå·¥ä½œï¼Œä¸ºé›†åˆæ“ä½œã€æ’åºå’Œå”¯ä¸€æ€§åˆ¤æ–­å»ºç«‹å¯é çš„æ ‡å‡†ï¼Œå¹¶æ·±å…¥è§£æå…¶åœ¨æ„å»ºç¨³å®šã€å¯é¢„æµ‹çš„è½¯ä»¶ç³»ç»Ÿä¸­æ‰€æ‰®æ¼”çš„åŸºçŸ³è§’è‰²ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰‹å†™Springäº‹åŠ¡æ¡†æ¶ï¼š200è¡Œä»£ç æ­å¼€@Transactionalçš„ç¥ç§˜é¢çº±ï¼ˆ é™„å®Œæ•´æºä»£ç ï¼‰]]></title>    <link>https://juejin.cn/post/7577690150093242408</link>    <guid>https://juejin.cn/post/7577690150093242408</guid>    <pubDate>2025-11-30T03:23:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577690150093242408" data-draft-id="7577690150093226024" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰‹å†™Springäº‹åŠ¡æ¡†æ¶ï¼š200è¡Œä»£ç æ­å¼€@Transactionalçš„ç¥ç§˜é¢çº±ï¼ˆ é™„å®Œæ•´æºä»£ç ï¼‰"/> <meta itemprop="keywords" content="Spring,Spring Boot,Spring Cloud"/> <meta itemprop="datePublished" content="2025-11-30T03:23:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰‹å†™Springäº‹åŠ¡æ¡†æ¶ï¼š200è¡Œä»£ç æ­å¼€@Transactionalçš„ç¥ç§˜é¢çº±ï¼ˆ é™„å®Œæ•´æºä»£ç ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T03:23:57.000Z" title="Sun Nov 30 2025 03:23:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å†™åœ¨å‰é¢</h2>
<p>ä¹‹å‰æˆ‘åœ¨é¡¹ç›®é‡Œå†™è¿‡å¥½å‡ ç¯‡å…³äºäº‹åŠ¡çš„æ–‡ç« ï¼Œæ¯”å¦‚åœ¨mallå•†åŸé‡Œæ€ä¹ˆç”¨@Transactionalã€ç¢°åˆ°å“ªäº›è¯¡å¼‚çš„å‘ã€äº‹åŠ¡ä¼ æ’­è¡Œä¸ºREQUIREDå’ŒREQUIRES_NEWçš„åŒºåˆ«å•¥çš„ã€‚ä½†è¯´å®è¯ï¼Œæ¯æ¬¡å†™å®Œéƒ½è§‰å¾—æœ‰ç‚¹è™šï¼Œæ€»æ„Ÿè§‰æ˜¯åœ¨"çŸ¥é“æ€ä¹ˆç”¨"å’Œ"ç†è§£ä¸ºä»€ä¹ˆ"ä¹‹é—´æ‰“è½¬ã€‚</p>
<p>åæ¥æˆ‘å°±æƒ³ï¼Œå¹²è„†è‡ªå·±æ‰‹å†™ä¸€ä¸ªç®€åŒ–ç‰ˆçš„äº‹åŠ¡æ¡†æ¶å§ï¼ŒæŠŠSpringé‚£å¥—@Transactionalçš„æ ¸å¿ƒé€»è¾‘å‰¥å‡ºæ¥ï¼Œçœ‹çœ‹åˆ°åº•æ˜¯å’‹å›äº‹ã€‚è¿™ä¸ï¼ŒèŠ±äº†åŠå¤©æ—¶é—´ï¼ˆå¯¹ï¼Œå°±åŠå¤©ï¼‰ï¼Œç”¨JDK+JDBCæ’¸äº†ä¸ª200æ¥è¡Œçš„äº‹åŠ¡ç®¡ç†æ¡†æ¶ï¼Œè¿˜çœŸå°±è·‘é€šäº†ã€‚</p>
<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œå°±æŠŠè¿™ä¸ªè¿‡ç¨‹å’Œè¸©çš„å‘åˆ†äº«ç»™å¤§å®¶ã€‚</p>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆè¦æ‰‹å†™ï¼Ÿçœ‹æºç ä¸é¦™å—ï¼Ÿ</h2>
<p>æœ‰åŒå­¦å¯èƒ½ä¼šé—®ï¼šSpringæºç å°±åœ¨é‚£ï¼Œä¸ºå•¥ä¸ç›´æ¥çœ‹ï¼Ÿ</p>
<p>æˆ‘å½“æ—¶ä¹Ÿè¿™ä¹ˆæƒ³è¿‡ï¼Œä½†çœ‹Springäº‹åŠ¡æºç æœ‰ä¸ªé—®é¢˜ â€”â€” <strong>æŠ½è±¡å±‚å¤ªå¤šäº†</strong>ã€‚ä»€ä¹ˆPlatformTransactionManagerã€TransactionDefinitionã€TransactionStatusï¼Œä¸€å±‚å¥—ä¸€å±‚ï¼Œçœ‹ç€çœ‹ç€å°±æ™•äº†ï¼Œå¾ˆéš¾æŠ“ä½æœ¬è´¨ã€‚</p>
<p>åæ¥æˆ‘æ¢äº†ä¸ªæ€è·¯ï¼š<strong>å…ˆè‡ªå·±å®ç°æœ€ç®€å•èƒ½è·‘é€šçš„ç‰ˆæœ¬ï¼Œå†å»å¯¹æ¯”Springçš„å®ç°</strong>ã€‚è¿™æ ·åè€Œæ›´æ¸…æ¥šå“ªäº›æ˜¯æ ¸å¿ƒé€»è¾‘ï¼Œå“ªäº›æ˜¯ä¸ºäº†æ‰©å±•æ€§åšçš„è®¾è®¡ã€‚</p>
<p>å°±åƒå­¦åšèœï¼Œä½ å¾—å…ˆä¼šåšä¸ªè¥¿çº¢æŸ¿ç‚’è›‹ï¼Œå†å»ç ”ç©¶ç±³å…¶æ—å¤§å¨çš„ç•ªèŒ„æ–™ç†ï¼Œå¯¹å§ï¼Ÿ</p>
<h2 data-id="heading-2">äº‹åŠ¡çš„æœ¬è´¨åˆ°åº•æ˜¯å•¥ï¼Ÿ</h2>
<p>æˆ‘ä»¬å…ˆæŠŠSpringé‚£å¥—å¤æ‚çš„ä¸œè¥¿æ”¾ä¸€è¾¹ï¼Œæƒ³æƒ³äº‹åŠ¡åœ¨æ•°æ®åº“å±‚é¢åˆ°åº•æ˜¯å’‹å›äº‹ã€‚</p>
<p>å…¶å®å°±ä¸‰æ­¥ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> dataSource.getConnection();
conn.setAutoCommit(<span class="hljs-literal">false</span>);  <span class="hljs-comment">// å…³é”®ï¼šå…³é—­è‡ªåŠ¨æäº¤</span>

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// æ‰§è¡Œä½ çš„SQLæ“ä½œ</span>
    insertOrder(...);
    insertOrderItems(...);
    
    conn.commit();  <span class="hljs-comment">// æˆåŠŸå°±æäº¤</span>
} <span class="hljs-keyword">catch</span> (Exception e) {
    conn.rollback();  <span class="hljs-comment">// å¤±è´¥å°±å›æ»š</span>
} <span class="hljs-keyword">finally</span> {
    conn.setAutoCommit(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// è®°å¾—æ¢å¤</span>
    conn.close();
}
</code></pre>
<p>çœ‹ï¼Œå°±è¿™ä¹ˆç®€å•ï¼<strong>äº‹åŠ¡çš„æœ¬è´¨å°±æ˜¯æŠŠConnectionçš„è‡ªåŠ¨æäº¤å…³äº†ï¼Œç„¶åä½ æ‰‹åŠ¨æ§åˆ¶commitè¿˜æ˜¯rollback</strong>ã€‚</p>
<p>é‚£Springçš„@Transactionalåšäº†å•¥ï¼Ÿæ— éå°±æ˜¯å¸®ä½ æŠŠè¿™ä¸ªtry-catch-finallyçš„æ¨¡æ¿ä»£ç ç»™å°è£…äº†ï¼Œä½ åªè¦æ‰“ä¸ªæ³¨è§£å°±è¡Œã€‚</p>
<p>æ˜ç™½è¿™ç‚¹ä¹‹åï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ¸…æ™°äº†ï¼š<strong>ç”¨AOPæ‹¦æˆªå¸¦@Transactionalæ³¨è§£çš„æ–¹æ³•ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åè‡ªåŠ¨åŠ ä¸Šè¿™å¥—é€»è¾‘</strong>ã€‚</p>
<h2 data-id="heading-3">æ•´ä½“è®¾è®¡ï¼šåˆ†å±‚è¦æ¸…æ™°</h2>
<p>æˆ‘å½“æ—¶è®¾è®¡çš„æ—¶å€™ï¼Œå‚è€ƒäº†Springçš„æ€è·¯ï¼ŒæŠŠèŒè´£åˆ†äº†å‡ å±‚ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[ä¸šåŠ¡ä»£ç ] --&gt; B[åŠ¨æ€ä»£ç† ProxyFactory]
    B --&gt; C[äº‹åŠ¡æ‹¦æˆªå™¨ TransactionInterceptor]
    C --&gt; D[äº‹åŠ¡ç®¡ç†å™¨ TransactionManager]
    D --&gt; E[äº‹åŠ¡ä¸Šä¸‹æ–‡ TransactionContext]
    E --&gt; F[æ•°æ®åº“è¿æ¥ Connection]
    
    style C fill:#f9f,stroke:#333,stroke-width:2px
    style E fill:#bbf,stroke:#333,stroke-width:2px
</code></pre>
<p><strong>å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
<ol>
<li><strong>@Transactionalæ³¨è§£</strong>ï¼šæ ‡è®°å“ªäº›æ–¹æ³•éœ€è¦äº‹åŠ¡</li>
<li><strong>ProxyFactory</strong>ï¼šç”¨JDKåŠ¨æ€ä»£ç†ç»™ä½ çš„ä¸šåŠ¡ç±»å¥—ä¸€å±‚</li>
<li><strong>TransactionInterceptor</strong>ï¼šæ‹¦æˆªå™¨ï¼ŒçœŸæ­£å¹²æ´»çš„åœ°æ–¹</li>
<li><strong>TransactionManager</strong>ï¼šç®¡ç†äº‹åŠ¡çš„å¼€å¯ã€æäº¤ã€å›æ»š</li>
<li><strong>TransactionContext</strong>ï¼šç”¨ThreadLocalä¿å­˜å½“å‰çº¿ç¨‹çš„äº‹åŠ¡ä¿¡æ¯</li>
</ol>
<p>è¿™ä¸ªåˆ†å±‚å…¶å®å°±æ˜¯Springçš„ç®€åŒ–ç‰ˆï¼Œä½†éº»é›€è™½å°äº”è„ä¿±å…¨ã€‚</p>
<h2 data-id="heading-4">å…ˆä»æœ€ç®€å•çš„å¼€å§‹ï¼šæ³¨è§£å®šä¹‰</h2>
<p>æ³¨è§£éƒ¨åˆ†å¾ˆç®€å•ï¼Œå°±å‡ ä¸ªå±æ€§ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Target({ElementType.METHOD, ElementType.TYPE})</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Transactional {
    Propagation <span class="hljs-title function_">propagation</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> Propagation.REQUIRED;
    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Throwable</span>&gt;[] rollbackFor() <span class="hljs-keyword">default</span> {};
    <span class="hljs-type">int</span> <span class="hljs-title function_">timeout</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> -<span class="hljs-number">1</span>;
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">readOnly</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Propagation</span> {
    REQUIRED,   <span class="hljs-comment">// æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æ–°å»º</span>
    SUPPORTS    <span class="hljs-comment">// æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±ç®—äº†</span>
}
</code></pre>
<p>è¿™é‡Œæˆ‘åªå®ç°äº†REQUIREDå’ŒSUPPORTSï¼Œå› ä¸ºè¿™ä¿©æœ€å¸¸ç”¨ã€‚REQUIRES_NEWã€NESTEDé‚£äº›ç•™åˆ°ç¬¬äºŒé˜¶æ®µå†è¯´ã€‚</p>
<h2 data-id="heading-5">å…³é”®ä¸­çš„å…³é”®ï¼šThreadLocalç®¡ç†äº‹åŠ¡ä¸Šä¸‹æ–‡</h2>
<p>è¿™å—æ˜¯æˆ‘å½“æ—¶èŠ±æ—¶é—´æœ€å¤šçš„åœ°æ–¹ã€‚ä¸ºä»€ä¹ˆè¦ç”¨ThreadLocalï¼Ÿ</p>
<p>æƒ³æƒ³è¿™ä¸ªåœºæ™¯ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¤–å±‚æ–¹æ³•</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethod</span><span class="hljs-params">()</span> {
    insertOrder();
    innerMethod();  <span class="hljs-comment">// è°ƒç”¨å†…å±‚æ–¹æ³•</span>
}

<span class="hljs-comment">// å†…å±‚æ–¹æ³•</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">innerMethod</span><span class="hljs-params">()</span> {
    insertOrderItems();
}
</code></pre>
<p>å¤–å±‚å’Œå†…å±‚éƒ½æœ‰@Transactionalï¼Œå®ƒä»¬åº”è¯¥<strong>å…±äº«åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥</strong>ï¼Œè¦ä¹ˆä¸€èµ·æäº¤ï¼Œè¦ä¹ˆä¸€èµ·å›æ»šã€‚æ€ä¹ˆåšåˆ°çš„ï¼Ÿ</p>
<p>ç­”æ¡ˆå°±æ˜¯ThreadLocalã€‚æ¯ä¸ªçº¿ç¨‹æŒæœ‰è‡ªå·±çš„ConnectionHolderï¼Œé‡Œé¢æ”¾ç€Connectionå’Œå„ç§çŠ¶æ€ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionContext</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;ConnectionHolder&gt; CONTEXT = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
    
    <span class="hljs-comment">// å¼€å¯äº‹åŠ¡ï¼šç»‘å®šè¿æ¥åˆ°å½“å‰çº¿ç¨‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bindNewConnection</span><span class="hljs-params">(DataSource ds, <span class="hljs-type">boolean</span> readOnly, Integer timeout)</span> {
        <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> ds.getConnection();
        conn.setAutoCommit(<span class="hljs-literal">false</span>);  <span class="hljs-comment">// å…³é—­è‡ªåŠ¨æäº¤</span>
        conn.setReadOnly(readOnly);
        
        <span class="hljs-type">ConnectionHolder</span> <span class="hljs-variable">holder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionHolder</span>(conn);
        holder.setActive(<span class="hljs-literal">true</span>);
        CONTEXT.set(holder);  <span class="hljs-comment">// ç»‘å®šåˆ°ThreadLocal</span>
    }
    
    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹çš„è¿æ¥</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getCurrentConnection</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ConnectionHolder</span> <span class="hljs-variable">holder</span> <span class="hljs-operator">=</span> CONTEXT.get();
        <span class="hljs-keyword">return</span> holder != <span class="hljs-literal">null</span> ? holder.getConnection() : <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-comment">// æ¸…ç†èµ„æº</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ConnectionHolder</span> <span class="hljs-variable">holder</span> <span class="hljs-operator">=</span> CONTEXT.get();
        <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) {
            holder.getConnection().setReadOnly(<span class="hljs-literal">false</span>);
            holder.getConnection().setAutoCommit(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// æ¢å¤è‡ªåŠ¨æäº¤</span>
            holder.getConnection().close();
        }
        CONTEXT.remove();  <span class="hljs-comment">// è¿™ä¸ªå¾ˆé‡è¦ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
    }
}
</code></pre>
<p>è¿™é‡Œæœ‰ä¸ªå‘æˆ‘å½“æ—¶è¢«æŠ˜è…¾æƒ¨äº†ï¼š<strong>ä¸€å®šè¦è®°å¾—ThreadLocal.remove()</strong>ã€‚</p>
<p>æˆ‘ä¸€å¼€å§‹æ²¡åŠ è¿™è¡Œï¼Œåœ¨å¤šçº¿ç¨‹æµ‹è¯•çš„æ—¶å€™ï¼Œå‘ç°æœ‰çš„çº¿ç¨‹ä¼šè«åå…¶å¦™æ‹¿åˆ°åˆ«çš„çº¿ç¨‹çš„è¿æ¥ï¼ŒæŸ¥äº†åŠå¤©æ‰å‘ç°æ˜¯å› ä¸ºTomcatçš„çº¿ç¨‹æ± ä¼šå¤ç”¨çº¿ç¨‹ï¼Œå¦‚æœä½ ä¸removeï¼Œä¸Šä¸€æ¬¡çš„ConnectionHolderå°±è¿˜åœ¨é‚£ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant çº¿ç¨‹1
    participant ThreadLocal
    participant çº¿ç¨‹æ± 
    
    çº¿ç¨‹1-&gt;&gt;ThreadLocal: set(holder1)
    çº¿ç¨‹1-&gt;&gt;çº¿ç¨‹1: æ‰§è¡Œä¸šåŠ¡
    çº¿ç¨‹1-&gt;&gt;ThreadLocal: å¿˜è®°remove()
    çº¿ç¨‹1-&gt;&gt;çº¿ç¨‹æ± : å½’è¿˜çº¿ç¨‹
    
    Note over çº¿ç¨‹æ± ,ThreadLocal: çº¿ç¨‹1è¢«å¤ç”¨æ‰§è¡Œæ–°ä»»åŠ¡
    
    çº¿ç¨‹æ± -&gt;&gt;çº¿ç¨‹1: åˆ†é…ç»™æ–°ä»»åŠ¡
    çº¿ç¨‹1-&gt;&gt;ThreadLocal: get()
    ThreadLocal--&gt;&gt;çº¿ç¨‹1: è¿”å›holder1 (æ—§çš„!)
    
    Note over çº¿ç¨‹1: æ‚²å‰§ï¼šæ‹¿åˆ°ä¸Šæ¬¡çš„è¿æ¥
</code></pre>
<p>æ‰€ä»¥æˆ‘çš„å»ºè®®æ˜¯ï¼š<strong>åœ¨finallyå—é‡Œç»Ÿä¸€æ¸…ç†ï¼Œæ— è®ºcommitè¿˜æ˜¯rollback</strong>ã€‚</p>
<h2 data-id="heading-6">æ‹¦æˆªå™¨ï¼šæ•´ä¸ªæ¡†æ¶çš„çµé­‚</h2>
<p>æ‹¦æˆªå™¨æ˜¯æ•´ä¸ªæ¡†æ¶æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒè¦å¤„ç†å„ç§æƒ…å†µã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
    <span class="hljs-comment">// 1. è§£æ@Transactionalæ³¨è§£</span>
    <span class="hljs-type">TransactionAttribute</span> <span class="hljs-variable">attr</span> <span class="hljs-operator">=</span> parseAnnotation(method, target.getClass());
    <span class="hljs-keyword">if</span> (attr == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> method.invoke(target, args);  <span class="hljs-comment">// æ²¡æ³¨è§£ç›´æ¥æ‰§è¡Œ</span>
    }
    
    <span class="hljs-comment">// 2. åˆ¤æ–­æ˜¯å¦å·²ç»æœ‰äº‹åŠ¡</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">existing</span> <span class="hljs-operator">=</span> TransactionContext.isActive();
    <span class="hljs-type">boolean</span> <span class="hljs-variable">started</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// 3. REQUIREDä¼ æ’­ï¼šæ²¡äº‹åŠ¡å°±æ–°å»º</span>
    <span class="hljs-keyword">if</span> (attr.getPropagation() == Propagation.REQUIRED &amp;&amp; !existing) {
        txManager.begin(attr.isReadOnly(), attr.getTimeout());
        started = <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 4. æ‰§è¡Œä¸šåŠ¡æ–¹æ³•</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);
        
        <span class="hljs-comment">// 5. æ­£å¸¸è¿”å›ï¼šæäº¤</span>
        <span class="hljs-keyword">if</span> (started) {
            <span class="hljs-keyword">if</span> (TransactionContext.isRollbackOnly()) {
                txManager.rollback();  <span class="hljs-comment">// æœ‰äººæ ‡è®°äº†å›æ»š</span>
            } <span class="hljs-keyword">else</span> {
                txManager.commit();
            }
        }
        <span class="hljs-keyword">return</span> result;
        
    } <span class="hljs-keyword">catch</span> (InvocationTargetException e) {
        <span class="hljs-type">Throwable</span> <span class="hljs-variable">ex</span> <span class="hljs-operator">=</span> e.getTargetException();
        
        <span class="hljs-comment">// 6. åˆ¤æ–­æ˜¯å¦è¦å›æ»š</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">shouldRollback</span> <span class="hljs-operator">=</span> (ex <span class="hljs-keyword">instanceof</span> RuntimeException || ex <span class="hljs-keyword">instanceof</span> Error)
            || matchRollbackFor(ex, attr.getRollbackFor());
        
        <span class="hljs-keyword">if</span> (shouldRollback) {
            <span class="hljs-keyword">if</span> (started) {
                txManager.rollback();  <span class="hljs-comment">// æˆ‘å¼€å¯çš„äº‹åŠ¡ï¼Œæˆ‘è´Ÿè´£å›æ»š</span>
            } <span class="hljs-keyword">else</span> {
                TransactionContext.setRollbackOnly();  <span class="hljs-comment">// æ ‡è®°ç»™å¤–å±‚å›æ»š</span>
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (started) {
                txManager.commit();  <span class="hljs-comment">// å—æ£€å¼‚å¸¸é»˜è®¤æäº¤</span>
            }
        }
        
        <span class="hljs-keyword">throw</span> ex;
    }
}
</code></pre>
<p>è¿™é‡Œé¢æœ‰å‡ ä¸ªç‚¹è¦æ³¨æ„ï¼š</p>
<h3 data-id="heading-7">1. å¼‚å¸¸å›æ»šè§„åˆ™</h3>
<p>Springçš„é»˜è®¤è§„åˆ™æ˜¯ï¼š</p>
<ul>
<li><strong>RuntimeExceptionå’ŒError</strong>ï¼šå›æ»š</li>
<li><strong>å—æ£€å¼‚å¸¸ï¼ˆExceptionï¼‰</strong>ï¼šæäº¤</li>
</ul>
<p>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿæˆ‘ç†è§£æ˜¯å› ä¸ºå—æ£€å¼‚å¸¸ä¸€èˆ¬æ˜¯å¯é¢„æœŸçš„ä¸šåŠ¡å¼‚å¸¸ï¼Œä¸åº”è¯¥å¯¼è‡´æ•´ä¸ªäº‹åŠ¡å›æ»šã€‚ä½†ä½ å¯ä»¥é€šè¿‡rollbackForæ˜¾å¼æŒ‡å®šï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// ç°åœ¨æ‰€æœ‰å¼‚å¸¸éƒ½å›æ»š</span>
}
</code></pre>
<h3 data-id="heading-8">2. å†…å¤–å±‚äº‹åŠ¡çš„åä½œ</h3>
<p>è¿™æ˜¯ä¸ªå®¹æ˜“ææ··çš„åœ°æ–¹ã€‚å‡è®¾å¤–å±‚å¼€å¯äº†äº‹åŠ¡ï¼Œå†…å±‚ä¹Ÿæœ‰@Transactionalï¼Œå†…å±‚æŠ›å¼‚å¸¸äº†å’‹åŠï¼Ÿ</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant å¤–å±‚æ–¹æ³•
    participant å†…å±‚æ–¹æ³•
    participant TransactionContext
    
    å¤–å±‚æ–¹æ³•-&gt;&gt;TransactionContext: begin() å¼€å¯äº‹åŠ¡
    å¤–å±‚æ–¹æ³•-&gt;&gt;å†…å±‚æ–¹æ³•: è°ƒç”¨
    å†…å±‚æ–¹æ³•-&gt;&gt;å†…å±‚æ–¹æ³•: å‘ç°å·²æœ‰äº‹åŠ¡ï¼ŒåŠ å…¥
    å†…å±‚æ–¹æ³•-&gt;&gt;å†…å±‚æ–¹æ³•: æ‰§è¡ŒSQL
    å†…å±‚æ–¹æ³•--&gt;&gt;å¤–å±‚æ–¹æ³•: æŠ›å¼‚å¸¸
    å†…å±‚æ–¹æ³•-&gt;&gt;TransactionContext: setRollbackOnly() æ‰“æ ‡è®°
    å¤–å±‚æ–¹æ³•-&gt;&gt;å¤–å±‚æ–¹æ³•: catchåˆ°å¼‚å¸¸
    å¤–å±‚æ–¹æ³•-&gt;&gt;TransactionContext: commit() æ—¶æ£€æŸ¥æ ‡è®°
    TransactionContext-&gt;&gt;TransactionContext: å‘ç°rollbackOnly=true
    TransactionContext-&gt;&gt;TransactionContext: æ‰§è¡Œrollback
</code></pre>
<p>å…³é”®ç‚¹ï¼š<strong>å†…å±‚ä¸èƒ½ç›´æ¥rollbackï¼Œåªèƒ½æ‰“ä¸ªæ ‡è®°ï¼Œè®©å¤–å±‚æ¥ç»Ÿä¸€å¤„ç†</strong>ã€‚å¦åˆ™å¤–å±‚è¿˜æƒ³commitçš„æ—¶å€™ï¼Œè¿æ¥å·²ç»è¢«å›æ»šäº†ï¼Œå°±ä¹±å¥—äº†ã€‚</p>
<h2 data-id="heading-9">ä¸€ä¸ªè¢«æˆ‘å¿½ç•¥çš„å‘ï¼šå¹¶å‘å”¯ä¸€é”®å†²çª</h2>
<p>å†™æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ï¼Œæˆ‘çŠ¯äº†ä¸ªä½çº§é”™è¯¯ã€‚è®¢å•å·æˆ‘ç”¨æ—¶é—´æˆ³ç”Ÿæˆçš„ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">orderNo</span> <span class="hljs-operator">=</span> <span class="hljs-string">"ORD"</span> + System.currentTimeMillis();
</code></pre>
<p>ç»“æœå¤šçº¿ç¨‹æµ‹è¯•çš„æ—¶å€™ï¼Œç»å¸¸æŠ¥å”¯ä¸€é”®å†²çªã€‚åæ¥æƒ³æƒ³ä¹Ÿå¯¹ï¼ŒcurrentTimeMillis()ç²¾åº¦æ‰åˆ°æ¯«ç§’ï¼Œå¹¶å‘ä¸€é«˜è‚¯å®šä¼šé‡å¤ã€‚</p>
<p>åæ¥æ”¹æˆUUIDå°±å¥½äº†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">orderNo</span> <span class="hljs-operator">=</span> <span class="hljs-string">"ORD-"</span> + UUID.randomUUID();
</code></pre>
<p>è¿™ä¸ªå‘è™½ç„¶ç®€å•ï¼Œä½†æé†’æˆ‘ä»¬ï¼š<strong>ç”Ÿäº§ç¯å¢ƒçš„ä¸šåŠ¡ä¸»é”®ä¸€å®šè¦ç”¨åˆ†å¸ƒå¼IDç”Ÿæˆå™¨</strong>ï¼Œæ¯”å¦‚é›ªèŠ±ç®—æ³•ã€å·æ®µæ¨¡å¼å•¥çš„ã€‚æ—¶é—´æˆ³è¿™ç§ç©å…·çº§åˆ«çš„æ–¹æ¡ˆçœŸä¸èƒ½ç”¨ã€‚</p>
<h2 data-id="heading-10">å‡ ä¸ªè¦æ³¨æ„çš„åœ°æ–¹</h2>
<h3 data-id="heading-11">1. åŒç±»æ–¹æ³•è°ƒç”¨ä¸ç”Ÿæ•ˆ</h3>
<p>è¿™ä¸ªæ˜¯Springäº‹åŠ¡çš„ç»å…¸é—®é¢˜ï¼Œæˆ‘è¿™ä¸ªç®€åŒ–ç‰ˆä¹Ÿä¸€æ ·ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span> {
        methodB();  <span class="hljs-comment">// è¿™æ ·è°ƒç”¨ï¼ŒmethodBçš„@Transactionalä¸ç”Ÿæ•ˆ</span>
    }
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>ä¸ºå•¥ï¼Ÿå› ä¸ºä»£ç†åªèƒ½æ‹¦æˆª<strong>ä»å¤–éƒ¨è¿›æ¥çš„è°ƒç”¨</strong>ï¼Œå†…éƒ¨è°ƒç”¨èµ°çš„æ˜¯thisï¼Œä¸ç»è¿‡ä»£ç†ã€‚</p>
<p>è§£å†³åŠæ³•ï¼š</p>
<ul>
<li>è¦ä¹ˆæ‹†åˆ°ä¸åŒçš„ç±»</li>
<li>è¦ä¹ˆé€šè¿‡æ³¨å…¥çš„æ–¹å¼æ‹¿åˆ°ä»£ç†å¯¹è±¡è‡ªå·±</li>
</ul>
<h3 data-id="heading-12">2. èµ„æºæ¸…ç†ä¸€å®šè¦æ”¾finally</h3>
<p>æˆ‘ä¸€å¼€å§‹æŠŠclear()æ”¾åœ¨commit()å’Œrollback()é‡Œï¼Œç»“æœæœ‰äº›å¼‚å¸¸åœºæ™¯èµ„æºæ²¡é‡Šæ”¾ï¼Œè¿æ¥æ± å¾ˆå¿«å°±è€—å°½äº†ã€‚</p>
<p>åæ¥ç»Ÿä¸€æ”¾åˆ°finallyå—ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (holder.isRollbackOnly()) {
        conn.rollback();
    } <span class="hljs-keyword">else</span> {
        conn.commit();
    }
} <span class="hljs-keyword">finally</span> {
    TransactionContext.clear();  <span class="hljs-comment">// æ— è®ºå¦‚ä½•éƒ½è¦æ¸…ç†</span>
}
</code></pre>
<h3 data-id="heading-13">3. æ³¨è§£è§£æçš„ä¼˜å…ˆçº§</h3>
<p>æ–¹æ³•çº§æ³¨è§£ &gt; ç±»çº§æ³¨è§£ &gt; æ¥å£æ–¹æ³•æ³¨è§£</p>
<p>è¿™ä¸ªé¡ºåºè¦è®°ä½ï¼Œé¢è¯•å¯èƒ½ä¼šé—®ã€‚</p>
<h2 data-id="heading-14">æµ‹è¯•éªŒè¯ï¼šçœ¼è§ä¸ºå®</h2>
<p>å†™å®Œä»£ç ï¼Œæˆ‘è·‘äº†å‡ ä¸ªæµ‹è¯•åœºæ™¯ï¼š</p>
<p><strong>åœºæ™¯1ï¼šæ­£å¸¸æäº¤</strong></p>
<pre><code class="hljs language-java" lang="java">service.placeOrder(<span class="hljs-string">"U1001"</span>, <span class="hljs-string">"SKU-001"</span>, <span class="hljs-number">2</span>);
<span class="hljs-comment">// æ•°æ®åº“æŸ¥è¯¢ï¼šæœ‰è®°å½• </span>
</code></pre>
<p><strong>åœºæ™¯2ï¼šè¿è¡Œæ—¶å¼‚å¸¸å›æ»š</strong></p>
<pre><code class="hljs language-java" lang="java">service.placeOrder(<span class="hljs-string">"U1002"</span>, <span class="hljs-string">"OUT_OF_STOCK"</span>, <span class="hljs-number">1</span>);  <span class="hljs-comment">// å†…éƒ¨æŠ›RuntimeException</span>
<span class="hljs-comment">// æ•°æ®åº“æŸ¥è¯¢ï¼šæ— è®°å½• </span>
</code></pre>
<p><strong>åœºæ™¯3ï¼šå—æ£€å¼‚å¸¸éœ€è¦rollbackFor</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// æŠ›Exceptionä¹Ÿä¼šå›æ»š </span>
}
</code></pre>
<p><strong>åœºæ™¯4ï¼šä¼ æ’­è¡Œä¸ºREQUIRED</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethod</span><span class="hljs-params">()</span> {
    insertOrder();
    innerMethod();  <span class="hljs-comment">// å…±äº«åŒä¸€ä¸ªäº‹åŠ¡</span>
}

<span class="hljs-comment">// å†…å±‚æŠ›å¼‚å¸¸ï¼Œå¤–å±‚ä¹Ÿå›æ»š </span>
</code></pre>
<p><strong>åœºæ™¯5ï¼šå¤šçº¿ç¨‹éš”ç¦»</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¼€5ä¸ªçº¿ç¨‹å¹¶å‘ä¸‹å•</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
    executor.submit(() -&gt; service.placeOrder(...));
}
<span class="hljs-comment">// æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„äº‹åŠ¡ï¼Œäº’ä¸å½±å“ </span>
</code></pre>
<p>è¿™å‡ ä¸ªåœºæ™¯è·‘ä¸‹æ¥ï¼ŒåŸºæœ¬çš„äº‹åŠ¡åŠŸèƒ½å°±éƒ½éªŒè¯äº†ã€‚</p>
<h2 data-id="heading-15">å’ŒSpringäº‹åŠ¡çš„å¯¹æ¯”</h2>
<p>å†™å®Œä¹‹åï¼Œæˆ‘åˆå›å»çœ‹äº†ä¸‹Springçš„æºç ï¼Œå‘ç°æˆ‘è¿™ä¸ªç®€åŒ–ç‰ˆå…¶å®æŠ“ä½äº†æ ¸å¿ƒï¼š</p>








































<table><thead><tr><th>åŠŸèƒ½</th><th>æˆ‘çš„å®ç°</th><th>Springå®ç°</th></tr></thead><tbody><tr><td>æ³¨è§£é©±åŠ¨</td><td>@Transactional</td><td>@Transactional</td></tr><tr><td>ä»£ç†æ–¹å¼</td><td>JDKåŠ¨æ€ä»£ç†</td><td>JDK + CGLIB</td></tr><tr><td>ä¼ æ’­è¡Œä¸º</td><td>REQUIRED, SUPPORTS</td><td>7ç§ä¼ æ’­è¡Œä¸º</td></tr><tr><td>å›æ»šè§„åˆ™</td><td>RuntimeException/Error + rollbackFor</td><td>åŒå·¦</td></tr><tr><td>çº¿ç¨‹éš”ç¦»</td><td>ThreadLocal</td><td>åŒå·¦</td></tr><tr><td>èµ„æºç®¡ç†</td><td>æ‰‹åŠ¨clear</td><td>TransactionSynchronizationManager</td></tr></tbody></table>
<p>Springå¤šçš„é‚£äº›æŠ½è±¡å±‚ï¼Œä¸»è¦æ˜¯ä¸ºäº†ï¼š</p>
<ul>
<li>æ”¯æŒæ›´å¤šä¼ æ’­è¡Œä¸ºï¼ˆREQUIRES_NEWéœ€è¦æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼‰</li>
<li>æ”¯æŒJTAåˆ†å¸ƒå¼äº‹åŠ¡</li>
<li>æ”¯æŒå¤šç§æŒä¹…åŒ–æ¡†æ¶ï¼ˆHibernateã€JPAç­‰ï¼‰</li>
<li>æä¾›ç¼–ç¨‹å¼äº‹åŠ¡API</li>
</ul>
<p>ä½†<strong>æ ¸å¿ƒåŸç†æ˜¯ä¸€æ ·çš„</strong>ï¼šThreadLocal + AOP + Connectionæ§åˆ¶ã€‚</p>
<h2 data-id="heading-16">ç°åœ¨æ˜ç™½äº†ï¼Œä¸‹ä¸€æ­¥è¯¥å¹²å•¥ï¼Ÿ</h2>
<p>ç°åœ¨æˆ‘å¯¹Springäº‹åŠ¡çš„ç†è§£ï¼Œä»"ä¼šç”¨"å‡çº§åˆ°äº†"çŸ¥é“ä¸ºä»€ä¹ˆ"ã€‚ä¸‹ä¸€æ­¥æˆ‘æ‰“ç®—ï¼š</p>
<ol>
<li><strong>åŠ å…¥CGLIBæ”¯æŒ</strong>ï¼šç°åœ¨åªèƒ½ä»£ç†æ¥å£ï¼Œæ— æ¥å£çš„ç±»è¿˜ä¸è¡Œ</li>
<li><strong>å®ç°REQUIRES_NEW</strong>ï¼šè¿™ä¸ªéœ€è¦æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œæ¶‰åŠåˆ°äº‹åŠ¡æ ˆçš„ç®¡ç†</li>
<li><strong>åŠ å…¥Druidç›‘æ§</strong>ï¼šçœ‹çœ‹äº‹åŠ¡æ‰§è¡Œè€—æ—¶ã€è¿æ¥è·å–æƒ…å†µ</li>
<li><strong>ç ”ç©¶åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼šä»2PCåˆ°TCCåˆ°Seataï¼Œæ…¢æ…¢å•ƒ</li>
</ol>
<p>è¯´å®è¯ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡é‚£å—æˆ‘è¿˜æ²¡ç ”ç©¶é€ï¼ŒSeataçš„ATæ¨¡å¼çœ‹ç€æœ‰ç‚¹æ‡µï¼Œå‡†å¤‡å…ˆæŠŠåŸç†æ‘¸æ¸…æ¥šå†è¯´ã€‚</p>
<h2 data-id="heading-17">å†™åœ¨æœ€å</h2>
<p>è¿™æ¬¡æ‰‹å†™äº‹åŠ¡æ¡†æ¶ï¼Œæœ€å¤§çš„æ”¶è·æ˜¯ï¼š<strong>ä¸è¦æ€•é€ è½®å­</strong>ã€‚</p>
<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¼šè§‰å¾—"Springéƒ½å®ç°äº†ï¼Œæˆ‘è¿˜é€ å•¥è½®å­"ã€‚ä½†å…¶å®ï¼Œè‡ªå·±åŠ¨æ‰‹å®ç°ä¸€éï¼Œå’Œåªçœ‹æºç ã€çœ‹æ–‡æ¡£ï¼Œç†è§£æ·±åº¦å®Œå…¨ä¸ä¸€æ ·ã€‚</p>
<p>å°±åƒæˆ‘ç°åœ¨ï¼Œä»¥åçœ‹åˆ°@Transactionalï¼Œè„‘å­é‡Œèƒ½ç›´æ¥æµ®ç°å‡ºé‚£ä¸ªinvokeæ–¹æ³•ã€ThreadLocalçš„ä¸Šä¸‹æ–‡ã€commitå’Œrollbackçš„é€»è¾‘ï¼Œè¿™ç§æ„Ÿè§‰è¿˜æ˜¯æŒºçˆ½çš„ã€‚</p>
<p>è€Œä¸”ï¼Œè¿™200è¡Œä»£ç å†™å®Œï¼Œæˆ‘å¯¹äº‹åŠ¡ç›¸å…³çš„é¢è¯•é¢˜åŸºæœ¬éƒ½èƒ½ç­”ä¸Šæ¥äº†ï¼š</p>
<ul>
<li>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯å•¥ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆåŒç±»æ–¹æ³•è°ƒç”¨äº‹åŠ¡ä¸ç”Ÿæ•ˆï¼Ÿ</li>
<li>å—æ£€å¼‚å¸¸é»˜è®¤ä¸å›æ»šæ˜¯ä¸ºå•¥ï¼Ÿ</li>
<li>å¤šçº¿ç¨‹æƒ…å†µä¸‹äº‹åŠ¡æ€ä¹ˆéš”ç¦»ï¼Ÿ</li>
</ul>
<p>è¿™äº›é—®é¢˜ï¼Œä»¥å‰æ˜¯é èƒŒï¼Œç°åœ¨æ˜¯çœŸæ‡‚äº†ã€‚</p>
<p>ä»£ç æˆ‘æ”¾åˆ°giteeäº†ï¼ˆé“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fsh_wangwanbao%2Fsimple-spring-transaction" target="_blank" title="https://gitee.com/sh_wangwanbao/simple-spring-transaction" ref="nofollow noopener noreferrer">gitee.com/sh_wangwanbâ€¦</a> )
æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥cloneä¸‹æ¥è·‘è·‘çœ‹ã€‚ä¸‹ä¸€ç¯‡æˆ‘æ‰“ç®—å†™REQUIRES_NEWçš„å®ç°ï¼Œæ¶‰åŠåˆ°äº‹åŠ¡æŒ‚èµ·å’Œæ¢å¤ï¼Œåº”è¯¥ä¼šæ›´æœ‰æ„æ€ã€‚</p>
<hr/>
<p><strong>ä½ ä»¬åœ¨ç”¨äº‹åŠ¡çš„æ—¶å€™ï¼Œè¸©è¿‡å“ªäº›å‘ï¼Ÿæ¬¢è¿è¯„è®ºåŒºèŠèŠï¼Œè¯´ä¸å®šèƒ½å¸®æˆ‘é¿å…åé¢çš„ä¸€äº›é—®é¢˜ã€‚</strong></p>
<p>å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¾›è‹¦ç‚¹ä¸ªèµæ”¯æŒä¸‹å‘—ã€‚æ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼Œè°¢è°¢ã€‚</p>
<p>ä¸‹ç¯‡æ–‡ç« è§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5ä¸ªæµ‹è¯•ç”¨ä¾‹å¸¦ä½ å½»åº•ç†è§£Springäº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼ˆ é™„å®Œæ•´æºä»£ç ï¼‰]]></title>    <link>https://juejin.cn/post/7577690150093291560</link>    <guid>https://juejin.cn/post/7577690150093291560</guid>    <pubDate>2025-11-30T03:35:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577690150093291560" data-draft-id="7577713754563215412" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5ä¸ªæµ‹è¯•ç”¨ä¾‹å¸¦ä½ å½»åº•ç†è§£Springäº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼ˆ é™„å®Œæ•´æºä»£ç ï¼‰"/> <meta itemprop="keywords" content="Spring,Spring Boot,Spring Cloud"/> <meta itemprop="datePublished" content="2025-11-30T03:35:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5ä¸ªæµ‹è¯•ç”¨ä¾‹å¸¦ä½ å½»åº•ç†è§£Springäº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼ˆ é™„å®Œæ•´æºä»£ç ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T03:35:27.000Z" title="Sun Nov 30 2025 03:35:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">5ä¸ªæµ‹è¯•ç”¨ä¾‹å¸¦ä½ å½»åº•ç†è§£Springäº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼ˆ é™„å®Œæ•´æºä»£ç ï¼‰</h2>
<h3 data-id="heading-1">å†™åœ¨å‰é¢</h3>
<p>è¯´å®è¯ï¼ŒSpringäº‹åŠ¡ä¼ æ’­è¡Œä¸ºè¿™å—ï¼Œæˆ‘ä¹‹å‰ä¸€ç›´æ˜¯åŠæ‡‚ä¸æ‡‚çš„çŠ¶æ€ã€‚</p>
<p>é¢è¯•çš„æ—¶å€™èƒ½èƒŒå‡ºæ¥7ç§ä¼ æ’­è¡Œä¸ºï¼ŒREQUIREDã€REQUIRES_NEWã€NESTEDå•¥çš„ï¼Œä½†è¦é—®æˆ‘"å†…å±‚æ–¹æ³•æŠ›å¼‚å¸¸ï¼Œå¤–å±‚ä¼šä¸ä¼šå›æ»š"ï¼Œæˆ‘å°±å¼€å§‹å¿ƒè™šäº†ã€‚çœ‹ç½‘ä¸Šçš„æ–‡ç« ï¼Œè¦ä¹ˆå¤ªç†è®ºè®²ä¸æ¸…æ¥šï¼Œè¦ä¹ˆç›´æ¥è´´Springæºç è®©äººæ›´æ™•ã€‚</p>
<p>åæ¥æˆ‘å¹²è„†è‡ªå·±æ‰‹å†™äº†ä¸ªç®€åŒ–ç‰ˆçš„äº‹åŠ¡æ¡†æ¶ï¼ˆä¸Šç¯‡æ–‡ç« å†™è¿‡ï¼‰ï¼ŒæŠŠæ ¸å¿ƒé€»è¾‘å‰¥å‡ºæ¥ï¼Œç„¶åå†™äº†5ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œä¸€ä¸ªä¸ªè·‘ä¸€éã€‚ç°åœ¨å¯ä»¥æ‹ç€èƒ¸è„¯è¯´ï¼š<strong>äº‹åŠ¡ä¼ æ’­è¿™å—ï¼Œæˆ‘æ˜¯çœŸæ‡‚äº†</strong>ã€‚</p>
<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œå°±å¸¦ä½ é€šè¿‡è¿™5ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ŒæŠŠäº‹åŠ¡ä¼ æ’­è¡Œä¸ºå½»åº•ææ˜ç™½ã€‚</p>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆä¼ æ’­è¡Œä¸ºè¿™ä¹ˆéš¾ç†è§£ï¼Ÿ</h3>
<p>æˆ‘è§‰å¾—ä¸»è¦æ˜¯ä¸¤ä¸ªåŸå› ï¼š</p>
<ol>
<li>
<p><strong>åœºæ™¯å¤ªæŠ½è±¡</strong>ï¼šæ–‡æ¡£é‡Œè¯´"æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æ–°å»º"ï¼Œä½†"åŠ å…¥"åˆ°åº•æ˜¯å•¥æ„æ€ï¼Ÿå…±äº«ä¸€ä¸ªè¿æ¥ï¼Ÿè¿˜æ˜¯å¼€ä¸ªå­äº‹åŠ¡ï¼Ÿ</p>
</li>
<li>
<p><strong>å¼‚å¸¸å¤„ç†å¤æ‚</strong>ï¼šå†…å±‚æ–¹æ³•æŠ›å¼‚å¸¸ï¼Œå¤–å±‚è¦ä¸è¦å›æ»šï¼Ÿå†…å±‚å›æ»šäº†ï¼Œå¤–å±‚è¿˜èƒ½æäº¤å—ï¼Ÿè¿™äº›è¾¹ç•Œæƒ…å†µå¾ˆå®¹æ˜“ææ··ã€‚</p>
</li>
</ol>
<p>æ‰€ä»¥æˆ‘çš„æ€è·¯æ˜¯ï¼š<strong>ç”¨å®é™…ä»£ç è·‘ä¸€éï¼Œçœ‹çœ‹æ•°æ®åº“é‡Œåˆ°åº•æœ‰æ²¡æœ‰æ•°æ®ï¼Œæ¯”çœ‹ä¸€ä¸‡å­—çš„æ–‡æ¡£éƒ½ç®¡ç”¨</strong>ã€‚</p>
<h3 data-id="heading-3">æµ‹è¯•ç¯å¢ƒå‡†å¤‡</h3>
<p>ä¸ºäº†è®©å¤§å®¶èƒ½ç›´æ¥å¤ç°ï¼Œæˆ‘å…ˆè¯´è¯´ç¯å¢ƒï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ•°æ®åº“ï¼šMySQL 8.x</span>
<span class="hljs-keyword">CREATE</span> DATABASE sst_demo;

<span class="hljs-comment">-- è®¢å•è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (
  id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
  order_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span>,
  user_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  total_amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  status TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);

<span class="hljs-comment">-- è®¢å•æ˜ç»†è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> order_items (
  id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
  order_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  sku <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  quantity <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
);
</code></pre>
<p>ä¸šåŠ¡åœºæ™¯å°±æ˜¯ä¸‹å•ï¼šæ’å…¥è®¢å•ä¸»è¡¨ + æ’å…¥æ˜ç»†è¡¨ï¼Œè¿™ä¸¤æ­¥è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚</p>
<h3 data-id="heading-4">æµ‹è¯•1ï¼šæ­£å¸¸æäº¤ - æœ€åŸºç¡€çš„åœºæ™¯</h3>
<h4 data-id="heading-5">ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">(String userId, String sku, <span class="hljs-type">int</span> quantity)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> TransactionContext.getCurrentConnection();
    
    <span class="hljs-comment">// 1. æ’å…¥è®¢å•</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">orderNo</span> <span class="hljs-operator">=</span> <span class="hljs-string">"ORD-"</span> + UUID.randomUUID();
    <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> conn.prepareStatement(
        <span class="hljs-string">"INSERT INTO orders(order_no, user_id, total_amount) VALUES(?, ?, ?)"</span>
    );
    ps.setString(<span class="hljs-number">1</span>, orderNo);
    ps.setString(<span class="hljs-number">2</span>, userId);
    ps.setBigDecimal(<span class="hljs-number">3</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"99.99"</span>));
    ps.executeUpdate();
    
    <span class="hljs-comment">// 2. æ’å…¥æ˜ç»†</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> getGeneratedId(ps);
    <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps2</span> <span class="hljs-operator">=</span> conn.prepareStatement(
        <span class="hljs-string">"INSERT INTO order_items(order_id, sku, quantity, price) VALUES(?, ?, ?, ?)"</span>
    );
    ps2.setLong(<span class="hljs-number">1</span>, orderId);
    ps2.setString(<span class="hljs-number">2</span>, sku);
    ps2.setInt(<span class="hljs-number">3</span>, quantity);
    ps2.setBigDecimal(<span class="hljs-number">4</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"99.99"</span>));
    ps2.executeUpdate();
    
    System.out.println(<span class="hljs-string">"è®¢å•åˆ›å»ºæˆåŠŸï¼š"</span> + orderNo);
}
</code></pre>
<h4 data-id="heading-6">è¿è¡Œç»“æœ</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">========== æµ‹è¯•1ï¼šæ­£å¸¸æäº¤ ==========</span>
è®¢å•åˆ›å»ºæˆåŠŸï¼šORD-xxx
è®¢å•åˆ›å»ºæˆåŠŸ
</code></pre>
<h4 data-id="heading-7">éªŒè¯</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-string">'U1001'</span>;
<span class="hljs-comment">-- ç»“æœï¼šæœ‰1æ¡è®°å½•</span>

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_items <span class="hljs-keyword">WHERE</span> order_id<span class="hljs-operator">=</span>...;
<span class="hljs-comment">-- ç»“æœï¼šæœ‰1æ¡è®°å½•</span>
</code></pre>
<h4 data-id="heading-8">åŸç†è§£æ</h4>
<p>è¿™ä¸ªæœ€ç®€å•ï¼Œæ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client
    participant Proxy
    participant Interceptor
    participant TxManager
    participant DB
    
    Client-&gt;&gt;Proxy: placeOrder()
    Proxy-&gt;&gt;Interceptor: æ‹¦æˆªè°ƒç”¨
    Interceptor-&gt;&gt;TxManager: begin() å¼€å¯äº‹åŠ¡
    TxManager-&gt;&gt;DB: setAutoCommit(false)
    Interceptor-&gt;&gt;DB: INSERT orders
    Interceptor-&gt;&gt;DB: INSERT order_items
    Interceptor-&gt;&gt;TxManager: commit()
    TxManager-&gt;&gt;DB: conn.commit()
    TxManager-&gt;&gt;DB: close()
</code></pre>
<p>å…³é”®ç‚¹ï¼š</p>
<ol>
<li>æ‹¦æˆªå™¨åœ¨æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨<code>begin()</code>ï¼Œæ‹¿åˆ°æ•°æ®åº“è¿æ¥å¹¶å…³é—­è‡ªåŠ¨æäº¤</li>
<li>ä¸šåŠ¡ä»£ç æ‰§è¡Œï¼Œåœ¨åŒä¸€ä¸ªè¿æ¥ä¸Šæ‰§è¡Œä¸¤æ¡INSERT</li>
<li>æ–¹æ³•æ­£å¸¸è¿”å›ï¼Œæ‹¦æˆªå™¨è°ƒç”¨<code>commit()</code></li>
<li>æœ€åæ¸…ç†èµ„æºï¼Œæ¢å¤autoCommitå¹¶å…³é—­è¿æ¥</li>
</ol>
<p>è¿™å°±æ˜¯äº‹åŠ¡çš„åŸºæœ¬æµç¨‹ï¼Œæ²¡å•¥ç‰¹åˆ«çš„ã€‚</p>
<h3 data-id="heading-9">æµ‹è¯•2ï¼šè¿è¡Œæ—¶å¼‚å¸¸å›æ»š - Springçš„é»˜è®¤è¡Œä¸º</h3>
<h4 data-id="heading-10">ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸šåŠ¡ä»£ç é‡Œæ¨¡æ‹Ÿåº“å­˜ä¸è¶³</span>
<span class="hljs-keyword">if</span> (<span class="hljs-string">"OUT_OF_STOCK"</span>.equals(sku)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"åº“å­˜ä¸è¶³ï¼Œè®¢å•å›æ»š"</span>);
}
</code></pre>
<h4 data-id="heading-11">è¿è¡Œç»“æœ</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">========== æµ‹è¯•2ï¼šè¿è¡Œæ—¶å¼‚å¸¸å›æ»š ==========</span>
æ•è·è¿è¡Œæ—¶å¼‚å¸¸ï¼šåº“å­˜ä¸è¶³ï¼Œè®¢å•å›æ»š
</code></pre>
<h4 data-id="heading-12">éªŒè¯</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-string">'U1002'</span>;
<span class="hljs-comment">-- ç»“æœï¼šæ— è®°å½•</span>

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_items <span class="hljs-keyword">WHERE</span> sku<span class="hljs-operator">=</span><span class="hljs-string">'OUT_OF_STOCK'</span>;
<span class="hljs-comment">-- ç»“æœï¼šæ— è®°å½•</span>
</code></pre>
<h4 data-id="heading-13">åŸç†è§£æ</h4>
<p>è¿™ä¸ªæ˜¯Springçš„<strong>é»˜è®¤å›æ»šè§„åˆ™</strong>ï¼šRuntimeExceptionå’ŒErrorä¼šå¯¼è‡´å›æ»šã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client
    participant Interceptor
    participant TxManager
    participant DB
    
    Client-&gt;&gt;Interceptor: placeOrder()
    Interceptor-&gt;&gt;TxManager: begin()
    TxManager-&gt;&gt;DB: setAutoCommit(false)
    Interceptor-&gt;&gt;DB: INSERT orders (æˆåŠŸ)
    Interceptor-&gt;&gt;DB: INSERT order_items (æˆåŠŸ)
    Interceptor-&gt;&gt;Interceptor: æŠ›RuntimeException
    Interceptor-&gt;&gt;TxManager: rollback()
    TxManager-&gt;&gt;DB: conn.rollback()
    
    Note over DB: orderså’Œorder_itemséƒ½è¢«å›æ»š
</code></pre>
<p>å…³é”®ç‚¹ï¼š</p>
<ol>
<li>è™½ç„¶ä¸¤æ¡INSERTéƒ½æ‰§è¡ŒæˆåŠŸäº†ï¼Œä½†è¿˜æ²¡commit</li>
<li>æŠ›å‡ºRuntimeExceptionåï¼Œæ‹¦æˆªå™¨æ•è·å¼‚å¸¸</li>
<li>åˆ¤æ–­æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼Œè°ƒç”¨<code>rollback()</code></li>
<li>æ•°æ®åº“å›æ»šï¼Œä¸¤æ¡è®°å½•éƒ½ä¸ä¼šä¿å­˜</li>
</ol>
<p>è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œæˆ‘ä¹‹å‰è¸©è¿‡å‘çš„æ˜¯ä¸‹ä¸€ä¸ªåœºæ™¯ã€‚</p>
<h3 data-id="heading-14">æµ‹è¯•3ï¼šå—æ£€å¼‚å¸¸å›æ»š - å®¹æ˜“è¢«å¿½ç•¥çš„å‘</h3>
<h4 data-id="heading-15">ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸šåŠ¡ä»£ç é‡ŒæŠ›å—æ£€å¼‚å¸¸</span>
<span class="hljs-keyword">if</span> (<span class="hljs-string">"INVALID_SKU"</span>.equals(sku)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">"æ— æ•ˆçš„SKUï¼Œè®¢å•å›æ»š"</span>);  <span class="hljs-comment">// æ³¨æ„ï¼šè¿™æ˜¯Exceptionï¼Œä¸æ˜¯RuntimeException</span>
}
</code></pre>
<h4 data-id="heading-16">è¿è¡Œç»“æœï¼ˆå¦‚æœæ²¡åŠ rollbackForï¼‰</h4>
<p>å‡è®¾æˆ‘ä»¬çš„@Transactionalæ²¡æœ‰é…ç½®rollbackForï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>  <span class="hljs-comment">// æ²¡æœ‰rollbackFor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// æŠ›Exception</span>
}
</code></pre>
<p><strong>æ‚²å‰§å‘ç”Ÿäº†</strong>ï¼šæ•°æ®åº“é‡Œæœ‰æ•°æ®ï¼</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-string">'U1003'</span>;
<span class="hljs-comment">-- ç»“æœï¼šæœ‰1æ¡è®°å½•ï¼ï¼ï¼</span>
</code></pre>
<h4 data-id="heading-17">ä¸ºä»€ä¹ˆï¼Ÿ</h4>
<p>å› ä¸ºSpringçš„é»˜è®¤è§„åˆ™ï¼š<strong>å—æ£€å¼‚å¸¸ï¼ˆExceptionï¼‰ä¸å›æ»šï¼Œåªæäº¤</strong>ã€‚</p>
<p>æˆ‘å½“æ—¶ç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒå·®ç‚¹å‡ºäº‹æ•…ã€‚ä¸šåŠ¡ä»£ç æŠ›äº†ä¸ªè‡ªå®šä¹‰çš„<code>BusinessException</code>ï¼ˆç»§æ‰¿è‡ªExceptionï¼‰ï¼Œæˆ‘ä»¥ä¸ºä¼šå›æ»šï¼Œç»“æœæ•°æ®éƒ½å…¥åº“äº†ã€‚</p>
<h4 data-id="heading-18">æ­£ç¡®åšæ³•</h4>
<p>å¿…é¡»æ˜¾å¼æŒ‡å®šrollbackForï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>  <span class="hljs-comment">// æ‰€æœ‰å¼‚å¸¸éƒ½å›æ»š</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>ç°åœ¨å†è·‘ï¼š</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">========== æµ‹è¯•3ï¼šå—æ£€å¼‚å¸¸å›æ»š ==========</span>
æ•è·å—æ£€å¼‚å¸¸ï¼šæ— æ•ˆçš„SKUï¼Œè®¢å•å›æ»š
</code></pre>
<p>éªŒè¯ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-string">'U1003'</span>;
<span class="hljs-comment">-- ç»“æœï¼šæ— è®°å½• </span>
</code></pre>
<h4 data-id="heading-19">å¼‚å¸¸å›æ»šè§„åˆ™æ€»ç»“</h4>
<p>è¿™ä¸ªè¡¨å»ºè®®ä¿å­˜ä¸‹æ¥ï¼Œé¢è¯•å¸¸è€ƒï¼š</p>






























<table><thead><tr><th>å¼‚å¸¸ç±»å‹</th><th>é»˜è®¤è¡Œä¸º</th><th>rollbackForé…ç½®å</th></tr></thead><tbody><tr><td>RuntimeException</td><td>å›æ»š</td><td>å›æ»š</td></tr><tr><td>Error</td><td>å›æ»š</td><td>å›æ»š</td></tr><tr><td>Exceptionï¼ˆå—æ£€å¼‚å¸¸ï¼‰</td><td><strong>æäº¤</strong></td><td>å›æ»š</td></tr><tr><td>è‡ªå®šä¹‰å¼‚å¸¸extends Exception</td><td><strong>æäº¤</strong></td><td>éœ€æ˜¾å¼é…ç½®</td></tr></tbody></table>
<p>æˆ‘çš„å»ºè®®ï¼š<strong>ç”Ÿäº§ç¯å¢ƒç»Ÿä¸€åŠ ä¸Š<code>rollbackFor = Exception.class</code></strong>ï¼Œé¿å…æ¼æ‰å—æ£€å¼‚å¸¸ã€‚</p>
<h3 data-id="heading-20">æµ‹è¯•4ï¼šREQUIREDä¼ æ’­ - å¤–å†…å±‚ç»Ÿä¸€æäº¤</h3>
<p>å¥½ï¼Œå‰é¢3ä¸ªæµ‹è¯•éƒ½æ˜¯å•æ–¹æ³•çš„ï¼Œç°åœ¨è¿›å…¥é‡ç‚¹ï¼š<strong>æ–¹æ³•åµŒå¥—è°ƒç”¨æ—¶çš„ä¼ æ’­è¡Œä¸º</strong>ã€‚</p>
<h4 data-id="heading-21">åœºæ™¯è®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¤–å±‚æœåŠ¡</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrderWithInner</span><span class="hljs-params">(String userId, String sku, <span class="hljs-type">int</span> quantity)</span> {
    <span class="hljs-comment">// 1. æ’å…¥å¤–å±‚è®¢å•</span>
    insertOuterOrder(userId, sku);
    
    <span class="hljs-comment">// 2. è°ƒç”¨å†…å±‚æœåŠ¡</span>
    innerService.createOrderItem(orderId, sku, quantity);
    
    System.out.println(<span class="hljs-string">"å¤–å±‚æ–¹æ³•æ‰§è¡Œå®Œæˆ"</span>);
}

<span class="hljs-comment">// å†…å±‚æœåŠ¡</span>
<span class="hljs-meta">@Transactional</span>  <span class="hljs-comment">// é»˜è®¤REQUIRED</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrderItem</span><span class="hljs-params">(<span class="hljs-type">long</span> orderId, String sku, <span class="hljs-type">int</span> quantity)</span> {
    <span class="hljs-comment">// æ’å…¥è®¢å•æ˜ç»†</span>
    insertOrderItem(orderId, sku, quantity);
    
    System.out.println(<span class="hljs-string">"å†…å±‚æ–¹æ³•æ‰§è¡Œå®Œæˆ"</span>);
}
</code></pre>
<h4 data-id="heading-22">å…³é”®é—®é¢˜</h4>
<p>å¤–å±‚å’Œå†…å±‚å„æœ‰ä¸€ä¸ª@Transactionalï¼Œè¿™ä¼šå¼€å‡ ä¸ªäº‹åŠ¡ï¼Ÿ</p>
<p>å¾ˆå¤šäººä¼šè¯´"ä¸¤ä¸ªäº‹åŠ¡"ï¼Œ<strong>é”™äº†</strong>ï¼</p>
<h4 data-id="heading-23">è¿è¡Œç»“æœ</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">========== ä¼ æ’­ï¼šç»Ÿä¸€æäº¤ ==========</span>
å¤–å±‚è®¢å•åˆ›å»ºæˆåŠŸï¼šORD-xxx
å†…å±‚æ˜ç»†åˆ›å»ºæˆåŠŸ
å†…å±‚æ–¹æ³•æ‰§è¡Œå®Œæˆ
å¤–å±‚æ–¹æ³•æ‰§è¡Œå®Œæˆ
å¤–å†…å±‚å‡æˆåŠŸï¼Œç»Ÿä¸€æäº¤
</code></pre>
<p>éªŒè¯ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-string">'U2001'</span>;
<span class="hljs-comment">-- æœ‰è®°å½•</span>

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_items <span class="hljs-keyword">WHERE</span> order_id<span class="hljs-operator">=</span>...;
<span class="hljs-comment">-- æœ‰è®°å½•</span>
</code></pre>
<h4 data-id="heading-24">åŸç†ï¼šREQUIREDåªæœ‰ä¸€ä¸ªäº‹åŠ¡</h4>
<p>è¿™æ˜¯REQUIREDä¼ æ’­çš„æ ¸å¿ƒï¼š<strong>æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æ–°å»º</strong>ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Outer
    participant OuterInterceptor
    participant Inner
    participant InnerInterceptor
    participant TxContext
    participant DB
    
    Outer-&gt;&gt;OuterInterceptor: placeOrderWithInner()
    OuterInterceptor-&gt;&gt;TxContext: begin() å¼€å¯äº‹åŠ¡
    TxContext-&gt;&gt;DB: è·å–è¿æ¥ï¼ŒsetAutoCommit(false)
    OuterInterceptor-&gt;&gt;DB: INSERT orders
    OuterInterceptor-&gt;&gt;Inner: è°ƒç”¨createOrderItem()
    Inner-&gt;&gt;InnerInterceptor: æ‹¦æˆª
    InnerInterceptor-&gt;&gt;TxContext: æ£€æŸ¥æ˜¯å¦å·²æœ‰äº‹åŠ¡
    TxContext--&gt;&gt;InnerInterceptor: æœ‰äº‹åŠ¡ï¼Œç›´æ¥åŠ å…¥
    InnerInterceptor-&gt;&gt;DB: INSERT order_items (ç”¨åŒä¸€ä¸ªconn)
    InnerInterceptor--&gt;&gt;OuterInterceptor: è¿”å›
    OuterInterceptor-&gt;&gt;TxContext: commit()
    TxContext-&gt;&gt;DB: conn.commit() ä¸€æ¬¡æ€§æäº¤æ‰€æœ‰æ“ä½œ
</code></pre>
<p>å…³é”®ç‚¹ï¼š</p>
<ol>
<li>å¤–å±‚å¼€å¯äº‹åŠ¡ï¼ŒæŠŠConnectionæ”¾åˆ°ThreadLocal</li>
<li>å†…å±‚å‘ç°ThreadLocalé‡Œå·²ç»æœ‰äº‹åŠ¡äº†ï¼Œ<strong>ç›´æ¥å¤ç”¨è¿™ä¸ªè¿æ¥</strong></li>
<li>å†…å¤–å±‚çš„SQLéƒ½åœ¨åŒä¸€ä¸ªConnectionä¸Šæ‰§è¡Œ</li>
<li>æœ€åå¤–å±‚ç»Ÿä¸€commitï¼Œä¸€æ¬¡æ€§æäº¤æ‰€æœ‰æ“ä½œ</li>
</ol>
<p>æ‰€ä»¥ï¼š<strong>REQUIREDä¼ æ’­ä¸‹ï¼ŒåµŒå¥—è°ƒç”¨å…±äº«ä¸€ä¸ªäº‹åŠ¡</strong>ã€‚</p>
<h3 data-id="heading-25">æµ‹è¯•5ï¼šREQUIREDä¼ æ’­ - å†…å±‚å¤±è´¥æ•´ä½“å›æ»šï¼ˆéš¾ç‚¹ï¼‰</h3>
<p>è¿™ä¸ªæ˜¯æœ€å®¹æ˜“ææ··çš„åœºæ™¯ï¼Œé¢è¯•ç»å¸¸é—®ã€‚</p>
<h4 data-id="heading-26">ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å†…å±‚æœåŠ¡æ¨¡æ‹Ÿå¤±è´¥</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrderItem</span><span class="hljs-params">(<span class="hljs-type">long</span> orderId, String sku, <span class="hljs-type">int</span> quantity)</span> {
    insertOrderItem(orderId, sku, quantity);
    
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"FAIL_INNER"</span>.equals(sku)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å†…å±‚å¤±è´¥"</span>);  <span class="hljs-comment">// æŠ›å¼‚å¸¸</span>
    }
}
</code></pre>
<h4 data-id="heading-27">è¿è¡Œç»“æœ</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">========== ä¼ æ’­ï¼šå†…å±‚å¤±è´¥æ•´ä½“å›æ»š ==========</span>
æ•è·å†…å±‚å¼‚å¸¸ï¼šå†…å±‚å¤±è´¥
</code></pre>
<h4 data-id="heading-28">éªŒè¯ï¼ˆé‡ç‚¹ï¼‰</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-string">'U2002'</span>;
<span class="hljs-comment">-- ç»“æœï¼šæ— è®°å½•</span>

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_items <span class="hljs-keyword">WHERE</span> sku<span class="hljs-operator">=</span><span class="hljs-string">'FAIL_INNER'</span>;
<span class="hljs-comment">-- ç»“æœï¼šæ— è®°å½•</span>
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šå¤–å±‚çš„è®¢å•ä¹Ÿå›æ»šäº†ï¼è™½ç„¶å¤–å±‚ä»£ç æ²¡æŠ›å¼‚å¸¸ã€‚</p>
<h4 data-id="heading-29">ä¸ºä»€ä¹ˆå¤–å±‚ä¹Ÿå›æ»šäº†ï¼Ÿ</h4>
<p>å¾ˆå¤šäººä¼šæƒ³ï¼šå†…å±‚æŠ›å¼‚å¸¸ï¼Œå†…å±‚å›æ»šå°±å¥½äº†ï¼Œå¤–å±‚ç»§ç»­æäº¤ä¸è¡Œå—ï¼Ÿ</p>
<p><strong>ä¸è¡Œï¼å› ä¸ºå®ƒä»¬å…±äº«åŒä¸€ä¸ªäº‹åŠ¡ï¼ˆåŒä¸€ä¸ªConnectionï¼‰</strong>ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹å…·ä½“æµç¨‹ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Outer
    participant OuterInterceptor
    participant Inner
    participant InnerInterceptor
    participant TxContext
    
    Outer-&gt;&gt;OuterInterceptor: placeOrderWithInner()
    OuterInterceptor-&gt;&gt;TxContext: begin() å¤–å±‚å¼€å¯
    OuterInterceptor-&gt;&gt;Outer: INSERT orders
    OuterInterceptor-&gt;&gt;Inner: è°ƒç”¨å†…å±‚
    Inner-&gt;&gt;InnerInterceptor: æ‹¦æˆª
    InnerInterceptor-&gt;&gt;TxContext: æ£€æŸ¥ï¼Œå·²æœ‰äº‹åŠ¡ï¼ŒåŠ å…¥
    InnerInterceptor-&gt;&gt;Inner: INSERT order_items
    Inner-&gt;&gt;Inner: æŠ›RuntimeException
    InnerInterceptor-&gt;&gt;InnerInterceptor: catchåˆ°å¼‚å¸¸
    InnerInterceptor-&gt;&gt;TxContext: setRollbackOnly() æ‰“æ ‡è®°
    InnerInterceptor--&gt;&gt;OuterInterceptor: å¼‚å¸¸å‘ä¸ŠæŠ›
    OuterInterceptor-&gt;&gt;OuterInterceptor: catchåˆ°å¼‚å¸¸
    OuterInterceptor-&gt;&gt;TxContext: commit() å°è¯•æäº¤
    TxContext-&gt;&gt;TxContext: æ£€æŸ¥rollbackOnly=true
    TxContext-&gt;&gt;TxContext: æ‰§è¡Œrollback() æ•´ä½“å›æ»š
    
    Note over TxContext: orderså’Œorder_itemséƒ½å›æ»š
</code></pre>
<p>å…³é”®ç‚¹ï¼š</p>
<ol>
<li>å†…å±‚æŠ›å¼‚å¸¸åï¼Œ<strong>ä¸èƒ½ç›´æ¥rollback</strong>ï¼ˆå› ä¸ºäº‹åŠ¡æ˜¯å¤–å±‚å¼€çš„ï¼‰</li>
<li>å†…å±‚åªèƒ½æ‰“ä¸ªæ ‡è®°ï¼š<code>setRollbackOnly(true)</code></li>
<li>å¼‚å¸¸ç»§ç»­å‘ä¸ŠæŠ›ï¼Œå¤–å±‚æ•è·</li>
<li>å¤–å±‚å°è¯•commitæ—¶ï¼Œå‘ç°æœ‰rollbackOnlyæ ‡è®°</li>
<li>æœ€ç»ˆæ‰§è¡Œrollbackï¼Œ<strong>æ•´ä¸ªäº‹åŠ¡å›æ»š</strong></li>
</ol>
<p>è¿™å°±æ˜¯REQUIREDçš„"ç»Ÿä¸€è¿›é€€"ï¼šè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚</p>
<h4 data-id="heading-30">å®é™…ä»£ç æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h4>
<p>æˆ‘æ‰‹å†™æ¡†æ¶é‡Œçš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ‹¦æˆªå™¨é€»è¾‘</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);
    
    <span class="hljs-keyword">if</span> (started) {  <span class="hljs-comment">// å¦‚æœæ˜¯æˆ‘å¼€å¯çš„äº‹åŠ¡</span>
        <span class="hljs-keyword">if</span> (TransactionContext.isRollbackOnly()) {
            txManager.rollback();  <span class="hljs-comment">// æœ‰äººæ ‡è®°äº†å›æ»š</span>
        } <span class="hljs-keyword">else</span> {
            txManager.commit();
        }
    }
    <span class="hljs-keyword">return</span> result;
    
} <span class="hljs-keyword">catch</span> (InvocationTargetException e) {
    <span class="hljs-type">Throwable</span> <span class="hljs-variable">ex</span> <span class="hljs-operator">=</span> e.getTargetException();
    
    <span class="hljs-keyword">if</span> (shouldRollback(ex)) {
        <span class="hljs-keyword">if</span> (started) {
            txManager.rollback();  <span class="hljs-comment">// æˆ‘å¼€çš„äº‹åŠ¡ï¼Œæˆ‘è´Ÿè´£å›æ»š</span>
        } <span class="hljs-keyword">else</span> {
            TransactionContext.setRollbackOnly();  <span class="hljs-comment">// ä¸æ˜¯æˆ‘å¼€çš„ï¼Œæ‰“æ ‡è®°</span>
        }
    }
    <span class="hljs-keyword">throw</span> ex;
}
</code></pre>
<p>è¿™ä¸ª<code>started</code>æ ‡å¿—å¾ˆå…³é”®ï¼š</p>
<ul>
<li><strong>å¤–å±‚</strong>ï¼šstarted=trueï¼ˆæˆ‘å¼€çš„äº‹åŠ¡ï¼‰</li>
<li><strong>å†…å±‚</strong>ï¼šstarted=falseï¼ˆåŠ å…¥çš„äº‹åŠ¡ï¼‰</li>
</ul>
<p>æ‰€ä»¥ï¼š</p>
<ul>
<li>å†…å±‚æŠ›å¼‚å¸¸ï¼šåªæ‰“æ ‡è®°ï¼Œä¸ç›´æ¥å›æ»š</li>
<li>å¤–å±‚æ‹¿åˆ°æ ‡è®°ï¼šæ‰§è¡Œå›æ»š</li>
</ul>
<h3 data-id="heading-31">å‡ ä¸ªå®¹æ˜“è¸©çš„å‘</h3>
<h4 data-id="heading-32">å‘1ï¼šä»¥ä¸ºå†…å±‚å¯ä»¥ç‹¬ç«‹å›æ»š</h4>
<p>é”™è¯¯è®¤çŸ¥ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    innerService.createOrderItem();  <span class="hljs-comment">// å†…å±‚å¤±è´¥</span>
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-comment">// ä»¥ä¸ºcatchä½äº†å°±æ²¡äº‹</span>
}
<span class="hljs-comment">// ä»¥ä¸ºå¤–å±‚å¯ä»¥ç»§ç»­æäº¤</span>
</code></pre>
<p>çœŸç›¸ï¼š<strong>catchä½ä¹Ÿæ²¡ç”¨ï¼Œäº‹åŠ¡å·²ç»è¢«æ ‡è®°ä¸ºrollbackOnly</strong>ã€‚</p>
<h4 data-id="heading-33">å‘2ï¼šåŒç±»æ–¹æ³•è°ƒç”¨ä¸ç”Ÿæ•ˆ</h4>
<p>è¿™ä¸ªæ˜¯ç»å…¸é—®é¢˜ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span> {
        methodB();  <span class="hljs-comment">// ç›´æ¥è°ƒç”¨</span>
    }
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è¿™ä¸ª@Transactionalä¸ç”Ÿæ•ˆï¼</span>
    }
}
</code></pre>
<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºä»£ç†åªèƒ½æ‹¦æˆª<strong>å¤–éƒ¨è°ƒç”¨</strong>ï¼Œå†…éƒ¨è°ƒç”¨èµ°çš„æ˜¯thisï¼Œä¸ç»è¿‡ä»£ç†ã€‚</p>
<p>è§£å†³åŠæ³•ï¼šæ‹†åˆ°ä¸åŒçš„ç±»ï¼Œæˆ–è€…é€šè¿‡æ³¨å…¥æ‹¿åˆ°ä»£ç†å¯¹è±¡ã€‚</p>
<h4 data-id="heading-34">å‘3ï¼šå¿˜è®°é…ç½®rollbackFor</h4>
<p>ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>  <span class="hljs-comment">// ç»Ÿä¸€é…ç½®</span>
</code></pre>
<p>ä¸è¦ä¾èµ–é»˜è®¤è¡Œä¸ºï¼Œå¦åˆ™å—æ£€å¼‚å¸¸ä¼šè®©ä½ æŠ“ç‹‚ã€‚</p>
<h3 data-id="heading-35">ä¼ æ’­è¡Œä¸ºå¯¹æ¯”è¡¨</h3>
<p>è™½ç„¶æˆ‘è¿™ä¸ªç®€åŒ–ç‰ˆåªå®ç°äº†REQUIREDï¼Œä½†æˆ‘æŠŠ7ç§ä¼ æ’­è¡Œä¸ºæ€»ç»“äº†ä¸‹ï¼š</p>





















































<table><thead><tr><th>ä¼ æ’­è¡Œä¸º</th><th>å¤–å±‚æœ‰äº‹åŠ¡</th><th>å¤–å±‚æ— äº‹åŠ¡</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>REQUIRED</td><td>åŠ å…¥å¤–å±‚äº‹åŠ¡</td><td>æ–°å»ºäº‹åŠ¡</td><td><strong>é»˜è®¤ï¼Œæœ€å¸¸ç”¨</strong></td></tr><tr><td>REQUIRES_NEW</td><td>æŒ‚èµ·å¤–å±‚ï¼Œæ–°å»ºäº‹åŠ¡</td><td>æ–°å»ºäº‹åŠ¡</td><td>æ—¥å¿—è®°å½•ï¼ˆç‹¬ç«‹æäº¤ï¼‰</td></tr><tr><td>NESTED</td><td>åµŒå¥—äº‹åŠ¡ï¼ˆSavePointï¼‰</td><td>æ–°å»ºäº‹åŠ¡</td><td>éƒ¨åˆ†å›æ»šåœºæ™¯</td></tr><tr><td>SUPPORTS</td><td>åŠ å…¥å¤–å±‚äº‹åŠ¡</td><td>éäº‹åŠ¡æ‰§è¡Œ</td><td>æŸ¥è¯¢æ–¹æ³•</td></tr><tr><td>NOT_SUPPORTED</td><td>æŒ‚èµ·å¤–å±‚äº‹åŠ¡</td><td>éäº‹åŠ¡æ‰§è¡Œ</td><td>ä¸éœ€è¦äº‹åŠ¡çš„æ“ä½œ</td></tr><tr><td>MANDATORY</td><td>åŠ å…¥å¤–å±‚äº‹åŠ¡</td><td>æŠ›å¼‚å¸¸</td><td>å¿…é¡»åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ</td></tr><tr><td>NEVER</td><td>æŠ›å¼‚å¸¸</td><td>éäº‹åŠ¡æ‰§è¡Œ</td><td>ç¦æ­¢åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ</td></tr></tbody></table>
<p>ç”Ÿäº§ç¯å¢ƒ99%çš„åœºæ™¯ç”¨REQUIREDå°±å¤Ÿäº†ï¼ŒREQUIRES_NEWç”¨åœ¨æ—¥å¿—è®°å½•ï¼ˆå³ä½¿ä¸šåŠ¡å¤±è´¥ä¹Ÿè¦è®°æ—¥å¿—ï¼‰ï¼Œå…¶ä»–çš„åŸºæœ¬ç”¨ä¸ä¸Šã€‚</p>
<h3 data-id="heading-36">ç”Ÿäº§ç»éªŒæ€»ç»“</h3>
<p>è¿™5ä¸ªæµ‹è¯•è·‘ä¸‹æ¥ï¼Œæˆ‘æ€»ç»“äº†å‡ æ¡ç”Ÿäº§ç»éªŒï¼š</p>
<ol>
<li><strong>ç»Ÿä¸€åŠ rollbackFor = Exception.class</strong>
<ul>
<li>é¿å…å—æ£€å¼‚å¸¸ä¸å›æ»šçš„å‘</li>
</ul>
</li>
<li><strong>ç†è§£REQUIREDçš„"ç»Ÿä¸€è¿›é€€"</strong>
<ul>
<li>å†…å±‚å¤±è´¥ = æ•´ä½“å›æ»š</li>
<li>ä¸è¦ä¼å›¾catchä½å†…å±‚å¼‚å¸¸è®©å¤–å±‚ç»§ç»­æäº¤</li>
</ul>
</li>
<li><strong>æ‹†åˆ†æœåŠ¡è¦å°å¿ƒ</strong>
<ul>
<li>ä¸åŒç±»çš„æ–¹æ³•è°ƒç”¨æ‰ä¼šèµ°ä»£ç†</li>
<li>åŒç±»å†…éƒ¨è°ƒç”¨äº‹åŠ¡ä¸ç”Ÿæ•ˆ</li>
</ul>
</li>
<li><strong>æ•°æ®åº“è¿æ¥è¦å¤ç”¨</strong>
<ul>
<li>REQUIREDä¼ æ’­ä¸‹ï¼Œå†…å¤–å±‚å…±äº«ä¸€ä¸ªConnection</li>
<li>æ‰€ä»¥å¯ä»¥çœ‹åˆ°å½¼æ­¤æœªæäº¤çš„æ•°æ®</li>
</ul>
</li>
<li><strong>ThreadLocalä¸€å®šè¦æ¸…ç†</strong>
<ul>
<li>finallyå—é‡Œç»Ÿä¸€æ¸…ç†èµ„æº</li>
<li>å¦åˆ™çº¿ç¨‹æ± å¤ç”¨ä¼šå‡ºé—®é¢˜</li>
</ul>
</li>
</ol>
<h3 data-id="heading-37">ä¸‹ä¸€æ­¥ï¼šREQUIRES_NEW</h3>
<p>REQUIREDææ¸…æ¥šåï¼Œä¸‹ä¸€ä¸ªè¦ç ”ç©¶çš„æ˜¯REQUIRES_NEWã€‚å®ƒè·ŸREQUIREDæœ€å¤§çš„åŒºåˆ«ï¼š</p>
<ul>
<li><strong>REQUIRED</strong>ï¼šæœ‰äº‹åŠ¡å°±åŠ å…¥ï¼ˆå…±äº«Connectionï¼‰</li>
<li><strong>REQUIRES_NEW</strong>ï¼šæ€»æ˜¯æ–°å»ºäº‹åŠ¡ï¼ˆæŒ‚èµ·å¤–å±‚ï¼Œæ–°å¼€Connectionï¼‰</li>
</ul>
<p>è¿™ä¸ªæ¶‰åŠåˆ°äº‹åŠ¡æŒ‚èµ·å’Œæ¢å¤ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªäº‹åŠ¡æ ˆï¼Œå®ç°èµ·æ¥æ›´å¤æ‚ã€‚æˆ‘å‡†å¤‡ä¸‹ä¸€ç¯‡æ–‡ç« ä¸“é—¨å†™è¿™ä¸ªã€‚</p>
<h3 data-id="heading-38">å†™åœ¨æœ€å</h3>
<p>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºè¿™å—ï¼Œè¯´å®è¯å…‰çœ‹æ–‡æ¡£çœŸçš„å¾ˆéš¾ç†è§£ã€‚æˆ‘è¿™æ¬¡é€šè¿‡æ‰‹å†™æ¡†æ¶+æµ‹è¯•ç”¨ä¾‹ï¼Œç®—æ˜¯å½»åº•ææ˜ç™½äº†ã€‚</p>
<p>æœ€å¤§çš„æ”¶è·æ˜¯ï¼š<strong>ä¸è¦æ€•åŠ¨æ‰‹å®è·µ</strong>ã€‚è‡ªå·±å†™200è¡Œä»£ç ï¼Œæ¯”çœ‹2000è¡Œæºç ç†è§£å¾—æ›´æ·±ã€‚</p>
<p>ä»£ç æˆ‘æ”¾Giteeäº†ï¼ˆé“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fsh_wangwanbao%2Fsimple-spring-transaction" target="_blank" title="https://gitee.com/sh_wangwanbao/simple-spring-transaction" ref="nofollow noopener noreferrer">gitee.com/sh_wangwanbâ€¦</a> )
æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥cloneä¸‹æ¥è·‘è·‘çœ‹ã€‚ä¸‹ä¸€ç¯‡æˆ‘æ‰“ç®—å†™REQUIRES_NEWçš„å®ç°ï¼Œæ¶‰åŠåˆ°äº‹åŠ¡æŒ‚èµ·å’Œæ¢å¤ï¼Œåº”è¯¥ä¼šæ›´æœ‰æ„æ€ã€‚</p>
<hr/>
<p><strong>ä½ ä»¬åœ¨ç”¨äº‹åŠ¡çš„æ—¶å€™ï¼Œæœ‰æ²¡æœ‰é‡åˆ°è¿‡"å†…å±‚å¤±è´¥å¤–å±‚å´æäº¤äº†"çš„å‘ï¼Ÿæˆ–è€…è¿˜æœ‰å“ªäº›ä¼ æ’­è¡Œä¸ºçš„é—®é¢˜æä¸æ¸…æ¥šï¼Ÿæ¬¢è¿è¯„è®ºåŒºèŠèŠï¼Œå¤§å®¶ä¸€èµ·äº¤æµã€‚</strong></p>
<p>å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¾›è‹¦ç‚¹ä¸ªèµæ”¯æŒä¸‹å‘—ã€‚æ‚¨çš„æ”¯æŒï¼Œæ˜¯æˆ‘åˆ›ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼Œè°¢è°¢ã€‚</p>
<p>ä¸‹ç¯‡è§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹â€œä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½â€ï¼‰]]></title>    <link>https://juejin.cn/post/7577722399375818794</link>    <guid>https://juejin.cn/post/7577722399375818794</guid>    <pubDate>2025-11-29T23:03:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577722399375818794" data-draft-id="7577905525996666921" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹â€œä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½â€ï¼‰"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-29T23:03:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ–¹æ³•é‡è½½"/> <meta itemprop="url" content="https://juejin.cn/user/1443021512522878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹â€œä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½â€ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1443021512522878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ–¹æ³•é‡è½½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T23:03:14.000Z" title="Sat Nov 29 2025 23:03:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œéšç€å•é¡µé¢åº”ç”¨(SPA)çš„å¤æ‚åº¦ä¸æ–­æå‡ï¼Œæ‰“åŒ…åçš„JavaScriptæ–‡ä»¶ä½“ç§¯å¯èƒ½è¾¾åˆ°å‡ MBç”šè‡³æ›´å¤§ã€‚è¿™ä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼šç”¨æˆ·éœ€è¦ç­‰å¾…æ•´ä¸ªåº”ç”¨åŠ è½½å®Œæˆåæ‰èƒ½ä¸é¡µé¢äº¤äº’ã€‚ä»£ç åˆ†å‰²(Code Splitting)å’Œæ‡’åŠ è½½(Lazy Loading)æ­£æ˜¯è§£å†³è¿™ä¸€é—®é¢˜çš„å…³é”®æŠ€æœ¯ã€‚</p>
<p>ä¸€ã€ä»£ç åˆ†å‰²çš„æ ¸å¿ƒæ€æƒ³</p>
<p>ä»£ç åˆ†å‰²çš„æ ¸å¿ƒæ˜¯å°†å•ä¸ªå¤§å‹çš„æ‰“åŒ…æ–‡ä»¶æ‹†åˆ†æˆå¤šä¸ªè¾ƒå°çš„chunkï¼Œç„¶åæŒ‰éœ€åŠ è½½æˆ–å¹¶è¡ŒåŠ è½½ã€‚è¿™ç±»ä¼¼äºå›¾ä¹¦çš„ç« èŠ‚åˆ’åˆ†â€”â€”è¯»è€…ä¸éœ€è¦ä¸€æ¬¡æ€§æ‹¿åˆ°æ•´æœ¬ä¹¦ï¼Œè€Œæ˜¯å¯ä»¥æ ¹æ®éœ€è¦é˜…è¯»ç‰¹å®šç« èŠ‚ã€‚</p>
<p>äºŒã€å®ç°æ–¹å¼</p>
<ol>
<li>åŠ¨æ€import()è¯­æ³•ï¼ˆç°ä»£æ¨èæ–¹æ¡ˆï¼‰</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é™æ€å¯¼å…¥ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰</span>
<span class="hljs-comment">// import { utils } from './module';</span>

<span class="hljs-comment">// åŠ¨æ€å¯¼å…¥ï¼ˆä»£ç åˆ†å‰²ï¼‰</span>
button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./module.js'</span>);
  <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">doSomething</span>();
});
</code></pre>
<p>Webpackç­‰æ„å»ºå·¥å…·æ£€æµ‹åˆ°åŠ¨æ€import()æ—¶ä¼šè‡ªåŠ¨è¿›è¡Œä»£ç åˆ†å‰²ï¼Œç”Ÿæˆç‹¬ç«‹çš„chunkæ–‡ä»¶ã€‚</p>
<ol>
<li>React.lazy + Suspenseï¼ˆReactç”Ÿæ€ï¼‰</li>
</ol>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./LazyComponent'</span>));

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
  );
}
</code></pre>
<ol>
<li>è·¯ç”±çº§åˆ†å‰²ï¼ˆæœ€å¸¸ç”¨çš„åˆ†å‰²åœºæ™¯ï¼‰</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue Router</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/Dashboard.vue'</span>)
  }
];

<span class="hljs-comment">// React Router</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Dashboard</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Dashboard'</span>));
</code></pre>
<p>ä¸‰ã€æ‡’åŠ è½½çš„å®é™…åº”ç”¨åœºæ™¯</p>
<ol>
<li>è·¯ç”±çº§åˆ«åˆ†å‰²ï¼šæ¯ä¸ªè·¯ç”±å¯¹åº”çš„ç»„ä»¶å•ç‹¬æ‰“åŒ…</li>
<li>ç»„ä»¶çº§åˆ«åˆ†å‰²ï¼šå¤§å‹ç»„ä»¶ï¼ˆå¦‚å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€å›¾è¡¨åº“ï¼‰æŒ‰éœ€åŠ è½½</li>
<li>ç¬¬ä¸‰æ–¹åº“åˆ†å‰²ï¼šå°†ä¸å¸¸å˜åŒ–çš„ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpacké…ç½®ç¤ºä¾‹</span>
<span class="hljs-attr">optimization</span>: {
  <span class="hljs-attr">splitChunks</span>: {
    <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>,
    <span class="hljs-attr">cacheGroups</span>: {
      <span class="hljs-attr">vendor</span>: {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'vendors'</span>,
      }
    }
  }
}
</code></pre>
<p>å››ã€æ€§èƒ½æ”¶ç›Šåˆ†æ</p>
<p>é€šè¿‡ä»£ç åˆ†å‰²å¯ä»¥å®ç°ï¼š</p>
<p>Â· å‡å°‘åˆå§‹åŠ è½½æ—¶é—´ï¼šé¦–å±åªéœ€åŠ è½½å¿…è¦ä»£ç 
Â· æé«˜ç¼“å­˜æ•ˆç‡ï¼šä¿®æ”¹ä¸šåŠ¡ä»£ç ä¸ä¼šå½±å“vendor chunk
Â· ä¼˜åŒ–èµ„æºåŠ è½½ï¼šéå…³é”®èµ„æºå¯ä»¥å»¶è¿ŸåŠ è½½</p>
<p>äº”ã€æœ€ä½³å®è·µå»ºè®®</p>
<ol>
<li>åˆ†å‰²ç²’åº¦è¦åˆç†ï¼Œé¿å…äº§ç”Ÿè¿‡å¤šå°æ–‡ä»¶å¯¼è‡´è¯·æ±‚é¢‘ç¹</li>
<li>ä½¿ç”¨é¢„åŠ è½½(preload/prefetch)ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"prefetch"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"lazy-component.js"</span>&gt;</span>
</code></pre>
<ol>
<li>æ³¨æ„é”™è¯¯å¤„ç†ï¼ŒåŠ¨æ€å¯¼å…¥å¯èƒ½å¤±è´¥</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span>(<span class="hljs-string">'./module'</span>)
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// å¤„ç†åŠ è½½å¤±è´¥æƒ…å†µ</span>
  });
</code></pre>
<p>ä»£ç åˆ†å‰²ä¸æ˜¯é“¶å¼¹ï¼Œéœ€è¦ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯ã€‚è¿‡åº¦åˆ†å‰²å¯èƒ½å¯¼è‡´è¯·æ±‚ç¢ç‰‡åŒ–ï¼Œè€Œåˆ†å‰²ä¸è¶³åˆæ— æ³•å……åˆ†å‘æŒ¥æ€§èƒ½ä¼˜åŠ¿ã€‚é€šè¿‡Chrome DevToolsçš„Coverageå·¥å…·å’ŒWebpack Bundle Analyzerè¿›è¡Œåˆ†æï¼Œæ‰¾åˆ°æœ€é€‚åˆè‡ªå·±é¡¹ç›®çš„åˆ†å‰²ç­–ç•¥æ‰æ˜¯å…³é”®ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HTML æ•²å‡»ä¹ PART--2]]></title>    <link>https://juejin.cn/post/7577704980855275574</link>    <guid>https://juejin.cn/post/7577704980855275574</guid>    <pubDate>2025-11-29T15:56:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577704980855275574" data-draft-id="7576856418470461450" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HTML æ•²å‡»ä¹ PART--2"/> <meta itemprop="keywords" content="HTML"/> <meta itemprop="datePublished" content="2025-11-29T15:56:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="izx888"/> <meta itemprop="url" content="https://juejin.cn/user/1241762540820323"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HTML æ•²å‡»ä¹ PART--2
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1241762540820323/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    izx888
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T15:56:16.000Z" title="Sat Nov 29 2025 15:56:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">HTML5 æ•²å‡»ä¹é¡¹ç›® PART-2ï¼šä»ç»“æ„åˆ°äº¤äº’çš„å®Œæ•´å®ç°</h2>
<h3 data-id="heading-1">ä¸€ã€é¡¹ç›®æ¦‚è¿°</h3>
<p>â€œHTML5 æ•²å‡»ä¹â€æ˜¯ä¸€ä¸ªåŸºäºç°ä»£ Web æŠ€æœ¯çš„äº¤äº’å¼éŸ³é¢‘åº”ç”¨ï¼šç”¨æˆ·æŒ‰ä¸‹é”®ç›˜ä¸Šçš„ç‰¹å®šæŒ‰é”®ï¼ˆå¦‚ Aã€Sã€D ç­‰ï¼‰ï¼Œé¡µé¢ä¸­å¯¹åº”çš„è™šæ‹Ÿâ€œæ‰“å‡»ä¹å™¨é”®â€ä¼šé«˜äº®æ˜¾ç¤ºå¹¶æ’­æ”¾é¢„è®¾éŸ³æ•ˆï¼Œæ¨¡æ‹ŸçœŸå®çš„èŠ‚å¥æ‰“å‡»ä½“éªŒã€‚</p>
<p>è¯¥é¡¹ç›®ä¸ä»…å®ç°äº†åŸºç¡€çš„éŸ³æ•ˆè§¦å‘ä¸è§†è§‰åé¦ˆï¼Œæ›´å®Œæ•´ä½“ç°äº†å‰ç«¯å¼€å‘çš„æ ¸å¿ƒç†å¿µâ€”â€”<strong>ç»“æ„ã€æ ·å¼ä¸è¡Œä¸ºåˆ†ç¦»</strong>ï¼Œå¹¶èåˆäº†<strong>å“åº”å¼è®¾è®¡</strong>ã€<strong>æ¨¡å—åŒ–æ€ç»´</strong>ä¸<strong>ç”¨æˆ·ä½“éªŒä¼˜åŒ–</strong>ç­‰ç°ä»£å¼€å‘å®è·µã€‚ä»£ç ç»“æ„æ¸…æ™°ã€æ‰©å±•æ€§å¼ºï¼Œä¸ºåç»­åŠŸèƒ½ï¼ˆå¦‚èŠ‚å¥å½•åˆ¶ã€éŸ³è‰²åˆ‡æ¢ã€ç§»åŠ¨ç«¯è§¦æ§æ”¯æŒç­‰ï¼‰é¢„ç•™äº†è‰¯å¥½æ¥å£ï¼Œæ˜¯åˆå­¦è€…æŒæ¡ HTML5ã€CSS3 ä¸ JavaScript ååŒå¼€å‘çš„ç†æƒ³èŒƒä¾‹ã€‚</p>
<blockquote>
<p>è·Ÿç€æœ¬æ–‡ï¼Œä½ å°†äº²æ‰‹æ„å»ºä¸€ä¸ªæ—¢ç¾è§‚åˆå¯Œæœ‰äº¤äº’æ„Ÿçš„ç½‘é¡µä¹å™¨ï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">äºŒã€HTML5 ç»“æ„è®¾è®¡ï¼šè¯­ä¹‰åŒ–ä¸æ•°æ®ç»‘å®š</h3>
<p>HTML æ˜¯åº”ç”¨çš„éª¨æ¶ã€‚æˆ‘ä»¬é‡‡ç”¨<strong>è¯­ä¹‰åŒ–æ ‡ç­¾</strong>ä¸<strong>æ•°æ®å±æ€§ï¼ˆdata-*ï¼‰</strong> æ„å»ºæ¸…æ™°ã€å¯ç»´æŠ¤çš„ DOM ç»“æ„ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>HTML5 æ•²å‡»ä¹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"style.css"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"keys"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"key"</span> <span class="hljs-attr">data-key</span>=<span class="hljs-string">"65"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>A<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sound"</span>&gt;</span>Clap<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- æ›´å¤š .key å…ƒç´  --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">audio</span> <span class="hljs-attr">data-key</span>=<span class="hljs-string">"65"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"sounds/clap.wav"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">audio</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- å¯¹åº”çš„ audio å…ƒç´  --&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">å…³é”®è®¾è®¡è¦ç‚¹ï¼š</h4>
<ul>
<li><strong><code>.keys</code> å®¹å™¨</strong>ï¼šåŒ…è£¹æ‰€æœ‰è™šæ‹Ÿç´é”®ï¼Œä½œä¸ºå¸ƒå±€æ ¹èŠ‚ç‚¹ï¼›</li>
<li><strong><code>.key</code> æ¨¡å—</strong>ï¼šæ¯ä¸ªé”®åŒ…å«è§†è§‰æç¤ºï¼ˆ<code>&lt;h3&gt;</code>ï¼‰ä¸éŸ³æ•ˆåç§°ï¼ˆ<code>.sound</code>ï¼‰ï¼Œå…·å¤‡ç‹¬ç«‹è¯­ä¹‰ï¼›</li>
<li><strong><code>data-key</code> å±æ€§</strong>ï¼šå­˜å‚¨é”®ç›˜äº‹ä»¶çš„ <code>keyCode</code>ï¼ˆå¦‚ A é”®ä¸º 65ï¼‰ï¼Œå®ç° UI å…ƒç´ ä¸ç‰©ç†æŒ‰é”®çš„ç²¾å‡†æ˜ å°„ï¼›</li>
<li><strong><code>&lt;audio&gt;</code> é¢„åŠ è½½</strong>ï¼šæ¯ä¸ªéŸ³æ•ˆé€šè¿‡ç‹¬ç«‹ <code>&lt;audio&gt;</code> æ ‡ç­¾é¢„åŠ è½½ï¼Œå¹¶é€šè¿‡ç›¸åŒçš„ <code>data-key</code> ä¸ <code>.key</code> å…³è”ï¼Œä¾¿äº JavaScript åŠ¨æ€è°ƒç”¨ã€‚</li>
</ul>
<blockquote>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p>
<ul>
<li>HTML åªè´Ÿè´£ç»“æ„ï¼Œä¸åµŒå…¥æ ·å¼æˆ–é€»è¾‘ï¼›</li>
<li>CSS é€šè¿‡å¤–é“¾å¼•å…¥ï¼Œç½®äº <code>&lt;head&gt;</code>ï¼›</li>
<li>JavaScript è„šæœ¬ç½®äº <code>&lt;body&gt;</code> åº•éƒ¨ï¼Œé¿å…é˜»å¡æ¸²æŸ“ã€‚</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-4">ä¸‰ã€CSS æ ·å¼ç³»ç»Ÿï¼šé‡ç½®ã€å¸ƒå±€ä¸åŠ¨æ•ˆ</h3>
<h4 data-id="heading-5">1. ç»Ÿä¸€æ ·å¼èµ·ç‚¹ï¼šCSS Reset</h4>
<p>ä¸åŒæµè§ˆå™¨å¯¹é»˜è®¤å…ƒç´ ï¼ˆå¦‚ <code>body</code>ã€<code>h1</code>ï¼‰çš„ marginã€padding ç­‰å¤„ç†ä¸ä¸€ï¼Œæ˜“å¯¼è‡´å¸ƒå±€é”™ä¹±ã€‚ä¸ºæ­¤ï¼Œé¡¹ç›®é‡‡ç”¨ <strong>Eric Meyerâ€™s Reset CSS</strong>ï¼Œæ¸…é™¤æ‰€æœ‰é»˜è®¤æ ·å¼ï¼Œå¹¶è¡¥å……ç°ä»£å¼€å‘è§„èŒƒï¼š</p>
<pre><code class="hljs language-css" lang="css">*, *<span class="hljs-selector-pseudo">::before</span>, *<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">box-sizing</span>: border-box;
}
</code></pre>
<p><code>box-sizing: border-box</code> ç¡®ä¿å…ƒç´ çš„å®½é«˜åŒ…å« padding å’Œ borderï¼Œä½¿å°ºå¯¸è®¡ç®—æ›´ç›´è§‚ã€å¸ƒå±€æ›´ç¨³å®šã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜ä¼˜åŒ–äº†å¸¸ç”¨å…ƒç´ ï¼š</p>
<ul>
<li><code>img { max-width: 100%; height: auto; }</code>ï¼šå›¾ç‰‡è‡ªé€‚åº”å®¹å™¨ï¼›</li>
<li><code>a { text-decoration: none; color: inherit; }</code>ï¼šé“¾æ¥æ ·å¼ç»§æ‰¿çˆ¶çº§ï¼Œä¿æŒè§†è§‰ç»Ÿä¸€ã€‚</li>
</ul>
<h4 data-id="heading-6">2. å“åº”å¼å¸ƒå±€ï¼šFlexbox + ç›¸å¯¹å•ä½</h4>
<p>ä¸ºé€‚é…æ‰‹æœºã€å¹³æ¿ã€æ¡Œé¢ç­‰å¤šç§è®¾å¤‡ï¼Œé¡¹ç›®æ‘’å¼ƒå›ºå®šå•ä½ï¼ˆå¦‚ <code>px</code>ï¼‰ï¼Œè½¬è€Œä½¿ç”¨ï¼š</p>
<ul>
<li><strong><code>vh</code>ï¼ˆè§†å£é«˜åº¦å•ä½ï¼‰</strong> ï¼š<br/>
<code>min-height: 100vh</code> ç¡®ä¿ <code>.keys</code> å®¹å™¨å§‹ç»ˆå æ»¡å±å¹•é«˜åº¦ï¼›</li>
<li><strong><code>rem</code>ï¼ˆæ ¹å­—ä½“å•ä½ï¼‰</strong> ï¼š<br/>
è®¾ç½® <code>html { font-size: 10px; }</code>ï¼Œåç»­æ‰€æœ‰å°ºå¯¸ï¼ˆå¦‚ <code>font-size: 1.5rem</code>ã€<code>border: .4rem</code>ï¼‰å‡åŸºäºæ­¤ï¼Œä¾¿äºå…¨å±€ç¼©æ”¾ã€‚</li>
</ul>
<p>é…åˆ <strong>Flexbox å¼¹æ€§å¸ƒå±€</strong>ï¼Œå®ç°ä¼˜é›…å±…ä¸­ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.keys</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/* æ°´å¹³å±…ä¸­ */</span>
  <span class="hljs-attribute">align-items</span>: center;     <span class="hljs-comment">/* å‚ç›´å±…ä¸­ */</span>
}
</code></pre>
<p>æ— è®ºå±å¹•å°ºå¯¸å¦‚ä½•å˜åŒ–ï¼Œç´é”®å§‹ç»ˆå±…ä¸­æ’åˆ—ï¼Œå¸ƒå±€è‡ªé€‚åº”ä¸”æ— éœ€åª’ä½“æŸ¥è¯¢å¹²é¢„ã€‚</p>
<h4 data-id="heading-7">3. è§†è§‰åé¦ˆï¼šåŠ¨æ€äº¤äº’æ•ˆæœ</h4>
<p>å½“ç”¨æˆ·è§¦å‘æŒ‰é”®æ—¶ï¼ŒJavaScript ä¼šä¸ºå¯¹åº” <code>.key</code> æ·»åŠ  <code>.playing</code> ç±»ï¼ŒCSS åˆ™å®šä¹‰å…¶åŠ¨æ•ˆï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.playing</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#ffc600</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1rem</span> <span class="hljs-number">#ffc600</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>);
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.1s</span> ease;
}
</code></pre>
<p>è¿™ä¸€ç»„åˆå®ç°äº†<strong>è¾¹æ¡†é«˜äº®ã€å‘å…‰é˜´å½±ä¸è½»å¾®æ”¾å¤§</strong>çš„è§†è§‰åé¦ˆï¼Œæ˜¾è‘—æå‡äº¤äº’æ²‰æµ¸æ„Ÿã€‚</p>
<h4 data-id="heading-8">4. èƒŒæ™¯ä¸æ°›å›´è¥é€ </h4>
<p>å…¨å±èƒŒæ™¯å›¾å¢å¼ºæ•´ä½“æ°›å›´ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">'./background.jpg'</span>) bottom center no-repeat;
  <span class="hljs-attribute">background-size</span>: cover;
}
</code></pre>
<ul>
<li><code>cover</code>ï¼šç­‰æ¯”ç¼©æ”¾è¦†ç›–æ•´ä¸ªè§†å£ï¼ˆå¯èƒ½è£å‰ªè¾¹ç¼˜ï¼‰ï¼›</li>
<li><code>contain</code>ï¼šå®Œæ•´æ˜¾ç¤ºå›¾ç‰‡ï¼ˆå¯èƒ½ç•™ç™½ï¼‰ï¼›</li>
<li><code>bottom center</code>ï¼šç¡®ä¿å…³é”®è§†è§‰å†…å®¹ï¼ˆå¦‚é¼“é¢ï¼‰ä½äºåº•éƒ¨ä¸­å¤®ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-9">å››ã€JavaScript äº¤äº’é€»è¾‘ï¼šäº‹ä»¶é©±åŠ¨ä¸ DOM æ“ä½œ</h3>
<p>JavaScript æ˜¯è®©é¡µé¢â€œæ´»èµ·æ¥â€çš„å¼•æ“ã€‚é¡¹ç›®é‡‡ç”¨<strong>äº‹ä»¶ç›‘å¬ + æ•°æ®é©±åŠ¨</strong>çš„æ–¹å¼å®ç°æ ¸å¿ƒäº¤äº’ã€‚</p>
<h4 data-id="heading-10">1. å®‰å…¨æ‰§è¡Œæ—¶æœº</h4>
<p>ä½¿ç”¨ <code>DOMContentLoaded</code> ç¡®ä¿ DOM åŠ è½½å®Œæˆåå†æ‰§è¡Œè„šæœ¬ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// åˆå§‹åŒ–é€»è¾‘</span>
});
</code></pre>
<p>é¿å…å› å…ƒç´ æœªå°±ç»ªå¯¼è‡´çš„ <code>null</code> é”™è¯¯ã€‚</p>
<h4 data-id="heading-11">2. å…¨å±€é”®ç›˜ç›‘å¬</h4>
<p>ç›‘å¬ <code>window</code> çš„ <code>keydown</code> äº‹ä»¶ï¼Œæ•è·ç”¨æˆ·è¾“å…¥ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, playSound);
</code></pre>
<h4 data-id="heading-12">3. åŠ¨æ€åŒ¹é…ä¸åé¦ˆ</h4>
<pre><code class="hljs language-ini" lang="ini">function playSound(event) {
  const <span class="hljs-attr">keyCode</span> = event.keyCode<span class="hljs-comment">;</span>
  const <span class="hljs-attr">keyElement</span> = document.querySelector(`.key[data-key=<span class="hljs-string">"${keyCode}"</span>]`)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">audioElement</span> = document.querySelector(`audio[data-key=<span class="hljs-string">"${keyCode}"</span>]`)<span class="hljs-comment">;</span>

  if (keyElement) {
    keyElement.classList.add('playing')<span class="hljs-comment">;</span>
    setTimeout(() =&gt; keyElement.classList.remove('playing'), 150)<span class="hljs-comment">; // è‡ªåŠ¨ç§»é™¤åŠ¨æ•ˆ</span>
  }

  if (audioElement) {
    <span class="hljs-attr">audioElement.currentTime</span> = <span class="hljs-number">0</span><span class="hljs-comment">; // é‡ç½®æ’­æ”¾ä½ç½®</span>
    audioElement.play()<span class="hljs-comment">;</span>
  }
}
</code></pre>
<ul>
<li>é€šè¿‡ <code>data-key</code> ç²¾å‡†åŒ¹é… UI ä¸éŸ³é¢‘ï¼›</li>
<li>ä½¿ç”¨ <code>setTimeout</code> è‡ªåŠ¨æ¸…é™¤ <code>.playing</code> ç±»ï¼Œé¿å…çŠ¶æ€æ®‹ç•™ï¼›</li>
<li>é‡ç½® <code>currentTime</code> æ”¯æŒå¿«é€Ÿè¿æŒ‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-13">äº”ã€æ€§èƒ½ä¸å·¥ç¨‹åŒ–è€ƒé‡</h3>
<h4 data-id="heading-14">âœ… æœ€ä½³å®è·µæ€»ç»“ï¼š</h4>

























<table><thead><tr><th>æ–¹é¢</th><th>å®è·µ</th></tr></thead><tbody><tr><td><strong>è„šæœ¬åŠ è½½</strong></td><td><code>&lt;script&gt;</code> ç½®äº <code>&lt;/body&gt;</code> å‰ï¼Œé¿å…é˜»å¡æ¸²æŸ“</td></tr><tr><td><strong>é€‰æ‹©å™¨æ€§èƒ½</strong></td><td>é¿å…é€šé…ç¬¦ <code>*</code> é‡ç½®ï¼Œé‡‡ç”¨æ˜ç¡®å…ƒç´ åˆ—è¡¨ï¼ˆå¦‚ Eric Meyer æ–¹æ¡ˆï¼‰</td></tr><tr><td><strong>å¯è®¿é—®æ€§</strong></td><td>ä½¿ç”¨è¯­ä¹‰åŒ–æ ‡ç­¾ï¼ˆ<code>&lt;h3&gt;</code>ã€<code>&lt;p&gt;</code>ï¼‰ï¼Œæå‡å±å¹•é˜…è¯»å™¨å…¼å®¹æ€§</td></tr><tr><td><strong>æ‰©å±•æ€§</strong></td><td><code>data-*</code> å±æ€§å¤©ç„¶æ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•ï¼ˆå¦‚éŸ³é‡æ§åˆ¶ã€éŸ³è‰²åˆ‡æ¢ï¼‰</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-15">å…­ã€ç»“è¯­ï¼šå°é¡¹ç›®ï¼Œå¤§æ ¼å±€</h3>
<p>â€œHTML5 æ•²å‡»ä¹â€è™½ä½“é‡å°å·§ï¼Œå´å®Œæ•´æ¶µç›–äº†ç°ä»£ Web å¼€å‘çš„å…³é”®è¦ç´ ï¼š</p>
<ul>
<li><strong>ç»“æ„æ¸…æ™°</strong>ï¼šè¯­ä¹‰åŒ– HTML + æ•°æ®ç»‘å®šï¼›</li>
<li><strong>æ ·å¼å¥å£®</strong>ï¼šCSS Reset + Flexbox + å“åº”å¼å•ä½ï¼›</li>
<li><strong>äº¤äº’æµç•…</strong>ï¼šäº‹ä»¶é©±åŠ¨ + åŠ¨æ€ DOM æ“ä½œ + è§†è§‰åé¦ˆï¼›</li>
<li><strong>å·¥ç¨‹è§„èŒƒ</strong>ï¼šèŒè´£åˆ†ç¦»ã€æ€§èƒ½ä¼˜åŒ–ã€å¯æ‰©å±•è®¾è®¡ã€‚</li>
</ul>
<p>å®ƒä¸ä»…æ˜¯ä¸€æ¬¡è¶£å‘³ç¼–ç¨‹å®è·µï¼Œæ›´æ˜¯é€šå¾€ä¸“ä¸šå‰ç«¯å¼€å‘çš„åšå®ä¸€æ­¥ã€‚æŒæ¡å…¶ä¸­çš„è®¾è®¡æ€æƒ³ä¸æŠ€æœ¯ç»„åˆï¼Œä½ ä¾¿å·²å…·å¤‡æ„å»ºæ›´å¤æ‚äº¤äº’åº”ç”¨çš„èƒ½åŠ›ã€‚</p>
<blockquote>
<p>ä¸‹ä¸€æ­¥ï¼Œä¸å¦¨å°è¯•æ·»åŠ ï¼š</p>
<ul>
<li>ç§»åŠ¨ç«¯è§¦æ§æ”¯æŒ</li>
<li>èŠ‚å¥å½•åˆ¶ä¸å›æ”¾</li>
<li>å¤šå¥—éŸ³æ•ˆä¸»é¢˜åˆ‡æ¢<br/>
è®©ä½ çš„â€œæ•²å‡»ä¹â€çœŸæ­£æˆä¸ºå±äºä½ çš„æ•°å­—ä¹å™¨ï¼</li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ï¼šåŸç†ã€ä½œç”¨ä¸å®è·µæŒ‡å—]]></title>    <link>https://juejin.cn/post/7577715145121726518</link>    <guid>https://juejin.cn/post/7577715145121726518</guid>    <pubDate>2025-11-29T16:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577715145121726518" data-draft-id="7577691384943165482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ï¼šåŸç†ã€ä½œç”¨ä¸å®è·µæŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,æµè§ˆå™¨"/> <meta itemprop="datePublished" content="2025-11-29T16:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JamesGosling666"/> <meta itemprop="url" content="https://juejin.cn/user/2358921680140899"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ï¼šåŸç†ã€ä½œç”¨ä¸å®è·µæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2358921680140899/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JamesGosling666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T16:43:11.000Z" title="Sat Nov 29 2025 16:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€CSP æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<blockquote>
<p>CSP æœ¬è´¨ä¸Šæ˜¯ä¸€å¥—<strong>ç”±ç½‘ç«™å¼€å‘è€…å®šä¹‰ã€æµè§ˆå™¨è´Ÿè´£æ‰§è¡Œçš„ â€œå†…å®¹åŠ è½½è§„åˆ™â€</strong> ã€‚å®ƒé€šè¿‡æ˜ç¡®å‘Šè¯‰æµè§ˆå™¨ â€œå“ªäº›æ¥æºçš„èµ„æºï¼ˆå¦‚è„šæœ¬ã€å›¾ç‰‡ã€æ ·å¼è¡¨ï¼‰æ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥åŠ è½½ï¼›å“ªäº›æ¥æºæ˜¯å±é™©çš„ï¼Œå¿…é¡»æ‹’ç»â€ï¼Œä»æ ¹æºä¸Šé™åˆ¶æ¶æ„ä»£ç çš„æ‰§è¡Œï¼Œå¼¥è¡¥ä¼ ç»Ÿå®‰å…¨é˜²æŠ¤ï¼ˆå¦‚è¾“å…¥è¿‡æ»¤ã€è¾“å‡ºç¼–ç ï¼‰çš„ä¸è¶³ã€‚</p>
</blockquote>
<h3 data-id="heading-1">1. CSP çš„æ ¸å¿ƒé€»è¾‘ï¼šâ€œç™½åå•æœºåˆ¶â€</h3>
<p>CSP çš„æ ¸å¿ƒæ€æƒ³æ˜¯ â€œ<strong>é»˜è®¤æ‹’ç»ï¼Œä¾‹å¤–å…è®¸</strong>â€â€”â€” é™¤éå¼€å‘è€…æ˜ç¡®å°†æŸä¸ªèµ„æºæ¥æºåŠ å…¥ â€œç™½åå•â€ï¼Œå¦åˆ™æµè§ˆå™¨ä¼šé»˜è®¤é˜»æ­¢è¯¥èµ„æºçš„åŠ è½½æˆ–æ‰§è¡Œã€‚è¿™ç§æœºåˆ¶å½»åº•æ”¹å˜äº†ä¼ ç»Ÿç½‘é¡µ â€œé»˜è®¤å…è®¸æ‰€æœ‰èµ„æºâ€ çš„å®½æ¾æ¨¡å¼ï¼Œå¤§å¹…é™ä½äº†æ¶æ„èµ„æºæ³¨å…¥çš„é£é™©ã€‚</p>
<h3 data-id="heading-2">2. CSP çš„å®ç°è½½ä½“ï¼šä¸¤ç§éƒ¨ç½²æ–¹å¼</h3>
<p>CSP çš„è§„åˆ™é€šå¸¸é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¼ é€’ç»™æµè§ˆå™¨ï¼Œå¼€å‘è€…å¯æ ¹æ®åœºæ™¯é€‰æ‹©ï¼š</p>
<ul>
<li><strong>HTTP å“åº”å¤´ï¼ˆæ¨èï¼‰</strong> ï¼šåœ¨æœåŠ¡å™¨è¿”å›çš„ HTTP å“åº”ä¸­æ·»åŠ <code>Content-Security-Policy</code>å¤´ï¼Œä¾‹å¦‚ï¼š<code>Content-Security-Policy: default-src 'self'; script-src https://cdn.example.com</code>ã€‚è¿™ç§æ–¹å¼ä¼˜å…ˆçº§é«˜ã€è§„åˆ™è¦†ç›–å…¨é¢ï¼Œé€‚ç”¨äºæ•´ç«™æˆ–ç‰¹å®šé¡µé¢çš„å®‰å…¨ç®¡æ§ã€‚</li>
<li><strong><code>&lt;meta&gt;</code>æ ‡ç­¾</strong>ï¼šä¼—æ‰€å‘¨çŸ¥å¯ä»¥é€šè¿‡ <code>&lt;meta&gt;</code>æ ‡ç­¾æ¥æ¨¡æ‹Ÿå“åº”å¤´ï¼Œä¾‹å¦‚ï¼š<code>&lt;meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src https://img.example.com"&gt;</code>ã€‚è¿™ç§æ–¹å¼æ— éœ€æœåŠ¡å™¨é…ç½®ï¼Œé€‚åˆé™æ€é¡µé¢æˆ–æ— æ³•ä¿®æ”¹æœåŠ¡å™¨å“åº”å¤´çš„åœºæ™¯ï¼ˆå¦‚é™æ€åšå®¢ã€ç¬¬ä¸‰æ–¹å¹³å°æ‰˜ç®¡é¡µé¢ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-3">äºŒã€CSP çš„æ ¸å¿ƒä½œç”¨ â€”â€” æŠµå¾¡å“ªäº›å¨èƒï¼Ÿè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
<p>CSP çš„æ ¸å¿ƒä»·å€¼åœ¨äº â€œ<strong>ç²¾å‡†ç®¡æ§èµ„æºåŠ è½½ï¼Œé˜»æ–­æ¶æ„ä»£ç æ‰§è¡Œ</strong>â€ï¼Œå…·ä½“å¯æ‹†è§£ä¸ºä»¥ä¸‹ 4 ä¸ªå…³é”®ä½œç”¨ï¼š</p>
<h3 data-id="heading-4">1. æŠµå¾¡ XSS æ”»å‡»ï¼šä» â€œäº‹åè¿‡æ»¤â€ åˆ° â€œäº‹å‰é˜»æ­¢â€</h3>
<p>XSS æ”»å‡»çš„æœ¬è´¨æ˜¯æ¶æ„è„šæœ¬è¢«æ³¨å…¥åˆ°ç½‘é¡µä¸­å¹¶æ‰§è¡Œï¼Œè€Œ CSP é€šè¿‡é™åˆ¶ â€œè„šæœ¬çš„åŠ è½½æ¥æºâ€ å’Œ â€œè„šæœ¬çš„æ‰§è¡Œæ–¹å¼â€ï¼Œç›´æ¥åˆ‡æ–­æ¶æ„è„šæœ¬çš„æ‰§è¡Œè·¯å¾„ï¼š</p>
<ul>
<li>ç¦æ­¢åŠ è½½æœªçŸ¥æ¥æºçš„è„šæœ¬ï¼šä¾‹å¦‚é€šè¿‡<code>script-src 'self' https://cdn.tencent.com</code>ï¼Œä»…å…è®¸åŠ è½½ç½‘ç«™è‡ªèº«ï¼ˆ<code>'self'</code>ï¼‰å’Œè…¾è®¯ CDN çš„è„šæœ¬ï¼Œæ¶æ„ç½‘ç«™çš„è„šæœ¬ä¼šè¢«ç›´æ¥æ‹¦æˆªï¼›</li>
<li>ç¦æ­¢å†…è”è„šæœ¬ï¼ˆå¦‚<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>ï¼‰å’Œ<code>eval()</code>å‡½æ•°ï¼šå†…è”è„šæœ¬æ˜¯ XSS æ”»å‡»çš„å¸¸ç”¨è½½ä½“ï¼ŒCSP é»˜è®¤æ‹’ç»å†…è”è„šæœ¬ï¼ˆéœ€æ˜¾å¼é…ç½®<code>'unsafe-inline'</code>æ‰å…è®¸ï¼Œä¸”ä¸æ¨èï¼‰ï¼ŒåŒæ—¶ç¦ç”¨<code>eval()</code>ç­‰åŠ¨æ€æ‰§è¡Œè„šæœ¬çš„å‡½æ•°ï¼Œå½»åº•æœç» â€œåŠ¨æ€æ³¨å…¥æ¶æ„ä»£ç â€ çš„å¯èƒ½ã€‚</li>
</ul>
<h3 data-id="heading-5">2. é˜²æ­¢æ•°æ®æ³¨å…¥ä¸æ¶æ„èµ„æºåŠ è½½</h3>
<p>é™¤äº†è„šæœ¬ï¼ŒCSP è¿˜èƒ½ç®¡æ§å›¾ç‰‡ã€æ ·å¼è¡¨ã€å­—ä½“ã€iframe ç­‰å„ç±»èµ„æºçš„åŠ è½½æ¥æºï¼š</p>
<ul>
<li>ä¾‹å¦‚é€šè¿‡<code>img-src https://img.example.com data:</code>ï¼Œä»…å…è®¸åŠ è½½æŒ‡å®šåŸŸåçš„å›¾ç‰‡å’Œ<code>data:</code>åè®®çš„ Base64 å›¾ç‰‡ï¼Œé¿å…æ”»å‡»è€…æ³¨å…¥æ¶æ„å›¾ç‰‡ï¼ˆå¦‚åŒ…å«æ¶æ„ä»£ç çš„ SVGï¼‰ï¼›</li>
<li>é€šè¿‡<code>frame-src 'none'</code>ç¦æ­¢åŠ è½½ä»»ä½• iframeï¼Œé˜²æ­¢ â€œç‚¹å‡»åŠ«æŒâ€ï¼ˆClickjackingï¼‰æ”»å‡» â€”â€” å³æ”»å‡»è€…é€šè¿‡ iframe åµŒå¥—åˆæ³•ç½‘ç«™ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»æ¶æ„æŒ‰é’®ã€‚</li>
</ul>
<h3 data-id="heading-6">3. å¢å¼ºç½‘ç«™çš„ â€œå®‰å…¨é€æ˜åº¦â€ï¼šæŠ¥å‘Šæœºåˆ¶</h3>
<p>CSP æ”¯æŒ â€œè¿è§„æŠ¥å‘Šâ€ åŠŸèƒ½ï¼šå½“æµè§ˆå™¨æ£€æµ‹åˆ°è¿å CSP è§„åˆ™çš„è¡Œä¸ºæ—¶ï¼ˆå¦‚å°è¯•åŠ è½½æœªæˆæƒçš„è„šæœ¬ï¼‰ï¼Œä¼šè‡ªåŠ¨å‘å¼€å‘è€…æŒ‡å®šçš„ â€œæŠ¥å‘Šåœ°å€â€ å‘é€ JSON æ ¼å¼çš„æ—¥å¿—ï¼ŒåŒ…å«è¿è§„èµ„æºçš„ URLã€è¿è§„ç±»å‹ã€è§¦å‘é¡µé¢ç­‰ä¿¡æ¯ã€‚</p>
<p>è¿™ä¸€æœºåˆ¶è®©å¼€å‘è€…èƒ½å®æ—¶ç›‘æ§ç½‘ç«™çš„å®‰å…¨é£é™©ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>å‘ç°æœªè¢«æ³¨æ„çš„ç¬¬ä¸‰æ–¹è„šæœ¬åŠ è½½ï¼ˆå¯èƒ½å­˜åœ¨å®‰å…¨éšæ‚£ï¼‰ï¼›</li>
<li>éªŒè¯ CSP è§„åˆ™æ˜¯å¦é…ç½®æ­£ç¡®ï¼ˆé¿å…è¯¯æ‹¦æˆªåˆæ³•èµ„æºï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7">4. å…¼å®¹ â€œæ¸è¿›å¼å®‰å…¨â€ï¼šä»æµ‹è¯•åˆ°å¼ºåˆ¶</h3>
<p>ä¸ºäº†é¿å…ç›´æ¥å¯ç”¨ CSP å¯¼è‡´åˆæ³•èµ„æºè¢«æ‹¦æˆªï¼ˆå½±å“ç½‘ç«™åŠŸèƒ½ï¼‰ï¼ŒCSP æä¾›äº† â€œæµ‹è¯•æ¨¡å¼â€ï¼šå°† HTTP å“åº”å¤´æ”¹ä¸º<code>Content-Security-Policy-Report-Only</code>ï¼Œæ­¤æ—¶æµè§ˆå™¨ä»…ä¼šè®°å½•è¿è§„è¡Œä¸ºï¼ˆå‘é€æŠ¥å‘Šï¼‰ï¼Œä½†ä¸ä¼šå®é™…é˜»æ­¢èµ„æºåŠ è½½ã€‚</p>
<h2 data-id="heading-8">ä¸‰ã€CSP çš„å…·ä½“ä½¿ç”¨ â€”â€” è§„åˆ™é…ç½®ã€å¸¸è§åœºæ™¯ä¸æ³¨æ„äº‹é¡¹</h2>
<p>CSP çš„ä½¿ç”¨æ ¸å¿ƒæ˜¯ â€œé…ç½®è§„åˆ™â€ï¼Œè€Œè§„åˆ™ç”± â€œæŒ‡ä»¤ï¼ˆDirectiveï¼‰â€ å’Œ â€œæºï¼ˆSourceï¼‰â€ ä¸¤éƒ¨åˆ†ç»„æˆã€‚ä¸‹é¢ä»åŸºç¡€é…ç½®é€»è¾‘ã€å¸¸è§åœºæ™¯ç¤ºä¾‹ã€é¿å‘æŒ‡å—ä¸‰ä¸ªæ–¹é¢ï¼Œè®²è§£ CSP çš„å®é™…åº”ç”¨ã€‚</p>
<h3 data-id="heading-9">1. åŸºç¡€ï¼šCSP çš„ â€œæŒ‡ä»¤â€ ä¸ â€œæºâ€ è¯¦è§£</h3>
<h4 data-id="heading-10">ï¼ˆ1ï¼‰æ ¸å¿ƒæŒ‡ä»¤ï¼šç®¡æ§ä¸åŒç±»å‹çš„èµ„æº</h4>
<p>CSP æä¾›äº†æ•°åç§æŒ‡ä»¤ï¼Œè¦†ç›–å„ç±»èµ„æºå’Œè¡Œä¸ºï¼Œä»¥ä¸‹æ˜¯æœ€å¸¸ç”¨çš„ 8 ä¸ªæŒ‡ä»¤ï¼š</p>


















































<table><thead><tr><th>æŒ‡ä»¤ï¼ˆDirectiveï¼‰</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>default-src</code></td><td>æ‰€æœ‰èµ„æºçš„ â€œé»˜è®¤åŠ è½½è§„åˆ™â€ï¼Œå½“å…¶ä»–æŒ‡ä»¤ï¼ˆå¦‚<code>script-src</code>ï¼‰æœªé…ç½®æ—¶ï¼Œä¼šç»§æ‰¿<code>default-src</code>çš„è§„åˆ™</td><td><code>default-src 'self'</code>ï¼ˆé»˜è®¤ä»…å…è®¸åŠ è½½è‡ªèº«åŸŸåèµ„æºï¼‰</td></tr><tr><td><code>script-src</code></td><td>ç®¡æ§ JavaScript è„šæœ¬çš„åŠ è½½ä¸æ‰§è¡Œï¼ˆæœ€å…³é”®çš„æŒ‡ä»¤ä¹‹ä¸€ï¼‰</td><td><code>script-src 'self' https://cdn.jsdelivr.net</code></td></tr><tr><td><code>style-src</code></td><td>ç®¡æ§ CSS æ ·å¼è¡¨çš„åŠ è½½ä¸æ‰§è¡Œ</td><td><code>style-src 'self' https://fonts.googleapis.com</code></td></tr><tr><td><code>img-src</code></td><td>ç®¡æ§å›¾ç‰‡èµ„æºï¼ˆjpgã€pngã€svg ç­‰ï¼‰çš„åŠ è½½</td><td><code>img-src 'self' https://img.baidu.com data:</code></td></tr><tr><td><code>font-src</code></td><td>ç®¡æ§å­—ä½“æ–‡ä»¶ï¼ˆwoffã€ttf ç­‰ï¼‰çš„åŠ è½½</td><td><code>font-src 'self' https://fonts.gstatic.com</code></td></tr><tr><td><code>frame-src</code></td><td>ç®¡æ§ iframe åµŒå¥—çš„æ¥æº</td><td><code>frame-src 'none'</code>ï¼ˆç¦æ­¢æ‰€æœ‰ iframeï¼‰</td></tr><tr><td><code>report-uri</code> / <code>report-to</code></td><td>æŒ‡å®šè¿è§„æŠ¥å‘Šçš„æ¥æ”¶åœ°å€ï¼ˆ<code>report-uri</code>æ˜¯æ—§æ ‡å‡†ï¼Œ<code>report-to</code>æ˜¯æ–°æ ‡å‡†ï¼Œå»ºè®®åŒæ—¶é…ç½®ï¼‰</td><td><code>report-uri /csp-report; report-to csp-endpoint</code></td></tr><tr><td><code>object-src</code></td><td>ç®¡æ§æ’ä»¶èµ„æºï¼ˆå¦‚ Flashã€Java Appletï¼Œç°åœ¨è¾ƒå°‘ä½¿ç”¨ï¼‰</td><td><code>object-src 'none'</code>ï¼ˆç¦æ­¢æ‰€æœ‰æ’ä»¶ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-11">ï¼ˆ2ï¼‰å¸¸è§ â€œæºâ€ å€¼ï¼šå®šä¹‰ â€œå®‰å…¨çš„èµ„æºæ¥æºâ€</h4>
<p>â€œæºâ€ æ˜¯æŒ‡ä»¤åç´§è·Ÿçš„ â€œå…è®¸åŠ è½½çš„èµ„æºåœ°å€â€ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼Œä»¥ä¸‹æ˜¯æœ€å¸¸ç”¨çš„ 5 ç§ï¼š</p>



































<table><thead><tr><th>æºï¼ˆSourceï¼‰</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>'self'</code></td><td>å…è®¸åŠ è½½å½“å‰ç½‘ç«™çš„åŒæºèµ„æºï¼ˆåŒåè®®ã€åŒåŸŸåã€åŒç«¯å£ï¼‰</td><td><code>default-src 'self'</code></td></tr><tr><td>å®Œæ•´åŸŸå</td><td>å…è®¸åŠ è½½æŒ‡å®šåŸŸåçš„èµ„æºï¼ˆå¯å¸¦ç«¯å£ï¼Œé»˜è®¤ 80/443ï¼‰</td><td><code>script-src https://cdn.example.com:8443</code></td></tr><tr><td>é€šé…ç¬¦åŸŸå</td><td>å…è®¸åŠ è½½æŒ‡å®šåŸŸåä¸‹çš„æ‰€æœ‰å­åŸŸåï¼ˆå¦‚<code>*.example.com</code>ï¼‰</td><td><code>img-src *.example.com</code></td></tr><tr><td><code>data:</code></td><td>å…è®¸åŠ è½½ Base64 ç¼–ç çš„èµ„æºï¼ˆå¦‚<code>data:image/png;base64,...</code>ï¼‰</td><td><code>img-src data:</code></td></tr><tr><td><code>'none'</code></td><td>ç¦æ­¢åŠ è½½è¯¥ç±»å‹çš„æ‰€æœ‰èµ„æº</td><td><code>frame-src 'none'</code></td></tr></tbody></table>
<p>âš ï¸ æ³¨æ„ï¼š<code>'self'</code>ã€<code>'none'</code>ã€<code>'unsafe-inline'</code>ç­‰å¸¦å¼•å·çš„å€¼ï¼Œ<strong>å¿…é¡»ä½¿ç”¨å•å¼•å·åŒ…è£¹</strong>ï¼Œå¦åˆ™æµè§ˆå™¨ä¼šå°†å…¶è¯†åˆ«ä¸º â€œåŸŸåâ€ï¼ˆå¦‚<code>self</code>ä¼šè¢«å½“ä½œ<code>self.com</code>ï¼‰ï¼Œå¯¼è‡´è§„åˆ™å¤±æ•ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯è¿›é˜¶ç³»åˆ—ä¹‹ã€Šæµè§ˆå™¨æ¸²æŸ“åŸç†ã€‹]]></title>    <link>https://juejin.cn/post/7577905525996732457</link>    <guid>https://juejin.cn/post/7577905525996732457</guid>    <pubDate>2025-11-29T23:47:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577905525996732457" data-draft-id="7577291435159797801" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è¿›é˜¶ç³»åˆ—ä¹‹ã€Šæµè§ˆå™¨æ¸²æŸ“åŸç†ã€‹"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-29T23:47:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸è¦æƒ³å¤ªå¤š"/> <meta itemprop="url" content="https://juejin.cn/user/2840793778760654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è¿›é˜¶ç³»åˆ—ä¹‹ã€Šæµè§ˆå™¨æ¸²æŸ“åŸç†ã€‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2840793778760654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸è¦æƒ³å¤ªå¤š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T23:47:50.000Z" title="Sat Nov 29 2025 23:47:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-cave-dark">.hljs-comment,.hljs-quote{color:#7e7887}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#be4678}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa573c}.hljs-bullet,.hljs-string,.hljs-symbol{color:#2a9292}.hljs-section,.hljs-title{color:#576ddb}.hljs-keyword,.hljs-selector-tag{color:#955ae7}.hljs-addition,.hljs-deletion{color:#19171c;display:inline-block;width:100%}.hljs-deletion{background-color:#be4678}.hljs-addition{background-color:#2a9292}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#19171c;color:#8b8792}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æƒ³ææ‡‚æµè§ˆå™¨æ˜¯æ€ä¹ˆå˜é­”æœ¯ï¼ŒæŠŠä»£ç å˜æˆçœ¼å‰æ¼‚äº®é¡µé¢çš„å—ï¼ŸğŸ©âœ¨ è¿™æ¬¡æˆ‘ä»¬å°±ä»¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.baidu.com%2F" target="_blank" title="https://www.baidu.com/" ref="nofollow noopener noreferrer">www.baidu.com/</a> ä¸ºä¾‹ï¼Œä¸€èµ·æ­å¼€è¿™åœºè§†è§‰é­”æœ¯çš„å¹•åç§˜å¯†ï¼ä»å‰ç«¯ä»£ç åˆ°æµç•…çš„ç”¨æˆ·ç•Œé¢ï¼Œæ¯ä¸€æ­¥éƒ½è—ç€è¶…æœ‰æ„æ€çš„ç»†èŠ‚ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ‰“é€ é«˜æ€§èƒ½å‰ç«¯åº”ç”¨çš„æ ¸å¿ƒåŸºçŸ³ï½å¿«è·Ÿä¸Šæˆ‘ï¼Œä¸€èµ·æ¢ç´¢è¿™åœºå¥‡å¦™çš„é¡µé¢è¯ç”Ÿè®°å§ï¼ğŸš€</p>
<blockquote>
<p>å½“æˆ‘ä»¬æ‰“å¼€ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.baidu.com%2F" target="_blank" title="https://www.baidu.com/" ref="nofollow noopener noreferrer">www.baidu.com/</a> å¦‚ä½•æ¸²æŸ“å‡ºä¸‹é¢çš„ç•Œé¢</p>
<p>ä»¥ Chrome æµè§ˆå™¨ä¸ºä¾‹</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90e353d1deec43c68550b92d7f26ac33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=BRDfDZa7V1TpnkSPLQiar3nop3s%3D" alt="baidu.com.png" loading="lazy"/></p>
<h2 data-id="heading-0">1ã€æµè§ˆå™¨çš„å¤šè¿›ç¨‹æ¶æ„</h2>
<blockquote>
<p>é¦–å…ˆæµè§ˆå™¨ä¼šåˆ†é…å‡ ä¸ªè¿›ç¨‹ï¼Œé¡µé¢çš„æ¸²æŸ“æ˜¯å¤šä¸ªè¿›ç¨‹ä¹‹é—´ç›¸äº’é…åˆçš„ç»“æœ</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/611a5986038e4051b2d7cad35507f9c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=O6988kahu2hhG3jk3khH6UJQUwE%3D" alt="5.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d90270b356fd48e6add17c6836933e90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=WH5gFevAqwWOHlpgcnwGZNVlKjs%3D" alt="6.png" loading="lazy"/></p>
<ul>
<li>æµè§ˆå™¨è¿›ç¨‹ï¼šä¸»è¦è´Ÿè´£ç•Œé¢æ˜¾ç¤ºã€ç”¨æˆ·äº¤äº’ï¼ŒåŒæ—¶æä¾›å­˜å‚¨ç­‰åŠŸèƒ½</li>
<li>æ¸²æŸ“è¿›ç¨‹ï¼šæ ¸å¿ƒä»»åŠ¡æ˜¯å°† HTMLã€CSS å’Œ JavaScript è½¬æ¢ä¸ºç”¨æˆ·å¯ä»¥ä¸ä¹‹äº¤äº’çš„ç½‘é¡µï¼ŒåŒ…å«æ’ç‰ˆå¼•æ“ Blinkã€V8 JS å¼•æ“ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒChrome ä¼šä¸ºæ¯ä¸ª Tab æ ‡ç­¾åˆ›å»ºä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹</li>
<li>ç½‘ç»œè¿›ç¨‹ï¼šä¸»è¦è´Ÿè´£é¡µé¢çš„ç½‘ç»œèµ„æºåŠ è½½</li>
<li>GPU è¿›ç¨‹ï¼šåªæœ‰ä¸€ä¸ª GPU è¿›ç¨‹ï¼Œä¸ºæ‰€æœ‰æµè§ˆå™¨ Tab æ ‡ç­¾é¡µæœåŠ¡ã€‚å®ƒè´Ÿè´£ä¸ GPU ç¡¬ä»¶ç›´æ¥é€šä¿¡ï¼Œæ‰§è¡Œé¡µé¢å…‰æ …åŒ–å’Œåˆæˆæ“ä½œ</li>
<li>Spare Rendererï¼ˆChrome å¤‡ç”¨æ¸²æŸ“è¿›ç¨‹ï¼‰ï¼š æ˜¯ä¸€ä¸ªåœ¨åå°æå‰å‡†å¤‡å¥½çš„ã€ç©ºé—²çš„ç½‘é¡µæ¸²æŸ“è¿›ç¨‹ï¼Œç›®çš„æ˜¯æå‡ç”¨æˆ·ä½“éªŒå’Œæµè§ˆé€Ÿåº¦è€Œé‡‡ç”¨çš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥</li>
<li>æ’ä»¶è¿›ç¨‹ï¼šä¸»è¦æ˜¯è´Ÿè´£æ’ä»¶çš„è¿è¡Œï¼Œå› æ’ä»¶æ˜“å´©æºƒï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡æ’ä»¶è¿›ç¨‹æ¥éš”ç¦»</li>
</ul>
<p>é¡µé¢çš„æ¸²æŸ“éœ€è¦å¤šè¿›ç¨‹ä¹‹é—´ç›¸äº’æ­é…ï¼Œé‡ç‚¹åœ¨äºæµè§ˆå™¨è¿›ç¨‹ã€æ¸²æŸ“è¿›ç¨‹ã€ç½‘ç»œè¿›ç¨‹ã€GPUè¿›ç¨‹ä¹‹é—´çš„é…åˆ</p>
<h2 data-id="heading-1">2ã€HTTP è¯·æ±‚è¿‡ç¨‹</h2>
<p>æµè§ˆå™¨ä¸­çš„ HTTP è¯·æ±‚ä»å‘èµ·åˆ°ç»“æŸä¸€å…±ç»å†äº†å¦‚ä¸‹å…«ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>
<p>æ„å»ºè¯·æ±‚ï¼š<code>GET https://www.baidu.com/ HTTP2</code></p>
</li>
<li>
<p>æŸ¥æ‰¾ç¼“å­˜ï¼šå½“æµè§ˆå™¨å‘ç°è¯·æ±‚çš„èµ„æºå·²ç»åœ¨æµè§ˆå™¨ç¼“å­˜ä¸­å­˜æœ‰å‰¯æœ¬ï¼Œå®ƒä¼šæ‹¦æˆªè¯·æ±‚ï¼Œè¿”å›è¯¥èµ„æºçš„å‰¯æœ¬ï¼Œå¹¶ç›´æ¥ç»“æŸè¯·æ±‚ï¼Œè€Œä¸ä¼šå†å»æºæœåŠ¡å™¨é‡æ–°ä¸‹è½½</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e7d009f3eeb44f8a9a43324346f6cd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=v%2B%2BVqeS54YTYF43n4DjQ3UTldjE%3D" alt="1.webp" loading="lazy"/></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">*</span> ç¼“å­˜æ–¹å¼ï¼šå¼ºåˆ¶ç¼“å­˜/åå•†ç¼“å­˜ 200 304 Cache-Control/Last-Modified/ETag

<span class="hljs-bullet">*</span> ç¼“å­˜åˆ†ç±»ï¼šMemory Cache/Disk Cache/Service Worker/Push Cacheï¼ˆHTTP 2ï¼‰
</code></pre>
<ul>
<li>å‡†å¤‡ IP å’Œç«¯å£ï¼šè¯·æ±‚ DNS ç³»ç»Ÿè¿”å›åŸŸåå¯¹åº”çš„ IPã€ç«¯å£<code>www.baidu.comï¼š170.114.52.116:443</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b32c4f1625fd4ce1be246d6ee70525f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=%2Bj%2BtiOWQ7E3VKs0%2Fef0gJRRHwW8%3D" alt="2.png" loading="lazy"/></p>
<ul>
<li>
<p>ç­‰å¾… TCP é˜Ÿåˆ—ï¼šåŒä¸€ä¸ªåŸŸååŒæ—¶æœ€å¤šåªèƒ½å»ºç«‹ 6 ä¸ª TCPï¼ˆhttp1.1ï¼‰ è¿æ¥ï¼Œå…¶ä»–è¯·æ±‚è¿›å…¥æ’é˜Ÿç­‰å¾…</p>
</li>
<li>
<p>å»ºç«‹ TCP è¿æ¥ï¼šä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ€»å…±è¦å‘é€ä¸‰ä¸ªæ•°æ®åŒ…ä»¥ç¡®è®¤è¿æ¥çš„å»ºç«‹</p>
</li>
<li>
<p>å‘èµ· HTTP è¯·æ±‚ï¼šHTTP è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“</p>
</li>
<li>
<p>æœåŠ¡å™¨å¤„ç†è¯·æ±‚/æœåŠ¡å™¨è¿”å›è¯·æ±‚ï¼šè¿”å›å“åº”è¡Œã€å“åº”å¤´ã€å“åº”ä½“</p>
</li>
<li>
<p>æ–­å¼€è¿æ¥ï¼šæ‰§è¡Œ"å››æ¬¡æŒ¥æ‰‹"æ¥ä¿è¯åŒæ–¹éƒ½èƒ½æ–­å¼€è¿æ¥</p>
</li>
</ul>
<h2 data-id="heading-2">3ã€ä»è¾“å…¥ URL åˆ°é¡µé¢å±•ç¤º</h2>
<blockquote>
<p>æ•´ä¸ªè¿‡ç¨‹éœ€è¦å„ä¸ªè¿›ç¨‹ä¹‹é—´çš„é…åˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/060102af273a45e2808f53d20f7ddd68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=uZafNkcRJiNYctUDgcxy2WX%2Bbdo%3D" alt="3.webp" loading="lazy"/></p>
<ul>
<li>
<p>ç”¨æˆ·è¾“å…¥ï¼šæµè§ˆå™¨è¿›ç¨‹åˆ¤æ–­è¾“å…¥çš„å…³é”®å­—æ˜¯æœç´¢å†…å®¹ï¼Œè¿˜æ˜¯è¯·æ±‚çš„ URLï¼Œæ•´åˆæˆå®Œæ•´çš„ URL</p>
</li>
<li>
<p>URL è¯·æ±‚è¿‡ç¨‹ï¼šæµè§ˆå™¨è¿›ç¨‹ä¼šé€šè¿‡ IPC æŠŠ URL è¯·æ±‚å‘é€è‡³ç½‘ç»œè¿›ç¨‹ï¼Œç½‘ç»œè¿›ç¨‹æ¥æ”¶åˆ° URL è¯·æ±‚åï¼Œä¼šå‘èµ·è¯·æ±‚ï¼Œæ‰§è¡Œæ­¥éª¤äºŒã€‚è¿™é‡Œè¡¥å……å‡ ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹</p>
<blockquote>
<ul>
<li>
<p>å“åº”çŠ¶æ€ç ï¼š301/302 200 304 400 500â€¦</p>
</li>
<li>
<p>å“åº”ç±»å‹ï¼ˆContent-Typeï¼‰ï¼šæœåŠ¡å™¨è¿”å›çš„å“åº”ä½“æ•°æ®æ˜¯ä»€ä¹ˆç±»</p>
</li>
</ul>
</blockquote>
<blockquote>
<pre><code class="hljs language-bash" lang="bash">1.  text/htmlï¼šæœåŠ¡å™¨è¿”å›çš„æ•°æ®æ˜¯ HTML æ ¼å¼ï¼Œè§¦å‘æ¸²æŸ“æµç¨‹
2.  application/octet-streamï¼šæ•°æ®æ˜¯å­—èŠ‚æµç±»å‹çš„ï¼Œè§¦å‘ä¸‹è½½æµç¨‹
3.  application/jsonï¼šJSON å­—æ®µï¼Œå‰åç«¯å¸¸è§ç±»å‹
4.  text/cssï½œtext/javascript ï½œapplication/javascriptï¼šCSS æ–‡ä»¶ã€JS æ–‡ä»¶
</code></pre>
</blockquote>
</li>
<li>
<p>å‡†å¤‡æ¸²æŸ“è¿›ç¨‹ï¼šç½‘ç»œè¿›ç¨‹å°†å“åº”ä¿¡æ¯ä¼ é€’ç»™æµè§ˆå™¨è¿›ç¨‹ï¼Œå¦‚æœæ˜¯ text/htmlï¼Œåˆ™æ¸²æŸ“è¿›ç¨‹å‡†å¤‡æ¥æ”¶æ•°æ®</p>
</li>
<li>
<p>æäº¤æ–‡æ¡£ï¼šæ–‡æ¡£å¯ä»¥ç†è§£ä¸ºå“åº”ä½“å³è¿”å›çš„ HTML å†…å®¹</p>
<blockquote>
<ul>
<li>æ‰€è°“æäº¤æ–‡æ¡£ï¼Œå°±æ˜¯æŒ‡æµè§ˆå™¨è¿›ç¨‹å°†ç½‘ç»œè¿›ç¨‹æ¥æ”¶åˆ°çš„ HTML æ•°æ®æäº¤ç»™æ¸²æŸ“è¿›ç¨‹</li>
<li>æ¸²æŸ“è¿›ç¨‹æ¥æ”¶åˆ°"æäº¤æ–‡æ¡£"çš„æ¶ˆæ¯åï¼Œä¼šå’Œç½‘ç»œè¿›ç¨‹å»ºç«‹ä¼ è¾“æ•°æ®çš„"ç®¡é“"</li>
</ul>
</blockquote>
</li>
<li>
<p>æ¸²æŸ“é˜¶æ®µï¼šå½“æ¸²æŸ“è¿›ç¨‹æ¥æ”¶åˆ°ç½‘ç»œè¿›ç¨‹çš„å“åº”æ•°æ®æ—¶ï¼Œä¾¿å¼€å§‹é¡µé¢è§£æå’Œå­èµ„æºåŠ è½½äº†ï¼Œè¾¹åŠ è½½è¾¹è§£æ</p>
</li>
</ul>
<p>æ¥ä¸‹æ¥å°±è¿›å…¥åˆ°å¦å¤–ä¸€ä¸ªéƒ¨åˆ†ï¼Œæ¸²æŸ“è¿›ç¨‹å°†ç½‘ç»œè¿›ç¨‹æ¥æ”¶åˆ°çš„ HTML + CSS + JS ç”Ÿæˆé¡µé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42ccb82030af449ea565b17e531836b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=i4S3W2UD5axmgGP5lVLdgz%2F%2FxhQ%3D" alt="4.webp" loading="lazy"/></p>
<h2 data-id="heading-3">4ã€é¡µé¢æ¸²æŸ“æµç¨‹ - æ¸²æŸ“æµæ°´çº¿</h2>
<p>å½“ç½‘ç»œè¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹å»ºç«‹ç®¡é“é“¾æ¥æ—¶ï¼Œæ¸²æŸ“è¿›ç¨‹ä¾¿å¯ä»¥æ¥æ”¶ HTML CSS JS ç­‰æ•°æ®ï¼Œæ¥ä¸‹æ¥æ¸²æŸ“è¿›ç¨‹å¼€å§‹æ¸²æŸ“å·¥ä½œã€‚ä½†æ¸²æŸ“æœºåˆ¶è¿‡äºå¤æ‚ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šè¢«åˆ’åˆ†ä¸ºå¾ˆå¤šå­é˜¶æ®µï¼Œè¾“å…¥çš„ HTML ç»è¿‡è¿™äº›å­é˜¶æ®µæ˜¾ç¤ºæˆé¡µé¢ï¼Œè¿™æ ·çš„å¤„ç†æµç¨‹å«åšæ¸²æŸ“æµæ°´çº¿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7076fb168f044d0893afb5105e06ee96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=tX7sRWcKe3SNtRSOjXapPlshaUU%3D" alt="6.webp" loading="lazy"/></p>
<p>æŒ‰ç…§æ¸²æŸ“çš„æ—¶é—´é¡ºåºï¼Œæµæ°´çº¿å¯åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªå­é˜¶æ®µï¼š</p>
<p>æ„å»º DOM æ ‘ã€æ ·å¼è®¡ç®—ã€å¸ƒå±€é˜¶æ®µã€åˆ†å±‚ã€ç»˜åˆ¶ã€æ …æ ¼åŒ–å’Œåˆæˆ</p>
<h3 data-id="heading-4">4.1 æ„å»º DOM æ ‘</h3>
<blockquote>
<p>æµè§ˆå™¨æ— æ³•ç›´æ¥ç†è§£å’Œä½¿ç”¨æœåŠ¡å™¨è¿”å›çš„ HTMLï¼Œæ‰€ä»¥éœ€è¦å°† HTML è½¬æ¢ä¸ºæµè§ˆå™¨èƒ½å¤Ÿç†è§£çš„ç»“æ„â€”â€”DOM æ ‘ï¼Œ HTML ç»è¿‡ HTML è§£æå™¨è§£æï¼Œç”Ÿæˆæ ‘çŠ¶ç»“æ„çš„ DOM</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1addf32e715f4e749b339c8c5758a677~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=kcW7FPTXS%2FRFR5%2FojEOb%2Fpx%2FAeQ%3D" alt="7.webp" loading="lazy"/></p>
<h3 data-id="heading-5">4.2 æ ·å¼è®¡ç®—</h3>
<blockquote>
<p>æ ·å¼è®¡ç®—çš„ç›®çš„æ˜¯ä¸ºäº†è®¡ç®—å‡º DOM èŠ‚ç‚¹ä¸­æ¯ä¸ªå…ƒç´ çš„å…·ä½“æ ·å¼ï¼Œè¿™ä¸ªé˜¶æ®µå¤§ä½“å¯åˆ†ä¸ºä¸‰æ­¥æ¥å®Œæˆ</p>
</blockquote>
<ol>
<li>æŠŠ CSS è½¬æ¢ä¸ºæµè§ˆå™¨èƒ½å¤Ÿç†è§£çš„ç»“æ„ï¼šstyleSheets</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/062e8dded5354e588de28bc0e32a382d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=1XD%2BchD%2FMZbfWHt8DVuJfDcNt9w%3D" alt="8.webp" loading="lazy"/></p>
<ol start="2">
<li>è½¬æ¢æ ·å¼è¡¨ä¸­çš„å±æ€§å€¼ï¼Œä½¿å…¶æ ‡å‡†åŒ–</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43af6b790b85415bb451dd2afa7496f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=CukPSRb%2B95120umOARU6Y72vTHY%3D" alt="9.webp" loading="lazy"/></p>
<ol start="3">
<li>è®¡ç®—å‡º DOM æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å…·ä½“æ ·å¼ï¼šç»§æ‰¿è§„åˆ™å’Œå±‚å è§„åˆ™</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03fd778c95714eb7afed29877c8d13ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=l55TVmGcaoxzm%2ByXjjwzEJ%2BgulM%3D" alt="11.webp" loading="lazy"/></p>
<h3 data-id="heading-6">4.3 å¸ƒå±€é˜¶æ®µ</h3>
<blockquote>
<p>ç°åœ¨æˆ‘ä»¬æœ‰ DOM æ ‘å’Œ DOM æ ‘ä¸­å…ƒç´ çš„æ ·å¼ï¼Œæ¥ä¸‹æ¥éœ€è¦è®¡ç®—å‡º DOM æ ‘ä¸­å¯è§å…ƒç´ çš„å‡ ä½•ä½ç½®ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªè®¡ç®—è¿‡ç¨‹å«åšå¸ƒå±€</p>
</blockquote>
<p>åˆ›å»ºå¸ƒå±€æ ‘ï¼šåªåŒ…å«å¯è§å…ƒç´ çš„çš„å¸ƒå±€æ ‘</p>
<ul>
<li>æ¸²æŸ“è¿›ç¨‹éå† DOM æ ‘ä¸­çš„æ‰€æœ‰å¯è§èŠ‚ç‚¹ï¼Œå¹¶æŠŠè¿™äº›èŠ‚ç‚¹åŠ åˆ°å¸ƒå±€æ ‘ä¸­ï¼›</li>
<li>è€Œä¸å¯è§çš„èŠ‚ç‚¹ä¼šè¢«å¸ƒå±€æ ‘å¿½ç•¥æ‰ï¼Œå¦‚ head æ ‡ç­¾ä¸‹é¢çš„å…¨éƒ¨å†…å®¹ã€displayï¼šnone</li>
</ul>
<p>å¸ƒå±€è®¡ç®—ï¼šè®¡ç®—å¸ƒå±€æ ‘çš„å‡ ä½•ä½ç½®</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0298055a4b7406a9c167ed007bc9ff6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=tuhsCh79VMR4QmZvV7dlgWOmuOM%3D" alt="-1.webp" loading="lazy"/></p>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬å®Œæˆäº†æ¸²æŸ“æµç¨‹çš„å‰ä¸‰ä¸ªé˜¶æ®µï¼šDOM ç”Ÿæˆã€æ ·å¼è®¡ç®—å’Œå¸ƒå±€ï¼Œåƒä¸‹å›¾ä¸€æ ·</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38fafaf67d564765849d15df0f9da5a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=ZAvJ5DoBpJW6Gnn4mXr9vLr941Q%3D" alt="-2.png" loading="lazy"/></p>
<h3 data-id="heading-7">4.4 åˆ†å±‚</h3>
<blockquote>
<p>æˆ‘ä»¬çœ‹åˆ°çš„ç•Œé¢éƒ½æ˜¯å¤šä¸ªå›¾å±‚ç›¸äº’å åŠ çš„ç»“æœï¼Œç±»ä¼¼äº PS çš„å›¾å±‚ä¸€æ ·</p>
<p>positionï¼šfixedã€z-indexing åš z è½´æ’åºéƒ½ä¼šæœ‰æ–°çš„å›¾å±‚</p>
</blockquote>
<p>æ¸²æŸ“å¼•æ“éœ€è¦ä¸ºèŠ‚ç‚¹ç”Ÿæˆä¸“ç”¨çš„å›¾å±‚ï¼Œå¹¶ç”Ÿæˆä¸€æ£µå¯¹åº”çš„å›¾å±‚æ ‘ï¼ˆLayerTreeï¼‰ï¼Œå…·æœ‰å‡ ä¸ªç‰¹ç‚¹</p>
<ul>
<li>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å¯¹åº”çš„å±‚ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä»å±äºçˆ¶èŠ‚ç‚¹çš„å›¾å±‚</li>
<li>æ‹¥æœ‰å±‚å ä¸Šä¸‹æ–‡å±æ€§çš„å…ƒç´ ä¼šè¢«æå‡ä¸ºå•ç‹¬çš„ä¸€å±‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92fd13e7b77946c996dde781af94250f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=ZjAHq2sQ%2FrgMRtvuDJN8XAde3Co%3D" alt="-3.webp" loading="lazy"/></p>
<h3 data-id="heading-8">4.5 å›¾å±‚ç»˜åˆ¶</h3>
<blockquote>
<p>æ¸²æŸ“å¼•æ“ä¼šæŠŠä¸€ä¸ªå›¾å±‚çš„ç»˜åˆ¶æ‹†åˆ†æˆå¾ˆå¤šå°çš„ç»˜åˆ¶æŒ‡ä»¤ï¼Œç„¶åå†æŠŠè¿™äº›æŒ‡ä»¤æŒ‰ç…§é¡ºåºç»„æˆä¸€ä¸ªå¾…ç»˜åˆ¶åˆ—è¡¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8419954e7054a288e8a6837f6d7a3e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=G5tHj8wvbSQl6Fdp8wu6L%2BG0ozg%3D" alt="-4.webp" loading="lazy"/></p>
<ul>
<li>ç»˜åˆ¶åˆ—è¡¨ä¸­çš„æŒ‡ä»¤å…¶å®éå¸¸ç®€å•ï¼Œå°±æ˜¯è®©å…¶æ‰§è¡Œä¸€ä¸ªç®€å•çš„ç»˜åˆ¶æ“ä½œï¼Œæ¯”å¦‚ç»˜åˆ¶ç²‰è‰²çŸ©å½¢æˆ–è€…é»‘è‰²çš„çº¿ç­‰</li>
<li>è€Œç»˜åˆ¶ä¸€ä¸ªå…ƒç´ é€šå¸¸éœ€è¦å¥½å‡ æ¡ç»˜åˆ¶æŒ‡ä»¤ï¼Œå› ä¸ºæ¯ä¸ªå…ƒç´ çš„èƒŒæ™¯ã€å‰æ™¯ã€è¾¹æ¡†éƒ½éœ€è¦å•ç‹¬çš„æŒ‡ä»¤å»ç»˜åˆ¶</li>
<li>æ‰€ä»¥åœ¨å›¾å±‚ç»˜åˆ¶é˜¶æ®µï¼Œäº§ç”Ÿçš„å†…å®¹å°±æ˜¯è¿™äº›å¾…ç»˜åˆ¶åˆ—è¡¨</li>
</ul>
<h3 data-id="heading-9">4.5 æ …æ ¼åŒ–ï¼ˆå¤æ‚ï¼‰</h3>
<p>æ–°çš„åç§°ï¼šåˆæˆçº¿ç¨‹</p>
<blockquote>
<p>åˆæˆçº¿ç¨‹ æ˜¯æ¸²æŸ“è¿›ç¨‹ä¸­ç‹¬ç«‹äºä¸»çº¿ç¨‹çš„ä¸€ä¸ªå…³é”®å·¥ä½œçº¿ç¨‹ï¼Œå®ƒçš„ä¸»è¦ç›®æ ‡æ˜¯é«˜æ•ˆåœ°å°†é¡µé¢çš„ä¸åŒéƒ¨åˆ†åˆæˆæœ€ç»ˆçš„å›¾åƒï¼Œå¹¶å‘é€ç»™GPUè¿›è¡Œç»˜åˆ¶ï¼Œä»è€Œç¡®ä¿æ»šåŠ¨ã€åŠ¨ç”»ç­‰æ“ä½œæå…¶æµç•…</p>
</blockquote>
<p>ç¬¬ 1 æ­¥ï¼šå½“å›¾å±‚çš„ç»˜åˆ¶åˆ—è¡¨å‡†å¤‡å¥½ä¹‹åï¼Œä¸»çº¿ç¨‹ä¼šæŠŠå›¾å±‚ç»˜åˆ¶åˆ—è¡¨æäº¤ç»™åˆæˆçº¿ç¨‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c11d618879244910823280d6eeacfa00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=W5Pu8b2Zs5ypZfOrbXZ4AHORgtI%3D" alt="01.webp" loading="lazy"/></p>
<p>ä¸¤ä¸ªæ¦‚å¿µ</p>
<ul>
<li>è§†å£ï¼šé€šå¸¸é¡µé¢å¾ˆé•¿ï¼Œç”¨æˆ·èƒ½çœ‹åˆ°çš„éƒ¨åˆ†å«åšè§†å£</li>
<li>å›¾å—ï¼šåˆæˆçº¿ç¨‹ä¼šå°†å›¾å±‚åˆ’åˆ†ä¸ºå›¾å—ï¼Œè¿™äº›å›¾å—çš„å¤§å°é€šå¸¸æ˜¯ 256 * 256 px æˆ–è€… 512 * 512 px</li>
</ul>
<p>ç¬¬ 2 æ­¥ï¼šåˆæˆçº¿ç¨‹ä¼šä¸ºæ¯ä¸ªå›¾å—ç”Ÿæˆå¯¹åº”çš„å…‰æ …åŒ–ä»»åŠ¡</p>
<ul>
<li>è¿™ä¸ªä»»åŠ¡åŒ…å«äº†"å›¾å—çš„ä½ç½®ã€å›¾å—æ‰€å±å›¾å±‚çš„é‚£éƒ¨åˆ†ç»˜åˆ¶è®°å½•" çš„ä¿¡æ¯</li>
<li>ç”±æ¸²æŸ“è¿›ç¨‹çš„æ …æ ¼åŒ–çº¿ç¨‹æ‰§è¡Œï¼Œä¼˜å…ˆå¤„ç†è§†å£é™„è¿‘çš„å›¾å—</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/301a8d5c97b946a8985c6d60311194e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=JJ2XJioBQCU1EzQJR6yrICA3oQM%3D" alt="02.webp" loading="lazy"/></p>
<p>ç¬¬ 3 æ­¥ï¼šæäº¤ä»»åŠ¡åˆ° GPU è¿›ç¨‹</p>
<ul>
<li>æ …æ ¼åŒ–çº¿ç¨‹å°†è¿™äº›å…‰æ …åŒ–ä»»åŠ¡ä»¥åŠç›¸å…³çš„ç»˜åˆ¶è®°å½•ï¼ˆä½œä¸ºæ•°æ®æºï¼‰æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­</li>
<li>ç„¶åï¼Œå®ƒé€šè¿‡ IPC å°†ä»»åŠ¡é˜Ÿåˆ—æäº¤ç»™ GPU è¿›ç¨‹ã€‚è¿›è¡Œ GPUåŠ é€Ÿ</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/150efc4f7efa4375957915c22bbe6a74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=Q4xgs4DlMbB5pzPpLEQXodG2%2Fy8%3D" alt="03.webp" loading="lazy"/></p>
<p>ç¬¬ 4 æ­¥ï¼šGPU è¿›ç¨‹ä¸ GPU ç¡¬ä»¶æ‰§è¡Œå…‰æ …åŒ–</p>
<ul>
<li>GPU è¿›ç¨‹æ¥æ”¶ä»»åŠ¡ï¼šGPU è¿›ç¨‹æ”¶åˆ°æ¥è‡ªæ¸²æŸ“è¿›ç¨‹ï¼ˆåˆæˆçº¿ç¨‹ï¼‰çš„ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
<li>è¿›è¡Œå…‰æ …åŒ–æ“ä½œ</li>
</ul>
<p>ä»€ä¹ˆæ˜¯å…‰æ …åŒ–ï¼Ÿ</p>
<p>ç®€å•è¯´ï¼Œå°±æ˜¯å°†çŸ¢é‡å›¾å½¢ï¼ˆå¦‚ç»˜åˆ¶è®°å½•ä¸­çš„çŸ©å½¢ã€è·¯å¾„ã€æ–‡å­—å‘½ä»¤ï¼‰è½¬æ¢ä¸ºå±å¹•ä¸Šçš„åƒç´ ï¼ˆä½å›¾ï¼‰çš„è¿‡ç¨‹ã€‚GPU è¿›ç¨‹ä¼šé©±åŠ¨ GPU ç¡¬ä»¶æ¥æ‰§è¡Œå®é™…çš„å…‰æ …åŒ–å·¥ä½œã€‚å®ƒåˆ©ç”¨ GPU ä¸Šå¼ºå¤§çš„ã€é«˜åº¦å¹¶è¡ŒåŒ–çš„å…‰æ …åŒ–å™¨æ¥é«˜æ•ˆå®Œæˆæ­¤ä»»åŠ¡</p>
<ul>
<li>ç»“æœå­˜å‚¨ï¼šå…‰æ …åŒ–åçš„æ¯ä¸ªå›¾å—å­˜å‚¨åœ¨ GPU çš„æ˜¾å­˜ä¸­</li>
</ul>
<h3 data-id="heading-10">4.6 åˆæˆå’Œæ˜¾ç¤º</h3>
<p>ç¬¬ 1 æ­¥ï¼šç”Ÿæˆç»˜åˆ¶ï¼ˆDrawQuadï¼‰æŒ‡ä»¤</p>
<ul>
<li>å½“æ‰€æœ‰ï¼ˆæˆ–ä¼˜å…ˆçš„ï¼‰å›¾å—éƒ½å…‰æ …åŒ–å®Œæˆåï¼Œåˆæˆçº¿ç¨‹ä¼šæ”¶é›†æ¯ä¸ªå›¾å—åœ¨ GPU æ˜¾å­˜ä¸­çš„ä½ç½®ä¿¡æ¯ï¼ˆIDï¼‰</li>
</ul>
<p>ç¬¬ 2 æ­¥ï¼šå’Œæµè§ˆå™¨è¿›ç¨‹é€šä¿¡</p>
<ul>
<li>æµè§ˆå™¨è¿›ç¨‹é‡Œé¢æœ‰ä¸€ä¸ªå« viz çš„ç»„ä»¶ï¼Œç”¨æ¥æ¥æ”¶åˆæˆçº¿ç¨‹å‘è¿‡æ¥çš„åˆæˆå›¾åƒ</li>
<li>ç„¶åæµè§ˆå™¨è¿›ç¨‹å’Œ GPU è¿›ç¨‹é€šä¿¡ï¼Œå‘é€åˆæˆå¸§</li>
</ul>
<p>ç¬¬ 3 æ­¥ï¼šGPU è¿›ç¨‹é©±åŠ¨åˆæˆ</p>
<ul>
<li>GPU è¿›ç¨‹æ¥æ”¶åˆ°åˆæˆå¸§åï¼Œä¼šå‘ GPU å‘é€æœ€ç»ˆçš„ç»˜åˆ¶å‘½ä»¤</li>
<li>GPU æ ¹æ®åˆæˆå¸§çš„æŒ‡ä»¤ï¼Œå°†å„ä¸ªå›¾å—çº¹ç†ï¼ˆå°±åƒä¸€å¼ å¼ å›¾ç‰‡ï¼‰ç»˜åˆ¶åˆ°å±å¹•ç¼“å†²åŒºçš„æ­£ç¡®ä½ç½®ä¸Š</li>
</ul>
<p>ä»¥ä¸Šè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åˆæˆ ï¼Œå®ƒé€šå¸¸é€šè¿‡éå¸¸é«˜æ•ˆçš„ç¡¬ä»¶åŠ é€Ÿæ“ä½œï¼ˆå¦‚çº¹ç†æ˜ å°„ï¼‰æ¥å®Œæˆ</p>
<p>æ˜¾ç¤ºï¼šæœ€ç»ˆï¼Œå±å¹•çš„æ˜¾ç¤ºæ§åˆ¶å™¨ä»å¸§ç¼“å†²åŒºè¯»å–æ•°æ®ï¼Œå¹¶å°†åƒç´ ç‚¹äº®ï¼Œç”¨æˆ·å°±çœ‹åˆ°äº†æœ€ç»ˆçš„é¡µé¢</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b7f22afad764f7dbbd738108c43f60e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=VKW5u26mpgr4JrVE5v7BJVbpPCo%3D" alt="06.webp" loading="lazy"/></p>
<p>ç»“åˆä¸Šå›¾ï¼Œä¸€ä¸ªå®Œæ•´çš„æ¸²æŸ“æµç¨‹å¤§è‡´å¯æ€»ç»“ä¸ºå¦‚ä¸‹ï¼š</p>
<blockquote>
<ol>
<li>æ¸²æŸ“è¿›ç¨‹å°† HTML å†…å®¹è½¬æ¢ä¸ºèƒ½å¤Ÿè¯»æ‡‚çš„ DOM æ ‘ç»“æ„</li>
<li>æ¸²æŸ“å¼•æ“å°† CSS æ ·å¼è¡¨è½¬åŒ–ä¸ºæµè§ˆå™¨å¯ä»¥ç†è§£çš„ styleSheetsï¼Œè®¡ç®—å‡º DOM èŠ‚ç‚¹çš„æ ·å¼</li>
<li>åˆ›å»ºå¸ƒå±€æ ‘ï¼Œå¹¶è®¡ç®—å…ƒç´ çš„å¸ƒå±€ä¿¡æ¯</li>
<li>å¯¹å¸ƒå±€æ ‘è¿›è¡Œåˆ†å±‚ï¼Œå¹¶ç”Ÿæˆåˆ†å±‚æ ‘</li>
<li>ä¸ºæ¯ä¸ªå›¾å±‚ç”Ÿæˆç»˜åˆ¶åˆ—è¡¨ï¼Œå¹¶å°†å…¶æäº¤åˆ°åˆæˆçº¿ç¨‹</li>
<li>åˆæˆçº¿ç¨‹å°†å›¾å±‚åˆ†æˆå›¾å—ï¼Œå¹¶åœ¨å…‰æ …åŒ–çº¿ç¨‹æ± ä¸­é…åˆ GPU å°†å›¾å—è½¬æ¢æˆä½å›¾</li>
<li>åˆæˆçº¿ç¨‹å‘é€ç»˜åˆ¶å›¾å—å‘½ä»¤ DrawQuad ç»™æµè§ˆå™¨è¿›ç¨‹</li>
<li>æµè§ˆå™¨è¿›ç¨‹æ ¹æ® DrawQuad æ¶ˆæ¯ç”Ÿæˆé¡µé¢ï¼Œå¹¶æ˜¾ç¤ºåˆ°æ˜¾ç¤ºå™¨ä¸Š</li>
</ol>
</blockquote>
<h2 data-id="heading-11">5ã€æ‹“å±•å†…å®¹</h2>
<h3 data-id="heading-12">5.1 é¡µé¢çš„é‡æ–°æ¸²æŸ“ï¼ˆé‡æ’ã€é‡ç»˜ï¼‰</h3>
<p>æ¥ä»‹ç»ä»¥ä¸‹å‰ç«¯å¸¸è¯´çš„æ¸²æŸ“æµæ°´çº¿ä¸­ä¸¤ä¸ªæ¦‚å¿µï¼Œé‡æ’ã€é‡ç»˜</p>
<p>1ã€é‡æ’ï¼šæ›´æ–°å…ƒç´ çš„å‡ ä½•ä½ç½®</p>
<blockquote>
<p>ä¾‹å¦‚æ”¹å˜å…ƒç´ çš„å®½åº¦ã€é«˜åº¦ç­‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šè§¦å‘é‡æ–°å¸ƒå±€ï¼Œè§£æä¹‹åçš„ä¸€ç³»åˆ—å­é˜¶æ®µï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«é‡æ’ã€‚æ— ç–‘ï¼Œé‡æ’éœ€è¦æ›´æ–°å®Œæ•´çš„æ¸²æŸ“æµæ°´çº¿ï¼Œæ‰€ä»¥å¼€é”€ä¹Ÿæ˜¯æœ€å¤§çš„</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07c8bfa528df4fb8ac89fc0254b73d88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=KoMEs3LKojk5QcIHG6c1eUpkwXA%3D" alt="07.webp" loading="lazy"/></p>
<p>å¸¸è§çš„å¼•èµ·é‡æ’çš„æ–¹å¼</p>
<ul>
<li>
<p>é¡µé¢é¦–æ¬¡æ¸²æŸ“</p>
</li>
<li>
<p>æµè§ˆå™¨çª—å£å¤§å°å‘ç”Ÿå˜åŒ–</p>
</li>
<li>
<p>å…ƒç´ çš„å†…å®¹å‘ç”Ÿå˜åŒ–</p>
</li>
<li>
<p>å…ƒç´ çš„å°ºå¯¸æˆ–è€…ä½ç½®å‘ç”Ÿå˜åŒ–</p>
</li>
<li>
<p>å…ƒç´ çš„å­—ä½“å¤§å°å‘ç”Ÿå˜åŒ–</p>
</li>
<li>
<p>æ·»åŠ æˆ–è€…åˆ é™¤å¯è§çš„DOMå…ƒç´ </p>
</li>
</ul>
<p>2ã€é‡ç»˜ï¼šæ›´æ–°å…ƒç´ çš„ç»˜åˆ¶å±æ€§</p>
<blockquote>
<p>æ¯”å¦‚é€šè¿‡ JavaScript æ›´æ”¹æŸäº›å…ƒç´ çš„èƒŒæ™¯é¢œè‰²ï¼Œé‚£ä¹ˆå¸ƒå±€é˜¶æ®µå°†ä¸ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºå¹¶æ²¡æœ‰å¼•èµ·å‡ ä½•ä½ç½®çš„å˜æ¢ï¼Œç›¸è¾ƒäºé‡æ’æ“ä½œï¼Œé‡ç»˜çœå»äº†å¸ƒå±€å’Œåˆ†å±‚é˜¶æ®µï¼Œæ‰€ä»¥æ‰§è¡Œæ•ˆç‡ä¼šæ¯”é‡æ’æ“ä½œè¦é«˜ä¸€äº›</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63a55f0c8d684574bc392111d7557fba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=BckUddZSZaDVWQTqFXmNdm0TVx0%3D" alt="07.webp" loading="lazy"/></p>
<p>å¸¸è§çš„å¼•èµ·é‡ç»˜çš„æ–¹å¼</p>
<ul>
<li>æ”¹å˜é¢œè‰² (<code>color</code>, <code>background-color</code>)</li>
<li>æ”¹å˜å¯è§æ€§ (<code>visibility</code>)</li>
<li>æ”¹å˜è¾¹æ¡†æ ·å¼ï¼ˆå¦‚ <code>border-style</code>ï¼Œä½†ä¸æ”¹å˜ <code>border-width</code>ï¼‰</li>
<li>æ–‡æœ¬é˜´å½± (<code>text-shadow</code>)</li>
</ul>
<h3 data-id="heading-13">5.2 æ€§èƒ½ä¼˜åŒ–</h3>
<p>åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šåŠ è½½é˜¶æ®µå’Œäº¤äº’é˜¶æ®µã€å…³é—­é˜¶æ®µ</p>
<p>åŠ è½½é˜¶æ®µ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a37ce90290d14e759713f9fff67b306d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=eMyrRIPUjUB6eadhW65nE9t5NNY%3D" alt="08_0.webp" loading="lazy"/></p>
<p>é™ä½å…³é”®èµ„æºä¸ªæ•°</p>
<p>é™ä½å…³é”®èµ„æºå¤§å°ï¼šå‹ç¼©ä»£ç ã€å»é™¤ä»£ç æ³¨é‡Šç­‰</p>
<p>é™ä½å…³é”®èµ„æºéœ€è¦å¤šå°‘ä¸ª RTTï¼šä½¿ç”¨ CDNã€ç¼“å­˜</p>
<p>äº¤äº’é˜¶æ®µ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e00dd0f0821414699126710e66c491b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6KaB5oOz5aSq5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765064870&amp;x-signature=VTKgv5i3XzDGjCNwI5LMG%2B90wfE%3D" alt="09.webp" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vibe Coding ä½“éªŒæŠ¥å‘Šï¼šæˆ‘è®© TRAE SOLO æ›¿æˆ‘é‡æ„äº† 2000 è¡Œå±å±±ä»£ç ï¼Œç»“æœ...]]></title>    <link>https://juejin.cn/post/7577737385954607114</link>    <guid>https://juejin.cn/post/7577737385954607114</guid>    <pubDate>2025-11-30T04:57:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577737385954607114" data-draft-id="7577689171223380018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vibe Coding ä½“éªŒæŠ¥å‘Šï¼šæˆ‘è®© TRAE SOLO æ›¿æˆ‘é‡æ„äº† 2000 è¡Œå±å±±ä»£ç ï¼Œç»“æœ..."/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-30T04:57:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç§æ•™"/> <meta itemprop="url" content="https://juejin.cn/user/3394924618197325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vibe Coding ä½“éªŒæŠ¥å‘Šï¼šæˆ‘è®© TRAE SOLO æ›¿æˆ‘é‡æ„äº† 2000 è¡Œå±å±±ä»£ç ï¼Œç»“æœ...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394924618197325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç§æ•™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T04:57:15.000Z" title="Sun Nov 30 2025 04:57:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>å‰è¨€</strong>ï¼šæ¯ä¸ªç¨‹åºå‘˜çš„ç¡¬ç›˜é‡Œï¼Œå¤§æ¦‚éƒ½èººç€ä¸€æ®µä¸æ•¢ç»™äººçœ‹çš„â€œå±å±±â€ä»£ç ã€‚
ä¸Šå‘¨ï¼Œæˆ‘ç¿»å‡ºäº†ä¸‰å¹´å‰å†™çš„ä¸€ä¸ª Python æ•°æ®æ¸…æ´—è„šæœ¬ã€‚é‚£æ—¶çš„æˆ‘è¿˜åœ¨ç”¨ <code>if-else</code> å †ç Œé€»è¾‘ï¼Œå˜é‡åå…¨æ˜¯ <code>a</code>, <code>b</code>, <code>temp</code>ï¼Œæ²¡æœ‰ç±»å‹æ ‡æ³¨ï¼Œæ›´åˆ«æå•å…ƒæµ‹è¯•ã€‚
å€Ÿç€ TRAE SOLO å‘å¸ƒçš„å¥‘æœºï¼Œæˆ‘å†³å®šåšä¸€ä¸ªå¤§èƒ†çš„å®éªŒï¼š<strong>å®Œå…¨ä¸å†™ä¸€è¡Œä»£ç ï¼Œåªç”¨è‡ªç„¶è¯­è¨€ï¼ˆVibe Codingï¼‰ï¼Œè®© AI å¸®æˆ‘æŠŠè¿™å¨ 2000 è¡Œçš„â€œç¥–ä¼ ä»£ç â€é‡æ„æˆç¬¦åˆ SOLID åŸåˆ™çš„ç°ä»£å·¥ç¨‹ã€‚</strong>
ç»“æœæœ‰ç‚¹å‡ºä¹æ„æ–™ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ç¥–ä¼ ä»£ç çš„â€œå‘³é“â€</h2>
<p>é‚£ä¸ªè„šæœ¬çš„ä»»åŠ¡å¾ˆç®€å•ï¼šä» 10 ä¸ªä¸åŒçš„ CSV æ–‡ä»¶é‡Œè¯»å–é”€å”®æ•°æ®ï¼Œæ¸…æ´—è„æ•°æ®ï¼Œç„¶åç”Ÿæˆä¸€å¼ æŠ¥è¡¨ã€‚</p>
<p>ä½†å®ƒçš„å®ç°æ–¹å¼ç®€ç›´æ˜¯ç¾éš¾ï¼š</p>
<ul>
<li><strong>é¢å‘è¿‡ç¨‹</strong>ï¼šæ‰€æœ‰çš„é€»è¾‘éƒ½å†™åœ¨ä¸€ä¸ª 2000 è¡Œçš„ <code>main.py</code> é‡Œã€‚</li>
<li><strong>ç¡¬ç¼–ç </strong>ï¼šæ–‡ä»¶è·¯å¾„ã€åˆ—åã€é˜ˆå€¼å…¨å†™æ­»åœ¨ä»£ç é‡Œã€‚</li>
<li><strong>å¼‚å¸¸åå™¬</strong>ï¼šåˆ°å¤„éƒ½æ˜¯ <code>try: ... except: pass</code>ï¼Œä¸€æ—¦æŠ¥é”™æ ¹æœ¬æ‰¾ä¸åˆ°åŸå› ã€‚</li>
</ul>
<p>æ¯å½“ä¸šåŠ¡æ–¹è¦æ±‚â€œåŠ ä¸ªæ–°å­—æ®µâ€æˆ–è€…â€œæ”¹ä¸ªè®¡ç®—é€»è¾‘â€ï¼Œæˆ‘å°±å¾—æˆ´ç€ç—›è‹¦é¢å…·åœ¨ä»£ç å †é‡Œç¿»æ‰¾åŠå¤©ã€‚</p>
<h2 data-id="heading-1">Vibe Codingï¼šåƒäº§å“ç»ç†ä¸€æ ·å†™ä»£ç </h2>
<p>ä»¥å‰æˆ‘ä»¬é‡æ„ä»£ç ï¼Œæ˜¯ç›¯ç€å±å¹•ä¸€è¡Œè¡Œæ”¹ã€‚è€Œåœ¨ TRAE SOLO é‡Œï¼Œæˆ‘åªéœ€è¦<strong>æŠŠéœ€æ±‚æè¿°æ¸…æ¥š</strong>ã€‚</p>
<p>æˆ‘æ‰“å¼€ TRAE SOLO çš„å¯¹è¯æ¡†ï¼Œè¾“å…¥äº†è¿™æ ·ä¸€æ®µ Promptï¼š</p>
<blockquote>
<p>â€œè¯»å–å½“å‰é¡¹ç›®ä¸­çš„ <code>legacy_script.py</code>ã€‚è¿™æ˜¯ä¸€ä¸ªè€æ—§çš„æ•°æ®å¤„ç†è„šæœ¬ã€‚è¯·å¸®æˆ‘å°†å…¶é‡æ„ä¸ºé¢å‘å¯¹è±¡çš„æ¶æ„ã€‚è¦æ±‚ï¼š</p>
<ol>
<li>ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰æ¥å¤„ç†ä¸åŒæ¥æºçš„æ•°æ®æ¸…æ´—è§„åˆ™ã€‚</li>
<li>å¼•å…¥ Pydantic è¿›è¡Œæ•°æ®æ ¡éªŒã€‚</li>
<li>å°†é…ç½®é¡¹æå–åˆ° YAML æ–‡ä»¶ä¸­ã€‚</li>
<li>ä¿æŒé€»è¾‘ä¸å˜ï¼Œä½†ä»£ç å¿…é¡»ä¼˜é›…ã€‚â€</li>
</ol>
</blockquote>
<p>æ¥ä¸‹æ¥å‘ç”Ÿçš„äº‹æƒ…ï¼Œè®©æˆ‘è¿™ä¸ªè€å…µéƒ½æœ‰ç‚¹åä¸ä½äº†ã€‚</p>
<p>TRAE SOLO å¹¶æ²¡æœ‰ç›´æ¥ç»™æˆ‘ç”©ä¸€æ®µä»£ç ï¼Œè€Œæ˜¯<strong>å…ˆç”Ÿæˆäº†ä¸€ä¸ªæ–‡ä»¶æ ‘ç»“æ„</strong>ï¼Œé—®æˆ‘ï¼šâ€œè¿™æ ·çš„ç›®å½•ç»“æ„ä½ è§‰å¾—å¦‚ä½•ï¼Ÿâ€</p>
<pre><code class="hljs language-text" lang="text">project/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.yaml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ models/      # Pydantic æ¨¡å‹
â”‚   â”œâ”€â”€ strategies/  # æ¸…æ´—ç­–ç•¥
â”‚   â”œâ”€â”€ loader.py    # æ•°æ®åŠ è½½
â”‚   â””â”€â”€ main.py
â””â”€â”€ tests/
</code></pre>
<p>å¾—åˆ°æˆ‘çš„ç¡®è®¤åï¼Œå®ƒå¼€å§‹ç–¯ç‹‚è¾“å‡ºã€‚</p>
<h2 data-id="heading-2">é‡æ„å®æˆ˜ï¼šä»â€œé¢æ¡ä»£ç â€åˆ°â€œè®¾è®¡æ¨¡å¼â€</h2>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å®ƒé‡æ„å‰åçš„æ ¸å¿ƒé€»è¾‘å¯¹æ¯”ã€‚</p>
<h3 data-id="heading-3">åŸå§‹ä»£ç ï¼ˆè¾£çœ¼ç›ç‰ˆï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å…¸å‹çš„é¢æ¡ä»£ç </span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>(<span class="hljs-params">file_path</span>):
    data = []
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:
            cols = line.split(<span class="hljs-string">','</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(cols) &lt; <span class="hljs-number">5</span>: <span class="hljs-keyword">continue</span> <span class="hljs-comment"># è¿™é‡Œçš„ 5 æ˜¯å•¥æ„æ€ï¼Ÿ</span>
            <span class="hljs-keyword">if</span> cols[<span class="hljs-number">2</span>] == <span class="hljs-string">'US'</span>:
                <span class="hljs-comment"># ä¸€å †å¤æ‚çš„ if-else</span>
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">float</span>(cols[<span class="hljs-number">3</span>]) &gt; <span class="hljs-number">1000</span>:
                    data.append(cols)
            <span class="hljs-keyword">elif</span> cols[<span class="hljs-number">2</span>] == <span class="hljs-string">'CN'</span>:
                <span class="hljs-comment"># å¦ä¸€å †é€»è¾‘...</span>
    <span class="hljs-keyword">return</span> data
</code></pre>
<h3 data-id="heading-4">é‡æ„åçš„ä»£ç ï¼ˆèµå¿ƒæ‚¦ç›®ç‰ˆï¼‰</h3>
<p>TRAE SOLO è‡ªåŠ¨è¯†åˆ«å‡ºäº†ä¸åŒå›½å®¶çš„å¤„ç†é€»è¾‘å·®å¼‚ï¼Œå¹¶å°†å…¶å°è£…ä¸ºç­–ç•¥ç±»ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABC, abstractmethod
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>

<span class="hljs-comment"># 1. å®šä¹‰æ•°æ®æ¨¡å‹ï¼Œå¼ºç±»å‹çº¦æŸ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SalesRecord</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    region: <span class="hljs-built_in">str</span>
    amount: <span class="hljs-built_in">float</span> = Field(gt=<span class="hljs-number">0</span>)
    currency: <span class="hljs-built_in">str</span>

<span class="hljs-comment"># 2. å®šä¹‰æŠ½è±¡ç­–ç•¥</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CleaningStrategy</span>(<span class="hljs-title class_ inherited__">ABC</span>):
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">clean</span>(<span class="hljs-params">self, record: SalesRecord</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># 3. å…·ä½“ç­–ç•¥å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">USRegionStrategy</span>(<span class="hljs-title class_ inherited__">CleaningStrategy</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">clean</span>(<span class="hljs-params">self, record: SalesRecord</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-comment"># ä¸šåŠ¡é€»è¾‘æ¸…æ™°å¯è§</span>
        <span class="hljs-keyword">return</span> record.amount &gt; <span class="hljs-number">1000</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CNRegionStrategy</span>(<span class="hljs-title class_ inherited__">CleaningStrategy</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">clean</span>(<span class="hljs-params">self, record: SalesRecord</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span> <span class="hljs-comment"># CN åœ°åŒºæš‚æ— ç‰¹æ®Šè¿‡æ»¤</span>

<span class="hljs-comment"># 4. ä¸Šä¸‹æ–‡è°ƒç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataProcessor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, strategy: CleaningStrategy</span>):
        self.strategy = strategy

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">self, records: <span class="hljs-type">List</span>[SalesRecord]</span>):
        <span class="hljs-keyword">return</span> [r <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> records <span class="hljs-keyword">if</span> self.strategy.clean(r)]
</code></pre>
<p>ä¸ä»…ä»…æ˜¯ä»£ç å˜å¥½çœ‹äº†ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œ<strong>æ‰©å±•æ€§</strong>æœ‰äº†è´¨çš„é£è·ƒã€‚ä»¥åå†åŠ ä¸€ä¸ªâ€œJP åœ°åŒºâ€ï¼Œæˆ‘åªéœ€è¦æ–°å»ºä¸€ä¸ª <code>JPRegionStrategy</code> ç±»ï¼Œå®Œå…¨ä¸ç”¨åŠ¨æ ¸å¿ƒé€»è¾‘ã€‚</p>
<p>è¿™ä¸€åˆ‡ï¼Œæˆ‘è¿ä¸€è¡Œä»£ç éƒ½æ²¡æ•²ï¼Œå…¨æ˜¯ TRAE SOLO ç”Ÿæˆçš„ã€‚</p>
<h2 data-id="heading-5">é¿å‘ä¸åæ€ï¼šAI çœŸçš„èƒ½å®Œå…¨æ›¿ä»£äººå—ï¼Ÿ</h2>
<p>çˆ½å½’çˆ½ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä¹Ÿå‘ç°äº†å‡ ä¸ªå¿…é¡»äººå·¥å¹²é¢„çš„å‘ï¼š</p>
<h3 data-id="heading-6">1. ä¸šåŠ¡é€»è¾‘çš„â€œç»†å¾®ä¸¢å¤±â€</h3>
<p>åœ¨åŸå§‹ä»£ç é‡Œï¼Œæœ‰ä¸€è¡Œä¸èµ·çœ¼çš„æ³¨é‡Šï¼š<code># 2021å¹´ä»¥å‰çš„æ•°æ®ä¸å¤„ç†</code>ã€‚
TRAE SOLO åœ¨é‡æ„æ—¶ï¼Œå› ä¸ºè¿™è¡Œé€»è¾‘å†™å¾—å¤ªéšæ™¦ï¼ˆè—åœ¨ä¸€ä¸ªå¤æ‚çš„ <code>if</code> é‡Œï¼‰ï¼Œç›´æ¥ç»™æ¼æ‰äº†ã€‚
<strong>æ•™è®­</strong>ï¼šVibe Coding ä¸ä»£è¡¨ä½ å¯ä»¥å½“ç”©æ‰‹æŒæŸœã€‚<strong>Review ä»£ç </strong>ä¾ç„¶æ˜¯æ ¸å¿ƒå·¥ä½œï¼Œå°¤å…¶æ˜¯è¾¹ç•Œæ¡ä»¶ã€‚</p>
<h3 data-id="heading-7">2. è¿‡åº¦è®¾è®¡çš„å€¾å‘</h3>
<p>ä¸€å¼€å§‹ï¼ŒTRAE SOLO ç»™æ¯ä¸ªç­–ç•¥ç±»éƒ½æäº†ä¸ªå·¥å‚æ¨¡å¼ï¼Œè¿˜å¼•å…¥äº†ä¾èµ–æ³¨å…¥å®¹å™¨ã€‚å¯¹äºä¸€ä¸ªåªæœ‰ 2000 è¡Œçš„å°é¡¹ç›®ï¼Œè¿™æœ‰ç‚¹æ€é¸¡ç”¨ç‰›åˆ€ã€‚
æˆ‘ä¸å¾—ä¸å‘Šè¯‰å®ƒï¼šâ€œKeep it simpleï¼Œå»æ‰ DI å®¹å™¨ï¼Œç›´æ¥ç”¨ç®€å•çš„å·¥å‚å‡½æ•°ã€‚â€</p>
<h3 data-id="heading-8">3. æµ‹è¯•è¦†ç›–ç‡çš„å‡è±¡</h3>
<p>å®ƒç”Ÿæˆäº†å•å…ƒæµ‹è¯•ï¼Œè·‘é€šä¹Ÿæ˜¯å…¨ç»¿ã€‚ä½†æˆ‘ä»”ç»†ä¸€çœ‹ï¼Œå®ƒåªæµ‹äº†â€œæ­£å¸¸è·¯å¾„â€ï¼Œå¯¹äºè„æ•°æ®ã€ç©ºæ–‡ä»¶ç­‰å¼‚å¸¸æƒ…å†µå®Œå…¨æ²¡è¦†ç›–ã€‚
<strong>æ•™è®­</strong>ï¼šAI æ“…é•¿å†™ Happy Pathï¼Œ<strong>Dirty Path</strong> è¿˜æ˜¯å¾—é ç»éªŒä¸°å¯Œçš„è€é¸Ÿå»è¡¥å…¨ã€‚</p>
<h2 data-id="heading-9">ç»“è¯­</h2>
<p>è¿™æ¬¡é‡æ„ä½“éªŒï¼Œè®©æˆ‘å¯¹â€œAI è¾…åŠ©ç¼–ç¨‹â€æœ‰äº†æ–°çš„è®¤çŸ¥ã€‚</p>
<p>Vibe Coding ä¸æ˜¯è®©ä½ æŠŠå¤§è„‘ä¸¢æ‰ï¼Œè€Œæ˜¯è®©ä½ ä»<strong>æ‰“å­—å‘˜</strong>å‡çº§ä¸º<strong>æŠ€æœ¯æ€»ç›‘</strong>ã€‚ä½ ä¸å†éœ€è¦å…³å¿ƒ <code>import</code> å“ªä¸ªåŒ…ï¼Œ<code>for</code> å¾ªç¯æ€ä¹ˆå†™ï¼Œè€Œæ˜¯æŠŠç²¾åŠ›é›†ä¸­åœ¨<strong>æ¥å£è®¾è®¡ã€æ¨¡å—åˆ’åˆ†å’Œä¸šåŠ¡è¾¹ç•Œ</strong>ä¸Šã€‚</p>
<p>é‚£ä¸ª 2000 è¡Œçš„è„šæœ¬ï¼Œæœ€ç»ˆè¢«é‡æ„æˆäº† 600 è¡Œæ¸…æ™°ã€æ¨¡å—åŒ–çš„ Python ä»£ç ã€‚</p>
<p><strong>TRAE SOLO æ²¡èƒ½æ›¿æˆ‘é‡æ„æ•´ä¸ªä¸–ç•Œï¼Œä½†å®ƒç¡®å®å¸®æˆ‘æŠŠé‚£åº§â€œå±å±±â€ï¼Œå˜æˆäº†ä¸€åº§ç²¾è‡´çš„èŠ±å›­ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TSå’ŒJSæˆå‘˜å˜é‡ä¿®é¥°ç¬¦]]></title>    <link>https://juejin.cn/post/7577675494068158490</link>    <guid>https://juejin.cn/post/7577675494068158490</guid>    <pubDate>2025-11-30T01:28:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577675494068158490" data-draft-id="7577693903018672154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TSå’ŒJSæˆå‘˜å˜é‡ä¿®é¥°ç¬¦"/> <meta itemprop="keywords" content="TypeScript,JavaScript"/> <meta itemprop="datePublished" content="2025-11-30T01:28:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Robet"/> <meta itemprop="url" content="https://juejin.cn/user/193141028175320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TSå’ŒJSæˆå‘˜å˜é‡ä¿®é¥°ç¬¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/193141028175320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Robet
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T01:28:48.000Z" title="Sun Nov 30 2025 01:28:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ TypeScript å’Œ JavaScript ä¸­ï¼Œ<strong>ç±»æˆå‘˜å˜é‡ï¼ˆå±æ€§ï¼‰çš„ä¿®é¥°ç¬¦ï¼ˆModifiersï¼‰</strong> ç”¨äºæ§åˆ¶å…¶<strong>å¯è§æ€§ã€å¯è®¿é—®æ€§å’Œå¯å˜æ€§</strong>ã€‚ä¸¤è€…åœ¨èƒ½åŠ›ä¸Šæœ‰æ˜¾è‘—å·®å¼‚ï¼š<strong>TypeScript æä¾›äº†æ›´ä¸°å¯Œçš„ç¼–è¯‘æ—¶ä¿®é¥°ç¬¦</strong>ï¼Œè€Œ <strong>JavaScriptï¼ˆES2022 èµ·ï¼‰å¼•å…¥äº†è¿è¡Œæ—¶ç§æœ‰å­—æ®µ</strong>ã€‚</p>
<p>ä¸‹é¢ä» <strong>TypeScript</strong> å’Œ <strong>JavaScript</strong> ä¸¤ä¸ªè§’åº¦åˆ†åˆ«è¯´æ˜ï¼Œå¹¶å¯¹æ¯”å¼‚åŒã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€TypeScript ç±»æˆå‘˜å˜é‡ä¿®é¥°ç¬¦ï¼ˆç¼–è¯‘æ—¶ï¼‰</h2>
<p>TypeScript åœ¨ <strong>ç¼–è¯‘é˜¶æ®µ</strong> æä¾›ä»¥ä¸‹å…³é”®å­—ä½œä¸ºè®¿é—®ä¿®é¥°ç¬¦ï¼š</p>



































<table><thead><tr><th>ä¿®é¥°ç¬¦</th><th>å«ä¹‰</th><th>æ˜¯å¦ç”Ÿæˆ JS ä»£ç </th><th>å¯è§æ€§</th></tr></thead><tbody><tr><td><code>public</code></td><td>å…¬å…±ï¼ˆé»˜è®¤ï¼‰</td><td>âŒ ä¸ç”Ÿæˆé¢å¤–ä»£ç </td><td>ç±»å†…ã€å­ç±»ã€å¤–éƒ¨å‡å¯è®¿é—®</td></tr><tr><td><code>private</code></td><td>ç§æœ‰</td><td>âŒ ä»…ç±»å‹æ£€æŸ¥ï¼Œ<strong>ä¸é˜»æ­¢è¿è¡Œæ—¶è®¿é—®</strong></td><td>ä»…ç±»å†…éƒ¨å¯è®¿é—®ï¼ˆTS ç¼–è¯‘æ—¶æŠ¥é”™ï¼‰</td></tr><tr><td><code>protected</code></td><td>å—ä¿æŠ¤</td><td>âŒ ä»…ç±»å‹æ£€æŸ¥</td><td>ç±»å†…éƒ¨ + å­ç±»å¯è®¿é—®</td></tr><tr><td><code>readonly</code></td><td>åªè¯»</td><td>âŒ ä»…ç±»å‹æ£€æŸ¥</td><td>åˆå§‹åŒ–åä¸å¯ä¿®æ”¹ï¼ˆTS æŠ¥é”™ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-1">âœ… ç¤ºä¾‹ï¼ˆTypeScriptï¼‰ï¼š</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;        <span class="hljs-comment">// é»˜è®¤å°±æ˜¯ public</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;         <span class="hljs-comment">// TS ç¦æ­¢å¤–éƒ¨è®¿é—®</span>
  <span class="hljs-keyword">protected</span> <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;    <span class="hljs-comment">// å­ç±»å¯è®¿é—®</span>
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>;   <span class="hljs-comment">// åˆå§‹åŒ–åä¸å¯æ”¹</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, id: <span class="hljs-built_in">number</span>, email: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span> = email;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">createdAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
  }
}
</code></pre>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼š<br/>
<code>private</code> / <code>protected</code> <strong>åªåœ¨ TypeScript ç¼–è¯‘æ—¶ç”Ÿæ•ˆ</strong>ï¼Œç¼–è¯‘æˆ JS åï¼Œè¿™äº›å­—æ®µä»æ˜¯æ™®é€šå±æ€§ï¼Œ<strong>è¿è¡Œæ—¶ä»å¯è¢«è®¿é—®æˆ–ä¿®æ”¹</strong>ï¼</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini">// ç¼–è¯‘åçš„ JSï¼ˆæ—  private ä¿æŠ¤ï¼ï¼‰
const <span class="hljs-attr">user</span> = new User(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">1</span>, <span class="hljs-string">"a@example.com"</span>)<span class="hljs-comment">;</span>
console.log(user.id)<span class="hljs-comment">; // âœ… èƒ½è®¿é—®ï¼JS ä¸æŠ¥é”™</span>
<span class="hljs-attr">user.id</span> = <span class="hljs-number">999</span><span class="hljs-comment">;        // âœ… èƒ½ä¿®æ”¹ï¼</span>
</code></pre>
<hr/>
<h2 data-id="heading-2">äºŒã€JavaScript ç±»æˆå‘˜å˜é‡ä¿®é¥°ç¬¦ï¼ˆè¿è¡Œæ—¶ï¼ŒES2022+ï¼‰</h2>
<p>ä» <strong>ECMAScript 2022ï¼ˆES13ï¼‰</strong> å¼€å§‹ï¼ŒJavaScript åŸç”Ÿæ”¯æŒ <strong>çœŸæ­£çš„ç§æœ‰å­—æ®µï¼ˆPrivate Fieldsï¼‰</strong> ï¼Œä½¿ç”¨ <code>#</code> å‰ç¼€ã€‚</p>























<table><thead><tr><th>è¯­æ³•</th><th>å«ä¹‰</th><th>è¿è¡Œæ—¶æ˜¯å¦ç§æœ‰</th><th>æ˜¯å¦å¯è¢«å¤–éƒ¨è®¿é—®</th></tr></thead><tbody><tr><td><code>#fieldName</code></td><td>ç§æœ‰å­—æ®µ</td><td>âœ… æ˜¯</td><td>âŒ å®Œå…¨æ— æ³•ä»ç±»å¤–è®¿é—®</td></tr><tr><td>æ™®é€šå­—æ®µï¼ˆæ— å‰ç¼€ï¼‰</td><td>å…¬å…±å­—æ®µ</td><td>âŒ å¦</td><td>âœ… å¯è‡ªç”±è®¿é—®</td></tr></tbody></table>
<h3 data-id="heading-3">âœ… ç¤ºä¾‹ï¼ˆJavaScript / TypeScript å‡æ”¯æŒï¼‰ï¼š</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-meta">#id;                    <span class="hljs-comment">// ç§æœ‰å­—æ®µï¼ˆJS åŸç”Ÿç§æœ‰ï¼‰</span></span>
  name;                   <span class="hljs-comment">// å…¬å…±å­—æ®µ</span>

  <span class="hljs-built_in">constructor</span>(name, id) {
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.<span class="hljs-meta">#id = id;        <span class="hljs-comment">// åªèƒ½åœ¨ç±»å†…éƒ¨è®¿é—®</span></span>
  }

  <span class="hljs-built_in">getId</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.<span class="hljs-meta">#id;      <span class="hljs-comment">// âœ… OK</span></span>
  }
}

<span class="hljs-type">const</span> user = <span class="hljs-keyword">new</span> <span class="hljs-built_in">User</span>(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">2</span>);
console.<span class="hljs-built_in">log</span>(user.name);   <span class="hljs-comment">// âœ… "Bob"</span>
console.<span class="hljs-built_in">log</span>(user.<span class="hljs-meta">#id);    <span class="hljs-comment">// âŒ SyntaxError! æ— æ³•è®¿é—®</span></span>
</code></pre>
<blockquote>
<p>âœ… <strong>å…³é”®ä¼˜åŠ¿</strong>ï¼š<br/>
<code>#id</code> æ˜¯<strong>çœŸæ­£çš„ç§æœ‰</strong>ï¼Œå³ä½¿åœ¨è¿è¡Œæ—¶ä¹Ÿæ— æ³•ç»•è¿‡ï¼ˆé™¤éç”¨ Proxy ç­‰ hackï¼Œä½†æ­£å¸¸ä»£ç åšä¸åˆ°ï¼‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€TypeScript å¯¹ JS ç§æœ‰å­—æ®µçš„æ”¯æŒ</h2>
<p>TypeScript <strong>å®Œå…¨æ”¯æŒ <code>#</code> ç§æœ‰å­—æ®µ</strong>ï¼Œå¹¶æä¾›ç±»å‹æ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
  #<span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, id: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.#id = id;
  }

  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#id; <span class="hljs-comment">// âœ… TS çŸ¥é“è¿™æ˜¯ number</span>
  }
}
</code></pre>
<blockquote>
<p>ğŸ”¸ æ­¤æ—¶ä½ <strong>ä¸éœ€è¦</strong>ç”¨ <code>private</code>ï¼Œå› ä¸º <code>#id</code> å·²ç»æ˜¯è¿è¡Œæ—¶ç§æœ‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">å››ã€å¯¹æ¯”æ€»ç»“</h2>



































<table><thead><tr><th>ç‰¹æ€§</th><th>TypeScript <code>private</code></th><th>JavaScript <code>#field</code></th></tr></thead><tbody><tr><td><strong>ä½œç”¨æ—¶æœº</strong></td><td>ç¼–è¯‘æ—¶ï¼ˆç±»å‹æ£€æŸ¥ï¼‰</td><td>è¿è¡Œæ—¶ï¼ˆçœŸå®ç§æœ‰ï¼‰</td></tr><tr><td><strong>èƒ½å¦è¢«å¤–éƒ¨è®¿é—®</strong></td><td>âœ… èƒ½ï¼ˆJS æ— ä¿æŠ¤ï¼‰</td><td>âŒ ä¸èƒ½</td></tr><tr><td><strong>æ˜¯å¦ç”Ÿæˆé¢å¤–ä»£ç </strong></td><td>âŒ å¦</td><td>âœ… æ˜¯ï¼ˆä¿ç•™ <code>#</code> è¯­æ³•ï¼‰</td></tr><tr><td><strong>å…¼å®¹æ€§</strong></td><td>æ‰€æœ‰ JS ç¯å¢ƒï¼ˆå› è¢«æ“¦é™¤ï¼‰</td><td>éœ€è¦ ES2022+ æˆ– Babel è½¬è¯‘</td></tr><tr><td><strong>æ¨èåœºæ™¯</strong></td><td>å¿«é€Ÿå¼€å‘ã€å†…éƒ¨é¡¹ç›®</td><td>éœ€è¦çœŸæ­£å°è£…ã€åº“å¼€å‘</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">äº”ã€æœ€ä½³å®è·µå»ºè®®</h2>
<h3 data-id="heading-7">âœ… ä¼˜å…ˆä½¿ç”¨ <strong>JavaScript åŸç”Ÿç§æœ‰å­—æ®µ <code>#</code></strong></h3>
<ul>
<li>å¦‚æœç›®æ ‡ç¯å¢ƒæ”¯æŒï¼ˆç°ä»£æµè§ˆå™¨ / Node.js 12+ï¼‰ï¼Œ<strong>ä¼˜å…ˆç”¨ <code>#fieldName</code></strong>ã€‚</li>
<li>å®ƒæä¾›<strong>çœŸæ­£çš„å°è£…</strong>ï¼Œé¿å…â€œå‡è£…ç§æœ‰â€çš„é™·é˜±ã€‚</li>
</ul>
<h3 data-id="heading-8">âœ… åœ¨ TypeScript ä¸­ï¼š</h3>
<ul>
<li>è‹¥éœ€å…¼å®¹æ—§ç¯å¢ƒ â†’ ç”¨ <code>private</code>ï¼ˆä½†è¦æ¸…æ¥šå®ƒåªæ˜¯â€œçº¸é¢ç§æœ‰â€ï¼‰ã€‚</li>
<li>è‹¥ç”¨ç°ä»£ç¯å¢ƒ â†’ <strong>ç›´æ¥ç”¨ <code>#</code></strong> ï¼Œæ— éœ€ <code>private</code>ã€‚</li>
</ul>
<h3 data-id="heading-9">âœ… ä¸è¦æ··ç”¨ï¼š</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šè¯­ä¹‰é‡å¤ä¸”æ··ä¹±</span>
<span class="hljs-keyword">private</span> <span class="hljs-meta">#id; <span class="hljs-comment">// é”™è¯¯ï¼ä¸èƒ½åŒæ—¶ç”¨</span></span>
</code></pre>
<h3 data-id="heading-10">âœ… <code>readonly</code> ä»æ˜¯ TS ç‰¹æœ‰ï¼ˆJS æ— ç­‰ä»·ç‰©ï¼‰</h3>
<ul>
<li>
<p>å¯é…åˆ <code>#</code> ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> {
  <span class="hljs-keyword">readonly</span> #<span class="hljs-attr">apiUrl</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.#apiUrl = url; <span class="hljs-comment">// åˆå§‹åŒ–åä¸å¯å˜ï¼ˆTS æ£€æŸ¥ï¼‰</span>
  }
}
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-11">å…­ã€è¡¥å……ï¼šå…¶ä»–ç›¸å…³ä¿®é¥°ç¬¦</h2>

























<table><thead><tr><th>ä¿®é¥°ç¬¦</th><th>è¯­è¨€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>static</code></td><td>TS &amp; JS</td><td>é™æ€æˆå‘˜ï¼ˆå±äºç±»ï¼Œä¸å±äºå®ä¾‹ï¼‰</td></tr><tr><td><code>abstract</code></td><td>TS only</td><td>æŠ½è±¡ç±»/æ–¹æ³•ï¼ˆä¸èƒ½å®ä¾‹åŒ–ï¼‰</td></tr><tr><td><code>declare</code></td><td>TS only</td><td>å£°æ˜å±æ€§å­˜åœ¨ï¼ˆç”¨äº .d.ts æˆ–è£…é¥°å™¨ï¼‰</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">âœ… æ€»ç»“</h2>

























<table><thead><tr><th>éœ€æ±‚</th><th>æ¨èæ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>çœŸæ­£çš„ç§æœ‰å­—æ®µ</strong></td><td>ä½¿ç”¨ JavaScript <code>#fieldName</code>ï¼ˆES2022+ï¼‰</td></tr><tr><td><strong>ä»…å¼€å‘æ—¶æé†’ï¼ˆå…¼å®¹æ—§ç¯å¢ƒï¼‰</strong></td><td>ä½¿ç”¨ TypeScript <code>private</code></td></tr><tr><td><strong>åªè¯»å±æ€§</strong></td><td>TypeScript <code>readonly</code>ï¼ˆJS æ— åŸç”Ÿæ”¯æŒï¼‰</td></tr><tr><td><strong>å…¬å…±å­—æ®µ</strong></td><td>ç›´æ¥å£°æ˜ï¼ˆTS/JS å‡é»˜è®¤ publicï¼‰</td></tr></tbody></table>
<blockquote>
<p>ğŸ¯ <strong>ç°ä»£é¡¹ç›®å»ºè®®</strong>ï¼š<br/>
<strong>ç”¨ <code>#</code> å®ç°ç§æœ‰ï¼Œç”¨ <code>readonly</code> å®ç°åªè¯»ï¼Œæ”¾å¼ƒ <code>private</code>ï¼ˆé™¤éå¿…é¡»å…¼å®¹æ—§ JSï¼‰</strong> ã€‚</p>
</blockquote>
<p>è¿™æ ·æ—¢èƒ½è·å¾—ç±»å‹å®‰å…¨ï¼Œåˆèƒ½ä¿è¯è¿è¡Œæ—¶å°è£…æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«è®© API Key è£¸å¥”ï¼šåŸºäº TRAE SOLO çš„å¤§æ¨¡å‹å®‰å…¨é…ç½®æœ€ä½³å®è·µ]]></title>    <link>https://juejin.cn/post/7577681092138647587</link>    <guid>https://juejin.cn/post/7577681092138647587</guid>    <pubDate>2025-11-30T05:01:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577681092138647587" data-draft-id="7577681092138631203" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«è®© API Key è£¸å¥”ï¼šåŸºäº TRAE SOLO çš„å¤§æ¨¡å‹å®‰å…¨é…ç½®æœ€ä½³å®è·µ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-30T05:01:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç§æ•™"/> <meta itemprop="url" content="https://juejin.cn/user/3394924618197325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«è®© API Key è£¸å¥”ï¼šåŸºäº TRAE SOLO çš„å¤§æ¨¡å‹å®‰å…¨é…ç½®æœ€ä½³å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394924618197325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç§æ•™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T05:01:52.000Z" title="Sun Nov 30 2025 05:01:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>å‰è¨€</strong>ï¼šå‰å‡ å¤©ï¼Œæˆ‘çš„ä¸€ä½åˆ›ä¸šæœ‹å‹åŠå¤œç»™æˆ‘æ‰“ç”µè¯ï¼Œå£°éŸ³éƒ½åœ¨æŠ–ã€‚å› ä¸ºå¼€å‘å®ä¹ ç”Ÿä¸å°å¿ƒæŠŠå¸¦æœ‰ <code>sk-</code> å¼€å¤´çš„ OpenAI Key æäº¤åˆ°äº† GitHub å…¬å¼€ä»“åº“ã€‚çŸ­çŸ­ 15 åˆ†é’Ÿï¼Œä¿¡ç”¨å¡è¢«åˆ·çˆ†äº† 2000 ç¾å…ƒã€‚
è¿™ç§â€œæƒ¨æ¡ˆâ€åœ¨ AI å¼€å‘åœˆå­é‡Œç®€ç›´å¤ªå¸¸è§äº†ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åªé¡¾ç€è®©æ¨¡å‹è·‘èµ·æ¥ï¼Œå´å¿˜äº†ç»™å®ƒç©¿ä¸Šâ€œé˜²å¼¹è¡£â€ã€‚
ä»Šå¤©ä¸è°ˆå¤æ‚çš„ DevSecOpsï¼ŒåªèŠèŠåœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¦‚ä½•åˆ©ç”¨ <strong>TRAE SOLO</strong> çš„åŸç”Ÿèƒ½åŠ›ï¼Œä»¥æœ€ä½çš„æˆæœ¬æ„å»ºä¸€å¥—â€œé˜²æ‰‹æŠ–â€çš„ API Key å®‰å…¨ç®¡ç†æµç¨‹ã€‚</p>
</blockquote>
<h2 data-id="heading-0">é‚£äº›å¹´æˆ‘ä»¬è¸©è¿‡çš„å®‰å…¨é›·åŒº</h2>
<p>ä½ ç°åœ¨çš„ä»£ç é‡Œï¼Œæ˜¯ä¸æ˜¯è¿˜è—ç€è¿™æ ·çš„â€œå®šæ—¶ç‚¸å¼¹â€ï¼Ÿ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ ç»å¯¹ç¦æ­¢çš„å†™æ³•</span>
client = OpenAI(api_key=<span class="hljs-string">"sk-abcdefg123456..."</span>) 
</code></pre>
<p>æˆ–è€…ç¨å¾®å¥½ä¸€ç‚¹ï¼Œç”¨äº† <code>.env</code> æ–‡ä»¶ï¼Œä½†å´å¿˜äº†æŠŠå®ƒåŠ åˆ° <code>.gitignore</code> é‡Œï¼Œç»“æœä¸€æ¬¡ <code>git push</code>ï¼Œå…¨ä¸–ç•Œéƒ½çœ‹åˆ°äº†ä½ çš„å¯†é’¥ã€‚</p>
<p>æ›´éšè”½çš„é£é™©æ˜¯<strong>æ—¥å¿—æ³„éœ²</strong>ã€‚è°ƒè¯•çš„æ—¶å€™éšæ‰‹æ‰“å°ä¸€å¥ <code>print(request.headers)</code>ï¼Œå¯†é’¥å°±å ‚è€Œçš‡ä¹‹åœ°èººåœ¨äº†æœåŠ¡å™¨æ—¥å¿—é‡Œï¼Œè¢« ELK é‡‡é›†èµ°ï¼Œè®©è¿ç»´å°å“¥çœ‹ä¸ªæ­£ç€ã€‚</p>
<p>è¿™äº›ä½çº§é”™è¯¯ï¼Œå…‰é â€œå°å¿ƒâ€æ˜¯é˜²ä¸ä½çš„ã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯å·¥å…·å±‚é¢çš„<strong>å¼ºåˆ¶çº¦æŸ</strong>ã€‚</p>
<h2 data-id="heading-1">ç¯å¢ƒå˜é‡çš„â€œæ­£ç¡®æ‰“å¼€æ–¹å¼â€</h2>
<p>åœ¨ TRAE SOLO ä¸­ï¼Œç®¡ç†ç¯å¢ƒå˜é‡ä¸å†éœ€è¦æ‰‹åŠ¨åˆ›å»º <code>.env</code> æ–‡ä»¶å¹¶ç¥ˆç¥·åˆ«æäº¤é”™ã€‚å®ƒå†…ç½®çš„é…ç½®ç®¡ç†æœºåˆ¶ï¼Œå¤©ç„¶æ”¯æŒ<strong>æœ¬åœ°å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒçš„éš”ç¦»</strong>ã€‚</p>
<h3 data-id="heading-2">1. åˆ©ç”¨ TRAE SOLO çš„é…ç½®æ³¨å…¥</h3>
<p>TRAE SOLO å…è®¸æˆ‘ä»¬åœ¨ IDE å±‚é¢é…ç½®å¯†é’¥ï¼Œè€Œä¸æ˜¯å†™åœ¨é¡¹ç›®æ–‡ä»¶é‡Œã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿ä½ æŠŠæ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹æ‰“åŒ…å‘ç»™åˆ«äººï¼Œå¯†é’¥ä¹Ÿä¸ä¼šæ³„éœ²ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„é…ç½®åŠ è½½å™¨ï¼Œé…åˆ Pydantic çš„ <code>BaseSettings</code>ï¼Œå®ç°å¼ºç±»å‹çš„é…ç½®ç®¡ç†ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic_settings <span class="hljs-keyword">import</span> BaseSettings, SettingsConfigDict
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> Field, SecretStr

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppSettings</span>(<span class="hljs-title class_ inherited__">BaseSettings</span>):
    <span class="hljs-comment"># ä½¿ç”¨ SecretStr ç±»å‹ï¼Œé˜²æ­¢ print() æ—¶æ„å¤–æ‰“å°æ˜æ–‡</span>
    openai_api_key: SecretStr = Field(..., alias=<span class="hljs-string">"OPENAI_API_KEY"</span>)
    deepseek_api_key: SecretStr = Field(..., alias=<span class="hljs-string">"DEEPSEEK_API_KEY"</span>)
    
    <span class="hljs-comment"># å…è®¸ä» .env æ–‡ä»¶åŠ è½½ï¼Œä½†ä¼˜å…ˆçº§ä½äºç¯å¢ƒå˜é‡</span>
    model_config = SettingsConfigDict(
        env_file=<span class="hljs-string">".env"</span>, 
        env_file_encoding=<span class="hljs-string">"utf-8"</span>,
        extra=<span class="hljs-string">"ignore"</span>
    )

<span class="hljs-comment"># å®ä¾‹åŒ–é…ç½®</span>
settings = AppSettings()

<span class="hljs-comment"># âœ… å®‰å…¨çš„ä½¿ç”¨æ–¹å¼</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Key loaded: <span class="hljs-subst">{settings.openai_api_key}</span>"</span>) 
<span class="hljs-comment"># è¾“å‡º: Key loaded: ********** (Pydantic ä¼šè‡ªåŠ¨è„±æ•)</span>
</code></pre>
<h3 data-id="heading-3">2. ç¼–å†™ Git æäº¤å‰çš„â€œçœ‹é—¨ç‹—â€</h3>
<p>TRAE SOLO çš„ <code>DiffView</code> åŠŸèƒ½ä¸ä»…èƒ½çœ‹ä»£ç å·®å¼‚ï¼Œé…åˆ <code>pre-commit</code> é’©å­ï¼Œè¿˜èƒ½æˆä¸ºä¸€é“å®‰å…¨é˜²çº¿ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é…ç½®ä¸€ä¸ªç®€å•çš„ Python è„šæœ¬ä½œä¸º <code>pre-commit</code> hookï¼Œåœ¨æäº¤å‰æ‰«ææ‰€æœ‰å˜åŠ¨æ–‡ä»¶ï¼Œæ£€æµ‹æ˜¯å¦åŒ…å« <code>sk-</code> ç­‰æ•æ„Ÿç‰¹å¾ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># scripts/scan_secrets.py</span>
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-comment"># å®šä¹‰æ•æ„Ÿç‰¹å¾æ­£åˆ™</span>
PATTERNS = [
    <span class="hljs-string">r"sk-[a-zA-Z0-9]{20,}"</span>,  <span class="hljs-comment"># OpenAI é£æ ¼</span>
    <span class="hljs-string">r"x-api-key.*['\"]"</span>,      <span class="hljs-comment"># é€šç”¨ API Key</span>
]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_files</span>(<span class="hljs-params">files</span>):
    found_secrets = <span class="hljs-literal">False</span>
    <span class="hljs-keyword">for</span> file_path <span class="hljs-keyword">in</span> files:
        content = Path(file_path).read_text(encoding=<span class="hljs-string">'utf-8'</span>, errors=<span class="hljs-string">'ignore'</span>)
        <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> PATTERNS:
            <span class="hljs-keyword">if</span> re.search(pattern, content):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸš¨ è­¦å‘Š: åœ¨ <span class="hljs-subst">{file_path}</span> ä¸­å‘ç°ç–‘ä¼¼ API Keyï¼"</span>)
                found_secrets = <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> found_secrets

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># è·å– git æš‚å­˜åŒºçš„æ–‡ä»¶åˆ—è¡¨ï¼ˆæ­¤å¤„ç®€åŒ–ä¸ºæ‰«æå½“å‰ç›®å½•ï¼‰</span>
    <span class="hljs-keyword">if</span> scan_files(sys.argv[<span class="hljs-number">1</span>:]):
        sys.exit(<span class="hljs-number">1</span>) <span class="hljs-comment"># é˜»æ­¢æäº¤</span>
</code></pre>
<p>åœ¨ TRAE SOLO çš„ç»ˆç«¯ä¸­ï¼Œå°†æ­¤è„šæœ¬é›†æˆåˆ° Git æµç¨‹ä¸­ï¼Œå°±èƒ½åœ¨æºå¤´ææ–­æ³„éœ²é£é™©ã€‚</p>
<h2 data-id="heading-4">è¿›é˜¶å®æˆ˜ï¼šç”¨ TRAE SOLO ç›‘æ§ API è°ƒç”¨æˆæœ¬</h2>
<p>å…‰é˜²æ³„éœ²è¿˜ä¸å¤Ÿï¼Œä¸‡ä¸€ Key è¢«ç›—ç”¨äº†æˆ–è€…æ¨¡å‹é™·å…¥æ­»å¾ªç¯æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬éœ€è¦<strong>å¯è§‚æµ‹æ€§</strong>ã€‚</p>
<p>åˆ©ç”¨ TRAE SOLO çš„ <code>SOLO Coder</code>ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿç”Ÿæˆä¸€ä¸ª API è°ƒç”¨æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ï¼Œå®æ—¶ç»Ÿè®¡ Token æ¶ˆè€—ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps

<span class="hljs-comment"># é…ç½®æ—¥å¿—æ ¼å¼ï¼Œç»å¯¹ä¸è¦æ‰“å°å®Œæ•´çš„ Authorization å¤´</span>
logging.basicConfig(level=logging.INFO, <span class="hljs-built_in">format</span>=<span class="hljs-string">'%(asctime)s - %(message)s'</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">monitor_cost</span>(<span class="hljs-params">func</span>):
<span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        start_time = time.time()
        <span class="hljs-keyword">try</span>:
            response = func(*args, **kwargs)
            
            <span class="hljs-comment"># å‡è®¾ response åŒ…å« usage ä¿¡æ¯ (OpenAI æ ¼å¼)</span>
            usage = <span class="hljs-built_in">getattr</span>(response, <span class="hljs-string">'usage'</span>, <span class="hljs-literal">None</span>)
            <span class="hljs-keyword">if</span> usage:
                logging.info(
                    <span class="hljs-string">f"APIè°ƒç”¨æˆåŠŸ | è€—æ—¶: <span class="hljs-subst">{time.time() - start_time:<span class="hljs-number">.2</span>f}</span>s | "</span>
                    <span class="hljs-string">f"Tokens: <span class="hljs-subst">{usage.total_tokens}</span> (In: <span class="hljs-subst">{usage.prompt_tokens}</span>, Out: <span class="hljs-subst">{usage.completion_tokens}</span>)"</span>
                )
            <span class="hljs-keyword">return</span> response
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logging.error(<span class="hljs-string">f"APIè°ƒç”¨å¤±è´¥: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
            <span class="hljs-keyword">raise</span>
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-comment"># --- æ¨¡æ‹Ÿè°ƒç”¨ ---</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MockClient</span>:
<span class="hljs-meta">    @monitor_cost</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">chat_completion</span>(<span class="hljs-params">self, prompt</span>):
        time.sleep(<span class="hljs-number">0.5</span>)
        <span class="hljs-comment"># æ¨¡æ‹Ÿè¿”å›å¯¹è±¡</span>
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">MockResponse</span>:
            usage = <span class="hljs-built_in">type</span>(<span class="hljs-string">'Usage'</span>, (), {<span class="hljs-string">'total_tokens'</span>: <span class="hljs-number">150</span>, <span class="hljs-string">'prompt_tokens'</span>: <span class="hljs-number">50</span>, <span class="hljs-string">'completion_tokens'</span>: <span class="hljs-number">100</span>})()
        <span class="hljs-keyword">return</span> MockResponse()

client = MockClient()
client.chat_completion(<span class="hljs-string">"Hello AI"</span>)
</code></pre>
<p>æŠŠè¿™æ®µä»£ç å°è£…æˆä¸­é—´ä»¶ï¼Œé…åˆ Prometheus æˆ–ç®€å•çš„æ—¥å¿—ç›‘æ§ï¼Œä¸€æ—¦å‘ç° Token æ¶ˆè€—é€Ÿç‡å¼‚å¸¸ï¼ˆæ¯”å¦‚æ¯åˆ†é’Ÿæ¶ˆè€—è¶…è¿‡ $10ï¼‰ï¼Œç«‹åˆ»è§¦å‘æŠ¥è­¦ã€‚</p>
<h2 data-id="heading-5">é¿å‘æŒ‡å—ï¼šå®‰å…¨ä¸æ˜¯ä¸€æ¬¡æ€§çš„</h2>
<p>åœ¨æ„å»ºå®‰å…¨é˜²çº¿æ—¶ï¼Œæœ‰å‡ ä¸ªéšè”½çš„å‘éœ€è¦æ³¨æ„ï¼š</p>
<h3 data-id="heading-6">1. å¿½ç•¥äº†å†å²æäº¤è®°å½•</h3>
<p>å¾ˆå¤šæ–°æ‰‹ä»¥ä¸ºæŠŠå«æœ‰ Key çš„æ–‡ä»¶åˆ äº†æˆ–è€…åŠ è¿› <code>.gitignore</code> å°±ä¸‡äº‹å¤§å‰äº†ã€‚
<strong>çœŸç›¸</strong>ï¼šKey ä¾ç„¶èººåœ¨ <code>.git</code> æ–‡ä»¶å¤¹çš„å†å²è®°å½•é‡Œï¼Œç”¨ <code>git log -p</code> ä¸€æŸ¥ä¸€ä¸ªå‡†ã€‚
<strong>å¯¹ç­–</strong>ï¼šå¿…é¡»ä½¿ç”¨ <code>git filter-repo</code> æˆ– BFG Repo-Cleaner å½»åº•æ¸…æ´—å†å²è®°å½•ï¼Œæˆ–è€…å¹²è„†åˆ åº“é‡å»ºã€‚</p>
<h3 data-id="heading-7">2. é”™è¯¯åœ°ä¿¡ä»»å‰ç«¯ç¯å¢ƒ</h3>
<p>æœ‰äº›å¼€å‘è€…ä¸ºäº†å›¾çœäº‹ï¼Œç›´æ¥åœ¨å‰ç«¯ JS ä»£ç é‡Œè°ƒç”¨ OpenAI APIã€‚
<strong>çœŸç›¸</strong>ï¼šå‰ç«¯æ²¡æœ‰ä»»ä½•ç§˜å¯†ã€‚ä»»ä½•ç”¨æˆ·åªè¦æŒ‰ F12 æ‰“å¼€æ§åˆ¶å°ï¼Œç½‘ç»œè¯·æ±‚é‡Œçš„ Key å°±ä¸€è§ˆæ— ä½™ã€‚
<strong>å¯¹ç­–</strong>ï¼šå¿…é¡»é€šè¿‡<strong>åç«¯ä¸­è½¬</strong>ï¼ˆBackend-for-Frontend æ¨¡å¼ï¼‰ã€‚å‰ç«¯è¯·æ±‚åç«¯æ¥å£ï¼Œåç«¯é™„åŠ ä¸Š Key å†è½¬å‘ç»™å¤§æ¨¡å‹ã€‚</p>
<h3 data-id="heading-8">3. å¯†é’¥è½®æ¢æœºåˆ¶ç¼ºå¤±</h3>
<p>Key ç”¨äº†ä¸€å¹´éƒ½ä¸æ¢ï¼Œä¸€æ—¦æ³„éœ²å°±æ˜¯æ¯ç­æ€§æ‰“å‡»ã€‚
<strong>å¯¹ç­–</strong>ï¼šå»ºç«‹å®šæœŸè½®æ¢æœºåˆ¶ã€‚å¦‚æœä½¿ç”¨ Azure OpenAI æˆ– AWS Bedrockï¼Œåˆ©ç”¨ IAM è§’è‰²ä»£æ›¿é•¿æœŸ Key æ‰æ˜¯æ­£è§£ã€‚</p>
<h2 data-id="heading-9">ç»“è¯­</h2>
<p>åœ¨å¤§æ¨¡å‹æ—¶ä»£ï¼ŒAPI Key å°±æ˜¯ä½ çš„<strong>æ•°å­—é’±åŒ…</strong>ã€‚</p>
<p>TRAE SOLO æä¾›çš„ä¸ä»…æ˜¯ç¼–ç æ•ˆç‡çš„æå‡ï¼Œæ›´æ˜¯ä¸€ç§<strong>è§„èŒƒåŒ–çš„å·¥ç¨‹çº¦æŸ</strong>ã€‚é€šè¿‡ IDE å±‚é¢çš„é…ç½®ç®¡ç†ã€ä»£ç å®¡æŸ¥å’Œè‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸é™ä½å¼€å‘é€Ÿåº¦çš„å‰æä¸‹ï¼ŒæŠŠå®‰å…¨é£é™©é™åˆ°æœ€ä½ã€‚</p>
<p><strong>ä¸è¦ç­‰åˆ°è´¦å•ç‚¸äº†æ‰åæ‚”ï¼Œç°åœ¨å°±å»æ£€æŸ¥ä½ çš„ä»£ç åº“å§ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FastAPI - Tracking IDçš„è®¾è®¡]]></title>    <link>https://juejin.cn/post/7577702891272994851</link>    <guid>https://juejin.cn/post/7577702891272994851</guid>    <pubDate>2025-11-29T15:12:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577702891272994851" data-draft-id="7577690150092734504" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FastAPI -  Tracking IDçš„è®¾è®¡"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-29T15:12:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èŠ±é…’é”„ä½œç”°"/> <meta itemprop="url" content="https://juejin.cn/user/3289345922186590"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FastAPI -  Tracking IDçš„è®¾è®¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3289345922186590/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èŠ±é…’é”„ä½œç”°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T15:12:46.000Z" title="Sat Nov 29 2025 15:12:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œæ ¹æ® <code>tracking_id</code> è¿½æŸ¥æ—¥å¿—ä¸­ä¸€æ¡è¯·æ±‚çš„å®Œæ•´å¤„ç†è·¯å¾„æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„éœ€æ±‚ã€‚ä¸è¿‡ FastAPI å®˜æ–¹å¹¶æ²¡æœ‰æä¾›ç›¸å¯¹åº”çš„åŠŸèƒ½ï¼Œå› æ­¤éœ€è¦å¼€å‘è€…è‡ªè¡Œå®ç°ã€‚æœ¬æ–‡ä»‹ç»å¦‚ä½•åŸºäº <code>contextvars</code>ï¼Œä¸ºæ¯æ¬¡è¯·æ±‚çš„å®Œæ•´æµç¨‹éƒ½æ·»åŠ ä¸€ä¸ª tracking_idï¼Œå¹¶åœ¨æ—¥å¿—ä¸­è‡ªåŠ¨è®°å½•ã€‚</p>
<h2 data-id="heading-1">ä»€ä¹ˆæ˜¯ contextvars</h2>
<p>Python åœ¨ 3.7 ç‰ˆæœ¬çš„æ ‡å‡†åº“ä¸­åŠ å…¥äº†ä¸€ä¸ªæ¨¡å— <code>contextvars</code>ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ "(Context Variables) ä¸Šä¸‹æ–‡å˜é‡"ï¼Œé€šå¸¸ç”¨æ¥éšå¼åœ°ä¼ é€’ä¸€äº›ç¯å¢ƒä¿¡æ¯çš„å˜é‡ï¼Œå…¶ä½œç”¨è·Ÿ <code>threading.local()</code> æ¯”è¾ƒç›¸ä¼¼ã€‚ä¸è¿‡ <code>threading.local()</code> æ˜¯é’ˆå¯¹çº¿ç¨‹çš„ï¼Œéš”ç¦»çº¿ç¨‹ä¹‹é—´çš„æ•°æ®çŠ¶æ€ï¼Œè€Œ <code>contextvars</code> å¯ä»¥ç”¨åœ¨ <code>asyncio</code> ç”Ÿæ€çš„å¼‚æ­¥åç¨‹ä¸­ã€‚<strong>PS: <code>contextvars</code> ä¸ä»…å¯ä»¥ç”¨åœ¨å¼‚æ­¥åç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥æ›¿ä»£ <code>threading.local()</code> ç”¨åœ¨å¤šçº¿ç¨‹å‡½æ•°ä¸­ã€‚</strong></p>
<h2 data-id="heading-2">åŸºæœ¬ä½¿ç”¨</h2>
<ol>
<li>é¦–å…ˆç¼–å†™ <code>context.py</code></li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> contextvars
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>

TRACKING_ID: contextvars.ContextVar[<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]] = contextvars.ContextVar(
    <span class="hljs-string">'tracking_id'</span>, 
    default=<span class="hljs-literal">None</span>
)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tracking_id</span>() -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]:
    <span class="hljs-string">"""ç”¨äºä¾èµ–æ³¨å…¥"""</span>
    <span class="hljs-keyword">return</span> TRACKING_ID.get()

</code></pre>
<ol start="2">
<li>ç¼–å†™ä¸­é—´ä»¶ <code>middlewares.py</code>ï¼Œåœ¨è¯·æ±‚å¤´å’Œå“åº”å¤´ä¸­æ·»åŠ  tracking_id çš„ä¿¡æ¯ã€‚å¸¸è§åœºæ™¯å°±æ˜¯å®¢æˆ·æ‹¿ç€ tracking_id æ‰¾ç¢´ã€‚</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> uuid

<span class="hljs-keyword">from</span> starlette.middleware.base <span class="hljs-keyword">import</span> (BaseHTTPMiddleware,
                                       RequestResponseEndpoint)
<span class="hljs-keyword">from</span> starlette.requests <span class="hljs-keyword">import</span> Request
<span class="hljs-keyword">from</span> starlette.responses <span class="hljs-keyword">import</span> Response

<span class="hljs-keyword">from</span> context <span class="hljs-keyword">import</span> TRACKING_ID


<span class="hljs-keyword">class</span> <span class="hljs-title class_">TrackingIDMiddleware</span>(<span class="hljs-title class_ inherited__">BaseHTTPMiddleware</span>):
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-params">
        self, request: Request, call_next: RequestResponseEndpoint
    </span>) -&gt; Response:
        tracking_id = <span class="hljs-built_in">str</span>(uuid.uuid4())
        token = TRACKING_ID.<span class="hljs-built_in">set</span>(tracking_id)
        <span class="hljs-comment"># HTTP è¯·æ±‚å¤´ä¹ æƒ¯äºä½¿ç”¨ latin-1 ç¼–ç </span>
        request.scope[<span class="hljs-string">"headers"</span>].append((<span class="hljs-string">b"x-request-id"</span>, tracking_id.encode(<span class="hljs-string">"latin-1"</span>)))

        <span class="hljs-keyword">try</span>:
            resp = <span class="hljs-keyword">await</span> call_next(request)
        <span class="hljs-keyword">finally</span>:
            <span class="hljs-comment"># æ— è®ºæ˜¯å¦æˆåŠŸï¼Œæ¯æ¬¡è¯·æ±‚ç»“æŸæ—¶é‡ç½® tracking_idï¼Œé¿å…æ³„éœ²åˆ°ä¸‹ä¸€æ¬¡çš„è¯·æ±‚ä¸­</span>
            TRACKING_ID.reset(token)

        <span class="hljs-comment"># å¯é€‰, åœ¨å“åº”ä¸­è®¾ç½®è·Ÿè¸ª ID å¤´</span>
        resp.headers[<span class="hljs-string">"X-Tracking-ID"</span>] = tracking_id

        <span class="hljs-keyword">return</span> resp

</code></pre>
<ol start="3">
<li>ç¼–å†™ handler å‡½æ•° <code>handlers.py</code>ï¼Œæµ‹è¯•åœ¨ handler å‡½æ•°ä¸­è·å– tracking_idã€‚</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio

<span class="hljs-keyword">from</span> context <span class="hljs-keyword">import</span> TRACKING_ID


<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_db_query</span>():
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)
    current_id = TRACKING_ID.get()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"This is mock_db_query. Current tracking ID: <span class="hljs-subst">{current_id}</span>"</span>)
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)
</code></pre>
<ol start="4">
<li>ç¼–å†™ä¸»å‡½æ•° <code>main.py</code></li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> uvicorn
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, FastAPI
<span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> PlainTextResponse
<span class="hljs-keyword">from</span> starlette.background <span class="hljs-keyword">import</span> BackgroundTasks

<span class="hljs-keyword">from</span> context <span class="hljs-keyword">import</span> TRACKING_ID, get_tracking_id
<span class="hljs-keyword">from</span> handlers <span class="hljs-keyword">import</span> mock_db_query
<span class="hljs-keyword">from</span> middlewares <span class="hljs-keyword">import</span> TrackingIDMiddleware

app = FastAPI()

app.add_middleware(TrackingIDMiddleware)


<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/qwer"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_qwer</span>():
    <span class="hljs-string">"""æµ‹è¯•ä¸Šä¸‹æ–‡å˜é‡ä¼ é€’"""</span>
    current_id = TRACKING_ID.get()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"This is get qwer. Current tracking ID: <span class="hljs-subst">{current_id}</span>"</span>)
    <span class="hljs-keyword">return</span> PlainTextResponse(<span class="hljs-string">f"Current tracking ID: <span class="hljs-subst">{current_id}</span>"</span>)


<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/asdf"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_asdf</span>(<span class="hljs-params">tracking_id: <span class="hljs-built_in">str</span> = Depends(<span class="hljs-params">get_tracking_id</span>)</span>):
    <span class="hljs-string">"""æµ‹è¯•ä¾èµ–æ³¨å…¥"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"This is get asdf. tracking ID: <span class="hljs-subst">{tracking_id}</span>"</span>)
    <span class="hljs-keyword">await</span> mock_db_query()
    <span class="hljs-keyword">return</span> PlainTextResponse(<span class="hljs-string">f"Get request, tracking ID: <span class="hljs-subst">{tracking_id}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    uvicorn.run(<span class="hljs-string">"main:app"</span>, host=<span class="hljs-string">"127.0.0.1"</span>, port=<span class="hljs-number">8000</span>, workers=<span class="hljs-number">4</span>)
</code></pre>
<ol start="5">
<li>å¯åŠ¨æœåŠ¡åç”¨ curl æµ‹è¯• apiï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ° tracking_id åœ¨è¯·æ±‚ä¸­éƒ½èƒ½æ•è·åˆ°ã€‚</li>
</ol>
<pre><code class="hljs language-vbnet" lang="vbnet">This <span class="hljs-built_in">is</span> <span class="hljs-keyword">get</span> qwer. Current tracking ID: <span class="hljs-number">01</span>b0153f-<span class="hljs-number">4877</span>-<span class="hljs-number">4</span>ca0-ac35-ed88ab406452
<span class="hljs-symbol">INFO:</span>     <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">55708</span> - <span class="hljs-string">"GET /qwer HTTP/1.1"</span> <span class="hljs-number">200</span> OK
This <span class="hljs-built_in">is</span> <span class="hljs-keyword">get</span> asdf. tracking ID: <span class="hljs-number">0</span>be61d8d-<span class="hljs-number">11</span>a0-<span class="hljs-number">4</span>cb6-<span class="hljs-number">812</span>f-<span class="hljs-number">51</span>b9bfdc2639
This <span class="hljs-built_in">is</span> mock_db_query. Current tracking ID: <span class="hljs-number">0</span>be61d8d-<span class="hljs-number">11</span>a0-<span class="hljs-number">4</span>cb6-<span class="hljs-number">812</span>f-<span class="hljs-number">51</span>b9bfdc2639
<span class="hljs-symbol">INFO:</span>     <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">55722</span> - <span class="hljs-string">"GET /asdf HTTP/1.1"</span> <span class="hljs-number">200</span> OK
</code></pre>
<p>ä½¿ç”¨ curl çš„æ§åˆ¶å°è¾“å‡º</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">$</span> <span class="hljs-string">curl</span> <span class="hljs-string">-i</span> <span class="hljs-string">http://127.0.0.1:8000/qwer</span>
<span class="hljs-string">HTTP/1.1</span> <span class="hljs-number">200</span> <span class="hljs-string">OK</span>
<span class="hljs-attr">date:</span> <span class="hljs-string">Sat,</span> <span class="hljs-number">29</span> <span class="hljs-string">Nov</span> <span class="hljs-number">2025 06:16:46 </span><span class="hljs-string">GMT</span>
<span class="hljs-attr">server:</span> <span class="hljs-string">uvicorn</span>
<span class="hljs-attr">content-length:</span> <span class="hljs-number">57</span>
<span class="hljs-attr">content-type:</span> <span class="hljs-string">text/plain;</span> <span class="hljs-string">charset=utf-8</span>
<span class="hljs-attr">x-tracking-id:</span> <span class="hljs-string">01b0153f-4877-4ca0-ac35-ed88ab406452</span>

<span class="hljs-attr">Current tracking ID:</span> <span class="hljs-string">01b0153f-4877-4ca0-ac35-ed88ab406452</span>

<span class="hljs-string">=====</span> <span class="hljs-string">å¦ä¸€ä¸ªè¯·æ±‚</span> <span class="hljs-string">=====</span>

<span class="hljs-string">$</span> <span class="hljs-string">curl</span> <span class="hljs-string">-i</span> <span class="hljs-string">http://127.0.0.1:8000/asdf</span>
<span class="hljs-string">HTTP/1.1</span> <span class="hljs-number">200</span> <span class="hljs-string">OK</span>
<span class="hljs-attr">date:</span> <span class="hljs-string">Sat,</span> <span class="hljs-number">29</span> <span class="hljs-string">Nov</span> <span class="hljs-number">2025 06:16:49 </span><span class="hljs-string">GMT</span>
<span class="hljs-attr">server:</span> <span class="hljs-string">uvicorn</span>
<span class="hljs-attr">content-length:</span> <span class="hljs-number">62</span>
<span class="hljs-attr">content-type:</span> <span class="hljs-string">text/plain;</span> <span class="hljs-string">charset=utf-8</span>
<span class="hljs-attr">x-tracking-id:</span> <span class="hljs-string">0be61d8d-11a0-4cb6-812f-51b9bfdc2639</span>

<span class="hljs-string">Get</span> <span class="hljs-string">request,</span> <span class="hljs-attr">tracking ID:</span> <span class="hljs-string">0be61d8d-11a0-4cb6-812f-51b9bfdc2639</span>
</code></pre>
<h2 data-id="heading-3">åå°ä»»åŠ¡å‹ API</h2>
<p>FastAPI ä¸­æœ‰ <code>from starlette.background import BackgroundTasks</code> å¯ä»¥è®©æ¥å£ç›´æ¥å“åº”ï¼Œå°†å®é™…æµç¨‹æ”¾åˆ°åå°å¼‚æ­¥å¤„ç†ã€‚å› ä¸ºä¸Šé¢çš„ä¸­é—´ä»¶åœ¨å“åº”æ—¶ä¼šé‡ç½® tracking_idï¼Œæ‰€ä»¥åå°çš„åç¨‹å‡½æ•°<strong>å¯èƒ½</strong>ä¸ä¼šè·å–åˆ° tracking_idã€‚ç†è®ºä¸Šæ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯æœ¬åœ°æµ‹è¯•æ—¶å‘ç°åœ¨å¼‚æ­¥åç¨‹ä¸­è¿˜æ˜¯èƒ½è·å–åˆ° tracking_idï¼Œè¿™å¯èƒ½æ˜¯æœ¬åœ°ä½å¹¶å‘çš„é—®é¢˜ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒé«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæœ€å¥½è¿˜æ˜¯å¼ºåˆ¶è§£è€¦ï¼Œæ˜¾å¼ä¼ é€’ contextvarsã€‚</p>
<ol>
<li>è‡ªå®šä¹‰çš„ä¸­é—´ä»¶ç±»ä¿æŒä¸å˜ã€‚</li>
<li>æ·»åŠ åå°ä»»åŠ¡çš„ api</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> starlette.background <span class="hljs-keyword">import</span> BackgroundTasks
<span class="hljs-keyword">from</span> handlers <span class="hljs-keyword">import</span> mock_backgroud_task

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/zxcv"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_zxcv</span>(<span class="hljs-params">tasks: BackgroundTasks</span>):
    <span class="hljs-string">"""æµ‹è¯•åå°ä»»åŠ¡"""</span>
    current_id = TRACKING_ID.get()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"This is get zxcv. The current id is <span class="hljs-subst">{current_id}</span>"</span>)

    <span class="hljs-comment"># æ˜¾å¼ä¼ é€’ tracking_id</span>
    tasks.add_task(mock_backgroud_task, current_id)

    <span class="hljs-keyword">return</span> PlainTextResponse(<span class="hljs-string">f"This is get zxcv. The current id is <span class="hljs-subst">{current_id}</span>"</span>)
</code></pre>
<ol start="3">
<li>åå°åç¨‹å‡½æ•°ä¸­æ˜¾å¼å¤„ç†ã€‚ä»»åŠ¡åœ¨å¯åŠ¨æ—¶ï¼Œä½¿ç”¨ä¼ å…¥çš„å‚æ•°å€¼ï¼Œåœ¨è‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œé‡æ–°è®¾ç½® <code>TRACKING_ID</code>ã€‚åœ¨ä»»åŠ¡ç»“æŸæ—¶ï¼Œå¯¹ä»»åŠ¡è‡ªå·±è®¾ç½®çš„ä¸Šä¸‹æ–‡è¿›è¡Œæ¸…ç†ã€‚</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_backgroud_task</span>(<span class="hljs-params">request_tracking_id: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]</span>):
    <span class="hljs-keyword">if</span> request_tracking_id <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        request_tracking_id = <span class="hljs-built_in">str</span>(uuid4())
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"WARNING: No tracking ID found. Generate a new one: <span class="hljs-subst">{request_tracking_id}</span>"</span>)
    token = TRACKING_ID.<span class="hljs-built_in">set</span>(request_tracking_id)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># æ¨¡æ‹Ÿè€—æ—¶çš„åå°å¼‚æ­¥ä»»åŠ¡</span>
        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">5</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"This is mock backgroud task. Current tracking ID: <span class="hljs-subst">{request_tracking_id}</span>"</span>)
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-comment"># ç¡®ä¿ tracking ID è¢«é‡ç½®</span>
        TRACKING_ID.reset(token)
</code></pre>
<ol start="4">
<li>å¯åŠ¨ä¸»ç¨‹åºå¹¶æµ‹è¯• tracking_id æ˜¯å¦ä¸€è‡´ã€‚</li>
</ol>
<h2 data-id="heading-4">æ—¥å¿—è®°å½• tracking_id</h2>
<p>tracking_id åœ¨å‰é¢æ˜¯æ‰‹åŠ¨æ·»åŠ åˆ° <code>print()</code> é‡Œé¢çš„ï¼Œæœªå…è¿˜æ˜¯éº»çƒ¦äº†ç‚¹ï¼Œä¸æ³¨æ„çš„è¯è¿˜å¯èƒ½å¿˜äº†ã€‚å› æ­¤ï¼Œæœ€å¥½æ˜¯ç”¨æ—¥å¿—è®°å½•å™¨è‡ªåŠ¨è·å– <code>tracking_id</code>ï¼Œè¿™æ ·ä»£ç çš„ä¾µå…¥æ€§æ”¹åŠ¨å°±å¤§å¤§é™ä½äº†ã€‚</p>
<p>é¦–å…ˆéœ€è¦å°è£…ä¸€ä¸ªæ—¥å¿—æ¨¡å—ã€‚è¿™é‡Œé€‰ç”¨æ ‡å‡†åº“ <code>logging</code>ï¼Œå–œæ¬¢ <code>loguru</code> çš„è¯ä¹Ÿå¯ä»¥è¯•è¯•ç”¨ <code>loguru</code> å°è£…ï¼ˆå¦‚æœç”Ÿäº§ç¯å¢ƒæœ‰é¢‘ç¹ä¸”ä¸¥è‹›çš„å®‰å…¨æ‰«æï¼Œä¸ªäººå»ºè®®è¿˜æ˜¯å°½é‡ç”¨æ ‡å‡†åº“æ¯”è¾ƒå¥½ï¼Œå…å¾—ç»å¸¸å‡çº§ç¬¬ä¸‰æ–¹ä¾èµ–ï¼‰ã€‚å¦‚æœä½ çš„åº”ç”¨è¿è¡Œåœ¨ docker æˆ–è€… k8s ä¸Šï¼Œæœ‰ç°æˆçš„æ§åˆ¶å°æ—¥å¿—é‡‡é›†å·¥å…·ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¥å¿—æ¨¡å—åªéœ€è¦è¾“å‡ºåˆ°æ§åˆ¶å°å°±è¡Œäº†ã€‚å¦‚æœåº”ç”¨è¿è¡Œåœ¨ server ä¸Šï¼Œéœ€è¦ç”¨æ¯”å¦‚ <code>filebeat</code> è¿™æ ·çš„å·¥å…·è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œé‚£ä¹ˆéœ€è¦è§£å†³<strong>æ—¥å¿—æ–‡ä»¶ä½“ç§¯å¢é•¿</strong>ã€<strong>uvicorn å¤šå·¥ä½œè¿›ç¨‹è¿è¡ŒåŒæ—¶å†™æ—¥å¿—æ–‡ä»¶çš„ç«äº‰é—®é¢˜</strong>ã€ä»¥åŠ<strong>é«˜å¹¶å‘æƒ…å†µä¸‹å†™æ—¥å¿—æ–‡ä»¶é˜»å¡å¼‚æ­¥åç¨‹çš„é—®é¢˜</strong>ã€‚</p>
<p>ä»¥ä¸‹æ—¥å¿—æ¨¡å—çš„ç¤ºä¾‹è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œä¸»è¦ç‰¹ç‚¹ï¼š</p>
<ul>
<li>è‡ªåŠ¨è·å– tracking_idï¼Œæ— éœ€æ‰‹åŠ¨è®°å½•ã€‚</li>
<li>æ—¥å¿—ä¸º JSON æ ¼å¼ï¼Œä¾¿äºåœ¨ ELK è¿™æ ·çš„æ—¥å¿—èšåˆç³»ç»Ÿä¸­æŸ¥æ—¥å¿—ã€‚</li>
<li>æ—¥å¿—ä¼šåŒæ—¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºå’Œæ—¥å¿—æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥é…ç½®è¾“å‡ºåˆ°å…¶ä¸­ä¸€ä¸ªã€‚</li>
<li>æ—¥å¿—æ–‡ä»¶æŒ‰å¤©è½®è½¬ï¼Œé»˜è®¤ä¿ç•™æœ€è¿‘ 7 å¤©çš„æ—¥å¿—ï¼Œé¿å…æ—¥å¿—æ–‡ä»¶ä½“ç§¯å¢é•¿çš„é—®é¢˜ã€‚</li>
<li>ä¸»è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹è¾“å‡ºåˆ°å„è‡ªçš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé¿å…åŒæ—¶å†™æ—¥å¿—æ–‡ä»¶çš„ç«äº‰é—®é¢˜ã€‚</li>
<li>æ—¥å¿—ä¼šå…ˆè¾“å‡ºåˆ°é˜Ÿåˆ—ï¼Œé¿å…å†™æ–‡ä»¶é˜»å¡å¼‚æ­¥åç¨‹çš„é—®é¢˜ã€‚</li>
</ul>
<ol>
<li>ç¼–è¾‘æ–‡ä»¶ <code>pkg/log/log.py</code>ã€‚ä¸»è¦å†…å®¹éƒ½åœ¨è¿™ä¸ªéƒ¨åˆ†ã€‚éœ€è¦å¯¹å¤–æä¾›çš„å¯¹è±¡åªæœ‰ <code>setup_logger</code> å’Œ <code>close_log_queue</code>ã€‚</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> logging.handlers <span class="hljs-keyword">import</span> QueueHandler, QueueListener, TimedRotatingFileHandler
<span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> current_process
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">from</span> queue <span class="hljs-keyword">import</span> Queue
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>

<span class="hljs-keyword">from</span> context <span class="hljs-keyword">import</span> TRACKING_ID

_queue_listener = <span class="hljs-literal">None</span>
_queue_logger: <span class="hljs-type">Optional</span>[Queue] = <span class="hljs-literal">None</span>
PATTERN_PROCESS_NAME = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r"SpawnProcess-(\d+)"</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">JSONFormatter</span>(logging.Formatter):
    <span class="hljs-string">"""A logging formatter that outputs logs in JSON format."""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format</span>(<span class="hljs-params">self, record: logging.LogRecord</span>) -&gt; <span class="hljs-built_in">str</span>:
        log_record = {
            <span class="hljs-string">"@timestamp"</span>: self.formatTime(record, <span class="hljs-string">"%Y-%m-%dT%H:%M:%S%z"</span>),
            <span class="hljs-string">"level"</span>: record.levelname,
            <span class="hljs-string">"name"</span>: record.name,
            <span class="hljs-comment"># "taskName": getattr(record, "taskName", None),  # Record task name if needed</span>
            <span class="hljs-string">"processName"</span>: record.processName,  <span class="hljs-comment"># Record process name if needed</span>
            <span class="hljs-string">"tracking_id"</span>: <span class="hljs-built_in">getattr</span>(record, <span class="hljs-string">"tracking_id"</span>, <span class="hljs-literal">None</span>),
            <span class="hljs-string">"loc"</span>: <span class="hljs-string">"%s:%d"</span> % (record.filename, record.lineno),
            <span class="hljs-string">"func"</span>: record.funcName,
            <span class="hljs-string">"message"</span>: record.getMessage(),
        }

        <span class="hljs-keyword">return</span> json.dumps(log_record, ensure_ascii=<span class="hljs-literal">False</span>, default=<span class="hljs-built_in">str</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">TrackingIDFilter</span>(logging.Filter):
    <span class="hljs-string">"""A logging filter that adds tracking_id to log records.
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">filter</span>(<span class="hljs-params">self, record</span>):
        record.tracking_id = TRACKING_ID.get()
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_setup_console_handler</span>(<span class="hljs-params">level: <span class="hljs-built_in">int</span></span>) -&gt; logging.StreamHandler:
    <span class="hljs-string">"""Setup a StreamHandler for console logging.
    
    Args:
        level (int): The logging level.
    """</span>
    handler = logging.StreamHandler(sys.stdout)
    handler.setLevel(level)
    handler.setFormatter(JSONFormatter())
    <span class="hljs-keyword">return</span> handler


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_setup_file_handler</span>(<span class="hljs-params">
    level: <span class="hljs-built_in">int</span>, log_path: <span class="hljs-built_in">str</span>, rotate_days: <span class="hljs-built_in">int</span>
</span>) -&gt; TimedRotatingFileHandler:
    <span class="hljs-string">"""Setup a TimedRotatingFileHandler for logging.
    
    Args:
        level (int): The logging level.
        log_path (str): The log path.
        rotate_days (int): The number of days to keep log files.
    """</span>
    handler = TimedRotatingFileHandler(
        filename=log_path,
        when=<span class="hljs-string">"midnight"</span>,
        interval=<span class="hljs-number">1</span>,
        backupCount=rotate_days,
        encoding=<span class="hljs-string">"utf-8"</span>,
    )
    handler.setLevel(level)
    handler.setFormatter(JSONFormatter())
    <span class="hljs-keyword">return</span> handler


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_setup_queue_handler</span>(<span class="hljs-params">level: <span class="hljs-built_in">int</span>, log_queue: Queue</span>) -&gt; QueueHandler:
    <span class="hljs-string">"""Setup a QueueHandler for logging.
    
    Args:
        level (int): The logging level.
        log_queue (Queue): The log queue.
    """</span>
    handler = QueueHandler(log_queue)
    handler.setLevel(level)
    <span class="hljs-keyword">return</span> handler


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_spawn_process_number</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    Get the spawn process number for log file naming.
    The server should be started with multiple processes using uvicorn's --workers option.
    Prevent issues caused by multiple processes writing to the same log file.

    Args:
        name (str): The name of the log file.

    Returns:
        str: The spawn process number for log file naming.
    """</span>
    <span class="hljs-keyword">try</span>:
        process_name = current_process().name
        pid = os.getpid()

        <span class="hljs-keyword">if</span> process_name == <span class="hljs-string">"MainProcess"</span>:
            <span class="hljs-keyword">return</span> name
        <span class="hljs-keyword">elif</span> m := PATTERN_PROCESS_NAME.<span class="hljs-keyword">match</span>(process_name):
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{name}</span>-sp<span class="hljs-subst">{m.group(<span class="hljs-number">1</span>)}</span>"</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{name}</span>-<span class="hljs-subst">{pid}</span>"</span>

    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{name}</span>-<span class="hljs-subst">{os.getpid()}</span>"</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_setup_logpath</span>(<span class="hljs-params">log_dir: <span class="hljs-built_in">str</span>, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""Setup the log path.
    
    Args:
        log_dir (str): The log directory.
        name (str): The name of the log file. Example: "app"

    Returns:
        str: The log path.
    """</span>
    main_name = _get_spawn_process_number(name)
    log_file = <span class="hljs-string">f"<span class="hljs-subst">{main_name}</span>.log"</span>
    log_path = Path(log_dir) / log_file

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> log_path.parent.exists():
        <span class="hljs-keyword">try</span>:
            log_path.parent.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">raise</span> RuntimeError(
                <span class="hljs-string">f"Failed to create log directory: <span class="hljs-subst">{log_path.parent}</span>"</span>
            ) <span class="hljs-keyword">from</span> e
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(log_path)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_validate</span>(<span class="hljs-params">level: <span class="hljs-built_in">int</span>, enable_console: <span class="hljs-built_in">bool</span>, enable_file: <span class="hljs-built_in">bool</span>, rotate_days: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-string">"""Validate the log configuration.
    
    Args:
        level (int): The logging level.
        enable_console (bool): Whether to enable console logging.
        enable_file (bool): Whether to enable file logging.
        rotate_days (int): The number of days to keep log files.

    Raises:
        ValueError: If the log configuration is invalid.
    """</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> enable_console <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> enable_file:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"At least one of enable_console or enable_file must be True."</span>)

    <span class="hljs-keyword">if</span> level <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [
        logging.DEBUG,
        logging.INFO,
        logging.WARNING,
        logging.ERROR,
        logging.CRITICAL,
    ]:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"Invalid logging level specified."</span>)

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(rotate_days, <span class="hljs-built_in">int</span>) <span class="hljs-keyword">or</span> rotate_days &lt;= <span class="hljs-number">0</span>:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"rotate_days must be a positive integer."</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_logger</span>(<span class="hljs-params">
    name: <span class="hljs-built_in">str</span> = <span class="hljs-string">"app"</span>,
    level: <span class="hljs-built_in">int</span> = logging.DEBUG,
    enable_console: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>,
    enable_file: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>,
    log_dir: <span class="hljs-built_in">str</span> = <span class="hljs-string">"logs"</span>,
    rotate_days: <span class="hljs-built_in">int</span> = <span class="hljs-number">7</span>,
</span>) -&gt; logging.Logger:
    <span class="hljs-string">"""Setup a logger with console and/or file handlers.
    
    Args:
        name (str): The name of the logger. This will be used as the log file name prefix. Defaults to "app".
        level (int): The logging level. Defaults to logging.DEBUG.
        enable_console (bool): Whether to enable console logging. Defaults to True.
        enable_file (bool): Whether to enable file logging. Defaults to True.
        log_dir (str): The log directory. Defaults to "logs".
        rotate_days (int): The number of days to keep log files. Defaults to 7.

    Returns:
        logging.Logger: The configured logger.
    """</span>
    logger = logging.getLogger(name)

    <span class="hljs-keyword">if</span> logger.hasHandlers():
        <span class="hljs-keyword">return</span> logger  <span class="hljs-comment"># Logger is already configured</span>

    _validate(level, enable_console, enable_file, rotate_days)

    logger.setLevel(level)
    logger.propagate = <span class="hljs-literal">False</span>  <span class="hljs-comment"># Prevent log messages from being propagated to the root logger</span>

    log_path = _setup_logpath(log_dir, name)

    handlers = []

    <span class="hljs-keyword">if</span> enable_console:
        handlers.append(_setup_console_handler(level))

    <span class="hljs-keyword">if</span> enable_file:
        handlers.append(_setup_file_handler(level, log_path, rotate_days))

    <span class="hljs-keyword">global</span> _queue_logger, _queue_listener
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> _queue_logger:
        _queue_logger = Queue(-<span class="hljs-number">1</span>)

    queue_handler = _setup_queue_handler(level, _queue_logger)

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> _queue_listener:
        _queue_listener = QueueListener(
            _queue_logger, *handlers, respect_handler_level=<span class="hljs-literal">True</span>
        )
        _queue_listener.start()

    logger.addHandler(queue_handler)
    logger.addFilter(TrackingIDFilter())

    <span class="hljs-keyword">return</span> logger


<span class="hljs-keyword">def</span> <span class="hljs-title function_">close_log_queue</span>() -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-string">"""Close the log queue and stop the listener.
    This function should be called when the application is shutting down to ensure that the log queue is closed and the listener is stopped.
    """</span>
    <span class="hljs-keyword">global</span> _queue_listener
    <span class="hljs-keyword">if</span> _queue_listener:
        _queue_listener.stop()
        _queue_listener = <span class="hljs-literal">None</span>

</code></pre>
<ol start="2">
<li>ç¼–è¾‘ <code>pkg/log/__init__.py</code>ï¼Œä¾¿äºå…¶å®ƒæ¨¡å—å¯¼å…¥ï¼Œä¸ªäººä¸€èˆ¬ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªæ–‡ä»¶å‘Šè¯‰åˆ«äººè¿™ä¸ªæ¨¡å—å“ªäº›å¯¹è±¡æ˜¯ public çš„ã€‚<code>logger</code> å¯¹è±¡æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå…¶å®ƒæ¨¡å—ç›´æ¥ä½¿ç”¨å³å¯ï¼Œä¸€èˆ¬æ— éœ€ä½¿ç”¨ <code>setup_logger</code> å•ç‹¬åˆ›å»ºæ—¥å¿—è®°å½•å™¨å¯¹è±¡ã€‚ä¸è¿‡æœ‰çš„éœ€æ±‚æ˜¯å„ä¸ªç±»å¯¹è±¡åˆ›å»ºå„è‡ªçš„æ—¥å¿—è®°å½•å™¨ï¼Œæ‰€ä»¥ä¹Ÿå¯¹å¤–æä¾›å‡ºå»äº†ï¼ˆä¸ªäººè®¤ä¸ºæ²¡å•¥å¿…è¦ï¼‰ã€‚</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-keyword">from</span> .log <span class="hljs-keyword">import</span> close_log_queue, setup_logger

logger = setup_logger(
    log_dir=<span class="hljs-built_in">str</span>(Path(__file__).parent.parent.parent / <span class="hljs-string">"logs"</span>),
)

__all__ = [
    <span class="hljs-string">"logger"</span>,
    <span class="hljs-string">"setup_logger"</span>,
    <span class="hljs-string">"close_log_queue"</span>,
]

</code></pre>
<ol start="3">
<li>é€šè¿‡ FastAPI çš„ lifespan æ¥è°ƒç”¨ <code>close_log_queue</code></li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> asynccontextmanager

<span class="hljs-keyword">from</span> pkg.log <span class="hljs-keyword">import</span> close_log_queue

<span class="hljs-meta">@asynccontextmanager</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">lifespan</span>(<span class="hljs-params">app: FastAPI</span>):
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span>
    <span class="hljs-keyword">finally</span>:
        close_log_queue()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Shutdown!"</span>)


app = FastAPI(lifespan=lifespan)
</code></pre>
<ol start="4">
<li>å°† <code>print()</code> æ”¹æˆ <code>logger.info()</code>ï¼Œæµ‹è¯•æ—¥å¿—ä¸­æ˜¯å¦è‡ªåŠ¨è¾“å‡º <code>tracking_id</code>ã€‚å…¶ä¸­éƒ¨åˆ†æ”¹åŠ¨å¦‚ä¸‹</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_db_query</span>():
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)
    current_id = TRACKING_ID.get()
    logger.info(<span class="hljs-string">f"This is mock_db_query. Current tracking ID: <span class="hljs-subst">{current_id}</span>"</span>)
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)
</code></pre>
<ol start="5">
<li>ä½¿ç”¨ curl æµ‹è¯•å¹¶æŸ¥çœ‹æ—¥å¿—</li>
</ol>
<p>curl å‘½ä»¤è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -i  http://127.0.0.1:8000/asdf
HTTP/1.1 200 OK
<span class="hljs-built_in">date</span>: Sat, 29 Nov 2025 13:07:09 GMT
content-length: 62
content-type: text/plain; charset=utf-8
x-tracking-id: 38a015f7-b0d3-41ea-a2b3-179bf608b4bb

Get request, tracking ID: 38a015f7-b0d3-41ea-a2b3-179bf608b4bb
</code></pre>
<p>æœåŠ¡ç«¯çš„æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-less" lang="less">{"<span class="hljs-variable">@timestamp</span><span class="hljs-string">": "</span><span class="hljs-number">2025</span><span class="hljs-attribute">-11-29T21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">09</span>+<span class="hljs-number">0800</span><span class="hljs-string">", "</span>level<span class="hljs-string">": "</span>INFO<span class="hljs-string">", "</span>name<span class="hljs-string">": "</span>app<span class="hljs-string">", "</span>processName<span class="hljs-string">": "</span>SpawnProcess-<span class="hljs-number">3</span><span class="hljs-string">", "</span>tracking_id<span class="hljs-string">": "</span><span class="hljs-number">38</span>a015f7-b0d3-<span class="hljs-number">41</span>ea-a2b3-<span class="hljs-number">179</span>bf608b4bb<span class="hljs-string">", "</span>loc<span class="hljs-string">": "</span>main.<span class="hljs-attribute">py</span>:<span class="hljs-number">39</span><span class="hljs-string">", "</span>func<span class="hljs-string">": "</span>get_asdf<span class="hljs-string">", "</span>message<span class="hljs-string">": "</span>This is get asdf. tracking <span class="hljs-attribute">ID</span>: <span class="hljs-number">38</span>a015f7-b0d3-<span class="hljs-number">41</span>ea-a2b3-<span class="hljs-number">179</span>bf608b4bb"}
{"<span class="hljs-variable">@timestamp</span><span class="hljs-string">": "</span><span class="hljs-number">2025</span><span class="hljs-attribute">-11-29T21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">10</span>+<span class="hljs-number">0800</span><span class="hljs-string">", "</span>level<span class="hljs-string">": "</span>INFO<span class="hljs-string">", "</span>name<span class="hljs-string">": "</span>app<span class="hljs-string">", "</span>processName<span class="hljs-string">": "</span>SpawnProcess-<span class="hljs-number">3</span><span class="hljs-string">", "</span>tracking_id<span class="hljs-string">": "</span><span class="hljs-number">38</span>a015f7-b0d3-<span class="hljs-number">41</span>ea-a2b3-<span class="hljs-number">179</span>bf608b4bb<span class="hljs-string">", "</span>loc<span class="hljs-string">": "</span>handlers.<span class="hljs-attribute">py</span>:<span class="hljs-number">12</span><span class="hljs-string">", "</span>func<span class="hljs-string">": "</span>mock_db_query<span class="hljs-string">", "</span>message<span class="hljs-string">": "</span>This is mock_db_query. Current tracking <span class="hljs-attribute">ID</span>: <span class="hljs-number">38</span>a015f7-b0d3-<span class="hljs-number">41</span>ea-a2b3-<span class="hljs-number">179</span>bf608b4bb"}
</code></pre>
<p>æ—¥å¿—æ–‡ä»¶è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-less" lang="less">{"<span class="hljs-variable">@timestamp</span><span class="hljs-string">": "</span><span class="hljs-number">2025</span><span class="hljs-attribute">-11-29T21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">09</span>+<span class="hljs-number">0800</span><span class="hljs-string">", "</span>level<span class="hljs-string">": "</span>INFO<span class="hljs-string">", "</span>name<span class="hljs-string">": "</span>app<span class="hljs-string">", "</span>processName<span class="hljs-string">": "</span>SpawnProcess-<span class="hljs-number">3</span><span class="hljs-string">", "</span>tracking_id<span class="hljs-string">": "</span><span class="hljs-number">38</span>a015f7-b0d3-<span class="hljs-number">41</span>ea-a2b3-<span class="hljs-number">179</span>bf608b4bb<span class="hljs-string">", "</span>loc<span class="hljs-string">": "</span>main.<span class="hljs-attribute">py</span>:<span class="hljs-number">39</span><span class="hljs-string">", "</span>func<span class="hljs-string">": "</span>get_asdf<span class="hljs-string">", "</span>message<span class="hljs-string">": "</span>This is get asdf. tracking <span class="hljs-attribute">ID</span>: <span class="hljs-number">38</span>a015f7-b0d3-<span class="hljs-number">41</span>ea-a2b3-<span class="hljs-number">179</span>bf608b4bb"}
{"<span class="hljs-variable">@timestamp</span><span class="hljs-string">": "</span><span class="hljs-number">2025</span><span class="hljs-attribute">-11-29T21</span>:<span class="hljs-number">07</span>:<span class="hljs-number">10</span>+<span class="hljs-number">0800</span><span class="hljs-string">", "</span>level<span class="hljs-string">": "</span>INFO<span class="hljs-string">", "</span>name<span class="hljs-string">": "</span>app<span class="hljs-string">", "</span>processName<span class="hljs-string">": "</span>SpawnProcess-<span class="hljs-number">3</span><span class="hljs-string">", "</span>tracking_id<span class="hljs-string">": "</span><span class="hljs-number">38</span>a015f7-b0d3-<span class="hljs-number">41</span>ea-a2b3-<span class="hljs-number">179</span>bf608b4bb<span class="hljs-string">", "</span>loc<span class="hljs-string">": "</span>handlers.<span class="hljs-attribute">py</span>:<span class="hljs-number">12</span><span class="hljs-string">", "</span>func<span class="hljs-string">": "</span>mock_db_query<span class="hljs-string">", "</span>message<span class="hljs-string">": "</span>This is mock_db_query. Current tracking <span class="hljs-attribute">ID</span>: <span class="hljs-number">38</span>a015f7-b0d3-<span class="hljs-number">41</span>ea-a2b3-<span class="hljs-number">179</span>bf608b4bb"}
</code></pre>
<p>æ ¹æ®ä»¥ä¸Šä¸‰æ¡è¾“å‡ºå¯è§ï¼Œtracking_id åœ¨æ—¥å¿—ä¸­å’Œæ—¥å¿—æ¶ˆæ¯ä¸­ä¿æŒä¸€è‡´ã€‚</p>
<h3 data-id="heading-5">è¡¥å……: å¦ä¸€ç§è§£å†³å¤šè¿›ç¨‹æ–‡ä»¶å†™å…¥é—®é¢˜çš„æ–¹æ³•</h3>
<p>è´¹åŠ²è°ƒè¯•å®Œä¸Šé¢çš„æ—¥å¿—æ¨¡å—ä¸­ï¼Œæƒ³åˆ°å¦ä¸€ä¸ªè§£å†³å¤šè¿›ç¨‹æ–‡ä»¶å†™å…¥é—®é¢˜çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ç”±å¤–éƒ¨å·¥å…·å†™æ—¥å¿—ï¼ŒæœåŠ¡åªè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œç±»ä¼¼ docker å’Œ k8s è¿è¡Œç¯å¢ƒçš„è§£å†³æ–¹æ¡ˆã€‚ä»¥ä¸‹åªæ˜¯æ€è·¯ï¼Œå¤§è‡´æƒ³æ¥åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚</p>
<ol>
<li>ç§»é™¤æ—¥å¿—æ¨¡å—ä¸­çš„å†™æ–‡ä»¶åŠŸèƒ½ï¼Œä¿ç•™è¾“å‡ºåˆ°æ§åˆ¶å°çš„éƒ¨åˆ†ã€‚æ³¨æ„æ ‡å‡†è¾“å‡ºä¹Ÿæœ‰å¯èƒ½é˜»å¡å¼‚æ­¥åç¨‹ï¼Œæ‰€ä»¥é˜Ÿåˆ—å¤„ç†å™¨è¿˜æ˜¯è¦ä¿ç•™çš„ã€‚</li>
<li>å¯åŠ¨æ—¶ç”¨ <code>nohup</code> å°†æ§åˆ¶å°è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­ã€‚æ¯”å¦‚ï¼š<code>nohup python main.py &gt; logs/start.log 2&gt;&amp;1 &amp;</code></li>
<li>é…ç½® <code>logrotate</code> æ¥åšæ—¥å¿—è½®è½¬ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Goå¾®æœåŠ¡é€šä¿¡ä¼˜åŒ–ï¼šä»åè®®é€‰æ‹©åˆ°æ€§èƒ½è°ƒä¼˜å…¨æ”»ç•¥ï½œGoè¯­è¨€è¿›é˜¶ï¼ˆ20ï¼‰]]></title>    <link>https://juejin.cn/post/7577683422878056482</link>    <guid>https://juejin.cn/post/7577683422878056482</guid>    <pubDate>2025-11-29T15:14:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577683422878056482" data-draft-id="7577647745110671360" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Goå¾®æœåŠ¡é€šä¿¡ä¼˜åŒ–ï¼šä»åè®®é€‰æ‹©åˆ°æ€§èƒ½è°ƒä¼˜å…¨æ”»ç•¥ï½œGoè¯­è¨€è¿›é˜¶ï¼ˆ20ï¼‰"/> <meta itemprop="keywords" content="åç«¯,Go,å¾®æœåŠ¡"/> <meta itemprop="datePublished" content="2025-11-29T15:14:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŠç“¶å…¥æ¢¦"/> <meta itemprop="url" content="https://juejin.cn/user/2757990117802792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Goå¾®æœåŠ¡é€šä¿¡ä¼˜åŒ–ï¼šä»åè®®é€‰æ‹©åˆ°æ€§èƒ½è°ƒä¼˜å…¨æ”»ç•¥ï½œGoè¯­è¨€è¿›é˜¶ï¼ˆ20ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2757990117802792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŠç“¶å…¥æ¢¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T15:14:48.000Z" title="Sat Nov 29 2025 15:14:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»24åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»ä¸€æ¬¡è·¨åŸè°ƒç”¨çš„å»¶è¿Ÿçˆ†ç‚¸è¯´èµ·</h2>
<p>å»å¹´ä¸šåŠ¡é«˜å³°æœŸå‰ï¼Œæˆ‘ä»¬çš„å†…å®¹åˆ†å‘å¹³å°é‡åˆ°äº†ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼šè·¨åŸæœåŠ¡è°ƒç”¨çš„å¹³å‡å»¶è¿Ÿä»150msçªç„¶é£™å‡åˆ°äº†800msï¼ŒP99æ›´æ˜¯çªç ´äº†3ç§’ã€‚ä¸€å¼€å§‹å›¢é˜Ÿæ€€ç–‘æ˜¯ç½‘ç»œæŠ–åŠ¨ï¼Œä½†æŠ“åŒ…åˆ†æåå‘ç°â€”â€”90%çš„å»¶è¿Ÿéƒ½èŠ±åœ¨äº†TLSæ¡æ‰‹å’Œè¿æ¥å»ºç«‹ä¸Šã€‚åŸæ¥ï¼Œéšç€æµé‡å¢é•¿ï¼Œæ—§çš„HTTP/1.1å®¢æˆ·ç«¯è¿æ¥æ± é…ç½®ä¸åˆç†ï¼Œå¯¼è‡´æ¯ç§’åˆ›å»ºä¸Šåƒä¸ªæ–°è¿æ¥ï¼Œå®Œå…¨å†²å®äº†TLSæ¡æ‰‹èƒ½åŠ›ã€‚</p>
<p>è¿™æ¬¡äº‹ä»¶è®©æˆ‘ä»¬æ„è¯†åˆ°ï¼šå¾®æœåŠ¡é€šä¿¡çš„æ¯ä¸€æ¯«ç§’å»¶è¿Ÿï¼Œéƒ½æ¥è‡ªäºè®¾è®¡ç»†èŠ‚çš„å †å â€”â€”åè®®é€‰æ‹©ã€è¿æ¥å¤ç”¨ã€è¶…æ—¶ç­–ç•¥ï¼Œç”šè‡³ä¸€ä¸ªå°å°çš„Keep-Aliveé…ç½®ï¼Œéƒ½ä¼šåœ¨é«˜å¹¶å‘ä¸‹è¢«æ”¾å¤§æˆé›ªå´©æ•ˆåº”ã€‚</p>
<p>Goç¤¾åŒºæœ‰è¶³å¤Ÿä¸°å¯Œçš„é€šä¿¡å·¥å…·ï¼Œä½†è¦æŠŠå®ƒä»¬æ‹¼æˆæ—¢é«˜æ•ˆåˆç¨³å¥çš„ä½“ç³»ï¼Œéœ€è¦ä»åè®®ã€é“¾è·¯ã€æ•°æ®ã€æ²»ç†å¤šç»´åº¦æ•´ä½“æ€è€ƒã€‚æœ¬ç¯‡æˆ‘å°†ç»“åˆå›¢é˜Ÿè¿‘2å¹´çš„å¾®æœåŠ¡é€šä¿¡ä¼˜åŒ–ç»éªŒï¼Œæ¢³ç†å…³é”®å†³ç­–ç‚¹ä¸è°ƒä¼˜å¥—è·¯ï¼Œå¸®ä½ åœ¨è®¾è®¡ä¹‹åˆå°±æŒæ¡ä¸»åŠ¨æƒã€‚</p>
<h2 data-id="heading-1">åè®®é€‰å‹ä¸‰è¦ç´ ï¼šæ•ˆç‡ã€ç”Ÿæ€ä¸æ¼”åŒ–æˆæœ¬</h2>
<p>é€‰æ‹©é€šä¿¡åè®®æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä»ä¸‰ä¸ªç»´åº¦æƒè¡¡ï¼š<strong>æ•ˆç‡</strong>ï¼ˆå»¶è¿Ÿã€ååã€å¸¦å®½ï¼‰ã€<strong>ç”Ÿæ€</strong>ï¼ˆå·¥å…·é“¾ã€è°ƒè¯•æˆæœ¬ã€å›¢é˜Ÿç†Ÿæ‚‰åº¦ï¼‰ã€<strong>æ¼”åŒ–æˆæœ¬</strong>ï¼ˆæ‰©å±•èƒ½åŠ›ã€ç‰ˆæœ¬å…¼å®¹ã€æŠ€æœ¯å€ºåŠ¡ï¼‰ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬åœ¨ä¸åŒåœºæ™¯ä¸‹çš„é€‰å‹å®è·µï¼š</p>
<h3 data-id="heading-2">HTTP/1.1ï¼šè€ç»ƒå´éœ€è¦ç²¾ç»†æ‰“ç£¨</h3>
<p><strong>æˆ‘ä»¬ç”¨å®ƒåšä»€ä¹ˆ</strong>ï¼šä¸ç¬¬ä¸‰æ–¹å†…å®¹å¹³å°ã€æ•°æ®æ¥å£å¯¹æ¥ï¼Œä»¥åŠé¢å‘æµè§ˆå™¨çš„å…¬å¼€ APIã€‚</p>
<p><strong>å›½å†…æ¡†æ¶å‚è€ƒ</strong>ï¼š</p>
<ul>
<li><strong>Hertz</strong>ï¼ˆ<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.cloudwego.io%2Fdocs%2Fhertz%25EF%25BC%259A%25E5%25AD%2597%25E8%258A%2582%25E5%25BC%2580%25E6%25BA%2590%25E7%259A%2584%25E8%25BD%25BB%25E9%2587%258F" target="_blank" title="http://www.cloudwego.io/docs/hertz%EF%BC%9A%E5%AD%97%E8%8A%82%E5%BC%80%E6%BA%90%E7%9A%84%E8%BD%BB%E9%87%8F" ref="nofollow noopener noreferrer">www.cloudwego.io/docs/hertzï¼šâ€¦</a> HTTP æ¡†æ¶ï¼Œé€‚åˆå¯¹æ€§èƒ½æœ‰è¾ƒé«˜è¦æ±‚çš„åœºæ™¯</li>
<li><strong>Kratos</strong>ï¼ˆgo-kratos.devï¼‰ï¼šBç«™å¼€æºçš„å¾®æœåŠ¡æ¡†æ¶ï¼Œæä¾› HTTP æœåŠ¡ç»„ä»¶ä¸ä¸­é—´ä»¶ç”Ÿæ€</li>
</ul>
<p><strong>çœŸå®ä½“éªŒ</strong>ï¼š</p>
<ul>
<li>ä¼˜åŠ¿ï¼šPostmanã€curl è°ƒè¯•è¶…æ–¹ä¾¿ï¼ŒNginx ç½‘å…³ã€WAF ç­‰ä¸­é—´ä»¶æ”¯æŒå®Œç¾ï¼Œå›¢é˜Ÿæ–°äººä¸Šæ‰‹å¿«</li>
<li>å‘ç‚¹ï¼šåœ¨æˆ‘ä»¬çš„å†…å®¹ç³»ç»Ÿä¸­ï¼Œæ—©æœŸå› æœªé…ç½® <code>MaxIdleConnsPerHost</code>ï¼Œå¯¼è‡´å¯¹åŒä¸€ä¸ªç¬¬ä¸‰æ–¹å†…å®¹å¹³å°çš„å¹¶å‘è¯·æ±‚æ—¶ï¼Œæ¯ç§’åˆ›å»ºä¸Šç™¾ä¸ªæ–°è¿æ¥ï¼ŒTLS æ¡æ‰‹å»¶è¿Ÿå æ¯”é«˜è¾¾ 40%</li>
</ul>
<p><strong>ä¼˜åŒ–å®æ‹›</strong>ï¼š</p>
<ul>
<li>å¼ºåˆ¶å¼€å¯ <code>Keep-Alive</code>ï¼Œè®¾ç½®åˆç†çš„ <code>IdleConnTimeout</code>ï¼ˆæˆ‘ä»¬ç”¨ 60sï¼‰</li>
<li>ä½¿ç”¨ <code>httptrace.ClientTrace</code> è·Ÿè¸ªæ¯ä¸ªè¯·æ±‚çš„é˜¶æ®µè€—æ—¶ï¼Œå‘ç°é—®é¢˜ç“¶é¢ˆ</li>
<li>å¯¹äºå›ºå®šç¬¬ä¸‰æ–¹æ¥å£ï¼Œä½¿ç”¨ <code>singleflight.Group</code> åˆå¹¶ç›¸åŒå‚æ•°çš„å¹¶å‘è¯·æ±‚ï¼ˆæ¯”å¦‚æŸ¥è¯¢ç‰©æµçŠ¶æ€ï¼‰</li>
</ul>
<h3 data-id="heading-3">HTTP/2ï¼šå¹¶å‘å‹å¥½ä½†ä»éœ€å…³æ³¨é˜Ÿåˆ—</h3>
<p><strong>æˆ‘ä»¬ç”¨å®ƒåšä»€ä¹ˆ</strong>ï¼šå†…éƒ¨æœåŠ¡é—´çš„é«˜é¢‘è°ƒç”¨ï¼Œç‰¹åˆ«æ˜¯èšåˆç±»æœåŠ¡ï¼ˆæ¯”å¦‚å•†å“è¯¦æƒ…é¡µéœ€è¦è°ƒç”¨ä»·æ ¼ã€åº“å­˜ã€ä¿ƒé”€ç­‰ 10+ ä¸ªæœåŠ¡ï¼‰ã€‚</p>
<p><strong>çœŸå®ä½“éªŒ</strong>ï¼š</p>
<ul>
<li>ä¼˜åŠ¿ï¼šå¤šè·¯å¤ç”¨ç¡®å®è§£å†³äº† HTTP/1.1 çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œç›¸åŒ QPS ä¸‹è¿æ¥æ•°å‡å°‘äº† 90%</li>
<li>å‘ç‚¹ï¼šåœ¨æˆ‘ä»¬çš„ API ç½‘å…³ä¸­ï¼Œæ›¾å› å•è¿æ¥çš„ <code>MaxConcurrentStreams</code> è®¾ç½®è¿‡å¤§ï¼ˆé»˜è®¤ 250ï¼‰ï¼Œå¯¼è‡´ä¸ªåˆ«æ…¢è¯·æ±‚é˜»å¡äº†æ•´ä¸ªè¿æ¥çš„å…¶ä»–è¯·æ±‚</li>
</ul>
<p><strong>ä¼˜åŒ–å®æ‹›</strong>ï¼š</p>
<ul>
<li>åœ¨ <code>http2.Server</code> ä¸­è®¾ç½® <code>MaxConcurrentStreams: 100</code>ï¼Œé¿å…å•è¿æ¥è¿‡è½½</li>
<li>å¯¹äºé«˜è´Ÿè½½æœåŠ¡ï¼Œä½¿ç”¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ <code>grpc-lb</code>ï¼‰æ‹†åˆ†è¿æ¥åˆ°ä¸åŒå®ä¾‹</li>
<li>ç›‘æ§ <code>inflight</code> è¯·æ±‚æ•°é‡ï¼Œå½“è¶…è¿‡é˜ˆå€¼æ—¶ä¸»åŠ¨è§¦å‘é™çº§</li>
</ul>
<h3 data-id="heading-4">gRPCï¼šå¼ºç±»å‹ä¸å·¥å…·é“¾å¹¶é‡</h3>
<p><strong>æˆ‘ä»¬ç”¨å®ƒåšä»€ä¹ˆ</strong>ï¼šæ ¸å¿ƒæœåŠ¡é—´çš„é«˜é¢‘ RPC è°ƒç”¨ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ streaming èƒ½åŠ›çš„åœºæ™¯ï¼ˆæ¯”å¦‚å®æ—¶å†…å®¹åŒæ­¥ã€çŠ¶æ€æ¨é€ï¼‰ã€‚</p>
<p><strong>å›½å†…æ¡†æ¶å‚è€ƒ</strong>ï¼š</p>
<ul>
<li><strong>Kitex</strong>ï¼ˆcloudwego.github.io/kitexï¼‰ï¼šå­—èŠ‚å¼€æºçš„ RPC æ¡†æ¶ï¼Œæ”¯æŒ gRPC/Thriftï¼Œé€‚åˆé«˜æ€§èƒ½ RPC åœºæ™¯</li>
<li><strong>Kratos</strong>ï¼šBç«™æ¡†æ¶ï¼Œé›†æˆ gRPC ä¸å¾®æœåŠ¡æ²»ç†èƒ½åŠ›ï¼Œæä¾›å…¨é“¾è·¯è§£å†³æ–¹æ¡ˆ</li>
</ul>
<p><strong>çœŸå®ä½“éªŒ</strong>ï¼š</p>
<ul>
<li>ä¼˜åŠ¿ï¼šProtoBuf å‹ç¼©æ•ˆç‡æ¯” JSON é«˜ 60% ä»¥ä¸Šï¼Œè‡ªåŠ¨ç”Ÿæˆçš„å®¢æˆ·ç«¯ä»£ç è´¨é‡é«˜ï¼Œå†…ç½®çš„å¥åº·æ£€æŸ¥ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½çœäº†å¾ˆå¤šå¼€å‘é‡</li>
<li>å‘ç‚¹ï¼šè°ƒè¯•ç¡®å®æ¯” HTTP éº»çƒ¦ï¼Œéœ€è¦ç”¨ <code>grpcurl</code> æˆ–ä¸“é—¨çš„ GUI å·¥å…·ï¼›å¯¹ç½‘ç»œä¸­é—´ä»¶è¦æ±‚é«˜ï¼Œæˆ‘ä»¬æ›¾é‡åˆ°è¿‡æŸäº›è€ç‰ˆæœ¬çš„ F5 è´Ÿè½½å‡è¡¡å™¨ä¸æ”¯æŒ gRPC çš„é—®é¢˜</li>
</ul>
<p><strong>æ¨èå¼€æºå·¥å…·</strong>ï¼š</p>
<ul>
<li><code>buf</code> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fbuf.build%2F)%25EF%25BC%259A%25E6%25AF%2594%25E5%258E%259F%25E7%2594%259F" target="_blank" title="https://buf.build/)%EF%BC%9A%E6%AF%94%E5%8E%9F%E7%94%9F" ref="nofollow noopener noreferrer">buf.build/)ï¼šæ¯”åŸç”Ÿ</a> protoc æ›´å¥½ç”¨çš„ Protobuf æ„å»ºå·¥å…·ï¼Œæ”¯æŒ lintã€breaking change æ£€æŸ¥</li>
<li><code>grpc-go</code> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgrpc%2Fgrpc-go)%25EF%25BC%259A%25E5%25AE%2598%25E6%2596%25B9" target="_blank" title="https://github.com/grpc/grpc-go)%EF%BC%9A%E5%AE%98%E6%96%B9" ref="nofollow noopener noreferrer">github.com/grpc/grpc-gâ€¦</a> gRPC å®ç°ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ç”¨ v1.50+ ç‰ˆæœ¬ï¼Œç¨³å®šæ€§ä¸é”™</li>
<li><code>grpc-ecosystem/go-grpc-middleware</code>ï¼šæä¾›äº†é™æµã€ç†”æ–­ã€æ—¥å¿—ç­‰å®ç”¨ä¸­é—´ä»¶</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-proto" lang="proto">// api/checkout/v1/service.proto
syntax = "proto3";
package checkout.v1;

option go_package = "github.com/yourcompany/yourproject/api/checkout/v1";

service CheckoutService {
    // æµå¼ä¸‹å•æ¥å£ï¼Œæ”¯æŒæ‰¹é‡æäº¤
    rpc PlaceOrder(stream OrderRequest) returns (OrderResponse);
    // è®¢å•çŠ¶æ€æŸ¥è¯¢
    rpc GetStatus(StatusRequest) returns (StatusResponse);
}

message OrderRequest {
    string order_id = 1;
    repeated Item items = 2;
}

message Item {
    string sku = 1;
    int32 quantity = 2;
}

message OrderResponse {
    bool success = 1;
    string order_id = 2;
    string message = 3;
}

message StatusRequest {
    string order_id = 1;
}

message StatusResponse {
    string order_id = 1;
    string status = 2;
    int64 updated_at = 3;
}
</code></pre>
<h3 data-id="heading-5">GraphQL / REST æ··åˆï¼šé¢å‘å®¢æˆ·ç«¯çš„èšåˆå±‚</h3>
<p><strong>æˆ‘ä»¬ç”¨å®ƒåšä»€ä¹ˆ</strong>ï¼šç§»åŠ¨ç«¯å’Œ Web å‰ç«¯çš„ç»Ÿä¸€ API å±‚ï¼Œæ›¿ä»£äº†åŸæ¥çš„å¤šä¸ª BFFï¼ˆBackend for Frontendï¼‰ã€‚</p>
<p><strong>çœŸå®ä½“éªŒ</strong>ï¼š</p>
<ul>
<li>ä¼˜åŠ¿ï¼šå‰ç«¯å¯ä»¥æŒ‰éœ€å–æ•°ï¼Œå‡å°‘äº† 70% çš„æ— æ•ˆæ•°æ®ä¼ è¾“ï¼›ä¸€ä¸ª GraphQL æœåŠ¡æ›¿ä»£äº†åŸæ¥çš„ 5 ä¸ª BFF æœåŠ¡</li>
<li>å‘ç‚¹ï¼šåˆæœŸå›  Resolver æœªå¹¶è¡ŒåŒ–ï¼Œå¯¼è‡´æŸäº›å¤æ‚æŸ¥è¯¢çš„å»¶è¿Ÿæ¯” REST è¿˜é«˜</li>
</ul>
<p><strong>ä¼˜åŒ–å®æ‹›</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>graphql-go-tools</code> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwundergraph%2Fgraphql-go-tools" target="_blank" title="https://github.com/wundergraph/graphql-go-tools" ref="nofollow noopener noreferrer">github.com/wundergraphâ€¦</a>) æé«˜ GraphQL å¼•æ“æ€§èƒ½</li>
<li>åœ¨ Resolver å†…éƒ¨ä½¿ç”¨ <code>errgroup.Group</code> å¹¶å‘è°ƒç”¨åç«¯æœåŠ¡</li>
<li>é…åˆ <code>dataloader</code> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgraph-gophers%2Fdataloader" target="_blank" title="https://github.com/graph-gophers/dataloader" ref="nofollow noopener noreferrer">github.com/graph-gopheâ€¦</a>) æ‰¹é‡åŒ–ç›¸åŒç±»å‹çš„è¯·æ±‚ï¼ˆæ¯”å¦‚æ‰¹é‡æŸ¥è¯¢å¤šä¸ªå•†å“çš„ä»·æ ¼ï¼‰</li>
</ul>
<h3 data-id="heading-6">æ¶ˆæ¯é˜Ÿåˆ— / äº‹ä»¶æµï¼šè§£è€¦å»¶è¿Ÿå®¹å¿å‹åœºæ™¯</h3>
<p><strong>æˆ‘ä»¬ç”¨å®ƒåšä»€ä¹ˆ</strong>ï¼šå¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆæ¯”å¦‚å†…å®¹å‘å¸ƒåå‘é€é€šçŸ¥ã€æ›´æ–°ç»Ÿè®¡æ•°æ®ï¼‰ï¼Œä»¥åŠäº‹ä»¶é©±åŠ¨çš„å¾®æœåŠ¡æ¶æ„ã€‚</p>
<p><strong>çœŸå®ä½“éªŒ</strong>ï¼š</p>
<ul>
<li>ä¼˜åŠ¿ï¼šç¡®å®å®ç°äº†æœåŠ¡è§£è€¦ï¼Œåœ¨å¤§ä¿ƒæœŸé—´ï¼Œå³ä½¿é€šçŸ¥æœåŠ¡æŒ‚äº†ï¼Œä¹Ÿä¸ä¼šå½±å“æ ¸å¿ƒçš„è®¢å•æµç¨‹</li>
<li>å‘ç‚¹ï¼šè°ƒè¯•å’Œå…¨é“¾è·¯è¿½è¸ªæ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬æ›¾é‡åˆ°è¿‡æ¶ˆæ¯ä¸¢å¤±ä½†å¾ˆéš¾å®šä½åŸå› çš„æƒ…å†µ</li>
</ul>
<p><strong>æ¨èå¼€æºå·¥å…·</strong>ï¼š</p>
<ul>
<li><code>sarama</code> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FShopify%2Fsarama)%25EF%25BC%259AGo" target="_blank" title="https://github.com/Shopify/sarama)%EF%BC%9AGo" ref="nofollow noopener noreferrer">github.com/Shopify/sarâ€¦</a> è¯­è¨€ä¸­æœ€æˆç†Ÿçš„ Kafka å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ç”¨å®ƒå¤„ç†æ¯å¤©æ•°åäº¿çš„æ¶ˆæ¯</li>
<li><code>nats.go</code> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnats-io%2Fnats.go)%25EF%25BC%259A%25E8%25BD%25BB%25E9%2587%258F%25E7%25BA%25A7%25E7%259A%2584%25E6%25B6%2588%25E6%2581%25AF%25E9%2598%259F%25E5%2588%2597%25EF%25BC%258C%25E9%2580%2582%25E5%2590%2588%25E5%25BB%25B6%25E8%25BF%259F%25E6%2595%258F%25E6%2584%259F%25E7%259A%2584%25E5%259C%25BA%25E6%2599%25AF" target="_blank" title="https://github.com/nats-io/nats.go)%EF%BC%9A%E8%BD%BB%E9%87%8F%E7%BA%A7%E7%9A%84%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%EF%BC%8C%E9%80%82%E5%90%88%E5%BB%B6%E8%BF%9F%E6%95%8F%E6%84%9F%E7%9A%84%E5%9C%BA%E6%99%AF" ref="nofollow noopener noreferrer">github.com/nats-io/natâ€¦</a></li>
<li><code>watermill</code> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FThreeDotsLabs%2Fwatermill)%25EF%25BC%259AGo" target="_blank" title="https://github.com/ThreeDotsLabs/watermill)%EF%BC%9AGo" ref="nofollow noopener noreferrer">github.com/ThreeDotsLaâ€¦</a> è¯­è¨€çš„äº‹ä»¶é©±åŠ¨æ¡†æ¶ï¼Œæ”¯æŒå¤šç§æ¶ˆæ¯é˜Ÿåˆ—åç«¯</li>
</ul>
<p><strong>ä¼˜åŒ–å®æ‹›</strong>ï¼š</p>
<ul>
<li>æ˜ç¡®å®šä¹‰æŠ•é€’è¯­ä¹‰ï¼ˆæˆ‘ä»¬åœ¨æ ¸å¿ƒä¸šåŠ¡ä¸­ä½¿ç”¨è‡³å°‘ä¸€æ¬¡æŠ•é€’ï¼‰</li>
<li>å®ç°æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¤„ç†æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯</li>
<li>ç›‘æ§æ¶ˆè´¹ Lagï¼Œå½“ Lag è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘å‘Šè­¦å’Œæ‰©å®¹</li>
</ul>
<h2 data-id="heading-7">è¿æ¥ä¸ä¼ è¾“ç­–ç•¥ï¼šè®©é“¾è·¯ä¿æŒâ€œæ¸©çƒ­â€</h2>
<p>è¿æ¥ç®¡ç†æ˜¯å¾®æœåŠ¡é€šä¿¡æ€§èƒ½çš„åŸºçŸ³ã€‚æˆ‘ä»¬çš„ç»éªŒæ˜¯ï¼š<strong>è¿æ¥æ± é…ç½®çš„å¥½åï¼Œç›´æ¥å†³å®šäº†ç³»ç»Ÿåœ¨é«˜å¹¶å‘ä¸‹çš„ç¨³å®šæ€§</strong>ã€‚</p>
<h3 data-id="heading-8">HTTP å®¢æˆ·ç«¯ï¼šå–„ç”¨ <code>http.Transport</code></h3>
<p><strong>æˆ‘ä»¬çš„é…ç½®å®è·µ</strong>ï¼š</p>
<p><strong>æ¡†æ¶å·¥å…·å‚è€ƒ</strong>ï¼š</p>
<ul>
<li><strong>Hertz</strong> ä¸ <strong>Kratos</strong> éƒ½æä¾›äº†ä¼˜åŒ–çš„ HTTP å®¢æˆ·ç«¯å®ç°ï¼Œå†…ç½®è¿æ¥æ± ç®¡ç†ä¸æœåŠ¡å‘ç°èƒ½åŠ›</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Hertz å®¢æˆ·ç«¯ç¤ºä¾‹ï¼ˆéœ€å¯¼å…¥ time åŒ…ï¼‰</span>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"time"</span>
    <span class="hljs-string">"github.com/cloudwego/hertz/client"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewHertzClient</span><span class="hljs-params">()</span></span> client.Client {
    c, _ := client.NewClient(
        client.WithTimeout(<span class="hljs-number">800</span>*time.Millisecond),
        client.WithMaxConnsPerHost(<span class="hljs-number">100</span>),
        client.WithMaxIdleConnsPerHost(<span class="hljs-number">50</span>),
        client.WithIdleConnTimeout(<span class="hljs-number">60</span>*time.Second),
    )
    <span class="hljs-keyword">return</span> c
}
</code></pre>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å®¢æˆ·ç«¯</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewHTTPClient</span><span class="hljs-params">()</span></span> *http.Client {
    <span class="hljs-keyword">return</span> &amp;http.Client{
        Timeout: <span class="hljs-number">800</span> * time.Millisecond, <span class="hljs-comment">// æ€»è¶…æ—¶æ§åˆ¶</span>
        Transport: &amp;http.Transport{
            <span class="hljs-comment">// è¿æ¥æ± é…ç½®</span>
            MaxIdleConns:        <span class="hljs-number">1000</span>,    <span class="hljs-comment">// å…¨å±€æœ€å¤§ç©ºé—²è¿æ¥æ•°</span>
            MaxIdleConnsPerHost: <span class="hljs-number">100</span>,     <span class="hljs-comment">// æ¯ä¸ªä¸»æœºçš„æœ€å¤§ç©ºé—²è¿æ¥æ•°</span>
            IdleConnTimeout:     <span class="hljs-number">60</span> * time.Second, <span class="hljs-comment">// ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´</span>
            
            <span class="hljs-comment">// è¿æ¥å»ºç«‹ç›¸å…³</span>
            TLSHandshakeTimeout:   <span class="hljs-number">300</span> * time.Millisecond, <span class="hljs-comment">// TLS æ¡æ‰‹è¶…æ—¶</span>
            ExpectContinueTimeout: <span class="hljs-number">100</span> * time.Millisecond, <span class="hljs-comment">// 100-continue è¶…æ—¶</span>
            DialContext: (&amp;net.Dialer{
                Timeout:   <span class="hljs-number">500</span> * time.Millisecond, <span class="hljs-comment">// è¿æ¥å»ºç«‹è¶…æ—¶</span>
                KeepAlive: <span class="hljs-number">60</span> * time.Second,       <span class="hljs-comment">// TCP Keep-Alive</span>
                DualStack: <span class="hljs-literal">true</span>,                   <span class="hljs-comment">// æ”¯æŒ IPv4/IPv6</span>
            }).DialContext,
        },
    }
}
</code></pre>
<p><strong>çœŸå®è¸©å‘ç»éªŒ</strong>ï¼š</p>
<ul>
<li>æ—©æœŸæˆ‘ä»¬å°† <code>MaxIdleConnsPerHost</code> è®¾ç½®ä¸º 10ï¼Œç»“æœåœ¨å³°å€¼ QPS è¾¾åˆ° 1000 æ—¶ï¼Œæ¯ç§’åˆ›å»ºäº† 100 ä¸ªæ–°è¿æ¥ï¼ŒTLS æ¡æ‰‹å»¶è¿Ÿé£™å‡</li>
<li>åæ¥æ ¹æ®å…¬å¼ <code>MaxIdleConnsPerHost = å³°å€¼ QPS Ã— å¹³å‡å“åº”æ—¶é—´</code>ï¼Œè®¡ç®—å‡ºéœ€è¦ 100 å·¦å³ï¼Œè°ƒæ•´åè¿æ¥å¤ç”¨ç‡ä» 30% æå‡åˆ°äº† 90%</li>
</ul>
<p><strong>è¿›é˜¶ä¼˜åŒ–</strong>ï¼š</p>
<ol>
<li>
<p><strong>è‡ªå®šä¹‰ DNS ç¼“å­˜</strong>ï¼ˆè§£å†³ DNS è§£æå»¶è¿Ÿé—®é¢˜ï¼‰ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ç®€å•çš„ DNS ç¼“å­˜å®ç°</span>
<span class="hljs-keyword">type</span> DNSCache <span class="hljs-keyword">struct</span> {
    cache <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>][]net.IP
    mu    sync.RWMutex
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *DNSCache)</span></span> LookupIP(host <span class="hljs-type">string</span>) ([]net.IP, <span class="hljs-type">error</span>) {
    c.mu.RLock()
    ips, ok := c.cache[host]
    c.mu.RUnlock()
    <span class="hljs-keyword">if</span> ok {
        <span class="hljs-keyword">return</span> ips, <span class="hljs-literal">nil</span>
    }
    
    ips, err := net.LookupIP(host)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    c.mu.Lock()
    c.cache[host] = ips
    c.mu.Unlock()
    <span class="hljs-keyword">return</span> ips, <span class="hljs-literal">nil</span>
}
</code></pre>
</li>
<li>
<p><strong>ä½¿ç”¨ <code>httptrace</code> åˆ†æè¯·æ±‚é˜¶æ®µè€—æ—¶</strong>ï¼š</p>
<pre><code class="hljs language-go" lang="go">trace := &amp;httptrace.ClientTrace{
    ConnectStart: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(network, addr <span class="hljs-type">string</span>)</span></span> {
        fmt.Printf(<span class="hljs-string">"ConnectStart: %s %s\n"</span>, network, addr)
    },
    ConnectDone: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(network, addr <span class="hljs-type">string</span>, err <span class="hljs-type">error</span>)</span></span> {
        fmt.Printf(<span class="hljs-string">"ConnectDone: %s %s, err: %v\n"</span>, network, addr, err)
    },
    TLSHandshakeStart: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        fmt.Println(<span class="hljs-string">"TLSHandshakeStart"</span>)
    },
    TLSHandshakeDone: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(cs tls.ConnectionState, err <span class="hljs-type">error</span>)</span></span> {
        fmt.Printf(<span class="hljs-string">"TLSHandshakeDone: err: %v\n"</span>, err)
    },
    GotFirstResponseByte: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        fmt.Println(<span class="hljs-string">"GotFirstResponseByte"</span>)
    },
}

req, _ := http.NewRequest(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"https://example.com"</span>, <span class="hljs-literal">nil</span>)
req = req.WithContext(httptrace.WithClientTrace(req.Context(), trace))
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">gRPC è¿æ¥ï¼šé‡ç”¨ + èƒŒå‹</h3>
<p><strong>æˆ‘ä»¬çš„é…ç½®å®è·µ</strong>ï¼š</p>
<p><strong>æ¡†æ¶å·¥å…·å‚è€ƒ</strong>ï¼š</p>
<ul>
<li><strong>Kitex</strong> ä¸ <strong>Kratos</strong> éƒ½æä¾›äº†å°è£…å¥½çš„ gRPC å®¢æˆ·ç«¯ï¼Œç®€åŒ–äº†è¿æ¥æ± ä¸è´Ÿè½½å‡è¡¡é…ç½®</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Kitex å®¢æˆ·ç«¯ç¤ºä¾‹</span>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"time"</span>
    <span class="hljs-string">"github.com/cloudwego/kitex/client"</span>
    <span class="hljs-string">"github.com/cloudwego/kitex/pkg/rpcinfo"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewKitexClient</span><span class="hljs-params">()</span></span> (YourServiceClient, <span class="hljs-type">error</span>) {
    c, err := NewClient(
        <span class="hljs-string">"your.service"</span>,
        client.WithHostPorts(<span class="hljs-string">"127.0.0.1:8888"</span>),
        client.WithRPCTimeout(<span class="hljs-number">500</span>*time.Millisecond),
        client.WithConnectTimeout(<span class="hljs-number">200</span>*time.Millisecond),
        client.WithClientBasicInfo(&amp;rpcinfo.EndpointBasicInfo{ServiceName: <span class="hljs-string">"your-client"</span>}),
    )
    <span class="hljs-keyword">return</span> c, err
}
</code></pre>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªé«˜æ€§èƒ½çš„ gRPC å®¢æˆ·ç«¯è¿æ¥</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewGRPCClient</span><span class="hljs-params">(addr <span class="hljs-type">string</span>)</span></span> (*grpc.ClientConn, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> grpc.Dial(addr, 
        grpc.WithTransportCredentials(insecure.NewCredentials()),
        grpc.WithKeepaliveParams(keepalive.ClientParameters{
            Time:                <span class="hljs-number">30</span> * time.Second,    <span class="hljs-comment">// å‘é€ keepalive çš„æ—¶é—´é—´éš”</span>
            Timeout:             <span class="hljs-number">5</span> * time.Second,     <span class="hljs-comment">// keepalive è¶…æ—¶æ—¶é—´</span>
            PermitWithoutStream: <span class="hljs-literal">true</span>,                <span class="hljs-comment">// å³ä½¿æ²¡æœ‰æ´»è·ƒæµä¹Ÿå‘é€ keepalive</span>
        }),
        grpc.WithDefaultCallOptions(
            grpc.MaxCallRecvMsgSize(<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">10</span>),   <span class="hljs-comment">// æœ€å¤§æ¥æ”¶æ¶ˆæ¯å¤§å°ï¼ˆ10MBï¼‰</span>
            grpc.MaxCallSendMsgSize(<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">10</span>),   <span class="hljs-comment">// æœ€å¤§å‘é€æ¶ˆæ¯å¤§å°ï¼ˆ10MBï¼‰</span>
        ),
        grpc.WithInitialWindowSize(<span class="hljs-number">65535</span>*<span class="hljs-number">10</span>),        <span class="hljs-comment">// åˆå§‹çª—å£å¤§å°</span>
        grpc.WithInitialConnWindowSize(<span class="hljs-number">65535</span>*<span class="hljs-number">100</span>),   <span class="hljs-comment">// åˆå§‹è¿æ¥çª—å£å¤§å°</span>
    )
}
</code></pre>
<p><strong>çœŸå®è°ƒä¼˜ç»éªŒ</strong>ï¼š</p>
<ul>
<li>åœ¨æˆ‘ä»¬çš„å®æ—¶æ¨èç³»ç»Ÿä¸­ï¼Œæ›¾å›  gRPC æµæ§åˆ¶é…ç½®ä¸å½“ï¼Œå¯¼è‡´å•æµå†™æ»¡ç¼“å†²åé˜»å¡äº†å…¶ä»–è¯·æ±‚</li>
<li>é€šè¿‡ç›‘æ§ <code>sent/recv message per stream</code> æŒ‡æ ‡ï¼Œæˆ‘ä»¬å‘ç°é—®é¢˜å¹¶è°ƒæ•´äº†çª—å£å¤§å°ï¼Œæœ€ç»ˆå°† P99 å»¶è¿Ÿé™ä½äº† 40%</li>
</ul>
<p><strong>èƒŒå‹å®ç°</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>grpc-go</code> çš„æµæ§åˆ¶æœºåˆ¶ï¼Œç›‘æ§ <code>inflight</code> è¯·æ±‚æ•°é‡</li>
<li>å½“ <code>inflight</code> è¯·æ±‚è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¸»åŠ¨æ‹’ç»æ–°è¯·æ±‚æˆ–è§¦å‘é™çº§</li>
</ul>
<h3 data-id="heading-10">æœåŠ¡ç«¯è°ƒä¼˜ï¼šå¤šè·¯å¤ç”¨ + é›¶æ‹·è´</h3>
<p><strong>HTTP/2 æœåŠ¡ç«¯é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP/2 æœåŠ¡å™¨</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewHTTP2Server</span><span class="hljs-params">()</span></span> *http.Server {
    <span class="hljs-keyword">return</span> &amp;http.Server{
        Addr: <span class="hljs-string">":8080"</span>,
        Handler: http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
            <span class="hljs-comment">// å¤„ç†è¯·æ±‚</span>
        }),
        TLSConfig: &amp;tls.Config{
            MinVersion: tls.VersionTLS12,
            <span class="hljs-comment">// å¯ç”¨ HTTP/2</span>
            NextProtos: []<span class="hljs-type">string</span>{<span class="hljs-string">"h2"</span>, <span class="hljs-string">"http/1.1"</span>},
        },
        ReadHeaderTimeout: <span class="hljs-number">500</span> * time.Millisecond,
        ReadTimeout:       <span class="hljs-number">2</span> * time.Second,
        WriteTimeout:      <span class="hljs-number">2</span> * time.Second,
        IdleTimeout:       <span class="hljs-number">60</span> * time.Second,
    }
}
</code></pre>
<p><strong>é›¶æ‹·è´å®è·µ</strong>ï¼š</p>
<ul>
<li>åœ¨æˆ‘ä»¬çš„é™æ€èµ„æºæœåŠ¡ä¸­ï¼Œä½¿ç”¨ <code>io.Copy</code> ä»£æ›¿æ‰‹åŠ¨è¯»å†™ï¼Œè§¦å‘å†…æ ¸é›¶æ‹·è´</li>
<li>å¯¹äºå¤§æ–‡ä»¶ä¼ è¾“ï¼Œä½¿ç”¨ <code>http.ServeFile</code> æˆ– <code>http.ServeContent</code>ï¼Œå®ƒä»¬å†…éƒ¨ä¼šä½¿ç”¨ <code>sendfile</code> ç³»ç»Ÿè°ƒç”¨</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// é›¶æ‹·è´ä¼ è¾“æ–‡ä»¶</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">serveFile</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
    file, err := os.Open(<span class="hljs-string">"path/to/file"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        http.Error(w, <span class="hljs-string">"File not found"</span>, http.StatusNotFound)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">defer</span> file.Close()
    
    stat, _ := file.Stat()
    w.Header().Set(<span class="hljs-string">"Content-Length"</span>, strconv.FormatInt(stat.Size(), <span class="hljs-number">10</span>))
    w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/octet-stream"</span>)
    
    <span class="hljs-comment">// ä½¿ç”¨ io.Copy è§¦å‘é›¶æ‹·è´</span>
    io.Copy(w, file)
}
</code></pre>
<p><strong>é˜²å¾¡æ…¢å®¢æˆ·ç«¯</strong>ï¼š</p>
<ul>
<li>è®¾ç½® <code>ReadIdleTimeout</code> å…³é—­é•¿æ—¶é—´ç©ºé—²çš„è¿æ¥</li>
<li>ä½¿ç”¨ <code>http.MaxBytesReader</code> é™åˆ¶è¯·æ±‚ä½“å¤§å°ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// é™åˆ¶è¯·æ±‚ä½“å¤§å°ä¸º 1MB</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">limitRequestBody</span><span class="hljs-params">(next http.Handler)</span></span> http.Handler {
    <span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        r.Body = http.MaxBytesReader(w, r.Body, <span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>)
        next.ServeHTTP(w, r)
    })
}
</code></pre>
<h2 data-id="heading-11">æ•°æ®ç¼–ç ä¸è´Ÿè½½è£å‰ªï¼šä¼ å¾—å¿«è¿˜è¦ä¼ å¾—å‡†</h2>
<p>æ•°æ®ç¼–ç æ˜¯é€šä¿¡æ€§èƒ½çš„å¦ä¸€ä¸ªå…³é”®å› ç´ ã€‚æˆ‘ä»¬çš„åŸåˆ™æ˜¯ï¼š<strong>åªä¼ éœ€è¦çš„ï¼Œå‹ç¼©èƒ½å‹ç¼©çš„ï¼Œé€‰æ‹©é«˜æ•ˆçš„åºåˆ—åŒ–æ ¼å¼</strong>ã€‚</p>
<h3 data-id="heading-12">åºåˆ—åŒ–æ ¼å¼é€‰æ‹©ï¼šæ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰æœ€åˆé€‚</h3>
<p><strong>æˆ‘ä»¬çš„é€‰å‹å®è·µ</strong>ï¼š</p>






























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ ¼å¼</th><th>çœŸå®æ•ˆæœ</th></tr></thead><tbody><tr><td>æ ¸å¿ƒæœåŠ¡é—´é«˜é¢‘è°ƒç”¨</td><td>ProtoBuf</td><td>æ¯” JSON å° 60%ï¼Œåºåˆ—åŒ–é€Ÿåº¦å¿« 3-5 å€</td></tr><tr><td>é¢å‘å‰ç«¯çš„ API</td><td>JSON + å­—æ®µè£å‰ª</td><td>å¹³è¡¡äº†çµæ´»æ€§å’Œæ€§èƒ½</td></tr><tr><td>å¯¹å»¶è¿Ÿæç«¯æ•æ„Ÿçš„åœºæ™¯</td><td>FlatBuffers</td><td>æ— éœ€è§£æï¼Œç›´æ¥å†…å­˜è®¿é—®ï¼Œå»¶è¿Ÿé™ä½ 50%</td></tr><tr><td>é…ç½®æ–‡ä»¶</td><td>JSON/YAML</td><td>å¯è¯»æ€§ä¼˜å…ˆï¼Œç»´æŠ¤æˆæœ¬ä½</td></tr></tbody></table>
<p><strong>å¼€æºå·¥å…·æ¨è</strong>ï¼š</p>
<ul>
<li><code>github.com/json-iterator/go</code>ï¼ˆjsoniterï¼‰ï¼šæ¯”æ ‡å‡†åº“ <code>encoding/json</code> å¿« 2-3 å€ï¼ŒAPI å…¼å®¹</li>
<li><code>github.com/bytedance/sonic</code>ï¼šå­—èŠ‚è·³åŠ¨å¼€æºçš„ JSON åº“ï¼Œæ¯” jsoniter æ›´å¿«ï¼ˆä½† API ä¸å®Œå…¨å…¼å®¹ï¼‰</li>
<li><code>github.com/golang/protobuf</code>ï¼šå®˜æ–¹ ProtoBuf åº“</li>
<li><code>github.com/google/flatbuffers/go</code>ï¼šFlatBuffers çš„ Go å®ç°</li>
</ul>
<h3 data-id="heading-13">å­—æ®µè£å‰ªï¼šåªä¼ éœ€è¦çš„æ•°æ®</h3>
<p><strong>ProtoBuf ä¸­çš„å­—æ®µè£å‰ª</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>oneof</code> ä»£æ›¿å¯é€‰å­—æ®µï¼Œå‡å°‘ç¼–ç å¼€é”€</li>
<li>ä½¿ç”¨ <code>map</code> å­˜å‚¨åŠ¨æ€å­—æ®µï¼Œé¿å…å®šä¹‰è¿‡å¤šå¯é€‰å­—æ®µ</li>
<li>åœ¨ <code>.proto</code> æ–‡ä»¶ä¸­ä½¿ç”¨ <code>reserved</code> æ ‡è®°ä¸å†ä½¿ç”¨çš„å­—æ®µï¼Œé˜²æ­¢è¯¯ç”¨</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-proto" lang="proto">// ä¸æ¨èï¼šè¿‡å¤šå¯é€‰å­—æ®µ
message User {
    string id = 1;
    string name = 2;
    optional int32 age = 3;
    optional string email = 4;
    optional string phone = 5;
    // ... æ›´å¤šå¯é€‰å­—æ®µ
}

// æ¨èï¼šä½¿ç”¨ oneof å’Œ map
message User {
    string id = 1;
    string name = 2;
    oneof contact {
        string email = 3;
        string phone = 4;
    }
    map&lt;string, string&gt; extra_info = 5;
}
</code></pre>
<p><strong>REST API ä¸­çš„å­—æ®µè£å‰ª</strong>ï¼š</p>
<ul>
<li>æ”¯æŒ <code>fields=id,name,email</code> æŸ¥è¯¢å‚æ•°ï¼Œåªè¿”å›æŒ‡å®šå­—æ®µ</li>
<li>åœ¨æˆ‘ä»¬çš„ç”¨æˆ·ä¸­å¿ƒ API ä¸­ï¼Œå®ç°å­—æ®µè£å‰ªåï¼Œå“åº”å¤§å°å‡å°‘äº† 40%ï¼ŒQPS æå‡äº† 25%</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// å­—æ®µè£å‰ªä¸­é—´ä»¶</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fieldSelector</span><span class="hljs-params">(next http.Handler)</span></span> http.Handler {
    <span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        fields := r.URL.Query().Get(<span class="hljs-string">"fields"</span>)
        <span class="hljs-keyword">if</span> fields == <span class="hljs-string">""</span> {
            next.ServeHTTP(w, r)
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// è®°å½•éœ€è¦è¿”å›çš„å­—æ®µ</span>
        requiredFields := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">bool</span>)
        <span class="hljs-keyword">for</span> _, field := <span class="hljs-keyword">range</span> strings.Split(fields, <span class="hljs-string">","</span>) {
            requiredFields[strings.TrimSpace(field)] = <span class="hljs-literal">true</span>
        }
        
        <span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰ ResponseWriter æ‹¦æˆªå“åº”å¹¶è£å‰ªå­—æ®µ</span>
        crw := &amp;customResponseWriter{ResponseWriter: w, fields: requiredFields}
        next.ServeHTTP(crw, r)
    })
}
</code></pre>
<h3 data-id="heading-14">å‹ç¼©ç­–ç•¥ï¼šå¹³è¡¡CPUå’Œå¸¦å®½</h3>
<p><strong>æˆ‘ä»¬çš„å‹ç¼©å®è·µ</strong>ï¼š</p>
<ul>
<li>å¯¹äºå°äº 1KB çš„æ¶ˆæ¯ï¼Œä¸å¯ç”¨å‹ç¼©ï¼ˆå‹ç¼©å¼€é”€å¯èƒ½è¶…è¿‡æ”¶ç›Šï¼‰</li>
<li>å¯¹äºå¤§äº 1KB çš„æ¶ˆæ¯ï¼Œä½¿ç”¨ gzip æˆ– brotli å‹ç¼©</li>
<li>åœ¨ gRPC ä¸­ï¼Œä½¿ç”¨ <code>grpc.UseCompressor("gzip")</code> å¯ç”¨å‹ç¼©</li>
</ul>
<p><strong>gRPC å‹ç¼©é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// å®¢æˆ·ç«¯å¯ç”¨ gzip å‹ç¼©</span>
conn, err := grpc.Dial(addr, 
    grpc.WithTransportCredentials(insecure.NewCredentials()),
    grpc.WithDefaultCallOptions(
        grpc.UseCompressor(<span class="hljs-string">"gzip"</span>),
        grpc.MaxCallRecvMsgSize(<span class="hljs-number">10</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>),
    ),
)

<span class="hljs-comment">// æœåŠ¡ç«¯å¯ç”¨ gzip å‹ç¼©</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"google.golang.org/grpc/encoding/gzip"</span>

srv := grpc.NewServer(
    grpc.RPCCompressor(gzip.GzipCompressor),
)
</code></pre>
<p><strong>HTTP å‹ç¼©é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ä½¿ç”¨ net/http å¯ç”¨ gzip å‹ç¼©</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/klauspost/compress/gzhttp"</span>

mux := http.NewServeMux()
mux.HandleFunc(<span class="hljs-string">"/"</span>, handler)

<span class="hljs-comment">// ä½¿ç”¨ gzhttp åŒ…è£… handlerï¼Œè‡ªåŠ¨å¤„ç†å‹ç¼©</span>
compressedHandler := gzhttp.GzipHandler(mux)

srv := &amp;http.Server{
    Addr:    <span class="hljs-string">":8080"</span>,
    Handler: compressedHandler,
}
</code></pre>
<h3 data-id="heading-15">åºåˆ—åŒ–ç¼“å­˜ï¼šé¿å…é‡å¤å·¥ä½œ</h3>
<p><strong>æˆ‘ä»¬çš„ç¼“å­˜å®è·µ</strong>ï¼š</p>
<ul>
<li>åœ¨çƒ­è·¯å¾„ä¸Šï¼Œç¼“å­˜åºåˆ—åŒ–åçš„ <code>[]byte</code> ç»“æœ</li>
<li>ä½¿ç”¨ <code>sync.Pool</code> å¤ç”¨åºåˆ—åŒ–ç¼“å†²åŒºï¼Œå‡å°‘å†…å­˜åˆ†é…</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ç¼“å­˜åºåˆ—åŒ–ç»“æœ</span>
<span class="hljs-keyword">type</span> CachedSerializer <span class="hljs-keyword">struct</span> {
    cache sync.Map <span class="hljs-comment">// key: ç»“æ„ä½“æŒ‡é’ˆ, value: []byte</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cs *CachedSerializer)</span></span> Marshal(v <span class="hljs-keyword">interface</span>{}) ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>) {
    key := reflect.ValueOf(v).Pointer()
    <span class="hljs-keyword">if</span> data, ok := cs.cache.Load(key); ok {
        <span class="hljs-keyword">return</span> data.([]<span class="hljs-type">byte</span>), <span class="hljs-literal">nil</span>
    }
    
    data, err := jsoniter.Marshal(v)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    cs.cache.Store(key, data)
    <span class="hljs-keyword">return</span> data, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// ä½¿ç”¨ sync.Pool å¤ç”¨ç¼“å†²åŒº</span>
<span class="hljs-keyword">var</span> bufferPool = sync.Pool{
    New: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">interface</span>{} {
        <span class="hljs-keyword">return</span> &amp;bytes.Buffer{}
    },
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MarshalWithPool</span><span class="hljs-params">(v <span class="hljs-keyword">interface</span>{})</span></span> ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>) {
    buf := bufferPool.Get().(*bytes.Buffer)
    buf.Reset()
    <span class="hljs-keyword">defer</span> bufferPool.Put(buf)
    
    <span class="hljs-keyword">if</span> err := jsoniter.NewEncoder(buf).Encode(v); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">append</span>([]<span class="hljs-type">byte</span>{}, buf.Bytes()...), <span class="hljs-literal">nil</span>
}
</code></pre>
<h3 data-id="heading-16">å¹‚ç­‰è®¾è®¡ï¼šé¿å…é‡è¯•å‰¯ä½œç”¨</h3>
<p><strong>æˆ‘ä»¬çš„å¹‚ç­‰å®è·µ</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰å†™æ“ä½œéƒ½å¿…é¡»æ”¯æŒå¹‚ç­‰</li>
<li>ä½¿ç”¨ä¸šåŠ¡å¹‚ç­‰é”®ï¼ˆå¦‚å†…å®¹IDã€è¯·æ±‚æµæ°´å·ï¼‰ç¡®ä¿é‡å¤è¯·æ±‚ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨</li>
<li>åœ¨æœåŠ¡ç«¯ä½¿ç”¨ Redis <code>SETNX</code> æˆ–æ•°æ®åº“å”¯ä¸€çº¦æŸå®ç°å¹‚ç­‰æ€§</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// å¹‚ç­‰å¤„ç†å™¨</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">idempotentHandler</span><span class="hljs-params">(redisClient *redis.Client)</span></span> http.HandlerFunc {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        <span class="hljs-comment">// ä»è¯·æ±‚å¤´è·å–å¹‚ç­‰é”®</span>
        idempotencyKey := r.Header.Get(<span class="hljs-string">"X-Idempotency-Key"</span>)
        <span class="hljs-keyword">if</span> idempotencyKey == <span class="hljs-string">""</span> {
            http.Error(w, <span class="hljs-string">"Missing X-Idempotency-Key"</span>, http.StatusBadRequest)
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²ç»å¤„ç†è¿‡</span>
        key := fmt.Sprintf(<span class="hljs-string">"idempotent:%s"</span>, idempotencyKey)
        exists, err := redisClient.Exists(r.Context(), key).Result()
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            http.Error(w, <span class="hljs-string">"Internal Server Error"</span>, http.StatusInternalServerError)
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-keyword">if</span> exists == <span class="hljs-number">1</span> {
            <span class="hljs-comment">// å·²ç»å¤„ç†è¿‡ï¼Œç›´æ¥è¿”å›ç»“æœ</span>
            w.WriteHeader(http.StatusOK)
            w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">"Already processed"</span>))
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// æ‰§è¡Œå®é™…ä¸šåŠ¡é€»è¾‘</span>
        <span class="hljs-comment">// ...</span>
        
        <span class="hljs-comment">// æ ‡è®°ä¸ºå·²å¤„ç†ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´</span>
        redisClient.Set(r.Context(), key, <span class="hljs-string">"processed"</span>, <span class="hljs-number">24</span>*time.Hour)
        
        w.WriteHeader(http.StatusOK)
        w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">"Success"</span>))
    }
}
</code></pre>
<h2 data-id="heading-17">è°ƒä¼˜å››è±¡é™ï¼šå»¶è¿Ÿã€ååã€æˆæœ¬ã€å¯é æ€§</h2>
<p>åœ¨å®é™…è°ƒä¼˜ä¸­ï¼Œæˆ‘ä»¬å‘ç°å»¶è¿Ÿã€ååã€æˆæœ¬å’Œå¯é æ€§å¾€å¾€ç›¸äº’åˆ¶çº¦ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨å®è·µä¸­æ€»ç»“çš„è°ƒä¼˜æŒ‡å—ï¼ŒåŒ…å«çœŸå®æ¡ˆä¾‹å’Œå¯æ“ä½œçš„å»ºè®®ã€‚</p>
<h3 data-id="heading-18">å»¶è¿Ÿä¼˜åŒ–ï¼šä»æ¯«ç§’åˆ°å¾®ç§’çš„çªç ´</h3>
<p><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼šå‡å°‘ç½‘ç»œå¾€è¿”ã€ä¼˜åŒ–åè®®æ ˆã€é™ä½åºåˆ—åŒ–å¼€é”€ã€‚</p>
<p><strong>æˆ‘ä»¬çš„å»¶è¿Ÿä¼˜åŒ–å®è·µ</strong>ï¼š</p>



































<table><thead><tr><th>ä¼˜åŒ–é¡¹</th><th>å…·ä½“æªæ–½</th><th>çœŸå®æ•ˆæœ</th></tr></thead><tbody><tr><td>åè®®å‡çº§</td><td>ä» HTTP/1.1 å‡çº§åˆ° gRPC</td><td>å»¶è¿Ÿé™ä½ 40%</td></tr><tr><td>è¿æ¥å¤ç”¨</td><td>ä¼˜åŒ– HTTP è¿æ¥æ± é…ç½®</td><td>TLS æ¡æ‰‹æ¬¡æ•°å‡å°‘ 95%</td></tr><tr><td>åºåˆ—åŒ–ä¼˜åŒ–</td><td>ä» JSON åˆ‡æ¢åˆ° ProtoBuf</td><td>åºåˆ—åŒ–æ—¶é—´å‡å°‘ 70%</td></tr><tr><td>ä¸­é—´ä»¶ä¼˜åŒ–</td><td>ç§»é™¤ä¸å¿…è¦çš„è°ƒè¯•ä¸­é—´ä»¶</td><td>å»¶è¿Ÿé™ä½ 15%</td></tr><tr><td>åœ°åŸŸä¼˜åŒ–</td><td>é¿å…è·¨ AZ è°ƒç”¨</td><td>å»¶è¿Ÿé™ä½ 30%</td></tr></tbody></table>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ä½¿ç”¨ context.WithTimeout è®¾ç½®è°ƒç”¨è¶…æ—¶</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">callService</span><span class="hljs-params">(ctx context.Context, client ServiceClient, req *Request)</span></span> (*Response, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// è®¾ç½® 500ms è¶…æ—¶</span>
    timeoutCtx, cancel := context.WithTimeout(ctx, <span class="hljs-number">500</span>*time.Millisecond)
    <span class="hljs-keyword">defer</span> cancel()
    
    <span class="hljs-comment">// åœ¨æ–°çš„è¶…æ—¶ä¸Šä¸‹æ–‡ä¸‹æ‰§è¡Œè°ƒç”¨</span>
    <span class="hljs-keyword">return</span> client.Call(timeoutCtx, req)
}

<span class="hljs-comment">// ä¼˜åŒ– gRPC å®¢æˆ·ç«¯å»¶è¿Ÿé…ç½®</span>
conn, err := grpc.Dial(addr, 
    grpc.WithTransportCredentials(insecure.NewCredentials()),
    grpc.WithDefaultCallOptions(
        grpc.WaitForReady(<span class="hljs-literal">true</span>), <span class="hljs-comment">// ç­‰å¾…æœåŠ¡å°±ç»ª</span>
        grpc.PerRPCCredentials(credentials.NewTLS(tlsConfig)),
        grpc.WithCompressor(<span class="hljs-string">"gzip"</span>),
    ),
    grpc.WithUnaryInterceptor(grpc_retry.UnaryClientInterceptor(
        grpc_retry.WithMax(<span class="hljs-number">3</span>),
        grpc_retry.WithBackoff(grpc_retry.BackoffExponential(<span class="hljs-number">100</span>*time.Millisecond)),
    )),
)
</code></pre>
<h3 data-id="heading-19">ååä¼˜åŒ–ï¼šä»åƒçº§åˆ°ä¸‡çº§çš„è·¨è¶Š</h3>
<p><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼šå¢åŠ å¹¶å‘åº¦ã€ä¼˜åŒ–èµ„æºåˆ©ç”¨ã€å‡å°‘é”ç«äº‰ã€‚</p>
<p><strong>æˆ‘ä»¬çš„ååä¼˜åŒ–å®è·µ</strong>ï¼š</p>



































<table><thead><tr><th>ä¼˜åŒ–é¡¹</th><th>å…·ä½“æªæ–½</th><th>çœŸå®æ•ˆæœ</th></tr></thead><tbody><tr><td>è¿æ¥æ± æ‰©å®¹</td><td>è°ƒå¤§ <code>MaxIdleConns</code> å’Œ <code>MaxConnsPerHost</code></td><td>QPS æå‡ 150%</td></tr><tr><td>å¹¶è¡Œåº¦è°ƒä¼˜</td><td>ä½¿ç”¨ <code>errgroup</code> å¹¶å‘å¤„ç†è¯·æ±‚</td><td>ååé‡æå‡ 200%</td></tr><tr><td>è´Ÿè½½å‡è¡¡</td><td>ä»è½®è¯¢åˆ‡æ¢åˆ°ä¸€è‡´æ€§å“ˆå¸Œ</td><td>çƒ­ç‚¹åˆ†å¸ƒæ›´å‡åŒ€</td></tr><tr><td>å†…å­˜ä¼˜åŒ–</td><td>ä½¿ç”¨ <code>sync.Pool</code> å¤ç”¨å¯¹è±¡</td><td>GC è€—æ—¶å‡å°‘ 60%</td></tr><tr><td>è¯·æ±‚åˆå¹¶</td><td>å®ç°æ‰¹é‡ API</td><td>ç½‘ç»œå¾€è¿”å‡å°‘ 70%</td></tr></tbody></table>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨ errgroup å¹¶å‘å¤„ç†è¯·æ±‚</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"golang.org/x/sync/errgroup"</span>

<span class="hljs-comment">// å¹¶å‘è°ƒç”¨å¤šä¸ªæœåŠ¡</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">batchCallServices</span><span class="hljs-params">(ctx context.Context, clients []ServiceClient, reqs []*Request)</span></span> ([]*Response, <span class="hljs-type">error</span>) {
    g, gCtx := errgroup.WithContext(ctx)
    respCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> *Response, <span class="hljs-built_in">len</span>(reqs))
    
    <span class="hljs-keyword">for</span> i, client := <span class="hljs-keyword">range</span> clients {
        req := reqs[i]
        g.Go(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span> {
            resp, err := client.Call(gCtx, req)
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                <span class="hljs-keyword">return</span> err
            }
            respCh &lt;- resp
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        })
    }
    
    <span class="hljs-keyword">if</span> err := g.Wait(); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-built_in">close</span>(respCh)
    
    <span class="hljs-keyword">var</span> resps []*Response
    <span class="hljs-keyword">for</span> resp := <span class="hljs-keyword">range</span> respCh {
        resps = <span class="hljs-built_in">append</span>(resps, resp)
    }
    
    <span class="hljs-keyword">return</span> resps, <span class="hljs-literal">nil</span>
}
</code></pre>
<h3 data-id="heading-20">æˆæœ¬ä¼˜åŒ–ï¼šç”¨æœ€å°‘çš„èµ„æºåŠæœ€å¤šçš„äº‹</h3>
<p><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼šåŠ¨æ€èµ„æºè°ƒæ•´ã€è¯·æ±‚åˆå¹¶ã€èµ„æºå¤ç”¨ã€‚</p>
<p><strong>æˆ‘ä»¬çš„æˆæœ¬ä¼˜åŒ–å®è·µ</strong>ï¼š</p>



































<table><thead><tr><th>ä¼˜åŒ–é¡¹</th><th>å…·ä½“æªæ–½</th><th>çœŸå®æ•ˆæœ</th></tr></thead><tbody><tr><td>åŠ¨æ€è¿æ¥æ± </td><td>æ ¹æ®è´Ÿè½½è°ƒæ•´è¿æ¥æ•°</td><td>èµ„æºåˆ©ç”¨ç‡æå‡ 80%</td></tr><tr><td>è¯·æ±‚åˆå¹¶</td><td>å®ç°æ‰¹é‡æŸ¥è¯¢ API</td><td>ç½‘ç»œæˆæœ¬é™ä½ 60%</td></tr><tr><td>èµ„æºå¤ç”¨</td><td>ä½¿ç”¨ <code>sync.Pool</code> å¤ç”¨ç¼“å†²åŒº</td><td>å†…å­˜å ç”¨å‡å°‘ 40%</td></tr><tr><td>ä½å³°æœŸç¼©å®¹</td><td>æŒ‰ä¸šåŠ¡ä½å³°æœŸé‡Šæ”¾èµ„æº</td><td>æœåŠ¡å™¨æˆæœ¬é™ä½ 30%</td></tr><tr><td>æ‰¹é‡å¤„ç†</td><td>å®ç°å¼‚æ­¥æ‰¹é‡ä»»åŠ¡</td><td>è®¡ç®—èµ„æºåˆ©ç”¨ç‡æå‡ 70%</td></tr></tbody></table>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šåŠ¨æ€è°ƒæ•´è¿æ¥æ± å¤§å°</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// åŠ¨æ€è¿æ¥æ± </span>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"log"</span>
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"sync"</span>
    <span class="hljs-string">"time"</span>
    <span class="hljs-string">"golang.org/x/time/rate"</span>
)

<span class="hljs-keyword">type</span> DynamicConnectionPool <span class="hljs-keyword">struct</span> {
    pool          *http.Client
    limiter       *rate.Limiter
    maxConn       <span class="hljs-type">int</span>
    currentConn   <span class="hljs-type">int</span>
    mu            sync.Mutex
    lastAdjustTime time.Time
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewDynamicConnectionPool</span><span class="hljs-params">(maxConn <span class="hljs-type">int</span>)</span></span> *DynamicConnectionPool {
    <span class="hljs-keyword">return</span> &amp;DynamicConnectionPool{
        pool: &amp;http.Client{
            Transport: &amp;http.Transport{
                MaxIdleConns:        maxConn,
                MaxIdleConnsPerHost: maxConn,
            },
        },
        limiter:       rate.NewLimiter(rate.Limit(maxConn), maxConn),
        maxConn:       maxConn,
        currentConn:   maxConn / <span class="hljs-number">2</span>, <span class="hljs-comment">// åˆå§‹ä¸ºæœ€å¤§è¿æ¥æ•°çš„ä¸€åŠ</span>
        lastAdjustTime: time.Now(),
    }
}

<span class="hljs-comment">// åŠ¨æ€è°ƒæ•´è¿æ¥æ± å¤§å°</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *DynamicConnectionPool)</span></span> adjustPoolSize() {
    p.mu.Lock()
    <span class="hljs-keyword">defer</span> p.mu.Unlock()
    
    <span class="hljs-comment">// æ¯ 5 åˆ†é’Ÿè°ƒæ•´ä¸€æ¬¡</span>
    <span class="hljs-keyword">if</span> time.Since(p.lastAdjustTime) &lt; <span class="hljs-number">5</span>*time.Minute {
        <span class="hljs-keyword">return</span>
    }
    
    <span class="hljs-comment">// æ ¹æ®æœ€è¿‘çš„è¯·æ±‚é€Ÿç‡è°ƒæ•´è¿æ¥æ± å¤§å°</span>
    <span class="hljs-comment">// è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥æ ¹æ®å†å²ç›‘æ§æ•°æ®</span>
    currentRate := p.limiter.Limit()
    newConn := <span class="hljs-type">int</span>(currentRate * <span class="hljs-number">1.5</span>)
    <span class="hljs-keyword">if</span> newConn &gt; p.maxConn {
        newConn = p.maxConn
    }
    <span class="hljs-keyword">if</span> newConn &lt; <span class="hljs-number">10</span> {
        newConn = <span class="hljs-number">10</span>
    }
    
    p.currentConn = newConn
    p.limiter.SetLimit(rate.Limit(newConn))
    
    <span class="hljs-comment">// æ›´æ–°è¿æ¥æ± é…ç½®</span>
    transport := p.pool.Transport.(*http.Transport)
    transport.MaxIdleConns = newConn
    transport.MaxIdleConnsPerHost = newConn
    
    p.lastAdjustTime = time.Now()
    log.Printf(<span class="hljs-string">"Adjusted connection pool size from %d to %d"</span>, <span class="hljs-type">int</span>(currentRate), newConn)
}
</code></pre>
<h3 data-id="heading-21">å¯é æ€§ä¼˜åŒ–ï¼šä»å¯ç”¨åˆ°é«˜å¯ç”¨çš„èœ•å˜</h3>
<p><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼šè¶…æ—¶æ§åˆ¶ã€é‡è¯•ç­–ç•¥ã€ç†”æ–­é™çº§ã€ç›‘æ§å‘Šè­¦ã€‚</p>
<p><strong>æˆ‘ä»¬çš„å¯é æ€§ä¼˜åŒ–å®è·µ</strong>ï¼š</p>



































<table><thead><tr><th>ä¼˜åŒ–é¡¹</th><th>å…·ä½“æªæ–½</th><th>çœŸå®æ•ˆæœ</th></tr></thead><tbody><tr><td>è¶…æ—¶æ§åˆ¶</td><td>ä¸ºæ‰€æœ‰å¤–éƒ¨è°ƒç”¨è®¾ç½®åˆç†è¶…æ—¶</td><td>é”™è¯¯ç‡é™ä½ 80%</td></tr><tr><td>é‡è¯•ç­–ç•¥</td><td>å®ç°æŒ‡æ•°é€€é¿é‡è¯•</td><td>æˆåŠŸé‡è¯•ç‡æå‡ 70%</td></tr><tr><td>ç†”æ–­é™çº§</td><td>ä½¿ç”¨ <code>hystrix-go</code> å®ç°ç†”æ–­</td><td>é›ªå´©æ•ˆåº”å®Œå…¨é¿å…</td></tr><tr><td>ç›‘æ§å‘Šè­¦</td><td>ç›‘æ§ P99 å»¶è¿Ÿå’Œé”™è¯¯ç‡</td><td>æ•…éšœå‘ç°æ—¶é—´ç¼©çŸ­ 90%</td></tr><tr><td>é™æµä¿æŠ¤</td><td>å®ç°ä»¤ç‰Œæ¡¶é™æµ</td><td>æœåŠ¡å¯ç”¨æ€§æå‡åˆ° 99.99%</td></tr></tbody></table>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨ hystrix-go å®ç°ç†”æ–­</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/afex/hystrix-go/hystrix"</span>

<span class="hljs-comment">// åˆå§‹åŒ–ç†”æ–­å™¨</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initHystrix</span><span class="hljs-params">()</span></span> {
    hystrix.ConfigureCommand(<span class="hljs-string">"service-call"</span>, hystrix.CommandConfig{
        Timeout:                <span class="hljs-number">500</span>,   <span class="hljs-comment">// 500ms è¶…æ—¶</span>
        MaxConcurrentRequests:  <span class="hljs-number">100</span>,   <span class="hljs-comment">// æœ€å¤§å¹¶å‘è¯·æ±‚æ•°</span>
        RequestVolumeThreshold: <span class="hljs-number">20</span>,    <span class="hljs-comment">// 20 ä¸ªè¯·æ±‚æ‰è§¦å‘ç»Ÿè®¡</span>
        SleepWindow:            <span class="hljs-number">5000</span>,  <span class="hljs-comment">// 5 ç§’åå°è¯•åŠå¼€</span>
        ErrorPercentThreshold:  <span class="hljs-number">50</span>,    <span class="hljs-comment">// é”™è¯¯ç‡è¶…è¿‡ 50% è§¦å‘ç†”æ–­</span>
    })
}

<span class="hljs-comment">// ä½¿ç”¨ç†”æ–­å™¨åŒ…è£…æœåŠ¡è°ƒç”¨</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">callServiceWithCircuitBreaker</span><span class="hljs-params">(ctx context.Context, client ServiceClient, req *Request)</span></span> (*Response, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">var</span> resp *Response
    err := hystrix.Do(<span class="hljs-string">"service-call"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span> {
        <span class="hljs-keyword">var</span> err <span class="hljs-type">error</span>
        resp, err = client.Call(ctx, req)
        <span class="hljs-keyword">return</span> err
    }, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(err <span class="hljs-type">error</span>)</span></span> <span class="hljs-type">error</span> {
        <span class="hljs-comment">// é™çº§é€»è¾‘ï¼šè¿”å›é»˜è®¤å€¼æˆ–é”™è¯¯</span>
        log.Printf(<span class="hljs-string">"Circuit breaker open, returning fallback: %v"</span>, err)
        <span class="hljs-keyword">return</span> err
    })
    
    <span class="hljs-keyword">return</span> resp, err
}

<span class="hljs-comment">// ä½¿ç”¨ä»¤ç‰Œæ¡¶å®ç°é™æµ</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"golang.org/x/time/rate"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">rateLimitMiddleware</span><span class="hljs-params">(limiter *rate.Limiter)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(http.Handler)</span></span> http.Handler {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(next http.Handler)</span></span> http.Handler {
        <span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
            <span class="hljs-keyword">if</span> !limiter.Allow() {
                http.Error(w, <span class="hljs-string">"Too Many Requests"</span>, http.StatusTooManyRequests)
                <span class="hljs-keyword">return</span>
            }
            next.ServeHTTP(w, r)
        })
    }
}
</code></pre>
<h2 data-id="heading-22">å·¥ç¨‹æ²»ç†ï¼šè§‚æµ‹ã€ç°åº¦ä¸æµé‡æ§åˆ¶</h2>
<p>å·¥ç¨‹æ²»ç†æ˜¯é€šä¿¡ä¼˜åŒ–çš„é‡è¦ä¿éšœï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿå‘ç°é—®é¢˜ã€éªŒè¯ä¼˜åŒ–æ•ˆæœå¹¶ç¡®ä¿æœåŠ¡çš„ç¨³å®šæ€§ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨å®è·µä¸­æ€»ç»“çš„æ²»ç†ç»éªŒã€‚</p>
<h3 data-id="heading-23">ç›‘æ§æŒ‡æ ‡ï¼šè®©æ€§èƒ½å¯è§†åŒ–</h3>
<p><strong>æ ¸å¿ƒæŒ‡æ ‡ä½“ç³»</strong>ï¼š</p>
<p><strong>æ¡†æ¶ç›‘æ§æ”¯æŒ</strong>ï¼š</p>
<ul>
<li>å›½å†…ä¸»æµæ¡†æ¶éƒ½æä¾›äº†ä¸ Prometheusã€Jaeger ç­‰ç›‘æ§ç³»ç»Ÿçš„é›†æˆèƒ½åŠ›</li>
<li><strong>Kitex</strong> å†…ç½® RPC ç›¸å…³æŒ‡æ ‡æ”¶é›†ï¼Œ<strong>Kratos</strong> æä¾›ç»Ÿä¸€çš„æŒ‡æ ‡ç»„ä»¶</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Kratos ç›‘æ§æŒ‡æ ‡ç¤ºä¾‹</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/go-kratos/kratos/v2/metrics"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initMetrics</span><span class="hljs-params">()</span></span> {
    requestCounter := metrics.NewCounter(
        <span class="hljs-string">"http_request_total"</span>,
        metrics.WithLabels(<span class="hljs-string">"method"</span>, <span class="hljs-string">"path"</span>, <span class="hljs-string">"status"</span>),
        metrics.WithDescription(<span class="hljs-string">"HTTP è¯·æ±‚æ€»æ•°"</span>),
    )
    requestCounter.Inc(<span class="hljs-number">1</span>, <span class="hljs-string">"GET"</span>, <span class="hljs-string">"/api/v1/users"</span>, <span class="hljs-string">"200"</span>)
}
- **å»¶è¿ŸæŒ‡æ ‡**ï¼šP50ã€P95ã€P99 å»¶è¿Ÿï¼Œä»¥åŠé•¿å°¾å»¶è¿Ÿåˆ†å¸ƒ
- **æµé‡æŒ‡æ ‡**ï¼šQPSã€TPSã€å¹¶å‘è¿æ¥æ•°
- **é”™è¯¯æŒ‡æ ‡**ï¼šHTTP é”™è¯¯ç‡ã€gRPC é”™è¯¯ç åˆ†å¸ƒ
- **åè®®æŒ‡æ ‡**ï¼šTLS æ¡æ‰‹æ¬¡æ•°ã€è¿æ¥å¤ç”¨ç‡ã€é‡ä¼ ç‡
- **èµ„æºæŒ‡æ ‡**ï¼šCPUã€å†…å­˜ã€å¸¦å®½ä½¿ç”¨ç‡

**å¼€æºå·¥å…·æ¨è**ï¼š
- <span class="hljs-string">`github.com/prometheus/client_golang`</span>ï¼šPrometheus å®¢æˆ·ç«¯åº“ï¼Œç”¨äºæš´éœ²æŒ‡æ ‡
- <span class="hljs-string">`github.com/uber-go/tally`</span>ï¼šUber å¼€æºçš„æŒ‡æ ‡åº“ï¼Œæ”¯æŒå¤šåç«¯
- <span class="hljs-string">`github.com/grafana/grafana`</span>ï¼šæ•°æ®å¯è§†åŒ–å¹³å°ï¼Œç”¨äºç›‘æ§é¢æ¿å±•ç¤º

**ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨ Prometheus ç›‘æ§ gRPC æœåŠ¡**
<span class="hljs-string">``</span><span class="hljs-string">`go
import (
    "github.com/prometheus/client_golang/prometheus"
    "github.com/prometheus/client_golang/prometheus/promhttp"
    "google.golang.org/grpc"
    "google.golang.org/grpc/stats"
)

// gRPC ç»Ÿè®¡æ‹¦æˆªå™¨
func newStatsHandler() stats.Handler {
    return &amp;grpcStatsHandler{
        requestDuration: prometheus.NewHistogramVec(
            prometheus.HistogramOpts{
                Name:    "grpc_request_duration_seconds",
                Help:    "gRPC request duration",
                Buckets: prometheus.DefBuckets,
            },
            []string{"method", "status"},
        ),
    }
}

// æ³¨å†ŒæŒ‡æ ‡
grpcStats := newStatsHandler()
prometheus.MustRegister(grpcStats.requestDuration)

// é…ç½® gRPC æœåŠ¡å™¨
srv := grpc.NewServer(
    grpc.StatsHandler(grpcStats),
)

// æš´éœ² Prometheus ç«¯ç‚¹
http.Handle("/metrics", promhttp.Handler())
go http.ListenAndServe(":2112", nil)
</span></code></pre>
<h3 data-id="heading-24">æ—¥å¿—ä¸è¿½è¸ªï¼šå…¨é“¾è·¯å¯è§‚æµ‹</h3>
<p><strong>æˆ‘ä»¬çš„æ—¥å¿—ä¸è¿½è¸ªå®è·µ</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>opentelemetry-go</code> ç»Ÿä¸€æ—¥å¿—ã€æŒ‡æ ‡å’Œè¿½è¸ª</li>
<li>å®ç°è¯·æ±‚å…¨é“¾è·¯è¿½è¸ªï¼Œä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯</li>
<li>ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€çš„ traceID å’Œ spanID</li>
<li>è®°å½•å…³é”®è¯·æ±‚å‚æ•°å’Œå“åº”çŠ¶æ€</li>
</ul>
<p><strong>å¼€æºå·¥å…·æ¨è</strong>ï¼š</p>
<ul>
<li><code>go.opentelemetry.io/otel</code>ï¼šOpenTelemetry Go å®¢æˆ·ç«¯</li>
<li><code>github.com/rs/zerolog</code>ï¼šé«˜æ€§èƒ½ JSON æ—¥å¿—åº“</li>
<li><code>github.com/openzipkin/zipkin-go</code>ï¼šZipkin å®¢æˆ·ç«¯åº“</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨ OpenTelemetry è¿›è¡Œå…¨é“¾è·¯è¿½è¸ª</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"go.opentelemetry.io/otel"</span>
    <span class="hljs-string">"go.opentelemetry.io/otel/exporters/zipkin"</span>
    <span class="hljs-string">"go.opentelemetry.io/otel/sdk/trace"</span>
)

<span class="hljs-comment">// åˆå§‹åŒ– OpenTelemetry</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initTracer</span><span class="hljs-params">()</span></span> (<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// åˆ›å»º Zipkin  exporter</span>
    exporter, err := zipkin.New(
        <span class="hljs-string">"http://localhost:9411/api/v2/spans"</span>,
        zipkin.WithLocalEndpoint(<span class="hljs-string">"service-name"</span>, <span class="hljs-string">"localhost:8080"</span>),
    )
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// åˆ›å»º tracer provider</span>
    provider := trace.NewTracerProvider(
        trace.WithSampler(trace.AlwaysSample()),
        trace.WithBatcher(exporter),
    )
    
    <span class="hljs-comment">// è®¾ç½®å…¨å±€ tracer provider</span>
    otel.SetTracerProvider(provider)
    
    <span class="hljs-comment">// è¿”å›æ¸…ç†å‡½æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        provider.Shutdown(context.Background())
    }, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// ä½¿ç”¨è¿½è¸ªåŒ…è£… gRPC å®¢æˆ·ç«¯è°ƒç”¨</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">tracedGRPCCall</span><span class="hljs-params">(ctx context.Context, client ServiceClient, req *Request)</span></span> (*Response, <span class="hljs-type">error</span>) {
    tracer := otel.Tracer(<span class="hljs-string">"service"</span>)
    ctx, span := tracer.Start(ctx, <span class="hljs-string">"call-service"</span>)
    <span class="hljs-keyword">defer</span> span.End()
    
    <span class="hljs-comment">// æ·»åŠ å±æ€§</span>
    span.SetAttributes(
        attribute.String(<span class="hljs-string">"service.method"</span>, <span class="hljs-string">"Service.Call"</span>),
        attribute.String(<span class="hljs-string">"request.id"</span>, req.ID),
    )
    
    <span class="hljs-comment">// æ‰§è¡Œè°ƒç”¨</span>
    resp, err := client.Call(ctx, req)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        span.RecordError(err)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-keyword">return</span> resp, <span class="hljs-literal">nil</span>
}
</code></pre>
<h3 data-id="heading-25">ç°åº¦ä¸æµé‡æ§åˆ¶ï¼šå®‰å…¨åœ°éªŒè¯ä¼˜åŒ–</h3>
<p><strong>ç°åº¦å‘å¸ƒç­–ç•¥</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>istio</code> æˆ– <code>linkerd</code> å®ç°æµé‡é•œåƒå’Œç°åº¦å‘å¸ƒ</li>
<li>æŒ‰ç”¨æˆ·ã€åœ°åŸŸã€æƒé‡ç­‰ç»´åº¦åˆ†é…æµé‡</li>
<li>è®¾ç½®å›æ»šæœºåˆ¶ï¼Œç¡®ä¿å‡ºç°é—®é¢˜æ—¶èƒ½å¿«é€Ÿæ¢å¤</li>
</ul>
<p><strong>æµé‡æ§åˆ¶å®è·µ</strong>ï¼š</p>
<ul>
<li>å®ç°ä»¤ç‰Œæ¡¶é™æµï¼Œé˜²æ­¢çªå‘æµé‡å†²å‡»</li>
<li>ä½¿ç”¨ç†”æ–­å™¨ä¿æŠ¤ä¸‹æ¸¸æœåŠ¡</li>
<li>å®ç°è¯·æ±‚ä¼˜å…ˆçº§ï¼Œç¡®ä¿æ ¸å¿ƒä¸šåŠ¡ä¸å—å½±å“</li>
</ul>
<p><strong>å¼€æºå·¥å…·æ¨è</strong>ï¼š</p>
<ul>
<li><code>github.com/istio/istio</code>ï¼šæœåŠ¡ç½‘æ ¼ï¼Œç”¨äºæµé‡ç®¡ç†å’Œç°åº¦å‘å¸ƒ</li>
<li><code>github.com/envoyproxy/go-control-plane</code>ï¼šEnvoy æ§åˆ¶å¹³é¢ï¼Œç”¨äºåŠ¨æ€é…ç½®</li>
<li><code>github.com/ulule/limiter</code>ï¼šé™æµåº“ï¼Œæ”¯æŒå¤šç§ç®—æ³•</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨ istioctl è¿›è¡Œç°åº¦å‘å¸ƒ</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºç›®æ ‡è§„åˆ™</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: service-destination
spec:
  host: service.default.svc.cluster.local
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2'</span> | kubectl apply -f -

<span class="hljs-comment"># åˆ›å»ºè™šæ‹ŸæœåŠ¡ï¼Œå°† 10% æµé‡è·¯ç”±åˆ° v2</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: service-virtual

spec:
  hosts:
  - service.default.svc.cluster.local
  http:
  - route:
    - destination:
        host: service.default.svc.cluster.local
        subset: v1
      weight: 90
    - destination:
        host: service.default.svc.cluster.local
        subset: v2
      weight: 10'</span> | kubectl apply -f -
</code></pre>
<h3 data-id="heading-26">è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šç¡®ä¿ä¼˜åŒ–çš„è´¨é‡</h3>
<p><strong>æ€§èƒ½æµ‹è¯•ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>github.com/loadimpact/k6</code> æˆ– <code>github.com/gatling/gatling</code> è¿›è¡Œè´Ÿè½½æµ‹è¯•</li>
<li>æ¨¡æ‹ŸçœŸå®çš„ç”¨æˆ·è¡Œä¸ºå’Œæµé‡æ¨¡å¼</li>
<li>å…³æ³¨ P99 å»¶è¿Ÿå’Œé”™è¯¯ç‡ç­‰å…³é”®æŒ‡æ ‡</li>
</ul>
<p><strong>æ··æ²Œå·¥ç¨‹å®è·µ</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>github.com/Netflix/chaosmonkey</code> æˆ– <code>github.com/chaos-mesh/chaos-mesh</code> è¿›è¡Œæ•…éšœæ³¨å…¥</li>
<li>æµ‹è¯•æœåŠ¡åœ¨ç½‘ç»œå»¶è¿Ÿã€èŠ‚ç‚¹æ•…éšœç­‰æƒ…å†µä¸‹çš„è¡¨ç°</li>
<li>éªŒè¯ç†”æ–­ã€é‡è¯•ç­‰æœºåˆ¶çš„æœ‰æ•ˆæ€§</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨ k6 è¿›è¡Œæ€§èƒ½æµ‹è¯•</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'k6/http'</span>;
<span class="hljs-keyword">import</span> { check, sleep } <span class="hljs-keyword">from</span> <span class="hljs-string">'k6'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> options = {
    <span class="hljs-attr">stages</span>: [
        { <span class="hljs-attr">duration</span>: <span class="hljs-string">'30s'</span>, <span class="hljs-attr">target</span>: <span class="hljs-number">100</span> },  <span class="hljs-comment">// é€æ­¥å¢åŠ åˆ° 100 å¹¶å‘</span>
        { <span class="hljs-attr">duration</span>: <span class="hljs-string">'1m'</span>, <span class="hljs-attr">target</span>: <span class="hljs-number">100</span> },   <span class="hljs-comment">// ä¿æŒ 100 å¹¶å‘</span>
        { <span class="hljs-attr">duration</span>: <span class="hljs-string">'30s'</span>, <span class="hljs-attr">target</span>: <span class="hljs-number">200</span> },  <span class="hljs-comment">// é€æ­¥å¢åŠ åˆ° 200 å¹¶å‘</span>
        { <span class="hljs-attr">duration</span>: <span class="hljs-string">'1m'</span>, <span class="hljs-attr">target</span>: <span class="hljs-number">200</span> },   <span class="hljs-comment">// ä¿æŒ 200 å¹¶å‘</span>
        { <span class="hljs-attr">duration</span>: <span class="hljs-string">'30s'</span>, <span class="hljs-attr">target</span>: <span class="hljs-number">0</span> },    <span class="hljs-comment">// é€æ­¥å‡å°‘åˆ° 0 å¹¶å‘</span>
    ],
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> res = http.<span class="hljs-title function_">get</span>(<span class="hljs-string">'http://localhost:8080/api/v1/users/1'</span>);
    <span class="hljs-title function_">check</span>(res, {
        <span class="hljs-string">'status is 200'</span>: <span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>,
        <span class="hljs-string">'response time &lt; 50ms'</span>: <span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-property">timings</span>.<span class="hljs-property">duration</span> &lt; <span class="hljs-number">50</span>,
    });
    <span class="hljs-title function_">sleep</span>(<span class="hljs-number">1</span>);
}
</code></pre>
<h2 data-id="heading-27">æ¡ˆä¾‹ä¸€ï¼šè·¨åŒºåŸŸåº“å­˜ç³»ç»Ÿçš„åè®®æ¼”è¿›</h2>
<p><strong>èƒŒæ™¯</strong>ï¼šæˆ‘ä»¬çš„ç”µå•†åº“å­˜ä¸­å¿ƒåŸä½¿ç”¨ REST + JSON è¿›è¡Œè·¨åŒºåŸŸåº“å­˜åŒæ­¥ï¼Œå­˜åœ¨ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼šè·¨åŒºåŸŸåŒæ­¥æ—¶å»¶é«˜ï¼ˆå¹³å‡420msï¼‰ã€å¸¦å®½å ç”¨å¤§ï¼ˆæ¯å¤©è·¨åŒºåŸŸæµé‡è¶…è¿‡10TBï¼‰ã€‚</p>
<p><strong>ç­–ç•¥</strong>ï¼šç»è¿‡è¯„ä¼°ï¼Œæˆ‘ä»¬å†³å®šè¿ç§»åˆ° gRPCï¼Œæ‹†åˆ†ä¸º <code>ListDelta</code>ã€<code>ApplyDelta</code> ä¸¤ç±»æ¥å£ï¼Œå¹¶å¼•å…¥ streaming ä¼ è¾“æ‰¹é‡æ›´æ–°ï¼Œä»¥å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ã€‚</p>
<p><strong>è°ƒä¼˜æ­¥éª¤</strong>ï¼š</p>
<ol>
<li><strong>ç¼–ç ä¼˜åŒ–</strong>ï¼šå°†åº“å­˜ç»“æ„è½¬ä¸º ProtoBufï¼Œå‡å°‘äº† 60% çš„æŠ¥æ–‡ä½“ç§¯ã€‚ä¾‹å¦‚ï¼ŒåŸæ¥çš„ JSON æ ¼å¼åº“å­˜è®°å½•çº¦ 200 å­—èŠ‚ï¼Œè½¬æ¢åä»… 80 å­—èŠ‚ã€‚</li>
<li><strong>è¿æ¥ç®¡ç†</strong>ï¼šæ¯ä¸ªè¾¹ç¼˜èŠ‚ç‚¹ä¸ä¸­å¿ƒä¿æŒ 4 æ¡é•¿è¿æ¥ï¼Œå¯ç”¨ <code>keepalive</code> ä¸å¥åº·æ¢é’ˆï¼Œç¡®ä¿è¿æ¥ç¨³å®šæ€§ã€‚</li>
<li><strong>ç›‘æ§ä¸å›æ»š</strong>ï¼šä½¿ç”¨ <code>otelcol</code> æ”¶é›†å»¶è¿Ÿæ ·æœ¬ï¼Œè®¾ç½® P99 è¶…è¿‡ 150ms å³è‡ªåŠ¨å›æ»šçš„ç­–ç•¥ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§ã€‚</li>
</ol>
<p><strong>ç»“æœ</strong>ï¼šåŒºåŸŸåŒæ­¥å»¶è¿Ÿä» 420ms é™è‡³ 130msï¼Œè·¨åŒºåŸŸå¸¦å®½ä¸‹é™è¿‘ä¸€åŠï¼ˆæ¯å¤©çº¦ 5.5TBï¼‰ï¼Œç³»ç»Ÿç¨³å®šè¿è¡Œä¸‰ä¸ªæœˆæœªå‡ºç°å¤§è§„æ¨¡è¶…æ—¶ã€‚</p>
<h2 data-id="heading-28">æ¡ˆä¾‹äºŒï¼šé£æ§å›è°ƒçš„å¹‚ç­‰ä¸é™æµæ”¹é€ </h2>
<p><strong>èƒŒæ™¯</strong>ï¼šé£æ§å¹³å°é€šè¿‡ HTTP å›è°ƒé€šçŸ¥å¤šä¸ªä¸šåŠ¡çº¿ï¼Œä½†ç”±äºä¸‹æ¸¸æœåŠ¡å¶å°”è¶…æ—¶ï¼Œå¯¼è‡´é£æ§ç³»ç»Ÿå‘èµ·æµ·é‡é‡è¯•ï¼Œæœ€ç»ˆå¼•å‘æ¥å£é›ªå´©ï¼ŒæˆåŠŸç‡ä¸€åº¦é™è‡³ 50% ä»¥ä¸‹ã€‚</p>
<p><strong>ç­–ç•¥</strong>ï¼šè€ƒè™‘åˆ°ä¸šåŠ¡çº¿çš„æŠ€æœ¯æ ˆå¤šæ ·æ€§ï¼Œæˆ‘ä»¬å†³å®šä¿ç•™ HTTP/1.1 åè®®ï¼Œä½†å¼ºåŒ–å®¢æˆ·ç«¯é™æµä¸å¹‚ç­‰æ€§è®¾è®¡ã€‚</p>
<p><strong>è°ƒä¼˜æ­¥éª¤</strong>ï¼š</p>
<ol>
<li><strong>å¹‚ç­‰æ€§è®¾è®¡</strong>ï¼šå¼•å…¥ <code>X-Event-Id</code> ä½œä¸ºå¹‚ç­‰é”®ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨ Redis <code>SETNX</code> å‘½ä»¤é˜²æ­¢é‡å¤æ‰§è¡Œï¼Œç¡®ä¿åŒä¸€äº‹ä»¶åªä¼šè¢«å¤„ç†ä¸€æ¬¡ã€‚</li>
<li><strong>é™æµä¸é‡è¯•</strong>ï¼šå®¢æˆ·ç«¯å¼•å…¥ <code>golang.org/x/time/rate</code> å®ç°ä»¤ç‰Œæ¡¶é™æµï¼Œå¹¶é‡‡ç”¨æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥ï¼›å°†è¶…æ—¶æ—¶é—´è®¾ä¸º 200ms å¹¶è®¾ç½®é‡è¯•ä¸Šé™ï¼ˆæœ€å¤š3æ¬¡ï¼‰ã€‚</li>
<li><strong>æ‰¹é‡ç¡®è®¤</strong>ï¼šå¢åŠ  <code>/ack</code> æ¥å£ï¼Œæ”¯æŒä¸€æ¬¡ç¡®è®¤å¤šæ¡å›è°ƒï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ã€‚</li>
<li><strong>è§‚æµ‹ä¸ç°åº¦</strong>ï¼šç°åº¦é˜¶æ®µå¯ç”¨ <code>otelhttp</code> ä¸­é—´ä»¶ï¼ŒæŒ‰ç§Ÿæˆ·æ‹†åˆ†æŒ‡æ ‡ï¼Œå®æ—¶ç›‘æ§å„ä¸šåŠ¡çº¿çš„è°ƒç”¨æƒ…å†µã€‚</li>
</ol>
<p><strong>ç»“æœ</strong>ï¼šé«˜å³°æœŸè°ƒç”¨æˆåŠŸç‡æå‡è‡³ 99.7%ï¼Œé™æµç”Ÿæ•ˆåæœªå†è§¦å‘ç½‘å…³ç†”æ–­ï¼Œç³»ç»Ÿç¨³å®šæ€§æ˜¾è‘—æå‡ã€‚</p>
<h2 data-id="heading-29">æ’æŸ¥æ¸…å•ï¼šé€šä¿¡é“¾è·¯å‡ºé—®é¢˜æ—¶å…ˆçœ‹ä»€ä¹ˆ</h2>
<p>å½“é€šä¿¡é“¾è·¯å‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿›è¡Œæ’æŸ¥ï¼š</p>
<ol>
<li><strong>è¿æ¥æ•°æš´æ¶¨</strong>ï¼šæ£€æŸ¥æ˜¯å¦å…³é—­äº† Keep-Alive æˆ–çˆ†å‘é‡è¯•ï¼›å®¡è®¡ <code>MaxIdleConns</code> å’Œ <code>MaxConnsPerHost</code> é…ç½®ã€‚</li>
<li><strong>å»¶è¿Ÿé•¿å°¾</strong>ï¼šç¡®è®¤æ˜¯å¦å­˜åœ¨æ…¢ Resolver æˆ–å•è¿æ¥å¤šè·¯å¤ç”¨å µå¡ï¼›ä½¿ç”¨ <code>tcpdump</code> å…³æ³¨ <code>tcp retrans</code> æŒ‡æ ‡ã€‚</li>
<li><strong>å¸¦å®½é£™å‡</strong>ï¼šæ’æŸ¥æ˜¯å¦å¯ç”¨äº†å‹ç¼©ã€å­—æ®µè£å‰ªï¼›å®¡æŸ¥å¤§å¯¹è±¡ä¼ è¾“ï¼Œè€ƒè™‘æ˜¯å¦éœ€è¦åˆ†é¡µæˆ–åˆ†æ‰¹å¤„ç†ã€‚</li>
<li><strong>é‡è¯•é£æš´</strong>ï¼šè§‚å¯Ÿè¶…æ—¶ä¸é‡è¯•ç­–ç•¥æ˜¯å¦åŒ¹é…ï¼›é˜²æ­¢æœ¬æœåŠ¡ä¸ç½‘å…³åŒé‡é‡è¯•ï¼Œé¿å…é›ªå´©æ•ˆåº”ã€‚</li>
<li><strong>SSL é”™è¯¯é›†ä¸­</strong>ï¼šæ ¡éªŒè¯ä¹¦æœ‰æ•ˆæœŸã€SNI é…ç½®ï¼›å¼€å¯ OCSP Stapling ç¼“è§£è¯ä¹¦éªŒè¯æ…¢çš„é—®é¢˜ã€‚</li>
</ol>
<h2 data-id="heading-30">éªŒæ”¶æ¸…å•ï¼šä¸Šçº¿å‰é€æ¡ç¡®è®¤</h2>
<p>åœ¨é€šä¿¡ä¼˜åŒ–ä¸Šçº¿å‰ï¼Œæˆ‘ä»¬ä¼šé€æ¡ç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š</p>
<ol>
<li><strong>åè®®é€‰æ‹©</strong>ï¼šæœ‰é‡åŒ–ä¾æ®ï¼Œå¹¶è®°å½•åœ¨ ADRï¼ˆArchitecture Decision Recordï¼‰ä¸­ï¼Œç¡®ä¿å›¢é˜Ÿå…±è¯†ã€‚</li>
<li><strong>é…ç½®å¯¹é½</strong>ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è¶…æ—¶ã€é‡è¯•ã€é™æµã€ç†”æ–­é…ç½®å·²å¯¹é½ï¼Œé¿å…é…ç½®ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ã€‚</li>
<li><strong>ç›‘æ§è¦†ç›–</strong>ï¼šç›‘æ§è¦†ç›–é“¾è·¯å…³é”®é˜¶æ®µï¼Œå»¶è¿Ÿåˆ†ä½ä¸é”™è¯¯ç±»å‹å‡æœ‰å‘Šè­¦ï¼Œç¡®ä¿é—®é¢˜å¯åŠæ—¶å‘ç°ã€‚</li>
<li><strong>å‹æµ‹éªŒè¯</strong>ï¼šåŒ…æ‹¬çªå‘æµé‡ã€è·¨å¯ç”¨åŒºã€æ…¢ä¸‹æ¸¸ä¸‰ç±»åœºæ™¯ï¼ŒéªŒè¯ç³»ç»Ÿåœ¨æç«¯æƒ…å†µä¸‹çš„è¡¨ç°ã€‚</li>
<li><strong>å›æ»šè·¯å¾„</strong>ï¼šæ˜ç¡®å›æ»šè·¯å¾„ï¼Œèƒ½åœ¨ååˆ†é’Ÿå†…æ¢å¤æ—§åè®®ï¼Œé™ä½é£é™©ã€‚</li>
</ol>
<h2 data-id="heading-31">æ€»ç»“ï¼šé€šä¿¡ä¼˜åŒ–çš„æ ¸å¿ƒåŸåˆ™</h2>
<ol>
<li><strong>åè®®åŒ¹é…åœºæ™¯</strong>ï¼šæ ¸å¿ƒæœåŠ¡ç”¨ gRPC/Kitexï¼Œå…¬å¼€ API ç”¨ HTTP/Hertzï¼Œå¼‚æ­¥ç”¨æ¶ˆæ¯é˜Ÿåˆ—</li>
<li><strong>è¿æ¥æ± æ˜¯åŸºç¡€</strong>ï¼šåˆç†é…ç½® <code>MaxIdleConns</code> å’Œ <code>MaxIdleConnsPerHost</code>ï¼Œæˆ–ç›´æ¥ä½¿ç”¨æ¡†æ¶é»˜è®¤ä¼˜åŒ–é…ç½®</li>
<li><strong>æ•°æ®ä¼ è¾“ç²¾ç˜¦åŒ–</strong>ï¼šä¼˜å…ˆä½¿ç”¨ ProtoBufï¼Œå®ç°å­—æ®µè£å‰ªï¼ŒæŒ‰éœ€å¯ç”¨å‹ç¼©</li>
<li><strong>ç³»ç»Ÿå…·å¤‡å¼¹æ€§</strong>ï¼šå®ç°è¶…æ—¶æ§åˆ¶ã€æ™ºèƒ½é‡è¯•ã€ç†”æ–­å’Œé™æµæœºåˆ¶</li>
<li><strong>æ²»ç†æŒç»­ä¼˜åŒ–</strong>ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»ï¼Œé€šè¿‡ç°åº¦å‘å¸ƒéªŒè¯ä¼˜åŒ–æ•ˆæœ</li>
</ol>
<p><strong>æ¡†æ¶é€‰æ‹©å‚è€ƒ</strong>ï¼š</p>
<ul>
<li>é«˜æ€§èƒ½ HTTP æœåŠ¡ï¼šè€ƒè™‘ Hertz</li>
<li>é«˜æ€§èƒ½ RPC åœºæ™¯ï¼šè€ƒè™‘ Kitex</li>
<li>å®Œæ•´å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼šè€ƒè™‘ Kratos</li>
</ul>
<p>å›½å†…æ¡†æ¶åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ç»è¿‡éªŒè¯ï¼Œèƒ½æœ‰æ•ˆç®€åŒ–é€šä¿¡å±‚çš„é…ç½®ä¸ä¼˜åŒ–å·¥ä½œã€‚</p>
<p>é€šè¿‡è¿™äº›å®è·µï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªé«˜æ•ˆã€ç¨³å®šã€å¯ç»´æŠ¤çš„å¾®æœåŠ¡é€šä¿¡ç³»ç»Ÿï¼Œä¸ºä¸šåŠ¡çš„å¿«é€Ÿå‘å±•æä¾›å¯é çš„æŠ€æœ¯æ”¯æ’‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python é¥¼å›¾å…¥é—¨ï¼š3 è¡Œä»£ç å±•ç¤ºæ•°æ®å æ¯”]]></title>    <link>https://juejin.cn/post/7577690150092767272</link>    <guid>https://juejin.cn/post/7577690150092767272</guid>    <pubDate>2025-11-29T15:19:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577690150092767272" data-draft-id="7576187677839392783" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python é¥¼å›¾å…¥é—¨ï¼š3 è¡Œä»£ç å±•ç¤ºæ•°æ®å æ¯”"/> <meta itemprop="keywords" content="åç«¯,Python"/> <meta itemprop="datePublished" content="2025-11-29T15:19:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MOMOé™ŒæŸ“"/> <meta itemprop="url" content="https://juejin.cn/user/546920729166618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python é¥¼å›¾å…¥é—¨ï¼š3 è¡Œä»£ç å±•ç¤ºæ•°æ®å æ¯”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/546920729166618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MOMOé™ŒæŸ“
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T15:19:09.000Z" title="Sat Nov 29 2025 15:19:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>é¥¼å›¾çš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>ç›´è§‚å‘ˆç°å„éƒ¨åˆ†æ•°æ®å æ€»ä½“çš„æ¯”ä¾‹å…³ç³»</strong>ï¼ˆæ¯”å¦‚ä¸åŒäº§å“çš„å¸‚åœºä»½é¢ã€å®¶åº­å¼€æ”¯æ„æˆã€ç­çº§æˆç»©ç­‰çº§åˆ†å¸ƒç­‰ï¼‰ï¼Œé€šè¿‡æ‰‡å½¢çš„å¤§å°å¯¹æ¯”ï¼Œèƒ½å¿«é€Ÿçœ‹å‡º â€œè°å æ¯”æœ€é«˜â€â€œè°å æ¯”æœ€ä½â€ã€‚å€ŸåŠ©<code>matplotlib</code>åº“ï¼Œæ–°æ‰‹ä¹Ÿèƒ½è½»æ¾ç”¨ Python ç”»å‡ºæ¸…æ™°çš„é¥¼å›¾ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å‡†å¤‡å·¥ä½œï¼šå®‰è£…å¹¶å¯¼å…¥åº“</h2>
<p>å’Œä¹‹å‰çš„æŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ã€æ•£ç‚¹å›¾ä¸€è‡´ï¼Œæ ¸å¿ƒä¾èµ–<code>matplotlib</code>åº“ï¼Œè‹¥æœªå®‰è£…ï¼Œæ‰“å¼€ç»ˆç«¯ / å‘½ä»¤æç¤ºç¬¦è¾“å…¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pip install matplotlib
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œåœ¨ä»£ç ä¸­å¯¼å…¥åº“ï¼ˆæƒ¯ä¾‹ç®€å†™ä¸º<code>plt</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
</code></pre>
<h2 data-id="heading-1">äºŒã€æœ€åŸºç¡€çš„é¥¼å›¾ï¼š3 è¡Œæ ¸å¿ƒä»£ç </h2>
<p>æˆ‘ä»¬ä»¥ â€œæŸå®¶åº­ monthly å¼€æ”¯æ„æˆâ€ ä¸ºä¾‹ï¼Œæ‰‹æŠŠæ‰‹å®ç°ç¬¬ä¸€ä¸ªé¥¼å›¾ã€‚</p>
<h3 data-id="heading-2">æ­¥éª¤ 1ï¼šå‡†å¤‡æ•°æ®</h3>
<p>å®šä¹‰ä¸¤ä¸ªåˆ—è¡¨ï¼Œå¯¹åº” â€œåˆ†ç±»æ•°æ®â€ï¼ˆæ¯”å¦‚å¼€æ”¯é¡¹ç›®ï¼‰å’Œ â€œå¯¹åº”å æ¯” / æ•°å€¼â€ï¼ˆæ¯”å¦‚å¼€æ”¯é‡‘é¢ï¼Œé¥¼å›¾ä¼šè‡ªåŠ¨è®¡ç®—å æ¯”ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åˆ†ç±»æ•°æ®ï¼ˆé¥¼å›¾çš„å„éƒ¨åˆ†åç§°ï¼‰</span>
expenses = [<span class="hljs-string">"æˆ¿ç§Ÿ"</span>, <span class="hljs-string">"é¤é¥®"</span>, <span class="hljs-string">"äº¤é€š"</span>, <span class="hljs-string">"å¨±ä¹"</span>, <span class="hljs-string">"å…¶ä»–"</span>]
<span class="hljs-comment"># å¯¹åº”æ•°å€¼ï¼ˆå¯ç›´æ¥ç”¨é‡‘é¢ï¼Œé¥¼å›¾è‡ªåŠ¨è®¡ç®—å æ¯”ï¼‰</span>
amounts = [<span class="hljs-number">3500</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">800</span>, <span class="hljs-number">1200</span>, <span class="hljs-number">500</span>]
</code></pre>
<h3 data-id="heading-3">æ­¥éª¤ 2ï¼šç»˜åˆ¶é¥¼å›¾</h3>
<p>ç”¨<code>plt.pie()</code>å‡½æ•°ç»˜åˆ¶ï¼Œæ ¸å¿ƒå‚æ•°æ˜¯<code>æ•°å€¼æ•°æ®</code>å’Œ<code>åˆ†ç±»æ ‡ç­¾</code>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç»˜åˆ¶é¥¼å›¾ï¼ˆæ ¸å¿ƒä»£ç ï¼‰</span>
plt.pie(amounts, labels=expenses)
</code></pre>
<h3 data-id="heading-4">æ­¥éª¤ 3ï¼šæ˜¾ç¤ºå›¾è¡¨</h3>
<p>ç”¨<code>plt.show()</code>å±•ç¤ºç»˜åˆ¶ç»“æœï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ˜¾ç¤ºå›¾è¡¨</span>
plt.show()
</code></pre>
<h3 data-id="heading-5">å®Œæ•´ä»£ç ï¼ˆç›´æ¥è¿è¡Œå¯ç”¨ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. å‡†å¤‡æ•°æ®</span>
expenses = [<span class="hljs-string">"æˆ¿ç§Ÿ"</span>, <span class="hljs-string">"é¤é¥®"</span>, <span class="hljs-string">"äº¤é€š"</span>, <span class="hljs-string">"å¨±ä¹"</span>, <span class="hljs-string">"å…¶ä»–"</span>]  <span class="hljs-comment"># åˆ†ç±»æ ‡ç­¾</span>
amounts = [<span class="hljs-number">3500</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">800</span>, <span class="hljs-number">1200</span>, <span class="hljs-number">500</span>]  <span class="hljs-comment"># å¯¹åº”æ•°å€¼ï¼ˆé‡‘é¢/æ•°é‡ï¼‰</span>

<span class="hljs-comment"># 2. ç»˜åˆ¶é¥¼å›¾</span>
plt.pie(amounts, labels=expenses)

<span class="hljs-comment"># 3. æ˜¾ç¤ºå›¾è¡¨</span>
plt.show()
</code></pre>
<h2 data-id="heading-6">ä¸‰ã€ç®€å•ä¼˜åŒ–ï¼šè®©å æ¯”æ›´æ¸…æ™°</h2>
<p>åŸºç¡€é¥¼å›¾å¯ä»¥æ·»åŠ  â€œå æ¯”ç™¾åˆ†æ¯”â€â€œé¢œè‰²åŒºåˆ†â€â€œçªå‡ºæŸéƒ¨åˆ†â€ï¼Œè®©å›¾è¡¨æ›´ä¸“ä¸šï¼Œè¡¥å…… 3 è¡Œä»£ç å³å¯ï¼š</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

expenses = [<span class="hljs-string">"æˆ¿ç§Ÿ"</span>, <span class="hljs-string">"é¤é¥®"</span>, <span class="hljs-string">"äº¤é€š"</span>, <span class="hljs-string">"å¨±ä¹"</span>, <span class="hljs-string">"å…¶ä»–"</span>]
amounts = [<span class="hljs-number">3500</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">800</span>, <span class="hljs-number">1200</span>, <span class="hljs-number">500</span>]

<span class="hljs-comment"># å®šä¹‰é¢œè‰²åˆ—è¡¨ï¼ˆå¯é€‰ï¼Œè®©å„éƒ¨åˆ†æ›´æ˜“åŒºåˆ†ï¼‰</span>
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>]
<span class="hljs-comment"># çªå‡ºæŸéƒ¨åˆ†ï¼ˆæ¯”å¦‚çªå‡ºå æ¯”æœ€é«˜çš„æˆ¿ç§Ÿï¼Œexplodeå‚æ•°æ§åˆ¶åç§»è·ç¦»ï¼‰</span>
explode = (<span class="hljs-number">0.1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)

<span class="hljs-comment"># ç»˜åˆ¶é¥¼å›¾ï¼šæ·»åŠ ç™¾åˆ†æ¯”ã€é¢œè‰²ã€çªå‡ºæ•ˆæœã€æ–‡æœ¬æ ¼å¼</span>
plt.pie(
    amounts,
    labels=expenses,
    colors=colors,
    explode=explode,
    autopct=<span class="hljs-string">"%1.1f%%"</span>,  <span class="hljs-comment"># æ˜¾ç¤ºå æ¯”ç™¾åˆ†æ¯”ï¼ˆä¿ç•™1ä½å°æ•°ï¼‰</span>
    startangle=<span class="hljs-number">90</span>  <span class="hljs-comment"># é¥¼å›¾èµ·å§‹è§’åº¦ï¼ˆ90åº¦=ä»æ­£ä¸Šæ–¹å¼€å§‹ï¼‰</span>
)
plt.title(<span class="hljs-string">"æŸå®¶åº­æœˆåº¦å¼€æ”¯æ„æˆå›¾"</span>)  <span class="hljs-comment"># å›¾è¡¨æ ‡é¢˜</span>
plt.axis(<span class="hljs-string">"equal"</span>)  <span class="hljs-comment"># ä¿è¯é¥¼å›¾æ˜¯æ­£åœ†å½¢ï¼ˆé¿å…é»˜è®¤æ¤­åœ†ï¼‰</span>

plt.show()
</code></pre>
<h2 data-id="heading-7">å››ã€å…³é”®å‡½æ•°è¯´æ˜ï¼ˆæ–°æ‰‹å¿…è®°ï¼‰</h2>






























<table><thead><tr><th>å‡½æ•°</th><th>ä½œç”¨</th><th>å¸¸ç”¨å‚æ•°</th></tr></thead><tbody><tr><td><code>plt.pie(x)</code></td><td>ç»˜åˆ¶é¥¼å›¾ï¼ˆæ ¸å¿ƒï¼‰</td><td>x = æ•°å€¼æ•°æ®ï¼›labels = åˆ†ç±»æ ‡ç­¾ï¼›colors = é¢œè‰²åˆ—è¡¨ï¼›explode = çªå‡ºæ•ˆæœï¼ˆå…ƒç»„ï¼Œå¯¹åº”æ¯ä¸ªéƒ¨åˆ†çš„åç§»é‡ï¼‰ï¼›autopct = ç™¾åˆ†æ¯”æ ¼å¼ï¼ˆå¦‚ "%1.1f%%"= ä¿ç•™ 1 ä½å°æ•°ï¼‰ï¼›startangle = èµ·å§‹è§’åº¦</td></tr><tr><td><code>plt.title()</code></td><td>è®¾ç½®å›¾è¡¨æ ‡é¢˜</td><td>å­—ç¬¦ä¸²ï¼ˆå¦‚ "æœˆåº¦å¼€æ”¯æ„æˆ"ï¼‰</td></tr><tr><td><code>plt.axis("equal")</code></td><td>ä¿è¯é¥¼å›¾ä¸ºæ­£åœ†å½¢</td><td>å›ºå®šå‚æ•° "equal"ï¼Œå¿…åŠ ï¼ˆå¦åˆ™å¯èƒ½æ˜¯æ¤­åœ†ï¼‰</td></tr><tr><td><code>plt.show()</code></td><td>æ˜¾ç¤ºå›¾è¡¨</td><td>æ— </td></tr></tbody></table>
<h2 data-id="heading-8">äº”ã€å¸¸è§åº”ç”¨åœºæ™¯</h2>
<p>é¥¼å›¾çš„æ ¸å¿ƒæ˜¯ â€œå±•ç¤ºå æ¯”â€ï¼Œé€‚åˆè¿™äº›åœºæ™¯ï¼š</p>
<ol>
<li>æ„æˆåˆ†æï¼šå…¬å¸è¥æ”¶æ„æˆã€äº§å“å¸‚åœºä»½é¢ã€ç­çº§å­¦ç”Ÿæ€§åˆ«æ¯”ä¾‹</li>
<li>èµ„æºåˆ†é…ï¼šé¡¹ç›®é¢„ç®—åˆ†é…ã€æ—¶é—´åˆ©ç”¨å æ¯”ã€åº“å­˜å“ç±»å æ¯”</li>
<li>å±‚çº§å±•ç¤ºï¼šæŸæŒ‡æ ‡ä¸‹å„å­ç±»åˆ«å æ€»ä½“çš„æ¯”ä¾‹ï¼ˆæ¯”å¦‚æ€»é”€å”®é¢ä¸­å„åŒºåŸŸçš„å æ¯”ï¼‰</li>
<li>æ³¨æ„ï¼šåˆ†ç±»ä¸å®œè¿‡å¤šï¼ˆå»ºè®®ä¸è¶…è¿‡ 6 ç±»ï¼‰ï¼Œå¦åˆ™æ‰‡å½¢å¤ªå°ï¼Œå¯è¯»æ€§å˜å·®</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[antdæ¸å˜è‰²è¾¹æ¡†æŒ‰é’®]]></title>    <link>https://juejin.cn/post/7577705544874459174</link>    <guid>https://juejin.cn/post/7577705544874459174</guid>    <pubDate>2025-11-29T10:32:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577705544874459174" data-draft-id="7577691061032812590" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="antdæ¸å˜è‰²è¾¹æ¡†æŒ‰é’®"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-29T10:32:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘å‘å‘å‘å‘¢"/> <meta itemprop="url" content="https://juejin.cn/user/2436173499753037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            antdæ¸å˜è‰²è¾¹æ¡†æŒ‰é’®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173499753037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘å‘å‘å‘å‘¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T10:32:23.000Z" title="Sat Nov 29 2025 10:32:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç›´æ¥è´´ä»£ç æŠŠæ–¹ä¾¿ï¼Œæ˜é‡‘çš„å†™ä»£ç æ·»åŠ ä¾èµ–å¤ªéº»çƒ¦äº†</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> styled <span class="hljs-keyword">from</span> <span class="hljs-string">'styled-components'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> { v4 } <span class="hljs-keyword">from</span> <span class="hljs-string">'uuid'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ButtonProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">SizeType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd/lib/config-provider/SizeContext'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">LinearGradientProps</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">colors</span>: <span class="hljs-built_in">string</span>[];
  direction?: <span class="hljs-string">'to right'</span> | <span class="hljs-string">'to left'</span> | <span class="hljs-string">'to top'</span> | <span class="hljs-string">'to bottom'</span> | <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">angleToCoordinates</span>(<span class="hljs-params">angleDeg: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-comment">// å°†è§’åº¦è½¬æ¢ä¸ºå¼§åº¦</span>
  <span class="hljs-keyword">const</span> angleRad = angleDeg * (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>);

  <span class="hljs-comment">// è®¡ç®—ç»ˆç‚¹åæ ‡ (èµ·ç‚¹å›ºå®šä¸º [0,0])</span>
  <span class="hljs-comment">// ä½¿ç”¨å•ä½åœ†ä¸Šçš„ç‚¹ï¼Œé•¿åº¦=1</span>
  <span class="hljs-keyword">const</span> x = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angleRad);
  <span class="hljs-keyword">const</span> y = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angleRad);

  <span class="hljs-comment">// å°†åæ ‡è½¬æ¢ä¸ºç™¾åˆ†æ¯”å­—ç¬¦ä¸²</span>
  <span class="hljs-comment">// SVG æ¸å˜åæ ‡å¯ä»¥æ˜¯è´Ÿæ•°æˆ–å¤§äº100%</span>
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">x1</span>: <span class="hljs-string">'0%'</span>,
    <span class="hljs-attr">y1</span>: <span class="hljs-string">'0%'</span>,
    <span class="hljs-attr">x2</span>: <span class="hljs-string">`<span class="hljs-subst">${(x * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>)}</span>%`</span>,
    <span class="hljs-attr">y2</span>: <span class="hljs-string">`<span class="hljs-subst">${(y * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>)}</span>%`</span>
  };
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">LinearGradientComponent</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">LinearGradientProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ id, colors, direction = <span class="hljs-string">'to right'</span> }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getCoordinates</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// å¤„ç†æ•°å­—è§’åº¦å€¼ (å¦‚ 150deg)</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> direction === <span class="hljs-string">'number'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">angleToCoordinates</span>(direction);
    }

    <span class="hljs-comment">// å¤„ç†å­—ç¬¦ä¸²è§’åº¦å€¼ (å¦‚ "150deg")</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> direction === <span class="hljs-string">'string'</span> &amp;&amp; direction.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'deg'</span>)) {
      <span class="hljs-keyword">const</span> angle = <span class="hljs-built_in">parseFloat</span>(direction);
      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isNaN</span>(angle)) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">angleToCoordinates</span>(angle);
      }
    }

    <span class="hljs-comment">// å¤„ç†å…³é”®è¯æ–¹å‘</span>
    <span class="hljs-keyword">switch</span> (direction) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'to right'</span>:
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">x1</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">y1</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">x2</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">y2</span>: <span class="hljs-string">'0%'</span> };
      <span class="hljs-keyword">case</span> <span class="hljs-string">'to left'</span>:
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">x1</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">y1</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">x2</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">y2</span>: <span class="hljs-string">'0%'</span> };
      <span class="hljs-keyword">case</span> <span class="hljs-string">'to top'</span>:
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">x1</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">y1</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">x2</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">y2</span>: <span class="hljs-string">'0%'</span> };
      <span class="hljs-keyword">case</span> <span class="hljs-string">'to bottom'</span>:
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">x1</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">y1</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">x2</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">y2</span>: <span class="hljs-string">'100%'</span> };
      <span class="hljs-keyword">case</span> <span class="hljs-string">'to top right'</span>:
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">x1</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">y1</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">x2</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">y2</span>: <span class="hljs-string">'0%'</span> };
      <span class="hljs-keyword">case</span> <span class="hljs-string">'to bottom left'</span>:
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">x1</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">y1</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">x2</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">y2</span>: <span class="hljs-string">'100%'</span> };
      <span class="hljs-attr">default</span>:
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">x1</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">y1</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">x2</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">y2</span>: <span class="hljs-string">'0%'</span> };
    }
  };

  <span class="hljs-keyword">const</span> { x1, y1, x2, y2 } = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getCoordinates</span>(), [direction]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">linearGradient</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{id}</span> <span class="hljs-attr">x1</span>=<span class="hljs-string">{x1}</span> <span class="hljs-attr">y1</span>=<span class="hljs-string">{y1}</span> <span class="hljs-attr">x2</span>=<span class="hljs-string">{x2}</span> <span class="hljs-attr">y2</span>=<span class="hljs-string">{y2}</span>&gt;</span>
      {colors.map((color, index) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">stop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span> <span class="hljs-attr">offset</span>=<span class="hljs-string">{</span>`${(<span class="hljs-attr">index</span> / (<span class="hljs-attr">colors.length</span> <span class="hljs-attr">-</span> <span class="hljs-attr">1</span>)) * <span class="hljs-attr">100</span>}%`} <span class="hljs-attr">stopColor</span>=<span class="hljs-string">{color}</span> /&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">linearGradient</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = {
  <span class="hljs-attr">linear</span>: <span class="hljs-built_in">string</span>;
  hoverIconColor?: <span class="hljs-built_in">string</span>;
} &amp; <span class="hljs-title class_">ButtonProps</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">SvgButton</span> = <span class="hljs-title function_">styled</span>(<span class="hljs-title class_">Button</span>) &lt;{ disabled?: <span class="hljs-built_in">boolean</span>; <span class="hljs-attr">linear</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">linearid</span>: <span class="hljs-built_in">string</span> }&gt;<span class="hljs-string">`
  &amp;.ant-btn-variant-outlined:not(:disabled):not(.ant-btn-disabled) {
    --ant-button-default-hover-bg: transparent;
    background: transparent;
  }
  width: 100%;
  height: 100%;
  background: transparent;
  border: none;
  padding: 0;
  cursor: <span class="hljs-subst">${({ disabled }) =&gt; (disabled ? <span class="hljs-string">'not-allowed'</span> : <span class="hljs-string">'pointer'</span>)}</span>;
  outline: none;

  background-clip: text;
  color: transparent;
  fill: transparent;
  background-image: <span class="hljs-subst">${({ linear }) =&gt; linear}</span>;
  p {
    color: #9980df;
  }
  svg {
    fill: url(#<span class="hljs-subst">${({ linearid }) =&gt; linearid}</span>);
  }
`</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">SvgButtonWrapper</span> = styled.<span class="hljs-property">div</span>&lt;{ size?: <span class="hljs-title class_">SizeType</span> }&gt;<span class="hljs-string">`
  --ant-control-height: 32px;
  --font-size: 14px;

  &amp;.button-size-large {
    --ant-control-height: 40px;
    --font-size: 16px;
  }
  &amp;.button-size-small {
    --ant-control-height: 24px;
    --font-size: 12px;
  }

  display: inline-block;
  position: relative;
  height: var(--ant-control-height);
  width: fit-content;

  &amp; &gt; svg {
    position: absolute;
    z-index: 0;
    pointer-events: none;

    &amp; &gt; rect {
      transition: fill 0.3s;
    }
  }

  &amp;[aria-disabled='false'] {
    &amp;:hover {
      &amp; &gt; svg &gt; rect:last-child {
        fill: transparent;
      }

      <span class="hljs-subst">${SvgButton}</span> {
        color: #000;
        background-clip: unset;
        background-image: unset;

        p {
          color: <span class="hljs-subst">${({ theme }) =&gt; theme.same}</span>;
        }

        svg {
          fill: <span class="hljs-subst">${({ theme }) =&gt; theme.same}</span>;
        }
      }
    }
  }
  &amp;[aria-disabled='true'] {
    opacity: 0.5;
  }
`</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LinearButton</span>(<span class="hljs-params">{ linear, children, size, disabled, loading, ...buttonProps }: Props</span>) {
  <span class="hljs-keyword">const</span> colors = <span class="hljs-title function_">useMemo</span>(
    <span class="hljs-function">() =&gt;</span>
      linear.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/#(?:[a-f0-9]{3}|[a-f0-9]{6})\b|rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(?:,\s*[\d.]+\s*)?\)/gi</span>) || [],
    [linear]
  );
  <span class="hljs-keyword">const</span> deg = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> linear.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/[0-9]deg/</span>)?.[<span class="hljs-number">0</span>] || <span class="hljs-string">''</span>, [linear]);

  <span class="hljs-keyword">const</span> linearId = <span class="hljs-title function_">useMemo</span>(
    <span class="hljs-function">() =&gt;</span>
      <span class="hljs-string">`<span class="hljs-subst">${v4({
        random: <span class="hljs-built_in">Uint8Array</span>.<span class="hljs-keyword">from</span>(linear)
      })}</span>`</span>,
    []
  );

  <span class="hljs-keyword">const</span> buttonRef = useRef&lt;<span class="hljs-title class_">HTMLButtonElement</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [contentSize, setContentSize] = useState&lt;{ <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span> }&gt;(
    buttonRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">getBoundingClientRect</span>() || { <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">32</span> }
  );

  <span class="hljs-keyword">const</span> handle = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (buttonRef.<span class="hljs-property">current</span>) {
      <span class="hljs-title function_">setContentSize</span>(buttonRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>());
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">setTimeout</span>(handle, <span class="hljs-number">100</span>);
    }
  }, []);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">handle</span>();
  }, [children, buttonProps.<span class="hljs-property">icon</span>]);

  <span class="hljs-keyword">return</span> (
    <span class="hljs-comment">// ä½¿ç”¨svgåšèƒŒæ™¯ï¼ŒæŒ‰é’®èƒŒæ™¯ç»Ÿä¸€é€æ˜ï¼Œé¿å…æ¯”ä¾‹å½±å“ã€è¾¹æ¡†é”¯é½¿ç­‰é—®é¢˜</span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SvgButtonWrapper</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">button-size-</span>${<span class="hljs-attr">size</span> || '<span class="hljs-attr">default</span>'}`} <span class="hljs-attr">aria-disabled</span>=<span class="hljs-string">{!!disabled}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>
        <span class="hljs-attr">width</span>=<span class="hljs-string">"100%"</span>
        <span class="hljs-attr">height</span>=<span class="hljs-string">"100%"</span>
        <span class="hljs-attr">viewBox</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">0</span> <span class="hljs-attr">0</span> ${<span class="hljs-attr">contentSize.width</span>} ${<span class="hljs-attr">contentSize.height</span>}`}
        <span class="hljs-attr">preserveAspectRatio</span>=<span class="hljs-string">"none"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">defs</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">LinearGradientComponent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{linearId}</span> <span class="hljs-attr">colors</span>=<span class="hljs-string">{[...colors]}</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">{deg}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">defs</span>&gt;</span>

        {/* èƒŒæ™¯è¾¹æ¡† */}
        <span class="hljs-tag">&lt;<span class="hljs-name">rect</span>
          <span class="hljs-attr">x</span>=<span class="hljs-string">"1"</span>
          <span class="hljs-attr">y</span>=<span class="hljs-string">"1"</span>
          <span class="hljs-attr">width</span>=<span class="hljs-string">{Math.max(contentSize.width</span> <span class="hljs-attr">-</span> <span class="hljs-attr">2</span>, <span class="hljs-attr">0</span>)}
          <span class="hljs-attr">height</span>=<span class="hljs-string">{Math.max(contentSize.height</span> <span class="hljs-attr">-</span> <span class="hljs-attr">2</span>, <span class="hljs-attr">0</span>)}
          <span class="hljs-attr">rx</span>=<span class="hljs-string">{Math.max(contentSize.height</span> / <span class="hljs-attr">2</span>, <span class="hljs-attr">0</span>)}
          <span class="hljs-attr">ry</span>=<span class="hljs-string">{Math.max(contentSize.height</span> / <span class="hljs-attr">2</span>, <span class="hljs-attr">0</span>)}
          <span class="hljs-attr">fill</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">url</span>(#${<span class="hljs-attr">linearId</span>})`}
          <span class="hljs-attr">stroke</span>=<span class="hljs-string">"none"</span>
        /&gt;</span>

        {/* å†…éƒ¨å¡«å…… */}
        <span class="hljs-tag">&lt;<span class="hljs-name">rect</span>
          <span class="hljs-attr">x</span>=<span class="hljs-string">"2"</span>
          <span class="hljs-attr">y</span>=<span class="hljs-string">"2"</span>
          <span class="hljs-attr">width</span>=<span class="hljs-string">{Math.max(contentSize.width</span> <span class="hljs-attr">-</span> <span class="hljs-attr">4</span>, <span class="hljs-attr">0</span>)}
          <span class="hljs-attr">height</span>=<span class="hljs-string">{Math.max(contentSize.height</span> <span class="hljs-attr">-</span> <span class="hljs-attr">4</span>, <span class="hljs-attr">0</span>)}
          <span class="hljs-attr">rx</span>=<span class="hljs-string">{Math.max(contentSize.height</span> / <span class="hljs-attr">2</span> <span class="hljs-attr">-</span> <span class="hljs-attr">2</span>, <span class="hljs-attr">0</span>)}
          <span class="hljs-attr">ry</span>=<span class="hljs-string">{Math.max(contentSize.height</span> / <span class="hljs-attr">2</span> <span class="hljs-attr">-</span> <span class="hljs-attr">2</span>, <span class="hljs-attr">0</span>)}
          <span class="hljs-attr">fill</span>=<span class="hljs-string">{disabled</span> ? '#<span class="hljs-attr">050505</span>' <span class="hljs-attr">:</span> '#<span class="hljs-attr">000</span>'}
          <span class="hljs-attr">stroke</span>=<span class="hljs-string">"none"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>

      {/* å®é™…å¯ç‚¹å‡»çš„æŒ‰é’® */}
      <span class="hljs-tag">&lt;<span class="hljs-name">SvgButton</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">{buttonRef}</span>
        <span class="hljs-attr">linear</span>=<span class="hljs-string">{linear}</span>
        <span class="hljs-attr">size</span>=<span class="hljs-string">{size}</span>
        <span class="hljs-attr">linearid</span>=<span class="hljs-string">{linearId}</span>
        <span class="hljs-attr">disabled</span>=<span class="hljs-string">{!!disabled</span> || !!<span class="hljs-attr">loading</span>}
        {<span class="hljs-attr">...buttonProps</span>}
      &gt;</span>
        {children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">SvgButton</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">SvgButtonWrapper</span>&gt;</span></span>
  );
}
</code></pre>
<p>æŒ‰é’®åŠ æ¸å˜è¾¹æ¡†ä¸»è¦éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜</p>
<ol>
<li>ä¸åŒåˆ†è¾¨ç‡ä¸‹ä¼šå‡ºç°è¾¹æ¡†æ¶ˆå¤±æˆ–è§†è§‰ä¸ç­‰çš„æƒ…å†µ</li>
<li>å¦‚ä½•ç»™æ–‡æœ¬å’Œsvgå›¾æ ‡åŠ ä¸Šæ¸å˜</li>
</ol>
<p>æ‰€ä»¥ä¹Ÿå°è¯•è¿‡ä½¿ç”¨borderæˆ–è€…æ¸å˜èƒŒæ™¯çš„æ–¹æ¡ˆï¼Œæœ€åè¿˜æ˜¯é€‰æ‹©svgæ¸²æŸ“èƒŒæ™¯ï¼Œä½¿ç”¨çš„å›¾æ ‡ä¹Ÿéœ€è¦æ˜¯svgçš„ï¼Œhoveråçš„æ•ˆæœæ ¹æ®ä¸»é¢˜æ¥éšä¾¿æ”¹ã€‚å®¹å™¨çš„å¤§å°æ˜¯é€šè¿‡contentSizeè®¡ç®—æ›´æ–°ä¸Šå»çš„ï¼Œborderé»˜è®¤å°±æ˜¯2pxï¼Œä»£ç ä¸Šå¯ä»¥å†™çš„å†æ•´æ´ä¸€ç‚¹</p>
<h2 data-id="heading-0">æ•ˆæœ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2939afa1b0794eaf8ca57d3998f8eb1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGQ5ZGQ5ZGQ5ZGQ5ZGi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765017143&amp;x-signature=1pEO0cxOUjwU8%2B80xQJc0s%2FUf8U%3D" alt="output.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue ä¸­ nextTick çš„é­”æ³•ï¼šä¸ºä»€ä¹ˆå®ƒèƒ½æ‹¿åˆ°æ›´æ–°åçš„ DOMï¼Ÿ]]></title>    <link>https://juejin.cn/post/7577693903017967642</link>    <guid>https://juejin.cn/post/7577693903017967642</guid>    <pubDate>2025-11-29T10:37:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577693903017967642" data-draft-id="7577693903017951258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue ä¸­ nextTick çš„é­”æ³•ï¼šä¸ºä»€ä¹ˆå®ƒèƒ½æ‹¿åˆ°æ›´æ–°åçš„ DOMï¼Ÿ"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-11-29T10:37:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue ä¸­ nextTick çš„é­”æ³•ï¼šä¸ºä»€ä¹ˆå®ƒèƒ½æ‹¿åˆ°æ›´æ–°åçš„ DOMï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T10:37:22.000Z" title="Sat Nov 29 2025 10:37:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue ä¸­ nextTick çš„é­”æ³•ï¼šä¸ºä»€ä¹ˆå®ƒèƒ½æ‹¿åˆ°æ›´æ–°åçš„ DOMï¼Ÿ</h2>
<blockquote>
<p>æ·±å…¥ç†è§£ Vue å¼‚æ­¥æ›´æ–°æœºåˆ¶çš„æ ¸å¿ƒ</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ä¸ªä»¤äººå›°æƒ‘çš„åœºæ™¯</h3>
<p>å¾ˆå¤š Vue å¼€å‘è€…éƒ½é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼šåœ¨æ”¹å˜æ•°æ®åï¼Œç«‹å³è®¿é—® DOMï¼Œå´å‘ç°æ‹¿åˆ°çš„æ˜¯æ—§çš„å€¼ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šç”¨åˆ° <code>nextTick</code> è¿™ä¸ªç¥å¥‡çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ”¹å˜æ•°æ®</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello Vue'</span>

<span class="hljs-comment">// æ­¤æ—¶ DOM è¿˜æ²¡æœ‰æ›´æ–°</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span>.<span class="hljs-property">textContent</span>) <span class="hljs-comment">// æ—§å†…å®¹</span>

<span class="hljs-comment">// ä½¿ç”¨ nextTick è·å–æ›´æ–°åçš„ DOM</span>
<span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span>.<span class="hljs-property">textContent</span>) <span class="hljs-comment">// 'Hello Vue'</span>
})
</code></pre>
<p>é‚£ä¹ˆï¼Œ<code>nextTick</code> åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿä¸ºä»€ä¹ˆå®ƒèƒ½å¤Ÿç¡®ä¿æˆ‘ä»¬åœ¨ DOM æ›´æ–°åå†æ‰§è¡Œå›è°ƒï¼Ÿä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥å½»åº•æ­å¼€ <code>nextTick</code> çš„ç¥ç§˜é¢çº±ã€‚</p>
<h3 data-id="heading-2">nextTick çš„æ ¸å¿ƒä½œç”¨</h3>
<p><code>nextTick</code> æ˜¯ Vue æä¾›çš„ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š</p>
<p><strong>å°†å›è°ƒå‡½æ•°å»¶è¿Ÿåˆ°ä¸‹æ¬¡ DOM æ›´æ–°å¾ªç¯ä¹‹åæ‰§è¡Œ</strong></p>
<p>åœ¨ Vue ä¸­ï¼Œæ•°æ®å˜åŒ–æ—¶ï¼ŒDOM æ›´æ–°æ˜¯å¼‚æ­¥çš„ã€‚Vue ä¼šå¼€å¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ç¼“å†²åœ¨åŒä¸€äº‹ä»¶å¾ªç¯ä¸­å‘ç”Ÿçš„æ‰€æœ‰æ•°æ®å˜æ›´ã€‚è¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œ DOM æ“ä½œã€‚</p>
<h3 data-id="heading-3">æºç è§£æï¼šnextTick çš„å®ç°</h3>
<p>è®©æˆ‘ä»¬æ·±å…¥åˆ° Vue çš„æºç ä¸­ï¼Œçœ‹çœ‹ <code>nextTick</code> åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<h4 data-id="heading-4">1. æ ¸å¿ƒå˜é‡å®šä¹‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å›è°ƒé˜Ÿåˆ—</span>
<span class="hljs-keyword">const</span> callbacks = []
<span class="hljs-comment">// æ ‡è®°æ˜¯å¦å·²ç»æœ‰ pending çš„ Promise</span>
<span class="hljs-keyword">let</span> pending = <span class="hljs-literal">false</span>
<span class="hljs-comment">// å½“å‰æ˜¯å¦æ­£åœ¨æ‰§è¡Œå›è°ƒ</span>
<span class="hljs-keyword">let</span> flushing = <span class="hljs-literal">false</span>
<span class="hljs-comment">// å›è°ƒæ‰§è¡Œçš„ä½ç½®ç´¢å¼•</span>
<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>
</code></pre>
<h4 data-id="heading-5">2. nextTick å‡½æ•°ä¸»ä½“</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">nextTick</span>(<span class="hljs-params">cb?: <span class="hljs-built_in">Function</span>, ctx?: <span class="hljs-built_in">Object</span></span>) {
  <span class="hljs-keyword">let</span> _resolve
  <span class="hljs-comment">// å°†å›è°ƒå‡½æ•°åŒ…è£…åæ¨å…¥å›è°ƒé˜Ÿåˆ—</span>
  callbacks.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (cb) {
      <span class="hljs-keyword">try</span> {
        cb.<span class="hljs-title function_">call</span>(ctx)
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-title function_">handleError</span>(e, ctx, <span class="hljs-string">'nextTick'</span>)
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_resolve) {
      <span class="hljs-title function_">_resolve</span>(ctx)
    }
  })
  
  <span class="hljs-comment">// å¦‚æœå½“å‰æ²¡æœ‰ pending çš„ Promiseï¼Œå°±åˆ›å»ºä¸€æ¬¡</span>
  <span class="hljs-keyword">if</span> (!pending) {
    pending = <span class="hljs-literal">true</span>
    <span class="hljs-comment">// æ‰§è¡Œå¼‚æ­¥å»¶è¿Ÿå™¨</span>
    <span class="hljs-title function_">timerFunc</span>()
  }
  
  <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æä¾›å›è°ƒä¸”æ”¯æŒ Promiseï¼Œè¿”å›ä¸€ä¸ª Promise</span>
  <span class="hljs-keyword">if</span> (!cb &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Promise</span> !== <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      _resolve = resolve
    })
  }
}
</code></pre>
<h4 data-id="heading-6">3. timerFuncï¼šå¼‚æ­¥å»¶è¿Ÿå™¨çš„å®ç°</h4>
<p>è¿™æ˜¯ <code>nextTick</code> æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼ŒVue ä¼šæŒ‰ç…§ä»¥ä¸‹ä¼˜å…ˆçº§é€‰æ‹©å¼‚æ­¥æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> timerFunc

<span class="hljs-comment">// ä¼˜å…ˆçº§ï¼šPromise &gt; MutationObserver &gt; setImmediate &gt; setTimeout</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Promise</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-title function_">isNative</span>(<span class="hljs-title class_">Promise</span>)) {
  <span class="hljs-comment">// æƒ…å†µ1ï¼šæ”¯æŒ Promise</span>
  <span class="hljs-keyword">const</span> p = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  timerFunc = <span class="hljs-function">() =&gt;</span> {
    p.<span class="hljs-title function_">then</span>(flushCallbacks)
    <span class="hljs-comment">// åœ¨ä¸€äº›æœ‰é—®é¢˜çš„ UIWebView ä¸­ï¼ŒPromise.then ä¸ä¼šå®Œå…¨è§¦å‘</span>
    <span class="hljs-comment">// æ‰€ä»¥éœ€è¦é¢å¤–çš„ setTimeout æ¥å¼ºåˆ¶åˆ·æ–°</span>
    <span class="hljs-keyword">if</span> (isIOS) <span class="hljs-built_in">setTimeout</span>(noop)
  }
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!isIE &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">MutationObserver</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; (
  <span class="hljs-title function_">isNative</span>(<span class="hljs-title class_">MutationObserver</span>) ||
  <span class="hljs-title class_">MutationObserver</span>.<span class="hljs-title function_">toString</span>() === <span class="hljs-string">'[object MutationObserverConstructor]'</span>
)) {
  <span class="hljs-comment">// æƒ…å†µ2ï¼šæ”¯æŒ MutationObserver</span>
  <span class="hljs-keyword">let</span> counter = <span class="hljs-number">1</span>
  <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutationObserver</span>(flushCallbacks)
  <span class="hljs-keyword">const</span> textNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(<span class="hljs-title class_">String</span>(counter))
  observer.<span class="hljs-title function_">observe</span>(textNode, {
    <span class="hljs-attr">characterData</span>: <span class="hljs-literal">true</span>
  })
  timerFunc = <span class="hljs-function">() =&gt;</span> {
    counter = (counter + <span class="hljs-number">1</span>) % <span class="hljs-number">2</span>
    textNode.<span class="hljs-property">data</span> = <span class="hljs-title class_">String</span>(counter)
  }
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> setImmediate !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-title function_">isNative</span>(setImmediate)) {
  <span class="hljs-comment">// æƒ…å†µ3ï¼šæ”¯æŒ setImmediate</span>
  timerFunc = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setImmediate</span>(flushCallbacks)
  }
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// æƒ…å†µ4ï¼šé™çº§åˆ° setTimeout</span>
  timerFunc = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(flushCallbacks, <span class="hljs-number">0</span>)
  }
}
</code></pre>
<h4 data-id="heading-7">4. flushCallbacksï¼šæ‰§è¡Œå›è°ƒé˜Ÿåˆ—</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">flushCallbacks</span>(<span class="hljs-params"/>) {
  flushing = <span class="hljs-literal">true</span>
  pending = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">const</span> copies = callbacks.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>)
  callbacks.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>
  index = <span class="hljs-number">0</span>
  
  <span class="hljs-comment">// æ‰§è¡Œæ‰€æœ‰å›è°ƒ</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; copies.<span class="hljs-property">length</span>; i++) {
    index = i
    copies[i]()
  }
  
  flushing = <span class="hljs-literal">false</span>
  index = <span class="hljs-number">0</span>
}
</code></pre>
<h3 data-id="heading-8">å®Œæ•´æµç¨‹å›¾</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡æµç¨‹å›¾æ¥ç›´è§‚ç†è§£ <code>nextTick</code> çš„å®Œæ•´å·¥ä½œæµç¨‹ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[è°ƒç”¨ nextTick] --&gt; B[å›è°ƒå‡½æ•°æ¨å…¥ callbacks é˜Ÿåˆ—]
    B --&gt; C{æ˜¯å¦æœ‰ pending çš„ timerFunc?}
    C --&gt;|å¦| D[è®¾ç½® pending = true]
    D --&gt; E[æ‰§è¡Œ timerFunc]
    E --&gt; F{é€‰æ‹©å¼‚æ­¥æ–¹æ¡ˆ}
    F --&gt;|ä¼˜å…ˆçº§1| G[Promise.resolve.then]
    F --&gt;|ä¼˜å…ˆçº§2| H[MutationObserver]
    F --&gt;|ä¼˜å…ˆçº§3| I[setImmediate]
    F --&gt;|ä¼˜å…ˆçº§4| J[setTimeout]
    G --&gt; K[å¼‚æ­¥ä»»åŠ¡å®Œæˆ]
    H --&gt; K
    I --&gt; K
    J --&gt; K
    K --&gt; L[æ‰§è¡Œ flushCallbacks]
    L --&gt; M[éå†æ‰§è¡Œæ‰€æœ‰å›è°ƒ]
    M --&gt; N[é‡ç½®çŠ¶æ€]
    C --&gt;|æ˜¯| O[ç­‰å¾…ç°æœ‰ timerFunc è§¦å‘]
</code></pre>
<h3 data-id="heading-9">Vue çš„å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—</h3>
<p>è¦çœŸæ­£ç†è§£ <code>nextTick</code>ï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ Vue çš„å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—æœºåˆ¶ã€‚</p>
<h4 data-id="heading-10">Watcher ä¸æ›´æ–°é˜Ÿåˆ—</h4>
<p>å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒVue ä¸ä¼šç«‹å³æ›´æ–° DOMï¼Œè€Œæ˜¯å°†éœ€è¦æ›´æ–°çš„ Watcher æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç®€åŒ–ç‰ˆçš„æ›´æ–°é˜Ÿåˆ—å®ç°</span>
<span class="hljs-keyword">const</span> queue = []
<span class="hljs-keyword">let</span> has = {}
<span class="hljs-keyword">let</span> waiting = <span class="hljs-literal">false</span>
<span class="hljs-keyword">let</span> flushing = <span class="hljs-literal">false</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">queueWatcher</span>(<span class="hljs-params">watcher</span>) {
  <span class="hljs-keyword">const</span> id = watcher.<span class="hljs-property">id</span>
  <span class="hljs-comment">// é¿å…é‡å¤æ·»åŠ </span>
  <span class="hljs-keyword">if</span> (has[id] == <span class="hljs-literal">null</span>) {
    has[id] = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">if</span> (!flushing) {
      queue.<span class="hljs-title function_">push</span>(watcher)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// å¦‚æœå·²ç»åœ¨åˆ·æ–°ï¼ŒæŒ‰ id æ’åºæ’å…¥</span>
      <span class="hljs-keyword">let</span> i = queue.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
      <span class="hljs-keyword">while</span> (i &gt; index &amp;&amp; queue[i].<span class="hljs-property">id</span> &gt; watcher.<span class="hljs-property">id</span>) {
        i--
      }
      queue.<span class="hljs-title function_">splice</span>(i + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, watcher)
    }
    
    <span class="hljs-comment">// å¼€å¯ä¸‹ä¸€æ¬¡çš„å¼‚æ­¥æ›´æ–°</span>
    <span class="hljs-keyword">if</span> (!waiting) {
      waiting = <span class="hljs-literal">true</span>
      <span class="hljs-title function_">nextTick</span>(flushSchedulerQueue)
    }
  }
}
</code></pre>
<h4 data-id="heading-11">åˆ·æ–°è°ƒåº¦é˜Ÿåˆ—</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">flushSchedulerQueue</span>(<span class="hljs-params"/>) {
  flushing = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">let</span> watcher, id
  
  <span class="hljs-comment">// é˜Ÿåˆ—æ’åºï¼Œç¡®ä¿ï¼š</span>
  <span class="hljs-comment">// 1. ç»„ä»¶æ›´æ–°é¡ºåºä¸ºçˆ¶åˆ°å­</span>
  <span class="hljs-comment">// 2. ç”¨æˆ· watcher åœ¨æ¸²æŸ“ watcher ä¹‹å‰</span>
  <span class="hljs-comment">// 3. å¦‚æœä¸€ä¸ªç»„ä»¶åœ¨çˆ¶ç»„ä»¶çš„ watcher æœŸé—´è¢«é”€æ¯ï¼Œå®ƒçš„ watcher å¯ä»¥è¢«è·³è¿‡</span>
  queue.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">id</span> - b.<span class="hljs-property">id</span>)
  
  <span class="hljs-comment">// ä¸è¦ç¼“å­˜é˜Ÿåˆ—é•¿åº¦ï¼Œå› ä¸ºå¯èƒ½ä¼šæœ‰æ–°çš„ watcher åŠ å…¥</span>
  <span class="hljs-keyword">for</span> (index = <span class="hljs-number">0</span>; index &lt; queue.<span class="hljs-property">length</span>; index++) {
    watcher = queue[index]
    <span class="hljs-keyword">if</span> (watcher.<span class="hljs-property">before</span>) {
      watcher.<span class="hljs-title function_">before</span>()
    }
    id = watcher.<span class="hljs-property">id</span>
    has[id] = <span class="hljs-literal">null</span>
    <span class="hljs-comment">// æ‰§è¡Œæ›´æ–°</span>
    watcher.<span class="hljs-title function_">run</span>()
  }
  
  <span class="hljs-comment">// é‡ç½®çŠ¶æ€</span>
  <span class="hljs-title function_">resetSchedulerState</span>()
}
</code></pre>
<h3 data-id="heading-12">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-13">åœºæ™¯ 1ï¼šè·å–æ›´æ–°åçš„ DOM</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">list</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">addItem</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'d'</span>)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'li'</span>).<span class="hljs-property">length</span>) <span class="hljs-comment">// 3ï¼Œè¿˜æ˜¯æ—§çš„</span>
      
      <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'li'</span>).<span class="hljs-property">length</span>) <span class="hljs-comment">// 4ï¼Œæ›´æ–°åçš„</span>
      })
    }
  }
}
</code></pre>
<h4 data-id="heading-14">åœºæ™¯ 2ï¼šåœ¨ created é’©å­ä¸­æ“ä½œ DOM</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// DOM è¿˜æ²¡æœ‰è¢«åˆ›å»º</span>
    <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// ç°åœ¨å¯ä»¥å®‰å…¨åœ°æ“ä½œ DOM äº†</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'button'</span>).<span class="hljs-title function_">focus</span>()
    })
  }
}
</code></pre>
<h4 data-id="heading-15">åœºæ™¯ 3ï¼šä¸ Promise ç»“åˆä½¿ç”¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateData</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Updated'</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-number">10</span>
  
  <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰ DOM æ›´æ–°å®Œæˆ</span>
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$nextTick()
  
  <span class="hljs-comment">// ç°åœ¨å¯ä»¥æ‰§è¡Œä¾èµ–äºæ›´æ–°å DOM çš„æ“ä½œ</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateLayout</span>()
}
</code></pre>
<h3 data-id="heading-16">æ€§èƒ½ä¼˜åŒ–è€ƒè™‘</h3>
<p>Vue ä½¿ç”¨å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—æœ‰é‡è¦çš„æ€§èƒ½ä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>æ‰¹é‡æ›´æ–°</strong>ï¼šåŒä¸€äº‹ä»¶å¾ªç¯å†…çš„æ‰€æœ‰æ•°æ®å˜æ›´ä¼šè¢«æ‰¹é‡å¤„ç†</li>
<li><strong>é¿å…é‡å¤è®¡ç®—</strong>ï¼šç›¸åŒçš„ Watcher åªä¼šè¢«æ¨å…¥é˜Ÿåˆ—ä¸€æ¬¡</li>
<li><strong>ä¼˜åŒ–æ¸²æŸ“</strong>ï¼šå‡å°‘ä¸å¿…è¦çš„ DOM æ“ä½œ</li>
</ol>
<h3 data-id="heading-17">å¸¸è§é—®é¢˜è§£ç­”</h3>
<h4 data-id="heading-18">Q: nextTick å’Œ setTimeout æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4>
<p>A: è™½ç„¶ <code>nextTick</code> åœ¨é™çº§æƒ…å†µä¸‹ä¼šä½¿ç”¨ <code>setTimeout</code>ï¼Œä½†å®ƒä»¬æœ‰æœ¬è´¨åŒºåˆ«ï¼š</p>
<ul>
<li><code>nextTick</code> ä¼šå°è¯•ä½¿ç”¨å¾®ä»»åŠ¡ï¼ˆPromiseã€MutationObserverï¼‰ï¼Œè€Œ <code>setTimeout</code> æ˜¯å®ä»»åŠ¡</li>
<li>å¾®ä»»åŠ¡åœ¨å½“å‰äº‹ä»¶å¾ªç¯ç»“æŸæ—¶æ‰§è¡Œï¼Œå®ä»»åŠ¡åœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¼€å§‹æ‰§è¡Œ</li>
<li><code>nextTick</code> èƒ½ç¡®ä¿åœ¨ DOM æ›´æ–°åç«‹å³æ‰§è¡Œï¼Œè€Œ <code>setTimeout</code> å¯èƒ½ä¼šæœ‰é¢å¤–çš„å»¶è¿Ÿ</li>
</ul>
<h4 data-id="heading-19">Q: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™éœ€è¦è¿ç»­è°ƒç”¨å¤šä¸ª nextTickï¼Ÿ</h4>
<p>A: åœ¨æŸäº›å¤æ‚åœºæ™¯ä¸‹ï¼Œå¯èƒ½éœ€è¦ç¡®ä¿æŸäº›æ“ä½œåœ¨ç‰¹å®šçš„ DOM æ›´æ–°ä¹‹åæ‰§è¡Œï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">data1</span> = <span class="hljs-string">'first'</span>
<span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ç¬¬ä¸€æ¬¡æ›´æ–°åæ‰§è¡Œ</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">data2</span> = <span class="hljs-string">'second'</span>
  <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// ç¬¬äºŒæ¬¡æ›´æ–°åæ‰§è¡Œ</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data3</span> = <span class="hljs-string">'third'</span>
  })
})
</code></pre>
<h4 data-id="heading-20">Q: nextTick ä¼šè¿”å› Promise å—ï¼Ÿ</h4>
<p>A: æ˜¯çš„ï¼Œå½“ä¸ä¼ å…¥å›è°ƒå‡½æ•°æ—¶ï¼Œ<code>nextTick</code> ä¼šè¿”å›ä¸€ä¸ª Promiseï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„</span>
<span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// æ“ä½œ DOM</span>
})

<span class="hljs-comment">// æˆ–è€…</span>
<span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$nextTick()
<span class="hljs-comment">// æ“ä½œ DOM</span>
</code></pre>
<h3 data-id="heading-21">æ€»ç»“</h3>
<p>é€šè¿‡æœ¬æ–‡çš„æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>nextTick</code> çš„å®ç°ä½“ç°äº† Vue åœ¨æ€§èƒ½ä¼˜åŒ–ä¸Šçš„æ·±æ€ç†Ÿè™‘ï¼š</p>
<ol>
<li><strong>å¼‚æ­¥æ›´æ–°</strong>ï¼šé€šè¿‡é˜Ÿåˆ—æœºåˆ¶æ‰¹é‡å¤„ç†æ•°æ®å˜æ›´</li>
<li><strong>ä¼˜å…ˆçº§ç­–ç•¥</strong>ï¼šæ™ºèƒ½é€‰æ‹©æœ€ä¼˜çš„å¼‚æ­¥æ–¹æ¡ˆ</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·æœºåˆ¶</li>
<li><strong>å…¼å®¹æ€§</strong>ï¼šä¼˜é›…çš„é™çº§æ–¹æ¡ˆ</li>
</ol>
<p>ç†è§£ <code>nextTick</code> çš„å·¥ä½œåŸç†ï¼Œä¸ä»…å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨ Vueï¼Œè¿˜èƒ½è®©æˆ‘ä»¬å¯¹ JavaScript çš„å¼‚æ­¥æœºåˆ¶æœ‰æ›´æ·±å…¥çš„è®¤è¯†ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ å½»åº•æŒæ¡ Vue ä¸­ <code>nextTick</code> çš„é­”æ³•ï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³æ³•ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter å°è£…ä¸€ä¸ª tab]]></title>    <link>https://juejin.cn/post/7577705544874737702</link>    <guid>https://juejin.cn/post/7577705544874737702</guid>    <pubDate>2025-11-29T13:16:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577705544874737702" data-draft-id="7577675494067748890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter å°è£…ä¸€ä¸ª tab"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-11-29T13:16:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åå­—è¢«ä½ ä»¬æƒ³å®Œäº†"/> <meta itemprop="url" content="https://juejin.cn/user/3065854916834782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter å°è£…ä¸€ä¸ª tab
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3065854916834782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åå­—è¢«ä½ ä»¬æƒ³å®Œäº†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T13:16:02.000Z" title="Sat Nov 29 2025 13:16:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">flutter å°è£…ä¸€ä¸ª tab</h2>
<p>flutterç‰ˆæœ¬ï¼š3.35.4</p>
<p>demo é“¾æ¥ï¼š</p>
<pre><code class="hljs language-text" lang="text">https://github.com/yhtqw/FrontEndDemo/tree/main/flutter_demo/lib/pages/customize_tab
</code></pre>
<p>åœ¨flutterä¸­ä½¿ç”¨ <strong>TabBar</strong> + <strong>TabBarView</strong> å°±èƒ½å¾ˆå¥½çš„å®ç°ï¼Œä¸ºäº†ä½¿ç”¨çš„ä¾¿æ·æ€§å’Œé€šç”¨æ€§ï¼Œæ‰€ä»¥è¿›è¡Œä¸€äº›å°è£…ã€‚</p>
<p>éœ€è¦çœ‹æœ€ç»ˆæ•ˆæœå’Œæœ€ç»ˆçš„å°è£…ä»£ç ï¼Œç›´æ¥æ‹‰åˆ°æœ€åº•éƒ¨å³å¯ï½</p>
<p>ç®€å•çš„ä½¿ç”¨ä¸€ä¸‹ï¼Œå¯¹ä¸€äº›åŸºæœ¬çš„ç»“æ„é™åˆ¶åšå‡ºè§£é‡Šã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Page19</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> Page19({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;Page19&gt; createState() =&gt; _Page19State();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_Page19State</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">Page19</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  <span class="hljs-comment">// å¿…é¡»ï¼Œä½¿ç”¨TabControllerä½œä¸ºæ¡¥æ¢è¿æ¥TabBarå’ŒTabBarView</span>
  <span class="hljs-keyword">late</span> TabController _controller;

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();

    _controller = TabController(
      length: <span class="hljs-number">2</span>,
      vsync: <span class="hljs-keyword">this</span>,
      initialIndex: <span class="hljs-number">0</span>,
    );
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      backgroundColor: Colors.white,
      body: Column(
        children: [
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">100</span>,),

          TabBar(
            controller: _controller,
            <span class="hljs-comment">// tab baré€‰é¡¹ï¼Œæ•°é‡å¾—å’Œä¸‹é¢ä¸€è‡´</span>
            tabs: <span class="hljs-keyword">const</span> [
              Text(<span class="hljs-string">'1111'</span>),
              Text(<span class="hljs-string">'2222'</span>),
            ],
          ),

          <span class="hljs-comment">// ä½¿ç”¨TabBarViewæ—¶ï¼Œå¿…é¡»æŒ‡å®šå®¹å™¨çš„é™åˆ¶èŒƒå›´ã€‚</span>
          <span class="hljs-comment">// è¿™é‡Œç›´æ¥æ’‘æ»¡å‰©ä½™ç©ºé—´</span>
          Expanded(
            child: TabBarView(
              controller: _controller,
              <span class="hljs-comment">// tab baræ¯ä¸ªé€‰é¡¹å¯¹åº”çš„tabé¡µé¢ï¼Œæ•°é‡å¾—å¾ˆä¸Šé¢ä¸€è‡´</span>
              children: <span class="hljs-keyword">const</span> [
                Text(<span class="hljs-string">'1'</span>),
                Text(<span class="hljs-string">'2'</span>),
              ],
            ),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50031a2165d44806b5471b3b8643d2a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=T0P8YJ7e0LRaVQlKhhiozBn7X4Y%3D" alt="image01.gif" loading="lazy"/></p>
<p>ç®€å•çš„åœºæ™¯å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨TabControllerï¼Œä½†éœ€è¦DefaultTabControlleråŒ…è£¹ï¼Œè¿™æ ·æ— éœ€æ‰‹åŠ¨åˆ›å»ºæ§åˆ¶å™¨è‡ªåŠ¨å°±å…³è”ä¸Šäº†ï¼Œå¤§è‡´ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ... å…¶ä»–çœç•¥</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_Page19State</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">Page19</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> DefaultTabController(
      <span class="hljs-comment">// æ•°é‡å¾—å’Œä¸‹é¢çš„ä¸€è‡´</span>
      length: <span class="hljs-number">2</span>,
      child: Scaffold(
        backgroundColor: Colors.white,
        body: Column(
          children: [
            SizedBox(height: <span class="hljs-number">100</span>,),

            TabBar(
              tabs: [
                Text(<span class="hljs-string">'1111'</span>),
                Text(<span class="hljs-string">'2222'</span>),
              ],
            ),

            Expanded(
              child: TabBarView(
                children: [
                  Text(<span class="hljs-string">'1'</span>),
                  Text(<span class="hljs-string">'2'</span>),
                ],
              ),
            ),
          ],
        ),
      ),
    );
  }
}
</code></pre>
<p>æ•ˆæœå’Œä¸Šé¢ä¸€è‡´ã€‚</p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡º flutter å·²ç»å®ç°äº†æ»‘åŠ¨çš„åŠ¨ç”»æ•ˆæœï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹ç»“æ„æ ·å¼è¿›è¡Œå°è£…ï¼Œä¸‹é¢æˆ‘ä»¬å»ä½“éªŒä¸€ä¸‹å…¶ä»–çš„å±æ€§ï¼Œä¸ºå°è£…åšå‡†å¤‡ã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_Page19State</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">Page19</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  <span class="hljs-keyword">late</span> TabController _controller;

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();

    _controller = TabController(
      length: <span class="hljs-number">3</span>,
      vsync: <span class="hljs-keyword">this</span>,
      initialIndex: <span class="hljs-number">0</span>,
    );
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      backgroundColor: Colors.white,
      body: Column(
        children: [
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">100</span>,),

          TabBar(
            controller: _controller,
            <span class="hljs-comment">// æ³¨æ„ï¼šé€‰é¡¹æ–‡æœ¬é¢œè‰²å°±é€šè¿‡ä¸‹é¢è®¾ç½®ï¼Œä¸é€šè¿‡é€‰é¡¹è‡ªèº«çš„TextStyleæ¥è®¾ç½®</span>
            <span class="hljs-comment">// tab bar é€‰é¡¹æ–‡æœ¬é€‰ä¸­æ—¶çš„é¢œè‰²</span>
            labelColor: Colors.blue,
            <span class="hljs-comment">// tab bar é€‰é¡¹æ–‡æœ¬æœªé€‰ä¸­æ—¶çš„é¢œè‰²</span>
            unselectedLabelColor: Colors.black,

            <span class="hljs-comment">// é€‰ä¸­æŒ‡ç¤ºå™¨ç›¸å…³çš„å±æ€§</span>
            <span class="hljs-comment">// è®¾ç½®tab baré€‰ä¸­æŒ‡ç¤ºå™¨çš„é¢œè‰²</span>
            indicatorColor: Colors.blue,
            <span class="hljs-comment">// è®¾ç½®tab baré€‰ä¸­æŒ‡ç¤ºå™¨çš„å¤§å°ï¼Œé»˜è®¤å’Œé€‰é¡¹çš„æ–‡æœ¬å®½åº¦ä¸€è‡´ã€‚</span>
            <span class="hljs-comment">// è¿™é‡Œè®¾ç½®çš„æŒ‡ç¤ºå™¨å®½åº¦å’Œé€‰é¡¹çš„å®½åº¦ä¸€è‡´</span>
            <span class="hljs-comment">// è¿™æ ·è®¾ç½®ååˆ‡æ¢tabçš„æ—¶å€™è •è™«è •åŠ¨æ•ˆæœå°±æ²¡æœ‰äº†</span>
            indicatorSize: TabBarIndicatorSize.tab,
            <span class="hljs-comment">// è®¾ç½®tab baré€‰ä¸­æŒ‡ç¤ºå™¨çš„é«˜åº¦</span>
            indicatorWeight: <span class="hljs-number">10</span>,

            <span class="hljs-comment">// ç§»é™¤tab baré€‰é¡¹ç‚¹å‡»æ—¶çš„é«˜äº®å’Œæ°´æ³¢çº¹åé¦ˆæ•ˆæœ</span>
            overlayColor: WidgetStateProperty.all(Colors.transparent),

            <span class="hljs-comment">// è®¾ç½®tab baré€‰é¡¹çš„å†…è¾¹è·</span>
            <span class="hljs-comment">// åœ¨indicatorSizeè®¾ç½®ä¸ºlabelçš„æ—¶å€™å†è®¾ç½®è¿™ä¸ªå€¼æ¯”è¾ƒå¥½</span>
            <span class="hljs-comment">// labelPadding: const EdgeInsets.symmetric(horizontal: 40),</span>

            <span class="hljs-comment">// è®¾ç½®tab baråº•éƒ¨çš„é‚£æ¡åˆ†å‰²çº¿é«˜åº¦ï¼Œä¹Ÿå¯ä»¥é€šè¿‡dividerColorè®¾ç½®å…¶é¢œè‰²</span>
            dividerHeight: <span class="hljs-number">0</span>,

            tabs: [<span class="hljs-string">'1111'</span>,<span class="hljs-string">'2222'</span>,<span class="hljs-string">'3333'</span>].map(
              (item) =&gt; Text(item,),
            ).toList(),
          ),

          Expanded(
            child: TabBarView(
              controller: _controller,
              children: [<span class="hljs-string">'1'</span>,<span class="hljs-string">'2'</span>,<span class="hljs-string">'3'</span>].map(
                (item) =&gt;Text(item,),
              ).toList(),
            ),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a30010bd94254286a3a2d5a6e2fb49f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=ep3BgnoUvvK%2BrNJnaLWLM0HDV7s%3D" alt="image02.gif" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢æˆ‘ä»¬ä½¿ç”¨äº†è®¸å¤šé€‰ä¸­å’Œé€‰ä¸­æŒ‡ç¤ºå™¨çš„æ•ˆæœï¼Œä¹Ÿæ˜¯åœ¨tab barä¸ªæ•°å°‘çš„æ—¶å€™å±•ç¤ºçš„æ•ˆæœï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åŠ å‡ ä¸ªå†çœ‹çœ‹æ•ˆæœ:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51d8a9a581f443c69365902764fa98f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=OzjFbSfy73XO6vFCingRBzAPAIc%3D" alt="image03.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°é€‰é¡¹è¢«æŒ¤å‹ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ TabBar çš„ isScrollable å±æ€§æ¥è®¾ç½®æ˜¯å¦å¯ä»¥æ»šåŠ¨ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
TabBar(
  <span class="hljs-comment">// å…¶ä»–çœç•¥...</span>

  <span class="hljs-comment">// è®¾ç½®tab baré€‰é¡¹ä¸ªæ•°è¿‡å¤šè¶…è¿‡é™åˆ¶çš„å®½åº¦çš„æ—¶å€™ï¼Œæ˜¯å¦å…è®¸æ»šåŠ¨</span>
  isScrollable: <span class="hljs-keyword">true</span>,
),
<span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/838a738323dd4a898eb05331a6c59609~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=OpdvpUWYfX7Mdxq%2F5iBSmyDqA9A%3D" alt="image04.gif" loading="lazy"/></p>
<p>æˆ‘ä»¬åˆå‘ç°äº†å…è®¸æ»šåŠ¨åï¼Œç¬¬ä¸€ä¸ªçš„æ’åˆ—è·ç¦»å®¹å™¨å·¦è¾¹æœ‰ä¸€äº›è¾¹è·ï¼Œå¦‚æœæƒ³è®©é€‰é¡¹åœ¨æœ€å·¦è¾¹å¼€å§‹æ˜¾ç¤ºï¼Œå°±éœ€è¦è®¾ç½®tabAlignmentå±æ€§ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
TabBar(
  <span class="hljs-comment">// å…¶ä»–çœç•¥...</span>

  <span class="hljs-comment">// è®¾ç½®tab baré€‰é¡¹ä¸ªæ•°è¿‡å¤šè¶…è¿‡é™åˆ¶çš„å®½åº¦çš„æ—¶å€™ï¼Œæ˜¯å¦å…è®¸æ»šåŠ¨</span>
  isScrollable: <span class="hljs-keyword">true</span>,
  <span class="hljs-comment">// è®¾ç½®tab baré€‰é¡¹çš„æ˜¾ç¤ºä½ç½®</span>
  tabAlignment: TabAlignment.start,
),
<span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5afb91717faa4e978089609c827a9fef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=jF6bLnpOi3WkIEholl3%2FmUhdngg%3D" alt="image05.png" loading="lazy"/></p>
<p>å…³äºTabBarçš„ä¸€äº›å¸¸ç”¨çš„å±æ€§å°±ä½“éªŒå¾—å·®ä¸å¤šäº†ï¼Œå¦‚æœæˆ‘ä»¬è¦è®¾ç½®æ•´ä¸ªTabBarå®¹å™¨çš„æ ·å¼ï¼Œä¾‹å¦‚èƒŒæ™¯è‰²ï¼Œåœ†è§’ï¼Œé«˜åº¦ç­‰å±æ€§æ—¶ï¼Œå°±éœ€è¦å¯¹TabBarè¿›è¡ŒåŒ…è£¹ï¼Œä½¿ç”¨å¤–å±‚åŒ…è£¹éƒ¨ä»¶æ¥è®¾ç½®æ ·å¼:</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
Container(
  height: <span class="hljs-number">60</span>,
  padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="hljs-number">20</span>),
  decoration: <span class="hljs-keyword">const</span> BoxDecoration(
    color: Colors.grey,
    borderRadius: BorderRadius.only(
      topLeft: Radius.circular(<span class="hljs-number">20</span>),
      topRight: Radius.circular(<span class="hljs-number">20</span>),
    )
  ),
  child: TabBar(
    <span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
  ),
),
<span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a14d7f7dbcb946f4b90fdfcec8b32bae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=3N%2FoHk1O04zGpgHDHThr0XcQTz8%3D" alt="image06.png" loading="lazy"/></p>
<p>è¿™ä¸‹å…³äºTabBarçš„æ ·å¼å°±è®¾ç½®çš„å·®ä¸å¤šäº†ï¼Œé‚£ä¹ˆå…³äºTabBarViewçš„æ ·å¼å°±è‡ªè¡Œé€šè¿‡ä¼ æŸ“çš„childrenéƒ¨ä»¶è‡ªè¡Œå°è£…å®ç°ã€‚</p>
<p>æˆ‘ä»¬ä»ä¸Šé¢çš„æ•ˆæœä¸­å¯ä»¥çœ‹åˆ°tab baré€‰ä¸­æ ·å¼é€šè¿‡å±æ€§å»è‡ªå®šä¹‰å¯èƒ½æœ‰äº›ä¸å¥½çœ‹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç”¨è®©æŒ‡ç¤ºå™¨ä¸ºæ•´ä¸ªèƒŒæ™¯ï¼Œå¹¶ä¸”è®¾ç½®éƒ¨åˆ†æ ·å¼æ•ˆæœï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå®šä¹‰TabBarçš„indicatorå±æ€§ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d75d0f3521a74919a42f664408d36aaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=NWUPd2znWKiJIyo%2BW55GSxol9fg%3D" alt="image07.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬è¦è‡ªå®šä¹‰æŒ‡ç¤ºå™¨ï¼Œéœ€è¦å®ç°Decorationï¼Œå¹¶ä¸”å¦‚æœè®¾ç½®äº†indicatorå±æ€§ï¼Œåˆ™ä¼šå¿½ç•¥indicatorColorå’ŒindicatorWeightå±æ€§ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7b0bb7558be4cd782a08cac86bf7718~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=YOmW%2BW3hnuYY8ozNVfdjNzYp6rM%3D" alt="image08.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8a206d57c874b1598894764b8f0d33c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=grBuGTVkVj6cCFC4YJckeUzkKMs%3D" alt="image09.png" loading="lazy"/></p>
<p>ä¸ºäº†å®ç°è‡ªå®šä¹‰çš„indicatorï¼Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿Decorationå»å®ç°ç»˜åˆ¶çš„æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å»å®ç°ä¸€ä¸ªç®€å•çš„åœ†è§’çŸ©å½¢æ ·å¼ï¼ˆè¿™é‡Œä¸æ·±å…¥å±•å¼€ç»˜åˆ¶ç›¸å…³çš„çŸ¥è¯†ï¼Œåé¢æœ‰æ—¶é—´å†å•ç‹¬å†™ç»˜åˆ¶ç›¸å…³çš„çŸ¥è¯†ï¼‰ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizeTabIndicator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Decoration</span> </span>{
  <span class="hljs-keyword">const</span> CustomizeTabIndicator({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.color,
    <span class="hljs-keyword">this</span>.radius = BorderRadius.zero,
  });

  <span class="hljs-comment">/// <span class="markdown">æŒ‡ç¤ºå™¨é¢œè‰²</span></span>
  <span class="hljs-keyword">final</span> Color color;
  <span class="hljs-comment">/// <span class="markdown">æŒ‡ç¤ºå™¨çš„åœ†è§’å±æ€§</span></span>
  <span class="hljs-keyword">final</span> BorderRadius radius;

  <span class="hljs-comment">// éœ€è¦é‡å†™ç»˜åˆ¶æ–¹æ³•</span>
  <span class="hljs-meta">@override</span>
  BoxPainter createBoxPainter([VoidCallback? onChanged]) =&gt;
      _RoundedPainter(<span class="hljs-keyword">this</span>, onChanged);
}

<span class="hljs-comment">// è‡ªå®šä¹‰ç»˜åˆ¶æ–¹æ³•</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_RoundedPainter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BoxPainter</span> </span>{
  _RoundedPainter(<span class="hljs-keyword">this</span>.decoration, VoidCallback? onChanged) : <span class="hljs-keyword">super</span>(onChanged);

  <span class="hljs-keyword">final</span> CustomizeTabIndicator decoration;

  <span class="hljs-comment">// é‡å†™ç»˜åˆ¶çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä¼ ç»™æˆ‘ä»¬ç»˜åˆ¶åŒºåŸŸçš„ä¿¡æ¯</span>
  <span class="hljs-comment">// æˆ‘ä»¬åˆ©ç”¨è¿™äº›ä¿¡æ¯å°±å¯ä»¥å®ç°è‡ªå®šä¹‰çš„ç»˜åˆ¶</span>
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> paint(Canvas canvas, Offset offset, ImageConfiguration configuration) {
    <span class="hljs-comment">// è·å–ç»˜åˆ¶åŒºåŸŸçš„å¤§å°ï¼Œæ•´ä¸ªå˜æ¢è¿‡ç¨‹ä¸­éƒ½ä¼šæ›´æ–°</span>
    <span class="hljs-built_in">double</span> width = configuration.size!.width;
    <span class="hljs-built_in">double</span> height = configuration.size!.height;
    <span class="hljs-comment">// è·å–ç»˜åˆ¶åŒºåŸŸçš„åç§»é‡ï¼ˆè·ç¦»æœ€è¾¹ä¸Šçš„è·ç¦»ï¼‰</span>
    Offset baseOffset = Offset(offset.dx, offset.dy,);

    <span class="hljs-comment">// è®¾ç½®è¦ç»˜åˆ¶çš„åœ†è§’çŸ©å½¢</span>
    <span class="hljs-keyword">final</span> RRect indicatorRRect = _buildRRect(
      baseOffset,
      width,
      height,
    );
    <span class="hljs-comment">// è®¾ç½®ç”»ç¬”å±æ€§</span>
    <span class="hljs-keyword">final</span> Paint paint = Paint()
      ..color = decoration.color
      ..style = PaintingStyle.fill;

    <span class="hljs-comment">// ç»˜åˆ¶åœ†è§’çŸ©å½¢</span>
    canvas.drawRRect(indicatorRRect, paint);
  }

  <span class="hljs-comment">/// <span class="markdown">ç»˜åˆ¶åœ†è§’æŒ‡ç¤ºå™¨</span></span>
  RRect _buildRRect(
    Offset offset,
    <span class="hljs-built_in">double</span> width,
    <span class="hljs-built_in">double</span> height,
  ) {
    <span class="hljs-keyword">return</span> RRect.fromRectAndCorners(
      <span class="hljs-comment">// åœ†è§’çŸ©å½¢çš„ç»˜åˆ¶ä¸­å¿ƒ</span>
      Rect.fromCenter(
        center: Offset(
          offset.dx + width / <span class="hljs-number">2</span>,
          offset.dy + height / <span class="hljs-number">2</span>,
        ),
        width: width,
        height: height,
      ),
      topLeft: decoration.radius.topLeft,
      topRight: decoration.radius.topRight,
      bottomRight: decoration.radius.bottomRight,
      bottomLeft: decoration.radius.bottomLeft,
    );
  }
}
</code></pre>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_Page19State</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">Page19</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  <span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      backgroundColor: Colors.white,
      body: Column(
        children: [
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">100</span>,),

          Container(
            height: <span class="hljs-number">60</span>,
            width: <span class="hljs-built_in">double</span>.infinity,
            padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="hljs-number">20</span>),
            decoration: <span class="hljs-keyword">const</span> BoxDecoration(
              color: Colors.grey,
              borderRadius: BorderRadius.only(
                topLeft: Radius.circular(<span class="hljs-number">20</span>),
                topRight: Radius.circular(<span class="hljs-number">20</span>),
              )
            ),
            child: TabBar(
              controller: _controller,
              <span class="hljs-comment">// æ³¨æ„ï¼šé€‰é¡¹æ–‡æœ¬é¢œè‰²å°±é€šè¿‡ä¸‹é¢è®¾ç½®ï¼Œä¸é€šè¿‡é€‰é¡¹è‡ªèº«çš„TextStyleæ¥è®¾ç½®</span>
              <span class="hljs-comment">// tab bar é€‰é¡¹æ–‡æœ¬é€‰ä¸­æ—¶çš„é¢œè‰²</span>
              labelColor: Colors.blue,
              <span class="hljs-comment">// tab bar é€‰é¡¹æ–‡æœ¬æœªé€‰ä¸­æ—¶çš„é¢œè‰²</span>
              unselectedLabelColor: Colors.black,

              <span class="hljs-comment">// é€‰ä¸­æŒ‡ç¤ºå™¨ç›¸å…³çš„å±æ€§</span>
              <span class="hljs-comment">// è‡ªå®šä¹‰æŒ‡ç¤ºå™¨</span>
              indicator: <span class="hljs-keyword">const</span> CustomizeTabIndicator(
                color: Colors.amber,
              ),

              <span class="hljs-comment">// è®¾ç½®tab baré€‰é¡¹ä¸ªæ•°è¿‡å¤šè¶…è¿‡é™åˆ¶çš„å®½åº¦çš„æ—¶å€™ï¼Œæ˜¯å¦å…è®¸æ»šåŠ¨</span>
              isScrollable: <span class="hljs-keyword">true</span>,
              <span class="hljs-comment">// è®¾ç½®tab baré€‰é¡¹çš„æ˜¾ç¤ºä½ç½®</span>
              tabAlignment: TabAlignment.start,

              <span class="hljs-comment">// è®¾ç½®tab baré€‰é¡¹çš„å†…è¾¹è·</span>
              <span class="hljs-comment">// åœ¨indicatorSizeè®¾ç½®ä¸ºlabelçš„æ—¶å€™å†è®¾ç½®è¿™ä¸ªå€¼æ¯”è¾ƒå¥½</span>
              labelPadding: <span class="hljs-keyword">const</span> EdgeInsets.only(right: <span class="hljs-number">30</span>),

              <span class="hljs-comment">// è®¾ç½®tab baråº•éƒ¨çš„é‚£æ¡åˆ†å‰²çº¿é«˜åº¦ï¼Œä¹Ÿå¯ä»¥é€šè¿‡dividerColorè®¾ç½®å…¶é¢œè‰²</span>
              dividerHeight: <span class="hljs-number">0</span>,

              tabs: [<span class="hljs-string">'1111'</span>,<span class="hljs-string">'2222'</span>,<span class="hljs-string">'3333'</span>,<span class="hljs-string">'4444'</span>,<span class="hljs-string">'5555'</span>,<span class="hljs-string">'6666'</span>,<span class="hljs-string">'7777'</span>].map(
                (item) =&gt; Padding(
                  padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(
                    horizontal: <span class="hljs-number">20</span>,
                    vertical: <span class="hljs-number">5</span>,
                  ),
                  child: Text(item,)
                ),
              ).toList(),
            ),
          ),
          <span class="hljs-comment">// å…¶ä»–çœç•¥...</span>
        ],
      ),
    );
  }
}
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddfd3a0615824abc83bb3c2404cb528e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=BxsX8KyUfQrZMCn6ULtGI2JaA3g%3D" alt="image10.gif" loading="lazy"/></p>
<p>é€šè¿‡ä¸Šé¢çš„ä¸€ç³»åˆ—çš„ä½¿ç”¨ï¼Œæ¥ä¸‹æ¥å°è£…å°±å¾ˆæ˜äº†äº†ï¼Œå±æ€§ä¸»è¦åˆ†ä¸ºï¼š</p>
<ul>
<li>tab barç›¸å…³
<ul>
<li>tab barå®¹å™¨çš„å±æ€§</li>
<li>tab barç›¸å…³å±æ€§</li>
</ul>
</li>
<li>tab viewsç›¸å…³</li>
<li>å…¶ä»–å±æ€§</li>
</ul>
<p>æ¥ä¸‹æ¥åŸºäºä¸Šè¿°çš„å¼€å§‹å°è£…ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'customize_tab_indicator.dart'</span>;

<span class="hljs-comment">/// <span class="markdown">æŠ½å–ä¸€äº›é»˜è®¤çš„å±æ€§</span></span>
BorderRadius ctDefaultIndicatorBorderRadius = BorderRadius.circular(<span class="hljs-number">10</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizeTab</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> CustomizeTab({
    <span class="hljs-keyword">super</span>.key,
    <span class="hljs-keyword">this</span>.tabBarHeight = kToolbarHeight,
    <span class="hljs-keyword">this</span>.tabBarBackgroundColor,
    <span class="hljs-keyword">this</span>.tabBarPadding,
    <span class="hljs-keyword">this</span>.tabBarBorderRadius,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.tabs,
    <span class="hljs-keyword">this</span>.unselectedColor,
    <span class="hljs-keyword">this</span>.selectedColor,
    <span class="hljs-keyword">this</span>.tabBarOptionMargin = <span class="hljs-keyword">const</span> EdgeInsets.only(right: <span class="hljs-number">10</span>),
    <span class="hljs-keyword">this</span>.tabBarOptionPadding = EdgeInsets.zero,
    <span class="hljs-keyword">this</span>.indicatorColor = Colors.blue,
    <span class="hljs-keyword">this</span>.indicatorBorderRadius,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.tabViews,
    <span class="hljs-keyword">this</span>.initialIndex,
    <span class="hljs-keyword">this</span>.onChangeTabIndex,
  });

  <span class="hljs-comment">/// <span class="markdown">tab bar å®¹å™¨çš„é«˜åº¦ï¼Œé»˜è®¤ä¸ºAppBarå·¥å…·æ ç»„ä»¶çš„é«˜åº¦</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> tabBarHeight;
  <span class="hljs-comment">/// <span class="markdown">tab bar å®¹å™¨çš„èƒŒæ™¯é¢œè‰²</span></span>
  <span class="hljs-keyword">final</span> Color? tabBarBackgroundColor;
  <span class="hljs-comment">/// <span class="markdown">tab bar å®¹å™¨çš„å†…è¾¹è·</span></span>
  <span class="hljs-keyword">final</span> EdgeInsetsGeometry? tabBarPadding;
  <span class="hljs-comment">/// <span class="markdown">tab bar å®¹å™¨çš„åœ†è§’å±æ€§</span></span>
  <span class="hljs-keyword">final</span> BorderRadiusGeometry? tabBarBorderRadius;
  <span class="hljs-comment">/// <span class="markdown">tab é€‰é¡¹</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Widget&gt; tabs;
  <span class="hljs-comment">/// <span class="markdown">tab é€‰é¡¹æœªé€‰ä¸­æ—¶çš„é¢œè‰²</span></span>
  <span class="hljs-keyword">final</span> Color? unselectedColor;
  <span class="hljs-comment">/// <span class="markdown">tab é€‰é¡¹é€‰ä¸­æ—¶çš„é¢œè‰²</span></span>
  <span class="hljs-keyword">final</span> Color? selectedColor;
  <span class="hljs-comment">/// <span class="markdown">tab bar é€‰é¡¹æ¯é¡¹çš„margin</span></span>
  <span class="hljs-keyword">final</span> EdgeInsetsGeometry tabBarOptionMargin;
  <span class="hljs-comment">/// <span class="markdown">tab bar é€‰é¡¹æ¯é¡¹çš„padding(å› ä¸ºå¤§æ¦‚ç‡æ¯é¡¹çš„paddingæ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥è¿›è¡ŒæŠ½å–)</span></span>
  <span class="hljs-keyword">final</span> EdgeInsetsGeometry tabBarOptionPadding;
  <span class="hljs-comment">/// <span class="markdown">æŒ‡ç¤ºå™¨çš„é¢œè‰²</span></span>
  <span class="hljs-keyword">final</span> Color indicatorColor;
  <span class="hljs-comment">/// <span class="markdown">æŒ‡ç¤ºå™¨çš„åœ†è§’å±æ€§</span></span>
  <span class="hljs-keyword">final</span> BorderRadius? indicatorBorderRadius;
  <span class="hljs-comment">/// <span class="markdown">tab é¡µé¢</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Widget&gt; tabViews;
  <span class="hljs-comment">/// <span class="markdown">åˆå§‹åŒ–æ˜¾ç¤ºtabçš„ç´¢å¼•</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int?</span> initialIndex;
  <span class="hljs-comment">/// <span class="markdown">å½“tabç´¢å¼•å‘ç”Ÿæ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>(<span class="hljs-built_in">int</span>)? onChangeTabIndex;

  <span class="hljs-meta">@override</span>
  State&lt;CustomizeTab&gt; createState() =&gt; _CustomizeTabState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_CustomizeTabState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">CustomizeTab</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  <span class="hljs-keyword">late</span> TabController _controller;

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();

    _controller = TabController(
      length: widget.tabs.length,
      vsync: <span class="hljs-keyword">this</span>,
      initialIndex: widget.initialIndex ?? <span class="hljs-number">0</span>,
    )..addListener(() {
      <span class="hljs-comment">// indexIsChangingä¸»è¦ä½œç”¨å°±æ˜¯æ ‡è¯†TabControlleræ˜¯å¦æ­£å¤„äºç´¢å¼•åˆ‡æ¢è¿‡ç¨‹ä¸­ã€‚</span>
      <span class="hljs-comment">// ç‚¹å‡»åˆ‡æ¢ï¼Œåœ¨æ‰§è¡ŒåŠ¨ç”»æœŸé—´ä¸ºtrueï¼Œç”¨æˆ·æ‰‹åŠ¿æ“ä½œç»“æŸåä¸”åŠ¨ç”»å®Œæˆä¸ºfalse</span>
      <span class="hljs-comment">// æ»‘åŠ¨åˆ‡æ¢ä¸ºfalse</span>
      <span class="hljs-comment">// ä½¿ç”¨indexIsChangingæ¥åˆ¤æ–­å½“å‰tabå˜åŒ–æ˜¯å¦å®Œæˆï¼Œå®Œæˆäº†å°±æ‰§è¡Œå›è°ƒ</span>
      <span class="hljs-keyword">if</span> (!_controller.indexIsChanging) {
        widget.onChangeTabIndex?.call(_controller.index);
      }
    });
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }

  <span class="hljs-comment">/// <span class="markdown">å¯¹æ¯ä¸ªtabåŠ å†…è¾¹è·</span></span>
  Widget _buildTab(Widget tab) {
    <span class="hljs-keyword">return</span> Padding(
      padding: widget.tabBarOptionPadding,
      child: tab,
    );
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-comment">// é€šè¿‡çˆ¶å®¹å™¨çš„çº¦æŸåŠ¨æ€æ„å»ºå­éƒ¨ä»¶</span>
    <span class="hljs-keyword">return</span> LayoutBuilder(
      builder: (_, BoxConstraints boxConstraints) =&gt; Column(
        children: [
          Container(
            width: <span class="hljs-built_in">double</span>.infinity,
            height: widget.tabBarHeight,
            padding: widget.tabBarPadding,
            decoration: BoxDecoration(
              color: widget.tabBarBackgroundColor,
              borderRadius: widget.tabBarBorderRadius,
            ),
            child: TabBar(
              controller: _controller,
              indicator: CustomizeTabIndicator(
                color: widget.indicatorColor,
                radius: widget.indicatorBorderRadius ??
                    ctDefaultIndicatorBorderRadius,
              ),
              isScrollable: <span class="hljs-keyword">true</span>,
              dividerHeight: <span class="hljs-number">0</span>,
              labelPadding: widget.tabBarOptionMargin,
              tabAlignment: TabAlignment.start,
              unselectedLabelColor: widget.unselectedColor,
              labelColor: widget.selectedColor,
              tabs: widget.tabs.map((tab) =&gt; _buildTab(tab)).toList(),
            ),
          ),

          <span class="hljs-comment">// å› ä¸ºTabBarViewå¿…é¡»è¦çº¦æŸ</span>
          <span class="hljs-comment">// æ‰€ä»¥å®šä¹‰å®ƒçš„é«˜åº¦å°±ä¸ºå¤–ç•Œçš„çº¦æŸé«˜åº¦å‡å»TabBarçš„é«˜åº¦</span>
          SizedBox(
            width: <span class="hljs-built_in">double</span>.infinity,
            height: boxConstraints.maxHeight - widget.tabBarHeight,
            child: TabBarView(
              controller: _controller,
              children: widget.tabViews,
            ),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'../widgets/page19/customize_tab.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Page19</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> Page19({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;Page19&gt; createState() =&gt; _Page19State();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_Page19State</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">Page19</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  Widget _buildTab(<span class="hljs-built_in">String</span> txt) {
    <span class="hljs-keyword">return</span> Text(
      txt,
      style: <span class="hljs-keyword">const</span> TextStyle(
        fontSize: <span class="hljs-number">14</span>,
      ),
    );
  }

  Widget _buildTabView(<span class="hljs-built_in">String</span> txt) {
    <span class="hljs-keyword">return</span> Container(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">20</span>),
      color: Colors.grey,
      child: Text(txt),
    );
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      backgroundColor: Colors.white,
      body: Column(
        children: [
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">100</span>,),

          Expanded(
            child: CustomizeTab(
              tabBarBackgroundColor: Colors.amber,
              tabBarPadding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(
                horizontal: <span class="hljs-number">20</span>,
              ),
              tabBarBorderRadius: <span class="hljs-keyword">const</span> BorderRadius.only(
                topRight: Radius.circular(<span class="hljs-number">20</span>),
                topLeft: Radius.circular(<span class="hljs-number">20</span>),
              ),
              unselectedColor: Colors.black,
              selectedColor: Colors.white,
              tabBarOptionPadding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(
                horizontal: <span class="hljs-number">15</span>,
                vertical: <span class="hljs-number">5</span>,
              ),
              indicatorColor: Colors.orange,
              onChangeTabIndex: (index) {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">'å½“å‰çš„ç´¢å¼•ä¸ºï¼š<span class="hljs-subst">$index</span>'</span>);
              },
              tabs: [<span class="hljs-string">'tab1'</span>, <span class="hljs-string">'tab2'</span>, <span class="hljs-string">'tab3'</span>, <span class="hljs-string">'tab4'</span>, <span class="hljs-string">'tab5'</span>].map(
                (item) =&gt; _buildTab(item),
              ).toList(),
              tabViews: [<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, <span class="hljs-string">'3'</span>, <span class="hljs-string">'4'</span>, <span class="hljs-string">'5'</span>].map(
                (item) =&gt; _buildTabView(item),
              ).toList(),
            ),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df879ac790674caea03a33b87e0da7ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=gaJEOeEof9fVgxYdkG1sfh7r8BE%3D" alt="image11.gif" loading="lazy"/></p>
<p>ä¸Šé¢æˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªç®€å•çš„tabå°è£…ï¼Œä½†æ˜¯ç›®å‰è¿˜ä¸ç®—å¾ˆé€šç”¨ï¼Œä¾‹å¦‚æˆ‘æƒ³è¦TabBaråœ¨ä¸‹é¢ï¼ŒTabViewåœ¨ä¸Šé¢ï¼Œè¿™ä¸ªå°±ä¸èƒ½ç›´æ¥ä½¿ç”¨äº†ï¼Œå¾—æ›´æ”¹å†…éƒ¨ä»£ç ï¼Œæ‰€ä»¥ç»§ç»­ç»§ç»­å°è£…ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰æ–¹å‘ã€‚</p>
<p>æ¥ä¸‹æ¥è¿›è¡ŒTabBarä½ç½®çš„åˆ†æï¼š</p>
<ol>
<li>åœ¨é¡¶éƒ¨ï¼ˆtopï¼‰</li>
</ol>
<p>ä¸ç”¨å…·ä½“åˆ†æäº†ï¼Œå› ä¸ºä¸Šé¢å°±æ˜¯åŸºäºåœ¨é¡¶éƒ¨å°è£…çš„ã€‚</p>
<ol start="2">
<li>åœ¨åº•éƒ¨ï¼ˆbottomï¼‰</li>
</ol>
<p>ä¸åœ¨é¡¶éƒ¨ç›¸æ¯”ï¼Œåªæ˜¯ç»“æ„å€’åºä¸€ä¸‹å°±è¡Œäº†ã€‚</p>
<ol start="3">
<li>åœ¨å·¦è¾¹ï¼ˆleftï¼‰</li>
</ol>
<p>åœ¨å·¦è¾¹ï¼Œç»“æ„ä»ä¸Šä¸‹ç»“æ„ï¼ˆColumnï¼‰å˜æˆå·¦å³ç»“æ„ï¼ˆRowï¼‰ï¼Œè€Œä¸”TabBarä¸æ”¯æŒç›´æ¥è½¬æˆä¸Šä¸‹ç»“æ„ï¼Œæ‰€ä»¥åªæœ‰å¦è¾Ÿè¹Šå¾„ã€‚ä»å·¦å³ç»“æ„å˜æˆä¸Šä¸‹ç»“æ„æ—‹è½¬90åº¦ä¹Ÿèƒ½å®ç°æ•ˆæœï¼ŒåŸºäºæ­¤åœ¨åšè°ƒæ•´ï¼Œè®©æ•´ä¸ªå®¹å™¨æ—‹è½¬90åº¦çš„æ—¶å€™ï¼ŒTabBarçš„é€‰é¡¹åˆ™ä¹Ÿè¢«æ—‹è½¬äº†90åº¦ï¼Œä»è§†è§‰æ•ˆæœä¸Šçœ‹å°±æ˜¯å€’ç½®çš„ï¼Œå¤§è‡´æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e67a5415682147f2b6d2ada5c8918a42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=YeJyVPhIZ4DHskotFiWT1AJIQVI%3D" alt="image12.png" loading="lazy"/></p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯¹æ¯ä¸ªå­é¡¹å‘åæ–¹å‘æ—‹è½¬90åº¦å³å¯è¿˜åŸæ˜¾ç¤ºã€‚</p>
<p>å¯¹äºTabViewï¼ŒåŸå…ˆçš„äº¤äº’æ–¹å¼ä¸ºå·¦å³æ»‘åŠ¨åˆ‡æ¢ï¼Œç°åœ¨å˜æˆå·¦å³ç»“æ„äº†ï¼Œé‚£ä¹ˆäº¤äº’æ–¹å¼å¾—ä»å·¦å³å˜æˆä¸Šä¸‹ï¼ŒTabViewä¸æ”¯æŒç›´æ¥å˜æˆä¸Šä¸‹æ»‘åŠ¨ï¼Œæ‰€ä»¥æœ‰ä¸¤ç§æ–¹å¼è§£å†³ï¼š</p>
<p>ä¸€ç§æ˜¯ä½¿ç”¨PageViewï¼Œè¿™ä¸ªå¤©ç”Ÿå°±æ”¯æŒä¸Šä¸‹æ»‘åŠ¨ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨è¿™ä¸ªï¼Œå¾—ç»´æŠ¤PageControllerï¼ŒåŒæ­¥TabBarçš„åˆ‡æ¢ï¼Œæœ‰å…´è¶£çš„å¯è‡ªè¡Œè¯•ä¸€ä¸‹ã€‚</p>
<p>å¦ä¸€ç§æ–¹å¼ä¾ç„¶æ˜¯æ—‹è½¬ï¼Œæˆ‘ä»¬å°†å…¶æ—‹è½¬90åº¦åï¼Œè‡ªç„¶è€Œç„¶æ»‘åŠ¨æ‰‹åŠ¿ä»å·¦å³å˜æˆäº†ä¸Šä¸‹ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­é¡¹ä¾ç„¶è¦åæ–¹å‘æ—‹è½¬90åº¦è¿˜åŸã€‚</p>
<ol start="4">
<li>åœ¨å³è¾¹ï¼ˆrightï¼‰</li>
</ol>
<p>ä¸åœ¨å·¦è¾¹ç›¸æ¯”ï¼Œåªæ˜¯ç»“æ„å€’åºä¸€ä¸‹å°±è¡Œäº†ã€‚</p>
<p>ç®€å•çš„åˆ†æäº†å¦‚ä½•å®ç°ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¼€å§‹ç¼–å†™ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'customize_tab_indicator.dart'</span>;

<span class="hljs-comment">/// <span class="markdown">tab bar ä½ç½®çš„æšä¸¾</span></span>
<span class="hljs-keyword">enum</span> TabBarPosition { top, bottom, left, right }

<span class="hljs-comment">/// <span class="markdown">æŠ½å–ä¸€äº›é»˜è®¤çš„å±æ€§</span></span>
BorderRadius ctDefaultIndicatorBorderRadius = BorderRadius.circular(<span class="hljs-number">10</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizeTab</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> CustomizeTab({
    <span class="hljs-keyword">super</span>.key,
    <span class="hljs-keyword">this</span>.tabBarHeight = kToolbarHeight,
    <span class="hljs-keyword">this</span>.tabBarBackgroundColor,
    <span class="hljs-keyword">this</span>.tabBarPadding = EdgeInsets.zero,
    <span class="hljs-keyword">this</span>.tabBarBorderRadius,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.tabs,
    <span class="hljs-keyword">this</span>.unselectedColor,
    <span class="hljs-keyword">this</span>.selectedColor,
    <span class="hljs-keyword">this</span>.tabBarOptionMargin = <span class="hljs-keyword">const</span> EdgeInsets.only(right: <span class="hljs-number">10</span>),
    <span class="hljs-keyword">this</span>.tabBarOptionPadding = EdgeInsets.zero,
    <span class="hljs-keyword">this</span>.indicatorColor = Colors.blue,
    <span class="hljs-keyword">this</span>.indicatorBorderRadius,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.tabViews,
    <span class="hljs-keyword">this</span>.initialIndex,
    <span class="hljs-keyword">this</span>.onChangeTabIndex,
    <span class="hljs-keyword">this</span>.position = TabBarPosition.top,
  });

  <span class="hljs-comment">/// <span class="markdown">tab bar å®¹å™¨çš„é«˜åº¦ï¼Œé»˜è®¤ä¸ºAppBarå·¥å…·æ ç»„ä»¶çš„é«˜åº¦</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> tabBarHeight;
  <span class="hljs-comment">/// <span class="markdown">tab bar å®¹å™¨çš„èƒŒæ™¯é¢œè‰²</span></span>
  <span class="hljs-keyword">final</span> Color? tabBarBackgroundColor;
  <span class="hljs-comment">/// <span class="markdown">tab bar å®¹å™¨çš„å†…è¾¹è·</span></span>
  <span class="hljs-keyword">final</span> EdgeInsetsGeometry tabBarPadding;
  <span class="hljs-comment">/// <span class="markdown">tab bar å®¹å™¨çš„åœ†è§’å±æ€§</span></span>
  <span class="hljs-keyword">final</span> BorderRadiusGeometry? tabBarBorderRadius;
  <span class="hljs-comment">/// <span class="markdown">tab é€‰é¡¹</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Widget&gt; tabs;
  <span class="hljs-comment">/// <span class="markdown">tab é€‰é¡¹æœªé€‰ä¸­æ—¶çš„é¢œè‰²</span></span>
  <span class="hljs-keyword">final</span> Color? unselectedColor;
  <span class="hljs-comment">/// <span class="markdown">tab é€‰é¡¹é€‰ä¸­æ—¶çš„é¢œè‰²</span></span>
  <span class="hljs-keyword">final</span> Color? selectedColor;
  <span class="hljs-comment">/// <span class="markdown">tab bar é€‰é¡¹æ¯é¡¹çš„margin</span></span>
  <span class="hljs-keyword">final</span> EdgeInsetsGeometry tabBarOptionMargin;
  <span class="hljs-comment">/// <span class="markdown">tab bar é€‰é¡¹æ¯é¡¹çš„padding(å› ä¸ºå¤§æ¦‚ç‡æ¯é¡¹çš„paddingæ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥è¿›è¡ŒæŠ½å–)</span></span>
  <span class="hljs-keyword">final</span> EdgeInsetsGeometry tabBarOptionPadding;
  <span class="hljs-comment">/// <span class="markdown">æŒ‡ç¤ºå™¨çš„é¢œè‰²</span></span>
  <span class="hljs-keyword">final</span> Color indicatorColor;
  <span class="hljs-comment">/// <span class="markdown">æŒ‡ç¤ºå™¨çš„åœ†è§’å±æ€§</span></span>
  <span class="hljs-keyword">final</span> BorderRadius? indicatorBorderRadius;
  <span class="hljs-comment">/// <span class="markdown">tab é¡µé¢</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Widget&gt; tabViews;
  <span class="hljs-comment">/// <span class="markdown">åˆå§‹åŒ–æ˜¾ç¤ºtabçš„ç´¢å¼•</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int?</span> initialIndex;
  <span class="hljs-comment">/// <span class="markdown">å½“tabç´¢å¼•å‘ç”Ÿæ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>(<span class="hljs-built_in">int</span>)? onChangeTabIndex;
  <span class="hljs-comment">/// <span class="markdown">tab baræ‰€åœ¨ä½ç½®ï¼Œé»˜è®¤ä¸ºtop</span></span>
  <span class="hljs-keyword">final</span> TabBarPosition position;

  <span class="hljs-meta">@override</span>
  State&lt;CustomizeTab&gt; createState() =&gt; _CustomizeTabState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_CustomizeTabState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">CustomizeTab</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  <span class="hljs-keyword">late</span> TabController _controller;

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();

    _controller = TabController(
      length: widget.tabs.length,
      vsync: <span class="hljs-keyword">this</span>,
      initialIndex: widget.initialIndex ?? <span class="hljs-number">0</span>,
    )..addListener(() {
      <span class="hljs-comment">// indexIsChangingä¸»è¦ä½œç”¨å°±æ˜¯æ ‡è¯†TabControlleræ˜¯å¦æ­£å¤„äºç´¢å¼•åˆ‡æ¢è¿‡ç¨‹ä¸­ã€‚</span>
      <span class="hljs-comment">// ç‚¹å‡»åˆ‡æ¢ï¼Œåœ¨æ‰§è¡ŒåŠ¨ç”»æœŸé—´ä¸ºtrueï¼Œç”¨æˆ·æ‰‹åŠ¿æ“ä½œç»“æŸåä¸”åŠ¨ç”»å®Œæˆä¸ºfalse</span>
      <span class="hljs-comment">// æ»‘åŠ¨åˆ‡æ¢ä¸ºfalse</span>
      <span class="hljs-comment">// ä½¿ç”¨indexIsChangingæ¥åˆ¤æ–­å½“å‰tabå˜åŒ–æ˜¯å¦å®Œæˆï¼Œå®Œæˆäº†å°±æ‰§è¡Œå›è°ƒ</span>
      <span class="hljs-keyword">if</span> (!_controller.indexIsChanging) {
        widget.onChangeTabIndex?.call(_controller.index);
      }
    });
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }

  <span class="hljs-comment">/// <span class="markdown">å¯¹æ¯ä¸ªtabåŠ å†…è¾¹è·</span></span>
  Widget _buildTabOption(Widget tab) {
    <span class="hljs-keyword">final</span> Widget tabOption = Padding(
      padding: widget.tabBarOptionPadding,
      child: tab,
    );

    <span class="hljs-comment">// å¦‚æœæ˜¯leftå’Œrightï¼Œå› ä¸ºå¤–å±‚çš„TabBarå®¹å™¨æ—‹è½¬äº†90åº¦</span>
    <span class="hljs-comment">// é‚£Tabé€‰é¡¹å°±æ—‹è½¬-90åº¦è¿˜åŸï¼Œè¾¾åˆ°è§†è§‰çš„ç»Ÿä¸€</span>
    <span class="hljs-keyword">if</span> (widget.position == TabBarPosition.left || widget.position == TabBarPosition.right) {
      <span class="hljs-keyword">return</span> RotatedBox(
        quarterTurns: <span class="hljs-number">-1</span>,
        child: tabOption,
      );
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> tabOption;
    }
  }

  <span class="hljs-comment">/// <span class="markdown">æ„å»ºTabBar</span></span>
  Widget _buildTabBar() {
    <span class="hljs-keyword">final</span> Widget tabBar = Container(
      width: <span class="hljs-built_in">double</span>.infinity,
      height: widget.tabBarHeight,
      padding: widget.tabBarPadding,
      decoration: BoxDecoration(
        color: widget.tabBarBackgroundColor,
        borderRadius: widget.tabBarBorderRadius,
      ),
      child: TabBar(
        controller: _controller,
        indicator: CustomizeTabIndicator(
          color: widget.indicatorColor,
          radius: widget.indicatorBorderRadius
              ?? ctDefaultIndicatorBorderRadius,
        ),
        isScrollable: <span class="hljs-keyword">true</span>,
        dividerHeight: <span class="hljs-number">0</span>,
        labelPadding: widget.tabBarOptionMargin,
        tabAlignment: TabAlignment.start,
        unselectedLabelColor: widget.unselectedColor,
        labelColor: widget.selectedColor,
        tabs: widget.tabs.map((tab) =&gt; _buildTabOption(tab)).toList(),
      ),
    );

    <span class="hljs-keyword">if</span> (widget.position == TabBarPosition.left || widget.position == TabBarPosition.right) {
      <span class="hljs-comment">// å¦‚æœæ˜¯leftå’Œrightï¼Œåˆ™æ—‹è½¬90åº¦ï¼Œ</span>
      <span class="hljs-keyword">return</span> RotatedBox(
        quarterTurns: <span class="hljs-number">1</span>,
        child: tabBar,
      );
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> tabBar;
    }
  }

  Widget _buildTabView(BoxConstraints boxConstraints) {
    <span class="hljs-keyword">final</span> EdgeInsets tabBarPadding = widget.tabBarPadding.resolve(TextDirection.ltr);

    <span class="hljs-keyword">return</span> widget.position == TabBarPosition.top || widget.position == TabBarPosition.bottom ? SizedBox(
      width: <span class="hljs-built_in">double</span>.infinity,
      height: boxConstraints.maxHeight -
          widget.tabBarHeight -
          tabBarPadding.top -
          tabBarPadding.bottom,
      child: TabBarView(
        controller: _controller,
        children: widget.tabViews,
      ),
    ) : SizedBox(
      <span class="hljs-comment">// å¦‚æœæ˜¯leftæˆ–è€…rightï¼Œåˆ™å®½é«˜è®¾ç½®äº¤æ¢ï¼Œå¹¶ä¸”å°†TabBarViewæ—‹è½¬90åº¦</span>
      width: boxConstraints.maxWidth -
          widget.tabBarHeight -
          tabBarPadding.top -
          tabBarPadding.bottom,
      height: <span class="hljs-built_in">double</span>.infinity,
      child: RotatedBox(
        quarterTurns: <span class="hljs-number">1</span>,
        child: TabBarView(
          controller: _controller,
          <span class="hljs-comment">// å› ä¸ºTabBarViewæ—‹è½¬äº†90åº¦ï¼Œå¯¹åº”çš„Tabé¡¹è¦æ—‹è½¬-90åº¦è¿˜åŸ</span>
          children: widget.tabViews.map((tabView) =&gt; RotatedBox(
            quarterTurns: <span class="hljs-number">-1</span>,
            child: tabView,
          )).toList(),
        ),
      ),
    );
  }

  <span class="hljs-comment">/// <span class="markdown">æ„å»ºtab</span></span>
  Widget _buildTab(BoxConstraints boxConstraints) {
    <span class="hljs-built_in">List</span>&lt;Widget&gt; children = [
      _buildTabBar(),
      _buildTabView(boxConstraints),
    ];

    <span class="hljs-comment">// å¦‚æœæ˜¯bottomå’Œrightï¼Œåˆ™æ¸²æŸ“çš„ç»“æ„ä¼šå€’ç½®</span>
    <span class="hljs-keyword">if</span> (widget.position == TabBarPosition.bottom
        || widget.position == TabBarPosition.right) {
      children = children.reversed.toList();
    }

    <span class="hljs-comment">// å¦‚æœæ˜¯topæˆ–è€…bottomï¼Œåˆ™æ˜¯ä¸Šä¸‹ç»“æ„</span>
    <span class="hljs-comment">// å¦‚æœæ˜¯leftæˆ–è€…rightï¼Œåˆ™æ˜¯å·¦å³ç»“æ„</span>
    <span class="hljs-keyword">return</span> widget.position == TabBarPosition.top || widget.position == TabBarPosition.bottom
        ? Column(
          children: children,
        )
        : Row(
          children: children,
        );
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-comment">// é€šè¿‡çˆ¶å®¹å™¨çš„çº¦æŸåŠ¨æ€æ„å»ºå­éƒ¨ä»¶</span>
    <span class="hljs-keyword">return</span> LayoutBuilder(
      builder: (_, BoxConstraints boxConstraints) =&gt; _buildTab(boxConstraints),
    );
  }
}
</code></pre>
<p>å®Œæˆç¼–ç åå°±å¼€å§‹æµ‹è¯•ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'../widgets/page19/customize_tab.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Page19</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> Page19({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;Page19&gt; createState() =&gt; _Page19State();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_Page19State</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">Page19</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  <span class="hljs-comment">// ç”¨äºåŠ¨æ€åˆ‡æ¢tab barçš„ä½ç½®</span>
  TabBarPosition _tabBarPosition = TabBarPosition.top;

  <span class="hljs-comment">/// <span class="markdown">æ„å»ºtabé¡¹</span></span>
  Widget _buildTab(<span class="hljs-built_in">String</span> txt) {
    <span class="hljs-keyword">return</span> Text(
      txt,
      style: <span class="hljs-keyword">const</span> TextStyle(
        fontSize: <span class="hljs-number">14</span>,
      ),
    );
  }

  <span class="hljs-comment">/// <span class="markdown">æ„å»ºtab view</span></span>
  Widget _buildTabView(<span class="hljs-built_in">String</span> txt) {
    <span class="hljs-keyword">return</span> Container(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">20</span>),
      color: Colors.grey,
      child: Column(
        children: [
          Container(
            width: <span class="hljs-built_in">double</span>.infinity,
            height: <span class="hljs-number">60</span>,
            decoration: BoxDecoration(
              color: Colors.amber,
              borderRadius: BorderRadius.circular(<span class="hljs-number">20</span>),
            ),
            alignment: Alignment.center,
            child: Text(txt),
          )
        ],
      ),
    );
  }

  <span class="hljs-comment">/// <span class="markdown">æ”¹å˜tab barçš„ä½ç½®</span></span>
  <span class="hljs-keyword">void</span> _onChangePosition(TabBarPosition tabBarPosition) {
    setState(() {
      _tabBarPosition = tabBarPosition;
    });
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      backgroundColor: Colors.white,
      body: Column(
        children: [
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">100</span>,),

          Expanded(
            child: CustomizeTab(
              tabBarHeight: <span class="hljs-number">100</span>,
              tabBarBackgroundColor: Colors.amber,
              tabBarPadding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(
                horizontal: <span class="hljs-number">20</span>,
              ),
              unselectedColor: Colors.black,
              selectedColor: Colors.white,
              tabBarOptionPadding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(
                horizontal: <span class="hljs-number">15</span>,
                vertical: <span class="hljs-number">5</span>,
              ),
              indicatorColor: Colors.orange,
              position: _tabBarPosition,
              onChangeTabIndex: (index) {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">'å½“å‰çš„ç´¢å¼•ä¸ºï¼š<span class="hljs-subst">$index</span>'</span>);
              },
              tabs: [<span class="hljs-string">'tab1'</span>, <span class="hljs-string">'tab2'</span>, <span class="hljs-string">'tab3'</span>, <span class="hljs-string">'tab4'</span>, <span class="hljs-string">'tab5'</span>].map(
                (item) =&gt; _buildTab(item),
              ).toList(),
              tabViews: [<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, <span class="hljs-string">'3'</span>, <span class="hljs-string">'4'</span>, <span class="hljs-string">'5'</span>].map(
                (item) =&gt; _buildTabView(item),
              ).toList(),
            ),
          ),

          Container(
            height: <span class="hljs-number">200</span>,
            color: Colors.black,
            padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="hljs-number">20</span>),
            child: Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                ElevatedButton(
                  onPressed: () =&gt; _onChangePosition(TabBarPosition.left),
                  child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'å·¦'</span>),
                ),
                ElevatedButton(
                  onPressed: () =&gt; _onChangePosition(TabBarPosition.right),
                  child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'å³'</span>),
                ),
                ElevatedButton(
                  onPressed: () =&gt; _onChangePosition(TabBarPosition.top),
                  child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'ä¸Š'</span>),
                ),
                ElevatedButton(
                  onPressed: () =&gt; _onChangePosition(TabBarPosition.bottom),
                  child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'ä¸‹'</span>),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/361ac0f9e57142edbf19456dddcae10f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026962&amp;x-signature=qADqaxBzNYF1%2By%2FuM051d7dcj%2B4%3D" alt="image13.gif" loading="lazy"/></p>
<p>è‡³æ­¤æˆ‘ä»¬å°±ç®€å•å°è£…äº†ä¸€ä¸ªtabï¼Œæå¤§çš„æ–¹ä¾¿äº†ä½¿ç”¨ã€‚</p>
<p>æ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ã€å‰ç«¯å­¦ä¹ å°è¥åœ°ã€‘ï¼Œä¸å®šæ—¶ä¼šåˆ†äº«ä¸€äº›å°åŠŸèƒ½ï½</p>
<p>æ–‡ç« åˆ°æ­¤å°±ç»“æŸäº†ï¼Œæ„Ÿè°¢é˜…è¯»ï¼Œæ‹œæ‹œï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React ç»„ä»¶çš„ç»„åˆæ¨¡å¼ä¹‹é“ (Composition Pattern)]]></title>    <link>https://juejin.cn/post/7577675494067896346</link>    <guid>https://juejin.cn/post/7577675494067896346</guid>    <pubDate>2025-11-29T14:46:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577675494067896346" data-draft-id="7577693903018360858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React ç»„ä»¶çš„ç»„åˆæ¨¡å¼ä¹‹é“ (Composition Pattern)"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-29T14:46:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iMonster"/> <meta itemprop="url" content="https://juejin.cn/user/1785262612681832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React ç»„ä»¶çš„ç»„åˆæ¨¡å¼ä¹‹é“ (Composition Pattern)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1785262612681832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iMonster
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T14:46:32.000Z" title="Sat Nov 29 2025 14:46:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŸºäº React Universe Conf 2025 ä¸­ Fernando Rojo çš„æ¼”è®²ã€ŠComposition is all you needã€‹ï¼Œä»¥ä¸‹æ˜¯å…³äºå¦‚ä½•ä½¿ç”¨**ç»„åˆæ¨¡å¼ï¼ˆComposition Patternï¼‰**é‡æ„å¤æ‚ React ç»„ä»¶çš„æ•™ç¨‹å’Œä»£ç æ€»ç»“ã€‚</p>
<hr/>
<h2 data-id="heading-0">React ç»„ä»¶çš„ç»„åˆæ¨¡å¼ä¹‹é“ (Composition Pattern)</h2>
<h3 data-id="heading-1">1. æ ¸å¿ƒé—®é¢˜ï¼šå•ä½“ç»„ä»¶çš„é™·é˜± (The Monolith Trap)</h3>
<p>åœ¨å¼€å‘åˆæœŸï¼Œæˆ‘ä»¬é€šå¸¸åˆ›å»ºä¸€ä¸ªç®€å•çš„ç»„ä»¶ï¼ˆå¦‚ <code>Composer</code> è¾“å…¥æ¡†ï¼‰ã€‚éšç€éœ€æ±‚å¢åŠ ï¼ˆæ”¯æŒå¤šæ€ã€ç¼–è¾‘æ¨¡å¼ã€è½¬å‘æ¨¡å¼ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¾€å¾€é€šè¿‡æ·»åŠ  <code>Boolean</code> å±æ€§æ¥æ§åˆ¶åŠŸèƒ½ã€‚</p>
<p><strong>åæ¨¡å¼ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// âŒ å…¸å‹çš„â€œå•ä½“â€ç»„ä»¶ï¼Œå……æ»¡æ¡ä»¶åˆ¤æ–­</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Composer</span>(<span class="hljs-params">{ 
  onSubmit, 
  isThread, 
  isEditingMessage, 
  initialText, 
  onCancel 
}</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"composer"</span>&gt;</span>
      {/* åªæœ‰éç¼–è¾‘æ¨¡å¼æ‰æ”¯æŒæ‹–æ‹½ */}
      {!isEditingMessage &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">DropZone</span> /&gt;</span>}
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">{initialText}</span> /&gt;</span>
      
      {/* çº¿ç¨‹æ¨¡å¼ä¸‹çš„é¢å¤–é€‰é¡¹ */}
      {isThread &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Checkbox</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"Also send to channel"</span> /&gt;</span>}
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span>&gt;</span>
        {/* åªæœ‰éç¼–è¾‘æ¨¡å¼æ‰æ˜¾ç¤ºé™„ä»¶æŒ‰é’® */}
        {!isEditingMessage &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">AttachmentButton</span> /&gt;</span>}
        
        {/* æäº¤æŒ‰é’®é€»è¾‘å¤æ‚ */}
        {isEditingMessage ? (
           <span class="hljs-tag">&lt;&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onCancel}</span>&gt;</span>Cancel<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onSubmit}</span>&gt;</span>Save<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
           <span class="hljs-tag">&lt;/&gt;</span>
        ) : (
           <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onSubmit}</span>&gt;</span>Send<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Footer</span>&gt;</span></span>
    &lt;/div&gt;
  );
}
</code></pre>
<p><strong>ç¼ºç‚¹ï¼š</strong> ä»£ç éš¾ä»¥ç»´æŠ¤ï¼Œæ¡ä»¶æ¸²æŸ“ï¼ˆTernary Hellï¼‰æ³›æ»¥ï¼Œä¸”å®¹æ˜“å‡ºç°ä¸å¯èƒ½çš„çŠ¶æ€ç»„åˆã€‚</p>
<hr/>
<h3 data-id="heading-2">2. è§£å†³æ–¹æ¡ˆï¼šç»„åˆæ¨¡å¼ (Composition)</h3>
<p>ä¸å…¶é€šè¿‡å±æ€§ï¼ˆPropsï¼‰å‘Šè¯‰ç»„ä»¶<strong>åšä»€ä¹ˆ</strong>ï¼Œä¸å¦‚é€šè¿‡å­ç»„ä»¶ï¼ˆChildrenï¼‰ç›´æ¥<strong>æ„å»º</strong>ç»„ä»¶ã€‚è¿™ç§æ–¹å¼ç±»ä¼¼äº <code>Radix UI</code> çš„è®¾è®¡ç†å¿µã€‚</p>
<p>æˆ‘ä»¬å°†å¤§ç»„ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªå°çš„ã€èŒè´£å•ä¸€çš„å­ç»„ä»¶ï¼Œå¹¶é€šè¿‡ <code>Context</code> å…±äº«çŠ¶æ€ã€‚</p>
<h4 data-id="heading-3">åŸºç¡€æ¶æ„ä»£ç </h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 1. åˆ›å»º Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ComposerContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 2. Provider ç»„ä»¶ï¼šç®¡ç†çŠ¶æ€å’Œå¯¹å¤–æ¥å£</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ComposerProvider</span> = (<span class="hljs-params">{ children, state, actions, meta }</span>) =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ComposerContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">state</span>, <span class="hljs-attr">actions</span>, <span class="hljs-attr">meta</span> }}&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ComposerContext.Provider</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// 3. å­ç»„ä»¶ï¼šæ¶ˆè´¹ Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ComposerInput</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { state, actions } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ComposerContext</span>);
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
      <span class="hljs-attr">value</span>=<span class="hljs-string">{state.text}</span> 
      <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> actions.update(e.target.value)} 
    /&gt;</span>
  );
};

<span class="hljs-comment">// ... å…¶ä»–å­ç»„ä»¶ (Composer.Header, Composer.Footer, etc.)</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">3. å®æˆ˜é‡æ„ï¼šæ„å»ºä¸åŒçš„ Composer</h3>
<p>é€šè¿‡ç»„åˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹å†…éƒ¨é€»è¾‘çš„æƒ…å†µä¸‹ï¼Œæ„å»ºå‡ºå®Œå…¨ä¸åŒçš„ UI å˜ä½“ã€‚</p>
<h4 data-id="heading-5">åœºæ™¯ Aï¼šåŸºç¡€é¢‘é“è¾“å…¥æ¡† (Channel Composer)</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChannelComposer</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰ Hook è·å–å…¨å±€é¢‘é“é€»è¾‘</span>
  <span class="hljs-keyword">const</span> { state, actions } = <span class="hljs-title function_">useChannelLogic</span>(); 

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Composer.Provider</span> <span class="hljs-attr">state</span>=<span class="hljs-string">{state}</span> <span class="hljs-attr">actions</span>=<span class="hljs-string">{actions}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Composer.DropZone</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Frame</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Header</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Input</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Footer</span>&gt;</span>
          {/* ä½¿ç”¨å°è£…å¥½çš„é€šç”¨æ“ä½œç»„ */}
          <span class="hljs-tag">&lt;<span class="hljs-name">Composer.CommonActions</span> /&gt;</span> 
          <span class="hljs-tag">&lt;<span class="hljs-name">Composer.SubmitButton</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Composer.Footer</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Composer.Frame</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Composer.Provider</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-6">åœºæ™¯ Bï¼šç¼–è¾‘æ¶ˆæ¯è¾“å…¥æ¡† (Edit Message Composer)</h4>
<p><strong>éœ€æ±‚å·®å¼‚ï¼š</strong></p>
<ol>
<li>ä¸éœ€è¦æ‹–æ‹½ä¸Šä¼  (<code>DropZone</code>)ã€‚</li>
<li>åº•éƒ¨æŒ‰é’®ä¸åŒï¼ˆå–æ¶ˆ/ä¿å­˜ï¼‰ã€‚</li>
<li>æŸäº›æ“ä½œæŒ‰é’®ä¸å¯è§ï¼ˆå¦‚é™„ä»¶ï¼‰ã€‚</li>
</ol>
<p><strong>ç»„åˆå®ç°ï¼š</strong>
æˆ‘ä»¬åªéœ€è¦<strong>ä¸æ¸²æŸ“</strong>ä¸éœ€è¦çš„ç»„ä»¶ï¼Œå¹¶<strong>æ›¿æ¢</strong>åº•éƒ¨çš„æŒ‰é’®å³å¯ï¼Œæ— éœ€ä»»ä½• <code>Boolean</code> å±æ€§ã€‚</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">EditMessageComposer</span>(<span class="hljs-params">{ messageId, initialText, onCancel }</span>) {
  <span class="hljs-keyword">const</span> { state, actions } = <span class="hljs-title function_">useEditMessageLogic</span>(messageId, initialText);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Composer.Provider</span> <span class="hljs-attr">state</span>=<span class="hljs-string">{state}</span> <span class="hljs-attr">actions</span>=<span class="hljs-string">{actions}</span>&gt;</span>
      {/* ç§»é™¤ DropZone */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Frame</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Header</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Input</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Footer</span>&gt;</span>
          {/* æ‰‹åŠ¨åˆ—å‡ºéœ€è¦çš„ Actionï¼Œè€Œä¸æ˜¯ç”¨é€šç”¨çš„ */}
          <span class="hljs-tag">&lt;<span class="hljs-name">Composer.FormatText</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Emoji</span> /&gt;</span>
          
          {/* è‡ªå®šä¹‰åº•éƒ¨æŒ‰é’®å¸ƒå±€ */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex gap-2"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onCancel}</span>&gt;</span>Cancel<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{actions.submit}</span>&gt;</span>Save<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Composer.Footer</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Composer.Frame</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Composer.Provider</span>&gt;</span></span>
  );
}
</code></pre>
<hr/>
<h3 data-id="heading-7">4. è¿›é˜¶æŠ€å·§ï¼šçŠ¶æ€æå‡ä¸è§£è€¦ (Lift Your State)</h3>
<p>è¿™æ˜¯è¯¥æ¼”è®²æœ€æ ¸å¿ƒçš„è§‚ç‚¹ã€‚<strong>çŠ¶æ€ç®¡ç†åº”è¯¥ä¸ UI ç»„ä»¶è§£è€¦ã€‚</strong></p>
<p><code>Composer</code> çš„ UI ç»„ä»¶ï¼ˆInput, Footer ç­‰ï¼‰ä¸åº”è¯¥çŸ¥é“çŠ¶æ€æ˜¯æ¥è‡ªäº <code>useState</code>ï¼ˆæœ¬åœ°çŠ¶æ€ï¼‰è¿˜æ˜¯ <code>useGlobalStore</code>ï¼ˆå…¨å±€åŒæ­¥çŠ¶æ€ï¼‰ã€‚å®ƒä»¬åªè´Ÿè´£æ¸²æŸ“ Provider æä¾›çš„æ•°æ®ã€‚</p>
<h4 data-id="heading-8">åœºæ™¯ Cï¼šè½¬å‘æ¶ˆæ¯ (Forward Message)</h4>
<p><strong>å¤æ‚ç‚¹ï¼š</strong></p>
<ol>
<li>è¿™æ˜¯ä¸€ä¸ªæ¨¡æ€æ¡†ï¼ˆModalï¼‰ã€‚</li>
<li>æäº¤æŒ‰é’®åœ¨ Composer <strong>å¤–éƒ¨</strong>ï¼ˆModal çš„ Footerï¼‰ã€‚</li>
<li>çŠ¶æ€æ˜¯ä¸´æ—¶çš„ï¼ˆEphemeralï¼‰ï¼Œä¸éœ€è¦åŒæ­¥åˆ°æœåŠ¡å™¨ã€‚</li>
</ol>
<p><strong>ä»£ç å®ç°ï¼š</strong></p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ForwardMessageDialog</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. çŠ¶æ€æå‡ï¼šåœ¨çˆ¶ç»„ä»¶æ§åˆ¶çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);
  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// å®šä¹‰ç¬¦åˆ Provider æ¥å£çš„ state å’Œ actions</span>
  <span class="hljs-keyword">const</span> state = { text };
  <span class="hljs-keyword">const</span> actions = { 
    <span class="hljs-attr">update</span>: setText, 
    <span class="hljs-attr">submit</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Forwarding:"</span>, text) 
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Dialog</span>&gt;</span>
      {/* 2. å°†æœ¬åœ°çŠ¶æ€æ³¨å…¥ Provider */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Provider</span> <span class="hljs-attr">state</span>=<span class="hljs-string">{state}</span> <span class="hljs-attr">actions</span>=<span class="hljs-string">{actions}</span> <span class="hljs-attr">meta</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">inputRef</span> }}&gt;</span>
        
        {/* UI éƒ¨åˆ† */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Frame</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Input</span> /&gt;</span> 
          <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Footer</span>&gt;</span>
             {/* åªæœ‰å°‘é‡çš„æ“ä½œæŒ‰é’® */}
             <span class="hljs-tag">&lt;<span class="hljs-name">Composer.Emoji</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Composer.Footer</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Composer.Frame</span>&gt;</span>

        {/* 3. å¤–éƒ¨æŒ‰é’®ä¹Ÿå¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ª Context */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Dialog.Footer</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">CopyLinkButton</span> /&gt;</span>
           {/* è¿™ä¸ªæŒ‰é’®åœ¨ Composer å¤–éƒ¨ï¼Œä½†èƒ½è§¦å‘æäº¤ */}
           <span class="hljs-tag">&lt;<span class="hljs-name">ForwardButton</span> /&gt;</span> 
        <span class="hljs-tag">&lt;/<span class="hljs-name">Dialog.Footer</span>&gt;</span>

      <span class="hljs-tag">&lt;/<span class="hljs-name">Composer.Provider</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Dialog</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// å¤–éƒ¨æŒ‰é’®å®ç°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ForwardButton</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// å› ä¸ºè¢«åŒ…åœ¨ Composer.Provider å†…ï¼Œä¾ç„¶å¯ä»¥è®¿é—® context</span>
  <span class="hljs-keyword">const</span> { actions } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ComposerContext</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{actions.submit}</span>&gt;</span>Forward<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span>;
}
</code></pre>
<hr/>
<h3 data-id="heading-9">æ€»ç»“ï¼šä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ</h3>
<ol>
<li><strong>æ¶ˆé™¤â€œå¸ƒå°”åœ°ç‹±â€ï¼š</strong> ä¸å†éœ€è¦ä¼ é€’ <code>isEditing={true}</code>ã€<code>isForwarding={true}</code> å¹¶åœ¨ç»„ä»¶æ·±å¤„åšåˆ¤æ–­ã€‚éœ€è¦ä»€ä¹ˆåŠŸèƒ½ï¼Œå°±æ¸²æŸ“ä»€ä¹ˆç»„ä»¶ã€‚</li>
<li><strong>çŠ¶æ€çµæ´»æ€§ï¼š</strong> åŒä¸€å¥— UI ç»„ä»¶å¯ä»¥é…åˆ <code>useState</code>ï¼ˆæœ¬åœ°ï¼‰ã€<code>Redux/Zustand</code>ï¼ˆå…¨å±€ï¼‰ç”šè‡³ <code>Ref</code> ä¸€èµ·å·¥ä½œï¼Œåªè¦é€šè¿‡ Provider ä¼ å…¥å³å¯ã€‚</li>
<li><strong>å¯ç»´æŠ¤æ€§ï¼š</strong> å½“éœ€è¦åœ¨â€œè½¬å‘â€åŠŸèƒ½ä¸­ä¿®æ”¹æŒ‰é’®æ ·å¼æ—¶ï¼Œä½ åªéœ€è¦ä¿®æ”¹ <code>ForwardMessageDialog</code>ï¼Œå®Œå…¨ä¸ä¼šå½±å“åˆ°â€œé¢‘é“èŠå¤©â€çš„ä»£ç ã€‚</li>
<li><strong>AI å‹å¥½ï¼š</strong> è¿™ç§ç»“æ„åŒ–ã€å£°æ˜å¼çš„ä»£ç æ›´å®¹æ˜“è¢« AI ç†è§£å’Œç”Ÿæˆï¼Œå‡å°‘äº† AI äº§ç”Ÿå¹»è§‰ï¼ˆHallucinationï¼‰æˆ–é€»è¾‘é”™è¯¯çš„æ¦‚ç‡ã€‚</li>
</ol>
<p><strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong>
ä¸è¦æŠŠæ‰€æœ‰çš„é€»è¾‘å¡è¿›ä¸€ä¸ªç»„ä»¶é‡Œã€‚<strong>æå‡ä½ çš„çŠ¶æ€ (Lift your state)ï¼Œç»„åˆä½ çš„å†…éƒ¨ç»„ä»¶ (Compose your internals)ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HTML5æ•²å‡»ä¹ PART--1]]></title>    <link>https://juejin.cn/post/7577715145121644598</link>    <guid>https://juejin.cn/post/7577715145121644598</guid>    <pubDate>2025-11-29T15:53:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577715145121644598" data-draft-id="7576838095519580211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HTML5æ•²å‡»ä¹ PART--1"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2025-11-29T15:53:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="izx888"/> <meta itemprop="url" content="https://juejin.cn/user/1241762540820323"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HTML5æ•²å‡»ä¹ PART--1
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1241762540820323/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    izx888
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T15:53:43.000Z" title="Sat Nov 29 2025 15:53:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">HTML5 æ•²å‡»ä¹ï¼šå‰ç«¯å¼€å‘å®æˆ˜ PART-1 â€”â€” ç”¨ä»£ç â€œå¼¹å¥â€ä½ çš„ç¬¬ä¸€æ¶ç½‘é¡µé’¢ç´</h2>
<p>åœ¨å½“ä»Šçš„ Web å¼€å‘ä¸–ç•Œä¸­ï¼Œå‰ç«¯ä¸ä»…æ˜¯ç”¨æˆ·ä¸äº§å“ä¹‹é—´çš„æ¡¥æ¢ï¼Œæ›´æ˜¯åˆ›æ„ä¸æŠ€æœ¯èåˆçš„èˆå°ã€‚è€Œä½œä¸ºå‰ç«¯ä¸‰å¤§åŸºçŸ³â€”â€”<strong>HTMLã€CSS å’Œ JavaScript</strong>â€”â€”å®ƒä»¬åˆ†åˆ«æ„å»ºäº†ç½‘é¡µçš„â€œéª¨éª¼â€ã€â€œå¤–è²Œâ€ä¸â€œçµé­‚â€ã€‚æœ¬æ–‡å°†ä»¥ä¸€ä¸ªè¶£å‘³åè¶³çš„å°é¡¹ç›® <strong>â€œHTML5 æ¨¡æ‹Ÿé’¢ç´â€</strong> ä¸ºåˆ‡å…¥ç‚¹ï¼Œå¸¦ä½ ç³»ç»Ÿç†è§£å‰ç«¯å¼€å‘çš„æ ¸å¿ƒé€»è¾‘ï¼Œå¹¶æŒæ¡é«˜æ•ˆå®ç°äº¤äº’å¼åº”ç”¨çš„å…³é”®æŠ€å·§ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€å‰ç«¯ä¸‰å‰‘å®¢ï¼šç»“æ„ Ã— æ ·å¼ Ã— è¡Œä¸º</h3>
<p>ä»»ä½•ç°ä»£ç½‘é¡µéƒ½ç¦»ä¸å¼€è¿™ä¸‰ä½â€œä¸»è§’â€çš„ååŒå·¥ä½œï¼š</p>
<ul>
<li><strong>HTMLï¼ˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼‰</strong> ï¼šè´Ÿè´£å®šä¹‰é¡µé¢çš„<strong>ç»“æ„ä¸è¯­ä¹‰</strong>ã€‚<br/>
åœ¨æ¨¡æ‹Ÿé’¢ç´ä¸­ï¼Œæ¯ä¸ªç´é”®éƒ½æ˜¯ä¸€ä¸ª HTML å…ƒç´ ï¼ˆå¦‚ <code>&lt;div&gt;</code> æˆ– <code>&lt;span&gt;</code>ï¼‰ï¼Œå…±åŒç»„æˆå®Œæ•´çš„é”®ç›˜å¸ƒå±€ã€‚</li>
<li><strong>CSSï¼ˆå±‚å æ ·å¼è¡¨ï¼‰</strong> ï¼šæŒæ§é¡µé¢çš„<strong>è§†è§‰è¡¨ç°</strong>ã€‚<br/>
å®ƒè®©ç™½é”®æ´ç™½ã€é»‘é”®æ·±é‚ƒï¼Œè¿˜èƒ½é€šè¿‡ <code>:hover</code>ã€<code>:active</code> ç­‰ä¼ªç±»æ·»åŠ ç‚¹å‡»åé¦ˆï¼Œç”šè‡³ç”¨ <code>transition</code> å®ç°å¹³æ»‘åŠ¨ç”»ï¼Œèµ‹äºˆç´é”®â€œç”Ÿå‘½æ„Ÿâ€ã€‚</li>
<li><strong>JavaScript</strong>ï¼šé©±åŠ¨é¡µé¢çš„<strong>äº¤äº’è¡Œä¸º</strong>ã€‚<br/>
å®ƒç›‘å¬ç”¨æˆ·çš„ç‚¹å‡»æˆ–é”®ç›˜è¾“å…¥ï¼Œè§¦å‘å¯¹åº”éŸ³ç¬¦çš„æ’­æ”¾ï¼ŒçœŸæ­£è®©è¿™æ¶â€œæ•°å­—é’¢ç´â€å‘å‡ºå£°éŸ³â€”â€”è¿™æ‰æ˜¯â€œæ•²å‡»ä¹â€çš„æ ¸å¿ƒï¼</li>
</ul>
<blockquote>
<p><strong>è®¾è®¡å“²å­¦</strong>ï¼šç»“æ„ã€æ ·å¼ã€è¡Œä¸ºåˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰æ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„åŸºæœ¬åŸåˆ™ã€‚æ¸…æ™°çš„èŒè´£åˆ’åˆ†ï¼Œè®©ä»£ç æ›´æ˜“ç»´æŠ¤ã€æ‰©å±•å’Œåä½œã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">äºŒã€HTML5 åŸºç¡€ï¼šä»éª¨æ¶æ­å»ºå¼€å§‹</h3>
<p>HTML5 æ˜¯å½“å‰ Web æ ‡å‡†çš„ä¸»æµç‰ˆæœ¬ï¼Œå…¶æ ‡å¿—æ€§å¼€å¤´æ˜¯ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
</code></pre>
<p>è¿™ä¸€è¡Œå£°æ˜å‘Šè¯‰æµè§ˆå™¨ï¼šâ€œè¯·ä»¥æ ‡å‡†æ¨¡å¼è§£ææ­¤æ–‡æ¡£â€ï¼Œé¿å…å› â€œæ€ªå¼‚æ¨¡å¼â€ï¼ˆQuirks Modeï¼‰å¯¼è‡´çš„æ¸²æŸ“ä¸ä¸€è‡´é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨ VS Code ç­‰ç°ä»£ç¼–è¾‘å™¨æ—¶ï¼Œåªéœ€è¾“å…¥ <code>!</code> å¹¶æŒ‰ <code>Tab</code>ï¼Œå³å¯è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ HTML5 æ¨¡æ¿ï¼Œæå¤§æå‡å¼€å‘æ•ˆç‡ã€‚</p>
<h4 data-id="heading-3">æ„å»ºç´é”®ç»“æ„</h4>
<p>åœ¨ <code>&lt;body&gt;</code> ä¸­ï¼Œæˆ‘ä»¬ç”¨ä»¥ä¸‹æ–¹å¼ç»„ç»‡ç´é”®ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>&lt;div class="piano"&gt;</code> ä½œä¸ºæ•´ä¸ªé’¢ç´çš„å®¹å™¨ï¼›</li>
<li>å†…éƒ¨åµŒå¥—å¤šä¸ª <code>&lt;div class="key white"&gt;</code> å’Œ <code>&lt;div class="key black"&gt;</code> åˆ†åˆ«ä»£è¡¨ç™½é”®ä¸é»‘é”®ã€‚</li>
</ul>
<blockquote>
<p><strong>å°çŸ¥è¯†</strong>ï¼š</p>
<ul>
<li><code>&lt;div&gt;</code> æ˜¯<strong>å—çº§å…ƒç´ </strong>ï¼Œé»˜è®¤ç‹¬å ä¸€è¡Œï¼Œå¯è®¾ç½®å®½é«˜ï¼Œé€‚åˆåšå¸ƒå±€å®¹å™¨ï¼›</li>
<li><code>&lt;span&gt;</code> æ˜¯<strong>è¡Œå†…å…ƒç´ </strong>ï¼Œå°ºå¯¸ç”±å†…å®¹å†³å®šï¼Œé€šå¸¸ç”¨äºåŒ…è£¹æ–‡æœ¬ã€‚<br/>
ç†è§£äºŒè€…åŒºåˆ«ï¼Œæ˜¯æŒæ¡é¡µé¢å¸ƒå±€çš„ç¬¬ä¸€æ­¥ã€‚</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-4">ä¸‰ã€CSS æ ·å¼ï¼šæ‰“é€ é€¼çœŸçš„é’¢ç´å¤–è§‚</h3>
<p>æœ‰äº†ç»“æ„ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯â€œåŒ–å¦†â€â€”â€”ç”¨ CSS èµ‹äºˆç´é”®çœŸå®æ„Ÿï¼š</p>
<ul>
<li>
<p><strong>åŸºç¡€æ ·å¼</strong>ï¼šè®¾ç½®ç™½é”®èƒŒæ™¯ä¸ºç™½è‰²ã€é»‘é”®ä¸ºé»‘è‰²ï¼Œè°ƒæ•´å®½åº¦ã€é«˜åº¦ã€è¾¹è·ï¼›</p>
</li>
<li>
<p><strong>å¸ƒå±€æ–¹æ¡ˆ</strong>ï¼šæ¨èä½¿ç”¨ <strong>Flexbox</strong>ï¼ˆè€Œéè¿‡æ—¶çš„ <code>float</code>ï¼‰å®ç°ç´é”®æ°´å¹³æ’åˆ—ï¼Œä»£ç ç®€æ´ä¸”å“åº”å‹å¥½ï¼›</p>
</li>
<li>
<p><strong>äº¤äº’åé¦ˆ</strong>ï¼š</p>
<ul>
<li><code>:hover</code>ï¼šé¼ æ ‡æ‚¬åœæ—¶è½»å¾®å˜è‰²æˆ–åŠ é˜´å½±ï¼›</li>
<li><code>:active</code>ï¼šç‚¹å‡»ç¬é—´äº§ç”Ÿâ€œæŒ‰ä¸‹â€æ•ˆæœï¼›</li>
</ul>
</li>
<li>
<p><strong>å¢å¼ºè´¨æ„Ÿ</strong>ï¼šåˆ©ç”¨ <code>border-radius</code> åœ†è§’ã€<code>box-shadow</code> é˜´å½±ã€<code>transition</code> è¿‡æ¸¡åŠ¨ç”»ï¼Œè®©ç•Œé¢æ›´å…·ç°ä»£æ„Ÿã€‚</p>
</li>
</ul>
<blockquote>
<p>ç¤ºä¾‹ç‰‡æ®µï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.key</span><span class="hljs-selector-class">.white</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.1s</span>;
}
<span class="hljs-selector-class">.key</span><span class="hljs-selector-class">.white</span><span class="hljs-selector-pseudo">:active</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">2px</span>);
}
</code></pre>
</blockquote>
<hr/>
<h3 data-id="heading-5">å››ã€JavaScript è¡Œä¸ºï¼šè®©é’¢ç´çœŸæ­£â€œå‘å£°â€</h3>
<p>è¿™æ˜¯é¡¹ç›®æœ€æ¿€åŠ¨äººå¿ƒçš„éƒ¨åˆ†â€”â€”è®©ç‚¹å‡»å˜æˆéŸ³ä¹ï¼</p>
<h4 data-id="heading-6">æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼š</h4>
<ol>
<li>
<p><strong>äº‹ä»¶ç›‘å¬</strong><br/>
ä¸ºæ¯ä¸ªç´é”®ç»‘å®š <code>click</code> äº‹ä»¶ï¼Œæˆ–ç›‘å¬å…¨å±€ <code>keydown</code> é”®ç›˜äº‹ä»¶ï¼ˆå¦‚ A/S/D å¯¹åº” Do/Re/Miï¼‰ã€‚</p>
</li>
<li>
<p><strong>éŸ³é¢‘æ’­æ”¾</strong><br/>
å¯é€‰æ‹©ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li><strong><code>&lt;audio&gt;</code> æ ‡ç­¾é¢„åŠ è½½</strong>ï¼šç®€å•ç›´æ¥ï¼Œé€‚åˆåˆå­¦è€…ï¼›</li>
<li><strong>Web Audio API</strong>ï¼šæ›´å¼ºå¤§çµæ´»ï¼Œæ”¯æŒéŸ³æ•ˆåˆæˆä¸ç²¾ç¡®æ§åˆ¶ï¼ˆè¿›é˜¶æ–¹å‘ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>çŠ¶æ€ç®¡ç†</strong><br/>
é¿å…å¿«é€Ÿè¿ç‚¹å¯¼è‡´å£°éŸ³é‡å ï¼Œå¯é€šè¿‡èŠ‚æµï¼ˆthrottleï¼‰æˆ–è®°å½•â€œæ­£åœ¨æ’­æ”¾â€çŠ¶æ€æ¥ä¼˜åŒ–ä½“éªŒã€‚</p>
</li>
</ol>
<h4 data-id="heading-7">æ¨¡å—åŒ–æ€ç»´</h4>
<p>å°†åŠŸèƒ½æ‹†åˆ†ä¸ºç‹¬ç«‹å‡½æ•°ï¼š</p>
<ul>
<li><code>createPiano()</code>ï¼šåŠ¨æ€ç”Ÿæˆç´é”®ï¼›</li>
<li><code>playNote(note)</code>ï¼šæ’­æ”¾æŒ‡å®šéŸ³ç¬¦ï¼›</li>
<li><code>bindEvents()</code>ï¼šç»Ÿä¸€ç»‘å®šäº¤äº’é€»è¾‘ã€‚</li>
</ul>
<p>è¿™æ ·ä¸ä»…æå‡å¯è¯»æ€§ï¼Œä¹Ÿä¸ºåç»­æ‰©å±•ï¼ˆå¦‚æ·»åŠ å½•éŸ³ã€èŠ‚å¥è®­ç»ƒç­‰ï¼‰æ‰“ä¸‹åŸºç¡€ã€‚</p>
<hr/>
<h3 data-id="heading-8">äº”ã€ææ•ˆåˆ©å™¨ï¼šç°ä»£å‰ç«¯å¼€å‘å·¥å…·é“¾</h3>
<p>é«˜æ•ˆå¼€å‘ç¦»ä¸å¼€è¿™äº›â€œç¥åŠ©æ”»â€ï¼š</p>
<ul>
<li><strong>Emmet è¯­æ³•</strong>ï¼š<br/>
è¾“å…¥ <code>div.piano&gt;div.key*8</code> + <code>Tab</code>ï¼Œç§’é€Ÿç”Ÿæˆ 8 ä¸ªç´é”®ç»“æ„ï¼›</li>
<li><strong>Live Serverï¼ˆVS Code æ’ä»¶ï¼‰</strong> ï¼š<br/>
å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ï¼Œä¿å­˜å³è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ï¼Œæ‰€è§å³æ‰€å¾—ï¼Œè°ƒè¯•æ•ˆç‡ç¿»å€ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-9">å…­ã€é¢è¯•é«˜é¢‘è€ƒç‚¹å›é¡¾</h3>
<p>åœ¨æŠ€æœ¯é¢è¯•ä¸­ï¼Œä»¥ä¸‹æ¦‚å¿µå¸¸è¢«è€ƒå¯Ÿï¼š</p>





















<table><thead><tr><th>é—®é¢˜</th><th>ç­”æ¡ˆè¦ç‚¹</th></tr></thead><tbody><tr><td><code>&lt;!DOCTYPE html&gt;</code> çš„ä½œç”¨ï¼Ÿ</td><td>å£°æ˜ HTML5 æ–‡æ¡£ç±»å‹ï¼Œç¡®ä¿æµè§ˆå™¨ä»¥æ ‡å‡†æ¨¡å¼æ¸²æŸ“ï¼Œé¿å…å…¼å®¹æ€§é—®é¢˜ã€‚</td></tr><tr><td>HTML æ–‡ä»¶çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>ä¸€ç§ç»“æ„åŒ–æ–‡æœ¬æ–‡æ¡£ï¼Œæµè§ˆå™¨å°†å…¶è§£æä¸º DOM æ ‘ï¼Œä¾› JS æ“ä½œã€‚</td></tr><tr><td>å—çº§ vs è¡Œå†…å…ƒç´ çš„åŒºåˆ«ï¼Ÿ</td><td>å—çº§ç‹¬å ä¸€è¡Œã€å¯è®¾å®½é«˜ï¼›è¡Œå†…ä¸æ¢è¡Œã€å°ºå¯¸ç”±å†…å®¹å†³å®šã€‚</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-10">ç»“è¯­ï¼šä»â€œæ•²ä»£ç â€åˆ°â€œæ•²å‡ºæ—‹å¾‹â€</h3>
<p>é€šè¿‡â€œHTML5 æ¨¡æ‹Ÿé’¢ç´â€è¿™ä¸ªå°è€Œç¾çš„é¡¹ç›®ï¼Œæˆ‘ä»¬ä¸ä»…å®è·µäº†å‰ç«¯ä¸‰å‰‘å®¢çš„ååŒå¼€å‘æµç¨‹ï¼Œæ›´ä½“ä¼šåˆ°äº†<strong>ç”¨ä»£ç åˆ›é€ äº¤äº’ä¹è¶£</strong>çš„é­…åŠ›ã€‚ä» <code>! + Tab</code> å¿«é€Ÿæ­å»ºéª¨æ¶ï¼Œåˆ° Emmet æå‡ç¼–ç é€Ÿåº¦ï¼Œå†åˆ° Live Server å®ç°å®æ—¶é¢„è§ˆâ€”â€”ç°ä»£å‰ç«¯å¼€å‘å·²å˜å¾—å‰æ‰€æœªæœ‰çš„é«˜æ•ˆä¸ç›´è§‚ã€‚</p>
<p>æœªæ¥ï¼Œéšç€ AI ä¸ Web æŠ€æœ¯çš„æ·±åº¦èåˆï¼Œå‰ç«¯å·¥ç¨‹å¸ˆçš„è§’è‰²å°†æ›´åƒä¸€ä½â€œæ•°å­—å¯¼æ¼”â€ï¼šç”¨æŠ€æœ¯ç¼–æ’ç”¨æˆ·ä½“éªŒï¼Œç”¨åˆ›æ„ä¼ é€’æƒ…æ„Ÿä»·å€¼ã€‚è€Œè¿™ä¸€åˆ‡çš„èµ·ç‚¹ï¼Œæ­£æ˜¯å¯¹ HTML5 çš„æ·±åˆ»ç†è§£ä¸çµæ´»è¿ç”¨ã€‚</p>
<blockquote>
<p><strong>åŠ¨æ‰‹è¯•è¯•å§ï¼</strong><br/>
æ‰“å¼€ä½ çš„ç¼–è¾‘å™¨ï¼Œæ•²ä¸‹ç¬¬ä¸€è¡Œä»£ç ï¼Œè®©æµè§ˆå™¨ä¸ºä½ å¥å“å±äºç¨‹åºå‘˜çš„æ—‹å¾‹ ğŸ¹âœ¨</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openrestyå®¹å™¨å¯¼å‡ºç«ç„°å›¾]]></title>    <link>https://juejin.cn/post/7577689171222708274</link>    <guid>https://juejin.cn/post/7577689171222708274</guid>    <pubDate>2025-11-29T15:28:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577689171222708274" data-draft-id="7577675494067372058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openrestyå®¹å™¨å¯¼å‡ºç«ç„°å›¾"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-29T15:28:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£çš„å½’å®¿55"/> <meta itemprop="url" content="https://juejin.cn/user/2840793779297303"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openrestyå®¹å™¨å¯¼å‡ºç«ç„°å›¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2840793779297303/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£çš„å½’å®¿55
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T15:28:02.000Z" title="Sat Nov 29 2025 15:28:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘ä»¬çº¿ä¸Šä½¿ç”¨çš„æ˜¯å®¹å™¨éƒ¨ç½²çš„openrestyä½œä¸ºç½‘å…³ï¼Œç”¨äºå¤„ç†è¯·æ±‚è½¬å‘ä»¥åŠä½¿ç”¨luaä»£ç†å¤„ç†éƒ¨åˆ†è¯·æ±‚ã€‚æœ‰æ—¶å€™ä¼šå‡ºç°åœ¨æµé‡æ²¡æœ‰å¢åŠ ç‰¹åˆ«å¤šï¼Œä½†æ˜¯openrestyçš„cpuè·‘æ»¡çš„æƒ…å†µã€‚ä¸ºäº†èƒ½å¿«é€ŸæŸ¥å‡ºç“¶é¢ˆå¹¶è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬å¢åŠ äº†ä¸€äº›ç›‘æ§ï¼Œç”¨äºæ’æŸ¥å„ç§æƒ…å†µå¯¼è‡´çš„nginx cpuå‡é«˜é—®é¢˜ã€‚è¿™é‡Œä¸»è¦ä»‹ç»ä¸‹ openrestyå¯¼å‡ºcpuç«ç„°å›¾çš„æ–¹å¼ï¼Œé€šè¿‡cpuç«ç„°å›¾å¯ä»¥å¿«é€Ÿå‘ç°å ç”¨cpué«˜çš„å‡½æ•°ï¼Œä»è€ŒååŠ©å¿«é€Ÿå®šä½é—®é¢˜ä»¥åŠè¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>
<p>ç›®å‰ç½‘ä¸Šçš„æ–‡æ¡£å¤§éƒ¨åˆ†éƒ½æ˜¯åœ¨ä¸»æœºä¸Šå¯¼å‡ºç«ç„°å›¾çš„ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¯¼å‡º<strong>å®¹å™¨éƒ¨ç½²çš„openresty cpuç«ç„°å›¾</strong>çš„æ–¹å¼ã€‚</p>
<p>è¿™é‡Œå…ˆç»™ä¸¤å¼ ç¤ºä¾‹å›¾ï¼Œcpuç«ç„°å›¾åˆ†ä¸ºnginxçš„cä»£ç  å’Œ å¤„ç†ä¸šåŠ¡çš„luaä»£ç  ä¸¤ç§ã€‚</p>
<p><strong>nginxç«ç„°å›¾</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ce1033bd3fe4aa5a3661e0e2283d7b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO55qE5b2S5a6_NTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034882&amp;x-signature=ZvomBb9PZgmf6Mi81QnR%2FUvIJY4%3D" alt="1.jpg" loading="lazy"/></p>
<p><strong>luaç«ç„°å›¾</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50d1abdb2e444cce9c6d8d331a0ac434~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO55qE5b2S5a6_NTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765034882&amp;x-signature=G8ebqv5LdweKcxWUIYuqxPy%2FYiI%3D" alt="2.jpg" loading="lazy"/></p>
<h3 data-id="heading-0">å¯¼å‡ºç«ç„°å›¾æµç¨‹</h3>
<h5 data-id="heading-1">ä¸€ã€ å‡†å¤‡å·¥ä½œ</h5>
<h6 data-id="heading-2">1. å®‰è£…å†…æ ¸debugåŒ…</h6>
<p>åœ¨å¯¼å‡ºç«ç„°å›¾ä¹‹å‰ï¼Œæœ‰ä¸€äº›å‡†å¤‡å·¥ä½œéœ€è¦å¤„ç†ï¼Œé¦–å…ˆæ˜¯å®‰è£…ä¸€äº›å†…æ ¸çš„debugä¿¡æ¯åŒ…å’Œå¼€å‘åŒ…ï¼Œè¿™æ ·åœ¨å¯¼å‡ºç«ç„°å›¾æ—¶ç¨‹åºæ‰çŸ¥é“å½“å‰æ‰§è¡Œçš„å‡½æ•°åç§°ï¼Œä¸ç„¶å¯¼å‡ºçš„ç«ç„°å›¾åªæœ‰ä¸€äº›å¾ˆç®€ç•¥çš„ä¿¡æ¯ï¼Œæ¯”å¦‚[unknown]ï¼Œ[libc-2.28.so] è¿™ç§ã€‚</p>
<p>å®‰è£…æ—¶éœ€è¦å…ˆæ ¹æ®ç³»ç»Ÿç‰ˆæœ¬æ‰¾åˆ°å¯¹åº”çš„debugåŒ…ï¼Œè¾“å…¥å‘½ä»¤uname -aæŸ¥è¯¢æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼Œè¿™é‡Œä»¥3.10.0-1160.76.1.el7.x86_64ä¸ºä¾‹ï¼Œé¦–å…ˆæ‰¾åˆ°ä¸‹è½½å¯¹åº”å†…æ ¸debugåŒ…çš„ç½‘ç«™ï¼Œç„¶ååœ¨æœºå™¨ä¸Šé€šè¿‡wgetä¸‹è½½ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">éœ€è¦ä¸‹è½½çš„åŒ…
kernel-debuginfo-3.10.0-1160.76.1.el7.x86_64.rpm
kernel-debuginfo-common-x86_64-3.10.0-1160.76.1.el7.x86_64.rpm
kernel-devel-3.10.0-1160.76.1.el7.x86_64.rpm

ä¸‹è½½ç½‘ç«™å‚è€ƒ
http://debuginfo.centos.org/
https://buildlogs.centos.org/c7.2009.u.x86_64/kernel/

æ‰§è¡Œå‘½ä»¤ä¸‹è½½
wget http://debuginfo.centos.org/7/x86_64/kernel-debuginfo-3.10.0-1160.76.1.el7.x86_64.rpm 
wget http://debuginfo.centos.org/7/x86_64/kernel-debuginfo-common-x86_64-3.10.0-1160.76.1.el7.x86_64.rpm 
wget https://buildlogs.centos.org/c7.2009.u.x86_64/kernel/20220810161826/3.10.0-1160.76.1.el7.x86_64/kernel-devel-3.10.0-1160.76.1.el7.x86_64.rpm

å®‰è£…
rpm -ivh *3.10.0-1160.76.1.el7.x86_64.rpm
</code></pre>
<h6 data-id="heading-3">2. å®‰è£…perfï¼Œstapxxå’ŒFlameGraph</h6>
<p>perfç”¨äºå¯¼å‡ºnginx cè¯­è¨€çš„cpuå‰–æä¿¡æ¯ï¼Œstapxxç”¨äºå¯¼å‡ºluaä»£ç çš„cpuå‰–æä¿¡æ¯ï¼Œè€ŒFlameGraphåˆ™æ˜¯ç”¨äºå°†å¯¼å‡ºçš„cpuå‰–æä¿¡æ¯è½¬æ¢ä¸ºå¯é˜…è¯»çš„svgæ ¼å¼çš„ç«ç„°å›¾ã€‚</p>
<ul>
<li>perfï¼šæ‰§è¡Œyum install -y perfå‘½ä»¤å³å¯ã€‚</li>
<li>stapxxï¼š git clone <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenresty%2Fstapxx.git" target="_blank" title="https://github.com/openresty/stapxx.git" ref="nofollow noopener noreferrer">github.com/openresty/sâ€¦</a></li>
<li>FlameGraphï¼š git clone <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrendangregg%2FFlameGraph.git" target="_blank" title="https://github.com/brendangregg/FlameGraph.git" ref="nofollow noopener noreferrer">github.com/brendangregâ€¦</a></li>
</ul>
<h6 data-id="heading-4">3. åˆ¶ä½œå¯¼å‡ºluaç«ç„°å›¾çš„å·¥å…·é•œåƒ</h6>
<p>è¿™é‡Œåˆ¶ä½œä¸€ä¸ªé•œåƒï¼Œç”¨äºå¯¼å‡ºå®¹å™¨å†…çš„openrestyçš„cpuå‰–æä¿¡æ¯ã€‚éœ€è¦åˆ¶ä½œé•œåƒçš„åŸå› æˆ‘åœ¨è¿™é‡Œè¯´æ˜ä¸‹ã€‚</p>
<p>ä¹‹å‰å°è¯•è¿‡å‡ ç§æ–¹å¼å¯¼å‡ºå®¹å™¨å†…çš„openrestyçš„cpuå‰–æä¿¡æ¯ï¼Œä½†æ˜¯éƒ½ä¸å¥½å¤„ç†ã€‚</p>
<ul>
<li>
<p>ç›´æ¥åœ¨ä¸»æœºä¸Šå¯¼å‡ºï¼šå› ä¸ºå¯¼å‡ºluaçš„cpuå‰–æä¿¡æ¯çš„è¯ï¼Œéœ€è¦æœ‰å¯¹åº”openrestyç‰ˆæœ¬çš„debugåŒ…ï¼Œä¸ç„¶æ— æ³•æ˜¾ç¤ºå‡½æ•°åç§°ã€‚å› æ­¤å°è¯•äº†åœ¨ä¸»æœºä¸Šç¼–è¯‘å¹¶å®‰è£… å®¹å™¨ä¸­ä½¿ç”¨ç‰ˆæœ¬çš„openrestyï¼Œç„¶ååŠ ä¸Šdebugä¿¡æ¯ï¼Œä½†æ˜¯å‘ç°å¾ˆéš¾ç¼–è¯‘å‡ºå’Œå®¹å™¨ä¸­å®Œå…¨ä¸€æ ·çš„nginxäºŒè¿›åˆ¶ï¼Œå¯¼å‡ºcpuä¿¡æ¯æ—¶ä¼šæŠ¥é”™è¯´ openrestyçš„æ„å»ºID ä¸ä¸€è‡´ï¼Œå¹¶ä¸”ä¸»æœºå’Œå®¹å™¨é‡Œé¢çš„è™šæ‹Ÿä¸»æœºç³»ç»Ÿæœ‰åŒºåˆ«ï¼Œä¼šå¯¼è‡´stapxxç­‰ç¨‹åºæœ‰é—®é¢˜ï¼Œæ¯”å¦‚åœ¨ä¸»æœºä¸Šè¿è¡Œstapxxæ—¶ï¼Œéœ€è¦ä¿®æ”¹å¯¹åº”stapxx/tapset/luajit.sxxçš„ä»£ç ï¼Œæ”¹ä¸º32ä½çš„ï¼Œä½†æ˜¯å®¹å™¨ä¸­å¯åŠ¨openrestyçš„æ“ä½œç³»ç»Ÿæ˜¯64ä½çš„ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
</li>
<li>
<p>ç¼–è¯‘ä¸€ä¸ªåŒ…å«ä¸»æœºå†…æ ¸çš„debugåŒ…çš„å®¹å™¨ï¼Œåœ¨å®¹å™¨å†…è¿è¡Œstapxxå¯¼å‡ºluaçš„cpuå‰–æä¿¡æ¯ï¼Œä½†æ˜¯å¯¼å‡ºçš„ä¿¡æ¯ä¼šå˜å°‘ç”šè‡³æŠ¥é”™ï¼Œå› ä¸ºdockerä¸­çš„æ“ä½œç³»ç»Ÿå…¶å®ä¸åŒ…å«å†…æ ¸ï¼Œå› æ­¤åœ¨dockerå®¹å™¨ä¸­å®‰è£…ä¸»æœºçš„å†…æ ¸debugåŒ…ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å®‰è£…å®¹å™¨å†…æ“ä½œç³»ç»Ÿçš„debugåŒ…ï¼Œåˆä¼šæ‰¾ä¸åˆ°ä¿¡æ¯ã€‚å› ä¸ºå®é™…ä¸Šè¿è¡Œçš„æ“ä½œç³»ç»Ÿå†…æ ¸åªæœ‰ä¸»æœºä¸Šçš„å†…æ ¸ã€‚</p>
<p><strong>ä½¿ç”¨é•œåƒçš„åŸå› æ€»ç»“ï¼š</strong></p>
</li>
</ul>
<ol>
<li>åœ¨ä¸»æœºä¸Šå¾ˆéš¾æ‰“åŒ…å‡ºå’Œå®¹å™¨ä¸­å®Œå…¨ä¸€è‡´çš„openrestyï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨çº¿ä¸Šçš„å®¹å™¨openrestyåˆ¶ä½œä¸€ä¸ªé•œåƒï¼Œè§£å†³openrestyç‰ˆæœ¬ä¸€è‡´çš„é—®é¢˜ã€‚</li>
<li>éœ€è¦å®‰è£…openrestyçš„debugä¿¡æ¯åŒ…ï¼Œå› ä¸ºä½¿ç”¨å®¹å™¨openrestyï¼Œè¿™ä¸ªå°±å¥½å¤„ç†äº†ï¼Œç›´æ¥åœ¨ç”Ÿæˆé•œåƒæ—¶è¿è¡Œå‘½ä»¤debuginfo-install -y openresty-1.21.4.1-1.el8.x86_64 å®‰è£…</li>
<li>ä¸€ä¸ªä¸»æœºåªæœ‰ä¸€ä¸ªå†…æ ¸ï¼Œå°±æ˜¯ä¸»æœºä¸Šçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬çš„å†…æ ¸ï¼Œä½†æ˜¯å®¹å™¨å†…å¯åŠ¨openrestyçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬å¯èƒ½å’Œä¸»æœºçš„ä¸ä¸€è‡´ï¼Œè¿™ä¸ªæ€ä¹ˆå¤„ç†ã€‚  å…¶å®ä¸ç”¨ç®¡å®¹å™¨ä¸­çš„æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºå¯¼å‡ºcpuå‰–æä¿¡æ¯æ—¶æ˜¯éœ€è¦ä»å†…æ ¸æŠ“å–å‡½æ•°ä»£ç çš„ï¼Œè€Œå†…æ ¸çš„ç‰ˆæœ¬æ˜¯ä¸»æœºä¸Šæ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬ï¼Œå› æ­¤åœ¨å®¹å™¨ä¸­æŒ‚è½½ä¸»æœºä¸Šçš„ /lib/modulesï¼Œ/sys/kernel/debugå’Œ/usr/src/kernelsç›®å½•ï¼Œè¿™æ ·stapxxå°±èƒ½æ‰¾åˆ°æ‰§è¡Œå‡½æ•°å¯¹åº”çš„åç§°äº†ã€‚</li>
</ol>
<p>ä¸‹é¢æä¾›ä¸‹æ‰“é•œåƒçš„æ–‡ä»¶å’Œæµç¨‹ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">dockerfileæ–‡ä»¶ï¼š
FROM nginx:10.9.0
RUN yum -y install systemtap &amp;&amp; debuginfo-install -y openresty-1.21.4.1-1.el8.x86_64 
ENTRYPOINT [<span class="hljs-string">"tail"</span>, <span class="hljs-string">"-f"</span>, <span class="hljs-string">"/dev/null"</span>]

ç”Ÿæˆé•œåƒï¼š
docker build -t openresty-debug:2.0.0 .

å®¹å™¨å¯åŠ¨å‘½ä»¤æ˜¯ï¼š
docker run --<span class="hljs-built_in">rm</span> --name debug --pid=host -v /lib/modules:/lib/modules -v /root/debug:/root/debug -v /sys/kernel/debug:/sys/kernel/debug -v /usr/src/kernels:/usr/src/kernels --privileged --entrypoint /bin/bash  openresty-debug:2.0.0  -c <span class="hljs-string">"cd /root/debug/stapxx/ &amp;&amp; export PATH=\$PWD:\$PATH &amp;&amp; ./samples/lj-lua-stacks.sxx --skip-badvars --arg time=30 -x <span class="hljs-variable">$top_nginx_worker_pid</span> &gt; /root/debug/a.bt"</span>

å…¶ä¸­/lib/modulesï¼Œ/sys/kernel/debugå’Œ/usr/src/kernelsæ˜¯æŠŠä¸»æœºä¸Šçš„kernel debugåŒ…æŒ‚è½½è¿›æ¥
ä¹‹å‰å®‰è£…çš„stapxxï¼ŒFlameGraph æˆ‘æ˜¯æ”¾åœ¨/root/debugæ–‡ä»¶å¤¹ä¸‹ï¼Œå¦‚æœéœ€è¦æ”¾åœ¨å…¶ä»–ç›®å½•ä¸‹ï¼Œå¯ä»¥ä¿®æ”¹dockerå¯åŠ¨å‘½ä»¤ï¼Œå°†ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚

--pid=hostæ˜¯è®©å®¹å™¨ä½¿ç”¨ä¸»æœºçš„pidç©ºé—´ï¼Œæ‰èƒ½æŸ¥åˆ°nginxçš„pid
</code></pre>
<h6 data-id="heading-5">4. ä¿®æ”¹stapxxè„šæœ¬çš„ä»£ç </h6>
<p>ç›´æ¥ä½¿ç”¨stapxxè¿è¡Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹æ‰€ç¤ºçš„é”™è¯¯ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">semantic error: unable to find member <span class="hljs-symbol">'gcptr32</span>' <span class="hljs-keyword">for</span> <span class="hljs-title class_">struct</span> <span class="hljs-title function_ invoke__">GCRef</span> (alternatives: gcptr64): operator '<span class="hljs-punctuation">-&gt;</span>' at :<span class="hljs-number">449</span>:<span class="hljs-number">100</span>
        source:     gco = @<span class="hljs-title function_ invoke__">cast</span>(pt, <span class="hljs-string">"GCproto"</span>, <span class="hljs-string">"/usr/local/openresty/luajit/lib/libluajit-5.1.so.2.1.0"</span>)<span class="hljs-punctuation">-&gt;</span>chunkname<span class="hljs-punctuation">-&gt;</span>gcptr32
        
æˆ–è€…

semantic error: unable to find member <span class="hljs-symbol">'fr</span>' <span class="hljs-keyword">for</span> <span class="hljs-title class_">union</span> <span class="hljs-title function_ invoke__">TValue</span> (alternatives: gcr, i, n, it, <span class="hljs-type">u32</span>, <span class="hljs-type">u64</span>, ftsz, it64): operator '<span class="hljs-punctuation">-&gt;</span>' at :<span class="hljs-number">75</span>:<span class="hljs-number">83</span>
        source:     @<span class="hljs-title function_ invoke__">cast</span>(@tv, <span class="hljs-string">"TValue"</span>, <span class="hljs-string">"/usr/local/openresty/luajit/lib/libluajit-5.1.so.2.1.0"</span>)<span class="hljs-punctuation">-&gt;</span>fr<span class="hljs-punctuation">-&gt;</span>tp<span class="hljs-punctuation">-&gt;</span>ftsz
</code></pre>
<p>è¿™æ˜¯å› ä¸ºopenrestyä¼šå› ä¸ºç³»ç»Ÿä¸åŒè€Œä½¿ç”¨ä¸åŒçš„å®ç¼–è¯‘ï¼Œå…·ä½“çš„openrestyä»£ç å¯ä»¥é€šè¿‡ bundule/LuaJIT-2.1-20220411/src/lj_obj.hå’Œlj_arch.hæ–‡ä»¶è¿›è¡ŒæŸ¥çœ‹ï¼Œä¸»è¦æ˜¯openrestyä½¿ç”¨äº†å’Œstapxxé»˜è®¤ä»£ç çš„ä¸åŒä½æ•°çš„æŒ‡é’ˆå¯¼è‡´æŠ¥é”™ï¼Œè¿™é‡Œåªéœ€è¦ä¿®æ”¹stapxxçš„ tapset/luajit.sxxçš„ä»£ç ï¼Œæ ¹æ®æŠ¥é”™çš„æç¤ºè¿›è¡Œä¿®æ”¹å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚å°†gcptr32æ‰¹é‡æ›¿æ¢æˆgcptr64ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">å¯é€‰ï¼Œä¸‹è½½openrestyä»£ç æŸ¥çœ‹ï¼š
wget https:<span class="hljs-comment">//openresty.org/download/openresty-1.21.4.1.tar.gz</span>
ä¸»è¦æŸ¥çœ‹bundule/LuaJIT-<span class="hljs-number">2.1</span>-<span class="hljs-number">20220411</span>/src/lj_obj.hå’Œlj_arch.h  ï¼Œéœ€è¦å¯¹æ¯”stapxxä¸­ç»“æ„å’Œopenrestyä¸­çš„ç»“æœï¼Œç„¶åè¿›è¡Œä¿®æ”¹

æ‰§è¡Œå‘½ä»¤æ‰¹é‡æ›¿æ¢ï¼š
sed -i <span class="hljs-symbol">'s</span>/gcptr32/gcptr64/g' stapxx/tapset/luajit.sxx
sed -i <span class="hljs-symbol">'s</span>/<span class="hljs-punctuation">-&gt;</span>fr<span class="hljs-punctuation">-&gt;</span>tp<span class="hljs-punctuation">-&gt;</span>ftsz/<span class="hljs-punctuation">-&gt;</span>ftsz/g' stapxx/tapset/luajit.sxx
sed -i <span class="hljs-symbol">'s</span>/<span class="hljs-punctuation">-&gt;</span>fr<span class="hljs-punctuation">-&gt;</span>tp<span class="hljs-punctuation">-&gt;</span>pcr<span class="hljs-punctuation">-&gt;</span>ptr32/<span class="hljs-punctuation">-&gt;</span>ftsz/g' stapxx/tapset/luajit.sxx
sed -i <span class="hljs-symbol">'s</span>/<span class="hljs-punctuation">-&gt;</span>ptr32/<span class="hljs-punctuation">-&gt;</span>ptr64/g' stapxx/tapset/luajit.sxx
sed -i <span class="hljs-symbol">'s</span>/<span class="hljs-punctuation">-&gt;</span>fr<span class="hljs-punctuation">-&gt;</span>func/<span class="hljs-punctuation">-&gt;</span>gcr/g' stapxx/tapset/luajit.sxx
</code></pre>
<h5 data-id="heading-6">äºŒã€ å¯¼å‡ºopenrestyç«ç„°å›¾</h5>
<h6 data-id="heading-7">1. å¯¼å‡ºnginxçš„cè¯­è¨€çš„ç«ç„°å›¾</h6>
<p>è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œåªè¦æ‰§è¡Œperfå‘½ä»¤å°±å¯ä»¥å¯¼å‡ºï¼Œç„¶åé€šè¿‡FlameGraphè½¬æˆç«ç„°å›¾ï¼Œå…¶ä¸­$top_nginx_worker_pidå˜é‡æ˜¯nginx workerçš„pid</p>
<pre><code class="hljs language-bash" lang="bash">perf record -F 99 -g -p <span class="hljs-string">"<span class="hljs-variable">$top_nginx_worker_pid</span>"</span> -- <span class="hljs-built_in">sleep</span> 30
perf script | ./FlameGraph/stackcollapse-perf.pl| ./FlameGraph/flamegraph.pl &gt; ./ngx_c_flame.svg
</code></pre>
<h6 data-id="heading-8">2. å¯¼å‡ºluaçš„ç«ç„°å›¾</h6>
<p>é€šè¿‡æ‰§è¡Œdockerå‘½ä»¤å¯¼å‡ºluaçš„cpuå‰–æä¿¡æ¯ï¼Œç„¶åé€šè¿‡FlameGraphè½¬æˆç«ç„°å›¾ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">docker run --<span class="hljs-built_in">rm</span> --name debug --pid=host -v /lib/modules:/lib/modules -v /root/debug:/root/debug -v /sys/kernel/debug:/sys/kernel/debug -v /usr/src/kernels:/usr/src/kernels --privileged --entrypoint /bin/bash  openresty-debug:2.0.0  -c <span class="hljs-string">"cd /root/debug/stapxx/ &amp;&amp; export PATH=\$PWD:\$PATH &amp;&amp; ./samples/lj-lua-stacks.sxx --skip-badvars --arg time=30 -x <span class="hljs-variable">$top_nginx_worker_pid</span> &gt; /root/debug/a.bt"</span>

./FlameGraph/stackcollapse-stap.pl a.bt &gt; a.cbt
./FlameGraph/flamegraph.pl a.cbt  &gt; ngx_lua_flame.svg
</code></pre>
<h6 data-id="heading-9">3. å‚è€ƒè„šæœ¬</h6>
<p>æœ€åè´´ä¸€ä¸‹æ•´ä½“çš„ç”Ÿæˆè„šæœ¬ï¼Œç”¨äºå‚è€ƒ</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-function"><span class="hljs-title">get_top_cpu_nginx_worker_pid</span></span>() {
    <span class="hljs-comment"># ä½¿ç”¨ top å‘½ä»¤è·å–è¿›ç¨‹ä¿¡æ¯ï¼Œç­›é€‰å‡º Nginx worker è¿›ç¨‹</span>
    <span class="hljs-built_in">local</span> top_pid=$(top -b -n 1 | awk <span class="hljs-string">'/nginx/ {print $1, $9}'</span> | <span class="hljs-built_in">sort</span> -k2 -nr | <span class="hljs-built_in">head</span> -n 1 | awk <span class="hljs-string">'{print $1}'</span>)
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$top_pid</span>"</span>
}

<span class="hljs-comment"># è°ƒç”¨å‡½æ•°å¹¶è¾“å‡ºç»“æœ</span>
top_nginx_worker_pid=$(get_top_cpu_nginx_worker_pid)
<span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$top_nginx_worker_pid</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"CPU ä½¿ç”¨ç‡æœ€é«˜çš„ Nginx worker è¿›ç¨‹ PID: <span class="hljs-variable">$top_nginx_worker_pid</span>"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"æœªæ‰¾åˆ° Nginx worker è¿›ç¨‹ã€‚"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">cd</span> /root/debug

<span class="hljs-built_in">echo</span> <span class="hljs-string">"perf nginx cpu flame,wait 30s"</span>
perf record -F 99 -g -p <span class="hljs-string">"<span class="hljs-variable">$top_nginx_worker_pid</span>"</span> -- <span class="hljs-built_in">sleep</span> 30
perf script | ./FlameGraph/stackcollapse-perf.pl| ./FlameGraph/flamegraph.pl &gt; ./ngx_c_flame.svg

<span class="hljs-built_in">echo</span> <span class="hljs-string">"perf nginx cpu flame done"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"stap nginx lua flame,wait 30s"</span>

docker run --<span class="hljs-built_in">rm</span> --name debug --pid=host -v /lib/modules:/lib/modules -v /root/debug:/root/debug -v /sys/kernel/debug:/sys/kernel/debug -v /usr/src/kernels:/usr/src/kernels --privileged --entrypoint /bin/bash  openresty-debug:2.0.0  -c <span class="hljs-string">"cd /root/debug/stapxx/ &amp;&amp; export PATH=\$PWD:\$PATH &amp;&amp; ./samples/lj-lua-stacks.sxx --skip-badvars --arg time=30 -x <span class="hljs-variable">$top_nginx_worker_pid</span> &gt; /root/debug/a.bt"</span>

./FlameGraph/stackcollapse-stap.pl a.bt &gt; a.cbt
./FlameGraph/flamegraph.pl a.cbt  &gt; ngx_lua_flame.svg

<span class="hljs-built_in">echo</span> <span class="hljs-string">"stap nginx lua flame done"</span>
</code></pre>
<p>è¿™é‡Œä¹Ÿè´´ä¸€ä¸‹stapxx/tapset/luajit.sxxçš„ä»£ç ï¼Œç”¨äºå‚è€ƒï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// module luajit</span>


<span class="hljs-variable">@use</span> nginx.lua


$*<span class="hljs-attribute">pt </span>:= <span class="hljs-variable">@cast</span>(pt, <span class="hljs-string">"GCproto"</span>, <span class="hljs-string">"$^libluajit_path"</span>)


<span class="hljs-comment">//@define LJ_TLIGHTUD  %( 4294967292 %)</span>
<span class="hljs-variable">@define</span> LJ_TLIGHTUD  %( <span class="hljs-number">4294901760</span> %)
<span class="hljs-variable">@define</span> LJ_TSTR  %( <span class="hljs-number">4294967291</span> %)
<span class="hljs-variable">@define</span> LJ_TUDATA  %( <span class="hljs-number">4294967283</span> %)
<span class="hljs-variable">@define</span> LJ_TFUNC  %( <span class="hljs-number">4294967287</span> %)


<span class="hljs-variable">@define</span> TSTR    %( <span class="hljs-number">4</span> %)
<span class="hljs-variable">@define</span> TUPVAL  %( <span class="hljs-number">5</span> %)
<span class="hljs-variable">@define</span> TTHREAD %( <span class="hljs-number">6</span> %)
<span class="hljs-variable">@define</span> TPROTO  %( <span class="hljs-number">7</span> %)
<span class="hljs-variable">@define</span> TFUNC   %( <span class="hljs-number">8</span> %)
<span class="hljs-variable">@define</span> TTRACE  %( <span class="hljs-number">9</span> %)
<span class="hljs-variable">@define</span> TCDATA  %( <span class="hljs-number">10</span> %)
<span class="hljs-variable">@define</span> TTAB    %( <span class="hljs-number">11</span> %)
<span class="hljs-variable">@define</span> TUDATA  %( <span class="hljs-number">12</span> %)

<span class="hljs-variable">@define</span> CTSHIFT_NUM  %( <span class="hljs-number">28</span> %)
<span class="hljs-variable">@define</span> CT_HASSIZE   %( <span class="hljs-number">5</span> %)
<span class="hljs-variable">@define</span> CT_ATTRIB    %( <span class="hljs-number">8</span> %)
<span class="hljs-variable">@define</span> CTMASK_CID   %( <span class="hljs-number">0</span>xffff %)

<span class="hljs-variable">@define</span> FF_LUA %( <span class="hljs-number">0</span> %)
<span class="hljs-variable">@define</span> FF_C   %( <span class="hljs-number">1</span> %)

<span class="hljs-variable">@define</span> FRAME_LUA   %( <span class="hljs-number">0</span> %)
<span class="hljs-variable">@define</span> FRAME_CONT  %( <span class="hljs-number">2</span> %)
<span class="hljs-variable">@define</span> FRAME_TYPE  %( <span class="hljs-number">3</span> %)
<span class="hljs-variable">@define</span> FRAME_P     %( <span class="hljs-number">4</span> %)
<span class="hljs-variable">@define</span> FRAME_TYPEP %( (<span class="hljs-variable">@FRAME_TYPE</span>|<span class="hljs-variable">@FRAME_P</span>) %)

<span class="hljs-variable">@define</span> NO_BCPOS    %( ~<span class="hljs-number">0</span> %)

<span class="hljs-variable">@define</span> sizeof_GCtab  %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCtab"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_TValue  %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"TValue"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_lua_State %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"struct lua_State"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_GCfunc %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"union GCfunc"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_GCupval %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCupval"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_GCstr %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCstr"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_GCudata %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCudata"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_Node %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"Node"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_GCfuncC %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCfuncC"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_GCfuncL %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCfuncL"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_GCRef %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCRef"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_GCproto %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCproto"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_GCtrace %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCtrace"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_GCcdata %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCcdata"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_IRIns %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"IRIns"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_IRRef %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"IRRef"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_SnapShot %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"SnapShot"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_SnapEntry %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"SnapEntry"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_K64Array %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"K64Array"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_ptr %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"global_State"</span>, <span class="hljs-string">"$^libluajit_path"</span>)-&gt;strmask %)
<span class="hljs-variable">@define</span> sizeof_GCcdataVar %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCcdataVar"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)
<span class="hljs-variable">@define</span> sizeof_BCIns %( &amp;<span class="hljs-variable">@cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"BCIns"</span>, <span class="hljs-string">"$^libluajit_path"</span>)[<span class="hljs-number">1</span>] %)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">strdata</span>(s) %(
    (<span class="hljs-variable">@s</span> + <span class="hljs-variable">@sizeof_GCstr</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_gc</span>(frame) %(
    <span class="hljs-variable">@cast</span>(<span class="hljs-variable">@frame</span>, <span class="hljs-string">"TValue"</span>, <span class="hljs-string">"$^libluajit_path"</span>)-&gt;gcr-&gt;gcptr64
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_ftsz</span>(tv) %(
    <span class="hljs-variable">@cast</span>(<span class="hljs-variable">@tv</span>, <span class="hljs-string">"TValue"</span>, <span class="hljs-string">"$^libluajit_path"</span>)-&gt;ftsz
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_type</span>(f) %(
    (<span class="hljs-variable">@frame_ftsz</span>(<span class="hljs-variable">@f</span>) &amp; <span class="hljs-variable">@FRAME_TYPE</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_typep</span>(f) %(
    (<span class="hljs-variable">@frame_ftsz</span>(<span class="hljs-variable">@f</span>) &amp; <span class="hljs-variable">@FRAME_TYPEP</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_islua</span>(f) %(
    (<span class="hljs-variable">@frame_type</span>(<span class="hljs-variable">@f</span>) == <span class="hljs-variable">@FRAME_LUA</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_iscont</span>(f) %(
    (<span class="hljs-variable">@frame_typep</span>(<span class="hljs-variable">@f</span>) == <span class="hljs-variable">@FRAME_CONT</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_pc</span>(tv) %(
    <span class="hljs-variable">@cast</span>(<span class="hljs-variable">@tv</span>, <span class="hljs-string">"TValue"</span>, <span class="hljs-string">"$^libluajit_path"</span>)-&gt;ftsz
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_contpc</span>(f) %(
    (<span class="hljs-variable">@frame_pc</span>(<span class="hljs-variable">@f</span>) - <span class="hljs-number">1</span> * <span class="hljs-variable">@sizeof_BCIns</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">bc_a</span>(i) %(
    ((<span class="hljs-variable">@i</span> &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0</span>xff)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_prevl</span>(f) %(
    (<span class="hljs-variable">@f</span> - (<span class="hljs-number">1</span> + <span class="hljs-variable">@bc_a</span>(<span class="hljs-built_in">user_uint32</span>(<span class="hljs-variable">@frame_pc</span>(<span class="hljs-variable">@f</span>) - <span class="hljs-number">4</span>))) * <span class="hljs-variable">@sizeof_TValue</span>)
%)

<span class="hljs-variable">@define</span> FRAME_VARG  %( <span class="hljs-number">3</span> %)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_isvarg</span>(f) %(
    (<span class="hljs-variable">@frame_typep</span>(<span class="hljs-variable">@f</span>) == <span class="hljs-variable">@FRAME_VARG</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_sized</span>(f) %(
    (<span class="hljs-variable">@frame_ftsz</span>(<span class="hljs-variable">@f</span>) &amp; ~<span class="hljs-variable">@FRAME_TYPEP</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">frame_prevd</span>(f) %(
    (<span class="hljs-variable">@f</span> - <span class="hljs-variable">@frame_sized</span>(<span class="hljs-variable">@f</span>))
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">isluafunc</span>(fn) %(
    (<span class="hljs-variable">@cast</span>(<span class="hljs-variable">@fn</span>, <span class="hljs-string">"GCfunc"</span>, <span class="hljs-string">"$^libluajit_path"</span>)-&gt;c-&gt;ffid == <span class="hljs-variable">@FF_LUA</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">isffunc</span>(fn) %(
    (<span class="hljs-variable">@cast</span>(<span class="hljs-variable">@fn</span>, <span class="hljs-string">"GCfunc"</span>, <span class="hljs-string">"$^libluajit_path"</span>)-&gt;c-&gt;ffid &gt; <span class="hljs-variable">@FF_C</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">funcproto</span>(fn) %(
    (<span class="hljs-variable">@cast</span>(<span class="hljs-variable">@fn</span>, <span class="hljs-string">"GCfunc"</span>, <span class="hljs-string">"$^libluajit_path"</span>)-&gt;l-&gt;pc-&gt;ptr64 - <span class="hljs-variable">@sizeof_GCproto</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">proto_bc</span>(pt) %(
    (<span class="hljs-variable">@pt</span> + <span class="hljs-variable">@sizeof_GCproto</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">proto_bcpos</span>(pt, pc) %(
    ((<span class="hljs-variable">@pc</span> - <span class="hljs-variable">@proto_bc</span>(<span class="hljs-variable">@pt</span>)) / <span class="hljs-variable">@sizeof_BCIns</span>)
%)

<span class="hljs-variable">@define</span> <span class="hljs-built_in">proto_lineinfo</span>(pt) %(
    <span class="hljs-variable">@cast</span>(<span class="hljs-variable">@pt</span>, <span class="hljs-string">"GCproto"</span>, <span class="hljs-string">"$^libluajit_path"</span>)-&gt;lineinfo-&gt;ptr64
%)


global luajit_cfunc_cache


function <span class="hljs-built_in">luajit_frame_func</span>(f) {
    <span class="hljs-selector-tag">gco</span> = @<span class="hljs-selector-tag">frame_gc</span>(f)
    $*<span class="hljs-selector-tag">gco</span> := @<span class="hljs-selector-tag">cast</span>(gco, <span class="hljs-string">"GCobj"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">gco-</span>&gt;<span class="hljs-selector-tag">fn</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_G</span>(L)
{
    $*L := @cast(L, "lua_State", "$^libluajit_path")
    return $*L-&gt;glref-&gt;ptr64
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_gcref</span>(r)
{
    $*r := @cast(r, "GCRef", "$^libluajit_path")
    return $*r-&gt;gcptr64
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_objlen</span>(o, gct, g)
{
    $*o := @cast(o, "GCobj", "$^libluajit_path")
    if (gct == @TSTR) {
        /*
        if ($*o-&gt;str-&gt;len == 0) {
            printf("empty string found.\n")
        }
        */
        <span class="hljs-selector-tag">return</span> $*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">str-</span>&gt;<span class="hljs-selector-tag">len</span> + <span class="hljs-number">1</span> + @<span class="hljs-selector-tag">sizeof_GCstr</span>
    }

    <span class="hljs-selector-tag">if</span> (gct == <span class="hljs-variable">@TTAB</span>) {
        <span class="hljs-selector-tag">t</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">tab</span>
        $*<span class="hljs-selector-tag">t</span> := @<span class="hljs-selector-tag">cast</span>(t, <span class="hljs-string">"GCtab"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
        <span class="hljs-selector-tag">asize</span> = $*<span class="hljs-selector-tag">t-</span>&gt;<span class="hljs-selector-tag">asize</span>
        <span class="hljs-selector-tag">hmask</span> = $*<span class="hljs-selector-tag">t-</span>&gt;<span class="hljs-selector-tag">hmask</span>

        <span class="hljs-selector-tag">n</span> = <span class="hljs-number">0</span>
        <span class="hljs-selector-tag">if</span> (hmask &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-selector-tag">n</span> += @<span class="hljs-selector-tag">sizeof_Node</span> * (hmask + <span class="hljs-number">1</span>)
        }

        <span class="hljs-selector-tag">if</span> (asize &gt; <span class="hljs-number">0</span> &amp;&amp; $*t-&gt;colo &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-selector-tag">n</span> += @<span class="hljs-selector-tag">sizeof_TValue</span> * <span class="hljs-selector-tag">asize</span>
        }

        <span class="hljs-selector-tag">if</span> ($*t-&gt;colo) {
            <span class="hljs-selector-tag">n</span> += ($*t-&gt;colo &amp; <span class="hljs-number">0</span>x7f) * @<span class="hljs-selector-tag">sizeof_TValue</span> + @<span class="hljs-selector-tag">sizeof_GCtab</span>

        } <span class="hljs-selector-tag">else</span> {
            <span class="hljs-selector-tag">n</span> += @<span class="hljs-selector-tag">sizeof_GCtab</span>
        }

        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">n</span>
    }

    <span class="hljs-selector-tag">if</span> (gct == <span class="hljs-variable">@TUDATA</span>) {
        <span class="hljs-selector-tag">return</span> $*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">ud-</span>&gt;<span class="hljs-selector-tag">len</span> + @<span class="hljs-selector-tag">sizeof_GCudata</span>
    }

    <span class="hljs-selector-tag">if</span> (gct == <span class="hljs-variable">@TPROTO</span>) {
        <span class="hljs-selector-tag">return</span> $*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">pt-</span>&gt;<span class="hljs-selector-tag">sizept</span>
    }

    <span class="hljs-selector-tag">if</span> (gct == <span class="hljs-variable">@TTHREAD</span>) {
        <span class="hljs-selector-tag">L</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">th</span>
        <span class="hljs-comment">//printf("open upval: %p\n", luajit_gcref(&amp;$*L-&gt;openupval))</span>
        <span class="hljs-comment">//printf("lua_State: %d\n", @sizeof_lua_State)</span>
        <span class="hljs-selector-tag">n</span> = @<span class="hljs-selector-tag">sizeof_lua_State</span> + $*<span class="hljs-selector-tag">L-</span>&gt;<span class="hljs-selector-tag">stacksize</span> * @<span class="hljs-selector-tag">sizeof_TValue</span>
        <span class="hljs-selector-tag">p</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">L-</span>&gt;<span class="hljs-selector-tag">openupval</span>
        <span class="hljs-selector-tag">while</span> (p) {
            <span class="hljs-selector-tag">o</span> = <span class="hljs-selector-tag">luajit_gcref</span>(p)
            <span class="hljs-selector-tag">if</span> (o == <span class="hljs-number">0</span>) {
                <span class="hljs-selector-tag">break</span>;
            }

            $*<span class="hljs-selector-tag">o</span> := @<span class="hljs-selector-tag">cast</span>(o, <span class="hljs-string">"GCobj"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
            <span class="hljs-selector-tag">gct</span> = $*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">gch-</span>&gt;<span class="hljs-selector-tag">gct</span>
            <span class="hljs-selector-tag">size</span> = <span class="hljs-selector-tag">luajit_objlen</span>(o, gct, g)
            <span class="hljs-comment">//printf("%s: %d\n", typenames[@TSTR], size)</span>
            <span class="hljs-selector-tag">n</span> += <span class="hljs-selector-tag">size</span>
            <span class="hljs-selector-tag">p</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">gch-</span>&gt;<span class="hljs-selector-tag">nextgc</span>
        }

        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">n</span>
    }

    <span class="hljs-selector-tag">if</span> (gct == <span class="hljs-variable">@TFUNC</span>) {
        <span class="hljs-selector-tag">fn</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">fn</span>
        $*<span class="hljs-selector-tag">fn</span> := @<span class="hljs-selector-tag">cast</span>(fn, <span class="hljs-string">"GCfunc"</span>, <span class="hljs-string">"$^libluajit_path"</span>);
        <span class="hljs-selector-tag">if</span> (<span class="hljs-variable">@isluafunc</span>(fn)) {
            <span class="hljs-selector-tag">n</span> = $*<span class="hljs-selector-tag">fn-</span>&gt;<span class="hljs-selector-tag">l-</span>&gt;<span class="hljs-selector-tag">nupvalues</span>
            <span class="hljs-comment">//n = 0</span>
            <span class="hljs-selector-tag">return</span> @<span class="hljs-selector-tag">sizeof_GCfuncL</span> <span class="hljs-selector-tag">-</span> @<span class="hljs-selector-tag">sizeof_GCRef</span> + @<span class="hljs-selector-tag">sizeof_GCRef</span> * <span class="hljs-selector-tag">n</span>
        }

        <span class="hljs-selector-tag">n</span> = $*<span class="hljs-selector-tag">fn-</span>&gt;<span class="hljs-selector-tag">c-</span>&gt;<span class="hljs-selector-tag">nupvalues</span>
        <span class="hljs-comment">//n = 0</span>
        <span class="hljs-selector-tag">return</span> @<span class="hljs-selector-tag">sizeof_GCfuncC</span> <span class="hljs-selector-tag">-</span> @<span class="hljs-selector-tag">sizeof_TValue</span> + @<span class="hljs-selector-tag">sizeof_TValue</span> * <span class="hljs-selector-tag">n</span>
    }

    <span class="hljs-selector-tag">if</span> (gct == <span class="hljs-variable">@TUPVAL</span>) {
        <span class="hljs-selector-tag">return</span> @<span class="hljs-selector-tag">sizeof_GCupval</span>
    }

    <span class="hljs-selector-tag">if</span> (gct == <span class="hljs-variable">@TTRACE</span>) {
        <span class="hljs-selector-tag">T</span> = <span class="hljs-selector-tag">o</span>
        $*<span class="hljs-selector-tag">T</span> := @<span class="hljs-selector-tag">cast</span>(T, <span class="hljs-string">"GCtrace"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
        <span class="hljs-selector-tag">return</span> ((<span class="hljs-variable">@sizeof_GCtrace</span> + <span class="hljs-number">7</span>) &amp; ~<span class="hljs-number">7</span>)
               + ($*T-&gt;nins - $*T-&gt;nk) * @<span class="hljs-selector-tag">sizeof_IRIns</span>
               + $*<span class="hljs-selector-tag">T-</span>&gt;<span class="hljs-selector-tag">nsnap</span> * @<span class="hljs-selector-tag">sizeof_SnapShot</span>
               + $*<span class="hljs-selector-tag">T-</span>&gt;<span class="hljs-selector-tag">nsnapmap</span> * @<span class="hljs-selector-tag">sizeof_SnapEntry</span>
    }

    $*<span class="hljs-selector-tag">g</span> := @<span class="hljs-selector-tag">cast</span>(g, <span class="hljs-string">"global_State"</span>, <span class="hljs-string">"$^libluajit_path"</span>)

    <span class="hljs-selector-tag">if</span> (gct == <span class="hljs-variable">@TCDATA</span>) {
        <span class="hljs-selector-tag">cd</span> = <span class="hljs-selector-tag">o</span>
        $*<span class="hljs-selector-tag">cd</span> := @<span class="hljs-selector-tag">cast</span>(cd, <span class="hljs-string">"GCcdata"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
        <span class="hljs-selector-tag">if</span> ($*cd-&gt;marked &amp; <span class="hljs-number">0</span>x80) {
            <span class="hljs-comment">/* cdata is a vector */</span>
            <span class="hljs-selector-tag">cdatav</span> = <span class="hljs-selector-tag">cd</span> <span class="hljs-selector-tag">-</span> @<span class="hljs-selector-tag">sizeof_GCcdataVar</span>
            $*<span class="hljs-selector-tag">cdatav</span> := @<span class="hljs-selector-tag">cast</span>(cdatav, <span class="hljs-string">"GCcdataVar"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
            <span class="hljs-selector-tag">return</span> $*<span class="hljs-selector-tag">cdatav-</span>&gt;<span class="hljs-selector-tag">len</span> + $*<span class="hljs-selector-tag">cdatav-</span>&gt;<span class="hljs-selector-tag">extra</span>
        }

        <span class="hljs-comment">/* cdata is not a vector */</span>
        <span class="hljs-selector-tag">cts</span> = $*<span class="hljs-selector-tag">g-</span>&gt;<span class="hljs-selector-tag">ctype_state-</span>&gt;<span class="hljs-selector-tag">ptr64</span>
        $*<span class="hljs-selector-tag">cts</span> := @<span class="hljs-selector-tag">cast</span>(cts, <span class="hljs-string">"CTState"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
        <span class="hljs-selector-tag">id</span> = $*<span class="hljs-selector-tag">cd-</span>&gt;<span class="hljs-selector-tag">ctypeid</span>
        <span class="hljs-selector-tag">ct</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">cts-</span>&gt;<span class="hljs-selector-tag">tab</span><span class="hljs-selector-attr">[id]</span>
        $*<span class="hljs-selector-tag">ct</span> := @<span class="hljs-selector-tag">cast</span>(ct, <span class="hljs-string">"CType"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
        <span class="hljs-selector-tag">while</span> (($*ct-&gt;info &gt;&gt; <span class="hljs-variable">@CTSHIFT_NUM</span>) == <span class="hljs-variable">@CT_ATTRIB</span>) {
            <span class="hljs-comment">//printf("XXX skipping c type attribute\n")</span>
            <span class="hljs-selector-tag">ct</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">cts-</span>&gt;<span class="hljs-selector-tag">tab</span><span class="hljs-selector-attr">[$*ct-&gt;info &amp; @CTMASK_CID]</span>
        }

        <span class="hljs-selector-tag">if</span> (($*ct-&gt;info &gt;&gt; <span class="hljs-variable">@CTSHIFT_NUM</span>) &lt;= <span class="hljs-variable">@CT_HASSIZE</span>) {
            <span class="hljs-selector-tag">sz</span> = $*<span class="hljs-selector-tag">ct-</span>&gt;<span class="hljs-selector-tag">size</span>

        } <span class="hljs-selector-tag">else</span> {
            <span class="hljs-selector-tag">sz</span> = @<span class="hljs-selector-tag">sizeof_ptr</span>
        }

        <span class="hljs-comment">//printf("GCcdata size: %d\n", @sizeof_GCcdata)</span>
        <span class="hljs-selector-tag">return</span> @<span class="hljs-selector-tag">sizeof_GCcdata</span> + <span class="hljs-selector-tag">sz</span>
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-number">0</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_jit_state_size</span>(J)
{
    $*J := @cast(J, "jit_State", "$^libluajit_path")

    ir_k64_size = 0
    // In the newer revision of luajit, 64-bit constants are represented as an
    // array of TValue. Uncomment following code if the luajit being used
    // is using linked list to represent 64-bit constants. As the 64-bit
    // constants don't take lots of memory, it does not seems to be a big deal
    // if you don't uncomment following code for the older luajit.
    //
    /*
    $*k := @cast(k, "K64Array", "$^libluajit_path")
    for (k = $*J-&gt;k64-&gt;ptr64; <span class="hljs-selector-tag">k</span>; ) {
        <span class="hljs-selector-tag">ir_k64_size</span> += @<span class="hljs-selector-tag">sizeof_K64Array</span>
        <span class="hljs-selector-tag">k</span> = $*<span class="hljs-selector-tag">k-</span>&gt;<span class="hljs-selector-tag">next-</span>&gt;<span class="hljs-selector-tag">ptr64</span>
    }
    <span class="hljs-selector-tag">if</span> (ir_k64_size) {
        <span class="hljs-comment">//printf("64-bit constants: %d\n", ir_k64_size)</span>
    }
    */

    sizesnapmap = $*J-&gt;sizesnapmap * <span class="hljs-variable">@sizeof_SnapEntry</span>
    if (sizesnapmap) {
        <span class="hljs-comment">//printf("JIT snap map buffer size: %d\n", sizesnapmap)</span>
    }

    sizesnap = $*J-&gt;sizesnap * <span class="hljs-variable">@sizeof_SnapShot</span>
    if (sizesnap) {
        <span class="hljs-comment">//printf("JIT snap buffer size: %d\n", sizesnap)</span>
    }

    sizeirbuf = ($*J-&gt;irtoplim - $*J-&gt;irbotlim) * <span class="hljs-variable">@sizeof_IRIns</span>
    if (sizeirbuf) {
        <span class="hljs-comment">//printf("JIT IR buffer size: %d\n", sizeirbuf)</span>
    }

    sizetrace = $*J-&gt;sizetrace * <span class="hljs-variable">@sizeof_GCRef</span>
    if (sizetrace) {
        <span class="hljs-comment">//printf("JIT trace array size: %d\n", sizetrace)</span>
    }

    return ir_k64_size + sizesnapmap + sizesnap + sizeirbuf + sizetrace
}


<span class="hljs-comment">/* returns a TValue* pointer */</span>
<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_index2adr</span>(L, idx)
{
    <span class="hljs-selector-tag">if</span> (idx &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-selector-tag">o</span> = $*<span class="hljs-selector-tag">L-</span>&gt;<span class="hljs-selector-tag">base</span> + (idx - <span class="hljs-number">1</span>) * @<span class="hljs-selector-tag">sizeof_TValue</span>
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">o</span> &lt; $*<span class="hljs-selector-tag">L-</span>&gt;<span class="hljs-selector-tag">top</span> ? <span class="hljs-selector-tag">o</span> : <span class="hljs-number">0</span>
    }

    <span class="hljs-selector-tag">top</span> = $*<span class="hljs-selector-tag">L-</span>&gt;<span class="hljs-selector-tag">top</span>

    <span class="hljs-selector-tag">if</span> (idx != <span class="hljs-number">0</span> &amp;&amp; -idx &lt;= top - $*L-&gt;base) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">top</span> + <span class="hljs-selector-tag">idx</span> * @<span class="hljs-selector-tag">sizeof_TValue</span>;
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-number">0</span>
}


<span class="hljs-comment">/* convert GCstr to stap string */</span>
<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_unbox_gcstr</span>(gcs)
{
    <span class="hljs-selector-tag">if</span> (gcs == <span class="hljs-number">0</span>) {
        <span class="hljs-selector-tag">return</span> ""
    }

    $*<span class="hljs-selector-tag">gcs</span> := @<span class="hljs-selector-tag">cast</span>(gcs, <span class="hljs-string">"GCstr"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
    <span class="hljs-selector-tag">src</span> = @<span class="hljs-selector-tag">strdata</span>(gcs)
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">user_string_n_warn</span>(src, $*gcs-&gt;len)
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_tostring</span>(L, idx)
{
    $*o := @cast(o, "TValue", "$^libluajit_path")
    o = luajit_index2adr(L, idx)
    if (o == 0) {
        return "&lt;nil&gt;"
    }

    <span class="hljs-selector-tag">if</span> ($*o-&gt;it == <span class="hljs-variable">@LJ_TSTR</span>) {
        <span class="hljs-selector-tag">gco</span> = $*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">gcr-</span>&gt;<span class="hljs-selector-tag">gcptr64</span>
        $*<span class="hljs-selector-tag">gco</span> := @<span class="hljs-selector-tag">cast</span>(gco, <span class="hljs-string">"GCobj"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
        <span class="hljs-selector-tag">s</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">gco-</span>&gt;<span class="hljs-selector-tag">str</span>
        $*<span class="hljs-selector-tag">s</span> := @<span class="hljs-selector-tag">cast</span>(s, <span class="hljs-string">"GCstr"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">user_string_n</span>(s + <span class="hljs-variable">@sizeof_GCstr</span>, $*s-&gt;len)
    }

    <span class="hljs-selector-tag">return</span> "&lt;<span class="hljs-selector-tag">unknown</span>&gt;"
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_tostringlen</span>(L, idx)
{
    $*o := @cast(o, "TValue", "$^libluajit_path")
    o = luajit_index2adr(L, idx)
    if (o == 0) {
        return -1
    }

    <span class="hljs-selector-tag">if</span> ($*o-&gt;it == <span class="hljs-variable">@LJ_TSTR</span>) {
        <span class="hljs-selector-tag">gco</span> = $*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">gcr-</span>&gt;<span class="hljs-selector-tag">gcptr64</span>
        $*<span class="hljs-selector-tag">gco</span> := @<span class="hljs-selector-tag">cast</span>(gco, <span class="hljs-string">"GCobj"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
        <span class="hljs-selector-tag">s</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">gco-</span>&gt;<span class="hljs-selector-tag">str</span>
        $*<span class="hljs-selector-tag">s</span> := @<span class="hljs-selector-tag">cast</span>(s, <span class="hljs-string">"GCstr"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
        <span class="hljs-selector-tag">return</span> $*<span class="hljs-selector-tag">s-</span>&gt;<span class="hljs-selector-tag">len</span>
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">-1</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_touserdata</span>(L, idx)
{
    $*o := @cast(o, "TValue", "$^libluajit_path")
    o = luajit_index2adr(L, idx)
    if (o == 0) {
        return 0
    }

    <span class="hljs-comment">//printf("udata type: %d (%d)\n", $*o-&gt;it, ($*o-&gt;it &gt;&gt; 15))</span>

    <span class="hljs-selector-tag">if</span> ($*o-&gt;it == <span class="hljs-variable">@LJ_TUDATA</span>) {
        <span class="hljs-selector-tag">gco</span> = $*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">gcr-</span>&gt;<span class="hljs-selector-tag">gcptr64</span>
        <span class="hljs-selector-tag">ud</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">gco-</span>&gt;<span class="hljs-selector-tag">ud</span>
        $*<span class="hljs-selector-tag">ud</span> := @<span class="hljs-selector-tag">cast</span>(ud, <span class="hljs-string">"GCudata"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ud</span> + @<span class="hljs-selector-tag">sizeof_GCudata</span>
    }

    <span class="hljs-selector-tag">if</span> ($*o-&gt;it == <span class="hljs-variable">@LJ_TLIGHTUD</span>) {
        <span class="hljs-selector-tag">return</span> $*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">u64</span> <span class="hljs-selector-tag">&amp;</span> <span class="hljs-number">0</span><span class="hljs-selector-tag">x7fffffffffff</span>
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-number">0</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_proto_chunkname</span>(pt) {
    <span class="hljs-selector-tag">gco</span> = $*<span class="hljs-selector-tag">pt-</span>&gt;<span class="hljs-selector-tag">chunkname-</span>&gt;<span class="hljs-selector-tag">gcptr64</span>
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">gco-</span>&gt;<span class="hljs-selector-tag">str</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_debug_framepc</span>(L, T, fn, pt, nextframe) {
    <span class="hljs-comment">//printf("debug framepc: L=%p, fn=%p, nextframe = %p\\n", L, fn, nextframe)</span>
    <span class="hljs-selector-tag">if</span> (nextframe == <span class="hljs-number">0</span>) {
        <span class="hljs-selector-tag">return</span> @<span class="hljs-selector-tag">NO_BCPOS</span>
    }

    <span class="hljs-selector-tag">if</span> (<span class="hljs-variable">@frame_islua</span>(nextframe)) {
        <span class="hljs-selector-tag">ins</span> = @<span class="hljs-selector-tag">frame_pc</span>(nextframe);
        <span class="hljs-comment">//printf("frame is lua, ins = %p\\n", ins)</span>

    } <span class="hljs-selector-tag">else</span> <span class="hljs-selector-tag">if</span> (<span class="hljs-variable">@frame_iscont</span>(nextframe)) {
        <span class="hljs-comment">//println("frame is cont")</span>
        <span class="hljs-selector-tag">ins</span> = @<span class="hljs-selector-tag">frame_contpc</span>(nextframe)

    } <span class="hljs-selector-tag">else</span> {
        <span class="hljs-comment">/* <span class="hljs-doctag">TODO:</span> add support for cframe */</span>
    }

    <span class="hljs-comment">//printf("debug framepc: ins = %p\\n", ins)</span>
    <span class="hljs-selector-tag">pos</span> = @<span class="hljs-selector-tag">proto_bcpos</span>(pt, ins) <span class="hljs-selector-tag">-</span> <span class="hljs-number">1</span>;
    <span class="hljs-selector-tag">sizebc</span> = $*<span class="hljs-selector-tag">pt-</span>&gt;<span class="hljs-selector-tag">sizebc</span>
    <span class="hljs-selector-tag">if</span> (pos &gt; sizebc) {
        <span class="hljs-comment">//printf("Undo the effects of lj_trace_exit for JLOOP.\n")</span>
        <span class="hljs-selector-tag">if</span> (!T) {
            <span class="hljs-selector-tag">T</span> = <span class="hljs-selector-tag">ins</span> <span class="hljs-selector-tag">-</span> <span class="hljs-number">1</span> * @<span class="hljs-selector-tag">sizeof_BCIns</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">&amp;</span>@<span class="hljs-selector-tag">cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GCtrace"</span>, <span class="hljs-string">"$^libluajit_path"</span>)<span class="hljs-selector-tag">-</span>&gt;<span class="hljs-selector-tag">startins</span>;
        }
        <span class="hljs-comment">//printf("startpc: %d\n", $*T-&gt;startpc-&gt;ptr64)</span>
        <span class="hljs-selector-tag">pos</span> = @<span class="hljs-selector-tag">proto_bcpos</span>(pt, $*T-&gt;startpc-&gt;ptr64);
        <span class="hljs-comment">//printf("Found adjusted position: %d\n", pos)</span>
    }
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">pos</span>;
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_debug_line</span>(pt, pc)
{
    <span class="hljs-selector-tag">lineinfo</span> = @<span class="hljs-selector-tag">proto_lineinfo</span>(pt)
    <span class="hljs-comment">//printf("lj_debug_line: lineinfo = %p, %x &lt;= %x\\n", lineinfo,</span>
           <span class="hljs-comment">//pc, $pt-&gt;sizebc)</span>
    <span class="hljs-selector-tag">sizebc</span> = $*<span class="hljs-selector-tag">pt-</span>&gt;<span class="hljs-selector-tag">sizebc</span>

    <span class="hljs-selector-tag">if</span> (pc &lt;= sizebc &amp;&amp; lineinfo) {
        <span class="hljs-selector-tag">first</span> = $*<span class="hljs-selector-tag">pt-</span>&gt;<span class="hljs-selector-tag">firstline</span>

        <span class="hljs-selector-tag">if</span> (pc == sizebc) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">first</span> + $*<span class="hljs-selector-tag">pt-</span>&gt;<span class="hljs-selector-tag">numline</span>
        }

        <span class="hljs-selector-tag">if</span> (pc-- == <span class="hljs-number">0</span>) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">first</span>
        }

        <span class="hljs-selector-tag">if</span> ($*pt-&gt;numline &lt; <span class="hljs-number">256</span>) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">first</span> + @<span class="hljs-selector-tag">cast</span>(lineinfo, <span class="hljs-string">"uint8_t"</span>, <span class="hljs-string">"$^libluajit_path"</span>)<span class="hljs-selector-attr">[pc]</span>
        }

        <span class="hljs-selector-tag">if</span> ($*pt-&gt;numline &lt; <span class="hljs-number">65536</span>) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">first</span> + @<span class="hljs-selector-tag">cast</span>(lineinfo, <span class="hljs-string">"uint16_t"</span>, <span class="hljs-string">"$^libluajit_path"</span>)<span class="hljs-selector-attr">[pc]</span>
        }

        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">first</span> + @<span class="hljs-selector-tag">cast</span>(lineinfo, <span class="hljs-string">"uint32_t"</span>, <span class="hljs-string">"$^libluajit_path"</span>)<span class="hljs-selector-attr">[pc]</span>
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">-1</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_debug_frameline</span>(L, T, fn, pt, nextframe)
{
    <span class="hljs-selector-tag">pc</span> = <span class="hljs-selector-tag">luajit_debug_framepc</span>(L, T, fn, pt, nextframe)
    <span class="hljs-selector-tag">if</span> (pc != <span class="hljs-variable">@NO_BCPOS</span>) {
        <span class="hljs-selector-tag">if</span> (pc &lt;= $*pt-&gt;sizebc) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">luajit_debug_line</span>(pt, pc)
        }
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">-1</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_debug_dumpstack</span>(L, T, depth, base, simple)
{
    <span class="hljs-selector-tag">level</span> = <span class="hljs-number">0</span>
    <span class="hljs-selector-tag">dir</span> = <span class="hljs-number">1</span>
    <span class="hljs-selector-tag">if</span> (depth &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-selector-tag">level</span> = ~<span class="hljs-selector-tag">depth</span>
        <span class="hljs-selector-tag">depth</span> = <span class="hljs-selector-tag">dir</span> = <span class="hljs-selector-tag">-1</span>
    }
    <span class="hljs-selector-tag">bt</span> = ""
    <span class="hljs-selector-tag">while</span> (level != depth) {
        <span class="hljs-comment">/* lj_debug_frame(L, level, &amp;size) {{{ */</span>
        <span class="hljs-selector-tag">bot</span> = $*<span class="hljs-selector-tag">L-</span>&gt;<span class="hljs-selector-tag">stack-</span>&gt;<span class="hljs-selector-tag">ptr64</span>
        <span class="hljs-selector-tag">found_frame</span> = <span class="hljs-number">0</span>
        <span class="hljs-selector-tag">tmp_level</span> = <span class="hljs-selector-tag">level</span>
        <span class="hljs-comment">/* Traverse frames backwards. */</span>
        <span class="hljs-selector-tag">for</span> (nextframe = frame = base - <span class="hljs-variable">@sizeof_TValue</span>; frame &gt; bot; ) {
            <span class="hljs-selector-tag">if</span> (<span class="hljs-variable">@frame_gc</span>(frame) == L) {
                <span class="hljs-selector-tag">tmp_level</span>++
            }

            <span class="hljs-selector-tag">if</span> (tmp_level-- == <span class="hljs-number">0</span>) {
                <span class="hljs-selector-tag">size</span> = (nextframe - frame) / @<span class="hljs-selector-tag">sizeof_TValue</span>
                <span class="hljs-selector-tag">found_frame</span> = <span class="hljs-number">1</span>
                <span class="hljs-selector-tag">break</span>
            }
            <span class="hljs-selector-tag">nextframe</span> = <span class="hljs-selector-tag">frame</span>
            <span class="hljs-selector-tag">if</span> (<span class="hljs-variable">@frame_islua</span>(frame)) {
                <span class="hljs-selector-tag">frame</span> = @<span class="hljs-selector-tag">frame_prevl</span>(frame)

            } <span class="hljs-selector-tag">else</span> {
                <span class="hljs-selector-tag">if</span> (<span class="hljs-variable">@frame_isvarg</span>(frame)) {
                    <span class="hljs-selector-tag">tmp_level</span>++;  <span class="hljs-comment">/* Skip vararg pseudo-frame. */</span>
                }

                <span class="hljs-selector-tag">frame</span> = @<span class="hljs-selector-tag">frame_prevd</span>(frame);
            }
        }

        <span class="hljs-selector-tag">if</span> (!found_frame) {
            <span class="hljs-selector-tag">frame</span> = <span class="hljs-number">0</span>
            <span class="hljs-selector-tag">size</span> = <span class="hljs-selector-tag">tmp_level</span>
        }
        <span class="hljs-comment">/* }}} */</span>

        <span class="hljs-selector-tag">if</span> (frame) {
            <span class="hljs-comment">//nextframe = size ? frame + size * @sizeof_TValue : 0</span>
            <span class="hljs-selector-tag">fn</span> = <span class="hljs-selector-tag">luajit_frame_func</span>(frame)
            <span class="hljs-selector-tag">if</span> (fn == <span class="hljs-number">0</span>) {
                <span class="hljs-selector-tag">return</span> ""
            }
            <span class="hljs-selector-tag">if</span> (<span class="hljs-variable">@isluafunc</span>(fn)) {
                <span class="hljs-selector-tag">pt</span> = @<span class="hljs-selector-tag">funcproto</span>(fn)

                <span class="hljs-selector-tag">if</span> (simple) {
                    <span class="hljs-selector-tag">line</span> = $*<span class="hljs-selector-tag">pt-</span>&gt;<span class="hljs-selector-tag">firstline</span>

                } <span class="hljs-selector-tag">else</span> {
                    <span class="hljs-selector-tag">line</span> = <span class="hljs-selector-tag">luajit_debug_frameline</span>(L, T, fn, pt, nextframe)
                    <span class="hljs-selector-tag">if</span> (line &lt; <span class="hljs-number">0</span>) {
                        <span class="hljs-selector-tag">line</span> = $*<span class="hljs-selector-tag">pt-</span>&gt;<span class="hljs-selector-tag">firstline</span>
                        <span class="hljs-comment">//printf("using firstline %d\n", line)</span>

                    } <span class="hljs-selector-tag">else</span> {
                        <span class="hljs-comment">//printf("GOT the lineno %d\n", line)</span>
                    }
                }

                <span class="hljs-selector-tag">name</span> = <span class="hljs-selector-tag">luajit_proto_chunkname</span>(pt)  <span class="hljs-comment">/* GCstr *name */</span>
                <span class="hljs-selector-tag">if</span> (name == <span class="hljs-number">0</span>) {
                    <span class="hljs-selector-tag">return</span> ""
                }

                <span class="hljs-selector-tag">path</span> = <span class="hljs-selector-tag">luajit_unbox_gcstr</span>(name)
                <span class="hljs-selector-tag">bt</span> .= <span class="hljs-selector-tag">sprintf</span>(<span class="hljs-string">"%s:%d\n"</span>, path, line)

            } <span class="hljs-selector-tag">else</span> <span class="hljs-selector-tag">if</span> (<span class="hljs-variable">@isffunc</span>(fn)) {
                <span class="hljs-selector-tag">bt</span> .= <span class="hljs-selector-tag">sprintf</span>(<span class="hljs-string">"builtin#%d\n"</span>, $*fn-&gt;c-&gt;ffid)

            } <span class="hljs-selector-tag">else</span> {
                <span class="hljs-comment">/* C function */</span>
                <span class="hljs-selector-tag">cfunc</span> = $*<span class="hljs-selector-tag">fn-</span>&gt;<span class="hljs-selector-tag">c-</span>&gt;<span class="hljs-selector-tag">f</span>
                <span class="hljs-selector-tag">sym</span> = <span class="hljs-selector-tag">luajit_cfunc_cache</span><span class="hljs-selector-attr">[cfunc]</span>
                <span class="hljs-selector-tag">if</span> (sym == <span class="hljs-string">""</span>) {
                    <span class="hljs-selector-tag">sym</span> = <span class="hljs-selector-tag">sprintf</span>(<span class="hljs-string">"C:%s\n"</span>, <span class="hljs-built_in">usymname</span>(cfunc))
                    <span class="hljs-selector-tag">luajit_cfunc_cache</span><span class="hljs-selector-attr">[cfunc]</span> = <span class="hljs-selector-tag">sym</span>
                }
                <span class="hljs-selector-tag">bt</span> .= <span class="hljs-selector-tag">sym</span>
            }

        } <span class="hljs-selector-tag">else</span> <span class="hljs-selector-tag">if</span> (dir == <span class="hljs-number">1</span>) {
            <span class="hljs-selector-tag">break</span>

        } <span class="hljs-selector-tag">else</span> {
            <span class="hljs-selector-tag">level</span> <span class="hljs-selector-tag">-</span>= <span class="hljs-selector-tag">size</span>
        }
        <span class="hljs-selector-tag">level</span> += <span class="hljs-selector-tag">dir</span>
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bt</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_cur_thread</span>(g)
{
    $*g := @cast(g, "global_State", "$^libluajit_path")
    gco = $*g-&gt;cur_L-&gt;gcptr64
    if (gco == 0) {
        return 0
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">gco-</span>&gt;<span class="hljs-selector-tag">th</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_get_trace</span>(g, traceno)
{
    <span class="hljs-selector-tag">GG</span> = <span class="hljs-selector-tag">g</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">&amp;</span>@<span class="hljs-selector-tag">cast</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"GG_State"</span>, <span class="hljs-string">"$^libluajit_path"</span>)<span class="hljs-selector-tag">-</span>&gt;<span class="hljs-selector-tag">g</span>
    $*<span class="hljs-selector-tag">GG</span> := @<span class="hljs-selector-tag">cast</span>(GG, <span class="hljs-string">"GG_State"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
    <span class="hljs-selector-tag">J</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">GG-</span>&gt;<span class="hljs-selector-tag">J</span>
    $*<span class="hljs-selector-tag">J</span> := @<span class="hljs-selector-tag">cast</span>(J, <span class="hljs-string">"jit_State"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
    <span class="hljs-selector-tag">if</span> (J == <span class="hljs-number">0</span>) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-number">0</span>
    }

    <span class="hljs-selector-tag">return</span> $*<span class="hljs-selector-tag">J-</span>&gt;<span class="hljs-selector-tag">trace</span><span class="hljs-selector-attr">[traceno]</span><span class="hljs-selector-tag">-</span>&gt;<span class="hljs-selector-tag">gcptr64</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_trace_starting_func</span>(g, trace)
{
    $*trace := @cast(trace, "GCtrace", "$^libluajit_path")
    gco = $*trace-&gt;startpt-&gt;gcptr64
    if (gco == 0) {
        return ""
    }

    <span class="hljs-selector-tag">pt</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">gco-</span>&gt;<span class="hljs-selector-tag">pt</span>

    <span class="hljs-selector-tag">firstline</span> = $*<span class="hljs-selector-tag">pt-</span>&gt;<span class="hljs-selector-tag">firstline</span>

    <span class="hljs-selector-tag">name</span> = <span class="hljs-selector-tag">luajit_proto_chunkname</span>(pt)  <span class="hljs-comment">/* GCstr *name */</span>
    <span class="hljs-selector-tag">path</span> = <span class="hljs-selector-tag">luajit_unbox_gcstr</span>(name)

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">sprintf</span>(<span class="hljs-string">"%s:%d"</span>, path, firstline)
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_print_backtrace</span>(simple)
{
    <span class="hljs-selector-tag">if</span> (<span class="hljs-variable">@defined</span>(<span class="hljs-variable">@var</span>(<span class="hljs-string">"globalL"</span>, <span class="hljs-string">"$^exec_path"</span>))) {
        <span class="hljs-selector-tag">mL</span> = @<span class="hljs-selector-tag">var</span>(<span class="hljs-string">"globalL"</span>, <span class="hljs-string">"$^exec_path"</span>)

    } <span class="hljs-selector-tag">else</span> {
        <span class="hljs-selector-tag">mL</span> = <span class="hljs-selector-tag">ngx_lua_get_main_lua_vm</span>()
    }

    <span class="hljs-selector-tag">if</span> (mL == <span class="hljs-number">0</span>) {
        <span class="hljs-selector-tag">return</span> ""
    }

    <span class="hljs-selector-tag">g</span> = <span class="hljs-selector-tag">luajit_G</span>(mL)
    <span class="hljs-selector-tag">if</span> (g == <span class="hljs-number">0</span>) {
        <span class="hljs-selector-tag">return</span> ""
    }

    <span class="hljs-selector-tag">L</span> = <span class="hljs-selector-tag">luajit_cur_thread</span>(g)
    <span class="hljs-selector-tag">if</span> (L == <span class="hljs-number">0</span>) {
        <span class="hljs-selector-tag">return</span> ""
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">luajit_backtrace</span>(L, g, simple)
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_backtrace</span>(L, g, simple)
{
    <span class="hljs-selector-tag">bt</span> = ""

    <span class="hljs-selector-tag">vmstate</span> = $*<span class="hljs-selector-tag">g-</span>&gt;<span class="hljs-selector-tag">vmstate</span>
    <span class="hljs-selector-tag">if</span> (vmstate &gt;= <span class="hljs-number">0</span> || (vmstate == -<span class="hljs-number">3</span> &amp;&amp; $*g-&gt;jit_base-&gt;ptr64)) {
        <span class="hljs-comment">/* compiled Lua code */</span>

        <span class="hljs-selector-tag">T</span> = <span class="hljs-selector-tag">luajit_get_trace</span>(g, vmstate)
        <span class="hljs-selector-tag">if</span> (T) {
            <span class="hljs-selector-tag">if</span> (simple) {
                <span class="hljs-selector-tag">func</span> = <span class="hljs-selector-tag">luajit_trace_starting_func</span>(g, T)
                <span class="hljs-selector-tag">if</span> (func != <span class="hljs-string">""</span>) {
                    <span class="hljs-selector-tag">bt</span> .= <span class="hljs-selector-tag">sprintf</span>(<span class="hljs-string">"T:%s\n"</span>, func)
                }

            } <span class="hljs-selector-tag">else</span> {
                <span class="hljs-comment">//printf("start pc: %d\n", $*T-&gt;startpc-&gt;ptr64)</span>
            }

            <span class="hljs-selector-id">#warn</span>(<span class="hljs-built_in">sprintf</span>(<span class="hljs-string">"bt: %s"</span>, bt))
        }

        <span class="hljs-selector-tag">base</span> = $*<span class="hljs-selector-tag">g-</span>&gt;<span class="hljs-selector-tag">jit_base-</span>&gt;<span class="hljs-selector-tag">ptr64</span>
        <span class="hljs-selector-tag">if</span> (!base) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bt</span>
        }

        <span class="hljs-selector-tag">bt</span> .= <span class="hljs-selector-tag">luajit_debug_dumpstack</span>(L, T, $^<span class="hljs-attribute">arg_depth </span>:<span class="hljs-built_in">default</span>(<span class="hljs-number">30</span>), base, simple)
        <span class="hljs-comment">/*
        if (bt != "") {
            warn(sprintf("JIT backtrace: %s\n", bt))
        }
        */</span>

        <span class="hljs-comment">/*
        if (vmstate == -3) {
            printf("HIT JIT GC: %s===\n", bt)
        }
        */</span>

    } <span class="hljs-selector-tag">else</span> {

        <span class="hljs-selector-tag">if</span> (vmstate == -<span class="hljs-number">1</span> &amp;&amp; !$*L-&gt;cframe) {
            <span class="hljs-selector-tag">return</span> ""
        }

        <span class="hljs-selector-tag">if</span> (vmstate == -<span class="hljs-number">1</span> || vmstate == -<span class="hljs-number">2</span> || vmstate == -<span class="hljs-number">3</span>) {
            <span class="hljs-selector-tag">base</span> = $*<span class="hljs-selector-tag">L-</span>&gt;<span class="hljs-selector-tag">base</span>
            <span class="hljs-selector-tag">bt</span> .= <span class="hljs-selector-tag">luajit_debug_dumpstack</span>(L, <span class="hljs-number">0</span>, $^arg_depth, base, simple)
        }
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">bt</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_vm_state</span>(g)
{
    <span class="hljs-selector-tag">return</span> $*<span class="hljs-selector-tag">g-</span>&gt;<span class="hljs-selector-tag">vmstate</span>
}


<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_find_gcstr</span>(g, str)
{
    <span class="hljs-selector-tag">len</span> = <span class="hljs-selector-tag">strlen</span>(str)
    <span class="hljs-selector-tag">strmask</span> = $*<span class="hljs-selector-tag">g-</span>&gt;<span class="hljs-selector-tag">strmask</span>
    <span class="hljs-selector-tag">strnum</span> = $*<span class="hljs-selector-tag">g-</span>&gt;<span class="hljs-selector-tag">strnum</span>
    <span class="hljs-selector-tag">strhash</span> = $*<span class="hljs-selector-tag">g-</span>&gt;<span class="hljs-selector-tag">strhash</span>
    $*<span class="hljs-selector-tag">strhash</span> := @<span class="hljs-selector-tag">cast</span>(strhash, <span class="hljs-string">"GCRef"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
    <span class="hljs-selector-tag">ret</span> = <span class="hljs-number">0</span>

    <span class="hljs-selector-tag">n</span> = <span class="hljs-number">0</span>
    <span class="hljs-selector-tag">done</span> = <span class="hljs-number">0</span>
    <span class="hljs-selector-tag">for</span> (i = <span class="hljs-number">0</span>; i &lt;= strmask; i++) {
        <span class="hljs-selector-tag">p</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">strhash</span><span class="hljs-selector-attr">[i]</span>

        <span class="hljs-selector-tag">while</span> (p) {
            <span class="hljs-selector-tag">o</span> = <span class="hljs-selector-tag">luajit_gcref</span>(p)
            <span class="hljs-selector-tag">if</span> (o == <span class="hljs-number">0</span>) {
                <span class="hljs-selector-tag">break</span>
            }

            $*<span class="hljs-selector-tag">o</span> := @<span class="hljs-selector-tag">cast</span>(o, <span class="hljs-string">"GCobj"</span>, <span class="hljs-string">"$^libluajit_path"</span>)
            <span class="hljs-selector-tag">if</span> ($*o-&gt;str-&gt;len == len) {
                <span class="hljs-selector-tag">gcs</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">str</span>
                <span class="hljs-selector-tag">s</span> = <span class="hljs-selector-tag">luajit_unbox_gcstr</span>(gcs)
                <span class="hljs-selector-tag">if</span> (s == str) {
                    <span class="hljs-selector-tag">done</span> = <span class="hljs-number">1</span>
                    <span class="hljs-selector-tag">ret</span> = <span class="hljs-selector-tag">gcs</span>
                    <span class="hljs-selector-tag">break</span>
                }
            }

            <span class="hljs-selector-tag">if</span> (++n == strnum) {
                <span class="hljs-selector-tag">done</span> = <span class="hljs-number">1</span>
                <span class="hljs-selector-tag">break</span>
            }

            <span class="hljs-selector-tag">p</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">gch-</span>&gt;<span class="hljs-selector-tag">nextgc</span>
        }

        <span class="hljs-selector-tag">if</span> (done) {
            <span class="hljs-selector-tag">break</span>
        }
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ret</span>
}

<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">luajit_bucket_depth</span>(p)
{
    <span class="hljs-selector-tag">n</span> = <span class="hljs-number">0</span>
    <span class="hljs-selector-tag">while</span> (p) {
        $*o := @cast(o, "GCobj", "$^libluajit_path")
        o = luajit_gcref(p)
        if (o == 0) {
            break
        }

        <span class="hljs-selector-tag">n</span>++;
        <span class="hljs-selector-tag">p</span> = <span class="hljs-selector-tag">&amp;</span>$*<span class="hljs-selector-tag">o-</span>&gt;<span class="hljs-selector-tag">gch-</span>&gt;<span class="hljs-selector-tag">nextgc</span>
    }
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">n</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Fridaå¦‚ä½•ç¨³å®šè¿æ¥PCç«¯è·ŸAndroidæ‰‹æœºç«¯]]></title>    <link>https://juejin.cn/post/7577693903018377242</link>    <guid>https://juejin.cn/post/7577693903018377242</guid>    <pubDate>2025-11-29T14:39:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577693903018377242" data-draft-id="7577675494067863578" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Fridaå¦‚ä½•ç¨³å®šè¿æ¥PCç«¯è·ŸAndroidæ‰‹æœºç«¯"/> <meta itemprop="keywords" content="Android,Mac,Xposed"/> <meta itemprop="datePublished" content="2025-11-29T14:39:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YF0211"/> <meta itemprop="url" content="https://juejin.cn/user/2576910988619064"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Fridaå¦‚ä½•ç¨³å®šè¿æ¥PCç«¯è·ŸAndroidæ‰‹æœºç«¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2576910988619064/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YF0211
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T14:39:08.000Z" title="Sat Nov 29 2025 14:39:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>å¿…é¡»æŠŠ frida-server ä»¥ â€œzygote bypass æ¨¡å¼â€ å¯åŠ¨</strong></h2>
<p>æ­£ç¡®çš„å¯åŠ¨æ–¹å¼ï¼ˆç¨³å®šå¯ç”¨ï¼‰</p>
<ol>
<li>æŠŠ frida-server æ”¾åˆ°ä¸€ä¸ªé€‚åˆçš„ç›®å½•ï¼š</li>
</ol>
<pre><code class="hljs language-perl" lang="perl">adb <span class="hljs-keyword">push</span> frida /data/<span class="hljs-keyword">local</span>/tmp/
adb shell
su
<span class="hljs-keyword">chmod</span> <span class="hljs-number">755</span> /data/<span class="hljs-keyword">local</span>/tmp/frida
</code></pre>
<ol start="2">
<li>ä½¿ç”¨ <code>--runtime=v8</code> å¼ºåˆ¶ V8 å¼•æ“æ¨¡å¼ï¼ˆè§£å†³ ptrace å»¶æ—¶é”™è¯¯ï¼‰</li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino">su -c <span class="hljs-string">"/data/local/tmp/frida --runtime=v8 -D"</span>
</code></pre>
<p><strong>å¿…é¡»åŠ  <code>-D</code>ï¼ˆdaemon æ¨¡å¼ï¼‰</strong></p>
<ol start="3">
<li>ç¦ç”¨ seccompï¼ˆPixel 5 å¿…é¡»ï¼‰</li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino">setenforce <span class="hljs-number">0</span>
su -c <span class="hljs-string">"cmd task lock-profile 0"</span>
</code></pre>
<p>å°½ç®¡å·²ç»æ˜¯ Permissiveï¼Œä½†ä¾ç„¶æœ‰ <strong>seccomp filter</strong> é˜»æ‹¦ ptraceï¼Œå¿…é¡»åŠ ä¸Šè¿™ä¸ªå‘½ä»¤ï¼š
è§£é” task profileï¼ˆPixel ç³»åˆ—ç‰¹æœ‰ï¼‰ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">su -c <span class="hljs-string">"locksettings set-secure user_verified 1"</span>
</code></pre>
<ol start="4">
<li>ä¸è¦ spawnï¼Œåœ¨ Android 14 ä¼šå¤±è´¥,æ­£ç¡® attach æ–¹æ³•ï¼šå…ˆå¯åŠ¨ APPï¼Œå† attach.</li>
</ol>
<pre><code class="hljs language-css" lang="css">adb shell pidof com<span class="hljs-selector-class">.charmy</span><span class="hljs-selector-class">.cupist</span>
frida -U -<span class="hljs-selector-tag">p</span> &lt;PID&gt; <span class="hljs-attr">--runtime</span>=v8
</code></pre>
<p>è‹¥è¿˜å¤±è´¥ï¼ŒåŠ ï¼š</p>
<pre><code class="hljs language-css" lang="css">frida -U -<span class="hljs-selector-tag">p</span> &lt;PID&gt; <span class="hljs-attr">--enable-jit</span> <span class="hljs-attr">--runtime</span>=v8
</code></pre>
<ol start="5">
<li>Pixel 5 / Android 14 ä¸“å±è¡¥ä¸ï¼ˆæœ€å…³é”®),Pixel 5 éœ€è¦å…³é—­ hardware-assisted ptrace restriction</li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino">adb shell su -c <span class="hljs-string">"echo 0 &gt; /proc/sys/kernel/yama/ptrace_scope"</span>

</code></pre>
<p>å†æ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /proc/sys/kernel/yama/ptrace_scope
</code></pre>
<p>å¿…é¡»è¿”å› <code>0</code></p>
<ol start="6">
<li>å¦‚æœä»é™„åŠ å¤±è´¥ â†’ ä½¿ç”¨ Riru / LSPosed æ³¨å…¥ FridaDexï¼ˆæ•ˆæœæœ€ä½³ï¼‰,å®‰è£…æ¨¡å—ï¼š</li>
</ol>
<pre><code class="hljs language-python" lang="python">frida-riru-<span class="hljs-number">17.</span>x.x.<span class="hljs-built_in">zip</span>
</code></pre>
<p>æ¨¡å—ç‰¹ç‚¹ï¼š</p>
<p>âœ” æ— éœ€ frida-server<br/>
âœ” ä¸èµ° ptrace<br/>
âœ” Android 14 å®Œå…¨å…¼å®¹<br/>
âœ” APP å¯åŠ¨å³æ³¨å…¥</p>
<p>ç„¶åä½¿ç”¨ï¼š</p>
<pre><code class="hljs">frida -U -n com.charmy.cupist
</code></pre>
<p>å³å¯ç¨³å®šæ³¨å…¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Transformer çš„æŠ€æœ¯å±‚é¢]]></title>    <link>https://juejin.cn/post/7577625663257772032</link>    <guid>https://juejin.cn/post/7577625663257772032</guid>    <pubDate>2025-11-29T11:46:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577625663257772032" data-draft-id="7577647745110179840" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Transformer çš„æŠ€æœ¯å±‚é¢"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-29T11:46:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·480215170247"/> <meta itemprop="url" content="https://juejin.cn/user/2631551226224443"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Transformer çš„æŠ€æœ¯å±‚é¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2631551226224443/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·480215170247
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T11:46:20.000Z" title="Sat Nov 29 2025 11:46:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œåœ¨å¤§æ¨¡å‹æ¨ç†ä¸è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰æ•°æ®çš„å¤„ç†éƒ½ä»¥**å‘é‡ï¼ˆVectorï¼‰**å½¢å¼è¿›è¡Œã€‚ä»æ•´ä½“æ¥çœ‹ï¼ŒTransformer ä¼šå°†æ•´ä¸ªä¸Šä¸‹æ–‡çš„ä¿¡æ¯ä¸æ–­èåˆè¿›æ¯ä¸€ä¸ª token çš„éšè—çŠ¶æ€ä¸­ï¼Œè€Œç”¨äºé¢„æµ‹ä¸‹ä¸€ä¸ªè¯çš„ï¼Œæ˜¯ <strong>æœ€åä¸€ä¸ª token ç»è¿‡å¤šå±‚æ³¨æ„åŠ›ä¸ MLP åçš„éšè—å‘é‡ï¼ˆhidden stateï¼‰</strong> ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬ä»æ¨¡å‹çš„å…¥å£å¼€å§‹â€”â€”å‘é‡çš„å½¢æˆï¼ˆEmbeddingï¼‰ï¼Œå†åˆ°æ ¸å¿ƒçš„ Attentionã€MLPï¼Œæœ€ååˆ°è§£ç å™¨ï¼Œå®Œæ•´ç†è§£ä¸€å¥è¯æ˜¯å¦‚ä½•è¢«â€œç†è§£â€å¹¶ç”Ÿæˆä¸‹ä¸€è¯çš„ã€‚</p>
<hr/>
<h2 data-id="heading-0"><strong>ä¸€ã€ç¼–ç å±‚ï¼ˆEmbedding + ä½ç½®ç¼–ç ï¼‰</strong></h2>
<p>å½“å¥å­è¿›å…¥æ¨¡å‹åï¼Œä¼šè¢«åˆ†å‰²æˆä¸€ä¸ªä¸€ä¸ªçš„ <strong>tokenï¼ˆè¯æˆ–å­è¯ï¼‰</strong> ã€‚<br/>
è¿™äº› token æœ¬è´¨ä¸Šæ˜¯è¯è¡¨ä¸­çš„ç´¢å¼•ï¼ˆä¾‹å¦‚ 0~5w çš„æ•°å­—ï¼‰ã€‚</p>
<p>Transformer çš„â€œç¼–ç å±‚â€å®é™…ä¸Šä¸æ˜¯ Encoder æ¨¡å—ï¼Œè€Œæ˜¯ï¼š</p>
<pre><code class="hljs language-css" lang="css">Token Embedding  
+ <span class="hljs-attribute">Position</span> Embedding / Encoding
</code></pre>
<p>ä¾‹å¦‚ GPT-3 ä¸­ï¼ŒEmbedding ä¼šå°†æ¯ä¸ª token æ˜ å°„åˆ°ä¸€ä¸ª <strong>12288 ç»´å‘é‡</strong>ã€‚åŒæ—¶ï¼Œæ¨¡å‹è¿˜ä¼šåŠ å…¥â€œä½ç½®ç¼–ç â€ï¼Œè®©æ¨¡å‹åŒºåˆ†å¥å­é¡ºåºï¼ˆä¾‹å¦‚çŸ¥é“â€œä½ åƒè‹¹æœâ€ â‰  â€œè‹¹æœåƒä½ â€ï¼‰ã€‚</p>
<p>æ­¤æ—¶çš„æ¯ä¸ª token åªæ˜¯ä¸€ä¸ªç‹¬ç«‹å‘é‡ï¼Œ<strong>å®ƒè¿˜ä¸çŸ¥é“ä¸Šä¸‹æ–‡ï¼Œä¹Ÿä¸çŸ¥é“å·¦è¾¹æ˜¯ä»€ä¹ˆå³è¾¹æ˜¯ä»€ä¹ˆ</strong>ã€‚æ¥ä¸‹æ¥å°±äº¤ç»™æ³¨æ„åŠ›æœºåˆ¶ã€‚</p>
<hr/>
<h2 data-id="heading-1"><strong>äºŒã€æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttentionï¼‰</strong></h2>
<p>ç»è¿‡ Embedding åï¼Œæ¯ä¸ª token çš„å‘é‡éƒ½ä¼šå¹¶è¡Œåœ°è®¡ç®—ä¸‰ç§æŠ•å½±ï¼š</p>
<ul>
<li><strong>Qï¼ˆQueryï¼‰</strong> ï¼šæˆ‘åœ¨å¯»æ‰¾ä»€ä¹ˆä¿¡æ¯ï¼Ÿ</li>
<li><strong>Kï¼ˆKeyï¼‰</strong> ï¼šåˆ«äººå¦‚ä½•æ ¹æ®æˆ‘æ¥åˆ¤æ–­æ˜¯å¦åº”è¯¥å…³æ³¨æˆ‘ï¼Ÿ</li>
<li><strong>Vï¼ˆValueï¼‰</strong> ï¼šå¦‚æœåˆ«äººå…³æ³¨æˆ‘ï¼Œæˆ‘æ„¿æ„æä¾›ä»€ä¹ˆå†…å®¹ç‰¹å¾ï¼Ÿ</li>
</ul>
<p>è¿™ä¸‰è€…æ¥è‡ªä¸‰ç»„ç‹¬ç«‹çš„çŸ©é˜µï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">q</span> = xW_Q
<span class="hljs-attr">k</span> = xW_K
<span class="hljs-attr">v</span> = xW_V
</code></pre>
<p>Attention çš„æ ¸å¿ƒæ˜¯ï¼š</p>
<blockquote>
<p><strong>Q ä¸ K çš„ç›¸ä¼¼åº¦å†³å®šâ€œå…³æ³¨çš„æƒé‡â€ï¼Œ<br/>
V å†³å®šâ€œè¢«æ‹¿èµ°çš„å†…å®¹â€ã€‚</strong></p>
</blockquote>
<p>æ•°å­¦è¡¨ç°ä¸ºï¼š</p>
<p>Î±ij=softmax(qiâ‹…kjdk)\alpha_{ij} = softmax\left(\frac{q_i \cdot k_j}{\sqrt{d_k}}\right)Î±ijâ€‹=softmax(dkâ€‹â€‹qiâ€‹â‹…kjâ€‹â€‹) outi=âˆ‘jÎ±ijvjout_i = \sum_j \alpha_{ij} v_joutiâ€‹=jâˆ‘â€‹Î±ijâ€‹vjâ€‹</p>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>token <em>i</em> ä¼šæ ¹æ® Q ä¸æ‰€æœ‰ token çš„ K çš„ç›¸ä¼¼åº¦å†³å®šâ€œçœ‹è°å¤šï¼Œçœ‹è°å°‘â€ï¼›</li>
<li>å¾—åˆ°çš„æƒé‡å†ä¸ V åŠ æƒæ±‚å’Œï¼Œå½¢æˆæ¯ä¸ª token èåˆä¸Šä¸‹æ–‡åçš„è¯­ä¹‰è¡¨ç¤ºã€‚</li>
</ul>
<p>å› æ­¤ï¼Œä¸€ä¸ªâ€œè‹¹æœâ€ä¼šåœ¨ä¸Šä¸‹æ–‡çš„å¸®åŠ©ä¸‹ä»ï¼š</p>
<pre><code class="hljs">â€œè‹¹æœâ€
</code></pre>
<p>å˜æˆï¼š</p>
<pre><code class="hljs">â€œè¢«å°æœ‹å‹å’¬äº†ä¸€å£çš„çº¢å¯Œå£«è‹¹æœâ€
</code></pre>
<p>å®ƒè·å¾—äº†ä¸Šä¸‹æ–‡èµ‹äºˆçš„è¯­ä¹‰è¡¥å……ã€‚</p>
<hr/>
<h2 data-id="heading-2"><strong>ä¸‰ã€å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰</strong></h2>
<p>ä¸ºäº†è®©æ¨¡å‹ä»ä¸åŒè§’åº¦è§‚å¯Ÿå¥å­ï¼ˆå¦‚å¥æ³•ã€è¯­ä¹‰ã€å®ä½“ã€å…³ç³»ç­‰ï¼‰ï¼ŒTransformer å¹¶ä¸æ˜¯åªåšä¸€æ¬¡ QKVï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>åŒä¸€å±‚å†…éƒ¨ä½¿ç”¨å¤šç»„ï¼ˆå¦‚ GPT-3 çš„ 96 ç»„ï¼‰Q/K/V å¹¶è¡Œè®¡ç®—æ³¨æ„åŠ›ã€‚</strong></p>
</blockquote>
<p>æ¯ä¸€ç»„å«åšä¸€ä¸ª <strong>headï¼ˆæ³¨æ„åŠ›å¤´ï¼‰</strong> ã€‚</p>
<p>æµç¨‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">è¾“å…¥å‘é‡ â†’ 96 å¥— W_Q/W_K/W_V â†’ å¾—åˆ° 96 å¥— q/k/v  
â†’ 96 æ¬¡ç‹¬ç«‹çš„ Attention  
â†’ concat æ‹¼æ¥  
â†’ å†çº¿æ€§èåˆå›åˆ°åŸç»´åº¦
</code></pre>
<p>ä½ å¯ä»¥ç†è§£ä¸ºï¼š</p>
<blockquote>
<p><strong>å¤šå¤´æ³¨æ„åŠ› = å•å±‚å†…éƒ¨çš„ 96 ä¸ªâ€œä¸åŒè§†è§’â€åŒæ—¶è¯»æ‡‚ä¸€å¥è¯ã€‚</strong></p>
</blockquote>
<p>ä½†è¿™ä¸€æ•´å¥—æ“ä½œä»ç„¶è¢«è§†ä¸º <strong>ä¸€æ¬¡ Attention å±‚</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-3"><strong>å››ã€MLPï¼ˆå‰é¦ˆç½‘ç»œ / å¤šå±‚æ„ŸçŸ¥æœºï¼‰</strong></h2>
<p>Attention è®© token å¾—åˆ°äº†ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½†è¯­ä¹‰ä»éœ€è¦è¿›ä¸€æ­¥éçº¿æ€§å˜æ¢ä¸ç‰¹å¾ç»„åˆâ€”â€”è¿™æ­£æ˜¯ MLP çš„ä½œç”¨ã€‚</p>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p><strong>Attention è´Ÿè´£â€œä¿¡æ¯æµåŠ¨ä¸ä¸Šä¸‹æ–‡ç†è§£â€ï¼Œ<br/>
MLP è´Ÿè´£â€œç‰¹å¾å¢å¼ºã€éçº¿æ€§è¡¨è¾¾ä¸é«˜é˜¶æŠ½è±¡â€ã€‚</strong></p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>â€œå¡”â€ ç»è¿‡ Attention åçŸ¥é“ä¸Šä¸‹æ–‡æŒ‡çš„æ˜¯â€œåŸƒè²å°”é“å¡”â€ï¼›</li>
<li>MLP ä¼šè¿›ä¸€æ­¥åŠ å¼ºå®ƒçš„ç‰¹å¾ï¼Œå¦‚â€œé“åšçš„ã€é«˜ã€æœ‰ç»“æ„ç‰¹å¾â€ç­‰ã€‚</li>
</ul>
<p>MLP ç»“æ„é€šå¸¸æ˜¯ï¼š</p>
<pre><code class="hljs">d_model â†’ d_ffï¼ˆæ‰©å¤§æ•°å€ï¼‰â†’ d_model
</code></pre>
<p>é€šè¿‡ä¸¤æ¬¡çº¿æ€§å˜æ¢ + æ¿€æ´»å‡½æ•°ï¼ˆå¦‚ GELUï¼‰ï¼Œä½¿ token çš„è¯­ä¹‰è¡¨è¾¾æ›´ä¸°å¯Œã€‚</p>
<hr/>
<h2 data-id="heading-4"><strong>äº”ã€å¤šå±‚ Transformerï¼ˆLayer Stackï¼‰</strong></h2>
<p>Transformer çš„åŸºæœ¬ç»“æ„å•å…ƒæ˜¯ <strong>ä¸€ä¸ª block</strong>ï¼š</p>
<pre><code class="hljs">ï¼ˆ1ï¼‰å¤šå¤´æ³¨æ„åŠ›  
ï¼ˆ2ï¼‰æ®‹å·® + LayerNorm  
ï¼ˆ3ï¼‰MLP  
ï¼ˆ4ï¼‰æ®‹å·® + LayerNorm
</code></pre>
<p>GPT-3 175B å…·æœ‰ <strong>96 å±‚</strong>è¿™æ ·çš„ blockï¼Œå±‚å±‚å †å ï¼Œæ¯ä¸€å±‚éƒ½ä½¿ token çš„éšè—çŠ¶æ€æ›´æŠ½è±¡ã€æ›´å…¨å±€ã€æ›´é«˜é˜¶ã€‚</p>
<p>å› æ­¤ï¼š</p>
<blockquote>
<p><strong>å¤šå¤´ = åŒä¸€å±‚å†…éƒ¨çš„æ¨ªå‘å¹¶è¡Œ<br/>
å¤šå±‚ = æ¨¡å‹çºµå‘çš„æ·±åº¦å †å </strong></p>
</blockquote>
<p>ä¸¤è€…ä¸æ˜¯ä¸€å›äº‹ã€‚</p>
<hr/>
<h2 data-id="heading-5"><strong>å…­ã€è§£ç å™¨ï¼ˆçº¿æ€§å±‚ + Softmaxï¼‰</strong></h2>
<p>Transformer æœ€ç»ˆä¼šä½¿ç”¨â€œæœ€åä¸€ä¸ª token çš„éšè—çŠ¶æ€â€æ¥é¢„æµ‹ä¸‹ä¸€è¯ã€‚</p>
<p>æµç¨‹ï¼š</p>
<ol>
<li><strong>çº¿æ€§å±‚ï¼ˆLinearï¼‰</strong><br/>
å°† hidden stateï¼ˆå¦‚ 12288 ç»´ï¼‰æ˜ å°„åˆ°è¯è¡¨ç»´åº¦ï¼ˆå¦‚ 50k ç»´ï¼‰ï¼Œå¾—åˆ° logitsï¼ˆç”ŸçŒ›åˆ†æ•°ï¼‰ã€‚</li>
<li><strong>Softmax</strong><br/>
æŠŠ logits è½¬æˆæ¦‚ç‡åˆ†å¸ƒï¼Œè¡¨ç¤ºæ¯ä¸ªè¯ä½œä¸ºä¸‹ä¸€ token çš„å¯èƒ½æ€§ã€‚</li>
</ol>
<p>æœ€ç»ˆï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">P</span>(è‹¹æœ) = <span class="hljs-number">0.72</span>  
<span class="hljs-selector-tag">P</span>(é¦™è•‰) = <span class="hljs-number">0.10</span>  
<span class="hljs-selector-tag">P</span>(è‘¡è„) = <span class="hljs-number">0.05</span>  
...
</code></pre>
<p>ä¹‹åç”±æ¨ç†ç­–ç•¥ï¼ˆgreedy/top-k/top-p ç­‰ï¼‰é€‰æ‹©ä¸‹ä¸€è¯ã€‚</p>
<hr/>
<h2 data-id="heading-6"><strong>ä¸ƒã€æœ€ç»ˆæ€»ç»“</strong></h2>
<p>Transformer çš„å®Œæ•´æµç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼š</p>
<ol>
<li>æ–‡æœ¬ â†’ token â†’ Embedding + ä½ç½®ç¼–ç </li>
<li>å¤šå¤´æ³¨æ„åŠ›è®©æ¯ä¸ª token ä¸æ‰€æœ‰å…¶ä»– token äº¤æ¢ä¿¡æ¯</li>
<li>MLP è¿›ä¸€æ­¥æŠ½è±¡ç‰¹å¾</li>
<li>å¤šå±‚ block å †å å½¢æˆæ·±åº¦ç†è§£</li>
<li>æœ€åä¸€ä¸ª token çš„éšè—çŠ¶æ€ç»çº¿æ€§å±‚ + softmax å¾—åˆ°ä¸‹ä¸€è¯æ¦‚ç‡</li>
<li>æ¨ç†ç­–ç•¥é€‰å‡ºä¸‹ä¸€ä¸ª token</li>
</ol>
<p>è¿™å°±æ˜¯ Transformer ç»“æ„çš„æ ¸å¿ƒé€»è¾‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å°ç™½ä¹Ÿèƒ½çœ‹æ‡‚! ä»Šå¹´çˆ†ç«çš„ MCP åè®®ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿå†™ç»™æ™®é€šäººçš„ MCP æŒ‡å—]]></title>    <link>https://juejin.cn/post/7577971299742466086</link>    <guid>https://juejin.cn/post/7577971299742466086</guid>    <pubDate>2025-11-30T03:20:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577971299742466086" data-draft-id="7577689171223265330" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å°ç™½ä¹Ÿèƒ½çœ‹æ‡‚! ä»Šå¹´çˆ†ç«çš„ MCP åè®®ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿå†™ç»™æ™®é€šäººçš„ MCP æŒ‡å—"/> <meta itemprop="keywords" content="MCP,AIGC,åç«¯"/> <meta itemprop="datePublished" content="2025-11-30T03:20:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éŸ©æ•°"/> <meta itemprop="url" content="https://juejin.cn/user/2788017218794462"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å°ç™½ä¹Ÿèƒ½çœ‹æ‡‚! ä»Šå¹´çˆ†ç«çš„ MCP åè®®ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿå†™ç»™æ™®é€šäººçš„ MCP æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017218794462/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éŸ©æ•°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T03:20:09.000Z" title="Sun Nov 30 2025 03:20:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯éŸ©æ•°åŒå­¦ã€‚è‡´åŠ›äºåˆ†äº« Github ä¸Šé‚£äº› Â å¥½ç©Â Â æœ‰è¶£Â Â å…è´¹Â Â å®ç”¨Â Â çš„é«˜è´¨é‡é¡¹ç›®ã€‚</p>
<p>æˆ‘ä»¬å…³æ³¨è¿™ä¸ªä¸–ç•Œä¸Šé‚£äº›æ–°å¥‡çš„å¼€æºé¡¹ç›®ï¼Œä½œä¸ºå¼€æºæŠ€æœ¯åšä¸»ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆæƒ³å¸¦ä½ å»äº†è§£é‚£äº›æŠ€æœ¯èƒŒåçš„äº‹æƒ…, ä»Šå¤©æ˜¯æˆ‘ä»¬ AIGC é¦–ç¯‡æ–‡ç« , å…³äº MCP åè®®ã€‚</p>
<h4 data-id="heading-0">ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ MCP</h4>
<p>åœ¨äº†è§£ä»€ä¹ˆæ˜¯ MCP ä¹‹å‰, Â æˆ‘ä»¬éœ€è¦å…ˆæœ€åŸºç¡€çš„äº†è§£ä¸‹å¤§æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€æçš„ LLM. LLM çš„æ¦‚å¿µåˆ°ä»Šå¤©å·²ç»å®Œå…¨ä¸å†é™Œç”Ÿ, Â é¦–å…ˆå¤§è¯­è¨€æ¨¡å‹ä¸»è¦çš„ç‰¹ç‚¹åˆ™åœ¨äºå®ƒä½¿ç”¨è¿‡å»çš„æ•°æ®è®­ç»ƒè€Œæˆ, Â å› æ­¤æœªå¼€å¯è”ç½‘èƒ½åŠ›ä¸‹çš„å¤§è¯­è¨€æ¨¡å‹çš„çŸ¥è¯†åˆ™åœç•™åœ¨è®­ç»ƒä»–çš„æ•°æ®é‚£ä¸€åˆ»ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªä¾‹å­ç®€å•è¯æ˜è¿™ä¸€ç‚¹:</p>
<p>ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é—®å¤§æ¨¡å‹ä¸€ä¸ªç®€å•çš„é—®é¢˜:Â è¯·å¸®æˆ‘ç”Ÿæˆä¸€ä¸ª json æ•°æ®ï¼Œä½¿ç”¨æœ€æ–°çš„æ—¥æœŸ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bca56b4743041878f7272afa6e8f8fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-p5pWw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765077609&amp;x-signature=ejnx%2FwQhc7KSxDZvJRHSQkxxYAo%3D" alt="image.png" loading="lazy"/></p>
<p>å› æ­¤è¿™å°±æ„å‘³ç€ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å¤§è¯­è¨€æ¨¡å‹çš„å±€é™æ€§ï¼Œè¯•æƒ³äººç±»å¦‚ä½•è·å–æ–°çŸ¥è¯†ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥ä¸Šæœç´¢å¼•æ“æŸ¥ç½‘é¡µ, Â å»å›¾ä¹¦é¦†æŸ¥é˜…ç›¸å…³æ•°æ®ï¼Œè¿˜å¯ä»¥ç¼ ç€æœ‹å‹é—®ï¼Œæˆ‘ä»¬ä¾é ä¸»åŠ¨ä¸ä¸–ç•Œäº¤äº’è€Œè·å–æ–°çŸ¥è¯†ï¼Œè€Œå•çº¯é å¤§æ¨¡å‹æœ¬èº«å¾ˆéš¾åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>çŸ¥è¯†çš„å±€é™æ€§å’Œç¼ºä¹å’Œä¸ç”¨æˆ·ç”µè„‘è¿›è¡ŒçœŸå®äº¤äº’æå¤§çš„åˆ¶çº¦äº†å¤§è¯­è¨€æ¨¡å‹çš„èƒ½åŠ›ã€‚</p>
<h4 data-id="heading-1">Function Calling å’Œ ToolÂ </h4>
<p>è€Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå„ä¸ªå¤§æ¨¡å‹æœåŠ¡å•†æå‡ºäº†Â Function Calling å’Œ Tool æ¦‚å¿µï¼Œ Function Calling Â ä¸º OpenAI æ¨¡å‹æä¾›äº†ä¸€ç§å¼ºå¤§ä¸”çµæ´»çš„æ–¹å¼ï¼Œä½¿å…¶èƒ½å¤Ÿä¸å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œå¹¶è®¿é—®å…¶è®­ç»ƒæ•°æ®ä¹‹å¤–çš„æ•°æ®ã€‚Tool åˆ™æ˜¯ç”±Â OpenAIÂ å·²ç»å†…ç½®æ‰˜ç®¡çš„ä¸€ç³»åˆ— Function Calling, Â ä¾‹å¦‚è”ç½‘æœç´¢ï¼Œç”Ÿæˆå›¾åƒï¼Œè§£ææ–‡ä»¶ç­‰ç­‰ç­‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ce0c22a222741c09ffa49c9a1a47808~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-p5pWw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765077609&amp;x-signature=WMw8F%2B18ennW%2BgjfCc8K1RCW92E%3D" alt="Image" loading="lazy"/></p>
<p>ä¾‹å¦‚å½“æˆ‘ä»¬éœ€è¦é—®å¤§æ¨¡å‹å½“å‰çš„å¤©æ°”å¦‚ä½•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰è¿™æ ·ä¸€ä¸ª Function Calling Â å¹¶æ³¨å†Œåˆ°Â å¤§æ¨¡å‹Â çš„ä¸Šä¸‹æ–‡ä¸­ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e9b37ad331644a2adaa350d7010aca8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-p5pWw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765077609&amp;x-signature=qCh7QlHTwgcDG1IBXHupBZbELV4%3D" alt="Image" loading="lazy"/></p>
<p>æ­¤æ—¶çš„ Function Calling æ³¨æ„å®ƒçš„ parameters éƒ¨åˆ†å·²ç»å’Œ MCP çš„åè®®éå¸¸åƒäº†ï¼Œè¿™éƒ¨åˆ†åŸºæœ¬ä¸Šæ˜¯ä» Openapi çš„åè®®æ¼”å˜è€Œæ¥çš„ã€‚</p>
<p>è°ƒç”¨è¿‡ç¨‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b46f1647cc614f63b72a7407a490bb7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-p5pWw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765077609&amp;x-signature=vhwbNcHfGNkjcuutxrnUqOfzxgg%3D" alt="Image" loading="lazy"/></p>
<h3 data-id="heading-2">Function Calling Â æ‰§è¡Œæµç¨‹:</h3>
<ol>
<li>Codeï¼šå°†functionæè¿°å’Œè¦æ±‚å‘é€ç»™LLM</li>
<li>LLMï¼šLLMæ¥ç¡®å®šæ˜¯ç›´æ¥ç»™ç­”å¤ï¼Œè¿˜æ˜¯éœ€è¦è°ƒç”¨ function</li>
<li>LLMï¼šå¦‚ä½•è¦è°ƒç”¨functionï¼Œåˆ™è¿”å›éœ€è¦è°ƒç”¨çš„ function ä»¥åŠè°ƒç”¨ function æ‰€éœ€è¦çš„å‚æ•°</li>
<li>Codeï¼šç¨‹åºæ”¶åˆ° LLM è¿”å›åï¼Œæ ¹æ® LLM çš„è¿”å›ä¿¡æ¯ï¼Œæ‰§è¡Œ function</li>
<li>Codeï¼šå°† function æ‰§è¡Œåå¾—åˆ°çš„ç»“æœï¼Œä»¥åŠ prompt æç¤ºè¯å‘é€ç»™ LLM</li>
<li>LLMï¼šLLM äº§ç”Ÿæœ€ç»ˆå›ç­”</li>
</ol>
<p>å½“æˆ‘ä»¬åªéœ€è¦è§£å†³ç±»ä¼¼äºæŸ¥å¤©æ°”è¿™ç±»æ¯”è¾ƒç‰¹å®šçš„åœºæ™¯æ—¶ï¼Œä½¿ç”¨ Function Calling æ˜¯éå¸¸åˆé€‚çš„ï¼Œä½†æ˜¯å½“æˆ‘ä»¬éœ€è¦å¤§é‡ Function Calling æ—¶ï¼Œæ„å‘³ç€æˆ‘ä»¬åˆ™éœ€è¦ä¸ºæ¯ä¸€ä¸ªåŠŸèƒ½é¡¹éƒ½å®ç°å¯¹åº”çš„è°ƒç”¨å‡½æ•°, æ¯”è¾ƒéº»çƒ¦ï¼Œç¬¬äºŒä¸ªä¸åŒçš„å¤§æ¨¡å‹çš„ Function Calling çš„åè®®å¯èƒ½è¿˜ä¸ä¸€æ ·ã€‚<strong>å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§åè®®ï¼Œå¯ä»¥å°†å„ç§æ•°æ®æºæˆ–è€…æ“ä½œä»¥æœåŠ¡çš„æ–¹å¼ä½¿ç”¨ç»Ÿä¸€çš„åè®®ä»å¤–éƒ¨é›†æˆåˆ°å¤§æ¨¡å‹çš„å·¥å…·ä¸­ä¾›å¤§æ¨¡å‹è°ƒç”¨ï¼Œä»è€Œå¢å¼ºå¤§æ¨¡å‹çš„èƒ½åŠ›ï¼Œä¸ºå¤§æ¨¡å‹å®‰è£…èƒ½ä¸èŠå¤©æ¡†ä¹‹å¤–è¿›è¡Œå®é™…äº¤äº’çš„è§¦æ‰‹</strong></p>
<h4 data-id="heading-3">MCP åè®®</h4>
<p>åœ¨è¿™æ ·çš„ä¸€ä¸ªèƒŒæ™¯ä¸‹, Â 2024 å¹´ 11 æœˆ 25 æ—¥, Â Anthropic å‘å¸ƒäº†ä¸€ç¯‡æ–‡ç« , Â æ­£å¼æå‡ºäº† Model Context Protocol æ¨¡å‹ä¸Šä¸‹æ–‡åè®®, Â ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ MCP, Â å¹¶åŒæ­¥æ¨å‡ºäº†ç›¸å…³çš„ SDK å¥—ä»¶, Â Claude å®¢æˆ·ç«¯é’ˆå¯¹ MCP çš„æ”¯æŒ, Â MCP ç›¸å…³çš„å¼€æºä»“åº“ã€‚å‘å¸ƒå³å¯ç”¨ï¼Œç«™åœ¨ä»Šå¤©çš„è§’åº¦å›çœ‹è¿™ç¯‡ä¸åˆ°åƒå­—çš„åšå®¢ï¼Œå¾ˆéš¾ä¸è®¤ä¸ºè¿™æ˜¯ä¸€æ¬¡è“„è°‹å·²ä¹…çš„é’ˆå¯¹ OpenAPI çš„çªç„¶è¢­å‡»ã€‚</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­, Â Anthropic æå‡ºäº†å…³äº MCP çš„æœ€åˆæ„æƒ³, Â MCP è§£å†³äº†Â Function Calling å¼•å‘çš„æ‰©å±•å›°éš¾ï¼Œåè®®æ··ä¹±è¿™ä¸€æŒ‘æˆ˜ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šç”¨çš„å¼€æ”¾æ ‡å‡†ï¼Œå°±åƒç”µè„‘æ˜¯ IO æ¥å£ä¸ USB æ ‡å‡†ä¸€æ ·ã€‚ç”¨äºè¿æ¥ AI ç³»ç»Ÿä¸æ•°æ®æºï¼Œç”¨å•ä¸€åè®®æ›¿ä»£åˆ†æ•£çš„é›†æˆã€‚ç»“æœæ˜¯ä¸ºAIç³»ç»Ÿæä¾›æ‰€éœ€æ•°æ®è®¿é—®çš„æ›´ç®€å•ã€æ›´å¯é çš„æ–¹å¼ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10b1a1f7df584f1e978abf89a2c41e8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-p5pWw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765077609&amp;x-signature=SL6CfZNZSiHhBWWcQrOSZG8bOZY%3D" alt="image.png" loading="lazy"/></p>
<p>æœ‰äº† MCP ä¹‹åï¼Œå¤§æ¨¡å‹å¯ä»¥ä»¥ç»Ÿä¸€çš„æ–¹å¼è¯»æ‡‚æ¥è‡ªå››é¢å…«æ–¹çš„æ•°æ®æ“ä½œäº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c5839fc790d4b1d8434d6160b7ced35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-p5pWw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765077609&amp;x-signature=p57UOAIH67OrzcsP%2FHi3MOd%2Bqxc%3D" alt="image.png" loading="lazy"/></p>
<p>2025 å¹´ï¼Œ<strong>éšç€è¶Šæ¥è¶Šå¤šçš„å…¬å¸å’Œå¼€å‘è€…é’ˆå¯¹ MCP åè®®è¾¾æˆå…±è¯†ï¼ŒMCP æˆä¸ºäº†å¤§æ¨¡å‹ä¸ç¬¬ä¸‰æ–¹æ•°æ®æºé›†æˆçš„äº‹å®æ ‡å‡†ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/387c6159538d4f268c252697f81ae246~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-p5pWw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765077609&amp;x-signature=4m8gvqQQOk78Vs7l4ogL%2Fhc%2FCKw%3D" alt="image.png" loading="lazy"/></p>
<p>å°±åƒä¸Šé¢é‚£å¼ å›¾æ‰€ç¤ºçš„ï¼Œåœ¨ MCP å‡ºç°ä¹‹å‰ï¼Œå¤§æ¨¡å‹æ˜¯ä¸€ä¸ªæ²¡æœ‰å››è‚¢åªæœ‰å˜´å·´çš„äººç±»ï¼Œæ‰€æœ‰çš„ä¸€åˆ‡çŸ¥è¯†éœ€è¦äººå·¥æ•´ç†å¥½ä¹‹åä¸€ç‚¹ç‚¹å–‚è¿›å»å˜´å·´é‡Œé¢ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨ MCP å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬æƒ³è®©å¤§æ¨¡å‹å¸®æˆ‘ä»¬åšä¸€äº›éœ€è¦å¤–éƒ¨æ•°æ®æºçš„äº‹æƒ…æ—¶ï¼Œ<strong>ä¾‹å¦‚åˆ†æå…¬å¸æœ€è¿‘ä¸€ä¸ªæœˆçš„è¥æ”¶ä¿¡æ¯</strong> è¿™æ ·çš„éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬è¦å¦‚ä½•åšï¼Ÿè‡ªå·±ä»å…¬å¸çš„æ•°æ®åº“ä¸­æ‹‰å–ä¿¡æ¯ï¼Œæ•´ç†æˆå¯¹ llm å‹å¥½çš„æ ¼å¼ä¾‹å¦‚ csv æˆ–è€… jsonã€‚ç„¶åæŠŠæ•°æ®ç²˜è´´è¿›å¤§æ¨¡å‹å†°å†·çš„èŠå¤©æ¡†ï¼Œæ­é…è‡ªå·±ç²¾å¿ƒå‡†å¤‡çš„ promptï¼Œç„¶åäº¤ç»™å¤§æ¨¡å‹å»åˆ†æã€‚<strong>è¿™å’Œåš¼ç¢äº†å–‚é¥­æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«</strong>ï¼Œè¿™æ—¶å€™å½“å¦å¤–ä¸€ä¸ªäººä¹Ÿæœ‰ç±»ä¼¼çš„éœ€æ±‚çš„æ—¶å€™æ—¶ï¼Œä½ ä¼šå‘ç°ä»–ä¹Ÿéœ€è¦è¿™ä¹ˆä»å¤´æ¥ä¸€éã€‚è€Œ MCP çš„å‡ºç°åˆ™å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜:</p>
<ol>
<li>åè®®çš„ä¸€è‡´æ€§å¯ä»¥ä¿è¯ä¸ç®¡æ˜¯ deepseekå’Œ claude è°ƒç”¨ mcp æ—¶å¯ä»¥ä¿è¯ä¸€è‡´çš„è¡Œä¸ºã€‚</li>
<li>MCP çš„èƒ½åŠ›å¯ä»¥å…±äº«äº†ï¼Œå¹³å°æ–¹ä¾‹å¦‚ jira æˆ–è€… slack å¯ä»¥å°è£…æˆ MCP æ’ä»¶ï¼Œæ‰€æœ‰éœ€è¦è°ƒç”¨ jira æˆ–è€… slack çš„äººæ— éœ€äºŒæ¬¡å¼€å‘ï¼Œå¯ä»¥å®ç°å¼€ç®±å³ç”¨ã€‚</li>
<li>æ•°æ®å®‰å…¨ï¼Œå¦‚æœä½ éœ€è¦å¤§æ¨¡å‹è¯»å–å†…éƒ¨æ•°æ®ï¼Œä½ å¯ä»¥å®ç°è‡ªå·±çš„ MCP server å¹¶å†³å®šè¿”å›å“ªäº›æ•°æ®ã€‚</li>
</ol>
<h4 data-id="heading-4">MCP åè®®ç»„æˆéƒ¨åˆ†</h4>
<p>MCP ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯å®¢æˆ·ç«¯(Client), Â ä¸»æœº(Host) å’Œ æœåŠ¡å™¨(Server). Â è¿™é‡Œçš„ä¸»æœºå¯ä»¥ç†è§£ä¸ºå‘èµ·è¯·æ±‚çš„ LLM ç¨‹åºï¼Œæ¯”å¦‚ å¤§æ¨¡å‹æ¡Œé¢ç«¯ã€‚æ¯ä¸ª host å¯ä»¥è¿è¡Œå¤šä¸ªè¿æ¥(client)ã€‚æ¯ä¸ª client éƒ½å¯ä»¥è¿å¤šä¸ª MCP æœåŠ¡ï¼Œclient ä½¿ç”¨ Rpc çš„æ–¹å¼ä¸æœåŠ¡ç«¯é€šä¿¡ã€‚ä¾‹å¦‚deepseek å¯ä»¥åŒæ—¶å®‰è£… slack å’Œ jira, github ç­‰å¤šä¸ª MCP serverã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37433993a93f4e24b4c6765c183d9306~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-p5pWw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765077609&amp;x-signature=pM0%2BQzcyFNpWbpEAtEhxWzb3C1s%3D" alt="image.png" loading="lazy"/></p>
<p>MCP Client ä¸ Server ä¿æŒä¸€å¯¹ä¸€çš„è¿æ¥, Â  å½“æˆ‘ä»¬å‘å¤§æ¨¡å‹æé—®æ—¶:</p>
<ol>
<li><strong>MCP Client ä¼šå…ˆä» Mcp server è·å–æ‰€æœ‰å¯ç”¨çš„ MCP Server æä¾›çš„ tool åˆ—è¡¨, ç„¶åä¸€å¹¶äº¤ç»™å¤§æ¨¡å‹ã€‚</strong></li>
<li><strong>å¤§æ¨¡å‹ä¼šæ ¹æ®ä¸Šä¸‹æ–‡å†³å®šæ˜¯å¦ä½¿ç”¨å·¥å…·ï¼Œ å¦‚æœéœ€è¦æ‰§è¡Œå·¥å…·ï¼Œåˆ™ä¼šç”Ÿæˆå¯¹åº”çš„è°ƒç”¨è¯¢é—®ç”¨æˆ·æ˜¯å¦æ‰§è¡Œè¯¥ tool,ç”¨æˆ·ç¡®è®¤è¿‡ä¹‹åï¼ˆè¯¢é—®è¿™éƒ¨ä¸åŒçš„å®¢æˆ·ç«¯çš„è¡Œä¸ºå¯èƒ½ä¸ä¸€æ ·), MCP Client å¸¦ç€å‚æ•°æ‰§è¡Œå¯¹åº” tool æ‰€å±çš„ Mcp Server çš„è°ƒç”¨ã€‚</strong></li>
<li><strong>MCP Client å°† MCP server è°ƒç”¨çš„è¿”å›ç»“æœå‘é€å› Â llm.</strong></li>
<li><strong>LLM åŸºäºä¸Šä¸‹æ–‡ä»¥åŠ MCP Server è°ƒç”¨çš„ç»“æœç”Ÿæˆå›å¤ã€‚</strong></li>
</ol>
<p>é™¤äº† MCP clientï¼Œå¦å¤–ä¸€ä¸ªæ ¸å¿ƒçš„ç»„ä»¶å°±æ˜¯ MCP server äº†ã€‚MCP server å¯ä»¥æ˜¯è¿œç¨‹æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°åœ¨ docker ä¸­è¿è¡Œçš„æœåŠ¡ï¼Œä½†æ˜¯ä»–ä»¬æä¾›çš„ä½œç”¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä»¥ api çš„æ–¹å¼æä¾›èƒ½å¤Ÿå®é™…æ‰§è¡Œçš„æ“ä½œã€‚MCP server ä¸»è¦æœ‰ä¸‰éƒ¨åˆ†æ„æˆ</p>
<ul>
<li>èµ„æº: å¯ä»¥æ˜¯æ–‡æ¡£æˆ–è€… api è¿”å›ä¿¡æ¯ç­‰ã€‚</li>
<li>å·¥å…·: å®é™…å¯ä»¥æ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚è°ƒç”¨æŸ¥è¯¢æ•°æ®ã€‚</li>
<li>æç¤º, é¢„å…ˆç¼–å†™çš„ promptï¼Œæ¯”å¦‚ä½ æä¾›ä¸€ä¸ªç”Ÿæˆ ppt çš„ mcp prompt</li>
</ul>
<p>MCP çš„å‡ºç°ç¡®å®å¼¥è¡¥äº†ä¼ ç»Ÿçš„ function calling çš„ä¸è¶³ï¼Œä½†æ˜¯ç°é˜¶æ®µçš„ MCP å¹¶ä¸èƒ½ç®—æ˜¯å®Œç¾çš„ï¼Œä»ç„¶è¿˜æœ‰è®¸å¤šé—®é¢˜éœ€è¦è§£å†³ã€‚1.  #### token çš„æ¶ˆè€—é—®é¢˜ï¼Œè¿™åº”è¯¥æ˜¯æœ€è½»çš„ä¸€ä¸ªé—®é¢˜äº†ï¼Œå½“æˆ‘ä»¬å‘ llm æé—®æ—¶ï¼Œllm å§‹ç»ˆä¼šå»åŠ è½½æ‰€æœ‰çš„ mcp tool å»åˆ¤æ–­æ˜¯å¦è°ƒç”¨ mcp å·¥å…·ã€‚å¦‚æœæˆ‘ä»¬æ³¨å†Œäº†è¿‡å¤šçš„ mcp serverï¼Œåˆ™ä¼šåŠ å‰§ token çš„æ¶ˆè€—ã€‚åŒæ—¶å¦‚æœå¤šä¸ª mcp server å­˜åœ¨åŠŸèƒ½ç›¸ä¼¼ tool, Â è¿™äº› tool çš„æè¿°å†™çš„ä¹Ÿå¤§å·®ä¸å·®ï¼Œè¿™ä¸ªæ—¶å€™ agent åˆ¤æ–­è°ƒç”¨å“ªä¸ª mcp server çš„ tool çš„å‡†ç¡®æ€§å°±ä¼šå—åˆ°å¾ˆå¤§çš„å½±å“ã€‚</p>
<ol>
<li>å®‰å…¨é£é™©, Â å¦‚æœä¸€ä¸ªéæ³•çš„ mcp server æä¾›äº† æŸäº›å’Œ jira ç±»ä¼¼çš„ tool, å°±æœ‰å¯èƒ½é€ æˆ mcp åç§°å†²çªæ”»å‡»ï¼Œå³å°†ä¸€äº›å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯çš„å‚æ•°å‘é€ç»™ç›¸ä¼¼çš„ç¡®å®é”™è¯¯çš„ mcp server ä¸Šã€‚åŒæ—¶ç”±äºç›®å‰ mcp server ç¼ºä¹ç»Ÿä¸€çš„è®¤è¯ä½“ç³»ï¼Œå› æ­¤ä»ä¸€äº›ç¬¬ä¸‰æ–¹ç½‘ç«™å®‰è£…çš„ mcp server å¯èƒ½å­˜åœ¨æ¶æ„ç¨‹åºã€‚ç­‰ç­‰ç­‰ç­‰</li>
<li>ç¼ºä¹ç»Ÿä¸€çš„è®¤è¯ä½“ç³»å’Œç»†ç²’åº¦çš„æƒé™æ§åˆ¶ã€‚ä¸åŒçš„ mcp server çš„è®¤è¯æ–¹å¼å¯èƒ½å®Œå…¨ä¸åŒ, æœ‰çš„ä½¿ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥ api_key æœ‰çš„ä½¿ç”¨ oatuh ç­‰ç­‰ã€‚</li>
<li>åŸºäº jsonrcp çš„åè®®æ— æ³•å¤„ç†æ–‡ä»¶ä¸Šä¼ è¿™ç§å¤æ‚çš„æ“ä½œã€‚</li>
<li>æ½œåœ¨çš„æ€§èƒ½é—®é¢˜,Â  ç”±äº mcp è¿æ¥è¿œç¨‹ MCP åªæ”¯æŒ SSE åè®®, Â ä½†æ˜¯ç”±äº SSE æ˜¯ä¸€ä¸ªé•¿é“¾æ¥æœåŠ¡ï¼Œå› æ­¤å¯¹äºé«˜æ€§èƒ½é«˜å¹¶å‘çš„åœºæ™¯å¹¶ä¸æ˜¯ååˆ†å‹å¥½</li>
</ol>
<h4 data-id="heading-5">æ€»ç»“</h4>
<p>å…³äº MCP Server çš„å¼€å‘ï¼Œå¦‚æœä½ ä¹‹å‰å·²ç»æ¥è§¦è¿‡åç«¯å¼€å‘ï¼Œé‚£ä¹ˆå¼€å‘ä¸€ä¸ª MCP Server å¯¹äºæ¥è¯´å¹¶ä¸æ˜¯ä¸€é¡¹éš¾äº‹, æ— éæ˜¯æä¾›å¦å¤–ä¸€ç§æ ·å¼çš„æ¥å£ç½¢äº†Â MCP å¹¶ä¸æ˜¯æŠ€æœ¯ä¸Šéå¸¸é«˜å¤§ä¸Šçš„ä¸œè¥¿ï¼Œä½†ç¡®å®æ˜¯äººå·¥æ™ºèƒ½æ—¶ä»£å‘å±•è¿‡ç¨‹ä¸­çš„å¿…ç„¶äº§ç‰©ã€‚ç°é˜¶æ®µçš„ MCP åè®®ä»ç„¶ç§°ä¸ä¸Šå®Œç¾, Â ä»ç„¶æœ‰è®¸å¤šéœ€è¦å®Œå–„çš„åœ°æ–¹, Â ä½†æ˜¯æ— æ³•å¦è®¤çš„æ˜¯ï¼ŒMCP çš„å‡ºç°ç¡®å®ä¸º AI å¢åŠ äº†å››è‚¢, Â å°†æˆ‘ä»¬å¸¦å‘äº†æ›´è¿œçš„åœ°æ–¹ï¼Œä½¿å¾—æ›´å¤šçš„äº‹æƒ…å˜å¾—å¯èƒ½ã€‚</p>
<h4 data-id="heading-6">ä»‹ç»ä¸‹æˆ‘è‡ªå·±</h4>
<p>æˆ‘æ˜¯éŸ©æ•°åŒå­¦ï¼ŒæŠ€æœ¯åšä¸»&amp;å¼€æºåšä¸»ï¼Œå¦‚æœä½ æƒ³è¦çŸ¥é“è¿™ä¸ªä¸–ç•Œä¸Šæœ‰å“ªäº› å¥½ç©,æœ‰è¶£,å…è´¹,å®ç”¨ çš„å¼€æºé¡¹ç›®ï¼Œæ¬¢è¿åœ¨ç»¿æ³¡æ³¡æˆ–è€…çº¢æ³¡æ³¡æœç´¢æˆ‘ä»¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è°·æ­ŒAIæ¨¡å‹Gemini 3.0 Proï¼Œå·²ç»æ€ç–¯äº†ï¼]]></title>    <link>https://juejin.cn/post/7577718777481363494</link>    <guid>https://juejin.cn/post/7577718777481363494</guid>    <pubDate>2025-11-29T14:16:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577718777481363494" data-draft-id="7577705544874852390" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è°·æ­ŒAIæ¨¡å‹Gemini 3.0 Proï¼Œå·²ç»æ€ç–¯äº†ï¼"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,Gemini,AIGC"/> <meta itemprop="datePublished" content="2025-11-29T14:16:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°ç°"/> <meta itemprop="url" content="https://juejin.cn/user/2137106333828663"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è°·æ­ŒAIæ¨¡å‹Gemini 3.0 Proï¼Œå·²ç»æ€ç–¯äº†ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2137106333828663/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°ç°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T14:16:01.000Z" title="Sat Nov 29 2025 14:16:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç¨‹åºå‘˜å°ç°ã€‚</p>
<p>2025å¹´11æœˆ18æ—¥ï¼Œè°·æ­Œå…¬å¸æ¨å‡ºäº†ä»–ä»¬æœ€æ–°ç‰ˆæœ¬çš„å¤§æ¨¡å‹â€”â€”Gemini3.0 proã€‚</p>
<p>æœ€è¿‘å°ç°ä¹Ÿä½“éªŒäº†ä¸€ä¸‹Gemini3.0 proï¼Œå¯¹äºè¿™ä¸ªå½“ä»Šå…¬è®¤æœ€å¼ºçš„AIæ¨¡å‹ï¼Œæˆ‘çš„å¿ƒä¸­å”¯æœ‰éœ‡æ’¼ã€‚ï¼ˆåæ–‡ç®€ç§°Gemini3ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bd401e498c9449288df2362587d756f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=q6HE9DO%2FEpwjBw%2FqpwCGpXwUg90%3D" alt="" loading="lazy"/></p>
<p><strong>Gemini3æœ‰å¤šå¼ºï¼Ÿ</strong></p>
<p>å›½å¤–æœ‰ä¸€ä¸ªæƒå¨çš„AIæ¨¡å‹èƒ½åŠ›æ’è¡Œç½‘ç«™ï¼Œåä¸ºå¤§ä¼—ç«æŠ€åœºï¼ˆLMSYS Chatbot Arenaï¼‰ã€‚</p>
<p>åœ¨è¿™ä¸ªç½‘ç«™é‡Œï¼Œæ‰€æœ‰ä¸»æµçš„AIå¤§æ¨¡å‹éƒ½ä¼šä¸¤ä¸¤åˆ†ç»„è¿›è¡Œå¯¹æˆ˜ï¼Œé€šè¿‡åŒç›²æµ‹è¯•çš„æ–¹å¼è®©ç”¨æˆ·åˆ¤æ–­å¤§æ¨¡å‹çš„èƒ½åŠ›å¼ºå¼±ï¼Œæ¯”æ‹¼çš„ç»´åº¦åŒ…å«é€šç”¨èƒ½åŠ›ã€ä»£ç èƒ½åŠ›ã€è§£å†³éš¾é¢˜èƒ½åŠ›ã€å¤šæ¨¡æ€èƒ½åŠ›ç­‰ç­‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef78977746694ce8aeb52df6b9939cd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=Ykr2CeG7XHeTyF%2BYtmn97ybBIMY%3D" alt="" loading="lazy"/></p>
<p>å½“Gemini3é—®ä¸–çš„é‚£ä¸€åˆ»ï¼Œå®ƒåœ¨æ‰€æœ‰çš„æ’è¡Œæ¦œä¸Šéƒ½é¥é¥é¢†å…ˆï¼Œè®©è¿‘æœŸå‘å¸ƒçš„GPT-5 proå’ŒGrox 4.1éƒ½é»¯ç„¶å¤±è‰²ã€‚</p>
<p><strong>é€šç”¨èƒ½åŠ›æ’è¡Œæ¦œï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/497c7a83acd84970aba8e8dffc1ddcd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=UTKiVNKS07TaI%2BrDX4s8JrQDhwM%3D" alt="" loading="lazy"/></p>
<p><strong>ä»£ç èƒ½åŠ›æ’è¡Œæ¦œï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5890e9afeec249a89c5fbf45c839826c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=iUD%2F70GPhDgsfebe16%2BkMNVDbno%3D" alt="" loading="lazy"/></p>
<p><strong>è§£å†³éš¾é¢˜èƒ½åŠ›æ’è¡Œæ¦œï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d27d92f0cec0496f82645f924da6d9d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=2Y7Qt7Y2r5SY0%2FRxqVn3%2FWCAR%2BU%3D" alt="" loading="lazy"/></p>
<p>Gemini3åœ¨å¤§ä¼—ç«æŠ€åœºçš„æˆç»©ä»…ä»…æ˜¯å†°å±±ä¸€è§’ï¼Œè¿™ä¸ªå¼ºå¤§çš„æ¨¡å‹åœ¨BenchMarkç­‰åŸºå‡†æµ‹è¯•å¹³å°çš„è¡¨ç°åŒæ ·äº®çœ¼ï¼Œç”±äºç¯‡å¹…åŸå› ï¼Œå°ç°è¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°äº†ã€‚</p>
<p><strong>æ€æ ·å…è´¹ä½¿ç”¨Gemini3</strong></p>
<p>æ—¢ç„¶Gemini3æ¨¡å‹å¦‚æ­¤å¼ºå¤§ï¼Œæˆ‘ä»¬ä»å“ªé‡Œèƒ½å…è´¹ä½¿ç”¨å®ƒå‘¢ï¼Ÿå°ç°åœ¨æ­¤æ¨èä¸‰ä¸ªå…è´¹å…¥å£ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæ¨èçš„æ˜¯<strong>Geminiå®˜ç½‘</strong>ï¼Œå…¥å£å¦‚ä¸‹ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2F" target="_blank" title="https://gemini.google.com/" ref="nofollow noopener noreferrer">gemini.google.com/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70fd7366e8a043dfb2deb6b361a57249~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=xg5Lxb3ydF%2FmINh3oIxZxGqXfPU%3D" alt="" loading="lazy"/></p>
<p>åœ¨Geminiå®˜ç½‘çš„å¯¹è¯æ¡†å³ä¸‹è§’å¯ä»¥é€‰æ‹©æ¨¡å‹ï¼Œé€‰å®šâ€œæ€è€ƒï¼ˆ3 Proï¼‰â€è¿™ä¸€é¡¹ï¼Œå°±å¯ä»¥ä½¿ç”¨Gemini3ç‰ˆæœ¬äº†ã€‚ä¸è¿‡å…è´¹ä¼šå‘˜æ¯å¤©åªæœ‰5æ¬¡å·¦å³çš„è¯•ç”¨é¢åº¦ã€‚</p>
<p>ç¬¬äºŒä¸ªæ¨èçš„æ˜¯<strong>Google AI Studio</strong>ï¼Œå…¥å£å¦‚ä¸‹ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Faistudio.google.com%2F" target="_blank" title="https://aistudio.google.com/" ref="nofollow noopener noreferrer">aistudio.google.com/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e777ed6798334cae9fb629c470324a30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=RzYZxXxBbkBkyAZaXdvnBej1eIw%3D" alt="" loading="lazy"/></p>
<p>åœ¨ç½‘ç«™é¦–é¡µç‚¹å‡»â€œTry Gemini3â€é€‰é¡¹ï¼ŒåŒæ ·å¯ä»¥å…è´¹ä½¿ç”¨Gemini3ã€‚<strong>Google AI Studioä¹Ÿå­˜åœ¨</strong>ä¸€å®šçš„ä½¿ç”¨é¢‘æ¬¡é™åˆ¶ï¼Œä½†æ˜¯æ¯”å®˜ç½‘è¦å®½æ¾ä¸€äº›ï¼Œå¤§çº¦æ¯å¤©å¯ç”¨50æ¬¡å·¦å³ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªæ¨èçš„æ˜¯<strong>LMSYS Chatbot Arenaï¼Œä¹Ÿå°±æ˜¯åˆšæ‰æˆ‘ä»¬æåˆ°çš„å¤§ä¼—ç«æŠ€åœºï¼Œå…¥å£å¦‚ä¸‹ï¼š</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flmarena.ai%2F" target="_blank" title="https://lmarena.ai/" ref="nofollow noopener noreferrer">lmarena.ai/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba11e67e87164a05bc47030c273ed7fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=zBuqf%2BqYj0EQvoZrt9BD2%2BOX8Lc%3D" alt="" loading="lazy"/></p>
<p>æŠŠLMArenaé¦–é¡µçš„æ¨¡å¼è®¾ç½®ä¸ºâ€œDirect Chatâ€ï¼ˆç›´æ¥èŠå¤©ï¼‰ï¼Œå¤§æ¨¡å‹é€‰æ‹©gemini-3-proï¼Œå³å¯å¼€å¯å…è´¹çš„ä½¿ç”¨ã€‚</p>
<p>åœ¨è¿™é‡Œä½¿ç”¨Gemini3è™½ç„¶æ²¡æœ‰æ¬¡æ•°é™åˆ¶ï¼Œä½†ä¼šæœ‰ä¸€å®šçš„é€Ÿç‡é™åˆ¶ï¼Œæœ‰å¯èƒ½éœ€è¦æ’é˜Ÿã€‚</p>
<p><strong>Gemini3çš„å®æ“ä½“éªŒ</strong></p>
<p>è¯´å®Œäº†å…è´¹è¯•ç”¨Gemini3çš„å‡ ç§é€”å¾„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥å®æ“ç¯èŠ‚ï¼Œåˆ‡åˆ‡å®å®ä½“éªŒä¸€æŠŠGemini3æ¨¡å‹çš„å¼ºå¤§ã€‚</p>
<p>å¦‚ä½•å…·ä½“å±•ç°å‡ºGemini3æ¨¡å‹çš„å¼ºå¤§ä¹‹å¤„å‘¢ï¼Ÿæˆ‘ä»¬ä¸å¦¨å°è¯•è®©Gemini3ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€æ¬¾æœ‰è¶£çš„å°æ¸¸æˆã€‚</p>
<p>é­‚æ–—ç½—è¿™æ¬¾æ¸¸æˆï¼Œå¯ä»¥è¯´æ˜¯ä¼´éšç€80åå’Œ90åçš„æœ‹å‹ä¸€èµ·é•¿å¤§çš„ï¼Œå°ç°ä¹ŸåŒæ ·æ˜¯é­‚æ–—ç½—ç³»åˆ—æ¸¸æˆçš„é‡åº¦çˆ±å¥½è€…ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76800e86ce8548b2b8340401475cf04e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=Vfl1Dn7OkkrrlQoH5kFKJPvIuAs%3D" alt="" loading="lazy"/></p>
<p>ä¸‹é¢æˆ‘ä»¬å°è¯•ç”¨ä¸€å¥æç¤ºè¯ï¼Œè®©Gemini 3ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªç½‘é¡µç‰ˆçš„é­‚æ–—ç½—å°æ¸¸æˆã€‚</p>
<p>é¦–å…ˆæŠŠGeminiçš„å·¥å…·é€‰é¡¹å½“ä¸­æ‰¾åˆ°Canvasï¼Œè¿™æ˜¯Geminiçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œä¸“é—¨ç”¨äºå¤„ç†é•¿ç¯‡å†™ä½œå’Œç¼–ç¨‹ä»»åŠ¡ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4f54f779de44c84a9dc747f43741802~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=%2FWu58knRRAxg5yljBw24L8zuj4Q%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬çš„æç¤ºè¯å¦‚ä¸‹ï¼š</p>
<p>ç¼–å†™ä¸€ä¸ªé­‚æ–—ç½—æ¸¸æˆï¼Œå¸¦æœ‰bossæˆ˜ï¼Œæœ‰è‡³å°‘ä¸¤ä¸ªå…³å¡ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/279fc24145e34b14a0011d94a2407520~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=YWF1LAyRz5ULjipHB%2BIbGU5e%2FGs%3D" alt="" loading="lazy"/></p>
<p>ä»è§†é¢‘ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒGemini3å¾ˆå¿«å°±ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†ä¸€å¥—Html5æ¸¸æˆä»£ç ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬è¿›è¡Œç¬¬ä¸€æ¬¡æµ‹è¯•ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17baac48d6254a58a8df116e1d81ebe2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=H99%2FpqqFbjxLRaEWXhEdgunvNeM%3D" alt="" loading="lazy"/></p>
<p>å•Šè¿™......ä¸å¾—ä¸è¯´ï¼ŒGemini3å¶å°”ä¹Ÿæœ‰ç¿»è½¦çš„æ—¶å€™ã€‚æ²¡å…³ç³»ï¼Œæˆ‘ä»¬è®©æ¨¡å‹é‡æ–°æ¥ç”Ÿæˆï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f21c3f1b9c7439da29073643a4d8b62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=GqHZbON5B6CWPIYyIL0pygHfPkE%3D" alt="" loading="lazy"/></p>
<p>è¿™ä¸€å›æ¸¸æˆæ€»ç®—å¯ä»¥æ­£å¸¸è¿è¡Œäº†ã€‚åœ¨æ²¡æœ‰ä»»ä½•ç¾å·¥èµ„æºçš„æƒ…å†µä¸‹ï¼ŒGemini3èƒ½ä¸ºæˆ‘ä»¬åšåˆ°è¿™ç§ç¨‹åº¦ï¼Œå·²ç»ç›¸å½“ä¸é”™äº†ã€‚</p>
<p>ä¸è¿‡æ¸¸æˆä¸­å­˜åœ¨ä¸¤å¤„bugï¼Œå…¶ä¸­ä¸€å¤„bugæ˜¯å…³å¡ä¸­å­˜åœ¨ä¸€æ¡å¾ˆé•¿çš„æ²Ÿå£‘ï¼Œæ— æ³•è¿›è¡Œè·³è·ƒï¼›å¦ä¸€å¤„bugæ˜¯å‡»è´¥bossä¹‹åï¼Œæ¸¸æˆæµç¨‹å°±æ­¤å¡ä½äº†ã€‚</p>
<p>æˆ‘ä»¬è®©æ¨¡å‹ä¿®æ”¹è¿™ä¸¤å¤„bugï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44ac08510c0241b794654cd68ce69ee4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=D3EW50hOmNkhql0dzgPPOMpSXSE%3D" alt="" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¸¸æˆä¸­çš„ä¸¤å¤„bugå·²ç»ä¿®æ”¹ã€‚ä½†æˆ‘ä¸€å¼€å§‹æƒ³è®©æ¸¸æˆåŒ…å«è‡³å°‘ä¸¤ä¸ªå…³å¡ï¼Œç›®å‰å´åªæœ‰ä¸€å…³ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®©AIç»§ç»­ä¿®æ”¹æ¸¸æˆä»£ç ï¼Œå¢åŠ ä¸€ä¸ªå…³å¡ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42c6cbbc27d5462dad50a2ce07dd5c7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=Zx5XPkLDmktXnhGz%2BiLXXSv1xPc%3D" alt="" loading="lazy"/></p>
<p>ç°åœ¨ä¸¤ä¸ªå…³å¡ç¡®å®æœ‰äº†ï¼Œä½†æ¸¸æˆé‡Œåªæœ‰3æ¡å‘½ï¼Œç¬¬äºŒå…³æ€»æ˜¯è¿‡ä¸å»ã€‚</p>
<p>æ€ä¹ˆåŠå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬æ¥æŠŠæ¸¸æˆæ”¹ä¸º30æ¡å‘½å³å¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78aa0ee7e63e48558cb9650d1769aa0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=fwf7pyxoaGTWQahphQE0HzE9bJM%3D" alt="" loading="lazy"/></p>
<p>ç»ˆäºï¼Œç¬¬äºŒå…³bossä¹Ÿè¢«æˆ‘ä»¬æˆ˜èƒœäº†ï¼Œæ¸¸æˆå®Œç¾é€šå…³ã€‚</p>
<p>ä¸è¿‡è¿™è¿˜ä¸æ˜¯æˆ‘ä»¬çš„ç»ˆç‚¹ã€‚ä¸ºäº†å……åˆ†å±•ç°Gemini3çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬æ¥å°è¯•æŠŠè¿™æ¬¾æ¸¸æˆæ”¹ä¸ºä¸€æ¬¾3Dæ¸¸æˆï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d168f62c0444c7ea99fe9f4766d7f1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=955jYjeZ5%2FYhYqOgTuGQ0sPAzbs%3D" alt="" loading="lazy"/></p>
<p>ä»è§†é¢‘å¯ä»¥çœ‹å‡ºï¼Œæ¸¸æˆçš„åœºæ™¯å’Œè§’è‰²éƒ½å·²ç»3DåŒ–äº†ã€‚å°½ç®¡æœ‰äº›ç»†èŠ‚è¿˜ä¸å¤ªå®Œå–„ï¼Œä½†åªè¦æˆ‘ä»¬æ„¿æ„ï¼Œå¤šè¿›è¡Œå‡ è½®å¯¹è¯å°±å¯ä»¥æŠŠæ‰€æœ‰çš„ç»†èŠ‚åšå¾—æ›´åŠ å®Œå–„ã€‚</p>
<p>å¥½äº†ï¼Œç”¨Gemini3å¼€å‘é­‚æ–—ç½—å°æ¸¸æˆçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±å±•ç¤ºåˆ°è¿™é‡Œã€‚æ²¡æœ‰å¤æ‚çš„æç¤ºè¯ï¼Œæ²¡æœ‰ç¾å·¥èµ„æºï¼Œä»…ä»…æ˜¯å‡ è½®ç®€å•çš„å¯¹è¯ï¼ŒGemini3å°±ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†è¿™æ ·ä¸€æ¬¾å®Œæˆåº¦è¾ƒé«˜çš„æ¸¸æˆï¼Œè¿™æ ·çš„ä»£ç èƒ½åŠ›ä¸å¯è°“ä¸æƒŠè‰³ã€‚</p>
<p>å¦‚æœå¤§å®¶æœ‰å…´è¶£ï¼Œå¯ä»¥å°½æƒ…å‘æŒ¥æƒ³è±¡åŠ›ï¼Œç”¨Gemini3åšå‡ºæ›´å¤šæœ‰è¶£åˆé…·ç‚«çš„é¡¹ç›®ã€‚</p>
<p><strong>å†™åœ¨æœ€å</strong></p>
<p>è®°å¾—2023å¹´ï¼ŒGPT-4æ¨¡å‹åˆšåˆšä¸Šçº¿çš„æ—¶å€™ï¼Œæˆ‘æ›¾ç»ç”¨GPT-4ç”Ÿæˆäº†ä¸€æ¬¾ç®€å•çš„é£è¡Œå°„å‡»æ¸¸æˆã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bee3ca423df84e19bb66798fa12e6be6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP54Gw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765030560&amp;x-signature=SJOPRUTcx9%2FHXkbw%2BMZ5XkHKqVo%3D" alt="" loading="lazy"/></p>
<p>å°½ç®¡å½“æ—¶çš„ç”Ÿæˆè¿‡ç¨‹éå¸¸éº»çƒ¦ï¼Œç”Ÿæˆçš„ç»“æœä¹Ÿå¾ˆç²—ç³™ï¼Œä½†å½“æ—¶çš„æˆ‘è¿˜æ˜¯è¢«AIçš„èƒ½åŠ›æ·±æ·±å¸å¼•äº†ã€‚</p>
<p>æ²¡æƒ³åˆ°ä»…ä»…æ˜¯ä¸¤å¹´åŠçš„æ—¶é—´ï¼ŒAIæ¨¡å‹å·²ç»å–å¾—äº†å¦‚æ­¤å¤§çš„è¿›æ­¥ï¼ŒGemini3è·Ÿå½“å¹´GPT-4ä¹‹é—´çš„å·®è·ï¼Œç®€ç›´åƒæ˜¯æˆå¹´äººä¸å°å­©å­ä¹‹é—´çš„å·®è·ã€‚</p>
<p>åœ¨è¿™ä¸ªæŠ€æœ¯é£é€Ÿè¿›æ­¥çš„æ—¶ä»£ï¼Œå°ç°æ„Ÿå—åˆ°çš„å”¯æœ‰éœ‡æ’¼ã€‚</p>
<p>å¸Œæœ›åœ¨2026å¹´ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ›´åŠ ä¸°å¯Œã€æ›´åŠ å¼ºå¤§çš„AIæ¨¡å‹å’ŒAIåº”ç”¨ï¼Œå°ç°ä¹Ÿçƒ­åˆ‡æœŸæœ›ç€ä¸ºå¤§å®¶åˆ†äº«æ›´å¤šæœ‰è¶£åˆæœ‰ç”¨çš„AIç©æ³•ã€‚</p>
<p>å¤§å®¶æœ‰å“ªäº›æƒ³è¦äº†è§£çš„AIäº§å“å’Œé¡¹ç›®ï¼Ÿæ¬¢è¿æŠŠä½ çš„æƒ³æ³•æ‰“åœ¨ç•™è¨€åŒºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€URPã€‘Unity[å†…ç½®Shader]éå…‰ç…§Unlit]]></title>    <link>https://juejin.cn/post/7577689171223314482</link>    <guid>https://juejin.cn/post/7577689171223314482</guid>    <pubDate>2025-11-30T03:38:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577689171223314482" data-draft-id="7577971299742482470" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€URPã€‘Unity[å†…ç½®Shader]éå…‰ç…§Unlit"/> <meta itemprop="keywords" content="æ¸¸æˆå¼€å‘,Unity3D,å›¾å½¢å­¦"/> <meta itemprop="datePublished" content="2025-11-30T03:38:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€URPã€‘Unity[å†…ç½®Shader]éå…‰ç…§Unlit
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T03:38:42.000Z" title="Sun Nov 30 2025 03:38:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13021255.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13021255%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13021255&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong></p>
</blockquote>
<h2 data-id="heading-0"><strong>URPå†…ç½®Unlit Shaderçš„ä½œç”¨ä¸åŸç†</strong></h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.unity.cn%2Fcn%2FPackages-cn%2Fcom.unity.render-pipelines.universal%4014.1%2Fmanual%2Funlit-shader.html" target="_blank" title="https://docs.unity.cn/cn/Packages-cn/com.unity.render-pipelines.universal@14.1/manual/unlit-shader.html" ref="nofollow noopener noreferrer">Unlit Shader</a>æ˜¯Unityé€šç”¨æ¸²æŸ“ç®¡çº¿(URP)ä¸­çš„åŸºç¡€ç€è‰²å™¨ï¼Œä¸»è¦ç”¨äºæ¸²æŸ“ä¸å—å…‰ç…§å½±å“çš„ç‰©ä½“ã€‚å…¶æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ç›´æ¥é‡‡æ ·çº¹ç†æˆ–é¢œè‰²å€¼è¾“å‡ºåˆ°å±å¹•ï¼Œè·³è¿‡äº†å¤æ‚çš„å…‰ç…§è®¡ç®—æµç¨‹ã€‚è¿™ç§ç€è‰²å™¨ç‰¹åˆ«é€‚åˆUIå…ƒç´ ã€ç²’å­ç‰¹æ•ˆã€å…¨æ¯æŠ•å½±ç­‰éœ€è¦ä¿æŒæ’å®šäº®åº¦çš„åœºæ™¯ï¼Œå› ä¸ºå®ƒçš„æ¸²æŸ“ç»“æœä¸ä¼šéšå…‰ç…§ç¯å¢ƒå˜åŒ–è€Œæ”¹å˜ã€‚</p>
<p>åœ¨URPæ¶æ„ä¸­ï¼ŒUnlit Shaderé€šè¿‡ShaderLabè¯­æ³•å®šä¹‰ï¼Œå†…éƒ¨ä½¿ç”¨HLSLç¼–å†™æ ¸å¿ƒé€»è¾‘ã€‚ä¸Built-inç®¡çº¿ç›¸æ¯”ï¼ŒURPç‰ˆæœ¬ä¼˜åŒ–äº†æ¸²æŸ“æµç¨‹ï¼ŒåŒ…å«ä¸‰ä¸ªå…³é”®Passï¼šä¸»ç»˜åˆ¶Passã€æ·±åº¦Only Passå’Œå…ƒæ•°æ®Passï¼ˆç”¨äºå…‰ç…§çƒ˜ç„™ï¼‰ã€‚å…¶æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>æ— å…‰ç…§è®¡ç®—ï¼šç›´æ¥è¾“å‡ºAlbedoé¢œè‰²æˆ–çº¹ç†é‡‡æ ·ç»“æœ</li>
<li>æ”¯æŒAlphaæ··åˆï¼šå¯å®ç°é€æ˜æ•ˆæœ</li>
<li>ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šå‡å°‘äº†GPUæŒ‡ä»¤æ•°é‡</li>
</ul>
<p><img src="https://docs.unity.cn/cn/Packages-cn/com.unity.render-pipelines.universal@14.1/manual/images/Inspectors/Shaders/Unlit.png" alt="" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>å‘å±•å†å²æ¼”å˜</strong></h2>
<p>Unlit Shaderéšç€Unityæ¸²æŸ“ç®¡çº¿çš„æ¼”è¿›ç»å†äº†ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>â€Œ<strong>Built-inç®¡çº¿æ—¶æœŸ</strong>â€Œï¼ˆ2012-2018ï¼‰ï¼šæœ€åˆä½œä¸ºç®€å•ç€è‰²å™¨å‡ºç°åœ¨æ ‡å‡†èµ„æºåŒ…ä¸­ï¼Œä½¿ç”¨CGè¯­è¨€ç¼–å†™ï¼ŒåŠŸèƒ½è¾ƒä¸ºåŸºç¡€</li>
<li>â€Œ<strong>LWRPè¿‡æ¸¡æœŸ</strong>â€Œï¼ˆ2018-2020ï¼‰ï¼šè½»é‡çº§æ¸²æŸ“ç®¡çº¿ä¸­é¦–æ¬¡é’ˆå¯¹ç§»åŠ¨å¹³å°ä¼˜åŒ–ï¼Œå¼•å…¥HLSLæ›¿ä»£CG</li>
<li>â€Œ<strong>URPæˆç†ŸæœŸ</strong>â€Œï¼ˆ2020è‡³ä»Šï¼‰ï¼šæˆä¸ºUniversal RPçš„æ ¸å¿ƒç»„ä»¶ï¼Œæ”¯æŒShader Graphå¯è§†åŒ–ç¼–ç¨‹ï¼Œå¹¶ä¼˜åŒ–äº†å¤šPassåä½œæœºåˆ¶</li>
</ul>
<h2 data-id="heading-2"><strong>å…·ä½“ä½¿ç”¨ç¤ºä¾‹</strong></h2>
<p>åˆ›å»ºUnlitæè´¨çš„åŸºæœ¬æ­¥éª¤ï¼š</p>
<ul>
<li>åœ¨Projectçª—å£å³é”®åˆ›å»ºMaterial</li>
<li>æè´¨Inspectorä¸­é€‰æ‹©Shaderè·¯å¾„ï¼š"Universal Render Pipeline/Unlit"</li>
<li>é…ç½®åŸºç¡€å±æ€§ï¼š
<ul>
<li>â€Œ<strong>Base Map</strong>â€Œï¼šä¸»çº¹ç†è´´å›¾</li>
<li>â€Œ<strong>Base Color</strong>â€Œï¼šè‰²è°ƒå åŠ </li>
<li>â€Œ<strong>Alpha</strong>â€Œï¼šé€æ˜åº¦æ§åˆ¶</li>
</ul>
</li>
</ul>
<p>ä»£ç è¯´æ˜ï¼š</p>
<ul>
<li>
<p>å®šä¹‰åŒ…å«çº¹ç†å’Œé¢œè‰²å±æ€§çš„åŸºç¡€Unlit Shader</p>
</li>
<li>
<p>ä½¿ç”¨URPæ ¸å¿ƒåº“ä¸­çš„TransformObjectToHClipæ–¹æ³•è¿›è¡Œåæ ‡è½¬æ¢</p>
</li>
<li>
<p>ç‰‡å…ƒç€è‰²å™¨ç›´æ¥è¿”å›çº¹ç†é‡‡æ ·ç»“æœä¸é¢œè‰²çš„ä¹˜ç§¯</p>
</li>
<li>
<p>UnlitExample.shader</p>
<pre><code class="hljs language-c" lang="c">Shader <span class="hljs-string">"Custom/UnlitTexture"</span>
{
    Properties {
        _MainTex (<span class="hljs-string">"Texture"</span>, <span class="hljs-number">2</span>D) = <span class="hljs-string">"white"</span> {}
        _Color (<span class="hljs-string">"Color"</span>, Color) = (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)
    }
    SubShader {
        Tags { <span class="hljs-string">"RenderType"</span>=<span class="hljs-string">"Opaque"</span> }
        Pass {
            HLSLPROGRAM
            <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> vertex vert</span>
            <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> fragment frag</span>
            <span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"</span></span>

            <span class="hljs-keyword">struct</span> Attributes {
                float4 positionOS : POSITION;
                float2 uv : TEXCOORD0;
            };

            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Varyings</span> {</span>
                float4 positionCS : SV_POSITION;
                float2 uv : TEXCOORD0;
            };

            sampler2D _MainTex;
            float4 _Color;

            Varyings <span class="hljs-title function_">vert</span><span class="hljs-params">(Attributes IN)</span> {
                Varyings OUT;
                OUT.positionCS = TransformObjectToHClip(IN.positionOS.xyz);
                OUT.uv = IN.uv;
                <span class="hljs-keyword">return</span> OUT;
            }

            half4 <span class="hljs-title function_">frag</span><span class="hljs-params">(Varyings IN)</span> : SV_Target {
                <span class="hljs-keyword">return</span> tex2D(_MainTex, IN.uv) * _Color;
            }
            ENDHLSL
        }
    }
}
</code></pre>
</li>
<li>
<p>UnlitGraph.shadergraph</p>
<pre><code class="hljs language-c" lang="c">{
    <span class="hljs-string">"m_Nodes"</span>: [
        {
            <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"d4f5e3c7-1a2d-4b8f-a3e1-6c9b8d2e1f0a"</span>,
            <span class="hljs-string">"m_Type"</span>: <span class="hljs-string">"UnityEditor.ShaderGraph.Texture2DNode"</span>,
            <span class="hljs-string">"m_Position"</span>: { <span class="hljs-string">"x"</span>: <span class="hljs-number">-208</span>, <span class="hljs-string">"y"</span>: <span class="hljs-number">-16</span> },
            <span class="hljs-string">"m_Outputs"</span>: [ { <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"out"</span> } ],
            <span class="hljs-string">"m_Texture"</span>: { <span class="hljs-string">"m_DefaultValue"</span>: {} }
        },
        {
            <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6"</span>,
            <span class="hljs-string">"m_Type"</span>: <span class="hljs-string">"UnityEditor.ShaderGraph.ColorNode"</span>,
            <span class="hljs-string">"m_Position"</span>: { <span class="hljs-string">"x"</span>: <span class="hljs-number">-200</span>, <span class="hljs-string">"y"</span>: <span class="hljs-number">100</span> },
            <span class="hljs-string">"m_Outputs"</span>: [ { <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"out"</span> } ],
            <span class="hljs-string">"m_Color"</span>: { <span class="hljs-string">"r"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"g"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"b"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span> }
        },
        {
            <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"b2c3d4e5-f6g7-8h9i-0j1k-l2m3n4o5p6q7"</span>,
            <span class="hljs-string">"m_Type"</span>: <span class="hljs-string">"UnityEditor.ShaderGraph.MultiplyNode"</span>,
            <span class="hljs-string">"m_Position"</span>: { <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span> },
            <span class="hljs-string">"m_Inputs"</span>: [
                { <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"a"</span>, <span class="hljs-string">"m_SlotId"</span>: <span class="hljs-number">0</span> },
                { <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"b"</span>, <span class="hljs-string">"m_SlotId"</span>: <span class="hljs-number">1</span> }
            ],
            <span class="hljs-string">"m_Outputs"</span>: [ { <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"out"</span> } ]
        }
    ],
    <span class="hljs-string">"m_Edges"</span>: [
        { <span class="hljs-string">"m_OutputSlot"</span>: <span class="hljs-string">"d4f5e3c7-1a2d-4b8f-a3e1-6c9b8d2e1f0a.out"</span>, <span class="hljs-string">"m_InputSlot"</span>: <span class="hljs-string">"b2c3d4e5-f6g7-8h9i-0j1k-l2m3n4o5p6q7.a"</span> },
        { <span class="hljs-string">"m_OutputSlot"</span>: <span class="hljs-string">"a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6.out"</span>, <span class="hljs-string">"m_InputSlot"</span>: <span class="hljs-string">"b2c3d4e5-f6g7-8h9i-0j1k-l2m3n4o5p6q7.b"</span> }
    ]
}
</code></pre>
</li>
</ul>
<h2 data-id="heading-3"><strong>Shader Graphåº”ç”¨ç¤ºä¾‹</strong></h2>
<p>åœ¨Shader Graphä¸­åˆ›å»ºUnlitæ•ˆæœçš„æ­¥éª¤ï¼š</p>
<ul>
<li>åˆ›å»ºæ–°çš„Shader Graphæ–‡ä»¶ï¼ˆå³é”® &gt; Create &gt; Shader &gt; Universal Render Pipeline &gt; Unlit Shader Graphï¼‰</li>
<li>æ ¸å¿ƒèŠ‚ç‚¹é…ç½®ï¼š
<ul>
<li>æ·»åŠ â€Œ<strong>Sample Texture 2D</strong>â€ŒèŠ‚ç‚¹ä½œä¸ºåŸºç¡€çº¹ç†è¾“å…¥</li>
<li>è¿æ¥â€Œ<strong>Color</strong>â€Œå‚æ•°èŠ‚ç‚¹å®ç°è‰²è°ƒæ§åˆ¶</li>
<li>ä½¿ç”¨â€Œ<strong>Multiply</strong>â€ŒèŠ‚ç‚¹æ··åˆçº¹ç†å’Œé¢œè‰²</li>
</ul>
</li>
<li>é«˜çº§åŠŸèƒ½æ‰©å±•ï¼š
<ul>
<li>æ·»åŠ â€Œ<strong>Time</strong>â€ŒèŠ‚ç‚¹é©±åŠ¨UVåŠ¨ç”»</li>
<li>é€šè¿‡â€Œ<strong>Vertex Position</strong>â€ŒèŠ‚ç‚¹å®ç°é¡¶ç‚¹å˜å½¢</li>
</ul>
</li>
</ul>
<p>ä»£ç è¯´æ˜ï¼š</p>
<ul>
<li>
<p>æ„å»ºåŒ…å«çº¹ç†é‡‡æ ·å’Œé¢œè‰²æ··åˆçš„åŸºç¡€Unlitç€è‰²å™¨</p>
</li>
<li>
<p>é€šè¿‡èŠ‚ç‚¹è¿æ¥å®ç°æè´¨å±æ€§çš„å¯è§†åŒ–ç¼–è¾‘</p>
</li>
<li>
<p>å¯æ‰©å±•æ·»åŠ UVæ»šåŠ¨ã€é¡¶ç‚¹åŠ¨ç”»ç­‰é«˜çº§æ•ˆæœ</p>
</li>
<li>
<p>UnlitExample.shader</p>
<pre><code class="hljs language-c" lang="c">Shader <span class="hljs-string">"Custom/UnlitTexture"</span>
{
    Properties {
        _MainTex (<span class="hljs-string">"Texture"</span>, <span class="hljs-number">2</span>D) = <span class="hljs-string">"white"</span> {}
        _Color (<span class="hljs-string">"Color"</span>, Color) = (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)
    }
    SubShader {
        Tags { <span class="hljs-string">"RenderType"</span>=<span class="hljs-string">"Opaque"</span> }
        Pass {
            HLSLPROGRAM
            <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> vertex vert</span>
            <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> fragment frag</span>
            <span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"</span></span>

            <span class="hljs-keyword">struct</span> Attributes {
                float4 positionOS : POSITION;
                float2 uv : TEXCOORD0;
            };

            <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Varyings</span> {</span>
                float4 positionCS : SV_POSITION;
                float2 uv : TEXCOORD0;
            };

            sampler2D _MainTex;
            float4 _Color;

            Varyings <span class="hljs-title function_">vert</span><span class="hljs-params">(Attributes IN)</span> {
                Varyings OUT;
                OUT.positionCS = TransformObjectToHClip(IN.positionOS.xyz);
                OUT.uv = IN.uv;
                <span class="hljs-keyword">return</span> OUT;
            }

            half4 <span class="hljs-title function_">frag</span><span class="hljs-params">(Varyings IN)</span> : SV_Target {
                <span class="hljs-keyword">return</span> tex2D(_MainTex, IN.uv) * _Color;
            }
            ENDHLSL
        }
    }
}
</code></pre>
</li>
<li>
<p>UnlitGraph.shadergraph</p>
<pre><code class="hljs language-c" lang="c">{
    <span class="hljs-string">"m_Nodes"</span>: [
        {
            <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"d4f5e3c7-1a2d-4b8f-a3e1-6c9b8d2e1f0a"</span>,
            <span class="hljs-string">"m_Type"</span>: <span class="hljs-string">"UnityEditor.ShaderGraph.Texture2DNode"</span>,
            <span class="hljs-string">"m_Position"</span>: { <span class="hljs-string">"x"</span>: <span class="hljs-number">-208</span>, <span class="hljs-string">"y"</span>: <span class="hljs-number">-16</span> },
            <span class="hljs-string">"m_Outputs"</span>: [ { <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"out"</span> } ],
            <span class="hljs-string">"m_Texture"</span>: { <span class="hljs-string">"m_DefaultValue"</span>: {} }
        },
        {
            <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6"</span>,
            <span class="hljs-string">"m_Type"</span>: <span class="hljs-string">"UnityEditor.ShaderGraph.ColorNode"</span>,
            <span class="hljs-string">"m_Position"</span>: { <span class="hljs-string">"x"</span>: <span class="hljs-number">-200</span>, <span class="hljs-string">"y"</span>: <span class="hljs-number">100</span> },
            <span class="hljs-string">"m_Outputs"</span>: [ { <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"out"</span> } ],
            <span class="hljs-string">"m_Color"</span>: { <span class="hljs-string">"r"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"g"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"b"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span> }
        },
        {
            <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"b2c3d4e5-f6g7-8h9i-0j1k-l2m3n4o5p6q7"</span>,
            <span class="hljs-string">"m_Type"</span>: <span class="hljs-string">"UnityEditor.ShaderGraph.MultiplyNode"</span>,
            <span class="hljs-string">"m_Position"</span>: { <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span> },
            <span class="hljs-string">"m_Inputs"</span>: [
                { <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"a"</span>, <span class="hljs-string">"m_SlotId"</span>: <span class="hljs-number">0</span> },
                { <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"b"</span>, <span class="hljs-string">"m_SlotId"</span>: <span class="hljs-number">1</span> }
            ],
            <span class="hljs-string">"m_Outputs"</span>: [ { <span class="hljs-string">"m_Id"</span>: <span class="hljs-string">"out"</span> } ]
        }
    ],
    <span class="hljs-string">"m_Edges"</span>: [
        { <span class="hljs-string">"m_OutputSlot"</span>: <span class="hljs-string">"d4f5e3c7-1a2d-4b8f-a3e1-6c9b8d2e1f0a.out"</span>, <span class="hljs-string">"m_InputSlot"</span>: <span class="hljs-string">"b2c3d4e5-f6g7-8h9i-0j1k-l2m3n4o5p6q7.a"</span> },
        { <span class="hljs-string">"m_OutputSlot"</span>: <span class="hljs-string">"a1b2c3d4-e5f6-7g8h-9i0j-k1l2m3n4o5p6.out"</span>, <span class="hljs-string">"m_InputSlot"</span>: <span class="hljs-string">"b2c3d4e5-f6g7-8h9i-0j1k-l2m3n4o5p6q7.b"</span> }
    ]
}
</code></pre>
</li>
</ul>
<p>å®é™…åº”ç”¨æ—¶å¯ç»“åˆç²’å­ç³»ç»Ÿåˆ›å»ºå‘å…‰è½¨è¿¹ï¼Œæˆ–ä¸ºUIå…ƒç´ æ·»åŠ åŠ¨æ€é«˜äº®æ•ˆæœã€‚URP Unlit Shaderçš„è½»é‡çº§ç‰¹æ€§ä½¿å…¶åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šèƒ½ä¿æŒ60fpsä»¥ä¸Šçš„æ¸²æŸ“æ€§èƒ½</p>
<h2 data-id="heading-4">å…¸å‹åº”ç”¨åœºæ™¯åŠå®ç°</h2>
<h3 data-id="heading-5"><strong>å…‰æ™•æ•ˆæœï¼ˆHaloï¼‰</strong></h3>
<ul>
<li>â€Œ<strong>åº”ç”¨å®ä¾‹</strong>â€Œï¼šè§’è‰²æŠ€èƒ½ç‰¹æ•ˆã€UIé«˜äº®æç¤ºã€‚é€šè¿‡é€æ˜çº¹ç†å®ç°è¾¹ç¼˜å‘å…‰ï¼Œå¦‚1ä¸­æè¿°çš„é€æ˜å…‰æ™•æè´¨ã€‚</li>
<li>â€Œ<strong>å®ç°æ­¥éª¤</strong>â€Œï¼š
<ul>
<li>å¯¼å…¥çº¹ç†å¹¶è®¾ç½®ï¼š<code>Texture Type</code>ä¸º<code>Default (sRGB)</code>ï¼Œå‹¾é€‰<code>Alpha Is Transparency</code>ï¼Œ<code>Wrap Mode</code>è®¾ä¸º<code>Clamp</code>ã€‚</li>
<li>åˆ›å»ºæè´¨ï¼šé€‰æ‹©<code>Universal Render Pipeline/Unlit</code> Shaderï¼Œè®¾ç½®<code>Surface Type</code>ä¸º<code>Transparent</code>ï¼Œæ‹–æ‹½çº¹ç†åˆ°<code>Base Map</code>æ’æ§½ã€‚</li>
<li>è°ƒæ•´<code>Tint</code>é¢œè‰²æ§åˆ¶å…‰æ™•è‰²å½©ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6"><strong>å…¨æ¯æŠ•å½±æ•ˆæœ</strong></h3>
<ul>
<li>â€Œ<strong>åº”ç”¨å®ä¾‹</strong>â€Œï¼šç§‘å¹»åœºæ™¯ä¸­çš„è™šæ‹Ÿè§’è‰²æˆ–ç•Œé¢ã€‚ç»“åˆé€æ˜åº¦ä¸æ‰«æçº¿çº¹ç†ã€‚</li>
<li>â€Œ<strong>å®ç°æ­¥éª¤</strong>â€Œï¼š
<ul>
<li>ä½¿ç”¨<code>Unlit</code> Shaderå¹¶å¯ç”¨é€æ˜æ··åˆï¼ˆ<code>Blend SrcAlpha OneMinusSrcAlpha</code>ï¼‰ã€‚</li>
<li>æ·»åŠ é¡¶ç‚¹åç§»ä»£ç æ¨¡æ‹Ÿå…¨æ¯æŠ–åŠ¨ï¼Œé€šè¿‡<code>_Time</code>å˜é‡æ§åˆ¶åŠ¨æ€æ•ˆæœã€‚</li>
<li>å åŠ æ‰«æçº¿çº¹ç†ï¼ˆå¦‚<code>_HologramLine1</code>ï¼‰å’Œè²æ¶…å°”åå°„å¢å¼ºç«‹ä½“æ„Ÿã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7"><strong>é€æ˜é®ç½©ï¼ˆå¦‚å¡‘æ–™è–„è†œï¼‰</strong></h3>
<ul>
<li>â€Œ<strong>åº”ç”¨å®ä¾‹</strong>â€Œï¼šUIé®ç½©æˆ–åŠé€æ˜è£…é¥°ç‰©ã€‚é€šè¿‡Alphaé€šé“æ§åˆ¶é€æ˜åº¦ï¼Œå¦‚ä¸­çš„å¡‘æ–™è–„è†œæè´¨ã€‚</li>
<li>â€Œ<strong>å®ç°æ­¥éª¤</strong>â€Œï¼š
<ul>
<li>åœ¨å›¾ç‰‡ç¼–è¾‘å™¨ä¸­åˆ›å»ºå¸¦Alphaé€šé“çš„çº¹ç†ï¼Œç™½è‰²åŒºåŸŸä¸é€æ˜ï¼Œç°è‰²åŒºåŸŸåŠé€æ˜ã€‚</li>
<li>æè´¨Shaderé€‰æ‹©<code>Unlit</code>ï¼Œè®¾ç½®<code>Transparent</code>æ¨¡å¼ï¼Œçº¹ç†ç»‘å®šåˆ°<code>Base Map</code>ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8"><strong>å‘å…‰å¹¿å‘Šç‰Œï¼ˆBillboardï¼‰</strong></h3>
<ul>
<li>â€Œ<strong>åº”ç”¨å®ä¾‹</strong>â€Œï¼šæ¸¸æˆå†…å›ºå®šäº®åº¦æ ‡è¯†æˆ–éœ“è™¹ç¯ã€‚ç›´æ¥æ˜¾ç¤ºçº¹ç†é¢œè‰²ä¸å—å…‰ç…§å½±å“ã€‚</li>
<li>â€Œ<strong>å®ç°æ­¥éª¤</strong>â€Œï¼š
<ul>
<li>ä½¿ç”¨<code>Unlit</code> Shaderï¼Œ<code>Surface Type</code>è®¾ä¸º<code>Opaque</code>ã€‚</li>
<li>é€šè¿‡<code>Base Map</code>è®¾ç½®å‘å…‰çº¹ç†ï¼Œè°ƒæ•´<code>Tint</code>é¢œè‰²å¢å¼ºäº®åº¦ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-9"><strong>æ™¯æ·±é®æŒ¡æ ‡è®°</strong></h3>
<ul>
<li>â€Œ<strong>åº”ç”¨å®ä¾‹</strong>â€Œï¼šåŠé€æ˜ç‰©ä½“æ·±åº¦å†™å…¥ï¼ˆå¦‚ç»ç’ƒç“¶ï¼‰ï¼Œè§£å†³æ™¯æ·±æ•ˆæœå¤±æ•ˆé—®é¢˜ã€‚</li>
<li>â€Œ<strong>å®ç°æ­¥éª¤</strong>â€Œï¼š
<ul>
<li>åˆ›å»ºä¸¤ä¸ªæè´¨ï¼šä¸€ä¸ªé€æ˜æè´¨ï¼ˆ<code>Queue=Transparent</code>ï¼‰ï¼Œä¸€ä¸ªæ·±åº¦å†™å…¥æè´¨ï¼ˆ<code>Queue=2000</code>ï¼‰ã€‚</li>
<li>æ·±åº¦å†™å…¥æè´¨ä½¿ç”¨<code>Unlit</code> Shaderå¹¶å¯ç”¨<code>ZWrite On</code>ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10"><strong>å…³é”®æ³¨æ„äº‹é¡¹</strong></h3>
<ul>
<li>â€Œ<strong>æ¸²æŸ“é¡ºåº</strong>â€Œï¼šé€æ˜ç‰©ä½“éœ€å…³é—­æ·±åº¦å†™å…¥ï¼ˆ<code>ZWrite Off</code>ï¼‰ï¼Œå¹¶åˆç†è®¾ç½®<code>Queue</code>æ ‡ç­¾é¿å…æ··åˆé”™è¯¯ã€‚</li>
<li>â€Œ<strong>æ€§èƒ½ä¼˜åŒ–</strong>â€Œï¼šå¤æ‚æ•ˆæœï¼ˆå¦‚å…¨æ¯æŠ•å½±ï¼‰å»ºè®®ç»“åˆé¡¶ç‚¹ç€è‰²å™¨è®¡ç®—ï¼Œå‡å°‘ç‰‡å…ƒç€è‰²å™¨è´Ÿæ‹…</li>
</ul>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13021255.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13021255%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13021255&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong>
ï¼ˆæ¬¢è¿<em>ç‚¹èµç•™è¨€</em>æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ Node.js æ‰¹é‡å¯¼å…¥å¤šè¯­è¨€æ ‡ç­¾åˆ° Strapi]]></title>    <link>https://juejin.cn/post/7577702891273568291</link>    <guid>https://juejin.cn/post/7577702891273568291</guid>    <pubDate>2025-11-30T03:40:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577702891273568291" data-draft-id="7577690150093307944" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ Node.js æ‰¹é‡å¯¼å…¥å¤šè¯­è¨€æ ‡ç­¾åˆ° Strapi"/> <meta itemprop="keywords" content="å‰ç«¯,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-11-30T03:40:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ Node.js æ‰¹é‡å¯¼å…¥å¤šè¯­è¨€æ ‡ç­¾åˆ° Strapi
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T03:40:41.000Z" title="Sun Nov 30 2025 03:40:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨å¤šè¯­è¨€ç½‘ç«™å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦åœ¨ Strapi ä¸­ç»´æŠ¤å¤§é‡çš„æ ‡ç­¾ï¼ˆTagsï¼‰ï¼Œæ¯”å¦‚æ–‡ç« æ ‡ç­¾ã€äº§å“åˆ†ç±»æ ‡ç­¾ç­‰ã€‚å¦‚æœæ‰‹åŠ¨åœ¨åå°åˆ›å»ºä¸Šç™¾æ¡æ ‡ç­¾ï¼Œä¼šéå¸¸è€—æ—¶ä¸”å®¹æ˜“å‡ºé”™ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ <strong>Node.js è„šæœ¬</strong>æ‰¹é‡å¯¼å…¥æ ‡ç­¾ï¼Œå¹¶æ”¯æŒå¤šè¯­è¨€ï¼ˆè‹±æ–‡ / å¾·è¯­ / æ³•è¯­ï¼‰ä¸è‡ªåŠ¨ç”Ÿæˆ slugã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€é¡¹ç›®èƒŒæ™¯</h2>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Next.js + Strapi é¡¹ç›®ï¼ŒStrapi ä½œä¸ºå†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆCMSï¼‰ï¼Œæˆ‘ä»¬å¸Œæœ›ï¼š</p>
<ul>
<li>æ‰¹é‡å¯¼å…¥ 1000+ æ ‡ç­¾</li>
<li>æ”¯æŒå¤šè¯­è¨€ï¼ˆen / de / frï¼‰</li>
<li>è‡ªåŠ¨ç”Ÿæˆ URL slug</li>
<li>é¿å…é‡å¤åˆ›å»º</li>
</ul>
<p>ä¸ºäº†å®ç°è¿™äº›ç›®æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ª Node.js è„šæœ¬ï¼Œè°ƒç”¨ Strapi çš„ REST API æ¥æ‰¹é‡åˆ›å»ºæ ‡ç­¾ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€å‡†å¤‡å·¥ä½œ</h2>
<ol>
<li>
<p><strong>è·å– Strapi API Token</strong>
åœ¨ Strapi åå°åˆ›å»ºä¸€ä¸ª <strong>API Token</strong>ï¼Œé€‰æ‹© <strong>Full Access</strong> æˆ–è€…è‡³å°‘æœ‰ Tags CRUD æƒé™ã€‚
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º <code>.env</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-env" lang="env">STRAPI_API_URL=https://your-strapi-domain.com
STRAPI_API_TOKEN=YOUR_API_TOKEN
</code></pre>
</li>
<li>
<p><strong>å®‰è£…ä¾èµ–</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install node-fetch@2 dotenv
</code></pre>
</li>
<li>
<p><strong>å‡†å¤‡æ ‡ç­¾æ•°æ®</strong>
æˆ‘ä»¬å°†æ ‡ç­¾å†™æˆ <code>tags.json</code> æ–‡ä»¶ï¼Œç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"tags"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"title_en"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Economy"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title_de"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Wirtschaft"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title_fr"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Ã‰conomie"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"slug_en"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"economy"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"slug_de"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"wirtschaft"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"slug_fr"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"economie"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"title_en"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Technology"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title_de"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Technologie"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title_fr"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Technologie"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"slug_en"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"technology"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"slug_de"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"technologie"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"slug_fr"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"technologie"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€æ ¸å¿ƒè„šæœ¬è§£æ</h2>
<p>ä»¥ä¸‹æ˜¯ <code>import_tags_to_strapi.js</code> çš„æ ¸å¿ƒå®ç°ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> fetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-fetch'</span>); <span class="hljs-comment">// npm install node-fetch@2</span>
<span class="hljs-built_in">require</span>(<span class="hljs-string">'dotenv'</span>).<span class="hljs-title function_">config</span>();

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STRAPI_URL</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">STRAPI_API_URL</span> || <span class="hljs-string">'http://localhost:1337'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TOKEN</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">STRAPI_API_TOKEN</span>;

<span class="hljs-keyword">const</span> raw = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'tags.json'</span>, <span class="hljs-string">'utf8'</span>);
<span class="hljs-keyword">const</span> { tags } = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(raw);

<span class="hljs-comment">// helper: sleep</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sleep</span> = (<span class="hljs-params">ms</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(res, ms));
</code></pre>
<h3 data-id="heading-3">1. åˆ›å»ºè‹±æ–‡æ ‡ç­¾</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> enBody = {
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">title</span>: tagObj.<span class="hljs-property">title_en</span>,
    <span class="hljs-attr">slug</span>: tagObj.<span class="hljs-property">slug_en</span>
  }
};
<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${STRAPI_URL}</span>/api/tags?populate=none`</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${TOKEN}</span>`</span>,
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
  },
  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(enBody)
});
</code></pre>
<h3 data-id="heading-4">2. åˆ›å»ºå¾·è¯­å’Œæ³•è¯­æœ¬åœ°åŒ–</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> deBody = {
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">title</span>: tagObj.<span class="hljs-property">title_de</span>, <span class="hljs-attr">slug</span>: tagObj.<span class="hljs-property">slug_de</span> },
  <span class="hljs-attr">locale</span>: <span class="hljs-string">'de'</span>
};
<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${STRAPI_URL}</span>/api/tags/<span class="hljs-subst">${createdId}</span>/localizations`</span>, { ... });

<span class="hljs-keyword">const</span> frBody = {
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">title</span>: tagObj.<span class="hljs-property">title_fr</span>, <span class="hljs-attr">slug</span>: tagObj.<span class="hljs-property">slug_fr</span> },
  <span class="hljs-attr">locale</span>: <span class="hljs-string">'fr'</span>
};
<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${STRAPI_URL}</span>/api/tags/<span class="hljs-subst">${createdId}</span>/localizations`</span>, { ... });
</code></pre>
<blockquote>
<p>è¿™é‡Œä½¿ç”¨äº† Strapi <strong>Localizations API</strong>ï¼Œä¿è¯ä¸åŒè¯­è¨€ä¹‹é—´çš„æ ‡ç­¾å…³è”ã€‚</p>
</blockquote>
<h3 data-id="heading-5">3. æ‰¹é‡å¤„ç†ä¸é˜²åˆ·é™æµ</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; tags.<span class="hljs-property">length</span>; i++) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">createTag</span>(tags[i], i + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">200</span>); <span class="hljs-comment">// é¿å… API è¯·æ±‚è¿‡å¿«</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-6">å››ã€è¿è¡Œè„šæœ¬</h2>
<pre><code class="hljs language-bash" lang="bash">node import_tags_to_strapi.js
</code></pre>
<p>æ‰§è¡Œåï¼Œä½ ä¼šçœ‹åˆ°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">1 created EN <span class="hljs-attr">id</span>= <span class="hljs-number">15</span>
1 created DE localization
1 created FR localization
2 created EN <span class="hljs-attr">id</span>= <span class="hljs-number">16</span>
...
done import
</code></pre>
<hr/>
<h2 data-id="heading-7">äº”ã€æ³¨æ„äº‹é¡¹</h2>
<ol>
<li><strong>API Token æƒé™</strong>ï¼šç¡®ä¿ Token æœ‰ Tag çš„è¯»å†™æƒé™ã€‚</li>
<li><strong>slug å”¯ä¸€æ€§</strong>ï¼šStrapi å¯¹ slug æœ‰å”¯ä¸€æ€§è¦æ±‚ï¼Œå»ºè®®æå‰ç”Ÿæˆæˆ–ä½¿ç”¨ <code>slugify</code>ã€‚</li>
<li><strong>è¯·æ±‚é¢‘ç‡</strong>ï¼šä¸€æ¬¡å¯¼å…¥å¤§é‡æ ‡ç­¾æ—¶ï¼Œå¢åŠ  <code>sleep</code> æ—¶é—´å¯é¿å… Strapi æŠ¥ 429ã€‚</li>
<li><strong>å¤šè¯­è¨€ç®¡ç†</strong>ï¼šLocalizations API ä¿è¯æ ‡ç­¾åœ¨å¤šè¯­è¨€ä¹‹é—´å…³è”ï¼Œä¾¿äºå‰ç«¯å±•ç¤ºã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-8">å…­ã€æ€»ç»“</h2>
<p>é€šè¿‡ Node.js è„šæœ¬æ‰¹é‡å¯¼å…¥ Strapi æ ‡ç­¾å¯ä»¥å¤§å¹…æé«˜æ•ˆç‡ï¼Œå¹¶ä¸”å¯ä»¥ï¼š</p>
<ul>
<li>æ”¯æŒä¸Šåƒæ¡æ ‡ç­¾</li>
<li>è‡ªåŠ¨ç”Ÿæˆ slug</li>
<li>æ”¯æŒå¤šè¯­è¨€</li>
<li>å¯åœ¨ CI/CD æˆ–éƒ¨ç½²è„šæœ¬ä¸­é‡å¤æ‰§è¡Œ</li>
</ul>
<p>è¿™ç§æ–¹å¼ç‰¹åˆ«é€‚åˆæ–°é—»ç½‘ç«™ã€åšå®¢ã€äº§å“ç›®å½•ã€è·¨è¯­è¨€é¡¹ç›®ç­‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-appå¼€å‘appä¹‹å‰æé¡»çŸ¥ï¼ˆIOS/å®‰å“ï¼‰]]></title>    <link>https://juejin.cn/post/7577681092138467363</link>    <guid>https://juejin.cn/post/7577681092138467363</guid>    <pubDate>2025-11-30T03:44:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577681092138467363" data-draft-id="7577690150093176872" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-appå¼€å‘appä¹‹å‰æé¡»çŸ¥ï¼ˆIOS/å®‰å“ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,uni-app"/> <meta itemprop="datePublished" content="2025-11-30T03:44:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é±¼æ¨±å‰ç«¯"/> <meta itemprop="url" content="https://juejin.cn/user/2392187252771181"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-appå¼€å‘appä¹‹å‰æé¡»çŸ¥ï¼ˆIOS/å®‰å“ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392187252771181/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é±¼æ¨±å‰ç«¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T03:44:38.000Z" title="Sun Nov 30 2025 03:44:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯é±¼æ¨±ï¼ï¼ï¼</p>
<p>å…³æ³¨å…¬ä¼—å·<code>ã€é±¼æ¨±AIå®éªŒå®¤ã€‘</code>æŒç»­åˆ†äº«æ›´å¤šå‰ç«¯å’ŒAIè¾…åŠ©å‰ç«¯ç¼–ç æ–°çŸ¥è¯†~~</p>
<p>ä¸å®šæ—¶å†™ç‚¹ç¬”è®°å†™ç‚¹ç”Ÿæ´»~å†™ç‚¹å‰ç«¯ç»éªŒã€‚</p>
<p>åœ¨å½“å‰ç¯å¢ƒä¸‹ï¼Œçº¯å‰ç«¯å¼€å‘è€…å¯ä»¥é€šè¿‡æŠ€æœ¯æ·±åŒ–ã€æ¨ªå‘æ‰©å±•ã€åˆ‡å…¥æ–°å…´é¢†åŸŸï¼ˆMCP TOOLS AIåº”ç”¨äº§å“æ–¹å‘ ç­‰ï¼‰ä»¥åŠäº§å“åŒ–æ€ç»´æ‰¾åˆ°çªç ´å£ã€‚ï¼ˆä¸ç®¡å†™å¤šä¹…çš„ä»£ç ï¼ŒæŠ€æœ¯æ·±åº¦å¹¿åº¦å¦‚ä½•ä¸€å®šè¦å…·å¤‡<code>ç‹¬ç«‹èµšé’±</code>çš„èƒ½åŠ›å‘€ï¼ï¼è€é“ä»¬ï¼Œå› ä¸ºæ€»æœ‰ä¸€å¤©ä½ ä¸åœ¨èŒåœºæ€»æœ‰ä¸€å¤©ä¼šé¢å¯¹é€‰æ‹©å’ŒèŒåœºçš„æ— æƒ…ï¼‰</p>
<p>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<p>å‰ç«¯æœ€å·çš„å¼€å‘è¯­è¨€ä¸€ç‚¹ä¸ä¸ºè¿‡ï¼Œä¸‰å¤©ä¸€å°æ›´ï¼Œäº”å¤©ä¸€å¤§æ›´ã€‚ã€‚ã€‚ä¸€å¹´ä¸€ä¸ªæ¡†æ¶å‡çº§~=å—¯ï¼Œè¦çš„å°±æ˜¯è¿™æ ·æ„Ÿè§‰ï¼ä¸æ—¶ä¿±è¿›~ æ¥ä¸‹æ¥ä¼šé€æ­¥åˆ†äº«<code>uni-app</code>çš„ä¸€äº›å¼€å‘ç»éªŒã€‚ä»æ–‡æ¡£åˆ°åŸºç¡€åˆ°å®æˆ˜ä»¥åŠé‡åˆ°çš„é—®é¢˜~æ—¶é—´èŠ‚ç‚¹ä¸é™ã€‚</p>
<p>æœ€è¿‘ä¾æ—§æ¯”è¾ƒå¿™ï¼ŒæŠ€æœ¯æ–‡ç« è¿˜æ˜¯ä¼šä¸å®šæ—¶æ›´æ–°ä¸€äº›æ ¸å¿ƒçš„æŠ€æœ¯åˆ†äº«ï¼Œå’Œå¤§å®¶ä¸€èµ·å­¦ä¹ å‰ç«¯è·¯ç¨‹ã€‚</p>
<h2 data-id="heading-0">å‰è¨€é¡»çŸ¥</h2>
<p><code>uni-app</code>Â App ç«¯å†…ç½®äº†ä¸€ä¸ªåŸºäº weex æ”¹è¿›çš„åŸç”Ÿæ¸²æŸ“å¼•æ“ï¼Œæä¾›äº†åŸç”Ÿæ¸²æŸ“èƒ½åŠ›ï¼Œåœ¨ App ç«¯ï¼Œå¦‚æœä½¿ç”¨ vue é¡µé¢ï¼Œåˆ™ä½¿ç”¨ webview æ¸²æŸ“ï¼›å¦‚æœä½¿ç”¨ nvue é¡µé¢(native vue çš„ç¼©å†™)ï¼Œåˆ™ä½¿ç”¨åŸç”Ÿæ¸²æŸ“ã€‚ä¸€ä¸ª App ä¸­å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸¤ç§é¡µé¢ï¼Œæ¯”å¦‚é¦–é¡µä½¿ç”¨ nvueï¼ŒäºŒçº§é¡µä½¿ç”¨ vue é¡µé¢</p>
<p>è™½ç„¶ nvue ä¹Ÿå¯ä»¥å¤šç«¯ç¼–è¯‘ï¼Œè¾“å‡º H5 å’Œå°ç¨‹åºï¼Œä½† nvue çš„ css å†™æ³•å—é™ï¼Œæ‰€ä»¥å¦‚æœä½ ä¸å¼€å‘ Appï¼Œé‚£ä¹ˆä¸éœ€è¦ä½¿ç”¨ nvue</p>
<p>nvue çš„ç»„ä»¶å’Œ API å†™æ³•ä¸ vue é¡µé¢ä¸€è‡´</p>
<p>å¦‚æœä½ ç†Ÿæ‚‰ weex æˆ– react native å¼€å‘ï¼Œé‚£ä¹ˆ nvue æ˜¯ä½ çš„æ›´ä¼˜é€‰æ‹©ï¼Œèƒ½åˆ‡å®æå‡ä½ çš„å¼€å‘æ•ˆç‡ï¼Œé™ä½æˆæœ¬</p>
<p>å¦‚æœä½ æ˜¯ web å‰ç«¯ï¼Œä¸ç†Ÿæ‚‰åŸç”Ÿæ’ç‰ˆï¼Œé‚£ä¹ˆå»ºè®®ä½ ä»ç„¶ä»¥ä½¿ç”¨ vue é¡µé¢ä¸ºä¸»ï¼Œåœ¨ App ç«¯æŸäº› vue é¡µé¢è¡¨ç°ä¸ä½³çš„åœºæ™¯ä¸‹ä½¿ç”¨ nvue ä½œä¸ºå¼ºåŒ–è¡¥å……ã€‚</p>
<p>uni-app åœ¨ App ç«¯ï¼Œæ”¯æŒ vue é¡µé¢å’Œ nvue é¡µé¢æ··æ­ã€äº’ç›¸è·³è½¬ã€‚ä¹Ÿæ”¯æŒçº¯ nvue åŸç”Ÿæ¸²æŸ“ã€‚</p>
<p>å¯ç”¨çº¯åŸç”Ÿæ¸²æŸ“æ¨¡å¼ï¼Œå¯ä»¥å‡å°‘ App ç«¯çš„åŒ…ä½“ç§¯ã€å‡å°‘ä½¿ç”¨æ—¶çš„å†…å­˜å ç”¨ã€‚å› ä¸º webview æ¸²æŸ“æ¨¡å¼çš„ç›¸å…³æ¨¡å—å°†è¢«ç§»é™¤ã€‚</p>
<p>åœ¨ manifest.json æºç è§†å›¾çš„<code>"app-plus"</code>ä¸‹é…ç½®<code>"renderer":"native"</code>ï¼Œå³ä»£è¡¨ App ç«¯å¯ç”¨çº¯åŸç”Ÿæ¸²æŸ“æ¨¡å¼ã€‚æ­¤æ—¶ pages.json æ³¨å†Œçš„ vue é¡µé¢å°†è¢«å¿½ç•¥ï¼Œvue ç»„ä»¶ä¹Ÿå°†è¢«åŸç”Ÿæ¸²æŸ“å¼•æ“æ¥æ¸²æŸ“ã€‚</p>
<p>å¦‚æœä¸æŒ‡å®šè¯¥å€¼ï¼Œé»˜è®¤æ˜¯ä¸å¯åŠ¨çº¯åŸç”Ÿæ¸²æŸ“çš„ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// manifest.json</span>
	<span class="hljs-punctuation">{</span>
	   <span class="hljs-comment">// ...</span>
		<span class="hljs-comment">// Appå¹³å°ç‰¹æœ‰é…ç½®</span>
	   <span class="hljs-attr">"app-plus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
	      <span class="hljs-attr">"renderer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"native"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">//Appç«¯çº¯åŸç”Ÿæ¸²æŸ“æ¨¡å¼</span>
	   <span class="hljs-punctuation">}</span>
	<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-1">ç¼–è¯‘æ¨¡å¼</h2>
<p><strong>weex ç¼–è¯‘æ¨¡å¼å’Œ uni-app ç¼–è¯‘æ¨¡å¼ï¼ˆæ¨èï¼‰</strong></p>
<p>weex çš„ç»„ä»¶å’Œ JS APIï¼Œä¸ uni-app ä¸åŒã€‚uni-app ä¸å¾®ä¿¡å°ç¨‹åºç›¸åŒ  ä¸»è¦ä»‹ç» uni-app æ–¹å¼ weexè‡ªè¡Œäº†è§£</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/254529af32d34d22add29c650b2e32b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG85qix5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765079078&amp;x-signature=Xl9AMmBlX9j4gbevc%2Fc4UpE3eaA%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ manifest.json ä¸­ä¿®æ”¹ 2 ç§ç¼–è¯‘æ¨¡å¼ï¼Œ<code>manifest.json</code>Â -&gt;Â <code>app-plus</code>Â -&gt;Â <code>nvueCompiler</code>Â åˆ‡æ¢ç¼–è¯‘æ¨¡å¼ã€‚
<code>nvueCompiler</code>Â æœ‰ä¸¤ä¸ªå€¼ï¼š</p>
<ul>
<li>weex</li>
<li>uni-app</li>
</ul>
<pre><code class="hljs language-json" lang="json">	<span class="hljs-comment">// manifest.json</span>
	<span class="hljs-punctuation">{</span>
		<span class="hljs-comment">// ...</span>
		<span class="hljs-comment">// Appå¹³å°ç‰¹æœ‰é…ç½®</span>
		<span class="hljs-attr">"app-plus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
			<span class="hljs-attr">"nvueCompiler"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uni-app"</span> <span class="hljs-comment">//æ˜¯å¦å¯ç”¨ uni-app æ¨¡å¼</span>
		<span class="hljs-punctuation">}</span>
	<span class="hljs-punctuation">}</span>
</code></pre>
<p>åŸç”Ÿå¼€å‘æ²¡æœ‰é¡µé¢æ»šåŠ¨çš„æ¦‚å¿µï¼Œé¡µé¢å†…å®¹é«˜è¿‡å±å¹•é«˜åº¦æ—¶ï¼Œå†…å®¹å¹¶ä¸ä¼šè‡ªåŠ¨æ»šåŠ¨ï¼›åªæœ‰å°†é¡µé¢å†…å®¹æ”¾åœ¨<code>list</code>ã€<code>waterfall</code>ã€<code>scroll-view/scroller</code>è¿™å‡ ä¸ªç»„ä»¶ä¸‹å†…å®¹æ‰å¯æ»šåŠ¨ã€‚è¿™ä¸ç¬¦åˆå‰ç«¯å¼€å‘çš„ä¹ æƒ¯ï¼Œæ‰€ä»¥åœ¨ nvue ç¼–è¯‘ä¸ºÂ <code>uni-app</code>æ¨¡å¼æ—¶ï¼Œ<code>uni-app</code>æ¡†æ¶ä¼šç»™ nvue é¡µé¢å¤–å±‚è‡ªåŠ¨åµŒå¥—ä¸€ä¸ªÂ <code>scroller</code>ï¼Œä»è€Œå®ç°é¡µé¢å†…å®¹çš„è‡ªåŠ¨æ»šåŠ¨ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li><code>uni-app</code>æ¡†æ¶ä»…å¯¹ nvue é¡µé¢åµŒå¥—<code>scroller</code>å®¹å™¨ï¼Œä¸ä¼šç»™ç»„ä»¶è‡ªåŠ¨å¥—<code>scroller</code>å®¹å™¨ï¼›</li>
<li>è‹¥ nvue é¡µé¢æœ‰<code>recycle-list</code>ç»„ä»¶æ—¶ï¼Œ<code>uni-app</code>æ¡†æ¶ä¹Ÿä¸ä¼šè‡ªåŠ¨ç»™é¡µé¢åµŒå¥—<code>scroller</code>å®¹å™¨</li>
<li>è‹¥ä½ ä¸å¸Œæœ›è‡ªåŠ¨åµŒå¥—<code>scroller</code>å®¹å™¨ï¼Œå¯åœ¨<code>pages.json</code>ä¸­é€šè¿‡å¦‚ä¸‹é…ç½®è¿›è¡Œå…³é—­ï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"disableScroll"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-comment">// ä¸åµŒå¥— scroller</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>HBuilderX 3.1.0+ å¼€å§‹æ”¯æŒæ–°çš„æ ·å¼ç¼–è¯‘æ¨¡å¼</strong></p>
<ul>
<li>weex ç¼–è¯‘æ¨¡å¼ï¼šè€æ¨¡å¼ï¼Œæ ·å¼æ”¯æŒä¸æ™®é€š weex ç›¸åŒ</li>
<li>uni-app ç¼–è¯‘æ¨¡å¼ï¼šæ–°æ¨¡å¼ï¼Œåœ¨ weex åŸæœ‰æ ·å¼åŸºç¡€ä¸Šæ”¯æŒç»„åˆé€‰æ‹©å™¨ï¼ˆç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ã€æ™®é€šå…„å¼Ÿé€‰æ‹©å™¨ã€å­é€‰æ‹©å™¨ã€åä»£é€‰æ‹©å™¨ï¼‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fask.dcloud.net.cn%2Farticle%2F38751" target="_blank" title="https://ask.dcloud.net.cn/article/38751" ref="nofollow noopener noreferrer">è¯¦è§</a></li>
</ul>
<pre><code class="hljs language-json" lang="json">  <span class="hljs-comment">// manifest.json</span>
  <span class="hljs-punctuation">{</span>
      <span class="hljs-comment">// ...</span>
      <span class="hljs-comment">// Appå¹³å°ç‰¹æœ‰é…ç½®</span>
      <span class="hljs-attr">"app-plus"</span><span class="hljs-punctuation">:</span>  <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"nvueStyleCompiler"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uni-app"</span>
      <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-2">å¿«é€Ÿä¸Šæ‰‹</h2>
<p>åœ¨ HBuilderX çš„Â <code>uni-app</code>Â é¡¹ç›®ä¸­ï¼Œæ–°å»ºé¡µé¢ï¼Œå¼¹å‡ºç•Œé¢å³ä¸Šè§’å¯ä»¥é€‰æ‹©æ˜¯å»ºç«‹<code>vue</code>é¡µé¢è¿˜æ˜¯<code>nvue</code>é¡µé¢ï¼Œæˆ–è€… 2 ä¸ªåŒæ—¶å»º</p>
<p>ä¸ç®¡æ˜¯ vue é¡µé¢è¿˜æ˜¯ nvue é¡µé¢ï¼Œéƒ½éœ€è¦åœ¨<code>pages.json</code>ä¸­æ³¨å†Œã€‚å¦‚æœåœ¨ HBuilderX ä¸­æ–°å»ºé¡µé¢æ˜¯ä¼šè‡ªåŠ¨æ³¨å†Œçš„ï¼Œå¦‚æœä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨ï¼Œåˆ™éœ€è¦è‡ªè¡Œåœ¨ pages.json é‡Œæ³¨å†Œã€‚</p>
<p>å¦‚æœä¸€ä¸ªé¡µé¢è·¯ç”±ä¸‹åŒæ—¶æœ‰ vue é¡µé¢å’Œ nvue é¡µé¢ï¼Œå³å‡ºç°åŒåçš„ vue å’Œ nvue æ–‡ä»¶ã€‚é‚£ä¹ˆåœ¨ App ç«¯ï¼Œä¼šä»…ä½¿ç”¨ nvue é¡µé¢ï¼ŒåŒåçš„ vue æ–‡ä»¶å°†ä¸ä¼šè¢«ç¼–è¯‘åˆ° App ç«¯ã€‚è€Œåœ¨é App ç«¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨ vue é¡µé¢ã€‚</p>
<p>å¦‚æœä¸åŒåï¼Œåªæœ‰ nvue é¡µé¢ï¼Œåˆ™åœ¨é app ç«¯ï¼Œåªæœ‰ uni-app ç¼–è¯‘æ¨¡å¼çš„ nvue æ–‡ä»¶æ‰ä¼šç¼–è¯‘ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96331e2892094ca795ba4c89362bf75f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG85qix5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765079078&amp;x-signature=%2F5ZBYr4dzE3vhqrRSePbIdoOAlQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">å¼€å‘ nvue é¡µé¢éœ€æ³¨æ„</h3>
<p><code>nvue</code>Â é¡µé¢ç»“æ„åŒÂ <code>vue</code>, ç”±Â <code>template</code>ã€<code>style</code>ã€<code>script</code>Â æ„æˆã€‚</p>
<ul>
<li>
<p>templateï¼š æ¨¡æ¿å†™æ³•ã€æ•°æ®ç»‘å®šåŒ vueã€‚ç»„ä»¶æ”¯æŒ 2 ç§æ¨¡å¼ï¼Œ</p>
<ul>
<li>uni-app ç»„ä»¶ï¼ŒåŒ uni-app å†™æ³•ã€‚</li>
<li>App ç«¯ nvue ä¸“ç”¨ç»„ä»¶ï¼Œè¯¦è§<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.io%2Fcomponent%2Fbarcode" target="_blank" title="https://uniapp.dcloud.io/component/barcode" ref="nofollow noopener noreferrer">uniapp.dcloud.io/component/bâ€¦</a>ã€‚</li>
</ul>
</li>
<li>
<p>styleï¼šç”±äºé‡‡ç”¨åŸç”Ÿæ¸²æŸ“ï¼Œ<strong>å¹¶éæ‰€æœ‰æµè§ˆå™¨çš„ css å‡æ”¯æŒï¼Œå¸ƒå±€æ¨¡å‹åªæ”¯æŒ flex å¸ƒå±€</strong>ï¼Œè™½ç„¶ä¸ä¼šé€ æˆæŸäº›ç•Œé¢å¸ƒå±€æ— æ³•å®ç°ï¼Œä½†å†™æ³•è¦æ³¨æ„ã€‚è¯¦è§ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fnvue-css" target="_blank" title="https://uniapp.dcloud.net.cn/tutorial/nvue-css" ref="nofollow noopener noreferrer">æ ·å¼</a></p>
</li>
<li>
<p>scriptï¼šå†™æ³•åŒ vueï¼Œå¹¶æ”¯æŒ 3 ç§ APIï¼š</p>
<ul>
<li>nvue API ï¼šä»…æ”¯æŒ App ç«¯ï¼Œuni-app ç¼–è¯‘æ¨¡å¼ä¹Ÿå¯ä½¿ç”¨ã€‚ä½¿ç”¨å‰éœ€å…ˆå¼•å…¥å¯¹åº”æ¨¡å—ï¼Œå‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fnvue-api" target="_blank" title="https://uniapp.dcloud.net.cn/tutorial/nvue-api" ref="nofollow noopener noreferrer">æ¨¡å—å¼•å…¥ API</a></li>
<li>uni APIï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.io%2Fapi%2FREADME" target="_blank" title="https://uniapp.dcloud.io/api/README" ref="nofollow noopener noreferrer">uniapp.dcloud.io/api/README</a></li>
<li>plus APIï¼šä»…æ”¯æŒ App ç«¯ã€‚<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.html5plus.org%2Fdoc%2Fh5p.html" target="_blank" title="http://www.html5plus.org/doc/h5p.html" ref="nofollow noopener noreferrer">www.html5plus.org/doc/h5p.htmâ€¦</a></li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">è°ƒè¯• nvue é¡µé¢</h3>
<p>HBuilderX å†…ç½®äº† weex è°ƒè¯•å·¥å…·çš„å¼ºåŒ–ç‰ˆï¼ŒåŒ…æ‹¬å®¡æŸ¥ç•Œé¢å…ƒç´ ã€çœ‹ logã€debug æ‰“æ–­ç‚¹ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fdebug%2Fdebug-app.html" target="_blank" title="https://uniapp.dcloud.net.cn/tutorial/debug/debug-app.html" ref="nofollow noopener noreferrer">è¯¦è§</a></p>
<h4 data-id="heading-5">æ³¨æ„äº‹é¡¹</h4>
<ul>
<li><code>vue</code>Â å’ŒÂ <code>nvue</code>Â é¡µé¢å‡æ”¯æŒæ–­ç‚¹è°ƒè¯•</li>
<li>ç›®å‰ä»…æ”¯æŒÂ <code>nvue</code>Â é¡µé¢å®¡æŸ¥å…ƒç´ ï¼Œ<code>vue</code>Â é¡µé¢æš‚ä¸æ”¯æŒï¼Œä»¥åŠÂ <code>Android</code>Â å¹³å°çš„Â <code>nvue</code>Â å®¡æŸ¥å…ƒç´ æš‚ä¸æ”¯æŒæŸ¥çœ‹Â <code>style</code></li>
<li>App ç«¯æä¾›çœŸæœºè¿è¡Œçš„<code>console.log</code>æ—¥å¿—è¾“å‡ºï¼Œè¿è¡Œåˆ°çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨æ—¶ï¼Œä¸ç”¨ç‚¹<code>debug</code>æŒ‰é’®ï¼Œè¿è¡Œæ‰‹æœº Appï¼Œä¼šåœ¨<code>HBuilderX</code>çš„æ§åˆ¶å°ç›´æ¥è¾“å‡ºæ—¥å¿—ã€‚</li>
<li>å¦‚æœæ˜¯è°ƒè¯•<code>App</code>çš„ç•Œé¢å’Œå¸¸è§„ APIï¼Œ<strong>æ¨èç¼–è¯‘åˆ° H5 ç«¯</strong>ï¼Œç‚¹<code>HBuilderX</code>å³ä¸Šè§’çš„é¢„è§ˆï¼Œåœ¨å†…ç½®æµè§ˆå™¨é‡Œè°ƒ<code>Dom</code>ï¼Œä¿å­˜åç«‹å³çœ‹åˆ°ç»“æœï¼Œè°ƒè¯•æ›´æ–¹ä¾¿ã€‚å¹¶ä¸” H5 ç«¯ä¹Ÿæ”¯æŒ<code>titleNView</code>çš„å„ç§å¤æ‚è®¾ç½®ã€‚å”¯ä¸€è¦æ³¨æ„çš„å°±æ˜¯<code>css</code>å…¼å®¹æ€§ï¼Œä½¿ç”¨å¤ªæ–°çš„<code>css</code>åœ¨<code>pc</code>ä¸Šé¢„è§ˆå¯èƒ½æ­£å¸¸ï¼Œä½†ä½ç«¯<code>Android</code>ä¸Šå¼‚å¸¸ï¼Œå…·ä½“å¯æŸ¥è¯¢<code>caniuse</code>ç­‰ç½‘ç«™ã€‚</li>
<li>å¸¸ç”¨çš„å¼€å‘æ¨¡å¼å°±æ˜¯<code>pc</code>ä¸Šä½¿ç”¨å†…ç½®æµè§ˆå™¨é¢„è§ˆè°ƒ domï¼Œè¿è¡Œåˆ°çœŸæœºä¸Šçœ‹<code>console.log</code>ã€‚å¦‚æœæ˜¯å¾ˆå¤æ‚çš„é—®é¢˜æ‰ä½¿ç”¨<code>debug</code>ã€‚</li>
<li>uni-app çš„ App ç«¯çš„ webkit remote debugï¼Œåªèƒ½è°ƒè¯•è§†å›¾å±‚ï¼Œä¸èƒ½è°ƒè¯•é€»è¾‘å±‚ã€‚å› ä¸º uni-app çš„ js ä¸æ˜¯è¿è¡Œåœ¨ webview é‡Œï¼Œè€Œæ˜¯ç‹¬ç«‹çš„ jscore é‡Œã€‚</li>
<li>éƒ¨åˆ† manifest é…ç½®ï¼Œå¦‚ä¸‰æ–¹ sdk é…ç½®ï¼Œéœ€è¦æ‰“åŒ…åç”Ÿæ•ˆçš„ï¼Œå¯ä»¥æ‰“åŒ…ä¸€ä¸ªè‡ªå®šä¹‰è¿è¡ŒåŸºåº§ã€‚æ‰“åŒ…è‡ªå®šä¹‰åŸºåº§åè¿è¡Œè¿™ä¸ªè‡ªå®šä¹‰åŸºåº§ï¼ŒåŒæ ·å¯ä»¥çœŸæœºè¿è¡Œå’Œ debugã€‚æ‰“åŒ…æ­£å¼åŒ…å°†æ— æ³•çœŸæœºè¿è¡Œå’Œ debugã€‚</li>
<li>è°ƒè¯•ä¾èµ– chrome å®‰è£…ä½ç½®ï¼Œæ‰¾ä¸åˆ°å¯èƒ½ä¼šå¯¼è‡´è°ƒè¯•æŠ¥é”™ã€‚ç¤¾åŒºåé¦ˆä¸­æœ‰ç”¨æˆ·ä¸»åŠ¨ä¿®æ”¹äº† chrome çš„å®‰è£…ä½ç½®ï¼Œå¯¼è‡´å†…ç½®çš„ puppeteer æŸ¥æ‰¾ chromeå¤±è´¥ï¼Œå¦‚æœä½ ä¿®æ”¹äº† chrome çš„å®‰è£…ä½ç½®ï¼Œè¯·å‚è€ƒ ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fask.dcloud.net.cn%2Farticle%2F41558" target="_blank" title="https://ask.dcloud.net.cn/article/41558" ref="nofollow noopener noreferrer">HBuilderX APPç«¯ uni/nvue è°ƒè¯•æŠ¥é”™é—®é¢˜</a>ã€‹</li>
</ul>
<h3 data-id="heading-6">nvueå¼€å‘ä¸vueå¼€å‘çš„å¸¸è§åŒºåˆ«</h3>
<ol>
<li>nvue é¡µé¢æ§åˆ¶æ˜¾éšåªå¯ä»¥ä½¿ç”¨<code>v-if</code>ä¸å¯ä»¥ä½¿ç”¨<code>v-show</code></li>
<li>nvue é¡µé¢åªèƒ½ä½¿ç”¨<code>flex</code>å¸ƒå±€ï¼Œä¸æ”¯æŒå…¶ä»–å¸ƒå±€æ–¹å¼ã€‚é¡µé¢å¼€å‘å‰ï¼Œé¦–å…ˆæƒ³æ¸…æ¥šè¿™ä¸ªé¡µé¢çš„çºµå‘å†…å®¹æœ‰ä»€ä¹ˆï¼Œå“ªäº›æ˜¯è¦æ»šåŠ¨çš„ï¼Œç„¶åæ¯ä¸ªçºµå‘å†…å®¹çš„æ¨ªè½´æ’å¸ƒæœ‰ä»€ä¹ˆï¼ŒæŒ‰ flex å¸ƒå±€è®¾è®¡å¥½ç•Œé¢ã€‚</li>
<li>nvue é¡µé¢çš„å¸ƒå±€æ’åˆ—æ–¹å‘é»˜è®¤ä¸ºç«–æ’ï¼ˆ<code>column</code>ï¼‰ï¼Œå¦‚éœ€æ”¹å˜å¸ƒå±€æ–¹å‘ï¼Œå¯ä»¥åœ¨Â <code>manifest.json</code>Â -&gt;Â <code>app-plus</code>Â -&gt;Â <code>nvue</code>Â -&gt;Â <code>flex-direction</code>Â èŠ‚ç‚¹ä¸‹ä¿®æ”¹ï¼Œä»…åœ¨ uni-app æ¨¡å¼ä¸‹ç”Ÿæ•ˆã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.io%2Fcollocation%2Fmanifest%3Fid%3Dnvue" target="_blank" title="https://uniapp.dcloud.io/collocation/manifest?id=nvue" ref="nofollow noopener noreferrer">è¯¦æƒ…</a>ã€‚</li>
<li>nvueé¡µé¢ç¼–è¯‘ä¸ºH5ã€å°ç¨‹åºæ—¶ï¼Œä¼šåšä¸€ä»¶cssé»˜è®¤å€¼å¯¹é½çš„å·¥ä½œã€‚å› ä¸ºweexæ¸²æŸ“å¼•æ“åªæ”¯æŒflexï¼Œå¹¶ä¸”é»˜è®¤flexæ–¹å‘æ˜¯å‚ç›´ã€‚è€ŒH5å’Œå°ç¨‹åºç«¯ï¼Œä½¿ç”¨webæ¸²æŸ“ï¼Œé»˜è®¤ä¸æ˜¯flexï¼Œå¹¶ä¸”è®¾ç½®<code>display:flex</code>åï¼Œå®ƒçš„flexæ–¹å‘é»˜è®¤æ˜¯æ°´å¹³è€Œä¸æ˜¯å‚ç›´çš„ã€‚æ‰€ä»¥nvueç¼–è¯‘ä¸ºH5ã€å°ç¨‹åºæ—¶ï¼Œä¼šè‡ªåŠ¨æŠŠé¡µé¢é»˜è®¤å¸ƒå±€è®¾ä¸ºflexã€æ–¹å‘ä¸ºå‚ç›´ã€‚å½“ç„¶å¼€å‘è€…æ‰‹åŠ¨è®¾ç½®åä¼šè¦†ç›–é»˜è®¤è®¾ç½®ã€‚</li>
<li>æ–‡å­—å†…å®¹ï¼Œå¿…é¡»ã€åªèƒ½åœ¨<code>&lt;text&gt;</code>ç»„ä»¶ä¸‹ã€‚ä¸èƒ½åœ¨<code>&lt;div&gt;</code>ã€<code>&lt;view&gt;</code>çš„<code>text</code>åŒºåŸŸé‡Œç›´æ¥å†™æ–‡å­—ã€‚å¦åˆ™å³ä½¿æ¸²æŸ“äº†ï¼Œä¹Ÿæ— æ³•ç»‘å®šjsé‡Œçš„å˜é‡ã€‚</li>
<li>åªæœ‰<code>text</code>æ ‡ç­¾å¯ä»¥è®¾ç½®å­—ä½“å¤§å°ï¼Œå­—ä½“é¢œè‰²ã€‚</li>
<li>å¸ƒå±€ä¸èƒ½ä½¿ç”¨ç™¾åˆ†æ¯”ã€æ²¡æœ‰åª’ä½“æŸ¥è¯¢ã€‚</li>
<li>nvue åˆ‡æ¢æ¨ªç«–å±æ—¶å¯èƒ½å¯¼è‡´æ ·å¼å‡ºç°é—®é¢˜ï¼Œå»ºè®®æœ‰ nvue çš„é¡µé¢é”å®šæ‰‹æœºæ–¹å‘ã€‚</li>
<li>æ”¯æŒçš„cssæœ‰é™ï¼Œä¸è¿‡å¹¶ä¸å½±å“å¸ƒå±€å‡ºä½ éœ€è¦çš„ç•Œé¢ï¼Œ<code>flex</code>è¿˜æ˜¯éå¸¸å¼ºå¤§çš„ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fnvue-css.html%23flex" target="_blank" title="https://uniapp.dcloud.net.cn/tutorial/nvue-css.html#flex" ref="nofollow noopener noreferrer">è¯¦è§</a></li>
<li>ä¸æ”¯æŒèƒŒæ™¯å›¾ã€‚ä½†å¯ä»¥ä½¿ç”¨<code>image</code>ç»„ä»¶å’Œå±‚çº§æ¥å®ç°ç±»ä¼¼webä¸­çš„èƒŒæ™¯æ•ˆæœã€‚å› ä¸ºåŸç”Ÿå¼€å‘æœ¬èº«ä¹Ÿæ²¡æœ‰webè¿™ç§èƒŒæ™¯å›¾æ¦‚å¿µ</li>
<li>cssé€‰æ‹©å™¨æ”¯æŒçš„æ¯”è¾ƒå°‘ï¼Œåªèƒ½ä½¿ç”¨ class é€‰æ‹©å™¨ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fnvue-css.html" target="_blank" title="https://uniapp.dcloud.net.cn/tutorial/nvue-css.html" ref="nofollow noopener noreferrer">è¯¦è§</a></li>
<li>nvue çš„å„ç»„ä»¶åœ¨å®‰å“ç«¯é»˜è®¤æ˜¯é€æ˜çš„ï¼Œå¦‚æœä¸è®¾ç½®<code>background-color</code>ï¼Œå¯èƒ½ä¼šå¯¼è‡´å‡ºç°é‡å½±çš„é—®é¢˜ã€‚</li>
<li><code>class</code>Â è¿›è¡Œç»‘å®šæ—¶åªæ”¯æŒæ•°ç»„è¯­æ³•ã€‚</li>
<li>Androidç«¯åœ¨ä¸€ä¸ªé¡µé¢å†…ä½¿ç”¨å¤§é‡åœ†è§’è¾¹æ¡†ä¼šé€ æˆæ€§èƒ½é—®é¢˜ï¼Œå°¤å…¶æ˜¯å¤šä¸ªè§’çš„æ ·å¼è¿˜ä¸ä¸€æ ·çš„è¯æ›´è€—è´¹æ€§èƒ½ã€‚åº”é¿å…è¿™ç±»ä½¿ç”¨ã€‚</li>
<li>nvueé¡µé¢æ²¡æœ‰<code>bounce</code>å›å¼¹æ•ˆæœï¼Œåªæœ‰å‡ ä¸ªåˆ—è¡¨ç»„ä»¶æœ‰<code>bounce</code>æ•ˆæœï¼ŒåŒ…æ‹¬Â <code>list</code>ã€<code>recycle-list</code>ã€<code>waterfall</code>ã€‚</li>
<li>åŸç”Ÿå¼€å‘æ²¡æœ‰é¡µé¢æ»šåŠ¨çš„æ¦‚å¿µï¼Œé¡µé¢å†…å®¹é«˜è¿‡å±å¹•é«˜åº¦å¹¶ä¸ä¼šè‡ªåŠ¨æ»šåŠ¨ï¼Œåªæœ‰éƒ¨åˆ†ç»„ä»¶å¯æ»šåŠ¨ï¼ˆ<code>list</code>ã€<code>waterfall</code>ã€<code>scroll-view/scroller</code>ï¼‰ï¼Œè¦æ»šçš„å†…å®¹éœ€è¦å¥—åœ¨å¯æ»šåŠ¨ç»„ä»¶ä¸‹ã€‚è¿™ä¸ç¬¦åˆå‰ç«¯å¼€å‘çš„ä¹ æƒ¯ï¼Œæ‰€ä»¥åœ¨ nvue ç¼–è¯‘ä¸º uni-appæ¨¡å¼æ—¶ï¼Œç»™é¡µé¢å¤–å±‚è‡ªåŠ¨å¥—äº†ä¸€ä¸ªÂ <code>scroller</code>ï¼Œé¡µé¢å†…å®¹è¿‡é«˜ä¼šè‡ªåŠ¨æ»šåŠ¨ã€‚ï¼ˆç»„ä»¶ä¸ä¼šå¥—ï¼Œé¡µé¢æœ‰<code>recycle-list</code>æ—¶ä¹Ÿä¸ä¼šå¥—ï¼‰ã€‚åç»­ä¼šæä¾›é…ç½®ï¼Œå¯ä»¥è®¾ç½®ä¸è‡ªåŠ¨å¥—ã€‚</li>
<li>åœ¨ App.vue ä¸­å®šä¹‰çš„å…¨å±€jså˜é‡ä¸ä¼šåœ¨ nvue é¡µé¢ç”Ÿæ•ˆã€‚<code>globalData</code>å’Œ<code>vuex</code>æ˜¯ç”Ÿæ•ˆçš„ã€‚</li>
<li>App.vue ä¸­å®šä¹‰çš„å…¨å±€cssï¼Œå¯¹nvueå’Œvueé¡µé¢åŒæ—¶ç”Ÿæ•ˆã€‚å¦‚æœå…¨å±€cssä¸­æœ‰äº›cssåœ¨nvueä¸‹ä¸æ”¯æŒï¼Œç¼–è¯‘æ—¶æ§åˆ¶å°ä¼šæŠ¥è­¦ï¼Œå»ºè®®æŠŠè¿™äº›ä¸æ”¯æŒçš„cssåŒ…è£¹åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.io%2Fplatform" target="_blank" title="https://uniapp.dcloud.io/platform" ref="nofollow noopener noreferrer">æ¡ä»¶ç¼–è¯‘</a>é‡Œï¼Œ<code>APP-PLUS-NVUE</code></li>
<li>ä¸èƒ½åœ¨Â <code>style</code>Â ä¸­å¼•å…¥å­—ä½“æ–‡ä»¶ï¼Œnvue ä¸­å­—ä½“å›¾æ ‡çš„ä½¿ç”¨å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fnvue-api.html%23addrule" target="_blank" title="https://uniapp.dcloud.net.cn/tutorial/nvue-api.html#addrule" ref="nofollow noopener noreferrer">åŠ è½½è‡ªå®šä¹‰å­—ä½“</a>ã€‚å¦‚æœæ˜¯æœ¬åœ°å­—ä½“ï¼Œå¯ä»¥ç”¨<code>plus.io</code>çš„APIè½¬æ¢è·¯å¾„ã€‚</li>
<li>ç›®å‰ä¸æ”¯æŒåœ¨ nvue é¡µé¢ä½¿ç”¨Â <code>typescript/ts</code>ã€‚
<strong>21</strong>.  nvue é¡µé¢å…³é—­åŸç”Ÿå¯¼èˆªæ æ—¶ï¼Œæƒ³è¦æ¨¡æ‹ŸçŠ¶æ€æ ï¼Œå¯ä»¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fask.dcloud.net.cn%2Farticle%2F35111" target="_blank" title="https://ask.dcloud.net.cn/article/35111" ref="nofollow noopener noreferrer">å‚è€ƒæ–‡ç« </a>ã€‚ä½†æ˜¯ï¼Œä»ç„¶<strong>å¼ºçƒˆå»ºè®®åœ¨nvueé¡µé¢ä½¿ç”¨åŸç”Ÿå¯¼èˆªæ </strong>ã€‚nvueçš„æ¸²æŸ“é€Ÿåº¦å†å¿«ï¼Œä¹Ÿæ²¡æœ‰åŸç”Ÿå¯¼èˆªæ å¿«ã€‚åŸç”Ÿæ’ç‰ˆå¼•æ“è§£æ<code>json</code>ç»˜åˆ¶åŸç”Ÿå¯¼èˆªæ è€—æ—¶å¾ˆå°‘ï¼Œè€Œè§£ænvueçš„jsç»˜åˆ¶æ•´ä¸ªé¡µé¢çš„è€—æ—¶è¦å¤§çš„å¤šï¼Œå°¤å…¶åœ¨æ–°é¡µé¢è¿›å…¥åŠ¨ç”»æœŸé—´ï¼Œå¯¹äºå¤æ‚é¡µé¢ï¼Œæ²¡æœ‰åŸç”Ÿå¯¼èˆªæ ä¼šåœ¨åŠ¨ç”»æœŸé—´äº§ç”Ÿæ•´ä¸ªå±å¹•çš„ç™½å±æˆ–é—ªå±ã€‚</li>
</ol>
<h3 data-id="heading-7">iOS å¹³å°ä¸‹æ‹‰ç»„ä»¶ refresh ç»„ä»¶æ³¨æ„é—®é¢˜</h3>
<p>iOS å¹³å°é»˜è®¤æƒ…å†µä¸‹æ»šåŠ¨å®¹å™¨ç»„ä»¶ï¼ˆå¦‚<code>list</code>ã€<code>waterfall</code>ç»„ä»¶ï¼‰å†…å®¹ä¸è¶³æ—¶ï¼Œç”±äºæ²¡æœ‰æ’‘æ»¡å®¹å™¨çš„å¯è§†åŒºåŸŸä¼šå¯¼è‡´æ— æ³•ä¸Šä¸‹æ»šåŠ¨ï¼Œæ­¤æ—¶æ— æ³•æ“ä½œä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½ï¼Œæ— æ³•è§¦å‘<code>refresh</code>ç»„ä»¶çš„<code>@refresh</code>ã€<code>@pullingdown</code>äº‹ä»¶ã€‚ æ­¤æ—¶å¯åœ¨å®¹å™¨ç»„ä»¶ä¸­é…ç½®<code>alwaysScrollableVertical</code>å±æ€§å€¼ä¸º<code>true</code>æ¥è®¾ç½®æ”¯æŒä¸Šä¸‹æ»šåŠ¨ï¼Œæ”¯æŒä¸‹æ‹‰åˆ·æ–°æ“ä½œã€‚</p>
<blockquote>
<p>Android å¹³å°ä¸å­˜åœ¨æ­¤é—®é¢˜</p>
</blockquote>
<h4 data-id="heading-8">ç”¨æ³•</h4>
<pre><code class="hljs language-nvue" lang="nvue">&lt;list class="scroll-v list" enableBackToTop="true" scroll-y alwaysScrollableVertical="true"&gt;
	&lt;refresh class="refresh" @refresh="onrefresh()" @pullingdown="onpullingdown"&gt;
		&lt;!-- refresh content --&gt;
	&lt;/refresh&gt;
	&lt;cell v-for="(newsitem,index) in list" :key="newsitem.id"&gt;
		&lt;!-- cell content --&gt;
	&lt;/cell&gt;
&lt;/list&gt;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18d5a212772d471f84750462d052781e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG85qix5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765079078&amp;x-signature=WPbSlHxNtvV9c%2BsFSsye0RYq9lU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-9">HTML5+ èƒ½åŠ›</h2>
<p><code>uni-app</code>Â App ç«¯å†…ç½®Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.html5plus.org%2Fdoc%2F" target="_blank" title="https://www.html5plus.org/doc/" ref="nofollow noopener noreferrer">HTML5+</a>Â å¼•æ“ï¼Œè®© js å¯ä»¥ç›´æ¥è°ƒç”¨ä¸°å¯Œçš„åŸç”Ÿèƒ½åŠ›</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a056cec33d7544c0875177ad4e79d426~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG85qix5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765079078&amp;x-signature=DMijjtu2pg6YmxlsRyNfdusla8w%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">æ¡ä»¶ç¼–è¯‘è°ƒç”¨ HTML5+</h4>
<p>å°ç¨‹åºåŠ H5 ç­‰å¹³å°æ˜¯æ²¡æœ‰ HTML5+ æ‰©å±•è§„èŒƒçš„ï¼Œå› æ­¤åœ¨Â <code>uni-app</code>Â è°ƒç”¨ HTML5+ çš„æ‰©å±•è§„èŒƒæ—¶ï¼Œéœ€è¦æ³¨æ„ä½¿ç”¨æ¡ä»¶ç¼–è¯‘ã€‚å¦åˆ™è¿è¡Œåˆ°h5ã€å°ç¨‹åºç­‰å¹³å°ä¼šå‡ºç°Â <code>plus is not defined</code>é”™è¯¯ã€‚</p>
<pre><code class="hljs language-nvue" lang="nvue">// #ifdef APP-PLUS
var appid = plus.runtime.appid;
console.log('åº”ç”¨çš„ appid ä¸ºï¼š' + appid);
// #endif
</code></pre>
<h4 data-id="heading-11"><code>uni-app</code>ä¸éœ€è¦Â <code>plus ready</code></h4>
<p>åœ¨htmlä¸­ä½¿ç”¨plusçš„apiï¼Œéœ€è¦ç­‰å¾…plus readyã€‚ è€Œ<code>uni-app</code>ä¸éœ€è¦ç­‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚è€Œä¸”å¦‚æœä½ è°ƒç”¨plus readyï¼Œåè€Œä¸ä¼šè§¦å‘ã€‚</p>
<h4 data-id="heading-12"><code>uni-app</code>Â ä¸­çš„äº‹ä»¶ç›‘å¬</h4>
<p>åœ¨æ™®é€šçš„ H5+ é¡¹ç›®ä¸­ï¼Œéœ€è¦ä½¿ç”¨Â <code>document.addEventListener</code>Â ç›‘å¬åŸç”Ÿæ‰©å±•çš„äº‹ä»¶ã€‚</p>
<p><code>uni-app</code>Â ä¸­ï¼Œæ²¡æœ‰ documentã€‚å¯ä»¥ä½¿ç”¨Â <code>plus.globalEvent.addEventListener</code>Â æ¥å®ç°ã€‚</p>
<pre><code class="hljs language-nvue" lang="nvue">// #ifdef APP-PLUS
// ç›‘å¬æ–°æ„å›¾äº‹ä»¶
plus.globalEvent.addEventListener('newintent', function(){});
// #endif
</code></pre>
<p>å¤åˆ¶ä»£ç </p>
<p>åŒç†ï¼Œåœ¨Â <code>uni-app</code>Â ä¸­ä½¿ç”¨ Native.js æ—¶ï¼Œä¸€äº› Native.js ä¸­å¯¹äºåŸç”Ÿäº‹ä»¶çš„ç›‘å¬åŒæ ·éœ€è¦æŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•å»å®ç°ã€‚</p>
<h2 data-id="heading-13">Native.js èƒ½åŠ›</h2>
<p>Native.jsæŠ€æœ¯ï¼Œç®€ç§°NJSï¼Œæ˜¯ä¸€ç§å°†æ‰‹æœºæ“ä½œç³»ç»Ÿçš„åŸç”Ÿå¯¹è±¡è½¬ä¹‰ï¼Œæ˜ å°„ä¸ºJSå¯¹è±¡ï¼Œåœ¨JSé‡Œç¼–å†™åŸç”Ÿä»£ç çš„æŠ€æœ¯ã€‚ å¦‚æœè¯´Node.jsæŠŠjsæ‰©å±•åˆ°æœåŠ¡å™¨ä¸–ç•Œï¼Œé‚£ä¹ˆNative.jsåˆ™æŠŠjsæ‰©å±•åˆ°æ‰‹æœºAppçš„åŸç”Ÿä¸–ç•Œã€‚ HTML/JS/Csså…¨éƒ¨è¯­æ³•åªæœ‰7ä¸‡å¤šï¼Œè€ŒåŸç”Ÿè¯­æ³•æœ‰å‡ åä¸‡ï¼ŒNative.jså¤§å¹…æå‡äº†HTML5çš„èƒ½åŠ›ã€‚ NJSçªç ´äº†æµè§ˆå™¨çš„åŠŸèƒ½é™åˆ¶ï¼Œä¹Ÿä¸å†éœ€è¦åƒHybridé‚£æ ·ç”±åŸç”Ÿè¯­è¨€å¼€å‘æ’ä»¶æ‰èƒ½è¡¥è¶³æµè§ˆå™¨æ¬ ç¼ºçš„åŠŸèƒ½ã€‚ NJSç¼–å†™çš„ä»£ç ï¼Œæœ€ç»ˆéœ€è¦åœ¨HBuilderé‡Œæ‰“åŒ…å‘è¡Œä¸ºAppå®‰è£…åŒ…ï¼Œæˆ–è€…åœ¨æ”¯æŒNative.jsæŠ€æœ¯çš„æµè§ˆå™¨é‡Œè¿è¡Œã€‚ç›®å‰Native.jsæŠ€æœ¯ä¸èƒ½åœ¨æ™®é€šæ‰‹æœºæµè§ˆå™¨é‡Œç›´æ¥è¿è¡Œã€‚</p>
<ul>
<li>NJSå¤§å¹…æ‰©å±•äº†HTML5çš„èƒ½åŠ›èŒƒå›´ï¼ŒåŸæœ¬åªæœ‰åŸç”Ÿæˆ–Hybrid Appçš„åŸç”Ÿæ’ä»¶æ‰èƒ½å®ç°çš„åŠŸèƒ½å¦‚ä»Šå¯ä»¥ä½¿ç”¨JSå®ç°ã€‚</li>
<li>NJSå¤§å¹…æå‡äº†Appå¼€å‘æ•ˆç‡ï¼Œå°†iOSã€Androidã€Webçš„3ä¸ªå·¥ç¨‹å¸ˆç»„é˜Ÿæ‰èƒ½å®Œæˆçš„Appï¼Œå˜ä¸º1ä¸ªwebå·¥ç¨‹å¸ˆå°±æå®šã€‚</li>
<li>NJSä¸å†éœ€è¦é…ç½®åŸç”Ÿå¼€å‘å’Œç¼–è¯‘ç¯å¢ƒï¼Œè°ƒè¯•ã€æ‰“åŒ…å‡åœ¨HBuilderé‡Œè¿›è¡Œã€‚æ²¡æœ‰macå’Œxcodeä¸€æ ·å¯ä»¥å¼€å‘iOSåº”ç”¨ã€‚</li>
<li>å¦‚æœä¸ç†Ÿæ‚‰åŸç”ŸAPIä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬æ±‡æ€»äº†å¾ˆå¤šNJSçš„ä»£ç ç¤ºä¾‹ï¼Œå¤åˆ¶ç²˜è´´å°±å¯ä»¥ç”¨ã€‚<a href="https://link.juejin.cn?target=http%3A%2F%2Fask.dcloud.net.cn%2Farticle%2F114" target="_blank" title="http://ask.dcloud.net.cn/article/114" ref="nofollow noopener noreferrer">ask.dcloud.net.cn/article/114</a></li>
</ul>
<p>å†æ¬¡å¼ºè°ƒï¼ŒNative.jsä¸æ˜¯ä¸€ä¸ªjsåº“ï¼Œä¸éœ€è¦ä¸‹è½½å¼•å…¥åˆ°é¡µé¢çš„scriptä¸­ï¼Œä¹Ÿä¸åƒnodejsé‚£æ ·æœ‰å•ç‹¬çš„è¿è¡Œç¯å¢ƒï¼ŒNative.jsçš„è¿è¡Œç¯å¢ƒæ˜¯é›†æˆåœ¨5+runtimeé‡Œçš„ï¼Œä½¿ç”¨HBuilderæ‰“åŒ…çš„appæˆ–æµåº”ç”¨éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨Native.jsã€‚</p>
<h2 data-id="heading-14">æ³¨æ„äº‹é¡¹ï¼š</h2>
<ul>
<li>
<p>Uni-appä¸æ”¯æŒNative.jsæ‰§è¡ŒUIç›¸å…³æ“ä½œçš„APIè°ƒç”¨åŠwebviewç›¸å…³APIè°ƒç”¨ã€‚å°†å¤±æ•ˆæ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚Uni-appä¸æ¨èä½¿ç”¨Native.js</p>
</li>
<li>
<p>Native APIå…·æœ‰å¹³å°ä¾èµ–æ€§ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ¤æ–­å½“å‰çš„è¿è¡Œå¹³å°</p>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">judgePlatform</span>(<span class="hljs-params"/>){
	<span class="hljs-keyword">switch</span> ( plus.<span class="hljs-property">os</span>.<span class="hljs-property">name</span> ) {
		<span class="hljs-keyword">case</span> <span class="hljs-string">"Android"</span>:
		<span class="hljs-comment">// Androidå¹³å°: plus.android.*</span>
		<span class="hljs-keyword">break</span>;
		<span class="hljs-keyword">case</span> <span class="hljs-string">"iOS"</span>:
		<span class="hljs-comment">// iOSå¹³å°: plus.ios.*</span>
		<span class="hljs-keyword">break</span>;
		<span class="hljs-attr">default</span>:
		<span class="hljs-comment">// å…¶å®ƒå¹³å°</span>
		<span class="hljs-keyword">break</span>;
	}
}
</code></pre>
<ul>
<li>åœ¨NJSä¸­è°ƒç”¨Native APIæˆ–ä»Native APIè¿”å›æ•°æ®åˆ°NJSæ—¶ä¼šè‡ªåŠ¨è½¬æ¢æ•°æ®ç±»å‹</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb70f936bde54fe5b6e6660832bab412~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG85qix5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765079078&amp;x-signature=KGGqKFoSxcWfYLG5aBUzi%2FI99vc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-15">æŠ€æœ¯è¦æ±‚</h3>
<p>ç”±äºNJSæ˜¯ç›´æ¥è°ƒç”¨Native APIï¼Œéœ€è¦å¯¹Native APIæœ‰ä¸€å®šäº†è§£ï¼ŒçŸ¥é“æ‰€éœ€è¦çš„åŠŸèƒ½è°ƒç”¨äº†å“ªäº›åŸç”ŸAPIï¼Œèƒ½çœ‹æ‡‚åŸç”Ÿä»£ç å¹¶å‚è€ƒåŸç”Ÿä»£ç ä¿®æ”¹ä¸ºJSä»£ç ã€‚ å¦åˆ™åªèƒ½ç›´æ¥copyåˆ«äººå†™å¥½çš„NJSä»£ç ã€‚</p>
<h2 data-id="heading-16">renderjsèƒ½åŠ›</h2>
<p><code>renderjs</code>æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨è§†å›¾å±‚çš„jsã€‚å®ƒæ¯”<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fminiprogram-subject.html%23wxs" target="_blank" title="https://uniapp.dcloud.net.cn/tutorial/miniprogram-subject.html#wxs" ref="nofollow noopener noreferrer">WXS</a>æ›´åŠ å¼ºå¤§ã€‚å®ƒåªæ”¯æŒapp-vueå’Œwebã€‚</p>
<p><code>renderjs</code>çš„ä¸»è¦ä½œç”¨æœ‰2ä¸ªï¼š</p>
<ol>
<li>å¤§å¹…é™ä½é€»è¾‘å±‚å’Œè§†å›¾å±‚çš„é€šè®¯æŸè€—ï¼Œæä¾›é«˜æ€§èƒ½è§†å›¾äº¤äº’èƒ½åŠ›</li>
<li>åœ¨è§†å›¾å±‚æ“ä½œdomï¼Œè¿è¡Œ for web çš„ jsåº“</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8a99c2201604e78b0402df9ec679140~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG85qix5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765079078&amp;x-signature=nAEadX6XH4i7Vd5w2Of%2Fi6MWEZc%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>nvueçš„è§†å›¾å±‚æ˜¯åŸç”Ÿçš„ï¼Œæ— æ³•è¿è¡Œjsã€‚ä½†æä¾›äº†bindingxæŠ€æœ¯æ¥è§£å†³é€šä¿¡é˜»å¡ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fnvue-api.html%23bindingx" target="_blank" title="https://uniapp.dcloud.net.cn/tutorial/nvue-api.html#bindingx" ref="nofollow noopener noreferrer">è¯¦è§</a></li>
<li>å¾®ä¿¡å°ç¨‹åºä¸‹æ›¿ä»£æ–¹æ¡ˆæ˜¯wxsï¼Œè¿™æ˜¯å¾®ä¿¡æä¾›çš„ä¸€ä¸ªè£å‰ªç‰ˆrenderjsã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fminiprogram-subject.html%23wxs" target="_blank" title="https://uniapp.dcloud.net.cn/tutorial/miniprogram-subject.html#wxs" ref="nofollow noopener noreferrer">è¯¦è§</a></li>
<li>webä¸‹ä¸å­˜åœ¨é€»è¾‘å±‚å’Œè§†å›¾å±‚çš„é€šä¿¡é˜»å¡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ“ä½œdomï¼Œæ‰€ä»¥åœ¨webç«¯ä½¿ç”¨renderjsä¸»è¦æ˜¯ä¸ºäº†è·¨ç«¯å¤ç”¨ä»£ç ã€‚<strong>å¦‚æœåªå¼€å‘webç«¯ï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨renderjs</strong>ã€‚</li>
</ul>
<pre><code class="hljs language-js" lang="js">&lt;script <span class="hljs-variable language_">module</span>=<span class="hljs-string">"test"</span> lang=<span class="hljs-string">"renderjs"</span>&gt;
	<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
		<span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
			<span class="hljs-comment">// ...</span>
		},
		<span class="hljs-attr">methods</span>: {
			<span class="hljs-comment">// ...</span>
		}
	}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-17">è¿‡å»çš„é—®é¢˜</h3>
<ul>
<li>H5ç«¯æµè¡Œçš„echartæŠ¥è¡¨å› ä¸ºæ¶‰åŠå¤§é‡domæ“ä½œï¼Œæ— æ³•è·¨ç«¯ä½¿ç”¨</li>
<li>wx-chartåœ¨è·¨ç«¯å’Œæ›´æ–°æ–¹é¢éƒ½ä¸è¶³</li>
<li>æ’ä»¶å¸‚åœºæä¾›äº†æ¯”wx-chartæ›´å¥½çš„ã€å…¨ç«¯å¯ç”¨çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fext.dcloud.net.cn%2Fplugin%3Fid%3D271" target="_blank" title="https://ext.dcloud.net.cn/plugin?id=271" ref="nofollow noopener noreferrer">uChart</a>ã€‚ä½†å—é™äºå°ç¨‹åºæ¶æ„é€»è¾‘å±‚å’Œè§†å›¾å±‚åˆ†ç¦»ï¼Œå¯¼è‡´çš„é€šä¿¡æŠ˜æŸï¼Œå›¾è¡¨çš„åŠ¨ç”»æ€§èƒ½ä¸ä½³ã€‚å¹¶ä¸”uchartåªå®ç°äº†echartçš„å¸¸ç”¨åŠŸèƒ½ï¼Œè¿˜æœ‰ä¸€äº›åŠŸèƒ½æ²¡æœ‰å®ç°ã€‚</li>
</ul>
<h3 data-id="heading-18">æ–°çš„è§£å†³æ–¹æ¡ˆ</h3>
<p>ä»uni-app 2.5.5+èµ·ï¼Œæ–°æä¾›äº†<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.io%2Fframe%3Fid%3Drenderjs" target="_blank" title="https://uniapp.dcloud.io/frame?id=renderjs" ref="nofollow noopener noreferrer">renderjs</a>æŠ€æœ¯ã€‚å®ƒæ˜¯wxsçš„å‡çº§ç‰ˆï¼Œä¸€ç§å¯ä»¥è¿è¡Œåœ¨è§†å›¾å±‚çš„jsã€‚</p>
<p>é€šè¿‡renderjsç¼–å†™çš„ä»£ç ï¼Œç›´æ¥è¿è¡Œåœ¨è§†å›¾å±‚ï¼ˆä¹Ÿå°±æ˜¯webviewä¸­ï¼‰ï¼Œå¯ä»¥å®Œæ•´çš„è¿è¡Œechartç­‰åº“ï¼Œå¹¶ä¸”æ²¡æœ‰äº†é€»è¾‘å±‚å’Œè§†å›¾å±‚é¢‘ç¹é€šè¡Œçš„æŠ˜æŸï¼Œè®©åŠ¨ç”»ä¸å†å¡é¡¿ã€‚</p>
<p>renderjsæ”¯æŒapp-vueå’Œh5ï¼Œä¸æ”¯æŒå…¶ä»–å¹³å°ã€‚å¦‚æœä½ åªè€ƒè™‘è¿™2ä¸ªå¹³å°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬ç¤ºä¾‹ï¼Œä½¿ç”¨å®Œæ•´ç‰ˆçš„echartã€‚å¦‚æœè¿˜è¦å…¼å®¹å¤šç«¯å°ç¨‹åºï¼Œå»ºè®®ä»ç„¶ä½¿ç”¨uchartã€‚</p>
<p>renderjsï¼Œä¸æ­¢èƒ½è¿è¡Œechartï¼Œå…¶ä»–å¦‚F2ã€threejsç­‰webåº“éƒ½å¯ä»¥è¿è¡Œã€‚</p>
<h3 data-id="heading-19">renderjsä½¿ç”¨æ³¨æ„äº‹é¡¹</h3>
<ul>
<li>ç›®å‰ä»…æ”¯æŒå†…è”ä½¿ç”¨ã€‚</li>
<li>ä¸è¦ç›´æ¥å¼•ç”¨å¤§å‹ç±»åº“ï¼Œæ¨èé€šè¿‡åŠ¨æ€åˆ›å»º script æ–¹å¼å¼•ç”¨ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨ vue ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ(ä¸æ”¯æŒ beforeDestroyã€destroyedã€beforeUnmountã€unmounted)ï¼Œä¸å¯ä»¥ä½¿ç”¨ Appã€Page çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>è§†å›¾å±‚å’Œé€»è¾‘å±‚é€šè®¯æ–¹å¼ä¸Â <a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Ftutorial%2Fminiprogram-subject.html%23wxs" target="_blank" title="https://uniapp.dcloud.net.cn/tutorial/miniprogram-subject.html#wxs" ref="nofollow noopener noreferrer">WXS</a>Â ä¸€è‡´ï¼Œå¦å¤–å¯ä»¥é€šè¿‡ this.$ownerInstance è·å–å½“å‰ç»„ä»¶çš„ ComponentDescriptor å®ä¾‹ã€‚</li>
<li>this.$ownerInstance.callMethod() ä»…æ”¯æŒè°ƒç”¨é€»è¾‘å±‚vueé€‰é¡¹å¼ä¸­çš„ methods ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚</li>
<li>æ³¨æ„é€»è¾‘å±‚ç»™æ•°æ®æ—¶æœ€å¥½ä¸€æ¬¡æ€§ç»™åˆ°æ¸²æŸ“å±‚ï¼Œè€Œä¸æ˜¯ä¸åœä»é€»è¾‘å±‚å‘æ¸²æŸ“å±‚å‘æ¶ˆæ¯ï¼Œé‚£æ ·è¿˜æ˜¯ä¼šäº§ç”Ÿé€»è¾‘å±‚å’Œè§†å›¾å±‚çš„å¤šæ¬¡é€šä¿¡ï¼Œè¿˜æ˜¯ä¼šå¡</li>
<li>è§‚æµ‹æ›´æ–°çš„æ•°æ®åœ¨è§†å›¾å±‚å¯ä»¥ç›´æ¥è®¿é—®åˆ°ã€‚</li>
<li>APP ç«¯è§†å›¾å±‚çš„é¡µé¢å¼•ç”¨èµ„æºçš„è·¯å¾„ç›¸å¯¹äºæ ¹ç›®å½•è®¡ç®—ï¼Œä¾‹å¦‚ï¼š./static/test.jsã€‚</li>
<li>APP ç«¯å¯ä»¥ä½¿ç”¨ domã€bom APIï¼Œä¸å¯ç›´æ¥è®¿é—®é€»è¾‘å±‚æ•°æ®ï¼Œä¸å¯ä»¥ä½¿ç”¨ uni ç›¸å…³æ¥å£ï¼ˆå¦‚ï¼šuni.requestï¼‰</li>
<li>H5 ç«¯é€»è¾‘å±‚å’Œè§†å›¾å±‚å®é™…è¿è¡Œåœ¨åŒä¸€ä¸ªç¯å¢ƒä¸­ï¼Œç›¸å½“äºä½¿ç”¨ mixin æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®é€»è¾‘å±‚æ•°æ®ã€‚</li>
<li>vue3 é¡¹ç›®ä¸æ”¯æŒÂ <code>setup script</code>Â ç”¨æ³•ã€‚</li>
</ul>
<h2 data-id="heading-20">APP ç¦»çº¿ SDK</h2>
<p>Appç¦»çº¿å¼€å‘å·¥å…·åŒ…ï¼Œå³Appç¦»çº¿SDKï¼Œæ˜¯æŠŠAppè¿è¡Œç¯å¢ƒï¼ˆruntimeï¼‰å°è£…ä¸ºåŸç”Ÿå¼€å‘è°ƒç”¨æ¥å£ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è‡ªå·±çš„ Android åŠ iOS åŸç”Ÿå¼€å‘ç¯å¢ƒé…ç½®å·¥ç¨‹ä½¿ç”¨ï¼ŒåŒ…æ‹¬ Androidç¦»çº¿å¼€å‘SDK åŠ iOSç¦»çº¿å¼€å‘SDKã€‚</p>
<p><strong>æ³¨æ„ï¼šæœ¬SDKä»…é™äº<code>uni-app</code>é¡¹ç›®ä½¿ç”¨</strong></p>
<ul>
<li>Android ç¦»çº¿SDK-æ­£å¼ç‰ˆ  <a href="https://link.juejin.cn?target=https%3A%2F%2Fnativesupport.dcloud.net.cn%2FAppDocs%2Fdownload%2Fandroid.html" target="_blank" title="https://nativesupport.dcloud.net.cn/AppDocs/download/android.html" ref="nofollow noopener noreferrer">nativesupport.dcloud.net.cn/AppDocs/dowâ€¦</a></li>
<li>iOS ç¦»çº¿SDK - æ­£å¼ç‰ˆ <a href="https://link.juejin.cn?target=https%3A%2F%2Fnativesupport.dcloud.net.cn%2FAppDocs%2Fdownload%2Fios.html" target="_blank" title="https://nativesupport.dcloud.net.cn/AppDocs/download/ios.html" ref="nofollow noopener noreferrer">nativesupport.dcloud.net.cn/AppDocs/dowâ€¦</a></li>
<li>AppKeyç”³è¯·é…ç½® <a href="https://link.juejin.cn?target=https%3A%2F%2Fnativesupport.dcloud.net.cn%2FAppDocs%2Fusesdk%2Fappkey.html" target="_blank" title="https://nativesupport.dcloud.net.cn/AppDocs/usesdk/appkey.html" ref="nofollow noopener noreferrer">nativesupport.dcloud.net.cn/AppDocs/useâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æä¸æ‡‚ pxã€dpi å’Œ dpï¼Ÿçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼šå›¾è§£ RN å±å¹•é€‚é…é€»è¾‘]]></title>    <link>https://juejin.cn/post/7577681092138500131</link>    <guid>https://juejin.cn/post/7577681092138500131</guid>    <pubDate>2025-11-30T03:47:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577681092138500131" data-draft-id="7577690150093160488" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æä¸æ‡‚ pxã€dpi å’Œ dpï¼Ÿçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼šå›¾è§£ RN å±å¹•é€‚é…é€»è¾‘"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-30T03:47:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çš®è›‹å°ç²¾çµ"/> <meta itemprop="url" content="https://juejin.cn/user/219558056559278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æä¸æ‡‚ pxã€dpi å’Œ dpï¼Ÿçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼šå›¾è§£ RN å±å¹•é€‚é…é€»è¾‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558056559278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çš®è›‹å°ç²¾çµ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T03:47:06.000Z" title="Sun Nov 30 2025 03:47:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>ä¸€ã€ä¸‰ä¸ªæ¦‚å¿µï¼špxã€dpiã€dp</strong></h3>
<ol>
<li>
<p><strong>pxï¼šç‰©ç†åƒç´  / åˆ†è¾¨ç‡é‡Œçš„é‚£ä¸ªåƒç´ </strong>
å½“æˆ‘ä»¬è¯´â€œ720pã€1080pâ€æ—¶ï¼Œå…¶å®è¯´çš„æ˜¯åˆ†è¾¨ç‡ï¼š</p>
<ul>
<li>720p â‰ˆ 1280 Ã— 720 åƒç´ </li>
<li>1080p â‰ˆ 1920 Ã— 1080 åƒç´ 
è¿™é‡Œçš„â€œ1280ã€1920ã€720ã€1080â€ï¼Œéƒ½æ˜¯ pxï¼ˆç‰©ç†åƒç´ ç‚¹çš„ä¸ªæ•°ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>dpiï¼šåƒç´ å¯†åº¦ï¼ˆæ¯è‹±å¯¸å¤šå°‘ä¸ªåƒç´ ï¼‰</strong>
dpiï¼ˆdots per inchï¼‰è¡¨ç¤ºï¼šä¸€è‹±å¯¸ï¼ˆ2.54cmï¼‰é•¿åº¦ä¸Šæœ‰å¤šå°‘ä¸ªåƒç´ ç‚¹ã€‚</p>
<ul>
<li>160dpiï¼šæ¯è‹±å¯¸çº¦ 160 ä¸ªåƒç´ </li>
<li>320dpiï¼šæ¯è‹±å¯¸çº¦ 320 ä¸ªåƒç´ ï¼ˆæ¯” 160dpi æ›´ç»†è…»ï¼‰
dpi æ˜¯ç¡¬ä»¶å±æ€§ï¼Œè·Ÿå±å¹•å¤šå¤§ã€åˆ†è¾¨ç‡å¤šå°‘ä¸€èµ·å†³å®šâ€œçœ‹èµ·æ¥å¤šæ¸…æ™°â€ã€‚</li>
</ul>
</li>
<li>
<p><strong>dpï¼šå¯†åº¦æ— å…³åƒç´ ï¼ˆReact Native ç”¨çš„é€»è¾‘å•ä½ï¼‰</strong>
dpï¼ˆdensity-independent pixelï¼‰æ˜¯ç³»ç»Ÿå®šä¹‰çš„ä¸€ç§â€œé€»è¾‘é•¿åº¦å•ä½â€ï¼Œè®©åŒæ ·çš„æ•°å€¼åœ¨ä¸åŒ dpi çš„è®¾å¤‡ä¸Šï¼Œçœ‹èµ·æ¥å·®ä¸å¤šå¤§ã€‚
åœ¨ React Native é‡Œï¼Œä½ å†™ <code>width: 100</code>ï¼Œè¿™ä¸ª 100 æœ¬è´¨ä¸Šå°±æ˜¯ 100dpï¼Œè€Œä¸æ˜¯ 100pxã€‚</p>
</li>
</ol>
<h3 data-id="heading-1"><strong>äºŒã€dp å’Œ dpi çš„æ•°å­¦å…³ç³»</strong></h3>
<p>Android / React Native çš„çº¦å®šï¼š</p>
<ul>
<li>æŠŠ <strong>160dpi</strong> çš„å±å¹•å½“æˆåŸºå‡†å±å¹•ã€‚</li>
<li>åœ¨ 160dpi å±å¹•ä¸Šï¼š<code>1dp â‰ˆ 1px</code></li>
<li>åœ¨å…¶å®ƒå¯†åº¦å±å¹•ä¸Šï¼Œç³»ç»Ÿç”¨è¿™ä¸ªå…¬å¼æ¢ç®—ï¼š<code>px = dp Ã— (dpi / 160)</code></li>
</ul>
<p>ä¸¾å‡ ä¸ªæ•°å­—ä¾‹å­ï¼š</p>
<ul>
<li><strong>160dpiï¼ˆåŸºå‡†ï¼‰</strong>
<code>1dp = 1 Ã— (160 / 160) = 1px</code>
<code>100dp = 100px</code></li>
<li><strong>320dpi</strong>
<code>1dp = 1 Ã— (320 / 160) = 2px</code>
<code>100dp = 200px</code></li>
<li><strong>480dpi</strong>
<code>1dp = 1 Ã— (480 / 160) = 3px</code>
<code>100dp = 300px</code>ï¼ˆå››èˆäº”å…¥åè¿‘ä¼¼ï¼‰</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<p>å½“ä½ åœ¨ä»£ç é‡Œå†™ width: 100 æ—¶ï¼Œè¿™ä¸ª 100 å®é™…ä¸Šæ˜¯ 100dpã€‚ç³»ç»Ÿä¼šæ ¹æ®å½“å‰è®¾å¤‡çš„ dpiï¼ŒæŠŠå®ƒæ¢ç®—æˆåº”è¯¥ä½¿ç”¨å¤šå°‘ä¸ªç‰©ç†åƒç´ ï¼š</p>
<ul>
<li>åœ¨ 160dpi çš„å±å¹•ä¸Šï¼Œå¤§çº¦ä½¿ç”¨ 100pxï¼ˆ1dp â‰ˆ 1pxï¼‰ï¼›</li>
<li>åœ¨ 320dpi çš„å±å¹•ä¸Šï¼Œå¤§çº¦ä½¿ç”¨ 200pxï¼ˆ1dp â‰ˆ 2pxï¼‰ï¼›</li>
<li>åœ¨ 480dpi çš„å±å¹•ä¸Šï¼Œå¤§çº¦ä½¿ç”¨ 300pxï¼ˆ1dp â‰ˆ 3pxï¼‰ã€‚</li>
</ul>
<p>éšç€å±å¹•åƒç´ å¯†åº¦æé«˜ï¼Œå•ä¸ªåƒç´ æœ¬èº«å˜å¾—æ›´å°ï¼Œæ‰€ä»¥è™½ç„¶ä¸åŒè®¾å¤‡å®é™…ä½¿ç”¨çš„ç‰©ç†åƒç´ æ•°é‡ä¸ä¸€æ ·ï¼Œä½†è¿™ä¸ªâ€œ100dp å®½â€çš„æ§ä»¶åœ¨ç°å®ä¸–ç•Œé‡Œçš„ç‰©ç†å°ºå¯¸ï¼ˆæ¯”å¦‚çœ‹èµ·æ¥æœ‰å¤šå®½ã€å å¤šå¤§ä¸€å—å±å¹•ï¼‰ä¼šå°½é‡ä¿æŒæ¥è¿‘ã€‚</p>
<p>ç°åœ¨ï¼Œ160/320/480dpi å’Œ dpâ†’px çš„å…³ç³»å°±ç†æ¸…æ¥šäº†ï¼Œä¹Ÿè§£é‡Šäº†â€œä¸ºä»€ä¹ˆåŒæ ·çš„ dp åœ¨ä¸åŒæ‰‹æœºä¸Šçœ‹èµ·æ¥å·®ä¸å¤šå¤§â€ã€‚</p>
<h3 data-id="heading-2"><strong>ä¸‰ã€ç¤ºæ„å›¾ï¼šåŒæ · 100dp çš„æŒ‰é’®ï¼Œåœ¨ä¸åŒ dpi / åˆ†è¾¨ç‡ä¸Šé•¿ä»€ä¹ˆæ ·ï¼Ÿ</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/069bb940d5894672b5890e2fe8bc7765~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu6JuL5bCP57K-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765079727&amp;x-signature=VpcJWXbIlSQNDepmn0tI%2F802lOc%3D" alt="Gemini_Generated_Image_hl6v29hl6v29hl6v.png" loading="lazy"/>
<strong>1ï¼‰å·¦è¾¹ï¼š720pï¼Œ160dpi</strong></p>
<ul>
<li>åˆ†è¾¨ç‡ï¼š1280 Ã— 720 px</li>
<li>dpiï¼š160</li>
<li>æ¢ç®—ï¼š<code>1dp = 1px</code>ï¼Œ<code>100dp = 100px</code></li>
<li>æŒ‰é’®åœ¨å±å¹•ä¸Šå¤§çº¦å æ®â€œæŸä¸ªå…·ä½“å®½åº¦ A å˜ç±³â€ã€‚</li>
</ul>
<p><strong>2ï¼‰ä¸­é—´ï¼š1080pï¼Œ320dpi</strong></p>
<ul>
<li>åˆ†è¾¨ç‡ï¼š1920 Ã— 1080 px</li>
<li>dpiï¼š320ï¼ˆåƒç´ æ›´å¯†ï¼‰</li>
<li>æ¢ç®—ï¼š<code>1dp = 2px</code>ï¼Œ<code>100dp = 200px</code></li>
<li>æŒ‰é’®ç”¨æ›´å¤šåƒç´ ç”»å‡ºæ¥ï¼Œä½†å› ä¸ºåƒç´ æ›´å°ï¼Œå®é™…å æ®çš„ç‰©ç†å®½åº¦ä¾ç„¶æ¥è¿‘ A å˜ç±³ã€‚</li>
</ul>
<p><strong>3ï¼‰å³è¾¹ï¼šæ›´é«˜åˆ†è¾¨ç‡ï¼Œ2Kï¼Œ480dpi</strong></p>
<ul>
<li>åˆ†è¾¨ç‡ï¼šä¾‹å¦‚ 2560 Ã— 1440 pxï¼ˆä¸¾ä¾‹ï¼‰</li>
<li>dpiï¼š480</li>
<li>æ¢ç®—ï¼š<code>1dp = 3px</code>ï¼Œ<code>100dp = 300px</code></li>
<li>æŒ‰é’®åœ¨å±å¹•ä¸Šä¾ç„¶å¤§çº¦æ˜¯ A å˜ç±³å®½ï¼Œåªæ˜¯è¾¹ç¼˜ã€æ–‡å­—æ›´ç»†è…»ã€‚</li>
</ul>
<p>å›¾ä¸­ä¸‰ä¸ªæŒ‰é’®ï¼Œçœ‹èµ·æ¥å·®ä¸å¤šå®½ï¼Œä½†å³è¾¹é‚£å°çš„åƒç´ æ•°é‡æœ€å¤šâ€”â€”è¿™å°±æ˜¯â€œdp + dpi æ¢ç®—â€çš„æ•ˆæœï¼šåŒæ ·çš„ dp å€¼ï¼Œåœ¨é«˜å¯†åº¦å±ä¸Šç”¨æ›´å¤š px å»ç”»ï¼Œä»è€Œä¿æŒè§†è§‰å°ºå¯¸æ¥è¿‘ã€‚</p>
<h3 data-id="heading-3"><strong>å››ã€é‚£ 720pã€ 1080p åœ¨è¿™ä¸ªæ•…äº‹é‡Œæ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ</strong></h3>
<ul>
<li><strong>720pã€1080p</strong> è¯´æ˜çš„æ˜¯æ€»åƒç´ æ•°ï¼ˆåˆ†è¾¨ç‡ï¼‰ï¼Œå³å±å¹•ä¸€å…±å¤šå°‘ä¸ª pxã€‚</li>
<li><strong>dpi</strong> è¯´æ˜çš„æ˜¯è¿™äº›åƒç´ åœ¨ç‰©ç†å°ºå¯¸ä¸Šçš„â€œå¯†åº¦â€ï¼Œå’Œâ€œå±å¹•æœ‰å¤šå¤§â€ä¸€èµ·å†³å®šå±å¹•çœ‹èµ·æ¥å¤šæ¸…æ™°ã€‚</li>
<li><strong>dp</strong> æ˜¯åœ¨ React Native / Android / iOS å¸ƒå±€é‡Œç”¨çš„â€œé€»è¾‘å°ºå¯¸å•ä½â€ï¼Œç”¨æ¥å†™ UI å°ºå¯¸ã€‚ç³»ç»Ÿä¼šæ ¹æ®å½“å‰è®¾å¤‡çš„ dpi å’Œåˆ†è¾¨ç‡ï¼Œç”¨å…¬å¼æŠŠ dp æ¢æˆ pxã€‚</li>
</ul>
<p>ä½ å¯ä»¥å¤§è‡´è¿™æ ·ç†è§£ï¼š</p>
<ul>
<li><strong>px</strong>ï¼šç –å¤´æ€»æ•°ï¼ˆåˆ†è¾¨ç‡ï¼‰</li>
<li><strong>dpi</strong>ï¼šæ¯ 1cm æ‘†å¤šå°‘å—ç –ï¼ˆå¯†åº¦ï¼‰</li>
<li><strong>dp</strong>ï¼šè®¾è®¡å›¾ä¸Šç”»çš„â€œè¿™å µå¢™è¦ 2 ç±³å®½â€ï¼Œå…·ä½“åˆ°ç°åœºè¦ç”¨å¤šå°‘ç –ï¼Œç”±å·¥äººï¼ˆç³»ç»Ÿï¼‰æ ¹æ®ç –å°ºå¯¸ï¼ˆdpiï¼‰æ¥ç®—ã€‚</li>
</ul>
<h3 data-id="heading-4"><strong>äº”ã€åœ¨ React Native é‡Œæ€ä¹ˆç”¨ dp å†™å°ºå¯¸ï¼Ÿ</strong></h3>
<p>åœ¨ RN ä»£ç é‡Œï¼Œä½ ä¸ç”¨å†™ dpã€px è¿™æ ·çš„å•ä½ï¼Œç›´æ¥å†™æ•°å­—å³å¯ï¼Œè¿™ä¸ªæ•°å­—é»˜è®¤å°±æ˜¯ dpï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®½é«˜éƒ½æ˜¯ dp å•ä½</span>
&lt;<span class="hljs-title class_">View</span> style={{ <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">40</span>, <span class="hljs-attr">borderRadius</span>: <span class="hljs-number">8</span> }} /&gt;
</code></pre>
<p>React Native ä¼šåšå‡ ä»¶äº‹ï¼š</p>
<ol>
<li>è·å–å½“å‰è®¾å¤‡çš„ï¼š
<ul>
<li>åˆ†è¾¨ç‡ï¼ˆæ€»pxæ•°ï¼‰</li>
<li>å±å¹•å°ºå¯¸ï¼ˆè‹±å¯¸ï¼‰</li>
<li>åƒç´ å¯†åº¦dpiï¼ˆppiï¼‰</li>
</ul>
</li>
<li>ç”¨å…¬å¼ px = dp Ã— (dpi / 160)ï¼ŒæŠŠä½ çš„dpæ¢ç®—æˆçœŸå®px</li>
<li>æŠŠè¿™ä¸ªpxå‘Šè¯‰åº•å±‚åŸç”Ÿè§†å›¾å»æ¸²æŸ“</li>
</ol>
<p>ä½ ä¹Ÿå¯ä»¥ç”¨ <strong>Dimensions</strong> å’Œ <strong>PixelRatio</strong> çœ‹ä¸€ä¸‹å½“å‰è®¾å¤‡çš„é€»è¾‘å°ºå¯¸å’Œåƒç´ æ¯”ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Dimensions</span>, <span class="hljs-title class_">PixelRatio</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;

<span class="hljs-keyword">const</span> { width, height } = <span class="hljs-title class_">Dimensions</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'window'</span>); <span class="hljs-comment">// å®½é«˜ï¼Œå•ä½æ˜¯ dp</span>
<span class="hljs-keyword">const</span> pixelRatio = <span class="hljs-title class_">PixelRatio</span>.<span class="hljs-title function_">get</span>();                <span class="hljs-comment">// è®¾å¤‡åƒç´ æ¯”ï¼Œçº¦ç­‰äº dpi / 160</span>
</code></pre>
<p>æ¯”å¦‚æŸå°è®¾å¤‡ï¼š</p>
<ul>
<li>width = 375ï¼Œheight = 812ï¼ˆå•ä½æ˜¯é€»è¾‘å°ºå¯¸dpï¼‰</li>
<li>pixelRatio = 3</li>
<li>åˆ†è¾¨ç‡å¤§çº¦æ˜¯ï¼šå®½ 375 Ã— 3 = 1125pxï¼Œé«˜ 812 Ã— 3 â‰ˆ 2436pxï¼ˆç±»ä¼¼iPhoneXï¼‰</li>
</ul>
<h3 data-id="heading-5">å…­ã€å’Œè®¾è®¡ç¨¿çš„è¿æ¥ï¼šä»pxåˆ°dp</h3>
<p>åœ¨å¼€å‘ä¸­ï¼Œä½ æœ€å›°æƒ‘çš„å¯èƒ½æ˜¯ï¼š <strong>â€œè®¾è®¡å¸ˆç»™æˆ‘ä¸€å¼  750px å®½çš„å›¾ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¦å†™ 375ï¼Ÿâ€</strong></p>
<p>ä¸ºä»€ä¹ˆè¦â€œé™¤ä»¥ 2â€ï¼Ÿ</p>
<p>è¿™å¾—ä»ç§»åŠ¨ç«¯è®¾è®¡çš„<strong>è¡Œä¸šæ ‡å‡†</strong>è¯´èµ·ã€‚</p>
<h4 data-id="heading-6">1. ä»€ä¹ˆæ˜¯â€œ2 å€å›¾â€ï¼Ÿ</h4>
<p>åœ¨ Retinaï¼ˆè§†ç½‘è†œï¼‰å±å¹•å‡ºç°ä¹‹å‰ï¼Œå±å¹•å¾ˆæ¸£ï¼ˆ1å€å±ï¼‰ï¼Œ1ä¸ªé€»è¾‘åƒç´  = 1ä¸ªç‰©ç†åƒç´ ã€‚</p>
<p>åæ¥ iPhone 4 æå‡ºäº† Retina å±ï¼Œå±å¹•å¤§å°æ²¡å˜ï¼Œä½†å¡è¿›å»çš„åƒç´ ç¿»äº†ä¸€å€ï¼ˆæ¨ªç«–å„ç¿»å€ï¼‰ã€‚</p>
<p>è¿™å°±å‡ºç°äº†ä¸€ä¸ªæ ‡å‡†ï¼š <strong>â€œ2 å€å›¾æ ‡å‡†â€</strong> ï¼ˆä»¥ iPhone 6/7/8 ä¸ºåŸºå‡†ï¼‰ï¼š</p>
<ul>
<li><strong>æ‰‹æœºç‰©ç†å±å¹•ï¼ˆç¡¬ä»¶ï¼‰ï¼š</strong> å®½ 750pxï¼ˆå¾ˆç»†è…»ï¼‰ã€‚</li>
<li><strong>ç³»ç»Ÿé€»è¾‘å®½åº¦ï¼ˆè½¯ä»¶ï¼‰ï¼š</strong> å®½ 375dpï¼ˆä¹Ÿå°±æ˜¯ç³»ç»Ÿè®¤ä¸ºåªæœ‰ 375 ä¸ªâ€œç‚¹â€ï¼‰ã€‚</li>
<li><strong>å…³ç³»ï¼š</strong> 750 Ã· 375 = <strong>2</strong>ã€‚è¿™å°±æ˜¯ <strong>â€œ2 å€å›¾â€ (@2x)</strong> çš„ç”±æ¥ã€‚å³ï¼š<strong>2 ä¸ªç‰©ç†åƒç´  = 1 ä¸ªé€»è¾‘ç‚¹ (dp)</strong> ã€‚</li>
</ul>
<h4 data-id="heading-7">2. è®¾è®¡å¸ˆä¸ºä»€ä¹ˆå–œæ¬¢ç»™ 750px çš„ç¨¿å­ï¼Ÿ</h4>
<p>è™½ç„¶ç³»ç»Ÿé€»è¾‘åªè¦ 375dpï¼Œä½†ä¸ºäº†ä¿è¯å›¾æ ‡ã€çº¿æ¡åœ¨é«˜é€šè¿‡ç‡å±å¹•ä¸Šä¸æ¨¡ç³Šï¼Œè®¾è®¡å¸ˆé€šå¸¸ä¼šåœ¨ <strong>750px Ã— 1334px</strong>ï¼ˆä¹Ÿå°±æ˜¯ iPhone 6/7/8 çš„ç‰©ç†åˆ†è¾¨ç‡ï¼‰çš„ç”»å¸ƒä¸Šç”»å›¾ã€‚</p>
<p>è¿™å°±å¥½æ¯”ï¼šè®¾è®¡å¸ˆåœ¨ä¸€å¼ <strong>å¾ˆå¤§ã€å¾ˆæ¸…æ™°</strong>çš„çº¸ï¼ˆ750pxï¼‰ä¸Šç”»å›¾ï¼Œä½†ä½ çš„æ‰‹æœºå±å¹•æ˜¯ä¸€ä¸ª<strong>ç¼©å°é•œ</strong>ï¼Œå®ƒè¦æŠŠè¿™å¼ å¤§çº¸ç¼©æ”¾åˆ° 375dp çš„é€»è¾‘å®½åº¦é‡Œå»æ˜¾ç¤ºã€‚</p>
<h4 data-id="heading-8">3. å¼€å‘è€…æ€ä¹ˆæ¢ç®—ï¼Ÿï¼ˆæ ¸å¿ƒå…¬å¼ï¼‰</h4>
<p>å› ä¸º RN ä»£ç é‡Œå†™çš„æ˜¯ <code>dp</code>ï¼ˆé€»è¾‘ç‚¹ï¼‰ï¼Œè€Œè®¾è®¡ç¨¿æ˜¯ <code>px</code>ï¼ˆç‰©ç†åƒç´ ï¼Œä¸”é€šå¸¸æ˜¯ 2 å€å¯†åº¦çš„ï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œæ‹¿åˆ°ä¸€å¼  <strong>750px å®½</strong> çš„è®¾è®¡ç¨¿ï¼Œä½ çš„æ¢ç®—é€»è¾‘æ˜¯ï¼š</p>
<blockquote>
<p><strong>RN æ•°å€¼ = è®¾è®¡ç¨¿æ•°å€¼ Ã· 2</strong></p>
</blockquote>
<p><strong>å®æˆ˜ä¾‹å­ï¼š</strong></p>
<ul>
<li>
<p><strong>åœºæ™¯</strong>ï¼šè®¾è®¡å¸ˆç”¨ Figma ç»™äº†ä¸€å¼  750px å®½çš„è®¾è®¡ç¨¿ã€‚</p>
</li>
<li>
<p><strong>å…ƒç´  A</strong>ï¼šè®¾è®¡ç¨¿ä¸Šé‡å‡ºæ¥å®½ <strong>200px</strong>ã€‚</p>
<ul>
<li>ä½ çš„æ€è€ƒï¼šè¿™æ˜¯ 2 å€å›¾ï¼Œæ‰€ä»¥æˆ‘é™¤ä»¥ 2ã€‚</li>
<li><strong>ä»£ç å†™</strong>ï¼š<code>width: 100</code></li>
</ul>
</li>
<li>
<p><strong>å…ƒç´  B</strong>ï¼šè®¾è®¡ç¨¿ä¸Šé‡å‡ºæ¥å­—å· <strong>32px</strong>ã€‚</p>
<ul>
<li>ä½ çš„æ€è€ƒï¼šé™¤ä»¥ 2ã€‚</li>
<li><strong>ä»£ç å†™</strong>ï¼š<code>fontSize: 16</code></li>
</ul>
</li>
</ul>
<h4 data-id="heading-9">4. ç‰¹æ®Šæƒ…å†µï¼šå¦‚æœæ˜¯ 3 å€å›¾å‘¢ï¼Ÿ</h4>
<p>ç°åœ¨æœ‰çš„è®¾è®¡å¸ˆå–œæ¬¢ç”¨ iPhone 12/13/14 Pro çš„å°ºå¯¸åšå›¾ï¼Œè¿™ç±»æ‰‹æœºçš„ç”»å¸ƒå®½åº¦é€šå¸¸æ˜¯ <strong>1125px</strong> æˆ–è€…æ›´é«˜ã€‚</p>
<ul>
<li>åŸºå‡†é€»è¾‘å®½åº¦ï¼šä¾ç„¶çº¦ç­‰äº 375dp ~ 390dpã€‚</li>
<li>æ¢ç®—å…³ç³»ï¼š1125 Ã· 375 = 3ã€‚</li>
<li><strong>ç»“è®º</strong>ï¼šå¦‚æœè®¾è®¡å¸ˆç»™ä½ çš„æ˜¯ 3 å€å›¾ï¼ˆè¶…é«˜æ¸…ç¨¿ï¼‰ï¼Œä½ å°± <strong>é™¤ä»¥ 3</strong>ã€‚</li>
</ul>
<p>æ€»ç»“ï¼š</p>
<p>é—®è®¾è®¡å¸ˆä¸€å¥ï¼šâ€œä½ è¿™æ˜¯æŒ‰å‡ å€å›¾ç”»çš„ï¼Ÿâ€</p>
<ul>
<li>å¦‚æœæ˜¯æŒ‰ 750px å®½ç”»çš„ï¼Œå°±æ˜¯ <strong>2 å€å›¾</strong> -&gt; <strong>é™¤ä»¥ 2</strong>ã€‚</li>
<li>å¦‚æœæ˜¯æŒ‰ 375px å®½ç”»çš„ï¼ˆ1 å€å›¾ï¼‰ï¼Œå°±æ˜¯ <strong>1 å€å›¾</strong> -&gt; <strong>ä¸é™¤ï¼Œæ˜¯å¤šå°‘å†™å¤šå°‘</strong>ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•å®ç°ç²¾å‡†æ“æ§ï¼ŸCesiumæ¨¡å‹ç§»åŠ¨æ—‹è½¬æ§ä»¶å®ç°]]></title>    <link>https://juejin.cn/post/7577663384424022067</link>    <guid>https://juejin.cn/post/7577663384424022067</guid>    <pubDate>2025-11-29T10:44:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577663384424022067" data-draft-id="7577417823342559267" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•å®ç°ç²¾å‡†æ“æ§ï¼ŸCesiumæ¨¡å‹ç§»åŠ¨æ—‹è½¬æ§ä»¶å®ç°"/> <meta itemprop="keywords" content="cesium,WebGL"/> <meta itemprop="datePublished" content="2025-11-29T10:44:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="goodName"/> <meta itemprop="url" content="https://juejin.cn/user/767898264016683"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•å®ç°ç²¾å‡†æ“æ§ï¼ŸCesiumæ¨¡å‹ç§»åŠ¨æ—‹è½¬æ§ä»¶å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/767898264016683/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    goodName
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T10:44:38.000Z" title="Sat Nov 29 2025 10:44:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘åœ¨é¡¹ç›®ä¸­é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼š<strong>éœ€è¦åœ¨Cesiumä¸­åŠ¨æ€ç¼–è¾‘æ¨¡å‹çš„ä½ç½®</strong>ã€‚</p>
<p>ç†Ÿæ‚‰ä¸‰ç»´å¼€å‘çš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼ŒThree.jsæä¾›äº†ååˆ†ä¾¿æ·çš„æ§ä»¶æ¥æ“ä½œæ¨¡å‹ï¼ˆTransformControlsï¼‰ï¼Œä½†æ˜¯Cesiumåœ¨è¿™æ–¹é¢æœ‰æ‰€æ¬ ç¼ºï¼šè™½ç„¶é€šè¿‡å‚æ•°è®¾ç½®ä¹Ÿèƒ½å®ç°åŠŸèƒ½ï¼Œä½†å¯¹ç”¨æˆ·æ¥è¯´æ“ä½œä¸å¤Ÿç›´è§‚ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘èŠ±äº†ä¸¤ä¸‰å¤©æ—¶é—´å¼€å‘äº†ä¸€ä¸ªç±»ä¼¼çš„æ¨¡å‹ä½ç½®ç¼–è¾‘æ§ä»¶ï¼Œå®ç°äº†è¾ƒä¸ºç›´è§‚çš„äº¤äº’æ“ä½œã€‚</p>
<p>å…·ä½“æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47f94f4c570a4bceafc1af925589ae85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29vZE5hbWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765017877&amp;x-signature=LBiRhlrRJmYKnlJIlKNa0jwr5aY%3D" alt="Cesiumæ§ä»¶.gif" loading="lazy"/></p>
<p>æ•´ä¸ªå®ç°è¿‡ç¨‹è¿˜æ˜¯æœ‰äº›å¤æ‚çš„ï¼Œæ¶‰åŠåˆ°äº†åæ ‡è½¬æ¢ã€äº¤äº’å¤„ç†ã€Cesiumäº‹ä»¶æœºåˆ¶ç­‰ã€‚
å› æ­¤åœ¨è¿™é‡Œåšä¸ªç®€å•çš„åˆ†äº«ï¼Œç»™å¤§å®¶æä¾›ä¸€äº›å‚è€ƒã€‚</p>
<p>æœ¬æ–‡ä¸»è¦ä»æ•°æ®æµçš„è§’åº¦ï¼Œè¯´æ˜æ•´ä¸ªç³»ç»Ÿçš„è®¡ç®—å’Œå˜åŒ–è¿‡ç¨‹ï¼š</p>
<h2 data-id="heading-0">1. æ¨¡å‹è®¾ç½®é˜¶æ®µçš„æ•°æ®æµ</h2>
<p>é¦–å…ˆï¼Œéœ€è¦è·å–åˆ°æ¨¡å‹æˆ–ç»„åˆæ¨¡å‹çš„ä¸­å¿ƒç‚¹ï¼Œä»è€Œè®¾ç½®æ“ä½œçš„ä¸­å¿ƒç‚¹å¹¶ç”Ÿæˆå¯¹åº”çš„æ“ä½œè½´ã€‚</p>
<p>å¤§è‡´çš„è¿‡ç¨‹ï¼šæ¨¡å‹è®¾ç½® â†’ è®¡ç®—åŒ…å›´çƒ â†’ ç”Ÿæˆæ“ä½œè½´</p>
<pre><code class="hljs language-javascript" lang="javascript">    <span class="hljs-comment">// è·å–åŸºå‡†ç‚¹</span>
    <span class="hljs-title function_">calcSceneBS</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> boundingSpheres = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">_targetList</span>.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-keyword">const</span> model = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_targetList</span>[i];
            <span class="hljs-keyword">let</span> sphere = model.<span class="hljs-property">boundingSphere</span>;
            <span class="hljs-keyword">if</span> (model <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Model</span>) {
                sphere = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getModelBS</span>(model);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (model <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Primitive</span>) {
                <span class="hljs-keyword">const</span> translation = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>.<span class="hljs-title function_">getTranslation</span>(model.<span class="hljs-property">modelMatrix</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Cartesian3</span>);
                <span class="hljs-keyword">const</span> boundingSpheres = model.<span class="hljs-property">_boundingSpheres</span>;
                sphere = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">BoundingSphere</span>(translation, boundingSpheres.<span class="hljs-property">radius</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (model.<span class="hljs-property">point</span>) {
                sphere = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">BoundingSphere</span>(model.<span class="hljs-property">position</span>.<span class="hljs-title function_">getValue</span>(), <span class="hljs-number">10</span>);
            }

            <span class="hljs-keyword">if</span> (sphere) {
                boundingSpheres.<span class="hljs-title function_">push</span>(sphere);
            }
        }

        <span class="hljs-keyword">if</span> (boundingSpheres.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_sceneSphere</span> = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">BoundingSphere</span>.<span class="hljs-title function_">fromBoundingSpheres</span>(boundingSpheres, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">BoundingSphere</span>());
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_basePt</span> === <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">_sceneSphere</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">_sceneSphere</span>.<span class="hljs-property">center</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_basePt</span> = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Cartographic</span>.<span class="hljs-title function_">fromCartesian</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_sceneSphere</span>.<span class="hljs-property">center</span>);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_basePt</span>.<span class="hljs-property">longitude</span> = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Math</span>.<span class="hljs-title function_">toDegrees</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_basePt</span>.<span class="hljs-property">longitude</span>);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">_basePt</span>.<span class="hljs-property">latitude</span> = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Math</span>.<span class="hljs-title function_">toDegrees</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_basePt</span>.<span class="hljs-property">latitude</span>);
        }
    }
    
    <span class="hljs-comment">// åˆ›å»ºxyzè½´</span>
    <span class="hljs-title function_">_createAxis</span>(<span class="hljs-params">name, color</span>) {
        <span class="hljs-keyword">const</span> positionsCallback = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">CallbackProperty</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_isValidCartesian</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_center</span>)) <span class="hljs-keyword">return</span> [];
            <span class="hljs-keyword">const</span> axes = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getLocalAxes</span>();
            <span class="hljs-keyword">if</span> (!axes) <span class="hljs-keyword">return</span> [];
        
            <span class="hljs-comment">// è®¡ç®—è½´çš„æ–¹å‘å‘é‡</span>
            <span class="hljs-keyword">const</span> dir = name === <span class="hljs-string">'X'</span> ? axes.<span class="hljs-property">xAxis</span> : name === <span class="hljs-string">'Y'</span> ? axes.<span class="hljs-property">yAxis</span> : axes.<span class="hljs-property">zAxis</span>;
            <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_isValidCartesian</span>(dir)) <span class="hljs-keyword">return</span> [];
            
            <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Cartesian3</span>.<span class="hljs-title function_">clone</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_center</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">Cartesian3</span>());
            <span class="hljs-keyword">const</span> end = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Cartesian3</span>.<span class="hljs-title function_">add</span>(
                start,
                <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Cartesian3</span>.<span class="hljs-title function_">multiplyByScalar</span>(dir, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_axisLength</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">Cartesian3</span>()),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">Cartesian3</span>()
            );
            <span class="hljs-keyword">return</span> [start, end];
        }, <span class="hljs-literal">false</span>);

        <span class="hljs-keyword">const</span> entity = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_viewer</span>.<span class="hljs-property">entities</span>.<span class="hljs-title function_">add</span>({
            name,
            <span class="hljs-attr">polyline</span>: {
                <span class="hljs-attr">positions</span>: positionsCallback,
                <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span> === name ? <span class="hljs-number">10</span> : <span class="hljs-number">5</span>,
                <span class="hljs-attr">clampToGround</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">material</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">PolylineArrowMaterialProperty</span>(color)
            }
        });
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_axisEntities</span>.<span class="hljs-title function_">push</span>(entity);
    }
</code></pre>
<h2 data-id="heading-1">2. äº¤äº’è¿‡ç¨‹çš„æ•°æ®æµ</h2>
<p>å®Œæ•´çš„æ•°æ®æµï¼šé¼ æ ‡ç‚¹å‡» â†’ æ‹¾å–æ£€æµ‹ â†’ åæ ‡è½¬æ¢ â†’ å˜æ¢è®¡ç®— â†’ çŸ©é˜µåº”ç”¨ â†’ è§†è§‰æ›´æ–°</p>
<h3 data-id="heading-2">2.1 é¼ æ ‡æ“ä½œ</h3>
<p>æˆ‘ä»¬éœ€è¦åˆ¤æ–­æ‹¾å–çš„æ“ä½œè½´ï¼Œæ ¹æ®ä¸åŒçš„è½´ä½¿ç”¨ä¸åŒçš„æ‹¾å–æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">_onLeftDown</span>(<span class="hljs-params">event</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_isActive</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// æ‹¾å–æ“ä½œè½´</span>
        <span class="hljs-keyword">const</span> pickedObject = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_scene</span>.<span class="hljs-title function_">pick</span>(event.<span class="hljs-property">position</span>);
        <span class="hljs-keyword">if</span> (pickedObject &amp;&amp; pickedObject.<span class="hljs-property">id</span>) {
            <span class="hljs-keyword">const</span> axisName = <span class="hljs-title class_">Cesium</span>.<span class="hljs-title function_">clone</span>(pickedObject.<span class="hljs-property">id</span>.<span class="hljs-property">name</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">const</span> validAxes = [<span class="hljs-string">"X"</span>, <span class="hljs-string">"Y"</span>, <span class="hljs-string">"Z"</span>, <span class="hljs-string">"XY"</span>, <span class="hljs-string">"XZ"</span>, <span class="hljs-string">"YZ"</span>,
                <span class="hljs-string">"XY_CIRCLE"</span>, <span class="hljs-string">"XZ_CIRCLE"</span>, <span class="hljs-string">"YZ_CIRCLE"</span>,
                <span class="hljs-string">"SCALE_X"</span>, <span class="hljs-string">"SCALE_Y"</span>, <span class="hljs-string">"SCALE_Z"</span>];
            <span class="hljs-keyword">if</span> (validAxes.<span class="hljs-title function_">indexOf</span>(axisName) &gt;= <span class="hljs-number">0</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">_pickedObject</span> = pickedObject;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_highlightPickedObject</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_pickedObject</span>);

                <span class="hljs-variable language_">this</span>.<span class="hljs-property">_viewer</span>.<span class="hljs-property">scene</span>.<span class="hljs-property">screenSpaceCameraController</span>.<span class="hljs-property">enableRotate</span> = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">_viewer</span>.<span class="hljs-property">scene</span>.<span class="hljs-property">screenSpaceCameraController</span>.<span class="hljs-property">enableLook</span> = <span class="hljs-literal">false</span>;

                <span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span> = axisName;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">_isDragging</span> = <span class="hljs-literal">true</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mouseDownPos</span> = <span class="hljs-literal">undefined</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mouseDownXY</span> = event.<span class="hljs-property">position</span>;

                <span class="hljs-keyword">const</span> X = [<span class="hljs-string">"XY"</span>, <span class="hljs-string">"XY_CIRCLE"</span>, <span class="hljs-string">"X"</span>, <span class="hljs-string">"Y"</span>, <span class="hljs-string">"Z"</span>];
                <span class="hljs-keyword">const</span> Y = [<span class="hljs-string">"YZ"</span>, <span class="hljs-string">"YZ_CIRCLE"</span>];
                <span class="hljs-keyword">const</span> Z = [<span class="hljs-string">"XZ"</span>, <span class="hljs-string">"XZ_CIRCLE"</span>];

                <span class="hljs-keyword">if</span> (X.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span>) &gt; -<span class="hljs-number">1</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mouseDownPos</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pickPositionOnEllipsoid</span>(event.<span class="hljs-property">position</span>);
                    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_transType</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">"MOVE"</span>) &gt;= <span class="hljs-number">0</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calcFixedAxis</span>()
                }
                <span class="hljs-keyword">if</span> (Y.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span>) &gt; -<span class="hljs-number">1</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mouseDownPos</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pickPositionOnPlane</span>(event.<span class="hljs-property">position</span>, <span class="hljs-string">"YZ"</span>);
                    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_transType</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">"MOVE"</span>) &gt;= <span class="hljs-number">0</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calcFixedAxis</span>()
                }
                <span class="hljs-keyword">if</span> (Z.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span>) &gt; -<span class="hljs-number">1</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mouseDownPos</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pickPositionOnPlane</span>(event.<span class="hljs-property">position</span>, <span class="hljs-string">"XZ"</span>);
                    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_transType</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">"MOVE"</span>) &gt;= <span class="hljs-number">0</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calcFixedAxis</span>()
                }

                <span class="hljs-comment">// è§¦å‘ Transform äº‹ä»¶</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_raiseEvent</span>(<span class="hljs-string">"Transform"</span>, {
                    <span class="hljs-attr">position</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mouseDownPos</span>,
                    <span class="hljs-attr">cartographic</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mouseDownPos</span>,
                    <span class="hljs-attr">axis</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span>
                });
            }
        }
    }
    
    
    <span class="hljs-title function_">_onMouseMove</span>(<span class="hljs-params">event</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_isActive</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">_isDragging</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span> === <span class="hljs-string">""</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">let</span> pos = <span class="hljs-literal">undefined</span>;
        <span class="hljs-keyword">const</span> X = [<span class="hljs-string">"XY"</span>, <span class="hljs-string">"XY_CIRCLE"</span>, <span class="hljs-string">"X"</span>, <span class="hljs-string">"Y"</span>, <span class="hljs-string">"Z"</span>];
        <span class="hljs-keyword">const</span> Y = [<span class="hljs-string">"YZ"</span>, <span class="hljs-string">"YZ_CIRCLE"</span>];
        <span class="hljs-keyword">const</span> Z = [<span class="hljs-string">"XZ"</span>, <span class="hljs-string">"XZ_CIRCLE"</span>];
        <span class="hljs-keyword">if</span> (X.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span>) &gt; -<span class="hljs-number">1</span>) pos = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pickPositionOnEllipsoid</span>(event.<span class="hljs-property">endPosition</span>);
        <span class="hljs-keyword">if</span> (Y.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span>) &gt; -<span class="hljs-number">1</span>) pos = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pickPositionOnPlane</span>(event.<span class="hljs-property">endPosition</span>, <span class="hljs-string">"YZ"</span>);
        <span class="hljs-keyword">if</span> (Z.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span>) &gt; -<span class="hljs-number">1</span>) pos = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pickPositionOnPlane</span>(event.<span class="hljs-property">endPosition</span>, <span class="hljs-string">"XZ"</span>);

        <span class="hljs-comment">// è§¦å‘ Transforming äº‹ä»¶</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_raiseEvent</span>(<span class="hljs-string">"Transforming"</span>, {
                <span class="hljs-title class_">MouseDownPos</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mouseDownPos</span>,
                <span class="hljs-title class_">MouseMovePos</span>: pos,
                <span class="hljs-title class_">MouseDownXY</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mouseDownXY</span>,
                <span class="hljs-title class_">MouseMoveXY</span>: event.<span class="hljs-property">endPosition</span>,
                <span class="hljs-title class_">SelectedAxis</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">_selectedAxis</span>,
                <span class="hljs-title class_">FixedAxis</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">_fixedAxis</span>
            });
        } <span class="hljs-keyword">catch</span> (err) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error raising Transforming event:'</span>, err);
        }

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_requestRender</span>();
    }
</code></pre>
<h3 data-id="heading-3">2.2 æ‹¾å–æ“ä½œåŠåæ ‡è½¬æ¢</h3>
<pre><code class="hljs language-javascipt" lang="javascipt">    /**
     * åœ¨æ¤­çƒé¢ä¸Šæ‹¾å–ä½ç½®
     * @param {Cesium.Cartesian2} screenPosition å±å¹•ä½ç½®
     * @returns {Cesium.Cartographic} åœ°ç†åæ ‡
     */
    pickPositionOnEllipsoid(screenPosition) {
        if (!this._initSphere || !this._initSphere.center) return undefined;

        // è·å–ä¸­å¿ƒç‚¹çš„åœ°ç†åæ ‡
        const centerCartographic = Cesium.Cartographic.fromCartesian(this._initSphere.center);

        // æ ¹æ®ä¸­å¿ƒç‚¹é«˜åº¦è°ƒæ•´æ¤­çƒåŠå¾„
        const ellipsoid = Cesium.clone(Cesium.Ellipsoid.WGS84, true);
        ellipsoid.radii.x += centerCartographic.height;
        ellipsoid.radii.y += centerCartographic.height;
        ellipsoid.radii.z += centerCartographic.height;
        const adjustedEllipsoid = new Cesium.Ellipsoid(
            ellipsoid.radii.x,
            ellipsoid.radii.y,
            ellipsoid.radii.z
        );

        // æ‹¾å–ä½ç½®
        const cartesian = this._viewer.camera.pickEllipsoid(screenPosition, adjustedEllipsoid, new Cesium.Cartesian3());
        if (cartesian === undefined) return undefined;

        // è½¬æ¢ä¸ºåœ°ç†åæ ‡
        const cartographic = Cesium.Cartographic.fromCartesian(cartesian);
        return cartographic;
    }

    /**
     * åœ¨æŒ‡å®šå¹³é¢ä¸Šæ‹¾å–ä½ç½®
     * @param {Cesium.Cartesian2} screenPosition å±å¹•ä½ç½®
     * @param {String} planeType å¹³é¢ç±»å‹ ("XY"|"YZ"|"XZ")
     * @returns {Cesium.Cartographic} åœ°ç†åæ ‡
     */
    pickPositionOnPlane(screenPosition, planeType) {
        this._calcCallbackArgs();

        if (!this._initSphere || !this._initSphere.center) return undefined;
        if (!this._callbackCartographic) return undefined;

        const r = this._axisZoom * 1e-5;
        const lon = this._callbackCartographic.longitude;
        const lat = this._callbackCartographic.latitude;
        const height = this._callbackCartographic.height;

        // åˆ›å»ºä¸‰è§’å½¢ç”¨äºå¹³é¢ç›¸äº¤æµ‹è¯•
        let i, n, a;
        if (planeType === "YZ") {
            i = Cesium.Cartesian3.fromRadians(lon, lat - r, -2e3);
            n = Cesium.Cartesian3.fromRadians(lon, lat, height + this._axisZoom * 0.95 + 1e3);
            a = Cesium.Cartesian3.fromRadians(lon, lat + r, -2e3);
        } else {
            // XZ å¹³é¢
            i = Cesium.Cartesian3.fromRadians(lon - r, lat, -2e3);
            n = Cesium.Cartesian3.fromRadians(lon, lat, height + this._axisZoom * 0.95 + 1e3);
            a = Cesium.Cartesian3.fromRadians(lon + r, lat, -2e3);
        }

        const ray = this._viewer.camera.getPickRay(screenPosition);
        if (!ray) return undefined;

        // è®¡ç®—å¹³é¢æ³•å‘é‡ï¼ˆåŸºäºç»åº¦ï¼‰
        const centerCartographic = Cesium.Cartographic.fromCartesian(this._initSphere.center);
        const s = Math.cos(centerCartographic.longitude);
        const l = Math.sin(centerCartographic.longitude);
        const d = 0;
        const plane = new Cesium.Plane.fromPointNormal(
            new Cesium.Cartesian3(0, 0, 0),
            new Cesium.Cartesian3(s, l, d)
        );

        // åˆ›å»ºå°„çº¿ç»ˆç‚¹
        const rayEnd = new Cesium.Cartesian3();
        rayEnd.x = ray.origin.x + ray.direction.x * 1e6;
        rayEnd.y = ray.origin.y + ray.direction.y * 1e6;
        rayEnd.z = ray.origin.z + ray.direction.z * 1e6;

        // çº¿æ®µä¸ä¸‰è§’å½¢ç›¸äº¤æµ‹è¯•
        const intersection = Cesium.IntersectionTests.lineSegmentTriangle(
            ray.origin,
            rayEnd,
            i,
            n,
            a
        );

        if (intersection === undefined) return undefined;

        // è½¬æ¢ä¸ºåœ°ç†åæ ‡
        const cartographic = Cesium.Cartographic.fromCartesian(intersection);
        return cartographic;
    }
    
    /**
     * è®¡ç®—å›è°ƒå‚æ•°ï¼ˆç”¨äºåŠ¨æ€æ›´æ–°ï¼‰
     */
    _calcCallbackArgs() {
        if (!this._initSphere || !this._initSphere.center) return;
        this._callbackCenter = this._initSphere.center;
        this._callbackCartographic = Cesium.Cartographic.fromCartesian(this._callbackCenter);
        this._callbackLonDeg = Cesium.Math.toDegrees(this._callbackCartographic.longitude);
        this._callbackLatDeg = Cesium.Math.toDegrees(this._callbackCartographic.latitude);
        this._callbackHeight = this._callbackCartographic.height;
        this._viewer.scene.requestRender();
    }
</code></pre>
<h3 data-id="heading-4">2.3 å˜æ¢çŸ©é˜µ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">getMatrixOfTileset</span>(<span class="hljs-params">tileset, deltaLon, deltaLat, deltaHeight, heading, pitch, roll, scaleX, scaleY, scaleZ, baseLon, baseLat, baseHeight</span>) {
    <span class="hljs-keyword">let</span> baseLonRad = baseLon;
    <span class="hljs-keyword">let</span> baseLatRad = baseLat;
    <span class="hljs-keyword">let</span> baseHeightM = baseHeight;

    <span class="hljs-comment">// è®¡ç®—åŸºå‡†ä½ç½®å’Œç›®æ ‡ä½ç½®</span>
    <span class="hljs-keyword">const</span> basePos = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Cartesian3</span>.<span class="hljs-title function_">fromRadians</span>(baseLonRad, baseLatRad, baseHeightM);
    <span class="hljs-keyword">const</span> targetPos = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Cartesian3</span>.<span class="hljs-title function_">fromRadians</span>(
        baseLonRad + deltaLon,
        baseLatRad + deltaLat,
        baseHeightM + deltaHeight
    );

    <span class="hljs-comment">// è§’åº¦è½¬æ¢ä¸ºå¼§åº¦</span>
    heading = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Math</span>.<span class="hljs-title function_">toRadians</span>(heading);
    pitch = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Math</span>.<span class="hljs-title function_">toRadians</span>(pitch);
    roll = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Math</span>.<span class="hljs-title function_">toRadians</span>(roll);

    <span class="hljs-comment">// åˆ›å»ºå››å…ƒæ•°æ—‹è½¬</span>
    <span class="hljs-keyword">const</span> quaternion = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Quaternion</span>.<span class="hljs-title function_">fromHeadingPitchRoll</span>(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">HeadingPitchRoll</span>(heading, pitch, roll)
    );
    <span class="hljs-keyword">const</span> scale = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">Cartesian3</span>(scaleX, scaleY, scaleZ);
    
    <span class="hljs-comment">// åˆ›å»ºå˜æ¢çŸ©é˜µï¼ˆæ—‹è½¬ + ç¼©æ”¾ï¼‰</span>
    <span class="hljs-keyword">const</span> transform = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>.<span class="hljs-title function_">fromTranslationQuaternionRotationScale</span>(
        <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Cartesian3</span>.<span class="hljs-property">ZERO</span>,
        quaternion,
        scale
    );

    <span class="hljs-comment">// åæ ‡ç³»å˜æ¢</span>
    <span class="hljs-keyword">const</span> baseFrame = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Transforms</span>.<span class="hljs-title function_">eastNorthUpToFixedFrame</span>(basePos);
    <span class="hljs-keyword">const</span> baseFrameInv = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>.<span class="hljs-title function_">inverse</span>(baseFrame, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>);
    <span class="hljs-keyword">const</span> targetFrame = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Transforms</span>.<span class="hljs-title function_">eastNorthUpToFixedFrame</span>(targetPos);

    <span class="hljs-comment">// åˆæˆæœ€ç»ˆå˜æ¢çŸ©é˜µ</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>.<span class="hljs-title function_">multiply</span>(transform, baseFrameInv, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>.<span class="hljs-title function_">multiply</span>(targetFrame, result, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>);
}
</code></pre>
<h3 data-id="heading-5">2.4 çŸ©é˜µåº”ç”¨åˆ°æ¨¡å‹</h3>
<pre><code class="hljs language-javaScript" lang="javaScript"><span class="hljs-title function_">applyTransformToTileset</span>(<span class="hljs-params">tileset, deltaLon, deltaLat, deltaHeight, heading, pitch, roll, scaleX, scaleY, scaleZ, baseLon, baseLat, baseHeight</span>) {
    <span class="hljs-comment">// è·å–å˜æ¢çŸ©é˜µ</span>
    <span class="hljs-keyword">const</span> transformMatrix = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getMatrixOfTileset</span>(
        tileset, deltaLon, deltaLat, deltaHeight, heading, pitch, roll,
        scaleX, scaleY, scaleZ, baseLon, baseLat, baseHeight
    );
    
    <span class="hljs-keyword">if</span> (transformMatrix) {
        <span class="hljs-comment">// å°†å˜æ¢çŸ©é˜µåº”ç”¨åˆ°åˆå§‹æ¨¡å‹çŸ©é˜µ</span>
        <span class="hljs-keyword">const</span> resultMatrix = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>.<span class="hljs-title function_">multiply</span>(transformMatrix, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mouseDownMM</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>);
        tileset.<span class="hljs-property">modelMatrix</span> = resultMatrix;
    }
}
</code></pre>
<h3 data-id="heading-6">2.5 è½´æ›´æ–°</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">_getLocalAxes</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> enuMatrix = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Transforms</span>.<span class="hljs-title function_">eastNorthUpToFixedFrame</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_center</span>)

    <span class="hljs-comment">// ä»ENUçŸ©é˜µæå–åæ ‡è½´</span>
    <span class="hljs-keyword">const</span> xAxis = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>.<span class="hljs-title function_">multiplyByPointAsVector</span>(
        enuMatrix,
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">Cartesian3</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">Cartesian3</span>()
    );
    <span class="hljs-keyword">const</span> yAxis = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>.<span class="hljs-title function_">multiplyByPointAsVector</span>(
        enuMatrix,
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">Cartesian3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">Cartesian3</span>()
    );
    <span class="hljs-keyword">const</span> zAxis = <span class="hljs-title class_">Cesium</span>.<span class="hljs-property">Matrix4</span>.<span class="hljs-title function_">multiplyByPointAsVector</span>(
        enuMatrix,
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">Cartesian3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cesium</span>.<span class="hljs-title class_">Cartesian3</span>()
    );

    <span class="hljs-keyword">return</span> { xAxis, yAxis, zAxis };
}
</code></pre>
<h2 data-id="heading-7">3. ç®€å•æ€»ç»“ä¸€ä¸‹</h2>
<p>åº”è¯¥è¿˜æœ‰å…¶ä»–ä¼˜åŒ–çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚è½´å¤§å°éšè§†è·ç¼©æ”¾ä¹‹ç±»çš„ã€‚</p>
<p>æœ‰æœºä¼šæŠŠå®Œæ•´ä»£ç æ”¾å‡ºæ¥å¼€æºï¼Œäº‰å–è¾¾åˆ°å¼€ç®±å³ç”¨çš„æ•ˆæœã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çœä¸‹5ä¸‡åŸ¹è®­è´¹ï¼è¿™ä»½Pythoné‡åŒ–è‡ªå­¦è·¯çº¿ï¼Œæ¯”ä»˜è´¹è¯¾æ›´ç‹ ]]></title>    <link>https://juejin.cn/post/7577683422878498850</link>    <guid>https://juejin.cn/post/7577683422878498850</guid>    <pubDate>2025-11-30T03:01:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577683422878498850" data-draft-id="7577713754563166260" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çœä¸‹5ä¸‡åŸ¹è®­è´¹ï¼è¿™ä»½Pythoné‡åŒ–è‡ªå­¦è·¯çº¿ï¼Œæ¯”ä»˜è´¹è¯¾æ›´ç‹ "/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-30T03:01:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç§æ•™"/> <meta itemprop="url" content="https://juejin.cn/user/3394924618197325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çœä¸‹5ä¸‡åŸ¹è®­è´¹ï¼è¿™ä»½Pythoné‡åŒ–è‡ªå­¦è·¯çº¿ï¼Œæ¯”ä»˜è´¹è¯¾æ›´ç‹ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394924618197325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç§æ•™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T03:01:46.000Z" title="Sun Nov 30 2025 03:01:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä½ æ˜¯åœ¨å­¦æŠ€æœ¯ï¼Œè¿˜æ˜¯åœ¨â€œè¢«å‰²éŸ­èœâ€ï¼Ÿ</h2>
<p>å¾ˆå¤šæƒ³è½¬è¡Œåšé‡åŒ–æˆ–è€…æƒ³ç”¨Pythonææå‰¯ä¸šçš„æœ‹å‹ï¼Œä¸Šæ¥å°±çŠ¯äº†ä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼š<strong>ã€ŒæŠ¥ç­ã€ä¹°ä¹¦ã€å•ƒè¯­æ³•ã€</strong>ã€‚</p>
<p>ç»“æœå‘¢ï¼ŸèŠ±äº†å‡ ä¸ªæœˆæŠŠã€ŠPythonç¼–ç¨‹ä»å…¥é—¨åˆ°å®è·µã€‹å•ƒå®Œäº†ï¼Œåªä¼šå†™ä¸ª <code>print("Hello World")</code>ã€‚ä¸€æ—¦è®©ä½ å»å¤„ç†ä¸€ä¸ªçœŸå®çš„ 10GB è‚¡ç¥¨è¡Œæƒ…æ•°æ®ï¼Œæˆ–è€…å†™ä¸€ä¸ªæœ€ç®€å•çš„åŒå‡çº¿ç­–ç•¥ï¼Œç«‹é©¬ä¸¤çœ¼ä¸€æŠ¹é»‘ï¼ŒæŠ¥é”™æŠ¥åˆ°æ€€ç–‘äººç”Ÿã€‚</p>
<p><strong>ã€Œè¿™å°±æ˜¯å…¸å‹çš„â€œæˆ˜æœ¯å‹¤å¥‹ï¼Œæˆ˜ç•¥æ‡’æƒ°â€ã€‚ã€</strong></p>
<p>å¦‚æœä½ ä¸æ”¹å˜å­¦ä¹ è·¯å¾„ï¼Œåˆ«è¯´åšé‡åŒ–èµšé’±äº†ï¼Œä½ è¿é‡åŒ–å›æµ‹æ¡†æ¶çš„é—¨éƒ½æ‘¸ä¸åˆ°ã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œä¸å–è¯¾ï¼Œä¸è®²åºŸè¯ï¼Œç›´æ¥æŠŠ**ã€Œèƒ½è½åœ°çš„ã€çœé’±çš„ã€ç›´å‡»æ ¸å¿ƒçš„ã€**å­¦ä¹ è·¯å¾„æ‹åœ¨ä½ è„¸ä¸Šã€‚</p>
<h2 data-id="heading-1">é‡åŒ–ä¸æ˜¯â€œèƒŒå­—å…¸â€ï¼Œè€Œæ˜¯â€œå­¦åšèœâ€</h2>
<p>å¾ˆå¤šäººå­¦Pythoné‡åŒ–ï¼ŒæŠŠPythonå½“æˆè‹±è¯­å•è¯æ¥èƒŒã€‚ä»Šå¤©èƒŒåˆ—è¡¨ï¼ˆListï¼‰ï¼Œæ˜å¤©èƒŒå­—å…¸ï¼ˆDictionaryï¼‰ï¼Œåå¤©èƒŒç±»ï¼ˆClassï¼‰ã€‚</p>
<p><strong>ã€Œå¤§é”™ç‰¹é”™ã€‚ã€</strong></p>
<p>é‡åŒ–äº¤æ˜“çš„æœ¬è´¨ï¼Œæ˜¯**ã€Œæ•°æ®é©±åŠ¨çš„å†³ç­–é€»è¾‘ã€**ã€‚</p>
<ul>
<li>**æ•°æ®ï¼ˆDataï¼‰**æ˜¯é£Ÿæã€‚</li>
<li>**Pythonï¼ˆPandas/Numpyï¼‰**æ˜¯èœåˆ€ã€‚</li>
<li>**ç­–ç•¥ï¼ˆStrategyï¼‰**æ˜¯èœè°±ã€‚</li>
<li>**å›æµ‹ç³»ç»Ÿï¼ˆBacktestï¼‰**æ˜¯ç‚’é”…ã€‚</li>
</ul>
<p>ä½ ä¸éœ€è¦æŠŠèœåˆ€çš„é‡‘å±æˆåˆ†ï¼ˆåº•å±‚æºç ï¼‰ç ”ç©¶é€ï¼Œä½ åªéœ€è¦çŸ¥é“**ã€Œæ€ä¹ˆåˆ‡è‚‰æœ€å¿«ã€<strong>ï¼ˆå‘é‡åŒ–è¿ç®—ï¼‰ã€‚ ä½ ä¸éœ€è¦èƒŒè¯µæ‰€æœ‰èœè°±ï¼Œä½ åªéœ€è¦</strong>ã€Œå…ˆå­¦ä¼šç‚’è¿™ä¸€ä¸ªè¥¿çº¢æŸ¿ç‚’é¸¡è›‹ã€**ï¼ˆè·‘é€šä¸€ä¸ªç­–ç•¥ï¼‰ï¼Œç„¶åè‡ªç„¶å°±ä¼šä¸¾ä¸€åä¸‰äº†ã€‚</p>
<p><strong>ã€Œç»“è®ºï¼šä»¥â€œç­–ç•¥â€ä¸ºå¯¼å‘ï¼Œå€’é€¼â€œè¯­æ³•â€å­¦ä¹ ã€‚ã€</strong> åªè¦è¿™ä¸ªè¯­æ³•ç°åœ¨ç”¨ä¸åˆ°ï¼Œå°±åˆ«å­¦ï¼</p>
<h2 data-id="heading-2">åˆ«åšâ€œå¾ªç¯æ€ªâ€ï¼Œè¦åšâ€œå‘é‡ç‹â€</h2>
<p>é‡åŒ–é¢†åŸŸæœ€é„™è§†çš„ä¸€ç§ä»£ç ï¼Œå°±æ˜¯**ã€Œforå¾ªç¯ã€**ã€‚ å¤„ç†ä¸€å¹´çš„åˆ†é’Ÿçº§æ•°æ®ï¼ˆçº¦24ä¸‡è¡Œï¼‰ï¼Œå¦‚æœä½ ç”¨forå¾ªç¯ä¸€è¡Œè¡Œå»ç®—å‡çº¿ï¼Œæ”¶ç›˜äº†ä½ è¿˜æ²¡ç®—å®Œã€‚</p>
<p>æ¥çœ‹çœ‹**ã€Œèœé¸Ÿã€<strong>å’Œ</strong>ã€Œè€æ‰‹ã€**çš„åŒºåˆ«ã€‚</p>
<p><strong>ã€Œåœºæ™¯ã€</strong>ï¼šè®¡ç®—æŸåªè‚¡ç¥¨æ”¶ç›˜ä»·çš„ 5æ—¥ç§»åŠ¨å¹³å‡çº¿ï¼ˆMA5ï¼‰ã€‚</p>
<h3 data-id="heading-3">âŒ èœé¸Ÿå†™æ³•ï¼ˆç”±æ…¢åˆé•¿ï¼Œå…¸å‹çš„Cè¯­è¨€æ€ç»´ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span>Â pandasÂ <span class="hljs-keyword">as</span>Â pd
<span class="hljs-keyword">import</span>Â time

<span class="hljs-comment">#Â æ¨¡æ‹Ÿæ•°æ®ï¼š100ä¸‡è¡Œæ•°æ®</span>
dfÂ =Â pd.DataFrame({<span class="hljs-string">'close'</span>:Â [iÂ <span class="hljs-keyword">for</span>Â iÂ <span class="hljs-keyword">in</span>Â <span class="hljs-built_in">range</span>(<span class="hljs-number">1000000</span>)]})

start_timeÂ =Â time.time()

<span class="hljs-comment">#Â åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨å­˜ç»“æœ</span>
ma5Â =Â []
<span class="hljs-comment">#Â å…¸å‹çš„â€œå¾ªç¯æ€ªâ€å†™æ³•ï¼Œæ…¢åˆ°ä»¤äººå‘æŒ‡</span>
<span class="hljs-keyword">for</span>Â iÂ <span class="hljs-keyword">in</span>Â <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(df)):
Â Â Â Â <span class="hljs-keyword">if</span>Â iÂ &lt;Â <span class="hljs-number">4</span>:
Â Â Â Â Â Â Â Â ma5.append(<span class="hljs-literal">None</span>)Â <span class="hljs-comment">#Â å‰4å¤©ç®—ä¸å‡ºæ¥</span>
Â Â Â Â <span class="hljs-keyword">else</span>:
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ¯æ¬¡éƒ½è¦åˆ‡ç‰‡ã€æ±‚å’Œã€é™¤æ³•ï¼ŒCPUåœ¨å“­æ³£</span>
Â Â Â Â Â Â Â Â current_maÂ =Â <span class="hljs-built_in">sum</span>(df[<span class="hljs-string">'close'</span>][i-<span class="hljs-number">4</span>:i+<span class="hljs-number">1</span>])Â /Â <span class="hljs-number">5</span>
Â Â Â Â Â Â Â Â ma5.append(current_ma)

df[<span class="hljs-string">'ma5_loop'</span>]Â =Â ma5

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¾ªç¯è€—æ—¶:Â <span class="hljs-subst">{time.time()Â -Â start_time:<span class="hljs-number">.4</span>f}</span>Â ç§’"</span>)
<span class="hljs-comment">#Â åœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œè¿™è·‘äº†å¤§æ¦‚Â 15ç§’+</span>
</code></pre>
<h3 data-id="heading-4">âœ… å¤§ç¥å†™æ³•ï¼ˆPandas å‘é‡åŒ–ï¼Œä¸€è¡Œæå®šï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss">start_timeÂ =Â <span class="hljs-selector-tag">time</span><span class="hljs-selector-class">.time</span>()

#Â è¿™ä¸€è¡Œä»£ç ï¼Œåˆ©ç”¨åº•å±‚Cè¯­è¨€ä¼˜åŒ–ï¼Œæ•ˆç‡æå‡ç™¾å€
#Â <span class="hljs-built_in">rolling</span>(<span class="hljs-number">5</span>)Â æ˜¯æ»‘åŠ¨çª—å£ï¼Œ<span class="hljs-built_in">mean</span>()Â æ˜¯æ±‚å¹³å‡
df<span class="hljs-selector-attr">[<span class="hljs-string">'ma5_vector'</span>]</span>Â =Â df<span class="hljs-selector-attr">[<span class="hljs-string">'close'</span>]</span><span class="hljs-selector-class">.rolling</span>(window=<span class="hljs-number">5</span>)<span class="hljs-selector-class">.mean</span>()

<span class="hljs-built_in">print</span>(f"å‘é‡åŒ–è€—æ—¶:Â {time.time()Â -Â start_time:.<span class="hljs-number">4</span>f}Â ç§’")
#Â è€—æ—¶é€šå¸¸åœ¨Â <span class="hljs-number">0.05</span>ç§’Â å·¦å³ï¼Œå¿«äº†<span class="hljs-number">300</span>å€ï¼
</code></pre>
<p><strong>ã€Œæ ¸å¿ƒé€»è¾‘ã€</strong>ï¼šåœ¨é‡åŒ–é‡Œï¼Œèƒ½ç”¨ <code>Pandas</code> / <code>Numpy</code> å†…ç½®å‡½æ•°çš„ï¼Œ<strong>ã€Œç»å¯¹ä¸è¦è‡ªå·±å†™å¾ªç¯ã€</strong>ã€‚è¿™å°±æ˜¯ä¸“ä¸šå’Œä¸šä½™çš„åˆ†æ°´å²­ã€‚</p>
<h2 data-id="heading-5">æ–°æ‰‹æœ€å®¹æ˜“è¸©çš„3ä¸ªæ­»ç©´</h2>
<h3 data-id="heading-6">1. ç¯å¢ƒé…ç½®â€œåŠé€€â€</h3>
<p>ä¸è¦å»å®˜ç½‘ä¸‹è½½åŸç”Ÿ Pythonï¼ä¸è¦ï¼ ä½ ä¼šå‘ç°è£…ä¸ª <code>talib</code> æŠ¥é”™ï¼Œè£…ä¸ª <code>backtrader</code> æŠ¥é”™ï¼Œæœ€åè¿˜æ²¡å¼€å§‹å†™ä»£ç å°±æ”¾å¼ƒäº†ã€‚ <strong>ã€Œè§£æ³•ã€</strong>ï¼šç›´æ¥ä¸‹è½½ <strong>ã€ŒAnacondaã€</strong> æˆ–è€… <strong>ã€ŒMinicondaã€</strong>ã€‚å®ƒæŠŠç§‘å­¦è®¡ç®—åŒ…éƒ½ç»™ä½ æ‰“åŒ…å¥½äº†ï¼Œå¼€ç®±å³ç”¨ã€‚</p>
<h3 data-id="heading-7">2. æ²‰è¿·â€œé€ è½®å­â€</h3>
<p>å¾ˆå¤šæ–°æ‰‹è§‰å¾—è‡ªå·±ç‰›é€¼ï¼Œéè¦ä»é›¶å†™ä¸€ä¸ªå›æµ‹æ¡†æ¶ã€‚ç»“æœå†™äº†ä¸€å¹´ï¼ŒBugæ¯”ä»£ç è¿˜å¤šï¼Œè®¢å•æ’®åˆé€»è¾‘å…¨æ˜¯é”™çš„ã€‚ <strong>ã€Œè§£æ³•ã€</strong>ï¼šç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šã€‚å…¥é—¨ç”¨ <code>Backtrader</code>ï¼ˆç»å…¸ï¼‰ï¼Œè¿›é˜¶çœ‹ <code>Zipline</code>ï¼ˆå·¥ä¸šçº§ï¼‰æˆ– <code>VeighNa</code>ï¼ˆå®ç›˜ï¼‰ã€‚å…ˆå­¦ä¼šå¼€æ³•æ‹‰åˆ©ï¼Œå†å»ç ”ç©¶æ³•æ‹‰åˆ©æ€ä¹ˆé€ ã€‚</p>
<h3 data-id="heading-8">3. æœªæ¥å‡½æ•°ï¼ˆLook-ahead Biasï¼‰</h3>
<p>è¿™æ˜¯æœ€éšè”½çš„å‘ã€‚ä½ åœ¨ç¼–å†™ç­–ç•¥æ—¶ï¼Œæ— æ„ä¸­ç”¨åˆ°äº†â€œæ˜å¤©â€çš„æ•°æ®æ¥å†³å®šâ€œä»Šå¤©â€çš„äº¤æ˜“ã€‚ æ¯”å¦‚ï¼š<code>if close_price &gt; open_price: buy()</code>ã€‚ æ³¨æ„ï¼<code>close_price</code> æ˜¯æ”¶ç›˜æ‰çŸ¥é“çš„ï¼Œä½ åœ¨ç›˜ä¸­ï¼ˆOpençš„æ—¶å€™ï¼‰æ˜¯ä¸å¯èƒ½çŸ¥é“æ”¶ç›˜ä»·çš„ã€‚ <strong>ã€Œç»“æœã€</strong>ï¼šå›æµ‹æ”¶ç›Šç‡ 500%ï¼Œå®ç›˜äºæˆç‹—ã€‚</p>
<h2 data-id="heading-9">æ€»ç»“</h2>
<p>å­¦ä¹ Pythoné‡åŒ–ï¼Œåƒä¸‡åˆ«èµ°ç›´çº¿ã€‚</p>
<p><strong>ã€Œé€å¤§å®¶ä¸€å¼ â€œæç®€ä¸Šä½è·¯çº¿å›¾â€ï¼šã€</strong></p>
<ol>
<li><strong>ã€Œè£…å¥½ Anacondaã€</strong>ï¼ˆ1å°æ—¶ï¼‰ã€‚</li>
<li><strong>ã€ŒèŠ±3å¤©æå®š Pandasã€</strong>ï¼šé‡ç‚¹çœ‹ <code>DataFrame</code>ã€<code>Series</code>ã€<code>resample</code>ï¼ˆé‡é‡‡æ ·ï¼‰ã€<code>rolling</code>ï¼ˆæ»‘åŠ¨çª—å£ï¼‰ã€‚</li>
<li><strong>ã€Œæ‰¾ä¸€ä¸ªç°æˆçš„ç­–ç•¥ä»£ç ã€</strong>ï¼ˆæ¯”å¦‚åŒå‡çº¿ï¼‰ï¼Œè·‘é€šå®ƒï¼Œä¸ç®¡æ‡‚ä¸æ‡‚ï¼Œå…ˆè®©å®ƒè·‘èµ·æ¥ã€‚</li>
<li><strong>ã€Œä¿®æ”¹å®ƒã€</strong>ï¼šæŠŠå‚æ•° 5å¤©æ”¹æˆ 10å¤©ï¼Œçœ‹çœ‹ç»“æœå˜æ²¡å˜ï¼Ÿ</li>
<li><strong>ã€Œæ¥å…¥æ•°æ®ã€</strong>ï¼šå­¦ä¹ æ€ä¹ˆç”¨ <code>Tushare</code> æˆ– <code>Baostock</code> æ‹‰å–çœŸå®æ•°æ®ã€‚</li>
</ol>
<p><strong>ã€Œä¸€å¥è¯å£è¯€ï¼šã€</strong> <strong>ã€Œå°‘å†™å¾ªç¯å¤šç”¨åº“ï¼Œç­–ç•¥è·‘é€šæ˜¯èµ·æ­¥ã€‚å›æµ‹åƒä¸‡é˜²æœªæ¥ï¼Œå®ç›˜ä¹‹å‰çœ‹å›æ’¤ã€‚ã€</strong></p>
<hr/>
<p><em>ä½ åœ¨å­¦ä¹ é‡åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯åœ¨ç¯å¢ƒé…ç½®ä¸Šå¡æœ€ä¹…ï¼Œè¿˜æ˜¯åœ¨ç­–ç•¥é€»è¾‘ä¸Šå¡æœ€ä¹…ï¼Ÿè¯„è®ºåŒºèŠèŠï¼Œæˆ‘å¸®ä½ é¿å‘ã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Web 3Dåœ°çƒå®æ—¶ç»Ÿè®¡è®¿é—®æ¥æº]]></title>    <link>https://juejin.cn/post/7577722399375081514</link>    <guid>https://juejin.cn/post/7577722399375081514</guid>    <pubDate>2025-11-29T13:09:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577722399375081514" data-draft-id="7577660060093988918" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Web 3Dåœ°çƒå®æ—¶ç»Ÿè®¡è®¿é—®æ¥æº"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2025-11-29T13:09:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iå¬é£é€å¤œ"/> <meta itemprop="url" content="https://juejin.cn/user/588993963758215"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Web 3Dåœ°çƒå®æ—¶ç»Ÿè®¡è®¿é—®æ¥æº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993963758215/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iå¬é£é€å¤œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T13:09:43.000Z" title="Sat Nov 29 2025 13:09:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="zenburn">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#3f3f3f;color:#dcdcdc}.hljs-keyword,.hljs-selector-tag,.hljs-tag{color:#e3ceab}.hljs-template-tag{color:#dcdcdc}.hljs-number{color:#8cd0d3}.hljs-attribute,.hljs-template-variable,.hljs-variable{color:#efdcbc}.hljs-literal{color:#efefaf}.hljs-subst{color:#8f8f8f}.hljs-name,.hljs-section,.hljs-selector-class,.hljs-selector-id,.hljs-title,.hljs-type{color:#efef8f}.hljs-bullet,.hljs-link,.hljs-symbol{color:#dca3a3}.hljs-built_in,.hljs-builtin-name,.hljs-deletion,.hljs-string{color:#cc9393}.hljs-addition,.hljs-comment,.hljs-meta,.hljs-quote{color:#7f9f7f}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>è¿™ç¯‡æ–‡ç« ä»‹ç»ä¸€ä¸ªWeb 3Dåœ°çƒå®æ—¶ç»Ÿè®¡è®¿é—®æ¥æºçš„å¼€æºé¡¹ç›®ï¼Œæ•ˆæœå¦‚ä¸‹ï¼Œå½“æœåŠ¡å™¨æœ‰httpæµé‡è¿›æ¥æ—¶ï¼Œwebé€šè¿‡3Dåœ°çƒ+é£çº¿å®æ—¶ç»˜åˆ¶å®¢æˆ·ç«¯çš„æ¥æº</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8374b86eaa914a91a6c3a2511af82d5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaeWQrOmjjumAneWknA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026583&amp;x-signature=05B05mswM%2Fiat0w9vOIQjSnxjfQ%3D" alt="Peek 2025-11-29 21-03.gif" loading="lazy"/></p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhouxinlin%2Flive-origin" target="_blank" title="https://github.com/houxinlin/live-origin" ref="nofollow noopener noreferrer">github.com/houxinlin/lâ€¦</a></p>
<h2 data-id="heading-1">å®ç°åŸç†</h2>
<p>è¦åœ¨æœåŠ¡å™¨ä¸Šæ•è·httpæµé‡ï¼Œä¹Ÿå°±æ˜¯æŠ“åŒ…ï¼ŒæŠ“åŒ…æœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€æ˜¯ä½¿ç”¨ç±»ä¼¼pcapçš„åº“ä»å†…æ ¸æ•è·ç½‘ç»œæ•°æ®åŒ…ï¼Œå¦ä¸€ç§æ¯”è¾ƒå¤æ‚æ˜¯ä½¿ç”¨ebpfæ‹¦æˆªç³»ç»Ÿçš„å‡½æ•°ç‚¹ï¼Œä»¥æ£€æµ‹æµé‡ï¼Œæœ¬é¡¹ç›®æ˜¯ä½¿ç”¨pcapå®ç°ã€‚</p>
<p>è¦é€šè¿‡ä»£ç æŠŠæµé‡æŠ“ä¸‹æ¥ï¼Œå…¶å®é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå¤§æ¦‚å¦‚ä¸‹</p>
<ol>
<li><strong>æ‰“å¼€è®¾å¤‡ (Open Device)</strong> ï¼š<br/>
é¦–å…ˆå¾—å‘Šè¯‰ç¨‹åºæˆ‘ä»¬è¦ç›‘å¬å“ªä¸ªç½‘å¡ï¼ˆæ¯”å¦‚Â eth0Â è¿˜æ˜¯Â wlan0ï¼‰ã€‚è¿™é‡Œé€šå¸¸éœ€è¦å¼€å¯æ··æ‚æ¨¡å¼ ï¼Œå¦åˆ™ç½‘å¡é»˜è®¤åªä¼šæ¥æ”¶å‘ç»™å®ƒè‡ªå·±çš„åŒ…ï¼Œè€Œå¿½ç•¥å¹¿æ’­æˆ–å…¶ä»–æµé‡ã€‚</li>
<li><strong>è®¾ç½®è¿‡æ»¤å™¨ (Set BPF Filter)</strong> ï¼š<br/>
è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼ŒæœåŠ¡å™¨ä¸Šçš„æµé‡å¤ªæ‚äº†ï¼ŒSSHã€æ•°æ®åº“ã€ç­‰æ•°æ®åŒ…ã€‚æˆ‘ä»¬åªæƒ³çœ‹ HTTP æµé‡ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸ªè¿‡æ»¤è§„åˆ™ï¼Œæ¯”å¦‚Â tcp port 80 or tcp port 443ã€‚è¿™ç”¨çš„å°±æ˜¯ BPF (Berkeley Packet Filter) è¯­æ³•ï¼Œæ•ˆç‡æé«˜ï¼Œç›´æ¥åœ¨å†…æ ¸å±‚å°±æŠŠä¸ç›¸å…³çš„åŒ…æ‰”æ‰äº†ã€‚</li>
<li><strong>å¾ªç¯æŠ“åŒ… (Loop)</strong> ï¼š<br/>
å‰ä¸¤æ­¥é…ç½®å¥½åï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªæ­»å¾ªç¯é‡Œä¸æ–­åœ°ä»å¥æŸ„ä¸­è¯»å–æ•°æ®åŒ…ï¼ˆPacketï¼‰ã€‚</li>
</ol>
<p>ä¼ªä»£ç å¤§æ¦‚é•¿è¿™æ ·ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 1. æ‰“å¼€ç½‘å¡ eth0ï¼Œ65535æ˜¯æœ€å¤§æ•è·é•¿åº¦ï¼Œ1æ˜¯å¼€å¯æ··æ‚æ¨¡å¼</span>
handle = pcap_open_live(<span class="hljs-string">"eth0"</span>, <span class="hljs-number">65535</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>, errbuf);

<span class="hljs-comment">// 2. ç¼–è¯‘å¹¶è®¾ç½®è¿‡æ»¤è§„åˆ™</span>
pcap_compile(handle, &amp;fp, <span class="hljs-string">"tcp port 80"</span>, <span class="hljs-number">0</span>, net);
pcap_setfilter(handle, &amp;fp);

<span class="hljs-comment">// 3. æ¯æŠ“åˆ°ä¸€ä¸ªåŒ…å°±å›è°ƒ process_packet å‡½æ•°</span>
pcap_loop(handle, <span class="hljs-number">-1</span>, process_packet, <span class="hljs-literal">NULL</span>);
</code></pre>
<p>pcap_loopÂ æ•è·åˆ°æ•°æ®æ—¶ï¼Œæ‹¿åˆ°æ‰‹çš„æ˜¯ä¸€å †åŸå§‹çš„äºŒè¿›åˆ¶å­—èŠ‚ï¼Œæˆªè·åˆ°çš„æ•°æ®åŒ…ï¼Œéœ€è¦è§£æå‡ºä»¥å¤ªç½‘å¸§å¤´ï¼Œä»¥å¤ªå¤´ç”± 14 å­—èŠ‚å›ºå®šé•¿åº¦æ„æˆï¼Œç”¨äºæŒ‡æ˜ç›®æ ‡ä¸æº MAC åœ°å€ï¼Œä»¥åŠæ•°æ®ä½¿ç”¨çš„ä¸Šå±‚åè®®ç±»å‹ï¼Œå¦‚ä¸‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c895c55142f4503ba4d7cc5f5b24b7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaeWQrOmjjumAneWknA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026583&amp;x-signature=D0n7yR29NNBOtQzbTyiG3i5VQbM%3D" alt="image.png" loading="lazy"/></p>
<p>å…¶ä¸­æ•°æ®ç±»å‹è¡¨ç¤ºä»¥å¤ªç½‘å¸§ä¸­è½½è·ï¼ˆPayloadï¼‰æ˜¯ä»€ä¹ˆåè®®çš„æ•°æ®ã€‚</p>

























<table><thead><tr><th>åè®®ç±»å‹</th><th>åå…­è¿›åˆ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>IPv4</td><td>0x0800</td><td>è¡¨ç¤ºæ•°æ®éƒ¨åˆ†æ˜¯ IPv4 æ•°æ®åŒ…</td></tr><tr><td>ARP</td><td>0x0806</td><td>åœ°å€è§£æåè®®</td></tr><tr><td>IPv6</td><td>0x86DD</td><td>IPv6 æ•°æ®åŒ…</td></tr></tbody></table>
<p>åœ¨é¡¹ç›®ä¸­ï¼Œè§£ææ—¶ç›´æ¥è·³è¿‡14å­—èŠ‚å»è§£æipæŠ¥æ–‡å³å¯ï¼Œå› ä¸ºç”¨ä¸åˆ°ä»¥å¤ªæ•°æ®ï¼Œè§£æåˆ°ipå¤´åå°±å¯ä»¥è·å–å®¢æˆ·ç«¯çš„åœ°å€äº†ï¼Œipå¤´æ ¼å¼å¦‚ä¸‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f866a22fde304f5b92cca95409feb252~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaeWQrOmjjumAneWknA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765026583&amp;x-signature=76VWxj1BHXFdKwQ69aOUQ5tuuFc%3D" alt="image.png" loading="lazy"/></p>
<p>è·å–ipåŒ…ä¿¡æ¯ä»£ç å¦‚ä¸‹</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(u_char *d, <span class="hljs-keyword">struct</span> pcap_pkthdr *h, u_char *p)</span> {
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ip</span> *<span class="hljs-title">ip4_pkt</span> =</span> (<span class="hljs-keyword">struct</span> ip *) (p + link_offset);
    <span class="hljs-type">uint32_t</span> ip_hl = ip4_pkt-&gt;ip_hl * <span class="hljs-number">4</span>;
    <span class="hljs-type">uint8_t</span> ip_proto = ip4_pkt-&gt;ip_p;
    <span class="hljs-type">char</span> ip_src[INET_ADDRSTRLEN];
    <span class="hljs-type">char</span> ip_dst[INET_ADDRSTRLEN];
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *data;
    <span class="hljs-type">uint32_t</span> len = h-&gt;caplen;

    inet_ntop(AF_INET, (<span class="hljs-type">const</span> <span class="hljs-type">void</span> *) &amp;ip4_pkt-&gt;ip_src, ip_src, <span class="hljs-keyword">sizeof</span>(ip_src));
    inet_ntop(AF_INET, (<span class="hljs-type">const</span> <span class="hljs-type">void</span> *) &amp;ip4_pkt-&gt;ip_dst, ip_dst, <span class="hljs-keyword">sizeof</span>(ip_dst));
 }
</code></pre>
<p>æ¥ä¸‹æ¥æ‹¿åˆ°å®¢æˆ·ç«¯çš„ipåï¼Œè§£æå‡ºipçš„ç»çº¬åº¦é€šè¿‡websocketå‘é€åˆ°å‰ç«¯å³å¯ï¼Œç»çº¬åº¦æœ‰ä¸¤ç§åŠæ³•å¯ä»¥è·å–ã€‚</p>
<ol>
<li>
<p>ä½¿ç”¨maxminddb</p>
<p>ä»–æ˜¯ä¸€ç§ç¦»çº¿çš„ç»çº¬åº¦æŸ¥è¯¢ç³»ç»Ÿï¼Œä½†æ˜¯æµ‹è¯•åä¸å¤ªå‡†ç¡®ï¼Œä¼˜ç‚¹æ˜¯é€Ÿåº¦æå¿«ã€‚</p>
</li>
<li>
<p>åœ¨çº¿æœåŠ¡</p>
<p>å¯»æ‰¾å¤§é‡çš„åœ¨çº¿ipè½¬ç»çº¬åº¦æœåŠ¡ï¼Œæ‰¾åˆ°ä»–çš„apiæ¥å£ï¼Œåœ¨ç¨‹åºä¸­ä½¿ç”¨è´Ÿè½½å‡è¡¡ï¼ˆå› ä¸ºå…è´¹æœåŠ¡éƒ½è¦åˆ†é’Ÿå†…æ¬¡æ•°é™åˆ¶ï¼‰</p>
</li>
</ol>
<p>ä½†æ˜¯ï¼Œç›®å‰å¹¿æ³›çš„åšæ³•æ˜¯nginxåšwebç›‘å¬ï¼Œä½¿ç”¨https 443ç«¯å£ï¼Œè™½ç„¶æŠ“åŒ…è·å–ipæ¥æºæ²¡é—®é¢˜ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬æƒ³é€šè¿‡httpè¯·æ±‚å¤´ä¸­çš„å­—æ®µè·å–ipï¼Œæ¯”å¦‚çœŸå®çš„ç”¨æˆ·IPå¾€å¾€è—åœ¨HTTPè¯·æ±‚å¤´çš„Â X-Forwarded-ForÂ æˆ–è€…Â X-Real-IPÂ ç±»ä¼¼çš„å­—æ®µé‡Œï¼Œè¿™å°±éœ€è¦è§£ætcpæ•°æ®åŒ…ï¼Œä»tcpçš„Payloadä¸­è§£æå‡ºhttpè¯·æ±‚å¤´ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-c" lang="c">GET /api/v1/stats HTTP/<span class="hljs-number">1.1</span>
Host: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
User-Agent: Mozilla/<span class="hljs-number">5.0</span>...
X-Forwarded-For: <span class="hljs-number">203.0</span><span class="hljs-number">.113</span><span class="hljs-number">.195</span>
...
</code></pre>
<p>é¡¹ç›®ç›´æ¥è°ƒç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnodejs%2Fhttp-parser" target="_blank" title="https://github.com/nodejs/http-parser" ref="nofollow noopener noreferrer">github.com/nodejs/httpâ€¦</a> è¿™ä¸ªåº“å»è§£æhttpå¤´ï¼Œä»–æ˜¯è¢«å¹¿æ³›éªŒè¯çš„é«˜æ€§èƒ½ C è§£æåº“ï¼ˆè¿™ä¹Ÿæ˜¯ Node.js æ—©æœŸåº•å±‚ä½¿ç”¨çš„è§£æå™¨ï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è‹¥ä¾å·¥ä½œæµ-åŒ…å«ç½‘å…³]]></title>    <link>https://juejin.cn/post/7577681092138188835</link>    <guid>https://juejin.cn/post/7577681092138188835</guid>    <pubDate>2025-11-30T01:24:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577681092138188835" data-draft-id="7577683422878335010" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è‹¥ä¾å·¥ä½œæµ-åŒ…å«ç½‘å…³"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-30T01:24:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç æ¬¡ä½é¢"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è‹¥ä¾å·¥ä½œæµ-åŒ…å«ç½‘å…³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç æ¬¡ä½é¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T01:24:13.000Z" title="Sun Nov 30 2025 01:24:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">æ¦‚å¿µ</h3>
<p>åŒ…å«ç½‘å…³æ˜¯ä¸€ç§å·¥ä½œæµä¸­çš„è·¯ç”±èŠ‚ç‚¹ï¼Œå®ƒèƒ½å¤Ÿ<strong>åŒæ—¶æ¿€æ´»æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è·¯å¾„</strong>ï¼Œå¹¶åœ¨æ±‡èšç‚¹ç­‰å¾…æ‰€æœ‰è¢«æ¿€æ´»çš„è·¯å¾„æ‰§è¡Œå®Œæˆåï¼Œæ‰ç»§ç»­å‘ä¸‹æµè½¬ã€‚<br/>
ä»¥ä¸‹æ¡ˆä¾‹åœ¨çº¿ä½“éªŒï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com" target="_blank" title="https://www.ruoyiflow.com" ref="nofollow noopener noreferrer">ruoyiflow</a></p>
<h3 data-id="heading-1">éœ€æ±‚æè¿°</h3>
<p>å…¬å¸å…¨ä½“å‘˜å·¥éƒ½éœ€è¦è¿›è¡Œâ€œå¸¸è§„é¡¹æ£€æŸ¥â€å’Œâ€œæŠ½è¡€åŒ–éªŒâ€ï¼Œè€Œç®¡ç†å±‚é¢†å¯¼é¢å¤–éœ€è¦è¿›è¡Œâ€œé™„åŠ é¡¹æ£€æŸ¥â€ã€‚</p>
<h3 data-id="heading-2">æµç¨‹è®¾è®¡</h3>
<p>1.ç”¨å°æ‰³æ‰‹å°†ç½‘å…³ç±»å‹è®¾ç½®ä¸ºåŒ…å«ç½‘å…³</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7d8e78423ef42f098526b9c49edd20e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765070653&amp;x-signature=ixtTtaM2IyOfZyF%2Fr88NtryxPJQ%3D" alt="x1" loading="lazy"/>
2.åˆ†åˆ«è®¾è®¡ä¸‰æ¡æµå‡ºè·¯å¾„ï¼Œå…¶ä¸­ä¸¤æ¡æ˜¯é»˜è®¤è·¯çº¿ï¼Œå³å¸¸è§„æ£€æŸ¥å’ŒæŠ½è¡€åŒ–éªŒï¼Œ ä¸€æ¡æ˜¯é¢†å¯¼ä¸“å±çš„é™„åŠ æ£€æŸ¥
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a78ce90584f4b45b630ef4da5cd2628~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765070653&amp;x-signature=n6F5bg0XP3CiALv8Ns8P8cEx1qw%3D" alt="x2" loading="lazy"/>
3.è®¾ç½®æœåŠ¡ä»»åŠ¡çš„å±æ€§ï¼Œ è¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸ºä¸€ä¸ªæµ‹è¯•çš„æ–¹æ³•
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a78ce90584f4b45b630ef4da5cd2628~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765070653&amp;x-signature=n6F5bg0XP3CiALv8Ns8P8cEx1qw%3D" alt="x2" loading="lazy"/>
4.æµç¨‹å®é™…è¿è¡Œçš„ç»“æœ
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/332d93ccee8244dfb7ad12e2f848b5c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765070653&amp;x-signature=aGkLoa1PoLj83OewOPj3Pvhzh2Y%3D" alt="x2" loading="lazy"/></p>
<h3 data-id="heading-3">bpmnæ–‡ä»¶</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bpmn:definitions</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hljs-attr">xmlns:bpmn</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span> <span class="hljs-attr">xmlns:bpmndi</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/DI"</span> <span class="hljs-attr">xmlns:dc</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DC"</span> <span class="hljs-attr">xmlns:camunda</span>=<span class="hljs-string">"http://camunda.org/schema/1.0/bpmn"</span> <span class="hljs-attr">xmlns:di</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DI"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Definitions_1"</span> <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"http://bpmn.io/schema/bpmn"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Process_9988"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ä½“æ£€æµç¨‹"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_0pygc7d"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_06uhglv<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:startEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_06uhglv"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Event_0pygc7d"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_1oi7a6w"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_1oi7a6w"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ä½“æ£€æµç¨‹"</span> <span class="hljs-attr">camunda:assignee</span>=<span class="hljs-string">"${startUser}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formData</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userType"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"å‘˜å·¥ç±»å‹"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"long"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">camunda:formData</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_06uhglv<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1cfkc1x<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:userTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1cfkc1x"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_1oi7a6w"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Gateway_082pcsr"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:inclusiveGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Gateway_082pcsr"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1cfkc1x<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_12o75yq<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_17y2qrg<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0whi5cb<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:inclusiveGateway</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_12o75yq"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Gateway_082pcsr"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0tg7rc8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0tg7rc8"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"å¸¸è§„é¡¹æ£€æŸ¥"</span> <span class="hljs-attr">camunda:delegateExpression</span>=<span class="hljs-string">"${includeApproveTask}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_12o75yq<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1gpmmkv<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:serviceTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1gpmmkv"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0tg7rc8"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Gateway_1vlogqd"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:inclusiveGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Gateway_1vlogqd"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1gpmmkv<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_06kg33d<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_12i1kyq<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0s2cs7t<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:inclusiveGateway</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_0klslb1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0s2cs7t<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:endEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0s2cs7t"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Gateway_1vlogqd"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Event_0klslb1"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_17y2qrg"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"é¢†å¯¼ä¸“å±"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Gateway_082pcsr"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0z4j3c2"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:conditionExpression</span> <span class="hljs-attr">xsi:type</span>=<span class="hljs-string">"bpmn:tFormalExpression"</span>&gt;</span>${userType==2}<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:conditionExpression</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:sequenceFlow</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0z4j3c2"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"é™„åŠ æ£€æŸ¥"</span> <span class="hljs-attr">camunda:delegateExpression</span>=<span class="hljs-string">"${includeApproveTask}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_17y2qrg<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_06kg33d<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:serviceTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_06kg33d"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0z4j3c2"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Gateway_1vlogqd"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0whi5cb"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Gateway_082pcsr"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_1udv0ib"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_12i1kyq"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_1udv0ib"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Gateway_1vlogqd"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_1udv0ib"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"æŠ½è¡€åŒ–éªŒ"</span> <span class="hljs-attr">camunda:delegateExpression</span>=<span class="hljs-string">"${includeApproveTask}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0whi5cb<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_12i1kyq<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:serviceTask</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:process</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNDiagram</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"BPMNDiagram_1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNPlane</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"BPMNPlane_1"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Process_9988"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNShape</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_0pygc7d_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Event_0pygc7d"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dc:Bounds</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"272"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"232"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"36"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"36"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNShape</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNShape</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0dmv1pk_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Activity_1oi7a6w"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dc:Bounds</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"360"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"210"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"80"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNShape</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNShape</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Gateway_1f5mkme_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Gateway_082pcsr"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dc:Bounds</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"515"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"225"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"50"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNShape</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNShape</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_1xhstnt_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Activity_0tg7rc8"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dc:Bounds</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"660"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"70"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"80"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNLabel</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNShape</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNShape</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Gateway_18xqnd7_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Gateway_1vlogqd"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dc:Bounds</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"845"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"225"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"50"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNShape</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNShape</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_0klslb1_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Event_0klslb1"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dc:Bounds</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"962"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"232"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"36"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"36"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNShape</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNShape</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0mi86gy_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Activity_0z4j3c2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dc:Bounds</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"660"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"340"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"80"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNLabel</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNShape</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNShape</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_14rh5fv_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Activity_1udv0ib"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dc:Bounds</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"660"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"210"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"80"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNLabel</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNShape</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNEdge</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_06uhglv_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Flow_06uhglv"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"308"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"250"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"360"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"250"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNEdge</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNEdge</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1cfkc1x_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Flow_1cfkc1x"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"460"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"250"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"515"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"250"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNEdge</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNEdge</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_12o75yq_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Flow_12o75yq"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"540"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"225"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"540"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"110"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"660"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"110"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNLabel</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">dc:Bounds</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"558"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"180"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"44"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"14"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNLabel</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNEdge</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNEdge</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1gpmmkv_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Flow_1gpmmkv"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"760"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"110"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"870"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"110"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"870"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"225"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNEdge</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNEdge</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0s2cs7t_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Flow_0s2cs7t"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"895"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"250"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"962"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"250"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNEdge</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNEdge</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_17y2qrg_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Flow_17y2qrg"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"540"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"275"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"540"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"380"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"660"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"380"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNLabel</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">dc:Bounds</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"571"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"353"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"44"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"14"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNLabel</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNEdge</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNEdge</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_06kg33d_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Flow_06kg33d"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"760"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"380"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"870"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"380"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"870"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"275"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNEdge</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNEdge</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0whi5cb_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Flow_0whi5cb"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"565"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"250"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"660"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"250"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNEdge</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmndi:BPMNEdge</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_12i1kyq_di"</span> <span class="hljs-attr">bpmnElement</span>=<span class="hljs-string">"Flow_12i1kyq"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"760"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"250"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">di:waypoint</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"845"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"250"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNEdge</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNPlane</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">bpmndi:BPMNDiagram</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:definitions</span>&gt;</span>

</code></pre>
<p>åœ¨çº¿ä½“éªŒï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com" target="_blank" title="https://www.ruoyiflow.com" ref="nofollow noopener noreferrer">ruoyiflow</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ•°æ®-169 Elasticsearch å…¥é—¨åˆ°å¯ç”¨ï¼šç´¢å¼•/æ–‡æ¡£ CRUD ä¸æœç´¢æœ€å°ç¤ºä¾‹]]></title>    <link>https://juejin.cn/post/7577691061033484334</link>    <guid>https://juejin.cn/post/7577691061033484334</guid>    <pubDate>2025-11-30T01:57:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577691061033484334" data-draft-id="7577705544875212838" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ•°æ®-169 Elasticsearch å…¥é—¨åˆ°å¯ç”¨ï¼šç´¢å¼•/æ–‡æ¡£ CRUD ä¸æœç´¢æœ€å°ç¤ºä¾‹"/> <meta itemprop="keywords" content="å¤§æ•°æ®,åç«¯,Elasticsearch"/> <meta itemprop="datePublished" content="2025-11-30T01:57:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­¦å­åº·"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ•°æ®-169 Elasticsearch å…¥é—¨åˆ°å¯ç”¨ï¼šç´¢å¼•/æ–‡æ¡£ CRUD ä¸æœç´¢æœ€å°ç¤ºä¾‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­¦å­åº·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T01:57:51.000Z" title="Sun Nov 30 2025 01:57:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>åœºæ™¯ï¼šæœ¬åœ°/äº‘ä¸»æœºå¿«é€Ÿè·‘é€š Elasticsearch çš„ç´¢å¼•åˆ›å»ºã€æ’å…¥ã€æŸ¥è¯¢ã€æ›´æ–°ã€æœç´¢ã€‚</li>
<li>ç»“è®ºï¼šæŒ‰ REST è§„èŒƒä¸æ­£ç¡®ç«¯ç‚¹å³å¯ç¨³å®šè¿”å›ï¼›æ³¨æ„ç‰ˆæœ¬å·®å¼‚ä¸å®‰å…¨é»˜è®¤é¡¹ï¼ˆ8.xï¼‰ã€‚</li>
<li>äº§å‡ºï¼šä¸€å¥—å¯å¤åˆ¶çš„æœ€å°å¯ç”¨æµç¨‹  å¸¸è§é”™è¯¯é€ŸæŸ¥å¡ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/315065b1288c4b3e99bb878a162d76cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765072670&amp;x-signature=UHSPRS9Ef1W0TpcN1hT3VwlXn0Q%3D" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e7624462d174c5ba18419cdcbe23498~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765072670&amp;x-signature=%2B50Z7H4oAdWJ4crf3BGcxbLhtGo%3D" alt="Elasticsearch" loading="lazy"/></p>
<h2 data-id="heading-1">ESç®€å•ä½¿ç”¨</h2>
<h3 data-id="heading-2">åˆ›å»ºç´¢å¼•</h3>
<p>åˆ›å»º wzk_blog01 ç´¢å¼•</p>
<pre><code class="hljs language-shell" lang="shell">http://h121.wzk.icu:9200/wzk_blog01/?pertty
</code></pre>
<p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">{
  "acknowledged": true,
  "shards_acknowledged": true,
  "index": "wzk_blog01"
}
</code></pre>
<p>å¯¹åº”çš„æˆªå›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc745cea89244b6b8cc628d88ce207f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765072670&amp;x-signature=vvxBvkvt67Os4OxhfqfbN%2BWKyZQ%3D" alt="åˆ›å»ºç´¢å¼•" loading="lazy"/></p>
<h3 data-id="heading-3">æ’å…¥æ–‡æ¡£</h3>
<pre><code class="hljs language-shell" lang="shell">http://h121.wzk.icu:9200/wzk_blog01/_doc/1?pretty
{"id": "1", "title": "What is lucene"}

https://h121.wzk.icu:9200/wzk_blog01/_doc/1?pretty
{"id": "1", "title": "What is wzk icu"}

https://h121.wzk.icu:9200/wzk_blog01/_doc/1?pretty 
{"id": "1", "title": "Apache Spark is a unified analytics engine for large-scale data processing"}
</code></pre>
<p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">{
    "_index": "wzk_blog01",
    "_id": "1",
    "_version": 1,
    "result": "created",
    "_shards": {
        "total": 2,
        "successful": 1,
        "failed": 0
    },
    "_seq_no": 0,
    "_primary_term": 1
}
</code></pre>
<h3 data-id="heading-4">æŸ¥è¯¢æ–‡æ¡£</h3>
<pre><code class="hljs language-shell" lang="shell">http://h121.wzk.icu:9200/wzk_blog01/_doc/_search/1?pretty
</code></pre>
<p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"wzk_blog01"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_seq_no"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_primary_term"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"found"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_source"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Apache Spark is a unified analytics engine for large-scale data processing"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¯¹åº”æˆªå›¾å¦‚ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af262bdd20a443b69090ce8a22cbd705~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765072670&amp;x-signature=8D%2FIlXg%2BCI8VsDlZkGm958xJ%2FvI%3D" alt="æ’å…¥æ•°æ®" loading="lazy"/></p>
<h3 data-id="heading-5">æ›´æ–°æ–‡æ¡£</h3>
<pre><code class="hljs language-shell" lang="shell">http://h121.wzk.icu:9200/wzk_blog01/_doc/1?pretty
{"id": "1", "title": " What is elasticsearch"}
</code></pre>
<p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"wzk_blog01"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"updated"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_shards"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"successful"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"failed"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_seq_no"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_primary_term"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¯¹åº”æˆªå›¾å¦‚ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa1062f27ef1464485c6c2abd82b536d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765072670&amp;x-signature=Y0g2qhdvyIXDwDN%2BDqRARvDrgJE%3D" alt="æ›´æ–°æ–‡æ¡£" loading="lazy"/></p>
<h3 data-id="heading-6">æœç´¢æ–‡æ¡£</h3>
<pre><code class="hljs language-shell" lang="shell">http://h121.wzk.icu:9200/wzk_blog01/_doc/_search?pretty
</code></pre>
<p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"match"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"What"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¯¹åº”æˆªå›¾å¦‚ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7d140ab854c461cb88ef2d0b072b2aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765072670&amp;x-signature=f50r8%2FywGAxbvC1HgwceNfn%2BJyM%3D" alt="æœç´¢æ–‡æ¡£" loading="lazy"/></p>
<h2 data-id="heading-7">æ¶æ„ä¸æ¦‚å¿µ</h2>
<h3 data-id="heading-8">åŸºæœ¬ç®€ä»‹</h3>
<p>Elasticsearchæ˜¯ä¸€ä¸ªé¢å‘æ–‡æ¡£ï¼ˆdocument orientedï¼‰çš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œè¿™æ„å‘³ç€å®ƒèƒ½å¤Ÿä»¥æ–‡æ¡£ä¸ºå•ä½å­˜å‚¨å’Œç®¡ç†æ•°æ®ã€‚ä¸ä¼ ç»Ÿçš„è¡Œå¼å­˜å‚¨ä¸åŒï¼ŒElasticsearchå°†æ¯ä¸ªæ•°æ®å®ä½“ä½œä¸ºä¸€ä¸ªå®Œæ•´çš„JSONæ–‡æ¡£è¿›è¡Œå¤„ç†å’Œå­˜å‚¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå•†å“ä¿¡æ¯å¯ä»¥ä½œä¸ºä¸€ä¸ªåŒ…å«åç§°ã€ä»·æ ¼ã€æè¿°ç­‰å­—æ®µçš„å®Œæ•´æ–‡æ¡£å­˜å‚¨ã€‚</p>
<p>Elasticsearchçš„å¼ºå¤§ä¹‹å¤„ä¸ä»…åœ¨äºå­˜å‚¨æ–‡æ¡£ï¼Œæ›´åœ¨äºå®ƒèƒ½å¯¹æ–‡æ¡£å†…å®¹å»ºç«‹é«˜æ•ˆç´¢å¼•ï¼ˆIndexï¼‰ã€‚å®ƒä¼šè‡ªåŠ¨åˆ†ææ–‡æ¡£ä¸­çš„æ¯ä¸ªå­—æ®µï¼Œå»ºç«‹å€’æ’ç´¢å¼•ç­‰æ•°æ®ç»“æ„ï¼Œå®ç°è¿‘ä¹å®æ—¶çš„æœç´¢èƒ½åŠ›ã€‚æ¯”å¦‚ï¼Œå½“ç”¨æˆ·æœç´¢"æ™ºèƒ½æ‰‹æœº"æ—¶ï¼ŒElasticsearchå¯ä»¥å¿«é€Ÿè¿”å›æ‰€æœ‰åŒ…å«è¯¥å…³é”®è¯çš„å•†å“æ–‡æ¡£ã€‚</p>
<p>ä¸å…³ç³»å‹æ•°æ®åº“ç›¸æ¯”ï¼ŒElasticsearchæœ‰è®¸å¤šç›¸ä¼¼æ¦‚å¿µï¼š</p>
<ul>
<li>ç´¢å¼•ï¼ˆIndexï¼‰ç›¸å½“äºMySQLä¸­çš„æ•°æ®åº“</li>
<li>ç±»å‹ï¼ˆTypeï¼Œ7.xç‰ˆæœ¬åå·²ç§»é™¤ï¼‰ç±»ä¼¼MySQLçš„è¡¨</li>
<li>æ–‡æ¡£ï¼ˆDocumentï¼‰å¯¹åº”MySQLä¸­çš„è¡Œè®°å½•</li>
<li>å­—æ®µï¼ˆFieldï¼‰åˆ™å¯¹åº”MySQLä¸­çš„åˆ—</li>
</ul>
<p>ä¾‹å¦‚ï¼Œåœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼š</p>
<ul>
<li>å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º"products"çš„ç´¢å¼•</li>
<li>æ¯ä¸ªå•†å“ä½œä¸ºä¸€ä¸ªæ–‡æ¡£å­˜å‚¨</li>
<li>æ–‡æ¡£åŒ…å«titleã€priceã€categoryç­‰å­—æ®µ</li>
</ul>
<p>ElasticsearchåŸºäºApache Luceneæ„å»ºï¼Œç»§æ‰¿äº†å…¶å¼ºå¤§çš„å…¨æ–‡æ£€ç´¢èƒ½åŠ›ï¼ŒåŒæ—¶é€šè¿‡åˆ†å¸ƒå¼æ¶æ„è§£å†³äº†Luceneçš„å•æœºé™åˆ¶ã€‚å®ƒæ”¯æŒå¤æ‚çš„æŸ¥è¯¢åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>ç²¾ç¡®åŒ¹é…æŸ¥è¯¢</li>
<li>èŒƒå›´æŸ¥è¯¢</li>
<li>æ¨¡ç³Šæœç´¢</li>
<li>èšåˆåˆ†æ</li>
<li>åœ°ç†ä½ç½®æŸ¥è¯¢ç­‰</li>
</ol>
<p>è¿™ä½¿å¾—Elasticsearchä¸ä»…é€‚ç”¨äºä¼ ç»Ÿçš„æœç´¢åœºæ™¯ï¼Œä¹Ÿèƒ½å¾ˆå¥½åœ°æ”¯æŒæ—¥å¿—åˆ†æã€å•†ä¸šæ™ºèƒ½ç­‰åº”ç”¨åœºæ™¯ã€‚</p>
<ul>
<li>ç´¢å¼•ï¼ˆIndexï¼‰ï¼šç±»ä¼¼çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªç´¢å¼•ï¼Œéç±»ä¼¼çš„æ•°æ®æ”¾ä¸åŒç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•ä¹Ÿå¯ä»¥ç†è§£æˆä¸€ä¸ªå…³ç³»å‹æ•°æ®</li>
<li>ç±»å‹ï¼ˆtypeï¼‰ï¼šä»£è¡¨documentå±äºindexä¸­çš„å“ªä¸ªç±»åˆ«ï¼ˆtypeï¼‰ä¹Ÿæœ‰ä¸€ç§è¯´æ³•ä¸€ç§typeå°±åƒæ˜¯æ•°æ®åº“çš„è¡¨ï¼Œæ¯”å¦‚deptè¡¨ï¼Œuserè¡¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒESæ¯ä¸ªå¤§ç‰ˆæœ¬ä¹‹é—´å·®åˆ«å¾ˆå¤§ã€‚</li>
<li>æ˜ å°„ï¼ˆmappingï¼‰ï¼šmappingå®šä¹‰äº†æ¯ä¸ªå­—æ®µçš„ç±»å‹ç­‰ä¿¡æ¯ï¼Œç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ç»“æ„ï¼Œå¸¸è§çš„æ•°æ®ç±»å‹ textã€keywordã€numberã€arrayã€rangeã€booleanã€dateã€geo_pointã€ip ç­‰ç­‰ç±»å‹</li>
</ul>
<p>Elasticsearchå¯¹æ¯”ä¼ ç»Ÿå…³ç³»è¡Œæ•°æ®åº“å¦‚ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3721639085aa4388ad84400aca82b6f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765072670&amp;x-signature=TPoV%2F1snBOJPU9tnrGm%2BjK9woC8%3D" alt="å¯¹æ¯”ä¼ ç»Ÿæ•°æ®åº“å’ŒES" loading="lazy"/></p>
<h3 data-id="heading-9">æ ¸å¿ƒæ¦‚å¿µ</h3>
<h4 data-id="heading-10">ç´¢å¼•Index</h4>
<p>ä¸€ä¸ªç´¢å¼•å°±æ˜¯ä¸€ä¸ªæ‹¥æœ‰å‡ åˆ†ç›¸ä¼¼ç‰¹å¾çš„æ–‡æ¡£çš„é›†åˆï¼Œæ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥æœ‰ä¸€ä¸ªå®¢æˆ·æ•°æ®çš„ç´¢å¼•ï¼Œå¦ä¸€ä¸ªäº§å“ç›®å½•çš„ç´¢å¼•ï¼Œè¿˜æœ‰ä¸€ä¸ªè®¢å•æ•°æ®çš„ç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•ç”±ä¸€ä¸ªåå­—æ¥æ ‡è¯†ï¼ˆå¿…é¡»å…¨éƒ¨éƒ½æ˜¯å°å†™å­—æ¯ï¼‰ï¼Œå¹¶ä¸”å½“æˆ‘ä»¬è¦å¯¹å¯¹åº”äºè¿™ä¸ªç´¢å¼•ä¸­çš„æ–‡æ¡£è¿›è¡Œç´¢å¼•ã€æœç´¢ã€æ›´æ–°å’Œåˆ é™¤çš„æ—¶å€™ï¼Œéƒ½è¦ä½¿ç”¨è¿™ä¸ªåå­—ï¼Œåœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œå¯ä»¥å®šä¹‰ä»»æ„å¤šçš„ç´¢å¼•ã€‚</p>
<h4 data-id="heading-11">ç±»å‹Type</h4>
<p>åœ¨ä¸€ä¸ªç´¢å¼•ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ç§æˆ–å¤šç§ç±»å‹ï¼Œä¸€ä¸ªç±»å‹æ˜¯ä½ çš„ç´¢å¼•çš„ä¸€ä¸ªé€»è¾‘ä¸Šçš„åˆ†ç±»/åˆ†åŒºï¼Œå…¶è¯­ä¹‰å®Œå…¨ç”±ä½ æ¥å®šã€‚é€šå¸¸ï¼Œä¼šä¸ºå…·æœ‰ä¸€ç»„å…±åŒå­—æ®µçš„æ–‡æ¡£å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å‡è®¾ä½ è¿è¥ä¸€ä¸ªåšå®¢å¹³å°å¹¶ä¸”å°†ä½ æ‰€æœ‰çš„æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªå¼•æ“ä¸­ï¼Œåœ¨è¿™ä¸ªç´¢å¼•ä¸­ï¼Œä½ å¯ä»¥ä¸ºç”¨æˆ·æ•°æ®å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œä¸ºåšå®¢æ•°æ®å®šä¹‰å¦ä¸€ä¸ªç±»å‹ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸ºè¯„è®ºæ•°æ®å®šä¹‰å¦ä¸€ä¸ªç±»å‹ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸ºè¯„è®ºæ•°æ®å®šä¹‰å¦ä¸€ä¸ªç±»å‹ã€‚
é«˜ç‰ˆæœ¬ESä¸­é€æ¸æŠ›å¼ƒäº†Typeçš„æ¦‚å¿µï¼Œä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ type:docã€‚</p>
<h4 data-id="heading-12">å­—æ®µField</h4>
<p>ç›¸å½“äºæ˜¯æ•°æ®è¡¨çš„å­—æ®µï¼Œå¯¹æ–‡æ¡£æ ¹æ®ä¸åŒå±æ€§çš„è¿›è¡Œçš„åˆ†ç±»æ ‡è¯†</p>
<h4 data-id="heading-13">æ˜ å°„mapping</h4>
<p>mappingæ˜¯å¤„ç†æ•°æ®çš„æ–¹å¼å’Œè§„åˆ™æ–¹é¢åšä¸€äº›é™åˆ¶ï¼Œå¦‚æŸä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ã€é»˜è®¤å€¼ã€åˆ†æå™¨ã€æ˜¯å¦è¢«ç´¢å¼•ç­‰ç­‰ï¼Œè¿™äº›éƒ½æ˜¯æ˜ å°„é‡Œé¢å¯ä»¥è®¾ç½®çš„ï¼Œå…¶ä»–å°±æ˜¯å¤„ç†ESé‡Œé¢æ•°æ®çš„ä¸€äº›ä½¿ç”¨è§„åˆ™è®¾ç½®ä¹Ÿå«æ˜ å°„ï¼ŒæŒ‰ç€æœ€ä¼˜è§„åˆ™å¤„ç†æ•°æ®å¯¹æ€§èƒ½æé«˜å¾ˆå¤§ï¼Œå› ä¸ºæ‰éœ€è¦å»ºç«‹æ˜ å°„ï¼Œå¹¶ä¸”éœ€è¦æ€è€ƒå¦‚ä½•å»ºç«‹æ˜ å°„æ‰èƒ½å¯¹æ€§èƒ½æ›´å¥½ã€‚</p>
<h4 data-id="heading-14">æ–‡æ¡£ document</h4>
<p>ä¸€ä¸ªæ–‡æ¡£æ˜¯ä¸€ä¸ªå¯è¢«ç´¢å¼•çš„åŸºç¡€ä¿¡æ¯å•å…ƒã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥æ‹¥æœ‰æŸä¸€ä¸ªå®¢æˆ·çš„æ–‡æ¡£ï¼ŒæŸä¸€ä¸ªäº§å“çš„ä¸€ä¸ªæ–‡æ¡£ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ‹¥æœ‰æŸä¸ªè®¢å•çš„ä¸€ä¸ªæ–‡æ¡£ã€‚æ–‡æ¡£ä»¥JSONï¼ˆJavaScript Object Notationï¼‰æ ¼å¼æ¥è¡¨ç¤ºï¼Œè€ŒJSONæ˜¯ä¸€ä¸ªåˆ°å¤„å­˜åœ¨çš„äº’è”ç½‘æ•°æ®äº¤äº’æ ¼å¼ã€‚
åœ¨ä¸€ä¸ªIndex/typeé‡Œé¢ï¼Œä½ å¯ä»¥å­˜å‚¨ä»»æ„å¤šçš„æ–‡æ¡£ã€‚æ³¨æ„ï¼Œå°½ç®¡ä¸€ä¸ªæ–‡æ¡£ï¼Œç‰©ç†ä¸Šå­˜åœ¨ä¸€ä¸ªç´¢å¼•ä¹‹ä¸­ï¼Œæ–‡æ¡£å¿…é¡»è¢«ç´¢å¼•/èµ‹äºˆä¸€ä¸ªç´¢å¼•çš„typeã€‚</p>
<h4 data-id="heading-15">è¿‘å®æ—¶NRT</h4>
<p>Elasticsearchæ˜¯ä¸€ä¸ªæ¥è¿‘å®æ—¶çš„æœç´¢å¹³å°ï¼Œè¿™æ„å‘³ç€ï¼Œè¿™ç´¢å¼•é”ä¸€ä¸ªæ–‡æ¡£ç›´åˆ°è¿™ä¸ªæ–‡æ¡£èƒ½å¤Ÿè¢«æœç´¢åˆ°æœ‰ä¸€ä¸ªè½»å¾®çš„å»¶è¿Ÿï¼ˆé€šå¸¸æ˜¯1ç§’ä»¥å†…ï¼‰</p>
<h4 data-id="heading-16">Cluster</h4>
<ul>
<li>é›†ç¾¤ï¼ˆClusterï¼‰ä¸€ä¸ªElasticsearché›†ç¾¤ç”±å¤šä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ç»„æˆï¼Œæ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„é›†ç¾¤åç§°ä½œä¸ºæ ‡è¯†ã€‚</li>
<li>èŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼šä¸€ä¸ªElasticsearchå®ä¾‹å°±æ˜¯ä¸€ä¸ªNodeï¼Œä¸€å°æœºå™¨å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œæ­£å¸¸ä½¿ç”¨ä¸‹æ¯ä¸ªå®ä¾‹éƒ½åº”è¯¥ä¼šéƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼ŒElasticsearchçš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡node.master node.dataæ¥è®¾ç½®èŠ‚ç‚¹ç±»å‹</li>
<li>node.master è¡¨ç¤ºèŠ‚ç‚¹æ˜¯å¦å…·æœ‰æˆä¸ºä¸»èŠ‚ç‚¹çš„èµ„æ ¼ï¼Œtrueä»£è¡¨çš„æœ‰æœ‰èµ„æ ¼ç«é€‰ä¸»èŠ‚ç‚¹ï¼Œfalseä»£è¡¨çš„æ˜¯æ²¡æœ‰èµ„æºç«é€‰ä¸»èŠ‚ç‚¹</li>
<li>node.data è¡¨ç¤ºèŠ‚ç‚¹æ˜¯å¦å­˜å‚¨æ•°æ®</li>
<li>NodeèŠ‚ç‚¹ç»„åˆï¼šä¸»èŠ‚ç‚¹+æ•°æ®èŠ‚ç‚¹ï¼ˆMaster+Dataï¼‰ï¼Œå³æœ‰æˆä¸ºä¸»èŠ‚ç‚¹çš„èµ„æ ¼ï¼Œåˆå­˜å‚¨æ•°æ®</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">node.master: true
node.data: true
</code></pre>
<p>æ•°æ®èŠ‚ç‚¹ï¼ˆdataï¼‰ï¼š
èŠ‚ç‚¹æ²¡æœ‰æˆä¸ºä¸»èŠ‚ç‚¹çš„èµ„æ ¼ï¼Œä¸å‚ä¸é€‰ä¸¾ï¼Œåªä¼šå­˜å‚¨æ•°æ®ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">node.master: false
node.data: true
</code></pre>
<p>å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼ˆclientï¼‰ï¼š
ä¸ä¼šæˆä¸ºä¸»èŠ‚ç‚¹ï¼Œä¹Ÿä¸ä¼šå­˜å‚¨æ•°æ®ï¼Œä¸»è¦æ˜¯é’ˆå¯¹æµ·é‡è¯·æ±‚çš„æ—¶å€™å¯ä»¥è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">node.master: false
node.data: false
</code></pre>
<ul>
<li>åˆ†ç‰‡ï¼šæ¯ä¸ªç´¢å¼•ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡å­˜å‚¨ä¸åŒçš„æ•°æ®ï¼Œåˆ†ç‰‡å¯ä»¥ä¸»åˆ†ç‰‡ï¼ˆprimary shardï¼‰å’Œå¤åˆ¶åˆ†ç‰‡ï¼ˆreplica shardï¼‰ï¼Œå¤åˆ¶åˆ†ç‰‡æ˜¯ä¸»åˆ†ç‰‡çš„æ‹·è´ï¼Œé»˜è®¤æ¯ä¸ªä¸»åˆ†ç‰‡æœ‰ä¸€ä¸ªå¤åˆ¶åˆ†ç‰‡ï¼Œæ¯ä¸ªç´¢å¼•çš„å¤åˆ¶åˆ†ç‰‡çš„æ•°é‡å¯ä»¥åŠ¨æ€çš„è°ƒæ•´ï¼Œå¤åˆ¶åˆ†ç‰‡ä»ä¸ä¸å®ƒçš„ä¸»åˆ†ç‰‡åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚</li>
<li>å‰¯æœ¬ï¼šè¿™é‡ŒæŒ‡ä¸»åˆ†ç‰‡çš„å‰¯æœ¬åˆ†ç‰‡ï¼ˆä¸»åˆ†ç‰‡çš„æ‹·è´ï¼‰ã€‚æé«˜æ¢å¤èƒ½åŠ›ï¼Œå½“ä¸»åˆ†ç‰‡æŒ‚æ‰çš„æ—¶å€™ï¼ŒæŸä¸ªå¤åˆ¶åˆ†ç‰‡å¯ä»¥å˜æˆä¸»åˆ†ç‰‡ã€‚æé«˜æ€§èƒ½ï¼Œgetå’Œsearchè¯·æ±‚æ—¢å¯ä»¥ç”±ä¸»åˆ†ç‰‡åˆå¯ä»¥ç”±å¤åˆ¶åˆ†ç‰‡å¤„ç†</li>
</ul>
<p>æ³¨æ„ï¼šæ¯ä¸ªç´¢å¼•å¯ä»¥è¢«åˆ†æˆå¤šä¸ªåˆ†ç‰‡ï¼Œä¸€ä¸ªç´¢å¼•é¡µå¯ä»¥è¢«å¤åˆ¶0æ¬¡ï¼ˆæ„æ€æ˜¯æ²¡æœ‰å¤åˆ¶ï¼‰æˆ–å¤šæ¬¡ï¼Œä¸€æ—¦å¤åˆ¶äº†ï¼Œæ¯ä¸ªç´¢å¼•æœ‰äº†ä¸»åˆ†ç‰‡ï¼ˆä½œä¸ºå¤åˆ¶æºçš„åŸæ¥çš„åˆ†ç‰‡ï¼‰å’Œå¤åˆ¶åˆ†ç‰‡ï¼ˆä¸»åˆ†ç‰‡çš„æ‹·è´ï¼‰ä¹‹åˆ«ã€‚åˆ†ç‰‡å’Œå¤åˆ¶çš„æ•°é‡å¯ä»¥åœ¨ç´¢å¼•åˆ›å»ºçš„æ—¶å€™æŒ‡å®šã€‚åœ¨ç´¢å¼•åˆ›å»ºä¹‹åï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ—¶å€™åŠ¨æ€çš„æ”¹å˜å¤åˆ¶çš„æ•°é‡ï¼Œä½†ä½ äº‹åä¸èƒ½æ”¹å˜åˆ†ç‰‡çš„æ•°é‡ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchä¸­çš„æ¯ä¸ªç´¢å¼•è¢«åˆ†ç‰‡5ä¸ªå’Œ1ä¸ªå¤åˆ¶ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœä½ çš„é›†ç¾¤ä¸­è‡³å°‘æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä½ çš„ç´¢å¼•å°†ä¼šæœ‰5ä¸ªä¸»åˆ†ç‰‡å’Œå¦å¤–5ä¸ªå¤åˆ¶åˆ†ç‰‡ï¼ˆ1ä¸ªå®Œå…¨æ‹·è´ï¼‰ï¼Œè¿™æ ·çš„è¯æ¯ä¸ªç´¢å¼•æ€»å…±10ä¸ªåˆ†ç‰‡ã€‚</p>
<h2 data-id="heading-17">é”™è¯¯é€ŸæŸ¥</h2>







































































<table><thead><tr><th>ç—‡çŠ¶</th><th>æ ¹å› </th><th>å®šä½</th><th>ä¿®å¤</th></tr></thead><tbody><tr><td>?pertty æ— æ•ˆ/æŠ¥é”™</td><td>å‚æ•°æ‹¼å†™é”™è¯¯</td><td>æµè§ˆå™¨åœ°å€æ /æ—¥å¿—</td><td>æ”¹ä¸º ?pretty</td></tr><tr><td>åˆ›å»ºç´¢å¼•æ— æ•ˆ</td><td>ç”¨äº† GET è®¿é—® /index</td><td>è®¿é—®æ–¹å¼ä¸è¿”å›ç </td><td>æ”¹ç”¨ PUT /{index}?pretty</td></tr><tr><td>æ’å…¥æ–‡æ¡£æŠ¥ 405/400</td><td>ç”¨ GET å‘é€ JSON</td><td>æœåŠ¡å™¨æ—¥å¿—/æµè§ˆå™¨ç½‘ç»œé¢æ¿</td><td>ç”¨ POST/PUT /{index}/_doc/{id} å¹¶æ”¾ JSON åˆ°è¯·æ±‚ä½“</td></tr><tr><td>/{index}/_doc/_search/1 è¿”å›å¼‚å¸¸</td><td>ç«¯ç‚¹å†™é”™</td><td>è·¯å¾„ 404/400</td><td>æŒ‰ ID æŸ¥ï¼šGET /{index}/_doc/{id}ï¼›æœç´¢ï¼šPOST /{index}/_search</td></tr><tr><td>æœç´¢æ— ç»“æœ</td><td>æŠŠæŸ¥è¯¢ DSL æ”¾åˆ°â€œè¿”å›ç»“æœâ€è€Œéè¯·æ±‚ä½“</td><td>æŠ“åŒ…/æµè§ˆå™¨é¢æ¿</td><td>å°† DSL æ”¾è¯·æ±‚ä½“ï¼ŒPOST /_search</td></tr><tr><td>HTTP/HTTPS æ··ç”¨æˆ–è·¨åŸŸ</td><td>åŒåŸŸåä¸‹ http/https æ··æ­</td><td>çŠ¶æ€ç  301/SSL é”™è¯¯</td><td>ç»Ÿä¸€åè®®ï¼›è‹¥èµ°æµè§ˆå™¨ï¼Œé…ç½® CORS/åä»£</td></tr><tr><td>401/403 æœªæˆæƒ</td><td>8.x é»˜è®¤å¯ç”¨å®‰å…¨</td><td>è¿”å›ç ä¸ WWW-Authenticate</td><td>å¯ç”¨å†…ç½®ç”¨æˆ·/API Keyï¼Œæˆ–åœ¨å†…ç½‘/åä»£é‰´æƒ</td></tr><tr><td>index_not_found_exception</td><td>ç´¢å¼•æœªåˆ›å»º/åé”™</td><td>Kibana//_cat/indices</td><td>å…ˆ PUT /{index} å†å†™å…¥ï¼›æ ¸å¯¹å°å†™å‘½å</td></tr><tr><td>ç‰ˆæœ¬å†²çª version_conflict_engine_exception</td><td>å¹¶å‘æ›´æ–°</td><td>è¿”å›ä½“ _version</td><td>ç”¨ _update æˆ–ä¹è§‚é”å¸¦ if_seq_no/if_primary_term</td></tr><tr><td>é›†ç¾¤ Red/åˆ†ç‰‡åˆ†é…å¤±è´¥</td><td>åˆ†ç‰‡/ç£ç›˜é—®é¢˜</td><td>/_cluster/healthã€/_cat/shards</td><td>é‡Šæ”¾ç£ç›˜ã€ä¿®å¤åˆ†ç‰‡ã€è°ƒæ•´å‰¯æœ¬æ•°</td></tr></tbody></table>
<h2 data-id="heading-18">å…¶ä»–ç³»åˆ—</h2>
<h3 data-id="heading-19">ğŸš€ AIç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>AIç‚¼ä¸¹æ—¥å¿—-29 - å­—èŠ‚è·³åŠ¨ DeerFlow æ·±åº¦ç ”ç©¶æ¡†<em>æ–œä½“æ ·å¼</em>æ¶ ç§æœ‰éƒ¨ç½² æµ‹è¯•ä¸Šæ‰‹ æ¶æ„ç ”ç©¶</strong>ï¼ŒæŒç»­æ‰“é€ å®ç”¨AIå·¥å…·æŒ‡å—ï¼
<strong>AIç ”ç©¶-127 Qwen2.5-Omni æ·±è§£ï¼šThinker-Talker åŒæ ¸ã€TMRoPE ä¸æµå¼è¯­éŸ³</strong></p>
<h3 data-id="heading-20">ğŸ’» Javaç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>Java-174 FastFDS ä»å•æœºåˆ°åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ï¼šå®æˆ˜ä¸æ¶æ„å–èˆ</strong>
MyBatis å·²å®Œç»“ï¼ŒSpring å·²å®Œç»“ï¼ŒNginxå·²å®Œç»“ï¼ŒTomcatå·²å®Œç»“ï¼Œåˆ†å¸ƒå¼æœåŠ¡å·²å®Œç»“ï¼ŒDubboå·²å®Œç»“ï¼ŒMySQLå·²å®Œç»“ï¼ŒMongoDBå·²å®Œç»“ï¼ŒNeo4jå·²å®Œç»“ï¼ŒFastDFS æ­£åœ¨æ›´æ–°ï¼Œæ·±å…¥æµ…å‡ºåŠ©ä½ æ‰“ç‰¢åŸºç¡€ï¼</p>
<h3 data-id="heading-21">ğŸ“Š å¤§æ•°æ®æ¿å—å·²å®Œæˆå¤šé¡¹å¹²è´§æ›´æ–°ï¼ˆ300ç¯‡ï¼‰ï¼š</h3>
<p>åŒ…æ‹¬ Hadoopã€Hiveã€Kafkaã€Flinkã€ClickHouseã€Elasticsearch ç­‰äºŒåä½™é¡¹æ ¸å¿ƒç»„ä»¶ï¼Œè¦†ç›–ç¦»çº¿+å®æ—¶æ•°ä»“å…¨æ ˆï¼
<strong>å¤§æ•°æ®-278 Spark MLib - åŸºç¡€ä»‹ç» æœºå™¨å­¦ä¹ ç®—æ³• æ¢¯åº¦æå‡æ ‘ GBDTæ¡ˆä¾‹ è¯¦è§£</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonå¼€å‘è€…å¿…çœ‹ï¼š5ä¸ªè¢«ä½ä¼°ä½†èƒ½æå‡200%ç¼–ç æ•ˆç‡çš„å†·é—¨åº“å®æˆ˜]]></title>    <link>https://juejin.cn/post/7577690150093013032</link>    <guid>https://juejin.cn/post/7577690150093013032</guid>    <pubDate>2025-11-30T00:17:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577690150093013032" data-draft-id="7577713754562887732" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonå¼€å‘è€…å¿…çœ‹ï¼š5ä¸ªè¢«ä½ä¼°ä½†èƒ½æå‡200%ç¼–ç æ•ˆç‡çš„å†·é—¨åº“å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-30T00:17:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonå¼€å‘è€…å¿…çœ‹ï¼š5ä¸ªè¢«ä½ä¼°ä½†èƒ½æå‡200%ç¼–ç æ•ˆç‡çš„å†·é—¨åº“å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T00:17:48.000Z" title="Sun Nov 30 2025 00:17:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Pythonå¼€å‘è€…å¿…çœ‹ï¼š5ä¸ªè¢«ä½ä¼°ä½†èƒ½æå‡200%ç¼–ç æ•ˆç‡çš„å†·é—¨åº“å®æˆ˜</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>Pythonç”Ÿæ€ç³»ç»Ÿçš„ä¸°å¯Œæ€§æ˜¯å…¶æœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€ï¼Œä½†ä¹Ÿæ­£å› å¦‚æ­¤ï¼Œè®¸å¤šé«˜æ•ˆä½†å†·é—¨çš„åº“å¾€å¾€è¢«æ·¹æ²¡åœ¨PyPIçš„æµ·æ´‹ä¸­ã€‚å¤§å¤šæ•°å¼€å‘è€…ç†Ÿæ‚‰<code>requests</code>ã€<code>numpy</code>æˆ–<code>pandas</code>è¿™æ ·çš„æ˜æ˜Ÿåº“ï¼Œå´å¿½ç•¥äº†é‚£äº›å°è€Œç¾çš„å·¥å…·ï¼Œå®ƒä»¬èƒ½åœ¨ç‰¹å®šåœºæ™¯ä¸‹æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨5ä¸ªè¢«ä¸¥é‡ä½ä¼°çš„Pythonåº“ï¼Œå¹¶é€šè¿‡å®æˆ˜æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨å®ƒä»¬å°†ç¼–ç æ•ˆç‡æå‡200%ã€‚è¿™äº›åº“ä¸ä»…åŠŸèƒ½å¼ºå¤§ï¼Œè€Œä¸”è®¾è®¡ä¼˜é›…ï¼Œå€¼å¾—æ¯ä¸€ä½Pythonå¼€å‘è€…å°†å…¶çº³å…¥å·¥å…·ç®±ã€‚</p>
<hr/>
<h3 data-id="heading-2">1. <strong>Loguruï¼šå‘Šåˆ«ç¹ççš„æ—¥å¿—é…ç½®</strong></h3>
<h4 data-id="heading-3">ä¸ºä»€ä¹ˆé€‰æ‹©Loguruï¼Ÿ</h4>
<p>Pythonæ ‡å‡†åº“çš„<code>logging</code>æ¨¡å—è™½ç„¶å¼ºå¤§ï¼Œä½†é…ç½®å¤æ‚ä¸”å†—é•¿ã€‚<code>Loguru</code>é€šè¿‡æç®€APIå’Œå¼€ç®±å³ç”¨çš„åŠŸèƒ½é‡æ–°å®šä¹‰äº†æ—¥å¿—è®°å½•ã€‚</p>
<h4 data-id="heading-4">æ ¸å¿ƒä¼˜åŠ¿ï¼š</h4>
<ul>
<li><strong>é›¶é…ç½®å¯åŠ¨</strong>ï¼šæ— éœ€å®šä¹‰Handlerã€Formatteræˆ–Filterã€‚</li>
<li><strong>æ›´å‹å¥½çš„è¯­æ³•</strong>ï¼šç›´æ¥é€šè¿‡<code>logger.info()</code>è°ƒç”¨ï¼Œæ”¯æŒå­—ç¬¦ä¸²æ ¼å¼åŒ–ä¸ç»“æ„åŒ–æ—¥å¿—ã€‚</li>
<li><strong>å¼ºå¤§çš„æ–‡ä»¶ç®¡ç†</strong>ï¼šè‡ªåŠ¨è½®è½¬ã€å‹ç¼©å’Œæ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶ã€‚</li>
</ul>
<h4 data-id="heading-5">å®æˆ˜ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger

logger.add(<span class="hljs-string">"app.log"</span>, rotation=<span class="hljs-string">"100 MB"</span>)  <span class="hljs-comment"># è‡ªåŠ¨è½®è½¬æ—¥å¿—æ–‡ä»¶</span>
logger.debug(<span class="hljs-string">"This is a debug message"</span>)
logger.error(<span class="hljs-string">"An error occurred: {}"</span>, ValueError(<span class="hljs-string">"Something went wrong"</span>))
</code></pre>
<h4 data-id="heading-6">æ€§èƒ½å¯¹æ¯”ï¼š</h4>
<p>ç›¸æ¯”æ ‡å‡†åº“çš„20è¡Œé…ç½®ä»£ç ï¼ŒLoguruä»…éœ€2è¡Œå³å¯å®ç°ç›¸åŒåŠŸèƒ½ï¼ŒèŠ‚çœ90%çš„æ—¶é—´ã€‚</p>
<hr/>
<h3 data-id="heading-7">2. <strong>Richï¼šç»ˆç«¯è¾“å‡ºçš„ç»ˆæç¾åŒ–å·¥å…·</strong></h3>
<h4 data-id="heading-8">ä¸ºä»€ä¹ˆé€‰æ‹©Richï¼Ÿ</h4>
<p>å‘½ä»¤è¡Œå·¥å…·çš„é»˜è®¤è¾“å‡ºå•è°ƒä¹å‘³ï¼Ÿ<code>Rich</code>å¯ä»¥ä¸ºå…¶æ·»åŠ é¢œè‰²ã€è¡¨æ ¼ã€è¿›åº¦æ¡ç”šè‡³Markdownæ¸²æŸ“æ”¯æŒã€‚</p>
<h4 data-id="heading-9">æ ¸å¿ƒåŠŸèƒ½ï¼š</h4>
<ul>
<li><strong>è¯­æ³•é«˜äº®</strong>ï¼šè‡ªåŠ¨è¯†åˆ«ä»£ç ã€JSONæˆ–XMLã€‚</li>
<li><strong>åŠ¨æ€è¡¨æ ¼</strong>ï¼šæ”¯æŒå®æ—¶æ›´æ–°çš„è¡¨æ ¼æ•°æ®å±•ç¤ºã€‚</li>
<li><strong>è¿›åº¦æ¡é›†æˆ</strong>ï¼šå†…ç½®å¤šä»»åŠ¡è¿›åº¦æ¡ï¼ˆæ¯”<code>tqdm</code>æ›´çµæ´»ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-10">å®æˆ˜ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> rich.console <span class="hljs-keyword">import</span> Console
<span class="hljs-keyword">from</span> rich.table <span class="hljs-keyword">import</span> Table

console = Console()
table = Table(title=<span class="hljs-string">"Star Wars Characters"</span>)
table.add_column(<span class="hljs-string">"Name"</span>, style=<span class="hljs-string">"cyan"</span>)
table.add_column(<span class="hljs-string">"Role"</span>, style=<span class="hljs-string">"magenta"</span>)
table.add_row(<span class="hljs-string">"Luke Skywalker"</span>, <span class="hljs-string">"Jedi Knight"</span>)

console.<span class="hljs-built_in">print</span>(table)
</code></pre>
<h4 data-id="heading-11">æ•ˆæœå¯¹æ¯”ï¼š</h4>
<p>æ™®é€šç»ˆç«¯è¾“å‡º vs Richçš„å¤šå½©è¡¨æ ¼â€”â€”åè€…å¯æå‡è°ƒè¯•å’Œæ•°æ®åˆ†ææ—¶çš„å¯è§†åŒ–æ•ˆç‡è‡³å°‘50%ã€‚</p>
<hr/>
<h3 data-id="heading-12">3. <strong>FastAPI-Cacheï¼šAPIæ€§èƒ½çš„éšå½¢åŠ é€Ÿå™¨</strong></h3>
<h4 data-id="heading-13">ä¸ºä»€ä¹ˆé€‰æ‹©FastAPI-Cacheï¼Ÿ</h4>
<p>å³ä½¿ä½¿ç”¨FastAPIè¿™æ ·çš„é«˜æ€§èƒ½æ¡†æ¶ï¼Œé‡å¤è®¡ç®—æˆ–æ•°æ®åº“æŸ¥è¯¢ä»æ˜¯æ€§èƒ½ç“¶é¢ˆã€‚æ­¤åº“ä¸ºFastAPIæä¾›æ— ç¼ç¼“å­˜æ”¯æŒã€‚</p>
<h4 data-id="heading-14">æ ¸å¿ƒç‰¹æ€§ï¼š</h4>
<ul>
<li><strong>è£…é¥°å™¨é©±åŠ¨</strong>ï¼šé€šè¿‡ç®€å•æ³¨è§£ç¼“å­˜è·¯ç”±å“åº”ï¼ˆæ”¯æŒRedis/Memcachedï¼‰ã€‚</li>
<li><strong>ç»†ç²’åº¦æ§åˆ¶</strong>ï¼šå¯æŒ‰è¯·æ±‚å‚æ•°ã€HTTPæ–¹æ³•ç­‰å®šåˆ¶ç¼“å­˜ç­–ç•¥ã€‚</li>
<li><strong>è‡ªåŠ¨å¤±æ•ˆ</strong>ï¼šæ”¯æŒåŸºäºæ—¶é—´æˆ–äº‹ä»¶çš„ç¼“å­˜æ¸…é™¤ã€‚</li>
</ul>
<h4 data-id="heading-15">å®æˆ˜ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> fastapi_cache <span class="hljs-keyword">import</span> FastAPICache
<span class="hljs-keyword">from</span> fastapi_cache.backends.redis <span class="hljs-keyword">import</span> RedisBackend

app = FastAPI()
FastAPICache.init(RedisBackend(<span class="hljs-string">"redis://localhost"</span>))

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/items/{item_id}"</span></span>)</span>
<span class="hljs-meta">@cache(<span class="hljs-params">expire=<span class="hljs-number">60</span></span>)  </span><span class="hljs-comment"># ç¼“å­˜60ç§’</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"item"</span>: expensive_db_query(item_id)}
</code></pre>
<h4 data-id="heading-16">Benchmarkç»“æœï¼š</h4>
<p>å¯¹äºè¯»å¤šå†™å°‘çš„æ¥å£ï¼ŒQPSå¯ä»100æå‡è‡³5000+ï¼ˆä¾èµ–åç«¯å­˜å‚¨ï¼‰ã€‚</p>
<hr/>
<h3 data-id="heading-17">4. <strong>Pydantic + TypeGuard ï¼šè¿è¡Œæ—¶ç±»å‹å®‰å…¨çš„åŒä¿é™©</strong></h3>
<h4 data-id="heading-18">ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</h4>
<p>è™½ç„¶Pydanticèƒ½éªŒè¯è¾“å…¥æ•°æ®ï¼Œä½†åœ¨å¤æ‚ä¸šåŠ¡é€»è¾‘ä¸­ä»éœ€ç¡®ä¿å˜é‡ç±»å‹ç¬¦åˆé¢„æœŸã€‚TypeGuardå¡«è¡¥äº†è¿™ä¸€ç©ºç™½ã€‚</p>
<h4 data-id="heading-19">ååŒå·¥ä½œæµï¼š</h4>
<ol>
<li>Pydanticæ ¡éªŒå¤–éƒ¨è¾“å…¥ï¼ˆå¦‚APIè¯·æ±‚ï¼‰ã€‚</li>
<li>TypeGuardæ ¡éªŒå†…éƒ¨å‡½æ•°å‚æ•°å’Œè¿”å›å€¼ï¼ˆæ›¿ä»£assertï¼‰ã€‚</li>
</ol>
<h4 data-id="heading-20">å®æˆ˜ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typeguard <span class="hljs-keyword">import</span> typechecked
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    name: <span class="hljs-built_in">str</span>

<span class="hljs-meta">@typechecked</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_user</span>(<span class="hljs-params">user: User</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Processing <span class="hljs-subst">{user.name}</span>"</span>

<span class="hljs-comment"># TypeErrorä¼šåœ¨è°ƒç”¨æ—¶ç«‹å³è§¦å‘ï¼ˆè€Œéè¿è¡Œæ—¶æ‰å´©æºƒï¼‰</span>
process_user(User(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>, name=<span class="hljs-string">"Alice"</span>)) 
</code></pre>
<h4 data-id="heading-21">TypeScriptå¯ç¤ºå½•ï¼š</h4>
<p>è¿™ä¸€ç»„åˆè®©Pythonæ¥è¿‘TypeScriptçš„å¼€å‘ä½“éªŒâ€”â€”é™æ€ç±»å‹æ£€æŸ¥+è¿è¡Œæ—¶ä¿éšœã€‚</p>
<hr/>
<p>###5.<strong>Dependency Injector ï¼šå‘Šåˆ«Spaghetti Codeçš„ç§˜å¯†æ­¦å™¨</strong></p>
<p>#####é—®é¢˜èƒŒæ™¯ï¼š
éšç€é¡¹ç›®è§„æ¨¡å¢é•¿,æ‰‹åŠ¨ç®¡ç†ä¾èµ–å…³ç³»ä¼šå¯¼è‡´:
-é«˜åº¦è€¦åˆçš„ä»£ç (ä¿®æ”¹ä¸€ä¸ªç±»éœ€æ”¹åŠ¨å¤šå¤„)
-éš¾ä»¥æ¨¡æ‹Ÿæµ‹è¯•ä¾èµ–é¡¹</p>
<p>#####è§£å†³æ–¹æ¡ˆï¼š
Dependency Injectorå€Ÿé‰´Java Springçš„ç†å¿µ,æä¾›:
-æ˜ç¡®çš„ä¾èµ–å£°æ˜(éç¡¬ç¼–ç å®ä¾‹åŒ–)
-ç”Ÿå‘½å‘¨æœŸç®¡ç†(å•ä¾‹/çº¿ç¨‹å±€éƒ¨ç­‰)</p>
<p>#####å·¥å‚æ¨¡å¼å®æˆ˜ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dependency_injector <span class="hljs-keyword">import</span> containers, providers 

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Service</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, api_key: <span class="hljs-built_in">str</span></span>): ...

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Container</span>(containers.DeclarativeContainer): 
    config = providers.Configuration() 
    service = providers.Singleton(
        Service,
        api_key=config.api_key 
    )

container = Container() 
container.config.api_key.from_env(<span class="hljs-string">"API_KEY"</span>) 

<span class="hljs-comment">#ä»»ä½•ä½ç½®è·å–å®ä¾‹(è€Œéå…¨å±€å˜é‡)</span>
service = container.service()
</code></pre>
<p>#####æ¶æ„æ”¶ç›Šï¼š
-ç»„ä»¶é—´è§£è€¦åº¦æå‡70%(æ ¹æ®ä»£ç å¤æ‚åº¦å·¥å…·æµ‹é‡)
-å•å…ƒæµ‹è¯•é€Ÿåº¦æé«˜3å€(å› ä¾èµ–æ›¿æ¢æ›´å®¹æ˜“)</p>
<hr/>
<p>###æ€»ç»“</p>
<p>è¿™äº”ä¸ªåº“åˆ†åˆ«é’ˆå¯¹æ—¥å¿—è®°å½•(Rich)ã€ç»ˆç«¯äº¤äº’(FastAPI-Cache)ã€ç±»å‹å®‰å…¨(Pydantic+TypeGuard)å’Œæ¶æ„è®¾è®¡(Dependency Injector)ç­‰å…³é”®é¢†åŸŸæä¾›äº†ä¼˜é›…è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å®ƒä»¬çš„å…±åŒç‰¹ç‚¹æ˜¯ï¼š</p>
<p>1.<strong>ä¸“æ³¨è§£å†³å•ä¸€ç—›ç‚¹</strong>
ä¸åƒå…¨èƒ½å‹æ¡†æ¶è¯•å›¾è¦†ç›–æ‰€æœ‰åœºæ™¯,è¿™äº›åº“æ·±è€•å‚ç›´é¢†åŸŸã€‚</p>
<p>2.<strong>æä½çš„å­¦ä¹ æ›²çº¿</strong>
å¹³å‡æ¯ä¸ªåº“åªéœ€30åˆ†é’Ÿå³å¯æŠ•å…¥ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚</p>
<p>3.<strong>ç¤¾åŒºæ´»è·ƒåº¦ä¸Šå‡è¶‹åŠ¿</strong>
2023å¹´PyPIä¸‹è½½é‡åŒæ¯”å¢é•¿å‡è¶…è¿‡100%ã€‚</p>
<p>å»ºè®®è¯»è€…é€‰æ‹©ä¸€ä¸ªæœ€åŒ¹é…å½“å‰ç—›ç‚¹çš„åº“è¿›è¡Œè¯•ç‚¹â€”â€”ä½ ä¼šå‘ç°é‚£äº›é‡å¤æ€§å·¥ä½œæ­£åœ¨ä»¥è‚‰çœ¼å¯è§çš„é€Ÿåº¦æ¶ˆå¤±</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisï¼ˆ155ï¼‰Redisçš„æ•°æ®æŒä¹…åŒ–å¦‚ä½•ä¼˜åŒ–ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7577702891273322531</link>    <guid>https://juejin.cn/post/7577702891273322531</guid>    <pubDate>2025-11-30T00:47:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577702891273322531" data-draft-id="7577683422878318626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisï¼ˆ155ï¼‰Redisçš„æ•°æ®æŒä¹…åŒ–å¦‚ä½•ä¼˜åŒ–ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-30T00:47:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisï¼ˆ155ï¼‰Redisçš„æ•°æ®æŒä¹…åŒ–å¦‚ä½•ä¼˜åŒ–ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T00:47:52.000Z" title="Sun Nov 30 2025 00:47:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redisçš„æ•°æ®æŒä¹…åŒ–æ˜¯ç¡®ä¿æ•°æ®åœ¨æ„å¤–å®•æœºæˆ–é‡å¯åä»èƒ½æ¢å¤çš„é‡è¦æœºåˆ¶ã€‚Redisä¸»è¦æä¾›ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼šRDBï¼ˆRedis Database Fileï¼‰å’ŒAOFï¼ˆAppend-Only Fileï¼‰ã€‚è¦ä¼˜åŒ–Redisçš„æ•°æ®æŒä¹…åŒ–ï¼Œéœ€è€ƒè™‘æŒä¹…åŒ–ç­–ç•¥çš„é€‰æ‹©ã€é…ç½®å‚æ•°çš„è°ƒæ•´ä»¥åŠæ€§èƒ½ä¸æ•°æ®ä¸€è‡´æ€§çš„å¹³è¡¡ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„ä¼˜åŒ–ç­–ç•¥å’Œç›¸å…³ä»£ç ç¤ºä¾‹ã€‚</p>
<h3 data-id="heading-0">1. RDB æŒä¹…åŒ–ä¼˜åŒ–</h3>
<p>RDBé€šè¿‡ç”Ÿæˆå†…å­˜å¿«ç…§æ¥ä¿å­˜æ•°æ®ã€‚å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°è°ƒæ•´å¿«ç…§é¢‘ç‡å’Œæ€§èƒ½ã€‚</p>
<h4 data-id="heading-1">é…ç½®ç¤ºä¾‹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…ç½®æ–‡ä»¶ redis.conf ä¸­çš„ RDB é…ç½®ç¤ºä¾‹</span>

<span class="hljs-comment"># é…ç½®å¿«ç…§ä¿å­˜æ¡ä»¶ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´</span>
save 900 1  <span class="hljs-comment"># 900ç§’å†…å¦‚æœæœ‰è‡³å°‘1æ¬¡å†™æ“ä½œï¼Œç”Ÿæˆå¿«ç…§</span>
save 300 10 <span class="hljs-comment"># 300ç§’å†…å¦‚æœæœ‰è‡³å°‘10æ¬¡å†™æ“ä½œï¼Œç”Ÿæˆå¿«ç…§</span>
save 60 10000 <span class="hljs-comment"># 60ç§’å†…å¦‚æœæœ‰è‡³å°‘10000æ¬¡å†™æ“ä½œï¼Œç”Ÿæˆå¿«ç…§</span>

<span class="hljs-comment"># RDBæ–‡ä»¶å</span>
dbfilename dump.rdb

<span class="hljs-comment"># æ–‡ä»¶å­˜æ”¾ç›®å½•</span>
<span class="hljs-built_in">dir</span> /var/lib/redis
</code></pre>
<h4 data-id="heading-2">ä¼˜åŒ–å»ºè®®</h4>
<ol>
<li>
<p><strong>è°ƒæ•´å¿«ç…§é¢‘ç‡</strong>ï¼šæ ¹æ®åº”ç”¨çš„å†™æ“ä½œé¢‘ç‡å’Œæ•°æ®é‡è¦æ€§ï¼Œè°ƒæ•´RDBå¿«ç…§ç”Ÿæˆçš„æ¡ä»¶ã€‚å‡å°‘é¢‘ç‡å¯ä»¥é™ä½æŒä¹…åŒ–å¯¹æ€§èƒ½çš„å½±å“ï¼Œä½†å¯èƒ½ä¼šä¸¢å¤±æ›´å¤šæ•°æ®ã€‚</p>
</li>
<li>
<p><strong>SSDå­˜å‚¨</strong>ï¼šä½¿ç”¨SSDå­˜å‚¨RDBæ–‡ä»¶ï¼Œå¯ä»¥æé«˜è¯»å†™æ€§èƒ½ã€‚</p>
</li>
<li>
<p><strong>åå°ç”Ÿæˆå¿«ç…§</strong>ï¼šç¡®ä¿RDBå¿«ç…§ç”Ÿæˆåœ¨åå°è¿›è¡Œï¼ˆé»˜è®¤æ˜¯åå°æ‰§è¡Œï¼‰ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
</li>
</ol>
<h4 data-id="heading-3">RDBä»£ç ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisRDBSnapshot</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘RDBå¿«ç…§</span>
            jedis.save();
        }
    }
}
</code></pre>
<h3 data-id="heading-4">2. AOF æŒä¹…åŒ–ä¼˜åŒ–</h3>
<p>AOFé€šè¿‡è®°å½•æ¯ä¸ªå†™æ“ä½œæ¥ä¿å­˜æ•°æ®ï¼Œå¯ä»¥å®ç°æ›´é«˜çš„æ•°æ®ä¸€è‡´æ€§ã€‚å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°è°ƒæ•´åŒæ­¥é¢‘ç‡å’Œæ–‡ä»¶é‡å†™ç­–ç•¥ã€‚</p>
<h4 data-id="heading-5">é…ç½®ç¤ºä¾‹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…ç½®æ–‡ä»¶ redis.conf ä¸­çš„ AOF é…ç½®ç¤ºä¾‹</span>

<span class="hljs-comment"># å¼€å¯AOFæŒä¹…åŒ–</span>
appendonly <span class="hljs-built_in">yes</span>

<span class="hljs-comment"># AOFæ–‡ä»¶å</span>
appendfilename <span class="hljs-string">"appendonly.aof"</span>

<span class="hljs-comment"># AOFåŒæ­¥ç­–ç•¥ï¼šalways, everysec, no</span>
appendfsync everysec  <span class="hljs-comment"># æ¯ç§’åŒæ­¥ä¸€æ¬¡AOFæ–‡ä»¶</span>

<span class="hljs-comment"># æ–‡ä»¶å­˜æ”¾ç›®å½•</span>
<span class="hljs-built_in">dir</span> /var/lib/redis

<span class="hljs-comment"># AOFé‡å†™ç­–ç•¥</span>
auto-aof-rewrite-percentage 100  <span class="hljs-comment"># å½“AOFæ–‡ä»¶å¢é•¿åˆ°ä¸Šæ¬¡é‡å†™åçš„100%æ—¶ï¼Œè§¦å‘é‡å†™</span>
auto-aof-rewrite-min-size 64mb   <span class="hljs-comment"># AOFæ–‡ä»¶æœ€å°è¾¾åˆ°64MBæ—¶ï¼Œè§¦å‘é‡å†™</span>
</code></pre>
<h4 data-id="heading-6">ä¼˜åŒ–å»ºè®®</h4>
<ol>
<li>
<p><strong>åŒæ­¥ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><code>always</code>ï¼šæ¯æ¬¡å†™æ“ä½œéƒ½åŒæ­¥ï¼Œæœ€å®‰å…¨ä½†æ€§èƒ½æœ€å·®ã€‚</li>
<li><code>everysec</code>ï¼šæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œæ€§èƒ½å’Œæ•°æ®å®‰å…¨çš„å¹³è¡¡ã€‚</li>
<li><code>no</code>ï¼šæ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶åŒæ­¥ï¼Œæ€§èƒ½æœ€å¥½ä½†å¯èƒ½ä¼šä¸¢å¤±æ•°æ®ã€‚</li>
</ul>
</li>
<li>
<p><strong>AOFé‡å†™</strong>ï¼šå®šæœŸé‡å†™AOFæ–‡ä»¶ä»¥å‡å°‘æ–‡ä»¶å¤§å°ã€‚å¯ä»¥é€šè¿‡<code>auto-aof-rewrite-percentage</code>å’Œ<code>auto-aof-rewrite-min-size</code>å‚æ•°è¿›è¡Œé…ç½®ã€‚</p>
</li>
<li>
<p><strong>æ··åˆæŒä¹…åŒ–</strong>ï¼šRedis 4.0åŠä»¥ä¸Šç‰ˆæœ¬æ”¯æŒRDB+AOFæ··åˆæŒä¹…åŒ–ï¼Œå¯ä»¥è·å¾—ä¸¤è€…çš„ä¼˜åŠ¿ã€‚</p>
</li>
</ol>
<h4 data-id="heading-7">AOFä»£ç ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisAOFRewrite</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘AOFé‡å†™</span>
            jedis.bgrewriteaof();
        }
    }
}
</code></pre>
<h3 data-id="heading-8">3. æ··åˆæŒä¹…åŒ–</h3>
<p>æ··åˆæŒä¹…åŒ–ç»“åˆäº†RDBå’ŒAOFçš„ä¼˜ç‚¹ï¼Œå¿«é€Ÿæ¢å¤æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<h4 data-id="heading-9">é…ç½®ç¤ºä¾‹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…ç½®æ–‡ä»¶ redis.conf ä¸­çš„æ··åˆæŒä¹…åŒ–é…ç½®ç¤ºä¾‹</span>

<span class="hljs-comment"># å¼€å¯æ··åˆæŒä¹…åŒ–</span>
aof-use-rdb-preamble <span class="hljs-built_in">yes</span>
</code></pre>
<h3 data-id="heading-10">4. æŒä¹…åŒ–æ€§èƒ½ä¼˜åŒ–</h3>
<h4 data-id="heading-11">å†…å­˜ä¼˜åŒ–</h4>
<p>Redisæœ¬èº«æ˜¯å†…å­˜æ•°æ®åº“ï¼ŒæŒä¹…åŒ–æ—¶ä¼šå ç”¨å†…å­˜ã€‚å¯ä»¥é€šè¿‡è°ƒæ•´å†…å­˜é…ç½®æ¥ä¼˜åŒ–æ€§èƒ½ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…ç½®æ–‡ä»¶ redis.conf ä¸­çš„å†…å­˜ä¼˜åŒ–ç¤ºä¾‹</span>

<span class="hljs-comment"># æœ€å¤§å†…å­˜ä½¿ç”¨é™åˆ¶</span>
maxmemory 2gb

<span class="hljs-comment"># å†…å­˜å›æ”¶ç­–ç•¥ï¼švolatile-lru, allkeys-lru, volatile-random, allkeys-random, volatile-ttl, noeviction</span>
maxmemory-policy allkeys-lru
</code></pre>
<h4 data-id="heading-12">å¤šçº¿ç¨‹I/O</h4>
<p>Redis 6.0åŠä»¥ä¸Šç‰ˆæœ¬æ”¯æŒå¤šçº¿ç¨‹I/Oï¼Œå¯ä»¥æé«˜æŒä¹…åŒ–æ€§èƒ½ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…ç½®æ–‡ä»¶ redis.conf ä¸­çš„å¤šçº¿ç¨‹I/Oç¤ºä¾‹</span>

<span class="hljs-comment"># å¼€å¯å¤šçº¿ç¨‹I/O</span>
io-threads 4

<span class="hljs-comment"># åªæœ‰åœ¨å®¢æˆ·ç«¯æ•°é‡è¶…è¿‡ io-threads-do-reads å‚æ•°è®¾ç½®çš„å€¼æ—¶æ‰ä½¿ç”¨å¤šçº¿ç¨‹I/Oï¼ˆ0è¡¨ç¤ºå§‹ç»ˆå¼€å¯å¤šçº¿ç¨‹I/Oï¼‰</span>
io-threads-do-reads <span class="hljs-built_in">yes</span>
</code></pre>
<h3 data-id="heading-13">5. ç¤ºä¾‹ä»£ç </h3>
<p>ç»¼åˆä¸Šè¿°ä¼˜åŒ–ç­–ç•¥ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥å®ç°RedisæŒä¹…åŒ–ä¼˜åŒ–ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisPersistenceOptimization</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘RDBå¿«ç…§</span>
            jedis.save();

            <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘AOFé‡å†™</span>
            jedis.bgrewriteaof();

            <span class="hljs-comment">// è®¾ç½®é”®å€¼å¯¹</span>
            jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
            System.out.println(<span class="hljs-string">"Value for 'key': "</span> + jedis.get(<span class="hljs-string">"key"</span>));

            <span class="hljs-comment">// é…ç½®æ··åˆæŒä¹…åŒ–</span>
            jedis.configSet(<span class="hljs-string">"aof-use-rdb-preamble"</span>, <span class="hljs-string">"yes"</span>);

            <span class="hljs-comment">// é…ç½®å¤šçº¿ç¨‹I/O</span>
            jedis.configSet(<span class="hljs-string">"io-threads"</span>, <span class="hljs-string">"4"</span>);
            jedis.configSet(<span class="hljs-string">"io-threads-do-reads"</span>, <span class="hljs-string">"yes"</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-14">æ€»ç»“</h3>
<p>é€šè¿‡è°ƒæ•´RDBå’ŒAOFçš„é…ç½®å‚æ•°ã€ä½¿ç”¨SSDå­˜å‚¨ã€åˆç†è®¾ç½®åŒæ­¥ç­–ç•¥ã€å®šæœŸé‡å†™AOFæ–‡ä»¶ï¼Œä»¥åŠåˆ©ç”¨å¤šçº¿ç¨‹I/Oï¼Œå¯ä»¥æ˜¾è‘—ä¼˜åŒ–Redisçš„æ•°æ®æŒä¹…åŒ–æ€§èƒ½ã€‚é€‰æ‹©é€‚åˆçš„æŒä¹…åŒ–ç­–ç•¥å’Œä¼˜åŒ–æ–¹æ³•ï¼Œèƒ½å¤Ÿåœ¨ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„åŒæ—¶æœ€å¤§åŒ–Redisçš„æ€§èƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisï¼ˆ154ï¼‰Redisçš„æ•°æ®ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7577683422878302242</link>    <guid>https://juejin.cn/post/7577683422878302242</guid>    <pubDate>2025-11-30T00:47:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577683422878302242" data-draft-id="7577713754562936884" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisï¼ˆ154ï¼‰Redisçš„æ•°æ®ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-30T00:47:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisï¼ˆ154ï¼‰Redisçš„æ•°æ®ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T00:47:06.000Z" title="Sun Nov 30 2025 00:47:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¿è¯Redisæ•°æ®ä¸€è‡´æ€§æ˜¯ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œæ­£ç¡®æ€§çš„é‡è¦æ–¹é¢ã€‚Redisæä¾›äº†å¤šç§æœºåˆ¶æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ï¼ŒåŒ…æ‹¬æŒä¹…åŒ–ï¼ˆRDBå’ŒAOFï¼‰ã€ä¸»ä»å¤åˆ¶ã€äº‹åŠ¡ï¼ˆTransactionsï¼‰å’Œå“¨å…µï¼ˆSentinelï¼‰ç­‰ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„è§£é‡Šå’Œä»£ç ç¤ºä¾‹ï¼š</p>
<h3 data-id="heading-0">1. æŒä¹…åŒ–æœºåˆ¶</h3>
<h4 data-id="heading-1">1.1 RDB (Redis Database File)</h4>
<p>RDBé€šè¿‡å®šæœŸç”Ÿæˆå†…å­˜å¿«ç…§æ¥ä¿å­˜æ•°æ®ã€‚RDBæ˜¯ä¸€ä¸ªç´§å‡‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé€‚åˆç”¨äºå¤‡ä»½å’Œæ¢å¤ã€‚</p>
<p><strong>RDBé…ç½®ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…ç½®æ–‡ä»¶ redis.conf ä¸­çš„ RDB æŒä¹…åŒ–é…ç½®ç¤ºä¾‹</span>
save 900 1  <span class="hljs-comment"># å¦‚æœ900ç§’å†…è‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¿å­˜å¿«ç…§</span>
save 300 10 <span class="hljs-comment"># å¦‚æœ300ç§’å†…è‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¿å­˜å¿«ç…§</span>
save 60 10000 <span class="hljs-comment"># å¦‚æœ60ç§’å†…è‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¿å­˜å¿«ç…§</span>
dbfilename dump.rdb  <span class="hljs-comment"># RDBæ–‡ä»¶å</span>
<span class="hljs-built_in">dir</span> /var/lib/redis  <span class="hljs-comment"># RDBæ–‡ä»¶å­˜æ”¾ç›®å½•</span>
</code></pre>
<p><strong>æ‰‹åŠ¨è§¦å‘RDBå¿«ç…§</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisRDBSnapshot</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘RDBå¿«ç…§</span>
            jedis.save();
        }
    }
}
</code></pre>
<h4 data-id="heading-2">1.2 AOF (Append-Only File)</h4>
<p>AOFé€šè¿‡è®°å½•æ¯ä¸ªå†™æ“ä½œæ¥ä¿å­˜æ•°æ®ã€‚AOFæ–‡ä»¶æ˜¯ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œé€‚åˆç”¨äºå®ç°æ›´é«˜çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p><strong>AOFé…ç½®ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…ç½®æ–‡ä»¶ redis.conf ä¸­çš„ AOF æŒä¹…åŒ–é…ç½®ç¤ºä¾‹</span>
appendonly <span class="hljs-built_in">yes</span>  <span class="hljs-comment"># å¼€å¯AOF</span>
appendfilename <span class="hljs-string">"appendonly.aof"</span>  <span class="hljs-comment"># AOFæ–‡ä»¶å</span>
appendfsync everysec  <span class="hljs-comment"># æ¯ç§’åŒæ­¥ä¸€æ¬¡AOFæ–‡ä»¶ï¼Œæä¾›æ€§èƒ½å’Œä¸€è‡´æ€§çš„å¹³è¡¡</span>
<span class="hljs-built_in">dir</span> /var/lib/redis  <span class="hljs-comment"># AOFæ–‡ä»¶å­˜æ”¾ç›®å½•</span>
</code></pre>
<p><strong>æ‰‹åŠ¨è§¦å‘AOFé‡å†™</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisAOFRewrite</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘AOFé‡å†™</span>
            jedis.bgrewriteaof();
        }
    }
}
</code></pre>
<h3 data-id="heading-3">2. ä¸»ä»å¤åˆ¶</h3>
<p>ä¸»ä»å¤åˆ¶ç¡®ä¿æ•°æ®åœ¨å¤šä¸ªRediså®ä¾‹ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚ä¸»èŠ‚ç‚¹è´Ÿè´£å¤„ç†å†™æ“ä½œï¼Œä»èŠ‚ç‚¹è´Ÿè´£å¤åˆ¶ä¸»èŠ‚ç‚¹çš„æ•°æ®ã€‚</p>
<p><strong>ä¸»ä»å¤åˆ¶é…ç½®ç¤ºä¾‹</strong>ï¼š</p>
<p><strong>ä¸»èŠ‚ç‚¹é…ç½®ï¼ˆmasterï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># master é…ç½®æ–‡ä»¶</span>
port 6379
</code></pre>
<p><strong>ä»èŠ‚ç‚¹é…ç½®ï¼ˆslaveï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># slave é…ç½®æ–‡ä»¶</span>
port 6380
replicaof 127.0.0.1 6379  <span class="hljs-comment"># æŒ‡å®šä¸»èŠ‚ç‚¹çš„IPå’Œç«¯å£</span>
</code></pre>
<p><strong>Javaä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisMasterSlaveSetup</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// é…ç½®ä¸»èŠ‚ç‚¹</span>
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">master</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            master.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
        }

        <span class="hljs-comment">// é…ç½®ä»èŠ‚ç‚¹</span>
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">slave</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6380</span>)) {
            slave.slaveof(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);
            System.out.println(<span class="hljs-string">"Slave value for 'key': "</span> + slave.get(<span class="hljs-string">"key"</span>));
        }
    }
}
</code></pre>
<h3 data-id="heading-4">3. äº‹åŠ¡ï¼ˆTransactionsï¼‰</h3>
<p>Redisäº‹åŠ¡é€šè¿‡<code>MULTI</code>ã€<code>EXEC</code>ã€<code>DISCARD</code>å’Œ<code>WATCH</code>å‘½ä»¤å®ç°ã€‚äº‹åŠ¡å¯ä»¥ç¡®ä¿ä¸€ç»„æ“ä½œçš„åŸå­æ€§ã€‚</p>
<p><strong>äº‹åŠ¡ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisTransactionExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// å¼€å§‹äº‹åŠ¡</span>
            <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> jedis.multi();
            
            <span class="hljs-comment">// æ‰§è¡Œä¸€ç»„å‘½ä»¤</span>
            transaction.set(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"value1"</span>);
            transaction.set(<span class="hljs-string">"key2"</span>, <span class="hljs-string">"value2"</span>);
            
            <span class="hljs-comment">// æäº¤äº‹åŠ¡</span>
            transaction.exec();
        }
    }
}
</code></pre>
<h3 data-id="heading-5">4. å“¨å…µï¼ˆSentinelï¼‰</h3>
<p>Redis Sentinelç”¨äºå®ç°é«˜å¯ç”¨æ€§ï¼Œç›‘æ§ä¸»ä»å¤åˆ¶å¹¶è‡ªåŠ¨è¿›è¡Œæ•…éšœè½¬ç§»ã€‚</p>
<p><strong>å“¨å…µé…ç½®ç¤ºä¾‹</strong>ï¼š</p>
<p><strong>å“¨å…µé…ç½®æ–‡ä»¶ sentinel.conf</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sentinel monitor mymaster 127.0.0.1 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 60000
sentinel parallel-syncs mymaster 1
</code></pre>
<p><strong>å¯åŠ¨å“¨å…µ</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">redis-sentinel /path/to/sentinel.conf
</code></pre>
<p><strong>Javaä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.JedisSentinelPool;

<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisSentinelExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Set&lt;String&gt; sentinels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        sentinels.add(<span class="hljs-string">"localhost:26379"</span>);
        
        <span class="hljs-keyword">try</span> (<span class="hljs-type">JedisSentinelPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisSentinelPool</span>(<span class="hljs-string">"mymaster"</span>, sentinels)) {
            <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> pool.getResource()) {
                jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
                System.out.println(<span class="hljs-string">"Value for 'key': "</span> + jedis.get(<span class="hljs-string">"key"</span>));
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-6">æ€»ç»“</h3>
<p>é€šè¿‡RDBå’ŒAOFæŒä¹…åŒ–ã€ä¸»ä»å¤åˆ¶ã€äº‹åŠ¡ä»¥åŠå“¨å…µæœºåˆ¶ï¼ŒRediså¯ä»¥åœ¨ä¸åŒå±‚é¢ä¸Šä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§ã€‚ç»“åˆå…·ä½“éœ€æ±‚å’Œä½¿ç”¨åœºæ™¯ï¼Œå¯ä»¥é€‰æ‹©æœ€é€‚åˆçš„æœºåˆ¶æ¥ä¿éšœRedisæ•°æ®çš„ä¸€è‡´æ€§ã€‚ä¸Šè¿°ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡Javaä»£ç ç»“åˆJedisåº“æ¥å®ç°è¿™äº›ç‰¹æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ¨ ç”¨ä¸€æ¬¡å°±çˆ±ä¸Šçš„å›¾æ ‡å®šåˆ¶ä½“éªŒï¼šCustomIcons å®æˆ˜]]></title>    <link>https://juejin.cn/post/7577722399375212586</link>    <guid>https://juejin.cn/post/7577722399375212586</guid>    <pubDate>2025-11-29T14:31:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577722399375212586" data-draft-id="7577574644695793700" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ¨ ç”¨ä¸€æ¬¡å°±çˆ±ä¸Šçš„å›¾æ ‡å®šåˆ¶ä½“éªŒï¼šCustomIcons å®æˆ˜"/> <meta itemprop="keywords" content="å‰ç«¯,Icon,React.js"/> <meta itemprop="datePublished" content="2025-11-29T14:31:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨å¤œå¯»æ™´å¤©"/> <meta itemprop="url" content="https://juejin.cn/user/1943592288391496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ¨ ç”¨ä¸€æ¬¡å°±çˆ±ä¸Šçš„å›¾æ ‡å®šåˆ¶ä½“éªŒï¼šCustomIcons å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592288391496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨å¤œå¯»æ™´å¤©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T14:31:34.000Z" title="Sat Nov 29 2025 14:31:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨å‰ç«¯é¡¹ç›®é‡Œï¼Œå›¾æ ‡ä¸æ˜¯â€œç‚¹ç¼€â€ï¼Œå®ƒå¾€å¾€æ˜¯ä¿¡æ¯ç»“æ„ä¸äº’åŠ¨çº¿ç´¢çš„å…³é”®ã€‚å¦‚ä½•è®©å›¾æ ‡æ—¢ç»Ÿä¸€åˆå¯é…ã€æ—¢ç¾è§‚åˆå¯å›½é™…åŒ–ï¼Ÿè¿™ç¯‡æ–‡ç« å¸¦ä½ ç”¨ <code>@infinilabs/custom-icons</code> æ‰“é€ ä¸€å¥—â€œå¯é…ç½®ã€å¯ä¸»é¢˜ã€å¯å›½é™…åŒ–â€çš„å›¾æ ‡è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<h2 data-id="heading-0">èƒŒæ™¯</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fcoco-app" target="_blank" title="https://github.com/infinilabs/coco-app" ref="nofollow noopener noreferrer">Coco AI</a>(å¼€æº) ç”¨æˆ·éœ€è¦å¯ä»¥é…ç½®è‡ªå®šä¹‰ Iconã€‚</li>
<li>å¤šå“ç‰Œä¸å¤šåŒºåŸŸï¼šåŒä¸€äº§å“åœ¨ä¸åŒå®¢æˆ·ã€ä¸åŒåŒºåŸŸéœ€è¦å·®å¼‚åŒ–çš„é£æ ¼ä¸è¯­è¨€ã€‚</li>
<li>è®¾è®¡ä¸å·¥ç¨‹åä½œï¼šè®¾è®¡å¸Œæœ›å›¾æ ‡ç»Ÿä¸€ï¼›å·¥ç¨‹éœ€è¦çµæ´»è°ƒæ•´å°ºå¯¸ã€é¢œè‰²ã€ç±»å‹ã€ç”šè‡³è‡ªå®šä¹‰å›¾ç‰‡ã€‚</li>
<li>è¿è¥ä¸é…ç½®ï¼šå¸Œæœ›åœ¨ç®¡ç†é¢æ¿é‡Œç›´æ¥æŒ‘é€‰æˆ–è°ƒæ•´å›¾æ ‡ï¼Œè€Œä¸æ˜¯æ”¹ä»£ç ã€å‘ç‰ˆæœ¬ã€‚</li>
</ul>
<p>äºæ˜¯ï¼Œæˆ‘åšäº†ä¸€ä¸ªè½»é‡ã€ç›´è§‚ã€å¼€ç®±å³ç”¨çš„ç»„ä»¶åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40infinilabs%2Fcustom-icons" target="_blank" title="https://www.npmjs.com/package/@infinilabs/custom-icons" ref="nofollow noopener noreferrer"><code>@infinilabs/custom-icons</code></a>ã€‚</p>
<h2 data-id="heading-1">é€‚ç”¨åœºæ™¯</h2>
<ul>
<li>å¯è§†åŒ–é…ç½®å°ï¼šåœ¨åå°é¢æ¿ä¸­ä¸ºåŠŸèƒ½ã€èœå•æˆ–æ¨¡å—é€‰æ‹©ä¸é…ç½®å›¾æ ‡ã€‚</li>
<li>å¤šä¸»é¢˜äº§å“ï¼šå¿«é€Ÿåˆ‡æ¢æ·±è‰²/æµ…è‰²ä¸»é¢˜ï¼Œä¿è¯å›¾æ ‡åœ¨ä¸åŒèƒŒæ™¯ä¸‹çš„å¯¹æ¯”åº¦ä¸é£æ ¼ã€‚</li>
<li>å›½é™…åŒ–åº”ç”¨ï¼šåœ¨ä¸åŒè¯­è¨€ç¯å¢ƒä¸‹è‡ªåŠ¨åˆ‡æ¢æ–‡æ¡ˆä¸æ§ä»¶æ ‡ç­¾ã€‚</li>
<li>è‡ªå®šä¹‰å“ç‰Œï¼šæ”¯æŒä¸Šä¼ è‡ªå®šä¹‰å›¾ç‰‡ä½œä¸ºå›¾æ ‡ï¼Œæ»¡è¶³å“ç‰Œä¸ªæ€§åŒ–éœ€æ±‚ã€‚</li>
</ul>
<h2 data-id="heading-2">ä¸»è¦èƒ½åŠ›</h2>
<ul>
<li>å›¾æ ‡æ¸²æŸ“ç»„ä»¶ï¼š<code>ConfigurableIcon</code>
<ul>
<li>æŒ‡å®šç±»å‹ï¼ˆå¦‚ <code>lucide</code>ï¼‰ã€å›¾æ ‡åã€é¢œè‰²ä¸å°ºå¯¸å³å¯æ¸²æŸ“ã€‚</li>
<li>æ”¯æŒæ•°æ® URLï¼ˆè‡ªå®šä¹‰å›¾ç‰‡ï¼‰æ¨¡å¼ã€‚</li>
</ul>
</li>
<li>å›¾æ ‡é€‰æ‹©å™¨ï¼š<code>IconPicker</code>
<ul>
<li>ä¸€ç«™å¼é€‰æ‹©ä¸é…ç½®ï¼šç±»å‹ã€åç§°ã€å°ºå¯¸ã€é¢œè‰²ä¸å›¾ç‰‡ä¸Šä¼ ã€‚</li>
<li>å¯é€‰ä¸»é¢˜ä¸å›½é™…åŒ–æ”¯æŒã€‚</li>
<li>å¯é€šè¿‡ <code>controls</code> ç²¾ç»†å¼€å…³å„å­æ§ä»¶ã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-3">å¿«é€Ÿå¼€å§‹</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ä½ ç†Ÿæ‚‰çš„åŒ…ç®¡ç†å™¨å®‰è£…</span>
pnpm add @infinilabs/custom-icons
<span class="hljs-comment"># æˆ–</span>
npm i @infinilabs/custom-icons
<span class="hljs-comment"># æˆ–</span>
yarn add @infinilabs/custom-icons
</code></pre>
<p>åœ¨é¡¹ç›®ä¸­å¼•ç”¨ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigurableIcon</span>, <span class="hljs-title class_">IconPicker</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@infinilabs/custom-icons"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Demo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [config, setConfig] = <span class="hljs-title function_">useState</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"lucide"</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">"Bot"</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">28</span>,
    <span class="hljs-attr">color</span>: <span class="hljs-string">"#1e90ff"</span>,
    <span class="hljs-attr">dataUrl</span>: <span class="hljs-literal">undefined</span>,
  });

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">24</span> }}&gt;</span>
      {/* æ¸²æŸ“å½“å‰é…ç½®çš„å›¾æ ‡ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">ConfigurableIcon</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">{config.type}</span>
        <span class="hljs-attr">name</span>=<span class="hljs-string">{config.name}</span>
        <span class="hljs-attr">size</span>=<span class="hljs-string">{config.size}</span>
        <span class="hljs-attr">color</span>=<span class="hljs-string">{config.color}</span>
        <span class="hljs-attr">dataUrl</span>=<span class="hljs-string">{config.dataUrl}</span>
      /&gt;</span>

      {/* äº¤äº’å¼é€‰æ‹©ä¸é…ç½® */}
      <span class="hljs-tag">&lt;<span class="hljs-name">IconPicker</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{config}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{setConfig}</span>
        <span class="hljs-attr">configurable</span>
        <span class="hljs-attr">theme</span>=<span class="hljs-string">"light"</span>
        <span class="hljs-attr">locale</span>=<span class="hljs-string">"zh-CN"</span>
        <span class="hljs-attr">controls</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">type:</span> <span class="hljs-attr">true</span>,
          <span class="hljs-attr">name:</span> <span class="hljs-attr">true</span>,
          <span class="hljs-attr">size:</span> <span class="hljs-attr">true</span>,
          <span class="hljs-attr">color:</span> <span class="hljs-attr">true</span>,
          <span class="hljs-attr">image:</span> <span class="hljs-attr">true</span>,
        }}
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>å¦‚æœä½ éœ€è¦æŸ¥çœ‹å¯é€‰çš„ <code>Lucide</code> å›¾æ ‡åç§°ï¼Œé€‰æ‹©å™¨æ—å·²å†…ç½®å¿«æ·é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flucide.dev%2Ficons%2F" target="_blank" title="https://lucide.dev/icons/" ref="nofollow noopener noreferrer">lucide.dev/icons/</a></li>
</ul>
<h2 data-id="heading-4">åŸºç¡€æ•ˆæœ</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1ce2c691a2f42378b1225226f89d517~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5aSc5a-75pm05aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765031701&amp;x-signature=iEKLg6Q4SWN%2BLD2esTQ2ZyanGCA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">ç»„ä»¶è¯¦è§£</h2>
<h3 data-id="heading-6">ConfigurableIcon</h3>
<p>ç”¨äºåœ¨ä»»æ„ä½ç½®æ¸²æŸ“ä¸€ä¸ªå›¾æ ‡ã€‚</p>
<ul>
<li>å…³é”®å±æ€§
<ul>
<li><code>type</code>: å›¾æ ‡ç±»å‹ï¼ˆå¦‚ <code>lucide</code> æˆ–è‡ªå®šä¹‰ï¼‰</li>
<li><code>name</code>: å›¾æ ‡åç§°ï¼ˆ<code>type=lucide</code> æ—¶ä¸º Lucide åç§°ï¼‰</li>
<li><code>size</code>: æ•°å€¼å°ºå¯¸ï¼ˆpxï¼‰</li>
<li><code>color</code>: é¢œè‰²ï¼ˆåå…­è¿›åˆ¶æˆ– CSS é¢œè‰²ï¼‰</li>
<li><code>dataUrl</code>: å½“ä½¿ç”¨è‡ªå®šä¹‰å›¾ç‰‡æ—¶çš„ <code>data:</code> URL</li>
</ul>
</li>
</ul>
<p>ç¤ºä¾‹ï¼ˆè‡ªå®šä¹‰å›¾ç‰‡ï¼‰ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">ConfigurableIcon</span>
  <span class="hljs-keyword">type</span>=<span class="hljs-string">"custom"</span>
  name=<span class="hljs-string">"my-logo"</span>
  dataUrl=<span class="hljs-string">"data:image/png;base64,...."</span>
  size={<span class="hljs-number">28</span>}
  color=<span class="hljs-string">"#1e90ff"</span> <span class="hljs-comment">// è‡ªå®šä¹‰å›¾ç‰‡æ—¶é€šå¸¸å¿½ç•¥é¢œè‰²</span>
/&gt;
</code></pre>
<h3 data-id="heading-7">IconPicker</h3>
<p>ä¸€ä¸ªå°†é¢„è§ˆä¸é…ç½®æ§ä»¶æ•´åˆåœ¨ä¸€èµ·çš„é€‰æ‹©å™¨ã€‚å¯æ’åœ¨è®¾ç½®é¢æ¿æˆ–è¡¨å•ä¸­ï¼Œè®©ç”¨æˆ·è‡ªè¡ŒæŒ‘é€‰æˆ–ä¸Šä¼ ã€‚</p>
<ul>
<li>
<p>å¸¸ç”¨å±æ€§</p>
<ul>
<li><code>value</code>: å½“å‰å›¾æ ‡é…ç½®å¯¹è±¡</li>
<li><code>onChange(next)</code>: é…ç½®å˜åŒ–å›è°ƒ</li>
<li><code>configurable</code>: æ˜¯å¦å±•ç¤ºé…ç½®é¢æ¿</li>
<li><code>controls</code>: æ§ä»¶å¼€å…³é›†åˆï¼ˆ<code>type/name/size/color/image</code> ç­‰ï¼‰</li>
<li><code>theme</code>: <code>light | dark</code></li>
<li><code>locale</code>: <code>zh-CN | en-US</code></li>
<li><code>i18n</code>: æ–‡æ¡ˆå¯¹è±¡ï¼ˆå¯è¦†ç›–é»˜è®¤æ–‡æ¡ˆï¼‰</li>
</ul>
</li>
<li>
<p>æ§ä»¶å¼€å…³ç¤ºä¾‹</p>
</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">IconPicker</span>
  value={config}
  onChange={setConfig}
  configurable
  controls={{
    <span class="hljs-attr">type</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">color</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">image</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ‰“å¼€å³å‡ºç°ä¸Šä¼ æ§ä»¶</span>
  }}
/&gt;
</code></pre>
<ul>
<li>ä¸»é¢˜ä¸å›½é™…åŒ–</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">IconPicker</span>
  value={config}
  onChange={setConfig}
  configurable
  theme=<span class="hljs-string">"dark"</span>
  locale=<span class="hljs-string">"en-US"</span>
/&gt;
</code></pre>
<h2 data-id="heading-8">è¿›é˜¶ç¤ºä¾‹ï¼šé¢æ¿å†…æ‰¹é‡é…ç½®</h2>
<p>å°†å¤šä¸ªå›¾æ ‡é…ç½®æˆä¸€ç»„ï¼Œä¾›èœå•æˆ–å¡ç‰‡æ¨¡å—ç»Ÿä¸€ç®¡ç†ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">IconsPanel</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [items, setItems] = <span class="hljs-title function_">useState</span>([
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">config</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"lucide"</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"Home"</span>, <span class="hljs-attr">size</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">"#444"</span> } },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">config</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"lucide"</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"Settings"</span>, <span class="hljs-attr">size</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">"#444"</span> } },
  ]);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateItem</span> = (<span class="hljs-params">id, next</span>) =&gt;
    <span class="hljs-title function_">setItems</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span>
      prev.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">it</span>) =&gt;</span> (it.<span class="hljs-property">id</span> === id ? { ...it, <span class="hljs-attr">config</span>: next } : it))
    );

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> "<span class="hljs-attr">grid</span>", <span class="hljs-attr">gap:</span> <span class="hljs-attr">16</span> }}&gt;</span>
      {items.map((it) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{it.id}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">12</span>, <span class="hljs-attr">border:</span> "<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>", <span class="hljs-attr">borderRadius:</span> <span class="hljs-attr">8</span> }}&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">ConfigurableIcon</span> {<span class="hljs-attr">...it.config</span>} /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">IconPicker</span>
            <span class="hljs-attr">value</span>=<span class="hljs-string">{it.config}</span>
            <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(next)</span> =&gt;</span> updateItem(it.id, next)}
            configurable
            theme="light"
            locale="zh-CN"
            controls={{ type: true, name: true, size: true, color: true, image: false }}
          /&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-9">è®¾è®¡ä¸å·¥ç¨‹åä½œå»ºè®®</h2>
<ul>
<li>è®¾è®¡æä¾›å‘½åè§„èŒƒï¼šä¾‹å¦‚ç»Ÿä¸€ä½¿ç”¨ Lucide çš„å›¾æ ‡åé›†åˆï¼Œé¿å…éšæ„å‘½åã€‚</li>
<li>ç®¡ç†é¢æ¿é€‚é…ï¼šé€šè¿‡ <code>controls</code> å¼€å…³ä¸åŒè§’è‰²çœ‹åˆ°çš„æ§ä»¶ï¼ˆè¿è¥åªæ”¹é¢œè‰²ä¸å¤§å°ã€å¼€å‘å¯ä¿®æ”¹ç±»å‹ä¸åç§°ï¼‰ã€‚</li>
<li>ä¸»é¢˜å˜é‡æ‰˜ç®¡ï¼šå°†é¢œè‰²ä¸å°ºå¯¸ä½œä¸ºâ€œè®¾è®¡ä»¤ç‰Œâ€ï¼Œç»Ÿä¸€ç®¡ç†ä¸å›æ”¶ã€‚</li>
</ul>
<h2 data-id="heading-10">å¸¸è§é—®é¢˜</h2>
<ul>
<li>è‡ªå®šä¹‰å›¾ç‰‡ä¼šåº”ç”¨é¢œè‰²å—ï¼Ÿ
<ul>
<li>é€šå¸¸ä¸ä¼šï¼›é¢œè‰²æ›´é€‚ç”¨äºçŸ¢é‡å›¾æ ‡ã€‚è‡ªå®šä¹‰å›¾ç‰‡ç”±å›¾ç‰‡æœ¬èº«å†³å®šè§†è§‰ã€‚</li>
</ul>
</li>
<li>å¦‚ä½•é€‰æ‹© Lucide å›¾æ ‡åï¼Ÿ
<ul>
<li>æ‰“å¼€ <code>https://lucide.dev/icons/</code>ï¼Œåœ¨é€‰æ‹©å™¨é‡Œè¾“å…¥å¯¹åº”åç§°å³å¯ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/529fdc7ae7c048ceb579526842c9ab7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5aSc5a-75pm05aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765031701&amp;x-signature=N1huXI%2FMzC9%2BA8WyLPjGOtCbcxU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-11">å°ç»“</h2>
<p><code>@infinilabs/custom-icons</code> è®©â€œå›¾æ ‡å³é…ç½®â€çš„èƒ½åŠ›è½åœ°ï¼šä»ä¸»é¢˜ä¸å›½é™…åŒ–ï¼Œåˆ°è‡ªå®šä¹‰å›¾ç‰‡ä¸ç»Ÿä¸€é£æ ¼ï¼Œæ—¢èƒ½ä¿è¯è®¾è®¡ä¸€è‡´æ€§ï¼Œåˆç»™äºˆä¸šåŠ¡è¶³å¤Ÿè‡ªç”±åº¦ã€‚æŠŠå®ƒæ¥å…¥ä½ çš„ç®¡ç†é¢æ¿æˆ–è®¾ç½®é¡µï¼Œè®©å›¾æ ‡æˆä¸ºäº§å“çš„å¼ºå¤§è¡¨è¾¾åŠ›ï¼Œè€Œä¸æ˜¯ç»´æŠ¤è´Ÿæ‹…ã€‚</p>
<p>å¦‚æœä½ å¯¹æ›´å¤šåœºæ™¯ï¼ˆå¦‚åŸºäºè§’è‰²çš„æ§ä»¶å¯è§æ€§ã€å›¾æ ‡åº“æ‰©å±•ï¼‰æœ‰æƒ³æ³•ï¼Œæ¬¢è¿ç»§ç»­äº¤æµä¸å…±å»ºï¼</p>
<p>å¼€æºå…±å»ºï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fui-common" target="_blank" title="https://github.com/infinilabs/ui-common" ref="nofollow noopener noreferrer">github.com/infinilabs/â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æµ…è°ˆC++ä¸Cè¯­è¨€äºŒè¿›åˆ¶æ–‡ä»¶å·®å¼‚(ä»ä¸€æ¬¡é“¾æ¥é”™è¯¯è¯´èµ·)]]></title>    <link>https://juejin.cn/post/7577705544874917926</link>    <guid>https://juejin.cn/post/7577705544874917926</guid>    <pubDate>2025-11-29T14:53:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577705544874917926" data-draft-id="7577718777481429030" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æµ…è°ˆC++ä¸Cè¯­è¨€äºŒè¿›åˆ¶æ–‡ä»¶å·®å¼‚(ä»ä¸€æ¬¡é“¾æ¥é”™è¯¯è¯´èµ·)"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-29T14:53:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç äº‹æ¼«è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æµ…è°ˆC++ä¸Cè¯­è¨€äºŒè¿›åˆ¶æ–‡ä»¶å·®å¼‚(ä»ä¸€æ¬¡é“¾æ¥é”™è¯¯è¯´èµ·)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç äº‹æ¼«è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T14:53:25.000Z" title="Sat Nov 29 2025 14:53:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>"undefined reference to `func' "ï¼Œè¿™ä¸ªçœ‹ä¼¼ç®€å•çš„é“¾æ¥é”™è¯¯èƒŒåï¼Œéšè—ç€Cä¸C++äºŒè¿›åˆ¶æ–‡ä»¶çš„æ ¹æœ¬å·®å¼‚ã€‚å¾ˆå¤šå¼€å‘è€…è®¤ä¸ºC++åªæ˜¯"C with Classes"ï¼Œå´ä¸çŸ¥è¿™å¯¹"äº²å¯†å…„å¼Ÿ"åœ¨äºŒè¿›åˆ¶å±‚é¢æ—©å·²åˆ†é“æ‰¬é•³ã€‚</p>
<p>åœ¨è½¯ä»¶å¼€å‘çš„æ¼”è¿›å†ç¨‹ä¸­ï¼ŒC++ä½œä¸ºCè¯­è¨€çš„å»¶ä¼¸ï¼Œå§‹ç»ˆä¿æŒç€é«˜åº¦çš„è¯­æ³•å…¼å®¹æ€§ã€‚è¿™ç§è¡¨é¢ä¸Šçš„ç›¸ä¼¼æ€§å´æ©ç›–äº†ä¸¤è€…åœ¨ç¼–è¯‘äº§ç‰©å±‚é¢çš„æ·±åˆ»å·®å¼‚ã€‚æœ¬æ–‡å°†ä»äºŒè¿›åˆ¶æ–‡ä»¶çš„è§†è§’ï¼Œæ·±å…¥å‰–æC++ä¸Cè¯­è¨€åœ¨ç›®æ ‡ä»£ç ç”Ÿæˆæœºåˆ¶ä¸Šçš„æœ¬è´¨åŒºåˆ«ï¼Œæ­ç¤ºé¢å‘å¯¹è±¡ã€æ³›å‹ç¼–ç¨‹ç­‰é«˜çº§ç‰¹æ€§åœ¨æœºå™¨å±‚é¢çš„å®ç°ä»£ä»·ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€åç§°ä¿®é¥°ï¼šå‡½æ•°æ ‡è¯†çš„ç¼–ç é©å‘½</h2>
<h3 data-id="heading-1">1.1 Cè¯­è¨€çš„æœ´ç´ å‘½åç­–ç•¥</h3>
<p>Cè¯­è¨€é‡‡ç”¨æä¸ºç®€å•çš„åç§°ä¿®é¥°æ–¹æ¡ˆã€‚ç”±äºä¸æ”¯æŒå‡½æ•°é‡è½½ï¼Œç¼–è¯‘å™¨åªéœ€åœ¨ç¬¦å·è¡¨ä¸­ç»´æŠ¤å‡½æ•°åçš„åŸå§‹æ ‡è¯†ã€‚ä¾‹å¦‚å‡½æ•°<code>void calculate(int value)</code>åœ¨ç›®æ ‡æ–‡ä»¶ä¸­é€šå¸¸ä¿å­˜ä¸º<code>calculate</code>æˆ–<code>_calculate</code>ï¼ˆæŸäº›å¹³å°æ·»åŠ ä¸‹åˆ’çº¿å‰ç¼€ï¼‰ã€‚è¿™ç§ç®€çº¦ä¸»ä¹‰ä½¿å¾—é“¾æ¥è¿‡ç¨‹ç›´æ¥æ˜äº†ï¼Œä½†åŒæ—¶ä¹Ÿé™åˆ¶äº†è¯­è¨€çš„è¡¨è¾¾èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-2">1.2 C++çš„å‘½åè¿·å®«</h3>
<p>ä¸ºæ”¯æŒå‡½æ•°é‡è½½è¿™ä¸€æ ¸å¿ƒç‰¹æ€§ï¼ŒC++å¼•å…¥äº†å¤æ‚çš„åç§°ä¿®é¥°æœºåˆ¶ã€‚ç¼–è¯‘å™¨å°†å‡½æ•°åã€å‚æ•°ç±»å‹ã€ç±»åŸŸã€å‘½åç©ºé—´ç­‰ä¿¡æ¯ç¼–ç ä¸ºå†…éƒ¨ç¬¦å·ï¼Œå½¢æˆå”¯ä¸€çš„é“¾æ¥æ ‡è¯†ã€‚æ¯”è¾ƒä»¥ä¸‹é‡è½½å‡½æ•°ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">namespace</span> Geometry {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Vector</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">magnitude</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
        <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">float</span> <span class="hljs-title">magnitude</span><span class="hljs-params">(<span class="hljs-type">const</span> Vector&amp; v)</span></span>;
    };
}

<span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">compute</span><span class="hljs-params">(<span class="hljs-type">float</span> value)</span></span>;
<span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">compute</span><span class="hljs-params">(<span class="hljs-type">double</span> value, <span class="hljs-type">int</span> precision)</span></span>;
</code></pre>
<p>ä¸Šè¿°å‡½æ•°å¯èƒ½è¢«ä¿®é¥°ä¸ºï¼š</p>
<ul>
<li><code>_ZN8Geometry6Vector9magnitudeEv</code> (æˆå‘˜å‡½æ•°)</li>
<li><code>_ZN8Geometry6Vector9magnitudeERKS0_</code> (é™æ€æˆå‘˜å‡½æ•°)</li>
<li><code>_Z7computef</code> (å‚æ•°ä¸ºfloat)</li>
<li><code>_Z7computedf</code> (å‚æ•°ä¸ºdoubleå’Œint)</li>
</ul>
<p>è¿™ç§ç¼–ç ç¡®ä¿äº†ç¬¦å·çš„å”¯ä¸€æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ˜¾è‘—çš„å·¥ç¨‹å½±å“ã€‚å®è·µä¸­ï¼ŒC++ä¸Cçš„äº’æ“ä½œå¿…é¡»é€šè¿‡<code>extern "C"</code>é“¾æ¥æŒ‡ç¤ºç¬¦ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {
    <span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"legacy_c_library.h"</span></span>
}
</code></pre>
<p>è¯¥æŒ‡ä»¤å¼ºåˆ¶C++ç¼–è¯‘å™¨é‡‡ç”¨Cé£æ ¼çš„åç§°ä¿®é¥°ï¼Œç¡®ä¿ç¬¦å·åœ¨é“¾æ¥æ—¶çš„æ­£ç¡®è§£æã€‚</p>
<h2 data-id="heading-3">äºŒã€é¢å‘å¯¹è±¡æœºåˆ¶çš„äºŒè¿›åˆ¶å®ç°</h2>
<h3 data-id="heading-4">2.1 å†…å­˜å¸ƒå±€ä¸thisæŒ‡é’ˆä¼ é€’</h3>
<p>C++ç±»çš„éé™æ€æˆå‘˜å˜é‡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ä¸Cç»“æ„ä½“é«˜åº¦ç›¸ä¼¼â€”â€”é¡ºåºå­˜å‚¨ï¼Œå­—èŠ‚å¯¹é½ã€‚ç„¶è€Œæˆå‘˜å‡½æ•°çš„å®ç°å´æˆªç„¶ä¸åŒï¼šå®ƒä»¬ä½œä¸ºæ™®é€šå‡½æ•°å­˜åœ¨äºä»£ç æ®µï¼Œé€šè¿‡éšå¼çš„<code>this</code>æŒ‡é’ˆè®¿é—®å¯¹è±¡æ•°æ®ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹æˆå‘˜å‡½æ•°è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> {
    <span class="hljs-type">int</span> id;
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">()</span></span>;
};

Widget obj;
obj.<span class="hljs-built_in">update</span>();
</code></pre>
<p>ç¼–è¯‘å™¨å°†å…¶è½¬æ¢ä¸ºç­‰ä»·çš„Cé£æ ¼è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> _ZN6Widget6updateEv(Widget* this); <span class="hljs-comment">//  mangled name</span>

Widget obj;
_ZN6Widget6updateEv(&amp;obj); <span class="hljs-comment">// ä¼ é€’thisæŒ‡é’ˆ</span>
</code></pre>
<p><code>this</code>æŒ‡é’ˆçš„ä¼ é€’çº¦å®šå› å¹³å°è€Œå¼‚ï¼šx86-64 System V ABIä½¿ç”¨<code>rdi</code>å¯„å­˜å™¨ï¼Œè€Œx86-64 Windows ABIä½¿ç”¨<code>rcx</code>å¯„å­˜å™¨ã€‚</p>
<h3 data-id="heading-5">2.2 è™šå‡½æ•°ä¸åŠ¨æ€ç»‘å®šçš„ä»£ä»·</h3>
<p>å¤šæ€æ˜¯C++æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå…¶åœ¨äºŒè¿›åˆ¶å±‚é¢çš„å®ç°ä¹Ÿæœ€ä¸ºå¤æ‚ã€‚è™šå‡½æ•°æœºåˆ¶é€šè¿‡è™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰å’Œè™šå‡½æ•°æŒ‡é’ˆï¼ˆvptrï¼‰å®ç°è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šã€‚</p>
<h4 data-id="heading-6">2.2.1 è™šå‡½æ•°è¡¨ç»“æ„</h4>
<p>å¯¹äºåŒ…å«è™šå‡½æ•°çš„ç±»ï¼Œç¼–è¯‘å™¨åœ¨åªè¯»æ•°æ®æ®µåˆ›å»ºè™šå‡½æ•°è¡¨ã€‚æ¯ä¸ªvtableåŒ…å«ï¼š</p>
<ul>
<li>ç±»å‹ä¿¡æ¯æŒ‡é’ˆï¼ˆæŒ‡å‘RTTIæ•°æ®ï¼‰</li>
<li>è™šå‡½æ•°åœ°å€æ•°ç»„</li>
<li>åç§»é‡ä¿¡æ¯ï¼ˆå¤šé‡ç»§æ‰¿æ—¶ï¼‰</li>
</ul>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">vfunc1</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">vfunc2</span><span class="hljs-params">()</span></span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">vfunc1</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">vfunc3</span><span class="hljs-params">()</span></span>;
};
</code></pre>
<p>å¯¹åº”çš„vtableå¸ƒå±€å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">Base vtable:
    [<span class="hljs-number">0</span>] &amp;Base::rtti_complete
    [<span class="hljs-number">1</span>] &amp;Base::vfunc1
    [<span class="hljs-number">2</span>] &amp;Base::vfunc2

Derived vtable:
    [<span class="hljs-number">0</span>] &amp;Derived::rtti_complete  
    [<span class="hljs-number">1</span>] &amp;Derived::vfunc1      <span class="hljs-comment">// é‡å†™</span>
    [<span class="hljs-number">2</span>] &amp;Base::vfunc2         <span class="hljs-comment">// ç»§æ‰¿</span>
    [<span class="hljs-number">3</span>] &amp;Derived::vfunc3      <span class="hljs-comment">// æ–°å¢</span>
</code></pre>
<h4 data-id="heading-7">2.2.2 è™šå‡½æ•°è°ƒç”¨è§£æ</h4>
<p>è™šå‡½æ•°è°ƒç”¨<code>base_ptr-&gt;vfunc1()</code>è¢«ç¼–è¯‘ä¸ºï¼š</p>
<pre><code class="hljs language-assembly" lang="assembly">; 1. é€šè¿‡å¯¹è±¡è·å–vptr
mov rax, [rdi]        ; rdiå­˜å‚¨thisï¼Œ[rdi]æ˜¯vptr

; 2. ä»vtableè·å–å‡½æ•°åœ°å€  
mov rax, [rax + 8]    ; å‡è®¾vfunc1åœ¨vtableåç§»8å¤„

; 3. é—´æ¥è°ƒç”¨
call rax
</code></pre>
<p>ä¸æ™®é€šå‡½æ•°è°ƒç”¨ç›¸æ¯”ï¼Œè™šå‡½æ•°è°ƒç”¨éœ€è¦é¢å¤–çš„ä¸¤æ¬¡å†…å­˜è®¿é—®ï¼Œå¹¶é˜»ç¢äº†å†…è”ä¼˜åŒ–ï¼Œè¿™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡åœ¨æ€§èƒ½ä¸Šçš„å…¸å‹ä»£ä»·ã€‚</p>
<h2 data-id="heading-8">ä¸‰ã€æ¨¡æ¿å®ä¾‹åŒ–ä¸ä»£ç è†¨èƒ€</h2>
<h3 data-id="heading-9">3.1 ç¼–è¯‘æœŸä»£ç ç”Ÿæˆæœºåˆ¶</h3>
<p>C++æ¨¡æ¿æ˜¯å›¾çµå®Œå¤‡çš„ç¼–è¯‘æœŸå…ƒç¼–ç¨‹ç³»ç»Ÿï¼Œå…¶æ ¸å¿ƒæœºåˆ¶æ˜¯å®ä¾‹åŒ–ã€‚æ¯æ¬¡ä½¿ç”¨æ–°ç±»å‹å‚æ•°å®ä¾‹åŒ–æ¨¡æ¿æ—¶ï¼Œç¼–è¯‘å™¨éƒ½ä¼šç”Ÿæˆç‰¹åŒ–ç‰ˆæœ¬çš„å®Œæ•´ä»£ç ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Container</span> {
    T* data;
    <span class="hljs-type">size_t</span> size;
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_back</span><span class="hljs-params">(<span class="hljs-type">const</span> T&amp; item)</span></span>;
    T&amp; <span class="hljs-keyword">operator</span>[](<span class="hljs-type">size_t</span> index);
};

<span class="hljs-comment">// å®ä¾‹åŒ–ä¸åŒç‰ˆæœ¬</span>
Container&lt;<span class="hljs-type">int</span>&gt; int_container;
Container&lt;std::string&gt; string_container;
</code></pre>
<p>ç¼–è¯‘å™¨åˆ†åˆ«ä¸º<code>Container&lt;int&gt;</code>å’Œ<code>Container&lt;std::string&gt;</code>ç”Ÿæˆç‹¬ç«‹çš„äºŒè¿›åˆ¶ä»£ç ï¼ŒåŒ…æ‹¬æ‰€æœ‰æˆå‘˜å‡½æ•°çš„ç‰¹åŒ–ç‰ˆæœ¬ã€‚</p>
<h3 data-id="heading-10">3.2 äºŒè¿›åˆ¶è†¨èƒ€çš„ç¼“è§£ç­–ç•¥</h3>
<p>é‡å¤çš„æ¨¡æ¿å®ä¾‹åŒ–å¯èƒ½å¯¼è‡´æ˜¾è‘—çš„ä»£ç è†¨èƒ€ã€‚ç°ä»£C++é‡‡ç”¨å¤šç§æŠ€æœ¯ç¼“è§£è¯¥é—®é¢˜ï¼š</p>
<ul>
<li><strong>æ˜¾å¼å®ä¾‹åŒ–</strong>ï¼šåœ¨ç‰¹å®šç¼–è¯‘å•å…ƒä¸­æ˜¾å¼å®ä¾‹åŒ–æ¨¡æ¿ï¼Œé¿å…åœ¨å…¶ä»–å•å…ƒä¸­é‡å¤ç”Ÿæˆ</li>
<li><strong>å¤–éƒ¨æ¨¡æ¿</strong>ï¼ˆC++11ï¼‰ï¼šä½¿ç”¨<code>extern template</code>å£°æ˜é˜»æ­¢éšå¼å®ä¾‹åŒ–</li>
<li><strong>å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤</strong>ï¼šç¼–è¯‘å™¨è¯†åˆ«å¹¶åˆå¹¶ç›¸åŒçš„å®ä¾‹åŒ–ä»£ç </li>
</ul>
<h2 data-id="heading-11">å››ã€å…¨å±€å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç†</h2>
<h3 data-id="heading-12">4.1 æ„é€ ä¸ææ„çš„è‡ªåŠ¨åŒ–</h3>
<p>C++å…¨å±€å’Œé™æ€å¯¹è±¡çš„æ„é€ /ææ„é€šè¿‡ç‰¹å®šçš„äºŒè¿›åˆ¶æ®µå®ç°è‡ªåŠ¨åŒ–ç®¡ç†ã€‚ç¼–è¯‘å™¨ç”Ÿæˆåˆå§‹åŒ–ä»£ç ï¼Œåœ¨mainå‡½æ•°æ‰§è¡Œå‰æ„é€ æ‰€æœ‰å…¨å±€å¯¹è±¡ï¼Œåœ¨ç¨‹åºé€€å‡ºæ—¶æ‰§è¡Œææ„ã€‚</p>
<p>ELFæ ¼å¼çš„å¯æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨ä»¥ä¸‹ç‰¹æ®Šæ®µï¼š</p>
<ul>
<li><code>.init_array</code>ï¼šå­˜å‚¨å…¨å±€æ„é€ å‡½æ•°æŒ‡é’ˆæ•°ç»„</li>
<li><code>.fini_array</code>ï¼šå­˜å‚¨å…¨å±€ææ„å‡½æ•°æŒ‡é’ˆæ•°ç»„</li>
</ul>
<p>ç¨‹åºå¯åŠ¨æµç¨‹ä¼ªä»£ç ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„å…¥å£ç‚¹</span>
_start() {
    <span class="hljs-comment">// 1. è¿è¡Œæ—¶ç¯å¢ƒåˆå§‹åŒ–</span>
    __libc_start_init();
    
    <span class="hljs-comment">// 2. æ‰§è¡Œ.init_arrayä¸­çš„æ‰€æœ‰æ„é€ å‡½æ•°</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> ctor : .init_array) {
        ctor();
    }
    
    <span class="hljs-comment">// 3. è°ƒç”¨mainå‡½æ•°</span>
    <span class="hljs-type">int</span> result = main();
    
    <span class="hljs-comment">// 4. æ‰§è¡Œ.fini_arrayä¸­çš„ææ„å‡½æ•°</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> dtor : .fini_array) {
        dtor();
    }
    
    <span class="hljs-comment">// 5. ç¨‹åºé€€å‡º</span>
    _exit(result);
}
</code></pre>
<h3 data-id="heading-13">4.2 é™æ€åˆå§‹åŒ–é¡ºåºé—®é¢˜</h3>
<p>è¿™ç§è‡ªåŠ¨åŒ–æœºåˆ¶å¼•å…¥äº†è‘—åçš„"é™æ€åˆå§‹åŒ–é¡ºåºfiasco"é—®é¢˜ï¼šä¸åŒç¼–è¯‘å•å…ƒä¸­çš„å…¨å±€å¯¹è±¡æ„é€ é¡ºåºæœªå®šä¹‰ã€‚å®è·µä¸­å¸¸é‡‡ç”¨"æ„é€ æ—¶é¦–æ¬¡ä½¿ç”¨"æƒ¯ç”¨æ³•è§„é¿è¯¥é—®é¢˜ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">MyClass&amp; <span class="hljs-title">get_global_instance</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">static</span> MyClass instance;  <span class="hljs-comment">// C++11ä¿è¯çº¿ç¨‹å®‰å…¨</span>
    <span class="hljs-keyword">return</span> instance;
}
</code></pre>
<h2 data-id="heading-14">äº”ã€å¼‚å¸¸å¤„ç†çš„åŸºç¡€è®¾æ–½</h2>
<h3 data-id="heading-15">5.1 æ ˆå±•å¼€ä¸å¼‚å¸¸ä¼ æ’­</h3>
<p>C++å¼‚å¸¸å¤„ç†ä¾èµ–å¤æ‚çš„è¿è¡Œæ—¶æ”¯æŒã€‚å½“æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿå¿…é¡»ï¼š</p>
<ol>
<li>åœ¨è°ƒç”¨æ ˆä¸­æŸ¥æ‰¾åŒ¹é…çš„catchå—</li>
<li>å±•å¼€æ ˆå¸§ï¼Œææ„æ‰€æœ‰å±€éƒ¨å¯¹è±¡</li>
<li>è½¬ç§»æ§åˆ¶æµåˆ°å¼‚å¸¸å¤„ç†å™¨</li>
</ol>
<p>è¿™å¥—æœºåˆ¶åœ¨äºŒè¿›åˆ¶å±‚é¢é€šè¿‡<code>.eh_frame</code>æ®µï¼ˆå¼‚å¸¸å¤„ç†å¸§ï¼‰å®ç°ï¼Œè¯¥æ®µåŒ…å«DWARFæ ¼å¼çš„è°ƒç”¨æ ˆå±•å¼€ä¿¡æ¯ã€‚</p>
<h3 data-id="heading-16">5.2 é›¶å¼€é”€å¼‚å¸¸å¤„ç†åŸåˆ™</h3>
<p>ç°ä»£C++ç¼–è¯‘å™¨éµå¾ª"é›¶å¼€é”€"åŸåˆ™ï¼šä¸æŠ›å‡ºå¼‚å¸¸çš„ä»£ç ä¸åº”æ‰¿æ‹…å¼‚å¸¸å¤„ç†å¼€é”€ã€‚è¿™é€šè¿‡è¡¨é©±åŠ¨å¼‚å¸¸å¤„ç†å®ç°â€”â€”æ­£å¸¸æ‰§è¡Œè·¯å¾„ä¸åŒ…å«é¢å¤–æ£€æŸ¥ï¼Œå¼‚å¸¸å¤„ç†å…ƒæ•°æ®å­˜å‚¨åœ¨ç‹¬ç«‹çš„æ®µä¸­ã€‚</p>
<p>æ¯”è¾ƒä»¥ä¸‹ä¸¤ç§é”™è¯¯å¤„ç†æ–¹å¼çš„å¼€é”€ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å¼‚å¸¸æ–¹å¼ - æ— é”™è¯¯æ—¶é›¶å¼€é”€</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">parse_config</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; filename)</span> </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">auto</span> config = <span class="hljs-built_in">parse_file</span>(filename); <span class="hljs-comment">// å¯èƒ½æŠ›å‡º</span>
        <span class="hljs-built_in">apply_config</span>(config);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> parse_error&amp; e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-comment">// é”™è¯¯ç æ–¹å¼ - æ¯æ¬¡è°ƒç”¨éƒ½æœ‰æ£€æŸ¥å¼€é”€</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">parse_config</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; filename)</span> </span>{
    parse_result result = <span class="hljs-built_in">parse_file_ec</span>(filename);
    <span class="hljs-keyword">if</span> (result.error) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-built_in">apply_config</span>(result.value);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h2 data-id="heading-17">å…­ã€è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ï¼ˆRTTIï¼‰</h2>
<h3 data-id="heading-18">6.1 typeidä¸dynamic_castçš„å®ç°</h3>
<p>RTTIä½¿å¾—C++ç¨‹åºèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æŸ¥è¯¢ç±»å‹ä¿¡æ¯ã€‚å¯¹äºå¤šæ€ç±»å‹ï¼ˆåŒ…å«è™šå‡½æ•°çš„ç±»ï¼‰ï¼Œ<code>typeid</code>å’Œ<code>dynamic_cast</code>é€šè¿‡è™šå‡½æ•°è¡¨è®¿é—®<code>type_info</code>å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> { <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Base</span>() = <span class="hljs-keyword">default</span>; };
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process</span><span class="hljs-params">(Base* ptr)</span> </span>{
    <span class="hljs-comment">// typeidæŸ¥è¯¢</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">typeid</span>(*ptr) == <span class="hljs-built_in">typeid</span>(Derived)) {
        <span class="hljs-comment">// dynamic_castè½¬æ¢</span>
        Derived* d = <span class="hljs-built_in">dynamic_cast</span>&lt;Derived*&gt;(ptr);
    }
}
</code></pre>
<p><code>type_info</code>å¯¹è±¡åŒ…å«ç±»å‹åç§°å­—ç¬¦ä¸²å’Œç±»å‹æ¯”è¾ƒå‡½æ•°ï¼Œå­˜å‚¨åœ¨åªè¯»æ•°æ®æ®µã€‚<code>dynamic_cast</code>åœ¨å¤æ‚ç»§æ‰¿å±‚æ¬¡ä¸­å¯èƒ½éœ€è¦éå†æ•´ä¸ªç±»å±‚æ¬¡ç»“æ„ï¼Œè¿™æ˜¯å…¶æ€§èƒ½å¼€é”€çš„ä¸»è¦æ¥æºã€‚</p>
<h3 data-id="heading-19">6.2 RTTIçš„ä¼˜åŒ–ä¸ç¦ç”¨</h3>
<p>ç”±äºRTTIçš„ç©ºé—´å’Œæ—¶é—´å¼€é”€ï¼Œæ€§èƒ½æ•æ„Ÿçš„åœºæ™¯å¸¸ç¦ç”¨è¯¥ç‰¹æ€§ã€‚GCC/Clangé€šè¿‡<code>-fno-rtti</code>æ ‡å¿—ç¦ç”¨RTTIï¼Œæ­¤æ—¶<code>typeid</code>å’Œ<code>dynamic_cast</code>å°†æ— æ³•ä½¿ç”¨ï¼Œä½†å¯å‡å°‘äºŒè¿›åˆ¶å¤§å°å¹¶æå‡æ€§èƒ½ã€‚</p>
<h2 data-id="heading-20">æ€§èƒ½å½±å“ä¸å·¥ç¨‹å®è·µ</h2>
<h3 data-id="heading-21">äºŒè¿›åˆ¶ç‰¹å¾å¯¹æ¯”æ€»ç»“</h3>









































<table><thead><tr><th>ç‰¹æ€§ç»´åº¦</th><th>Cè¯­è¨€å®ç°</th><th>C++å®ç°</th><th>æ€§èƒ½å½±å“</th></tr></thead><tbody><tr><td>å‡½æ•°è°ƒç”¨</td><td>ç›´æ¥è°ƒç”¨</td><td>åç§°ä¿®é¥°+å¯èƒ½è™šè°ƒç”¨</td><td>è™šè°ƒç”¨ï¼š+2-3å‘¨æœŸ</td></tr><tr><td>ä»£ç ä½“ç§¯</td><td>ç´§å‡‘</td><td>æ¨¡æ¿å®ä¾‹åŒ–å¯èƒ½è†¨èƒ€</td><td>å¢åŠ I-Cacheå‹åŠ›</td></tr><tr><td>å¯åŠ¨æ—¶é—´</td><td>å¿«é€Ÿ</td><td>å…¨å±€å¯¹è±¡æ„é€ å¼€é”€</td><td>å¾®ç§’çº§å»¶è¿Ÿ</td></tr><tr><td>å¼‚å¸¸å¤„ç†</td><td>setjmp/longjmp</td><td>è¡¨é©±åŠ¨é›¶å¼€é”€</td><td>ä»…å¼‚å¸¸æ—¶å¼€é”€</td></tr><tr><td>ç±»å‹ä¿¡æ¯</td><td>æ— </td><td>RTTIå…ƒæ•°æ®</td><td>ç©ºé—´å¼€é”€+ç±»å‹æŸ¥è¯¢æ—¶é—´</td></tr></tbody></table>
<h3 data-id="heading-22">æ··åˆç¼–ç¨‹æœ€ä½³å®è·µ</h3>
<ol>
<li><strong>æ¸…æ™°çš„æ¥å£è¾¹ç•Œ</strong>ï¼šä½¿ç”¨<code>extern "C"</code>æ˜ç¡®Cé£æ ¼æ¥å£</li>
<li><strong>èµ„æºç®¡ç†éš”ç¦»</strong>ï¼šC++ç«¯ä½¿ç”¨RAIIï¼ŒCç«¯æä¾›æ˜¾å¼çš„create/destroyå‡½æ•°</li>
<li><strong>å¼‚å¸¸è¾¹ç•Œå¤„ç†</strong>ï¼šC++å¼‚å¸¸ä¸åº”ä¼ æ’­åˆ°Cä»£ç ä¸­</li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// C++å°è£…Cåº“çš„å…¸å‹æ¨¡å¼</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseHandle</span> {
    sqlite3* raw_handle;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">DatabaseHandle</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* filename) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">sqlite3_open</span>(filename, &amp;raw_handle) != SQLITE_OK) {
            <span class="hljs-keyword">throw</span> <span class="hljs-built_in">database_error</span>(<span class="hljs-string">"Failed to open database"</span>);
        }
    }
    
    ~<span class="hljs-built_in">DatabaseHandle</span>() {
        <span class="hljs-built_in">sqlite3_close</span>(raw_handle);
    }
    
    <span class="hljs-comment">// ç¦ç”¨æ‹·è´ï¼Œå…è®¸ç§»åŠ¨</span>
    <span class="hljs-built_in">DatabaseHandle</span>(<span class="hljs-type">const</span> DatabaseHandle&amp;) = <span class="hljs-keyword">delete</span>;
    DatabaseHandle&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> DatabaseHandle&amp;) = <span class="hljs-keyword">delete</span>;
    <span class="hljs-built_in">DatabaseHandle</span>(DatabaseHandle&amp;&amp;) = <span class="hljs-keyword">default</span>;
    DatabaseHandle&amp; <span class="hljs-keyword">operator</span>=(DatabaseHandle&amp;&amp;) = <span class="hljs-keyword">default</span>;
};
</code></pre>
<h2 data-id="heading-23">ç»“è®º</h2>
<p>C++åœ¨ä¿æŒCè¯­è¨€è¯­æ³•å…¼å®¹çš„åŒæ—¶ï¼Œé€šè¿‡å¤æ‚çš„äºŒè¿›åˆ¶æœºåˆ¶å®ç°äº†é¢å‘å¯¹è±¡ã€æ³›å‹ç¼–ç¨‹ç­‰é«˜çº§ç‰¹æ€§ã€‚è¿™äº›æœºåˆ¶åœ¨èµ‹äºˆç¨‹åºå‘˜å¼ºå¤§è¡¨è¾¾èƒ½åŠ›çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†åç§°ä¿®é¥°ã€è™šå‡½æ•°è¡¨ã€æ¨¡æ¿å®ä¾‹åŒ–ã€å¼‚å¸¸å¤„ç†å…ƒæ•°æ®ç­‰äºŒè¿›åˆ¶å±‚é¢çš„å¤æ‚æ€§ã€‚</p>
<p>ç†è§£è¿™äº›åº•å±‚å®ç°å·®å¼‚å¯¹äºæ€§èƒ½è°ƒä¼˜ã€æ··åˆç¼–ç¨‹å’Œç³»ç»Ÿè®¾è®¡è‡³å…³é‡è¦ã€‚åœ¨ç°ä»£C++å¼€å‘ä¸­ï¼Œå¼€å‘è€…åº”å½“æ ¹æ®å…·ä½“åœºæ™¯æƒè¡¡é«˜çº§ç‰¹æ€§çš„ä¾¿åˆ©æ€§ä¸åº•å±‚å¼€é”€ï¼Œåœ¨è¡¨è¾¾åŠ›ä¸æ€§èƒ½ä¹‹é—´æ‰¾åˆ°æ°å½“çš„å¹³è¡¡ç‚¹ã€‚éšç€ç¼–è¯‘å™¨æŠ€æœ¯çš„ä¸æ–­è¿›æ­¥ï¼ŒC++æ­£æœç€åœ¨ä¿æŒé›¶å¼€é”€æŠ½è±¡åŸåˆ™çš„åŒæ—¶ï¼Œè¿›ä¸€æ­¥é™ä½äºŒè¿›åˆ¶å¤æ‚åº¦çš„æ–¹å‘å‘å±•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>